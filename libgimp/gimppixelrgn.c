begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* LIBGIMP - The GIMP Library                                                     * Copyright (C) 1995-1997 Peter Mattis and Spencer Kimball                  *  * This library is free software; you can redistribute it and/or  * modify it under the terms of the GNU Library General Public  * License as published by the Free Software Foundation; either  * version 2 of the License, or (at your option) any later version.               *                                                                                * This library is distributed in the hope that it will be useful,                * but WITHOUT ANY WARRANTY; without even the implied warranty of                 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU              * Library General Public License for more details.  *  * You should have received a copy of the GNU Library General Public  * License along with this library; if not, write to the Free  * Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_comment
comment|/* Experimental: comment-out the following #define if a memcpy() call is    slower than compiler-optimized memory copies for transfers of approx.    64-256 bytes.     FYI this #define is a win on Linux486/libc5.  Unbenchmarked on other    architectures.  --adam */
end_comment

begin_define
DECL|macro|MEMCPY_IS_NICE
define|#
directive|define
name|MEMCPY_IS_NICE
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|MEMCPY_IS_NICE
end_ifdef

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|"gimp.h"
end_include

begin_define
DECL|macro|TILE_WIDTH
define|#
directive|define
name|TILE_WIDTH
value|_gimp_tile_width
end_define

begin_define
DECL|macro|TILE_HEIGHT
define|#
directive|define
name|TILE_HEIGHT
value|_gimp_tile_height
end_define

begin_define
DECL|macro|BOUNDS (a,x,y)
define|#
directive|define
name|BOUNDS
parameter_list|(
name|a
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
value|((a< x) ? x : ((a> y) ? y : a))
end_define

begin_typedef
DECL|typedef|GPixelRgnHolder
typedef|typedef
name|struct
name|_GPixelRgnHolder
name|GPixelRgnHolder
typedef|;
end_typedef

begin_typedef
DECL|typedef|GPixelRgnIterator
typedef|typedef
name|struct
name|_GPixelRgnIterator
name|GPixelRgnIterator
typedef|;
end_typedef

begin_struct
DECL|struct|_GPixelRgnHolder
struct|struct
name|_GPixelRgnHolder
block|{
DECL|member|pr
name|GPixelRgn
modifier|*
name|pr
decl_stmt|;
DECL|member|original_data
name|guchar
modifier|*
name|original_data
decl_stmt|;
DECL|member|startx
name|int
name|startx
decl_stmt|;
DECL|member|starty
name|int
name|starty
decl_stmt|;
DECL|member|count
name|int
name|count
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_GPixelRgnIterator
struct|struct
name|_GPixelRgnIterator
block|{
DECL|member|pixel_regions
name|GSList
modifier|*
name|pixel_regions
decl_stmt|;
DECL|member|region_width
name|int
name|region_width
decl_stmt|;
DECL|member|region_height
name|int
name|region_height
decl_stmt|;
DECL|member|portion_width
name|int
name|portion_width
decl_stmt|;
DECL|member|portion_height
name|int
name|portion_height
decl_stmt|;
DECL|member|process_count
name|int
name|process_count
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|int
name|gimp_get_portion_width
parameter_list|(
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|gimp_get_portion_height
parameter_list|(
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gpointer
name|gimp_pixel_rgns_configure
parameter_list|(
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_pixel_rgn_configure
parameter_list|(
name|GPixelRgnHolder
modifier|*
name|prh
parameter_list|,
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|gint
name|_gimp_tile_width
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|gint
name|_gimp_tile_height
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|gimp_pixel_rgn_init (GPixelRgn * pr,GDrawable * drawable,int x,int y,int width,int height,int dirty,int shadow)
name|gimp_pixel_rgn_init
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|GDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|dirty
parameter_list|,
name|int
name|shadow
parameter_list|)
block|{
name|pr
operator|->
name|data
operator|=
name|NULL
expr_stmt|;
name|pr
operator|->
name|drawable
operator|=
name|drawable
expr_stmt|;
name|pr
operator|->
name|bpp
operator|=
name|drawable
operator|->
name|bpp
expr_stmt|;
name|pr
operator|->
name|rowstride
operator|=
name|pr
operator|->
name|bpp
operator|*
name|TILE_WIDTH
expr_stmt|;
name|pr
operator|->
name|x
operator|=
name|x
expr_stmt|;
name|pr
operator|->
name|y
operator|=
name|y
expr_stmt|;
name|pr
operator|->
name|w
operator|=
name|width
expr_stmt|;
name|pr
operator|->
name|h
operator|=
name|height
expr_stmt|;
name|pr
operator|->
name|dirty
operator|=
name|dirty
expr_stmt|;
name|pr
operator|->
name|shadow
operator|=
name|shadow
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_resize (GPixelRgn * pr,int x,int y,int width,int height)
name|gimp_pixel_rgn_resize
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
if|if
condition|(
name|pr
operator|->
name|data
operator|!=
name|NULL
condition|)
name|pr
operator|->
name|data
operator|+=
operator|(
operator|(
name|y
operator|-
name|pr
operator|->
name|y
operator|)
operator|*
name|pr
operator|->
name|rowstride
operator|+
operator|(
name|x
operator|-
name|pr
operator|->
name|x
operator|)
operator|*
name|pr
operator|->
name|bpp
operator|)
expr_stmt|;
name|pr
operator|->
name|x
operator|=
name|x
expr_stmt|;
name|pr
operator|->
name|y
operator|=
name|y
expr_stmt|;
name|pr
operator|->
name|w
operator|=
name|width
expr_stmt|;
name|pr
operator|->
name|h
operator|=
name|height
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_get_pixel (GPixelRgn * pr,guchar * buf,int x,int y)
name|gimp_pixel_rgn_get_pixel
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|tile_data
decl_stmt|;
name|int
name|b
decl_stmt|;
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|tile_data
operator|=
name|tile
operator|->
name|data
operator|+
name|tile
operator|->
name|bpp
operator|*
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|tile
operator|->
name|bpp
condition|;
name|b
operator|++
control|)
operator|*
name|buf
operator|++
operator|=
operator|*
name|tile_data
operator|++
expr_stmt|;
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_get_row (GPixelRgn * pr,guchar * buf,int x,int y,int width)
name|gimp_pixel_rgn_get_row
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|tile_data
decl_stmt|;
name|int
name|bpp
decl_stmt|,
name|inc
decl_stmt|,
name|min
decl_stmt|;
name|int
name|end
decl_stmt|;
name|int
name|boundary
decl_stmt|;
ifndef|#
directive|ifndef
name|MEMCPY_IS_NICE
name|int
name|b
decl_stmt|;
endif|#
directive|endif
name|end
operator|=
name|x
operator|+
name|width
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|end
condition|)
block|{
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|tile_data
operator|=
name|tile
operator|->
name|data
operator|+
operator|(
name|int
operator|)
name|tile
operator|->
name|bpp
operator|*
call|(
name|int
call|)
argument_list|(
name|tile
operator|->
name|ewidth
operator|*
call|(
name|int
call|)
argument_list|(
name|y
operator|%
name|TILE_HEIGHT
argument_list|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
argument_list|)
expr_stmt|;
name|boundary
operator|=
name|x
operator|+
operator|(
name|tile
operator|->
name|ewidth
operator|-
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
name|bpp
operator|=
name|tile
operator|->
name|bpp
expr_stmt|;
ifdef|#
directive|ifdef
name|MEMCPY_IS_NICE
name|memcpy
argument_list|(
operator|(
name|void
operator|*
operator|)
name|buf
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|tile_data
argument_list|,
name|inc
operator|=
operator|(
name|bpp
operator|*
operator|(
operator|(
name|min
operator|=
name|MIN
argument_list|(
name|end
argument_list|,
name|boundary
argument_list|)
operator|)
operator|-
name|x
operator|)
operator|)
argument_list|)
expr_stmt|;
name|x
operator|=
name|min
expr_stmt|;
empty_stmt|;
name|buf
operator|+=
name|inc
expr_stmt|;
else|#
directive|else
for|for
control|(
init|;
name|x
operator|<
name|end
operator|&&
name|x
operator|<
name|boundary
condition|;
name|x
operator|++
control|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|tile
operator|->
name|bpp
condition|;
name|b
operator|++
control|)
operator|*
name|buf
operator|++
operator|=
name|tile_data
index|[
name|b
index|]
expr_stmt|;
name|tile_data
operator|+=
name|bpp
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* MEMCPY_IS_NICE */
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_get_col (GPixelRgn * pr,guchar * buf,int x,int y,int height)
name|gimp_pixel_rgn_get_col
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|tile_data
decl_stmt|;
name|int
name|inc
decl_stmt|;
name|int
name|end
decl_stmt|;
name|int
name|boundary
decl_stmt|;
name|int
name|b
decl_stmt|;
name|end
operator|=
name|y
operator|+
name|height
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|end
condition|)
block|{
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|tile_data
operator|=
name|tile
operator|->
name|data
operator|+
name|tile
operator|->
name|bpp
operator|*
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
name|boundary
operator|=
name|y
operator|+
operator|(
name|tile
operator|->
name|eheight
operator|-
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
operator|)
expr_stmt|;
name|inc
operator|=
name|tile
operator|->
name|bpp
operator|*
name|tile
operator|->
name|ewidth
expr_stmt|;
for|for
control|(
init|;
name|y
operator|<
name|end
operator|&&
name|y
operator|<
name|boundary
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|tile
operator|->
name|bpp
condition|;
name|b
operator|++
control|)
operator|*
name|buf
operator|++
operator|=
name|tile_data
index|[
name|b
index|]
expr_stmt|;
name|tile_data
operator|+=
name|inc
expr_stmt|;
block|}
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_get_rect (GPixelRgn * pr,guchar * buf,int x,int y,int width,int height)
name|gimp_pixel_rgn_get_rect
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|src
decl_stmt|,
modifier|*
name|dest
decl_stmt|;
name|gulong
name|bufstride
decl_stmt|;
name|int
name|xstart
decl_stmt|,
name|ystart
decl_stmt|;
name|int
name|xend
decl_stmt|,
name|yend
decl_stmt|;
name|int
name|xboundary
decl_stmt|;
name|int
name|yboundary
decl_stmt|;
name|int
name|xstep
decl_stmt|,
name|ystep
decl_stmt|;
name|int
name|ty
decl_stmt|,
name|bpp
decl_stmt|;
ifndef|#
directive|ifndef
name|MEMCPY_IS_NICE
name|int
name|b
decl_stmt|,
name|tx
decl_stmt|;
endif|#
directive|endif
name|bpp
operator|=
name|pr
operator|->
name|bpp
expr_stmt|;
name|bufstride
operator|=
name|bpp
operator|*
name|width
expr_stmt|;
name|xstart
operator|=
name|x
expr_stmt|;
name|ystart
operator|=
name|y
expr_stmt|;
name|xend
operator|=
name|x
operator|+
name|width
expr_stmt|;
name|yend
operator|=
name|y
operator|+
name|height
expr_stmt|;
name|ystep
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|yend
condition|)
block|{
name|x
operator|=
name|xstart
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|xend
condition|)
block|{
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|xstep
operator|=
name|tile
operator|->
name|ewidth
operator|-
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
expr_stmt|;
name|ystep
operator|=
name|tile
operator|->
name|eheight
operator|-
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
expr_stmt|;
name|xboundary
operator|=
name|x
operator|+
name|xstep
expr_stmt|;
name|yboundary
operator|=
name|y
operator|+
name|ystep
expr_stmt|;
name|xboundary
operator|=
name|MIN
argument_list|(
name|xboundary
argument_list|,
name|xend
argument_list|)
expr_stmt|;
name|yboundary
operator|=
name|MIN
argument_list|(
name|yboundary
argument_list|,
name|yend
argument_list|)
expr_stmt|;
for|for
control|(
name|ty
operator|=
name|y
init|;
name|ty
operator|<
name|yboundary
condition|;
name|ty
operator|++
control|)
block|{
name|src
operator|=
name|tile
operator|->
name|data
operator|+
name|tile
operator|->
name|bpp
operator|*
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|ty
operator|%
name|TILE_HEIGHT
operator|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
name|dest
operator|=
name|buf
operator|+
name|bufstride
operator|*
operator|(
name|ty
operator|-
name|ystart
operator|)
operator|+
name|bpp
operator|*
operator|(
name|x
operator|-
name|xstart
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MEMCPY_IS_NICE
name|memcpy
argument_list|(
operator|(
name|void
operator|*
operator|)
name|dest
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|src
argument_list|,
operator|(
name|xboundary
operator|-
name|x
operator|)
operator|*
name|bpp
argument_list|)
expr_stmt|;
else|#
directive|else
for|for
control|(
name|tx
operator|=
name|x
init|;
name|tx
operator|<
name|xboundary
condition|;
name|tx
operator|++
control|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|bpp
condition|;
name|b
operator|++
control|)
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* MEMCPY_IS_NICE */
block|}
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|x
operator|+=
name|xstep
expr_stmt|;
block|}
name|y
operator|+=
name|ystep
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_set_pixel (GPixelRgn * pr,guchar * buf,int x,int y)
name|gimp_pixel_rgn_set_pixel
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|tile_data
decl_stmt|;
name|int
name|b
decl_stmt|;
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|tile_data
operator|=
name|tile
operator|->
name|data
operator|+
name|tile
operator|->
name|bpp
operator|*
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|tile
operator|->
name|bpp
condition|;
name|b
operator|++
control|)
operator|*
name|tile_data
operator|++
operator|=
operator|*
name|buf
operator|++
expr_stmt|;
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_set_row (GPixelRgn * pr,guchar * buf,int x,int y,int width)
name|gimp_pixel_rgn_set_row
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|tile_data
decl_stmt|;
name|int
name|inc
decl_stmt|,
name|min
decl_stmt|;
name|int
name|end
decl_stmt|;
name|int
name|boundary
decl_stmt|;
ifndef|#
directive|ifndef
name|MEMCPY_IS_NICE
name|int
name|b
decl_stmt|;
endif|#
directive|endif
name|end
operator|=
name|x
operator|+
name|width
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|end
condition|)
block|{
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|tile_data
operator|=
name|tile
operator|->
name|data
operator|+
name|tile
operator|->
name|bpp
operator|*
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
name|boundary
operator|=
name|x
operator|+
operator|(
name|tile
operator|->
name|ewidth
operator|-
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MEMCPY_IS_NICE
name|memcpy
argument_list|(
operator|(
name|void
operator|*
operator|)
name|tile_data
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|buf
argument_list|,
name|inc
operator|=
operator|(
name|tile
operator|->
name|bpp
operator|*
operator|(
operator|(
name|min
operator|=
name|MIN
argument_list|(
name|end
argument_list|,
name|boundary
argument_list|)
operator|)
operator|-
name|x
operator|)
operator|)
argument_list|)
expr_stmt|;
name|x
operator|=
name|min
expr_stmt|;
name|buf
operator|+=
name|inc
expr_stmt|;
else|#
directive|else
for|for
control|(
init|;
name|x
operator|<
name|end
operator|&&
name|x
operator|<
name|boundary
condition|;
name|x
operator|++
control|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|tile
operator|->
name|bpp
condition|;
name|b
operator|++
control|)
operator|*
name|tile_data
operator|++
operator|=
operator|*
name|buf
operator|++
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* MEMCPY_IS_NICE */
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_set_col (GPixelRgn * pr,guchar * buf,int x,int y,int height)
name|gimp_pixel_rgn_set_col
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|tile_data
decl_stmt|;
name|int
name|inc
decl_stmt|;
name|int
name|end
decl_stmt|;
name|int
name|boundary
decl_stmt|;
name|int
name|b
decl_stmt|;
name|end
operator|=
name|y
operator|+
name|height
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|end
condition|)
block|{
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|tile_data
operator|=
name|tile
operator|->
name|data
operator|+
name|tile
operator|->
name|bpp
operator|*
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
name|boundary
operator|=
name|y
operator|+
operator|(
name|tile
operator|->
name|eheight
operator|-
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
operator|)
expr_stmt|;
name|inc
operator|=
name|tile
operator|->
name|bpp
operator|*
name|tile
operator|->
name|ewidth
expr_stmt|;
for|for
control|(
init|;
name|y
operator|<
name|end
operator|&&
name|y
operator|<
name|boundary
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|tile
operator|->
name|bpp
condition|;
name|b
operator|++
control|)
name|tile_data
index|[
name|b
index|]
operator|=
operator|*
name|buf
operator|++
expr_stmt|;
name|tile_data
operator|+=
name|inc
expr_stmt|;
block|}
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_pixel_rgn_set_rect (GPixelRgn * pr,guchar * buf,int x,int y,int width,int height)
name|gimp_pixel_rgn_set_rect
parameter_list|(
name|GPixelRgn
modifier|*
name|pr
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|guchar
modifier|*
name|src
decl_stmt|,
modifier|*
name|dest
decl_stmt|;
name|gulong
name|bufstride
decl_stmt|;
name|int
name|xstart
decl_stmt|,
name|ystart
decl_stmt|;
name|int
name|xend
decl_stmt|,
name|yend
decl_stmt|;
name|int
name|xboundary
decl_stmt|;
name|int
name|yboundary
decl_stmt|;
name|int
name|xstep
decl_stmt|,
name|ystep
decl_stmt|;
name|int
name|ty
decl_stmt|,
name|bpp
decl_stmt|;
ifndef|#
directive|ifndef
name|MEMCPY_IS_NICE
name|int
name|b
decl_stmt|,
name|tx
decl_stmt|;
endif|#
directive|endif
name|bpp
operator|=
name|pr
operator|->
name|bpp
expr_stmt|;
name|bufstride
operator|=
name|bpp
operator|*
name|width
expr_stmt|;
name|xstart
operator|=
name|x
expr_stmt|;
name|ystart
operator|=
name|y
expr_stmt|;
name|xend
operator|=
name|x
operator|+
name|width
expr_stmt|;
name|yend
operator|=
name|y
operator|+
name|height
expr_stmt|;
name|ystep
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|yend
condition|)
block|{
name|x
operator|=
name|xstart
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|xend
condition|)
block|{
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|pr
operator|->
name|drawable
argument_list|,
name|pr
operator|->
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|xstep
operator|=
name|tile
operator|->
name|ewidth
operator|-
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
expr_stmt|;
name|ystep
operator|=
name|tile
operator|->
name|eheight
operator|-
operator|(
name|y
operator|%
name|TILE_HEIGHT
operator|)
expr_stmt|;
name|xboundary
operator|=
name|x
operator|+
name|xstep
expr_stmt|;
name|yboundary
operator|=
name|y
operator|+
name|ystep
expr_stmt|;
name|xboundary
operator|=
name|MIN
argument_list|(
name|xboundary
argument_list|,
name|xend
argument_list|)
expr_stmt|;
name|yboundary
operator|=
name|MIN
argument_list|(
name|yboundary
argument_list|,
name|yend
argument_list|)
expr_stmt|;
for|for
control|(
name|ty
operator|=
name|y
init|;
name|ty
operator|<
name|yboundary
condition|;
name|ty
operator|++
control|)
block|{
name|src
operator|=
name|buf
operator|+
name|bufstride
operator|*
operator|(
name|ty
operator|-
name|ystart
operator|)
operator|+
name|bpp
operator|*
operator|(
name|x
operator|-
name|xstart
operator|)
expr_stmt|;
name|dest
operator|=
name|tile
operator|->
name|data
operator|+
name|tile
operator|->
name|bpp
operator|*
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|ty
operator|%
name|TILE_HEIGHT
operator|)
operator|+
operator|(
name|x
operator|%
name|TILE_WIDTH
operator|)
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MEMCPY_IS_NICE
name|memcpy
argument_list|(
operator|(
name|void
operator|*
operator|)
name|dest
argument_list|,
operator|(
specifier|const
name|void
operator|*
operator|)
name|src
argument_list|,
operator|(
name|xboundary
operator|-
name|x
operator|)
operator|*
name|bpp
argument_list|)
expr_stmt|;
else|#
directive|else
for|for
control|(
name|tx
operator|=
name|x
init|;
name|tx
operator|<
name|xboundary
condition|;
name|tx
operator|++
control|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|bpp
condition|;
name|b
operator|++
control|)
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* MEMCPY_IS_NICE */
block|}
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|x
operator|+=
name|xstep
expr_stmt|;
block|}
name|y
operator|+=
name|ystep
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gpointer
DECL|function|gimp_pixel_rgns_register (int nrgns,...)
name|gimp_pixel_rgns_register
parameter_list|(
name|int
name|nrgns
parameter_list|,
modifier|...
parameter_list|)
block|{
name|GPixelRgn
modifier|*
name|pr
decl_stmt|;
name|GPixelRgnHolder
modifier|*
name|prh
decl_stmt|;
name|GPixelRgnIterator
modifier|*
name|pri
decl_stmt|;
name|va_list
name|ap
decl_stmt|;
name|int
name|found
decl_stmt|;
name|pri
operator|=
name|g_new
argument_list|(
name|GPixelRgnIterator
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pri
operator|->
name|pixel_regions
operator|=
name|NULL
expr_stmt|;
name|pri
operator|->
name|process_count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|nrgns
operator|<
literal|1
condition|)
return|return
name|NULL
return|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|nrgns
argument_list|)
expr_stmt|;
name|found
operator|=
name|FALSE
expr_stmt|;
while|while
condition|(
name|nrgns
operator|--
condition|)
block|{
name|pr
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|GPixelRgn
operator|*
argument_list|)
expr_stmt|;
name|prh
operator|=
name|g_new
argument_list|(
name|GPixelRgnHolder
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|prh
operator|->
name|pr
operator|=
name|pr
expr_stmt|;
if|if
condition|(
name|pr
operator|!=
name|NULL
condition|)
block|{
comment|/*  If there is a defined value for data, make sure tiles is NULL  */
if|if
condition|(
name|pr
operator|->
name|data
condition|)
name|pr
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
name|prh
operator|->
name|original_data
operator|=
name|pr
operator|->
name|data
expr_stmt|;
name|prh
operator|->
name|startx
operator|=
name|pr
operator|->
name|x
expr_stmt|;
name|prh
operator|->
name|starty
operator|=
name|pr
operator|->
name|y
expr_stmt|;
name|prh
operator|->
name|pr
operator|->
name|process_count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
name|found
condition|)
block|{
name|found
operator|=
name|TRUE
expr_stmt|;
name|pri
operator|->
name|region_width
operator|=
name|pr
operator|->
name|w
expr_stmt|;
name|pri
operator|->
name|region_height
operator|=
name|pr
operator|->
name|h
expr_stmt|;
block|}
block|}
comment|/*  Add the pixel Rgn holder to the list  */
name|pri
operator|->
name|pixel_regions
operator|=
name|g_slist_prepend
argument_list|(
name|pri
operator|->
name|pixel_regions
argument_list|,
name|prh
argument_list|)
expr_stmt|;
block|}
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
return|return
name|gimp_pixel_rgns_configure
argument_list|(
name|pri
argument_list|)
return|;
block|}
end_function

begin_function
name|gpointer
DECL|function|gimp_pixel_rgns_process (gpointer pri_ptr)
name|gimp_pixel_rgns_process
parameter_list|(
name|gpointer
name|pri_ptr
parameter_list|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|GPixelRgnHolder
modifier|*
name|prh
decl_stmt|;
name|GPixelRgnIterator
modifier|*
name|pri
decl_stmt|;
name|pri
operator|=
operator|(
name|GPixelRgnIterator
operator|*
operator|)
name|pri_ptr
expr_stmt|;
name|pri
operator|->
name|process_count
operator|++
expr_stmt|;
comment|/*  Unref all referenced tiles and increment the offsets  */
name|list
operator|=
name|pri
operator|->
name|pixel_regions
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|prh
operator|=
operator|(
name|GPixelRgnHolder
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
if|if
condition|(
operator|(
name|prh
operator|->
name|pr
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|prh
operator|->
name|pr
operator|->
name|process_count
operator|!=
name|pri
operator|->
name|process_count
operator|)
condition|)
block|{
comment|/*  This eliminates the possibility of incrementing the 	   *  same region twice 	   */
name|prh
operator|->
name|pr
operator|->
name|process_count
operator|++
expr_stmt|;
comment|/*  Unref the last referenced tile if the underlying region is a tile manager  */
if|if
condition|(
name|prh
operator|->
name|pr
operator|->
name|drawable
condition|)
block|{
name|GTile
modifier|*
name|tile
init|=
name|gimp_drawable_get_tile2
argument_list|(
name|prh
operator|->
name|pr
operator|->
name|drawable
argument_list|,
name|prh
operator|->
name|pr
operator|->
name|shadow
argument_list|,
name|prh
operator|->
name|pr
operator|->
name|x
argument_list|,
name|prh
operator|->
name|pr
operator|->
name|y
argument_list|)
decl_stmt|;
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|prh
operator|->
name|pr
operator|->
name|dirty
argument_list|)
expr_stmt|;
block|}
name|prh
operator|->
name|pr
operator|->
name|x
operator|+=
name|pri
operator|->
name|portion_width
expr_stmt|;
if|if
condition|(
operator|(
name|prh
operator|->
name|pr
operator|->
name|x
operator|-
name|prh
operator|->
name|startx
operator|)
operator|>=
name|pri
operator|->
name|region_width
condition|)
block|{
name|prh
operator|->
name|pr
operator|->
name|x
operator|=
name|prh
operator|->
name|startx
expr_stmt|;
name|prh
operator|->
name|pr
operator|->
name|y
operator|+=
name|pri
operator|->
name|portion_height
expr_stmt|;
block|}
block|}
block|}
return|return
name|gimp_pixel_rgns_configure
argument_list|(
name|pri
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|gimp_get_portion_width (GPixelRgnIterator * pri)
name|gimp_get_portion_width
parameter_list|(
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|GPixelRgnHolder
modifier|*
name|prh
decl_stmt|;
name|int
name|min_width
init|=
name|G_MAXINT
decl_stmt|;
name|int
name|width
decl_stmt|;
comment|/* Find the minimum width to the next vertical tile (in the case of a tile manager)    * or to the end of the pixel region (in the case of no tile manager)    */
name|list
operator|=
name|pri
operator|->
name|pixel_regions
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|prh
operator|=
operator|(
name|GPixelRgnHolder
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|prh
operator|->
name|pr
condition|)
block|{
comment|/* Check if we're past the point of no return  */
if|if
condition|(
operator|(
name|prh
operator|->
name|pr
operator|->
name|x
operator|-
name|prh
operator|->
name|startx
operator|)
operator|>=
name|pri
operator|->
name|region_width
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|prh
operator|->
name|pr
operator|->
name|drawable
condition|)
block|{
name|width
operator|=
name|TILE_WIDTH
operator|-
operator|(
name|prh
operator|->
name|pr
operator|->
name|x
operator|%
name|TILE_WIDTH
operator|)
expr_stmt|;
name|width
operator|=
name|BOUNDS
argument_list|(
name|width
argument_list|,
literal|0
argument_list|,
operator|(
name|pri
operator|->
name|region_width
operator|-
operator|(
name|prh
operator|->
name|pr
operator|->
name|x
operator|-
name|prh
operator|->
name|startx
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|width
operator|=
operator|(
name|pri
operator|->
name|region_width
operator|-
operator|(
name|prh
operator|->
name|pr
operator|->
name|x
operator|-
name|prh
operator|->
name|startx
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|width
operator|<
name|min_width
condition|)
name|min_width
operator|=
name|width
expr_stmt|;
block|}
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
return|return
name|min_width
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|gimp_get_portion_height (GPixelRgnIterator * pri)
name|gimp_get_portion_height
parameter_list|(
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|GPixelRgnHolder
modifier|*
name|prh
decl_stmt|;
name|int
name|min_height
init|=
name|G_MAXINT
decl_stmt|;
name|int
name|height
decl_stmt|;
comment|/* Find the minimum height to the next vertical tile (in the case of a tile manager)    * or to the end of the pixel region (in the case of no tile manager)    */
name|list
operator|=
name|pri
operator|->
name|pixel_regions
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|prh
operator|=
operator|(
name|GPixelRgnHolder
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|prh
operator|->
name|pr
condition|)
block|{
comment|/* Check if we're past the point of no return  */
if|if
condition|(
operator|(
name|prh
operator|->
name|pr
operator|->
name|y
operator|-
name|prh
operator|->
name|starty
operator|)
operator|>=
name|pri
operator|->
name|region_height
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|prh
operator|->
name|pr
operator|->
name|drawable
condition|)
block|{
name|height
operator|=
name|TILE_HEIGHT
operator|-
operator|(
name|prh
operator|->
name|pr
operator|->
name|y
operator|%
name|TILE_HEIGHT
operator|)
expr_stmt|;
name|height
operator|=
name|BOUNDS
argument_list|(
name|height
argument_list|,
literal|0
argument_list|,
operator|(
name|pri
operator|->
name|region_height
operator|-
operator|(
name|prh
operator|->
name|pr
operator|->
name|y
operator|-
name|prh
operator|->
name|starty
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|height
operator|=
operator|(
name|pri
operator|->
name|region_height
operator|-
operator|(
name|prh
operator|->
name|pr
operator|->
name|y
operator|-
name|prh
operator|->
name|starty
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|height
operator|<
name|min_height
condition|)
name|min_height
operator|=
name|height
expr_stmt|;
block|}
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
return|return
name|min_height
return|;
block|}
end_function

begin_function
specifier|static
name|gpointer
DECL|function|gimp_pixel_rgns_configure (GPixelRgnIterator * pri)
name|gimp_pixel_rgns_configure
parameter_list|(
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
block|{
name|GPixelRgnHolder
modifier|*
name|prh
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
comment|/*  Determine the portion width and height  */
name|pri
operator|->
name|portion_width
operator|=
name|gimp_get_portion_width
argument_list|(
name|pri
argument_list|)
expr_stmt|;
name|pri
operator|->
name|portion_height
operator|=
name|gimp_get_portion_height
argument_list|(
name|pri
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|pri
operator|->
name|portion_width
operator|==
literal|0
operator|)
operator|||
operator|(
name|pri
operator|->
name|portion_height
operator|==
literal|0
operator|)
condition|)
block|{
comment|/*  free the pixel regions list  */
if|if
condition|(
name|pri
operator|->
name|pixel_regions
condition|)
block|{
name|list
operator|=
name|pri
operator|->
name|pixel_regions
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|g_free
argument_list|(
name|list
operator|->
name|data
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|g_slist_free
argument_list|(
name|pri
operator|->
name|pixel_regions
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pri
argument_list|)
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
name|pri
operator|->
name|process_count
operator|++
expr_stmt|;
name|list
operator|=
name|pri
operator|->
name|pixel_regions
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|prh
operator|=
operator|(
name|GPixelRgnHolder
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
operator|(
name|prh
operator|->
name|pr
operator|!=
name|NULL
operator|)
operator|&&
operator|(
name|prh
operator|->
name|pr
operator|->
name|process_count
operator|!=
name|pri
operator|->
name|process_count
operator|)
condition|)
block|{
name|prh
operator|->
name|pr
operator|->
name|process_count
operator|++
expr_stmt|;
name|gimp_pixel_rgn_configure
argument_list|(
name|prh
argument_list|,
name|pri
argument_list|)
expr_stmt|;
block|}
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
return|return
name|pri
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_pixel_rgn_configure (GPixelRgnHolder * prh,GPixelRgnIterator * pri)
name|gimp_pixel_rgn_configure
parameter_list|(
name|GPixelRgnHolder
modifier|*
name|prh
parameter_list|,
name|GPixelRgnIterator
modifier|*
name|pri
parameter_list|)
block|{
comment|/* Configure the rowstride and data pointer for the pixel region    * based on the current offsets into the region and whether the    * region is represented by a tile manager or not    */
if|if
condition|(
name|prh
operator|->
name|pr
operator|->
name|drawable
condition|)
block|{
name|GTile
modifier|*
name|tile
decl_stmt|;
name|int
name|offx
decl_stmt|,
name|offy
decl_stmt|;
name|tile
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|prh
operator|->
name|pr
operator|->
name|drawable
argument_list|,
name|prh
operator|->
name|pr
operator|->
name|shadow
argument_list|,
name|prh
operator|->
name|pr
operator|->
name|x
argument_list|,
name|prh
operator|->
name|pr
operator|->
name|y
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|offx
operator|=
name|prh
operator|->
name|pr
operator|->
name|x
operator|%
name|TILE_WIDTH
expr_stmt|;
name|offy
operator|=
name|prh
operator|->
name|pr
operator|->
name|y
operator|%
name|TILE_HEIGHT
expr_stmt|;
name|prh
operator|->
name|pr
operator|->
name|rowstride
operator|=
name|tile
operator|->
name|ewidth
operator|*
name|prh
operator|->
name|pr
operator|->
name|bpp
expr_stmt|;
name|prh
operator|->
name|pr
operator|->
name|data
operator|=
name|tile
operator|->
name|data
operator|+
name|offy
operator|*
name|prh
operator|->
name|pr
operator|->
name|rowstride
operator|+
name|offx
operator|*
name|prh
operator|->
name|pr
operator|->
name|bpp
expr_stmt|;
block|}
else|else
block|{
name|prh
operator|->
name|pr
operator|->
name|data
operator|=
operator|(
name|prh
operator|->
name|original_data
operator|+
operator|(
name|prh
operator|->
name|pr
operator|->
name|y
operator|-
name|prh
operator|->
name|starty
operator|)
operator|*
name|prh
operator|->
name|pr
operator|->
name|rowstride
operator|+
operator|(
name|prh
operator|->
name|pr
operator|->
name|x
operator|-
name|prh
operator|->
name|startx
operator|)
operator|*
name|prh
operator|->
name|pr
operator|->
name|bpp
operator|)
expr_stmt|;
block|}
name|prh
operator|->
name|pr
operator|->
name|w
operator|=
name|pri
operator|->
name|portion_width
expr_stmt|;
name|prh
operator|->
name|pr
operator|->
name|h
operator|=
name|pri
operator|->
name|portion_height
expr_stmt|;
block|}
end_function

end_unit

