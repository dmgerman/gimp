begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* HSV color selector for GTK+  *  * Copyright (C) 1999 The Free Software Foundation  *  * Authors: Simon Budig<Simon.Budig@unix-ag.org> (original code)  *          Federico Mena-Quintero<federico@gimp.org> (cleanup for GTK+)  *          Jonathan Blandford<jrb@redhat.com> (cleanup for GTK+)  *          Michael Natterer<mitch@gimp.org> (ported back to GIMP)  *  * This library is free software; you can redistribute it and/or  * modify it under the terms of the GNU Lesser General Public  * License as published by the Free Software Foundation; either  * version 2 of the License, or (at your option) any later version.  *  * This library is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  * Lesser General Public License for more details.  *  * You should have received a copy of the GNU Lesser General Public  * License along with this library; if not, write to the  * Free Software Foundation, Inc., 59 Temple Place - Suite 330,  * Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/*  * Modified by the GTK+ Team and others 1997-2000.  See the AUTHORS  * file for a list of people on the GTK+ Team.  See the ChangeLog  * files for a list of changes.  These files are distributed with  * GTK+ at ftp://ftp.gtk.org/pub/gtk/.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_include
include|#
directive|include
file|<libgimpmath/gimpmath.h>
end_include

begin_include
include|#
directive|include
file|"gimpcolorwheel.h"
end_include

begin_comment
comment|/* Default ring fraction */
end_comment

begin_define
DECL|macro|DEFAULT_FRACTION
define|#
directive|define
name|DEFAULT_FRACTION
value|0.1
end_define

begin_comment
comment|/* Default width/height */
end_comment

begin_define
DECL|macro|DEFAULT_SIZE
define|#
directive|define
name|DEFAULT_SIZE
value|100
end_define

begin_comment
comment|/* Default ring width */
end_comment

begin_define
DECL|macro|DEFAULT_RING_WIDTH
define|#
directive|define
name|DEFAULT_RING_WIDTH
value|10
end_define

begin_comment
comment|/* Dragging modes */
end_comment

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon28ee2e3c0103
block|{
DECL|enumerator|DRAG_NONE
name|DRAG_NONE
block|,
DECL|enumerator|DRAG_H
name|DRAG_H
block|,
DECL|enumerator|DRAG_SV
name|DRAG_SV
DECL|typedef|DragMode
block|}
name|DragMode
typedef|;
end_typedef

begin_comment
comment|/* Private part of the GimpColorWheel structure */
end_comment

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28ee2e3c0208
block|{
comment|/* Color value */
DECL|member|h
name|gdouble
name|h
decl_stmt|;
DECL|member|s
name|gdouble
name|s
decl_stmt|;
DECL|member|v
name|gdouble
name|v
decl_stmt|;
comment|/* ring_width is this fraction of size */
DECL|member|ring_fraction
name|gdouble
name|ring_fraction
decl_stmt|;
comment|/* Size and ring width */
DECL|member|size
name|gint
name|size
decl_stmt|;
DECL|member|ring_width
name|gint
name|ring_width
decl_stmt|;
comment|/* Window for capturing events */
DECL|member|window
name|GdkWindow
modifier|*
name|window
decl_stmt|;
comment|/* Dragging mode */
DECL|member|mode
name|DragMode
name|mode
decl_stmt|;
DECL|member|focus_on_ring
name|guint
name|focus_on_ring
range|:
literal|1
decl_stmt|;
DECL|typedef|GimpColorWheelPrivate
block|}
name|GimpColorWheelPrivate
typedef|;
end_typedef

begin_enum
enum|enum
DECL|enum|__anon28ee2e3c0303
block|{
DECL|enumerator|CHANGED
name|CHANGED
block|,
DECL|enumerator|MOVE
name|MOVE
block|,
DECL|enumerator|LAST_SIGNAL
name|LAST_SIGNAL
block|}
enum|;
end_enum

begin_function_decl
specifier|static
name|void
name|gimp_color_wheel_map
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_color_wheel_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_color_wheel_realize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_color_wheel_unrealize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_color_wheel_size_request
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkRequisition
modifier|*
name|requisition
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_color_wheel_size_allocate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkAllocation
modifier|*
name|allocation
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_color_wheel_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_color_wheel_button_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_color_wheel_motion
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventMotion
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_color_wheel_expose
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_color_wheel_grab_broken
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventGrabBroken
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_color_wheel_focus
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkDirectionType
name|direction
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_color_wheel_move
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|GtkDirectionType
name|dir
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|wheel_signals
specifier|static
name|guint
name|wheel_signals
index|[
name|LAST_SIGNAL
index|]
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|G_DEFINE_DYNAMIC_TYPE (GimpColorWheel,gimp_color_wheel,GTK_TYPE_WIDGET)
name|G_DEFINE_DYNAMIC_TYPE
argument_list|(
argument|GimpColorWheel
argument_list|,
argument|gimp_color_wheel
argument_list|,
argument|GTK_TYPE_WIDGET
argument_list|)
end_macro

begin_define
DECL|macro|parent_class
define|#
directive|define
name|parent_class
value|gimp_color_wheel_parent_class
end_define

begin_function
name|void
name|color_wheel_register_type
parameter_list|(
name|GTypeModule
modifier|*
name|module
parameter_list|)
block|{
name|gimp_color_wheel_register_type
argument_list|(
name|module
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_class_init (GimpColorWheelClass * class)
name|gimp_color_wheel_class_init
parameter_list|(
name|GimpColorWheelClass
modifier|*
name|class
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|object_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|class
argument_list|)
decl_stmt|;
name|GtkWidgetClass
modifier|*
name|widget_class
init|=
name|GTK_WIDGET_CLASS
argument_list|(
name|class
argument_list|)
decl_stmt|;
name|GimpColorWheelClass
modifier|*
name|wheel_class
init|=
name|GIMP_COLOR_WHEEL_CLASS
argument_list|(
name|class
argument_list|)
decl_stmt|;
name|GtkBindingSet
modifier|*
name|binding_set
decl_stmt|;
name|widget_class
operator|->
name|map
operator|=
name|gimp_color_wheel_map
expr_stmt|;
name|widget_class
operator|->
name|unmap
operator|=
name|gimp_color_wheel_unmap
expr_stmt|;
name|widget_class
operator|->
name|realize
operator|=
name|gimp_color_wheel_realize
expr_stmt|;
name|widget_class
operator|->
name|unrealize
operator|=
name|gimp_color_wheel_unrealize
expr_stmt|;
name|widget_class
operator|->
name|size_request
operator|=
name|gimp_color_wheel_size_request
expr_stmt|;
name|widget_class
operator|->
name|size_allocate
operator|=
name|gimp_color_wheel_size_allocate
expr_stmt|;
name|widget_class
operator|->
name|button_press_event
operator|=
name|gimp_color_wheel_button_press
expr_stmt|;
name|widget_class
operator|->
name|button_release_event
operator|=
name|gimp_color_wheel_button_release
expr_stmt|;
name|widget_class
operator|->
name|motion_notify_event
operator|=
name|gimp_color_wheel_motion
expr_stmt|;
name|widget_class
operator|->
name|expose_event
operator|=
name|gimp_color_wheel_expose
expr_stmt|;
name|widget_class
operator|->
name|focus
operator|=
name|gimp_color_wheel_focus
expr_stmt|;
name|widget_class
operator|->
name|grab_broken_event
operator|=
name|gimp_color_wheel_grab_broken
expr_stmt|;
name|wheel_class
operator|->
name|move
operator|=
name|gimp_color_wheel_move
expr_stmt|;
name|wheel_signals
index|[
name|CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"changed"
argument_list|,
name|G_OBJECT_CLASS_TYPE
argument_list|(
name|object_class
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpColorWheelClass
argument_list|,
name|changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|wheel_signals
index|[
name|MOVE
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"move"
argument_list|,
name|G_OBJECT_CLASS_TYPE
argument_list|(
name|object_class
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_LAST
operator||
name|G_SIGNAL_ACTION
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpColorWheelClass
argument_list|,
name|move
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__ENUM
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GTK_TYPE_DIRECTION_TYPE
argument_list|)
expr_stmt|;
name|binding_set
operator|=
name|gtk_binding_set_by_class
argument_list|(
name|class
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_Up
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_UP
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_KP_Up
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_UP
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_Down
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_DOWN
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_KP_Down
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_DOWN
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_Right
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_RIGHT
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_KP_Right
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_RIGHT
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_Left
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_LEFT
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_KP_Left
argument_list|,
literal|0
argument_list|,
literal|"move"
argument_list|,
literal|1
argument_list|,
name|G_TYPE_ENUM
argument_list|,
name|GTK_DIR_LEFT
argument_list|)
expr_stmt|;
name|g_type_class_add_private
argument_list|(
name|object_class
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpColorWheelPrivate
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_class_finalize (GimpColorWheelClass * klass)
name|gimp_color_wheel_class_finalize
parameter_list|(
name|GimpColorWheelClass
modifier|*
name|klass
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_init (GimpColorWheel * wheel)
name|gimp_color_wheel_init
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
decl_stmt|;
name|priv
operator|=
name|G_TYPE_INSTANCE_GET_PRIVATE
argument_list|(
name|wheel
argument_list|,
name|GIMP_TYPE_COLOR_WHEEL
argument_list|,
name|GimpColorWheelPrivate
argument_list|)
expr_stmt|;
name|wheel
operator|->
name|priv
operator|=
name|priv
expr_stmt|;
name|gtk_widget_set_has_window
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_can_focus
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|priv
operator|->
name|ring_fraction
operator|=
name|DEFAULT_FRACTION
expr_stmt|;
name|priv
operator|->
name|size
operator|=
name|DEFAULT_SIZE
expr_stmt|;
name|priv
operator|->
name|ring_width
operator|=
name|DEFAULT_RING_WIDTH
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_map (GtkWidget * widget)
name|gimp_color_wheel_map
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|map
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gdk_window_show
argument_list|(
name|priv
operator|->
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_unmap (GtkWidget * widget)
name|gimp_color_wheel_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|gdk_window_hide
argument_list|(
name|priv
operator|->
name|window
argument_list|)
expr_stmt|;
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|unmap
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_realize (GtkWidget * widget)
name|gimp_color_wheel_realize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|GtkAllocation
name|allocation
decl_stmt|;
name|GdkWindowAttr
name|attr
decl_stmt|;
name|gint
name|attr_mask
decl_stmt|;
name|GdkWindow
modifier|*
name|parent_window
decl_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|widget
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|gtk_widget_set_realized
argument_list|(
name|widget
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|attr
operator|.
name|window_type
operator|=
name|GDK_WINDOW_CHILD
expr_stmt|;
name|attr
operator|.
name|x
operator|=
name|allocation
operator|.
name|x
expr_stmt|;
name|attr
operator|.
name|y
operator|=
name|allocation
operator|.
name|y
expr_stmt|;
name|attr
operator|.
name|width
operator|=
name|allocation
operator|.
name|width
expr_stmt|;
name|attr
operator|.
name|height
operator|=
name|allocation
operator|.
name|height
expr_stmt|;
name|attr
operator|.
name|wclass
operator|=
name|GDK_INPUT_ONLY
expr_stmt|;
name|attr
operator|.
name|event_mask
operator|=
operator|(
name|gtk_widget_get_events
argument_list|(
name|widget
argument_list|)
operator||
name|GDK_KEY_PRESS_MASK
operator||
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
operator||
name|GDK_POINTER_MOTION_MASK
operator||
name|GDK_ENTER_NOTIFY_MASK
operator||
name|GDK_LEAVE_NOTIFY_MASK
operator|)
expr_stmt|;
name|attr_mask
operator|=
name|GDK_WA_X
operator||
name|GDK_WA_Y
expr_stmt|;
name|parent_window
operator|=
name|gtk_widget_get_parent_window
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_set_window
argument_list|(
name|widget
argument_list|,
name|parent_window
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|parent_window
argument_list|)
expr_stmt|;
name|priv
operator|->
name|window
operator|=
name|gdk_window_new
argument_list|(
name|parent_window
argument_list|,
operator|&
name|attr
argument_list|,
name|attr_mask
argument_list|)
expr_stmt|;
name|gdk_window_set_user_data
argument_list|(
name|priv
operator|->
name|window
argument_list|,
name|wheel
argument_list|)
expr_stmt|;
name|gtk_widget_style_attach
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_unrealize (GtkWidget * widget)
name|gimp_color_wheel_unrealize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|gdk_window_set_user_data
argument_list|(
name|priv
operator|->
name|window
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gdk_window_destroy
argument_list|(
name|priv
operator|->
name|window
argument_list|)
expr_stmt|;
name|priv
operator|->
name|window
operator|=
name|NULL
expr_stmt|;
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|unrealize
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_size_request (GtkWidget * widget,GtkRequisition * requisition)
name|gimp_color_wheel_size_request
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkRequisition
modifier|*
name|requisition
parameter_list|)
block|{
name|gint
name|focus_width
decl_stmt|;
name|gint
name|focus_pad
decl_stmt|;
name|gtk_widget_style_get
argument_list|(
name|widget
argument_list|,
literal|"focus-line-width"
argument_list|,
operator|&
name|focus_width
argument_list|,
literal|"focus-padding"
argument_list|,
operator|&
name|focus_pad
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|requisition
operator|->
name|width
operator|=
name|DEFAULT_SIZE
operator|+
literal|2
operator|*
operator|(
name|focus_width
operator|+
name|focus_pad
operator|)
expr_stmt|;
name|requisition
operator|->
name|height
operator|=
name|DEFAULT_SIZE
operator|+
literal|2
operator|*
operator|(
name|focus_width
operator|+
name|focus_pad
operator|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_size_allocate (GtkWidget * widget,GtkAllocation * allocation)
name|gimp_color_wheel_size_allocate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkAllocation
modifier|*
name|allocation
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|gint
name|focus_width
decl_stmt|;
name|gint
name|focus_pad
decl_stmt|;
name|gtk_widget_set_allocation
argument_list|(
name|widget
argument_list|,
name|allocation
argument_list|)
expr_stmt|;
name|gtk_widget_style_get
argument_list|(
name|widget
argument_list|,
literal|"focus-line-width"
argument_list|,
operator|&
name|focus_width
argument_list|,
literal|"focus-padding"
argument_list|,
operator|&
name|focus_pad
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|->
name|size
operator|=
name|MIN
argument_list|(
name|allocation
operator|->
name|width
operator|-
literal|2
operator|*
operator|(
name|focus_width
operator|+
name|focus_pad
operator|)
argument_list|,
name|allocation
operator|->
name|height
operator|-
literal|2
operator|*
operator|(
name|focus_width
operator|+
name|focus_pad
operator|)
argument_list|)
expr_stmt|;
name|priv
operator|->
name|ring_width
operator|=
name|priv
operator|->
name|size
operator|*
name|priv
operator|->
name|ring_fraction
expr_stmt|;
if|if
condition|(
name|gtk_widget_get_realized
argument_list|(
name|widget
argument_list|)
condition|)
name|gdk_window_move_resize
argument_list|(
name|priv
operator|->
name|window
argument_list|,
name|allocation
operator|->
name|x
argument_list|,
name|allocation
operator|->
name|y
argument_list|,
name|allocation
operator|->
name|width
argument_list|,
name|allocation
operator|->
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Utility functions */
end_comment

begin_define
DECL|macro|INTENSITY (r,g,b)
define|#
directive|define
name|INTENSITY
parameter_list|(
name|r
parameter_list|,
name|g
parameter_list|,
name|b
parameter_list|)
value|((r) * 0.30 + (g) * 0.59 + (b) * 0.11)
end_define

begin_comment
comment|/* Converts from HSV to RGB */
end_comment

begin_function
specifier|static
name|void
DECL|function|hsv_to_rgb (gdouble * h,gdouble * s,gdouble * v)
name|hsv_to_rgb
parameter_list|(
name|gdouble
modifier|*
name|h
parameter_list|,
name|gdouble
modifier|*
name|s
parameter_list|,
name|gdouble
modifier|*
name|v
parameter_list|)
block|{
name|gdouble
name|hue
decl_stmt|,
name|saturation
decl_stmt|,
name|value
decl_stmt|;
name|gdouble
name|f
decl_stmt|,
name|p
decl_stmt|,
name|q
decl_stmt|,
name|t
decl_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|0.0
condition|)
block|{
operator|*
name|h
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|s
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|v
operator|=
operator|*
name|v
expr_stmt|;
comment|/* heh */
block|}
else|else
block|{
name|hue
operator|=
operator|*
name|h
operator|*
literal|6.0
expr_stmt|;
name|saturation
operator|=
operator|*
name|s
expr_stmt|;
name|value
operator|=
operator|*
name|v
expr_stmt|;
if|if
condition|(
name|hue
operator|==
literal|6.0
condition|)
name|hue
operator|=
literal|0.0
expr_stmt|;
name|f
operator|=
name|hue
operator|-
operator|(
name|int
operator|)
name|hue
expr_stmt|;
name|p
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|)
expr_stmt|;
name|q
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|*
name|f
operator|)
expr_stmt|;
name|t
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|*
operator|(
literal|1.0
operator|-
name|f
operator|)
operator|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|hue
condition|)
block|{
case|case
literal|0
case|:
operator|*
name|h
operator|=
name|value
expr_stmt|;
operator|*
name|s
operator|=
name|t
expr_stmt|;
operator|*
name|v
operator|=
name|p
expr_stmt|;
break|break;
case|case
literal|1
case|:
operator|*
name|h
operator|=
name|q
expr_stmt|;
operator|*
name|s
operator|=
name|value
expr_stmt|;
operator|*
name|v
operator|=
name|p
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|*
name|h
operator|=
name|p
expr_stmt|;
operator|*
name|s
operator|=
name|value
expr_stmt|;
operator|*
name|v
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|3
case|:
operator|*
name|h
operator|=
name|p
expr_stmt|;
operator|*
name|s
operator|=
name|q
expr_stmt|;
operator|*
name|v
operator|=
name|value
expr_stmt|;
break|break;
case|case
literal|4
case|:
operator|*
name|h
operator|=
name|t
expr_stmt|;
operator|*
name|s
operator|=
name|p
expr_stmt|;
operator|*
name|v
operator|=
name|value
expr_stmt|;
break|break;
case|case
literal|5
case|:
operator|*
name|h
operator|=
name|value
expr_stmt|;
operator|*
name|s
operator|=
name|p
expr_stmt|;
operator|*
name|v
operator|=
name|q
expr_stmt|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/* Computes the vertices of the saturation/value triangle */
end_comment

begin_function
specifier|static
name|void
DECL|function|compute_triangle (GimpColorWheel * wheel,gint * hx,gint * hy,gint * sx,gint * sy,gint * vx,gint * vy)
name|compute_triangle
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|gint
modifier|*
name|hx
parameter_list|,
name|gint
modifier|*
name|hy
parameter_list|,
name|gint
modifier|*
name|sx
parameter_list|,
name|gint
modifier|*
name|sy
parameter_list|,
name|gint
modifier|*
name|vx
parameter_list|,
name|gint
modifier|*
name|vy
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|GtkAllocation
name|allocation
decl_stmt|;
name|gdouble
name|center_x
decl_stmt|;
name|gdouble
name|center_y
decl_stmt|;
name|gdouble
name|inner
decl_stmt|,
name|outer
decl_stmt|;
name|gdouble
name|angle
decl_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|center_x
operator|=
name|allocation
operator|.
name|width
operator|/
literal|2.0
expr_stmt|;
name|center_y
operator|=
name|allocation
operator|.
name|height
operator|/
literal|2.0
expr_stmt|;
name|outer
operator|=
name|priv
operator|->
name|size
operator|/
literal|2.0
expr_stmt|;
name|inner
operator|=
name|outer
operator|-
name|priv
operator|->
name|ring_width
expr_stmt|;
name|angle
operator|=
name|priv
operator|->
name|h
operator|*
literal|2.0
operator|*
name|G_PI
expr_stmt|;
operator|*
name|hx
operator|=
name|floor
argument_list|(
name|center_x
operator|+
name|cos
argument_list|(
name|angle
argument_list|)
operator|*
name|inner
operator|+
literal|0.5
argument_list|)
expr_stmt|;
operator|*
name|hy
operator|=
name|floor
argument_list|(
name|center_y
operator|-
name|sin
argument_list|(
name|angle
argument_list|)
operator|*
name|inner
operator|+
literal|0.5
argument_list|)
expr_stmt|;
operator|*
name|sx
operator|=
name|floor
argument_list|(
name|center_x
operator|+
name|cos
argument_list|(
name|angle
operator|+
literal|2.0
operator|*
name|G_PI
operator|/
literal|3.0
argument_list|)
operator|*
name|inner
operator|+
literal|0.5
argument_list|)
expr_stmt|;
operator|*
name|sy
operator|=
name|floor
argument_list|(
name|center_y
operator|-
name|sin
argument_list|(
name|angle
operator|+
literal|2.0
operator|*
name|G_PI
operator|/
literal|3.0
argument_list|)
operator|*
name|inner
operator|+
literal|0.5
argument_list|)
expr_stmt|;
operator|*
name|vx
operator|=
name|floor
argument_list|(
name|center_x
operator|+
name|cos
argument_list|(
name|angle
operator|+
literal|4.0
operator|*
name|G_PI
operator|/
literal|3.0
argument_list|)
operator|*
name|inner
operator|+
literal|0.5
argument_list|)
expr_stmt|;
operator|*
name|vy
operator|=
name|floor
argument_list|(
name|center_y
operator|-
name|sin
argument_list|(
name|angle
operator|+
literal|4.0
operator|*
name|G_PI
operator|/
literal|3.0
argument_list|)
operator|*
name|inner
operator|+
literal|0.5
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Computes whether a point is inside the hue ring */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|is_in_ring (GimpColorWheel * wheel,gdouble x,gdouble y)
name|is_in_ring
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|GtkAllocation
name|allocation
decl_stmt|;
name|gdouble
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|dist
decl_stmt|;
name|gdouble
name|center_x
decl_stmt|;
name|gdouble
name|center_y
decl_stmt|;
name|gdouble
name|inner
decl_stmt|,
name|outer
decl_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|center_x
operator|=
name|allocation
operator|.
name|width
operator|/
literal|2.0
expr_stmt|;
name|center_y
operator|=
name|allocation
operator|.
name|height
operator|/
literal|2.0
expr_stmt|;
name|outer
operator|=
name|priv
operator|->
name|size
operator|/
literal|2.0
expr_stmt|;
name|inner
operator|=
name|outer
operator|-
name|priv
operator|->
name|ring_width
expr_stmt|;
name|dx
operator|=
name|x
operator|-
name|center_x
expr_stmt|;
name|dy
operator|=
name|center_y
operator|-
name|y
expr_stmt|;
name|dist
operator|=
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
expr_stmt|;
return|return
operator|(
name|dist
operator|>=
name|inner
operator|*
name|inner
operator|&&
name|dist
operator|<=
name|outer
operator|*
name|outer
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Computes a saturation/value pair based on the mouse coordinates */
end_comment

begin_function
specifier|static
name|void
DECL|function|compute_sv (GimpColorWheel * wheel,gdouble x,gdouble y,gdouble * s,gdouble * v)
name|compute_sv
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|,
name|gdouble
modifier|*
name|s
parameter_list|,
name|gdouble
modifier|*
name|v
parameter_list|)
block|{
name|GtkAllocation
name|allocation
decl_stmt|;
name|gint
name|ihx
decl_stmt|,
name|ihy
decl_stmt|,
name|isx
decl_stmt|,
name|isy
decl_stmt|,
name|ivx
decl_stmt|,
name|ivy
decl_stmt|;
name|gdouble
name|hx
decl_stmt|,
name|hy
decl_stmt|,
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|vx
decl_stmt|,
name|vy
decl_stmt|;
name|gdouble
name|center_x
decl_stmt|;
name|gdouble
name|center_y
decl_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|compute_triangle
argument_list|(
name|wheel
argument_list|,
operator|&
name|ihx
argument_list|,
operator|&
name|ihy
argument_list|,
operator|&
name|isx
argument_list|,
operator|&
name|isy
argument_list|,
operator|&
name|ivx
argument_list|,
operator|&
name|ivy
argument_list|)
expr_stmt|;
name|center_x
operator|=
name|allocation
operator|.
name|width
operator|/
literal|2.0
expr_stmt|;
name|center_y
operator|=
name|allocation
operator|.
name|height
operator|/
literal|2.0
expr_stmt|;
name|hx
operator|=
name|ihx
operator|-
name|center_x
expr_stmt|;
name|hy
operator|=
name|center_y
operator|-
name|ihy
expr_stmt|;
name|sx
operator|=
name|isx
operator|-
name|center_x
expr_stmt|;
name|sy
operator|=
name|center_y
operator|-
name|isy
expr_stmt|;
name|vx
operator|=
name|ivx
operator|-
name|center_x
expr_stmt|;
name|vy
operator|=
name|center_y
operator|-
name|ivy
expr_stmt|;
name|x
operator|-=
name|center_x
expr_stmt|;
name|y
operator|=
name|center_y
operator|-
name|y
expr_stmt|;
if|if
condition|(
name|vx
operator|*
operator|(
name|x
operator|-
name|sx
operator|)
operator|+
name|vy
operator|*
operator|(
name|y
operator|-
name|sy
operator|)
operator|<
literal|0.0
condition|)
block|{
operator|*
name|s
operator|=
literal|1.0
expr_stmt|;
operator|*
name|v
operator|=
operator|(
operator|(
operator|(
name|x
operator|-
name|sx
operator|)
operator|*
operator|(
name|hx
operator|-
name|sx
operator|)
operator|+
operator|(
name|y
operator|-
name|sy
operator|)
operator|*
operator|(
name|hy
operator|-
name|sy
operator|)
operator|)
operator|/
operator|(
operator|(
name|hx
operator|-
name|sx
operator|)
operator|*
operator|(
name|hx
operator|-
name|sx
operator|)
operator|+
operator|(
name|hy
operator|-
name|sy
operator|)
operator|*
operator|(
name|hy
operator|-
name|sy
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|v
operator|<
literal|0.0
condition|)
operator|*
name|v
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|v
operator|>
literal|1.0
condition|)
operator|*
name|v
operator|=
literal|1.0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|hx
operator|*
operator|(
name|x
operator|-
name|sx
operator|)
operator|+
name|hy
operator|*
operator|(
name|y
operator|-
name|sy
operator|)
operator|<
literal|0.0
condition|)
block|{
operator|*
name|s
operator|=
literal|0.0
expr_stmt|;
operator|*
name|v
operator|=
operator|(
operator|(
operator|(
name|x
operator|-
name|sx
operator|)
operator|*
operator|(
name|vx
operator|-
name|sx
operator|)
operator|+
operator|(
name|y
operator|-
name|sy
operator|)
operator|*
operator|(
name|vy
operator|-
name|sy
operator|)
operator|)
operator|/
operator|(
operator|(
name|vx
operator|-
name|sx
operator|)
operator|*
operator|(
name|vx
operator|-
name|sx
operator|)
operator|+
operator|(
name|vy
operator|-
name|sy
operator|)
operator|*
operator|(
name|vy
operator|-
name|sy
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|v
operator|<
literal|0.0
condition|)
operator|*
name|v
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|v
operator|>
literal|1.0
condition|)
operator|*
name|v
operator|=
literal|1.0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|sx
operator|*
operator|(
name|x
operator|-
name|hx
operator|)
operator|+
name|sy
operator|*
operator|(
name|y
operator|-
name|hy
operator|)
operator|<
literal|0.0
condition|)
block|{
operator|*
name|v
operator|=
literal|1.0
expr_stmt|;
operator|*
name|s
operator|=
operator|(
operator|(
operator|(
name|x
operator|-
name|vx
operator|)
operator|*
operator|(
name|hx
operator|-
name|vx
operator|)
operator|+
operator|(
name|y
operator|-
name|vy
operator|)
operator|*
operator|(
name|hy
operator|-
name|vy
operator|)
operator|)
operator|/
operator|(
operator|(
name|hx
operator|-
name|vx
operator|)
operator|*
operator|(
name|hx
operator|-
name|vx
operator|)
operator|+
operator|(
name|hy
operator|-
name|vy
operator|)
operator|*
operator|(
name|hy
operator|-
name|vy
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|<
literal|0.0
condition|)
operator|*
name|s
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|>
literal|1.0
condition|)
operator|*
name|s
operator|=
literal|1.0
expr_stmt|;
block|}
else|else
block|{
operator|*
name|v
operator|=
operator|(
operator|(
operator|(
name|x
operator|-
name|sx
operator|)
operator|*
operator|(
name|hy
operator|-
name|vy
operator|)
operator|-
operator|(
name|y
operator|-
name|sy
operator|)
operator|*
operator|(
name|hx
operator|-
name|vx
operator|)
operator|)
operator|/
operator|(
operator|(
name|vx
operator|-
name|sx
operator|)
operator|*
operator|(
name|hy
operator|-
name|vy
operator|)
operator|-
operator|(
name|vy
operator|-
name|sy
operator|)
operator|*
operator|(
name|hx
operator|-
name|vx
operator|)
operator|)
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|v
operator|<=
literal|0.0
condition|)
block|{
operator|*
name|v
operator|=
literal|0.0
expr_stmt|;
operator|*
name|s
operator|=
literal|0.0
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|*
name|v
operator|>
literal|1.0
condition|)
operator|*
name|v
operator|=
literal|1.0
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|hy
operator|-
name|vy
argument_list|)
operator|<
name|fabs
argument_list|(
name|hx
operator|-
name|vx
argument_list|)
condition|)
operator|*
name|s
operator|=
operator|(
name|x
operator|-
name|sx
operator|-
operator|*
name|v
operator|*
operator|(
name|vx
operator|-
name|sx
operator|)
operator|)
operator|/
operator|(
operator|*
name|v
operator|*
operator|(
name|hx
operator|-
name|vx
operator|)
operator|)
expr_stmt|;
else|else
operator|*
name|s
operator|=
operator|(
name|y
operator|-
name|sy
operator|-
operator|*
name|v
operator|*
operator|(
name|vy
operator|-
name|sy
operator|)
operator|)
operator|/
operator|(
operator|*
name|v
operator|*
operator|(
name|hy
operator|-
name|vy
operator|)
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|s
operator|<
literal|0.0
condition|)
operator|*
name|s
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|s
operator|>
literal|1.0
condition|)
operator|*
name|s
operator|=
literal|1.0
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/* Computes whether a point is inside the saturation/value triangle */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|is_in_triangle (GimpColorWheel * wheel,gdouble x,gdouble y)
name|is_in_triangle
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|)
block|{
name|gint
name|hx
decl_stmt|,
name|hy
decl_stmt|,
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|vx
decl_stmt|,
name|vy
decl_stmt|;
name|gdouble
name|det
decl_stmt|,
name|s
decl_stmt|,
name|v
decl_stmt|;
name|compute_triangle
argument_list|(
name|wheel
argument_list|,
operator|&
name|hx
argument_list|,
operator|&
name|hy
argument_list|,
operator|&
name|sx
argument_list|,
operator|&
name|sy
argument_list|,
operator|&
name|vx
argument_list|,
operator|&
name|vy
argument_list|)
expr_stmt|;
name|det
operator|=
operator|(
name|vx
operator|-
name|sx
operator|)
operator|*
operator|(
name|hy
operator|-
name|sy
operator|)
operator|-
operator|(
name|vy
operator|-
name|sy
operator|)
operator|*
operator|(
name|hx
operator|-
name|sx
operator|)
expr_stmt|;
name|s
operator|=
operator|(
operator|(
name|x
operator|-
name|sx
operator|)
operator|*
operator|(
name|hy
operator|-
name|sy
operator|)
operator|-
operator|(
name|y
operator|-
name|sy
operator|)
operator|*
operator|(
name|hx
operator|-
name|sx
operator|)
operator|)
operator|/
name|det
expr_stmt|;
name|v
operator|=
operator|(
operator|(
name|vx
operator|-
name|sx
operator|)
operator|*
operator|(
name|y
operator|-
name|sy
operator|)
operator|-
operator|(
name|vy
operator|-
name|sy
operator|)
operator|*
operator|(
name|x
operator|-
name|sx
operator|)
operator|)
operator|/
name|det
expr_stmt|;
return|return
operator|(
name|s
operator|>=
literal|0.0
operator|&&
name|v
operator|>=
literal|0.0
operator|&&
name|s
operator|+
name|v
operator|<=
literal|1.0
operator|)
return|;
block|}
end_function

begin_comment
comment|/* Computes a value based on the mouse coordinates */
end_comment

begin_function
specifier|static
name|double
DECL|function|compute_v (GimpColorWheel * wheel,gdouble x,gdouble y)
name|compute_v
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|)
block|{
name|GtkAllocation
name|allocation
decl_stmt|;
name|gdouble
name|center_x
decl_stmt|;
name|gdouble
name|center_y
decl_stmt|;
name|gdouble
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|gdouble
name|angle
decl_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|center_x
operator|=
name|allocation
operator|.
name|width
operator|/
literal|2.0
expr_stmt|;
name|center_y
operator|=
name|allocation
operator|.
name|height
operator|/
literal|2.0
expr_stmt|;
name|dx
operator|=
name|x
operator|-
name|center_x
expr_stmt|;
name|dy
operator|=
name|center_y
operator|-
name|y
expr_stmt|;
name|angle
operator|=
name|atan2
argument_list|(
name|dy
argument_list|,
name|dx
argument_list|)
expr_stmt|;
if|if
condition|(
name|angle
operator|<
literal|0.0
condition|)
name|angle
operator|+=
literal|2.0
operator|*
name|G_PI
expr_stmt|;
return|return
name|angle
operator|/
operator|(
literal|2.0
operator|*
name|G_PI
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_cross_grab (GimpColorWheel * wheel,guint32 time)
name|set_cross_grab
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|guint32
name|time
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|GdkCursor
modifier|*
name|cursor
decl_stmt|;
name|cursor
operator|=
name|gdk_cursor_new_for_display
argument_list|(
name|gtk_widget_get_display
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|)
argument_list|,
name|GDK_CROSSHAIR
argument_list|)
expr_stmt|;
name|gdk_pointer_grab
argument_list|(
name|priv
operator|->
name|window
argument_list|,
name|FALSE
argument_list|,
name|GDK_POINTER_MOTION_MASK
operator||
name|GDK_POINTER_MOTION_HINT_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|,
name|NULL
argument_list|,
name|cursor
argument_list|,
name|time
argument_list|)
expr_stmt|;
name|gdk_cursor_unref
argument_list|(
name|cursor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_color_wheel_grab_broken (GtkWidget * widget,GdkEventGrabBroken * event)
name|gimp_color_wheel_grab_broken
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventGrabBroken
modifier|*
name|event
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|priv
operator|->
name|mode
operator|=
name|DRAG_NONE
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_color_wheel_button_press (GtkWidget * widget,GdkEventButton * event)
name|gimp_color_wheel_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|gdouble
name|x
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|mode
operator|!=
name|DRAG_NONE
operator|||
name|event
operator|->
name|button
operator|!=
literal|1
condition|)
return|return
name|FALSE
return|;
name|x
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|y
operator|=
name|event
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|is_in_ring
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
block|{
name|priv
operator|->
name|mode
operator|=
name|DRAG_H
expr_stmt|;
name|set_cross_grab
argument_list|(
name|wheel
argument_list|,
name|event
operator|->
name|time
argument_list|)
expr_stmt|;
name|gimp_color_wheel_set_color
argument_list|(
name|wheel
argument_list|,
name|compute_v
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
argument_list|,
name|priv
operator|->
name|s
argument_list|,
name|priv
operator|->
name|v
argument_list|)
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|priv
operator|->
name|focus_on_ring
operator|=
name|TRUE
expr_stmt|;
return|return
name|TRUE
return|;
block|}
if|if
condition|(
name|is_in_triangle
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
block|{
name|gdouble
name|s
decl_stmt|,
name|v
decl_stmt|;
name|priv
operator|->
name|mode
operator|=
name|DRAG_SV
expr_stmt|;
name|set_cross_grab
argument_list|(
name|wheel
argument_list|,
name|event
operator|->
name|time
argument_list|)
expr_stmt|;
name|compute_sv
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|gimp_color_wheel_set_color
argument_list|(
name|wheel
argument_list|,
name|priv
operator|->
name|h
argument_list|,
name|s
argument_list|,
name|v
argument_list|)
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|priv
operator|->
name|focus_on_ring
operator|=
name|FALSE
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_color_wheel_button_release (GtkWidget * widget,GdkEventButton * event)
name|gimp_color_wheel_button_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|DragMode
name|mode
decl_stmt|;
name|gdouble
name|x
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|mode
operator|==
name|DRAG_NONE
operator|||
name|event
operator|->
name|button
operator|!=
literal|1
condition|)
return|return
name|FALSE
return|;
comment|/* Set the drag mode to DRAG_NONE so that signal handlers for "catched"    * can see that this is the final color state.    */
name|mode
operator|=
name|priv
operator|->
name|mode
expr_stmt|;
name|priv
operator|->
name|mode
operator|=
name|DRAG_NONE
expr_stmt|;
name|x
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|y
operator|=
name|event
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|mode
operator|==
name|DRAG_H
condition|)
block|{
name|gimp_color_wheel_set_color
argument_list|(
name|wheel
argument_list|,
name|compute_v
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
argument_list|,
name|priv
operator|->
name|s
argument_list|,
name|priv
operator|->
name|v
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|mode
operator|==
name|DRAG_SV
condition|)
block|{
name|gdouble
name|s
decl_stmt|,
name|v
decl_stmt|;
name|compute_sv
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|gimp_color_wheel_set_color
argument_list|(
name|wheel
argument_list|,
name|priv
operator|->
name|h
argument_list|,
name|s
argument_list|,
name|v
argument_list|)
expr_stmt|;
block|}
else|else
name|g_assert_not_reached
argument_list|()
expr_stmt|;
name|gdk_display_pointer_ungrab
argument_list|(
name|gdk_window_get_display
argument_list|(
name|event
operator|->
name|window
argument_list|)
argument_list|,
name|event
operator|->
name|time
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_color_wheel_motion (GtkWidget * widget,GdkEventMotion * event)
name|gimp_color_wheel_motion
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventMotion
modifier|*
name|event
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|gdouble
name|x
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|mode
operator|==
name|DRAG_NONE
condition|)
return|return
name|FALSE
return|;
name|gdk_event_request_motions
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|x
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|y
operator|=
name|event
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|mode
operator|==
name|DRAG_H
condition|)
block|{
name|gimp_color_wheel_set_color
argument_list|(
name|wheel
argument_list|,
name|compute_v
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
argument_list|,
name|priv
operator|->
name|s
argument_list|,
name|priv
operator|->
name|v
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
elseif|else
if|if
condition|(
name|priv
operator|->
name|mode
operator|==
name|DRAG_SV
condition|)
block|{
name|gdouble
name|s
decl_stmt|,
name|v
decl_stmt|;
name|compute_sv
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|gimp_color_wheel_set_color
argument_list|(
name|wheel
argument_list|,
name|priv
operator|->
name|h
argument_list|,
name|s
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* Redrawing */
end_comment

begin_comment
comment|/* Paints the hue ring */
end_comment

begin_function
specifier|static
name|void
DECL|function|paint_ring (GimpColorWheel * wheel,cairo_t * cr,gint x,gint y,gint width,gint height)
name|paint_ring
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|cairo_t
modifier|*
name|cr
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|widget
init|=
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|GtkAllocation
name|allocation
decl_stmt|;
name|gint
name|xx
decl_stmt|,
name|yy
decl_stmt|;
name|gdouble
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|dist
decl_stmt|;
name|gdouble
name|center_x
decl_stmt|;
name|gdouble
name|center_y
decl_stmt|;
name|gdouble
name|inner
decl_stmt|,
name|outer
decl_stmt|;
name|guint32
modifier|*
name|buf
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|gdouble
name|angle
decl_stmt|;
name|gdouble
name|hue
decl_stmt|;
name|gdouble
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|cairo_surface_t
modifier|*
name|source
decl_stmt|;
name|cairo_t
modifier|*
name|source_cr
decl_stmt|;
name|gint
name|stride
decl_stmt|;
name|gint
name|focus_width
decl_stmt|;
name|gint
name|focus_pad
decl_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|gtk_widget_style_get
argument_list|(
name|widget
argument_list|,
literal|"focus-line-width"
argument_list|,
operator|&
name|focus_width
argument_list|,
literal|"focus-padding"
argument_list|,
operator|&
name|focus_pad
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|center_x
operator|=
name|allocation
operator|.
name|width
operator|/
literal|2.0
expr_stmt|;
name|center_y
operator|=
name|allocation
operator|.
name|height
operator|/
literal|2.0
expr_stmt|;
name|outer
operator|=
name|priv
operator|->
name|size
operator|/
literal|2.0
expr_stmt|;
name|inner
operator|=
name|outer
operator|-
name|priv
operator|->
name|ring_width
expr_stmt|;
comment|/* Create an image initialized with the ring colors */
name|stride
operator|=
name|cairo_format_stride_for_width
argument_list|(
name|CAIRO_FORMAT_RGB24
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|buf
operator|=
name|g_new
argument_list|(
name|guint32
argument_list|,
name|height
operator|*
name|stride
operator|/
literal|4
argument_list|)
expr_stmt|;
for|for
control|(
name|yy
operator|=
literal|0
init|;
name|yy
operator|<
name|height
condition|;
name|yy
operator|++
control|)
block|{
name|p
operator|=
name|buf
operator|+
name|yy
operator|*
name|width
expr_stmt|;
name|dy
operator|=
operator|-
operator|(
name|yy
operator|+
name|y
operator|-
name|center_y
operator|)
expr_stmt|;
for|for
control|(
name|xx
operator|=
literal|0
init|;
name|xx
operator|<
name|width
condition|;
name|xx
operator|++
control|)
block|{
name|dx
operator|=
name|xx
operator|+
name|x
operator|-
name|center_x
expr_stmt|;
name|dist
operator|=
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
expr_stmt|;
if|if
condition|(
name|dist
operator|<
operator|(
operator|(
name|inner
operator|-
literal|1
operator|)
operator|*
operator|(
name|inner
operator|-
literal|1
operator|)
operator|)
operator|||
name|dist
operator|>
operator|(
operator|(
name|outer
operator|+
literal|1
operator|)
operator|*
operator|(
name|outer
operator|+
literal|1
operator|)
operator|)
condition|)
block|{
operator|*
name|p
operator|++
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
name|angle
operator|=
name|atan2
argument_list|(
name|dy
argument_list|,
name|dx
argument_list|)
expr_stmt|;
if|if
condition|(
name|angle
operator|<
literal|0.0
condition|)
name|angle
operator|+=
literal|2.0
operator|*
name|G_PI
expr_stmt|;
name|hue
operator|=
name|angle
operator|/
operator|(
literal|2.0
operator|*
name|G_PI
operator|)
expr_stmt|;
name|r
operator|=
name|hue
expr_stmt|;
name|g
operator|=
literal|1.0
expr_stmt|;
name|b
operator|=
literal|1.0
expr_stmt|;
name|hsv_to_rgb
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
operator|*
name|p
operator|++
operator|=
operator|(
operator|(
operator|(
name|int
operator|)
name|floor
argument_list|(
name|r
operator|*
literal|255
operator|+
literal|0.5
argument_list|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
name|int
operator|)
name|floor
argument_list|(
name|g
operator|*
literal|255
operator|+
literal|0.5
argument_list|)
operator|<<
literal|8
operator|)
operator||
operator|(
name|int
operator|)
name|floor
argument_list|(
name|b
operator|*
literal|255
operator|+
literal|0.5
argument_list|)
operator|)
expr_stmt|;
block|}
block|}
name|source
operator|=
name|cairo_image_surface_create_for_data
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
argument_list|,
name|CAIRO_FORMAT_RGB24
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|stride
argument_list|)
expr_stmt|;
comment|/* Now draw the value marker onto the source image, so that it    * will get properly clipped at the edges of the ring    */
name|source_cr
operator|=
name|cairo_create
argument_list|(
name|source
argument_list|)
expr_stmt|;
name|r
operator|=
name|priv
operator|->
name|h
expr_stmt|;
name|g
operator|=
literal|1.0
expr_stmt|;
name|b
operator|=
literal|1.0
expr_stmt|;
name|hsv_to_rgb
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTENSITY
argument_list|(
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
operator|>
literal|0.5
condition|)
name|cairo_set_source_rgb
argument_list|(
name|source_cr
argument_list|,
literal|0.
argument_list|,
literal|0.
argument_list|,
literal|0.
argument_list|)
expr_stmt|;
else|else
name|cairo_set_source_rgb
argument_list|(
name|source_cr
argument_list|,
literal|1.
argument_list|,
literal|1.
argument_list|,
literal|1.
argument_list|)
expr_stmt|;
name|cairo_move_to
argument_list|(
name|source_cr
argument_list|,
operator|-
name|x
operator|+
name|center_x
argument_list|,
operator|-
name|y
operator|+
name|center_y
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|source_cr
argument_list|,
operator|-
name|x
operator|+
name|center_x
operator|+
name|cos
argument_list|(
name|priv
operator|->
name|h
operator|*
literal|2.0
operator|*
name|G_PI
argument_list|)
operator|*
name|priv
operator|->
name|size
operator|/
literal|2
argument_list|,
operator|-
name|y
operator|+
name|center_y
operator|-
name|sin
argument_list|(
name|priv
operator|->
name|h
operator|*
literal|2.0
operator|*
name|G_PI
argument_list|)
operator|*
name|priv
operator|->
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|source_cr
argument_list|)
expr_stmt|;
name|cairo_destroy
argument_list|(
name|source_cr
argument_list|)
expr_stmt|;
comment|/* Draw the ring using the source image */
name|cairo_save
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_set_source_surface
argument_list|(
name|cr
argument_list|,
name|source
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|cairo_surface_destroy
argument_list|(
name|source
argument_list|)
expr_stmt|;
name|cairo_set_line_width
argument_list|(
name|cr
argument_list|,
name|priv
operator|->
name|ring_width
argument_list|)
expr_stmt|;
name|cairo_new_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_arc
argument_list|(
name|cr
argument_list|,
name|center_x
argument_list|,
name|center_y
argument_list|,
name|priv
operator|->
name|size
operator|/
literal|2.
operator|-
name|priv
operator|->
name|ring_width
operator|/
literal|2.
argument_list|,
literal|0
argument_list|,
literal|2
operator|*
name|G_PI
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_restore
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Converts an HSV triplet to an integer RGB triplet */
end_comment

begin_function
specifier|static
name|void
DECL|function|get_color (gdouble h,gdouble s,gdouble v,gint * r,gint * g,gint * b)
name|get_color
parameter_list|(
name|gdouble
name|h
parameter_list|,
name|gdouble
name|s
parameter_list|,
name|gdouble
name|v
parameter_list|,
name|gint
modifier|*
name|r
parameter_list|,
name|gint
modifier|*
name|g
parameter_list|,
name|gint
modifier|*
name|b
parameter_list|)
block|{
name|hsv_to_rgb
argument_list|(
operator|&
name|h
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
operator|*
name|r
operator|=
name|floor
argument_list|(
name|h
operator|*
literal|255
operator|+
literal|0.5
argument_list|)
expr_stmt|;
operator|*
name|g
operator|=
name|floor
argument_list|(
name|s
operator|*
literal|255
operator|+
literal|0.5
argument_list|)
expr_stmt|;
operator|*
name|b
operator|=
name|floor
argument_list|(
name|v
operator|*
literal|255
operator|+
literal|0.5
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
DECL|macro|SWAP (a,b,t)
define|#
directive|define
name|SWAP
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|t
parameter_list|)
value|((t) = (a), (a) = (b), (b) = (t))
end_define

begin_define
DECL|macro|LERP (a,b,v1,v2,i)
define|#
directive|define
name|LERP
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|,
name|v1
parameter_list|,
name|v2
parameter_list|,
name|i
parameter_list|)
value|(((v2) - (v1) != 0)                                       \                                ? ((a) + ((b) - (a)) * ((i) - (v1)) / ((v2) - (v1)))     \                                : (a))
end_define

begin_comment
comment|/* Number of pixels we extend out from the edges when creating  * color source to avoid artifacts  */
end_comment

begin_define
DECL|macro|PAD
define|#
directive|define
name|PAD
value|3
end_define

begin_comment
comment|/* Paints the HSV triangle */
end_comment

begin_function
specifier|static
name|void
DECL|function|paint_triangle (GimpColorWheel * wheel,cairo_t * cr,gint x,gint y,gint width,gint height)
name|paint_triangle
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|cairo_t
modifier|*
name|cr
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|widget
init|=
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|gint
name|hx
decl_stmt|,
name|hy
decl_stmt|,
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|vx
decl_stmt|,
name|vy
decl_stmt|;
comment|/* HSV vertices */
name|gint
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|r1
decl_stmt|,
name|g1
decl_stmt|,
name|b1
decl_stmt|;
comment|/* First vertex in scanline order */
name|gint
name|x2
decl_stmt|,
name|y2
decl_stmt|,
name|r2
decl_stmt|,
name|g2
decl_stmt|,
name|b2
decl_stmt|;
comment|/* Second vertex */
name|gint
name|x3
decl_stmt|,
name|y3
decl_stmt|,
name|r3
decl_stmt|,
name|g3
decl_stmt|,
name|b3
decl_stmt|;
comment|/* Third vertex */
name|gint
name|t
decl_stmt|;
name|guint32
modifier|*
name|buf
decl_stmt|,
modifier|*
name|p
decl_stmt|,
name|c
decl_stmt|;
name|gint
name|xl
decl_stmt|,
name|xr
decl_stmt|,
name|rl
decl_stmt|,
name|rr
decl_stmt|,
name|gl
decl_stmt|,
name|gr
decl_stmt|,
name|bl
decl_stmt|,
name|br
decl_stmt|;
comment|/* Scanline data */
name|gint
name|xx
decl_stmt|,
name|yy
decl_stmt|;
name|gint
name|x_interp
decl_stmt|,
name|y_interp
decl_stmt|;
name|gint
name|x_start
decl_stmt|,
name|x_end
decl_stmt|;
name|cairo_surface_t
modifier|*
name|source
decl_stmt|;
name|gdouble
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|gchar
modifier|*
name|detail
decl_stmt|;
name|gint
name|stride
decl_stmt|;
comment|/* Compute triangle's vertices */
name|compute_triangle
argument_list|(
name|wheel
argument_list|,
operator|&
name|hx
argument_list|,
operator|&
name|hy
argument_list|,
operator|&
name|sx
argument_list|,
operator|&
name|sy
argument_list|,
operator|&
name|vx
argument_list|,
operator|&
name|vy
argument_list|)
expr_stmt|;
name|x1
operator|=
name|hx
expr_stmt|;
name|y1
operator|=
name|hy
expr_stmt|;
name|get_color
argument_list|(
name|priv
operator|->
name|h
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
operator|&
name|r1
argument_list|,
operator|&
name|g1
argument_list|,
operator|&
name|b1
argument_list|)
expr_stmt|;
name|x2
operator|=
name|sx
expr_stmt|;
name|y2
operator|=
name|sy
expr_stmt|;
name|get_color
argument_list|(
name|priv
operator|->
name|h
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
operator|&
name|r2
argument_list|,
operator|&
name|g2
argument_list|,
operator|&
name|b2
argument_list|)
expr_stmt|;
name|x3
operator|=
name|vx
expr_stmt|;
name|y3
operator|=
name|vy
expr_stmt|;
name|get_color
argument_list|(
name|priv
operator|->
name|h
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
operator|&
name|r3
argument_list|,
operator|&
name|g3
argument_list|,
operator|&
name|b3
argument_list|)
expr_stmt|;
if|if
condition|(
name|y2
operator|>
name|y3
condition|)
block|{
name|SWAP
argument_list|(
name|x2
argument_list|,
name|x3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|y2
argument_list|,
name|y3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|r2
argument_list|,
name|r3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|g2
argument_list|,
name|g3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|b2
argument_list|,
name|b3
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|y1
operator|>
name|y3
condition|)
block|{
name|SWAP
argument_list|(
name|x1
argument_list|,
name|x3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|y1
argument_list|,
name|y3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|r1
argument_list|,
name|r3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|g1
argument_list|,
name|g3
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|b1
argument_list|,
name|b3
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|y1
operator|>
name|y2
condition|)
block|{
name|SWAP
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|y1
argument_list|,
name|y2
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|r1
argument_list|,
name|r2
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|g1
argument_list|,
name|g2
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|b1
argument_list|,
name|b2
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
comment|/* Shade the triangle */
name|stride
operator|=
name|cairo_format_stride_for_width
argument_list|(
name|CAIRO_FORMAT_RGB24
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|buf
operator|=
name|g_new
argument_list|(
name|guint32
argument_list|,
name|height
operator|*
name|stride
operator|/
literal|4
argument_list|)
expr_stmt|;
for|for
control|(
name|yy
operator|=
literal|0
init|;
name|yy
operator|<
name|height
condition|;
name|yy
operator|++
control|)
block|{
name|p
operator|=
name|buf
operator|+
name|yy
operator|*
name|width
expr_stmt|;
if|if
condition|(
name|yy
operator|+
name|y
operator|>=
name|y1
operator|-
name|PAD
operator|&&
name|yy
operator|+
name|y
operator|<
name|y3
operator|+
name|PAD
condition|)
block|{
name|y_interp
operator|=
name|CLAMP
argument_list|(
name|yy
operator|+
name|y
argument_list|,
name|y1
argument_list|,
name|y3
argument_list|)
expr_stmt|;
if|if
condition|(
name|y_interp
operator|<
name|y2
condition|)
block|{
name|xl
operator|=
name|LERP
argument_list|(
name|x1
argument_list|,
name|x2
argument_list|,
name|y1
argument_list|,
name|y2
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|rl
operator|=
name|LERP
argument_list|(
name|r1
argument_list|,
name|r2
argument_list|,
name|y1
argument_list|,
name|y2
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|gl
operator|=
name|LERP
argument_list|(
name|g1
argument_list|,
name|g2
argument_list|,
name|y1
argument_list|,
name|y2
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|bl
operator|=
name|LERP
argument_list|(
name|b1
argument_list|,
name|b2
argument_list|,
name|y1
argument_list|,
name|y2
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|xl
operator|=
name|LERP
argument_list|(
name|x2
argument_list|,
name|x3
argument_list|,
name|y2
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|rl
operator|=
name|LERP
argument_list|(
name|r2
argument_list|,
name|r3
argument_list|,
name|y2
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|gl
operator|=
name|LERP
argument_list|(
name|g2
argument_list|,
name|g3
argument_list|,
name|y2
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|bl
operator|=
name|LERP
argument_list|(
name|b2
argument_list|,
name|b3
argument_list|,
name|y2
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
block|}
name|xr
operator|=
name|LERP
argument_list|(
name|x1
argument_list|,
name|x3
argument_list|,
name|y1
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|rr
operator|=
name|LERP
argument_list|(
name|r1
argument_list|,
name|r3
argument_list|,
name|y1
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|gr
operator|=
name|LERP
argument_list|(
name|g1
argument_list|,
name|g3
argument_list|,
name|y1
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
name|br
operator|=
name|LERP
argument_list|(
name|b1
argument_list|,
name|b3
argument_list|,
name|y1
argument_list|,
name|y3
argument_list|,
name|y_interp
argument_list|)
expr_stmt|;
if|if
condition|(
name|xl
operator|>
name|xr
condition|)
block|{
name|SWAP
argument_list|(
name|xl
argument_list|,
name|xr
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|rl
argument_list|,
name|rr
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|gl
argument_list|,
name|gr
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|SWAP
argument_list|(
name|bl
argument_list|,
name|br
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
name|x_start
operator|=
name|MAX
argument_list|(
name|xl
operator|-
name|PAD
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|x_end
operator|=
name|MIN
argument_list|(
name|xr
operator|+
name|PAD
argument_list|,
name|x
operator|+
name|width
argument_list|)
expr_stmt|;
name|x_start
operator|=
name|MIN
argument_list|(
name|x_start
argument_list|,
name|x_end
argument_list|)
expr_stmt|;
name|c
operator|=
operator|(
name|rl
operator|<<
literal|16
operator|)
operator||
operator|(
name|gl
operator|<<
literal|8
operator|)
operator||
name|bl
expr_stmt|;
for|for
control|(
name|xx
operator|=
name|x
init|;
name|xx
operator|<
name|x_start
condition|;
name|xx
operator|++
control|)
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
for|for
control|(
init|;
name|xx
operator|<
name|x_end
condition|;
name|xx
operator|++
control|)
block|{
name|x_interp
operator|=
name|CLAMP
argument_list|(
name|xx
argument_list|,
name|xl
argument_list|,
name|xr
argument_list|)
expr_stmt|;
operator|*
name|p
operator|++
operator|=
operator|(
operator|(
name|LERP
argument_list|(
name|rl
argument_list|,
name|rr
argument_list|,
name|xl
argument_list|,
name|xr
argument_list|,
name|x_interp
argument_list|)
operator|<<
literal|16
operator|)
operator||
operator|(
name|LERP
argument_list|(
name|gl
argument_list|,
name|gr
argument_list|,
name|xl
argument_list|,
name|xr
argument_list|,
name|x_interp
argument_list|)
operator|<<
literal|8
operator|)
operator||
name|LERP
argument_list|(
name|bl
argument_list|,
name|br
argument_list|,
name|xl
argument_list|,
name|xr
argument_list|,
name|x_interp
argument_list|)
operator|)
expr_stmt|;
block|}
name|c
operator|=
operator|(
name|rr
operator|<<
literal|16
operator|)
operator||
operator|(
name|gr
operator|<<
literal|8
operator|)
operator||
name|br
expr_stmt|;
for|for
control|(
init|;
name|xx
operator|<
name|x
operator|+
name|width
condition|;
name|xx
operator|++
control|)
operator|*
name|p
operator|++
operator|=
name|c
expr_stmt|;
block|}
block|}
name|source
operator|=
name|cairo_image_surface_create_for_data
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|buf
argument_list|,
name|CAIRO_FORMAT_RGB24
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|stride
argument_list|)
expr_stmt|;
comment|/* Draw a triangle with the image as a source */
name|cairo_set_source_surface
argument_list|(
name|cr
argument_list|,
name|source
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|cairo_surface_destroy
argument_list|(
name|source
argument_list|)
expr_stmt|;
name|cairo_move_to
argument_list|(
name|cr
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|x3
argument_list|,
name|y3
argument_list|)
expr_stmt|;
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
comment|/* Draw value marker */
name|xx
operator|=
name|floor
argument_list|(
name|sx
operator|+
operator|(
name|vx
operator|-
name|sx
operator|)
operator|*
name|priv
operator|->
name|v
operator|+
operator|(
name|hx
operator|-
name|vx
operator|)
operator|*
name|priv
operator|->
name|s
operator|*
name|priv
operator|->
name|v
operator|+
literal|0.5
argument_list|)
expr_stmt|;
name|yy
operator|=
name|floor
argument_list|(
name|sy
operator|+
operator|(
name|vy
operator|-
name|sy
operator|)
operator|*
name|priv
operator|->
name|v
operator|+
operator|(
name|hy
operator|-
name|vy
operator|)
operator|*
name|priv
operator|->
name|s
operator|*
name|priv
operator|->
name|v
operator|+
literal|0.5
argument_list|)
expr_stmt|;
name|r
operator|=
name|priv
operator|->
name|h
expr_stmt|;
name|g
operator|=
name|priv
operator|->
name|s
expr_stmt|;
name|b
operator|=
name|priv
operator|->
name|v
expr_stmt|;
name|hsv_to_rgb
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|INTENSITY
argument_list|(
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
operator|>
literal|0.5
condition|)
block|{
name|detail
operator|=
literal|"colorwheel_light"
expr_stmt|;
name|cairo_set_source_rgb
argument_list|(
name|cr
argument_list|,
literal|0.
argument_list|,
literal|0.
argument_list|,
literal|0.
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|detail
operator|=
literal|"colorwheel_dark"
expr_stmt|;
name|cairo_set_source_rgb
argument_list|(
name|cr
argument_list|,
literal|1.
argument_list|,
literal|1.
argument_list|,
literal|1.
argument_list|)
expr_stmt|;
block|}
DECL|macro|RADIUS
define|#
directive|define
name|RADIUS
value|4
DECL|macro|FOCUS_RADIUS
define|#
directive|define
name|FOCUS_RADIUS
value|6
name|cairo_new_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_arc
argument_list|(
name|cr
argument_list|,
name|xx
argument_list|,
name|yy
argument_list|,
name|RADIUS
argument_list|,
literal|0
argument_list|,
literal|2
operator|*
name|G_PI
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* Draw focus outline */
if|if
condition|(
name|gtk_widget_has_focus
argument_list|(
name|widget
argument_list|)
operator|&&
operator|!
name|priv
operator|->
name|focus_on_ring
condition|)
block|{
name|GtkAllocation
name|allocation
decl_stmt|;
name|gint
name|focus_width
decl_stmt|;
name|gint
name|focus_pad
decl_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|widget
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|gtk_widget_style_get
argument_list|(
name|widget
argument_list|,
literal|"focus-line-width"
argument_list|,
operator|&
name|focus_width
argument_list|,
literal|"focus-padding"
argument_list|,
operator|&
name|focus_pad
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_paint_focus
argument_list|(
name|gtk_widget_get_style
argument_list|(
name|widget
argument_list|)
argument_list|,
name|gtk_widget_get_window
argument_list|(
name|widget
argument_list|)
argument_list|,
name|gtk_widget_get_state
argument_list|(
name|widget
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|widget
argument_list|,
name|detail
argument_list|,
name|allocation
operator|.
name|x
operator|+
name|xx
operator|-
name|FOCUS_RADIUS
operator|-
name|focus_width
operator|-
name|focus_pad
argument_list|,
name|allocation
operator|.
name|y
operator|+
name|yy
operator|-
name|FOCUS_RADIUS
operator|-
name|focus_width
operator|-
name|focus_pad
argument_list|,
literal|2
operator|*
operator|(
name|FOCUS_RADIUS
operator|+
name|focus_width
operator|+
name|focus_pad
operator|)
argument_list|,
literal|2
operator|*
operator|(
name|FOCUS_RADIUS
operator|+
name|focus_width
operator|+
name|focus_pad
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* Paints the contents of the HSV color selector */
end_comment

begin_function
specifier|static
name|void
DECL|function|paint (GimpColorWheel * hsv,cairo_t * cr,gint x,gint y,gint width,gint height)
name|paint
parameter_list|(
name|GimpColorWheel
modifier|*
name|hsv
parameter_list|,
name|cairo_t
modifier|*
name|cr
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|paint_ring
argument_list|(
name|hsv
argument_list|,
name|cr
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|paint_triangle
argument_list|(
name|hsv
argument_list|,
name|cr
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|gimp_color_wheel_expose (GtkWidget * widget,GdkEventExpose * event)
name|gimp_color_wheel_expose
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|event
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|GtkAllocation
name|allocation
decl_stmt|;
name|GdkRectangle
name|dest
decl_stmt|;
name|cairo_t
modifier|*
name|cr
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|event
operator|->
name|window
operator|==
name|gtk_widget_get_window
argument_list|(
name|widget
argument_list|)
operator|&&
name|gtk_widget_is_drawable
argument_list|(
name|widget
argument_list|)
operator|)
condition|)
return|return
name|FALSE
return|;
name|gtk_widget_get_allocation
argument_list|(
name|widget
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gdk_rectangle_intersect
argument_list|(
operator|&
name|event
operator|->
name|area
argument_list|,
operator|&
name|allocation
argument_list|,
operator|&
name|dest
argument_list|)
condition|)
return|return
name|FALSE
return|;
name|cr
operator|=
name|gdk_cairo_create
argument_list|(
name|gtk_widget_get_window
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|cairo_translate
argument_list|(
name|cr
argument_list|,
name|allocation
operator|.
name|x
argument_list|,
name|allocation
operator|.
name|y
argument_list|)
expr_stmt|;
name|paint
argument_list|(
name|wheel
argument_list|,
name|cr
argument_list|,
name|dest
operator|.
name|x
operator|-
name|allocation
operator|.
name|x
argument_list|,
name|dest
operator|.
name|y
operator|-
name|allocation
operator|.
name|y
argument_list|,
name|dest
operator|.
name|width
argument_list|,
name|dest
operator|.
name|height
argument_list|)
expr_stmt|;
name|cairo_destroy
argument_list|(
name|cr
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtk_widget_has_focus
argument_list|(
name|widget
argument_list|)
operator|&&
name|priv
operator|->
name|focus_on_ring
condition|)
name|gtk_paint_focus
argument_list|(
name|gtk_widget_get_style
argument_list|(
name|widget
argument_list|)
argument_list|,
name|gtk_widget_get_window
argument_list|(
name|widget
argument_list|)
argument_list|,
name|gtk_widget_get_state
argument_list|(
name|widget
argument_list|)
argument_list|,
operator|&
name|event
operator|->
name|area
argument_list|,
name|widget
argument_list|,
name|NULL
argument_list|,
name|allocation
operator|.
name|x
argument_list|,
name|allocation
operator|.
name|y
argument_list|,
name|allocation
operator|.
name|width
argument_list|,
name|allocation
operator|.
name|height
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_color_wheel_focus (GtkWidget * widget,GtkDirectionType dir)
name|gimp_color_wheel_focus
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkDirectionType
name|dir
parameter_list|)
block|{
name|GimpColorWheel
modifier|*
name|wheel
init|=
name|GIMP_COLOR_WHEEL
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
if|if
condition|(
operator|!
name|gtk_widget_has_focus
argument_list|(
name|widget
argument_list|)
condition|)
block|{
if|if
condition|(
name|dir
operator|==
name|GTK_DIR_TAB_BACKWARD
condition|)
name|priv
operator|->
name|focus_on_ring
operator|=
name|FALSE
expr_stmt|;
else|else
name|priv
operator|->
name|focus_on_ring
operator|=
name|TRUE
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|widget
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
switch|switch
condition|(
name|dir
condition|)
block|{
case|case
name|GTK_DIR_UP
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
return|return
name|FALSE
return|;
else|else
name|priv
operator|->
name|focus_on_ring
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GTK_DIR_DOWN
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
name|priv
operator|->
name|focus_on_ring
operator|=
name|FALSE
expr_stmt|;
else|else
return|return
name|FALSE
return|;
break|break;
case|case
name|GTK_DIR_LEFT
case|:
case|case
name|GTK_DIR_TAB_BACKWARD
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
return|return
name|FALSE
return|;
else|else
name|priv
operator|->
name|focus_on_ring
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GTK_DIR_RIGHT
case|:
case|case
name|GTK_DIR_TAB_FORWARD
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
name|priv
operator|->
name|focus_on_ring
operator|=
name|FALSE
expr_stmt|;
else|else
return|return
name|FALSE
return|;
break|break;
block|}
name|gtk_widget_queue_draw
argument_list|(
name|widget
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_color_wheel_new:  *  * Creates a new HSV color selector.  *  * Return value: A newly-created HSV color selector.  *  * Since: 2.14  */
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_color_wheel_new (void)
name|gimp_color_wheel_new
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|g_object_new
argument_list|(
name|GIMP_TYPE_COLOR_WHEEL
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_color_wheel_set_color:  * @hsv: An HSV color selector  * @h: Hue  * @s: Saturation  * @v: Value  *  * Sets the current color in an HSV color selector.  * Color component values must be in the [0.0, 1.0] range.  *  * Since: 2.14  */
end_comment

begin_function
name|void
DECL|function|gimp_color_wheel_set_color (GimpColorWheel * wheel,gdouble h,gdouble s,gdouble v)
name|gimp_color_wheel_set_color
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|gdouble
name|h
parameter_list|,
name|gdouble
name|s
parameter_list|,
name|gdouble
name|v
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_COLOR_WHEEL
argument_list|(
name|wheel
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|h
operator|>=
literal|0.0
operator|&&
name|h
operator|<=
literal|1.0
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|s
operator|>=
literal|0.0
operator|&&
name|s
operator|<=
literal|1.0
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|v
operator|>=
literal|0.0
operator|&&
name|v
operator|<=
literal|1.0
argument_list|)
expr_stmt|;
name|priv
operator|=
name|wheel
operator|->
name|priv
expr_stmt|;
name|priv
operator|->
name|h
operator|=
name|h
expr_stmt|;
name|priv
operator|->
name|s
operator|=
name|s
expr_stmt|;
name|priv
operator|->
name|v
operator|=
name|v
expr_stmt|;
name|g_signal_emit
argument_list|(
name|wheel
argument_list|,
name|wheel_signals
index|[
name|CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|wheel
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_color_wheel_get_color:  * @hsv: An HSV color selector  * @h: (out): Return value for the hue  * @s: (out): Return value for the saturation  * @v: (out): Return value for the value  *  * Queries the current color in an HSV color selector.  * Returned values will be in the [0.0, 1.0] range.  *  * Since: 2.14  */
end_comment

begin_function
name|void
DECL|function|gimp_color_wheel_get_color (GimpColorWheel * wheel,gdouble * h,gdouble * s,gdouble * v)
name|gimp_color_wheel_get_color
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|gdouble
modifier|*
name|h
parameter_list|,
name|gdouble
modifier|*
name|s
parameter_list|,
name|gdouble
modifier|*
name|v
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_COLOR_WHEEL
argument_list|(
name|wheel
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|wheel
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|h
condition|)
operator|*
name|h
operator|=
name|priv
operator|->
name|h
expr_stmt|;
if|if
condition|(
name|s
condition|)
operator|*
name|s
operator|=
name|priv
operator|->
name|s
expr_stmt|;
if|if
condition|(
name|v
condition|)
operator|*
name|v
operator|=
name|priv
operator|->
name|v
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_color_wheel_set_ring_fraction:  * @ring: A wheel color selector  * @fraction: Ring fraction  *  * Sets the ring fraction of a wheel color selector.  *  * Since: GIMP 2.10  */
end_comment

begin_function
name|void
DECL|function|gimp_color_wheel_set_ring_fraction (GimpColorWheel * hsv,gdouble fraction)
name|gimp_color_wheel_set_ring_fraction
parameter_list|(
name|GimpColorWheel
modifier|*
name|hsv
parameter_list|,
name|gdouble
name|fraction
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_COLOR_WHEEL
argument_list|(
name|hsv
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|hsv
operator|->
name|priv
expr_stmt|;
name|priv
operator|->
name|ring_fraction
operator|=
name|CLAMP
argument_list|(
name|fraction
argument_list|,
literal|0.01
argument_list|,
literal|0.99
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|hsv
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_color_wheel_get_ring_fraction:  * @ring: A wheel color selector  *  * Returns value: The ring fraction of the wheel color selector.  *  * Since: GIMP 2.10  */
end_comment

begin_function
name|gdouble
DECL|function|gimp_color_wheel_get_ring_fraction (GimpColorWheel * wheel)
name|gimp_color_wheel_get_ring_fraction
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_COLOR_WHEEL
argument_list|(
name|wheel
argument_list|)
argument_list|,
name|DEFAULT_FRACTION
argument_list|)
expr_stmt|;
name|priv
operator|=
name|wheel
operator|->
name|priv
expr_stmt|;
return|return
name|priv
operator|->
name|ring_fraction
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_color_wheel_is_adjusting:  * @hsv: A #GimpColorWheel  *  * An HSV color selector can be said to be adjusting if multiple rapid  * changes are being made to its value, for example, when the user is  * adjusting the value with the mouse. This function queries whether  * the HSV color selector is being adjusted or not.  *  * Return value: %TRUE if clients can ignore changes to the color value,  *     since they may be transitory, or %FALSE if they should consider  *     the color value status to be final.  *  * Since: 2.14  */
end_comment

begin_function
name|gboolean
DECL|function|gimp_color_wheel_is_adjusting (GimpColorWheel * wheel)
name|gimp_color_wheel_is_adjusting
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_COLOR_WHEEL
argument_list|(
name|wheel
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|priv
operator|=
name|wheel
operator|->
name|priv
expr_stmt|;
return|return
name|priv
operator|->
name|mode
operator|!=
name|DRAG_NONE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_wheel_move (GimpColorWheel * wheel,GtkDirectionType dir)
name|gimp_color_wheel_move
parameter_list|(
name|GimpColorWheel
modifier|*
name|wheel
parameter_list|,
name|GtkDirectionType
name|dir
parameter_list|)
block|{
name|GimpColorWheelPrivate
modifier|*
name|priv
init|=
name|wheel
operator|->
name|priv
decl_stmt|;
name|gdouble
name|hue
decl_stmt|,
name|sat
decl_stmt|,
name|val
decl_stmt|;
name|gint
name|hx
decl_stmt|,
name|hy
decl_stmt|,
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|vx
decl_stmt|,
name|vy
decl_stmt|;
comment|/* HSV vertices */
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
comment|/* position in triangle */
name|hue
operator|=
name|priv
operator|->
name|h
expr_stmt|;
name|sat
operator|=
name|priv
operator|->
name|s
expr_stmt|;
name|val
operator|=
name|priv
operator|->
name|v
expr_stmt|;
name|compute_triangle
argument_list|(
name|wheel
argument_list|,
operator|&
name|hx
argument_list|,
operator|&
name|hy
argument_list|,
operator|&
name|sx
argument_list|,
operator|&
name|sy
argument_list|,
operator|&
name|vx
argument_list|,
operator|&
name|vy
argument_list|)
expr_stmt|;
name|x
operator|=
name|floor
argument_list|(
name|sx
operator|+
operator|(
name|vx
operator|-
name|sx
operator|)
operator|*
name|priv
operator|->
name|v
operator|+
operator|(
name|hx
operator|-
name|vx
operator|)
operator|*
name|priv
operator|->
name|s
operator|*
name|priv
operator|->
name|v
operator|+
literal|0.5
argument_list|)
expr_stmt|;
name|y
operator|=
name|floor
argument_list|(
name|sy
operator|+
operator|(
name|vy
operator|-
name|sy
operator|)
operator|*
name|priv
operator|->
name|v
operator|+
operator|(
name|hy
operator|-
name|vy
operator|)
operator|*
name|priv
operator|->
name|s
operator|*
name|priv
operator|->
name|v
operator|+
literal|0.5
argument_list|)
expr_stmt|;
DECL|macro|HUE_DELTA
define|#
directive|define
name|HUE_DELTA
value|0.002
switch|switch
condition|(
name|dir
condition|)
block|{
case|case
name|GTK_DIR_UP
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
name|hue
operator|+=
name|HUE_DELTA
expr_stmt|;
else|else
block|{
name|y
operator|-=
literal|1
expr_stmt|;
name|compute_sv
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|sat
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GTK_DIR_DOWN
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
name|hue
operator|-=
name|HUE_DELTA
expr_stmt|;
else|else
block|{
name|y
operator|+=
literal|1
expr_stmt|;
name|compute_sv
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|sat
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GTK_DIR_LEFT
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
name|hue
operator|+=
name|HUE_DELTA
expr_stmt|;
else|else
block|{
name|x
operator|-=
literal|1
expr_stmt|;
name|compute_sv
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|sat
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GTK_DIR_RIGHT
case|:
if|if
condition|(
name|priv
operator|->
name|focus_on_ring
condition|)
name|hue
operator|-=
name|HUE_DELTA
expr_stmt|;
else|else
block|{
name|x
operator|+=
literal|1
expr_stmt|;
name|compute_sv
argument_list|(
name|wheel
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|sat
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
comment|/* we don't care about the tab directions */
break|break;
block|}
comment|/* Wrap */
if|if
condition|(
name|hue
operator|<
literal|0.0
condition|)
name|hue
operator|=
literal|1.0
expr_stmt|;
elseif|else
if|if
condition|(
name|hue
operator|>
literal|1.0
condition|)
name|hue
operator|=
literal|0.0
expr_stmt|;
name|gimp_color_wheel_set_color
argument_list|(
name|wheel
argument_list|,
name|hue
argument_list|,
name|sat
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

