begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* LIBGIMP - The GIMP Library  * Copyright (C) 1995-1997 Peter Mattis and Spencer Kimball  *  * gimpquerybox.c  * Copyright (C) 1999-2000 Michael Natterer<mitch@gimp.org>  *  * This library is free software: you can redistribute it and/or  * modify it under the terms of the GNU Lesser General Public  * License as published by the Free Software Foundation; either  * version 3 of the License, or (at your option) any later version.  *  * This library is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  * Lesser General Public License for more details.  *  * You should have received a copy of the GNU Lesser General Public  * License along with this library.  If not, see  *<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"gimpwidgetstypes.h"
end_include

begin_include
include|#
directive|include
file|"gimpdialog.h"
end_include

begin_include
include|#
directive|include
file|"gimppixmap.h"
end_include

begin_include
include|#
directive|include
file|"gimpquerybox.h"
end_include

begin_include
include|#
directive|include
file|"gimpsizeentry.h"
end_include

begin_include
include|#
directive|include
file|"gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/libgimp-intl.h"
end_include

begin_comment
comment|/**  * SECTION: gimpquerybox  * @title: GimpQueryBox  * @short_description: Some simple dialogs to enter a single int,  *                     double, string or boolean value.  * @see_also: #GimpSizeEntry, #GimpUnitMenu  *  * These functions provide simple dialogs for entering a single  * string, integer, double, boolean or pixel size value.  *  * They return a pointer to a #GtkDialog which has to be shown with  * gtk_widget_show() by the caller.  *  * The dialogs contain an entry widget for the kind of value they ask  * for and "OK" and "Cancel" buttons. On "Cancel", all query boxes  * except the boolean one silently destroy themselves. On "OK" the  * user defined callback function is called and returns the entered  * value.  **/
end_comment

begin_comment
comment|/*  *  String, integer, double and size query boxes  */
end_comment

begin_typedef
DECL|typedef|QueryBox
typedef|typedef
name|struct
name|_QueryBox
name|QueryBox
typedef|;
end_typedef

begin_struct
DECL|struct|_QueryBox
struct|struct
name|_QueryBox
block|{
DECL|member|qbox
name|GtkWidget
modifier|*
name|qbox
decl_stmt|;
DECL|member|vbox
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
DECL|member|entry
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
DECL|member|object
name|GObject
modifier|*
name|object
decl_stmt|;
DECL|member|response_handler
name|gulong
name|response_handler
decl_stmt|;
DECL|member|callback
name|GCallback
name|callback
decl_stmt|;
DECL|member|callback_data
name|gpointer
name|callback_data
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|QueryBox
modifier|*
name|create_query_box
parameter_list|(
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|GimpHelpFunc
name|help_func
parameter_list|,
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
name|GCallback
name|response_callback
parameter_list|,
specifier|const
name|gchar
modifier|*
name|stock_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|message
parameter_list|,
specifier|const
name|gchar
modifier|*
name|ok_button
parameter_list|,
specifier|const
name|gchar
modifier|*
name|cancel_button
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
specifier|const
name|gchar
modifier|*
name|signal
parameter_list|,
name|GCallback
name|callback
parameter_list|,
name|gpointer
name|callback_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|query_box_disconnect
parameter_list|(
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|query_box_destroy
parameter_list|(
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|string_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|int_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|double_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|size_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|boolean_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|query_box_cancel_callback
parameter_list|(
name|QueryBox
modifier|*
name|query_box
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  *  create a generic query box without any entry widget  */
end_comment

begin_function
specifier|static
name|QueryBox
modifier|*
DECL|function|create_query_box (const gchar * title,GtkWidget * parent,GimpHelpFunc help_func,const gchar * help_id,GCallback response_callback,const gchar * stock_id,const gchar * message,const gchar * ok_button,const gchar * cancel_button,GObject * object,const gchar * signal,GCallback callback,gpointer callback_data)
name|create_query_box
parameter_list|(
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|GimpHelpFunc
name|help_func
parameter_list|,
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
name|GCallback
name|response_callback
parameter_list|,
specifier|const
name|gchar
modifier|*
name|stock_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|message
parameter_list|,
specifier|const
name|gchar
modifier|*
name|ok_button
parameter_list|,
specifier|const
name|gchar
modifier|*
name|cancel_button
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
specifier|const
name|gchar
modifier|*
name|signal
parameter_list|,
name|GCallback
name|callback
parameter_list|,
name|gpointer
name|callback_data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
init|=
name|NULL
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
comment|/*  make sure the object / signal passed are valid    */
name|g_return_val_if_fail
argument_list|(
name|parent
operator|==
name|NULL
operator|||
name|GTK_IS_WIDGET
argument_list|(
name|parent
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|object
operator|==
name|NULL
operator|||
name|G_IS_OBJECT
argument_list|(
name|object
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|object
operator|==
name|NULL
operator|||
name|signal
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|query_box
operator|=
name|g_slice_new0
argument_list|(
name|QueryBox
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|qbox
operator|=
name|gimp_dialog_new
argument_list|(
name|title
argument_list|,
literal|"gimp-query-box"
argument_list|,
name|parent
argument_list|,
literal|0
argument_list|,
name|help_func
argument_list|,
name|help_id
argument_list|,
name|cancel_button
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|ok_button
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|response_handler
operator|=
name|g_signal_connect
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|response_callback
argument_list|)
argument_list|,
name|query_box
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|query_box
operator|->
name|qbox
argument_list|)
expr_stmt|;
comment|/*  if we are associated with an object, connect to the provided signal    */
if|if
condition|(
name|object
condition|)
block|{
name|GClosure
modifier|*
name|closure
decl_stmt|;
name|closure
operator|=
name|g_cclosure_new_swap
argument_list|(
name|G_CALLBACK
argument_list|(
name|query_box_cancel_callback
argument_list|)
argument_list|,
name|query_box
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_object_watch_closure
argument_list|(
name|G_OBJECT
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
argument_list|,
name|closure
argument_list|)
expr_stmt|;
name|g_signal_connect_closure
argument_list|(
name|object
argument_list|,
name|signal
argument_list|,
name|closure
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|stock_id
condition|)
block|{
name|GtkWidget
modifier|*
name|content_area
decl_stmt|;
name|GtkWidget
modifier|*
name|image
decl_stmt|;
name|content_area
operator|=
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|content_area
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|stock_id
argument_list|,
name|GTK_ICON_SIZE_DIALOG
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|image
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
name|query_box
operator|->
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
argument_list|,
literal|"gimp-query-box-vbox"
argument_list|,
name|query_box
operator|->
name|vbox
argument_list|)
expr_stmt|;
if|if
condition|(
name|hbox
condition|)
block|{
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|query_box
operator|->
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|GtkWidget
modifier|*
name|content_area
decl_stmt|;
name|content_area
operator|=
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|query_box
operator|->
name|vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|content_area
argument_list|)
argument_list|,
name|query_box
operator|->
name|vbox
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|query_box
operator|->
name|vbox
argument_list|)
expr_stmt|;
if|if
condition|(
name|message
condition|)
block|{
name|label
operator|=
name|gtk_label_new
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_label_set_line_wrap
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|query_box
operator|->
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
name|query_box
operator|->
name|entry
operator|=
name|NULL
expr_stmt|;
name|query_box
operator|->
name|object
operator|=
name|object
expr_stmt|;
name|query_box
operator|->
name|callback
operator|=
name|callback
expr_stmt|;
name|query_box
operator|->
name|callback_data
operator|=
name|callback_data
expr_stmt|;
return|return
name|query_box
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_query_string_box:  * @title:     The query box dialog's title.  * @parent:    The dialog's parent widget.  * @help_func: The help function to show this dialog's help page.  * @help_id:   A string identifying this dialog's help page.  * @message:   A string which will be shown above the dialog's entry widget.  * @initial:   The initial value.  * @object:    The object this query box is associated with.  * @signal:    The object's signal which will cause the query box to be closed.  * @callback:  The function which will be called when the user selects "OK".  * @data:      The callback's user data.  *  * Creates a new #GtkDialog that queries the user for a string value.  *  * Returns: A pointer to the new #GtkDialog.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_query_string_box (const gchar * title,GtkWidget * parent,GimpHelpFunc help_func,const gchar * help_id,const gchar * message,const gchar * initial,GObject * object,const gchar * signal,GimpQueryStringCallback callback,gpointer data)
name|gimp_query_string_box
parameter_list|(
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|GimpHelpFunc
name|help_func
parameter_list|,
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|message
parameter_list|,
specifier|const
name|gchar
modifier|*
name|initial
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
specifier|const
name|gchar
modifier|*
name|signal
parameter_list|,
name|GimpQueryStringCallback
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|query_box
operator|=
name|create_query_box
argument_list|(
name|title
argument_list|,
name|parent
argument_list|,
name|help_func
argument_list|,
name|help_id
argument_list|,
name|G_CALLBACK
argument_list|(
name|string_query_box_response
argument_list|)
argument_list|,
name|GTK_STOCK_DIALOG_QUESTION
argument_list|,
name|message
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|object
argument_list|,
name|signal
argument_list|,
name|G_CALLBACK
argument_list|(
name|callback
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|query_box
condition|)
return|return
name|NULL
return|;
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|initial
condition|?
name|initial
else|:
literal|""
argument_list|)
expr_stmt|;
name|gtk_entry_set_activates_default
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|query_box
operator|->
name|vbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|entry
operator|=
name|entry
expr_stmt|;
return|return
name|query_box
operator|->
name|qbox
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_query_int_box:  * @title:     The query box dialog's title.  * @parent:    The dialog's parent widget.  * @help_func: The help function to show this dialog's help page.  * @help_id:   A string identifying this dialog's help page.  * @message:   A string which will be shown above the dialog's entry widget.  * @initial:   The initial value.  * @lower:     The lower boundary of the range of possible values.  * @upper:     The upper boundray of the range of possible values.  * @object:    The object this query box is associated with.  * @signal:    The object's signal which will cause the query box to be closed.  * @callback:  The function which will be called when the user selects "OK".  * @data:      The callback's user data.  *  * Creates a new #GtkDialog that queries the user for an integer value.  *  * Returns: A pointer to the new #GtkDialog.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_query_int_box (const gchar * title,GtkWidget * parent,GimpHelpFunc help_func,const gchar * help_id,const gchar * message,gint initial,gint lower,gint upper,GObject * object,const gchar * signal,GimpQueryIntCallback callback,gpointer data)
name|gimp_query_int_box
parameter_list|(
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|GimpHelpFunc
name|help_func
parameter_list|,
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|message
parameter_list|,
name|gint
name|initial
parameter_list|,
name|gint
name|lower
parameter_list|,
name|gint
name|upper
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
specifier|const
name|gchar
modifier|*
name|signal
parameter_list|,
name|GimpQueryIntCallback
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
name|query_box
operator|=
name|create_query_box
argument_list|(
name|title
argument_list|,
name|parent
argument_list|,
name|help_func
argument_list|,
name|help_id
argument_list|,
name|G_CALLBACK
argument_list|(
name|int_query_box_response
argument_list|)
argument_list|,
name|GTK_STOCK_DIALOG_QUESTION
argument_list|,
name|message
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|object
argument_list|,
name|signal
argument_list|,
name|G_CALLBACK
argument_list|(
name|callback
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|query_box
condition|)
return|return
name|NULL
return|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adjustment
argument_list|,
name|initial
argument_list|,
name|lower
argument_list|,
name|upper
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_entry_set_activates_default
argument_list|(
name|GTK_ENTRY
argument_list|(
name|spinbutton
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|query_box
operator|->
name|vbox
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|entry
operator|=
name|spinbutton
expr_stmt|;
return|return
name|query_box
operator|->
name|qbox
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_query_double_box:  * @title:     The query box dialog's title.  * @parent:    The dialog's parent widget.  * @help_func: The help function to show this dialog's help page.  * @help_id:   A string identifying this dialog's help page.  * @message:   A string which will be shown above the dialog's entry widget.  * @initial:   The initial value.  * @lower:     The lower boundary of the range of possible values.  * @upper:     The upper boundray of the range of possible values.  * @digits:    The number of decimal digits the #GtkSpinButton will provide.  * @object:    The object this query box is associated with.  * @signal:    The object's signal which will cause the query box to be closed.  * @callback:  The function which will be called when the user selects "OK".  * @data:      The callback's user data.  *  * Creates a new #GtkDialog that queries the user for a double value.  *  * Returns: A pointer to the new #GtkDialog.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_query_double_box (const gchar * title,GtkWidget * parent,GimpHelpFunc help_func,const gchar * help_id,const gchar * message,gdouble initial,gdouble lower,gdouble upper,gint digits,GObject * object,const gchar * signal,GimpQueryDoubleCallback callback,gpointer data)
name|gimp_query_double_box
parameter_list|(
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|GimpHelpFunc
name|help_func
parameter_list|,
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|message
parameter_list|,
name|gdouble
name|initial
parameter_list|,
name|gdouble
name|lower
parameter_list|,
name|gdouble
name|upper
parameter_list|,
name|gint
name|digits
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
specifier|const
name|gchar
modifier|*
name|signal
parameter_list|,
name|GimpQueryDoubleCallback
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
name|query_box
operator|=
name|create_query_box
argument_list|(
name|title
argument_list|,
name|parent
argument_list|,
name|help_func
argument_list|,
name|help_id
argument_list|,
name|G_CALLBACK
argument_list|(
name|double_query_box_response
argument_list|)
argument_list|,
name|GTK_STOCK_DIALOG_QUESTION
argument_list|,
name|message
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|object
argument_list|,
name|signal
argument_list|,
name|G_CALLBACK
argument_list|(
name|callback
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|query_box
condition|)
return|return
name|NULL
return|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adjustment
argument_list|,
name|initial
argument_list|,
name|lower
argument_list|,
name|upper
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|digits
argument_list|)
expr_stmt|;
name|gtk_entry_set_activates_default
argument_list|(
name|GTK_ENTRY
argument_list|(
name|spinbutton
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|query_box
operator|->
name|vbox
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|entry
operator|=
name|spinbutton
expr_stmt|;
return|return
name|query_box
operator|->
name|qbox
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_query_size_box:  * @title:       The query box dialog's title.  * @parent:      The dialog's parent widget.  * @help_func:   The help function to show this dialog's help page.  * @help_id:     A string identifying this dialog's help page.  * @message:     A string which will be shown above the dialog's entry widget.  * @initial:     The initial value.  * @lower:       The lower boundary of the range of possible values.  * @upper:       The upper boundray of the range of possible values.  * @digits:      The number of decimal digits the #GimpSizeEntry provide in  *               "pixel" mode.  * @unit:        The unit initially shown by the #GimpUnitMenu.  * @resolution:  The resolution (in dpi) which will be used for pixel/unit  *               calculations.  * @dot_for_dot: %TRUE if the #GimpUnitMenu's initial unit should be "pixels".  * @object:      The object this query box is associated with.  * @signal:      The object's signal which will cause the query box  *               to be closed.  * @callback:    The function which will be called when the user selects "OK".  * @data:        The callback's user data.  *  * Creates a new #GtkDialog that queries the user for a size using a  * #GimpSizeEntry.  *  * Returns: A pointer to the new #GtkDialog.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_query_size_box (const gchar * title,GtkWidget * parent,GimpHelpFunc help_func,const gchar * help_id,const gchar * message,gdouble initial,gdouble lower,gdouble upper,gint digits,GimpUnit unit,gdouble resolution,gboolean dot_for_dot,GObject * object,const gchar * signal,GimpQuerySizeCallback callback,gpointer data)
name|gimp_query_size_box
parameter_list|(
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|GimpHelpFunc
name|help_func
parameter_list|,
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|message
parameter_list|,
name|gdouble
name|initial
parameter_list|,
name|gdouble
name|lower
parameter_list|,
name|gdouble
name|upper
parameter_list|,
name|gint
name|digits
parameter_list|,
name|GimpUnit
name|unit
parameter_list|,
name|gdouble
name|resolution
parameter_list|,
name|gboolean
name|dot_for_dot
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
specifier|const
name|gchar
modifier|*
name|signal
parameter_list|,
name|GimpQuerySizeCallback
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|GtkWidget
modifier|*
name|sizeentry
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|query_box
operator|=
name|create_query_box
argument_list|(
name|title
argument_list|,
name|parent
argument_list|,
name|help_func
argument_list|,
name|help_id
argument_list|,
name|G_CALLBACK
argument_list|(
name|size_query_box_response
argument_list|)
argument_list|,
name|GTK_STOCK_DIALOG_QUESTION
argument_list|,
name|message
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|object
argument_list|,
name|signal
argument_list|,
name|G_CALLBACK
argument_list|(
name|callback
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|query_box
condition|)
return|return
name|NULL
return|;
name|sizeentry
operator|=
name|gimp_size_entry_new
argument_list|(
literal|1
argument_list|,
name|unit
argument_list|,
literal|"%p"
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|12
argument_list|,
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|dot_for_dot
condition|)
name|gimp_size_entry_set_unit
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|sizeentry
argument_list|)
argument_list|,
name|GIMP_UNIT_PIXEL
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_resolution
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|sizeentry
argument_list|)
argument_list|,
literal|0
argument_list|,
name|resolution
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval_digits
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|sizeentry
argument_list|)
argument_list|,
literal|0
argument_list|,
name|digits
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|sizeentry
argument_list|)
argument_list|,
literal|0
argument_list|,
name|lower
argument_list|,
name|upper
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|sizeentry
argument_list|)
argument_list|,
literal|0
argument_list|,
name|initial
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_size_entry_get_help_widget
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|sizeentry
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_entry_set_activates_default
argument_list|(
name|GTK_ENTRY
argument_list|(
name|spinbutton
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|query_box
operator|->
name|vbox
argument_list|)
argument_list|,
name|sizeentry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_size_entry_grab_focus
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|sizeentry
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sizeentry
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|entry
operator|=
name|sizeentry
expr_stmt|;
return|return
name|query_box
operator|->
name|qbox
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_query_boolean_box:  * @title:        The query box dialog's title.  * @parent:       The dialog's parent widget.  * @help_func:    The help function to show this dialog's help page.  * @help_id:      A string identifying this dialog's help page.  * @stock_id:     A stock_id to specify an icon to appear on the left  *                on the dialog's message.  * @message:      A string which will be shown in the query box.  * @true_button:  The string to be shown in the dialog's left button.  * @false_button: The string to be shown in the dialog's right button.  * @object:       The object this query box is associated with.  * @signal:       The object's signal which will cause the query box  *                to be closed.  * @callback:     The function which will be called when the user clicks one  *                of the buttons.  * @data:         The callback's user data.  *  * Creates a new #GtkDialog that asks the user to do a boolean decision.  *  * Returns: A pointer to the new #GtkDialog.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_query_boolean_box (const gchar * title,GtkWidget * parent,GimpHelpFunc help_func,const gchar * help_id,const gchar * stock_id,const gchar * message,const gchar * true_button,const gchar * false_button,GObject * object,const gchar * signal,GimpQueryBooleanCallback callback,gpointer data)
name|gimp_query_boolean_box
parameter_list|(
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|GimpHelpFunc
name|help_func
parameter_list|,
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|stock_id
parameter_list|,
specifier|const
name|gchar
modifier|*
name|message
parameter_list|,
specifier|const
name|gchar
modifier|*
name|true_button
parameter_list|,
specifier|const
name|gchar
modifier|*
name|false_button
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
specifier|const
name|gchar
modifier|*
name|signal
parameter_list|,
name|GimpQueryBooleanCallback
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|query_box
operator|=
name|create_query_box
argument_list|(
name|title
argument_list|,
name|parent
argument_list|,
name|help_func
argument_list|,
name|help_id
argument_list|,
name|G_CALLBACK
argument_list|(
name|boolean_query_box_response
argument_list|)
argument_list|,
name|stock_id
argument_list|,
name|message
argument_list|,
name|true_button
argument_list|,
name|false_button
argument_list|,
name|object
argument_list|,
name|signal
argument_list|,
name|G_CALLBACK
argument_list|(
name|callback
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|query_box
condition|)
return|return
name|NULL
return|;
return|return
name|query_box
operator|->
name|qbox
return|;
block|}
end_function

begin_comment
comment|/*  *  private functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|query_box_disconnect (QueryBox * query_box)
name|query_box_disconnect
parameter_list|(
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  disconnect the response callback to avoid that it may be run twice  */
if|if
condition|(
name|query_box
operator|->
name|response_handler
condition|)
block|{
name|g_signal_handler_disconnect
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|,
name|query_box
operator|->
name|response_handler
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|response_handler
operator|=
literal|0
expr_stmt|;
block|}
comment|/*  disconnect, if we are connected to some signal  */
if|if
condition|(
name|query_box
operator|->
name|object
condition|)
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|query_box
operator|->
name|object
argument_list|,
name|query_box_cancel_callback
argument_list|,
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|query_box_destroy (QueryBox * query_box)
name|query_box_destroy
parameter_list|(
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
comment|/*  Destroy the box  */
if|if
condition|(
name|query_box
operator|->
name|qbox
condition|)
name|gtk_widget_destroy
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
expr_stmt|;
name|g_slice_free
argument_list|(
name|QueryBox
argument_list|,
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|string_query_box_response (GtkWidget * widget,gint response_id,QueryBox * query_box)
name|string_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|string
decl_stmt|;
name|query_box_disconnect
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
comment|/*  Get the entry data  */
name|string
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|query_box
operator|->
name|entry
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Call the user defined callback  */
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
operator|(
operator|*
operator|(
name|GimpQueryStringCallback
operator|)
name|query_box
operator|->
name|callback
operator|)
operator|(
name|query_box
operator|->
name|qbox
operator|,
name|string
operator|,
name|query_box
operator|->
name|callback_data
operator|)
expr_stmt|;
name|query_box_destroy
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|int_query_box_response (GtkWidget * widget,gint response_id,QueryBox * query_box)
name|int_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
name|gint
name|value
decl_stmt|;
name|query_box_disconnect
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
comment|/*  Get the spinbutton data  */
name|value
operator|=
name|gtk_spin_button_get_value_as_int
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|query_box
operator|->
name|entry
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Call the user defined callback  */
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
operator|(
operator|*
operator|(
name|GimpQueryIntCallback
operator|)
name|query_box
operator|->
name|callback
operator|)
operator|(
name|query_box
operator|->
name|qbox
operator|,
name|value
operator|,
name|query_box
operator|->
name|callback_data
operator|)
expr_stmt|;
name|query_box_destroy
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|double_query_box_response (GtkWidget * widget,gint response_id,QueryBox * query_box)
name|double_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
name|gdouble
name|value
decl_stmt|;
name|query_box_disconnect
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
comment|/*  Get the spinbutton data  */
name|value
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|query_box
operator|->
name|entry
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Call the user defined callback  */
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
operator|(
operator|*
operator|(
name|GimpQueryDoubleCallback
operator|)
name|query_box
operator|->
name|callback
operator|)
operator|(
name|query_box
operator|->
name|qbox
operator|,
name|value
operator|,
name|query_box
operator|->
name|callback_data
operator|)
expr_stmt|;
name|query_box_destroy
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|size_query_box_response (GtkWidget * widget,gint response_id,QueryBox * query_box)
name|size_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
name|gdouble
name|size
decl_stmt|;
name|GimpUnit
name|unit
decl_stmt|;
name|query_box_disconnect
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
comment|/*  Get the sizeentry data  */
name|size
operator|=
name|gimp_size_entry_get_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|query_box
operator|->
name|entry
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|unit
operator|=
name|gimp_size_entry_get_unit
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|query_box
operator|->
name|entry
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Call the user defined callback  */
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
operator|(
operator|*
operator|(
name|GimpQuerySizeCallback
operator|)
name|query_box
operator|->
name|callback
operator|)
operator|(
name|query_box
operator|->
name|qbox
operator|,
name|size
operator|,
name|unit
operator|,
name|query_box
operator|->
name|callback_data
operator|)
expr_stmt|;
name|query_box_destroy
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|boolean_query_box_response (GtkWidget * widget,gint response_id,QueryBox * query_box)
name|boolean_query_box_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
name|query_box_disconnect
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
comment|/*  Call the user defined callback  */
operator|(
operator|*
operator|(
name|GimpQueryBooleanCallback
operator|)
name|query_box
operator|->
name|callback
operator|)
operator|(
name|query_box
operator|->
name|qbox
operator|,
operator|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
operator|)
operator|,
name|query_box
operator|->
name|callback_data
operator|)
expr_stmt|;
name|query_box_destroy
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|query_box_cancel_callback (QueryBox * query_box)
name|query_box_cancel_callback
parameter_list|(
name|QueryBox
modifier|*
name|query_box
parameter_list|)
block|{
name|query_box_disconnect
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
name|query_box_destroy
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

