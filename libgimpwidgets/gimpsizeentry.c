begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* LIBGIMP - The GIMP Library  * Copyright (C) 1995-1997 Peter Mattis and Spencer Kimball  *  * gimpsizeentry.c  * Copyright (C) 1999-2000 Sven Neumann<sven@gimp.org>  *                         Michael Natterer<mitch@gimp.org>  *  * This library is free software: you can redistribute it and/or  * modify it under the terms of the GNU Lesser General Public  * License as published by the Free Software Foundation; either  * version 3 of the License, or (at your option) any later version.  *  * This library is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  * Library General Public License for more details.  *  * You should have received a copy of the GNU Lesser General Public  * License along with this library.  If not, see  *<https://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"gimpeevl.h"
end_include

begin_include
include|#
directive|include
file|"gimpsizeentry.h"
end_include

begin_comment
comment|/**  * SECTION: gimpsizeentry  * @title: GimpSizeEntry  * @short_description: Widget for entering pixel values and resolutions.  * @see_also: #GimpUnit, #GimpUnitComboBox, gimp_coordinates_new()  *  * This widget is used to enter pixel distances/sizes and resolutions.  *  * You can specify the number of fields the widget should provide. For  * each field automatic mappings are performed between the field's  * "reference value" and its "value".  *  * There is a #GimpUnitComboBox right of the entry fields which lets  * you specify the #GimpUnit of the displayed values.  *  * For each field, there can be one or two #GtkSpinButton's to enter  * "value" and "reference value". If you specify @show_refval as  * %FALSE in gimp_size_entry_new() there will be only one  * #GtkSpinButton and the #GimpUnitComboBox will contain an item for  * selecting GIMP_UNIT_PIXEL.  *  * The "reference value" is either of GIMP_UNIT_PIXEL or dpi,  * depending on which #GimpSizeEntryUpdatePolicy you specify in  * gimp_size_entry_new().  The "value" is either the size in pixels  * mapped to the size in a real-world-unit (see #GimpUnit) or the dpi  * value mapped to pixels per real-world-unit.  **/
end_comment

begin_define
DECL|macro|SIZE_MAX_VALUE
define|#
directive|define
name|SIZE_MAX_VALUE
value|500000.0
end_define

begin_define
DECL|macro|GIMP_SIZE_ENTRY_DIGITS (unit)
define|#
directive|define
name|GIMP_SIZE_ENTRY_DIGITS
parameter_list|(
name|unit
parameter_list|)
value|(MIN (gimp_unit_get_digits (unit), 5) + 1)
end_define

begin_enum
enum|enum
DECL|enum|__anon2b12eaf60103
block|{
DECL|enumerator|VALUE_CHANGED
name|VALUE_CHANGED
block|,
DECL|enumerator|REFVAL_CHANGED
name|REFVAL_CHANGED
block|,
DECL|enumerator|UNIT_CHANGED
name|UNIT_CHANGED
block|,
DECL|enumerator|LAST_SIGNAL
name|LAST_SIGNAL
block|}
enum|;
end_enum

begin_struct
DECL|struct|_GimpSizeEntryField
struct|struct
name|_GimpSizeEntryField
block|{
DECL|member|gse
name|GimpSizeEntry
modifier|*
name|gse
decl_stmt|;
DECL|member|resolution
name|gdouble
name|resolution
decl_stmt|;
DECL|member|lower
name|gdouble
name|lower
decl_stmt|;
DECL|member|upper
name|gdouble
name|upper
decl_stmt|;
DECL|member|value_adjustment
name|GtkAdjustment
modifier|*
name|value_adjustment
decl_stmt|;
DECL|member|value_spinbutton
name|GtkWidget
modifier|*
name|value_spinbutton
decl_stmt|;
DECL|member|value
name|gdouble
name|value
decl_stmt|;
DECL|member|min_value
name|gdouble
name|min_value
decl_stmt|;
DECL|member|max_value
name|gdouble
name|max_value
decl_stmt|;
DECL|member|refval_adjustment
name|GtkAdjustment
modifier|*
name|refval_adjustment
decl_stmt|;
DECL|member|refval_spinbutton
name|GtkWidget
modifier|*
name|refval_spinbutton
decl_stmt|;
DECL|member|refval
name|gdouble
name|refval
decl_stmt|;
DECL|member|min_refval
name|gdouble
name|min_refval
decl_stmt|;
DECL|member|max_refval
name|gdouble
name|max_refval
decl_stmt|;
DECL|member|refval_digits
name|gint
name|refval_digits
decl_stmt|;
DECL|member|stop_recursion
name|gint
name|stop_recursion
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_GimpSizeEntryPrivate
struct|struct
name|_GimpSizeEntryPrivate
block|{
DECL|member|fields
name|GSList
modifier|*
name|fields
decl_stmt|;
DECL|member|number_of_fields
name|gint
name|number_of_fields
decl_stmt|;
DECL|member|unit_combo
name|GtkWidget
modifier|*
name|unit_combo
decl_stmt|;
DECL|member|unit
name|GimpUnit
name|unit
decl_stmt|;
DECL|member|menu_show_pixels
name|gboolean
name|menu_show_pixels
decl_stmt|;
DECL|member|menu_show_percent
name|gboolean
name|menu_show_percent
decl_stmt|;
DECL|member|show_refval
name|gboolean
name|show_refval
decl_stmt|;
DECL|member|update_policy
name|GimpSizeEntryUpdatePolicy
name|update_policy
decl_stmt|;
block|}
struct|;
end_struct

begin_define
DECL|macro|GET_PRIVATE (obj)
define|#
directive|define
name|GET_PRIVATE
parameter_list|(
name|obj
parameter_list|)
value|(((GimpSizeEntry *) (obj))->priv)
end_define

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_update_value
parameter_list|(
name|GimpSizeEntryField
modifier|*
name|gsef
parameter_list|,
name|gdouble
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_value_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_update_refval
parameter_list|(
name|GimpSizeEntryField
modifier|*
name|gsef
parameter_list|,
name|gdouble
name|refval
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_refval_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_update_unit
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|GimpUnit
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_unit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpSizeEntry
modifier|*
name|sizeentry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_size_entry_attach_eevl
parameter_list|(
name|GtkSpinButton
modifier|*
name|spin_button
parameter_list|,
name|GimpSizeEntryField
modifier|*
name|gsef
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|gimp_size_entry_eevl_input_callback
parameter_list|(
name|GtkSpinButton
modifier|*
name|spinner
parameter_list|,
name|gdouble
modifier|*
name|return_val
parameter_list|,
name|gpointer
modifier|*
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_size_entry_eevl_unit_resolver
parameter_list|(
specifier|const
name|gchar
modifier|*
name|ident
parameter_list|,
name|GimpEevlQuantity
modifier|*
name|result
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|G_DEFINE_TYPE_WITH_PRIVATE
argument_list|(
argument|GimpSizeEntry
argument_list|,
argument|gimp_size_entry
argument_list|,
argument|GTK_TYPE_GRID
argument_list|)
end_macro

begin_define
DECL|macro|parent_class
define|#
directive|define
name|parent_class
value|gimp_size_entry_parent_class
end_define

begin_decl_stmt
specifier|static
name|guint
name|gimp_size_entry_signals
index|[
name|LAST_SIGNAL
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_class_init (GimpSizeEntryClass * klass)
name|gimp_size_entry_class_init
parameter_list|(
name|GimpSizeEntryClass
modifier|*
name|klass
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|object_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|gimp_size_entry_signals
index|[
name|VALUE_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"value-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpSizeEntryClass
argument_list|,
name|value_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_size_entry_signals
index|[
name|REFVAL_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"refval-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpSizeEntryClass
argument_list|,
name|refval_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_size_entry_signals
index|[
name|UNIT_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"unit-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpSizeEntryClass
argument_list|,
name|unit_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|object_class
operator|->
name|finalize
operator|=
name|gimp_size_entry_finalize
expr_stmt|;
name|klass
operator|->
name|value_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|refval_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|unit_changed
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_init (GimpSizeEntry * gse)
name|gimp_size_entry_init
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|gse
operator|->
name|priv
operator|=
name|gimp_size_entry_get_instance_private
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|priv
operator|=
name|gse
operator|->
name|priv
expr_stmt|;
name|priv
operator|->
name|unit
operator|=
name|GIMP_UNIT_PIXEL
expr_stmt|;
name|priv
operator|->
name|menu_show_pixels
operator|=
name|TRUE
expr_stmt|;
name|priv
operator|->
name|menu_show_percent
operator|=
name|TRUE
expr_stmt|;
name|priv
operator|->
name|show_refval
operator|=
name|FALSE
expr_stmt|;
name|priv
operator|->
name|update_policy
operator|=
name|GIMP_SIZE_ENTRY_UPDATE_NONE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_finalize (GObject * object)
name|gimp_size_entry_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
init|=
name|GET_PRIVATE
argument_list|(
name|object
argument_list|)
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|fields
condition|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
for|for
control|(
name|list
operator|=
name|priv
operator|->
name|fields
init|;
name|list
condition|;
name|list
operator|=
name|list
operator|->
name|next
control|)
name|g_slice_free
argument_list|(
name|GimpSizeEntryField
argument_list|,
name|list
operator|->
name|data
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|priv
operator|->
name|fields
argument_list|)
expr_stmt|;
name|priv
operator|->
name|fields
operator|=
name|NULL
expr_stmt|;
block|}
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|finalize
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_new:  * @number_of_fields:  The number of input fields.  * @unit:              The initial unit.  * @unit_format:       A printf-like unit-format string as is used with  *                     gimp_unit_menu_new().  * @menu_show_pixels:  %TRUE if the unit menu should contain an item for  *                     GIMP_UNIT_PIXEL (ignored if the @update_policy is not  *                     GIMP_SIZE_ENTRY_UPDATE_NONE).  * @menu_show_percent: %TRUE if the unit menu should contain an item for  *                     GIMP_UNIT_PERCENT.  * @show_refval:       %TRUE if you want an extra "reference value"  *                     spinbutton per input field.  * @spinbutton_width:  The minimal horizontal size of the #GtkSpinButton's.  * @update_policy:     How the automatic pixel<-> real-world-unit  *                     calculations should be done.  *  * Creates a new #GimpSizeEntry widget.  *  * To have all automatic calculations performed correctly, set up the  * widget in the following order:  *  * 1. gimp_size_entry_new()  *  * 2. (for each additional input field) gimp_size_entry_add_field()  *  * 3. gimp_size_entry_set_unit()  *  * For each input field:  *  * 4. gimp_size_entry_set_resolution()  *  * 5. gimp_size_entry_set_refval_boundaries()  *    (or gimp_size_entry_set_value_boundaries())  *  * 6. gimp_size_entry_set_size()  *  * 7. gimp_size_entry_set_refval() (or gimp_size_entry_set_value())  *  * The #GimpSizeEntry is derived from #GtkGrid and will have  * an empty border of one cell width on each side plus an empty column left  * of the #GimpUnitComboBox to allow the caller to add labels or a  * #GimpChainButton.  *  * Returns: A Pointer to the new #GimpSizeEntry widget.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_size_entry_new (gint number_of_fields,GimpUnit unit,const gchar * unit_format,gboolean menu_show_pixels,gboolean menu_show_percent,gboolean show_refval,gint spinbutton_width,GimpSizeEntryUpdatePolicy update_policy)
name|gimp_size_entry_new
parameter_list|(
name|gint
name|number_of_fields
parameter_list|,
name|GimpUnit
name|unit
parameter_list|,
specifier|const
name|gchar
modifier|*
name|unit_format
parameter_list|,
name|gboolean
name|menu_show_pixels
parameter_list|,
name|gboolean
name|menu_show_percent
parameter_list|,
name|gboolean
name|show_refval
parameter_list|,
name|gint
name|spinbutton_width
parameter_list|,
name|GimpSizeEntryUpdatePolicy
name|update_policy
parameter_list|)
block|{
name|GimpSizeEntry
modifier|*
name|gse
decl_stmt|;
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpUnitStore
modifier|*
name|store
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
operator|(
name|number_of_fields
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|number_of_fields
operator|<=
literal|16
operator|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gse
operator|=
name|g_object_new
argument_list|(
name|GIMP_TYPE_SIZE_ENTRY
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|priv
operator|->
name|number_of_fields
operator|=
name|number_of_fields
expr_stmt|;
name|priv
operator|->
name|unit
operator|=
name|unit
expr_stmt|;
name|priv
operator|->
name|show_refval
operator|=
name|show_refval
expr_stmt|;
name|priv
operator|->
name|update_policy
operator|=
name|update_policy
expr_stmt|;
comment|/*  show the 'pixels' menu entry only if we are a 'size' sizeentry and    *  don't have the reference value spinbutton    */
if|if
condition|(
operator|(
name|update_policy
operator|==
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
operator|)
operator|||
operator|(
name|show_refval
operator|==
name|TRUE
operator|)
condition|)
name|priv
operator|->
name|menu_show_pixels
operator|=
name|FALSE
expr_stmt|;
else|else
name|priv
operator|->
name|menu_show_pixels
operator|=
name|menu_show_pixels
expr_stmt|;
comment|/*  show the 'percent' menu entry only if we are a 'size' sizeentry    */
if|if
condition|(
name|update_policy
operator|==
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
condition|)
name|priv
operator|->
name|menu_show_percent
operator|=
name|FALSE
expr_stmt|;
else|else
name|priv
operator|->
name|menu_show_percent
operator|=
name|menu_show_percent
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|number_of_fields
condition|;
name|i
operator|++
control|)
block|{
name|GimpSizeEntryField
modifier|*
name|gsef
init|=
name|g_slice_new0
argument_list|(
name|GimpSizeEntryField
argument_list|)
decl_stmt|;
name|gint
name|digits
decl_stmt|;
name|priv
operator|->
name|fields
operator|=
name|g_slist_append
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|gse
operator|=
name|gse
expr_stmt|;
name|gsef
operator|->
name|resolution
operator|=
literal|1.0
expr_stmt|;
comment|/*  just to avoid division by zero  */
name|gsef
operator|->
name|lower
operator|=
literal|0.0
expr_stmt|;
name|gsef
operator|->
name|upper
operator|=
literal|100.0
expr_stmt|;
name|gsef
operator|->
name|value
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|min_value
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|max_value
operator|=
name|SIZE_MAX_VALUE
expr_stmt|;
name|gsef
operator|->
name|refval_adjustment
operator|=
name|NULL
expr_stmt|;
name|gsef
operator|->
name|value_adjustment
operator|=
name|NULL
expr_stmt|;
name|gsef
operator|->
name|refval
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|min_refval
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|max_refval
operator|=
name|SIZE_MAX_VALUE
expr_stmt|;
name|gsef
operator|->
name|refval_digits
operator|=
operator|(
name|update_policy
operator|==
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
operator|)
condition|?
literal|0
else|:
literal|3
expr_stmt|;
name|gsef
operator|->
name|stop_recursion
operator|=
literal|0
expr_stmt|;
name|digits
operator|=
operator|(
operator|(
name|unit
operator|==
name|GIMP_UNIT_PIXEL
operator|)
condition|?
name|gsef
operator|->
name|refval_digits
else|:
operator|(
operator|(
name|unit
operator|==
name|GIMP_UNIT_PERCENT
operator|)
condition|?
literal|2
else|:
name|GIMP_SIZE_ENTRY_DIGITS
argument_list|(
name|unit
argument_list|)
operator|)
operator|)
expr_stmt|;
name|gsef
operator|->
name|value_adjustment
operator|=
name|gtk_adjustment_new
argument_list|(
name|gsef
operator|->
name|value
argument_list|,
name|gsef
operator|->
name|min_value
argument_list|,
name|gsef
operator|->
name|max_value
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|value_spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
literal|1.0
argument_list|,
name|digits
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_numeric
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_size_entry_attach_eevl
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
if|if
condition|(
name|spinbutton_width
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|spinbutton_width
operator|<
literal|17
condition|)
name|gtk_entry_set_width_chars
argument_list|(
name|GTK_ENTRY
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|spinbutton_width
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_set_size_request
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|,
name|spinbutton_width
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|gse
argument_list|)
argument_list|,
name|gsef
operator|->
name|value_spinbutton
argument_list|,
name|i
operator|+
literal|1
argument_list|,
name|priv
operator|->
name|show_refval
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_size_entry_value_callback
argument_list|)
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
block|{
name|gsef
operator|->
name|refval_adjustment
operator|=
name|gtk_adjustment_new
argument_list|(
name|gsef
operator|->
name|refval
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|refval_spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
literal|1.0
argument_list|,
name|gsef
operator|->
name|refval_digits
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_numeric
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|refval_spinbutton
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|gsef
operator|->
name|refval_spinbutton
argument_list|,
name|spinbutton_width
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|gse
argument_list|)
argument_list|,
name|gsef
operator|->
name|refval_spinbutton
argument_list|,
name|i
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_size_entry_refval_callback
argument_list|)
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gsef
operator|->
name|refval_spinbutton
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|menu_show_pixels
operator|&&
operator|(
name|unit
operator|==
name|GIMP_UNIT_PIXEL
operator|)
operator|&&
operator|!
name|priv
operator|->
name|show_refval
condition|)
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|gsef
operator|->
name|refval_digits
argument_list|)
expr_stmt|;
block|}
name|store
operator|=
name|gimp_unit_store_new
argument_list|(
name|priv
operator|->
name|number_of_fields
argument_list|)
expr_stmt|;
name|gimp_unit_store_set_has_pixels
argument_list|(
name|store
argument_list|,
name|priv
operator|->
name|menu_show_pixels
argument_list|)
expr_stmt|;
name|gimp_unit_store_set_has_percent
argument_list|(
name|store
argument_list|,
name|priv
operator|->
name|menu_show_percent
argument_list|)
expr_stmt|;
if|if
condition|(
name|unit_format
condition|)
block|{
name|gchar
modifier|*
name|short_format
init|=
name|g_strdup
argument_list|(
name|unit_format
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|p
decl_stmt|;
name|p
operator|=
name|strstr
argument_list|(
name|short_format
argument_list|,
literal|"%s"
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
condition|)
name|strcpy
argument_list|(
name|p
argument_list|,
literal|"%a"
argument_list|)
expr_stmt|;
name|p
operator|=
name|strstr
argument_list|(
name|short_format
argument_list|,
literal|"%p"
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
condition|)
name|strcpy
argument_list|(
name|p
argument_list|,
literal|"%a"
argument_list|)
expr_stmt|;
name|g_object_set
argument_list|(
name|store
argument_list|,
literal|"short-format"
argument_list|,
name|short_format
argument_list|,
literal|"long-format"
argument_list|,
name|unit_format
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|short_format
argument_list|)
expr_stmt|;
block|}
name|priv
operator|->
name|unit_combo
operator|=
name|gimp_unit_combo_box_new_with_model
argument_list|(
name|store
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|store
argument_list|)
expr_stmt|;
name|gimp_unit_combo_box_set_active
argument_list|(
name|GIMP_UNIT_COMBO_BOX
argument_list|(
name|priv
operator|->
name|unit_combo
argument_list|)
argument_list|,
name|unit
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|gse
argument_list|)
argument_list|,
name|priv
operator|->
name|unit_combo
argument_list|,
name|i
operator|+
literal|2
argument_list|,
name|priv
operator|->
name|show_refval
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|priv
operator|->
name|unit_combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_size_entry_unit_callback
argument_list|)
argument_list|,
name|gse
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|priv
operator|->
name|unit_combo
argument_list|)
expr_stmt|;
return|return
name|GTK_WIDGET
argument_list|(
name|gse
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_add_field:  * @gse:               The sizeentry you want to add a field to.  * @value_spinbutton:  The spinbutton to display the field's value.  * @refval_spinbutton: The spinbutton to display the field's reference value.  *  * Adds an input field to the #GimpSizeEntry.  *  * The new input field will have the index 0. If you specified @show_refval  * as %TRUE in gimp_size_entry_new() you have to pass an additional  * #GtkSpinButton to hold the reference value. If @show_refval was %FALSE,  * @refval_spinbutton will be ignored.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_add_field (GimpSizeEntry * gse,GtkSpinButton * value_spinbutton,GtkSpinButton * refval_spinbutton)
name|gimp_size_entry_add_field
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|GtkSpinButton
modifier|*
name|value_spinbutton
parameter_list|,
name|GtkSpinButton
modifier|*
name|refval_spinbutton
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|gint
name|digits
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GTK_IS_SPIN_BUTTON
argument_list|(
name|value_spinbutton
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
block|{
name|g_return_if_fail
argument_list|(
name|GTK_IS_SPIN_BUTTON
argument_list|(
name|refval_spinbutton
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gsef
operator|=
name|g_slice_new0
argument_list|(
name|GimpSizeEntryField
argument_list|)
expr_stmt|;
name|priv
operator|->
name|fields
operator|=
name|g_slist_prepend
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
name|priv
operator|->
name|number_of_fields
operator|++
expr_stmt|;
name|gsef
operator|->
name|gse
operator|=
name|gse
expr_stmt|;
name|gsef
operator|->
name|resolution
operator|=
literal|1.0
expr_stmt|;
comment|/*  just to avoid division by zero  */
name|gsef
operator|->
name|lower
operator|=
literal|0.0
expr_stmt|;
name|gsef
operator|->
name|upper
operator|=
literal|100.0
expr_stmt|;
name|gsef
operator|->
name|value
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|min_value
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|max_value
operator|=
name|SIZE_MAX_VALUE
expr_stmt|;
name|gsef
operator|->
name|refval
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|min_refval
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|max_refval
operator|=
name|SIZE_MAX_VALUE
expr_stmt|;
name|gsef
operator|->
name|refval_digits
operator|=
operator|(
name|priv
operator|->
name|update_policy
operator|==
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
operator|)
condition|?
literal|0
else|:
literal|3
expr_stmt|;
name|gsef
operator|->
name|stop_recursion
operator|=
literal|0
expr_stmt|;
name|gsef
operator|->
name|value_adjustment
operator|=
name|gtk_spin_button_get_adjustment
argument_list|(
name|value_spinbutton
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|value_spinbutton
operator|=
name|GTK_WIDGET
argument_list|(
name|value_spinbutton
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_size_entry_value_callback
argument_list|)
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
name|gimp_size_entry_attach_eevl
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
block|{
name|gsef
operator|->
name|refval_adjustment
operator|=
name|gtk_spin_button_get_adjustment
argument_list|(
name|refval_spinbutton
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|refval_spinbutton
operator|=
name|GTK_WIDGET
argument_list|(
name|refval_spinbutton
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_size_entry_refval_callback
argument_list|)
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
block|}
name|digits
operator|=
operator|(
operator|(
name|priv
operator|->
name|unit
operator|==
name|GIMP_UNIT_PIXEL
operator|)
condition|?
name|gsef
operator|->
name|refval_digits
else|:
operator|(
name|priv
operator|->
name|unit
operator|==
name|GIMP_UNIT_PERCENT
operator|)
condition|?
literal|2
else|:
name|GIMP_SIZE_ENTRY_DIGITS
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
operator|)
expr_stmt|;
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|value_spinbutton
argument_list|)
argument_list|,
name|digits
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|menu_show_pixels
operator|&&
operator|!
name|priv
operator|->
name|show_refval
operator|&&
operator|(
name|priv
operator|->
name|unit
operator|==
name|GIMP_UNIT_PIXEL
operator|)
condition|)
block|{
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|gsef
operator|->
name|refval_digits
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|GimpSizeEntryUpdatePolicy
DECL|function|gimp_size_entry_get_update_policy (GimpSizeEntry * gse)
name|gimp_size_entry_get_update_policy
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
argument_list|)
expr_stmt|;
return|return
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
operator|->
name|update_policy
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_size_entry_get_n_fields (GimpSizeEntry * gse)
name|gimp_size_entry_get_n_fields
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
operator|->
name|number_of_fields
return|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_size_entry_get_unit_combo (GimpSizeEntry * gse)
name|gimp_size_entry_get_unit_combo
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
operator|->
name|unit_combo
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_attach_label:  * @gse:       The sizeentry you want to add a label to.  * @text:      The text of the label.  * @row:       The row where the label will be attached.  * @column:    The column where the label will be attached.  * @alignment: The horizontal alignment of the label.  *  * Attaches a #GtkLabel to the #GimpSizeEntry (which is a #GtkGrid).  *  * Returns: (transfer none): A pointer to the new #GtkLabel widget.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_size_entry_attach_label (GimpSizeEntry * gse,const gchar * text,gint row,gint column,gfloat alignment)
name|gimp_size_entry_attach_label
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
specifier|const
name|gchar
modifier|*
name|text
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|gfloat
name|alignment
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|text
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new_with_mnemonic
argument_list|(
name|text
argument_list|)
expr_stmt|;
if|if
condition|(
name|column
operator|==
literal|0
condition|)
block|{
name|GList
modifier|*
name|children
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|children
operator|=
name|gtk_container_get_children
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|children
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GtkWidget
modifier|*
name|child
init|=
name|list
operator|->
name|data
decl_stmt|;
name|gint
name|left_attach
decl_stmt|;
name|gint
name|top_attach
decl_stmt|;
name|gtk_container_child_get
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|gse
argument_list|)
argument_list|,
name|child
argument_list|,
literal|"left-attach"
argument_list|,
operator|&
name|left_attach
argument_list|,
literal|"top-attach"
argument_list|,
operator|&
name|top_attach
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|left_attach
operator|==
literal|1
operator|&&
name|top_attach
operator|==
name|row
condition|)
block|{
name|gtk_label_set_mnemonic_widget
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|child
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|g_list_free
argument_list|(
name|children
argument_list|)
expr_stmt|;
block|}
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|alignment
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|gse
argument_list|)
argument_list|,
name|label
argument_list|,
name|column
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
return|return
name|label
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_resolution:  * @gse:        The sizeentry you want to set a resolution for.  * @field:      The index of the field you want to set the resolution for.  * @resolution: The new resolution (in dpi) for the chosen @field.  * @keep_size:  %TRUE if the @field's size in pixels should stay the same.  *              %FALSE if the @field's size in units should stay the same.  *  * Sets the resolution (in dpi) for field # @field of the #GimpSizeEntry.  *  * The @resolution passed will be clamped to fit in  * [#GIMP_MIN_RESOLUTION..#GIMP_MAX_RESOLUTION].  *  * This function does nothing if the #GimpSizeEntryUpdatePolicy specified in  * gimp_size_entry_new() doesn't equal to #GIMP_SIZE_ENTRY_UPDATE_SIZE.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_resolution (GimpSizeEntry * gse,gint field,gdouble resolution,gboolean keep_size)
name|gimp_size_entry_set_resolution
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|,
name|gdouble
name|resolution
parameter_list|,
name|gboolean
name|keep_size
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|gfloat
name|val
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|)
expr_stmt|;
name|resolution
operator|=
name|CLAMP
argument_list|(
name|resolution
argument_list|,
name|GIMP_MIN_RESOLUTION
argument_list|,
name|GIMP_MAX_RESOLUTION
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|resolution
operator|=
name|resolution
expr_stmt|;
name|val
operator|=
name|gsef
operator|->
name|value
expr_stmt|;
name|gsef
operator|->
name|stop_recursion
operator|=
literal|0
expr_stmt|;
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|keep_size
condition|)
name|gimp_size_entry_set_value
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_size:  * @gse:   The sizeentry you want to set a size for.  * @field: The index of the field you want to set the size for.  * @lower: The reference value which will be treated as 0%.  * @upper: The reference value which will be treated as 100%.  *  * Sets the pixel values for field # @field of the #GimpSizeEntry  * which will be treated as 0% and 100%.  *  * These values will be used if you specified @menu_show_percent as %TRUE  * in gimp_size_entry_new() and the user has selected GIMP_UNIT_PERCENT in  * the #GimpSizeEntry's #GimpUnitComboBox.  *  * This function does nothing if the #GimpSizeEntryUpdatePolicy specified in  * gimp_size_entry_new() doesn't equal to GIMP_SIZE_ENTRY_UPDATE_SIZE.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_size (GimpSizeEntry * gse,gint field,gdouble lower,gdouble upper)
name|gimp_size_entry_set_size
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|,
name|gdouble
name|lower
parameter_list|,
name|gdouble
name|upper
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|lower
operator|<=
name|upper
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|lower
operator|=
name|lower
expr_stmt|;
name|gsef
operator|->
name|upper
operator|=
name|upper
expr_stmt|;
name|gimp_size_entry_set_refval
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|refval
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_value_boundaries:  * @gse:   The sizeentry you want to set value boundaries for.  * @field: The index of the field you want to set value boundaries for.  * @lower: The new lower boundary of the value of the chosen @field.  * @upper: The new upper boundary of the value of the chosen @field.  *  * Limits the range of possible values which can be entered in field # @field  * of the #GimpSizeEntry.  *  * The current value of the @field will be clamped to fit in the @field's  * new boundaries.  *  * NOTE: In most cases you won't be interested in this function because the  *       #GimpSizeEntry's purpose is to shield the programmer from unit  *       calculations. Use gimp_size_entry_set_refval_boundaries() instead.  *       Whatever you do, don't mix these calls. A size entry should either  *       be clamped by the value or the reference value.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_value_boundaries (GimpSizeEntry * gse,gint field,gdouble lower,gdouble upper)
name|gimp_size_entry_set_value_boundaries
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|,
name|gdouble
name|lower
parameter_list|,
name|gdouble
name|upper
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|lower
operator|<=
name|upper
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|min_value
operator|=
name|lower
expr_stmt|;
name|gsef
operator|->
name|max_value
operator|=
name|upper
expr_stmt|;
name|g_object_freeze_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_lower
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
name|gsef
operator|->
name|min_value
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_upper
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
name|gsef
operator|->
name|max_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|gsef
operator|->
name|stop_recursion
condition|)
comment|/* this is a hack (but useful ;-) */
block|{
name|g_object_thaw_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|gsef
operator|->
name|stop_recursion
operator|++
expr_stmt|;
switch|switch
condition|(
name|priv
operator|->
name|update_policy
condition|)
block|{
case|case
name|GIMP_SIZE_ENTRY_UPDATE_NONE
case|:
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
case|:
switch|switch
condition|(
name|priv
operator|->
name|unit
condition|)
block|{
case|case
name|GIMP_UNIT_PIXEL
case|:
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|min_value
argument_list|,
name|gsef
operator|->
name|max_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_UNIT_PERCENT
case|:
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|lower
operator|+
operator|(
name|gsef
operator|->
name|upper
operator|-
name|gsef
operator|->
name|lower
operator|)
operator|*
name|gsef
operator|->
name|min_value
operator|/
literal|100
argument_list|,
name|gsef
operator|->
name|lower
operator|+
operator|(
name|gsef
operator|->
name|upper
operator|-
name|gsef
operator|->
name|lower
operator|)
operator|*
name|gsef
operator|->
name|max_value
operator|/
literal|100
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|min_value
operator|*
name|gsef
operator|->
name|resolution
operator|/
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|,
name|gsef
operator|->
name|max_value
operator|*
name|gsef
operator|->
name|resolution
operator|/
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
case|:
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|min_value
operator|*
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|,
name|gsef
operator|->
name|max_value
operator|*
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|gsef
operator|->
name|stop_recursion
operator|--
expr_stmt|;
name|gimp_size_entry_set_value
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|value
argument_list|)
expr_stmt|;
name|g_object_thaw_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_get_value:  * @gse:   The sizeentry you want to know a value of.  * @field: The index of the field you want to know the value of.  *  * Returns the value of field # @field of the #GimpSizeEntry.  *  * The @value returned is a distance or resolution  * in the #GimpUnit the user has selected in the #GimpSizeEntry's  * #GimpUnitComboBox.  *  * NOTE: In most cases you won't be interested in this value because the  *       #GimpSizeEntry's purpose is to shield the programmer from unit  *       calculations. Use gimp_size_entry_get_refval() instead.  *  * Returns: The value of the chosen @field.  **/
end_comment

begin_function
name|gdouble
DECL|function|gimp_size_entry_get_value (GimpSizeEntry * gse,gint field)
name|gimp_size_entry_get_value
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
return|return
name|gsef
operator|->
name|value
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_update_value (GimpSizeEntryField * gsef,gdouble value)
name|gimp_size_entry_update_value
parameter_list|(
name|GimpSizeEntryField
modifier|*
name|gsef
parameter_list|,
name|gdouble
name|value
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
init|=
name|gsef
operator|->
name|gse
operator|->
name|priv
decl_stmt|;
if|if
condition|(
name|gsef
operator|->
name|stop_recursion
operator|>
literal|1
condition|)
return|return;
name|gsef
operator|->
name|value
operator|=
name|value
expr_stmt|;
switch|switch
condition|(
name|priv
operator|->
name|update_policy
condition|)
block|{
case|case
name|GIMP_SIZE_ENTRY_UPDATE_NONE
case|:
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
case|:
switch|switch
condition|(
name|priv
operator|->
name|unit
condition|)
block|{
case|case
name|GIMP_UNIT_PIXEL
case|:
name|gsef
operator|->
name|refval
operator|=
name|value
expr_stmt|;
break|break;
case|case
name|GIMP_UNIT_PERCENT
case|:
name|gsef
operator|->
name|refval
operator|=
name|CLAMP
argument_list|(
name|gsef
operator|->
name|lower
operator|+
operator|(
name|gsef
operator|->
name|upper
operator|-
name|gsef
operator|->
name|lower
operator|)
operator|*
name|value
operator|/
literal|100
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gsef
operator|->
name|refval
operator|=
name|CLAMP
argument_list|(
name|value
operator|*
name|gsef
operator|->
name|resolution
operator|/
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
name|gtk_adjustment_set_value
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
name|gsef
operator|->
name|refval
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
case|:
name|gsef
operator|->
name|refval
operator|=
name|CLAMP
argument_list|(
name|value
operator|*
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
name|gtk_adjustment_set_value
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
name|gsef
operator|->
name|refval
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|g_signal_emit
argument_list|(
name|gsef
operator|->
name|gse
argument_list|,
name|gimp_size_entry_signals
index|[
name|VALUE_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_value:  * @gse:   The sizeentry you want to set a value for.  * @field: The index of the field you want to set a value for.  * @value: The new value for @field.  *  * Sets the value for field # @field of the #GimpSizeEntry.  *  * The @value passed is treated to be a distance or resolution  * in the #GimpUnit the user has selected in the #GimpSizeEntry's  * #GimpUnitComboBox.  *  * NOTE: In most cases you won't be interested in this value because the  *       #GimpSizeEntry's purpose is to shield the programmer from unit  *       calculations. Use gimp_size_entry_set_refval() instead.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_value (GimpSizeEntry * gse,gint field,gdouble value)
name|gimp_size_entry_set_value
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|,
name|gdouble
name|value
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
name|value
operator|=
name|CLAMP
argument_list|(
name|value
argument_list|,
name|gsef
operator|->
name|min_value
argument_list|,
name|gsef
operator|->
name|max_value
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|gimp_size_entry_update_value
argument_list|(
name|gsef
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_value_callback (GtkAdjustment * adjustment,gpointer data)
name|gimp_size_entry_value_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|gdouble
name|new_value
decl_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|data
expr_stmt|;
name|new_value
operator|=
name|gtk_adjustment_get_value
argument_list|(
name|adjustment
argument_list|)
expr_stmt|;
if|if
condition|(
name|gsef
operator|->
name|value
operator|!=
name|new_value
condition|)
name|gimp_size_entry_update_value
argument_list|(
name|gsef
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_refval_boundaries:  * @gse:   The sizeentry you want to set the reference value boundaries for.  * @field: The index of the field you want to set the reference value  *         boundaries for.  * @lower: The new lower boundary of the reference value of the chosen @field.  * @upper: The new upper boundary of the reference value of the chosen @field.  *  * Limits the range of possible reference values which can be entered in  * field # @field of the #GimpSizeEntry.  *  * The current reference value of the @field will be clamped to fit in the  * @field's new boundaries.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_refval_boundaries (GimpSizeEntry * gse,gint field,gdouble lower,gdouble upper)
name|gimp_size_entry_set_refval_boundaries
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|,
name|gdouble
name|lower
parameter_list|,
name|gdouble
name|upper
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|lower
operator|<=
name|upper
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|min_refval
operator|=
name|lower
expr_stmt|;
name|gsef
operator|->
name|max_refval
operator|=
name|upper
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
block|{
name|g_object_freeze_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_lower
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_upper
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gsef
operator|->
name|stop_recursion
condition|)
comment|/* this is a hack (but useful ;-) */
block|{
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
name|g_object_thaw_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|gsef
operator|->
name|stop_recursion
operator|++
expr_stmt|;
switch|switch
condition|(
name|priv
operator|->
name|update_policy
condition|)
block|{
case|case
name|GIMP_SIZE_ENTRY_UPDATE_NONE
case|:
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
case|:
switch|switch
condition|(
name|priv
operator|->
name|unit
condition|)
block|{
case|case
name|GIMP_UNIT_PIXEL
case|:
name|gimp_size_entry_set_value_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_UNIT_PERCENT
case|:
name|gimp_size_entry_set_value_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
literal|100
operator|*
operator|(
name|gsef
operator|->
name|min_refval
operator|-
name|gsef
operator|->
name|lower
operator|)
operator|/
operator|(
name|gsef
operator|->
name|upper
operator|-
name|gsef
operator|->
name|lower
operator|)
argument_list|,
literal|100
operator|*
operator|(
name|gsef
operator|->
name|max_refval
operator|-
name|gsef
operator|->
name|lower
operator|)
operator|/
operator|(
name|gsef
operator|->
name|upper
operator|-
name|gsef
operator|->
name|lower
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gimp_size_entry_set_value_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|min_refval
operator|*
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
operator|/
name|gsef
operator|->
name|resolution
argument_list|,
name|gsef
operator|->
name|max_refval
operator|*
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
operator|/
name|gsef
operator|->
name|resolution
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
case|:
name|gimp_size_entry_set_value_boundaries
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|min_refval
operator|/
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|,
name|gsef
operator|->
name|max_refval
operator|/
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|gsef
operator|->
name|stop_recursion
operator|--
expr_stmt|;
name|gimp_size_entry_set_refval
argument_list|(
name|gse
argument_list|,
name|field
argument_list|,
name|gsef
operator|->
name|refval
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
name|g_object_thaw_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_refval_digits:  * @gse:    The sizeentry you want to set the reference value digits for.  * @field:  The index of the field you want to set the reference value for.  * @digits: The new number of decimal digits for the #GtkSpinButton which  *          displays @field's reference value.  *  * Sets the decimal digits of field # @field of the #GimpSizeEntry to  * @digits.  *  * If you don't specify this value explicitly, the reference value's number  * of digits will equal to 0 for #GIMP_SIZE_ENTRY_UPDATE_SIZE and to 2 for  * #GIMP_SIZE_ENTRY_UPDATE_RESOLUTION.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_refval_digits (GimpSizeEntry * gse,gint field,gint digits)
name|gimp_size_entry_set_refval_digits
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|,
name|gint
name|digits
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|digits
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|digits
operator|<=
literal|6
operator|)
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
name|gsef
operator|->
name|refval_digits
operator|=
name|digits
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|update_policy
operator|==
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
condition|)
block|{
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|refval_spinbutton
argument_list|)
argument_list|,
name|gsef
operator|->
name|refval_digits
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|priv
operator|->
name|unit
operator|==
name|GIMP_UNIT_PIXEL
condition|)
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|gsef
operator|->
name|refval_digits
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_get_refval:  * @gse:   The sizeentry you want to know a reference value of.  * @field: The index of the field you want to know the reference value of.  *  * Returns the reference value for field # @field of the #GimpSizeEntry.  *  * The reference value is either a distance in pixels or a resolution  * in dpi, depending on which #GimpSizeEntryUpdatePolicy you chose in  * gimp_size_entry_new().  *  * Returns: The reference value of the chosen @field.  **/
end_comment

begin_function
name|gdouble
DECL|function|gimp_size_entry_get_refval (GimpSizeEntry * gse,gint field)
name|gimp_size_entry_get_refval
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
comment|/*  return 1.0 to avoid division by zero  */
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
return|return
name|gsef
operator|->
name|refval
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_update_refval (GimpSizeEntryField * gsef,gdouble refval)
name|gimp_size_entry_update_refval
parameter_list|(
name|GimpSizeEntryField
modifier|*
name|gsef
parameter_list|,
name|gdouble
name|refval
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
init|=
name|GET_PRIVATE
argument_list|(
name|gsef
operator|->
name|gse
argument_list|)
decl_stmt|;
if|if
condition|(
name|gsef
operator|->
name|stop_recursion
operator|>
literal|1
condition|)
return|return;
name|gsef
operator|->
name|refval
operator|=
name|refval
expr_stmt|;
switch|switch
condition|(
name|priv
operator|->
name|update_policy
condition|)
block|{
case|case
name|GIMP_SIZE_ENTRY_UPDATE_NONE
case|:
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
case|:
switch|switch
condition|(
name|priv
operator|->
name|unit
condition|)
block|{
case|case
name|GIMP_UNIT_PIXEL
case|:
name|gsef
operator|->
name|value
operator|=
name|refval
expr_stmt|;
break|break;
case|case
name|GIMP_UNIT_PERCENT
case|:
name|gsef
operator|->
name|value
operator|=
name|CLAMP
argument_list|(
literal|100
operator|*
operator|(
name|refval
operator|-
name|gsef
operator|->
name|lower
operator|)
operator|/
operator|(
name|gsef
operator|->
name|upper
operator|-
name|gsef
operator|->
name|lower
operator|)
argument_list|,
name|gsef
operator|->
name|min_value
argument_list|,
name|gsef
operator|->
name|max_value
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gsef
operator|->
name|value
operator|=
name|CLAMP
argument_list|(
name|refval
operator|*
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
operator|/
name|gsef
operator|->
name|resolution
argument_list|,
name|gsef
operator|->
name|min_value
argument_list|,
name|gsef
operator|->
name|max_value
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_adjustment_set_value
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
name|gsef
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
case|:
name|gsef
operator|->
name|value
operator|=
name|CLAMP
argument_list|(
name|refval
operator|/
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
argument_list|,
name|gsef
operator|->
name|min_value
argument_list|,
name|gsef
operator|->
name|max_value
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|gsef
operator|->
name|value_adjustment
argument_list|,
name|gsef
operator|->
name|value
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|g_signal_emit
argument_list|(
name|gsef
operator|->
name|gse
argument_list|,
name|gimp_size_entry_signals
index|[
name|REFVAL_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_refval:  * @gse:    The sizeentry you want to set a reference value for.  * @field:  The index of the field you want to set the reference value for.  * @refval: The new reference value for @field.  *  * Sets the reference value for field # @field of the #GimpSizeEntry.  *  * The @refval passed is either a distance in pixels or a resolution in dpi,  * depending on which #GimpSizeEntryUpdatePolicy you chose in  * gimp_size_entry_new().  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_refval (GimpSizeEntry * gse,gint field,gdouble refval)
name|gimp_size_entry_set_refval
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|,
name|gdouble
name|refval
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|)
expr_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
name|refval
operator|=
name|CLAMP
argument_list|(
name|refval
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|show_refval
condition|)
name|gtk_adjustment_set_value
argument_list|(
name|gsef
operator|->
name|refval_adjustment
argument_list|,
name|refval
argument_list|)
expr_stmt|;
name|gimp_size_entry_update_refval
argument_list|(
name|gsef
argument_list|,
name|refval
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_refval_callback (GtkAdjustment * adjustment,gpointer data)
name|gimp_size_entry_refval_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|gdouble
name|new_refval
decl_stmt|;
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|data
expr_stmt|;
name|new_refval
operator|=
name|gtk_adjustment_get_value
argument_list|(
name|adjustment
argument_list|)
expr_stmt|;
if|if
condition|(
name|gsef
operator|->
name|refval
operator|!=
name|new_refval
condition|)
name|gimp_size_entry_update_refval
argument_list|(
name|gsef
argument_list|,
name|new_refval
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_get_unit:  * @gse: The sizeentry you want to know the unit of.  *  * Returns the #GimpUnit the user has selected in the #GimpSizeEntry's  * #GimpUnitComboBox.  *  * Returns: (transfer none): The sizeentry's unit.  **/
end_comment

begin_function
name|GimpUnit
DECL|function|gimp_size_entry_get_unit (GimpSizeEntry * gse)
name|gimp_size_entry_get_unit
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
name|GIMP_UNIT_INCH
argument_list|)
expr_stmt|;
return|return
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
operator|->
name|unit
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_update_unit (GimpSizeEntry * gse,GimpUnit unit)
name|gimp_size_entry_update_unit
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|GimpUnit
name|unit
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
init|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|digits
decl_stmt|;
name|priv
operator|->
name|unit
operator|=
name|unit
expr_stmt|;
name|digits
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|gse
argument_list|)
argument_list|,
literal|"gimp-pixel-digits"
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|priv
operator|->
name|number_of_fields
condition|;
name|i
operator|++
control|)
block|{
name|gsef
operator|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|update_policy
operator|==
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
condition|)
block|{
if|if
condition|(
name|unit
operator|==
name|GIMP_UNIT_PIXEL
condition|)
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|gsef
operator|->
name|refval_digits
operator|+
name|digits
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|unit
operator|==
name|GIMP_UNIT_PERCENT
condition|)
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
literal|2
operator|+
name|digits
argument_list|)
expr_stmt|;
else|else
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|GIMP_SIZE_ENTRY_DIGITS
argument_list|(
name|unit
argument_list|)
operator|+
name|digits
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|priv
operator|->
name|update_policy
operator|==
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
condition|)
block|{
name|digits
operator|=
operator|(
name|gimp_unit_get_digits
argument_list|(
name|GIMP_UNIT_INCH
argument_list|)
operator|-
name|gimp_unit_get_digits
argument_list|(
name|unit
argument_list|)
operator|)
expr_stmt|;
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|MAX
argument_list|(
literal|3
operator|+
name|digits
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gsef
operator|->
name|stop_recursion
operator|=
literal|0
expr_stmt|;
comment|/* hack !!! */
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|gse
argument_list|,
name|i
argument_list|,
name|gsef
operator|->
name|min_refval
argument_list|,
name|gsef
operator|->
name|max_refval
argument_list|)
expr_stmt|;
block|}
name|g_signal_emit
argument_list|(
name|gse
argument_list|,
name|gimp_size_entry_signals
index|[
name|UNIT_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_unit:  * @gse:  The sizeentry you want to change the unit for.  * @unit: The new unit.  *  * Sets the #GimpSizeEntry's unit. The reference value for all fields will  * stay the same but the value in units or pixels per unit will change  * according to which #GimpSizeEntryUpdatePolicy you chose in  * gimp_size_entry_new().  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_unit (GimpSizeEntry * gse,GimpUnit unit)
name|gimp_size_entry_set_unit
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|GimpUnit
name|unit
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|priv
operator|->
name|menu_show_pixels
operator|||
operator|(
name|unit
operator|!=
name|GIMP_UNIT_PIXEL
operator|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|priv
operator|->
name|menu_show_percent
operator|||
operator|(
name|unit
operator|!=
name|GIMP_UNIT_PERCENT
operator|)
argument_list|)
expr_stmt|;
name|gimp_unit_combo_box_set_active
argument_list|(
name|GIMP_UNIT_COMBO_BOX
argument_list|(
name|priv
operator|->
name|unit_combo
argument_list|)
argument_list|,
name|unit
argument_list|)
expr_stmt|;
name|gimp_size_entry_update_unit
argument_list|(
name|gse
argument_list|,
name|unit
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_unit_callback (GtkWidget * widget,GimpSizeEntry * gse)
name|gimp_size_entry_unit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|)
block|{
name|GimpUnit
name|new_unit
decl_stmt|;
name|new_unit
operator|=
name|gimp_unit_combo_box_get_active
argument_list|(
name|GIMP_UNIT_COMBO_BOX
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
operator|->
name|unit
operator|!=
name|new_unit
condition|)
name|gimp_size_entry_update_unit
argument_list|(
name|gse
argument_list|,
name|new_unit
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_attach_eevl:  * @spin_button: one of the size_entry's spinbuttons.  * @gsef:        a size entry field.  *  * Hooks in the GimpEevl unit expression parser into the  * #GtkSpinButton of the #GimpSizeEntryField.  **/
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_size_entry_attach_eevl (GtkSpinButton * spin_button,GimpSizeEntryField * gsef)
name|gimp_size_entry_attach_eevl
parameter_list|(
name|GtkSpinButton
modifier|*
name|spin_button
parameter_list|,
name|GimpSizeEntryField
modifier|*
name|gsef
parameter_list|)
block|{
name|gtk_spin_button_set_numeric
argument_list|(
name|spin_button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_update_policy
argument_list|(
name|spin_button
argument_list|,
name|GTK_UPDATE_IF_VALID
argument_list|)
expr_stmt|;
name|g_signal_connect_after
argument_list|(
name|spin_button
argument_list|,
literal|"input"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_size_entry_eevl_input_callback
argument_list|)
argument_list|,
name|gsef
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|gimp_size_entry_eevl_input_callback (GtkSpinButton * spinner,gdouble * return_val,gpointer * data)
name|gimp_size_entry_eevl_input_callback
parameter_list|(
name|GtkSpinButton
modifier|*
name|spinner
parameter_list|,
name|gdouble
modifier|*
name|return_val
parameter_list|,
name|gpointer
modifier|*
name|data
parameter_list|)
block|{
name|GimpSizeEntryField
modifier|*
name|gsef
init|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|data
decl_stmt|;
name|GimpSizeEntryPrivate
modifier|*
name|priv
init|=
name|GET_PRIVATE
argument_list|(
name|gsef
operator|->
name|gse
argument_list|)
decl_stmt|;
name|GimpEevlOptions
name|options
init|=
name|GIMP_EEVL_OPTIONS_INIT
decl_stmt|;
name|gboolean
name|success
init|=
name|FALSE
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|error_pos
init|=
literal|0
decl_stmt|;
name|GError
modifier|*
name|error
init|=
name|NULL
decl_stmt|;
name|GimpEevlQuantity
name|result
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GTK_IS_SPIN_BUTTON
argument_list|(
name|spinner
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gsef
operator|->
name|gse
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|options
operator|.
name|unit_resolver_proc
operator|=
name|gimp_size_entry_eevl_unit_resolver
expr_stmt|;
name|options
operator|.
name|data
operator|=
name|data
expr_stmt|;
comment|/* enable ratio expressions when there are two fields */
if|if
condition|(
name|priv
operator|->
name|number_of_fields
operator|==
literal|2
condition|)
block|{
name|GimpSizeEntryField
modifier|*
name|other_gsef
decl_stmt|;
name|GimpEevlQuantity
name|default_unit_factor
decl_stmt|;
name|options
operator|.
name|ratio_expressions
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|gsef
operator|==
name|priv
operator|->
name|fields
operator|->
name|data
condition|)
block|{
name|other_gsef
operator|=
name|priv
operator|->
name|fields
operator|->
name|next
operator|->
name|data
expr_stmt|;
name|options
operator|.
name|ratio_invert
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
block|{
name|other_gsef
operator|=
name|priv
operator|->
name|fields
operator|->
name|data
expr_stmt|;
name|options
operator|.
name|ratio_invert
operator|=
name|TRUE
expr_stmt|;
block|}
name|options
operator|.
name|unit_resolver_proc
argument_list|(
name|NULL
argument_list|,
operator|&
name|default_unit_factor
argument_list|,
name|options
operator|.
name|data
argument_list|)
expr_stmt|;
name|options
operator|.
name|ratio_quantity
operator|.
name|value
operator|=
name|other_gsef
operator|->
name|value
operator|/
name|default_unit_factor
operator|.
name|value
expr_stmt|;
name|options
operator|.
name|ratio_quantity
operator|.
name|dimension
operator|=
name|default_unit_factor
operator|.
name|dimension
expr_stmt|;
block|}
name|success
operator|=
name|gimp_eevl_evaluate
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|spinner
argument_list|)
argument_list|)
argument_list|,
operator|&
name|options
argument_list|,
operator|&
name|result
argument_list|,
operator|&
name|error_pos
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|success
condition|)
block|{
if|if
condition|(
name|error
operator|&&
name|error_pos
condition|)
block|{
name|g_printerr
argument_list|(
literal|"ERROR: %s at '%s'\n"
argument_list|,
name|error
operator|->
name|message
argument_list|,
operator|*
name|error_pos
condition|?
name|error_pos
else|:
literal|"<End of input>"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_printerr
argument_list|(
literal|"ERROR: Expression evaluation failed without error.\n"
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_error_bell
argument_list|(
name|GTK_WIDGET
argument_list|(
name|spinner
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|GTK_INPUT_ERROR
return|;
block|}
elseif|else
if|if
condition|(
name|result
operator|.
name|dimension
operator|!=
literal|1
operator|&&
name|priv
operator|->
name|unit
operator|!=
name|GIMP_UNIT_PERCENT
condition|)
block|{
name|g_printerr
argument_list|(
literal|"ERROR: result has wrong dimension (expected 1, got %d)\n"
argument_list|,
name|result
operator|.
name|dimension
argument_list|)
expr_stmt|;
name|gtk_widget_error_bell
argument_list|(
name|GTK_WIDGET
argument_list|(
name|spinner
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|GTK_INPUT_ERROR
return|;
block|}
elseif|else
if|if
condition|(
name|result
operator|.
name|dimension
operator|!=
literal|0
operator|&&
name|priv
operator|->
name|unit
operator|==
name|GIMP_UNIT_PERCENT
condition|)
block|{
name|g_printerr
argument_list|(
literal|"ERROR: result has wrong dimension (expected 0, got %d)\n"
argument_list|,
name|result
operator|.
name|dimension
argument_list|)
expr_stmt|;
name|gtk_widget_error_bell
argument_list|(
name|GTK_WIDGET
argument_list|(
name|spinner
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|GTK_INPUT_ERROR
return|;
block|}
else|else
block|{
comment|/* transform back to UI-unit */
name|GimpEevlQuantity
name|ui_unit
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gdouble
name|val
decl_stmt|;
switch|switch
condition|(
name|priv
operator|->
name|unit
condition|)
block|{
case|case
name|GIMP_UNIT_PIXEL
case|:
name|ui_unit
operator|.
name|value
operator|=
name|gsef
operator|->
name|resolution
expr_stmt|;
name|ui_unit
operator|.
name|dimension
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|GIMP_UNIT_PERCENT
case|:
name|ui_unit
operator|.
name|value
operator|=
literal|1.0
expr_stmt|;
name|ui_unit
operator|.
name|dimension
operator|=
literal|0
expr_stmt|;
break|break;
default|default:
name|ui_unit
operator|.
name|value
operator|=
name|gimp_unit_get_factor
argument_list|(
name|priv
operator|->
name|unit
argument_list|)
expr_stmt|;
name|ui_unit
operator|.
name|dimension
operator|=
literal|1
expr_stmt|;
break|break;
block|}
operator|*
name|return_val
operator|=
name|result
operator|.
name|value
operator|*
name|ui_unit
operator|.
name|value
expr_stmt|;
comment|/*  CLAMP() to adjustment bounds, or too large/small values        *  will make the validation machinery revert to the old value.        *  See bug #694477.        */
name|adj
operator|=
name|gtk_spin_button_get_adjustment
argument_list|(
name|spinner
argument_list|)
expr_stmt|;
name|val
operator|=
name|CLAMP
argument_list|(
operator|*
name|return_val
argument_list|,
name|gtk_adjustment_get_lower
argument_list|(
name|adj
argument_list|)
argument_list|,
name|gtk_adjustment_get_upper
argument_list|(
name|adj
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|!=
operator|*
name|return_val
condition|)
block|{
name|gtk_widget_error_bell
argument_list|(
name|GTK_WIDGET
argument_list|(
name|spinner
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|return_val
operator|=
name|val
expr_stmt|;
block|}
return|return
name|TRUE
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_size_entry_eevl_unit_resolver (const gchar * identifier,GimpEevlQuantity * result,gpointer data)
name|gimp_size_entry_eevl_unit_resolver
parameter_list|(
specifier|const
name|gchar
modifier|*
name|identifier
parameter_list|,
name|GimpEevlQuantity
modifier|*
name|result
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpSizeEntryField
modifier|*
name|gsef
init|=
operator|(
name|GimpSizeEntryField
operator|*
operator|)
name|data
decl_stmt|;
name|GimpSizeEntryPrivate
modifier|*
name|priv
init|=
name|GET_PRIVATE
argument_list|(
name|gsef
operator|->
name|gse
argument_list|)
decl_stmt|;
name|gboolean
name|resolve_default_unit
init|=
operator|(
name|identifier
operator|==
name|NULL
operator|)
decl_stmt|;
name|GimpUnit
name|unit
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|gsef
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|result
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gsef
operator|->
name|gse
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
for|for
control|(
name|unit
operator|=
literal|0
init|;
name|unit
operator|<=
name|gimp_unit_get_number_of_units
argument_list|()
condition|;
name|unit
operator|++
control|)
block|{
comment|/* Hack to handle percent within the loop */
if|if
condition|(
name|unit
operator|==
name|gimp_unit_get_number_of_units
argument_list|()
condition|)
name|unit
operator|=
name|GIMP_UNIT_PERCENT
expr_stmt|;
if|if
condition|(
operator|(
name|resolve_default_unit
operator|&&
name|unit
operator|==
name|priv
operator|->
name|unit
operator|)
operator|||
operator|(
name|identifier
operator|&&
operator|(
name|strcmp
argument_list|(
name|gimp_unit_get_symbol
argument_list|(
name|unit
argument_list|)
argument_list|,
name|identifier
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|gimp_unit_get_abbreviation
argument_list|(
name|unit
argument_list|)
argument_list|,
name|identifier
argument_list|)
operator|==
literal|0
operator|)
operator|)
condition|)
block|{
switch|switch
condition|(
name|unit
condition|)
block|{
case|case
name|GIMP_UNIT_PERCENT
case|:
if|if
condition|(
name|priv
operator|->
name|unit
operator|==
name|GIMP_UNIT_PERCENT
condition|)
block|{
name|result
operator|->
name|value
operator|=
literal|1
expr_stmt|;
name|result
operator|->
name|dimension
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
comment|/* gsef->upper contains the '100%'-value */
name|result
operator|->
name|value
operator|=
literal|100
operator|*
name|gsef
operator|->
name|resolution
operator|/
name|gsef
operator|->
name|upper
expr_stmt|;
name|result
operator|->
name|dimension
operator|=
literal|1
expr_stmt|;
block|}
comment|/* return here, don't perform percentage conversion */
return|return
name|TRUE
return|;
case|case
name|GIMP_UNIT_PIXEL
case|:
name|result
operator|->
name|value
operator|=
name|gsef
operator|->
name|resolution
expr_stmt|;
break|break;
default|default:
name|result
operator|->
name|value
operator|=
name|gimp_unit_get_factor
argument_list|(
name|unit
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|priv
operator|->
name|unit
operator|==
name|GIMP_UNIT_PERCENT
condition|)
block|{
comment|/* map non-percentages onto percent */
name|result
operator|->
name|value
operator|=
name|gsef
operator|->
name|upper
operator|/
operator|(
literal|100
operator|*
name|gsef
operator|->
name|resolution
operator|)
expr_stmt|;
name|result
operator|->
name|dimension
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|result
operator|->
name|dimension
operator|=
literal|1
expr_stmt|;
block|}
comment|/* We are done */
return|return
name|TRUE
return|;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_show_unit_menu:  * @gse: a #GimpSizeEntry  * @show: Boolean  *  * Controls whether a unit menu is shown in the size entry.  If  * @show is %TRUE, the menu is shown; otherwise it is hidden.  *  * Since: 2.4  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_show_unit_menu (GimpSizeEntry * gse,gboolean show)
name|gimp_size_entry_show_unit_menu
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gboolean
name|show
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_visible
argument_list|(
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
operator|->
name|unit_combo
argument_list|,
name|show
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_pixel_digits:  * @gse: a #GimpSizeEntry  * @digits: the number of digits to display for a pixel size  *  * This function allows you set up a #GimpSizeEntry so that sub-pixel  * sizes can be entered.  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_pixel_digits (GimpSizeEntry * gse,gint digits)
name|gimp_size_entry_set_pixel_digits
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|digits
parameter_list|)
block|{
name|GimpUnitComboBox
modifier|*
name|combo
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|combo
operator|=
name|GIMP_UNIT_COMBO_BOX
argument_list|(
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
operator|->
name|unit_combo
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|gse
argument_list|)
argument_list|,
literal|"gimp-pixel-digits"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|digits
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_size_entry_update_unit
argument_list|(
name|gse
argument_list|,
name|gimp_unit_combo_box_get_active
argument_list|(
name|combo
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_grab_focus:  * @gse: The sizeentry you want to grab the keyboard focus.  *  * This function is rather ugly and just a workaround for the fact that  * it's impossible to implement gtk_widget_grab_focus() for a #GtkGrid (is this actually true after the Table->Grid conversion?).  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_grab_focus (GimpSizeEntry * gse)
name|gimp_size_entry_grab_focus
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|gsef
operator|=
name|priv
operator|->
name|fields
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|gsef
condition|)
name|gtk_widget_grab_focus
argument_list|(
name|priv
operator|->
name|show_refval
condition|?
name|gsef
operator|->
name|refval_spinbutton
else|:
name|gsef
operator|->
name|value_spinbutton
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_set_activates_default:  * @gse:     A #GimpSizeEntry  * @setting: %TRUE to activate window's default widget on Enter keypress  *  * Iterates over all entries in the #GimpSizeEntry and calls  * gtk_entry_set_activates_default() on them.  *  * Since: 2.4  **/
end_comment

begin_function
name|void
DECL|function|gimp_size_entry_set_activates_default (GimpSizeEntry * gse,gboolean setting)
name|gimp_size_entry_set_activates_default
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gboolean
name|setting
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|priv
operator|->
name|fields
init|;
name|list
condition|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpSizeEntryField
modifier|*
name|gsef
init|=
name|list
operator|->
name|data
decl_stmt|;
if|if
condition|(
name|gsef
operator|->
name|value_spinbutton
condition|)
name|gtk_entry_set_activates_default
argument_list|(
name|GTK_ENTRY
argument_list|(
name|gsef
operator|->
name|value_spinbutton
argument_list|)
argument_list|,
name|setting
argument_list|)
expr_stmt|;
if|if
condition|(
name|gsef
operator|->
name|refval_spinbutton
condition|)
name|gtk_entry_set_activates_default
argument_list|(
name|GTK_ENTRY
argument_list|(
name|gsef
operator|->
name|refval_spinbutton
argument_list|)
argument_list|,
name|setting
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * gimp_size_entry_get_help_widget:  * @gse: a #GimpSizeEntry  * @field: the index of the widget you want to get a pointer to  *  * You shouldn't fiddle with the internals of a #GimpSizeEntry but  * if you want to set tooltips using gimp_help_set_help_data() you  * can use this function to get a pointer to the spinbuttons.  *  * Return value: (transfer none): a #GtkWidget pointer that you can attach a tooltip to.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_size_entry_get_help_widget (GimpSizeEntry * gse,gint field)
name|gimp_size_entry_get_help_widget
parameter_list|(
name|GimpSizeEntry
modifier|*
name|gse
parameter_list|,
name|gint
name|field
parameter_list|)
block|{
name|GimpSizeEntryPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpSizeEntryField
modifier|*
name|gsef
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_SIZE_ENTRY
argument_list|(
name|gse
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|gse
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
operator|(
name|field
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|field
operator|<
name|priv
operator|->
name|number_of_fields
operator|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gsef
operator|=
name|g_slist_nth_data
argument_list|(
name|priv
operator|->
name|fields
argument_list|,
name|field
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gsef
condition|)
return|return
name|NULL
return|;
return|return
operator|(
name|gsef
operator|->
name|refval_spinbutton
condition|?
name|gsef
operator|->
name|refval_spinbutton
else|:
name|gsef
operator|->
name|value_spinbutton
operator|)
return|;
block|}
end_function

end_unit

