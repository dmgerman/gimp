begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* unit tests for the color parsing routines in gimprgb-parse.c  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<glib-object.h>
end_include

begin_include
include|#
directive|include
file|"gimpcolor.h"
end_include

begin_define
DECL|macro|DBL (c)
define|#
directive|define
name|DBL
parameter_list|(
name|c
parameter_list|)
value|((gdouble)(c) / 255.0)
end_define

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2c63438e0108
block|{
DECL|member|str
specifier|const
name|gchar
modifier|*
name|str
decl_stmt|;
DECL|member|alpha
name|gboolean
name|alpha
decl_stmt|;
DECL|member|fail
name|gboolean
name|fail
decl_stmt|;
DECL|member|r
specifier|const
name|gdouble
name|r
decl_stmt|;
DECL|member|g
specifier|const
name|gdouble
name|g
decl_stmt|;
DECL|member|b
specifier|const
name|gdouble
name|b
decl_stmt|;
DECL|member|a
specifier|const
name|gdouble
name|a
decl_stmt|;
DECL|typedef|ColorSample
block|}
name|ColorSample
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|samples
specifier|static
specifier|const
name|ColorSample
name|samples
index|[]
init|=
block|{
comment|/* sample                  alpha  fail   red       green     blue     alpha */
block|{
literal|"#000000"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"#FFff00"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|1.0
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"#6495ed"
block|,
name|FALSE
block|,
name|FALSE
block|,
name|DBL
argument_list|(
literal|100
argument_list|)
block|,
name|DBL
argument_list|(
literal|149
argument_list|)
block|,
name|DBL
argument_list|(
literal|237
argument_list|)
block|,
literal|0.0
block|}
block|,
block|{
literal|"#fff"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|1.0
block|,
literal|1.0
block|,
literal|1.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"#64649595eded"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|1.0
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"rgb(0,0,0)"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"rgb(100,149,237)"
block|,
name|FALSE
block|,
name|FALSE
block|,
name|DBL
argument_list|(
literal|100
argument_list|)
block|,
name|DBL
argument_list|(
literal|149
argument_list|)
block|,
name|DBL
argument_list|(
literal|237
argument_list|)
block|,
literal|0.0
block|}
block|,
block|{
literal|"rgba(100%,0,100%,0.5)"
block|,
name|TRUE
block|,
name|FALSE
block|,
literal|255.0
block|,
literal|0.0
block|,
literal|255.0
block|,
literal|0.5
block|}
block|,
block|{
literal|"rgba(100%,0,100%,0.5)"
block|,
name|FALSE
block|,
name|TRUE
block|,
literal|255.0
block|,
literal|0.0
block|,
literal|255.0
block|,
literal|0.5
block|}
block|,
block|{
literal|"rgb(100%,149,20%)"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|1.0
block|,
name|DBL
argument_list|(
literal|149
argument_list|)
block|,
literal|0.2
block|,
literal|0.0
block|}
block|,
block|{
literal|"rgb(100%,149,20%)"
block|,
name|TRUE
block|,
name|TRUE
block|,
literal|1.0
block|,
name|DBL
argument_list|(
literal|149
argument_list|)
block|,
literal|0.2
block|,
literal|0.0
block|}
block|,
block|{
literal|"rgb(foobar)"
block|,
name|FALSE
block|,
name|TRUE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"rgb(100,149,237"
block|,
name|FALSE
block|,
name|TRUE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"rED"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"cornflowerblue"
block|,
name|FALSE
block|,
name|FALSE
block|,
name|DBL
argument_list|(
literal|100
argument_list|)
block|,
name|DBL
argument_list|(
literal|149
argument_list|)
block|,
name|DBL
argument_list|(
literal|237
argument_list|)
block|,
literal|0.0
block|}
block|,
block|{
literal|"    red"
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"red      "
block|,
name|FALSE
block|,
name|FALSE
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"red"
block|,
name|TRUE
block|,
name|TRUE
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"red  blue"
block|,
name|FALSE
block|,
name|TRUE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"transparent"
block|,
name|FALSE
block|,
name|TRUE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"transparent"
block|,
name|TRUE
block|,
name|FALSE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|"23foobar"
block|,
name|FALSE
block|,
name|TRUE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|,
block|{
literal|""
block|,
name|FALSE
block|,
name|TRUE
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|gint
DECL|function|check_failure (const ColorSample * sample,gboolean success,GimpRGB * rgb)
name|check_failure
parameter_list|(
specifier|const
name|ColorSample
modifier|*
name|sample
parameter_list|,
name|gboolean
name|success
parameter_list|,
name|GimpRGB
modifier|*
name|rgb
parameter_list|)
block|{
if|if
condition|(
name|success
operator|&&
name|sample
operator|->
name|fail
condition|)
block|{
name|g_print
argument_list|(
literal|"Parser succeeded for sample \"%s\" but should have failed!\n"
literal|"  parsed color: (%g, %g, %g, %g)\n"
argument_list|,
name|sample
operator|->
name|str
argument_list|,
name|rgb
operator|->
name|r
argument_list|,
name|rgb
operator|->
name|g
argument_list|,
name|rgb
operator|->
name|b
argument_list|,
name|rgb
operator|->
name|a
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|success
operator|&&
operator|!
name|sample
operator|->
name|fail
condition|)
block|{
name|g_print
argument_list|(
literal|"Parser failed for sample \"%s\" but should have succeeded!\n"
literal|"  parsed color: (%g, %g, %g, %g)\n"
argument_list|,
name|sample
operator|->
name|str
argument_list|,
name|rgb
operator|->
name|r
argument_list|,
name|rgb
operator|->
name|g
argument_list|,
name|rgb
operator|->
name|b
argument_list|,
name|rgb
operator|->
name|a
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|int
DECL|function|main (void)
name|main
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|failures
init|=
literal|0
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_print
argument_list|(
literal|"\nTesting the GIMP color parser ...\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|samples
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|GimpRGB
name|rgb
init|=
block|{
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|}
decl_stmt|;
name|gboolean
name|success
decl_stmt|;
if|if
condition|(
name|samples
index|[
name|i
index|]
operator|.
name|alpha
condition|)
name|success
operator|=
name|gimp_rgba_parse_css
argument_list|(
operator|&
name|rgb
argument_list|,
name|samples
index|[
name|i
index|]
operator|.
name|str
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
else|else
name|success
operator|=
name|gimp_rgb_parse_css
argument_list|(
operator|&
name|rgb
argument_list|,
name|samples
index|[
name|i
index|]
operator|.
name|str
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|failures
operator|+=
name|check_failure
argument_list|(
name|samples
operator|+
name|i
argument_list|,
name|success
argument_list|,
operator|&
name|rgb
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|failures
condition|)
block|{
name|g_print
argument_list|(
literal|"%d out of %d samples failed!\n\n"
argument_list|,
name|failures
argument_list|,
operator|(
name|int
operator|)
name|G_N_ELEMENTS
argument_list|(
name|samples
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|EXIT_FAILURE
return|;
block|}
else|else
block|{
name|g_print
argument_list|(
literal|"All %d samples passed.\n\n"
argument_list|,
operator|(
name|int
operator|)
name|G_N_ELEMENTS
argument_list|(
name|samples
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|EXIT_SUCCESS
return|;
block|}
block|}
end_function

end_unit

