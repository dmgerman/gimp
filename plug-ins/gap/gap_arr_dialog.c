begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* gap_arr_dialog.c  * 1998.June.29 hof (Wolfgang Hofer)  *  * GAP ... Gimp Animation Plugins  *  * This is the common GTK Dialog for most of the GAP Functions.  * (it replaces the older gap_sld_dialog module)  *  * - p_array_dialog   Dialog Window with one or more rows  *                    each row can contain one of the following GAP widgets:  *                       - float pair widget  *                         (horizontal slidebar combined with a float input field)  *                       - int pair widget  *                         (horizontal slidebar combined with a int input field)  *                       - Toggle Button widget  *                       - Textentry widget  *                       - Float entry widget  *                       - Int entry widget  *  *  */
end_comment

begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* revision history:  * gimp    1.1.17b; 2000/01/26  hof: bugfix gimp_help_init  *                                   use gimp_scale_entry_new for WGT_FLT_PAIR, WGT_INT_PAIR  * gimp    1.1.17a; 2000/02/20  hof: use gimp_help_set_help_data for tooltips  * gimp    1.1.13b; 1999/12/04  hof: some cosmetic gtk fixes  *                                   changed border_width spacing and Buttons in action area  *                                   to same style as used in dialogs of the gimp 1.1.13 main dialogs  * gimp    1.1.11b; 1999/11/20  hof: some cosmetic gtk fixes:  *                                   - allow X-expansion (useful for the scale widgets)  *                                   - use a hbox on WGT_INT_PAIR and WGT_FLT_PAIR  *                                     (reduces the waste of horizontal space  *                                      when used together with other widget types in the table)  * gimp    1.1.5.1; 1999/05/08  hof: call fileselect in gtk+1.2 style   * version 0.96.03; 1998/08/15  hof: p_arr_gtk_init   * version 0.96.01; 1998/07/09  hof: Bugfix: gtk_init should be called only  *                                           once in a plugin process   * version 0.96.00; 1998/07/09  hof: 1.st release   *                                   (re-implementation of gap_sld_dialog.c)  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_comment
comment|/* GIMP includes */
end_comment

begin_include
include|#
directive|include
file|"gtk/gtk.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimp.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpui.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimp.h"
end_include

begin_comment
comment|/* private includes */
end_comment

begin_include
include|#
directive|include
file|"gap_arr_dialog.h"
end_include

begin_typedef
DECL|typedef|t_entry_cb_func
typedef|typedef
name|void
function_decl|(
modifier|*
name|t_entry_cb_func
function_decl|)
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2956c3710108
block|{
DECL|member|arr_ptr
name|t_arr_arg
modifier|*
name|arr_ptr
decl_stmt|;
DECL|member|radio_index
name|gint
name|radio_index
decl_stmt|;
DECL|typedef|t_radio_arg
block|}
name|t_radio_arg
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon2956c3710208
typedef|typedef
struct|struct
block|{
DECL|member|dlg
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
DECL|member|run
name|gint
name|run
decl_stmt|;
DECL|typedef|t_arr_interface
block|}
name|t_arr_interface
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|g_first_call
specifier|static
name|gint
name|g_first_call
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|g_arrint
specifier|static
name|t_arr_interface
name|g_arrint
init|=
block|{
name|NULL
block|,
comment|/*  dlg  */
name|FALSE
comment|/*  run  */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|gap_debug
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ==0  ... dont print debug infos */
end_comment

begin_comment
comment|/* Declare local functions.  */
end_comment

begin_function_decl
specifier|static
name|void
name|arr_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|but_array_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entry_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|,
name|t_entry_cb_func
name|entry_update_cb
parameter_list|,
name|char
modifier|*
name|init_txt
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|label_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|,
name|gfloat
name|align
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|text_entry_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|text_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|filesel_close_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|filesel_ok_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|filesel_open_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|filesel_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|int_entry_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|int_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|flt_entry_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|flt_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|toggle_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|toggle_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|radio_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_radio_arg
modifier|*
name|radio_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|radio_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|optionmenu_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|pair_int_create_value
parameter_list|(
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|gint
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|pair_flt_create_value
parameter_list|(
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|gint
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|gint
DECL|function|p_arr_gtk_init (gint flag)
name|p_arr_gtk_init
parameter_list|(
name|gint
name|flag
parameter_list|)
block|{
name|gint
name|l_prev_value
decl_stmt|;
name|l_prev_value
operator|=
name|g_first_call
expr_stmt|;
if|if
condition|(
name|flag
operator|==
name|TRUE
condition|)
name|g_first_call
operator|=
name|TRUE
expr_stmt|;
else|else
name|g_first_call
operator|=
name|FALSE
expr_stmt|;
return|return
operator|(
name|l_prev_value
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|arr_close_callback (GtkWidget * widget,gpointer data)
name|arr_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
argument_list|)
expr_stmt|;
comment|/* close& destroy dialog window */
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|but_array_callback (GtkWidget * widget,gpointer data)
name|but_array_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_arrint
operator|.
name|run
operator|=
operator|*
operator|(
operator|(
name|gint
operator|*
operator|)
name|data
operator|)
expr_stmt|;
comment|/* set returnvalue according to button */
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
argument_list|)
expr_stmt|;
comment|/* close& destroy dialog window */
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|entry_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr,t_entry_cb_func entry_update_cb,char * init_txt)
name|entry_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|,
name|t_entry_cb_func
name|entry_update_cb
parameter_list|,
name|char
modifier|*
name|init_txt
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|table
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|entry
argument_list|,
name|arr_ptr
operator|->
name|entry_width
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|init_txt
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|entry_update_cb
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|help_txt
operator|!=
name|NULL
condition|)
block|{
name|gimp_help_set_help_data
argument_list|(
name|entry
argument_list|,
name|arr_ptr
operator|->
name|help_txt
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|arr_ptr
operator|->
name|text_entry
operator|=
name|entry
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * LABEL  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|label_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr,gfloat align)
name|label_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|,
name|gfloat
name|align
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
name|align
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
if|if
condition|(
name|align
operator|!=
literal|0.5
condition|)
block|{
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|table
argument_list|,
name|hbox
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_table_attach
argument_list|(
name|table
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * FILESEL  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|filesel_close_cb (GtkWidget * widget,t_arr_arg * arr_ptr)
name|filesel_close_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|text_filesel
operator|==
name|NULL
condition|)
return|return;
comment|/* filesel is already open */
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|arr_ptr
operator|->
name|text_filesel
argument_list|)
argument_list|)
expr_stmt|;
name|arr_ptr
operator|->
name|text_filesel
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|filesel_ok_cb (GtkWidget * widget,t_arr_arg * arr_ptr)
name|filesel_ok_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|char
modifier|*
name|filename
decl_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|text_filesel
operator|==
name|NULL
condition|)
return|return;
comment|/* filesel is already open */
name|filename
operator|=
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|arr_ptr
operator|->
name|text_filesel
argument_list|)
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|arr_ptr
operator|->
name|text_buf_ret
argument_list|,
name|filename
argument_list|,
name|arr_ptr
operator|->
name|text_buf_len
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|arr_ptr
operator|->
name|text_entry
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|filesel_close_cb
argument_list|(
name|widget
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|filesel_open_cb (GtkWidget * widget,t_arr_arg * arr_ptr)
name|filesel_open_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|filesel
decl_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|text_filesel
operator|!=
name|NULL
condition|)
return|return;
comment|/* filesel is already open */
name|filesel
operator|=
name|gtk_file_selection_new
argument_list|(
name|arr_ptr
operator|->
name|label_txt
argument_list|)
expr_stmt|;
name|arr_ptr
operator|->
name|text_filesel
operator|=
name|filesel
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|filesel
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|filesel
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|filesel_ok_cb
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|filesel
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|filesel_close_cb
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
comment|/* "destroy" has to be the last signal,     * (otherwise the other callbacks are never called)    */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|filesel
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|filesel_close_cb
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
name|gtk_file_selection_set_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|filesel
argument_list|)
argument_list|,
name|arr_ptr
operator|->
name|text_buf_ret
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|filesel
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|filesel_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr)
name|filesel_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|entry_create_value
argument_list|(
name|title
argument_list|,
name|table
argument_list|,
name|row
argument_list|,
name|arr_ptr
argument_list|,
name|text_entry_update_cb
argument_list|,
name|arr_ptr
operator|->
name|text_buf_ret
argument_list|)
expr_stmt|;
name|arr_ptr
operator|->
name|text_filesel
operator|=
name|NULL
expr_stmt|;
comment|/* Button  to invoke filebrowser */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"File-Browser"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|filesel_open_cb
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * TEXT  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|text_entry_update_cb (GtkWidget * widget,t_arr_arg * arr_ptr)
name|text_entry_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
if|if
condition|(
operator|(
name|arr_ptr
operator|->
name|widget_type
operator|!=
name|WGT_TEXT
operator|)
operator|&&
operator|(
name|arr_ptr
operator|->
name|widget_type
operator|!=
name|WGT_FILESEL
operator|)
condition|)
block|{
return|return;
block|}
name|strncpy
argument_list|(
name|arr_ptr
operator|->
name|text_buf_ret
argument_list|,
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|,
name|arr_ptr
operator|->
name|text_buf_len
operator|-
literal|1
argument_list|)
expr_stmt|;
name|arr_ptr
operator|->
name|text_buf_ret
index|[
name|arr_ptr
operator|->
name|text_buf_len
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|text_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr)
name|text_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|entry_create_value
argument_list|(
name|title
argument_list|,
name|table
argument_list|,
name|row
argument_list|,
name|arr_ptr
argument_list|,
name|text_entry_update_cb
argument_list|,
name|arr_ptr
operator|->
name|text_buf_ret
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * INT  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|int_entry_update_cb (GtkWidget * widget,t_arr_arg * arr_ptr)
name|int_entry_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|widget_type
operator|!=
name|WGT_INT
condition|)
return|return;
name|arr_ptr
operator|->
name|int_ret
operator|=
name|atol
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|int_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr)
name|int_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|char
modifier|*
name|buf
decl_stmt|;
name|buf
operator|=
name|g_strdup_printf
argument_list|(
literal|"%d"
argument_list|,
name|arr_ptr
operator|->
name|int_ret
argument_list|)
expr_stmt|;
name|entry_create_value
argument_list|(
name|title
argument_list|,
name|table
argument_list|,
name|row
argument_list|,
name|arr_ptr
argument_list|,
name|int_entry_update_cb
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * FLOAT  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|flt_entry_update_cb (GtkWidget * widget,t_arr_arg * arr_ptr)
name|flt_entry_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|widget_type
operator|!=
name|WGT_FLT
condition|)
return|return;
name|arr_ptr
operator|->
name|flt_ret
operator|=
name|atof
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|flt_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr)
name|flt_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|char
modifier|*
name|buf
decl_stmt|;
name|char
modifier|*
name|fmt
decl_stmt|;
comment|/* fmt should result something like "%.2f"  */
name|fmt
operator|=
name|g_strdup_printf
argument_list|(
literal|"%%.%df"
argument_list|,
name|arr_ptr
operator|->
name|flt_digits
argument_list|)
expr_stmt|;
name|buf
operator|=
name|g_strdup_printf
argument_list|(
name|fmt
argument_list|,
name|arr_ptr
operator|->
name|flt_ret
argument_list|)
expr_stmt|;
name|entry_create_value
argument_list|(
name|title
argument_list|,
name|table
argument_list|,
name|row
argument_list|,
name|arr_ptr
argument_list|,
name|flt_entry_update_cb
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|fmt
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * TOGGLE  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|toggle_update_cb (GtkWidget * widget,t_arr_arg * arr_ptr)
name|toggle_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|widget_type
operator|!=
name|WGT_TOGGLE
condition|)
return|return;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|arr_ptr
operator|->
name|int_ret
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|arr_ptr
operator|->
name|int_ret
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|toggle_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr)
name|toggle_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|check_button
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|char
modifier|*
name|l_togg_txt
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|table
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* (make sure there is only 0 or 1) */
if|if
condition|(
name|arr_ptr
operator|->
name|int_ret
operator|!=
literal|0
condition|)
name|arr_ptr
operator|->
name|int_ret
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|togg_label
operator|==
name|NULL
condition|)
name|l_togg_txt
operator|=
literal|" "
expr_stmt|;
else|else
name|l_togg_txt
operator|=
name|arr_ptr
operator|->
name|togg_label
expr_stmt|;
comment|/* check button */
name|check_button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|l_togg_txt
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|check_button
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|check_button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|toggle_update_cb
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|check_button
argument_list|)
argument_list|,
name|arr_ptr
operator|->
name|int_ret
argument_list|)
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|help_txt
operator|!=
name|NULL
condition|)
block|{
name|gimp_help_set_help_data
argument_list|(
name|check_button
argument_list|,
name|arr_ptr
operator|->
name|help_txt
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|check_button
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * RADIO  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|radio_update_cb (GtkWidget * widget,t_radio_arg * radio_ptr)
name|radio_update_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|t_radio_arg
modifier|*
name|radio_ptr
parameter_list|)
block|{
if|if
condition|(
name|radio_ptr
operator|->
name|arr_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
operator|(
name|radio_ptr
operator|->
name|arr_ptr
operator|->
name|widget_type
operator|!=
name|WGT_RADIO
operator|)
operator|&&
operator|(
name|radio_ptr
operator|->
name|arr_ptr
operator|->
name|widget_type
operator|!=
name|WGT_OPTIONMENU
operator|)
condition|)
block|{
return|return;
block|}
name|radio_ptr
operator|->
name|arr_ptr
operator|->
name|int_ret
operator|=
name|radio_ptr
operator|->
name|radio_index
expr_stmt|;
name|radio_ptr
operator|->
name|arr_ptr
operator|->
name|radio_ret
operator|=
name|radio_ptr
operator|->
name|radio_index
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|radio_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr)
name|radio_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|radio_table
decl_stmt|;
name|GtkWidget
modifier|*
name|radio_button
decl_stmt|;
name|GSList
modifier|*
name|radio_group
init|=
name|NULL
decl_stmt|;
name|gint
name|l_idy
decl_stmt|;
name|char
modifier|*
name|l_radio_txt
decl_stmt|;
name|char
modifier|*
name|l_radio_help_txt
decl_stmt|;
name|gint
name|l_radio_pressed
decl_stmt|;
name|t_radio_arg
modifier|*
name|radio_ptr
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* radio_table */
name|radio_table
operator|=
name|gtk_table_new
argument_list|(
name|arr_ptr
operator|->
name|radio_argc
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
for|for
control|(
name|l_idy
operator|=
literal|0
init|;
name|l_idy
operator|<
name|arr_ptr
operator|->
name|radio_argc
condition|;
name|l_idy
operator|++
control|)
block|{
name|radio_ptr
operator|=
name|g_malloc0
argument_list|(
sizeof|sizeof
argument_list|(
name|t_radio_arg
argument_list|)
argument_list|)
expr_stmt|;
name|radio_ptr
operator|->
name|arr_ptr
operator|=
name|arr_ptr
expr_stmt|;
name|radio_ptr
operator|->
name|radio_index
operator|=
name|l_idy
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|radio_ret
operator|==
name|l_idy
condition|)
name|l_radio_pressed
operator|=
name|TRUE
expr_stmt|;
else|else
name|l_radio_pressed
operator|=
name|FALSE
expr_stmt|;
name|l_radio_txt
operator|=
literal|"null"
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|radio_argv
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|radio_argv
index|[
name|l_idy
index|]
operator|!=
name|NULL
condition|)
name|l_radio_txt
operator|=
name|arr_ptr
operator|->
name|radio_argv
index|[
name|l_idy
index|]
expr_stmt|;
block|}
name|l_radio_help_txt
operator|=
name|arr_ptr
operator|->
name|help_txt
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|radio_help_argv
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|radio_help_argv
index|[
name|l_idy
index|]
operator|!=
name|NULL
condition|)
name|l_radio_help_txt
operator|=
name|arr_ptr
operator|->
name|radio_help_argv
index|[
name|l_idy
index|]
expr_stmt|;
block|}
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"radio_create_value: %02d %s\n"
argument_list|,
name|l_idy
argument_list|,
name|l_radio_txt
argument_list|)
expr_stmt|;
name|radio_button
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|radio_group
argument_list|,
name|l_radio_txt
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|radio_button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|radio_table
argument_list|)
argument_list|,
name|radio_button
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|l_idy
argument_list|,
name|l_idy
operator|+
literal|1
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|radio_button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|radio_update_cb
argument_list|,
name|radio_ptr
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|radio_button
argument_list|)
argument_list|,
name|l_radio_pressed
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_radio_help_txt
operator|!=
name|NULL
condition|)
block|{
name|gimp_help_set_help_data
argument_list|(
name|radio_button
argument_list|,
name|l_radio_help_txt
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|radio_button
argument_list|)
expr_stmt|;
block|}
comment|/* attach radio_table */
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|radio_table
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|radio_table
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * OPTIONMENU  * --------------------------  */
end_comment

begin_comment
comment|/* optionmenus share callback and data structure with WGT_RADIO */
end_comment

begin_function
specifier|static
name|void
DECL|function|optionmenu_create_value (char * title,GtkTable * table,int row,t_arr_arg * arr_ptr)
name|optionmenu_create_value
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|option_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menu_item
decl_stmt|;
name|gint
name|l_idx
decl_stmt|;
name|gint
name|l_idy
decl_stmt|;
name|char
modifier|*
name|l_radio_txt
decl_stmt|;
name|gint
name|l_radio_pressed
decl_stmt|;
name|t_radio_arg
modifier|*
name|l_menu_ptr
decl_stmt|;
comment|/* label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* optionmenu */
name|option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|option_menu
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|option_menu
argument_list|)
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|help_txt
operator|!=
name|NULL
condition|)
block|{
name|gimp_help_set_help_data
argument_list|(
name|option_menu
argument_list|,
name|arr_ptr
operator|->
name|help_txt
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
comment|/* menu (filled with items in loop) */
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
comment|/* outer loop is done to ensure that the initial "pressed" value    * is the first entry in the optionmenu    */
for|for
control|(
name|l_idx
operator|=
literal|0
init|;
name|l_idx
operator|<
literal|2
condition|;
name|l_idx
operator|++
control|)
block|{
for|for
control|(
name|l_idy
operator|=
literal|0
init|;
name|l_idy
operator|<
name|arr_ptr
operator|->
name|radio_argc
condition|;
name|l_idy
operator|++
control|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|radio_ret
operator|==
name|l_idy
condition|)
name|l_radio_pressed
operator|=
name|TRUE
expr_stmt|;
else|else
name|l_radio_pressed
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|l_radio_pressed
operator|==
name|TRUE
operator|)
operator|&&
operator|(
name|l_idx
operator|==
literal|0
operator|)
operator|)
operator|||
operator|(
operator|(
name|l_radio_pressed
operator|==
name|FALSE
operator|)
operator|&&
operator|(
name|l_idx
operator|==
literal|1
operator|)
operator|)
condition|)
block|{
name|l_radio_txt
operator|=
literal|"null"
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|radio_argv
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|arr_ptr
operator|->
name|radio_argv
index|[
name|l_idy
index|]
operator|!=
name|NULL
condition|)
name|l_radio_txt
operator|=
name|arr_ptr
operator|->
name|radio_argv
index|[
name|l_idy
index|]
expr_stmt|;
block|}
name|l_menu_ptr
operator|=
name|g_malloc0
argument_list|(
sizeof|sizeof
argument_list|(
name|t_radio_arg
argument_list|)
argument_list|)
expr_stmt|;
name|l_menu_ptr
operator|->
name|radio_index
operator|=
name|l_idy
expr_stmt|;
name|l_menu_ptr
operator|->
name|arr_ptr
operator|=
name|arr_ptr
expr_stmt|;
name|menu_item
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|l_radio_txt
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menu_item
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menu_item
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|radio_update_cb
argument_list|,
name|l_menu_ptr
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menu_item
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|option_menu
argument_list|)
argument_list|,
name|menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|option_menu
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * FLT_PAIR  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|pair_flt_create_value (gchar * title,GtkTable * table,gint row,t_arr_arg * arr_ptr)
name|pair_flt_create_value
parameter_list|(
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|gint
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|gfloat
name|umin
decl_stmt|,
name|umax
decl_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|constraint
condition|)
block|{
name|umin
operator|=
name|arr_ptr
operator|->
name|flt_min
expr_stmt|;
name|umax
operator|=
name|arr_ptr
operator|->
name|flt_max
expr_stmt|;
block|}
else|else
block|{
name|umin
operator|=
name|arr_ptr
operator|->
name|umin
expr_stmt|;
name|umax
operator|=
name|arr_ptr
operator|->
name|umax
expr_stmt|;
block|}
name|adj
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
comment|/* table col, row */
name|title
argument_list|,
comment|/* label text */
name|arr_ptr
operator|->
name|scale_width
argument_list|,
comment|/* scalesize */
name|arr_ptr
operator|->
name|entry_width
argument_list|,
comment|/* entrysize */
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|flt_ret
argument_list|,
comment|/* init value */
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|flt_min
argument_list|,
comment|/* lower,  */
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|flt_max
argument_list|,
comment|/* upper */
name|arr_ptr
operator|->
name|flt_step
argument_list|,
comment|/* step */
name|arr_ptr
operator|->
name|pagestep
argument_list|,
comment|/* pagestep */
name|arr_ptr
operator|->
name|flt_digits
argument_list|,
comment|/* digits */
name|arr_ptr
operator|->
name|constraint
argument_list|,
comment|/* constrain */
name|umin
argument_list|,
name|umax
argument_list|,
comment|/* lower, upper (unconstrained) */
name|arr_ptr
operator|->
name|help_txt
argument_list|,
comment|/* tooltip */
name|NULL
argument_list|)
expr_stmt|;
comment|/* privatetip */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adj
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|arr_ptr
operator|->
name|flt_ret
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* --------------------------  * INT_PAIR  * --------------------------  */
end_comment

begin_function
specifier|static
name|void
DECL|function|pair_int_create_value (gchar * title,GtkTable * table,gint row,t_arr_arg * arr_ptr)
name|pair_int_create_value
parameter_list|(
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkTable
modifier|*
name|table
parameter_list|,
name|gint
name|row
parameter_list|,
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|)
block|{
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|gfloat
name|umin
decl_stmt|,
name|umax
decl_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|constraint
condition|)
block|{
name|umin
operator|=
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|int_min
expr_stmt|;
name|umax
operator|=
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|int_max
expr_stmt|;
block|}
else|else
block|{
name|umin
operator|=
name|arr_ptr
operator|->
name|umin
expr_stmt|;
name|umax
operator|=
name|arr_ptr
operator|->
name|umax
expr_stmt|;
block|}
name|adj
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
comment|/* table col, row */
name|title
argument_list|,
comment|/* label text */
name|arr_ptr
operator|->
name|scale_width
argument_list|,
comment|/* scalesize */
name|arr_ptr
operator|->
name|entry_width
argument_list|,
comment|/* entrysize */
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|int_ret
argument_list|,
comment|/* init value */
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|int_min
argument_list|,
comment|/* lower,  */
operator|(
name|gfloat
operator|)
name|arr_ptr
operator|->
name|int_max
argument_list|,
comment|/* upper */
name|arr_ptr
operator|->
name|int_step
argument_list|,
comment|/* step */
name|arr_ptr
operator|->
name|pagestep
argument_list|,
comment|/* pagestep */
literal|0
argument_list|,
comment|/* digits */
name|arr_ptr
operator|->
name|constraint
argument_list|,
comment|/* constrain */
name|umin
argument_list|,
name|umax
argument_list|,
comment|/* lower, upper (unconstrained) */
name|arr_ptr
operator|->
name|help_txt
argument_list|,
comment|/* tooltip */
name|NULL
argument_list|)
expr_stmt|;
comment|/* privatetip */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adj
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_int_adjustment_update
argument_list|)
argument_list|,
operator|&
name|arr_ptr
operator|->
name|int_ret
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ============================================================================  * p_array_std_dialog  *  *   GTK dialog window that has argc rows.  *   each row contains the widget(s) as defined in argv[row]  *  *   The Dialog has an Action Area with OK and CANCEL Buttons.  * ============================================================================  */
end_comment

begin_function
DECL|function|p_array_std_dialog (char * title_txt,char * frame_txt,int argc,t_arr_arg argv[],int b_argc,t_but_arg b_argv[],gint b_def_val)
name|gint
name|p_array_std_dialog
parameter_list|(
name|char
modifier|*
name|title_txt
parameter_list|,
name|char
modifier|*
name|frame_txt
parameter_list|,
name|int
name|argc
parameter_list|,
name|t_arr_arg
name|argv
index|[]
parameter_list|,
name|int
name|b_argc
parameter_list|,
name|t_but_arg
name|b_argv
index|[]
parameter_list|,
name|gint
name|b_def_val
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|hbbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|l_argsv
decl_stmt|;
name|gint
name|l_argsc
decl_stmt|;
name|gint
name|l_idx
decl_stmt|;
name|gint
name|l_ok_value
decl_stmt|;
name|char
modifier|*
name|l_label_txt
decl_stmt|;
name|t_arr_arg
modifier|*
name|arr_ptr
decl_stmt|;
name|g_arrint
operator|.
name|run
operator|=
name|b_def_val
expr_stmt|;
comment|/* prepare default retcode (if window is closed without button) */
name|l_ok_value
operator|=
literal|0
expr_stmt|;
name|table
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
operator|(
name|argc
operator|>
literal|0
operator|)
operator|&&
operator|(
name|argv
operator|==
name|NULL
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"p_array_std_dialog: calling error (widget array == NULL)\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|g_arrint
operator|.
name|run
operator|)
return|;
block|}
if|if
condition|(
operator|(
name|b_argc
operator|>
literal|0
operator|)
operator|&&
operator|(
name|b_argv
operator|==
name|NULL
operator|)
condition|)
block|{
name|printf
argument_list|(
literal|"p_array_std_dialog: calling error (button array == NULL)\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|g_arrint
operator|.
name|run
operator|)
return|;
block|}
comment|/* gtk init (only once in a plugin-process) */
if|if
condition|(
name|g_first_call
operator|==
name|TRUE
condition|)
block|{
name|l_argsc
operator|=
literal|1
expr_stmt|;
name|l_argsv
operator|=
name|g_new
argument_list|(
name|gchar
operator|*
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|l_argsv
index|[
literal|0
index|]
operator|=
name|g_strdup
argument_list|(
literal|"gap_std_dialog"
argument_list|)
expr_stmt|;
name|gtk_init
argument_list|(
operator|&
name|l_argsc
argument_list|,
operator|&
name|l_argsv
argument_list|)
expr_stmt|;
name|g_first_call
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/* Initialize Tooltips */
name|gimp_help_init
argument_list|()
expr_stmt|;
comment|/* dialog */
name|g_arrint
operator|.
name|dlg
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
argument_list|,
name|title_txt
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|arr_close_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_set_homogeneous
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|hbbox
operator|=
name|gtk_hbutton_box_new
argument_list|()
expr_stmt|;
name|gtk_button_box_set_spacing
argument_list|(
name|GTK_BUTTON_BOX
argument_list|(
name|hbbox
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|hbbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbbox
argument_list|)
expr_stmt|;
comment|/*  Action area  */
for|for
control|(
name|l_idx
operator|=
literal|0
init|;
name|l_idx
operator|<
name|b_argc
condition|;
name|l_idx
operator|++
control|)
block|{
if|if
condition|(
name|b_argv
index|[
name|l_idx
index|]
operator|.
name|but_txt
operator|==
name|NULL
condition|)
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"OK"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|b_argv
index|[
name|l_idx
index|]
operator|.
name|but_txt
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|but_array_callback
argument_list|,
operator|&
name|b_argv
index|[
name|l_idx
index|]
operator|.
name|but_val
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|b_argv
index|[
name|l_idx
index|]
operator|.
name|but_val
operator|==
name|b_def_val
condition|)
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|b_argc
operator|<
literal|1
condition|)
block|{
comment|/* if no buttons are specified use one CLOSE button per default */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Close"
argument_list|)
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|but_array_callback
argument_list|,
operator|&
name|l_ok_value
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
block|}
comment|/*  parameter settings  */
if|if
condition|(
name|frame_txt
operator|==
name|NULL
condition|)
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|_
argument_list|(
literal|"Enter Values"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|frame_txt
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|0
condition|)
block|{
comment|/* table (one row per argv) */
name|table
operator|=
name|gtk_table_new
argument_list|(
name|argc
operator|+
literal|1
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
for|for
control|(
name|l_idx
operator|=
literal|0
init|;
name|l_idx
operator|<
name|argc
condition|;
name|l_idx
operator|++
control|)
block|{
name|arr_ptr
operator|=
operator|&
name|argv
index|[
name|l_idx
index|]
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|label_txt
operator|==
name|NULL
condition|)
name|l_label_txt
operator|=
name|_
argument_list|(
literal|"Value:"
argument_list|)
expr_stmt|;
else|else
name|l_label_txt
operator|=
name|arr_ptr
operator|->
name|label_txt
expr_stmt|;
switch|switch
condition|(
name|arr_ptr
operator|->
name|widget_type
condition|)
block|{
case|case
name|WGT_FLT_PAIR
case|:
name|pair_flt_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_INT_PAIR
case|:
name|pair_int_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_TOGGLE
case|:
name|toggle_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_RADIO
case|:
name|radio_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_OPTIONMENU
case|:
name|optionmenu_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_FILESEL
case|:
name|filesel_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_TEXT
case|:
name|text_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_INT
case|:
name|int_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_FLT
case|:
name|flt_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_LABEL
case|:
name|label_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_LABEL_LEFT
case|:
name|label_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_LABEL_RIGHT
case|:
name|label_create_value
argument_list|(
name|l_label_txt
argument_list|,
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
operator|(
name|l_idx
operator|+
literal|1
operator|)
argument_list|,
name|arr_ptr
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_ACT_BUTTON
case|:
name|printf
argument_list|(
literal|"WGT_ACT_BUTTON not implemented yet, widget type ignored\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* undefined widget type */
name|printf
argument_list|(
literal|"Unknown widget type %d ignored\n"
argument_list|,
name|arr_ptr
operator|->
name|widget_type
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* end switch */
block|}
comment|/* end for */
block|}
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
if|if
condition|(
name|argc
operator|>
literal|0
condition|)
block|{
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|g_arrint
operator|.
name|dlg
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
block|{
comment|/* for debugging: print results to stdout */
for|for
control|(
name|l_idx
operator|=
literal|0
init|;
name|l_idx
operator|<
name|argc
condition|;
name|l_idx
operator|++
control|)
block|{
name|arr_ptr
operator|=
operator|&
name|argv
index|[
name|l_idx
index|]
expr_stmt|;
if|if
condition|(
name|arr_ptr
operator|->
name|label_txt
operator|==
name|NULL
condition|)
name|l_label_txt
operator|=
name|_
argument_list|(
literal|"Value: "
argument_list|)
expr_stmt|;
else|else
name|l_label_txt
operator|=
name|arr_ptr
operator|->
name|label_txt
expr_stmt|;
name|arr_ptr
operator|=
operator|&
name|argv
index|[
name|l_idx
index|]
expr_stmt|;
name|printf
argument_list|(
literal|"%02d  "
argument_list|,
name|l_idx
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|arr_ptr
operator|->
name|widget_type
condition|)
block|{
case|case
name|WGT_FLT_PAIR
case|:
case|case
name|WGT_FLT
case|:
name|printf
argument_list|(
literal|"FLT  %s : %f\n"
argument_list|,
name|l_label_txt
argument_list|,
name|arr_ptr
operator|->
name|flt_ret
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_INT_PAIR
case|:
case|case
name|WGT_INT
case|:
case|case
name|WGT_TOGGLE
case|:
name|printf
argument_list|(
literal|"INT  %s : %d\n"
argument_list|,
name|l_label_txt
argument_list|,
name|arr_ptr
operator|->
name|int_ret
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_TEXT
case|:
case|case
name|WGT_FILESEL
case|:
name|printf
argument_list|(
literal|"TEXT  %s : %s\n"
argument_list|,
name|l_label_txt
argument_list|,
name|arr_ptr
operator|->
name|text_buf_ret
argument_list|)
expr_stmt|;
break|break;
case|case
name|WGT_RADIO
case|:
case|case
name|WGT_OPTIONMENU
case|:
name|printf
argument_list|(
literal|"RADIO/OPTIONMENU  %s : %d\n"
argument_list|,
name|l_label_txt
argument_list|,
name|arr_ptr
operator|->
name|radio_ret
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
return|return
operator|(
name|g_arrint
operator|.
name|run
operator|)
return|;
block|}
end_function

begin_comment
comment|/* end p_array_dialog */
end_comment

begin_function
DECL|function|p_init_arr_arg (t_arr_arg * arr_ptr,gint widget_type)
name|void
name|p_init_arr_arg
parameter_list|(
name|t_arr_arg
modifier|*
name|arr_ptr
parameter_list|,
name|gint
name|widget_type
parameter_list|)
block|{
name|arr_ptr
operator|->
name|label_txt
operator|=
name|NULL
expr_stmt|;
name|arr_ptr
operator|->
name|help_txt
operator|=
name|NULL
expr_stmt|;
name|arr_ptr
operator|->
name|togg_label
operator|=
name|NULL
expr_stmt|;
name|arr_ptr
operator|->
name|entry_width
operator|=
literal|60
expr_stmt|;
name|arr_ptr
operator|->
name|scale_width
operator|=
literal|200
expr_stmt|;
name|arr_ptr
operator|->
name|constraint
operator|=
name|TRUE
expr_stmt|;
name|arr_ptr
operator|->
name|has_default
operator|=
name|FALSE
expr_stmt|;
name|arr_ptr
operator|->
name|text_entry
operator|=
name|NULL
expr_stmt|;
switch|switch
condition|(
name|widget_type
condition|)
block|{
case|case
name|WGT_LABEL
case|:
case|case
name|WGT_LABEL_LEFT
case|:
case|case
name|WGT_LABEL_RIGHT
case|:
name|arr_ptr
operator|->
name|widget_type
operator|=
name|widget_type
expr_stmt|;
break|break;
case|case
name|WGT_INT_PAIR
case|:
case|case
name|WGT_INT
case|:
name|arr_ptr
operator|->
name|widget_type
operator|=
name|widget_type
expr_stmt|;
name|arr_ptr
operator|->
name|umin
operator|=
operator|(
name|gfloat
operator|)
name|G_MININT
expr_stmt|;
name|arr_ptr
operator|->
name|umax
operator|=
operator|(
name|gfloat
operator|)
name|G_MAXINT
expr_stmt|;
name|arr_ptr
operator|->
name|int_min
operator|=
literal|0
expr_stmt|;
name|arr_ptr
operator|->
name|int_max
operator|=
literal|100
expr_stmt|;
name|arr_ptr
operator|->
name|int_step
operator|=
literal|1
expr_stmt|;
name|arr_ptr
operator|->
name|pagestep
operator|=
literal|10.0
expr_stmt|;
name|arr_ptr
operator|->
name|int_default
operator|=
literal|0
expr_stmt|;
name|arr_ptr
operator|->
name|int_ret
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|WGT_FLT_PAIR
case|:
case|case
name|WGT_FLT
case|:
name|arr_ptr
operator|->
name|widget_type
operator|=
name|widget_type
expr_stmt|;
name|arr_ptr
operator|->
name|flt_digits
operator|=
literal|2
expr_stmt|;
name|arr_ptr
operator|->
name|umin
operator|=
name|G_MINFLOAT
expr_stmt|;
name|arr_ptr
operator|->
name|umax
operator|=
name|G_MAXFLOAT
expr_stmt|;
name|arr_ptr
operator|->
name|flt_min
operator|=
literal|0.0
expr_stmt|;
name|arr_ptr
operator|->
name|flt_max
operator|=
literal|100.0
expr_stmt|;
name|arr_ptr
operator|->
name|flt_step
operator|=
literal|0.1
expr_stmt|;
name|arr_ptr
operator|->
name|pagestep
operator|=
literal|10.0
expr_stmt|;
name|arr_ptr
operator|->
name|flt_default
operator|=
literal|0.0
expr_stmt|;
name|arr_ptr
operator|->
name|flt_ret
operator|=
literal|0.0
expr_stmt|;
break|break;
case|case
name|WGT_TOGGLE
case|:
name|arr_ptr
operator|->
name|widget_type
operator|=
name|widget_type
expr_stmt|;
name|arr_ptr
operator|->
name|int_default
operator|=
literal|0
expr_stmt|;
name|arr_ptr
operator|->
name|int_ret
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|WGT_RADIO
case|:
case|case
name|WGT_OPTIONMENU
case|:
name|arr_ptr
operator|->
name|widget_type
operator|=
name|widget_type
expr_stmt|;
name|arr_ptr
operator|->
name|radio_argc
operator|=
literal|0
expr_stmt|;
name|arr_ptr
operator|->
name|radio_default
operator|=
literal|0
expr_stmt|;
name|arr_ptr
operator|->
name|radio_ret
operator|=
literal|0
expr_stmt|;
name|arr_ptr
operator|->
name|radio_argv
operator|=
name|NULL
expr_stmt|;
name|arr_ptr
operator|->
name|radio_help_argv
operator|=
name|NULL
expr_stmt|;
break|break;
case|case
name|WGT_TEXT
case|:
case|case
name|WGT_FILESEL
case|:
name|arr_ptr
operator|->
name|widget_type
operator|=
name|widget_type
expr_stmt|;
name|arr_ptr
operator|->
name|text_buf_len
operator|=
literal|0
expr_stmt|;
name|arr_ptr
operator|->
name|text_buf_default
operator|=
name|NULL
expr_stmt|;
name|arr_ptr
operator|->
name|text_buf_ret
operator|=
name|NULL
expr_stmt|;
name|arr_ptr
operator|->
name|text_filesel
operator|=
name|NULL
expr_stmt|;
break|break;
case|case
name|WGT_ACT_BUTTON
case|:
name|arr_ptr
operator|->
name|widget_type
operator|=
name|widget_type
expr_stmt|;
name|arr_ptr
operator|->
name|action_functon
operator|=
name|NULL
expr_stmt|;
name|arr_ptr
operator|->
name|action_data
operator|=
name|NULL
expr_stmt|;
break|break;
default|default:
comment|/* Calling error: undefined widget type */
name|arr_ptr
operator|->
name|widget_type
operator|=
name|WGT_LABEL
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/* end p_init_arr_arg */
end_comment

begin_comment
comment|/* ============================================================================  *   simplified calls of p_array_std_dialog  * ============================================================================  */
end_comment

begin_function
DECL|function|p_array_dialog (char * title_txt,char * frame_txt,int argc,t_arr_arg argv[])
name|gint
name|p_array_dialog
parameter_list|(
name|char
modifier|*
name|title_txt
parameter_list|,
name|char
modifier|*
name|frame_txt
parameter_list|,
name|int
name|argc
parameter_list|,
name|t_arr_arg
name|argv
index|[]
parameter_list|)
block|{
specifier|static
name|t_but_arg
name|b_argv
index|[
literal|2
index|]
decl_stmt|;
name|b_argv
index|[
literal|0
index|]
operator|.
name|but_txt
operator|=
name|_
argument_list|(
literal|"OK"
argument_list|)
expr_stmt|;
name|b_argv
index|[
literal|0
index|]
operator|.
name|but_val
operator|=
name|TRUE
expr_stmt|;
name|b_argv
index|[
literal|1
index|]
operator|.
name|but_txt
operator|=
name|_
argument_list|(
literal|"Cancel"
argument_list|)
expr_stmt|;
name|b_argv
index|[
literal|1
index|]
operator|.
name|but_val
operator|=
name|FALSE
expr_stmt|;
return|return
operator|(
name|p_array_std_dialog
argument_list|(
name|title_txt
argument_list|,
name|frame_txt
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|,
comment|/* widget array */
literal|2
argument_list|,
name|b_argv
argument_list|,
comment|/* button array */
name|FALSE
argument_list|)
operator|)
return|;
comment|/* ret value for window close */
block|}
end_function

begin_comment
comment|/* ============================================================================  * p_buttons_dialog  *   dialog window wit 1 upto n buttons  *   return: the value aassigned with the pressed button.  *           (If window closed by windowmanager return b_def_val)  * ============================================================================  */
end_comment

begin_function
DECL|function|p_buttons_dialog (char * title_txt,char * msg_txt,int b_argc,t_but_arg b_argv[],gint b_def_val)
name|gint
name|p_buttons_dialog
parameter_list|(
name|char
modifier|*
name|title_txt
parameter_list|,
name|char
modifier|*
name|msg_txt
parameter_list|,
name|int
name|b_argc
parameter_list|,
name|t_but_arg
name|b_argv
index|[]
parameter_list|,
name|gint
name|b_def_val
parameter_list|)
block|{
specifier|static
name|t_arr_arg
name|argv
index|[
literal|1
index|]
decl_stmt|;
name|char
modifier|*
name|frame_txt
decl_stmt|;
if|if
condition|(
name|b_argc
operator|==
literal|1
condition|)
name|frame_txt
operator|=
name|_
argument_list|(
literal|"Press Button"
argument_list|)
expr_stmt|;
else|else
name|frame_txt
operator|=
name|_
argument_list|(
literal|"Select"
argument_list|)
expr_stmt|;
name|p_init_arr_arg
argument_list|(
operator|&
name|argv
index|[
literal|0
index|]
argument_list|,
name|WGT_LABEL
argument_list|)
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|label_txt
operator|=
name|msg_txt
expr_stmt|;
return|return
operator|(
name|p_array_std_dialog
argument_list|(
name|title_txt
argument_list|,
name|frame_txt
argument_list|,
literal|1
argument_list|,
name|argv
argument_list|,
name|b_argc
argument_list|,
name|b_argv
argument_list|,
name|b_def_val
argument_list|)
operator|)
return|;
comment|/* ret value for window close */
block|}
end_function

begin_comment
comment|/* end p_buttons_dialog */
end_comment

begin_comment
comment|/* ============================================================================  * p_slider_dialog  *   simplified call of p_array_dialog, using an array with one value.  *  *   return  the value of the (only) entryfield   *          or  -1 in case of Error or cancel  * ============================================================================  */
end_comment

begin_function
DECL|function|p_slider_dialog (char * title,char * frame,char * label,char * tooltip,long min,long max,long curr,long constraint)
name|long
name|p_slider_dialog
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|char
modifier|*
name|frame
parameter_list|,
name|char
modifier|*
name|label
parameter_list|,
name|char
modifier|*
name|tooltip
parameter_list|,
name|long
name|min
parameter_list|,
name|long
name|max
parameter_list|,
name|long
name|curr
parameter_list|,
name|long
name|constraint
parameter_list|)
block|{
specifier|static
name|t_arr_arg
name|argv
index|[
literal|1
index|]
decl_stmt|;
name|p_init_arr_arg
argument_list|(
operator|&
name|argv
index|[
literal|0
index|]
argument_list|,
name|WGT_INT_PAIR
argument_list|)
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|label_txt
operator|=
name|label
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|help_txt
operator|=
name|tooltip
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|constraint
operator|=
name|constraint
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|entry_width
operator|=
literal|45
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|scale_width
operator|=
literal|130
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|int_min
operator|=
operator|(
name|gint
operator|)
name|min
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|int_max
operator|=
operator|(
name|gint
operator|)
name|max
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|int_step
operator|=
literal|1
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|.
name|int_ret
operator|=
operator|(
name|gint
operator|)
name|curr
expr_stmt|;
if|if
condition|(
name|TRUE
operator|==
name|p_array_dialog
argument_list|(
name|title
argument_list|,
name|frame
argument_list|,
literal|1
argument_list|,
name|argv
argument_list|)
condition|)
block|{
return|return
call|(
name|long
call|)
argument_list|(
name|argv
index|[
literal|0
index|]
operator|.
name|int_ret
argument_list|)
return|;
block|}
else|else
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_comment
comment|/* end p_slider_dialog */
end_comment

end_unit

