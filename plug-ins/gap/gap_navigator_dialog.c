begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* gap_navigator_dialog.c  *  by hof (Wolfgang Hofer)  *  * GAP ... Gimp Animation Plugins  *  * This Module contains the GAP Video Navigator dialog Window   * that provides a VCR-GUI for the GAP basic navigation functions.  *  */
end_comment

begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* TODO:  * - BUG  X11 deadlock if GAP Video Navigator runs another plugin  *          from the double-click callback procedure in the frame listbox,  *          and the other plugin opens a new gtk dialog.  *          (the new dialog does not get the focus)  *       Current workaround:  *          save frames of other types than xcf before the  *          listbox is filled.  *          (this forces the GAP p_decide_save_as Dialog  *           when the Navigator is opened or an image != xcf is  *           selected in the image optionmenu, and sets  *           the fileformat specific save parameters)  *           * - BUGFIX or workaround needed: list widget can't handle large lists  *          (test failed at 1093 items maybe there is a limit of 1092 ??)  *  * - start of a 2.nd navigator should pop up the 1.st one and exit.  * x- scroll the listbox (active image should always be in the visible (exposed) area  *     problem: 1092 limit !  * x- implement the unfinished callback procedures  * x- Updatde Button (to create all missing and out of date thumbnails)  * x- tooltips  * x- multiple selections  * x- timezoom and framerate should be stored in a video info file  * x- calculate& update for frame timing labels  * x- Render Preview defaultIcon for images without thumbnail  *          and for preview_size 0 (off)  *  * Events that sould be handled:  * - changes of the active_image (in ram)  :: update of one frame_widget  * x- change of preview_size :: update full frame_widgets list  * x- changes of the active_image (on disk) :: update of image_menu + full frame_widgets list  *   (maybe i'll set a polling timer event to watch the diskfile)  * x- close of the active_image (in ram)  :: update of image_menu + full frame_widgets list  *  * - drag& drop   *    (Problem: gimage struct is not available for plugins,  *                         need a Drag&Drop type that operates on image_id)  * - preferences should have additional video_preview_size  *   (tiny,small,normal,large,huge)  ?? are these values translated or not  *  */
end_comment

begin_comment
comment|/* revision history:  * version 1.1.14a; 2000.01.08   hof: 1.st release  */
end_comment

begin_decl_stmt
DECL|variable|gap_navigator_version
specifier|static
name|char
modifier|*
name|gap_navigator_version
init|=
literal|"1.1.14a; 2000/01/08"
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* SYTEM (UNIX) includes */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_comment
comment|/* GIMP includes */
end_comment

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<libgimp/stdplugins-intl.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpmenu.h>
end_include

begin_include
include|#
directive|include
file|<pixmaps/update.xpm>
end_include

begin_include
include|#
directive|include
file|<pixmaps/play.xpm>
end_include

begin_include
include|#
directive|include
file|<pixmaps/duplicate.xpm>
end_include

begin_include
include|#
directive|include
file|<pixmaps/delete.xpm>
end_include

begin_include
include|#
directive|include
file|<pixmaps/prev.xpm>
end_include

begin_include
include|#
directive|include
file|<pixmaps/next.xpm>
end_include

begin_include
include|#
directive|include
file|<pixmaps/first.xpm>
end_include

begin_include
include|#
directive|include
file|<pixmaps/last.xpm>
end_include

begin_comment
comment|/*  *  gimp_help_set_help_data is not available for plugins in libgimp 1.1.14  *  workaround:  use a copy of gimp-1.1.14/app/gimphelp.c:gimp_help_set_help_data  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_help_set_help_data
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gchar
modifier|*
name|tooltip
parameter_list|,
name|gchar
modifier|*
name|help_data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  *   OpsButton  is not available for plugins in libgimp 1.1.14  *   workaround: include gimp-1.1.14/app/ops_buttons.h /.c  */
end_comment

begin_comment
comment|/* ---------------------------------------  start copy of gimp-1.1.14/app/ops_buttons.h */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|__OPS_BUTTONS_H__
end_ifndef

begin_define
DECL|macro|__OPS_BUTTONS_H__
define|#
directive|define
name|__OPS_BUTTONS_H__
end_define

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2c67209e0103
block|{
DECL|enumerator|OPS_BUTTON_MODIFIER_NONE
name|OPS_BUTTON_MODIFIER_NONE
block|,
DECL|enumerator|OPS_BUTTON_MODIFIER_SHIFT
name|OPS_BUTTON_MODIFIER_SHIFT
block|,
DECL|enumerator|OPS_BUTTON_MODIFIER_CTRL
name|OPS_BUTTON_MODIFIER_CTRL
block|,
DECL|enumerator|OPS_BUTTON_MODIFIER_ALT
name|OPS_BUTTON_MODIFIER_ALT
block|,
DECL|enumerator|OPS_BUTTON_MODIFIER_SHIFT_CTRL
name|OPS_BUTTON_MODIFIER_SHIFT_CTRL
block|,
DECL|enumerator|OPS_BUTTON_MODIFIER_LAST
name|OPS_BUTTON_MODIFIER_LAST
DECL|typedef|OpsButtonModifier
block|}
name|OpsButtonModifier
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2c67209e0203
block|{
DECL|enumerator|OPS_BUTTON_NORMAL
name|OPS_BUTTON_NORMAL
block|,
DECL|enumerator|OPS_BUTTON_RADIO
name|OPS_BUTTON_RADIO
DECL|typedef|OpsButtonType
block|}
name|OpsButtonType
typedef|;
end_typedef

begin_typedef
DECL|typedef|OpsButton
typedef|typedef
name|struct
name|_OpsButton
name|OpsButton
typedef|;
end_typedef

begin_struct
DECL|struct|_OpsButton
struct|struct
name|_OpsButton
block|{
DECL|member|xpm_data
name|gchar
modifier|*
modifier|*
name|xpm_data
decl_stmt|;
comment|/*  xpm data for the button  */
DECL|member|callback
name|GtkSignalFunc
name|callback
decl_stmt|;
comment|/*  callback function        */
DECL|member|ext_callbacks
name|GtkSignalFunc
modifier|*
name|ext_callbacks
decl_stmt|;
comment|/*  callback functions when 				   *  modifiers are pressed    */
DECL|member|tooltip
name|gchar
modifier|*
name|tooltip
decl_stmt|;
DECL|member|private_tip
name|gchar
modifier|*
name|private_tip
decl_stmt|;
DECL|member|widget
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
comment|/*  the button widget        */
DECL|member|modifier
name|gint
name|modifier
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Function declarations */
end_comment

begin_function_decl
name|GtkWidget
modifier|*
name|ops_button_box_new
parameter_list|(
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|OpsButton
modifier|*
name|ops_button
parameter_list|,
name|OpsButtonType
name|ops_type
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __OPS_BUTTONS_H__ */
end_comment

begin_comment
comment|/* ---------------------------------------  end copy of gimp-1.1.14/app/ops_buttons.h */
end_comment

begin_comment
comment|/* GAP includes */
end_comment

begin_include
include|#
directive|include
file|"gap_lib.h"
end_include

begin_include
include|#
directive|include
file|"gap_pdb_calls.h"
end_include

begin_comment
comment|/* Note:  *  the PDB call of gimp_file_load_thumbnail has a bug in gimp-1.1.14.  *  As workaround i use a copy of gimp-1.1.14/app/fileops.c:readXVThumb  *  to read .xvpics correct directly from file (this is also the faster way)  */
end_comment

begin_function_decl
name|guchar
modifier|*
name|readXVThumb
parameter_list|(
specifier|const
name|gchar
modifier|*
name|fnam
parameter_list|,
name|gint
modifier|*
name|w
parameter_list|,
name|gint
modifier|*
name|h
parameter_list|,
name|gchar
modifier|*
modifier|*
name|imginfo
comment|/* caller frees if != NULL */
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  some definitions used in all dialogs  */
end_comment

begin_define
DECL|macro|PREVIEW_EVENT_MASK
define|#
directive|define
name|PREVIEW_EVENT_MASK
value|(GDK_EXPOSURE_MASK | GDK_BUTTON_PRESS_MASK | \                             GDK_ENTER_NOTIFY_MASK)
end_define

begin_define
DECL|macro|BUTTON_EVENT_MASK
define|#
directive|define
name|BUTTON_EVENT_MASK
value|(GDK_EXPOSURE_MASK | GDK_ENTER_NOTIFY_MASK | \                             GDK_LEAVE_NOTIFY_MASK | GDK_BUTTON_PRESS_MASK | \                             GDK_BUTTON_RELEASE_MASK)
end_define

begin_define
DECL|macro|MAX_HEIGHT_GTK_SCROLLED_WIN
define|#
directive|define
name|MAX_HEIGHT_GTK_SCROLLED_WIN
value|32767
end_define

begin_define
DECL|macro|PLUGIN_NAME
define|#
directive|define
name|PLUGIN_NAME
value|"plug_in_gap_navigator"
end_define

begin_define
DECL|macro|LIST_WIDTH
define|#
directive|define
name|LIST_WIDTH
value|200
end_define

begin_define
DECL|macro|LIST_HEIGHT
define|#
directive|define
name|LIST_HEIGHT
value|150
end_define

begin_define
DECL|macro|PREVIEW_BPP
define|#
directive|define
name|PREVIEW_BPP
value|3
end_define

begin_define
DECL|macro|THUMBNAIL_BPP
define|#
directive|define
name|THUMBNAIL_BPP
value|3
end_define

begin_define
DECL|macro|MIX_CHANNEL (b,a,m)
define|#
directive|define
name|MIX_CHANNEL
parameter_list|(
name|b
parameter_list|,
name|a
parameter_list|,
name|m
parameter_list|)
value|(((a * m) + (b * (255 - m))) / 255)
end_define

begin_define
DECL|macro|PREVIEW_BG_GRAY1
define|#
directive|define
name|PREVIEW_BG_GRAY1
value|80
end_define

begin_define
DECL|macro|PREVIEW_BG_GRAY2
define|#
directive|define
name|PREVIEW_BG_GRAY2
value|180
end_define

begin_define
DECL|macro|NUPD_IMAGE_MENU
define|#
directive|define
name|NUPD_IMAGE_MENU
value|1
end_define

begin_define
DECL|macro|NUPD_THUMBFILE_TIMESTAMP
define|#
directive|define
name|NUPD_THUMBFILE_TIMESTAMP
value|2
end_define

begin_define
DECL|macro|NUPD_FRAME_NR_CHANGED
define|#
directive|define
name|NUPD_FRAME_NR_CHANGED
value|4
end_define

begin_define
DECL|macro|NUPD_PREV_LIST
define|#
directive|define
name|NUPD_PREV_LIST
value|8
end_define

begin_define
DECL|macro|NUPD_PREV_LIST_ICONS
define|#
directive|define
name|NUPD_PREV_LIST_ICONS
value|16
end_define

begin_define
DECL|macro|NUPD_ALL
define|#
directive|define
name|NUPD_ALL
value|0xffffffff;
end_define

begin_typedef
DECL|typedef|OpenFrameImages
typedef|typedef
name|struct
name|_OpenFrameImages
name|OpenFrameImages
typedef|;
end_typedef

begin_typedef
DECL|typedef|NaviDialog
typedef|typedef
name|struct
name|_NaviDialog
name|NaviDialog
typedef|;
end_typedef

begin_typedef
DECL|typedef|FrameWidget
typedef|typedef
name|struct
name|_FrameWidget
name|FrameWidget
typedef|;
end_typedef

begin_typedef
DECL|typedef|SelectedRange
typedef|typedef
name|struct
name|_SelectedRange
name|SelectedRange
typedef|;
end_typedef

begin_struct
DECL|struct|_OpenFrameImages
struct|struct
name|_OpenFrameImages
block|{
DECL|member|image_id
name|gint32
name|image_id
decl_stmt|;
DECL|member|frame_nr
name|gint32
name|frame_nr
decl_stmt|;
DECL|member|next
name|OpenFrameImages
modifier|*
name|next
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_NaviDialog
struct|struct
name|_NaviDialog
block|{
DECL|member|tool_tips
name|GtkTooltips
modifier|*
name|tool_tips
decl_stmt|;
DECL|member|tooltip_on
name|gint
name|tooltip_on
decl_stmt|;
DECL|member|shell
name|GtkWidget
modifier|*
name|shell
decl_stmt|;
DECL|member|vbox
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
DECL|member|mode_option_menu
name|GtkWidget
modifier|*
name|mode_option_menu
decl_stmt|;
DECL|member|frame_list
name|GtkWidget
modifier|*
name|frame_list
decl_stmt|;
DECL|member|scrolled_win
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
DECL|member|preserve_trans
name|GtkWidget
modifier|*
name|preserve_trans
decl_stmt|;
DECL|member|framerate_box
name|GtkWidget
modifier|*
name|framerate_box
decl_stmt|;
DECL|member|timezoom_box
name|GtkWidget
modifier|*
name|timezoom_box
decl_stmt|;
DECL|member|image_option_menu
name|GtkWidget
modifier|*
name|image_option_menu
decl_stmt|;
DECL|member|image_menu
name|GtkWidget
modifier|*
name|image_menu
decl_stmt|;
DECL|member|accel_group
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
DECL|member|framerate_data
name|GtkAdjustment
modifier|*
name|framerate_data
decl_stmt|;
DECL|member|timezoom_data
name|GtkAdjustment
modifier|*
name|timezoom_data
decl_stmt|;
DECL|member|frame_preview
name|GtkWidget
modifier|*
name|frame_preview
decl_stmt|;
DECL|member|framerange_number_label
name|GtkWidget
modifier|*
name|framerange_number_label
decl_stmt|;
DECL|member|waiting_cursor
name|gint
name|waiting_cursor
decl_stmt|;
DECL|member|cursor_wait
name|GdkCursor
modifier|*
name|cursor_wait
decl_stmt|;
DECL|member|cursor_acitve
name|GdkCursor
modifier|*
name|cursor_acitve
decl_stmt|;
DECL|member|ratio
name|gdouble
name|ratio
decl_stmt|;
DECL|member|preview_size
name|gdouble
name|preview_size
decl_stmt|;
DECL|member|image_width
DECL|member|image_height
name|gint
name|image_width
decl_stmt|,
name|image_height
decl_stmt|;
DECL|member|gimage_width
DECL|member|gimage_height
name|gint
name|gimage_width
decl_stmt|,
name|gimage_height
decl_stmt|;
comment|/* state information  */
DECL|member|active_imageid
name|gint32
name|active_imageid
decl_stmt|;
DECL|member|any_imageid
name|gint32
name|any_imageid
decl_stmt|;
DECL|member|ainfo_ptr
name|t_anim_info
modifier|*
name|ainfo_ptr
decl_stmt|;
DECL|member|vin_ptr
name|t_video_info
modifier|*
name|vin_ptr
decl_stmt|;
DECL|member|frame_widgets
name|GSList
modifier|*
name|frame_widgets
decl_stmt|;
DECL|member|timer
name|int
name|timer
decl_stmt|;
DECL|member|cycle_time
name|int
name|cycle_time
decl_stmt|;
DECL|member|OpenFrameImagesList
name|OpenFrameImages
modifier|*
name|OpenFrameImagesList
decl_stmt|;
DECL|member|OpenFrameImagesCount
name|int
name|OpenFrameImagesCount
decl_stmt|;
DECL|member|item_height
name|gint32
name|item_height
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_FrameWidget
struct|struct
name|_FrameWidget
block|{
DECL|member|clip_widget
name|GtkWidget
modifier|*
name|clip_widget
decl_stmt|;
DECL|member|number_label
name|GtkWidget
modifier|*
name|number_label
decl_stmt|;
DECL|member|time_label
name|GtkWidget
modifier|*
name|time_label
decl_stmt|;
DECL|member|frame_preview
name|GtkWidget
modifier|*
name|frame_preview
decl_stmt|;
DECL|member|list_item
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
DECL|member|label
name|GtkWidget
modifier|*
name|label
decl_stmt|;
DECL|member|image_id
name|gint32
name|image_id
decl_stmt|;
DECL|member|frame_nr
name|gint32
name|frame_nr
decl_stmt|;
DECL|member|frame_pixmap
name|GdkPixmap
modifier|*
name|frame_pixmap
decl_stmt|;
DECL|member|width
DECL|member|height
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
comment|/*  state information  */
DECL|member|visited
name|gboolean
name|visited
decl_stmt|;
DECL|member|thumb_timestamp
name|time_t
name|thumb_timestamp
decl_stmt|;
DECL|member|thumb_filename
name|char
modifier|*
name|thumb_filename
decl_stmt|;
comment|/* GimpDropType drop_type; */
block|}
struct|;
end_struct

begin_struct
DECL|struct|_SelectedRange
struct|struct
name|_SelectedRange
block|{
DECL|member|from
name|gint32
name|from
decl_stmt|;
DECL|member|to
name|gint32
name|to
decl_stmt|;
DECL|member|next
name|SelectedRange
modifier|*
name|next
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* -----------------------  * procedure declarations  * -----------------------  */
end_comment

begin_function_decl
name|int
name|gap_navigator
parameter_list|(
name|gint32
name|image_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_preview_extents
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|frames_dialog_flush
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|frames_dialog_update
parameter_list|(
name|gint32
name|image_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|frame_widget_preview_redraw
parameter_list|(
name|FrameWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|navi_images_menu_constrain
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|drawable_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_images_menu_callback
parameter_list|(
name|gint32
name|id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_thumb_update_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_thumb_updateall_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_play_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_play_optim_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_frames_duplicate_frame_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_frames_delete_frame_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_goto_first_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_goto_prev_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_goto_prevblock_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_goto_next_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_goto_nextblock_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_vcr_goto_last_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_framerate_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_timezoom_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|frame_list_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|frame_widget_select_update
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|frame_widget_button_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|frame_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|navi_dialog_poll
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_update
parameter_list|(
name|gint32
name|update_flag
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_scroll_to_current_frame_nr
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|FrameWidget
modifier|*
name|frame_widget_create
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|frame_nr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|frame_widget_delete
parameter_list|(
name|FrameWidget
modifier|*
name|fw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|navi_get_preview_size
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|frames_timing_update
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|frame_widget_time_label_update
parameter_list|(
name|FrameWidget
modifier|*
name|fw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_dialog_tooltips
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_set_waiting_cursor
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|navi_set_active_cursor
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* -----------------------  * Local data   * -----------------------  */
end_comment

begin_decl_stmt
DECL|variable|naviD
specifier|static
name|NaviDialog
modifier|*
name|naviD
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|suspend_gimage_notify
specifier|static
name|gint
name|suspend_gimage_notify
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|global_old_active_imageid
specifier|static
name|gint32
name|global_old_active_imageid
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  the ops buttons  */
end_comment

begin_decl_stmt
DECL|variable|navi_dialog_update_ext_callbacks
specifier|static
name|GtkSignalFunc
name|navi_dialog_update_ext_callbacks
index|[]
init|=
block|{
name|navi_dialog_thumb_updateall_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|navi_dialog_vcr_play_ext_callbacks
specifier|static
name|GtkSignalFunc
name|navi_dialog_vcr_play_ext_callbacks
index|[]
init|=
block|{
name|navi_dialog_vcr_play_optim_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|navi_dialog_vcr_goto_prev_ext_callbacks
specifier|static
name|GtkSignalFunc
name|navi_dialog_vcr_goto_prev_ext_callbacks
index|[]
init|=
block|{
name|navi_dialog_vcr_goto_prevblock_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|navi_dialog_vcr_goto_next_ext_callbacks
specifier|static
name|GtkSignalFunc
name|navi_dialog_vcr_goto_next_ext_callbacks
index|[]
init|=
block|{
name|navi_dialog_vcr_goto_nextblock_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|frames_ops_buttons
specifier|static
name|OpsButton
name|frames_ops_buttons
index|[]
init|=
block|{
block|{
name|play_xpm
block|,
name|navi_dialog_vcr_play_callback
block|,
name|navi_dialog_vcr_play_ext_callbacks
block|,
name|N_
argument_list|(
literal|"Playback         \n"
literal|"<Shift> optimized"
argument_list|)
block|,
literal|"video/frames/play_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|update_xpm
block|,
name|navi_dialog_thumb_update_callback
block|,
name|navi_dialog_update_ext_callbacks
block|,
name|N_
argument_list|(
literal|"Smart Update .xvpics\n"
literal|"<Shift> forced upd"
argument_list|)
block|,
literal|"video/frames/play_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|duplicate_xpm
block|,
name|navi_dialog_frames_duplicate_frame_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Duplicate selected Frames"
argument_list|)
block|,
literal|"video/frames/duplicate_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|delete_xpm
block|,
name|navi_dialog_frames_delete_frame_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Delete selected Frames"
argument_list|)
block|,
literal|"video/frames/delete_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|vcr_ops_buttons
specifier|static
name|OpsButton
name|vcr_ops_buttons
index|[]
init|=
block|{
block|{
name|first_xpm
block|,
name|navi_dialog_vcr_goto_first_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Goto 1.st Frame"
argument_list|)
block|,
literal|"video/frames/goto_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|prev_xpm
block|,
name|navi_dialog_vcr_goto_prev_callback
block|,
name|navi_dialog_vcr_goto_prev_ext_callbacks
block|,
name|N_
argument_list|(
literal|"Goto prev Frame\n"
literal|"<Shift> use timezoom stepsize"
argument_list|)
block|,
literal|"video/frames/goto_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|next_xpm
block|,
name|navi_dialog_vcr_goto_next_callback
block|,
name|navi_dialog_vcr_goto_next_ext_callbacks
block|,
name|N_
argument_list|(
literal|"Goto next Frame\n"
literal|"<Shift> use timezoom stepsize"
argument_list|)
block|,
literal|"video/frames/goto_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|last_xpm
block|,
name|navi_dialog_vcr_goto_last_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Goto last Frame"
argument_list|)
block|,
literal|"video/frames/goto_frame.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ------------------------  * gap DEBUG switch  * ------------------------  */
end_comment

begin_comment
comment|/* int gap_debug = 1; */
end_comment

begin_comment
comment|/* print debug infos */
end_comment

begin_comment
comment|/* int gap_debug = 0; */
end_comment

begin_comment
comment|/* 0: dont print debug infos */
end_comment

begin_decl_stmt
DECL|variable|gap_debug
name|int
name|gap_debug
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nparam
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|int
modifier|*
name|nretvals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|retvals
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc */
name|NULL
block|,
comment|/* quit_proc */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* ------------------------  * MAIN, query& run  * ------------------------  */
end_comment

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|()
block|{
specifier|static
name|GParamDef
name|args_navigator
index|[]
init|=
block|{
block|{
name|PARAM_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive"
block|}
block|,
block|{
name|PARAM_IMAGE
block|,
literal|"image"
block|,
literal|"(unused)"
block|}
block|,
block|{
name|PARAM_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"(unused)"
block|}
block|,   }
decl_stmt|;
specifier|static
name|int
name|nargs_navigator
init|=
sizeof|sizeof
argument_list|(
name|args_navigator
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args_navigator
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
specifier|static
name|GParamDef
modifier|*
name|return_vals
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|nreturn_vals
init|=
literal|0
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|PLUGIN_NAME
argument_list|,
name|_
argument_list|(
literal|"GAP video navigator dialog"
argument_list|)
argument_list|,
literal|""
argument_list|,
literal|"Wolfgang Hofer (hof@hotbot.com)"
argument_list|,
literal|"Wolfgang Hofer"
argument_list|,
name|gap_navigator_version
argument_list|,
name|N_
argument_list|(
literal|"<Image>/Video/VCR Navigator..."
argument_list|)
argument_list|,
literal|"RGB*, INDEXED*, GRAY*"
argument_list|,
name|PROC_PLUG_IN
argument_list|,
name|nargs_navigator
argument_list|,
name|nreturn_vals
argument_list|,
name|args_navigator
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* end query */
end_comment

begin_function
specifier|static
name|void
DECL|function|run (char * name,int n_params,GParam * param,int * nreturn_vals,GParam ** return_vals)
name|run
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|n_params
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|int
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
name|gint32
name|l_active_image
decl_stmt|;
name|char
modifier|*
name|l_env
decl_stmt|;
specifier|static
name|GParam
name|values
index|[
literal|2
index|]
decl_stmt|;
name|GRunModeType
name|run_mode
decl_stmt|;
name|GStatusType
name|status
init|=
name|STATUS_SUCCESS
decl_stmt|;
name|gint32
name|nr
decl_stmt|;
name|pid_t
name|l_navid_pid
decl_stmt|;
name|gint32
name|l_rc
decl_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|nr
operator|=
literal|0
expr_stmt|;
name|l_rc
operator|=
literal|0
expr_stmt|;
name|l_env
operator|=
name|g_getenv
argument_list|(
literal|"GAP_DEBUG"
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_env
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|l_env
operator|!=
literal|'n'
operator|)
operator|&&
operator|(
operator|*
name|l_env
operator|!=
literal|'N'
operator|)
condition|)
name|gap_debug
operator|=
literal|1
expr_stmt|;
block|}
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|l_active_image
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"\n\ngap_navigator: debug name = %s\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|l_active_image
operator|=
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
expr_stmt|;
if|if
condition|(
name|run_mode
operator|==
name|RUN_NONINTERACTIVE
condition|)
block|{
name|INIT_I18N
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|INIT_I18N_UI
argument_list|()
expr_stmt|;
block|}
comment|/* check for other Video navigator Dialog Process */
if|if
condition|(
sizeof|sizeof
argument_list|(
name|pid_t
argument_list|)
operator|==
name|gimp_get_data_size
argument_list|(
name|PLUGIN_NAME
argument_list|)
condition|)
block|{
name|gimp_get_data
argument_list|(
name|PLUGIN_NAME
argument_list|,
operator|&
name|l_navid_pid
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_navid_pid
operator|!=
literal|0
condition|)
block|{
comment|/* kill  with signal 0 checks only if the process is alive (no signal is sent)         *       returns 0 if alive, 1 if no process with given pid found.         */
if|if
condition|(
literal|0
operator|==
name|kill
argument_list|(
name|l_navid_pid
argument_list|,
literal|0
argument_list|)
condition|)
block|{
name|p_msg_win
argument_list|(
name|RUN_INTERACTIVE
argument_list|,
literal|"Cant open 2 or more Video Navigator Windows"
argument_list|)
expr_stmt|;
name|l_rc
operator|=
operator|-
literal|1
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|l_rc
operator|==
literal|0
condition|)
block|{
comment|/* set pid data when navigator is running */
name|l_navid_pid
operator|=
name|getpid
argument_list|()
expr_stmt|;
name|gimp_set_data
argument_list|(
name|PLUGIN_NAME
argument_list|,
operator|&
name|l_navid_pid
argument_list|,
sizeof|sizeof
argument_list|(
name|pid_t
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|PLUGIN_NAME
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|run_mode
operator|!=
name|RUN_INTERACTIVE
condition|)
block|{
name|status
operator|=
name|STATUS_CALLING_ERROR
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|l_rc
operator|=
name|gap_navigator
argument_list|(
name|l_active_image
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* set pid data to 0 when navigator stops */
name|l_navid_pid
operator|=
literal|0
expr_stmt|;
name|gimp_set_data
argument_list|(
name|PLUGIN_NAME
argument_list|,
operator|&
name|l_navid_pid
argument_list|,
sizeof|sizeof
argument_list|(
name|pid_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* ---------- return handling --------- */
if|if
condition|(
name|l_rc
operator|<
literal|0
condition|)
block|{
name|status
operator|=
name|STATUS_EXECUTION_ERROR
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ---------------------------------  * the navigator callback procedures  * ---------------------------------  */
end_comment

begin_function
specifier|static
name|gint32
DECL|function|navi_get_preview_size (void)
name|navi_get_preview_size
parameter_list|(
name|void
parameter_list|)
block|{
name|char
modifier|*
name|value_string
decl_stmt|;
name|gint32
name|preview_size
decl_stmt|;
name|preview_size
operator|=
literal|32
expr_stmt|;
comment|/* default preview size if nothing is configured */
name|value_string
operator|=
name|p_gimp_gimprc_query
argument_list|(
literal|"video-preview-size"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value_string
operator|==
name|NULL
condition|)
block|{
name|value_string
operator|=
name|p_gimp_gimprc_query
argument_list|(
literal|"preview-size"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|value_string
condition|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_get_preview_size value_str:%s:\n"
argument_list|,
name|value_string
argument_list|)
expr_stmt|;
comment|/* hof: I don't know if the value_string in the preferences       *      is translated to other languages or not      *      and how to handle the value from a plugin      * This version assumes translated values      */
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
literal|"tiny"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|24
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
literal|"small"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|32
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
literal|"medium"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|48
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
literal|"large"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|64
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
literal|"huge"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|128
expr_stmt|;
comment|/* hof: I don't know if the value_string in the preferences       *      is translated to other languages or not.      * so i did check for the translated values too,      * that may work for most Languages.      */
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
name|_
argument_list|(
literal|"none"
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
name|_
argument_list|(
literal|"tiny"
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|24
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
name|_
argument_list|(
literal|"small"
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|32
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
name|_
argument_list|(
literal|"medium"
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|48
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
name|_
argument_list|(
literal|"large"
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|64
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
name|_
argument_list|(
literal|"huge"
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|128
expr_stmt|;
else|else
block|{
name|preview_size
operator|=
name|atol
argument_list|(
name|value_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|preview_size
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Warning: preview-size or video-preview-size could not be detected\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  because the configured value %s\n"
argument_list|,
name|value_string
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  does not match with the current translations of\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"  %s %s %s %s %s %s\n"
argument_list|,
name|_
argument_list|(
literal|"none"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"tiny"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"small"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"medium"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"large"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"huge"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|g_free
argument_list|(
name|value_string
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_get_preview_size value_str is NULL\n"
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|preview_size
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|navi_check_exist_first_and_last (t_anim_info * ainfo_ptr)
name|navi_check_exist_first_and_last
parameter_list|(
name|t_anim_info
modifier|*
name|ainfo_ptr
parameter_list|)
block|{
name|char
modifier|*
name|l_fname
decl_stmt|;
name|l_fname
operator|=
name|p_alloc_fname
argument_list|(
name|ainfo_ptr
operator|->
name|basename
argument_list|,
name|ainfo_ptr
operator|->
name|last_frame_nr
argument_list|,
name|ainfo_ptr
operator|->
name|extension
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_file_exists
argument_list|(
name|l_fname
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
name|l_fname
operator|=
name|p_alloc_fname
argument_list|(
name|ainfo_ptr
operator|->
name|basename
argument_list|,
name|ainfo_ptr
operator|->
name|first_frame_nr
argument_list|,
name|ainfo_ptr
operator|->
name|extension
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|p_file_exists
argument_list|(
name|l_fname
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
name|l_fname
operator|=
name|p_alloc_fname
argument_list|(
name|ainfo_ptr
operator|->
name|basename
argument_list|,
name|ainfo_ptr
operator|->
name|last_frame_nr
operator|+
literal|1
argument_list|,
name|ainfo_ptr
operator|->
name|extension
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_file_exists
argument_list|(
name|l_fname
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
name|l_fname
operator|=
name|p_alloc_fname
argument_list|(
name|ainfo_ptr
operator|->
name|basename
argument_list|,
name|ainfo_ptr
operator|->
name|first_frame_nr
operator|-
literal|1
argument_list|,
name|ainfo_ptr
operator|->
name|extension
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_file_exists
argument_list|(
name|l_fname
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
name|g_free
argument_list|(
name|l_fname
argument_list|)
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_function
name|t_anim_info
modifier|*
DECL|function|navi_get_ainfo (gint32 image_id,t_anim_info * old_ainfo_ptr)
name|navi_get_ainfo
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|t_anim_info
modifier|*
name|old_ainfo_ptr
parameter_list|)
block|{
name|t_anim_info
modifier|*
name|ainfo_ptr
decl_stmt|;
name|ainfo_ptr
operator|=
name|p_alloc_ainfo
argument_list|(
name|image_id
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|)
expr_stmt|;
if|if
condition|(
name|ainfo_ptr
condition|)
block|{
if|if
condition|(
name|old_ainfo_ptr
condition|)
block|{
if|if
condition|(
operator|(
name|old_ainfo_ptr
operator|->
name|image_id
operator|==
name|image_id
operator|)
operator|&&
operator|(
name|strcmp
argument_list|(
name|old_ainfo_ptr
operator|->
name|basename
argument_list|,
name|ainfo_ptr
operator|->
name|basename
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|navi_check_exist_first_and_last
argument_list|(
name|old_ainfo_ptr
argument_list|)
condition|)
block|{
comment|/* - image_id and name have not changed, 	       * - first and last frame still exist 	       *   and are still first and last frame 	       * In that case we can reuse first and last frame_nr 	       * without scanning the directory for frames 	       */
name|ainfo_ptr
operator|->
name|first_frame_nr
operator|=
name|old_ainfo_ptr
operator|->
name|first_frame_nr
expr_stmt|;
name|ainfo_ptr
operator|->
name|last_frame_nr
operator|=
name|old_ainfo_ptr
operator|->
name|last_frame_nr
expr_stmt|;
name|ainfo_ptr
operator|->
name|frame_cnt
operator|=
name|old_ainfo_ptr
operator|->
name|frame_cnt
expr_stmt|;
return|return
operator|(
name|ainfo_ptr
operator|)
return|;
block|}
block|}
block|}
name|p_dir_ainfo
argument_list|(
name|ainfo_ptr
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|ainfo_ptr
operator|)
return|;
block|}
end_function

begin_function
DECL|function|navi_reload_ainfo_force (gint32 image_id)
name|void
name|navi_reload_ainfo_force
parameter_list|(
name|gint32
name|image_id
parameter_list|)
block|{
name|t_anim_info
modifier|*
name|old_ainfo_ptr
decl_stmt|;
name|char
name|frame_nr_to_char
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_reload_ainfo_force image_id:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|image_id
argument_list|)
expr_stmt|;
name|old_ainfo_ptr
operator|=
name|naviD
operator|->
name|ainfo_ptr
expr_stmt|;
name|naviD
operator|->
name|active_imageid
operator|=
name|image_id
expr_stmt|;
name|naviD
operator|->
name|ainfo_ptr
operator|=
name|navi_get_ainfo
argument_list|(
name|image_id
argument_list|,
name|old_ainfo_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|strcmp
argument_list|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|extension
argument_list|,
literal|".xcf"
argument_list|)
operator|!=
literal|0
operator|)
operator|&&
operator|(
name|strcmp
argument_list|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|extension
argument_list|,
literal|".xcfgz"
argument_list|)
operator|!=
literal|0
operator|)
operator|&&
operator|(
name|global_old_active_imageid
operator|!=
name|image_id
operator|)
condition|)
block|{
comment|/* for other frameformats than xcf       * save the frame a 1.st time (to set filetype specific save paramters)       * this also is a workaround for a BUG that causes an X11 deadlock       * when the save dialog pops up from the double-click callback in the frames listbox       */
name|suspend_gimage_notify
operator|++
expr_stmt|;
name|p_save_named_frame
argument_list|(
name|image_id
argument_list|,
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|old_filename
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
name|global_old_active_imageid
operator|=
name|image_id
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|framerange_number_label
condition|)
block|{
name|sprintf
argument_list|(
name|frame_nr_to_char
argument_list|,
literal|"%04d - %04d"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|naviD
operator|->
name|framerange_number_label
argument_list|)
argument_list|,
name|frame_nr_to_char
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|old_ainfo_ptr
condition|)
name|p_free_ainfo
argument_list|(
operator|&
name|old_ainfo_ptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_reload_ainfo (gint32 image_id)
name|void
name|navi_reload_ainfo
parameter_list|(
name|gint32
name|image_id
parameter_list|)
block|{
if|if
condition|(
name|image_id
operator|<
literal|0
condition|)
name|navi_reload_ainfo_force
argument_list|(
name|naviD
operator|->
name|any_imageid
argument_list|)
expr_stmt|;
else|else
name|navi_reload_ainfo_force
argument_list|(
name|image_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
condition|)
block|{
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
condition|)
name|g_free
argument_list|(
name|naviD
operator|->
name|vin_ptr
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|vin_ptr
operator|=
name|p_get_video_info
argument_list|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|basename
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|naviD
operator|->
name|framerate_data
argument_list|,
operator|(
name|gfloat
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|naviD
operator|->
name|timezoom_data
argument_list|,
operator|(
name|gfloat
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|navi_images_menu_constrain (gint32 image_id,gint32 drawable_id,gpointer data)
name|navi_images_menu_constrain
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|drawable_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_images_menu_constrain PROCEDURE imageID:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|image_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|p_get_frame_nr
argument_list|(
name|image_id
argument_list|)
operator|<
literal|0
condition|)
block|{
return|return
operator|(
name|FALSE
operator|)
return|;
comment|/* reject images without frame number */
block|}
if|if
condition|(
name|naviD
condition|)
block|{
if|if
condition|(
name|naviD
operator|->
name|active_imageid
operator|<
literal|0
condition|)
block|{
comment|/* if there is no valid active_imageid        * we nominate the first one that comes along        */
name|naviD
operator|->
name|any_imageid
operator|=
name|image_id
expr_stmt|;
block|}
block|}
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
end_function

begin_comment
comment|/* end  navi_images_menu_constrain */
end_comment

begin_function
specifier|static
name|void
DECL|function|navi_images_menu_callback (gint32 image_id,gpointer data)
name|navi_images_menu_callback
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_images_menu_callback PROCEDURE imageID:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|image_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
condition|)
block|{
if|if
condition|(
name|naviD
operator|->
name|active_imageid
operator|!=
name|image_id
condition|)
block|{
name|navi_reload_ainfo
argument_list|(
name|image_id
argument_list|)
expr_stmt|;
name|navi_dialog_update
argument_list|(
name|NUPD_FRAME_NR_CHANGED
operator||
name|NUPD_PREV_LIST
argument_list|)
expr_stmt|;
name|navi_scroll_to_current_frame_nr
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_cancel_callback (GtkWidget * widget,gpointer client_data)
name|navi_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|navi_delete_callback (GtkWidget * widget,GdkEvent * e,gpointer data)
name|navi_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|e
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|navi_cancel_callback
argument_list|(
name|widget
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navid_update_exposed_previews (void)
name|navid_update_exposed_previews
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
comment|/* I've tried  to send an "expose_event"  to frame_preview widgets    * using gtk_signal_emit_by_name , but it did not work.    * So i decided to use the trick widget_hide and widget_show    * to force gtk to (re)expose the widgets in the listbox     * That way all visible items in the listbox are refreshed (redraw)    */
name|gtk_widget_hide
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_set_waiting_cursor (void)
name|navi_set_waiting_cursor
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|waiting_cursor
condition|)
return|return;
name|naviD
operator|->
name|waiting_cursor
operator|=
name|TRUE
expr_stmt|;
name|gdk_window_set_cursor
argument_list|(
name|GTK_WIDGET
argument_list|(
name|naviD
operator|->
name|shell
argument_list|)
operator|->
name|window
argument_list|,
name|naviD
operator|->
name|cursor_wait
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_set_active_cursor (void)
name|navi_set_active_cursor
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
operator|!
name|naviD
operator|->
name|waiting_cursor
condition|)
return|return;
name|naviD
operator|->
name|waiting_cursor
operator|=
name|FALSE
expr_stmt|;
name|gdk_window_set_cursor
argument_list|(
name|GTK_WIDGET
argument_list|(
name|naviD
operator|->
name|shell
argument_list|)
operator|->
name|window
argument_list|,
name|naviD
operator|->
name|cursor_acitve
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_scroll_to_current_frame_nr (void)
name|navi_scroll_to_current_frame_nr
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gfloat
name|adj_val
decl_stmt|;
name|gint
name|index
decl_stmt|;
name|gint
name|page_size
decl_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|scrolled_win
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_scroll_to_current_frame_nr: BEGIN timezoom:%d, item_height:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|item_height
argument_list|)
expr_stmt|;
name|adj
operator|=
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
argument_list|)
expr_stmt|;
name|adj_val
operator|=
name|adj
operator|->
name|value
expr_stmt|;
name|page_size
operator|=
name|MAX
argument_list|(
name|adj
operator|->
name|page_size
argument_list|,
name|naviD
operator|->
name|item_height
argument_list|)
expr_stmt|;
name|index
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
condition|)
block|{
name|index
operator|=
operator|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|curr_frame_nr
operator|-
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
operator|)
operator|/
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
expr_stmt|;
block|}
if|if
condition|(
name|index
operator|*
name|naviD
operator|->
name|item_height
operator|<
name|adj
operator|->
name|value
condition|)
block|{
name|adj_val
operator|=
name|index
operator|*
name|naviD
operator|->
name|item_height
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|index
operator|+
literal|1
operator|)
operator|*
name|naviD
operator|->
name|item_height
operator|>
name|adj
operator|->
name|value
operator|+
name|page_size
condition|)
block|{
name|adj_val
operator|=
operator|(
name|index
operator|+
literal|1
operator|)
operator|*
name|naviD
operator|->
name|item_height
operator|-
name|page_size
expr_stmt|;
block|}
if|if
condition|(
name|adj_val
operator|>
name|MAX_HEIGHT_GTK_SCROLLED_WIN
operator|-
name|page_size
condition|)
block|{
name|adj_val
operator|=
name|MAX_HEIGHT_GTK_SCROLLED_WIN
operator|-
name|page_size
expr_stmt|;
block|}
if|if
condition|(
name|adj_val
operator|!=
name|adj
operator|->
name|value
condition|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_scroll_to_current_frame_nr: OLD: %d  should be set to adj_val: %d  index:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|adj
operator|->
name|value
argument_list|,
operator|(
name|int
operator|)
name|adj_val
argument_list|,
operator|(
name|int
operator|)
name|index
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_scroll_to_current_frame_nr: adj->lower :%d adj->upper :%d\n"
argument_list|,
operator|(
name|int
operator|)
name|adj
operator|->
name|lower
argument_list|,
operator|(
name|int
operator|)
name|adj
operator|->
name|upper
argument_list|)
expr_stmt|;
comment|/* gtk_adjustment_set_value(adj, adj_val); */
name|adj
operator|->
name|value
operator|=
name|adj_val
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|adj
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_scroll_to_current_frame_nr: NEW : %d should be equal to adj_val: %d adj->page_size:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|adj
operator|->
name|value
argument_list|,
operator|(
name|int
operator|)
name|adj_val
argument_list|,
operator|(
name|int
operator|)
name|adj
operator|->
name|page_size
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_dialog_tooltips (void)
name|navi_dialog_tooltips
parameter_list|(
name|void
parameter_list|)
block|{
name|char
modifier|*
name|value_string
decl_stmt|;
name|gint
name|tooltip_on
decl_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|tool_tips
operator|==
name|NULL
condition|)
return|return;
name|tooltip_on
operator|=
name|TRUE
expr_stmt|;
name|value_string
operator|=
name|p_gimp_gimprc_query
argument_list|(
literal|"show-tool-tips"
argument_list|)
expr_stmt|;
if|if
condition|(
name|value_string
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|value_string
argument_list|,
literal|"no"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tooltip_on
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|naviD
operator|->
name|tooltip_on
operator|!=
name|tooltip_on
condition|)
block|{
name|naviD
operator|->
name|tooltip_on
operator|=
name|tooltip_on
expr_stmt|;
if|if
condition|(
name|tooltip_on
condition|)
block|{
name|gtk_tooltips_enable
argument_list|(
name|naviD
operator|->
name|tool_tips
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_tooltips_disable
argument_list|(
name|naviD
operator|->
name|tool_tips
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
DECL|function|gimp_help_set_help_data (GtkWidget * widget,gchar * tooltip,gchar * help_data)
specifier|static
name|void
name|gimp_help_set_help_data
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gchar
modifier|*
name|tooltip
parameter_list|,
name|gchar
modifier|*
name|help_data
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|widget
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GTK_IS_WIDGET
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|naviD
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|naviD
operator|->
name|tool_tips
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|tooltip
condition|)
block|{
name|gtk_tooltips_set_tip
argument_list|(
name|naviD
operator|->
name|tool_tips
argument_list|,
name|widget
argument_list|,
name|tooltip
argument_list|,
name|help_data
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|help_data
condition|)
block|{
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"gimp_help_data"
argument_list|,
name|help_data
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|navi_find_OpenFrameList (OpenFrameImages * search_item)
name|navi_find_OpenFrameList
parameter_list|(
name|OpenFrameImages
modifier|*
name|search_item
parameter_list|)
block|{
name|OpenFrameImages
modifier|*
name|item_list
decl_stmt|;
name|item_list
operator|=
name|naviD
operator|->
name|OpenFrameImagesList
expr_stmt|;
while|while
condition|(
name|item_list
condition|)
block|{
if|if
condition|(
operator|(
name|item_list
operator|->
name|image_id
operator|==
name|search_item
operator|->
name|image_id
operator|)
operator|&&
operator|(
name|item_list
operator|->
name|frame_nr
operator|==
name|search_item
operator|->
name|frame_nr
operator|)
condition|)
block|{
return|return
operator|(
name|TRUE
operator|)
return|;
comment|/* item found in the list */
block|}
name|item_list
operator|=
operator|(
name|OpenFrameImages
operator|*
operator|)
name|item_list
operator|->
name|next
expr_stmt|;
block|}
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_free_OpenFrameList (OpenFrameImages * list)
name|navi_free_OpenFrameList
parameter_list|(
name|OpenFrameImages
modifier|*
name|list
parameter_list|)
block|{
name|OpenFrameImages
modifier|*
name|item_list
decl_stmt|;
name|OpenFrameImages
modifier|*
name|item_next
decl_stmt|;
name|item_list
operator|=
name|list
expr_stmt|;
while|while
condition|(
name|item_list
condition|)
block|{
name|item_next
operator|=
operator|(
name|OpenFrameImages
operator|*
operator|)
name|item_list
operator|->
name|next
expr_stmt|;
name|g_free
argument_list|(
name|item_list
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|item_next
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|navi_check_image_menu_changes ()
name|navi_check_image_menu_changes
parameter_list|()
block|{
name|int
name|nimages
decl_stmt|;
name|gint32
modifier|*
name|images
decl_stmt|;
name|gint32
name|frame_nr
decl_stmt|;
name|int
name|i
decl_stmt|;
name|gint
name|l_rc
decl_stmt|;
name|int
name|item_count
decl_stmt|;
name|OpenFrameImages
modifier|*
name|item_list
decl_stmt|;
name|OpenFrameImages
modifier|*
name|new_item
decl_stmt|;
name|l_rc
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|OpenFrameImagesList
operator|==
name|NULL
condition|)
block|{
name|l_rc
operator|=
name|FALSE
expr_stmt|;
block|}
name|item_list
operator|=
name|NULL
expr_stmt|;
name|item_count
operator|=
literal|0
expr_stmt|;
name|images
operator|=
name|gimp_query_images
argument_list|(
operator|&
name|nimages
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nimages
condition|;
name|i
operator|++
control|)
block|{
name|frame_nr
operator|=
name|p_get_frame_nr
argument_list|(
name|images
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* check for anim frame */
if|if
condition|(
name|frame_nr
operator|>=
literal|0
condition|)
block|{
name|item_count
operator|++
expr_stmt|;
name|new_item
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|OpenFrameImages
argument_list|)
argument_list|)
expr_stmt|;
name|new_item
operator|->
name|image_id
operator|=
name|images
index|[
name|i
index|]
expr_stmt|;
name|new_item
operator|->
name|frame_nr
operator|=
name|frame_nr
expr_stmt|;
name|new_item
operator|->
name|next
operator|=
name|item_list
expr_stmt|;
name|item_list
operator|=
name|new_item
expr_stmt|;
if|if
condition|(
operator|!
name|navi_find_OpenFrameList
argument_list|(
name|new_item
argument_list|)
condition|)
block|{
name|l_rc
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
name|g_free
argument_list|(
name|images
argument_list|)
expr_stmt|;
if|if
condition|(
name|item_count
operator|!=
name|naviD
operator|->
name|OpenFrameImagesCount
condition|)
block|{
name|l_rc
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|l_rc
operator|==
name|TRUE
condition|)
block|{
name|navi_free_OpenFrameList
argument_list|(
name|item_list
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|navi_free_OpenFrameList
argument_list|(
name|naviD
operator|->
name|OpenFrameImagesList
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|OpenFrameImagesCount
operator|=
name|item_count
expr_stmt|;
name|naviD
operator|->
name|OpenFrameImagesList
operator|=
name|item_list
expr_stmt|;
block|}
return|return
operator|(
name|l_rc
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|navi_refresh_image_menu ()
name|navi_refresh_image_menu
parameter_list|()
block|{
if|if
condition|(
name|naviD
condition|)
block|{
if|if
condition|(
operator|!
name|navi_check_image_menu_changes
argument_list|()
condition|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_refresh_image_menu ** BEGIN REFRESH\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|OpenFrameImagesCount
operator|!=
literal|0
condition|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|naviD
operator|->
name|vbox
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|naviD
operator|->
name|image_menu
operator|=
name|gimp_image_menu_new
argument_list|(
name|navi_images_menu_constrain
argument_list|,
name|navi_images_menu_callback
argument_list|,
name|naviD
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|naviD
operator|->
name|image_option_menu
argument_list|)
argument_list|,
name|naviD
operator|->
name|image_menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|image_menu
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|OpenFrameImagesCount
operator|==
literal|0
condition|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|naviD
operator|->
name|vbox
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
block|}
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
DECL|function|navi_update_after_goto (void)
name|void
name|navi_update_after_goto
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|naviD
condition|)
block|{
name|navi_dialog_update
argument_list|(
name|NUPD_IMAGE_MENU
operator||
name|NUPD_FRAME_NR_CHANGED
argument_list|)
expr_stmt|;
name|navi_scroll_to_current_frame_nr
argument_list|()
expr_stmt|;
block|}
name|gimp_displays_flush
argument_list|()
expr_stmt|;
name|navi_set_active_cursor
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|SelectedRange
modifier|*
DECL|function|navi_get_selected_ranges (void)
name|navi_get_selected_ranges
parameter_list|(
name|void
parameter_list|)
block|{
name|FrameWidget
modifier|*
name|fw
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|GtkStateType
name|state
decl_stmt|;
name|SelectedRange
modifier|*
name|new_range
decl_stmt|;
name|SelectedRange
modifier|*
name|range_list
decl_stmt|;
name|range_list
operator|=
name|NULL
expr_stmt|;
name|new_range
operator|=
name|NULL
expr_stmt|;
name|list
operator|=
name|naviD
operator|->
name|frame_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|fw
operator|=
operator|(
name|FrameWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|state
operator|=
name|fw
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
block|{
if|if
condition|(
name|new_range
operator|==
name|NULL
condition|)
block|{
name|new_range
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|SelectedRange
argument_list|)
argument_list|)
expr_stmt|;
name|new_range
operator|->
name|next
operator|=
name|range_list
expr_stmt|;
name|new_range
operator|->
name|from
operator|=
name|fw
operator|->
name|frame_nr
expr_stmt|;
name|new_range
operator|->
name|to
operator|=
name|fw
operator|->
name|frame_nr
expr_stmt|;
name|range_list
operator|=
name|new_range
expr_stmt|;
block|}
else|else
block|{
name|new_range
operator|->
name|to
operator|=
name|fw
operator|->
name|frame_nr
expr_stmt|;
block|}
block|}
else|else
block|{
name|new_range
operator|=
name|NULL
expr_stmt|;
block|}
block|}
return|return
operator|(
name|range_list
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_thumb_update (gint update_all)
name|navi_thumb_update
parameter_list|(
name|gint
name|update_all
parameter_list|)
block|{
name|gint32
name|l_frame_nr
decl_stmt|;
name|gint32
name|l_image_id
decl_stmt|;
name|gint
name|l_upd_flag
decl_stmt|;
name|gint
name|l_any_upd_flag
decl_stmt|;
name|char
modifier|*
name|l_image_filename
decl_stmt|;
name|char
modifier|*
name|l_thumb_filename
decl_stmt|;
name|struct
name|stat
name|l_stat_thumb
decl_stmt|;
name|struct
name|stat
name|l_stat_image
decl_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
return|return;
name|l_any_upd_flag
operator|=
name|FALSE
expr_stmt|;
for|for
control|(
name|l_frame_nr
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
init|;
name|l_frame_nr
operator|<=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
condition|;
name|l_frame_nr
operator|++
control|)
block|{
name|l_upd_flag
operator|=
name|TRUE
expr_stmt|;
name|l_image_filename
operator|=
name|p_alloc_fname
argument_list|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|basename
argument_list|,
name|l_frame_nr
argument_list|,
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|extension
argument_list|)
expr_stmt|;
name|l_thumb_filename
operator|=
name|p_alloc_fname_thumbnail
argument_list|(
name|l_image_filename
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|update_all
condition|)
block|{
if|if
condition|(
literal|0
operator|==
name|stat
argument_list|(
name|l_thumb_filename
argument_list|,
operator|&
name|l_stat_thumb
argument_list|)
condition|)
block|{
comment|/* thumbnail filename exists */
if|if
condition|(
name|S_ISREG
argument_list|(
name|l_stat_thumb
operator|.
name|st_mode
argument_list|)
condition|)
block|{
comment|/* and is a regular file */
if|if
condition|(
literal|0
operator|==
name|stat
argument_list|(
name|l_image_filename
argument_list|,
operator|&
name|l_stat_image
argument_list|)
condition|)
block|{
if|if
condition|(
name|l_stat_image
operator|.
name|st_mtime
operator|<
name|l_stat_thumb
operator|.
name|st_mtime
condition|)
block|{
comment|/* time of last modification of image is older (less) 		  * than last modification of the thumbnail 		  * So we can skip the thumbnail Update for this frame 		  */
name|l_upd_flag
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
if|if
condition|(
name|l_upd_flag
condition|)
block|{
name|l_any_upd_flag
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_thumb_update frame_nr:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|l_frame_nr
argument_list|)
expr_stmt|;
name|l_image_id
operator|=
name|p_load_image
argument_list|(
name|l_image_filename
argument_list|)
expr_stmt|;
name|p_gimp_file_save_thumbnail
argument_list|(
name|l_image_id
argument_list|,
name|l_image_filename
argument_list|)
expr_stmt|;
name|gimp_image_delete
argument_list|(
name|l_image_id
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|l_image_filename
condition|)
name|g_free
argument_list|(
name|l_image_filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_thumb_filename
condition|)
name|g_free
argument_list|(
name|l_thumb_filename
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|l_any_upd_flag
condition|)
block|{
name|navid_update_exposed_previews
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|navi_dialog_thumb_update_callback (GtkWidget * w,gpointer data)
specifier|static
name|void
name|navi_dialog_thumb_update_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_thumb_update_callback\n"
argument_list|)
expr_stmt|;
name|navi_thumb_update
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_thumb_updateall_callback (GtkWidget * w,gpointer data)
specifier|static
name|void
name|navi_dialog_thumb_updateall_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_thumb_updateall_callback\n"
argument_list|)
expr_stmt|;
name|navi_thumb_update
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_playback (gint32 optimize)
specifier|static
name|void
name|navi_playback
parameter_list|(
name|gint32
name|optimize
parameter_list|)
block|{
name|SelectedRange
modifier|*
name|range_list
decl_stmt|;
name|SelectedRange
modifier|*
name|range_item
decl_stmt|;
name|gint32
name|l_from
decl_stmt|;
name|gint32
name|l_to
decl_stmt|;
name|gint32
name|l_new_image_id
decl_stmt|;
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
name|char
name|l_frame_name
index|[
literal|50
index|]
decl_stmt|;
name|int
name|l_frame_delay
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_play_callback\n"
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|l_frame_name
argument_list|,
literal|"frame_[####]"
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
condition|)
block|{
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
operator|>
literal|0
condition|)
block|{
name|l_frame_delay
operator|=
literal|1000
operator|/
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
expr_stmt|;
name|sprintf
argument_list|(
name|l_frame_name
argument_list|,
literal|"frame_[####] (%dms)"
argument_list|,
operator|(
name|int
operator|)
name|l_frame_delay
argument_list|)
expr_stmt|;
block|}
block|}
name|l_from
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
expr_stmt|;
name|l_to
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
expr_stmt|;
name|range_list
operator|=
name|navi_get_selected_ranges
argument_list|()
expr_stmt|;
if|if
condition|(
name|range_list
condition|)
block|{
name|l_to
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
expr_stmt|;
name|l_from
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
expr_stmt|;
while|while
condition|(
name|range_list
condition|)
block|{
name|l_from
operator|=
name|MIN
argument_list|(
name|l_from
argument_list|,
name|range_list
operator|->
name|from
argument_list|)
expr_stmt|;
name|l_to
operator|=
name|MAX
argument_list|(
name|l_to
argument_list|,
name|range_list
operator|->
name|to
argument_list|)
expr_stmt|;
name|range_item
operator|=
name|range_list
expr_stmt|;
name|range_list
operator|=
name|range_list
operator|->
name|next
expr_stmt|;
name|g_free
argument_list|(
name|range_item
argument_list|)
expr_stmt|;
block|}
block|}
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_range_to_multilayer"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_INT32
argument_list|,
name|l_from
argument_list|,
name|PARAM_INT32
argument_list|,
name|l_to
argument_list|,
name|PARAM_INT32
argument_list|,
literal|3
argument_list|,
comment|/* flatten image */
name|PARAM_INT32
argument_list|,
literal|1
argument_list|,
comment|/* BG_VISIBLE */
name|PARAM_INT32
argument_list|,
operator|(
name|gint32
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
argument_list|,
name|PARAM_STRING
argument_list|,
name|l_frame_name
argument_list|,
name|PARAM_INT32
argument_list|,
literal|6
argument_list|,
comment|/* use all visible layers */
name|PARAM_INT32
argument_list|,
literal|0
argument_list|,
comment|/* ignore case */
name|PARAM_INT32
argument_list|,
literal|0
argument_list|,
comment|/* normal selection (no invert) */
name|PARAM_STRING
argument_list|,
literal|"0"
argument_list|,
comment|/* select string (ignored) */
name|PARAM_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|l_new_image_id
operator|=
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
expr_stmt|;
if|if
condition|(
name|optimize
condition|)
block|{
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_animationoptimize"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|l_new_image_id
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
ifdef|#
directive|ifdef
name|COMMENT_BLOCK
comment|/* sorry, plug_in_animationoptimize does create  		  * a new anim-optimized image, but does not return the id 		  * of the created image so we can't play the optimized 		  * image automatically. 		  */
comment|/* destroy the tmp image */
name|gimp_image_delete
argument_list|(
name|l_new_image_id
argument_list|)
expr_stmt|;
name|l_new_image_id
operator|=
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
expr_stmt|;
endif|#
directive|endif
block|}
block|}
comment|/* TODO: here we should start a thread for the playback,  	  * so the navigator is not blocked until playback exits 	  */
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_animationplay"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|l_new_image_id
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_END
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_play_callback (GtkWidget * w,gpointer data)
specifier|static
name|void
name|navi_dialog_vcr_play_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_play_callback\n"
argument_list|)
expr_stmt|;
name|navi_playback
argument_list|(
name|FALSE
comment|/* dont not optimize */
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_play_optim_callback (GtkWidget * w,gpointer data)
specifier|static
name|void
name|navi_dialog_vcr_play_optim_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_play_optim_callback\n"
argument_list|)
expr_stmt|;
name|navi_playback
argument_list|(
name|TRUE
comment|/* optimize */
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_frames_duplicate_frame_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_frames_duplicate_frame_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|SelectedRange
modifier|*
name|range_list
decl_stmt|;
name|SelectedRange
modifier|*
name|range_item
decl_stmt|;
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_frames_duplicate_frame_callback\n"
argument_list|)
expr_stmt|;
name|range_list
operator|=
name|navi_get_selected_ranges
argument_list|()
expr_stmt|;
if|if
condition|(
name|range_list
condition|)
block|{
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
while|while
condition|(
name|range_list
condition|)
block|{
comment|/* Note: process the ranges from high frame_nummers 	*       downto low frame_numbers. 	*       (the range_list was created in a way that 	*        the highest range is added as 1st list element) 	*/
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"Duplicate Range from:%d  to:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|range_list
operator|->
name|from
argument_list|,
operator|(
name|int
operator|)
name|range_list
operator|->
name|to
argument_list|)
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_goto"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_INT32
argument_list|,
name|range_list
operator|->
name|from
argument_list|,
name|PARAM_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_dup"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_INT32
argument_list|,
literal|1
argument_list|,
comment|/* copy block 1 times */
name|PARAM_INT32
argument_list|,
name|range_list
operator|->
name|from
argument_list|,
name|PARAM_INT32
argument_list|,
name|range_list
operator|->
name|to
argument_list|,
name|PARAM_END
argument_list|)
expr_stmt|;
block|}
name|range_item
operator|=
name|range_list
expr_stmt|;
name|range_list
operator|=
name|range_list
operator|->
name|next
expr_stmt|;
name|g_free
argument_list|(
name|range_item
argument_list|)
expr_stmt|;
block|}
name|navi_update_after_goto
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* end navi_dialog_frames_duplicate_frame_callback */
end_comment

begin_function
DECL|function|navi_dialog_frames_delete_frame_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_frames_delete_frame_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|SelectedRange
modifier|*
name|range_list
decl_stmt|;
name|SelectedRange
modifier|*
name|range_item
decl_stmt|;
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_frames_delete_frame_callback\n"
argument_list|)
expr_stmt|;
name|range_list
operator|=
name|navi_get_selected_ranges
argument_list|()
expr_stmt|;
if|if
condition|(
name|range_list
condition|)
block|{
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
while|while
condition|(
name|range_list
condition|)
block|{
comment|/* Note: process the ranges from high frame_nummers 	*       downto low frame_numbers. 	*       (the range_list was created in a way that 	*        the highest range is added as 1st list element) 	*/
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"Delete Range from:%d  to:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|range_list
operator|->
name|from
argument_list|,
operator|(
name|int
operator|)
name|range_list
operator|->
name|to
argument_list|)
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_goto"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_INT32
argument_list|,
name|range_list
operator|->
name|from
argument_list|,
name|PARAM_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_del"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_INT32
argument_list|,
literal|1
operator|+
operator|(
name|range_list
operator|->
name|to
operator|-
name|range_list
operator|->
name|from
operator|)
argument_list|,
comment|/* number of frames to delete */
name|PARAM_END
argument_list|)
expr_stmt|;
block|}
name|range_item
operator|=
name|range_list
expr_stmt|;
name|range_list
operator|=
name|range_list
operator|->
name|next
expr_stmt|;
name|g_free
argument_list|(
name|range_item
argument_list|)
expr_stmt|;
block|}
name|navi_update_after_goto
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* end navi_dialog_frames_delete_frame_callback */
end_comment

begin_function
DECL|function|navi_dialog_goto_callback (gint32 dst_framenr)
name|void
name|navi_dialog_goto_callback
parameter_list|(
name|gint32
name|dst_framenr
parameter_list|)
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_goto_callback\n"
argument_list|)
expr_stmt|;
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_goto"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_INT32
argument_list|,
name|dst_framenr
argument_list|,
name|PARAM_END
argument_list|)
expr_stmt|;
name|navi_update_after_goto
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_goto_first_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_vcr_goto_first_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_goto_first_callback\n"
argument_list|)
expr_stmt|;
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_first"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_END
argument_list|)
expr_stmt|;
name|navi_update_after_goto
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_goto_prev_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_vcr_goto_prev_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_goto_prev_callback\n"
argument_list|)
expr_stmt|;
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_prev"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_END
argument_list|)
expr_stmt|;
name|navi_update_after_goto
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_goto_prevblock_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_vcr_goto_prevblock_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint32
name|dst_framenr
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_goto_prevblock_callback\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
name|navi_reload_ainfo
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|==
name|NULL
condition|)
return|return;
name|dst_framenr
operator|=
name|MAX
argument_list|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|curr_frame_nr
operator|-
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
argument_list|,
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
argument_list|)
expr_stmt|;
name|navi_dialog_goto_callback
argument_list|(
name|dst_framenr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_goto_next_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_vcr_goto_next_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_goto_next_callback\n"
argument_list|)
expr_stmt|;
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_next"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_END
argument_list|)
expr_stmt|;
name|navi_update_after_goto
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_goto_nextblock_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_vcr_goto_nextblock_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint32
name|dst_framenr
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_goto_nextblock_callback\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
name|navi_reload_ainfo
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|==
name|NULL
condition|)
return|return;
name|dst_framenr
operator|=
name|MIN
argument_list|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|curr_frame_nr
operator|+
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
argument_list|,
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
argument_list|)
expr_stmt|;
name|navi_dialog_goto_callback
argument_list|(
name|dst_framenr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|navi_dialog_vcr_goto_last_callback (GtkWidget * w,gpointer data)
name|void
name|navi_dialog_vcr_goto_last_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_vcr_goto_last_callback\n"
argument_list|)
expr_stmt|;
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"plug_in_gap_last"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_INT32
argument_list|,
name|RUN_NONINTERACTIVE
argument_list|,
name|PARAM_IMAGE
argument_list|,
name|naviD
operator|->
name|active_imageid
argument_list|,
name|PARAM_DRAWABLE
argument_list|,
operator|-
literal|1
argument_list|,
comment|/* dummy */
name|PARAM_END
argument_list|)
expr_stmt|;
name|navi_update_after_goto
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|frames_timing_update (void)
name|frames_timing_update
parameter_list|(
name|void
parameter_list|)
block|{
name|FrameWidget
modifier|*
name|fw
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|list
operator|=
name|naviD
operator|->
name|frame_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|fw
operator|=
operator|(
name|FrameWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|frame_widget_time_label_update
argument_list|(
name|fw
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|navi_framerate_scale_update (GtkAdjustment * adjustment,gpointer data)
name|navi_framerate_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gdouble
name|framerate
decl_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|==
name|NULL
condition|)
return|return;
name|framerate
operator|=
call|(
name|gdouble
call|)
argument_list|(
name|adjustment
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|framerate
operator|!=
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
condition|)
block|{
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
operator|=
name|framerate
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
condition|)
block|{
comment|/* write new framerate to video info file */
name|p_set_video_info
argument_list|(
name|naviD
operator|->
name|vin_ptr
argument_list|,
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|basename
argument_list|)
expr_stmt|;
block|}
name|frames_timing_update
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_framerate_scale_update :%d\n"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|navi_timezoom_scale_update (GtkAdjustment * adjustment,gpointer data)
name|navi_timezoom_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|timezoom
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gfloat
name|adj_val
decl_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|==
name|NULL
condition|)
return|return;
name|timezoom
operator|=
call|(
name|int
call|)
argument_list|(
name|adjustment
operator|->
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|timezoom
operator|!=
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
condition|)
block|{
name|adj
operator|=
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|timezoom
operator|!=
literal|0
condition|)
block|{
name|adj_val
operator|=
operator|(
name|adj
operator|->
name|value
operator|*
operator|(
name|gfloat
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
operator|)
operator|/
operator|(
name|gfloat
operator|)
name|timezoom
expr_stmt|;
if|if
condition|(
name|adj_val
operator|>
name|MAX_HEIGHT_GTK_SCROLLED_WIN
condition|)
block|{
name|adj_val
operator|=
name|MAX_HEIGHT_GTK_SCROLLED_WIN
operator|-
name|adj
operator|->
name|page_size
expr_stmt|;
block|}
block|}
else|else
block|{
name|adj_val
operator|=
name|adj
operator|->
name|value
expr_stmt|;
block|}
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
operator|=
name|timezoom
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
condition|)
block|{
comment|/* write new timezoom to video info file */
name|p_set_video_info
argument_list|(
name|naviD
operator|->
name|vin_ptr
argument_list|,
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|basename
argument_list|)
expr_stmt|;
block|}
name|frames_dialog_flush
argument_list|()
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adjustment
argument_list|,
operator|(
name|gfloat
operator|)
name|timezoom
argument_list|)
expr_stmt|;
name|adj
operator|->
name|value
operator|=
name|adj_val
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|adj
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_timezoom_scale_update :%d\n"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/********************************/
end_comment

begin_comment
comment|/*  frame list events callback  */
end_comment

begin_comment
comment|/********************************/
end_comment

begin_function
specifier|static
name|gint
DECL|function|frame_list_events (GtkWidget * widget,GdkEvent * event,gpointer data)
name|frame_list_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|GtkWidget
modifier|*
name|event_widget
decl_stmt|;
name|FrameWidget
modifier|*
name|frame_widget
decl_stmt|;
name|event_widget
operator|=
name|gtk_get_event_widget
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|GTK_IS_LIST_ITEM
argument_list|(
name|event_widget
argument_list|)
condition|)
block|{
name|frame_widget
operator|=
operator|(
name|FrameWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|event_widget
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_list_events:nothing implemented on GDK_BUTTON_PRESS event\n"
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|GDK_2BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_list_events: GDK_2BUTTON_PRESS event\n"
argument_list|)
expr_stmt|;
name|navi_dialog_goto_callback
argument_list|(
name|frame_widget
operator|->
name|frame_nr
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
default|default:
break|break;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|void
DECL|function|frames_dialog_flush (void)
name|frames_dialog_flush
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frames_dialog_flush\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
condition|)
block|{
name|frames_dialog_update
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|frames_dialog_update (gint32 image_id)
name|frames_dialog_update
parameter_list|(
name|gint32
name|image_id
parameter_list|)
block|{
name|FrameWidget
modifier|*
name|fw
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|GList
modifier|*
name|item_list
decl_stmt|;
name|gint32
name|l_frame_nr
decl_stmt|;
name|gint32
name|l_count
decl_stmt|;
name|gint32
name|l_warning_flag
decl_stmt|;
name|gint32
name|scrolled_window_height
decl_stmt|;
name|gint32
name|scrolled_window_height_ok
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gint
name|l_waiting_cursor
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frames_dialog_update image_id:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|image_id
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|naviD
condition|)
comment|/* || (naviD->active_imageid == image_id) */
block|{
return|return;
block|}
name|l_waiting_cursor
operator|=
name|naviD
operator|->
name|waiting_cursor
expr_stmt|;
if|if
condition|(
operator|!
name|naviD
operator|->
name|waiting_cursor
condition|)
name|navi_set_waiting_cursor
argument_list|()
expr_stmt|;
name|navi_reload_ainfo
argument_list|(
name|image_id
argument_list|)
expr_stmt|;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
name|scrolled_window_height_ok
operator|=
literal|0
expr_stmt|;
comment|/*  Free all elements in the frames listbox  */
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|naviD
operator|->
name|frame_list
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|list
operator|=
name|naviD
operator|->
name|frame_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|fw
operator|=
operator|(
name|FrameWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|frame_widget_delete
argument_list|(
name|fw
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|naviD
operator|->
name|frame_widgets
condition|)
name|g_warning
argument_list|(
literal|"frames_dialog_update(): naviD->frame_widgets not empty!"
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|frame_widgets
operator|=
name|NULL
expr_stmt|;
comment|/*  Find the preview extents  */
name|navi_preview_extents
argument_list|()
expr_stmt|;
comment|/*  naviD->active_layer = NULL;  */
name|l_count
operator|=
literal|0
expr_stmt|;
name|l_warning_flag
operator|=
literal|0
expr_stmt|;
name|scrolled_window_height
operator|=
name|naviD
operator|->
name|item_height
expr_stmt|;
name|item_list
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|l_frame_nr
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
init|;
name|l_frame_nr
operator|<=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
condition|;
name|l_frame_nr
operator|++
control|)
block|{
comment|/*  create a frame list item  */
if|if
condition|(
operator|(
name|l_frame_nr
operator|==
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
operator|)
operator|||
operator|(
name|l_frame_nr
operator|==
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
operator|)
operator|||
operator|(
operator|(
operator|(
name|l_frame_nr
operator|-
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
operator|)
operator|%
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
operator|)
operator|==
literal|0
operator|)
condition|)
block|{
if|if
condition|(
name|scrolled_window_height
operator|<
name|MAX_HEIGHT_GTK_SCROLLED_WIN
condition|)
block|{
name|fw
operator|=
name|frame_widget_create
argument_list|(
name|image_id
argument_list|,
name|l_frame_nr
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw
condition|)
block|{
name|naviD
operator|->
name|frame_widgets
operator|=
name|g_slist_append
argument_list|(
name|naviD
operator|->
name|frame_widgets
argument_list|,
name|fw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|fw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|scrolled_window_height_ok
operator|=
name|scrolled_window_height
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|l_warning_flag
operator|==
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"WARNING: GTK listbox can't handle more than %d items of %d pixels height\n"
argument_list|,
operator|(
name|int
operator|)
name|l_count
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|item_height
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"         can't display frames upto %d\n"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
argument_list|)
expr_stmt|;
name|l_warning_flag
operator|=
literal|1
expr_stmt|;
block|}
block|}
name|l_count
operator|++
expr_stmt|;
name|scrolled_window_height
operator|+=
name|naviD
operator|->
name|item_height
expr_stmt|;
block|}
block|}
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"LIST_CREATED: first:%d, last:%d\n, count:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
argument_list|,
operator|(
name|int
operator|)
name|l_count
argument_list|)
expr_stmt|;
comment|/*  get the index of the active frame  */
if|if
condition|(
name|item_list
condition|)
block|{
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|naviD
operator|->
name|frame_list
argument_list|)
argument_list|,
name|item_list
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|adj
operator|=
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
argument_list|)
expr_stmt|;
name|adj
operator|->
name|lower
operator|=
literal|0
expr_stmt|;
name|adj
operator|->
name|upper
operator|=
name|scrolled_window_height_ok
expr_stmt|;
block|}
name|suspend_gimage_notify
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|l_waiting_cursor
condition|)
name|navi_set_active_cursor
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|frame_widget_select_update (GtkWidget * widget,gpointer data)
name|frame_widget_select_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|FrameWidget
modifier|*
name|frame_widget
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|frame_widget
operator|=
operator|(
name|FrameWidget
operator|*
operator|)
name|data
operator|)
condition|)
return|return;
comment|/*  Is the list item being selected?  */
if|if
condition|(
name|widget
operator|->
name|state
operator|!=
name|GTK_STATE_SELECTED
condition|)
return|return;
comment|/*  Only notify the gimage of an active layer change if necessary  */
if|if
condition|(
name|suspend_gimage_notify
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_select_update NOT IMPLEMENTED (maybe not needed)\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|frame_widget_button_events (GtkWidget * widget,GdkEvent * event)
name|frame_widget_button_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_button_events NOT IMPLEMENTED\n"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_comment
comment|/***********************/
end_comment

begin_comment
comment|/*  Preview functions  */
end_comment

begin_comment
comment|/***********************/
end_comment

begin_function
specifier|static
name|gint
DECL|function|render_current_preview (GtkWidget * preview_widget,FrameWidget * fw)
name|render_current_preview
parameter_list|(
name|GtkWidget
modifier|*
name|preview_widget
parameter_list|,
name|FrameWidget
modifier|*
name|fw
parameter_list|)
block|{
name|guchar
modifier|*
name|l_rowbuf
decl_stmt|;
name|guchar
modifier|*
name|l_ptr
decl_stmt|;
name|gint32
name|l_x
decl_stmt|,
name|l_y
decl_stmt|;
name|gint32
name|l_ofx
decl_stmt|,
name|l_ofy
decl_stmt|;
name|gint32
name|l_ofs_thpixel
decl_stmt|;
name|guchar
modifier|*
name|l_thumbdata_ptr
decl_stmt|;
name|gint32
name|l_thumbdata_count
decl_stmt|;
name|gint32
name|l_th_width
decl_stmt|;
name|gint32
name|l_th_height
decl_stmt|;
name|gint32
name|l_th_bpp
decl_stmt|;
name|gint32
name|l_thumb_rowstride
decl_stmt|;
name|gint32
name|l_pv_width
decl_stmt|;
name|gint32
name|l_pv_height
decl_stmt|;
name|gdouble
name|l_xscale
decl_stmt|;
name|gdouble
name|l_yscale
decl_stmt|;
name|gdouble
name|l_ofd
decl_stmt|;
name|guchar
name|l_alpha
decl_stmt|;
name|gint
name|l_1
decl_stmt|;
name|gint
name|l_offset
decl_stmt|;
name|gint
name|l_rc
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"render_current_preview START\n"
argument_list|)
expr_stmt|;
name|l_rc
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return
operator|(
name|l_rc
operator|)
return|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
return|return
operator|(
name|l_rc
operator|)
return|;
name|l_thumbdata_ptr
operator|=
name|NULL
expr_stmt|;
name|l_pv_width
operator|=
name|naviD
operator|->
name|image_width
expr_stmt|;
name|l_pv_height
operator|=
name|naviD
operator|->
name|image_height
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"render_current_preview BEFORE p_gimp_image_thumbnail w:%d h:%d,\n"
argument_list|,
operator|(
name|int
operator|)
name|l_pv_width
argument_list|,
operator|(
name|int
operator|)
name|l_pv_height
argument_list|)
expr_stmt|;
name|p_gimp_image_thumbnail
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|,
name|l_pv_width
argument_list|,
name|l_pv_height
argument_list|,
operator|&
name|l_th_width
argument_list|,
operator|&
name|l_th_height
argument_list|,
operator|&
name|l_th_bpp
argument_list|,
operator|&
name|l_thumbdata_count
argument_list|,
operator|&
name|l_thumbdata_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"render_current_preview AFTER p_gimp_image_thumbnail th_w:%d th_h:%d, th_bpp:%d, count:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|l_th_width
argument_list|,
operator|(
name|int
operator|)
name|l_th_height
argument_list|,
operator|(
name|int
operator|)
name|l_th_bpp
argument_list|,
operator|(
name|int
operator|)
name|l_thumbdata_count
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_th_bpp
operator|<
literal|3
condition|)
name|l_1
operator|=
literal|0
expr_stmt|;
else|else
name|l_1
operator|=
literal|1
expr_stmt|;
name|l_rowbuf
operator|=
name|g_malloc
argument_list|(
name|PREVIEW_BPP
operator|*
name|l_pv_width
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_rowbuf
operator|==
name|NULL
condition|)
return|return
operator|(
name|l_rc
operator|)
return|;
if|if
condition|(
name|l_thumbdata_ptr
operator|!=
name|NULL
condition|)
block|{
name|l_xscale
operator|=
operator|(
name|gdouble
operator|)
name|l_th_width
operator|/
operator|(
name|gdouble
operator|)
name|l_pv_width
expr_stmt|;
name|l_yscale
operator|=
operator|(
name|gdouble
operator|)
name|l_th_height
operator|/
operator|(
name|gdouble
operator|)
name|l_pv_height
expr_stmt|;
name|l_thumb_rowstride
operator|=
name|l_th_bpp
operator|*
name|l_th_width
expr_stmt|;
comment|/* render preview */
for|for
control|(
name|l_y
operator|=
literal|0
init|;
name|l_y
operator|<
name|l_pv_height
condition|;
name|l_y
operator|++
control|)
block|{
name|l_ptr
operator|=
name|l_rowbuf
expr_stmt|;
name|l_ofd
operator|=
operator|(
name|l_yscale
operator|*
operator|(
name|gdouble
operator|)
name|l_y
operator|)
operator|+
literal|0.5
expr_stmt|;
name|l_ofy
operator|=
call|(
name|gint32
call|)
argument_list|(
name|l_ofd
argument_list|)
operator|*
name|l_thumb_rowstride
expr_stmt|;
if|if
condition|(
name|l_y
operator|&
literal|0x4
condition|)
name|l_offset
operator|=
literal|4
expr_stmt|;
else|else
name|l_offset
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|l_th_bpp
operator|>
literal|3
operator|)
operator|||
operator|(
name|l_th_bpp
operator|==
literal|2
operator|)
condition|)
block|{
comment|/* thumbdata has alpha channel */
for|for
control|(
name|l_x
operator|=
literal|0
init|;
name|l_x
operator|<
name|l_pv_width
condition|;
name|l_x
operator|++
control|)
block|{
name|l_ofd
operator|=
operator|(
name|l_xscale
operator|*
operator|(
name|gdouble
operator|)
name|l_x
operator|)
operator|+
literal|0.5
expr_stmt|;
name|l_ofx
operator|=
call|(
name|gint32
call|)
argument_list|(
name|l_ofd
argument_list|)
operator|*
name|l_th_bpp
expr_stmt|;
name|l_ofs_thpixel
operator|=
name|l_ofy
operator|+
name|l_ofx
expr_stmt|;
name|l_alpha
operator|=
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
operator|+
operator|(
name|l_th_bpp
operator|-
literal|1
operator|)
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|l_x
operator|+
name|l_offset
operator|)
operator|&
literal|0x4
condition|)
block|{
operator|*
name|l_ptr
operator|=
name|MIX_CHANNEL
argument_list|(
name|PREVIEW_BG_GRAY2
argument_list|,
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
index|]
argument_list|,
name|l_alpha
argument_list|)
expr_stmt|;
name|l_ptr
index|[
literal|1
index|]
operator|=
name|MIX_CHANNEL
argument_list|(
name|PREVIEW_BG_GRAY2
argument_list|,
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
operator|+
name|l_1
index|]
argument_list|,
name|l_alpha
argument_list|)
expr_stmt|;
name|l_ptr
index|[
literal|2
index|]
operator|=
name|MIX_CHANNEL
argument_list|(
name|PREVIEW_BG_GRAY2
argument_list|,
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
operator|+
name|l_1
operator|+
name|l_1
index|]
argument_list|,
name|l_alpha
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|*
name|l_ptr
operator|=
name|MIX_CHANNEL
argument_list|(
name|PREVIEW_BG_GRAY1
argument_list|,
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
index|]
argument_list|,
name|l_alpha
argument_list|)
expr_stmt|;
name|l_ptr
index|[
literal|1
index|]
operator|=
name|MIX_CHANNEL
argument_list|(
name|PREVIEW_BG_GRAY1
argument_list|,
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
operator|+
name|l_1
index|]
argument_list|,
name|l_alpha
argument_list|)
expr_stmt|;
name|l_ptr
index|[
literal|2
index|]
operator|=
name|MIX_CHANNEL
argument_list|(
name|PREVIEW_BG_GRAY1
argument_list|,
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
operator|+
name|l_1
operator|+
name|l_1
index|]
argument_list|,
name|l_alpha
argument_list|)
expr_stmt|;
block|}
name|l_ptr
operator|+=
name|PREVIEW_BPP
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|l_x
operator|=
literal|0
init|;
name|l_x
operator|<
name|l_pv_width
condition|;
name|l_x
operator|++
control|)
block|{
name|l_ofd
operator|=
operator|(
name|l_xscale
operator|*
operator|(
name|gdouble
operator|)
name|l_x
operator|)
operator|+
literal|0.5
expr_stmt|;
name|l_ofx
operator|=
call|(
name|gint32
call|)
argument_list|(
name|l_ofd
argument_list|)
operator|*
name|l_th_bpp
expr_stmt|;
name|l_ofs_thpixel
operator|=
name|l_ofy
operator|+
name|l_ofx
expr_stmt|;
operator|*
name|l_ptr
operator|=
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
index|]
expr_stmt|;
name|l_ptr
index|[
literal|1
index|]
operator|=
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
operator|+
name|l_1
index|]
expr_stmt|;
name|l_ptr
index|[
literal|2
index|]
operator|=
name|l_thumbdata_ptr
index|[
name|l_ofs_thpixel
operator|+
name|l_1
operator|+
name|l_1
index|]
expr_stmt|;
name|l_ptr
operator|+=
name|PREVIEW_BPP
expr_stmt|;
block|}
block|}
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview_widget
argument_list|)
argument_list|,
name|l_rowbuf
argument_list|,
literal|0
argument_list|,
name|l_y
argument_list|,
name|l_pv_width
argument_list|)
expr_stmt|;
block|}
name|l_rc
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|l_rowbuf
condition|)
name|g_free
argument_list|(
name|l_rowbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_thumbdata_ptr
condition|)
name|g_free
argument_list|(
name|l_thumbdata_ptr
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"render_current_preview END\n"
argument_list|)
expr_stmt|;
return|return
operator|(
name|l_rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/* end render_current_preview */
end_comment

begin_function
specifier|static
name|gint
DECL|function|render_preview (GtkWidget * preview_widget,FrameWidget * fw)
name|render_preview
parameter_list|(
name|GtkWidget
modifier|*
name|preview_widget
parameter_list|,
name|FrameWidget
modifier|*
name|fw
parameter_list|)
block|{
name|guchar
modifier|*
name|l_rowbuf
decl_stmt|;
name|guchar
modifier|*
name|l_ptr
decl_stmt|;
name|gint32
name|l_x
decl_stmt|,
name|l_y
decl_stmt|;
name|gint32
name|l_ofx
decl_stmt|,
name|l_ofy
decl_stmt|;
name|gint32
name|l_ofs_thpixel
decl_stmt|;
name|gint32
name|l_th_width
decl_stmt|;
name|gint32
name|l_th_height
decl_stmt|;
name|gint32
name|l_thumb_rowstride
decl_stmt|;
name|gint32
name|l_pv_width
decl_stmt|;
name|gint32
name|l_pv_height
decl_stmt|;
name|gdouble
name|l_xscale
decl_stmt|;
name|gdouble
name|l_yscale
decl_stmt|;
name|gdouble
name|l_ofd
decl_stmt|;
name|char
modifier|*
name|l_filename
decl_stmt|;
name|gint
name|l_rc
decl_stmt|;
name|guchar
modifier|*
name|l_raw_thumb
decl_stmt|;
name|gchar
modifier|*
name|l_tname
decl_stmt|;
name|gchar
modifier|*
name|imginfo
init|=
name|NULL
decl_stmt|;
name|struct
name|stat
name|l_stat_thumb
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"render_preview (quick)\n"
argument_list|)
expr_stmt|;
name|l_rc
operator|=
name|FALSE
expr_stmt|;
name|l_raw_thumb
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return
operator|(
name|l_rc
operator|)
return|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
return|return
operator|(
name|l_rc
operator|)
return|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|curr_frame_nr
operator|==
name|fw
operator|->
name|frame_nr
condition|)
block|{
comment|/* if this is the currently open image       * we first write the thumbnail to disc       * so we get an up to date version in the following readXVThumb call       */
name|l_rc
operator|=
name|render_current_preview
argument_list|(
name|preview_widget
argument_list|,
name|fw
argument_list|)
expr_stmt|;
return|return
operator|(
name|l_rc
operator|)
return|;
block|}
name|l_filename
operator|=
name|p_alloc_fname
argument_list|(
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|basename
argument_list|,
name|fw
operator|->
name|frame_nr
argument_list|,
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|extension
argument_list|)
expr_stmt|;
name|l_tname
operator|=
name|p_alloc_fname_thumbnail
argument_list|(
name|l_filename
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|==
name|stat
argument_list|(
name|l_tname
argument_list|,
operator|&
name|l_stat_thumb
argument_list|)
condition|)
block|{
name|fw
operator|->
name|thumb_timestamp
operator|=
name|l_stat_thumb
operator|.
name|st_mtime
expr_stmt|;
name|l_raw_thumb
operator|=
name|readXVThumb
argument_list|(
name|l_tname
argument_list|,
operator|&
name|l_th_width
argument_list|,
operator|&
name|l_th_height
argument_list|,
operator|&
name|imginfo
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw
operator|->
name|thumb_filename
condition|)
name|g_free
argument_list|(
name|fw
operator|->
name|thumb_filename
argument_list|)
expr_stmt|;
name|fw
operator|->
name|thumb_filename
operator|=
name|l_tname
expr_stmt|;
block|}
else|else
block|{
name|g_free
argument_list|(
name|l_tname
argument_list|)
expr_stmt|;
block|}
name|l_pv_width
operator|=
name|naviD
operator|->
name|image_width
expr_stmt|;
name|l_pv_height
operator|=
name|naviD
operator|->
name|image_height
expr_stmt|;
name|l_rowbuf
operator|=
name|g_malloc
argument_list|(
name|PREVIEW_BPP
operator|*
name|l_pv_width
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_rowbuf
operator|==
name|NULL
condition|)
return|return
operator|(
name|l_rc
operator|)
return|;
if|if
condition|(
name|l_raw_thumb
operator|!=
name|NULL
condition|)
block|{
name|l_xscale
operator|=
operator|(
name|gdouble
operator|)
name|l_th_width
operator|/
operator|(
name|gdouble
operator|)
name|l_pv_width
expr_stmt|;
name|l_yscale
operator|=
operator|(
name|gdouble
operator|)
name|l_th_height
operator|/
operator|(
name|gdouble
operator|)
name|l_pv_height
expr_stmt|;
name|l_thumb_rowstride
operator|=
name|l_th_width
expr_stmt|;
comment|/* raw thumb data BPP is 1 */
comment|/* render preview */
for|for
control|(
name|l_y
operator|=
literal|0
init|;
name|l_y
operator|<
name|l_pv_height
condition|;
name|l_y
operator|++
control|)
block|{
name|l_ptr
operator|=
name|l_rowbuf
expr_stmt|;
name|l_ofd
operator|=
operator|(
name|l_yscale
operator|*
operator|(
name|gdouble
operator|)
name|l_y
operator|)
operator|+
literal|0.5
expr_stmt|;
name|l_ofy
operator|=
call|(
name|gint32
call|)
argument_list|(
name|l_ofd
argument_list|)
operator|*
name|l_thumb_rowstride
expr_stmt|;
comment|/* check if> thumbnail height !!! */
for|for
control|(
name|l_x
operator|=
literal|0
init|;
name|l_x
operator|<
name|l_pv_width
condition|;
name|l_x
operator|++
control|)
block|{
name|l_ofd
operator|=
operator|(
name|l_xscale
operator|*
operator|(
name|gdouble
operator|)
name|l_x
operator|)
operator|+
literal|0.5
expr_stmt|;
name|l_ofx
operator|=
call|(
name|gint32
call|)
argument_list|(
name|l_ofd
argument_list|)
expr_stmt|;
comment|/* raw thumb data BPP is 1 */
name|l_ofs_thpixel
operator|=
name|l_ofy
operator|+
name|l_ofx
expr_stmt|;
operator|*
name|l_ptr
operator|=
operator|(
operator|(
name|l_raw_thumb
index|[
name|l_ofs_thpixel
index|]
operator|>>
literal|5
operator|)
operator|*
literal|255
operator|)
operator|/
literal|7
expr_stmt|;
name|l_ptr
index|[
literal|1
index|]
operator|=
operator|(
operator|(
operator|(
name|l_raw_thumb
index|[
name|l_ofs_thpixel
index|]
operator|>>
literal|2
operator|)
operator|&
literal|7
operator|)
operator|*
literal|255
operator|)
operator|/
literal|7
expr_stmt|;
name|l_ptr
index|[
literal|2
index|]
operator|=
operator|(
operator|(
operator|(
name|l_raw_thumb
index|[
name|l_ofs_thpixel
index|]
operator|)
operator|&
literal|3
operator|)
operator|*
literal|255
operator|)
operator|/
literal|3
expr_stmt|;
name|l_ptr
operator|+=
name|PREVIEW_BPP
expr_stmt|;
block|}
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview_widget
argument_list|)
argument_list|,
name|l_rowbuf
argument_list|,
literal|0
argument_list|,
name|l_y
argument_list|,
name|l_pv_width
argument_list|)
expr_stmt|;
block|}
name|l_rc
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|l_rowbuf
condition|)
name|g_free
argument_list|(
name|l_rowbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_raw_thumb
condition|)
name|g_free
argument_list|(
name|l_raw_thumb
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_filename
condition|)
name|g_free
argument_list|(
name|l_filename
argument_list|)
expr_stmt|;
return|return
operator|(
name|l_rc
operator|)
return|;
block|}
end_function

begin_comment
comment|/* end render_preview */
end_comment

begin_function
name|void
DECL|function|render_no_preview (GtkWidget * widget,GdkPixmap * pixmap)
name|render_no_preview
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|)
block|{
name|int
name|w
decl_stmt|,
name|h
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|GdkPoint
name|poly
index|[
literal|6
index|]
decl_stmt|;
name|int
name|foldh
decl_stmt|,
name|foldw
decl_stmt|;
name|int
name|i
decl_stmt|;
name|gdk_window_get_size
argument_list|(
name|pixmap
argument_list|,
operator|&
name|w
argument_list|,
operator|&
name|h
argument_list|)
expr_stmt|;
name|x1
operator|=
literal|2
expr_stmt|;
name|y1
operator|=
name|h
operator|/
literal|8
operator|+
literal|2
expr_stmt|;
name|x2
operator|=
name|w
operator|-
name|w
operator|/
literal|8
operator|-
literal|2
expr_stmt|;
name|y2
operator|=
name|h
operator|-
literal|2
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
comment|/*   gdk_draw_rectangle (pixmap, widget->style->black_gc, 0, 		      x1, y1, (x2 - x1), (y2 - y1)); */
name|foldw
operator|=
name|w
operator|/
literal|4
expr_stmt|;
name|foldh
operator|=
name|h
operator|/
literal|4
expr_stmt|;
name|x1
operator|=
name|w
operator|/
literal|8
operator|+
literal|2
expr_stmt|;
name|y1
operator|=
literal|2
expr_stmt|;
name|x2
operator|=
name|w
operator|-
literal|2
expr_stmt|;
name|y2
operator|=
name|h
operator|-
name|h
operator|/
literal|8
operator|-
literal|2
expr_stmt|;
name|poly
index|[
literal|0
index|]
operator|.
name|x
operator|=
name|x1
operator|+
name|foldw
expr_stmt|;
name|poly
index|[
literal|0
index|]
operator|.
name|y
operator|=
name|y1
expr_stmt|;
name|poly
index|[
literal|1
index|]
operator|.
name|x
operator|=
name|x1
operator|+
name|foldw
expr_stmt|;
name|poly
index|[
literal|1
index|]
operator|.
name|y
operator|=
name|y1
operator|+
name|foldh
expr_stmt|;
name|poly
index|[
literal|2
index|]
operator|.
name|x
operator|=
name|x1
expr_stmt|;
name|poly
index|[
literal|2
index|]
operator|.
name|y
operator|=
name|y1
operator|+
name|foldh
expr_stmt|;
name|poly
index|[
literal|3
index|]
operator|.
name|x
operator|=
name|x1
expr_stmt|;
name|poly
index|[
literal|3
index|]
operator|.
name|y
operator|=
name|y2
expr_stmt|;
name|poly
index|[
literal|4
index|]
operator|.
name|x
operator|=
name|x2
expr_stmt|;
name|poly
index|[
literal|4
index|]
operator|.
name|y
operator|=
name|y2
expr_stmt|;
name|poly
index|[
literal|5
index|]
operator|.
name|x
operator|=
name|x2
expr_stmt|;
name|poly
index|[
literal|5
index|]
operator|.
name|y
operator|=
name|y1
expr_stmt|;
name|gdk_draw_polygon
argument_list|(
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
literal|1
argument_list|,
name|poly
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|x1
argument_list|,
name|y1
operator|+
name|foldh
argument_list|,
name|x1
argument_list|,
name|y2
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|x1
argument_list|,
name|y2
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|,
name|x2
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|x1
operator|+
name|foldw
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|foldw
condition|;
name|i
operator|++
control|)
block|{
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|x1
operator|+
name|i
argument_list|,
name|y1
operator|+
name|foldh
argument_list|,
name|x1
operator|+
name|i
argument_list|,
operator|(
name|foldw
operator|==
literal|1
operator|)
condition|?
name|y1
else|:
operator|(
name|y1
operator|+
operator|(
name|foldh
operator|-
operator|(
name|foldh
operator|*
name|i
operator|)
operator|/
operator|(
name|foldw
operator|-
literal|1
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|frame_widget_preview_redraw (FrameWidget * frame_widget)
name|frame_widget_preview_redraw
parameter_list|(
name|FrameWidget
modifier|*
name|frame_widget
parameter_list|)
block|{
name|GdkPixmap
modifier|*
modifier|*
name|pixmap
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
name|widget
operator|=
name|frame_widget
operator|->
name|frame_preview
expr_stmt|;
name|pixmap
operator|=
operator|&
name|frame_widget
operator|->
name|frame_pixmap
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_preview_redraw image_id: %d, frame_nr:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|frame_widget
operator|->
name|image_id
argument_list|,
operator|(
name|int
operator|)
name|frame_widget
operator|->
name|frame_nr
argument_list|)
expr_stmt|;
comment|/*  determine width and height  */
if|if
condition|(
operator|(
name|frame_widget
operator|->
name|width
operator|!=
name|naviD
operator|->
name|image_width
operator|)
operator|||
operator|(
name|frame_widget
operator|->
name|height
operator|!=
name|naviD
operator|->
name|image_height
operator|)
condition|)
block|{
name|frame_widget
operator|->
name|width
operator|=
name|naviD
operator|->
name|image_width
expr_stmt|;
name|frame_widget
operator|->
name|height
operator|=
name|naviD
operator|->
name|image_height
expr_stmt|;
if|if
condition|(
name|frame_widget
operator|->
name|width
operator|<
literal|1
condition|)
name|frame_widget
operator|->
name|width
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|frame_widget
operator|->
name|height
operator|<
literal|1
condition|)
name|frame_widget
operator|->
name|height
operator|=
literal|1
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|frame_widget
operator|->
name|frame_preview
argument_list|)
argument_list|,
name|naviD
operator|->
name|image_width
operator|+
literal|4
argument_list|,
name|naviD
operator|->
name|image_height
operator|+
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|pixmap
condition|)
block|{
name|gdk_pixmap_unref
argument_list|(
operator|*
name|pixmap
argument_list|)
expr_stmt|;
operator|*
name|pixmap
operator|=
name|NULL
expr_stmt|;
block|}
block|}
comment|/*  allocate the layer widget pixmap  */
if|if
condition|(
operator|!
operator|*
name|pixmap
condition|)
block|{
operator|*
name|pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|naviD
operator|->
name|image_width
argument_list|,
name|naviD
operator|->
name|image_height
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|naviD
operator|->
name|preview_size
operator|<
literal|1
condition|)
block|{
comment|/* preview_size is none, render a default icon */
name|render_no_preview
argument_list|(
name|widget
argument_list|,
operator|*
name|pixmap
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|TRUE
operator|==
name|render_preview
argument_list|(
name|naviD
operator|->
name|frame_preview
argument_list|,
name|frame_widget
argument_list|)
condition|)
block|{
name|gtk_preview_put
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|naviD
operator|->
name|frame_preview
argument_list|)
argument_list|,
operator|*
name|pixmap
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|naviD
operator|->
name|image_width
argument_list|,
name|naviD
operator|->
name|image_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* frame has no thumbnail (.xvpics), render a default icon */
name|render_no_preview
argument_list|(
name|widget
argument_list|,
operator|*
name|pixmap
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  make sure the image has been transfered completely to the pixmap before    *  we use it again...    */
name|gdk_flush
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/* end frame_widget_preview_redraw */
end_comment

begin_function
specifier|static
name|gint
DECL|function|frame_widget_preview_events (GtkWidget * widget,GdkEvent * event)
name|frame_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventExpose
modifier|*
name|eevent
decl_stmt|;
name|GdkPixmap
modifier|*
modifier|*
name|pixmap
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|FrameWidget
modifier|*
name|frame_widget
decl_stmt|;
name|int
name|valid
decl_stmt|;
name|int
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|;
name|pixmap
operator|=
name|NULL
expr_stmt|;
name|valid
operator|=
name|FALSE
expr_stmt|;
name|frame_widget
operator|=
operator|(
name|FrameWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|frame_widget
operator|->
name|frame_nr
operator|<
literal|0
condition|)
block|{
return|return
name|FALSE
return|;
block|}
name|pixmap
operator|=
operator|&
name|frame_widget
operator|->
name|frame_pixmap
expr_stmt|;
comment|/*   valid = GIMP_DRAWABLE(frame_widget->layer)->preview_valid; */
comment|/* ?? */
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_2BUTTON_PRESS
case|:
name|navi_dialog_goto_callback
argument_list|(
name|frame_widget
operator|->
name|frame_nr
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
case|case
name|GDK_BUTTON_PRESS
case|:
comment|/*  Control-button press disables the application of the mask  */
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_preview_events GDK_BUTTON_PRESS button:%d NOT IMPLEMENTED\n"
argument_list|,
operator|(
name|int
operator|)
name|bevent
operator|->
name|button
argument_list|)
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
comment|/*  * 	  gtk_menu_popup (GTK_MENU (naviD->ops_menu),  * 			  NULL, NULL, NULL, NULL,  * 			  3, bevent->time);  */
return|return
name|TRUE
return|;
block|}
if|if
condition|(
name|event
operator|->
name|button
operator|.
name|state
operator|&
name|GDK_CONTROL_MASK
condition|)
block|{       }
comment|/*  Alt-button press makes the mask visible instead of the layer  */
elseif|else
if|if
condition|(
name|event
operator|->
name|button
operator|.
name|state
operator|&
name|GDK_MOD1_MASK
condition|)
block|{       }
break|break;
case|case
name|GDK_EXPOSE
case|:
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_preview_events GDK_EXPOSE\n"
argument_list|)
expr_stmt|;
name|navi_preview_extents
argument_list|()
expr_stmt|;
name|frame_widget_time_label_update
argument_list|(
name|frame_widget
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|valid
operator|||
operator|!
operator|*
name|pixmap
condition|)
block|{
name|frame_widget_preview_redraw
argument_list|(
name|frame_widget
argument_list|)
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
operator|*
name|pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|naviD
operator|->
name|image_width
argument_list|,
name|naviD
operator|->
name|image_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|eevent
operator|=
operator|(
name|GdkEventExpose
operator|*
operator|)
name|event
expr_stmt|;
name|w
operator|=
name|eevent
operator|->
name|area
operator|.
name|width
expr_stmt|;
name|h
operator|=
name|eevent
operator|->
name|area
operator|.
name|height
expr_stmt|;
if|if
condition|(
name|eevent
operator|->
name|area
operator|.
name|x
operator|<
literal|2
condition|)
block|{
name|sx
operator|=
name|eevent
operator|->
name|area
operator|.
name|x
expr_stmt|;
name|dx
operator|=
literal|2
expr_stmt|;
name|w
operator|-=
operator|(
literal|2
operator|-
name|eevent
operator|->
name|area
operator|.
name|x
operator|)
expr_stmt|;
block|}
else|else
block|{
name|sx
operator|=
name|eevent
operator|->
name|area
operator|.
name|x
operator|-
literal|2
expr_stmt|;
name|dx
operator|=
name|eevent
operator|->
name|area
operator|.
name|x
expr_stmt|;
block|}
if|if
condition|(
name|eevent
operator|->
name|area
operator|.
name|y
operator|<
literal|2
condition|)
block|{
name|sy
operator|=
name|eevent
operator|->
name|area
operator|.
name|y
expr_stmt|;
name|dy
operator|=
literal|2
expr_stmt|;
name|h
operator|-=
operator|(
literal|2
operator|-
name|eevent
operator|->
name|area
operator|.
name|y
operator|)
expr_stmt|;
block|}
else|else
block|{
name|sy
operator|=
name|eevent
operator|->
name|area
operator|.
name|y
operator|-
literal|2
expr_stmt|;
name|dy
operator|=
name|eevent
operator|->
name|area
operator|.
name|y
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|sx
operator|+
name|w
operator|)
operator|>=
name|naviD
operator|->
name|image_width
condition|)
block|{
name|w
operator|=
name|naviD
operator|->
name|image_width
operator|-
name|sx
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|sy
operator|+
name|h
operator|)
operator|>=
name|naviD
operator|->
name|image_height
condition|)
block|{
name|h
operator|=
name|naviD
operator|->
name|image_height
operator|-
name|sy
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|w
operator|>
literal|0
operator|)
operator|&&
operator|(
name|h
operator|>
literal|0
operator|)
condition|)
block|{
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
operator|*
name|pixmap
argument_list|,
name|sx
argument_list|,
name|sy
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  The boundary indicating whether layer or mask is active  */
comment|/* frames do not have boundary */
comment|/* frame_widget_boundary_redraw (frame_widget); */
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* end  frame_widget_preview_events */
end_comment

begin_function
specifier|static
name|gint
DECL|function|navi_dialog_poll (GtkWidget * w,gpointer data)
name|navi_dialog_poll
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint32
name|frame_nr
decl_stmt|;
name|gint32
name|update_flag
decl_stmt|;
name|gint32
name|video_preview_size
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_poll  TIMER POLL\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
condition|)
block|{
if|if
condition|(
name|suspend_gimage_notify
operator|==
literal|0
condition|)
block|{
name|update_flag
operator|=
name|NUPD_IMAGE_MENU
expr_stmt|;
name|video_preview_size
operator|=
name|navi_get_preview_size
argument_list|()
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|preview_size
operator|!=
name|video_preview_size
condition|)
block|{
name|naviD
operator|->
name|preview_size
operator|=
name|video_preview_size
expr_stmt|;
name|update_flag
operator|=
name|NUPD_ALL
expr_stmt|;
block|}
comment|/* check and enable/disable tooltips */
name|navi_dialog_tooltips
argument_list|()
expr_stmt|;
name|frame_nr
operator|=
name|p_get_frame_nr
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
if|if
condition|(
name|frame_nr
operator|<
literal|0
condition|)
block|{
comment|/* no valid frame number, maybe frame was closed 	     */
name|naviD
operator|->
name|active_imageid
operator|=
operator|-
literal|1
expr_stmt|;
name|update_flag
operator|=
name|NUPD_ALL
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
condition|)
block|{
name|update_flag
operator|=
name|NUPD_IMAGE_MENU
operator||
name|NUPD_FRAME_NR_CHANGED
expr_stmt|;
block|}
else|else
block|{
name|update_flag
operator|=
name|NUPD_ALL
expr_stmt|;
block|}
block|}
name|navi_dialog_update
argument_list|(
name|update_flag
argument_list|)
expr_stmt|;
block|}
comment|/* restart timer */
name|naviD
operator|->
name|timer
operator|=
name|gtk_timeout_add
argument_list|(
name|naviD
operator|->
name|cycle_time
argument_list|,
operator|(
name|GtkFunction
operator|)
name|navi_dialog_poll
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navid_thumb_timestamp_check (void)
name|navid_thumb_timestamp_check
parameter_list|(
name|void
parameter_list|)
block|{
name|struct
name|stat
name|l_stat_thumb
decl_stmt|;
name|FrameWidget
modifier|*
name|fw
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gint
name|item_count
decl_stmt|;
if|if
condition|(
name|naviD
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|==
name|NULL
condition|)
return|return;
name|adj
operator|=
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navid_thumb_timestamp_check: adj->value:%d  adj->page_size:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|adj
operator|->
name|value
argument_list|,
operator|(
name|int
operator|)
name|adj
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|list
operator|=
name|naviD
operator|->
name|frame_widgets
expr_stmt|;
name|item_count
operator|=
operator|-
literal|1
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|item_count
operator|++
expr_stmt|;
name|fw
operator|=
operator|(
name|FrameWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|item_count
operator|*
name|naviD
operator|->
name|item_height
operator|)
operator|<
operator|(
name|adj
operator|->
name|value
operator|-
name|naviD
operator|->
name|image_height
operator|)
condition|)
block|{
continue|continue;
comment|/* WIDGET IS NOT EXPOSED */
block|}
if|if
condition|(
operator|(
name|item_count
operator|*
name|naviD
operator|->
name|item_height
operator|)
operator|>
operator|(
name|adj
operator|->
name|value
operator|+
name|adj
operator|->
name|page_size
operator|)
condition|)
block|{
return|return;
comment|/* WIDGET (and all further widgets) ARE NOT EXPOSED */
block|}
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navid_thumb_timestamp_check: Widget IS EXPOSED frame_nr:%04d\n"
argument_list|,
operator|(
name|int
operator|)
name|fw
operator|->
name|frame_nr
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw
operator|->
name|frame_nr
operator|==
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|curr_frame_nr
condition|)
block|{
comment|/* always redraw the currently opened frame 	 * (the render procedure uses gimp's internal chached thumbnaildata 	 * so the timestamp of the .xvpics thumbnailfile does not matter here) 	 */
name|gtk_widget_draw
argument_list|(
name|fw
operator|->
name|frame_preview
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* for the other exposed items we check the tumbnail timestamp */
if|if
condition|(
name|fw
operator|->
name|thumb_filename
condition|)
block|{
if|if
condition|(
literal|0
operator|==
name|stat
argument_list|(
name|fw
operator|->
name|thumb_filename
argument_list|,
operator|&
name|l_stat_thumb
argument_list|)
condition|)
block|{
if|if
condition|(
name|fw
operator|->
name|thumb_timestamp
operator|<
name|l_stat_thumb
operator|.
name|st_mtime
condition|)
block|{
name|gtk_widget_draw
argument_list|(
name|fw
operator|->
name|frame_preview
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_dialog_update (gint32 update_flag)
name|navi_dialog_update
parameter_list|(
name|gint32
name|update_flag
parameter_list|)
block|{
name|gint32
name|l_first
decl_stmt|,
name|l_last
decl_stmt|;
name|gint
name|l_image_menu_was_changed
decl_stmt|;
name|l_image_menu_was_changed
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|update_flag
operator|&
name|NUPD_IMAGE_MENU
condition|)
block|{
name|l_image_menu_was_changed
operator|=
name|navi_refresh_image_menu
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|update_flag
operator|&
name|NUPD_FRAME_NR_CHANGED
condition|)
block|{
name|l_first
operator|=
operator|-
literal|1
expr_stmt|;
name|l_last
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
condition|)
block|{
name|l_first
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
expr_stmt|;
name|l_last
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
expr_stmt|;
block|}
name|navi_reload_ainfo
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
name|navi_preview_extents
argument_list|()
expr_stmt|;
comment|/* we must force a rebuild of the list of frame_widgets       * if any frames were deleteted or are created        * (outside of the naviagator)       */
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
condition|)
block|{
if|if
condition|(
operator|(
name|l_first
operator|!=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
operator|)
operator|||
operator|(
name|l_last
operator|!=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
operator|)
condition|)
block|{
name|update_flag
operator||=
name|NUPD_PREV_LIST
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|update_flag
operator|&
name|NUPD_PREV_LIST
condition|)
block|{
name|frames_dialog_flush
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|navid_thumb_timestamp_check
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* ------------------------  * dialog helper procedures  * ------------------------   */
end_comment

begin_function
specifier|static
name|void
DECL|function|navi_preview_extents (void)
name|navi_preview_extents
parameter_list|(
name|void
parameter_list|)
block|{
name|gint32
name|width
decl_stmt|,
name|height
decl_stmt|;
if|if
condition|(
operator|!
name|naviD
condition|)
return|return;
name|naviD
operator|->
name|gimage_width
operator|=
name|gimp_image_width
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|gimage_height
operator|=
name|gimp_image_height
argument_list|(
name|naviD
operator|->
name|active_imageid
argument_list|)
expr_stmt|;
comment|/*  Get the image width and height variables, based on the gimage  */
if|if
condition|(
name|naviD
operator|->
name|gimage_width
operator|>
name|naviD
operator|->
name|gimage_height
condition|)
block|{
name|naviD
operator|->
name|ratio
operator|=
operator|(
name|double
operator|)
name|naviD
operator|->
name|preview_size
operator|/
operator|(
name|double
operator|)
name|naviD
operator|->
name|gimage_width
expr_stmt|;
block|}
else|else
block|{
name|naviD
operator|->
name|ratio
operator|=
operator|(
name|double
operator|)
name|naviD
operator|->
name|preview_size
operator|/
operator|(
name|double
operator|)
name|naviD
operator|->
name|gimage_height
expr_stmt|;
block|}
if|if
condition|(
name|naviD
operator|->
name|preview_size
operator|>
literal|0
condition|)
block|{
name|width
operator|=
call|(
name|int
call|)
argument_list|(
name|naviD
operator|->
name|ratio
operator|*
name|naviD
operator|->
name|gimage_width
argument_list|)
expr_stmt|;
name|height
operator|=
call|(
name|int
call|)
argument_list|(
name|naviD
operator|->
name|ratio
operator|*
name|naviD
operator|->
name|gimage_height
argument_list|)
expr_stmt|;
if|if
condition|(
name|width
operator|<
literal|1
condition|)
name|width
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|height
operator|<
literal|1
condition|)
name|height
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|width
operator|=
literal|16
expr_stmt|;
name|height
operator|=
literal|10
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|naviD
operator|->
name|image_width
operator|!=
name|width
operator|)
operator|||
operator|(
name|naviD
operator|->
name|image_height
operator|!=
name|height
operator|)
condition|)
block|{
name|naviD
operator|->
name|image_width
operator|=
name|width
expr_stmt|;
name|naviD
operator|->
name|image_height
operator|=
name|height
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|naviD
operator|->
name|frame_preview
argument_list|)
argument_list|,
name|naviD
operator|->
name|image_width
argument_list|,
name|naviD
operator|->
name|image_height
argument_list|)
expr_stmt|;
block|}
name|naviD
operator|->
name|item_height
operator|=
literal|6
operator|+
name|naviD
operator|->
name|image_height
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_preview_extents w: %d h:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|image_width
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|image_height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|navi_calc_frametiming (gint32 frame_nr,char * buf)
name|navi_calc_frametiming
parameter_list|(
name|gint32
name|frame_nr
parameter_list|,
name|char
modifier|*
name|buf
parameter_list|)
block|{
name|gint32
name|first
decl_stmt|;
name|gdouble
name|msec_per_frame
decl_stmt|;
name|gint32
name|tmsec
decl_stmt|;
name|gint32
name|tms
decl_stmt|;
name|gint32
name|tsec
decl_stmt|;
name|gint32
name|tmin
decl_stmt|;
name|first
operator|=
name|frame_nr
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
condition|)
block|{
name|first
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
expr_stmt|;
block|}
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|==
name|NULL
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"min:sec:msec"
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
operator|<
literal|1
condition|)
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"min:sec:msec"
argument_list|)
expr_stmt|;
return|return;
block|}
name|msec_per_frame
operator|=
literal|1000.0
operator|/
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
expr_stmt|;
name|tmsec
operator|=
operator|(
name|frame_nr
operator|-
name|first
operator|)
operator|*
name|msec_per_frame
expr_stmt|;
name|tms
operator|=
name|tmsec
operator|%
literal|1000
expr_stmt|;
name|tsec
operator|=
operator|(
name|tmsec
operator|/
literal|1000
operator|)
operator|%
literal|60
expr_stmt|;
name|tmin
operator|=
name|tmsec
operator|/
literal|60000
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%02d:%02d:%03d"
argument_list|,
operator|(
name|int
operator|)
name|tmin
argument_list|,
operator|(
name|int
operator|)
name|tsec
argument_list|,
operator|(
name|int
operator|)
name|tms
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|frame_widget_time_label_update (FrameWidget * fw)
name|frame_widget_time_label_update
parameter_list|(
name|FrameWidget
modifier|*
name|fw
parameter_list|)
block|{
name|char
name|frame_nr_to_time
index|[
literal|20
index|]
decl_stmt|;
name|navi_calc_frametiming
argument_list|(
name|fw
operator|->
name|frame_nr
argument_list|,
name|frame_nr_to_time
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|fw
operator|->
name|time_label
argument_list|)
argument_list|,
name|frame_nr_to_time
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|FrameWidget
modifier|*
DECL|function|frame_widget_create (gint32 image_id,gint32 frame_nr)
name|frame_widget_create
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|frame_nr
parameter_list|)
block|{
name|FrameWidget
modifier|*
name|frame_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|alignment
decl_stmt|;
name|char
name|frame_nr_to_char
index|[
literal|20
index|]
decl_stmt|;
name|char
name|frame_nr_to_time
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_create CREATE image_id:%d, nr:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|image_id
argument_list|,
operator|(
name|int
operator|)
name|frame_nr
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|gtk_list_item_new
argument_list|()
expr_stmt|;
comment|/*  create the frame widget and add it to the list  */
name|frame_widget
operator|=
name|g_new
argument_list|(
name|FrameWidget
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|frame_widget
operator|->
name|image_id
operator|=
name|image_id
expr_stmt|;
name|frame_widget
operator|->
name|frame_nr
operator|=
name|frame_nr
expr_stmt|;
name|frame_widget
operator|->
name|frame_preview
operator|=
name|NULL
expr_stmt|;
name|frame_widget
operator|->
name|frame_pixmap
operator|=
name|NULL
expr_stmt|;
name|frame_widget
operator|->
name|list_item
operator|=
name|list_item
expr_stmt|;
name|frame_widget
operator|->
name|width
operator|=
operator|-
literal|1
expr_stmt|;
name|frame_widget
operator|->
name|height
operator|=
operator|-
literal|1
expr_stmt|;
name|frame_widget
operator|->
name|thumb_timestamp
operator|=
literal|0
expr_stmt|;
name|frame_widget
operator|->
name|thumb_filename
operator|=
name|NULL
expr_stmt|;
name|frame_widget
operator|->
name|visited
operator|=
name|TRUE
expr_stmt|;
comment|/* frame_widget->drop_type     = GIMP_DROP_NONE; */
name|sprintf
argument_list|(
name|frame_nr_to_char
argument_list|,
literal|"%04d"
argument_list|,
operator|(
name|int
operator|)
name|frame_nr
argument_list|)
expr_stmt|;
name|navi_calc_frametiming
argument_list|(
name|frame_nr
argument_list|,
name|frame_nr_to_time
argument_list|)
expr_stmt|;
comment|/*  Need to let the list item know about the frame_widget  */
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|frame_widget
argument_list|)
expr_stmt|;
comment|/*  set up the list item observer  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"select"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|frame_widget_select_update
argument_list|,
name|frame_widget
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"deselect"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|frame_widget_select_update
argument_list|,
name|frame_widget
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*  the frame number label */
name|frame_widget
operator|->
name|number_label
operator|=
name|gtk_label_new
argument_list|(
name|frame_nr_to_char
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|frame_widget
operator|->
name|number_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame_widget
operator|->
name|number_label
argument_list|)
expr_stmt|;
comment|/*  The frame preview  */
name|alignment
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|alignment
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
name|frame_widget
operator|->
name|frame_preview
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|frame_widget
operator|->
name|frame_preview
argument_list|)
argument_list|,
name|naviD
operator|->
name|image_width
operator|+
literal|4
argument_list|,
name|naviD
operator|->
name|image_height
operator|+
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|frame_widget
operator|->
name|frame_preview
argument_list|,
name|PREVIEW_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|frame_widget
operator|->
name|frame_preview
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|frame_widget_preview_events
argument_list|,
name|frame_widget
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|frame_widget
operator|->
name|frame_preview
argument_list|)
argument_list|,
name|frame_widget
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|alignment
argument_list|)
argument_list|,
name|frame_widget
operator|->
name|frame_preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame_widget
operator|->
name|frame_preview
argument_list|)
expr_stmt|;
comment|/*  the frame timing label */
name|frame_widget
operator|->
name|time_label
operator|=
name|gtk_label_new
argument_list|(
name|frame_nr_to_time
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|frame_widget
operator|->
name|time_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame_widget
operator|->
name|time_label
argument_list|)
expr_stmt|;
name|frame_widget
operator|->
name|clip_widget
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|frame_widget
operator|->
name|clip_widget
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|frame_widget
operator|->
name|clip_widget
argument_list|,
name|BUTTON_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|frame_widget
operator|->
name|clip_widget
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|frame_widget_button_events
argument_list|,
name|frame_widget
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|frame_widget
operator|->
name|clip_widget
argument_list|)
argument_list|,
name|frame_widget
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame_widget
operator|->
name|clip_widget
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* gtk_widget_show (frame_widget->clip_widget); */
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"gap_framenumber"
argument_list|,
operator|(
name|gpointer
operator|)
name|frame_nr
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|gtk_widget_ref
argument_list|(
name|frame_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_create END image_id:%d, nr:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|image_id
argument_list|,
operator|(
name|int
operator|)
name|frame_nr
argument_list|)
expr_stmt|;
return|return
name|frame_widget
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|frame_widget_delete (FrameWidget * fw)
name|frame_widget_delete
parameter_list|(
name|FrameWidget
modifier|*
name|fw
parameter_list|)
block|{
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"frame_widget_delete image_id:%d frame_nr:%d\n"
argument_list|,
operator|(
name|int
operator|)
name|fw
operator|->
name|image_id
argument_list|,
operator|(
name|int
operator|)
name|fw
operator|->
name|frame_nr
argument_list|)
expr_stmt|;
if|if
condition|(
name|fw
operator|->
name|frame_pixmap
condition|)
block|{
name|gdk_pixmap_unref
argument_list|(
name|fw
operator|->
name|frame_pixmap
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fw
operator|->
name|thumb_filename
condition|)
name|g_free
argument_list|(
name|fw
operator|->
name|thumb_filename
argument_list|)
expr_stmt|;
comment|/*  Remove the layer widget from the list  */
name|naviD
operator|->
name|frame_widgets
operator|=
name|g_slist_remove
argument_list|(
name|naviD
operator|->
name|frame_widgets
argument_list|,
name|fw
argument_list|)
expr_stmt|;
comment|/*  Release the widget  */
name|gtk_widget_unref
argument_list|(
name|fw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|fw
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|navi_dialog_create (GtkWidget * shell,gint32 image_id)
name|navi_dialog_create
parameter_list|(
name|GtkWidget
modifier|*
name|shell
parameter_list|,
name|gint32
name|image_id
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|util_box
decl_stmt|;
name|GtkWidget
modifier|*
name|button_box
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|slider
decl_stmt|;
name|char
modifier|*
name|l_basename
decl_stmt|;
name|char
name|frame_nr_to_char
index|[
literal|20
index|]
decl_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_create\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
condition|)
block|{
return|return
name|naviD
operator|->
name|vbox
return|;
block|}
name|l_basename
operator|=
name|NULL
expr_stmt|;
name|sprintf
argument_list|(
name|frame_nr_to_char
argument_list|,
literal|"0000 - 0000"
argument_list|)
expr_stmt|;
name|naviD
operator|=
name|g_new
argument_list|(
name|NaviDialog
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|waiting_cursor
operator|=
name|FALSE
expr_stmt|;
name|naviD
operator|->
name|cursor_wait
operator|=
name|gdk_cursor_new
argument_list|(
name|GDK_WATCH
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|cursor_acitve
operator|=
name|gdk_cursor_new
argument_list|(
name|GDK_TOP_LEFT_ARROW
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|shell
operator|=
name|shell
expr_stmt|;
name|naviD
operator|->
name|frame_preview
operator|=
name|NULL
expr_stmt|;
name|naviD
operator|->
name|OpenFrameImagesList
operator|=
name|NULL
expr_stmt|;
name|naviD
operator|->
name|OpenFrameImagesCount
operator|=
literal|0
expr_stmt|;
name|naviD
operator|->
name|any_imageid
operator|=
operator|-
literal|1
expr_stmt|;
name|naviD
operator|->
name|frame_widgets
operator|=
name|NULL
expr_stmt|;
name|naviD
operator|->
name|cycle_time
operator|=
literal|1000
expr_stmt|;
comment|/* polling cylcle of 1 sec */
name|naviD
operator|->
name|timer
operator|=
literal|0
expr_stmt|;
name|naviD
operator|->
name|active_imageid
operator|=
name|image_id
expr_stmt|;
comment|/*  naviD->ainfo_ptr  = navi_get_ainfo(naviD->active_imageid, NULL); */
name|naviD
operator|->
name|ainfo_ptr
operator|=
name|NULL
expr_stmt|;
name|naviD
operator|->
name|framerange_number_label
operator|=
name|NULL
expr_stmt|;
name|navi_reload_ainfo_force
argument_list|(
name|image_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|ainfo_ptr
operator|!=
name|NULL
condition|)
block|{
name|sprintf
argument_list|(
name|frame_nr_to_char
argument_list|,
literal|"%04d - %04d"
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|first_frame_nr
argument_list|,
operator|(
name|int
operator|)
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|last_frame_nr
argument_list|)
expr_stmt|;
name|l_basename
operator|=
name|naviD
operator|->
name|ainfo_ptr
operator|->
name|basename
expr_stmt|;
block|}
name|naviD
operator|->
name|vin_ptr
operator|=
name|p_get_video_info
argument_list|(
name|l_basename
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|image_width
operator|=
literal|0
expr_stmt|;
name|naviD
operator|->
name|image_height
operator|=
literal|0
expr_stmt|;
name|naviD
operator|->
name|preview_size
operator|=
name|navi_get_preview_size
argument_list|()
expr_stmt|;
if|if
condition|(
name|naviD
operator|->
name|preview_size
operator|>
literal|0
condition|)
block|{
name|naviD
operator|->
name|frame_preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|navi_preview_extents
argument_list|()
expr_stmt|;
block|}
name|naviD
operator|->
name|tooltip_on
operator|=
operator|-
literal|44
expr_stmt|;
name|naviD
operator|->
name|tool_tips
operator|=
name|gtk_tooltips_new
argument_list|()
expr_stmt|;
name|navi_dialog_tooltips
argument_list|()
expr_stmt|;
comment|/*  The main vbox  */
name|naviD
operator|->
name|vbox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|naviD
operator|->
name|vbox
argument_list|,
name|NULL
argument_list|,
literal|"dialogs/layers/layers.html"
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|naviD
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
comment|/*  The image menu  */
name|util_box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|util_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|image_option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|naviD
operator|->
name|image_menu
operator|=
name|NULL
expr_stmt|;
name|navi_refresh_image_menu
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|util_box
argument_list|)
argument_list|,
name|naviD
operator|->
name|image_option_menu
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|image_option_menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|image_menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|util_box
argument_list|)
expr_stmt|;
comment|/*  the Framerange label */
name|util_box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|util_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Videoframes:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|util_box
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/*  the max frame number label */
name|naviD
operator|->
name|framerange_number_label
operator|=
name|gtk_label_new
argument_list|(
name|frame_nr_to_char
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|util_box
argument_list|)
argument_list|,
name|naviD
operator|->
name|framerange_number_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|framerange_number_label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|util_box
argument_list|)
expr_stmt|;
comment|/*  framerate scale  */
name|naviD
operator|->
name|framerate_box
operator|=
name|util_box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|util_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Framerate:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|util_box
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|framerate_data
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gtk_adjustment_new
argument_list|(
name|naviD
operator|->
name|vin_ptr
operator|->
name|framerate
argument_list|,
literal|1.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|naviD
operator|->
name|framerate_data
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
comment|/* GTK_UPDATE_CONTINUOUS */
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_RIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|util_box
argument_list|)
argument_list|,
name|slider
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|naviD
operator|->
name|framerate_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|navi_framerate_scale_update
argument_list|,
name|naviD
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|slider
argument_list|,
name|NULL
argument_list|,
literal|"#framerate_scale"
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|util_box
argument_list|)
expr_stmt|;
comment|/*  timezoom scale  */
name|naviD
operator|->
name|timezoom_box
operator|=
name|util_box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|util_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Timezoom:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|util_box
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|timezoom_data
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gtk_adjustment_new
argument_list|(
operator|(
name|gdouble
operator|)
name|naviD
operator|->
name|vin_ptr
operator|->
name|timezoom
argument_list|,
literal|1.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|naviD
operator|->
name|timezoom_data
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_RIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|util_box
argument_list|)
argument_list|,
name|slider
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|naviD
operator|->
name|timezoom_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|navi_timezoom_scale_update
argument_list|,
name|naviD
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|slider
argument_list|,
name|NULL
argument_list|,
literal|"#timezoom_scale"
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|util_box
argument_list|)
expr_stmt|;
comment|/*  The frames listbox  */
name|naviD
operator|->
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_ALWAYS
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|,
name|LIST_WIDTH
argument_list|,
name|LIST_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|naviD
operator|->
name|scrolled_win
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|naviD
operator|->
name|frame_list
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_scrolled_window_add_with_viewport
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
argument_list|,
name|naviD
operator|->
name|frame_list
argument_list|)
expr_stmt|;
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|naviD
operator|->
name|frame_list
argument_list|)
argument_list|,
name|GTK_SELECTION_EXTENDED
argument_list|)
expr_stmt|;
comment|/* GTK_SELECTION_BROWSE */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|naviD
operator|->
name|frame_list
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|frame_list_events
argument_list|,
name|naviD
argument_list|)
expr_stmt|;
name|gtk_container_set_focus_vadjustment
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|naviD
operator|->
name|frame_list
argument_list|)
argument_list|,
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
operator|->
name|vscrollbar
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|frame_list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|scrolled_win
argument_list|)
expr_stmt|;
comment|/*  The ops buttons  */
name|button_box
operator|=
name|ops_button_box_new
argument_list|(
name|naviD
operator|->
name|shell
argument_list|,
name|frames_ops_buttons
argument_list|,
name|OPS_BUTTON_NORMAL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button_box
argument_list|)
expr_stmt|;
comment|/*  The VCR ops buttons  */
name|button_box
operator|=
name|ops_button_box_new
argument_list|(
name|naviD
operator|->
name|shell
argument_list|,
name|vcr_ops_buttons
argument_list|,
name|OPS_BUTTON_NORMAL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button_box
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|naviD
operator|->
name|vbox
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"navi_dialog_create END\n"
argument_list|)
expr_stmt|;
return|return
name|naviD
operator|->
name|vbox
return|;
block|}
end_function

begin_comment
comment|/* ---------------------------------  * the navigator MAIN dialog  * ---------------------------------  */
end_comment

begin_function
DECL|function|gap_navigator (gint32 image_id)
name|int
name|gap_navigator
parameter_list|(
name|gint32
name|image_id
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|shell
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|subshell
decl_stmt|;
name|gint
name|argc
init|=
literal|1
decl_stmt|;
name|guchar
modifier|*
name|color_cube
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|argv
init|=
name|g_new
argument_list|(
name|gchar
operator|*
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|argv
index|[
literal|0
index|]
operator|=
name|g_strdup
argument_list|(
literal|"gap_navigator"
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"\nSTARTing gap_navigator_dialog\n"
argument_list|)
expr_stmt|;
comment|/* Init GTK  */
name|gtk_init
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|)
expr_stmt|;
name|gtk_rc_parse
argument_list|(
name|gimp_gtkrc
argument_list|()
argument_list|)
expr_stmt|;
name|gdk_set_use_xshm
argument_list|(
name|gimp_use_xshm
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_preview_set_gamma
argument_list|(
name|gimp_gamma
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_preview_set_install_cmap
argument_list|(
name|gimp_install_cmap
argument_list|()
argument_list|)
expr_stmt|;
name|color_cube
operator|=
name|gimp_color_cube
argument_list|()
expr_stmt|;
name|gtk_preview_set_color_cube
argument_list|(
name|color_cube
index|[
literal|0
index|]
argument_list|,
name|color_cube
index|[
literal|1
index|]
argument_list|,
name|color_cube
index|[
literal|2
index|]
argument_list|,
name|color_cube
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
comment|/*   gtk_widget_set_default_visual (gtk_preview_get_visual ());  */
name|gtk_widget_set_default_colormap
argument_list|(
name|gtk_preview_get_cmap
argument_list|()
argument_list|)
expr_stmt|;
comment|/*  The main shell */
name|shell
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
literal|"gap_navigator"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Video Navigator"
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  The subshell (toplevel vbox)  */
name|subshell
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|subshell
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"BEFORE  navi_dialog_create\n"
argument_list|)
expr_stmt|;
comment|/*  The naviD dialog structure  */
name|navi_dialog_create
argument_list|(
name|shell
argument_list|,
name|image_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"AFTER  navi_dialog_create\n"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|subshell
argument_list|)
argument_list|,
name|naviD
operator|->
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|shell
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|navi_delete_callback
argument_list|)
argument_list|,
name|naviD
argument_list|)
expr_stmt|;
comment|/*  The action area  */
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*  The close button */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Close"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|navi_delete_callback
argument_list|)
argument_list|,
name|naviD
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|subshell
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
argument_list|)
expr_stmt|;
name|frames_dialog_flush
argument_list|()
expr_stmt|;
name|navi_scroll_to_current_frame_nr
argument_list|()
expr_stmt|;
name|naviD
operator|->
name|timer
operator|=
name|gtk_timeout_add
argument_list|(
name|naviD
operator|->
name|cycle_time
argument_list|,
operator|(
name|GtkFunction
operator|)
name|navi_dialog_poll
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"BEFORE  gtk_main\n"
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
if|if
condition|(
name|gap_debug
condition|)
name|printf
argument_list|(
literal|"END gap_navigator_dialog\n"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  * Some Code Parts copied from gimp/app directory  * XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  */
end_comment

begin_comment
comment|/* ---------------------------------------  start copy of gimp-1.1.14/app/fileops.c readXVThumb */
end_comment

begin_comment
comment|/* The readXVThumb function source may be re-used under    the XFree86-style license.<adam@gimp.org> */
end_comment

begin_function
name|guchar
modifier|*
DECL|function|readXVThumb (const gchar * fnam,gint * w,gint * h,gchar ** imginfo)
name|readXVThumb
parameter_list|(
specifier|const
name|gchar
modifier|*
name|fnam
parameter_list|,
name|gint
modifier|*
name|w
parameter_list|,
name|gint
modifier|*
name|h
parameter_list|,
name|gchar
modifier|*
modifier|*
name|imginfo
comment|/* caller frees if != NULL */
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|P7_332
init|=
literal|"P7 332"
decl_stmt|;
name|gchar
name|P7_buf
index|[
literal|7
index|]
decl_stmt|;
name|gchar
name|linebuf
index|[
literal|200
index|]
decl_stmt|;
name|guchar
modifier|*
name|buf
decl_stmt|;
name|gint
name|twofivefive
decl_stmt|;
name|void
modifier|*
name|ptr
decl_stmt|;
operator|*
name|w
operator|=
operator|*
name|h
operator|=
literal|0
expr_stmt|;
operator|*
name|imginfo
operator|=
name|NULL
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|fnam
argument_list|,
literal|"rb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|fread
argument_list|(
name|P7_buf
argument_list|,
literal|6
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|P7_buf
argument_list|,
name|P7_332
argument_list|,
literal|6
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|g_warning
argument_list|(
literal|"Thumbnail doesn't have the 'P7 332' header."
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*newline*/
name|fread
argument_list|(
name|P7_buf
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
do|do
block|{
name|ptr
operator|=
name|fgets
argument_list|(
name|linebuf
argument_list|,
literal|199
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|strncmp
argument_list|(
name|linebuf
argument_list|,
literal|"#IMGINFO:"
argument_list|,
literal|9
argument_list|)
operator|==
literal|0
operator|)
operator|&&
operator|(
name|linebuf
index|[
literal|9
index|]
operator|!=
literal|'\0'
operator|)
operator|&&
operator|(
name|linebuf
index|[
literal|9
index|]
operator|!=
literal|'\n'
operator|)
condition|)
block|{
if|if
condition|(
name|linebuf
index|[
name|strlen
argument_list|(
name|linebuf
argument_list|)
operator|-
literal|1
index|]
operator|==
literal|'\n'
condition|)
name|linebuf
index|[
name|strlen
argument_list|(
name|linebuf
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|linebuf
index|[
literal|9
index|]
operator|!=
literal|'\0'
condition|)
block|{
if|if
condition|(
operator|*
name|imginfo
condition|)
name|g_free
argument_list|(
operator|*
name|imginfo
argument_list|)
expr_stmt|;
operator|*
name|imginfo
operator|=
name|g_strdup
argument_list|(
operator|&
name|linebuf
index|[
literal|9
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
do|while
condition|(
name|ptr
operator|&&
name|linebuf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
do|;
comment|/* keep throwing away comment lines */
if|if
condition|(
operator|!
name|ptr
condition|)
block|{
comment|/* g_warning("Thumbnail ended - not an image?"); */
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|sscanf
argument_list|(
name|linebuf
argument_list|,
literal|"%d %d %d\n"
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
operator|&
name|twofivefive
argument_list|)
expr_stmt|;
if|if
condition|(
name|twofivefive
operator|!=
literal|255
condition|)
block|{
name|g_warning
argument_list|(
literal|"Thumbnail is of funky depth."
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
operator|(
operator|*
name|w
operator|)
operator|<
literal|1
operator|||
operator|(
operator|*
name|h
operator|)
operator|<
literal|1
operator|||
operator|(
operator|*
name|w
operator|)
operator|>
literal|80
operator|||
operator|(
operator|*
name|h
operator|)
operator|>
literal|60
condition|)
block|{
name|g_warning
argument_list|(
literal|"Thumbnail size bad.  Corrupted?"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|buf
operator|=
name|g_malloc
argument_list|(
operator|(
operator|*
name|w
operator|)
operator|*
operator|(
operator|*
name|h
operator|)
argument_list|)
expr_stmt|;
name|fread
argument_list|(
name|buf
argument_list|,
operator|(
operator|*
name|w
operator|)
operator|*
operator|(
operator|*
name|h
operator|)
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
name|buf
operator|)
return|;
block|}
end_function

begin_comment
comment|/* ---------------------------------------  end copy of  gimp-1.1.14/app/fileops.c readXVThumb */
end_comment

begin_comment
comment|/* ---------------------------------------  start copy of gimp-1.1.14/app/ops_buttons.c */
end_comment

begin_function_decl
specifier|static
name|void
name|ops_button_pressed_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ops_button_extended_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|GtkWidget
modifier|*
DECL|function|ops_button_box_new (GtkWidget * parent,OpsButton * ops_button,OpsButtonType ops_type)
name|ops_button_box_new
parameter_list|(
name|GtkWidget
modifier|*
name|parent
parameter_list|,
name|OpsButton
modifier|*
name|ops_button
parameter_list|,
name|OpsButtonType
name|ops_type
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|button_box
decl_stmt|;
name|GtkWidget
modifier|*
name|pixmap_widget
decl_stmt|;
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
name|GdkBitmap
modifier|*
name|mask
decl_stmt|;
name|GtkStyle
modifier|*
name|style
decl_stmt|;
name|GSList
modifier|*
name|group
init|=
name|NULL
decl_stmt|;
name|gtk_widget_realize
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|style
operator|=
name|gtk_widget_get_style
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|button_box
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
name|ops_button
operator|->
name|xpm_data
condition|)
block|{
name|pixmap
operator|=
name|gdk_pixmap_create_from_xpm_d
argument_list|(
name|parent
operator|->
name|window
argument_list|,
operator|&
name|mask
argument_list|,
operator|&
name|style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|ops_button
operator|->
name|xpm_data
argument_list|)
expr_stmt|;
name|pixmap_widget
operator|=
name|gtk_pixmap_new
argument_list|(
name|pixmap
argument_list|,
name|mask
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|ops_type
condition|)
block|{
case|case
name|OPS_BUTTON_NORMAL
case|:
name|button
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
break|break;
case|case
name|OPS_BUTTON_RADIO
case|:
name|button
operator|=
name|gtk_radio_button_new
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_mode
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
default|default :
name|button
operator|=
name|NULL
expr_stmt|;
comment|/*stop compiler complaints */
name|g_error
argument_list|(
literal|"ops_button_box_new: unknown type %d\n"
argument_list|,
name|ops_type
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
name|pixmap_widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|ops_button
operator|->
name|ext_callbacks
operator|==
name|NULL
condition|)
block|{
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ops_button
operator|->
name|callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"button_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ops_button_pressed_callback
argument_list|,
name|ops_button
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ops_button_extended_callback
argument_list|,
name|ops_button
argument_list|)
expr_stmt|;
block|}
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|gettext
argument_list|(
name|ops_button
operator|->
name|tooltip
argument_list|)
argument_list|,
name|ops_button
operator|->
name|private_tip
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|button_box
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|pixmap_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|ops_button
operator|->
name|widget
operator|=
name|button
expr_stmt|;
name|ops_button
operator|->
name|modifier
operator|=
name|OPS_BUTTON_MODIFIER_NONE
expr_stmt|;
name|ops_button
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|button_box
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ops_button_pressed_callback (GtkWidget * widget,GdkEventButton * bevent,gpointer client_data)
name|ops_button_pressed_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|OpsButton
modifier|*
name|ops_button
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|client_data
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ops_button
operator|=
operator|(
name|OpsButton
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_CONTROL_MASK
condition|)
name|ops_button
operator|->
name|modifier
operator|=
name|OPS_BUTTON_MODIFIER_SHIFT_CTRL
expr_stmt|;
else|else
name|ops_button
operator|->
name|modifier
operator|=
name|OPS_BUTTON_MODIFIER_SHIFT
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_CONTROL_MASK
condition|)
name|ops_button
operator|->
name|modifier
operator|=
name|OPS_BUTTON_MODIFIER_CTRL
expr_stmt|;
elseif|else
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_MOD1_MASK
condition|)
name|ops_button
operator|->
name|modifier
operator|=
name|OPS_BUTTON_MODIFIER_ALT
expr_stmt|;
else|else
name|ops_button
operator|->
name|modifier
operator|=
name|OPS_BUTTON_MODIFIER_NONE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ops_button_extended_callback (GtkWidget * widget,gpointer client_data)
name|ops_button_extended_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|OpsButton
modifier|*
name|ops_button
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|client_data
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|ops_button
operator|=
operator|(
name|OpsButton
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|ops_button
operator|->
name|modifier
operator|>
name|OPS_BUTTON_MODIFIER_NONE
operator|&&
name|ops_button
operator|->
name|modifier
operator|<
name|OPS_BUTTON_MODIFIER_LAST
condition|)
block|{
if|if
condition|(
name|ops_button
operator|->
name|ext_callbacks
index|[
name|ops_button
operator|->
name|modifier
operator|-
literal|1
index|]
operator|!=
name|NULL
condition|)
operator|(
name|ops_button
operator|->
name|ext_callbacks
index|[
name|ops_button
operator|->
name|modifier
operator|-
literal|1
index|]
operator|)
operator|(
name|widget
operator|,
name|NULL
operator|)
expr_stmt|;
else|else
call|(
name|ops_button
operator|->
name|callback
call|)
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
else|else
call|(
name|ops_button
operator|->
name|callback
call|)
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|ops_button
operator|->
name|modifier
operator|=
name|OPS_BUTTON_MODIFIER_NONE
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ---------------------------------------  end copy of gimp-1.1.14/app/ops_buttons.c */
end_comment

end_unit

