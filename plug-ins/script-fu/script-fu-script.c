begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<https://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"tinyscheme/scheme-private.h"
end_include

begin_include
include|#
directive|include
file|"script-fu-types.h"
end_include

begin_include
include|#
directive|include
file|"script-fu-script.h"
end_include

begin_include
include|#
directive|include
file|"script-fu-scripts.h"
end_include

begin_include
include|#
directive|include
file|"script-fu-utils.h"
end_include

begin_include
include|#
directive|include
file|"script-fu-intl.h"
end_include

begin_comment
comment|/*  *  Local Functions  */
end_comment

begin_function_decl
specifier|static
name|gboolean
name|script_fu_script_param_init
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|,
specifier|const
name|GimpValueArray
modifier|*
name|args
parameter_list|,
name|SFArgType
name|type
parameter_list|,
name|gint
name|n
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  *  Function definitions  */
end_comment

begin_function
name|SFScript
modifier|*
DECL|function|script_fu_script_new (const gchar * name,const gchar * menu_label,const gchar * blurb,const gchar * author,const gchar * copyright,const gchar * date,const gchar * image_types,gint n_args)
name|script_fu_script_new
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
specifier|const
name|gchar
modifier|*
name|menu_label
parameter_list|,
specifier|const
name|gchar
modifier|*
name|blurb
parameter_list|,
specifier|const
name|gchar
modifier|*
name|author
parameter_list|,
specifier|const
name|gchar
modifier|*
name|copyright
parameter_list|,
specifier|const
name|gchar
modifier|*
name|date
parameter_list|,
specifier|const
name|gchar
modifier|*
name|image_types
parameter_list|,
name|gint
name|n_args
parameter_list|)
block|{
name|SFScript
modifier|*
name|script
decl_stmt|;
name|script
operator|=
name|g_slice_new0
argument_list|(
name|SFScript
argument_list|)
expr_stmt|;
name|script
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|script
operator|->
name|menu_label
operator|=
name|g_strdup
argument_list|(
name|menu_label
argument_list|)
expr_stmt|;
name|script
operator|->
name|blurb
operator|=
name|g_strdup
argument_list|(
name|blurb
argument_list|)
expr_stmt|;
name|script
operator|->
name|author
operator|=
name|g_strdup
argument_list|(
name|author
argument_list|)
expr_stmt|;
name|script
operator|->
name|copyright
operator|=
name|g_strdup
argument_list|(
name|copyright
argument_list|)
expr_stmt|;
name|script
operator|->
name|date
operator|=
name|g_strdup
argument_list|(
name|date
argument_list|)
expr_stmt|;
name|script
operator|->
name|image_types
operator|=
name|g_strdup
argument_list|(
name|image_types
argument_list|)
expr_stmt|;
name|script
operator|->
name|n_args
operator|=
name|n_args
expr_stmt|;
name|script
operator|->
name|args
operator|=
name|g_new0
argument_list|(
name|SFArg
argument_list|,
name|script
operator|->
name|n_args
argument_list|)
expr_stmt|;
return|return
name|script
return|;
block|}
end_function

begin_function
name|void
DECL|function|script_fu_script_free (SFScript * script)
name|script_fu_script_free
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|script
operator|->
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|script
operator|->
name|blurb
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|script
operator|->
name|menu_label
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|script
operator|->
name|author
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|script
operator|->
name|copyright
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|script
operator|->
name|date
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|script
operator|->
name|image_types
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|script
operator|->
name|n_args
condition|;
name|i
operator|++
control|)
block|{
name|SFArg
modifier|*
name|arg
init|=
operator|&
name|script
operator|->
name|args
index|[
name|i
index|]
decl_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|label
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|arg
operator|->
name|type
condition|)
block|{
case|case
name|SF_IMAGE
case|:
case|case
name|SF_DRAWABLE
case|:
case|case
name|SF_LAYER
case|:
case|case
name|SF_CHANNEL
case|:
case|case
name|SF_VECTORS
case|:
case|case
name|SF_DISPLAY
case|:
case|case
name|SF_COLOR
case|:
case|case
name|SF_TOGGLE
case|:
break|break;
case|case
name|SF_VALUE
case|:
case|case
name|SF_STRING
case|:
case|case
name|SF_TEXT
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_value
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|value
operator|.
name|sfa_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_ADJUSTMENT
case|:
break|break;
case|case
name|SF_FILENAME
case|:
case|case
name|SF_DIRNAME
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_file
operator|.
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|value
operator|.
name|sfa_file
operator|.
name|filename
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_FONT
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_font
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|value
operator|.
name|sfa_font
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PALETTE
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_palette
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|value
operator|.
name|sfa_palette
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PATTERN
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_pattern
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|value
operator|.
name|sfa_pattern
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_GRADIENT
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_gradient
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|value
operator|.
name|sfa_gradient
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_BRUSH
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_brush
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|value
operator|.
name|sfa_brush
operator|.
name|name
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_OPTION
case|:
name|g_slist_free_full
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_option
operator|.
name|list
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|g_free
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_ENUM
case|:
name|g_free
argument_list|(
name|arg
operator|->
name|default_value
operator|.
name|sfa_enum
operator|.
name|type_name
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|g_free
argument_list|(
name|script
operator|->
name|args
argument_list|)
expr_stmt|;
name|g_slice_free
argument_list|(
name|SFScript
argument_list|,
name|script
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|script_fu_script_install_proc (GimpPlugIn * plug_in,SFScript * script,GimpRunFunc run_func)
name|script_fu_script_install_proc
parameter_list|(
name|GimpPlugIn
modifier|*
name|plug_in
parameter_list|,
name|SFScript
modifier|*
name|script
parameter_list|,
name|GimpRunFunc
name|run_func
parameter_list|)
block|{
name|GimpProcedure
modifier|*
name|procedure
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|menu_label
init|=
name|NULL
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_PLUG_IN
argument_list|(
name|plug_in
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|run_func
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Allow scripts with no menus */
if|if
condition|(
name|strncmp
argument_list|(
name|script
operator|->
name|menu_label
argument_list|,
literal|"<None>"
argument_list|,
literal|6
argument_list|)
operator|!=
literal|0
condition|)
name|menu_label
operator|=
name|script
operator|->
name|menu_label
expr_stmt|;
name|procedure
operator|=
name|gimp_procedure_new
argument_list|(
name|plug_in
argument_list|,
name|script
operator|->
name|name
argument_list|,
name|GIMP_TEMPORARY
argument_list|,
name|run_func
argument_list|,
name|script
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_procedure_set_image_types
argument_list|(
name|procedure
argument_list|,
name|script
operator|->
name|image_types
argument_list|)
expr_stmt|;
name|gimp_procedure_set_menu_label
argument_list|(
name|procedure
argument_list|,
name|menu_label
argument_list|)
expr_stmt|;
name|gimp_procedure_set_documentation
argument_list|(
name|procedure
argument_list|,
name|script
operator|->
name|blurb
argument_list|,
name|NULL
argument_list|,
name|script
operator|->
name|name
argument_list|)
expr_stmt|;
name|gimp_procedure_set_attribution
argument_list|(
name|procedure
argument_list|,
name|script
operator|->
name|author
argument_list|,
name|script
operator|->
name|copyright
argument_list|,
name|script
operator|->
name|date
argument_list|)
expr_stmt|;
name|gimp_procedure_add_argument
argument_list|(
name|procedure
argument_list|,
name|g_param_spec_enum
argument_list|(
literal|"run-mode"
argument_list|,
literal|"Run mode"
argument_list|,
literal|"The run mode"
argument_list|,
name|GIMP_TYPE_RUN_MODE
argument_list|,
name|GIMP_RUN_INTERACTIVE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|script
operator|->
name|n_args
condition|;
name|i
operator|++
control|)
block|{
name|GParamSpec
modifier|*
name|pspec
init|=
name|NULL
decl_stmt|;
switch|switch
condition|(
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|SF_IMAGE
case|:
name|pspec
operator|=
name|gimp_param_spec_image_id
argument_list|(
literal|"image"
argument_list|,
literal|"Image"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|TRUE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_DRAWABLE
case|:
name|pspec
operator|=
name|gimp_param_spec_drawable_id
argument_list|(
literal|"drawable"
argument_list|,
literal|"Drawable"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|TRUE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_LAYER
case|:
name|pspec
operator|=
name|gimp_param_spec_layer_id
argument_list|(
literal|"layer"
argument_list|,
literal|"Layer"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|TRUE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_CHANNEL
case|:
name|pspec
operator|=
name|gimp_param_spec_channel_id
argument_list|(
literal|"channel"
argument_list|,
literal|"Channel"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|TRUE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_VECTORS
case|:
name|pspec
operator|=
name|gimp_param_spec_vectors_id
argument_list|(
literal|"vectors"
argument_list|,
literal|"Vectors"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|TRUE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_DISPLAY
case|:
name|pspec
operator|=
name|gimp_param_spec_display_id
argument_list|(
literal|"display"
argument_list|,
literal|"Display"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|TRUE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_COLOR
case|:
name|pspec
operator|=
name|gimp_param_spec_rgb
argument_list|(
literal|"color"
argument_list|,
literal|"Color"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_TOGGLE
case|:
name|pspec
operator|=
name|g_param_spec_boolean
argument_list|(
literal|"toggle"
argument_list|,
literal|"Toggle"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|FALSE
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_VALUE
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"value"
argument_list|,
literal|"Value"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_STRING
case|:
case|case
name|SF_TEXT
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"string"
argument_list|,
literal|"String"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_ADJUSTMENT
case|:
name|pspec
operator|=
name|g_param_spec_double
argument_list|(
literal|"value"
argument_list|,
literal|"Value"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
operator|-
name|G_MAXDOUBLE
argument_list|,
name|G_MAXDOUBLE
argument_list|,
literal|0
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_FILENAME
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"filename"
argument_list|,
literal|"Filename"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
operator||
name|GIMP_PARAM_NO_VALIDATE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_DIRNAME
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"dirname"
argument_list|,
literal|"Dirname"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
operator||
name|GIMP_PARAM_NO_VALIDATE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_FONT
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"Font"
argument_list|,
literal|"font"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PALETTE
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"palette"
argument_list|,
literal|"Palette"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PATTERN
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"pattern"
argument_list|,
literal|"Pattern"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_BRUSH
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"brush"
argument_list|,
literal|"Brush"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_GRADIENT
case|:
name|pspec
operator|=
name|g_param_spec_string
argument_list|(
literal|"gradient"
argument_list|,
literal|"Gradient"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|NULL
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_OPTION
case|:
name|pspec
operator|=
name|g_param_spec_int
argument_list|(
literal|"option"
argument_list|,
literal|"Option"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|G_MININT
argument_list|,
name|G_MAXINT
argument_list|,
literal|0
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_ENUM
case|:
name|pspec
operator|=
name|g_param_spec_int
argument_list|(
literal|"enum"
argument_list|,
literal|"Enum"
argument_list|,
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|label
argument_list|,
name|G_MININT
argument_list|,
name|G_MAXINT
argument_list|,
literal|0
argument_list|,
name|G_PARAM_READWRITE
argument_list|)
expr_stmt|;
break|break;
block|}
name|gimp_procedure_add_argument
argument_list|(
name|procedure
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
block|}
name|gimp_plug_in_add_temp_procedure
argument_list|(
name|plug_in
argument_list|,
name|procedure
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|procedure
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|script_fu_script_uninstall_proc (GimpPlugIn * plug_in,SFScript * script)
name|script_fu_script_uninstall_proc
parameter_list|(
name|GimpPlugIn
modifier|*
name|plug_in
parameter_list|,
name|SFScript
modifier|*
name|script
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_PLUG_IN
argument_list|(
name|plug_in
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|gimp_plug_in_remove_temp_procedure
argument_list|(
name|plug_in
argument_list|,
name|script
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gchar
modifier|*
DECL|function|script_fu_script_get_title (SFScript * script)
name|script_fu_script_get_title
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|)
block|{
name|gchar
modifier|*
name|title
decl_stmt|;
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* strip mnemonics from the menupath */
name|title
operator|=
name|gimp_strip_uline
argument_list|(
name|script
operator|->
name|menu_label
argument_list|)
expr_stmt|;
comment|/* if this looks like a full menu path, use only the last part */
if|if
condition|(
name|title
index|[
literal|0
index|]
operator|==
literal|'<'
operator|&&
operator|(
name|tmp
operator|=
name|strrchr
argument_list|(
name|title
argument_list|,
literal|'/'
argument_list|)
operator|)
operator|&&
name|tmp
index|[
literal|1
index|]
condition|)
block|{
name|tmp
operator|=
name|g_strdup
argument_list|(
name|tmp
operator|+
literal|1
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|title
operator|=
name|tmp
expr_stmt|;
block|}
comment|/* cut off ellipsis */
name|tmp
operator|=
operator|(
name|strstr
argument_list|(
name|title
argument_list|,
literal|"..."
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmp
condition|)
comment|/* U+2026 HORIZONTAL ELLIPSIS */
name|tmp
operator|=
name|strstr
argument_list|(
name|title
argument_list|,
literal|"\342\200\246"
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp
operator|&&
name|tmp
operator|==
operator|(
name|title
operator|+
name|strlen
argument_list|(
name|title
argument_list|)
operator|-
literal|3
operator|)
condition|)
operator|*
name|tmp
operator|=
literal|'\0'
expr_stmt|;
return|return
name|title
return|;
block|}
end_function

begin_function
name|void
DECL|function|script_fu_script_reset (SFScript * script,gboolean reset_ids)
name|script_fu_script_reset
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|,
name|gboolean
name|reset_ids
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|script
operator|->
name|n_args
condition|;
name|i
operator|++
control|)
block|{
name|SFArgValue
modifier|*
name|value
init|=
operator|&
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|value
decl_stmt|;
name|SFArgValue
modifier|*
name|default_value
init|=
operator|&
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|default_value
decl_stmt|;
switch|switch
condition|(
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|SF_IMAGE
case|:
case|case
name|SF_DRAWABLE
case|:
case|case
name|SF_LAYER
case|:
case|case
name|SF_CHANNEL
case|:
case|case
name|SF_VECTORS
case|:
case|case
name|SF_DISPLAY
case|:
if|if
condition|(
name|reset_ids
condition|)
name|value
operator|->
name|sfa_image
operator|=
name|default_value
operator|->
name|sfa_image
expr_stmt|;
break|break;
case|case
name|SF_COLOR
case|:
name|value
operator|->
name|sfa_color
operator|=
name|default_value
operator|->
name|sfa_color
expr_stmt|;
break|break;
case|case
name|SF_TOGGLE
case|:
name|value
operator|->
name|sfa_toggle
operator|=
name|default_value
operator|->
name|sfa_toggle
expr_stmt|;
break|break;
case|case
name|SF_VALUE
case|:
case|case
name|SF_STRING
case|:
case|case
name|SF_TEXT
case|:
name|g_free
argument_list|(
name|value
operator|->
name|sfa_value
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_value
operator|=
name|g_strdup
argument_list|(
name|default_value
operator|->
name|sfa_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_ADJUSTMENT
case|:
name|value
operator|->
name|sfa_adjustment
operator|.
name|value
operator|=
name|default_value
operator|->
name|sfa_adjustment
operator|.
name|value
expr_stmt|;
break|break;
case|case
name|SF_FILENAME
case|:
case|case
name|SF_DIRNAME
case|:
name|g_free
argument_list|(
name|value
operator|->
name|sfa_file
operator|.
name|filename
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_file
operator|.
name|filename
operator|=
name|g_strdup
argument_list|(
name|default_value
operator|->
name|sfa_file
operator|.
name|filename
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_FONT
case|:
name|g_free
argument_list|(
name|value
operator|->
name|sfa_font
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_font
operator|=
name|g_strdup
argument_list|(
name|default_value
operator|->
name|sfa_font
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PALETTE
case|:
name|g_free
argument_list|(
name|value
operator|->
name|sfa_palette
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_palette
operator|=
name|g_strdup
argument_list|(
name|default_value
operator|->
name|sfa_palette
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PATTERN
case|:
name|g_free
argument_list|(
name|value
operator|->
name|sfa_pattern
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_pattern
operator|=
name|g_strdup
argument_list|(
name|default_value
operator|->
name|sfa_pattern
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_GRADIENT
case|:
name|g_free
argument_list|(
name|value
operator|->
name|sfa_gradient
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_gradient
operator|=
name|g_strdup
argument_list|(
name|default_value
operator|->
name|sfa_gradient
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_BRUSH
case|:
name|g_free
argument_list|(
name|value
operator|->
name|sfa_brush
operator|.
name|name
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_brush
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|default_value
operator|->
name|sfa_brush
operator|.
name|name
argument_list|)
expr_stmt|;
name|value
operator|->
name|sfa_brush
operator|.
name|opacity
operator|=
name|default_value
operator|->
name|sfa_brush
operator|.
name|opacity
expr_stmt|;
name|value
operator|->
name|sfa_brush
operator|.
name|spacing
operator|=
name|default_value
operator|->
name|sfa_brush
operator|.
name|spacing
expr_stmt|;
name|value
operator|->
name|sfa_brush
operator|.
name|paint_mode
operator|=
name|default_value
operator|->
name|sfa_brush
operator|.
name|paint_mode
expr_stmt|;
break|break;
case|case
name|SF_OPTION
case|:
name|value
operator|->
name|sfa_option
operator|.
name|history
operator|=
name|default_value
operator|->
name|sfa_option
operator|.
name|history
expr_stmt|;
break|break;
case|case
name|SF_ENUM
case|:
name|value
operator|->
name|sfa_enum
operator|.
name|history
operator|=
name|default_value
operator|->
name|sfa_enum
operator|.
name|history
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_function
name|gint
DECL|function|script_fu_script_collect_standard_args (SFScript * script,const GimpValueArray * args)
name|script_fu_script_collect_standard_args
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|,
specifier|const
name|GimpValueArray
modifier|*
name|args
parameter_list|)
block|{
name|gint
name|params_consumed
init|=
literal|0
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  the first parameter may be a DISPLAY id  */
if|if
condition|(
name|script_fu_script_param_init
argument_list|(
name|script
argument_list|,
name|args
argument_list|,
name|SF_DISPLAY
argument_list|,
name|params_consumed
argument_list|)
condition|)
block|{
name|params_consumed
operator|++
expr_stmt|;
block|}
comment|/*  an IMAGE id may come first or after the DISPLAY id  */
if|if
condition|(
name|script_fu_script_param_init
argument_list|(
name|script
argument_list|,
name|args
argument_list|,
name|SF_IMAGE
argument_list|,
name|params_consumed
argument_list|)
condition|)
block|{
name|params_consumed
operator|++
expr_stmt|;
comment|/*  and may be followed by a DRAWABLE, LAYER, CHANNEL or        *  VECTORS id        */
if|if
condition|(
name|script_fu_script_param_init
argument_list|(
name|script
argument_list|,
name|args
argument_list|,
name|SF_DRAWABLE
argument_list|,
name|params_consumed
argument_list|)
operator|||
name|script_fu_script_param_init
argument_list|(
name|script
argument_list|,
name|args
argument_list|,
name|SF_LAYER
argument_list|,
name|params_consumed
argument_list|)
operator|||
name|script_fu_script_param_init
argument_list|(
name|script
argument_list|,
name|args
argument_list|,
name|SF_CHANNEL
argument_list|,
name|params_consumed
argument_list|)
operator|||
name|script_fu_script_param_init
argument_list|(
name|script
argument_list|,
name|args
argument_list|,
name|SF_VECTORS
argument_list|,
name|params_consumed
argument_list|)
condition|)
block|{
name|params_consumed
operator|++
expr_stmt|;
block|}
block|}
return|return
name|params_consumed
return|;
block|}
end_function

begin_function
name|gchar
modifier|*
DECL|function|script_fu_script_get_command (SFScript * script)
name|script_fu_script_get_command
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|)
block|{
name|GString
modifier|*
name|s
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|s
operator|=
name|g_string_new
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|g_string_append
argument_list|(
name|s
argument_list|,
name|script
operator|->
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|script
operator|->
name|n_args
condition|;
name|i
operator|++
control|)
block|{
name|SFArgValue
modifier|*
name|arg_value
init|=
operator|&
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|value
decl_stmt|;
name|g_string_append_c
argument_list|(
name|s
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|SF_IMAGE
case|:
case|case
name|SF_DRAWABLE
case|:
case|case
name|SF_LAYER
case|:
case|case
name|SF_CHANNEL
case|:
case|case
name|SF_VECTORS
case|:
case|case
name|SF_DISPLAY
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"%d"
argument_list|,
name|arg_value
operator|->
name|sfa_image
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_COLOR
case|:
block|{
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|gimp_rgb_get_uchar
argument_list|(
operator|&
name|arg_value
operator|->
name|sfa_color
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"'(%d %d %d)"
argument_list|,
operator|(
name|gint
operator|)
name|r
argument_list|,
operator|(
name|gint
operator|)
name|g
argument_list|,
operator|(
name|gint
operator|)
name|b
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_TOGGLE
case|:
name|g_string_append
argument_list|(
name|s
argument_list|,
name|arg_value
operator|->
name|sfa_toggle
condition|?
literal|"TRUE"
else|:
literal|"FALSE"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_VALUE
case|:
name|g_string_append
argument_list|(
name|s
argument_list|,
name|arg_value
operator|->
name|sfa_value
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_STRING
case|:
case|case
name|SF_TEXT
case|:
block|{
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|script_fu_strescape
argument_list|(
name|arg_value
operator|->
name|sfa_value
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_ADJUSTMENT
case|:
block|{
name|gchar
name|buffer
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|g_ascii_dtostr
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|arg_value
operator|->
name|sfa_adjustment
operator|.
name|value
argument_list|)
expr_stmt|;
name|g_string_append
argument_list|(
name|s
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_FILENAME
case|:
case|case
name|SF_DIRNAME
case|:
block|{
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|script_fu_strescape
argument_list|(
name|arg_value
operator|->
name|sfa_file
operator|.
name|filename
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_FONT
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|arg_value
operator|->
name|sfa_font
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PALETTE
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|arg_value
operator|->
name|sfa_palette
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_PATTERN
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|arg_value
operator|->
name|sfa_pattern
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_GRADIENT
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|arg_value
operator|->
name|sfa_gradient
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_BRUSH
case|:
block|{
name|gchar
name|buffer
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|g_ascii_dtostr
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|arg_value
operator|->
name|sfa_brush
operator|.
name|opacity
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"'(\"%s\" %s %d %d)"
argument_list|,
name|arg_value
operator|->
name|sfa_brush
operator|.
name|name
argument_list|,
name|buffer
argument_list|,
name|arg_value
operator|->
name|sfa_brush
operator|.
name|spacing
argument_list|,
name|arg_value
operator|->
name|sfa_brush
operator|.
name|paint_mode
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_OPTION
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"%d"
argument_list|,
name|arg_value
operator|->
name|sfa_option
operator|.
name|history
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_ENUM
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"%d"
argument_list|,
name|arg_value
operator|->
name|sfa_enum
operator|.
name|history
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|g_string_append_c
argument_list|(
name|s
argument_list|,
literal|')'
argument_list|)
expr_stmt|;
return|return
name|g_string_free
argument_list|(
name|s
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_function
name|gchar
modifier|*
DECL|function|script_fu_script_get_command_from_params (SFScript * script,const GimpValueArray * args)
name|script_fu_script_get_command_from_params
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|,
specifier|const
name|GimpValueArray
modifier|*
name|args
parameter_list|)
block|{
name|GString
modifier|*
name|s
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|script
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|s
operator|=
name|g_string_new
argument_list|(
literal|"("
argument_list|)
expr_stmt|;
name|g_string_append
argument_list|(
name|s
argument_list|,
name|script
operator|->
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|script
operator|->
name|n_args
condition|;
name|i
operator|++
control|)
block|{
name|GValue
modifier|*
name|value
init|=
name|gimp_value_array_index
argument_list|(
name|args
argument_list|,
name|i
operator|+
literal|1
argument_list|)
decl_stmt|;
name|g_string_append_c
argument_list|(
name|s
argument_list|,
literal|' '
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|script
operator|->
name|args
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|SF_IMAGE
case|:
case|case
name|SF_DRAWABLE
case|:
case|case
name|SF_LAYER
case|:
case|case
name|SF_CHANNEL
case|:
case|case
name|SF_VECTORS
case|:
case|case
name|SF_DISPLAY
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"%d"
argument_list|,
name|g_value_get_int
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_COLOR
case|:
block|{
name|GimpRGB
name|color
decl_stmt|;
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|gimp_value_get_rgb
argument_list|(
name|value
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_rgb_get_uchar
argument_list|(
operator|&
name|color
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"'(%d %d %d)"
argument_list|,
operator|(
name|gint
operator|)
name|r
argument_list|,
operator|(
name|gint
operator|)
name|g
argument_list|,
operator|(
name|gint
operator|)
name|b
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_TOGGLE
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
operator|(
name|g_value_get_boolean
argument_list|(
name|value
argument_list|)
condition|?
literal|"TRUE"
else|:
literal|"FALSE"
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_VALUE
case|:
name|g_string_append
argument_list|(
name|s
argument_list|,
name|g_value_get_string
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_STRING
case|:
case|case
name|SF_TEXT
case|:
case|case
name|SF_FILENAME
case|:
case|case
name|SF_DIRNAME
case|:
block|{
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|script_fu_strescape
argument_list|(
name|g_value_get_string
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_ADJUSTMENT
case|:
block|{
name|gchar
name|buffer
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|g_ascii_dtostr
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|g_value_get_double
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
name|g_string_append
argument_list|(
name|s
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SF_FONT
case|:
case|case
name|SF_PALETTE
case|:
case|case
name|SF_PATTERN
case|:
case|case
name|SF_GRADIENT
case|:
case|case
name|SF_BRUSH
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"\"%s\""
argument_list|,
name|g_value_get_string
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|SF_OPTION
case|:
case|case
name|SF_ENUM
case|:
name|g_string_append_printf
argument_list|(
name|s
argument_list|,
literal|"%d"
argument_list|,
name|g_value_get_int
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|g_string_append_c
argument_list|(
name|s
argument_list|,
literal|')'
argument_list|)
expr_stmt|;
return|return
name|g_string_free
argument_list|(
name|s
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  *  Local Functions  */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|script_fu_script_param_init (SFScript * script,const GimpValueArray * args,SFArgType type,gint n)
name|script_fu_script_param_init
parameter_list|(
name|SFScript
modifier|*
name|script
parameter_list|,
specifier|const
name|GimpValueArray
modifier|*
name|args
parameter_list|,
name|SFArgType
name|type
parameter_list|,
name|gint
name|n
parameter_list|)
block|{
name|SFArg
modifier|*
name|arg
init|=
operator|&
name|script
operator|->
name|args
index|[
name|n
index|]
decl_stmt|;
if|if
condition|(
name|script
operator|->
name|n_args
operator|>
name|n
operator|&&
name|arg
operator|->
name|type
operator|==
name|type
operator|&&
name|gimp_value_array_length
argument_list|(
name|args
argument_list|)
operator|>
name|n
operator|+
literal|1
condition|)
block|{
name|GValue
modifier|*
name|value
init|=
name|gimp_value_array_index
argument_list|(
name|args
argument_list|,
name|n
operator|+
literal|1
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|SF_IMAGE
case|:
if|if
condition|(
name|GIMP_VALUE_HOLDS_IMAGE_ID
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|arg
operator|->
name|value
operator|.
name|sfa_image
operator|=
name|gimp_value_get_image_id
argument_list|(
name|value
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|SF_DRAWABLE
case|:
if|if
condition|(
name|GIMP_VALUE_HOLDS_DRAWABLE_ID
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|arg
operator|->
name|value
operator|.
name|sfa_drawable
operator|=
name|gimp_value_get_drawable_id
argument_list|(
name|value
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|SF_LAYER
case|:
if|if
condition|(
name|GIMP_VALUE_HOLDS_LAYER_ID
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|arg
operator|->
name|value
operator|.
name|sfa_layer
operator|=
name|gimp_value_get_layer_id
argument_list|(
name|value
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|SF_CHANNEL
case|:
if|if
condition|(
name|GIMP_VALUE_HOLDS_CHANNEL_ID
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|arg
operator|->
name|value
operator|.
name|sfa_channel
operator|=
name|gimp_value_get_channel_id
argument_list|(
name|value
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|SF_VECTORS
case|:
if|if
condition|(
name|GIMP_VALUE_HOLDS_VECTORS_ID
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|arg
operator|->
name|value
operator|.
name|sfa_vectors
operator|=
name|gimp_value_get_vectors_id
argument_list|(
name|value
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|SF_DISPLAY
case|:
if|if
condition|(
name|GIMP_VALUE_HOLDS_DISPLAY_ID
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|arg
operator|->
name|value
operator|.
name|sfa_display
operator|=
name|gimp_value_get_display_id
argument_list|(
name|value
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
default|default:
break|break;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

end_unit

