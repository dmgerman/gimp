begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|"postfix.h"
end_include

begin_decl_stmt
specifier|extern
name|double
name|currentX
decl_stmt|,
name|currentY
decl_stmt|,
name|currentR
decl_stmt|,
name|currentA
decl_stmt|,
name|imageR
decl_stmt|,
name|imageX
decl_stmt|,
name|imageY
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|imageWidth
decl_stmt|,
name|imageHeight
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|STACKSIZE
define|#
directive|define
name|STACKSIZE
value|128
end_define

begin_define
DECL|macro|EXPRSIZE
define|#
directive|define
name|EXPRSIZE
value|256
end_define

begin_decl_stmt
DECL|variable|stack
name|double
name|stack
index|[
name|STACKSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|stackp
name|int
name|stackp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|expression
name|postfix
name|expression
index|[
name|EXPRSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|exprp
name|int
name|exprp
decl_stmt|,
DECL|variable|exprlen
name|exprlen
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|stack_push (double arg)
name|stack_push
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|arg
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_add (double arg)
name|stack_add
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_add_i (double arg)
name|stack_add_i
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|+=
name|arg
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_sub (double arg)
name|stack_sub
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|-
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_sub_i (double arg)
name|stack_sub_i
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|-=
name|arg
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_neg (double arg)
name|stack_neg
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
operator|-
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_mul (double arg)
name|stack_mul
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|*
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_mul_i (double arg)
name|stack_mul_i
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*=
name|arg
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_div (double arg)
name|stack_div
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|/
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_div_i (double arg)
name|stack_div_i
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|/=
name|arg
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_mod (double arg)
name|stack_mod
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|fmod
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
argument_list|,
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_mod_i (double arg)
name|stack_mod_i
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|fmod
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|,
name|arg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_x (double arg)
name|stack_var_x
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|currentX
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_y (double arg)
name|stack_var_y
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|currentY
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_r (double arg)
name|stack_var_r
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|currentR
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_a (double arg)
name|stack_var_a
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|currentA
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_w (double arg)
name|stack_var_w
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|imageWidth
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_h (double arg)
name|stack_var_h
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|imageHeight
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_big_r (double arg)
name|stack_var_big_r
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|imageR
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_big_x (double arg)
name|stack_var_big_x
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|imageX
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|stack_var_big_y (double arg)
name|stack_var_big_y
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|++
index|]
operator|=
name|imageY
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|make_postfix_recursive (exprtree * tree)
name|make_postfix_recursive
parameter_list|(
name|exprtree
modifier|*
name|tree
parameter_list|)
block|{
switch|switch
condition|(
name|tree
operator|->
name|type
condition|)
block|{
case|case
name|EXPR_NUMBER
case|:
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_push
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
operator|=
name|tree
operator|->
name|val
operator|.
name|number
expr_stmt|;
operator|++
name|exprp
expr_stmt|;
break|break;
case|case
name|EXPR_ADD
case|:
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|type
operator|==
name|EXPR_NUMBER
condition|)
block|{
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_add_i
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
operator|=
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|val
operator|.
name|number
expr_stmt|;
block|}
else|else
block|{
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
argument_list|)
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_add
expr_stmt|;
block|}
operator|++
name|exprp
expr_stmt|;
break|break;
case|case
name|EXPR_SUB
case|:
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|type
operator|==
name|EXPR_NUMBER
condition|)
block|{
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_sub_i
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
operator|=
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|val
operator|.
name|number
expr_stmt|;
block|}
else|else
block|{
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
argument_list|)
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_sub
expr_stmt|;
block|}
operator|++
name|exprp
expr_stmt|;
break|break;
case|case
name|EXPR_NEG
case|:
if|if
condition|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
operator|->
name|type
operator|==
name|EXPR_NUMBER
condition|)
block|{
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_push
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
operator|=
operator|-
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
operator|->
name|val
operator|.
name|number
expr_stmt|;
block|}
else|else
block|{
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
argument_list|)
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_neg
expr_stmt|;
block|}
operator|++
name|exprp
expr_stmt|;
break|break;
case|case
name|EXPR_MUL
case|:
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|type
operator|==
name|EXPR_NUMBER
condition|)
block|{
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_mul_i
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
operator|=
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|val
operator|.
name|number
expr_stmt|;
block|}
else|else
block|{
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
argument_list|)
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_mul
expr_stmt|;
block|}
operator|++
name|exprp
expr_stmt|;
break|break;
case|case
name|EXPR_DIV
case|:
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|type
operator|==
name|EXPR_NUMBER
condition|)
block|{
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_div_i
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
operator|=
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|val
operator|.
name|number
expr_stmt|;
block|}
else|else
block|{
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
argument_list|)
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_div
expr_stmt|;
block|}
operator|++
name|exprp
expr_stmt|;
break|break;
case|case
name|EXPR_MOD
case|:
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|type
operator|==
name|EXPR_NUMBER
condition|)
block|{
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_mod_i
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
operator|=
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|->
name|val
operator|.
name|number
expr_stmt|;
block|}
else|else
block|{
name|make_postfix_recursive
argument_list|(
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
argument_list|)
expr_stmt|;
name|expression
index|[
name|exprp
index|]
operator|.
name|func
operator|=
name|stack_mod
expr_stmt|;
block|}
operator|++
name|exprp
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_X
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_x
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_Y
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_y
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_R
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_r
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_A
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_a
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_W
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_w
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_H
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_h
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_BIG_R
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_big_r
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_BIG_X
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_big_x
expr_stmt|;
break|break;
case|case
name|EXPR_VAR_BIG_Y
case|:
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|stack_var_big_y
expr_stmt|;
break|break;
case|case
name|EXPR_FUNC
case|:
block|{
name|exprtree
modifier|*
name|arg
init|=
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|args
decl_stmt|;
while|while
condition|(
name|arg
operator|!=
literal|0
condition|)
block|{
name|make_postfix_recursive
argument_list|(
name|arg
argument_list|)
expr_stmt|;
name|arg
operator|=
name|arg
operator|->
name|next
expr_stmt|;
block|}
name|expression
index|[
name|exprp
operator|++
index|]
operator|.
name|func
operator|=
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
expr_stmt|;
break|break;
block|}
default|default :
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"illegal expr\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|make_postfix (exprtree * tree)
name|make_postfix
parameter_list|(
name|exprtree
modifier|*
name|tree
parameter_list|)
block|{
name|exprp
operator|=
literal|0
expr_stmt|;
name|make_postfix_recursive
argument_list|(
name|tree
argument_list|)
expr_stmt|;
name|exprlen
operator|=
name|exprp
expr_stmt|;
block|}
end_function

begin_function
name|double
DECL|function|eval_postfix (void)
name|eval_postfix
parameter_list|(
name|void
parameter_list|)
block|{
name|stackp
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|exprp
operator|=
literal|0
init|;
name|exprp
operator|<
name|exprlen
condition|;
operator|++
name|exprp
control|)
name|expression
index|[
name|exprp
index|]
operator|.
name|func
argument_list|(
name|expression
index|[
name|exprp
index|]
operator|.
name|arg
argument_list|)
expr_stmt|;
return|return
name|stack
index|[
literal|0
index|]
return|;
block|}
end_function

end_unit

