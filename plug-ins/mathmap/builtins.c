begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<math.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|_GIMP
end_ifdef

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<libc.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"builtins.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|imageWidth
decl_stmt|,
name|imageHeight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|double
name|middleX
decl_stmt|,
name|middleY
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|unsigned
name|char
modifier|*
name|imageData
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|double
name|stack
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|stackp
decl_stmt|;
end_decl_stmt

begin_function
name|double
DECL|function|color_to_double (int red,int green,int blue)
name|color_to_double
parameter_list|(
name|int
name|red
parameter_list|,
name|int
name|green
parameter_list|,
name|int
name|blue
parameter_list|)
block|{
return|return
operator|(
name|red
operator|<<
literal|16
operator|)
operator||
operator|(
name|green
operator|<<
literal|8
operator|)
operator||
name|blue
return|;
block|}
end_function

begin_function
name|void
DECL|function|double_to_color (double val,int * red,int * green,int * blue)
name|double_to_color
parameter_list|(
name|double
name|val
parameter_list|,
name|int
modifier|*
name|red
parameter_list|,
name|int
modifier|*
name|green
parameter_list|,
name|int
modifier|*
name|blue
parameter_list|)
block|{
name|int
name|color
init|=
name|val
decl_stmt|;
operator|*
name|red
operator|=
name|color
operator|>>
literal|16
expr_stmt|;
operator|*
name|green
operator|=
operator|(
name|color
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
operator|*
name|blue
operator|=
name|color
operator|&
literal|0xff
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_if (double arg)
name|builtin_if
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|!=
literal|0.0
condition|)
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
name|stackp
operator|-=
literal|2
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_sin (double arg)
name|builtin_sin
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_cos (double arg)
name|builtin_cos
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_tan (double arg)
name|builtin_tan
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|tan
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_asin (double arg)
name|builtin_asin
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|asin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|*
literal|180.0
operator|/
name|M_PI
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_acos (double arg)
name|builtin_acos
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|acos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|*
literal|180.0
operator|/
name|M_PI
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_atan (double arg)
name|builtin_atan
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|atan
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|*
literal|180.0
operator|/
name|M_PI
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_sign (double arg)
name|builtin_sign
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|<
literal|0
condition|)
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
operator|-
literal|1.0
expr_stmt|;
elseif|else
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|>
literal|0
condition|)
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
literal|0.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_min (double arg)
name|builtin_min
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|>=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_max (double arg)
name|builtin_max
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|<=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_inintv (double arg)
name|builtin_inintv
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|>=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|&&
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|<=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|=
literal|0.0
expr_stmt|;
name|stackp
operator|-=
literal|2
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_rand (double arg)
name|builtin_rand
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
operator|(
name|random
argument_list|()
operator|/
operator|(
name|double
operator|)
literal|0x7fffffff
operator|)
operator|*
operator|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|-
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|)
operator|+
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|_GIMP
end_ifdef

begin_function_decl
name|void
name|mathmap_get_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|unsigned
name|char
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|int
name|originX
decl_stmt|,
name|originY
decl_stmt|,
name|wholeImageWidth
decl_stmt|,
name|wholeImageHeight
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|builtin_origValXY (double arg)
name|builtin_origValXY
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|int
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
decl_stmt|;
name|unsigned
name|char
name|pixel
index|[
literal|4
index|]
decl_stmt|;
name|mathmap_get_pixel
argument_list|(
name|x
operator|+
name|originX
operator|+
name|middleX
argument_list|,
name|y
operator|+
name|originY
operator|+
name|middleY
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValXYIntersample (double arg)
name|builtin_origValXYIntersample
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
operator|+
name|originX
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|+
name|middleY
operator|+
name|originY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
name|pixel1a
index|[
literal|4
index|]
decl_stmt|,
name|pixel2a
index|[
literal|4
index|]
decl_stmt|,
name|pixel3a
index|[
literal|4
index|]
decl_stmt|,
name|pixel4a
index|[
literal|4
index|]
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
init|=
name|pixel1a
decl_stmt|,
modifier|*
name|pixel2
init|=
name|pixel2a
decl_stmt|,
modifier|*
name|pixel3
init|=
name|pixel3a
decl_stmt|,
modifier|*
name|pixel4
init|=
name|pixel4a
decl_stmt|;
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|,
name|pixel1
argument_list|)
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y2
argument_list|,
name|pixel2
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y1
argument_list|,
name|pixel3
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y2
argument_list|,
name|pixel4
argument_list|)
expr_stmt|;
name|red
operator|=
name|pixel1
index|[
literal|0
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|0
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|0
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|0
index|]
operator|*
name|p4fact
expr_stmt|;
name|green
operator|=
name|pixel1
index|[
literal|1
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|1
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|1
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|1
index|]
operator|*
name|p4fact
expr_stmt|;
name|blue
operator|=
name|pixel1
index|[
literal|2
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|2
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|2
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|2
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|red
argument_list|,
name|green
argument_list|,
name|blue
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRA (double arg)
name|builtin_origValRA
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|int
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
decl_stmt|;
name|unsigned
name|char
name|pixel
index|[
literal|4
index|]
decl_stmt|;
name|mathmap_get_pixel
argument_list|(
name|x
operator|+
name|originX
argument_list|,
name|y
operator|+
name|originY
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRAIntersample (double arg)
name|builtin_origValRAIntersample
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
operator|+
name|originX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
operator|+
name|originY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
name|pixel1a
index|[
literal|4
index|]
decl_stmt|,
name|pixel2a
index|[
literal|4
index|]
decl_stmt|,
name|pixel3a
index|[
literal|4
index|]
decl_stmt|,
name|pixel4a
index|[
literal|4
index|]
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
init|=
name|pixel1a
decl_stmt|,
modifier|*
name|pixel2
init|=
name|pixel2a
decl_stmt|,
modifier|*
name|pixel3
init|=
name|pixel3a
decl_stmt|,
modifier|*
name|pixel4
init|=
name|pixel4a
decl_stmt|;
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|,
name|pixel1
argument_list|)
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y2
argument_list|,
name|pixel2
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y1
argument_list|,
name|pixel3
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y2
argument_list|,
name|pixel4
argument_list|)
expr_stmt|;
name|red
operator|=
name|pixel1
index|[
literal|0
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|0
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|0
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|0
index|]
operator|*
name|p4fact
expr_stmt|;
name|green
operator|=
name|pixel1
index|[
literal|1
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|1
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|1
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|1
index|]
operator|*
name|p4fact
expr_stmt|;
name|blue
operator|=
name|pixel1
index|[
literal|2
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|2
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|2
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|2
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|red
argument_list|,
name|green
argument_list|,
name|blue
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_function
name|void
DECL|function|builtin_origValXY (double arg)
name|builtin_origValXY
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|int
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|+
name|middleY
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel
decl_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|y
operator|<
literal|0
operator|||
name|x
operator|>=
name|imageWidth
operator|||
name|y
operator|>=
name|imageHeight
condition|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
return|return;
block|}
name|pixel
operator|=
name|imageData
operator|+
operator|(
name|y
operator|*
name|imageWidth
operator|+
name|x
operator|)
operator|*
literal|3
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValXYIntersample (double arg)
name|builtin_origValXYIntersample
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|+
name|middleY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
decl_stmt|,
modifier|*
name|pixel2
decl_stmt|,
modifier|*
name|pixel3
decl_stmt|,
modifier|*
name|pixel4
decl_stmt|;
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel1
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel2
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel3
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel4
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
name|red
operator|=
name|pixel1
index|[
literal|0
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|0
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|0
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|0
index|]
operator|*
name|p4fact
expr_stmt|;
name|green
operator|=
name|pixel1
index|[
literal|1
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|1
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|1
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|1
index|]
operator|*
name|p4fact
expr_stmt|;
name|blue
operator|=
name|pixel1
index|[
literal|2
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|2
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|2
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|2
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|red
argument_list|,
name|green
argument_list|,
name|blue
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRA (double arg)
name|builtin_origValRA
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|int
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel
decl_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|y
operator|<
literal|0
operator|||
name|x
operator|>=
name|imageWidth
operator|||
name|y
operator|>=
name|imageHeight
condition|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
return|return;
block|}
name|pixel
operator|=
name|imageData
operator|+
operator|(
name|y
operator|*
name|imageWidth
operator|+
name|x
operator|)
operator|*
literal|3
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRAIntersample (double arg)
name|builtin_origValRAIntersample
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
decl_stmt|,
modifier|*
name|pixel2
decl_stmt|,
modifier|*
name|pixel3
decl_stmt|,
modifier|*
name|pixel4
decl_stmt|;
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel1
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel2
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel3
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel4
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
name|red
operator|=
name|pixel1
index|[
literal|0
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|0
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|0
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|0
index|]
operator|*
name|p4fact
expr_stmt|;
name|green
operator|=
name|pixel1
index|[
literal|1
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|1
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|1
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|1
index|]
operator|*
name|p4fact
expr_stmt|;
name|blue
operator|=
name|pixel1
index|[
literal|2
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|2
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|2
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|2
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|red
argument_list|,
name|green
argument_list|,
name|blue
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _GIMP */
end_comment

begin_function
name|void
DECL|function|builtin_grayColor (double arg)
name|builtin_grayColor
parameter_list|(
name|double
name|arg
parameter_list|)
block|{
name|int
name|grayLevel
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
literal|255
decl_stmt|;
if|if
condition|(
name|grayLevel
operator|<
literal|0
condition|)
name|grayLevel
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|grayLevel
operator|>
literal|255
condition|)
name|grayLevel
operator|=
literal|255
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|color_to_double
argument_list|(
name|grayLevel
argument_list|,
name|grayLevel
argument_list|,
name|grayLevel
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

