begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|_GIMP
end_ifdef

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<libc.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"builtins.h"
end_include

begin_decl_stmt
specifier|extern
name|int
name|imageWidth
decl_stmt|,
name|imageHeight
decl_stmt|,
name|inputBPP
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|double
name|middleX
decl_stmt|,
name|middleY
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|unsigned
name|char
modifier|*
name|imageData
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|double
name|stack
index|[]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|stackp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|intersamplingEnabled
decl_stmt|,
name|oversamplingEnabled
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|firstBuiltin
name|builtin
modifier|*
name|firstBuiltin
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
name|double
DECL|function|color_to_double (unsigned int red,unsigned int green,unsigned int blue,unsigned int alpha)
name|color_to_double
parameter_list|(
name|unsigned
name|int
name|red
parameter_list|,
name|unsigned
name|int
name|green
parameter_list|,
name|unsigned
name|int
name|blue
parameter_list|,
name|unsigned
name|int
name|alpha
parameter_list|)
block|{
name|double
name|val
decl_stmt|;
operator|*
operator|(
name|unsigned
name|int
operator|*
operator|)
operator|&
name|val
operator|=
operator|(
name|alpha
operator|<<
literal|24
operator|)
operator||
operator|(
name|red
operator|<<
literal|16
operator|)
operator||
operator|(
name|green
operator|<<
literal|8
operator|)
operator||
name|blue
expr_stmt|;
return|return
name|val
return|;
block|}
end_function

begin_function
name|double
DECL|function|pixel_to_double (unsigned char * pixel)
name|pixel_to_double
parameter_list|(
name|unsigned
name|char
modifier|*
name|pixel
parameter_list|)
block|{
if|if
condition|(
name|inputBPP
operator|==
literal|1
condition|)
return|return
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|0
index|]
argument_list|,
literal|255
argument_list|)
return|;
elseif|else
if|if
condition|(
name|inputBPP
operator|==
literal|2
condition|)
return|return
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|)
return|;
elseif|else
if|if
condition|(
name|inputBPP
operator|==
literal|3
condition|)
return|return
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|,
literal|255
argument_list|)
return|;
else|else
return|return
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|,
name|pixel
index|[
literal|3
index|]
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|double_to_color (double val,unsigned int * red,unsigned int * green,unsigned int * blue,unsigned int * alpha)
name|double_to_color
parameter_list|(
name|double
name|val
parameter_list|,
name|unsigned
name|int
modifier|*
name|red
parameter_list|,
name|unsigned
name|int
modifier|*
name|green
parameter_list|,
name|unsigned
name|int
modifier|*
name|blue
parameter_list|,
name|unsigned
name|int
modifier|*
name|alpha
parameter_list|)
block|{
name|unsigned
name|int
name|color
init|=
operator|*
operator|(
name|unsigned
name|int
operator|*
operator|)
operator|&
name|val
decl_stmt|;
operator|*
name|alpha
operator|=
name|color
operator|>>
literal|24
expr_stmt|;
operator|*
name|red
operator|=
operator|(
name|color
operator|>>
literal|16
operator|)
operator|&
literal|0xff
expr_stmt|;
operator|*
name|green
operator|=
operator|(
name|color
operator|>>
literal|8
operator|)
operator|&
literal|0xff
expr_stmt|;
operator|*
name|blue
operator|=
name|color
operator|&
literal|0xff
expr_stmt|;
block|}
end_function

begin_function
name|unsigned
name|int
DECL|function|alpha_component (double val)
name|alpha_component
parameter_list|(
name|double
name|val
parameter_list|)
block|{
name|unsigned
name|int
name|color
init|=
operator|*
operator|(
name|unsigned
name|int
operator|*
operator|)
operator|&
name|val
decl_stmt|;
return|return
name|color
operator|>>
literal|24
return|;
block|}
end_function

begin_function
name|unsigned
name|int
DECL|function|red_component (double val)
name|red_component
parameter_list|(
name|double
name|val
parameter_list|)
block|{
name|unsigned
name|int
name|color
init|=
operator|*
operator|(
name|unsigned
name|int
operator|*
operator|)
operator|&
name|val
decl_stmt|;
return|return
operator|(
name|color
operator|>>
literal|16
operator|)
operator|&
literal|0xff
return|;
block|}
end_function

begin_function
name|unsigned
name|int
DECL|function|green_component (double val)
name|green_component
parameter_list|(
name|double
name|val
parameter_list|)
block|{
name|unsigned
name|int
name|color
init|=
operator|*
operator|(
name|unsigned
name|int
operator|*
operator|)
operator|&
name|val
decl_stmt|;
return|return
operator|(
name|color
operator|>>
literal|8
operator|)
operator|&
literal|0xff
return|;
block|}
end_function

begin_function
name|unsigned
name|int
DECL|function|blue_component (double val)
name|blue_component
parameter_list|(
name|double
name|val
parameter_list|)
block|{
name|unsigned
name|int
name|color
init|=
operator|*
operator|(
name|unsigned
name|int
operator|*
operator|)
operator|&
name|val
decl_stmt|;
return|return
name|color
operator|&
literal|0xff
return|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_sin (void * arg)
name|builtin_sin
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_cos (void * arg)
name|builtin_cos
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_tan (void * arg)
name|builtin_tan
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|tan
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_asin (void * arg)
name|builtin_asin
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|asin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|*
literal|180.0
operator|/
name|M_PI
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_acos (void * arg)
name|builtin_acos
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|acos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|*
literal|180.0
operator|/
name|M_PI
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_atan (void * arg)
name|builtin_atan
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|atan
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|*
literal|180.0
operator|/
name|M_PI
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_pow (void * arg)
name|builtin_pow
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|pow
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
argument_list|,
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_abs (void * arg)
name|builtin_abs
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|fabs
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_floor (void * arg)
name|builtin_floor
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|floor
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_sign (void * arg)
name|builtin_sign
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|<
literal|0
condition|)
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
operator|-
literal|1.0
expr_stmt|;
elseif|else
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|>
literal|0
condition|)
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
literal|0.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_min (void * arg)
name|builtin_min
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|>=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_max (void * arg)
name|builtin_max
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|<=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_not (void * arg)
name|builtin_not
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|!=
literal|0.0
condition|)
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
literal|0.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
literal|1.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_or (void * arg)
name|builtin_or
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|||
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_and (void * arg)
name|builtin_and
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|&&
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_equal (void * arg)
name|builtin_equal
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|==
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_less (void * arg)
name|builtin_less
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|<
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_greater (void * arg)
name|builtin_greater
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|>
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_lessequal (void * arg)
name|builtin_lessequal
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|<=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_greaterequal (void * arg)
name|builtin_greaterequal
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|>=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_notequal (void * arg)
name|builtin_notequal
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|!=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_inintv (void * arg)
name|builtin_inintv
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
if|if
condition|(
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|>=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|&&
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|<=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
condition|)
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|=
literal|1.0
expr_stmt|;
else|else
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|=
literal|0.0
expr_stmt|;
name|stackp
operator|-=
literal|2
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_rand (void * arg)
name|builtin_rand
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
operator|(
name|random
argument_list|()
operator|/
operator|(
name|double
operator|)
literal|0x7fffffff
operator|)
operator|*
operator|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|-
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|)
operator|+
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|_GIMP
end_ifdef

begin_function_decl
name|void
name|mathmap_get_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|unsigned
name|char
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
specifier|extern
name|int
name|originX
decl_stmt|,
name|originY
decl_stmt|,
name|wholeImageWidth
decl_stmt|,
name|wholeImageHeight
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|builtin_origValXY (void * arg)
name|builtin_origValXY
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
decl_stmt|;
name|unsigned
name|char
name|pixel
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|oversamplingEnabled
condition|)
block|{
name|x
operator|+=
literal|0.5
expr_stmt|;
name|y
operator|+=
literal|0.5
expr_stmt|;
block|}
name|mathmap_get_pixel
argument_list|(
name|floor
argument_list|(
name|x
operator|+
name|originX
operator|+
name|middleX
argument_list|)
argument_list|,
name|floor
argument_list|(
name|y
operator|+
name|originY
operator|+
name|middleY
argument_list|)
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|pixel_to_double
argument_list|(
name|pixel
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValXYIntersample (void * arg)
name|builtin_origValXYIntersample
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
operator|+
name|originX
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|+
name|middleY
operator|+
name|originY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
name|pixel1a
index|[
literal|4
index|]
decl_stmt|,
name|pixel2a
index|[
literal|4
index|]
decl_stmt|,
name|pixel3a
index|[
literal|4
index|]
decl_stmt|,
name|pixel4a
index|[
literal|4
index|]
decl_stmt|,
name|resultPixel
index|[
literal|4
index|]
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
init|=
name|pixel1a
decl_stmt|,
modifier|*
name|pixel2
init|=
name|pixel2a
decl_stmt|,
modifier|*
name|pixel3
init|=
name|pixel3a
decl_stmt|,
modifier|*
name|pixel4
init|=
name|pixel4a
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|,
name|pixel1
argument_list|)
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y2
argument_list|,
name|pixel2
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y1
argument_list|,
name|pixel3
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y2
argument_list|,
name|pixel4
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|inputBPP
condition|;
operator|++
name|i
control|)
name|resultPixel
index|[
name|i
index|]
operator|=
name|pixel1
index|[
name|i
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
name|i
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
name|i
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
name|i
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|pixel_to_double
argument_list|(
name|resultPixel
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRA (void * arg)
name|builtin_origValRA
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
decl_stmt|;
name|unsigned
name|char
name|pixel
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|oversamplingEnabled
condition|)
block|{
name|x
operator|+=
literal|0.5
expr_stmt|;
name|y
operator|+=
literal|0.5
expr_stmt|;
block|}
name|mathmap_get_pixel
argument_list|(
name|floor
argument_list|(
name|x
operator|+
name|originX
argument_list|)
argument_list|,
name|floor
argument_list|(
name|y
operator|+
name|originY
argument_list|)
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|pixel_to_double
argument_list|(
name|pixel
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRAIntersample (void * arg)
name|builtin_origValRAIntersample
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
operator|+
name|originX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
operator|+
name|originY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
name|pixel1a
index|[
literal|4
index|]
decl_stmt|,
name|pixel2a
index|[
literal|4
index|]
decl_stmt|,
name|pixel3a
index|[
literal|4
index|]
decl_stmt|,
name|pixel4a
index|[
literal|4
index|]
decl_stmt|,
name|resultPixel
index|[
literal|4
index|]
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
init|=
name|pixel1a
decl_stmt|,
modifier|*
name|pixel2
init|=
name|pixel2a
decl_stmt|,
modifier|*
name|pixel3
init|=
name|pixel3a
decl_stmt|,
modifier|*
name|pixel4
init|=
name|pixel4a
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|,
name|pixel1
argument_list|)
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x1
argument_list|,
name|y2
argument_list|,
name|pixel2
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|wholeImageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y1
argument_list|,
name|pixel3
argument_list|)
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|wholeImageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|wholeImageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|mathmap_get_pixel
argument_list|(
name|x2
argument_list|,
name|y2
argument_list|,
name|pixel4
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|inputBPP
condition|;
operator|++
name|i
control|)
name|resultPixel
index|[
name|i
index|]
operator|=
name|pixel1
index|[
name|i
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
name|i
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
name|i
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
name|i
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|pixel_to_double
argument_list|(
name|resultPixel
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_function
name|void
DECL|function|builtin_origValXY (void * arg)
name|builtin_origValXY
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|+
name|middleY
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel
decl_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|y
operator|<
literal|0
operator|||
name|x
operator|>=
name|imageWidth
operator|||
name|y
operator|>=
name|imageHeight
condition|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
return|return;
block|}
name|pixel
operator|=
name|imageData
operator|+
operator|(
name|y
operator|*
name|imageWidth
operator|+
name|x
operator|)
operator|*
literal|3
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValXYIntersample (void * arg)
name|builtin_origValXYIntersample
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|+
name|middleY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
decl_stmt|,
modifier|*
name|pixel2
decl_stmt|,
modifier|*
name|pixel3
decl_stmt|,
modifier|*
name|pixel4
decl_stmt|;
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel1
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel2
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel3
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel4
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
name|red
operator|=
name|pixel1
index|[
literal|0
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|0
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|0
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|0
index|]
operator|*
name|p4fact
expr_stmt|;
name|green
operator|=
name|pixel1
index|[
literal|1
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|1
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|1
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|1
index|]
operator|*
name|p4fact
expr_stmt|;
name|blue
operator|=
name|pixel1
index|[
literal|2
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|2
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|2
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|2
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|red
argument_list|,
name|green
argument_list|,
name|blue
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRA (void * arg)
name|builtin_origValRA
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel
decl_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|y
operator|<
literal|0
operator|||
name|x
operator|>=
name|imageWidth
operator|||
name|y
operator|>=
name|imageHeight
condition|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
literal|0.0
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
return|return;
block|}
name|pixel
operator|=
name|imageData
operator|+
operator|(
name|y
operator|*
name|imageWidth
operator|+
name|x
operator|)
operator|*
literal|3
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|pixel
index|[
literal|0
index|]
argument_list|,
name|pixel
index|[
literal|1
index|]
argument_list|,
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_origValRAIntersample (void * arg)
name|builtin_origValRAIntersample
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|double
name|x
init|=
name|cos
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleX
decl_stmt|,
name|y
init|=
name|sin
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
name|M_PI
operator|/
literal|180
argument_list|)
operator|*
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|+
name|middleY
decl_stmt|;
name|int
name|x1
init|=
name|floor
argument_list|(
name|x
argument_list|)
decl_stmt|,
name|x2
init|=
name|x1
operator|+
literal|1
decl_stmt|,
name|y1
init|=
name|floor
argument_list|(
name|y
argument_list|)
decl_stmt|,
name|y2
init|=
name|y1
operator|+
literal|1
decl_stmt|;
name|double
name|x2fact
init|=
operator|(
name|x
operator|-
name|x1
operator|)
decl_stmt|,
name|y2fact
init|=
operator|(
name|y
operator|-
name|y1
operator|)
decl_stmt|,
name|x1fact
init|=
literal|1.0
operator|-
name|x2fact
decl_stmt|,
name|y1fact
init|=
literal|1.0
operator|-
name|y2fact
decl_stmt|,
name|p1fact
init|=
name|x1fact
operator|*
name|y1fact
decl_stmt|,
name|p2fact
init|=
name|x1fact
operator|*
name|y2fact
decl_stmt|,
name|p3fact
init|=
name|x2fact
operator|*
name|y1fact
decl_stmt|,
name|p4fact
init|=
name|x2fact
operator|*
name|y2fact
decl_stmt|;
specifier|static
name|unsigned
name|char
name|blackPixel
index|[]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixel1
decl_stmt|,
modifier|*
name|pixel2
decl_stmt|,
modifier|*
name|pixel3
decl_stmt|,
modifier|*
name|pixel4
decl_stmt|;
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel1
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel1
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
operator|||
name|x1
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel2
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel2
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x1
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y1
operator|<
literal|0
operator|||
name|y1
operator|>=
name|imageHeight
condition|)
name|pixel3
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel3
operator|=
name|imageData
operator|+
operator|(
name|y1
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|x2
operator|<
literal|0
operator|||
name|x2
operator|>=
name|imageWidth
operator|||
name|y2
operator|<
literal|0
operator|||
name|y2
operator|>=
name|imageHeight
condition|)
name|pixel4
operator|=
name|blackPixel
expr_stmt|;
else|else
name|pixel4
operator|=
name|imageData
operator|+
operator|(
name|y2
operator|*
name|imageWidth
operator|+
name|x2
operator|)
operator|*
literal|3
expr_stmt|;
name|red
operator|=
name|pixel1
index|[
literal|0
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|0
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|0
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|0
index|]
operator|*
name|p4fact
expr_stmt|;
name|green
operator|=
name|pixel1
index|[
literal|1
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|1
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|1
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|1
index|]
operator|*
name|p4fact
expr_stmt|;
name|blue
operator|=
name|pixel1
index|[
literal|2
index|]
operator|*
name|p1fact
operator|+
name|pixel2
index|[
literal|2
index|]
operator|*
name|p2fact
operator|+
name|pixel3
index|[
literal|2
index|]
operator|*
name|p3fact
operator|+
name|pixel4
index|[
literal|2
index|]
operator|*
name|p4fact
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|=
name|color_to_double
argument_list|(
name|red
argument_list|,
name|green
argument_list|,
name|blue
argument_list|)
expr_stmt|;
operator|--
name|stackp
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _GIMP */
end_comment

begin_function
name|void
DECL|function|builtin_red (void * arg)
name|builtin_red
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|red_component
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|/
literal|255.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_green (void * arg)
name|builtin_green
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|green_component
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|/
literal|255.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_blue (void * arg)
name|builtin_blue
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|blue_component
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|/
literal|255.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_gray (void * arg)
name|builtin_gray
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|,
name|alpha
decl_stmt|;
name|double_to_color
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|,
operator|&
name|red
argument_list|,
operator|&
name|green
argument_list|,
operator|&
name|blue
argument_list|,
operator|&
name|alpha
argument_list|)
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
operator|(
literal|0.299
operator|*
name|red
operator|+
literal|0.587
operator|*
name|green
operator|+
literal|0.114
operator|*
name|blue
operator|)
operator|/
literal|255.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_alpha (void * arg)
name|builtin_alpha
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|alpha_component
argument_list|(
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
argument_list|)
operator|/
literal|255.0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_rgbColor (void * arg)
name|builtin_rgbColor
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|redComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|*
literal|255
decl_stmt|,
name|greenComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|*
literal|255
decl_stmt|,
name|blueComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
literal|255
decl_stmt|;
name|stackp
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|redComponent
operator|<
literal|0
condition|)
name|redComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|redComponent
operator|>
literal|255
condition|)
name|redComponent
operator|=
literal|255
expr_stmt|;
if|if
condition|(
name|greenComponent
operator|<
literal|0
condition|)
name|greenComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|greenComponent
operator|>
literal|255
condition|)
name|greenComponent
operator|=
literal|255
expr_stmt|;
if|if
condition|(
name|blueComponent
operator|<
literal|0
condition|)
name|blueComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|blueComponent
operator|>
literal|255
condition|)
name|blueComponent
operator|=
literal|255
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|color_to_double
argument_list|(
name|redComponent
argument_list|,
name|greenComponent
argument_list|,
name|blueComponent
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_rgbaColor (void * arg)
name|builtin_rgbaColor
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|redComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|4
index|]
operator|*
literal|255
decl_stmt|,
name|greenComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|3
index|]
operator|*
literal|255
decl_stmt|,
name|blueComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|*
literal|255
decl_stmt|,
name|alphaComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
literal|255
decl_stmt|;
name|stackp
operator|-=
literal|3
expr_stmt|;
if|if
condition|(
name|redComponent
operator|<
literal|0
condition|)
name|redComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|redComponent
operator|>
literal|255
condition|)
name|redComponent
operator|=
literal|255
expr_stmt|;
if|if
condition|(
name|greenComponent
operator|<
literal|0
condition|)
name|greenComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|greenComponent
operator|>
literal|255
condition|)
name|greenComponent
operator|=
literal|255
expr_stmt|;
if|if
condition|(
name|blueComponent
operator|<
literal|0
condition|)
name|blueComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|blueComponent
operator|>
literal|255
condition|)
name|blueComponent
operator|=
literal|255
expr_stmt|;
if|if
condition|(
name|alphaComponent
operator|<
literal|0
condition|)
name|alphaComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|alphaComponent
operator|>
literal|255
condition|)
name|alphaComponent
operator|=
literal|255
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|color_to_double
argument_list|(
name|redComponent
argument_list|,
name|greenComponent
argument_list|,
name|blueComponent
argument_list|,
name|alphaComponent
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_grayColor (void * arg)
name|builtin_grayColor
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|grayLevel
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
literal|255
decl_stmt|;
if|if
condition|(
name|grayLevel
operator|<
literal|0
condition|)
name|grayLevel
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|grayLevel
operator|>
literal|255
condition|)
name|grayLevel
operator|=
literal|255
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|color_to_double
argument_list|(
name|grayLevel
argument_list|,
name|grayLevel
argument_list|,
name|grayLevel
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|builtin_grayaColor (void * arg)
name|builtin_grayaColor
parameter_list|(
name|void
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|grayLevel
init|=
name|stack
index|[
name|stackp
operator|-
literal|2
index|]
operator|*
literal|255
decl_stmt|,
name|alphaComponent
init|=
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|*
literal|255
decl_stmt|;
operator|--
name|stackp
expr_stmt|;
if|if
condition|(
name|grayLevel
operator|<
literal|0
condition|)
name|grayLevel
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|grayLevel
operator|>
literal|255
condition|)
name|grayLevel
operator|=
literal|255
expr_stmt|;
if|if
condition|(
name|alphaComponent
operator|<
literal|0
condition|)
name|alphaComponent
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|alphaComponent
operator|>
literal|255
condition|)
name|alphaComponent
operator|=
literal|255
expr_stmt|;
name|stack
index|[
name|stackp
operator|-
literal|1
index|]
operator|=
name|color_to_double
argument_list|(
name|grayLevel
argument_list|,
name|grayLevel
argument_list|,
name|grayLevel
argument_list|,
name|alphaComponent
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|builtin
modifier|*
DECL|function|builtin_with_name (const char * name)
name|builtin_with_name
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|builtin
modifier|*
name|next
decl_stmt|;
if|if
condition|(
name|intersamplingEnabled
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"origValXY"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|builtin_with_name
argument_list|(
literal|"origValXYIntersample"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"origValRA"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|builtin_with_name
argument_list|(
literal|"origValRAIntersample"
argument_list|)
return|;
block|}
for|for
control|(
name|next
operator|=
name|firstBuiltin
init|;
name|next
operator|!=
literal|0
condition|;
name|next
operator|=
name|next
operator|->
name|next
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|next
operator|->
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
name|next
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
DECL|function|register_builtin (const char * name,builtinFunction function,int numParams)
name|register_builtin
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|builtinFunction
name|function
parameter_list|,
name|int
name|numParams
parameter_list|)
block|{
name|builtin
modifier|*
name|theBuiltin
init|=
operator|(
name|builtin
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|builtin
argument_list|)
argument_list|)
decl_stmt|;
name|strncpy
argument_list|(
name|theBuiltin
operator|->
name|name
argument_list|,
name|name
argument_list|,
name|MAX_BUILTIN_LENGTH
argument_list|)
expr_stmt|;
name|theBuiltin
operator|->
name|name
index|[
name|MAX_BUILTIN_LENGTH
index|]
operator|=
literal|'\0'
expr_stmt|;
name|theBuiltin
operator|->
name|function
operator|=
name|function
expr_stmt|;
name|theBuiltin
operator|->
name|numParams
operator|=
name|numParams
expr_stmt|;
name|theBuiltin
operator|->
name|next
operator|=
name|firstBuiltin
expr_stmt|;
name|firstBuiltin
operator|=
name|theBuiltin
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|init_builtins (void)
name|init_builtins
parameter_list|(
name|void
parameter_list|)
block|{
name|register_builtin
argument_list|(
literal|"sin"
argument_list|,
name|builtin_sin
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"cos"
argument_list|,
name|builtin_cos
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"tan"
argument_list|,
name|builtin_tan
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"asin"
argument_list|,
name|builtin_asin
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"acos"
argument_list|,
name|builtin_acos
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"atan"
argument_list|,
name|builtin_atan
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"pow"
argument_list|,
name|builtin_pow
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"abs"
argument_list|,
name|builtin_abs
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"floor"
argument_list|,
name|builtin_floor
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"sign"
argument_list|,
name|builtin_sign
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"min"
argument_list|,
name|builtin_min
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"max"
argument_list|,
name|builtin_max
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"not"
argument_list|,
name|builtin_not
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"or"
argument_list|,
name|builtin_or
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"and"
argument_list|,
name|builtin_and
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"equal"
argument_list|,
name|builtin_equal
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"less"
argument_list|,
name|builtin_less
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"greater"
argument_list|,
name|builtin_greater
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"lessequal"
argument_list|,
name|builtin_lessequal
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"greaterequal"
argument_list|,
name|builtin_greaterequal
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"notequal"
argument_list|,
name|builtin_notequal
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"inintv"
argument_list|,
name|builtin_inintv
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"rand"
argument_list|,
name|builtin_rand
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"origValXY"
argument_list|,
name|builtin_origValXY
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"origValXYIntersample"
argument_list|,
name|builtin_origValXYIntersample
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"origValRA"
argument_list|,
name|builtin_origValRA
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"origValRAIntersample"
argument_list|,
name|builtin_origValRAIntersample
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"red"
argument_list|,
name|builtin_red
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"green"
argument_list|,
name|builtin_green
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"blue"
argument_list|,
name|builtin_blue
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"gray"
argument_list|,
name|builtin_gray
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"alpha"
argument_list|,
name|builtin_alpha
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"rgbColor"
argument_list|,
name|builtin_rgbColor
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"rgbaColor"
argument_list|,
name|builtin_rgbaColor
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"grayColor"
argument_list|,
name|builtin_grayColor
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|register_builtin
argument_list|(
literal|"grayaColor"
argument_list|,
name|builtin_grayaColor
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

