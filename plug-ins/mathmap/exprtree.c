begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|"exprtree.h"
end_include

begin_include
include|#
directive|include
file|"builtins.h"
end_include

begin_decl_stmt
specifier|extern
name|double
name|currentX
decl_stmt|,
name|currentY
decl_stmt|,
name|currentR
decl_stmt|,
name|currentA
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|imageWidth
decl_stmt|,
name|imageHeight
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|usesRA
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|intersamplingEnabled
decl_stmt|;
end_decl_stmt

begin_function
name|exprtree
modifier|*
DECL|function|make_number (double num)
name|make_number
parameter_list|(
name|double
name|num
parameter_list|)
block|{
name|exprtree
modifier|*
name|tree
init|=
operator|(
name|exprtree
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|exprtree
argument_list|)
argument_list|)
decl_stmt|;
name|tree
operator|->
name|type
operator|=
name|EXPR_NUMBER
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|number
operator|=
name|num
expr_stmt|;
name|tree
operator|->
name|next
operator|=
literal|0
expr_stmt|;
return|return
name|tree
return|;
block|}
end_function

begin_function
name|exprtree
modifier|*
DECL|function|make_var (char * name)
name|make_var
parameter_list|(
name|char
modifier|*
name|name
parameter_list|)
block|{
name|exprtree
modifier|*
name|tree
init|=
operator|(
name|exprtree
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|exprtree
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"x"
argument_list|)
operator|==
literal|0
condition|)
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_X
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"y"
argument_list|)
operator|==
literal|0
condition|)
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_Y
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"r"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_R
expr_stmt|;
name|usesRA
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_A
expr_stmt|;
name|usesRA
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"W"
argument_list|)
operator|==
literal|0
condition|)
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_W
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"H"
argument_list|)
operator|==
literal|0
condition|)
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_H
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"R"
argument_list|)
operator|==
literal|0
condition|)
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_BIG_R
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"X"
argument_list|)
operator|==
literal|0
condition|)
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_BIG_X
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"Y"
argument_list|)
operator|==
literal|0
condition|)
name|tree
operator|->
name|type
operator|=
name|EXPR_VAR_BIG_Y
expr_stmt|;
else|else
block|{
name|tree
operator|->
name|type
operator|=
name|EXPR_NUMBER
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|number
operator|=
literal|0.0
expr_stmt|;
block|}
name|tree
operator|->
name|next
operator|=
literal|0
expr_stmt|;
return|return
name|tree
return|;
block|}
end_function

begin_function
name|exprtree
modifier|*
DECL|function|make_operator (int type,exprtree * left,exprtree * right)
name|make_operator
parameter_list|(
name|int
name|type
parameter_list|,
name|exprtree
modifier|*
name|left
parameter_list|,
name|exprtree
modifier|*
name|right
parameter_list|)
block|{
name|exprtree
modifier|*
name|tree
init|=
operator|(
name|exprtree
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|exprtree
argument_list|)
argument_list|)
decl_stmt|;
name|tree
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|left
operator|=
name|left
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|operator
operator|.
name|right
operator|=
name|right
expr_stmt|;
name|tree
operator|->
name|next
operator|=
literal|0
expr_stmt|;
return|return
name|tree
return|;
block|}
end_function

begin_function
name|exprtree
modifier|*
DECL|function|make_function (char * name,exprtree * args)
name|make_function
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|exprtree
modifier|*
name|args
parameter_list|)
block|{
name|exprtree
modifier|*
name|tree
init|=
operator|(
name|exprtree
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|exprtree
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"if"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_if
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"sin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_sin
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"cos"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_cos
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"tan"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_tan
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"asin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_asin
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"acos"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_acos
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"atan"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_atan
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"sign"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_sign
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"min"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_min
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"max"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_max
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"inintv"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_inintv
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"rand"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_rand
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"origValXY"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|intersamplingEnabled
condition|)
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_origValXYIntersample
expr_stmt|;
else|else
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_origValXY
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"origValRA"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|intersamplingEnabled
condition|)
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_origValRAIntersample
expr_stmt|;
else|else
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_origValRA
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"grayColor"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|routine
operator|=
name|builtin_grayColor
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|numArgs
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|tree
operator|->
name|type
operator|=
name|EXPR_NUMBER
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|number
operator|=
literal|0.0
expr_stmt|;
name|tree
operator|->
name|next
operator|=
literal|0
expr_stmt|;
return|return
name|tree
return|;
block|}
name|tree
operator|->
name|type
operator|=
name|EXPR_FUNC
expr_stmt|;
name|tree
operator|->
name|val
operator|.
name|func
operator|.
name|args
operator|=
name|args
expr_stmt|;
name|tree
operator|->
name|next
operator|=
literal|0
expr_stmt|;
return|return
name|tree
return|;
block|}
end_function

begin_function
name|exprtree
modifier|*
DECL|function|arglist_append (exprtree * list1,exprtree * list2)
name|arglist_append
parameter_list|(
name|exprtree
modifier|*
name|list1
parameter_list|,
name|exprtree
modifier|*
name|list2
parameter_list|)
block|{
name|exprtree
modifier|*
name|tree
init|=
name|list1
decl_stmt|;
while|while
condition|(
name|tree
operator|->
name|next
operator|!=
literal|0
condition|)
name|tree
operator|=
name|tree
operator|->
name|next
expr_stmt|;
name|tree
operator|->
name|next
operator|=
name|list2
expr_stmt|;
return|return
name|list1
return|;
block|}
end_function

end_unit

