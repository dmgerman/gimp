begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_function
DECL|function|mul8bit (int a,int b)
name|int
name|mul8bit
parameter_list|(
name|int
name|a
parameter_list|,
name|int
name|b
parameter_list|)
block|{
name|int
name|t
init|=
name|a
operator|*
name|b
operator|+
literal|128
decl_stmt|;
return|return
operator|(
operator|(
name|t
operator|+
operator|(
name|t
operator|>>
literal|8
operator|)
operator|)
operator|>>
literal|8
operator|)
return|;
block|}
end_function

begin_function
DECL|function|lerp13 (int a,int b)
name|int
name|lerp13
parameter_list|(
name|int
name|a
parameter_list|,
name|int
name|b
parameter_list|)
block|{
if|#
directive|if
literal|0
block|return(a + mul8bit(b - a, 0x55));
else|#
directive|else
return|return
operator|(
operator|(
literal|2
operator|*
name|a
operator|+
name|b
operator|)
operator|/
literal|3
operator|)
return|;
endif|#
directive|endif
block|}
end_function

begin_function
DECL|function|prepare_opt_table (unsigned char * tab,const unsigned char * expand,int size)
specifier|static
name|void
name|prepare_opt_table
parameter_list|(
name|unsigned
name|char
modifier|*
name|tab
parameter_list|,
specifier|const
name|unsigned
name|char
modifier|*
name|expand
parameter_list|,
name|int
name|size
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|mn
decl_stmt|,
name|mx
decl_stmt|,
name|bestE
decl_stmt|,
name|minE
decl_stmt|,
name|maxE
decl_stmt|,
name|e
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
operator|++
name|i
control|)
block|{
name|bestE
operator|=
literal|256
operator|*
literal|100
expr_stmt|;
for|for
control|(
name|mn
operator|=
literal|0
init|;
name|mn
operator|<
name|size
condition|;
operator|++
name|mn
control|)
block|{
for|for
control|(
name|mx
operator|=
literal|0
init|;
name|mx
operator|<
name|size
condition|;
operator|++
name|mx
control|)
block|{
name|minE
operator|=
name|expand
index|[
name|mn
index|]
expr_stmt|;
name|maxE
operator|=
name|expand
index|[
name|mx
index|]
expr_stmt|;
name|e
operator|=
name|abs
argument_list|(
name|lerp13
argument_list|(
name|maxE
argument_list|,
name|minE
argument_list|)
operator|-
name|i
argument_list|)
operator|*
literal|100
expr_stmt|;
name|e
operator|+=
name|abs
argument_list|(
name|mx
operator|-
name|mn
argument_list|)
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|e
operator|<
name|bestE
condition|)
block|{
name|tab
index|[
name|i
operator|*
literal|2
operator|+
literal|0
index|]
operator|=
name|mx
expr_stmt|;
name|tab
index|[
name|i
operator|*
literal|2
operator|+
literal|1
index|]
operator|=
name|mn
expr_stmt|;
name|bestE
operator|=
name|e
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
end_function

begin_function
DECL|function|main (void)
name|int
name|main
parameter_list|(
name|void
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|int
name|i
decl_stmt|,
name|v
decl_stmt|;
name|unsigned
name|char
name|expand5
index|[
literal|32
index|]
decl_stmt|;
name|unsigned
name|char
name|expand6
index|[
literal|64
index|]
decl_stmt|;
name|unsigned
name|char
name|quantRB
index|[
literal|256
operator|+
literal|16
index|]
decl_stmt|;
name|unsigned
name|char
name|quantG
index|[
literal|256
operator|+
literal|16
index|]
decl_stmt|;
name|unsigned
name|char
name|omatch5
index|[
literal|256
index|]
index|[
literal|2
index|]
decl_stmt|;
name|unsigned
name|char
name|omatch6
index|[
literal|256
index|]
index|[
literal|2
index|]
decl_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
literal|"dxt_tables.h"
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"#ifndef DXT_TABLES_H\n"
literal|"#define DXT_TABLES_H\n\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|32
condition|;
operator|++
name|i
control|)
name|expand5
index|[
name|i
index|]
operator|=
operator|(
name|i
operator|<<
literal|3
operator|)
operator||
operator|(
name|i
operator|>>
literal|2
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|64
condition|;
operator|++
name|i
control|)
name|expand6
index|[
name|i
index|]
operator|=
operator|(
name|i
operator|<<
literal|2
operator|)
operator||
operator|(
name|i
operator|>>
literal|4
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
operator|+
literal|16
condition|;
operator|++
name|i
control|)
block|{
name|v
operator|=
name|i
operator|-
literal|8
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0
condition|)
name|v
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|v
operator|>
literal|255
condition|)
name|v
operator|=
literal|255
expr_stmt|;
name|quantRB
index|[
name|i
index|]
operator|=
name|expand5
index|[
name|mul8bit
argument_list|(
name|v
argument_list|,
literal|31
argument_list|)
index|]
expr_stmt|;
name|quantG
index|[
name|i
index|]
operator|=
name|expand6
index|[
name|mul8bit
argument_list|(
name|v
argument_list|,
literal|63
argument_list|)
index|]
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"static const unsigned char quantRB[256 + 16] =\n"
literal|"{"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
operator|+
literal|16
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
name|i
operator|%
literal|8
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n   "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"0x%02x, "
argument_list|,
name|quantRB
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n};\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"static const unsigned char quantG[256 + 16] =\n"
literal|"{"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
operator|+
literal|16
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
name|i
operator|%
literal|8
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n   "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"0x%02x, "
argument_list|,
name|quantG
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n};\n\n"
argument_list|)
expr_stmt|;
name|prepare_opt_table
argument_list|(
operator|&
name|omatch5
index|[
literal|0
index|]
index|[
literal|0
index|]
argument_list|,
name|expand5
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|prepare_opt_table
argument_list|(
operator|&
name|omatch6
index|[
literal|0
index|]
index|[
literal|0
index|]
argument_list|,
name|expand6
argument_list|,
literal|64
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"static const unsigned char omatch5[256][2] =\n"
literal|"{"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
name|i
operator|%
literal|4
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n   "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"{0x%02x, 0x%02x}, "
argument_list|,
name|omatch5
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|,
name|omatch5
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n};\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"static const unsigned char omatch6[256][2] =\n"
literal|"{"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
name|i
operator|%
literal|4
operator|==
literal|0
condition|)
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n   "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"{0x%02x, 0x%02x}, "
argument_list|,
name|omatch6
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|,
name|omatch6
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"\n};\n\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"#endif\n"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
end_function

end_unit

