begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* -*- Mode: C; c-basic-offset: 4 -*-  * Gimp-Python - allows the writing of Gimp plugins in Python.  * Copyright (C) 2005-2006  Manish Singh<yosh@gimp.org>  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<https://www.gnu.org/licenses/>.  */
end_comment

begin_define
DECL|macro|NO_IMPORT_PYGOBJECT
define|#
directive|define
name|NO_IMPORT_PYGOBJECT
end_define

begin_include
include|#
directive|include
file|"pygimp.h"
end_include

begin_include
include|#
directive|include
file|"pygimpcolor.h"
end_include

begin_include
include|#
directive|include
file|<libgimpmath/gimpmath.h>
end_include

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_set (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_set
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|r
init|=
name|NULL
decl_stmt|,
modifier|*
name|g
init|=
name|NULL
decl_stmt|,
modifier|*
name|b
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpRGB
name|tmprgb
decl_stmt|,
modifier|*
name|rgb
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"r"
block|,
literal|"g"
block|,
literal|"b"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|OOOO:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|r
operator|&&
operator|!
name|g
operator|&&
operator|!
name|b
operator|&&
operator|!
name|a
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide r,g,b or a arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|(
name|r
operator|&&
operator|(
operator|!
name|g
operator|||
operator|!
name|b
operator|)
operator|)
operator|||
operator|(
name|g
operator|&&
operator|(
operator|!
name|r
operator|||
operator|!
name|b
operator|)
operator|)
operator|||
operator|(
name|b
operator|&&
operator|(
operator|!
name|r
operator|||
operator|!
name|g
operator|)
operator|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide all 3 r,g,b arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
name|tmprgb
operator|=
operator|*
name|rgb
expr_stmt|;
DECL|macro|SET_MEMBER (m)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|)
value|G_STMT_START {				\     if (PyInt_Check(m))						\ 	tmprgb.m = (double) PyInt_AS_LONG(m) / 255.0;		\     else if (PyFloat_Check(m))					\         tmprgb.m = PyFloat_AS_DOUBLE(m);			\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be an int or a float");	\ 	return NULL;						\     }								\ } G_STMT_END
if|if
condition|(
name|r
condition|)
block|{
name|SET_MEMBER
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|b
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
operator|*
name|rgb
operator|=
name|tmprgb
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_set_alpha (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_set_alpha
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|py_a
decl_stmt|;
name|GimpRGB
modifier|*
name|rgb
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O:set_alpha"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|py_a
argument_list|)
condition|)
return|return
name|NULL
return|;
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
if|if
condition|(
name|PyInt_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|rgb
operator|->
name|a
operator|=
operator|(
name|double
operator|)
name|PyInt_AS_LONG
argument_list|(
name|py_a
argument_list|)
operator|/
literal|255.0
expr_stmt|;
elseif|else
if|if
condition|(
name|PyFloat_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|rgb
operator|->
name|a
operator|=
name|PyFloat_AS_DOUBLE
argument_list|(
name|py_a
argument_list|)
expr_stmt|;
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"a must be an int or a float"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_add (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_add
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|color
decl_stmt|;
name|gboolean
name|with_alpha
init|=
name|FALSE
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"color"
block|,
literal|"with_alpha"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O!|i:add"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|PyGimpRGB_Type
argument_list|,
operator|&
name|color
argument_list|,
operator|&
name|with_alpha
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|with_alpha
condition|)
name|gimp_rgba_add
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|pyg_boxed_get
argument_list|(
name|color
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|gimp_rgb_add
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|pyg_boxed_get
argument_list|(
name|color
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_subtract (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_subtract
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|color
decl_stmt|;
name|gboolean
name|with_alpha
init|=
name|FALSE
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"color"
block|,
literal|"with_alpha"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O!|i:subtract"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|PyGimpRGB_Type
argument_list|,
operator|&
name|color
argument_list|,
operator|&
name|with_alpha
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|with_alpha
condition|)
name|gimp_rgba_subtract
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|pyg_boxed_get
argument_list|(
name|color
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|gimp_rgb_subtract
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|pyg_boxed_get
argument_list|(
name|color
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_multiply (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_multiply
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|factor
decl_stmt|;
name|gboolean
name|with_alpha
init|=
name|FALSE
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"factor"
block|,
literal|"with_alpha"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"d|i:multiply"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|factor
argument_list|,
operator|&
name|with_alpha
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|with_alpha
condition|)
name|gimp_rgba_multiply
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|factor
argument_list|)
expr_stmt|;
else|else
name|gimp_rgb_multiply
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|factor
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_distance (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_distance
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|color
decl_stmt|;
name|gboolean
name|alpha
init|=
name|FALSE
decl_stmt|;
name|double
name|ret
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"color"
block|,
literal|"alpha"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O!|i:distance"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|PyGimpRGB_Type
argument_list|,
operator|&
name|color
argument_list|,
operator|&
name|alpha
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ret
operator|=
name|gimp_rgb_distance
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|pyg_boxed_get
argument_list|(
name|color
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|PyFloat_FromDouble
argument_list|(
name|ret
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_max (PyObject * self)
name|rgb_max
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyFloat_FromDouble
argument_list|(
name|gimp_rgb_max
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_min (PyObject * self)
name|rgb_min
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyFloat_FromDouble
argument_list|(
name|gimp_rgb_min
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_clamp (PyObject * self)
name|rgb_clamp
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|gimp_rgb_clamp
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_gamma (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_gamma
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|gamma
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"gamma"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"d:gamma"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|gamma
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_rgb_gamma
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|gamma
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_luminance (PyObject * self)
name|rgb_luminance
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyFloat_FromDouble
argument_list|(
name|gimp_rgb_luminance
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_composite (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_composite
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|color
decl_stmt|;
name|int
name|mode
init|=
name|GIMP_RGB_COMPOSITE_NORMAL
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"color"
block|,
literal|"mode"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O!|i:composite"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|PyGimpRGB_Type
argument_list|,
operator|&
name|color
argument_list|,
operator|&
name|mode
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|mode
operator|<
name|GIMP_RGB_COMPOSITE_NONE
operator|||
name|mode
operator|>
name|GIMP_RGB_COMPOSITE_BEHIND
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"composite type is not valid"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|gimp_rgb_composite
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|pyg_boxed_get
argument_list|(
name|color
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_parse_name (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_parse_name
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|len
decl_stmt|;
name|gboolean
name|success
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"name"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"s#:parse_name"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|len
argument_list|)
condition|)
return|return
name|NULL
return|;
name|success
operator|=
name|gimp_rgb_parse_name
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|name
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|success
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_ValueError
argument_list|,
literal|"unable to parse color name"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_parse_hex (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_parse_hex
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|char
modifier|*
name|hex
decl_stmt|;
name|int
name|len
decl_stmt|;
name|gboolean
name|success
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"hex"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"s#:parse_hex"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|hex
argument_list|,
operator|&
name|len
argument_list|)
condition|)
return|return
name|NULL
return|;
name|success
operator|=
name|gimp_rgb_parse_hex
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|hex
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|success
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_ValueError
argument_list|,
literal|"unable to parse hex value"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_parse_css (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_parse_css
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|char
modifier|*
name|css
decl_stmt|;
name|int
name|len
decl_stmt|;
name|gboolean
name|success
decl_stmt|,
name|with_alpha
init|=
name|FALSE
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"css"
block|,
literal|"with_alpha"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"s#|i:parse_css"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|css
argument_list|,
operator|&
name|len
argument_list|,
operator|&
name|with_alpha
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|with_alpha
condition|)
name|success
operator|=
name|gimp_rgba_parse_css
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|css
argument_list|,
name|len
argument_list|)
expr_stmt|;
else|else
name|success
operator|=
name|gimp_rgb_parse_css
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
argument_list|,
name|css
argument_list|,
name|len
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|success
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_ValueError
argument_list|,
literal|"unable to parse CSS color"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_to_hsv (PyObject * self)
name|rgb_to_hsv
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpRGB
modifier|*
name|rgb
decl_stmt|;
name|GimpHSV
name|hsv
decl_stmt|;
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
name|gimp_rgb_to_hsv
argument_list|(
name|rgb
argument_list|,
operator|&
name|hsv
argument_list|)
expr_stmt|;
return|return
name|pygimp_hsv_new
argument_list|(
operator|&
name|hsv
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_to_hsl (PyObject * self)
name|rgb_to_hsl
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpRGB
modifier|*
name|rgb
decl_stmt|;
name|GimpHSL
name|hsl
decl_stmt|;
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
name|gimp_rgb_to_hsl
argument_list|(
name|rgb
argument_list|,
operator|&
name|hsl
argument_list|)
expr_stmt|;
return|return
name|pygimp_hsl_new
argument_list|(
operator|&
name|hsl
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_to_cmyk (PyObject * self,PyObject * args,PyObject * kwargs)
name|rgb_to_cmyk
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|GimpRGB
modifier|*
name|rgb
decl_stmt|;
name|GimpCMYK
name|cmyk
decl_stmt|;
name|gdouble
name|pullout
init|=
literal|1.0
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"pullout"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|d:to_cmyk"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|pullout
argument_list|)
condition|)
return|return
name|NULL
return|;
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
name|gimp_rgb_to_cmyk
argument_list|(
name|rgb
argument_list|,
name|pullout
argument_list|,
operator|&
name|cmyk
argument_list|)
expr_stmt|;
return|return
name|pygimp_cmyk_new
argument_list|(
operator|&
name|cmyk
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* __getstate__ isn't exposed */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_getstate (PyObject * self)
name|rgb_getstate
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpRGB
modifier|*
name|rgb
decl_stmt|;
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"dddd"
argument_list|,
name|rgb
operator|->
name|r
argument_list|,
name|rgb
operator|->
name|g
argument_list|,
name|rgb
operator|->
name|b
argument_list|,
name|rgb
operator|->
name|a
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_reduce (PyObject * self)
name|rgb_reduce
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|Py_BuildValue
argument_list|(
literal|"ON"
argument_list|,
name|self
operator|->
name|ob_type
argument_list|,
name|rgb_getstate
argument_list|(
name|self
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|rgb_methods
specifier|static
name|PyMethodDef
name|rgb_methods
index|[]
init|=
block|{
block|{
literal|"set"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_set
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"set_alpha"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_set_alpha
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"add"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_add
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"subtract"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_subtract
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"multiply"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_multiply
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"distance"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_distance
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"max"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_max
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"min"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_min
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"clamp"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_clamp
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"gamma"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_gamma
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"luminance"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_luminance
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"composite"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_composite
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"parse_name"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_parse_name
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"parse_hex"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_parse_hex
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"parse_css"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_parse_css
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"to_hsv"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_to_hsv
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"to_hsl"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_to_hsl
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"to_cmyk"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_to_cmyk
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"__reduce__"
block|,
operator|(
name|PyCFunction
operator|)
name|rgb_reduce
block|,
name|METH_NOARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|MEMBER_ACCESSOR (m)
define|#
directive|define
name|MEMBER_ACCESSOR
parameter_list|(
name|m
parameter_list|)
define|\
value|static PyObject *							\ rgb_get_ ## m(PyObject *self, void *closure)				\ {									\     return PyFloat_FromDouble(pyg_boxed_get(self, GimpRGB)->m);		\ }									\ static int								\ rgb_set_ ## m(PyObject *self, PyObject *value, void *closure)		\ {									\     GimpRGB *rgb = pyg_boxed_get(self, GimpRGB);			\     if (value == NULL) {						\ 	PyErr_SetString(PyExc_TypeError, "cannot delete value");	\ 	return -1;							\     }									\     else if (PyInt_Check(value))					\ 	rgb->m = (double) PyInt_AS_LONG(value) / 255.0;			\     else if (PyFloat_Check(value))					\         rgb->m = PyFloat_AS_DOUBLE(value);				\     else {								\ 	PyErr_SetString(PyExc_TypeError, "type mismatch");		\ 	return -1;							\     }									\     return 0;								\ }
end_define

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|r
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|g
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|b
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|a
argument_list|)
expr_stmt|;
end_expr_stmt

begin_undef
undef|#
directive|undef
name|MEMBER_ACCESSOR
end_undef

begin_decl_stmt
DECL|variable|rgb_getsets
specifier|static
name|PyGetSetDef
name|rgb_getsets
index|[]
init|=
block|{
block|{
literal|"r"
block|,
operator|(
name|getter
operator|)
name|rgb_get_r
block|,
operator|(
name|setter
operator|)
name|rgb_set_r
block|}
block|,
block|{
literal|"g"
block|,
operator|(
name|getter
operator|)
name|rgb_get_g
block|,
operator|(
name|setter
operator|)
name|rgb_set_g
block|}
block|,
block|{
literal|"b"
block|,
operator|(
name|getter
operator|)
name|rgb_get_b
block|,
operator|(
name|setter
operator|)
name|rgb_set_b
block|}
block|,
block|{
literal|"a"
block|,
operator|(
name|getter
operator|)
name|rgb_get_a
block|,
operator|(
name|setter
operator|)
name|rgb_set_a
block|}
block|,
block|{
literal|"red"
block|,
operator|(
name|getter
operator|)
name|rgb_get_r
block|,
operator|(
name|setter
operator|)
name|rgb_set_r
block|}
block|,
block|{
literal|"green"
block|,
operator|(
name|getter
operator|)
name|rgb_get_g
block|,
operator|(
name|setter
operator|)
name|rgb_set_g
block|}
block|,
block|{
literal|"blue"
block|,
operator|(
name|getter
operator|)
name|rgb_get_b
block|,
operator|(
name|setter
operator|)
name|rgb_set_b
block|}
block|,
block|{
literal|"alpha"
block|,
operator|(
name|getter
operator|)
name|rgb_get_a
block|,
operator|(
name|setter
operator|)
name|rgb_set_a
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Py_ssize_t
DECL|function|rgb_length (PyObject * self)
name|rgb_length
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
literal|4
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_getitem (PyObject * self,Py_ssize_t pos)
name|rgb_getitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|)
block|{
name|GimpRGB
modifier|*
name|rgb
decl_stmt|;
name|double
name|val
decl_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|4
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
name|val
operator|=
name|rgb
operator|->
name|r
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|val
operator|=
name|rgb
operator|->
name|g
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|val
operator|=
name|rgb
operator|->
name|b
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|val
operator|=
name|rgb
operator|->
name|a
expr_stmt|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|PyInt_FromLong
argument_list|(
name|ROUND
argument_list|(
name|CLAMP
argument_list|(
name|val
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
operator|*
literal|255.0
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|rgb_setitem (PyObject * self,Py_ssize_t pos,PyObject * value)
name|rgb_setitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|)
block|{
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|4
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
return|return
name|rgb_set_r
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|1
case|:
return|return
name|rgb_set_g
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|2
case|:
return|return
name|rgb_set_b
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|3
case|:
return|return
name|rgb_set_a
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_slice (PyObject * self,Py_ssize_t start,Py_ssize_t end)
name|rgb_slice
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|start
parameter_list|,
name|Py_ssize_t
name|end
parameter_list|)
block|{
name|PyTupleObject
modifier|*
name|ret
decl_stmt|;
name|Py_ssize_t
name|i
decl_stmt|;
if|if
condition|(
name|start
operator|<
literal|0
condition|)
name|start
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|end
operator|>
literal|4
condition|)
name|end
operator|=
literal|4
expr_stmt|;
if|if
condition|(
name|end
operator|<
name|start
condition|)
name|end
operator|=
name|start
expr_stmt|;
name|ret
operator|=
operator|(
name|PyTupleObject
operator|*
operator|)
name|PyTuple_New
argument_list|(
name|end
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|i
operator|=
name|start
init|;
name|i
operator|<
name|end
condition|;
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
operator|-
name|start
argument_list|,
name|rgb_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|ret
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|rgb_as_sequence
specifier|static
name|PySequenceMethods
name|rgb_as_sequence
init|=
block|{
name|rgb_length
block|,
operator|(
name|binaryfunc
operator|)
literal|0
block|,
literal|0
block|,
name|rgb_getitem
block|,
name|rgb_slice
block|,
name|rgb_setitem
block|,
literal|0
block|,
operator|(
name|objobjproc
operator|)
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_subscript (PyObject * self,PyObject * item)
name|rgb_subscript
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|item
parameter_list|)
block|{
if|if
condition|(
name|PyInt_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyInt_AS_LONG
argument_list|(
name|item
argument_list|)
decl_stmt|;
return|return
name|rgb_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PyLong_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyLong_AsLong
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|i
operator|==
operator|-
literal|1
operator|&&
name|PyErr_Occurred
argument_list|()
condition|)
return|return
name|NULL
return|;
return|return
name|rgb_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PySlice_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|Py_ssize_t
name|start
decl_stmt|,
name|stop
decl_stmt|,
name|step
decl_stmt|,
name|slicelength
decl_stmt|,
name|cur
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|PySlice_GetIndicesEx
argument_list|(
operator|(
name|PySliceObject
operator|*
operator|)
name|item
argument_list|,
literal|4
argument_list|,
operator|&
name|start
argument_list|,
operator|&
name|stop
argument_list|,
operator|&
name|step
argument_list|,
operator|&
name|slicelength
argument_list|)
operator|<
literal|0
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|slicelength
operator|<=
literal|0
condition|)
block|{
return|return
name|PyTuple_New
argument_list|(
literal|0
argument_list|)
return|;
block|}
else|else
block|{
name|ret
operator|=
name|PyTuple_New
argument_list|(
name|slicelength
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|cur
operator|=
name|start
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|slicelength
condition|;
name|cur
operator|+=
name|step
operator|,
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|rgb_getitem
argument_list|(
name|self
argument_list|,
name|cur
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|PyString_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|char
modifier|*
name|s
init|=
name|PyString_AsString
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"r"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"red"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|rgb_get_r
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"g"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"green"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|rgb_get_g
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"b"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"blue"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|rgb_get_b
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"alpha"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|rgb_get_a
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
else|else
block|{
name|PyErr_SetObject
argument_list|(
name|PyExc_KeyError
argument_list|,
name|item
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"indices must be integers"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_decl_stmt
DECL|variable|rgb_as_mapping
specifier|static
name|PyMappingMethods
name|rgb_as_mapping
init|=
block|{
name|rgb_length
block|,
operator|(
name|binaryfunc
operator|)
name|rgb_subscript
block|,
operator|(
name|objobjargproc
operator|)
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|long
DECL|function|rgb_hash (PyObject * self)
name|rgb_hash
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|long
name|ret
init|=
operator|-
literal|1
decl_stmt|;
name|PyObject
modifier|*
name|temp
init|=
name|rgb_getstate
argument_list|(
name|self
argument_list|)
decl_stmt|;
if|if
condition|(
name|temp
operator|!=
name|NULL
condition|)
block|{
name|ret
operator|=
name|PyObject_Hash
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_richcompare (PyObject * self,PyObject * other,int op)
name|rgb_richcompare
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|other
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|GimpRGB
modifier|*
name|c1
decl_stmt|,
modifier|*
name|c2
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|pygimp_rgb_check
argument_list|(
name|other
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare %s to %s"
argument_list|,
name|self
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|,
name|other
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|op
operator|!=
name|Py_EQ
operator|&&
name|op
operator|!=
name|Py_NE
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare color values using<,<=,>,>="
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|c1
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
name|c2
operator|=
name|pyg_boxed_get
argument_list|(
name|other
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c1
operator|->
name|r
operator|==
name|c2
operator|->
name|r
operator|&&
name|c1
operator|->
name|g
operator|==
name|c2
operator|->
name|g
operator|&&
name|c1
operator|->
name|b
operator|==
name|c2
operator|->
name|b
operator|&&
name|c1
operator|->
name|a
operator|==
name|c2
operator|->
name|a
operator|)
operator|==
operator|(
name|op
operator|==
name|Py_EQ
operator|)
condition|)
name|ret
operator|=
name|Py_True
expr_stmt|;
else|else
name|ret
operator|=
name|Py_False
expr_stmt|;
name|Py_INCREF
argument_list|(
name|ret
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_pretty_print (PyObject * self,gboolean inexact)
name|rgb_pretty_print
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|gboolean
name|inexact
parameter_list|)
block|{
name|GimpRGB
modifier|*
name|rgb
decl_stmt|;
name|PyObject
modifier|*
name|ret
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|r_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|g_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|b_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|a_f
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|r
init|=
name|NULL
decl_stmt|,
modifier|*
name|g
init|=
name|NULL
decl_stmt|,
modifier|*
name|b
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|reprfunc
name|repr
decl_stmt|;
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
if|if
condition|(
name|inexact
condition|)
block|{
name|repr
operator|=
name|PyObject_Str
expr_stmt|;
name|prefix
operator|=
literal|"RGB "
expr_stmt|;
block|}
else|else
block|{
name|repr
operator|=
name|PyObject_Repr
expr_stmt|;
name|prefix
operator|=
name|self
operator|->
name|ob_type
operator|->
name|tp_name
expr_stmt|;
block|}
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|r_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|rgb
operator|->
name|r
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|g_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|rgb
operator|->
name|g
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|b_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|rgb
operator|->
name|b
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|rgb
operator|->
name|a
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|r
operator|=
name|repr
argument_list|(
name|r_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|g
operator|=
name|repr
argument_list|(
name|g_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|b
operator|=
name|repr
argument_list|(
name|b_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a
operator|=
name|repr
argument_list|(
name|a_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
name|ret
operator|=
name|PyString_FromFormat
argument_list|(
literal|"%s(%s, %s, %s, %s)"
argument_list|,
name|prefix
argument_list|,
name|PyString_AsString
argument_list|(
name|r
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|g
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|b
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|cleanup
label|:
name|Py_XDECREF
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|r_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|g_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|b_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a_f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_repr (PyObject * self)
name|rgb_repr
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|rgb_pretty_print
argument_list|(
name|self
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|rgb_str (PyObject * self)
name|rgb_str
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|rgb_pretty_print
argument_list|(
name|self
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|rgb_init (PyGBoxed * self,PyObject * args,PyObject * kwargs)
name|rgb_init
parameter_list|(
name|PyGBoxed
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|r
decl_stmt|,
modifier|*
name|g
decl_stmt|,
modifier|*
name|b
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpRGB
name|rgb
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"r"
block|,
literal|"g"
block|,
literal|"b"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"OOO|O:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
DECL|macro|SET_MEMBER (m)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|)
value|G_STMT_START {				\     if (PyInt_Check(m))						\ 	rgb.m = (double) PyInt_AS_LONG(m) / 255.0;		\     else if (PyFloat_Check(m))					\         rgb.m = PyFloat_AS_DOUBLE(m);				\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be an int or a float");	\ 	return -1;						\     }								\ } G_STMT_END
name|SET_MEMBER
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|)
expr_stmt|;
else|else
name|rgb
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
name|self
operator|->
name|gtype
operator|=
name|GIMP_TYPE_RGB
expr_stmt|;
name|self
operator|->
name|free_on_dealloc
operator|=
name|TRUE
expr_stmt|;
name|self
operator|->
name|boxed
operator|=
name|g_boxed_copy
argument_list|(
name|GIMP_TYPE_RGB
argument_list|,
operator|&
name|rgb
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpRGB_Type
name|PyTypeObject
name|PyGimpRGB_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimpcolor.RGB"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGBoxed
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
literal|0
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
literal|0
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|rgb_repr
block|,
comment|/* tp_repr */
operator|(
name|PyNumberMethods
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_number */
operator|&
name|rgb_as_sequence
block|,
comment|/* tp_as_sequence */
operator|&
name|rgb_as_mapping
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
name|rgb_hash
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
name|rgb_str
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
operator|(
name|PyBufferProcs
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
name|rgb_richcompare
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|rgb_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|rgb_getsets
block|,
comment|/* tp_getset */
name|NULL
block|,
comment|/* tp_base */
name|NULL
block|,
comment|/* tp_dict */
operator|(
name|descrgetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_get */
operator|(
name|descrsetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|rgb_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
operator|(
name|freefunc
operator|)
literal|0
block|,
comment|/* tp_free */
operator|(
name|inquiry
operator|)
literal|0
comment|/* tp_is_gc */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_rgb_new (const GimpRGB * rgb)
name|pygimp_rgb_new
parameter_list|(
specifier|const
name|GimpRGB
modifier|*
name|rgb
parameter_list|)
block|{
return|return
name|pyg_boxed_new
argument_list|(
name|GIMP_TYPE_RGB
argument_list|,
operator|(
name|gpointer
operator|)
name|rgb
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_set (PyObject * self,PyObject * args,PyObject * kwargs)
name|hsv_set
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|h
init|=
name|NULL
decl_stmt|,
modifier|*
name|s
init|=
name|NULL
decl_stmt|,
modifier|*
name|v
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpHSV
name|tmphsv
decl_stmt|,
modifier|*
name|hsv
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"h"
block|,
literal|"s"
block|,
literal|"v"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|OOOO:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|h
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|v
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|h
operator|&&
operator|!
name|s
operator|&&
operator|!
name|v
operator|&&
operator|!
name|a
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide h,s,v or a arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|(
name|h
operator|&&
operator|(
operator|!
name|s
operator|||
operator|!
name|v
operator|)
operator|)
operator|||
operator|(
name|s
operator|&&
operator|(
operator|!
name|h
operator|||
operator|!
name|v
operator|)
operator|)
operator|||
operator|(
name|v
operator|&&
operator|(
operator|!
name|h
operator|||
operator|!
name|s
operator|)
operator|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide all 3 h,s,v arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|hsv
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
name|tmphsv
operator|=
operator|*
name|hsv
expr_stmt|;
DECL|macro|SET_MEMBER (m,s)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|,
name|s
parameter_list|)
value|G_STMT_START {			\     if (PyInt_Check(m))						\         tmphsv.m = (double) PyInt_AS_LONG(m) / s;		\     else if (PyFloat_Check(m))					\         tmphsv.m = PyFloat_AS_DOUBLE(m);			\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be a float");			\ 	return NULL;						\     }								\ } G_STMT_END
if|if
condition|(
name|h
condition|)
block|{
name|SET_MEMBER
argument_list|(
name|h
argument_list|,
literal|360.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|s
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|v
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|,
literal|255.0
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
operator|*
name|hsv
operator|=
name|tmphsv
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_set_alpha (PyObject * self,PyObject * args,PyObject * kwargs)
name|hsv_set_alpha
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|py_a
decl_stmt|;
name|GimpHSV
modifier|*
name|hsv
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O:set_alpha"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|py_a
argument_list|)
condition|)
return|return
name|NULL
return|;
name|hsv
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
if|if
condition|(
name|PyInt_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|hsv
operator|->
name|a
operator|=
operator|(
name|double
operator|)
name|PyInt_AS_LONG
argument_list|(
name|py_a
argument_list|)
operator|/
literal|255.0
expr_stmt|;
elseif|else
if|if
condition|(
name|PyFloat_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|hsv
operator|->
name|a
operator|=
name|PyFloat_AS_DOUBLE
argument_list|(
name|py_a
argument_list|)
expr_stmt|;
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"a must be a float"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_clamp (PyObject * self)
name|hsv_clamp
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|gimp_hsv_clamp
argument_list|(
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_to_rgb (PyObject * self)
name|hsv_to_rgb
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpHSV
modifier|*
name|hsv
decl_stmt|;
name|GimpRGB
name|rgb
decl_stmt|;
name|hsv
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
name|gimp_hsv_to_rgb
argument_list|(
name|hsv
argument_list|,
operator|&
name|rgb
argument_list|)
expr_stmt|;
return|return
name|pygimp_rgb_new
argument_list|(
operator|&
name|rgb
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* __getstate__ isn't exposed */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_getstate (PyObject * self)
name|hsv_getstate
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpHSV
modifier|*
name|hsv
decl_stmt|;
name|hsv
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"dddd"
argument_list|,
name|hsv
operator|->
name|h
argument_list|,
name|hsv
operator|->
name|s
argument_list|,
name|hsv
operator|->
name|v
argument_list|,
name|hsv
operator|->
name|a
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_reduce (PyObject * self)
name|hsv_reduce
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|Py_BuildValue
argument_list|(
literal|"ON"
argument_list|,
name|self
operator|->
name|ob_type
argument_list|,
name|hsv_getstate
argument_list|(
name|self
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|hsv_methods
specifier|static
name|PyMethodDef
name|hsv_methods
index|[]
init|=
block|{
block|{
literal|"set"
block|,
operator|(
name|PyCFunction
operator|)
name|hsv_set
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"set_alpha"
block|,
operator|(
name|PyCFunction
operator|)
name|hsv_set_alpha
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"clamp"
block|,
operator|(
name|PyCFunction
operator|)
name|hsv_clamp
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"to_rgb"
block|,
operator|(
name|PyCFunction
operator|)
name|hsv_to_rgb
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"__reduce__"
block|,
operator|(
name|PyCFunction
operator|)
name|hsv_reduce
block|,
name|METH_NOARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|MEMBER_ACCESSOR (m,s)
define|#
directive|define
name|MEMBER_ACCESSOR
parameter_list|(
name|m
parameter_list|,
name|s
parameter_list|)
define|\
value|static PyObject *							\ hsv_get_ ## m(PyObject *self, void *closure)				\ {									\     return PyFloat_FromDouble(pyg_boxed_get(self, GimpHSV)->m);		\ }									\ static int								\ hsv_set_ ## m(PyObject *self, PyObject *value, void *closure)		\ {									\     GimpHSV *hsv = pyg_boxed_get(self, GimpHSV);			\     if (value == NULL) {						\ 	PyErr_SetString(PyExc_TypeError, "cannot delete value");	\ 	return -1;							\     }									\     else if (PyInt_Check(value))					\         hsv->m = (double) PyInt_AS_LONG(value) / s;			\     else if (PyFloat_Check(value))					\         hsv->m = PyFloat_AS_DOUBLE(value);				\     else {								\ 	PyErr_SetString(PyExc_TypeError, "type mismatch");		\ 	return -1;							\     }									\     return 0;								\ }
end_define

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|h
argument_list|,
literal|360.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|s
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|v
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|a
argument_list|,
literal|255.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_undef
undef|#
directive|undef
name|MEMBER_ACCESSOR
end_undef

begin_decl_stmt
DECL|variable|hsv_getsets
specifier|static
name|PyGetSetDef
name|hsv_getsets
index|[]
init|=
block|{
block|{
literal|"h"
block|,
operator|(
name|getter
operator|)
name|hsv_get_h
block|,
operator|(
name|setter
operator|)
name|hsv_set_h
block|}
block|,
block|{
literal|"s"
block|,
operator|(
name|getter
operator|)
name|hsv_get_s
block|,
operator|(
name|setter
operator|)
name|hsv_set_s
block|}
block|,
block|{
literal|"v"
block|,
operator|(
name|getter
operator|)
name|hsv_get_v
block|,
operator|(
name|setter
operator|)
name|hsv_set_v
block|}
block|,
block|{
literal|"a"
block|,
operator|(
name|getter
operator|)
name|hsv_get_a
block|,
operator|(
name|setter
operator|)
name|hsv_set_a
block|}
block|,
block|{
literal|"hue"
block|,
operator|(
name|getter
operator|)
name|hsv_get_h
block|,
operator|(
name|setter
operator|)
name|hsv_set_h
block|}
block|,
block|{
literal|"saturation"
block|,
operator|(
name|getter
operator|)
name|hsv_get_s
block|,
operator|(
name|setter
operator|)
name|hsv_set_s
block|}
block|,
block|{
literal|"value"
block|,
operator|(
name|getter
operator|)
name|hsv_get_v
block|,
operator|(
name|setter
operator|)
name|hsv_set_v
block|}
block|,
block|{
literal|"alpha"
block|,
operator|(
name|getter
operator|)
name|hsv_get_a
block|,
operator|(
name|setter
operator|)
name|hsv_set_a
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Py_ssize_t
DECL|function|hsv_length (PyObject * self)
name|hsv_length
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
literal|4
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_getitem (PyObject * self,Py_ssize_t pos)
name|hsv_getitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|)
block|{
name|GimpHSV
modifier|*
name|hsv
decl_stmt|;
name|double
name|val
decl_stmt|,
name|scale_factor
decl_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|4
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|hsv
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
name|val
operator|=
name|hsv
operator|->
name|h
expr_stmt|;
name|scale_factor
operator|=
literal|360.0
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|val
operator|=
name|hsv
operator|->
name|s
expr_stmt|;
name|scale_factor
operator|=
literal|100.0
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|val
operator|=
name|hsv
operator|->
name|v
expr_stmt|;
name|scale_factor
operator|=
literal|100.0
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|val
operator|=
name|hsv
operator|->
name|a
expr_stmt|;
name|scale_factor
operator|=
literal|255.0
expr_stmt|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|PyInt_FromLong
argument_list|(
name|ROUND
argument_list|(
name|CLAMP
argument_list|(
name|val
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
operator|*
name|scale_factor
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|hsv_setitem (PyObject * self,Py_ssize_t pos,PyObject * value)
name|hsv_setitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|)
block|{
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|4
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
return|return
name|hsv_set_h
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|1
case|:
return|return
name|hsv_set_s
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|2
case|:
return|return
name|hsv_set_v
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|3
case|:
return|return
name|hsv_set_a
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_slice (PyObject * self,Py_ssize_t start,Py_ssize_t end)
name|hsv_slice
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|start
parameter_list|,
name|Py_ssize_t
name|end
parameter_list|)
block|{
name|PyTupleObject
modifier|*
name|ret
decl_stmt|;
name|Py_ssize_t
name|i
decl_stmt|;
if|if
condition|(
name|start
operator|<
literal|0
condition|)
name|start
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|end
operator|>
literal|4
condition|)
name|end
operator|=
literal|4
expr_stmt|;
if|if
condition|(
name|end
operator|<
name|start
condition|)
name|end
operator|=
name|start
expr_stmt|;
name|ret
operator|=
operator|(
name|PyTupleObject
operator|*
operator|)
name|PyTuple_New
argument_list|(
name|end
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|i
operator|=
name|start
init|;
name|i
operator|<
name|end
condition|;
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
operator|-
name|start
argument_list|,
name|hsv_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|ret
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|hsv_as_sequence
specifier|static
name|PySequenceMethods
name|hsv_as_sequence
init|=
block|{
name|hsv_length
block|,
operator|(
name|binaryfunc
operator|)
literal|0
block|,
literal|0
block|,
name|hsv_getitem
block|,
name|hsv_slice
block|,
name|hsv_setitem
block|,
literal|0
block|,
operator|(
name|objobjproc
operator|)
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_subscript (PyObject * self,PyObject * item)
name|hsv_subscript
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|item
parameter_list|)
block|{
if|if
condition|(
name|PyInt_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyInt_AS_LONG
argument_list|(
name|item
argument_list|)
decl_stmt|;
return|return
name|hsv_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PyLong_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyLong_AsLong
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|i
operator|==
operator|-
literal|1
operator|&&
name|PyErr_Occurred
argument_list|()
condition|)
return|return
name|NULL
return|;
return|return
name|hsv_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PySlice_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|Py_ssize_t
name|start
decl_stmt|,
name|stop
decl_stmt|,
name|step
decl_stmt|,
name|slicelength
decl_stmt|,
name|cur
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|PySlice_GetIndicesEx
argument_list|(
operator|(
name|PySliceObject
operator|*
operator|)
name|item
argument_list|,
literal|4
argument_list|,
operator|&
name|start
argument_list|,
operator|&
name|stop
argument_list|,
operator|&
name|step
argument_list|,
operator|&
name|slicelength
argument_list|)
operator|<
literal|0
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|slicelength
operator|<=
literal|0
condition|)
block|{
return|return
name|PyTuple_New
argument_list|(
literal|0
argument_list|)
return|;
block|}
else|else
block|{
name|ret
operator|=
name|PyTuple_New
argument_list|(
name|slicelength
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|cur
operator|=
name|start
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|slicelength
condition|;
name|cur
operator|+=
name|step
operator|,
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|hsv_getitem
argument_list|(
name|self
argument_list|,
name|cur
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|PyString_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|char
modifier|*
name|s
init|=
name|PyString_AsString
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"h"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"hue"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsv_get_h
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"s"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"saturation"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsv_get_s
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"v"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"value"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsv_get_v
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"alpha"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsv_get_a
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
else|else
block|{
name|PyErr_SetObject
argument_list|(
name|PyExc_KeyError
argument_list|,
name|item
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"indices must be integers"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_decl_stmt
DECL|variable|hsv_as_mapping
specifier|static
name|PyMappingMethods
name|hsv_as_mapping
init|=
block|{
name|hsv_length
block|,
operator|(
name|binaryfunc
operator|)
name|hsv_subscript
block|,
operator|(
name|objobjargproc
operator|)
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|long
DECL|function|hsv_hash (PyObject * self)
name|hsv_hash
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|long
name|ret
init|=
operator|-
literal|1
decl_stmt|;
name|PyObject
modifier|*
name|temp
init|=
name|hsv_getstate
argument_list|(
name|self
argument_list|)
decl_stmt|;
if|if
condition|(
name|temp
operator|!=
name|NULL
condition|)
block|{
name|ret
operator|=
name|PyObject_Hash
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_richcompare (PyObject * self,PyObject * other,int op)
name|hsv_richcompare
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|other
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|GimpHSV
modifier|*
name|c1
decl_stmt|,
modifier|*
name|c2
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|pygimp_hsv_check
argument_list|(
name|other
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare %s to %s"
argument_list|,
name|self
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|,
name|other
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|op
operator|!=
name|Py_EQ
operator|&&
name|op
operator|!=
name|Py_NE
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare color values using<,<=,>,>="
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|c1
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
name|c2
operator|=
name|pyg_boxed_get
argument_list|(
name|other
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c1
operator|->
name|h
operator|==
name|c2
operator|->
name|h
operator|&&
name|c1
operator|->
name|s
operator|==
name|c2
operator|->
name|s
operator|&&
name|c1
operator|->
name|v
operator|==
name|c2
operator|->
name|v
operator|&&
name|c1
operator|->
name|a
operator|==
name|c2
operator|->
name|a
operator|)
operator|==
operator|(
name|op
operator|==
name|Py_EQ
operator|)
condition|)
name|ret
operator|=
name|Py_True
expr_stmt|;
else|else
name|ret
operator|=
name|Py_False
expr_stmt|;
name|Py_INCREF
argument_list|(
name|ret
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_pretty_print (PyObject * self,gboolean inexact)
name|hsv_pretty_print
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|gboolean
name|inexact
parameter_list|)
block|{
name|GimpHSV
modifier|*
name|hsv
decl_stmt|;
name|PyObject
modifier|*
name|ret
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|h_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|s_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|v_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|a_f
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|h
init|=
name|NULL
decl_stmt|,
modifier|*
name|s
init|=
name|NULL
decl_stmt|,
modifier|*
name|v
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|reprfunc
name|repr
decl_stmt|;
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
if|if
condition|(
name|inexact
condition|)
block|{
name|repr
operator|=
name|PyObject_Str
expr_stmt|;
name|prefix
operator|=
literal|"HSV "
expr_stmt|;
block|}
else|else
block|{
name|repr
operator|=
name|PyObject_Repr
expr_stmt|;
name|prefix
operator|=
name|self
operator|->
name|ob_type
operator|->
name|tp_name
expr_stmt|;
block|}
name|hsv
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSV
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|h_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsv
operator|->
name|h
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|s_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsv
operator|->
name|s
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|v_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsv
operator|->
name|v
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsv
operator|->
name|a
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|h
operator|=
name|repr
argument_list|(
name|h_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|s
operator|=
name|repr
argument_list|(
name|s_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|v
operator|=
name|repr
argument_list|(
name|v_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a
operator|=
name|repr
argument_list|(
name|a_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
name|ret
operator|=
name|PyString_FromFormat
argument_list|(
literal|"%s(%s, %s, %s, %s)"
argument_list|,
name|prefix
argument_list|,
name|PyString_AsString
argument_list|(
name|h
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|s
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|v
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|cleanup
label|:
name|Py_XDECREF
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|v
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|h_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|s_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|v_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a_f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_repr (PyObject * self)
name|hsv_repr
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|hsv_pretty_print
argument_list|(
name|self
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsv_str (PyObject * self)
name|hsv_str
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|hsv_pretty_print
argument_list|(
name|self
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|hsv_init (PyGBoxed * self,PyObject * args,PyObject * kwargs)
name|hsv_init
parameter_list|(
name|PyGBoxed
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|h
decl_stmt|,
modifier|*
name|s
decl_stmt|,
modifier|*
name|v
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpHSV
name|hsv
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"h"
block|,
literal|"s"
block|,
literal|"v"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"OOO|O:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|h
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|v
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
DECL|macro|SET_MEMBER (m,s)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|,
name|s
parameter_list|)
value|G_STMT_START {			\     if (PyInt_Check(m))						\         hsv.m = (double) PyInt_AS_LONG(m) / s;			\     else if (PyFloat_Check(m))					\         hsv.m = PyFloat_AS_DOUBLE(m);				\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be an int or a float");	\ 	return -1;						\     }								\ } G_STMT_END
name|SET_MEMBER
argument_list|(
name|h
argument_list|,
literal|360.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|s
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|v
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|,
literal|255.0
argument_list|)
expr_stmt|;
else|else
name|hsv
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
name|self
operator|->
name|gtype
operator|=
name|GIMP_TYPE_HSV
expr_stmt|;
name|self
operator|->
name|free_on_dealloc
operator|=
name|TRUE
expr_stmt|;
name|self
operator|->
name|boxed
operator|=
name|g_boxed_copy
argument_list|(
name|GIMP_TYPE_HSV
argument_list|,
operator|&
name|hsv
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpHSV_Type
name|PyTypeObject
name|PyGimpHSV_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimpcolor.HSV"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGBoxed
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
literal|0
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
literal|0
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|hsv_repr
block|,
comment|/* tp_repr */
operator|(
name|PyNumberMethods
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_number */
operator|&
name|hsv_as_sequence
block|,
comment|/* tp_as_sequence */
operator|&
name|hsv_as_mapping
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
name|hsv_hash
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
name|hsv_str
block|,
comment|/* tp_repr */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
operator|(
name|PyBufferProcs
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
name|hsv_richcompare
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|hsv_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|hsv_getsets
block|,
comment|/* tp_getset */
name|NULL
block|,
comment|/* tp_base */
name|NULL
block|,
comment|/* tp_dict */
operator|(
name|descrgetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_get */
operator|(
name|descrsetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|hsv_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
operator|(
name|freefunc
operator|)
literal|0
block|,
comment|/* tp_free */
operator|(
name|inquiry
operator|)
literal|0
comment|/* tp_is_gc */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_hsv_new (const GimpHSV * hsv)
name|pygimp_hsv_new
parameter_list|(
specifier|const
name|GimpHSV
modifier|*
name|hsv
parameter_list|)
block|{
return|return
name|pyg_boxed_new
argument_list|(
name|GIMP_TYPE_HSV
argument_list|,
operator|(
name|gpointer
operator|)
name|hsv
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_set (PyObject * self,PyObject * args,PyObject * kwargs)
name|hsl_set
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|h
init|=
name|NULL
decl_stmt|,
modifier|*
name|s
init|=
name|NULL
decl_stmt|,
modifier|*
name|l
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpHSL
name|tmphsl
decl_stmt|,
modifier|*
name|hsl
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"h"
block|,
literal|"s"
block|,
literal|"l"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|OOOO:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|h
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|l
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|h
operator|&&
operator|!
name|s
operator|&&
operator|!
name|l
operator|&&
operator|!
name|a
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide h,s,l or a arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|(
name|h
operator|&&
operator|(
operator|!
name|s
operator|||
operator|!
name|l
operator|)
operator|)
operator|||
operator|(
name|s
operator|&&
operator|(
operator|!
name|h
operator|||
operator|!
name|l
operator|)
operator|)
operator|||
operator|(
name|l
operator|&&
operator|(
operator|!
name|h
operator|||
operator|!
name|s
operator|)
operator|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide all 3 h,s,l arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|hsl
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
name|tmphsl
operator|=
operator|*
name|hsl
expr_stmt|;
DECL|macro|SET_MEMBER (m,s)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|,
name|s
parameter_list|)
value|G_STMT_START {			\     if (PyInt_Check(m))						\         tmphsl.m = (double) PyInt_AS_LONG(m) / s;		\     else if (PyFloat_Check(m))					\         tmphsl.m = PyFloat_AS_DOUBLE(m);			\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be a float");			\ 	return NULL;						\     }								\ } G_STMT_END
if|if
condition|(
name|h
condition|)
block|{
name|SET_MEMBER
argument_list|(
name|h
argument_list|,
literal|360.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|s
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|l
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|,
literal|255.0
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
operator|*
name|hsl
operator|=
name|tmphsl
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_set_alpha (PyObject * self,PyObject * args,PyObject * kwargs)
name|hsl_set_alpha
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|py_a
decl_stmt|;
name|GimpHSL
modifier|*
name|hsl
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O:set_alpha"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|py_a
argument_list|)
condition|)
return|return
name|NULL
return|;
name|hsl
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
if|if
condition|(
name|PyInt_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|hsl
operator|->
name|a
operator|=
operator|(
name|double
operator|)
name|PyInt_AS_LONG
argument_list|(
name|py_a
argument_list|)
operator|/
literal|255.0
expr_stmt|;
elseif|else
if|if
condition|(
name|PyFloat_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|hsl
operator|->
name|a
operator|=
name|PyFloat_AS_DOUBLE
argument_list|(
name|py_a
argument_list|)
expr_stmt|;
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"a must be a float"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_to_rgb (PyObject * self)
name|hsl_to_rgb
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpHSL
modifier|*
name|hsl
decl_stmt|;
name|GimpRGB
name|rgb
decl_stmt|;
name|hsl
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
name|gimp_hsl_to_rgb
argument_list|(
name|hsl
argument_list|,
operator|&
name|rgb
argument_list|)
expr_stmt|;
return|return
name|pygimp_rgb_new
argument_list|(
operator|&
name|rgb
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* __getstate__ isn't exposed */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_getstate (PyObject * self)
name|hsl_getstate
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpHSL
modifier|*
name|hsl
decl_stmt|;
name|hsl
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"dddd"
argument_list|,
name|hsl
operator|->
name|h
argument_list|,
name|hsl
operator|->
name|s
argument_list|,
name|hsl
operator|->
name|l
argument_list|,
name|hsl
operator|->
name|a
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_reduce (PyObject * self)
name|hsl_reduce
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|Py_BuildValue
argument_list|(
literal|"ON"
argument_list|,
name|self
operator|->
name|ob_type
argument_list|,
name|hsl_getstate
argument_list|(
name|self
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|hsl_methods
specifier|static
name|PyMethodDef
name|hsl_methods
index|[]
init|=
block|{
block|{
literal|"set"
block|,
operator|(
name|PyCFunction
operator|)
name|hsl_set
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"set_alpha"
block|,
operator|(
name|PyCFunction
operator|)
name|hsl_set_alpha
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"to_rgb"
block|,
operator|(
name|PyCFunction
operator|)
name|hsl_to_rgb
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"__reduce__"
block|,
operator|(
name|PyCFunction
operator|)
name|hsl_reduce
block|,
name|METH_NOARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|MEMBER_ACCESSOR (m,s)
define|#
directive|define
name|MEMBER_ACCESSOR
parameter_list|(
name|m
parameter_list|,
name|s
parameter_list|)
define|\
value|static PyObject *							\ hsl_get_ ## m(PyObject *self, void *closure)				\ {									\     return PyFloat_FromDouble(pyg_boxed_get(self, GimpHSL)->m);		\ }									\ static int								\ hsl_set_ ## m(PyObject *self, PyObject *value, void *closure)		\ {									\     GimpHSL *hsl = pyg_boxed_get(self, GimpHSL);			\     if (value == NULL) {						\ 	PyErr_SetString(PyExc_TypeError, "cannot delete value");	\ 	return -1;							\     }									\     else if (PyInt_Check(value))					\         hsl->m = (double) PyInt_AS_LONG(value) / s;			\     else if (PyFloat_Check(value))					\         hsl->m = PyFloat_AS_DOUBLE(value);				\     else {								\ 	PyErr_SetString(PyExc_TypeError, "type mismatch");		\ 	return -1;							\     }									\     return 0;								\ }
end_define

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|h
argument_list|,
literal|360.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|s
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|l
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|a
argument_list|,
literal|255.0
argument_list|)
expr_stmt|;
end_expr_stmt

begin_undef
undef|#
directive|undef
name|MEMBER_ACCESSOR
end_undef

begin_decl_stmt
DECL|variable|hsl_getsets
specifier|static
name|PyGetSetDef
name|hsl_getsets
index|[]
init|=
block|{
block|{
literal|"h"
block|,
operator|(
name|getter
operator|)
name|hsl_get_h
block|,
operator|(
name|setter
operator|)
name|hsl_set_h
block|}
block|,
block|{
literal|"s"
block|,
operator|(
name|getter
operator|)
name|hsl_get_s
block|,
operator|(
name|setter
operator|)
name|hsl_set_s
block|}
block|,
block|{
literal|"l"
block|,
operator|(
name|getter
operator|)
name|hsl_get_l
block|,
operator|(
name|setter
operator|)
name|hsl_set_l
block|}
block|,
block|{
literal|"a"
block|,
operator|(
name|getter
operator|)
name|hsl_get_a
block|,
operator|(
name|setter
operator|)
name|hsl_set_a
block|}
block|,
block|{
literal|"hue"
block|,
operator|(
name|getter
operator|)
name|hsl_get_h
block|,
operator|(
name|setter
operator|)
name|hsl_set_h
block|}
block|,
block|{
literal|"saturation"
block|,
operator|(
name|getter
operator|)
name|hsl_get_s
block|,
operator|(
name|setter
operator|)
name|hsl_set_s
block|}
block|,
block|{
literal|"lightness"
block|,
operator|(
name|getter
operator|)
name|hsl_get_l
block|,
operator|(
name|setter
operator|)
name|hsl_set_l
block|}
block|,
block|{
literal|"alpha"
block|,
operator|(
name|getter
operator|)
name|hsl_get_a
block|,
operator|(
name|setter
operator|)
name|hsl_set_a
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Py_ssize_t
DECL|function|hsl_length (PyObject * self)
name|hsl_length
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
literal|4
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_getitem (PyObject * self,Py_ssize_t pos)
name|hsl_getitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|)
block|{
name|GimpHSL
modifier|*
name|hsl
decl_stmt|;
name|double
name|val
decl_stmt|,
name|scale_factor
decl_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|4
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|hsl
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
name|val
operator|=
name|hsl
operator|->
name|h
expr_stmt|;
name|scale_factor
operator|=
literal|360.0
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|val
operator|=
name|hsl
operator|->
name|s
expr_stmt|;
name|scale_factor
operator|=
literal|100.0
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|val
operator|=
name|hsl
operator|->
name|l
expr_stmt|;
name|scale_factor
operator|=
literal|100.0
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|val
operator|=
name|hsl
operator|->
name|a
expr_stmt|;
name|scale_factor
operator|=
literal|255.0
expr_stmt|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|PyInt_FromLong
argument_list|(
name|ROUND
argument_list|(
name|CLAMP
argument_list|(
name|val
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
operator|*
name|scale_factor
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|hsl_setitem (PyObject * self,Py_ssize_t pos,PyObject * value)
name|hsl_setitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|)
block|{
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|4
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|4
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
return|return
name|hsl_set_h
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|1
case|:
return|return
name|hsl_set_s
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|2
case|:
return|return
name|hsl_set_l
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|3
case|:
return|return
name|hsl_set_a
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_slice (PyObject * self,Py_ssize_t start,Py_ssize_t end)
name|hsl_slice
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|start
parameter_list|,
name|Py_ssize_t
name|end
parameter_list|)
block|{
name|PyTupleObject
modifier|*
name|ret
decl_stmt|;
name|Py_ssize_t
name|i
decl_stmt|;
if|if
condition|(
name|start
operator|<
literal|0
condition|)
name|start
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|end
operator|>
literal|4
condition|)
name|end
operator|=
literal|4
expr_stmt|;
if|if
condition|(
name|end
operator|<
name|start
condition|)
name|end
operator|=
name|start
expr_stmt|;
name|ret
operator|=
operator|(
name|PyTupleObject
operator|*
operator|)
name|PyTuple_New
argument_list|(
name|end
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|i
operator|=
name|start
init|;
name|i
operator|<
name|end
condition|;
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
operator|-
name|start
argument_list|,
name|hsl_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|ret
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|hsl_as_sequence
specifier|static
name|PySequenceMethods
name|hsl_as_sequence
init|=
block|{
name|hsl_length
block|,
operator|(
name|binaryfunc
operator|)
literal|0
block|,
literal|0
block|,
name|hsl_getitem
block|,
name|hsl_slice
block|,
name|hsl_setitem
block|,
literal|0
block|,
operator|(
name|objobjproc
operator|)
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_subscript (PyObject * self,PyObject * item)
name|hsl_subscript
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|item
parameter_list|)
block|{
if|if
condition|(
name|PyInt_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyInt_AS_LONG
argument_list|(
name|item
argument_list|)
decl_stmt|;
return|return
name|hsl_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PyLong_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyLong_AsLong
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|i
operator|==
operator|-
literal|1
operator|&&
name|PyErr_Occurred
argument_list|()
condition|)
return|return
name|NULL
return|;
return|return
name|hsl_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PySlice_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|Py_ssize_t
name|start
decl_stmt|,
name|stop
decl_stmt|,
name|step
decl_stmt|,
name|slicelength
decl_stmt|,
name|cur
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|PySlice_GetIndicesEx
argument_list|(
operator|(
name|PySliceObject
operator|*
operator|)
name|item
argument_list|,
literal|4
argument_list|,
operator|&
name|start
argument_list|,
operator|&
name|stop
argument_list|,
operator|&
name|step
argument_list|,
operator|&
name|slicelength
argument_list|)
operator|<
literal|0
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|slicelength
operator|<=
literal|0
condition|)
block|{
return|return
name|PyTuple_New
argument_list|(
literal|0
argument_list|)
return|;
block|}
else|else
block|{
name|ret
operator|=
name|PyTuple_New
argument_list|(
name|slicelength
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|cur
operator|=
name|start
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|slicelength
condition|;
name|cur
operator|+=
name|step
operator|,
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|hsl_getitem
argument_list|(
name|self
argument_list|,
name|cur
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|PyString_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|char
modifier|*
name|s
init|=
name|PyString_AsString
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"h"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"hue"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsl_get_h
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"s"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"saturation"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsl_get_s
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"l"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"lightness"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsl_get_l
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"alpha"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|hsl_get_a
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
else|else
block|{
name|PyErr_SetObject
argument_list|(
name|PyExc_KeyError
argument_list|,
name|item
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"indices must be integers"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_decl_stmt
DECL|variable|hsl_as_mapping
specifier|static
name|PyMappingMethods
name|hsl_as_mapping
init|=
block|{
name|hsl_length
block|,
operator|(
name|binaryfunc
operator|)
name|hsl_subscript
block|,
operator|(
name|objobjargproc
operator|)
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|long
DECL|function|hsl_hash (PyObject * self)
name|hsl_hash
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|long
name|ret
init|=
operator|-
literal|1
decl_stmt|;
name|PyObject
modifier|*
name|temp
init|=
name|hsl_getstate
argument_list|(
name|self
argument_list|)
decl_stmt|;
if|if
condition|(
name|temp
operator|!=
name|NULL
condition|)
block|{
name|ret
operator|=
name|PyObject_Hash
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_richcompare (PyObject * self,PyObject * other,int op)
name|hsl_richcompare
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|other
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|GimpHSL
modifier|*
name|c1
decl_stmt|,
modifier|*
name|c2
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|pygimp_hsl_check
argument_list|(
name|other
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare %s to %s"
argument_list|,
name|self
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|,
name|other
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|op
operator|!=
name|Py_EQ
operator|&&
name|op
operator|!=
name|Py_NE
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare color values using<,<=,>,>="
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|c1
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
name|c2
operator|=
name|pyg_boxed_get
argument_list|(
name|other
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c1
operator|->
name|h
operator|==
name|c2
operator|->
name|h
operator|&&
name|c1
operator|->
name|s
operator|==
name|c2
operator|->
name|s
operator|&&
name|c1
operator|->
name|l
operator|==
name|c2
operator|->
name|l
operator|&&
name|c1
operator|->
name|a
operator|==
name|c2
operator|->
name|a
operator|)
operator|==
operator|(
name|op
operator|==
name|Py_EQ
operator|)
condition|)
name|ret
operator|=
name|Py_True
expr_stmt|;
else|else
name|ret
operator|=
name|Py_False
expr_stmt|;
name|Py_INCREF
argument_list|(
name|ret
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_pretty_print (PyObject * self,gboolean inexact)
name|hsl_pretty_print
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|gboolean
name|inexact
parameter_list|)
block|{
name|GimpHSL
modifier|*
name|hsl
decl_stmt|;
name|PyObject
modifier|*
name|ret
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|h_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|s_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|l_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|a_f
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|h
init|=
name|NULL
decl_stmt|,
modifier|*
name|s
init|=
name|NULL
decl_stmt|,
modifier|*
name|l
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|reprfunc
name|repr
decl_stmt|;
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
if|if
condition|(
name|inexact
condition|)
block|{
name|repr
operator|=
name|PyObject_Str
expr_stmt|;
name|prefix
operator|=
literal|"HSL "
expr_stmt|;
block|}
else|else
block|{
name|repr
operator|=
name|PyObject_Repr
expr_stmt|;
name|prefix
operator|=
name|self
operator|->
name|ob_type
operator|->
name|tp_name
expr_stmt|;
block|}
name|hsl
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpHSL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|h_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsl
operator|->
name|h
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|s_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsl
operator|->
name|s
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|l_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsl
operator|->
name|l
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|hsl
operator|->
name|a
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|h
operator|=
name|repr
argument_list|(
name|h_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|s
operator|=
name|repr
argument_list|(
name|s_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|l
operator|=
name|repr
argument_list|(
name|l_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a
operator|=
name|repr
argument_list|(
name|a_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
name|ret
operator|=
name|PyString_FromFormat
argument_list|(
literal|"%s(%s, %s, %s, %s)"
argument_list|,
name|prefix
argument_list|,
name|PyString_AsString
argument_list|(
name|h
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|s
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|l
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|cleanup
label|:
name|Py_XDECREF
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|l
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|h_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|s_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|l_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a_f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_repr (PyObject * self)
name|hsl_repr
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|hsl_pretty_print
argument_list|(
name|self
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|hsl_str (PyObject * self)
name|hsl_str
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|hsl_pretty_print
argument_list|(
name|self
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|hsl_init (PyGBoxed * self,PyObject * args,PyObject * kwargs)
name|hsl_init
parameter_list|(
name|PyGBoxed
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|h
decl_stmt|,
modifier|*
name|s
decl_stmt|,
modifier|*
name|l
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpHSL
name|hsl
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"h"
block|,
literal|"s"
block|,
literal|"l"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"OOO|O:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|h
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|l
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
DECL|macro|SET_MEMBER (m,s)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|,
name|s
parameter_list|)
value|G_STMT_START {			\     if (PyInt_Check(m))						\         hsl.m = (double) PyInt_AS_LONG(m) / s;			\     else if (PyFloat_Check(m))					\         hsl.m = PyFloat_AS_DOUBLE(m);				\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be a float");			\ 	return -1;						\     }								\ } G_STMT_END
name|SET_MEMBER
argument_list|(
name|h
argument_list|,
literal|360.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|s
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|l
argument_list|,
literal|100.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|,
literal|255.0
argument_list|)
expr_stmt|;
else|else
name|hsl
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
name|self
operator|->
name|gtype
operator|=
name|GIMP_TYPE_HSL
expr_stmt|;
name|self
operator|->
name|free_on_dealloc
operator|=
name|TRUE
expr_stmt|;
name|self
operator|->
name|boxed
operator|=
name|g_boxed_copy
argument_list|(
name|GIMP_TYPE_HSL
argument_list|,
operator|&
name|hsl
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpHSL_Type
name|PyTypeObject
name|PyGimpHSL_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimpcolor.HSL"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGBoxed
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
literal|0
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
literal|0
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|hsl_repr
block|,
comment|/* tp_repr */
operator|(
name|PyNumberMethods
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_number */
operator|&
name|hsl_as_sequence
block|,
comment|/* tp_as_sequence */
operator|&
name|hsl_as_mapping
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
name|hsl_hash
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
name|hsl_str
block|,
comment|/* tp_repr */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
operator|(
name|PyBufferProcs
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
name|hsl_richcompare
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|hsl_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|hsl_getsets
block|,
comment|/* tp_getset */
name|NULL
block|,
comment|/* tp_base */
name|NULL
block|,
comment|/* tp_dict */
operator|(
name|descrgetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_get */
operator|(
name|descrsetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|hsl_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
operator|(
name|freefunc
operator|)
literal|0
block|,
comment|/* tp_free */
operator|(
name|inquiry
operator|)
literal|0
comment|/* tp_is_gc */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_hsl_new (const GimpHSL * hsl)
name|pygimp_hsl_new
parameter_list|(
specifier|const
name|GimpHSL
modifier|*
name|hsl
parameter_list|)
block|{
return|return
name|pyg_boxed_new
argument_list|(
name|GIMP_TYPE_HSL
argument_list|,
operator|(
name|gpointer
operator|)
name|hsl
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_set (PyObject * self,PyObject * args,PyObject * kwargs)
name|cmyk_set
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|c
init|=
name|NULL
decl_stmt|,
modifier|*
name|m
init|=
name|NULL
decl_stmt|,
modifier|*
name|y
init|=
name|NULL
decl_stmt|,
modifier|*
name|k
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpCMYK
name|tmpcmyk
decl_stmt|,
modifier|*
name|cmyk
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"c"
block|,
literal|"m"
block|,
literal|"y"
block|,
literal|"k"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|OOOOO:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|m
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|k
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|c
operator|&&
operator|!
name|y
operator|&&
operator|!
name|m
operator|&&
operator|!
name|k
operator|&&
operator|!
name|a
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide c,m,y,k or a arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|(
name|c
operator|&&
operator|(
operator|!
name|m
operator|||
operator|!
name|y
operator|||
operator|!
name|k
operator|)
operator|)
operator|||
operator|(
name|m
operator|&&
operator|(
operator|!
name|c
operator|||
operator|!
name|y
operator|||
operator|!
name|k
operator|)
operator|)
operator|||
operator|(
name|y
operator|&&
operator|(
operator|!
name|c
operator|||
operator|!
name|m
operator|||
operator|!
name|k
operator|)
operator|)
operator|||
operator|(
name|k
operator|&&
operator|(
operator|!
name|c
operator|||
operator|!
name|m
operator|||
operator|!
name|y
operator|)
operator|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"must provide all 4 c,m,y,k arguments"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|cmyk
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpCMYK
argument_list|)
expr_stmt|;
name|tmpcmyk
operator|=
operator|*
name|cmyk
expr_stmt|;
DECL|macro|SET_MEMBER (m)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|)
value|G_STMT_START {				\     if (PyInt_Check(m))						\ 	tmpcmyk.m = (double) PyInt_AS_LONG(m) / 255.0;		\     else if (PyFloat_Check(m))					\         tmpcmyk.m = PyFloat_AS_DOUBLE(m);			\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be an int or a float");	\ 	return NULL;						\     }								\ } G_STMT_END
if|if
condition|(
name|c
condition|)
block|{
name|SET_MEMBER
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|k
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
operator|*
name|cmyk
operator|=
name|tmpcmyk
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_set_alpha (PyObject * self,PyObject * args,PyObject * kwargs)
name|cmyk_set_alpha
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|py_a
decl_stmt|;
name|GimpCMYK
modifier|*
name|cmyk
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O:set_alpha"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|py_a
argument_list|)
condition|)
return|return
name|NULL
return|;
name|cmyk
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpCMYK
argument_list|)
expr_stmt|;
if|if
condition|(
name|PyInt_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|cmyk
operator|->
name|a
operator|=
operator|(
name|double
operator|)
name|PyInt_AS_LONG
argument_list|(
name|py_a
argument_list|)
operator|/
literal|255.0
expr_stmt|;
elseif|else
if|if
condition|(
name|PyFloat_Check
argument_list|(
name|py_a
argument_list|)
condition|)
name|cmyk
operator|->
name|a
operator|=
name|PyFloat_AS_DOUBLE
argument_list|(
name|py_a
argument_list|)
expr_stmt|;
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"a must be an int or a float"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_comment
comment|/* __getstate__ isn't exposed */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_getstate (PyObject * self)
name|cmyk_getstate
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpCMYK
modifier|*
name|cmyk
decl_stmt|;
name|cmyk
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpCMYK
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"ddddd"
argument_list|,
name|cmyk
operator|->
name|c
argument_list|,
name|cmyk
operator|->
name|m
argument_list|,
name|cmyk
operator|->
name|y
argument_list|,
name|cmyk
operator|->
name|k
argument_list|,
name|cmyk
operator|->
name|a
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_reduce (PyObject * self)
name|cmyk_reduce
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|Py_BuildValue
argument_list|(
literal|"ON"
argument_list|,
name|self
operator|->
name|ob_type
argument_list|,
name|cmyk_getstate
argument_list|(
name|self
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|cmyk_methods
specifier|static
name|PyMethodDef
name|cmyk_methods
index|[]
init|=
block|{
block|{
literal|"set"
block|,
operator|(
name|PyCFunction
operator|)
name|cmyk_set
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"set_alpha"
block|,
operator|(
name|PyCFunction
operator|)
name|cmyk_set_alpha
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"__reduce__"
block|,
operator|(
name|PyCFunction
operator|)
name|cmyk_reduce
block|,
name|METH_NOARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|MEMBER_ACCESSOR (m)
define|#
directive|define
name|MEMBER_ACCESSOR
parameter_list|(
name|m
parameter_list|)
define|\
value|static PyObject *							\ cmyk_get_ ## m(PyObject *self, void *closure)				\ {									\     return PyFloat_FromDouble(pyg_boxed_get(self, GimpCMYK)->m);	\ }									\ static int								\ cmyk_set_ ## m(PyObject *self, PyObject *value, void *closure)		\ {									\     GimpCMYK *cmyk = pyg_boxed_get(self, GimpCMYK);			\     if (value == NULL) {						\ 	PyErr_SetString(PyExc_TypeError, "cannot delete value");	\ 	return -1;							\     }									\     else if (PyInt_Check(value))					\ 	cmyk->m = (double) PyInt_AS_LONG(value) / 255.0;		\     else if (PyFloat_Check(value))					\         cmyk->m = PyFloat_AS_DOUBLE(value);				\     else {								\ 	PyErr_SetString(PyExc_TypeError, "type mismatch");		\ 	return -1;							\     }									\     return 0;								\ }
end_define

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|c
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|m
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|y
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|k
argument_list|)
expr_stmt|;
end_expr_stmt

begin_expr_stmt
name|MEMBER_ACCESSOR
argument_list|(
name|a
argument_list|)
expr_stmt|;
end_expr_stmt

begin_undef
undef|#
directive|undef
name|MEMBER_ACCESSOR
end_undef

begin_decl_stmt
DECL|variable|cmyk_getsets
specifier|static
name|PyGetSetDef
name|cmyk_getsets
index|[]
init|=
block|{
block|{
literal|"c"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_c
block|,
operator|(
name|setter
operator|)
name|cmyk_set_c
block|}
block|,
block|{
literal|"m"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_m
block|,
operator|(
name|setter
operator|)
name|cmyk_set_m
block|}
block|,
block|{
literal|"y"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_y
block|,
operator|(
name|setter
operator|)
name|cmyk_set_y
block|}
block|,
block|{
literal|"k"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_k
block|,
operator|(
name|setter
operator|)
name|cmyk_set_k
block|}
block|,
block|{
literal|"a"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_a
block|,
operator|(
name|setter
operator|)
name|cmyk_set_a
block|}
block|,
block|{
literal|"cyan"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_c
block|,
operator|(
name|setter
operator|)
name|cmyk_set_c
block|}
block|,
block|{
literal|"magenta"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_m
block|,
operator|(
name|setter
operator|)
name|cmyk_set_m
block|}
block|,
block|{
literal|"yellow"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_y
block|,
operator|(
name|setter
operator|)
name|cmyk_set_y
block|}
block|,
block|{
literal|"black"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_k
block|,
operator|(
name|setter
operator|)
name|cmyk_set_k
block|}
block|,
block|{
literal|"alpha"
block|,
operator|(
name|getter
operator|)
name|cmyk_get_a
block|,
operator|(
name|setter
operator|)
name|cmyk_set_a
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Py_ssize_t
DECL|function|cmyk_length (PyObject * self)
name|cmyk_length
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
literal|5
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_getitem (PyObject * self,Py_ssize_t pos)
name|cmyk_getitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|)
block|{
name|GimpCMYK
modifier|*
name|cmyk
decl_stmt|;
name|double
name|val
decl_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|5
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|5
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|cmyk
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpCMYK
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
name|val
operator|=
name|cmyk
operator|->
name|c
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|val
operator|=
name|cmyk
operator|->
name|m
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|val
operator|=
name|cmyk
operator|->
name|y
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|val
operator|=
name|cmyk
operator|->
name|k
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|val
operator|=
name|cmyk
operator|->
name|a
expr_stmt|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|PyInt_FromLong
argument_list|(
name|ROUND
argument_list|(
name|CLAMP
argument_list|(
name|val
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
operator|*
literal|255.0
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|cmyk_setitem (PyObject * self,Py_ssize_t pos,PyObject * value)
name|cmyk_setitem
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|pos
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|)
block|{
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pos
operator|+=
literal|5
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>=
literal|5
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_IndexError
argument_list|,
literal|"index out of range"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
switch|switch
condition|(
name|pos
condition|)
block|{
case|case
literal|0
case|:
return|return
name|cmyk_set_c
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|1
case|:
return|return
name|cmyk_set_m
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|2
case|:
return|return
name|cmyk_set_y
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|3
case|:
return|return
name|cmyk_set_k
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
case|case
literal|4
case|:
return|return
name|cmyk_set_a
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|NULL
argument_list|)
return|;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_slice (PyObject * self,Py_ssize_t start,Py_ssize_t end)
name|cmyk_slice
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|Py_ssize_t
name|start
parameter_list|,
name|Py_ssize_t
name|end
parameter_list|)
block|{
name|PyTupleObject
modifier|*
name|ret
decl_stmt|;
name|Py_ssize_t
name|i
decl_stmt|;
if|if
condition|(
name|start
operator|<
literal|0
condition|)
name|start
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|end
operator|>
literal|5
condition|)
name|end
operator|=
literal|5
expr_stmt|;
if|if
condition|(
name|end
operator|<
name|start
condition|)
name|end
operator|=
name|start
expr_stmt|;
name|ret
operator|=
operator|(
name|PyTupleObject
operator|*
operator|)
name|PyTuple_New
argument_list|(
name|end
operator|-
name|start
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|i
operator|=
name|start
init|;
name|i
operator|<
name|end
condition|;
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
operator|-
name|start
argument_list|,
name|cmyk_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|ret
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|cmyk_as_sequence
specifier|static
name|PySequenceMethods
name|cmyk_as_sequence
init|=
block|{
name|cmyk_length
block|,
operator|(
name|binaryfunc
operator|)
literal|0
block|,
literal|0
block|,
name|cmyk_getitem
block|,
name|cmyk_slice
block|,
name|cmyk_setitem
block|,
literal|0
block|,
operator|(
name|objobjproc
operator|)
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_subscript (PyObject * self,PyObject * item)
name|cmyk_subscript
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|item
parameter_list|)
block|{
if|if
condition|(
name|PyInt_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyInt_AS_LONG
argument_list|(
name|item
argument_list|)
decl_stmt|;
return|return
name|cmyk_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PyLong_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|long
name|i
init|=
name|PyLong_AsLong
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|i
operator|==
operator|-
literal|1
operator|&&
name|PyErr_Occurred
argument_list|()
condition|)
return|return
name|NULL
return|;
return|return
name|cmyk_getitem
argument_list|(
name|self
argument_list|,
name|i
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|PySlice_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|Py_ssize_t
name|start
decl_stmt|,
name|stop
decl_stmt|,
name|step
decl_stmt|,
name|slicelength
decl_stmt|,
name|cur
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|PySlice_GetIndicesEx
argument_list|(
operator|(
name|PySliceObject
operator|*
operator|)
name|item
argument_list|,
literal|5
argument_list|,
operator|&
name|start
argument_list|,
operator|&
name|stop
argument_list|,
operator|&
name|step
argument_list|,
operator|&
name|slicelength
argument_list|)
operator|<
literal|0
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|slicelength
operator|<=
literal|0
condition|)
block|{
return|return
name|PyTuple_New
argument_list|(
literal|0
argument_list|)
return|;
block|}
else|else
block|{
name|ret
operator|=
name|PyTuple_New
argument_list|(
name|slicelength
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|cur
operator|=
name|start
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|slicelength
condition|;
name|cur
operator|+=
name|step
operator|,
name|i
operator|++
control|)
name|PyTuple_SET_ITEM
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|cmyk_getitem
argument_list|(
name|self
argument_list|,
name|cur
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|PyString_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|char
modifier|*
name|s
init|=
name|PyString_AsString
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"c"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"cyan"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|cmyk_get_c
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"m"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"magenta"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|cmyk_get_m
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"y"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"yellow"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|cmyk_get_y
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"k"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"black"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|cmyk_get_k
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
elseif|else
if|if
condition|(
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"a"
argument_list|)
operator|==
literal|0
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|s
argument_list|,
literal|"alpha"
argument_list|)
operator|==
literal|0
condition|)
return|return
name|cmyk_get_a
argument_list|(
name|self
argument_list|,
name|NULL
argument_list|)
return|;
else|else
block|{
name|PyErr_SetObject
argument_list|(
name|PyExc_KeyError
argument_list|,
name|item
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"indices must be integers"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_decl_stmt
DECL|variable|cmyk_as_mapping
specifier|static
name|PyMappingMethods
name|cmyk_as_mapping
init|=
block|{
name|cmyk_length
block|,
operator|(
name|binaryfunc
operator|)
name|cmyk_subscript
block|,
operator|(
name|objobjargproc
operator|)
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|long
DECL|function|cmyk_hash (PyObject * self)
name|cmyk_hash
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|long
name|ret
init|=
operator|-
literal|1
decl_stmt|;
name|PyObject
modifier|*
name|temp
init|=
name|cmyk_getstate
argument_list|(
name|self
argument_list|)
decl_stmt|;
if|if
condition|(
name|temp
operator|!=
name|NULL
condition|)
block|{
name|ret
operator|=
name|PyObject_Hash
argument_list|(
name|temp
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|temp
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_richcompare (PyObject * self,PyObject * other,int op)
name|cmyk_richcompare
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|other
parameter_list|,
name|int
name|op
parameter_list|)
block|{
name|GimpCMYK
modifier|*
name|c1
decl_stmt|,
modifier|*
name|c2
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|pygimp_cmyk_check
argument_list|(
name|other
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare %s to %s"
argument_list|,
name|self
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|,
name|other
operator|->
name|ob_type
operator|->
name|tp_name
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|op
operator|!=
name|Py_EQ
operator|&&
name|op
operator|!=
name|Py_NE
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can't compare color values using<,<=,>,>="
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|c1
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpCMYK
argument_list|)
expr_stmt|;
name|c2
operator|=
name|pyg_boxed_get
argument_list|(
name|other
argument_list|,
name|GimpCMYK
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c1
operator|->
name|c
operator|==
name|c2
operator|->
name|c
operator|&&
name|c1
operator|->
name|m
operator|==
name|c2
operator|->
name|m
operator|&&
name|c1
operator|->
name|y
operator|==
name|c2
operator|->
name|y
operator|&&
name|c1
operator|->
name|k
operator|==
name|c2
operator|->
name|k
operator|&&
name|c1
operator|->
name|a
operator|==
name|c2
operator|->
name|a
operator|)
operator|==
operator|(
name|op
operator|==
name|Py_EQ
operator|)
condition|)
name|ret
operator|=
name|Py_True
expr_stmt|;
else|else
name|ret
operator|=
name|Py_False
expr_stmt|;
name|Py_INCREF
argument_list|(
name|ret
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_pretty_print (PyObject * self,gboolean inexact)
name|cmyk_pretty_print
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|gboolean
name|inexact
parameter_list|)
block|{
name|GimpCMYK
modifier|*
name|cmyk
decl_stmt|;
name|PyObject
modifier|*
name|ret
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|c_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|m_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|y_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|k_f
init|=
name|NULL
decl_stmt|,
modifier|*
name|a_f
init|=
name|NULL
decl_stmt|;
name|PyObject
modifier|*
name|c
init|=
name|NULL
decl_stmt|,
modifier|*
name|m
init|=
name|NULL
decl_stmt|,
modifier|*
name|y
init|=
name|NULL
decl_stmt|,
modifier|*
name|k
init|=
name|NULL
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|reprfunc
name|repr
decl_stmt|;
specifier|const
name|char
modifier|*
name|prefix
decl_stmt|;
if|if
condition|(
name|inexact
condition|)
block|{
name|repr
operator|=
name|PyObject_Str
expr_stmt|;
name|prefix
operator|=
literal|"CMYK "
expr_stmt|;
block|}
else|else
block|{
name|repr
operator|=
name|PyObject_Repr
expr_stmt|;
name|prefix
operator|=
name|self
operator|->
name|ob_type
operator|->
name|tp_name
expr_stmt|;
block|}
name|cmyk
operator|=
name|pyg_boxed_get
argument_list|(
name|self
argument_list|,
name|GimpCMYK
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|cmyk
operator|->
name|c
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|m_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|cmyk
operator|->
name|m
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|y_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|cmyk
operator|->
name|y
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|k_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|cmyk
operator|->
name|k
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a_f
operator|=
name|PyFloat_FromDouble
argument_list|(
name|cmyk
operator|->
name|a
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|c
operator|=
name|repr
argument_list|(
name|c_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|m
operator|=
name|repr
argument_list|(
name|m_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|y
operator|=
name|repr
argument_list|(
name|y_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|k
operator|=
name|repr
argument_list|(
name|k_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
if|if
condition|(
operator|(
name|a
operator|=
name|repr
argument_list|(
name|a_f
argument_list|)
operator|)
operator|==
name|NULL
condition|)
goto|goto
name|cleanup
goto|;
name|ret
operator|=
name|PyString_FromFormat
argument_list|(
literal|"%s(%s, %s, %s, %s, %s)"
argument_list|,
name|prefix
argument_list|,
name|PyString_AsString
argument_list|(
name|c
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|m
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|y
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|k
argument_list|)
argument_list|,
name|PyString_AsString
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|cleanup
label|:
name|Py_XDECREF
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|k
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|c_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|m_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|y_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|k_f
argument_list|)
expr_stmt|;
name|Py_XDECREF
argument_list|(
name|a_f
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_repr (PyObject * self)
name|cmyk_repr
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|cmyk_pretty_print
argument_list|(
name|self
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|cmyk_str (PyObject * self)
name|cmyk_str
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|cmyk_pretty_print
argument_list|(
name|self
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|cmyk_init (PyGBoxed * self,PyObject * args,PyObject * kwargs)
name|cmyk_init
parameter_list|(
name|PyGBoxed
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyObject
modifier|*
name|c
decl_stmt|,
modifier|*
name|m
decl_stmt|,
modifier|*
name|y
decl_stmt|,
modifier|*
name|k
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|GimpCMYK
name|cmyk
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"c"
block|,
literal|"m"
block|,
literal|"y"
block|,
literal|"k"
block|,
literal|"a"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"OOOO|O:set"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|m
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|k
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
DECL|macro|SET_MEMBER (m)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|)
value|G_STMT_START {				\     if (PyInt_Check(m))						\ 	cmyk.m = (double) PyInt_AS_LONG(m) / 255.0;		\     else if (PyFloat_Check(m))					\         cmyk.m = PyFloat_AS_DOUBLE(m);				\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be an int or a float");	\ 	return -1;						\     }								\ } G_STMT_END
name|SET_MEMBER
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|k
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|)
expr_stmt|;
else|else
name|cmyk
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
undef|#
directive|undef
name|SET_MEMBER
name|self
operator|->
name|gtype
operator|=
name|GIMP_TYPE_CMYK
expr_stmt|;
name|self
operator|->
name|free_on_dealloc
operator|=
name|TRUE
expr_stmt|;
name|self
operator|->
name|boxed
operator|=
name|g_boxed_copy
argument_list|(
name|GIMP_TYPE_CMYK
argument_list|,
operator|&
name|cmyk
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpCMYK_Type
name|PyTypeObject
name|PyGimpCMYK_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimpcolor.CMYK"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGBoxed
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
literal|0
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
literal|0
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|cmyk_repr
block|,
comment|/* tp_repr */
operator|(
name|PyNumberMethods
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_number */
operator|&
name|cmyk_as_sequence
block|,
comment|/* tp_as_sequence */
operator|&
name|cmyk_as_mapping
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
name|cmyk_hash
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
name|cmyk_str
block|,
comment|/* tp_repr */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
operator|(
name|PyBufferProcs
operator|*
operator|)
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
name|cmyk_richcompare
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|cmyk_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|cmyk_getsets
block|,
comment|/* tp_getset */
name|NULL
block|,
comment|/* tp_base */
name|NULL
block|,
comment|/* tp_dict */
operator|(
name|descrgetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_get */
operator|(
name|descrsetfunc
operator|)
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|cmyk_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
operator|(
name|freefunc
operator|)
literal|0
block|,
comment|/* tp_free */
operator|(
name|inquiry
operator|)
literal|0
comment|/* tp_is_gc */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_cmyk_new (const GimpCMYK * cmyk)
name|pygimp_cmyk_new
parameter_list|(
specifier|const
name|GimpCMYK
modifier|*
name|cmyk
parameter_list|)
block|{
return|return
name|pyg_boxed_new
argument_list|(
name|GIMP_TYPE_CMYK
argument_list|,
operator|(
name|gpointer
operator|)
name|cmyk
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
name|int
DECL|function|pygimp_rgb_from_pyobject (PyObject * object,GimpRGB * color)
name|pygimp_rgb_from_pyobject
parameter_list|(
name|PyObject
modifier|*
name|object
parameter_list|,
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|color
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|pygimp_rgb_check
argument_list|(
name|object
argument_list|)
condition|)
block|{
operator|*
name|color
operator|=
operator|*
name|pyg_boxed_get
argument_list|(
name|object
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
elseif|else
if|if
condition|(
name|PyString_Check
argument_list|(
name|object
argument_list|)
condition|)
block|{
if|if
condition|(
name|gimp_rgb_parse_css
argument_list|(
name|color
argument_list|,
name|PyString_AsString
argument_list|(
name|object
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
condition|)
block|{
return|return
literal|1
return|;
block|}
else|else
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"unable to parse color string"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|PySequence_Check
argument_list|(
name|object
argument_list|)
condition|)
block|{
name|PyObject
modifier|*
name|r
decl_stmt|,
modifier|*
name|g
decl_stmt|,
modifier|*
name|b
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|object
argument_list|,
literal|"OOO|O"
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
condition|)
return|return
literal|0
return|;
DECL|macro|SET_MEMBER (m)
define|#
directive|define
name|SET_MEMBER
parameter_list|(
name|m
parameter_list|)
value|G_STMT_START {				\     if (PyInt_Check(m))						\         color->m = (double) PyInt_AS_LONG(m) / 255.0;		\     else if (PyFloat_Check(m))					\         color->m = PyFloat_AS_DOUBLE(m);			\     else {							\ 	PyErr_SetString(PyExc_TypeError,			\ 			#m " must be an int or a float");	\ 	return 0;						\     }								\ } G_STMT_END
name|SET_MEMBER
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|SET_MEMBER
argument_list|(
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|a
condition|)
name|SET_MEMBER
argument_list|(
name|a
argument_list|)
expr_stmt|;
else|else
name|color
operator|->
name|a
operator|=
literal|1.0
expr_stmt|;
name|gimp_rgb_clamp
argument_list|(
name|color
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"could not convert to GimpRGB"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

end_unit

