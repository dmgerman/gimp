begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* -*- Mode: C; c-basic-offset: 4 -*-     Gimp-Python - allows the writing of Gimp plugins in Python.     Copyright (C) 1997-2002  James Henstridge<james@daa.com.au>      This program is free software; you can redistribute it and/or modify     it under the terms of the GNU General Public License as published by     the Free Software Foundation; either version 2 of the License, or     (at your option) any later version.      This program is distributed in the hope that it will be useful,     but WITHOUT ANY WARRANTY; without even the implied warranty of     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the     GNU General Public License for more details.      You should have received a copy of the GNU General Public License     along with this program; if not, write to the Free Software     Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"pygimp.h"
end_include

begin_include
include|#
directive|include
file|<sysmodule.h>
end_include

begin_comment
comment|/* maximum bits per pixel ... */
end_comment

begin_define
DECL|macro|MAX_BPP
define|#
directive|define
name|MAX_BPP
value|4
end_define

begin_decl_stmt
DECL|variable|pygimp_error
name|PyObject
modifier|*
name|pygimp_error
decl_stmt|;
end_decl_stmt

begin_ifndef
ifndef|#
directive|ifndef
name|PG_DEBUG
end_ifndef

begin_define
DECL|macro|PG_DEBUG
define|#
directive|define
name|PG_DEBUG
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* End of code for pdbFunc objects */
end_comment

begin_comment
comment|/* -------------------------------------------------------- */
end_comment

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc */
name|NULL
block|,
comment|/* quit_proc */
name|NULL
block|,
comment|/* query_proc */
name|NULL
comment|/* run_proc */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|callbacks
specifier|static
name|PyObject
modifier|*
name|callbacks
index|[]
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|pygimp_init_proc (void)
name|pygimp_init_proc
parameter_list|(
name|void
parameter_list|)
block|{
name|PyObject
modifier|*
name|r
decl_stmt|;
name|r
operator|=
name|PyObject_CallFunction
argument_list|(
name|callbacks
index|[
literal|0
index|]
argument_list|,
literal|"()"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
block|{
name|PyErr_Print
argument_list|()
expr_stmt|;
name|PyErr_Clear
argument_list|()
expr_stmt|;
return|return;
block|}
name|Py_DECREF
argument_list|(
name|r
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pygimp_quit_proc (void)
name|pygimp_quit_proc
parameter_list|(
name|void
parameter_list|)
block|{
name|PyObject
modifier|*
name|r
decl_stmt|;
name|r
operator|=
name|PyObject_CallFunction
argument_list|(
name|callbacks
index|[
literal|1
index|]
argument_list|,
literal|"()"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
block|{
name|PyErr_Print
argument_list|()
expr_stmt|;
name|PyErr_Clear
argument_list|()
expr_stmt|;
return|return;
block|}
name|Py_DECREF
argument_list|(
name|r
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pygimp_query_proc (void)
name|pygimp_query_proc
parameter_list|(
name|void
parameter_list|)
block|{
name|PyObject
modifier|*
name|r
decl_stmt|;
name|r
operator|=
name|PyObject_CallFunction
argument_list|(
name|callbacks
index|[
literal|2
index|]
argument_list|,
literal|"()"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|r
condition|)
block|{
name|PyErr_Print
argument_list|()
expr_stmt|;
name|PyErr_Clear
argument_list|()
expr_stmt|;
return|return;
block|}
name|Py_DECREF
argument_list|(
name|r
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pygimp_run_proc (const char * name,int nparams,const GimpParam * params,int * nreturn_vals,GimpParam ** return_vals)
name|pygimp_run_proc
parameter_list|(
specifier|const
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|params
parameter_list|,
name|int
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
name|PyObject
modifier|*
name|args
decl_stmt|,
modifier|*
name|ret
decl_stmt|;
name|GimpParamDef
modifier|*
name|pd
decl_stmt|,
modifier|*
name|rv
decl_stmt|;
name|GimpPDBProcType
name|t
decl_stmt|;
name|char
modifier|*
name|b
decl_stmt|,
modifier|*
name|h
decl_stmt|,
modifier|*
name|a
decl_stmt|,
modifier|*
name|c
decl_stmt|,
modifier|*
name|d
decl_stmt|;
name|int
name|np
decl_stmt|,
name|nrv
decl_stmt|;
name|gimp_procedural_db_proc_info
argument_list|(
name|name
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|h
argument_list|,
operator|&
name|a
argument_list|,
operator|&
name|c
argument_list|,
operator|&
name|d
argument_list|,
operator|&
name|t
argument_list|,
operator|&
name|np
argument_list|,
operator|&
name|nrv
argument_list|,
operator|&
name|pd
argument_list|,
operator|&
name|rv
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|h
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|d
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
argument_list|)
expr_stmt|;
if|#
directive|if
name|PG_DEBUG
operator|>
literal|0
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Params for %s:"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|print_GParam
argument_list|(
name|nparams
argument_list|,
name|params
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|args
operator|=
name|pygimp_param_to_tuple
argument_list|(
name|nparams
argument_list|,
name|params
argument_list|)
expr_stmt|;
if|if
condition|(
name|args
operator|==
name|NULL
condition|)
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|g_new
argument_list|(
name|GimpParam
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
return|return;
block|}
name|ret
operator|=
name|PyObject_CallFunction
argument_list|(
name|callbacks
index|[
literal|3
index|]
argument_list|,
literal|"(sO)"
argument_list|,
name|name
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|args
argument_list|)
expr_stmt|;
if|if
condition|(
name|ret
operator|==
name|NULL
condition|)
block|{
name|PyErr_Print
argument_list|()
expr_stmt|;
name|PyErr_Clear
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|g_new
argument_list|(
name|GimpParam
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
return|return;
block|}
operator|*
name|return_vals
operator|=
name|pygimp_param_from_tuple
argument_list|(
name|ret
argument_list|,
name|rv
argument_list|,
name|nrv
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|rv
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|return_vals
operator|==
name|NULL
condition|)
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|g_new
argument_list|(
name|GimpParam
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
return|return;
block|}
name|Py_DECREF
argument_list|(
name|ret
argument_list|)
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
name|nrv
operator|+
literal|1
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
operator|(
operator|*
name|return_vals
operator|)
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_SUCCESS
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_main (PyObject * self,PyObject * args)
name|pygimp_main
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|PyObject
modifier|*
name|av
decl_stmt|;
name|int
name|argc
decl_stmt|,
name|i
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|PyObject
modifier|*
name|ip
decl_stmt|,
modifier|*
name|qp
decl_stmt|,
modifier|*
name|query
decl_stmt|,
modifier|*
name|rp
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"OOOO:main"
argument_list|,
operator|&
name|ip
argument_list|,
operator|&
name|qp
argument_list|,
operator|&
name|query
argument_list|,
operator|&
name|rp
argument_list|)
condition|)
return|return
name|NULL
return|;
DECL|macro|Arg_Check (v)
define|#
directive|define
name|Arg_Check
parameter_list|(
name|v
parameter_list|)
value|(PyCallable_Check(v) || (v) == Py_None)
if|if
condition|(
operator|!
name|Arg_Check
argument_list|(
name|ip
argument_list|)
operator|||
operator|!
name|Arg_Check
argument_list|(
name|qp
argument_list|)
operator|||
operator|!
name|Arg_Check
argument_list|(
name|query
argument_list|)
operator|||
operator|!
name|Arg_Check
argument_list|(
name|rp
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"arguments must be callable."
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|query
operator|==
name|Py_None
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"a query procedure must be provided."
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|ip
operator|!=
name|Py_None
condition|)
block|{
name|callbacks
index|[
literal|0
index|]
operator|=
name|ip
expr_stmt|;
name|PLUG_IN_INFO
operator|.
name|init_proc
operator|=
name|pygimp_init_proc
expr_stmt|;
block|}
if|if
condition|(
name|qp
operator|!=
name|Py_None
condition|)
block|{
name|callbacks
index|[
literal|1
index|]
operator|=
name|qp
expr_stmt|;
name|PLUG_IN_INFO
operator|.
name|quit_proc
operator|=
name|pygimp_quit_proc
expr_stmt|;
block|}
if|if
condition|(
name|query
operator|!=
name|Py_None
condition|)
block|{
name|callbacks
index|[
literal|2
index|]
operator|=
name|query
expr_stmt|;
name|PLUG_IN_INFO
operator|.
name|query_proc
operator|=
name|pygimp_query_proc
expr_stmt|;
block|}
if|if
condition|(
name|rp
operator|!=
name|Py_None
condition|)
block|{
name|callbacks
index|[
literal|3
index|]
operator|=
name|rp
expr_stmt|;
name|PLUG_IN_INFO
operator|.
name|run_proc
operator|=
name|pygimp_run_proc
expr_stmt|;
block|}
name|av
operator|=
name|PySys_GetObject
argument_list|(
literal|"argv"
argument_list|)
expr_stmt|;
name|argc
operator|=
name|PyList_Size
argument_list|(
name|av
argument_list|)
expr_stmt|;
name|argv
operator|=
name|g_new
argument_list|(
name|char
operator|*
argument_list|,
name|argc
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
name|argv
index|[
name|i
index|]
operator|=
name|g_strdup
argument_list|(
name|PyString_AsString
argument_list|(
name|PyList_GetItem
argument_list|(
name|av
argument_list|,
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_main
argument_list|(
operator|&
name|PLUG_IN_INFO
argument_list|,
name|argc
argument_list|,
name|argv
argument_list|)
expr_stmt|;
if|if
condition|(
name|argv
operator|!=
name|NULL
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|argc
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|argv
index|[
name|i
index|]
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|argv
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|argv
argument_list|)
expr_stmt|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_quit (PyObject * self)
name|pygimp_quit
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|gimp_quit
argument_list|()
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_message (PyObject * self,PyObject * args)
name|pygimp_message
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|msg
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:message"
argument_list|,
operator|&
name|msg
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_message
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_set_data (PyObject * self,PyObject * args)
name|pygimp_set_data
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|id
decl_stmt|,
modifier|*
name|data
decl_stmt|;
name|int
name|bytes
decl_stmt|,
name|nreturn_vals
decl_stmt|;
name|GimpParam
modifier|*
name|return_vals
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"ss#:set_data"
argument_list|,
operator|&
name|id
argument_list|,
operator|&
name|data
argument_list|,
operator|&
name|bytes
argument_list|)
condition|)
return|return
name|NULL
return|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"gimp_procedural_db_set_data"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|GIMP_PDB_STRING
argument_list|,
name|id
argument_list|,
name|GIMP_PDB_INT32
argument_list|,
name|bytes
argument_list|,
name|GIMP_PDB_INT8ARRAY
argument_list|,
name|data
argument_list|,
name|GIMP_PDB_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|!=
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"error occurred while storing"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_get_data (PyObject * self,PyObject * args)
name|pygimp_get_data
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|id
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
name|GimpParam
modifier|*
name|return_vals
decl_stmt|;
name|PyObject
modifier|*
name|s
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:get_data"
argument_list|,
operator|&
name|id
argument_list|)
condition|)
return|return
name|NULL
return|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"gimp_procedural_db_get_data"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|GIMP_PDB_STRING
argument_list|,
name|id
argument_list|,
name|GIMP_PDB_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|!=
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"no data for id"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|s
operator|=
name|PyString_FromStringAndSize
argument_list|(
operator|(
name|char
operator|*
operator|)
name|return_vals
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int8array
argument_list|,
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_int32
argument_list|)
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_progress_init (PyObject * self,PyObject * args)
name|pygimp_progress_init
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|msg
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"|s:progress_init"
argument_list|,
operator|&
name|msg
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_progress_init
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_progress_update (PyObject * self,PyObject * args)
name|pygimp_progress_update
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|double
name|p
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"d:progress_update"
argument_list|,
operator|&
name|p
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_progress_update
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_image_list (PyObject * self)
name|pygimp_image_list
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|gint32
modifier|*
name|imgs
decl_stmt|;
name|int
name|nimgs
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
name|imgs
operator|=
name|gimp_image_list
argument_list|(
operator|&
name|nimgs
argument_list|)
expr_stmt|;
name|ret
operator|=
name|PyList_New
argument_list|(
name|nimgs
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nimgs
condition|;
name|i
operator|++
control|)
name|PyList_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
name|pygimp_image_new
argument_list|(
name|imgs
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_install_procedure (PyObject * self,PyObject * args)
name|pygimp_install_procedure
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|blurb
decl_stmt|,
modifier|*
name|help
decl_stmt|,
modifier|*
name|author
decl_stmt|,
modifier|*
name|copyright
decl_stmt|,
modifier|*
name|date
decl_stmt|,
modifier|*
name|menu_path
decl_stmt|,
modifier|*
name|image_types
decl_stmt|,
modifier|*
name|n
decl_stmt|,
modifier|*
name|d
decl_stmt|;
name|GimpParamDef
modifier|*
name|params
decl_stmt|,
modifier|*
name|return_vals
decl_stmt|;
name|int
name|type
decl_stmt|,
name|nparams
decl_stmt|,
name|nreturn_vals
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|pars
decl_stmt|,
modifier|*
name|rets
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"sssssszziOO:install_procedure"
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|blurb
argument_list|,
operator|&
name|help
argument_list|,
operator|&
name|author
argument_list|,
operator|&
name|copyright
argument_list|,
operator|&
name|date
argument_list|,
operator|&
name|menu_path
argument_list|,
operator|&
name|image_types
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|pars
argument_list|,
operator|&
name|rets
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|PySequence_Check
argument_list|(
name|pars
argument_list|)
operator|||
operator|!
name|PySequence_Check
argument_list|(
name|rets
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"last two args must be sequences"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|nparams
operator|=
name|PySequence_Length
argument_list|(
name|pars
argument_list|)
expr_stmt|;
name|nreturn_vals
operator|=
name|PySequence_Length
argument_list|(
name|rets
argument_list|)
expr_stmt|;
name|params
operator|=
name|g_new
argument_list|(
name|GimpParamDef
argument_list|,
name|nparams
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nparams
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|PySequence_GetItem
argument_list|(
name|pars
argument_list|,
name|i
argument_list|)
argument_list|,
literal|"iss"
argument_list|,
operator|&
operator|(
name|params
index|[
name|i
index|]
operator|.
name|type
operator|)
argument_list|,
operator|&
name|n
argument_list|,
operator|&
name|d
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|params
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|params
index|[
name|i
index|]
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|params
index|[
name|i
index|]
operator|.
name|description
operator|=
name|g_strdup
argument_list|(
name|d
argument_list|)
expr_stmt|;
block|}
name|return_vals
operator|=
name|g_new
argument_list|(
name|GimpParamDef
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nreturn_vals
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|PySequence_GetItem
argument_list|(
name|rets
argument_list|,
name|i
argument_list|)
argument_list|,
literal|"iss"
argument_list|,
operator|&
operator|(
name|return_vals
index|[
name|i
index|]
operator|.
name|type
operator|)
argument_list|,
operator|&
name|n
argument_list|,
operator|&
name|d
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|params
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|return_vals
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|return_vals
index|[
name|i
index|]
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|return_vals
index|[
name|i
index|]
operator|.
name|description
operator|=
name|g_strdup
argument_list|(
name|d
argument_list|)
expr_stmt|;
block|}
name|gimp_install_procedure
argument_list|(
name|name
argument_list|,
name|blurb
argument_list|,
name|help
argument_list|,
name|author
argument_list|,
name|copyright
argument_list|,
name|date
argument_list|,
name|menu_path
argument_list|,
name|image_types
argument_list|,
name|type
argument_list|,
name|nparams
argument_list|,
name|nreturn_vals
argument_list|,
name|params
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_install_temp_proc (PyObject * self,PyObject * args)
name|pygimp_install_temp_proc
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|blurb
decl_stmt|,
modifier|*
name|help
decl_stmt|,
modifier|*
name|author
decl_stmt|,
modifier|*
name|copyright
decl_stmt|,
modifier|*
name|date
decl_stmt|,
modifier|*
name|menu_path
decl_stmt|,
modifier|*
name|image_types
decl_stmt|,
modifier|*
name|n
decl_stmt|,
modifier|*
name|d
decl_stmt|;
name|GimpParamDef
modifier|*
name|params
decl_stmt|,
modifier|*
name|return_vals
decl_stmt|;
name|int
name|type
decl_stmt|,
name|nparams
decl_stmt|,
name|nreturn_vals
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|pars
decl_stmt|,
modifier|*
name|rets
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"sssssszziOO:install_temp_proc"
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|blurb
argument_list|,
operator|&
name|help
argument_list|,
operator|&
name|author
argument_list|,
operator|&
name|copyright
argument_list|,
operator|&
name|date
argument_list|,
operator|&
name|menu_path
argument_list|,
operator|&
name|image_types
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|pars
argument_list|,
operator|&
name|rets
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|PySequence_Check
argument_list|(
name|pars
argument_list|)
operator|||
operator|!
name|PySequence_Check
argument_list|(
name|rets
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"last two args must be sequences"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|nparams
operator|=
name|PySequence_Length
argument_list|(
name|pars
argument_list|)
expr_stmt|;
name|nreturn_vals
operator|=
name|PySequence_Length
argument_list|(
name|rets
argument_list|)
expr_stmt|;
name|params
operator|=
name|g_new
argument_list|(
name|GimpParamDef
argument_list|,
name|nparams
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nparams
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|PySequence_GetItem
argument_list|(
name|pars
argument_list|,
name|i
argument_list|)
argument_list|,
literal|"iss"
argument_list|,
operator|&
operator|(
name|params
index|[
name|i
index|]
operator|.
name|type
operator|)
argument_list|,
operator|&
name|n
argument_list|,
operator|&
name|d
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|params
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|params
index|[
name|i
index|]
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|params
index|[
name|i
index|]
operator|.
name|description
operator|=
name|g_strdup
argument_list|(
name|d
argument_list|)
expr_stmt|;
block|}
name|return_vals
operator|=
name|g_new
argument_list|(
name|GimpParamDef
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nreturn_vals
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|PySequence_GetItem
argument_list|(
name|rets
argument_list|,
name|i
argument_list|)
argument_list|,
literal|"iss"
argument_list|,
operator|&
operator|(
name|return_vals
index|[
name|i
index|]
operator|.
name|type
operator|)
argument_list|,
operator|&
name|n
argument_list|,
operator|&
name|d
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|params
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|return_vals
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|return_vals
index|[
name|i
index|]
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|return_vals
index|[
name|i
index|]
operator|.
name|description
operator|=
name|g_strdup
argument_list|(
name|d
argument_list|)
expr_stmt|;
block|}
name|gimp_install_temp_proc
argument_list|(
name|name
argument_list|,
name|blurb
argument_list|,
name|help
argument_list|,
name|author
argument_list|,
name|copyright
argument_list|,
name|date
argument_list|,
name|menu_path
argument_list|,
name|image_types
argument_list|,
name|type
argument_list|,
name|nparams
argument_list|,
name|nreturn_vals
argument_list|,
name|params
argument_list|,
name|return_vals
argument_list|,
name|pygimp_run_proc
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_uninstall_temp_proc (PyObject * self,PyObject * args)
name|pygimp_uninstall_temp_proc
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:uninstall_temp_proc"
argument_list|,
operator|&
name|name
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_uninstall_temp_proc
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_register_magic_load_handler (PyObject * self,PyObject * args)
name|pygimp_register_magic_load_handler
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|extensions
decl_stmt|,
modifier|*
name|prefixes
decl_stmt|,
modifier|*
name|magics
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"ssss:register_magic_load_handler"
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|extensions
argument_list|,
operator|&
name|prefixes
argument_list|,
operator|&
name|magics
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_register_magic_load_handler
argument_list|(
name|name
argument_list|,
name|extensions
argument_list|,
name|prefixes
argument_list|,
name|magics
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_register_load_handler (PyObject * self,PyObject * args)
name|pygimp_register_load_handler
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|extensions
decl_stmt|,
modifier|*
name|prefixes
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"sss:register_load_handler"
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|extensions
argument_list|,
operator|&
name|prefixes
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_register_load_handler
argument_list|(
name|name
argument_list|,
name|extensions
argument_list|,
name|prefixes
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_register_save_handler (PyObject * self,PyObject * args)
name|pygimp_register_save_handler
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|extensions
decl_stmt|,
modifier|*
name|prefixes
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"sss:register_save_handler"
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|extensions
argument_list|,
operator|&
name|prefixes
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_register_save_handler
argument_list|(
name|name
argument_list|,
name|extensions
argument_list|,
name|prefixes
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_gamma (PyObject * self)
name|pygimp_gamma
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyFloat_FromDouble
argument_list|(
name|gimp_gamma
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_install_cmap (PyObject * self)
name|pygimp_install_cmap
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_install_cmap
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_gtkrc (PyObject * self)
name|pygimp_gtkrc
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyString_FromString
argument_list|(
name|gimp_gtkrc
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_get_background (PyObject * self)
name|pygimp_get_background
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpRGB
name|colour
decl_stmt|;
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|gimp_palette_get_background
argument_list|(
operator|&
name|colour
argument_list|)
expr_stmt|;
name|gimp_rgb_get_uchar
argument_list|(
operator|&
name|colour
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(iii)"
argument_list|,
operator|(
name|int
operator|)
name|r
argument_list|,
operator|(
name|int
operator|)
name|g
argument_list|,
operator|(
name|int
operator|)
name|b
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_get_foreground (PyObject * self)
name|pygimp_get_foreground
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|GimpRGB
name|colour
decl_stmt|;
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|gimp_palette_get_foreground
argument_list|(
operator|&
name|colour
argument_list|)
expr_stmt|;
name|gimp_rgb_get_uchar
argument_list|(
operator|&
name|colour
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(iii)"
argument_list|,
operator|(
name|int
operator|)
name|r
argument_list|,
operator|(
name|int
operator|)
name|g
argument_list|,
operator|(
name|int
operator|)
name|b
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_set_background (PyObject * self,PyObject * args)
name|pygimp_set_background
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|GimpRGB
name|colour
decl_stmt|;
name|int
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"(iii):set_background"
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
condition|)
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iii:set_background"
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
condition|)
return|return
name|NULL
return|;
block|}
name|r
operator|=
name|CLAMP
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|g
operator|=
name|CLAMP
argument_list|(
name|g
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|b
operator|=
name|CLAMP
argument_list|(
name|b
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|gimp_rgb_set_uchar
argument_list|(
operator|&
name|colour
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|gimp_palette_set_background
argument_list|(
operator|&
name|colour
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_set_foreground (PyObject * self,PyObject * args)
name|pygimp_set_foreground
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|GimpRGB
name|colour
decl_stmt|;
name|int
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"(iii):set_foreground"
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
condition|)
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iii:set_foreground"
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
condition|)
return|return
name|NULL
return|;
block|}
name|r
operator|=
name|CLAMP
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|g
operator|=
name|CLAMP
argument_list|(
name|g
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|b
operator|=
name|CLAMP
argument_list|(
name|b
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|gimp_rgb_set_uchar
argument_list|(
operator|&
name|colour
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|gimp_palette_set_foreground
argument_list|(
operator|&
name|colour
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_gradients_get_list (PyObject * self)
name|pygimp_gradients_get_list
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|char
modifier|*
modifier|*
name|list
decl_stmt|;
name|int
name|num
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
name|list
operator|=
name|gimp_gradients_get_list
argument_list|(
name|NULL
argument_list|,
operator|&
name|num
argument_list|)
expr_stmt|;
name|ret
operator|=
name|PyList_New
argument_list|(
name|num
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
name|PyList_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|PyString_FromString
argument_list|(
name|list
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|list
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_gradients_get_gradient (PyObject * self)
name|pygimp_gradients_get_gradient
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyString_FromString
argument_list|(
name|gimp_gradients_get_gradient
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_gradients_set_gradient (PyObject * self,PyObject * args)
name|pygimp_gradients_set_gradient
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|actv
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:gradients_set_gradient"
argument_list|,
operator|&
name|actv
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_gradients_set_gradient
argument_list|(
name|actv
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_gradients_sample_uniform (PyObject * self,PyObject * args)
name|pygimp_gradients_sample_uniform
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|num
decl_stmt|,
name|reverse
init|=
name|FALSE
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|double
modifier|*
name|samp
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i|i:gradients_sample_uniform"
argument_list|,
operator|&
name|num
argument_list|,
operator|&
name|reverse
argument_list|)
condition|)
return|return
name|NULL
return|;
name|samp
operator|=
name|gimp_gradients_sample_uniform
argument_list|(
name|num
argument_list|,
name|reverse
argument_list|)
expr_stmt|;
name|ret
operator|=
name|PyList_New
argument_list|(
name|num
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
operator|,
name|j
operator|+=
literal|4
control|)
name|PyList_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|Py_BuildValue
argument_list|(
literal|"(dddd)"
argument_list|,
name|samp
index|[
name|j
index|]
argument_list|,
name|samp
index|[
name|j
operator|+
literal|1
index|]
argument_list|,
name|samp
index|[
name|j
operator|+
literal|2
index|]
argument_list|,
name|samp
index|[
name|j
operator|+
literal|3
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|samp
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_gradients_sample_custom (PyObject * self,PyObject * args)
name|pygimp_gradients_sample_custom
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|num
decl_stmt|,
name|reverse
init|=
name|FALSE
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|double
modifier|*
name|pos
decl_stmt|,
modifier|*
name|samp
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|,
modifier|*
name|item
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O|i:gradients_sample_custom"
argument_list|,
operator|&
name|ret
argument_list|,
operator|&
name|reverse
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|PySequence_Check
argument_list|(
name|ret
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"second arg must be a sequence"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|num
operator|=
name|PySequence_Length
argument_list|(
name|ret
argument_list|)
expr_stmt|;
name|pos
operator|=
name|g_new
argument_list|(
name|gdouble
argument_list|,
name|num
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
block|{
name|item
operator|=
name|PySequence_GetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|PyFloat_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"second arg must be a sequence of floats"
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pos
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|pos
index|[
name|i
index|]
operator|=
name|PyFloat_AsDouble
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
name|samp
operator|=
name|gimp_gradients_sample_custom
argument_list|(
name|num
argument_list|,
name|pos
argument_list|,
name|reverse
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|ret
operator|=
name|PyList_New
argument_list|(
name|num
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
operator|,
name|j
operator|+=
literal|4
control|)
name|PyList_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|Py_BuildValue
argument_list|(
literal|"(dddd)"
argument_list|,
name|samp
index|[
name|j
index|]
argument_list|,
name|samp
index|[
name|j
operator|+
literal|1
index|]
argument_list|,
name|samp
index|[
name|j
operator|+
literal|2
index|]
argument_list|,
name|samp
index|[
name|j
operator|+
literal|3
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|samp
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_delete (PyObject * self,PyObject * args)
name|pygimp_delete
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|PyGimpImage
modifier|*
name|img
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O:delete"
argument_list|,
operator|&
name|img
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|pygimp_image_check
argument_list|(
name|img
argument_list|)
condition|)
name|gimp_image_delete
argument_list|(
name|img
operator|->
name|ID
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|pygimp_drawable_check
argument_list|(
name|img
argument_list|)
condition|)
name|gimp_drawable_delete
argument_list|(
name|img
operator|->
name|ID
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|pygimp_display_check
argument_list|(
name|img
argument_list|)
condition|)
name|gimp_display_delete
argument_list|(
name|img
operator|->
name|ID
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_displays_flush (PyObject * self)
name|pygimp_displays_flush
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|gimp_displays_flush
argument_list|()
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_tile_cache_size (PyObject * self,PyObject * args)
name|pygimp_tile_cache_size
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|unsigned
name|long
name|k
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"l:tile_cache_size"
argument_list|,
operator|&
name|k
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_tile_cache_size
argument_list|(
name|k
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_tile_cache_ntiles (PyObject * self,PyObject * args)
name|pygimp_tile_cache_ntiles
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|unsigned
name|long
name|n
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"l:tile_cache_ntiles"
argument_list|,
operator|&
name|n
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_tile_cache_ntiles
argument_list|(
name|n
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_tile_width (PyObject * self)
name|pygimp_tile_width
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_tile_width
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_tile_height (PyObject * self)
name|pygimp_tile_height
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_tile_height
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_extension_ack (PyObject * self)
name|pygimp_extension_ack
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|gimp_extension_ack
argument_list|()
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_extension_process (PyObject * self,PyObject * args)
name|pygimp_extension_process
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|timeout
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:extension_process"
argument_list|,
operator|&
name|timeout
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_extension_process
argument_list|(
name|timeout
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_parasite_find (PyObject * self,PyObject * args)
name|pygimp_parasite_find
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:parasite_find"
argument_list|,
operator|&
name|name
argument_list|)
condition|)
return|return
name|NULL
return|;
return|return
name|pygimp_parasite_new
argument_list|(
name|gimp_parasite_find
argument_list|(
name|name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_parasite_attach (PyObject * self,PyObject * args)
name|pygimp_parasite_attach
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|PyGimpParasite
modifier|*
name|parasite
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!:parasite_attach"
argument_list|,
operator|&
name|PyGimpParasite_Type
argument_list|,
operator|&
name|parasite
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_parasite_attach
argument_list|(
name|parasite
operator|->
name|para
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_attach_new_parasite (PyObject * self,PyObject * args)
name|pygimp_attach_new_parasite
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|data
decl_stmt|;
name|int
name|flags
decl_stmt|,
name|size
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"sis#:attach_new_parasite"
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|flags
argument_list|,
operator|&
name|data
argument_list|,
operator|&
name|size
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_attach_new_parasite
argument_list|(
name|name
argument_list|,
name|flags
argument_list|,
name|size
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_parasite_detach (PyObject * self,PyObject * args)
name|pygimp_parasite_detach
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:parasite_detach"
argument_list|,
operator|&
name|name
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_parasite_detach
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_parasite_list (PyObject * self)
name|pygimp_parasite_list
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
name|gint
name|num_parasites
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|parasites
decl_stmt|;
if|if
condition|(
name|gimp_parasite_list
argument_list|(
operator|&
name|num_parasites
argument_list|,
operator|&
name|parasites
argument_list|)
condition|)
block|{
name|PyObject
modifier|*
name|ret
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|ret
operator|=
name|PyTuple_New
argument_list|(
name|num_parasites
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_parasites
condition|;
name|i
operator|++
control|)
block|{
name|PyTuple_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|PyString_FromString
argument_list|(
name|parasites
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|parasites
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|parasites
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not list parasites"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|pygimp_default_display (PyObject * self)
name|pygimp_default_display
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|)
block|{
return|return
name|pygimp_display_new
argument_list|(
name|gimp_default_display
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|id2image (PyObject * self,PyObject * args)
name|id2image
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|id
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:_id2image"
argument_list|,
operator|&
name|id
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|id
operator|>=
literal|0
condition|)
return|return
name|pygimp_image_new
argument_list|(
name|id
argument_list|)
return|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|id2drawable (PyObject * self,PyObject * args)
name|id2drawable
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|id
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:_id2drawable"
argument_list|,
operator|&
name|id
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|id
operator|>=
literal|0
condition|)
return|return
name|pygimp_drawable_new
argument_list|(
name|NULL
argument_list|,
name|id
argument_list|)
return|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|id2display (PyObject * self,PyObject * args)
name|id2display
parameter_list|(
name|PyObject
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|id
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:_id2display"
argument_list|,
operator|&
name|id
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|id
operator|>=
literal|0
condition|)
return|return
name|pygimp_display_new
argument_list|(
name|id
argument_list|)
return|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_comment
comment|/* List of methods defined in the module */
end_comment

begin_decl_stmt
DECL|variable|gimp_methods
specifier|static
name|struct
name|PyMethodDef
name|gimp_methods
index|[]
init|=
block|{
block|{
literal|"main"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_main
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"quit"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_quit
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"message"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_message
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"set_data"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_set_data
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"get_data"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_get_data
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"progress_init"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_progress_init
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"progress_update"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_progress_update
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"image_list"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_image_list
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"install_procedure"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_install_procedure
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"install_temp_proc"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_install_temp_proc
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"uninstall_temp_proc"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_uninstall_temp_proc
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"register_magic_load_handler"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_register_magic_load_handler
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"register_load_handler"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_register_load_handler
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"register_save_handler"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_register_save_handler
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"gamma"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_gamma
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"install_cmap"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_install_cmap
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"gtkrc"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_gtkrc
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"get_background"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_get_background
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"get_foreground"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_get_foreground
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"set_background"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_set_background
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"set_foreground"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_set_foreground
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"gradients_get_list"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_gradients_get_list
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"gradients_get_gradient"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_gradients_get_gradient
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"gradients_set_gradient"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_gradients_set_gradient
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"gradients_sample_uniform"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_gradients_sample_uniform
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"gradients_sample_custom"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_gradients_sample_custom
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"delete"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_delete
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"displays_flush"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_displays_flush
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"tile_cache_size"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_tile_cache_size
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"tile_cache_ntiles"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_tile_cache_ntiles
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"tile_width"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_tile_width
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"tile_height"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_tile_height
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"extension_ack"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_extension_ack
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"extension_process"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_extension_process
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_find"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_parasite_find
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_attach"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_parasite_attach
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"attach_new_parasite"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_attach_new_parasite
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_detach"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_parasite_detach
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_list"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_parasite_list
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"default_display"
block|,
operator|(
name|PyCFunction
operator|)
name|pygimp_default_display
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"_id2image"
block|,
operator|(
name|PyCFunction
operator|)
name|id2image
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"_id2drawable"
block|,
operator|(
name|PyCFunction
operator|)
name|id2drawable
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"_id2display"
block|,
operator|(
name|PyCFunction
operator|)
name|id2display
block|,
name|METH_VARARGS
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|PyCFunction
operator|)
name|NULL
block|,
literal|0
block|,
name|NULL
block|}
comment|/* sentinel */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Initialization function for the module (*must* be called initgimp) */
end_comment

begin_decl_stmt
DECL|variable|gimp_module_documentation
specifier|static
name|char
name|gimp_module_documentation
index|[]
init|=
literal|"This module provides interfaces to allow you to write gimp plugins"
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|initgimp ()
name|initgimp
parameter_list|()
block|{
name|PyObject
modifier|*
name|m
decl_stmt|,
modifier|*
name|d
decl_stmt|;
name|PyObject
modifier|*
name|i
decl_stmt|;
name|PyGimpPDB_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpPDB_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpPDB_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpPDB_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpPDBFunction_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpPDBFunction_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpPDBFunction_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpPDBFunction_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpImage_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpImage_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpImage_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpImage_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpDisplay_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpDisplay_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpDisplay_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpDisplay_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpDisplay_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpLayer_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpLayer_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpLayer_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpLayer_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpChannel_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpChannel_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpChannel_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpChannel_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpTile_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpTile_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpTile_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpTile_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpPixelRgn_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpPixelRgn_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpPixelRgn_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpPixelRgn_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
name|PyGimpParasite_Type
operator|.
name|ob_type
operator|=
operator|&
name|PyType_Type
expr_stmt|;
name|PyGimpParasite_Type
operator|.
name|tp_alloc
operator|=
name|PyType_GenericAlloc
expr_stmt|;
name|PyGimpParasite_Type
operator|.
name|tp_new
operator|=
name|PyType_GenericNew
expr_stmt|;
if|if
condition|(
name|PyType_Ready
argument_list|(
operator|&
name|PyGimpParasite_Type
argument_list|)
operator|<
literal|0
condition|)
return|return;
comment|/* Create the module and add the functions */
name|m
operator|=
name|Py_InitModule4
argument_list|(
literal|"gimp"
argument_list|,
name|gimp_methods
argument_list|,
name|gimp_module_documentation
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
name|NULL
argument_list|,
name|PYTHON_API_VERSION
argument_list|)
expr_stmt|;
comment|/* Add some symbolic constants to the module */
name|d
operator|=
name|PyModule_GetDict
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|pygimp_error
operator|=
name|PyErr_NewException
argument_list|(
literal|"gimp.error"
argument_list|,
name|PyExc_RuntimeError
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"error"
argument_list|,
name|pygimp_error
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"pdb"
argument_list|,
name|pygimp_pdb_new
argument_list|()
argument_list|)
expr_stmt|;
comment|/* export the types used in gimpmodule */
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"Image"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpImage_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"Drawable"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpDrawable_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"Layer"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpLayer_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"Channel"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpChannel_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"Display"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpDisplay_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"Tile"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpTile_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"PixelRgn"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpPixelRgn_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"Parasite"
argument_list|,
operator|(
name|PyObject
operator|*
operator|)
operator|&
name|PyGimpParasite_Type
argument_list|)
expr_stmt|;
name|PyDict_SetItemString
argument_list|(
name|d
argument_list|,
literal|"version"
argument_list|,
name|i
operator|=
name|Py_BuildValue
argument_list|(
literal|"(iii)"
argument_list|,
name|gimp_major_version
argument_list|,
name|gimp_minor_version
argument_list|,
name|gimp_micro_version
argument_list|)
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|i
argument_list|)
expr_stmt|;
comment|/* Check for errors */
if|if
condition|(
name|PyErr_Occurred
argument_list|()
condition|)
name|Py_FatalError
argument_list|(
literal|"can't initialize module gimp"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

