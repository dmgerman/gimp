begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* -*- Mode: C; c-basic-offset: 4 -*-      Gimp-Python - allows the writing of Gimp plugins in Python.     Copyright (C) 1997-2002  James Henstridge<james@daa.com.au>      This program is free software; you can redistribute it and/or modify     it under the terms of the GNU General Public License as published by     the Free Software Foundation; either version 2 of the License, or     (at your option) any later version.      This program is distributed in the hope that it will be useful,     but WITHOUT ANY WARRANTY; without even the implied warranty of     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the     GNU General Public License for more details.      You should have received a copy of the GNU General Public License     along with this program; if not, write to the Free Software     Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"pygimp.h"
end_include

begin_function
specifier|static
name|void
DECL|function|ensure_drawable (PyGimpDrawable * self)
name|ensure_drawable
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
if|if
condition|(
operator|!
name|self
operator|->
name|drawable
condition|)
name|self
operator|->
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_flush (PyGimpDrawable * self,PyObject * args)
name|drw_flush
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|":flush"
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
name|gimp_drawable_flush
argument_list|(
name|self
operator|->
name|drawable
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_update (PyGimpDrawable * self,PyObject * args)
name|drw_update
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|unsigned
name|int
name|w
decl_stmt|,
name|h
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iiii:update"
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|w
argument_list|,
operator|&
name|h
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_drawable_update
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_merge_shadow (PyGimpDrawable * self,PyObject * args)
name|drw_merge_shadow
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|u
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:merge_shadow"
argument_list|,
operator|&
name|u
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_drawable_merge_shadow
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|u
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_fill (PyGimpDrawable * self,PyObject * args)
name|drw_fill
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|f
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:fill"
argument_list|,
operator|&
name|f
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_drawable_fill
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_tile (PyGimpDrawable * self,PyObject * args)
name|drw_get_tile
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|GimpTile
modifier|*
name|t
decl_stmt|;
name|int
name|shadow
decl_stmt|,
name|r
decl_stmt|,
name|c
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iii:get_tile"
argument_list|,
operator|&
name|shadow
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|c
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
name|t
operator|=
name|gimp_drawable_get_tile
argument_list|(
name|self
operator|->
name|drawable
argument_list|,
name|shadow
argument_list|,
name|r
argument_list|,
name|c
argument_list|)
expr_stmt|;
return|return
name|pygimp_tile_new
argument_list|(
name|t
argument_list|,
name|self
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_tile2 (PyGimpDrawable * self,PyObject * args)
name|drw_get_tile2
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|GimpTile
modifier|*
name|t
decl_stmt|;
name|int
name|shadow
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iii:get_tile2"
argument_list|,
operator|&
name|shadow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
name|t
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|self
operator|->
name|drawable
argument_list|,
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
return|return
name|pygimp_tile_new
argument_list|(
name|t
argument_list|,
name|self
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_pixel_rgn (PyGimpDrawable * self,PyObject * args)
name|drw_get_pixel_rgn
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|,
name|dirty
init|=
literal|1
decl_stmt|,
name|shadow
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iiii|ii:get_pixel_rgn"
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|w
argument_list|,
operator|&
name|h
argument_list|,
operator|&
name|dirty
argument_list|,
operator|&
name|shadow
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
return|return
name|pygimp_pixel_rgn_new
argument_list|(
name|self
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
name|dirty
argument_list|,
name|shadow
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_parasite_find (PyGimpDrawable * self,PyObject * args)
name|drw_parasite_find
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:parasite_find"
argument_list|,
operator|&
name|name
argument_list|)
condition|)
return|return
name|NULL
return|;
return|return
name|pygimp_parasite_new
argument_list|(
name|gimp_drawable_parasite_find
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_parasite_attach (PyGimpDrawable * self,PyObject * args)
name|drw_parasite_attach
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|PyGimpParasite
modifier|*
name|parasite
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!:parasite_attach"
argument_list|,
operator|&
name|PyGimpParasite_Type
argument_list|,
operator|&
name|parasite
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_drawable_parasite_attach
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|parasite
operator|->
name|para
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_attach_new_parasite (PyGimpDrawable * self,PyObject * args)
name|drw_attach_new_parasite
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|,
modifier|*
name|data
decl_stmt|;
name|int
name|flags
decl_stmt|,
name|size
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"sis#:attach_new_parasite"
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|flags
argument_list|,
operator|&
name|data
argument_list|,
operator|&
name|size
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_drawable_attach_new_parasite
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|name
argument_list|,
name|flags
argument_list|,
name|size
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_parasite_detach (PyGimpDrawable * self,PyObject * args)
name|drw_parasite_detach
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:detach_parasite"
argument_list|,
operator|&
name|name
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_drawable_parasite_detach
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|drw_dealloc (PyGimpLayer * self)
name|drw_dealloc
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|)
block|{
if|if
condition|(
name|self
operator|->
name|drawable
condition|)
name|gimp_drawable_detach
argument_list|(
name|self
operator|->
name|drawable
argument_list|)
expr_stmt|;
name|PyObject_DEL
argument_list|(
name|self
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_repr (PyGimpLayer * self)
name|drw_repr
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|)
block|{
name|PyObject
modifier|*
name|s
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gimp_drawable_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|s
operator|=
name|PyString_FromFormat
argument_list|(
literal|"<gimp.Drawable %s>"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|drw_cmp (PyGimpLayer * self,PyGimpLayer * other)
name|drw_cmp
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyGimpLayer
modifier|*
name|other
parameter_list|)
block|{
if|if
condition|(
name|self
operator|->
name|ID
operator|==
name|other
operator|->
name|ID
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|self
operator|->
name|ID
operator|>
name|other
operator|->
name|ID
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|1
return|;
block|}
end_function

begin_comment
comment|/* for inclusion with the methods of layer and channel objects */
end_comment

begin_decl_stmt
DECL|variable|drw_methods
specifier|static
name|PyMethodDef
name|drw_methods
index|[]
init|=
block|{
block|{
literal|"flush"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_flush
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"update"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_update
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"merge_shadow"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_merge_shadow
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"fill"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_fill
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"get_tile"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_tile
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"get_tile2"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_tile2
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"get_pixel_rgn"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_pixel_rgn
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_find"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_parasite_find
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_attach"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_parasite_attach
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"attach_new_parasite"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_attach_new_parasite
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_detach"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_parasite_detach
block|,
name|METH_VARARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|PyGimpDrawable_Type
name|PyTypeObject
name|PyGimpDrawable_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimp.Drawable"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGimpDrawable
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
name|drw_dealloc
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
name|drw_cmp
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|drw_repr
block|,
comment|/* tp_repr */
literal|0
block|,
comment|/* tp_as_number */
literal|0
block|,
comment|/* tp_as_sequence */
literal|0
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
literal|0
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
literal|0
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
literal|0
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|drw_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
literal|0
block|,
comment|/* tp_getset */
operator|(
name|PyTypeObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_base */
operator|(
name|PyObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_dict */
literal|0
block|,
comment|/* tp_descr_get */
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
literal|0
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_drawable_new (GimpDrawable * drawable,gint32 ID)
name|pygimp_drawable_new
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|gint32
name|ID
parameter_list|)
block|{
name|PyObject
modifier|*
name|self
decl_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
operator|&&
name|ID
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
if|if
condition|(
name|drawable
operator|!=
name|NULL
condition|)
name|ID
operator|=
name|drawable
operator|->
name|drawable_id
expr_stmt|;
comment|/* create the appropriate object type */
if|if
condition|(
name|gimp_drawable_is_layer
argument_list|(
name|ID
argument_list|)
condition|)
name|self
operator|=
name|pygimp_layer_new
argument_list|(
name|ID
argument_list|)
expr_stmt|;
else|else
name|self
operator|=
name|pygimp_channel_new
argument_list|(
name|ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|self
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
operator|(
operator|(
name|PyGimpDrawable
operator|*
operator|)
name|self
operator|)
operator|->
name|drawable
operator|=
name|drawable
expr_stmt|;
return|return
name|self
return|;
block|}
end_function

begin_comment
comment|/* End of code for Drawable objects */
end_comment

begin_comment
comment|/* -------------------------------------------------------- */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_copy (PyGimpLayer * self,PyObject * args)
name|lay_copy
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|add_alpha
init|=
literal|0
decl_stmt|,
name|nreturn_vals
decl_stmt|;
name|GimpParam
modifier|*
name|return_vals
decl_stmt|;
name|gint32
name|id
decl_stmt|;
comment|/* start of long convoluted (working) layer_copy */
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"|i:copy"
argument_list|,
operator|&
name|add_alpha
argument_list|)
condition|)
return|return
name|NULL
return|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"gimp_layer_copy"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|GIMP_PDB_LAYER
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|GIMP_PDB_INT32
argument_list|,
name|add_alpha
argument_list|,
name|GIMP_PDB_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|!=
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"can't create new layer"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|id
operator|=
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_layer
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
return|return
name|pygimp_layer_new
argument_list|(
name|id
argument_list|)
return|;
comment|/* This simple version of the code doesn't seem to work */
comment|/* return (PyObject *)newlayobject(gimp_layer_copy(self->ID));*/
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_add_alpha (PyGimpLayer * self,PyObject * args)
name|lay_add_alpha
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|":add_alpha"
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_layer_add_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_create_mask (PyGimpLayer * self,PyObject * args)
name|lay_create_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|type
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:create_mask"
argument_list|,
operator|&
name|type
argument_list|)
condition|)
return|return
name|NULL
return|;
return|return
name|pygimp_channel_new
argument_list|(
name|gimp_layer_create_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|type
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_resize (PyGimpLayer * self,PyObject * args)
name|lay_resize
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|unsigned
name|int
name|new_h
decl_stmt|,
name|new_w
decl_stmt|;
name|int
name|offs_x
decl_stmt|,
name|offs_y
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iiii:resize"
argument_list|,
operator|&
name|new_w
argument_list|,
operator|&
name|new_h
argument_list|,
operator|&
name|offs_x
argument_list|,
operator|&
name|offs_y
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_layer_resize
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|new_w
argument_list|,
name|new_h
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_scale (PyGimpLayer * self,PyObject * args)
name|lay_scale
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|unsigned
name|int
name|new_w
decl_stmt|,
name|new_h
decl_stmt|;
name|int
name|local_origin
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iii:scale"
argument_list|,
operator|&
name|new_w
argument_list|,
operator|&
name|new_h
argument_list|,
operator|&
name|local_origin
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_layer_scale
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|new_w
argument_list|,
name|new_h
argument_list|,
name|local_origin
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_translate (PyGimpLayer * self,PyObject * args)
name|lay_translate
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|offs_x
decl_stmt|,
name|offs_y
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"ii:translate"
argument_list|,
operator|&
name|offs_x
argument_list|,
operator|&
name|offs_y
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_layer_translate
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_set_offsets (PyGimpLayer * self,PyObject * args)
name|lay_set_offsets
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|offs_x
decl_stmt|,
name|offs_y
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"ii:set_offsets"
argument_list|,
operator|&
name|offs_x
argument_list|,
operator|&
name|offs_y
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_layer_set_offsets
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_tattoo (PyGimpLayer * self,PyObject * args)
name|lay_get_tattoo
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|":get_tattoo"
argument_list|)
condition|)
return|return
name|NULL
return|;
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_layer_get_tattoo
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|lay_methods
specifier|static
name|struct
name|PyMethodDef
name|lay_methods
index|[]
init|=
block|{
block|{
literal|"copy"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_copy
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"add_alpha"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_add_alpha
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"create_mask"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_create_mask
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"resize"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_resize
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"scale"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_scale
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"translate"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_translate
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"set_offsets"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_set_offsets
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"get_tattoo"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_get_tattoo
block|,
name|METH_VARARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
comment|/* sentinel */
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_getattr (PyGimpLayer * self,char * attr)
name|lay_getattr
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|char
modifier|*
name|attr
parameter_list|)
block|{
name|gint32
name|id
decl_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"__members__"
argument_list|)
condition|)
return|return
name|Py_BuildValue
argument_list|(
literal|"[ssssssssssssssssssss]"
argument_list|,
literal|"ID"
argument_list|,
literal|"apply_mask"
argument_list|,
literal|"bpp"
argument_list|,
literal|"edit_mask"
argument_list|,
literal|"has_alpha"
argument_list|,
literal|"height"
argument_list|,
literal|"image"
argument_list|,
literal|"is_color"
argument_list|,
literal|"is_colour"
argument_list|,
literal|"is_floating_selection"
argument_list|,
literal|"is_gray"
argument_list|,
literal|"is_grey"
argument_list|,
literal|"is_indexed"
argument_list|,
literal|"is_rgb"
argument_list|,
literal|"mask"
argument_list|,
literal|"mask_bounds"
argument_list|,
literal|"mode"
argument_list|,
literal|"name"
argument_list|,
literal|"offsets"
argument_list|,
literal|"opacity"
argument_list|,
literal|"preserve_transparency"
argument_list|,
literal|"show_mask"
argument_list|,
literal|"type"
argument_list|,
literal|"visible"
argument_list|,
literal|"width"
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"ID"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|self
operator|->
name|ID
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"bpp"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_drawable_bpp
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"has_alpha"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_has_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"height"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_drawable_height
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"image"
argument_list|)
condition|)
block|{
name|id
operator|=
name|gimp_layer_get_image_id
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
return|return
name|pygimp_image_new
argument_list|(
name|id
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_color"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_colour"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_rgb"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_is_rgb
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_floating_selection"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_layer_is_floating_selection
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_gray"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_grey"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_is_gray
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_indexed"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_is_indexed
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mask"
argument_list|)
condition|)
block|{
name|id
operator|=
name|gimp_layer_get_mask_id
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
return|return
name|pygimp_channel_new
argument_list|(
name|id
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mask_bounds"
argument_list|)
condition|)
block|{
name|gint
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(iiii)"
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"apply_mask"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_layer_get_apply_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"edit_mask"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_layer_get_edit_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mode"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_layer_get_mode
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"name"
argument_list|)
condition|)
return|return
name|PyString_FromString
argument_list|(
name|gimp_layer_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"offsets"
argument_list|)
condition|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gimp_drawable_offsets
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(ii)"
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"opacity"
argument_list|)
condition|)
return|return
name|PyFloat_FromDouble
argument_list|(
operator|(
name|double
operator|)
name|gimp_layer_get_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"preserve_transparency"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_layer_get_preserve_transparency
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"show_mask"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_layer_get_show_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"type"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_drawable_type
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"visible"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_layer_get_visible
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"width"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_drawable_width
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|{
name|PyObject
modifier|*
name|name
init|=
name|PyString_FromString
argument_list|(
name|attr
argument_list|)
decl_stmt|;
name|PyObject
modifier|*
name|ret
init|=
name|PyObject_GenericGetAttr
argument_list|(
operator|(
name|PyObject
operator|*
operator|)
name|self
argument_list|,
name|name
argument_list|)
decl_stmt|;
name|Py_DECREF
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_setattr (PyGimpLayer * self,char * attr,PyObject * v)
name|lay_setattr
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|char
modifier|*
name|attr
parameter_list|,
name|PyObject
modifier|*
name|v
parameter_list|)
block|{
if|if
condition|(
name|v
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can not delete attributes."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* Set attribute 'name' to value 'v'. v==NULL means delete */
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"apply_mask"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_apply_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"edit_mask"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_edit_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mode"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_mode
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|(
name|GimpLayerModeEffects
operator|)
name|PyInt_AsLong
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"name"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyString_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_name
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyString_AsString
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"opacity"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyFloat_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyFloat_AsDouble
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"preserve_transparency"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_preserve_transparency
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"show_mask"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_show_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"visible"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_visible
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"ID"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"bpp"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"height"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"image"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mask"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"type"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"width"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_floating_selection"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"offsets"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mask_bounds"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"has_alpha"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_color"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_colour"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_rgb"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_gray"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_grey"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_indexed"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"__members__"
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"read-only attribute."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|{
name|PyObject
modifier|*
name|name
init|=
name|PyString_FromString
argument_list|(
name|attr
argument_list|)
decl_stmt|;
name|int
name|ret
init|=
name|PyObject_GenericSetAttr
argument_list|(
operator|(
name|PyObject
operator|*
operator|)
name|self
argument_list|,
name|name
argument_list|,
name|v
argument_list|)
decl_stmt|;
name|Py_DECREF
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_repr (PyGimpLayer * self)
name|lay_repr
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|)
block|{
name|PyObject
modifier|*
name|s
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gimp_layer_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|s
operator|=
name|PyString_FromFormat
argument_list|(
literal|"<gimp.Layer %s>"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_init (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|lay_init
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyGimpImage
modifier|*
name|img
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|GimpImageType
name|type
decl_stmt|;
name|double
name|opacity
decl_stmt|;
name|GimpLayerModeEffects
name|mode
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!siiidi:gimp.Layer.__init__"
argument_list|,
operator|&
name|PyGimpImage_Type
argument_list|,
operator|&
name|img
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|opacity
argument_list|,
operator|&
name|mode
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|self
operator|->
name|ID
operator|=
name|gimp_layer_new
argument_list|(
name|img
operator|->
name|ID
argument_list|,
name|name
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|type
argument_list|,
name|opacity
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|self
operator|->
name|ID
operator|<
literal|0
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create layer"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpLayer_Type
name|PyTypeObject
name|PyGimpLayer_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimp.Layer"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGimpLayer
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
name|drw_dealloc
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
name|lay_getattr
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
name|lay_setattr
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
name|drw_cmp
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|lay_repr
block|,
comment|/* tp_repr */
literal|0
block|,
comment|/* tp_as_number */
literal|0
block|,
comment|/* tp_as_sequence */
literal|0
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
literal|0
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
literal|0
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
literal|0
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|lay_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
literal|0
block|,
comment|/* tp_getset */
operator|&
name|PyGimpDrawable_Type
block|,
comment|/* tp_base */
operator|(
name|PyObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_dict */
literal|0
block|,
comment|/* tp_descr_get */
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|lay_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_layer_new (gint32 ID)
name|pygimp_layer_new
parameter_list|(
name|gint32
name|ID
parameter_list|)
block|{
name|PyGimpLayer
modifier|*
name|self
decl_stmt|;
if|if
condition|(
name|ID
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
name|self
operator|=
name|PyObject_NEW
argument_list|(
name|PyGimpLayer
argument_list|,
operator|&
name|PyGimpLayer_Type
argument_list|)
expr_stmt|;
if|if
condition|(
name|self
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|self
operator|->
name|ID
operator|=
name|ID
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|self
return|;
block|}
end_function

begin_comment
comment|/* End of code for Layer objects */
end_comment

begin_comment
comment|/* -------------------------------------------------------- */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_copy (PyGimpChannel * self,PyObject * args)
name|chn_copy
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|gint32
name|id
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|":copy"
argument_list|)
condition|)
return|return
name|NULL
return|;
name|id
operator|=
name|gimp_channel_copy
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"can't copy channel"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|pygimp_channel_new
argument_list|(
name|id
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_get_tattoo (PyGimpChannel * self,PyObject * args)
name|chn_get_tattoo
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|":get_tattoo"
argument_list|)
condition|)
return|return
name|NULL
return|;
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_channel_get_tattoo
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|chn_methods
specifier|static
name|struct
name|PyMethodDef
name|chn_methods
index|[]
init|=
block|{
block|{
literal|"copy"
block|,
operator|(
name|PyCFunction
operator|)
name|chn_copy
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"get_tattoo"
block|,
operator|(
name|PyCFunction
operator|)
name|chn_get_tattoo
block|,
name|METH_VARARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
comment|/* sentinel */
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_getattr (PyGimpChannel * self,char * attr)
name|chn_getattr
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|char
modifier|*
name|attr
parameter_list|)
block|{
name|gint32
name|id
decl_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"__members__"
argument_list|)
condition|)
return|return
name|Py_BuildValue
argument_list|(
literal|"[ssssssssssssssssssssssss]"
argument_list|,
literal|"ID"
argument_list|,
literal|"bpp"
argument_list|,
literal|"color"
argument_list|,
literal|"colour"
argument_list|,
literal|"has_alpha"
argument_list|,
literal|"height"
argument_list|,
literal|"image"
argument_list|,
literal|"is_color"
argument_list|,
literal|"is_colour"
argument_list|,
literal|"is_gray"
argument_list|,
literal|"is_grey"
argument_list|,
literal|"is_indexed"
argument_list|,
literal|"is_layer_mask"
argument_list|,
literal|"is_rgb"
argument_list|,
literal|"layer"
argument_list|,
literal|"layer_mask"
argument_list|,
literal|"mask_bounds"
argument_list|,
literal|"name"
argument_list|,
literal|"offsets"
argument_list|,
literal|"opacity"
argument_list|,
literal|"show_masked"
argument_list|,
literal|"type"
argument_list|,
literal|"visible"
argument_list|,
literal|"width"
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"ID"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|self
operator|->
name|ID
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"bpp"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_bpp
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"color"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"colour"
argument_list|)
condition|)
block|{
name|GimpRGB
name|colour
decl_stmt|;
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|gimp_channel_get_color
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|colour
argument_list|)
expr_stmt|;
name|gimp_rgb_get_uchar
argument_list|(
operator|&
name|colour
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(iii)"
argument_list|,
operator|(
name|long
operator|)
name|r
argument_list|,
operator|(
name|long
operator|)
name|g
argument_list|,
operator|(
name|long
operator|)
name|b
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"has_alpha"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_has_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"height"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
operator|(
name|long
operator|)
name|gimp_drawable_height
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"image"
argument_list|)
condition|)
block|{
name|id
operator|=
name|gimp_channel_get_image_id
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
return|return
name|pygimp_image_new
argument_list|(
name|id
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_color"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_colour"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_rgb"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_is_rgb
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_gray"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_grey"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_is_gray
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_indexed"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_is_indexed
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"layer"
argument_list|)
condition|)
block|{
comment|/* id = gimp_channel_get_layer_id(self->ID); */
comment|/* It isn't quite clear what that was supposed to achieve, but 	   the gimp_channel_get_layer_id call no longer exists, which 	   was breaking everything that tried to load gimpmodule.so.  	   With no-one apparently maintaing it, the options seem to be: 	    A) remove this "layer" attribute entirely, as it doesn't 	       seem to make much sense.             B) Just return the channel ID. 	    	    The latter seems more conservative, so that's what I'll do. 	    -- acapnotic@users.sourceforge.net (08/09/2000) */
name|id
operator|=
name|self
operator|->
name|ID
expr_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
return|return
name|pygimp_layer_new
argument_list|(
name|id
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"layer_mask"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_layer_mask"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_is_layer_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mask_bounds"
argument_list|)
condition|)
block|{
name|gint
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(iiii)"
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"name"
argument_list|)
condition|)
return|return
name|PyString_FromString
argument_list|(
name|gimp_channel_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"offsets"
argument_list|)
condition|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gimp_drawable_offsets
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(ii)"
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"opacity"
argument_list|)
condition|)
return|return
name|PyFloat_FromDouble
argument_list|(
name|gimp_channel_get_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"show_masked"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_channel_get_show_masked
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"type"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_type
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"visible"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_channel_get_visible
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"width"
argument_list|)
condition|)
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_width
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|{
name|PyObject
modifier|*
name|name
init|=
name|PyString_FromString
argument_list|(
name|attr
argument_list|)
decl_stmt|;
name|PyObject
modifier|*
name|ret
init|=
name|PyObject_GenericGetAttr
argument_list|(
operator|(
name|PyObject
operator|*
operator|)
name|self
argument_list|,
name|name
argument_list|)
decl_stmt|;
name|Py_DECREF
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|chn_setattr (PyGimpChannel * self,char * attr,PyObject * v)
name|chn_setattr
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|char
modifier|*
name|attr
parameter_list|,
name|PyObject
modifier|*
name|v
parameter_list|)
block|{
if|if
condition|(
name|v
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"can not delete attributes."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"color"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"colour"
argument_list|)
condition|)
block|{
name|PyObject
modifier|*
name|r
decl_stmt|,
modifier|*
name|g
decl_stmt|,
modifier|*
name|b
decl_stmt|;
name|GimpRGB
name|colour
decl_stmt|;
if|if
condition|(
operator|!
name|PySequence_Check
argument_list|(
name|v
argument_list|)
operator|||
name|PySequence_Length
argument_list|(
name|v
argument_list|)
operator|<
literal|3
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|r
operator|=
name|PySequence_GetItem
argument_list|(
name|v
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g
operator|=
name|PySequence_GetItem
argument_list|(
name|v
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|b
operator|=
name|PySequence_GetItem
argument_list|(
name|v
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|r
argument_list|)
operator|||
operator|!
name|PyInt_Check
argument_list|(
name|g
argument_list|)
operator|||
operator|!
name|PyInt_Check
argument_list|(
name|b
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|b
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_rgb_set_uchar
argument_list|(
operator|&
name|colour
argument_list|,
name|PyInt_AsLong
argument_list|(
name|r
argument_list|)
argument_list|,
name|PyInt_AsLong
argument_list|(
name|g
argument_list|)
argument_list|,
name|PyInt_AsLong
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|g
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|gimp_channel_set_color
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|colour
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"name"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyString_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_channel_set_name
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyString_AsString
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"opacity"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyFloat_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_channel_set_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyFloat_AsDouble
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/*	if (!strcmp(attr, "show_masked")) { 	if (!PyInt_Check(v)) { 	PyErr_SetString(PyExc_TypeError, "type mis-match."); 	return -1; 	} 	gimp_channel_set_show_masked(self->ID, PyInt_AsLong(v)); 	return 0; 	}     */
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"visible"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|v
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mis-match."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_channel_set_visible
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"height"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"image"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"layer"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"width"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"ID"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"bpp"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"layer_mask"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"mask_bounds"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"offsets"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"type"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"has_alpha"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_color"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_colour"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_rgb"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_gray"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_grey"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_indexed"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"is_layer_mask"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|attr
argument_list|,
literal|"__members__"
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"read-only attribute."
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|{
name|PyObject
modifier|*
name|name
init|=
name|PyString_FromString
argument_list|(
name|attr
argument_list|)
decl_stmt|;
name|int
name|ret
init|=
name|PyObject_GenericSetAttr
argument_list|(
operator|(
name|PyObject
operator|*
operator|)
name|self
argument_list|,
name|name
argument_list|,
name|v
argument_list|)
decl_stmt|;
name|Py_DECREF
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_repr (PyGimpChannel * self)
name|chn_repr
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|)
block|{
name|PyObject
modifier|*
name|s
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gimp_channel_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|s
operator|=
name|PyString_FromFormat
argument_list|(
literal|"<gimp.Channel %s>"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|chn_init (PyGimpChannel * self,PyObject * args,PyObject * kwargs)
name|chn_init
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyGimpImage
modifier|*
name|img
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|double
name|opacity
decl_stmt|;
name|GimpRGB
name|colour
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!siid(iii):gimp.Channel.__init__"
argument_list|,
operator|&
name|PyGimpImage_Type
argument_list|,
operator|&
name|img
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|opacity
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|gimp_rgb_set_uchar
argument_list|(
operator|&
name|colour
argument_list|,
name|r
operator|&
literal|0xff
argument_list|,
name|g
operator|&
literal|0xff
argument_list|,
name|b
operator|&
literal|0xff
argument_list|)
expr_stmt|;
name|self
operator|->
name|ID
operator|=
name|gimp_channel_new
argument_list|(
name|img
operator|->
name|ID
argument_list|,
name|name
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|opacity
argument_list|,
operator|&
name|colour
argument_list|)
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|self
operator|->
name|ID
operator|<
literal|0
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create layer"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpChannel_Type
name|PyTypeObject
name|PyGimpChannel_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimp.Channel"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGimpChannel
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
name|drw_dealloc
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
name|chn_getattr
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
name|chn_setattr
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
name|drw_cmp
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|chn_repr
block|,
comment|/* tp_repr */
literal|0
block|,
comment|/* tp_as_number */
literal|0
block|,
comment|/* tp_as_sequence */
literal|0
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
literal|0
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
literal|0
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
literal|0
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|chn_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
literal|0
block|,
comment|/* tp_getset */
operator|&
name|PyGimpDrawable_Type
block|,
comment|/* tp_base */
operator|(
name|PyObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_dict */
literal|0
block|,
comment|/* tp_descr_get */
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|chn_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_channel_new (gint32 ID)
name|pygimp_channel_new
parameter_list|(
name|gint32
name|ID
parameter_list|)
block|{
name|PyGimpChannel
modifier|*
name|self
decl_stmt|;
if|if
condition|(
name|ID
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
name|self
operator|=
name|PyObject_NEW
argument_list|(
name|PyGimpChannel
argument_list|,
operator|&
name|PyGimpChannel_Type
argument_list|)
expr_stmt|;
if|if
condition|(
name|self
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|self
operator|->
name|ID
operator|=
name|ID
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|self
return|;
block|}
end_function

end_unit

