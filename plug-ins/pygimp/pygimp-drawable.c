begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* -*- Mode: C; c-basic-offset: 4 -*-  * Gimp-Python - allows the writing of Gimp plugins in Python.  * Copyright (C) 1997-2002  James Henstridge<james@daa.com.au>  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|<config.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|NO_IMPORT_PYGOBJECT
define|#
directive|define
name|NO_IMPORT_PYGOBJECT
end_define

begin_include
include|#
directive|include
file|<pygobject.h>
end_include

begin_include
include|#
directive|include
file|"pygimp.h"
end_include

begin_define
DECL|macro|NO_IMPORT_PYGIMPCOLOR
define|#
directive|define
name|NO_IMPORT_PYGIMPCOLOR
end_define

begin_include
include|#
directive|include
file|"pygimpcolor-api.h"
end_include

begin_include
include|#
directive|include
file|<glib-object.h>
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_function
specifier|static
name|void
DECL|function|ensure_drawable (PyGimpDrawable * self)
name|ensure_drawable
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
if|if
condition|(
operator|!
name|self
operator|->
name|drawable
condition|)
name|self
operator|->
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_flush (PyGimpDrawable * self)
name|drw_flush
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
name|gimp_drawable_flush
argument_list|(
name|self
operator|->
name|drawable
argument_list|)
expr_stmt|;
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_update (PyGimpDrawable * self,PyObject * args)
name|drw_update
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|unsigned
name|int
name|w
decl_stmt|,
name|h
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iiii:update"
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|w
argument_list|,
operator|&
name|h
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_drawable_update
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not update drawable (ID %d): "
literal|"x=%d, y=%d, w=%d, h=%d"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|(
name|int
operator|)
name|w
argument_list|,
operator|(
name|int
operator|)
name|h
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_merge_shadow (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_merge_shadow
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|gboolean
name|undo
init|=
name|FALSE
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"undo"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|i:merge_shadow"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|undo
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_drawable_merge_shadow
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|undo
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not merge the shadow buffer on drawable (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_free_shadow (PyGimpDrawable * self)
name|drw_free_shadow
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
if|if
condition|(
operator|!
name|gimp_drawable_free_shadow
argument_list|(
name|self
operator|->
name|ID
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not free shadow tiles on drawable (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_fill (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_fill
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|fill
init|=
name|GIMP_FILL_FOREGROUND
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"fill"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|i:fill"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|fill
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_drawable_fill
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|fill
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not fill drawable (ID %d) with fill mode %d"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|fill
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_tile (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_get_tile
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|GimpTile
modifier|*
name|t
decl_stmt|;
name|int
name|shadow
decl_stmt|,
name|row
decl_stmt|,
name|col
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"shadow"
block|,
literal|"row"
block|,
literal|"col"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"iii:get_tile"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|shadow
argument_list|,
operator|&
name|row
argument_list|,
operator|&
name|col
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
if|if
condition|(
name|row
operator|<
literal|0
operator|||
name|row
operator|>=
name|self
operator|->
name|drawable
operator|->
name|ntile_rows
operator|||
name|col
operator|<
literal|0
operator|||
name|col
operator|>=
name|self
operator|->
name|drawable
operator|->
name|ntile_cols
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
name|t
operator|=
name|gimp_drawable_get_tile
argument_list|(
name|self
operator|->
name|drawable
argument_list|,
name|shadow
argument_list|,
name|row
argument_list|,
name|col
argument_list|)
expr_stmt|;
return|return
name|pygimp_tile_new
argument_list|(
name|t
argument_list|,
name|self
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_tile2 (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_get_tile2
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|GimpTile
modifier|*
name|t
decl_stmt|;
name|int
name|shadow
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"shadow"
block|,
literal|"x"
block|,
literal|"y"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"iii:get_tile2"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|shadow
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|x
operator|>=
name|self
operator|->
name|drawable
operator|->
name|width
operator|||
name|y
operator|<
literal|0
operator|||
name|y
operator|>=
name|self
operator|->
name|drawable
operator|->
name|height
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
name|t
operator|=
name|gimp_drawable_get_tile2
argument_list|(
name|self
operator|->
name|drawable
argument_list|,
name|shadow
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
return|return
name|pygimp_tile_new
argument_list|(
name|t
argument_list|,
name|self
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_pixel_rgn (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_get_pixel_rgn
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|width
decl_stmt|,
name|height
decl_stmt|,
name|dirty
init|=
literal|1
decl_stmt|,
name|shadow
init|=
literal|0
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"x"
block|,
literal|"y"
block|,
literal|"width"
block|,
literal|"height"
block|,
literal|"dirty"
block|,
literal|"shadow"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"iiii|ii:get_pixel_rgn"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|dirty
argument_list|,
operator|&
name|shadow
argument_list|)
condition|)
return|return
name|NULL
return|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
return|return
name|pygimp_pixel_rgn_new
argument_list|(
name|self
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|dirty
argument_list|,
name|shadow
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_offset (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_offset
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|wrap_around
decl_stmt|;
name|GimpOffsetType
name|fill_type
decl_stmt|;
name|int
name|offset_x
decl_stmt|,
name|offset_y
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"wrap_around"
block|,
literal|"fill_type"
block|,
literal|"offset_x"
block|,
literal|"offset_y"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"iiii:offset"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|wrap_around
argument_list|,
operator|&
name|fill_type
argument_list|,
operator|&
name|offset_x
argument_list|,
operator|&
name|offset_y
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_drawable_offset
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|wrap_around
argument_list|,
name|fill_type
argument_list|,
name|offset_x
argument_list|,
name|offset_y
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not offset drawable (ID %d) by x: %d, y: %d"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|offset_x
argument_list|,
name|offset_y
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_parasite_find (PyGimpDrawable * self,PyObject * args)
name|drw_parasite_find
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:parasite_find"
argument_list|,
operator|&
name|name
argument_list|)
condition|)
return|return
name|NULL
return|;
return|return
name|pygimp_parasite_new
argument_list|(
name|gimp_item_get_parasite
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_parasite_attach (PyGimpDrawable * self,PyObject * args)
name|drw_parasite_attach
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|PyGimpParasite
modifier|*
name|parasite
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!:parasite_attach"
argument_list|,
operator|&
name|PyGimpParasite_Type
argument_list|,
operator|&
name|parasite
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_item_attach_parasite
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|parasite
operator|->
name|para
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not attach parasite '%s' on drawable (ID %d)"
argument_list|,
name|gimp_parasite_name
argument_list|(
name|parasite
operator|->
name|para
argument_list|)
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_attach_new_parasite (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_attach_new_parasite
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|flags
decl_stmt|,
name|size
decl_stmt|;
name|guint8
modifier|*
name|data
decl_stmt|;
name|GimpParasite
modifier|*
name|parasite
decl_stmt|;
name|gboolean
name|success
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"name"
block|,
literal|"flags"
block|,
literal|"data"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"sis#:attach_new_parasite"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|flags
argument_list|,
operator|&
name|data
argument_list|,
operator|&
name|size
argument_list|)
condition|)
return|return
name|NULL
return|;
name|parasite
operator|=
name|gimp_parasite_new
argument_list|(
name|name
argument_list|,
name|flags
argument_list|,
name|size
operator|+
literal|1
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|success
operator|=
name|gimp_item_attach_parasite
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|parasite
argument_list|)
expr_stmt|;
name|gimp_parasite_free
argument_list|(
name|parasite
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|success
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not attach new parasite '%s' to drawable (ID %d)"
argument_list|,
name|name
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_parasite_detach (PyGimpDrawable * self,PyObject * args)
name|drw_parasite_detach
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"s:detach_parasite"
argument_list|,
operator|&
name|name
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_item_detach_parasite
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|name
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not detach parasite '%s' from drawable (ID %d)"
argument_list|,
name|name
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_parasite_list (PyGimpDrawable * self)
name|drw_parasite_list
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
name|gint
name|num_parasites
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|parasites
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|parasites
operator|=
name|gimp_item_get_parasite_list
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|num_parasites
argument_list|)
expr_stmt|;
name|ret
operator|=
name|PyTuple_New
argument_list|(
name|num_parasites
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_parasites
condition|;
name|i
operator|++
control|)
name|PyTuple_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|PyString_FromString
argument_list|(
name|parasites
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|g_strfreev
argument_list|(
name|parasites
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_pixel (PyGimpDrawable * self,PyObject * args)
name|drw_get_pixel
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|num_channels
decl_stmt|,
name|i
decl_stmt|;
name|guint8
modifier|*
name|pixel
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"(ii):get_pixel"
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
condition|)
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"ii:get_pixel"
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
condition|)
return|return
name|NULL
return|;
block|}
name|pixel
operator|=
name|gimp_drawable_get_pixel
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|num_channels
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pixel
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not get pixel (%d, %d) on drawable (ID %d)"
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|ret
operator|=
name|PyTuple_New
argument_list|(
name|num_channels
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_channels
condition|;
name|i
operator|++
control|)
name|PyTuple_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|PyInt_FromLong
argument_list|(
name|pixel
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pixel
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_set_pixel (PyGimpDrawable * self,PyObject * args)
name|drw_set_pixel
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|num_channels
decl_stmt|,
name|i
decl_stmt|,
name|val
decl_stmt|;
name|guint8
modifier|*
name|pixel
decl_stmt|;
name|PyObject
modifier|*
name|seq
decl_stmt|,
modifier|*
name|item
decl_stmt|;
name|gboolean
name|is_string
decl_stmt|,
name|error
init|=
name|TRUE
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"(ii)O:set_pixel"
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|seq
argument_list|)
condition|)
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"iiO:set_pixel"
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|seq
argument_list|)
condition|)
return|return
name|NULL
return|;
block|}
if|if
condition|(
operator|!
name|PyString_Check
argument_list|(
name|seq
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|PySequence_Check
argument_list|(
name|seq
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"pixel values must be a sequence"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|is_string
operator|=
name|FALSE
expr_stmt|;
name|num_channels
operator|=
name|PySequence_Length
argument_list|(
name|seq
argument_list|)
expr_stmt|;
name|pixel
operator|=
name|g_new
argument_list|(
name|guint8
argument_list|,
name|num_channels
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_channels
condition|;
name|i
operator|++
control|)
block|{
name|item
operator|=
name|PySequence_GetItem
argument_list|(
name|seq
argument_list|,
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"pixel values must be a sequence of ints"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|val
operator|=
name|PyInt_AsLong
argument_list|(
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|<
literal|0
operator|||
name|val
operator|>
literal|255
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"pixel values must be between 0 and 255"
argument_list|)
expr_stmt|;
goto|goto
name|out
goto|;
block|}
name|pixel
index|[
name|i
index|]
operator|=
name|val
expr_stmt|;
block|}
block|}
else|else
block|{
name|is_string
operator|=
name|TRUE
expr_stmt|;
name|num_channels
operator|=
name|PyString_Size
argument_list|(
name|seq
argument_list|)
expr_stmt|;
name|pixel
operator|=
operator|(
name|guint8
operator|*
operator|)
name|PyString_AsString
argument_list|(
name|seq
argument_list|)
expr_stmt|;
block|}
name|error
operator|=
operator|!
name|gimp_drawable_set_pixel
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|num_channels
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set %d-element pixel (%d, %d) on "
literal|"drawable (ID %d)"
argument_list|,
name|num_channels
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|out
label|:
if|if
condition|(
operator|!
name|is_string
condition|)
name|g_free
argument_list|(
name|pixel
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
else|else
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_mask_intersect (PyGimpDrawable * self)
name|drw_mask_intersect
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|width
decl_stmt|,
name|height
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_drawable_mask_intersect
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not get selection bounds of drawable (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|Py_BuildValue
argument_list|(
literal|"(iiii)"
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|transform_result (PyGimpDrawable * self,gint32 id,const char * err_desc)
name|transform_result
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|gint32
name|id
parameter_list|,
specifier|const
name|char
modifier|*
name|err_desc
parameter_list|)
block|{
if|if
condition|(
name|id
operator|==
name|self
operator|->
name|ID
condition|)
block|{
name|Py_INCREF
argument_list|(
name|self
argument_list|)
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|self
return|;
block|}
elseif|else
if|if
condition|(
name|id
operator|!=
operator|-
literal|1
condition|)
block|{
return|return
name|pygimp_drawable_new
argument_list|(
name|NULL
argument_list|,
name|id
argument_list|)
return|;
block|}
else|else
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not %s drawable (ID %d)"
argument_list|,
name|err_desc
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_flip (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_flip
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
name|int
name|transform_direction
decl_stmt|,
name|interpolation
decl_stmt|,
name|recursion_level
init|=
literal|3
decl_stmt|;
name|gboolean
name|supersample
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"y0"
block|,
literal|"x1"
block|,
literal|"y1"
block|,
literal|"transform_direction"
block|,
literal|"interpolation"
block|,
literal|"supersample"
block|,
literal|"recursion_level"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ddddii|iii:transform_flip"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|transform_direction
argument_list|,
operator|&
name|interpolation
argument_list|,
operator|&
name|supersample
argument_list|,
operator|&
name|recursion_level
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_direction
argument_list|(
name|transform_direction
argument_list|)
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_flip
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"flip"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_flip_simple (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_flip_simple
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|flip_type
decl_stmt|;
name|gboolean
name|auto_center
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|double
name|axis
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"flip_type"
block|,
literal|"auto_center"
block|,
literal|"axis"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"iid|i:transform_flip_simple"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|flip_type
argument_list|,
operator|&
name|auto_center
argument_list|,
operator|&
name|axis
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_flip_simple
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|flip_type
argument_list|,
name|auto_center
argument_list|,
name|axis
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"flip"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_flip_default (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_flip_default
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
name|gboolean
name|interpolate
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"y0"
block|,
literal|"x1"
block|,
literal|"y1"
block|,
literal|"interpolate"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"dddd|ii:transform_flip_default"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|interpolate
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|interpolate
condition|)
name|gimp_context_set_interpolation
argument_list|(
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_flip
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"flip"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_perspective (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_perspective
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|,
name|x3
decl_stmt|,
name|y3
decl_stmt|;
name|int
name|transform_direction
decl_stmt|,
name|interpolation
decl_stmt|,
name|recursion_level
init|=
literal|3
decl_stmt|;
name|gboolean
name|supersample
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"y0"
block|,
literal|"x1"
block|,
literal|"y1"
block|,
literal|"x2"
block|,
literal|"y2"
block|,
literal|"x3"
block|,
literal|"y3"
block|,
literal|"transform_direction"
block|,
literal|"interpolation"
block|,
literal|"supersample"
block|,
literal|"recursion_level"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ddddddddii|iii:transform_perspective"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
operator|&
name|x3
argument_list|,
operator|&
name|y3
argument_list|,
operator|&
name|transform_direction
argument_list|,
operator|&
name|interpolation
argument_list|,
operator|&
name|supersample
argument_list|,
operator|&
name|recursion_level
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_direction
argument_list|(
name|transform_direction
argument_list|)
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_perspective
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|,
name|x3
argument_list|,
name|y3
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"apply perspective transform to"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_perspective_default (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_perspective_default
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|,
name|x3
decl_stmt|,
name|y3
decl_stmt|;
name|gboolean
name|interpolate
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"y0"
block|,
literal|"x1"
block|,
literal|"y1"
block|,
literal|"x2"
block|,
literal|"y2"
block|,
literal|"x3"
block|,
literal|"y3"
block|,
literal|"interpolate"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"dddddddd|ii:transform_perspective_default"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
operator|&
name|x3
argument_list|,
operator|&
name|y3
argument_list|,
operator|&
name|interpolate
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|interpolate
condition|)
name|gimp_context_set_interpolation
argument_list|(
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_perspective
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|,
name|x3
argument_list|,
name|y3
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"apply perspective transform to"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_rotate (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_rotate
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|angle
decl_stmt|;
name|gboolean
name|auto_center
decl_stmt|,
name|supersample
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|int
name|center_x
decl_stmt|,
name|center_y
decl_stmt|,
name|transform_direction
decl_stmt|,
name|interpolation
decl_stmt|,
name|recursion_level
init|=
literal|3
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"angle"
block|,
literal|"auto_center"
block|,
literal|"center_x"
block|,
literal|"center_y"
block|,
literal|"transform_direction"
block|,
literal|"interpolation"
block|,
literal|"supersample"
block|,
literal|"recursion_level"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"diiiii|iii:transform_rotate"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|angle
argument_list|,
operator|&
name|auto_center
argument_list|,
operator|&
name|center_x
argument_list|,
operator|&
name|center_y
argument_list|,
operator|&
name|transform_direction
argument_list|,
operator|&
name|interpolation
argument_list|,
operator|&
name|supersample
argument_list|,
operator|&
name|recursion_level
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_direction
argument_list|(
name|transform_direction
argument_list|)
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_rotate
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|angle
argument_list|,
name|auto_center
argument_list|,
name|center_x
argument_list|,
name|center_y
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"rotate"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_rotate_simple (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_rotate_simple
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|rotate_type
decl_stmt|,
name|center_x
decl_stmt|,
name|center_y
decl_stmt|;
name|gboolean
name|auto_center
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"rotate_type"
block|,
literal|"auto_center"
block|,
literal|"center_x"
block|,
literal|"center_y"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"iiii|i:transform_rotate_simple"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|rotate_type
argument_list|,
operator|&
name|auto_center
argument_list|,
operator|&
name|center_x
argument_list|,
operator|&
name|center_y
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_rotate_simple
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|rotate_type
argument_list|,
name|auto_center
argument_list|,
name|center_x
argument_list|,
name|center_y
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"rotate"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_rotate_default (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_rotate_default
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|angle
decl_stmt|;
name|gboolean
name|auto_center
decl_stmt|,
name|interpolate
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|int
name|center_x
decl_stmt|,
name|center_y
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"angle"
block|,
literal|"auto_center"
block|,
literal|"center_x"
block|,
literal|"center_y"
block|,
literal|"interpolate"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"dddd|ii:transform_rotate_default"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|angle
argument_list|,
operator|&
name|auto_center
argument_list|,
operator|&
name|center_x
argument_list|,
operator|&
name|center_y
argument_list|,
operator|&
name|interpolate
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|interpolate
condition|)
name|gimp_context_set_interpolation
argument_list|(
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_rotate
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|angle
argument_list|,
name|auto_center
argument_list|,
name|center_x
argument_list|,
name|center_y
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"rotate"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_scale (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_scale
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
name|int
name|transform_direction
decl_stmt|,
name|interpolation
decl_stmt|,
name|recursion_level
init|=
literal|3
decl_stmt|;
name|gboolean
name|supersample
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"y0"
block|,
literal|"x1"
block|,
literal|"y1"
block|,
literal|"transform_direction"
block|,
literal|"interpolation"
block|,
literal|"supersample"
block|,
literal|"recursion_level"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ddddii|iii:transform_scale"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|transform_direction
argument_list|,
operator|&
name|interpolation
argument_list|,
operator|&
name|supersample
argument_list|,
operator|&
name|recursion_level
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_direction
argument_list|(
name|transform_direction
argument_list|)
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_scale
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"scale"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_scale_default (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_scale_default
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
name|gboolean
name|interpolate
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"x0"
block|,
literal|"y0"
block|,
literal|"x1"
block|,
literal|"y1"
block|,
literal|"interpolate"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"dddd|ii:transform_scale_default"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|interpolate
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|interpolate
condition|)
name|gimp_context_set_interpolation
argument_list|(
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_scale
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"scale"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_shear (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_shear
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|shear_type
decl_stmt|,
name|transform_direction
decl_stmt|,
name|interpolation
decl_stmt|,
name|recursion_level
init|=
literal|3
decl_stmt|;
name|double
name|magnitude
decl_stmt|;
name|gboolean
name|supersample
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"shear_type"
block|,
literal|"magnitude"
block|,
literal|"transform_direction"
block|,
literal|"interpolation"
block|,
literal|"supersample"
block|,
literal|"recursion_level"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"idii|iii:transform_shear"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|shear_type
argument_list|,
operator|&
name|magnitude
argument_list|,
operator|&
name|transform_direction
argument_list|,
operator|&
name|interpolation
argument_list|,
operator|&
name|supersample
argument_list|,
operator|&
name|recursion_level
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_direction
argument_list|(
name|transform_direction
argument_list|)
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_shear
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|shear_type
argument_list|,
name|magnitude
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"shear"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_shear_default (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_shear_default
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|shear_type
decl_stmt|;
name|double
name|magnitude
decl_stmt|;
name|gboolean
name|interpolate
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"shear_type"
block|,
literal|"magnitude"
block|,
literal|"interpolate"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"id|ii:transform_shear_default"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|shear_type
argument_list|,
operator|&
name|magnitude
argument_list|,
operator|&
name|interpolate
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|interpolate
condition|)
name|gimp_context_set_interpolation
argument_list|(
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_shear
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|shear_type
argument_list|,
name|magnitude
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"shear"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_2d (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_2d
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|source_x
decl_stmt|,
name|source_y
decl_stmt|,
name|scale_x
decl_stmt|,
name|scale_y
decl_stmt|,
name|angle
decl_stmt|,
name|dest_x
decl_stmt|,
name|dest_y
decl_stmt|;
name|int
name|transform_direction
decl_stmt|,
name|interpolation
decl_stmt|,
name|recursion_level
init|=
literal|3
decl_stmt|;
name|gboolean
name|supersample
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"source_x"
block|,
literal|"source_y"
block|,
literal|"scale_x"
block|,
literal|"scale_y"
block|,
literal|"angle"
block|,
literal|"dest_x"
block|,
literal|"dest_y"
block|,
literal|"transform_direction"
block|,
literal|"interpolation"
block|,
literal|"supersample"
block|,
literal|"recursion_level"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"dddddddii|iii:transform_2d"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|source_x
argument_list|,
operator|&
name|source_y
argument_list|,
operator|&
name|scale_x
argument_list|,
operator|&
name|scale_y
argument_list|,
operator|&
name|angle
argument_list|,
operator|&
name|dest_x
argument_list|,
operator|&
name|dest_y
argument_list|,
operator|&
name|transform_direction
argument_list|,
operator|&
name|interpolation
argument_list|,
operator|&
name|supersample
argument_list|,
operator|&
name|recursion_level
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_direction
argument_list|(
name|transform_direction
argument_list|)
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_2d
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|source_x
argument_list|,
name|source_y
argument_list|,
name|scale_x
argument_list|,
name|scale_y
argument_list|,
name|angle
argument_list|,
name|dest_x
argument_list|,
name|dest_y
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"apply 2d transform to"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_2d_default (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_2d_default
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|source_x
decl_stmt|,
name|source_y
decl_stmt|,
name|scale_x
decl_stmt|,
name|scale_y
decl_stmt|,
name|angle
decl_stmt|,
name|dest_x
decl_stmt|,
name|dest_y
decl_stmt|;
name|gboolean
name|interpolate
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"source_x"
block|,
literal|"source_y"
block|,
literal|"scale_x"
block|,
literal|"scale_y"
block|,
literal|"angle"
block|,
literal|"dest_x"
block|,
literal|"dest_y"
block|,
literal|"interpolate"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ddddddd|ii:transform_2d_default"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|source_x
argument_list|,
operator|&
name|source_y
argument_list|,
operator|&
name|scale_x
argument_list|,
operator|&
name|scale_y
argument_list|,
operator|&
name|angle
argument_list|,
operator|&
name|dest_x
argument_list|,
operator|&
name|dest_y
argument_list|,
operator|&
name|interpolate
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|interpolate
condition|)
name|gimp_context_set_interpolation
argument_list|(
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_2d
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|source_x
argument_list|,
name|source_y
argument_list|,
name|scale_x
argument_list|,
name|scale_y
argument_list|,
name|angle
argument_list|,
name|dest_x
argument_list|,
name|dest_y
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"apply 2d transform to"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_matrix (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_matrix
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|coeff_0_0
decl_stmt|,
name|coeff_0_1
decl_stmt|,
name|coeff_0_2
decl_stmt|,
name|coeff_1_0
decl_stmt|,
name|coeff_1_1
decl_stmt|,
name|coeff_1_2
decl_stmt|,
name|coeff_2_0
decl_stmt|,
name|coeff_2_1
decl_stmt|,
name|coeff_2_2
decl_stmt|;
name|int
name|transform_direction
decl_stmt|,
name|interpolation
decl_stmt|,
name|recursion_level
init|=
literal|3
decl_stmt|;
name|gboolean
name|supersample
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"coeff_0_0"
block|,
literal|"coeff_0_1"
block|,
literal|"coeff_0_2"
block|,
literal|"coeff_1_0"
block|,
literal|"coeff_1_1"
block|,
literal|"coeff_1_2"
block|,
literal|"coeff_2_0"
block|,
literal|"coeff_2_1"
block|,
literal|"coeff_2_2"
block|,
literal|"transform_direction"
block|,
literal|"interpolation"
block|,
literal|"supersample"
block|,
literal|"recursion_level"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"dddddddddii|iii:transform_matrix"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|coeff_0_0
argument_list|,
operator|&
name|coeff_0_1
argument_list|,
operator|&
name|coeff_0_2
argument_list|,
operator|&
name|coeff_1_0
argument_list|,
operator|&
name|coeff_1_1
argument_list|,
operator|&
name|coeff_1_2
argument_list|,
operator|&
name|coeff_2_0
argument_list|,
operator|&
name|coeff_2_1
argument_list|,
operator|&
name|coeff_2_2
argument_list|,
operator|&
name|transform_direction
argument_list|,
operator|&
name|interpolation
argument_list|,
operator|&
name|supersample
argument_list|,
operator|&
name|recursion_level
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_transform_direction
argument_list|(
name|transform_direction
argument_list|)
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_matrix
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|coeff_0_0
argument_list|,
name|coeff_0_1
argument_list|,
name|coeff_0_2
argument_list|,
name|coeff_1_0
argument_list|,
name|coeff_1_1
argument_list|,
name|coeff_1_2
argument_list|,
name|coeff_2_0
argument_list|,
name|coeff_2_1
argument_list|,
name|coeff_2_2
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"apply 2d matrix transform to"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_transform_matrix_default (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_transform_matrix_default
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|double
name|coeff_0_0
decl_stmt|,
name|coeff_0_1
decl_stmt|,
name|coeff_0_2
decl_stmt|,
name|coeff_1_0
decl_stmt|,
name|coeff_1_1
decl_stmt|,
name|coeff_1_2
decl_stmt|,
name|coeff_2_0
decl_stmt|,
name|coeff_2_1
decl_stmt|,
name|coeff_2_2
decl_stmt|;
name|gboolean
name|interpolate
init|=
name|FALSE
decl_stmt|,
name|clip_result
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"coeff_0_0"
block|,
literal|"coeff_0_1"
block|,
literal|"coeff_0_2"
block|,
literal|"coeff_1_0"
block|,
literal|"coeff_1_1"
block|,
literal|"coeff_1_2"
block|,
literal|"coeff_2_0"
block|,
literal|"coeff_2_1"
block|,
literal|"coeff_2_2"
block|,
literal|"interpolate"
block|,
literal|"clip_result"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ddddddddd|ii:transform_matrix_default"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|coeff_0_0
argument_list|,
operator|&
name|coeff_0_1
argument_list|,
operator|&
name|coeff_0_2
argument_list|,
operator|&
name|coeff_1_0
argument_list|,
operator|&
name|coeff_1_1
argument_list|,
operator|&
name|coeff_1_2
argument_list|,
operator|&
name|coeff_2_0
argument_list|,
operator|&
name|coeff_2_1
argument_list|,
operator|&
name|coeff_2_2
argument_list|,
operator|&
name|interpolate
argument_list|,
operator|&
name|clip_result
argument_list|)
condition|)
return|return
name|NULL
return|;
name|gimp_context_push
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|interpolate
condition|)
name|gimp_context_set_interpolation
argument_list|(
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|gimp_context_set_transform_resize
argument_list|(
name|clip_result
argument_list|)
expr_stmt|;
name|id
operator|=
name|gimp_item_transform_matrix
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|coeff_0_0
argument_list|,
name|coeff_0_1
argument_list|,
name|coeff_0_2
argument_list|,
name|coeff_1_0
argument_list|,
name|coeff_1_1
argument_list|,
name|coeff_1_2
argument_list|,
name|coeff_2_0
argument_list|,
name|coeff_2_1
argument_list|,
name|coeff_2_2
argument_list|)
expr_stmt|;
name|gimp_context_pop
argument_list|()
expr_stmt|;
return|return
name|transform_result
argument_list|(
name|self
argument_list|,
name|id
argument_list|,
literal|"apply 2d matrix transform to"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_data (PyGimpDrawable * self,PyObject * args,PyObject * kwargs)
name|drw_get_data
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"format"
block|,
name|NULL
block|}
decl_stmt|;
name|gchar
modifier|*
name|format
init|=
literal|"RGBA float"
decl_stmt|;
specifier|const
name|Babl
modifier|*
name|bbl_format
decl_stmt|;
name|void
modifier|*
name|output_buffer
decl_stmt|;
name|GeglBuffer
modifier|*
name|buffer
decl_stmt|;
name|int
name|bpp
decl_stmt|;
name|Py_ssize_t
name|size
decl_stmt|;
name|PyObject
modifier|*
name|buffer_data
decl_stmt|,
modifier|*
name|ret
decl_stmt|;
name|PyObject
modifier|*
name|array_module
decl_stmt|;
name|PyObject
modifier|*
name|array_type
decl_stmt|;
name|char
name|array_data_type
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|s:get_data"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|format
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|g_str_has_suffix
argument_list|(
name|format
argument_list|,
literal|"double"
argument_list|)
condition|)
block|{
name|array_data_type
operator|=
literal|'d'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|g_str_has_suffix
argument_list|(
name|format
argument_list|,
literal|"float"
argument_list|)
condition|)
block|{
name|array_data_type
operator|=
literal|'f'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|g_str_has_suffix
argument_list|(
name|format
argument_list|,
literal|"u16"
argument_list|)
condition|)
block|{
name|array_data_type
operator|=
literal|'H'
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|g_str_has_suffix
argument_list|(
name|format
argument_list|,
literal|"u8"
argument_list|)
condition|)
block|{
name|array_data_type
operator|=
literal|'B'
expr_stmt|;
block|}
else|else
block|{
name|PyErr_Warn
argument_list|(
name|PyExc_Warning
argument_list|,
literal|"Could not find apropriate data format - returning raw bytes"
argument_list|)
expr_stmt|;
name|array_data_type
operator|=
literal|'B'
expr_stmt|;
block|}
name|bbl_format
operator|=
name|babl_format
argument_list|(
name|format
argument_list|)
expr_stmt|;
name|bpp
operator|=
name|babl_format_get_bytes_per_pixel
argument_list|(
name|bbl_format
argument_list|)
expr_stmt|;
name|ensure_drawable
argument_list|(
name|self
argument_list|)
expr_stmt|;
name|buffer
operator|=
name|gimp_drawable_get_buffer
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|size
operator|=
name|bpp
operator|*
name|self
operator|->
name|drawable
operator|->
name|width
operator|*
name|self
operator|->
name|drawable
operator|->
name|height
expr_stmt|;
name|output_buffer
operator|=
name|g_malloc
argument_list|(
operator|(
name|gsize
operator|)
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|output_buffer
operator|==
name|NULL
condition|)
block|{
return|return
name|PyErr_NoMemory
argument_list|()
return|;
block|}
name|gegl_buffer_get
argument_list|(
name|buffer
argument_list|,
name|GEGL_RECTANGLE
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|self
operator|->
name|drawable
operator|->
name|width
argument_list|,
name|self
operator|->
name|drawable
operator|->
name|height
argument_list|)
argument_list|,
literal|1.0
argument_list|,
name|bbl_format
argument_list|,
name|output_buffer
argument_list|,
name|GEGL_AUTO_ROWSTRIDE
argument_list|,
name|GEGL_ABYSS_NONE
argument_list|)
expr_stmt|;
name|buffer_data
operator|=
name|PyString_FromStringAndSize
argument_list|(
name|output_buffer
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|array_module
operator|=
name|PyImport_ImportModule
argument_list|(
literal|"array"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|array_module
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not import array module"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|array_type
operator|=
name|PyObject_GetAttrString
argument_list|(
name|array_module
argument_list|,
literal|"array"
argument_list|)
expr_stmt|;
name|Py_DECREF
argument_list|(
name|array_module
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|array_type
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not get array.array type"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|ret
operator|=
name|PyObject_CallFunction
argument_list|(
name|array_type
argument_list|,
literal|"cO"
argument_list|,
name|array_data_type
argument_list|,
name|buffer_data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ret
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create array object"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_DECREF
argument_list|(
name|buffer_data
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|output_buffer
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/* for inclusion with the methods of layer and channel objects */
end_comment

begin_decl_stmt
DECL|variable|drw_methods
specifier|static
name|PyMethodDef
name|drw_methods
index|[]
init|=
block|{
block|{
literal|"flush"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_flush
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"update"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_update
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"merge_shadow"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_merge_shadow
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"free_shadow"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_free_shadow
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"fill"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_fill
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"get_tile"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_tile
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"get_tile2"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_tile2
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"get_pixel_rgn"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_pixel_rgn
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"get_data"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_data
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|,
literal|"Takes a BABL format string, returns a Python array.array object"
block|}
block|,
block|{
literal|"offset"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_offset
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"parasite_find"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_parasite_find
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_attach"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_parasite_attach
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"attach_new_parasite"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_attach_new_parasite
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"parasite_detach"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_parasite_detach
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"parasite_list"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_parasite_list
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"get_pixel"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_get_pixel
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"set_pixel"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_set_pixel
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"mask_intersect"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_mask_intersect
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"transform_flip"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_flip
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_flip_simple"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_flip_simple
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_flip_default"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_flip_default
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_perspective"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_perspective
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_perspective_default"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_perspective_default
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_rotate"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_rotate
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_rotate_simple"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_rotate_simple
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_rotate_default"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_rotate_default
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_scale"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_scale
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_scale_default"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_scale_default
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_shear"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_shear
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_shear_default"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_shear_default
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_2d"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_2d
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_2d_default"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_2d_default
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_matrix"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_matrix
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"transform_matrix_default"
block|,
operator|(
name|PyCFunction
operator|)
name|drw_transform_matrix_default
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_ID (PyGimpDrawable * self,void * closure)
name|drw_get_ID
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|self
operator|->
name|ID
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_name (PyGimpDrawable * self,void * closure)
name|drw_get_name
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyString_FromString
argument_list|(
name|gimp_item_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|drw_set_name (PyGimpDrawable * self,PyObject * value,void * closure)
name|drw_set_name
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete name"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyString_Check
argument_list|(
name|value
argument_list|)
operator|&&
operator|!
name|PyUnicode_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_item_set_name
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyString_AsString
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_bpp (PyGimpDrawable * self,void * closure)
name|drw_get_bpp
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_bpp
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_has_alpha (PyGimpDrawable * self,void * closure)
name|drw_get_has_alpha
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_drawable_has_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_height (PyGimpDrawable * self,void * closure)
name|drw_get_height
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_height
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_image (PyGimpDrawable * self,void * closure)
name|drw_get_image
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|pygimp_image_new
argument_list|(
name|gimp_item_get_image
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_is_rgb (PyGimpDrawable * self,void * closure)
name|drw_get_is_rgb
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_drawable_is_rgb
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_is_gray (PyGimpDrawable * self,void * closure)
name|drw_get_is_gray
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_drawable_is_gray
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_is_indexed (PyGimpDrawable * self,void * closure)
name|drw_get_is_indexed
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_drawable_is_indexed
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_is_layer_mask (PyGimpDrawable * self,void * closure)
name|drw_get_is_layer_mask
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_item_is_layer_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_mask_bounds (PyGimpDrawable * self,void * closure)
name|drw_get_mask_bounds
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
name|gint
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(iiii)"
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_mask_intersect (PyGimpDrawable * self,void * closure)
name|drw_get_mask_intersect
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_drawable_mask_intersect
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|w
argument_list|,
operator|&
name|h
argument_list|)
condition|)
return|return
name|Py_BuildValue
argument_list|(
literal|""
argument_list|)
return|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(iiii)"
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_offsets (PyGimpDrawable * self,void * closure)
name|drw_get_offsets
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gimp_drawable_offsets
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
return|return
name|Py_BuildValue
argument_list|(
literal|"(ii)"
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_type (PyGimpDrawable * self,void * closure)
name|drw_get_type
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_type
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_type_with_alpha (PyGimpDrawable * self,void * closure)
name|drw_get_type_with_alpha
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_type_with_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_width (PyGimpDrawable * self,void * closure)
name|drw_get_width
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_drawable_width
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_linked (PyGimpDrawable * self,void * closure)
name|drw_get_linked
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_item_get_linked
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|drw_set_linked (PyGimpDrawable * self,PyObject * value,void * closure)
name|drw_set_linked
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete linked"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_item_set_linked
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_tattoo (PyGimpDrawable * self,void * closure)
name|drw_get_tattoo
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_item_get_tattoo
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|drw_set_tattoo (PyGimpDrawable * self,PyObject * value,void * closure)
name|drw_set_tattoo
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete tattoo"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_item_set_tattoo
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_get_visible (PyGimpDrawable * self,void * closure)
name|drw_get_visible
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_item_get_visible
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|drw_set_visible (PyGimpDrawable * self,PyObject * value,void * closure)
name|drw_set_visible
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete visible"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_item_set_visible
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|drw_getsets
specifier|static
name|PyGetSetDef
name|drw_getsets
index|[]
init|=
block|{
block|{
literal|"ID"
block|,
operator|(
name|getter
operator|)
name|drw_get_ID
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"name"
block|,
operator|(
name|getter
operator|)
name|drw_get_name
block|,
operator|(
name|setter
operator|)
name|drw_set_name
block|}
block|,
block|{
literal|"bpp"
block|,
operator|(
name|getter
operator|)
name|drw_get_bpp
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"has_alpha"
block|,
operator|(
name|getter
operator|)
name|drw_get_has_alpha
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"height"
block|,
operator|(
name|getter
operator|)
name|drw_get_height
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"image"
block|,
operator|(
name|getter
operator|)
name|drw_get_image
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"is_rgb"
block|,
operator|(
name|getter
operator|)
name|drw_get_is_rgb
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"is_gray"
block|,
operator|(
name|getter
operator|)
name|drw_get_is_gray
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"is_grey"
block|,
operator|(
name|getter
operator|)
name|drw_get_is_gray
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"is_indexed"
block|,
operator|(
name|getter
operator|)
name|drw_get_is_indexed
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"is_layer_mask"
block|,
operator|(
name|getter
operator|)
name|drw_get_is_layer_mask
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"mask_bounds"
block|,
operator|(
name|getter
operator|)
name|drw_get_mask_bounds
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"mask_intersect"
block|,
operator|(
name|getter
operator|)
name|drw_get_mask_intersect
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"offsets"
block|,
operator|(
name|getter
operator|)
name|drw_get_offsets
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"type"
block|,
operator|(
name|getter
operator|)
name|drw_get_type
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"type_with_alpha"
block|,
operator|(
name|getter
operator|)
name|drw_get_type_with_alpha
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"width"
block|,
operator|(
name|getter
operator|)
name|drw_get_width
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"linked"
block|,
operator|(
name|getter
operator|)
name|drw_get_linked
block|,
operator|(
name|setter
operator|)
name|drw_set_linked
block|}
block|,
block|{
literal|"tattoo"
block|,
operator|(
name|getter
operator|)
name|drw_get_tattoo
block|,
operator|(
name|setter
operator|)
name|drw_set_tattoo
block|}
block|,
block|{
literal|"visible"
block|,
operator|(
name|getter
operator|)
name|drw_get_visible
block|,
operator|(
name|setter
operator|)
name|drw_set_visible
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|drw_dealloc (PyGimpDrawable * self)
name|drw_dealloc
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
if|if
condition|(
name|self
operator|->
name|drawable
condition|)
name|gimp_drawable_detach
argument_list|(
name|self
operator|->
name|drawable
argument_list|)
expr_stmt|;
name|PyObject_DEL
argument_list|(
name|self
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|drw_repr (PyGimpDrawable * self)
name|drw_repr
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|)
block|{
name|PyObject
modifier|*
name|s
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gimp_item_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|s
operator|=
name|PyString_FromFormat
argument_list|(
literal|"<gimp.Drawable '%s'>"
argument_list|,
name|name
condition|?
name|name
else|:
literal|"(null)"
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|drw_cmp (PyGimpDrawable * self,PyGimpDrawable * other)
name|drw_cmp
parameter_list|(
name|PyGimpDrawable
modifier|*
name|self
parameter_list|,
name|PyGimpDrawable
modifier|*
name|other
parameter_list|)
block|{
if|if
condition|(
name|self
operator|->
name|ID
operator|==
name|other
operator|->
name|ID
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|self
operator|->
name|ID
operator|>
name|other
operator|->
name|ID
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|1
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpDrawable_Type
name|PyTypeObject
name|PyGimpDrawable_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimp.Drawable"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGimpDrawable
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
name|drw_dealloc
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
name|drw_cmp
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|drw_repr
block|,
comment|/* tp_repr */
literal|0
block|,
comment|/* tp_as_number */
literal|0
block|,
comment|/* tp_as_sequence */
literal|0
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
literal|0
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
literal|0
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
literal|0
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|drw_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|drw_getsets
block|,
comment|/* tp_getset */
operator|&
name|PyGimpItem_Type
block|,
comment|/* tp_base */
operator|(
name|PyObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_dict */
literal|0
block|,
comment|/* tp_descr_get */
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
literal|0
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_drawable_new (GimpDrawable * drawable,gint32 ID)
name|pygimp_drawable_new
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|gint32
name|ID
parameter_list|)
block|{
name|PyObject
modifier|*
name|self
decl_stmt|;
if|if
condition|(
name|drawable
operator|!=
name|NULL
condition|)
name|ID
operator|=
name|drawable
operator|->
name|drawable_id
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_item_is_valid
argument_list|(
name|ID
argument_list|)
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
comment|/* create the appropriate object type */
if|if
condition|(
name|gimp_item_is_layer
argument_list|(
name|ID
argument_list|)
condition|)
name|self
operator|=
name|pygimp_layer_new
argument_list|(
name|ID
argument_list|)
expr_stmt|;
else|else
name|self
operator|=
name|pygimp_channel_new
argument_list|(
name|ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|self
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|PyObject_TypeCheck
argument_list|(
name|self
argument_list|,
operator|&
name|PyGimpDrawable_Type
argument_list|)
condition|)
operator|(
operator|(
name|PyGimpDrawable
operator|*
operator|)
name|self
operator|)
operator|->
name|drawable
operator|=
name|drawable
expr_stmt|;
return|return
name|self
return|;
block|}
end_function

begin_comment
comment|/* End of code for Drawable objects */
end_comment

begin_comment
comment|/* -------------------------------------------------------- */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_copy (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|lay_copy
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|nreturn_vals
decl_stmt|;
name|GimpParam
modifier|*
name|return_vals
decl_stmt|;
name|gboolean
name|add_alpha
init|=
name|FALSE
decl_stmt|;
name|gint32
name|id
init|=
operator|-
literal|1
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"add_alpha"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"|i:copy"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|add_alpha
argument_list|)
condition|)
return|return
name|NULL
return|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"gimp-layer-copy"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|GIMP_PDB_LAYER
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|GIMP_PDB_INT32
argument_list|,
name|add_alpha
argument_list|,
name|GIMP_PDB_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
name|id
operator|=
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_layer
expr_stmt|;
else|else
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create new layer copy from layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
return|return
name|id
operator|!=
operator|-
literal|1
condition|?
name|pygimp_layer_new
argument_list|(
name|id
argument_list|)
else|:
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_add_alpha (PyGimpLayer * self)
name|lay_add_alpha
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|)
block|{
if|if
condition|(
operator|!
name|gimp_layer_add_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not add alpha to layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_add_mask (PyGimpLayer * self,PyObject * args)
name|lay_add_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|PyGimpChannel
modifier|*
name|mask
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!:add_mask"
argument_list|,
operator|&
name|PyGimpChannel_Type
argument_list|,
operator|&
name|mask
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_layer_add_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|mask
operator|->
name|ID
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not add mask (ID %d) to layer (ID %d)"
argument_list|,
name|mask
operator|->
name|ID
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_create_mask (PyGimpLayer * self,PyObject * args)
name|lay_create_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|type
decl_stmt|;
name|gint32
name|id
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:create_mask"
argument_list|,
operator|&
name|type
argument_list|)
condition|)
return|return
name|NULL
return|;
name|id
operator|=
name|gimp_layer_create_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|type
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create mask of type %d on layer (ID %d)"
argument_list|,
name|type
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|pygimp_channel_new
argument_list|(
name|id
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_remove_mask (PyGimpLayer * self,PyObject * args)
name|lay_remove_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|)
block|{
name|int
name|mode
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"i:remove_mask"
argument_list|,
operator|&
name|mode
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_layer_remove_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|mode
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not remove mask from layer (ID %d) with mode %d"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|mode
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_resize (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|lay_resize
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|unsigned
name|int
name|new_h
decl_stmt|,
name|new_w
decl_stmt|;
name|int
name|offs_x
init|=
literal|0
decl_stmt|,
name|offs_y
init|=
literal|0
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"width"
block|,
literal|"height"
block|,
literal|"offset_x"
block|,
literal|"offset_y"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ii|ii:resize"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|new_w
argument_list|,
operator|&
name|new_h
argument_list|,
operator|&
name|offs_x
argument_list|,
operator|&
name|offs_y
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_layer_resize
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|new_w
argument_list|,
name|new_h
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not resize layer (ID %d) to size %dx%d "
literal|"(offset %d, %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|new_w
argument_list|,
name|new_h
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_resize_to_image_size (PyGimpLayer * self)
name|lay_resize_to_image_size
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|)
block|{
if|if
condition|(
operator|!
name|gimp_layer_resize_to_image_size
argument_list|(
name|self
operator|->
name|ID
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not resize layer (ID %d) to image size"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_scale (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|lay_scale
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|new_width
decl_stmt|,
name|new_height
decl_stmt|;
name|int
name|interpolation
init|=
operator|-
literal|1
decl_stmt|;
name|gboolean
name|local_origin
init|=
name|FALSE
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"width"
block|,
literal|"height"
block|,
literal|"local_origin"
block|,
literal|"interpolation"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ii|ii:scale"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|new_width
argument_list|,
operator|&
name|new_height
argument_list|,
operator|&
name|local_origin
argument_list|,
operator|&
name|interpolation
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|interpolation
operator|!=
operator|-
literal|1
condition|)
block|{
name|gimp_context_push
argument_list|()
expr_stmt|;
name|gimp_context_set_interpolation
argument_list|(
name|interpolation
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|gimp_layer_scale
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|new_width
argument_list|,
name|new_height
argument_list|,
name|local_origin
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not scale layer (ID %d) to size %dx%d"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|new_width
argument_list|,
name|new_height
argument_list|)
expr_stmt|;
if|if
condition|(
name|interpolation
operator|!=
operator|-
literal|1
condition|)
block|{
name|gimp_context_pop
argument_list|()
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|interpolation
operator|!=
operator|-
literal|1
condition|)
block|{
name|gimp_context_pop
argument_list|()
expr_stmt|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_translate (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|lay_translate
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|offs_x
decl_stmt|,
name|offs_y
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"offset_x"
block|,
literal|"offset_y"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ii:translate"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|offs_x
argument_list|,
operator|&
name|offs_y
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_layer_translate
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not translate layer (ID %d) to offset %d, %d"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_set_offsets (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|lay_set_offsets
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|int
name|offs_x
decl_stmt|,
name|offs_y
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"offset_x"
block|,
literal|"offset_y"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"ii:set_offsets"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|offs_x
argument_list|,
operator|&
name|offs_y
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_layer_set_offsets
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set offset %d, %d on layer (ID %d)"
argument_list|,
name|offs_x
argument_list|,
name|offs_y
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|lay_methods
specifier|static
name|PyMethodDef
name|lay_methods
index|[]
init|=
block|{
block|{
literal|"copy"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_copy
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"add_alpha"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_add_alpha
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"add_mask"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_add_mask
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"create_mask"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_create_mask
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"remove_mask"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_remove_mask
block|,
name|METH_VARARGS
block|}
block|,
block|{
literal|"resize"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_resize
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"resize_to_image_size"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_resize_to_image_size
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"scale"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_scale
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"translate"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_translate
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
literal|"set_offsets"
block|,
operator|(
name|PyCFunction
operator|)
name|lay_set_offsets
block|,
name|METH_VARARGS
operator||
name|METH_KEYWORDS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
comment|/* sentinel */
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_is_floating_sel (PyGimpLayer * self,void * closure)
name|lay_get_is_floating_sel
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_layer_is_floating_sel
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_mask (PyGimpLayer * self,void * closure)
name|lay_get_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
name|gint32
name|id
init|=
name|gimp_layer_get_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
decl_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
return|return
name|pygimp_channel_new
argument_list|(
name|id
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_apply_mask (PyGimpLayer * self,void * closure)
name|lay_get_apply_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_layer_get_apply_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_set_apply_mask (PyGimpLayer * self,PyObject * value,void * closure)
name|lay_set_apply_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete apply_mask"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_layer_set_apply_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set layer mask on layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_edit_mask (PyGimpLayer * self,void * closure)
name|lay_get_edit_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_layer_get_edit_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_set_edit_mask (PyGimpLayer * self,PyObject * value,void * closure)
name|lay_set_edit_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete edit_mask"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_layer_set_edit_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set layer mask active on layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_mode (PyGimpLayer * self,void * closure)
name|lay_get_mode
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyInt_FromLong
argument_list|(
name|gimp_layer_get_mode
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_set_mode (PyGimpLayer * self,PyObject * value,void * closure)
name|lay_set_mode
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete mode"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_layer_set_mode
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set mode on layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_opacity (PyGimpLayer * self,void * closure)
name|lay_get_opacity
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyFloat_FromDouble
argument_list|(
name|gimp_layer_get_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_set_opacity (PyGimpLayer * self,PyObject * value,void * closure)
name|lay_set_opacity
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete opacity"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyFloat_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_layer_set_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyFloat_AsDouble
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set opacity on layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_lock_alpha (PyGimpLayer * self,void * closure)
name|lay_get_lock_alpha
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_layer_get_lock_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_set_lock_alpha (PyGimpLayer * self,PyObject * value,void * closure)
name|lay_set_lock_alpha
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete lock_alpha"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_layer_set_lock_alpha
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set lock alpha setting on layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_show_mask (PyGimpLayer * self,void * closure)
name|lay_get_show_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_layer_get_show_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_set_show_mask (PyGimpLayer * self,PyObject * value,void * closure)
name|lay_set_show_mask
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete show_mask"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_layer_set_show_mask
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set mask visibility on layer (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_get_preserve_trans (PyGimpLayer * self,void * closure)
name|lay_get_preserve_trans
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|PyErr_Warn
argument_list|(
name|PyExc_DeprecationWarning
argument_list|,
literal|"use lock_alpha attribute"
argument_list|)
operator|<
literal|0
condition|)
return|return
name|NULL
return|;
return|return
name|lay_get_lock_alpha
argument_list|(
name|self
argument_list|,
name|closure
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_set_preserve_trans (PyGimpLayer * self,PyObject * value,void * closure)
name|lay_set_preserve_trans
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|PyErr_Warn
argument_list|(
name|PyExc_DeprecationWarning
argument_list|,
literal|"use lock_alpha attribute"
argument_list|)
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
return|return
name|lay_set_lock_alpha
argument_list|(
name|self
argument_list|,
name|value
argument_list|,
name|closure
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|lay_getsets
specifier|static
name|PyGetSetDef
name|lay_getsets
index|[]
init|=
block|{
block|{
literal|"is_floating_sel"
block|,
operator|(
name|getter
operator|)
name|lay_get_is_floating_sel
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"mask"
block|,
operator|(
name|getter
operator|)
name|lay_get_mask
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
literal|"apply_mask"
block|,
operator|(
name|getter
operator|)
name|lay_get_apply_mask
block|,
operator|(
name|setter
operator|)
name|lay_set_apply_mask
block|}
block|,
block|{
literal|"edit_mask"
block|,
operator|(
name|getter
operator|)
name|lay_get_edit_mask
block|,
operator|(
name|setter
operator|)
name|lay_set_edit_mask
block|}
block|,
block|{
literal|"mode"
block|,
operator|(
name|getter
operator|)
name|lay_get_mode
block|,
operator|(
name|setter
operator|)
name|lay_set_mode
block|}
block|,
block|{
literal|"opacity"
block|,
operator|(
name|getter
operator|)
name|lay_get_opacity
block|,
operator|(
name|setter
operator|)
name|lay_set_opacity
block|}
block|,
block|{
literal|"lock_alpha"
block|,
operator|(
name|getter
operator|)
name|lay_get_lock_alpha
block|,
operator|(
name|setter
operator|)
name|lay_set_lock_alpha
block|}
block|,
block|{
literal|"show_mask"
block|,
operator|(
name|getter
operator|)
name|lay_get_show_mask
block|,
operator|(
name|setter
operator|)
name|lay_set_show_mask
block|}
block|,
block|{
literal|"preserve_trans"
block|,
operator|(
name|getter
operator|)
name|lay_get_preserve_trans
block|,
operator|(
name|setter
operator|)
name|lay_set_preserve_trans
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|lay_repr (PyGimpLayer * self)
name|lay_repr
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|)
block|{
name|PyObject
modifier|*
name|s
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gimp_item_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|s
operator|=
name|PyString_FromFormat
argument_list|(
literal|"<gimp.Layer '%s'>"
argument_list|,
name|name
condition|?
name|name
else|:
literal|"(null)"
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|lay_init (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|lay_init
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyGimpImage
modifier|*
name|img
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|GimpImageType
name|type
init|=
name|GIMP_RGB_IMAGE
decl_stmt|;
name|double
name|opacity
init|=
literal|100.0
decl_stmt|;
name|GimpLayerModeEffects
name|mode
init|=
name|GIMP_NORMAL_MODE
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!sii|idi:gimp.Layer.__init__"
argument_list|,
operator|&
name|PyGimpImage_Type
argument_list|,
operator|&
name|img
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|opacity
argument_list|,
operator|&
name|mode
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|self
operator|->
name|ID
operator|=
name|gimp_layer_new
argument_list|(
name|img
operator|->
name|ID
argument_list|,
name|name
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|type
argument_list|,
name|opacity
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|self
operator|->
name|ID
operator|<
literal|0
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create %dx%d layer '%s' of type %d on "
literal|"image (ID %d)"
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|name
argument_list|,
name|type
argument_list|,
name|img
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpLayer_Type
name|PyTypeObject
name|PyGimpLayer_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimp.Layer"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGimpLayer
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
name|drw_dealloc
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
name|drw_cmp
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|lay_repr
block|,
comment|/* tp_repr */
literal|0
block|,
comment|/* tp_as_number */
literal|0
block|,
comment|/* tp_as_sequence */
literal|0
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
literal|0
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
literal|0
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
literal|0
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|lay_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|lay_getsets
block|,
comment|/* tp_getset */
operator|&
name|PyGimpDrawable_Type
block|,
comment|/* tp_base */
operator|(
name|PyObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_dict */
literal|0
block|,
comment|/* tp_descr_get */
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|lay_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_layer_new (gint32 ID)
name|pygimp_layer_new
parameter_list|(
name|gint32
name|ID
parameter_list|)
block|{
name|PyGimpLayer
modifier|*
name|self
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_item_is_valid
argument_list|(
name|ID
argument_list|)
operator|||
operator|!
name|gimp_item_is_layer
argument_list|(
name|ID
argument_list|)
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
if|if
condition|(
name|gimp_item_is_group
argument_list|(
name|ID
argument_list|)
condition|)
block|{
name|self
operator|=
name|PyObject_NEW
argument_list|(
name|PyGimpGroupLayer
argument_list|,
operator|&
name|PyGimpGroupLayer_Type
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|self
operator|=
name|PyObject_NEW
argument_list|(
name|PyGimpLayer
argument_list|,
operator|&
name|PyGimpLayer_Type
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|self
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|self
operator|->
name|ID
operator|=
name|ID
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|self
return|;
block|}
end_function

begin_comment
comment|/* End of code for Layer objects */
end_comment

begin_comment
comment|/* -------------------------------------------------------- */
end_comment

begin_comment
comment|/* Since this help will primaly be seen from within  * GIMP's Python console, we should make it fit in that  * window's default size.  */
end_comment

begin_define
DECL|macro|GROUPLAYER_DOC
define|#
directive|define
name|GROUPLAYER_DOC
value|""                                \ "gimp.GroupLayer(img, name="", opacity=100.0,   "        \ "mode=gimp.NORMAL_MODE)\n"                               \ "\n"                                                     \ " Creates a new GroupLayer object that has to be \n"     \ "subsequently added to an image. Use Image.add_layer \n" \ "or pdb.gimp_image_insert_layer calls to do that. \n"    \  static PyMethodDef grouplay_methods[] = {
end_define

begin_block
block|{
name|NULL
operator|,
name|NULL
block|}
end_block

begin_comment
comment|/* sentinel */
end_comment

begin_function
unit|};
specifier|static
name|PyObject
modifier|*
DECL|function|grouplay_get_layers (PyGimpGroupLayer * self,void * closure)
name|grouplay_get_layers
parameter_list|(
name|PyGimpGroupLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
name|gint32
modifier|*
name|layers
decl_stmt|;
name|gint
name|n_layers
decl_stmt|,
name|i
decl_stmt|;
name|PyObject
modifier|*
name|ret
decl_stmt|;
name|layers
operator|=
name|gimp_item_get_children
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|n_layers
argument_list|)
expr_stmt|;
name|ret
operator|=
name|PyList_New
argument_list|(
name|n_layers
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_layers
condition|;
name|i
operator|++
control|)
name|PyList_SetItem
argument_list|(
name|ret
argument_list|,
name|i
argument_list|,
name|pygimp_group_layer_new
argument_list|(
name|layers
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|layers
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|grouplay_getsets
specifier|static
name|PyGetSetDef
name|grouplay_getsets
index|[]
init|=
block|{
block|{
literal|"layers"
block|,
operator|(
name|getter
operator|)
name|grouplay_get_layers
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|grouplay_repr (PyGimpLayer * self)
name|grouplay_repr
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|)
block|{
name|PyObject
modifier|*
name|s
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gimp_item_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|s
operator|=
name|PyString_FromFormat
argument_list|(
literal|"<gimp.GroupLayer '%s'>"
argument_list|,
name|name
condition|?
name|name
else|:
literal|"(null)"
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|grouplay_init (PyGimpLayer * self,PyObject * args,PyObject * kwargs)
name|grouplay_init
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyGimpImage
modifier|*
name|img
decl_stmt|;
name|char
modifier|*
name|name
init|=
literal|"Layer Group"
decl_stmt|;
name|GimpImageType
name|type
init|=
name|GIMP_RGB_IMAGE
decl_stmt|;
name|double
name|opacity
init|=
literal|100.0
decl_stmt|;
name|GimpLayerModeEffects
name|mode
init|=
name|GIMP_NORMAL_MODE
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!|sdi:gimp.Layer.__init__"
argument_list|,
operator|&
name|PyGimpImage_Type
argument_list|,
operator|&
name|img
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|opacity
argument_list|,
operator|&
name|mode
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|self
operator|->
name|ID
operator|=
name|gimp_layer_group_new
argument_list|(
name|img
operator|->
name|ID
argument_list|)
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|self
operator|->
name|ID
operator|<
literal|0
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create layer group '%s' of type %d on "
literal|"image (ID %d)"
argument_list|,
name|name
argument_list|,
name|type
argument_list|,
name|img
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_layer_set_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|opacity
argument_list|)
expr_stmt|;
name|gimp_layer_set_mode
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|gimp_item_set_name
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|name
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpGroupLayer_Type
name|PyTypeObject
name|PyGimpGroupLayer_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimp.GroupLayer"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGimpGroupLayer
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
name|drw_dealloc
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
name|drw_cmp
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|grouplay_repr
block|,
comment|/* tp_repr */
literal|0
block|,
comment|/* tp_as_number */
literal|0
block|,
comment|/* tp_as_sequence */
literal|0
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
literal|0
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
literal|0
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|GROUPLAYER_DOC
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
literal|0
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|grouplay_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|grouplay_getsets
block|,
comment|/* tp_getset */
operator|&
name|PyGimpLayer_Type
block|,
comment|/* tp_base */
operator|(
name|PyObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_dict */
literal|0
block|,
comment|/* tp_descr_get */
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|grouplay_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_group_layer_new (gint32 ID)
name|pygimp_group_layer_new
parameter_list|(
name|gint32
name|ID
parameter_list|)
block|{
name|PyGimpGroupLayer
modifier|*
name|self
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_item_is_valid
argument_list|(
name|ID
argument_list|)
operator|||
operator|!
name|gimp_item_is_layer
argument_list|(
name|ID
argument_list|)
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
if|if
condition|(
operator|!
name|gimp_item_is_group
argument_list|(
name|ID
argument_list|)
condition|)
block|{
return|return
name|pygimp_layer_new
argument_list|(
name|ID
argument_list|)
return|;
block|}
name|self
operator|=
name|PyObject_NEW
argument_list|(
name|PyGimpGroupLayer
argument_list|,
operator|&
name|PyGimpGroupLayer_Type
argument_list|)
expr_stmt|;
if|if
condition|(
name|self
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|self
operator|->
name|ID
operator|=
name|ID
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|self
return|;
block|}
end_function

begin_comment
comment|/* End of code for GroupLayer objects */
end_comment

begin_comment
comment|/* -------------------------------------------------------- */
end_comment

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_copy (PyGimpChannel * self)
name|chn_copy
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|)
block|{
name|gint32
name|id
decl_stmt|;
name|id
operator|=
name|gimp_channel_copy
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|id
operator|==
operator|-
literal|1
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create new channel copy from channel (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|pygimp_channel_new
argument_list|(
name|id
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_combine_masks (PyGimpChannel * self,PyObject * args,PyObject * kwargs)
name|chn_combine_masks
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyGimpChannel
modifier|*
name|channel2
decl_stmt|;
name|GimpChannelOps
name|operation
decl_stmt|;
name|int
name|offx
init|=
literal|0
decl_stmt|,
name|offy
init|=
literal|0
decl_stmt|;
specifier|static
name|char
modifier|*
name|kwlist
index|[]
init|=
block|{
literal|"channel"
block|,
literal|"operation"
block|,
literal|"offset_x"
block|,
literal|"offset_y"
block|,
name|NULL
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTupleAndKeywords
argument_list|(
name|args
argument_list|,
name|kwargs
argument_list|,
literal|"O!i|ii:combine_masks"
argument_list|,
name|kwlist
argument_list|,
operator|&
name|PyGimpChannel_Type
argument_list|,
operator|&
name|channel2
argument_list|,
operator|&
name|operation
argument_list|,
operator|&
name|offx
argument_list|,
operator|&
name|offy
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
operator|!
name|gimp_channel_combine_masks
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|channel2
operator|->
name|ID
argument_list|,
name|operation
argument_list|,
name|offx
argument_list|,
name|offy
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not combine masks with channels (ID %d and ID %d) "
literal|"with operation %d, offset %d, %d"
argument_list|,
name|self
operator|->
name|ID
argument_list|,
name|channel2
operator|->
name|ID
argument_list|,
name|operation
argument_list|,
name|offx
argument_list|,
name|offy
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|chn_methods
specifier|static
name|PyMethodDef
name|chn_methods
index|[]
init|=
block|{
block|{
literal|"copy"
block|,
operator|(
name|PyCFunction
operator|)
name|chn_copy
block|,
name|METH_NOARGS
block|}
block|,
block|{
literal|"combine_masks"
block|,
operator|(
name|PyCFunction
operator|)
name|chn_combine_masks
block|,
name|METH_VARARGS
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|}
comment|/* sentinel */
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_get_color (PyGimpChannel * self,void * closure)
name|chn_get_color
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
name|GimpRGB
name|rgb
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_channel_get_color
argument_list|(
name|self
operator|->
name|ID
argument_list|,
operator|&
name|rgb
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not get compositing color of channel (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|pygimp_rgb_new
argument_list|(
operator|&
name|rgb
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|chn_set_color (PyGimpChannel * self,PyObject * value,void * closure)
name|chn_set_color
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|GimpRGB
name|tmprgb
decl_stmt|,
modifier|*
name|rgb
decl_stmt|;
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete color"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|pygimp_rgb_check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|value
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|PyTuple_Check
argument_list|(
name|value
argument_list|)
operator|&&
name|PyArg_ParseTuple
argument_list|(
name|value
argument_list|,
literal|"(BBB)"
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
condition|)
block|{
name|gimp_rgb_set_uchar
argument_list|(
operator|&
name|tmprgb
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|rgb
operator|=
operator|&
name|tmprgb
expr_stmt|;
block|}
else|else
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_channel_set_color
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|rgb
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set compositing color on channel (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_get_opacity (PyGimpLayer * self,void * closure)
name|chn_get_opacity
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyFloat_FromDouble
argument_list|(
name|gimp_channel_get_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|chn_set_opacity (PyGimpLayer * self,PyObject * value,void * closure)
name|chn_set_opacity
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete opacity"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyFloat_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_channel_set_opacity
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyFloat_AsDouble
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set opacity on channel (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_get_show_masked (PyGimpLayer * self,void * closure)
name|chn_get_show_masked
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
return|return
name|PyBool_FromLong
argument_list|(
name|gimp_channel_get_show_masked
argument_list|(
name|self
operator|->
name|ID
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|chn_set_show_masked (PyGimpLayer * self,PyObject * value,void * closure)
name|chn_set_show_masked
parameter_list|(
name|PyGimpLayer
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|value
parameter_list|,
name|void
modifier|*
name|closure
parameter_list|)
block|{
if|if
condition|(
name|value
operator|==
name|NULL
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"cannot delete show_masked"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|PyInt_Check
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
operator|!
name|gimp_channel_set_show_masked
argument_list|(
name|self
operator|->
name|ID
argument_list|,
name|PyInt_AsLong
argument_list|(
name|value
argument_list|)
argument_list|)
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not set composite method on channel (ID %d)"
argument_list|,
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|chn_getsets
specifier|static
name|PyGetSetDef
name|chn_getsets
index|[]
init|=
block|{
block|{
literal|"color"
block|,
operator|(
name|getter
operator|)
name|chn_get_color
block|,
operator|(
name|setter
operator|)
name|chn_set_color
block|}
block|,
block|{
literal|"colour"
block|,
operator|(
name|getter
operator|)
name|chn_get_color
block|,
operator|(
name|setter
operator|)
name|chn_set_color
block|}
block|,
block|{
literal|"opacity"
block|,
operator|(
name|getter
operator|)
name|chn_get_opacity
block|,
operator|(
name|setter
operator|)
name|chn_set_opacity
block|}
block|,
block|{
literal|"show_masked"
block|,
operator|(
name|getter
operator|)
name|chn_get_show_masked
block|,
operator|(
name|setter
operator|)
name|chn_set_show_masked
block|}
block|,
block|{
name|NULL
block|,
operator|(
name|getter
operator|)
literal|0
block|,
operator|(
name|setter
operator|)
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|PyObject
modifier|*
DECL|function|chn_repr (PyGimpChannel * self)
name|chn_repr
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|)
block|{
name|PyObject
modifier|*
name|s
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|gimp_item_get_name
argument_list|(
name|self
operator|->
name|ID
argument_list|)
expr_stmt|;
name|s
operator|=
name|PyString_FromFormat
argument_list|(
literal|"<gimp.Channel '%s'>"
argument_list|,
name|name
condition|?
name|name
else|:
literal|"(null)"
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|chn_init (PyGimpChannel * self,PyObject * args,PyObject * kwargs)
name|chn_init
parameter_list|(
name|PyGimpChannel
modifier|*
name|self
parameter_list|,
name|PyObject
modifier|*
name|args
parameter_list|,
name|PyObject
modifier|*
name|kwargs
parameter_list|)
block|{
name|PyGimpImage
modifier|*
name|img
decl_stmt|;
name|PyObject
modifier|*
name|color
decl_stmt|;
name|char
modifier|*
name|name
decl_stmt|;
name|unsigned
name|int
name|width
decl_stmt|,
name|height
decl_stmt|,
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|double
name|opacity
decl_stmt|;
name|GimpRGB
name|tmprgb
decl_stmt|,
modifier|*
name|rgb
decl_stmt|;
if|if
condition|(
operator|!
name|PyArg_ParseTuple
argument_list|(
name|args
argument_list|,
literal|"O!siidO:gimp.Channel.__init__"
argument_list|,
operator|&
name|PyGimpImage_Type
argument_list|,
operator|&
name|img
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|opacity
argument_list|,
operator|&
name|color
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|pygimp_rgb_check
argument_list|(
name|color
argument_list|)
condition|)
block|{
name|rgb
operator|=
name|pyg_boxed_get
argument_list|(
name|color
argument_list|,
name|GimpRGB
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|PyTuple_Check
argument_list|(
name|color
argument_list|)
operator|&&
name|PyArg_ParseTuple
argument_list|(
name|color
argument_list|,
literal|"(BBB)"
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
condition|)
block|{
name|gimp_rgb_set_uchar
argument_list|(
operator|&
name|tmprgb
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|rgb
operator|=
operator|&
name|tmprgb
expr_stmt|;
block|}
else|else
block|{
name|PyErr_Clear
argument_list|()
expr_stmt|;
name|PyErr_SetString
argument_list|(
name|PyExc_TypeError
argument_list|,
literal|"type mismatch"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|self
operator|->
name|ID
operator|=
name|gimp_channel_new
argument_list|(
name|img
operator|->
name|ID
argument_list|,
name|name
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|opacity
argument_list|,
name|rgb
argument_list|)
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|self
operator|->
name|ID
operator|<
literal|0
condition|)
block|{
name|PyErr_Format
argument_list|(
name|pygimp_error
argument_list|,
literal|"could not create %dx%d channel '%s' on image (ID %d)"
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|name
argument_list|,
name|img
operator|->
name|ID
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|PyGimpChannel_Type
name|PyTypeObject
name|PyGimpChannel_Type
init|=
block|{
name|PyObject_HEAD_INIT
argument_list|(
name|NULL
argument_list|)
literal|0
block|,
comment|/* ob_size */
literal|"gimp.Channel"
block|,
comment|/* tp_name */
sizeof|sizeof
argument_list|(
name|PyGimpChannel
argument_list|)
block|,
comment|/* tp_basicsize */
literal|0
block|,
comment|/* tp_itemsize */
comment|/* methods */
operator|(
name|destructor
operator|)
name|drw_dealloc
block|,
comment|/* tp_dealloc */
operator|(
name|printfunc
operator|)
literal|0
block|,
comment|/* tp_print */
operator|(
name|getattrfunc
operator|)
literal|0
block|,
comment|/* tp_getattr */
operator|(
name|setattrfunc
operator|)
literal|0
block|,
comment|/* tp_setattr */
operator|(
name|cmpfunc
operator|)
name|drw_cmp
block|,
comment|/* tp_compare */
operator|(
name|reprfunc
operator|)
name|chn_repr
block|,
comment|/* tp_repr */
literal|0
block|,
comment|/* tp_as_number */
literal|0
block|,
comment|/* tp_as_sequence */
literal|0
block|,
comment|/* tp_as_mapping */
operator|(
name|hashfunc
operator|)
literal|0
block|,
comment|/* tp_hash */
operator|(
name|ternaryfunc
operator|)
literal|0
block|,
comment|/* tp_call */
operator|(
name|reprfunc
operator|)
literal|0
block|,
comment|/* tp_str */
operator|(
name|getattrofunc
operator|)
literal|0
block|,
comment|/* tp_getattro */
operator|(
name|setattrofunc
operator|)
literal|0
block|,
comment|/* tp_setattro */
literal|0
block|,
comment|/* tp_as_buffer */
name|Py_TPFLAGS_DEFAULT
block|,
comment|/* tp_flags */
name|NULL
block|,
comment|/* Documentation string */
operator|(
name|traverseproc
operator|)
literal|0
block|,
comment|/* tp_traverse */
operator|(
name|inquiry
operator|)
literal|0
block|,
comment|/* tp_clear */
operator|(
name|richcmpfunc
operator|)
literal|0
block|,
comment|/* tp_richcompare */
literal|0
block|,
comment|/* tp_weaklistoffset */
operator|(
name|getiterfunc
operator|)
literal|0
block|,
comment|/* tp_iter */
operator|(
name|iternextfunc
operator|)
literal|0
block|,
comment|/* tp_iternext */
name|chn_methods
block|,
comment|/* tp_methods */
literal|0
block|,
comment|/* tp_members */
name|chn_getsets
block|,
comment|/* tp_getset */
operator|&
name|PyGimpDrawable_Type
block|,
comment|/* tp_base */
operator|(
name|PyObject
operator|*
operator|)
literal|0
block|,
comment|/* tp_dict */
literal|0
block|,
comment|/* tp_descr_get */
literal|0
block|,
comment|/* tp_descr_set */
literal|0
block|,
comment|/* tp_dictoffset */
operator|(
name|initproc
operator|)
name|chn_init
block|,
comment|/* tp_init */
operator|(
name|allocfunc
operator|)
literal|0
block|,
comment|/* tp_alloc */
operator|(
name|newfunc
operator|)
literal|0
block|,
comment|/* tp_new */
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|PyObject
modifier|*
DECL|function|pygimp_channel_new (gint32 ID)
name|pygimp_channel_new
parameter_list|(
name|gint32
name|ID
parameter_list|)
block|{
name|PyGimpChannel
modifier|*
name|self
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_item_is_valid
argument_list|(
name|ID
argument_list|)
operator|||
operator|!
name|gimp_item_is_channel
argument_list|(
name|ID
argument_list|)
condition|)
block|{
name|Py_INCREF
argument_list|(
name|Py_None
argument_list|)
expr_stmt|;
return|return
name|Py_None
return|;
block|}
name|self
operator|=
name|PyObject_NEW
argument_list|(
name|PyGimpChannel
argument_list|,
operator|&
name|PyGimpChannel_Type
argument_list|)
expr_stmt|;
if|if
condition|(
name|self
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
name|self
operator|->
name|ID
operator|=
name|ID
expr_stmt|;
name|self
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|PyObject
operator|*
operator|)
name|self
return|;
block|}
end_function

end_unit

