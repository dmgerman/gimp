begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* Lighting Effects - A plug-in for GIMP  *  * Dialog creation and updaters, callbacks and event-handlers  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<glib/gstdio.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"lighting-ui.h"
end_include

begin_include
include|#
directive|include
file|"lighting-main.h"
end_include

begin_include
include|#
directive|include
file|"lighting-image.h"
end_include

begin_include
include|#
directive|include
file|"lighting-apply.h"
end_include

begin_include
include|#
directive|include
file|"lighting-preview.h"
end_include

begin_include
include|#
directive|include
file|"lighting-stock.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_decl_stmt
specifier|extern
name|LightingValues
name|mapvals
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|appwin
specifier|static
name|GtkWidget
modifier|*
name|appwin
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|options_note_book
specifier|static
name|GtkNotebook
modifier|*
name|options_note_book
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gc
name|GdkGC
modifier|*
name|gc
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|previewarea
name|GtkWidget
modifier|*
name|previewarea
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|spin_pos_x
name|GtkWidget
modifier|*
name|spin_pos_x
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|spin_pos_y
name|GtkWidget
modifier|*
name|spin_pos_y
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|spin_pos_z
name|GtkWidget
modifier|*
name|spin_pos_z
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|spin_dir_x
name|GtkWidget
modifier|*
name|spin_dir_x
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|spin_dir_y
name|GtkWidget
modifier|*
name|spin_dir_y
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|spin_dir_z
name|GtkWidget
modifier|*
name|spin_dir_z
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|colorbutton
specifier|static
name|GtkWidget
modifier|*
name|colorbutton
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|light_type_combo
specifier|static
name|GtkWidget
modifier|*
name|light_type_combo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|lightselect_combo
specifier|static
name|GtkWidget
modifier|*
name|lightselect_combo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|spin_intensity
specifier|static
name|GtkWidget
modifier|*
name|spin_intensity
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|isolate_button
specifier|static
name|GtkWidget
modifier|*
name|isolate_button
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|lighting_effects_path
specifier|static
name|gchar
modifier|*
name|lighting_effects_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|create_main_notebook
parameter_list|(
name|GtkWidget
modifier|*
name|container
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|distance_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adj
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|bumpmap_constrain
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|drawable_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|envmap_constrain
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|drawable_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|envmap_combo_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|save_lighting_preset
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|save_preset_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|load_lighting_preset
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|load_preset_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|lightselect_callback
parameter_list|(
name|GimpIntComboBox
modifier|*
name|combo
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|apply_settings
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|isolate_selected_light
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**********************/
end_comment

begin_comment
comment|/* Std. toggle update */
end_comment

begin_comment
comment|/**********************/
end_comment

begin_function
specifier|static
name|void
DECL|function|toggle_update (GtkWidget * widget,gpointer data)
name|toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_toggle_button_update
argument_list|(
name|widget
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|draw_preview_image
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|distance_update (GtkAdjustment * adj,gpointer data)
name|distance_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adj
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|mapvals
operator|.
name|viewpoint
operator|.
name|z
operator|=
name|gtk_adjustment_get_value
argument_list|(
name|adj
argument_list|)
expr_stmt|;
name|draw_preview_image
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****************************************/
end_comment

begin_comment
comment|/* Main window light type menu callback. */
end_comment

begin_comment
comment|/*****************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|apply_settings (GtkWidget * widget,gpointer data)
name|apply_settings
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|valid
decl_stmt|;
name|gint
name|type
decl_stmt|;
name|gint
name|k
init|=
name|mapvals
operator|.
name|light_selected
decl_stmt|;
if|if
condition|(
name|mapvals
operator|.
name|update_enabled
condition|)
block|{
name|valid
operator|=
name|gimp_int_combo_box_get_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|light_type_combo
argument_list|)
argument_list|,
operator|&
name|type
argument_list|)
expr_stmt|;
if|if
condition|(
name|valid
condition|)
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
operator|=
name|type
expr_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|colorbutton
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|x
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_pos_x
argument_list|)
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|y
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_pos_y
argument_list|)
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|z
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_pos_z
argument_list|)
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|x
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_dir_x
argument_list|)
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|y
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_dir_y
argument_list|)
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|z
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_dir_z
argument_list|)
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|intensity
operator|=
name|gtk_spin_button_get_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_intensity
argument_list|)
argument_list|)
expr_stmt|;
name|interactive_preview_callback
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|widget
operator|==
name|light_type_combo
condition|)
block|{
switch|switch
condition|(
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
condition|)
block|{
case|case
name|NO_LIGHT
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_x
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_z
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_x
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_z
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|POINT_LIGHT
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_x
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_y
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_z
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_x
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_z
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIRECTIONAL_LIGHT
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_x
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_pos_z
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_x
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_y
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|spin_dir_z
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|mapmenu2_callback (GtkWidget * widget,gpointer data)
name|mapmenu2_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_int_combo_box_get_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|widget
argument_list|)
argument_list|,
operator|(
name|gint
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
name|draw_preview_image
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************************/
end_comment

begin_comment
comment|/* Main window "Preview!" button callback */
end_comment

begin_comment
comment|/******************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|preview_callback (GtkWidget * widget)
name|preview_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|draw_preview_image
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*********************************************/
end_comment

begin_comment
comment|/* Main window "-" (zoom in) button callback */
end_comment

begin_comment
comment|/*********************************************/
end_comment

begin_comment
comment|/* static void zoomout_callback (GtkWidget *widget) {   mapvals.preview_zoom_factor *= 0.5;   draw_preview_image (TRUE); } */
end_comment

begin_comment
comment|/*********************************************/
end_comment

begin_comment
comment|/* Main window "+" (zoom out) button callback */
end_comment

begin_comment
comment|/*********************************************/
end_comment

begin_comment
comment|/* static void zoomin_callback (GtkWidget *widget) {   mapvals.preview_zoom_factor *= 2.0;   draw_preview_image (TRUE); } */
end_comment

begin_comment
comment|/**********************************************/
end_comment

begin_comment
comment|/* Main window "Apply" button callback.       */
end_comment

begin_comment
comment|/* Render to GIMP image, close down and exit. */
end_comment

begin_comment
comment|/**********************************************/
end_comment

begin_function
specifier|static
name|gint
DECL|function|bumpmap_constrain (gint32 image_id,gint32 drawable_id,gpointer data)
name|bumpmap_constrain
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|drawable_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
return|return
operator|(
operator|(
name|gimp_drawable_width
argument_list|(
name|drawable_id
argument_list|)
operator|==
name|gimp_drawable_width
argument_list|(
name|mapvals
operator|.
name|drawable_id
argument_list|)
operator|)
operator|&&
operator|(
name|gimp_drawable_height
argument_list|(
name|drawable_id
argument_list|)
operator|==
name|gimp_drawable_height
argument_list|(
name|mapvals
operator|.
name|drawable_id
argument_list|)
operator|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|envmap_constrain (gint32 image_id,gint32 drawable_id,gpointer data)
name|envmap_constrain
parameter_list|(
name|gint32
name|image_id
parameter_list|,
name|gint32
name|drawable_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
return|return
operator|(
operator|!
name|gimp_drawable_is_gray
argument_list|(
name|drawable_id
argument_list|)
operator|&&
operator|!
name|gimp_drawable_has_alpha
argument_list|(
name|drawable_id
argument_list|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|envmap_combo_callback (GtkWidget * widget,gpointer data)
name|envmap_combo_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_int_combo_box_get_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|widget
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|envmap_id
argument_list|)
expr_stmt|;
name|env_width
operator|=
name|gimp_drawable_width
argument_list|(
name|mapvals
operator|.
name|envmap_id
argument_list|)
expr_stmt|;
name|env_height
operator|=
name|gimp_drawable_height
argument_list|(
name|mapvals
operator|.
name|envmap_id
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***********************/
end_comment

begin_comment
comment|/* Dialog constructors */
end_comment

begin_comment
comment|/***********************/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|create_options_page (void)
name|create_options_page
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
comment|/* General options */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"General Options"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"T_ransparent background"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|mapvals
operator|.
name|transparent_background
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|toggle_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|transparent_background
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Make destination image transparent where bump "
literal|"height is zero"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Cre_ate new image"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|mapvals
operator|.
name|create_new_image
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|create_new_image
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Create a new image when applying filter"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"High _quality preview"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|mapvals
operator|.
name|previewquality
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|toggle_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|previewquality
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Enable/disable high quality preview"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|adj
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Distance:"
argument_list|)
argument_list|,
literal|100
argument_list|,
literal|6
argument_list|,
name|mapvals
operator|.
name|viewpoint
operator|.
name|z
argument_list|,
literal|0.0
argument_list|,
literal|2.0
argument_list|,
literal|0.01
argument_list|,
literal|0.05
argument_list|,
literal|3
argument_list|,
name|TRUE
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|"Distance of observer from surface"
argument_list|,
literal|"plug-in-lighting"
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|distance_update
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_comment
comment|/******************************/
end_comment

begin_comment
comment|/* Create light settings page */
end_comment

begin_comment
comment|/******************************/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|create_light_page (void)
name|create_light_page
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|gint
name|k
init|=
name|mapvals
operator|.
name|light_selected
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Light Settings"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|8
argument_list|,
literal|8
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|lightselect_combo
operator|=
name|gimp_int_combo_box_new
argument_list|(
name|_
argument_list|(
literal|"Light 1"
argument_list|)
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Light 2"
argument_list|)
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"Light 3"
argument_list|)
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"Light 4"
argument_list|)
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"Light 5"
argument_list|)
argument_list|,
literal|4
argument_list|,
name|_
argument_list|(
literal|"Light 6"
argument_list|)
argument_list|,
literal|5
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|lightselect_combo
argument_list|)
argument_list|,
name|k
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|lightselect_combo
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|lightselect_combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|lightselect_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|lightselect_combo
argument_list|)
expr_stmt|;
comment|/* row labels */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Type:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Color:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|light_type_combo
operator|=
name|gimp_int_combo_box_new
argument_list|(
name|_
argument_list|(
literal|"None"
argument_list|)
argument_list|,
name|NO_LIGHT
argument_list|,
name|_
argument_list|(
literal|"Directional"
argument_list|)
argument_list|,
name|DIRECTIONAL_LIGHT
argument_list|,
name|_
argument_list|(
literal|"Point"
argument_list|)
argument_list|,
name|POINT_LIGHT
argument_list|,
comment|/* _("Spot"),     SPOT_LIGHT, */
name|NULL
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|light_type_combo
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|light_type_combo
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|light_type_combo
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|light_type_combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|light_type_combo
argument_list|,
name|_
argument_list|(
literal|"Type of light source to apply"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|colorbutton
operator|=
name|gimp_color_button_new
argument_list|(
name|_
argument_list|(
literal|"Select lightsource color"
argument_list|)
argument_list|,
literal|64
argument_list|,
literal|16
argument_list|,
operator|&
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|color
argument_list|,
name|GIMP_COLOR_AREA_FLAT
argument_list|)
expr_stmt|;
name|gimp_color_button_set_update
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|colorbutton
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|colorbutton
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|colorbutton
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|colorbutton
argument_list|,
literal|"color-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|colorbutton
argument_list|,
name|_
argument_list|(
literal|"Set light source color"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|spin_intensity
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|intensity
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"_Intensity:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spin_intensity
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spin_intensity
argument_list|,
name|_
argument_list|(
literal|"Light intensity"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Position"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|spin_pos_x
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|x
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|0.1
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"_X:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spin_pos_x
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spin_pos_x
argument_list|,
name|_
argument_list|(
literal|"Light source X position in XYZ space"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|spin_pos_y
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|y
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|0.1
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"_Y:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spin_pos_y
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spin_pos_y
argument_list|,
name|_
argument_list|(
literal|"Light source Y position in XYZ space"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|spin_pos_z
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|z
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|0.1
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"_Z:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spin_pos_z
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spin_pos_z
argument_list|,
name|_
argument_list|(
literal|"Light source Z position in XYZ space"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Direction"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|spin_dir_x
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|x
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|0.1
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"X:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spin_dir_x
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spin_dir_x
argument_list|,
name|_
argument_list|(
literal|"Light source X direction in XYZ space"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|spin_dir_y
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|y
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|0.1
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"Y:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spin_dir_y
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spin_dir_y
argument_list|,
name|_
argument_list|(
literal|"Light source Y direction in XYZ space"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|spin_dir_z
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|z
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|0.1
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"Z:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spin_dir_z
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|apply_settings
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spin_dir_z
argument_list|,
name|_
argument_list|(
literal|"Light source Z direction in XYZ space"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|isolate_button
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"I_solate"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|isolate_button
argument_list|)
argument_list|,
name|mapvals
operator|.
name|light_isolated
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|isolate_button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|isolate_selected_light
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|isolate_button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|isolate_button
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Lighting preset:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|5
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_SAVE
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|2
argument_list|,
literal|4
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|save_lighting_preset
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_OPEN
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|4
argument_list|,
literal|6
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|load_lighting_preset
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_comment
comment|/*********************************/
end_comment

begin_comment
comment|/* Create material settings page */
end_comment

begin_comment
comment|/*********************************/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|create_material_page (void)
name|create_material_page
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkSizeGroup
modifier|*
name|group
init|=
name|gtk_size_group_new
argument_list|(
name|GTK_SIZE_GROUP_HORIZONTAL
argument_list|)
decl_stmt|;
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|image
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Material Properties"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|5
argument_list|,
literal|4
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/* Ambient intensity */
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_INTENSITY_AMBIENT_LOW
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|label
operator|=
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"_Glowing:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|image
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_size_group_add_widget
argument_list|(
name|group
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|material
operator|.
name|ambient_int
argument_list|,
literal|0
argument_list|,
name|G_MAXFLOAT
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|material
operator|.
name|ambient_int
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_mnemonic_widget
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|spinbutton
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spinbutton
argument_list|,
name|_
argument_list|(
literal|"Amount of original color to show where no "
literal|"direct light falls"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_INTENSITY_AMBIENT_HIGH
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|image
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/* Diffuse intensity */
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_INTENSITY_DIFFUSE_LOW
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|label
operator|=
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"_Bright:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|image
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_size_group_add_widget
argument_list|(
name|group
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|material
operator|.
name|diffuse_int
argument_list|,
literal|0
argument_list|,
name|G_MAXFLOAT
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|material
operator|.
name|diffuse_int
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_mnemonic_widget
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|spinbutton
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spinbutton
argument_list|,
name|_
argument_list|(
literal|"Intensity of original color when lit by a light "
literal|"source"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_INTENSITY_DIFFUSE_HIGH
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|image
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/* Specular reflection */
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_REFLECTIVITY_SPECULAR_LOW
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|label
operator|=
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"_Shiny:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|image
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_size_group_add_widget
argument_list|(
name|group
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|material
operator|.
name|specular_ref
argument_list|,
literal|0
argument_list|,
name|G_MAXFLOAT
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|material
operator|.
name|specular_ref
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_mnemonic_widget
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|spinbutton
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spinbutton
argument_list|,
name|_
argument_list|(
literal|"Controls how intense the highlights will be"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_REFLECTIVITY_SPECULAR_HIGH
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|image
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/* Highlight */
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_REFLECTIVITY_HIGHLIGHT_LOW
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|label
operator|=
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"_Polished:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|image
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_size_group_add_widget
argument_list|(
name|group
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|material
operator|.
name|highlight
argument_list|,
literal|0
argument_list|,
name|G_MAXFLOAT
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|material
operator|.
name|highlight
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_mnemonic_widget
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|spinbutton
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spinbutton
argument_list|,
name|_
argument_list|(
literal|"Higher values makes the highlights more focused"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|STOCK_REFLECTIVITY_HIGHLIGHT_HIGH
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|image
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/* Metallic */
name|button
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Metallic"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|material
operator|.
name|metallic
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_comment
comment|/* Create Bump mapping page */
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|create_bump_page (void)
name|create_bump_page
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|combo
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"E_nable bump mapping"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|mapvals
operator|.
name|bump_mapped
argument_list|)
expr_stmt|;
name|gtk_frame_set_label_widget
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|toggle
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|bump_mapped
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Enable/disable bump-mapping (image depth)"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|table
argument_list|,
name|mapvals
operator|.
name|bump_mapped
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"set_sensitive"
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|combo
operator|=
name|gimp_drawable_combo_box_new
argument_list|(
name|bumpmap_constrain
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_connect
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|combo
argument_list|)
argument_list|,
name|mapvals
operator|.
name|bumpmap_id
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_int_combo_box_get_active
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|bumpmap_id
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|mapmenu2_callback
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|bumpmap_id
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Bumpm_ap image:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|combo
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|combo
operator|=
name|gimp_int_combo_box_new
argument_list|(
name|_
argument_list|(
literal|"Linear"
argument_list|)
argument_list|,
name|LINEAR_MAP
argument_list|,
name|_
argument_list|(
literal|"Logarithmic"
argument_list|)
argument_list|,
name|LOGARITHMIC_MAP
argument_list|,
name|_
argument_list|(
literal|"Sinusoidal"
argument_list|)
argument_list|,
name|SINUSOIDAL_MAP
argument_list|,
name|_
argument_list|(
literal|"Spherical"
argument_list|)
argument_list|,
name|SPHERICAL_MAP
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|combo
argument_list|)
argument_list|,
name|mapvals
operator|.
name|bumpmaptype
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|mapmenu2_callback
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|bumpmaptype
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"Cu_rve:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|combo
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|mapvals
operator|.
name|bumpmax
argument_list|,
literal|0
argument_list|,
name|G_MAXFLOAT
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"Ma_ximum height:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spinbutton
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|bumpmax
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spinbutton
argument_list|,
name|_
argument_list|(
literal|"Maximum height for bumps"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|create_environment_page (void)
name|create_environment_page
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|combo
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"E_nable environment mapping"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|mapvals
operator|.
name|env_mapped
argument_list|)
expr_stmt|;
name|gtk_frame_set_label_widget
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|toggle
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|env_mapped
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Enable/disable environment-mapping (reflection)"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|table
argument_list|,
name|mapvals
operator|.
name|env_mapped
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"set_sensitive"
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|combo
operator|=
name|gimp_drawable_combo_box_new
argument_list|(
name|envmap_constrain
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_connect
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|combo
argument_list|)
argument_list|,
name|mapvals
operator|.
name|envmap_id
argument_list|,
name|G_CALLBACK
argument_list|(
name|envmap_combo_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"En_vironment image:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|combo
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|combo
argument_list|,
name|_
argument_list|(
literal|"Environment image to use"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_comment
comment|/*****************************/
end_comment

begin_comment
comment|/* Create notebook and pages */
end_comment

begin_comment
comment|/*****************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|create_main_notebook (GtkWidget * container)
name|create_main_notebook
parameter_list|(
name|GtkWidget
modifier|*
name|container
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|options_note_book
operator|=
name|GTK_NOTEBOOK
argument_list|(
name|gtk_notebook_new
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|container
argument_list|)
argument_list|,
name|GTK_WIDGET
argument_list|(
name|options_note_book
argument_list|)
argument_list|)
expr_stmt|;
name|page
operator|=
name|create_options_page
argument_list|()
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|options_note_book
argument_list|,
name|page
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Op_tions"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|page
operator|=
name|create_light_page
argument_list|()
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|options_note_book
argument_list|,
name|page
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Light"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|page
operator|=
name|create_material_page
argument_list|()
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|options_note_book
argument_list|,
name|page
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Material"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|page
operator|=
name|create_bump_page
argument_list|()
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|options_note_book
argument_list|,
name|page
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Bump Map"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|page
operator|=
name|create_environment_page
argument_list|()
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|options_note_book
argument_list|,
name|page
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Environment Map"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/*   if (mapvals.bump_mapped == TRUE)     {       bump_page = create_bump_page ();       bump_page_pos = g_list_length (options_note_book->children);       gtk_notebook_append_page (options_note_book, bump_page,                                 gtk_label_new (_("Bumpmap")));     }    if (mapvals.env_mapped == TRUE)     {       env_page = create_environment_page ();       env_page_pos = g_list_length (options_note_book->children);       gtk_notebook_append_page (options_note_book, env_page,                                 gtk_label_new (_("Environment")));     }   */
name|gtk_widget_show
argument_list|(
name|GTK_WIDGET
argument_list|(
name|options_note_book
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/********************************/
end_comment

begin_comment
comment|/* Create and show main dialog. */
end_comment

begin_comment
comment|/********************************/
end_comment

begin_function
name|gboolean
DECL|function|main_dialog (GimpDrawable * drawable)
name|main_dialog
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|main_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
name|gboolean
name|run
init|=
name|FALSE
decl_stmt|;
comment|/*   GtkWidget *image;   */
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|path
operator|=
name|gimp_gimprc_query
argument_list|(
literal|"lighting-effects-path"
argument_list|)
expr_stmt|;
if|if
condition|(
name|path
condition|)
block|{
name|lighting_effects_path
operator|=
name|g_filename_from_utf8
argument_list|(
name|path
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
block|}
name|lighting_stock_init
argument_list|()
expr_stmt|;
name|appwin
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Lighting Effects"
argument_list|)
argument_list|,
name|PLUG_IN_BINARY
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|appwin
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_window_set_transient
argument_list|(
name|GTK_WINDOW
argument_list|(
name|appwin
argument_list|)
argument_list|)
expr_stmt|;
name|main_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|appwin
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|main_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_hbox
argument_list|)
expr_stmt|;
comment|/* Create the Preview */
comment|/* ================== */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Add preview widget and various buttons to the first part */
comment|/* ======================================================== */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|gtk_widget_realize
argument_list|(
name|appwin
argument_list|)
expr_stmt|;
name|previewarea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|previewarea
argument_list|,
name|PREVIEW_WIDTH
argument_list|,
name|PREVIEW_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|previewarea
argument_list|,
operator|(
name|GDK_EXPOSURE_MASK
operator||
name|GDK_BUTTON1_MOTION_MASK
operator||
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
operator|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|previewarea
argument_list|,
literal|"event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_events
argument_list|)
argument_list|,
name|previewarea
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|previewarea
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|previewarea
argument_list|)
expr_stmt|;
comment|/* create preview options, frame and vbox */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Update"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Recompute preview image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"I_nteractive"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|mapvals
operator|.
name|interactive_preview
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|interactive_preview
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|interactive_preview_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Enable/disable real time preview of changes"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|create_main_notebook
argument_list|(
name|main_hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|appwin
argument_list|)
expr_stmt|;
block|{
name|GdkCursor
modifier|*
name|cursor
decl_stmt|;
name|cursor
operator|=
name|gdk_cursor_new_for_display
argument_list|(
name|gtk_widget_get_display
argument_list|(
name|previewarea
argument_list|)
argument_list|,
name|GDK_HAND2
argument_list|)
expr_stmt|;
name|gdk_window_set_cursor
argument_list|(
name|gtk_widget_get_window
argument_list|(
name|previewarea
argument_list|)
argument_list|,
name|cursor
argument_list|)
expr_stmt|;
name|gdk_cursor_unref
argument_list|(
name|cursor
argument_list|)
expr_stmt|;
block|}
name|image_setup
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|appwin
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_OK
condition|)
name|run
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|preview_rgb_data
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|preview_rgb_data
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|appwin
argument_list|)
expr_stmt|;
return|return
name|run
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_lighting_preset (GtkWidget * widget,gpointer data)
name|save_lighting_preset
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|window
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|window
condition|)
block|{
name|window
operator|=
name|gtk_file_chooser_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Save Lighting Preset"
argument_list|)
argument_list|,
name|GTK_WINDOW
argument_list|(
name|appwin
argument_list|)
argument_list|,
name|GTK_FILE_CHOOSER_ACTION_SAVE
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_SAVE
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|gtk_file_chooser_set_do_overwrite_confirmation
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|window
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|save_preset_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|lighting_effects_path
condition|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
name|dir
decl_stmt|;
name|list
operator|=
name|gimp_path_parse
argument_list|(
name|lighting_effects_path
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|dir
operator|=
name|gimp_path_get_user_writable_dir
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|gimp_path_free
argument_list|(
name|list
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dir
condition|)
name|dir
operator|=
name|g_strdup
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_file_chooser_set_current_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|,
name|dir
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|dir
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_file_chooser_set_current_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|,
name|g_get_tmp_dir
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|gtk_window_present
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_preset_response (GtkFileChooser * chooser,gint response_id,gpointer data)
name|save_preset_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gint
name|num_lights
init|=
literal|0
decl_stmt|;
name|gint
name|k
decl_stmt|;
name|LightSettings
modifier|*
name|source
decl_stmt|;
name|gchar
name|buffer1
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|buffer2
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|buffer3
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gint
name|blen
init|=
name|G_ASCII_DTOSTR_BUF_SIZE
decl_stmt|;
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
name|gchar
modifier|*
name|filename
init|=
name|gtk_file_chooser_get_filename
argument_list|(
name|chooser
argument_list|)
decl_stmt|;
name|fp
operator|=
name|g_fopen
argument_list|(
name|filename
argument_list|,
literal|"wb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Could not open '%s' for writing: %s"
argument_list|)
argument_list|,
name|filename
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|NUM_LIGHTS
condition|;
name|k
operator|++
control|)
if|if
condition|(
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
operator|!=
name|NO_LIGHT
condition|)
operator|++
name|num_lights
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Number of lights: %d\n"
argument_list|,
name|num_lights
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|NUM_LIGHTS
condition|;
name|k
operator|++
control|)
if|if
condition|(
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
operator|!=
name|NO_LIGHT
condition|)
block|{
name|source
operator|=
operator|&
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
expr_stmt|;
switch|switch
condition|(
name|source
operator|->
name|type
condition|)
block|{
case|case
name|POINT_LIGHT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Type: Point\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|DIRECTIONAL_LIGHT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Type: Directional\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPOT_LIGHT
case|:
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Type: Spot\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"Unknown light type: %d"
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Position: %s %s %s\n"
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer1
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|position
operator|.
name|x
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer2
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|position
operator|.
name|y
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer3
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|position
operator|.
name|z
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Direction: %s %s %s\n"
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer1
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|direction
operator|.
name|x
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer2
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|direction
operator|.
name|y
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer3
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|direction
operator|.
name|z
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Color: %s %s %s\n"
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer1
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|color
operator|.
name|r
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer2
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|color
operator|.
name|g
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer3
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|color
operator|.
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"Intensity: %s\n"
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer1
argument_list|,
name|blen
argument_list|,
name|source
operator|->
name|intensity
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chooser
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|load_lighting_preset (GtkWidget * widget,gpointer data)
name|load_lighting_preset
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|window
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|window
condition|)
block|{
name|window
operator|=
name|gtk_file_chooser_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Load Lighting Preset"
argument_list|)
argument_list|,
name|GTK_WINDOW
argument_list|(
name|appwin
argument_list|)
argument_list|,
name|GTK_FILE_CHOOSER_ACTION_OPEN
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OPEN
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|window
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|load_preset_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|lighting_effects_path
condition|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
name|dir
decl_stmt|;
name|list
operator|=
name|gimp_path_parse
argument_list|(
name|lighting_effects_path
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|dir
operator|=
name|gimp_path_get_user_writable_dir
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|gimp_path_free
argument_list|(
name|list
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dir
condition|)
name|dir
operator|=
name|g_strdup
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_file_chooser_set_current_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|,
name|dir
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|dir
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_file_chooser_set_current_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|,
name|g_get_tmp_dir
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|gtk_window_present
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|load_preset_response (GtkFileChooser * chooser,gint response_id,gpointer data)
name|load_preset_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gint
name|num_lights
decl_stmt|;
name|gint
name|k
decl_stmt|;
name|LightSettings
modifier|*
name|source
decl_stmt|;
name|gchar
name|buffer1
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|buffer2
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|buffer3
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|type_label
index|[
literal|21
index|]
decl_stmt|;
name|gchar
modifier|*
name|endptr
decl_stmt|;
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
name|gchar
modifier|*
name|filename
init|=
name|gtk_file_chooser_get_filename
argument_list|(
name|chooser
argument_list|)
decl_stmt|;
name|fp
operator|=
name|g_fopen
argument_list|(
name|filename
argument_list|,
literal|"rb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Could not open '%s' for reading: %s"
argument_list|)
argument_list|,
name|filename
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|"Number of lights: %d"
argument_list|,
operator|&
name|num_lights
argument_list|)
expr_stmt|;
comment|/* initialize lights to off */
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|NUM_LIGHTS
condition|;
name|k
operator|++
control|)
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
operator|=
name|NO_LIGHT
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|num_lights
condition|;
name|k
operator|++
control|)
block|{
name|source
operator|=
operator|&
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
expr_stmt|;
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|" Type: %20s"
argument_list|,
name|type_label
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|type_label
argument_list|,
literal|"Point"
argument_list|)
condition|)
name|source
operator|->
name|type
operator|=
name|POINT_LIGHT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|type_label
argument_list|,
literal|"Directional"
argument_list|)
condition|)
name|source
operator|->
name|type
operator|=
name|DIRECTIONAL_LIGHT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|type_label
argument_list|,
literal|"Spot"
argument_list|)
condition|)
name|source
operator|->
name|type
operator|=
name|SPOT_LIGHT
expr_stmt|;
else|else
block|{
name|g_warning
argument_list|(
literal|"Unknown light type: %s"
argument_list|,
name|type_label
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return;
block|}
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|" Position: %s %s %s"
argument_list|,
name|buffer1
argument_list|,
name|buffer2
argument_list|,
name|buffer3
argument_list|)
expr_stmt|;
name|source
operator|->
name|position
operator|.
name|x
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer1
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|source
operator|->
name|position
operator|.
name|y
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer2
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|source
operator|->
name|position
operator|.
name|z
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer3
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|" Direction: %s %s %s"
argument_list|,
name|buffer1
argument_list|,
name|buffer2
argument_list|,
name|buffer3
argument_list|)
expr_stmt|;
name|source
operator|->
name|direction
operator|.
name|x
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer1
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|source
operator|->
name|direction
operator|.
name|y
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer2
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|source
operator|->
name|direction
operator|.
name|z
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer3
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|" Color: %s %s %s"
argument_list|,
name|buffer1
argument_list|,
name|buffer2
argument_list|,
name|buffer3
argument_list|)
expr_stmt|;
name|source
operator|->
name|color
operator|.
name|r
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer1
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|source
operator|->
name|color
operator|.
name|g
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer2
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|source
operator|->
name|color
operator|.
name|b
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer3
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|source
operator|->
name|color
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|fscanf
argument_list|(
name|fp
argument_list|,
literal|" Intensity: %s"
argument_list|,
name|buffer1
argument_list|)
expr_stmt|;
name|source
operator|->
name|intensity
operator|=
name|g_ascii_strtod
argument_list|(
name|buffer1
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|lightselect_callback
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|lightselect_combo
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chooser
argument_list|)
argument_list|)
expr_stmt|;
name|interactive_preview_callback
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chooser
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|lightselect_callback (GimpIntComboBox * combo,gpointer data)
name|lightselect_callback
parameter_list|(
name|GimpIntComboBox
modifier|*
name|combo
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|valid
decl_stmt|;
name|gint
name|j
decl_stmt|,
name|k
decl_stmt|;
name|valid
operator|=
name|gimp_int_combo_box_get_active
argument_list|(
name|combo
argument_list|,
operator|&
name|k
argument_list|)
expr_stmt|;
if|if
condition|(
name|valid
condition|)
block|{
name|mapvals
operator|.
name|update_enabled
operator|=
name|FALSE
expr_stmt|;
comment|/* prevent apply_settings() */
name|mapvals
operator|.
name|light_selected
operator|=
name|k
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|light_type_combo
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|type
argument_list|)
expr_stmt|;
name|gimp_color_button_set_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|colorbutton
argument_list|)
argument_list|,
operator|&
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_pos_x
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|x
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_pos_y
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|y
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_pos_z
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|position
operator|.
name|z
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_dir_x
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|x
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_dir_y
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|y
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_dir_z
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|direction
operator|.
name|z
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_value
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spin_intensity
argument_list|)
argument_list|,
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|intensity
argument_list|)
expr_stmt|;
name|mapvals
operator|.
name|update_enabled
operator|=
name|TRUE
expr_stmt|;
comment|/* if we are isolating a light, need to switch */
if|if
condition|(
name|mapvals
operator|.
name|light_isolated
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|NUM_LIGHTS
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|j
operator|==
name|mapvals
operator|.
name|light_selected
condition|)
name|mapvals
operator|.
name|lightsource
index|[
name|j
index|]
operator|.
name|active
operator|=
name|TRUE
expr_stmt|;
else|else
name|mapvals
operator|.
name|lightsource
index|[
name|j
index|]
operator|.
name|active
operator|=
name|FALSE
expr_stmt|;
block|}
name|interactive_preview_callback
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|isolate_selected_light (GtkWidget * widget,gpointer data)
name|isolate_selected_light
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|k
decl_stmt|;
if|if
condition|(
name|gtk_toggle_button_get_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
argument_list|)
condition|)
block|{
name|mapvals
operator|.
name|light_isolated
operator|=
name|TRUE
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|NUM_LIGHTS
condition|;
name|k
operator|++
control|)
if|if
condition|(
name|k
operator|==
name|mapvals
operator|.
name|light_selected
condition|)
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|active
operator|=
name|TRUE
expr_stmt|;
else|else
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|active
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
block|{
name|mapvals
operator|.
name|light_isolated
operator|=
name|FALSE
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|NUM_LIGHTS
condition|;
name|k
operator|++
control|)
name|mapvals
operator|.
name|lightsource
index|[
name|k
index|]
operator|.
name|active
operator|=
name|TRUE
expr_stmt|;
block|}
name|interactive_preview_callback
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

