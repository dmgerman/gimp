begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/**********************************************************************     Fractal Explorer Plug-in (Version 2.00 Beta)     Daniel Cotting (cotting@mygale.org)  **********************************************************************  **********************************************************************     Official homepages: http://www.mygale.org/~cotting                         http://cotting.citeweb.net                         http://village.cyberbrain.com/cotting  *********************************************************************/
end_comment

begin_comment
comment|/**********************************************************************    The GIMP -- an image manipulation program    Copyright (C) 1995 Spencer Kimball and Peter Mattis       This program is free software; you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 2 of the License, or    (at your option) any later version.       This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.       You should have received a copy of the GNU General Public License    along with this program; if not, write to the Free Software    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  *********************************************************************/
end_comment

begin_comment
comment|/**********************************************************************    Some code has been 'stolen' from:         - Peter Kirchgessner (Pkirchg@aol.com) 	- Scott Draves (spot@cs.cmu.edu) 	- Andy Thomas (alt@picnic.demon.co.uk) 	   . 	   . 	   .  **********************************************************************    "If you steal from one author it's plagiarism; if you steal from    many it's research."  --Wilson Mizner  *********************************************************************/
end_comment

begin_comment
comment|/**********************************************************************  Include necessary files    *********************************************************************/
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<dirent.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|"gtk/gtk.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimp.h"
end_include

begin_include
include|#
directive|include
file|"logo.h"
end_include

begin_include
include|#
directive|include
file|"pix_data.h"
end_include

begin_include
include|#
directive|include
file|"Languages.h"
end_include

begin_include
include|#
directive|include
file|"FractalExplorer.h"
end_include

begin_include
include|#
directive|include
file|"Events.h"
end_include

begin_include
include|#
directive|include
file|"Callbacks.h"
end_include

begin_include
include|#
directive|include
file|"Dialogs.h"
end_include

begin_comment
comment|/**********************************************************************  MAIN()    *********************************************************************/
end_comment

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_comment
comment|/**********************************************************************  FUNCTION: query    *********************************************************************/
end_comment

begin_function
specifier|static
name|void
name|query
parameter_list|()
block|{
specifier|static
name|GParamDef
name|args
index|[]
init|=
block|{
block|{
name|PARAM_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|PARAM_IMAGE
block|,
literal|"image"
block|,
literal|"Input image"
block|}
block|,
block|{
name|PARAM_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"fractaltype"
block|,
literal|"0: Mandelbrot; 1: Julia; 2: Barnsley 1; 3: Barnsley 2; 4: Barnsley 3; 5: Spider; 6: ManOWar; 7: Lambda; 8: Sierpinski"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"xmin"
block|,
literal|"xmin fractal image delimiter"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"xmax"
block|,
literal|"xmax fractal image delimiter"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"ymin"
block|,
literal|"ymin fractal image delimiter"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"ymax"
block|,
literal|"ymax fractal image delimiter"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"iter"
block|,
literal|"Iteration value"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"cx"
block|,
literal|"cx value ( only Julia)"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"cy"
block|,
literal|"cy value ( only Julia)"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"colormode"
block|,
literal|"0: Apply colormap as specified by the parameters below; 1: Apply active gradient to final image"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"redstretch"
block|,
literal|"Red stretching factor"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"greenstretch"
block|,
literal|"Green stretching factor"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"bluestretch"
block|,
literal|"Blue stretching factor"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"redmode"
block|,
literal|"Red application mode (0:SIN;1:COS;2:NONE)"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"greenmode"
block|,
literal|"Green application mode (0:SIN;1:COS;2:NONE)"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"bluemode"
block|,
literal|"Blue application mode (0:SIN;1:COS;2:NONE)"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"redinvert"
block|,
literal|"Red inversion mode (1: enabled; 0: disabled)"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"greeninvert"
block|,
literal|"Green inversion mode (1: enabled; 0: disabled)"
block|}
block|,
block|{
name|PARAM_INT8
block|,
literal|"blueinvert"
block|,
literal|"Green inversion mode (1: enabled; 0: disabled)"
block|}
block|,     }
decl_stmt|;
specifier|static
name|GParamDef
modifier|*
name|return_vals
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|nargs
init|=
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
specifier|static
name|int
name|nreturn_vals
init|=
literal|0
decl_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"plug_in_fractalexplorer"
argument_list|,
literal|"Chaos Fractal Explorer Plug-In"
argument_list|,
literal|"No help yet."
argument_list|,
literal|"Daniel Cotting (cotting@mygale.org, www.mygale.org/~cotting)"
argument_list|,
literal|"Daniel Cotting (cotting@mygale.org, www.mygale.org/~cotting)"
argument_list|,
literal|"October 1997"
argument_list|,
literal|"<Image>/Filters/Render/Fractal Explorer"
argument_list|,
literal|"RGB*"
argument_list|,
name|PROC_PLUG_IN
argument_list|,
name|nargs
argument_list|,
name|nreturn_vals
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: run  *********************************************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|run (char * name,int nparams,GParam * param,int * nreturn_vals,GParam ** return_vals)
name|run
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|int
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GParam
name|values
index|[
literal|1
index|]
decl_stmt|;
name|gint32
name|image_ID
decl_stmt|;
name|GRunModeType
name|run_mode
decl_stmt|;
name|double
name|xhsiz
decl_stmt|,
name|yhsiz
decl_stmt|;
name|int
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
name|GStatusType
name|status
init|=
name|STATUS_SUCCESS
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gchar
modifier|*
name|filname
init|=
name|NULL
decl_stmt|;
name|gchar
name|load_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
comment|/*  Get the specified drawable  */
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
name|image_ID
operator|=
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
expr_stmt|;
name|tile_width
operator|=
name|gimp_tile_width
argument_list|()
expr_stmt|;
name|tile_height
operator|=
name|gimp_tile_height
argument_list|()
expr_stmt|;
name|img_width
operator|=
name|gimp_drawable_width
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|img_height
operator|=
name|gimp_drawable_height
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|img_bpp
operator|=
name|gimp_drawable_bpp
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
operator|&
name|sel_x1
argument_list|,
operator|&
name|sel_y1
argument_list|,
operator|&
name|sel_x2
argument_list|,
operator|&
name|sel_y2
argument_list|)
expr_stmt|;
name|sel_width
operator|=
name|sel_x2
operator|-
name|sel_x1
expr_stmt|;
name|sel_height
operator|=
name|sel_y2
operator|-
name|sel_y1
expr_stmt|;
name|cen_x
operator|=
call|(
name|double
call|)
argument_list|(
name|sel_x2
operator|-
literal|1
operator|+
name|sel_x1
argument_list|)
operator|/
literal|2.0
expr_stmt|;
name|cen_y
operator|=
call|(
name|double
call|)
argument_list|(
name|sel_y2
operator|-
literal|1
operator|+
name|sel_y1
argument_list|)
operator|/
literal|2.0
expr_stmt|;
name|xhsiz
operator|=
call|(
name|double
call|)
argument_list|(
name|sel_width
operator|-
literal|1
argument_list|)
operator|/
literal|2.0
expr_stmt|;
name|yhsiz
operator|=
call|(
name|double
call|)
argument_list|(
name|sel_height
operator|-
literal|1
argument_list|)
operator|/
literal|2.0
expr_stmt|;
comment|/* Calculate preview size */
if|if
condition|(
name|sel_width
operator|>
name|sel_height
condition|)
block|{
name|pwidth
operator|=
name|MIN
argument_list|(
name|sel_width
argument_list|,
name|PREVIEW_SIZE
argument_list|)
expr_stmt|;
name|pheight
operator|=
name|sel_height
operator|*
name|pwidth
operator|/
name|sel_width
expr_stmt|;
block|}
else|else
block|{
name|pheight
operator|=
name|MIN
argument_list|(
name|sel_height
argument_list|,
name|PREVIEW_SIZE
argument_list|)
expr_stmt|;
name|pwidth
operator|=
name|sel_width
operator|*
name|pheight
operator|/
name|sel_height
expr_stmt|;
block|}
comment|/* else */
name|preview_width
operator|=
name|MAX
argument_list|(
name|pwidth
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* Min size is 2 */
name|preview_height
operator|=
name|MAX
argument_list|(
name|pheight
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* See how we will run */
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|RUN_INTERACTIVE
case|:
comment|/* Possibly retrieve data */
name|gimp_get_data
argument_list|(
literal|"plug_in_fractalexplorer"
argument_list|,
operator|&
name|wvals
argument_list|)
expr_stmt|;
name|lng
operator|=
literal|0
expr_stmt|;
name|filname
operator|=
name|g_malloc
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|filname
argument_list|,
literal|"%s%s"
argument_list|,
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
argument_list|,
literal|"/.fractalexplorerrc"
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|filname
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|fp
operator|=
name|fopen
argument_list|(
name|filname
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
name|fp
condition|)
name|fputs
argument_list|(
literal|"FX-LANG:En\n"
argument_list|,
name|fp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fgets
argument_list|(
name|load_buf
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|load_buf
argument_list|)
operator|>
literal|0
condition|)
name|load_buf
index|[
name|strlen
argument_list|(
name|load_buf
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
literal|"FX-LANG:En"
argument_list|,
name|load_buf
argument_list|,
name|strlen
argument_list|(
name|load_buf
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
block|{
name|lng
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|strncmp
argument_list|(
literal|"FX-LANG:Fr"
argument_list|,
name|load_buf
argument_list|,
name|strlen
argument_list|(
name|load_buf
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
block|{
name|lng
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|strncmp
argument_list|(
literal|"FX-LANG:De"
argument_list|,
name|load_buf
argument_list|,
name|strlen
argument_list|(
name|load_buf
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
block|{
name|lng
operator|=
literal|2
expr_stmt|;
block|}
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|wvals
operator|.
name|language
operator|=
name|lng
expr_stmt|;
name|do_english
operator|=
operator|(
name|wvals
operator|.
name|language
operator|==
literal|0
operator|)
expr_stmt|;
name|do_french
operator|=
operator|(
name|wvals
operator|.
name|language
operator|==
literal|1
operator|)
expr_stmt|;
name|do_german
operator|=
operator|(
name|wvals
operator|.
name|language
operator|==
literal|2
operator|)
expr_stmt|;
comment|/* Get information from the dialog */
if|if
condition|(
operator|!
name|explorer_dialog
argument_list|()
condition|)
return|return;
break|break;
case|case
name|RUN_NONINTERACTIVE
case|:
comment|/* Make sure all the arguments are present */
if|if
condition|(
name|nparams
operator|!=
literal|21
condition|)
name|status
operator|=
name|STATUS_CALLING_ERROR
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|wvals
operator|.
name|fractaltype
operator|=
name|param
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
name|wvals
operator|.
name|xmin
operator|=
name|param
index|[
literal|4
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|xmax
operator|=
name|param
index|[
literal|5
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|ymin
operator|=
name|param
index|[
literal|6
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|ymax
operator|=
name|param
index|[
literal|7
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|iter
operator|=
name|param
index|[
literal|8
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|cx
operator|=
name|param
index|[
literal|9
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|cy
operator|=
name|param
index|[
literal|10
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|colormode
operator|=
name|param
index|[
literal|11
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
name|wvals
operator|.
name|redstretch
operator|=
name|param
index|[
literal|12
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|greenstretch
operator|=
name|param
index|[
literal|13
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|bluestretch
operator|=
name|param
index|[
literal|14
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|wvals
operator|.
name|redmode
operator|=
name|param
index|[
literal|15
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
name|wvals
operator|.
name|greenmode
operator|=
name|param
index|[
literal|16
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
name|wvals
operator|.
name|bluemode
operator|=
name|param
index|[
literal|17
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
name|wvals
operator|.
name|redinvert
operator|=
name|param
index|[
literal|18
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
name|wvals
operator|.
name|greeninvert
operator|=
name|param
index|[
literal|19
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
name|wvals
operator|.
name|blueinvert
operator|=
name|param
index|[
literal|20
index|]
operator|.
name|data
operator|.
name|d_int8
expr_stmt|;
block|}
name|make_color_map
argument_list|()
expr_stmt|;
break|break;
case|case
name|RUN_WITH_LAST_VALS
case|:
comment|/* Possibly retrieve data */
name|gimp_get_data
argument_list|(
literal|"plug_in_fractalexplorer"
argument_list|,
operator|&
name|wvals
argument_list|)
expr_stmt|;
name|make_color_map
argument_list|()
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/* switch */
name|xmin
operator|=
name|wvals
operator|.
name|xmin
expr_stmt|;
name|xmax
operator|=
name|wvals
operator|.
name|xmax
expr_stmt|;
name|ymin
operator|=
name|wvals
operator|.
name|ymin
expr_stmt|;
name|ymax
operator|=
name|wvals
operator|.
name|ymax
expr_stmt|;
name|cx
operator|=
name|wvals
operator|.
name|cx
expr_stmt|;
name|cy
operator|=
name|wvals
operator|.
name|cy
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
comment|/*  Make sure that the drawable is indexed or RGB color  */
if|if
condition|(
name|gimp_drawable_color
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
condition|)
block|{
name|gimp_progress_init
argument_list|(
literal|"Rendering fractal..."
argument_list|)
expr_stmt|;
comment|/* Set the tile cache size */
name|gimp_tile_cache_ntiles
argument_list|(
literal|2
operator|*
operator|(
name|drawable
operator|->
name|width
operator|/
name|gimp_tile_width
argument_list|()
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
comment|/* Run! */
name|explorer
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
if|if
condition|(
name|run_mode
operator|!=
name|RUN_NONINTERACTIVE
condition|)
name|gimp_displays_flush
argument_list|()
expr_stmt|;
comment|/* Store data */
if|if
condition|(
name|run_mode
operator|==
name|RUN_INTERACTIVE
condition|)
name|gimp_set_data
argument_list|(
literal|"plug_in_fractalexplorer"
argument_list|,
operator|&
name|wvals
argument_list|,
sizeof|sizeof
argument_list|(
name|explorer_vals_t
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|STATUS_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: explorer  *********************************************************************/
end_comment

begin_function
name|void
DECL|function|explorer (GDrawable * drawable)
name|explorer
parameter_list|(
name|GDrawable
modifier|*
name|drawable
parameter_list|)
block|{
name|GPixelRgn
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|,
name|bytes
decl_stmt|,
name|row
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|guchar
modifier|*
name|src_row
decl_stmt|,
modifier|*
name|dest_row
decl_stmt|;
comment|/* Get the input area. This is the bounding box of the selection in    *  the image (or the entire image if there is no selection). Only    *  operating on the input area is simply an optimization. It doesn't    *  need to be done for correct operation. (It simply makes it go    *  faster, since fewer pixels need to be operated on).    */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
comment|/* Get the size of the input image. (This will/must be the same    *  as the size of the output image.    */
name|width
operator|=
name|drawable
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|drawable
operator|->
name|height
expr_stmt|;
name|bytes
operator|=
name|drawable
operator|->
name|bpp
expr_stmt|;
comment|/*  allocate row buffers  */
name|src_row
operator|=
operator|(
name|guchar
operator|*
operator|)
name|malloc
argument_list|(
operator|(
name|x2
operator|-
name|x1
operator|)
operator|*
name|bytes
argument_list|)
expr_stmt|;
name|dest_row
operator|=
operator|(
name|guchar
operator|*
operator|)
name|malloc
argument_list|(
operator|(
name|x2
operator|-
name|x1
operator|)
operator|*
name|bytes
argument_list|)
expr_stmt|;
comment|/*  initialize the pixel regions  */
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|xbild
operator|=
name|width
expr_stmt|;
name|ybild
operator|=
name|height
expr_stmt|;
name|xdiff
operator|=
operator|(
name|xmax
operator|-
name|xmin
operator|)
operator|/
name|xbild
expr_stmt|;
name|ydiff
operator|=
operator|(
name|ymax
operator|-
name|ymin
operator|)
operator|/
name|ybild
expr_stmt|;
for|for
control|(
name|row
operator|=
name|y1
init|;
name|row
operator|<
name|y2
condition|;
name|row
operator|++
control|)
block|{
name|gimp_pixel_rgn_get_row
argument_list|(
operator|&
name|srcPR
argument_list|,
name|src_row
argument_list|,
name|x1
argument_list|,
name|row
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|)
expr_stmt|;
name|explorer_render_row
argument_list|(
name|src_row
argument_list|,
name|dest_row
argument_list|,
name|row
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
comment|/*  store the dest  */
name|gimp_pixel_rgn_set_row
argument_list|(
operator|&
name|destPR
argument_list|,
name|dest_row
argument_list|,
name|x1
argument_list|,
name|row
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|row
operator|%
literal|10
operator|)
operator|==
literal|0
condition|)
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|row
operator|/
call|(
name|double
call|)
argument_list|(
name|y2
operator|-
name|y1
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/*  update the processed region  */
name|gimp_drawable_flush
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|src_row
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|dest_row
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: explorer_render_row  *********************************************************************/
end_comment

begin_function
name|void
DECL|function|explorer_render_row (const guchar * src_row,guchar * dest_row,gint row,gint row_width,gint bytes)
name|explorer_render_row
parameter_list|(
specifier|const
name|guchar
modifier|*
name|src_row
parameter_list|,
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|row_width
parameter_list|,
name|gint
name|bytes
parameter_list|)
block|{
name|gint
name|col
decl_stmt|,
name|bytenum
decl_stmt|;
name|double
name|a
decl_stmt|,
name|b
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|,
name|oldx
decl_stmt|,
name|oldy
decl_stmt|,
name|tempsqrx
decl_stmt|,
name|tempsqry
decl_stmt|,
name|tmpx
init|=
literal|0
decl_stmt|,
name|tmpy
init|=
literal|0
decl_stmt|,
name|foldxinitx
decl_stmt|,
name|foldxinity
decl_stmt|,
name|foldyinitx
decl_stmt|,
name|foldyinity
decl_stmt|,
name|xx
init|=
literal|0
decl_stmt|,
name|cx
decl_stmt|,
name|cy
decl_stmt|;
name|int
name|zaehler
decl_stmt|,
name|color
decl_stmt|,
name|iteration
decl_stmt|;
name|cx
operator|=
name|wvals
operator|.
name|cx
expr_stmt|;
name|cy
operator|=
name|wvals
operator|.
name|cy
expr_stmt|;
name|iteration
operator|=
name|wvals
operator|.
name|iter
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|0
init|;
name|col
operator|<
name|row_width
condition|;
name|col
operator|++
control|)
block|{
name|a
operator|=
name|xmin
operator|+
operator|(
name|double
operator|)
name|col
operator|*
name|xdiff
expr_stmt|;
name|b
operator|=
name|ymin
operator|+
operator|(
name|double
operator|)
name|row
operator|*
name|ydiff
expr_stmt|;
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|!=
literal|0
condition|)
block|{
name|tmpx
operator|=
name|x
operator|=
name|a
expr_stmt|;
name|tmpy
operator|=
name|y
operator|=
name|b
expr_stmt|;
block|}
else|else
block|{
name|x
operator|=
literal|0
expr_stmt|;
name|y
operator|=
literal|0
expr_stmt|;
block|}
for|for
control|(
name|zaehler
operator|=
literal|0
init|;
operator|(
name|zaehler
operator|<
name|iteration
operator|)
operator|&&
operator|(
operator|(
name|x
operator|*
name|x
operator|+
name|y
operator|*
name|y
operator|)
operator|<
literal|4
operator|)
condition|;
name|zaehler
operator|++
control|)
block|{
name|oldx
operator|=
name|x
expr_stmt|;
name|oldy
operator|=
name|y
expr_stmt|;
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|1
condition|)
block|{
comment|/* Julia */
name|xx
operator|=
name|x
operator|*
name|x
operator|-
name|y
operator|*
name|y
operator|+
name|cx
expr_stmt|;
name|y
operator|=
literal|2.0
operator|*
name|x
operator|*
name|y
operator|+
name|cy
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|0
condition|)
block|{
comment|/*Mandelbrot*/
name|xx
operator|=
name|x
operator|*
name|x
operator|-
name|y
operator|*
name|y
operator|+
name|a
expr_stmt|;
name|y
operator|=
literal|2.0
operator|*
name|x
operator|*
name|y
operator|+
name|b
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|2
condition|)
block|{
comment|/* Some code taken from X-Fractint */
comment|/* Barnsley M1 */
name|foldxinitx
operator|=
name|oldx
operator|*
name|cx
expr_stmt|;
name|foldyinity
operator|=
name|oldy
operator|*
name|cy
expr_stmt|;
name|foldxinity
operator|=
name|oldx
operator|*
name|cy
expr_stmt|;
name|foldyinitx
operator|=
name|oldy
operator|*
name|cx
expr_stmt|;
comment|/* orbit calculation */
if|if
condition|(
name|oldx
operator|>=
literal|0
condition|)
block|{
name|xx
operator|=
operator|(
name|foldxinitx
operator|-
name|cx
operator|-
name|foldyinity
operator|)
expr_stmt|;
name|y
operator|=
operator|(
name|foldyinitx
operator|-
name|cy
operator|+
name|foldxinity
operator|)
expr_stmt|;
block|}
else|else
block|{
name|xx
operator|=
operator|(
name|foldxinitx
operator|+
name|cx
operator|-
name|foldyinity
operator|)
expr_stmt|;
name|y
operator|=
operator|(
name|foldyinitx
operator|+
name|cy
operator|+
name|foldxinity
operator|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|3
condition|)
block|{
comment|/* Barnsley Unnamed */
name|foldxinitx
operator|=
name|oldx
operator|*
name|cx
expr_stmt|;
name|foldyinity
operator|=
name|oldy
operator|*
name|cy
expr_stmt|;
name|foldxinity
operator|=
name|oldx
operator|*
name|cy
expr_stmt|;
name|foldyinitx
operator|=
name|oldy
operator|*
name|cx
expr_stmt|;
comment|/* orbit calculation */
if|if
condition|(
name|foldxinity
operator|+
name|foldyinitx
operator|>=
literal|0
condition|)
block|{
name|xx
operator|=
name|foldxinitx
operator|-
name|cx
operator|-
name|foldyinity
expr_stmt|;
name|y
operator|=
name|foldyinitx
operator|-
name|cy
operator|+
name|foldxinity
expr_stmt|;
block|}
else|else
block|{
name|xx
operator|=
name|foldxinitx
operator|+
name|cx
operator|-
name|foldyinity
expr_stmt|;
name|y
operator|=
name|foldyinitx
operator|+
name|cy
operator|+
name|foldxinity
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|4
condition|)
block|{
comment|/*Barnsley 1*/
name|foldxinitx
operator|=
name|oldx
operator|*
name|oldx
expr_stmt|;
name|foldyinity
operator|=
name|oldy
operator|*
name|oldy
expr_stmt|;
name|foldxinity
operator|=
name|oldx
operator|*
name|oldy
expr_stmt|;
comment|/* orbit calculation */
if|if
condition|(
name|oldx
operator|>
literal|0
condition|)
block|{
name|xx
operator|=
name|foldxinitx
operator|-
name|foldyinity
operator|-
literal|1.0
expr_stmt|;
name|y
operator|=
name|foldxinity
operator|*
literal|2
expr_stmt|;
block|}
else|else
block|{
name|xx
operator|=
name|foldxinitx
operator|-
name|foldyinity
operator|-
literal|1.0
operator|+
name|cx
operator|*
name|oldx
expr_stmt|;
name|y
operator|=
name|foldxinity
operator|*
literal|2
expr_stmt|;
name|y
operator|+=
name|cy
operator|*
name|oldx
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|5
condition|)
block|{
comment|/* Spider(XAXIS) { c=z=pixel: z=z*z+c; c=c/2+z, |z|<=4 } */
name|xx
operator|=
name|x
operator|*
name|x
operator|-
name|y
operator|*
name|y
operator|+
name|tmpx
operator|+
name|cx
expr_stmt|;
name|y
operator|=
literal|2
operator|*
name|oldx
operator|*
name|oldy
operator|+
name|tmpy
operator|+
name|cy
expr_stmt|;
name|tmpx
operator|=
name|tmpx
operator|/
literal|2
operator|+
name|xx
expr_stmt|;
name|tmpy
operator|=
name|tmpy
operator|/
literal|2
operator|+
name|y
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|6
condition|)
block|{
comment|/*			ManOWarfpFractal() */
name|xx
operator|=
name|x
operator|*
name|x
operator|-
name|y
operator|*
name|y
operator|+
name|tmpx
operator|+
name|cx
expr_stmt|;
name|y
operator|=
literal|2.0
operator|*
name|x
operator|*
name|y
operator|+
name|tmpy
operator|+
name|cy
expr_stmt|;
name|tmpx
operator|=
name|oldx
expr_stmt|;
name|tmpy
operator|=
name|oldy
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|7
condition|)
block|{
comment|/* Lambda */
name|tempsqrx
operator|=
name|x
operator|*
name|x
expr_stmt|;
name|tempsqry
operator|=
name|y
operator|*
name|y
expr_stmt|;
name|tempsqrx
operator|=
name|oldx
operator|-
name|tempsqrx
operator|+
name|tempsqry
expr_stmt|;
name|tempsqry
operator|=
operator|-
operator|(
name|oldy
operator|*
name|oldx
operator|)
expr_stmt|;
name|tempsqry
operator|+=
name|tempsqry
operator|+
name|oldy
expr_stmt|;
name|xx
operator|=
name|cx
operator|*
name|tempsqrx
operator|-
name|cy
operator|*
name|tempsqry
expr_stmt|;
name|y
operator|=
name|cx
operator|*
name|tempsqry
operator|+
name|cy
operator|*
name|tempsqrx
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|wvals
operator|.
name|fractaltype
operator|==
literal|8
condition|)
block|{
comment|/* Sierpinski */
name|xx
operator|=
name|oldx
operator|+
name|oldx
expr_stmt|;
name|y
operator|=
name|oldy
operator|+
name|oldy
expr_stmt|;
if|if
condition|(
name|oldy
operator|>
literal|.5
condition|)
name|y
operator|=
name|y
operator|-
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|oldx
operator|>
literal|.5
condition|)
name|xx
operator|=
name|xx
operator|-
literal|1
expr_stmt|;
block|}
name|x
operator|=
name|xx
expr_stmt|;
block|}
name|color
operator|=
call|(
name|int
call|)
argument_list|(
name|zaehler
operator|*
literal|255.0
operator|/
name|iteration
argument_list|)
expr_stmt|;
name|dest_row
index|[
name|col
operator|*
name|bytes
index|]
operator|=
name|colormap
index|[
name|color
index|]
index|[
literal|0
index|]
expr_stmt|;
name|dest_row
index|[
name|col
operator|*
name|bytes
operator|+
literal|1
index|]
operator|=
name|colormap
index|[
name|color
index|]
index|[
literal|1
index|]
expr_stmt|;
name|dest_row
index|[
name|col
operator|*
name|bytes
operator|+
literal|2
index|]
operator|=
name|colormap
index|[
name|color
index|]
index|[
literal|2
index|]
expr_stmt|;
if|if
condition|(
name|bytes
operator|>
literal|3
condition|)
for|for
control|(
name|bytenum
operator|=
literal|3
init|;
name|bytenum
operator|<
name|bytes
condition|;
name|bytenum
operator|++
control|)
block|{
name|dest_row
index|[
name|col
operator|*
name|bytes
operator|+
name|bytenum
index|]
operator|=
name|src_row
index|[
name|col
operator|*
name|bytes
operator|+
name|bytenum
index|]
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  static gint rename_button_press(GtkWidget *widget, 		  GdkEventButton *event, 		  gpointer data) {   GtkWidget *list = (GtkWidget *)data;   GList * sellist;   fractalexplorerOBJ * sel_obj;    sellist = GTK_LIST(list)->selection;     sel_obj = (fractalexplorerOBJ *)gtk_object_get_user_data(GTK_OBJECT((GtkWidget *)(sellist->data)));    fractalexplorer_dialog_edit_list(widget,(gpointer) sel_obj,FALSE);   return(FALSE); } */
end_comment

begin_function
specifier|static
name|gint
DECL|function|delete_button_press_cancel (GtkWidget * widget,gpointer data)
name|delete_button_press_cancel
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|delete_dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|delete_frame_to_freeze
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|delete_dialog
operator|=
name|NULL
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|fractalexplorer_delete_fractalexplorer_callback (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|fractalexplorer_delete_fractalexplorer_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
name|GtkWidget
modifier|*
name|list
init|=
operator|(
name|GtkWidget
operator|*
operator|)
name|data
decl_stmt|;
name|GList
modifier|*
name|sellist
decl_stmt|;
name|fractalexplorerOBJ
modifier|*
name|sel_obj
decl_stmt|;
name|sellist
operator|=
name|GTK_LIST
argument_list|(
name|list
argument_list|)
operator|->
name|selection
expr_stmt|;
name|sel_obj
operator|=
operator|(
name|fractalexplorerOBJ
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
operator|(
name|GtkWidget
operator|*
operator|)
operator|(
name|sellist
operator|->
name|data
operator|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|delete_dialog
condition|)
return|return
operator|(
name|FALSE
operator|)
return|;
name|delete_dialog
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|delete_dialog
argument_list|)
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DELFRAC
index|]
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|delete_dialog
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|delete_dialog
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|delete_dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Question */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DELSURE
index|]
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
operator|(
name|strlen
argument_list|(
name|sel_obj
operator|->
name|draw_name
argument_list|)
operator|+
literal|32
operator|*
sizeof|sizeof
argument_list|(
name|char
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|str
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DELSURE2
index|]
argument_list|,
name|sel_obj
operator|->
name|draw_name
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
comment|/* Buttons */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DEL
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|delete_button_press_ok
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|delete_dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_CANCEL
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|delete_button_press_cancel
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|delete_dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Show! */
name|gtk_widget_set_sensitive
argument_list|(
name|GTK_WIDGET
argument_list|(
name|delete_frame_to_freeze
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|delete_dialog
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|fractalexplorer_save (void)
name|fractalexplorer_save
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* Save the current object */
if|if
condition|(
operator|!
name|current_obj
operator|->
name|filename
condition|)
block|{
name|create_file_selection
argument_list|(
name|current_obj
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return;
block|}
name|save_callback
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|gradient_list_button_press (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|gradient_list_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gradientOBJ
modifier|*
name|sel_obj
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|gchar
name|load_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
if|if
condition|(
name|event
operator|->
name|button
operator|==
literal|3
condition|)
block|{ 	}
break|break;
case|case
name|GDK_2BUTTON_PRESS
case|:
name|sel_obj
operator|=
operator|(
name|gradientOBJ
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|sel_obj
condition|)
block|{
if|if
condition|(
name|sel_obj
operator|->
name|obj_status
operator|&&
name|gradient_GRADIENTEDITOR
condition|)
block|{
name|wvals
operator|.
name|colormode
operator|=
literal|1
expr_stmt|;
name|gimp_gradients_set_active
argument_list|(
name|sel_obj
operator|->
name|name
argument_list|)
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|filename
operator|=
name|sel_obj
operator|->
name|filename
expr_stmt|;
name|g_assert
argument_list|(
name|filename
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_OPENERROR
index|]
argument_list|,
name|filename
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|get_line
argument_list|(
name|load_buf
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|fractalexplorer_HEADER
argument_list|,
name|load_buf
argument_list|,
name|strlen
argument_list|(
name|load_buf
argument_list|)
argument_list|)
condition|)
block|{
name|gchar
name|err
index|[
literal|256
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|err
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_WRONGFILETYPE
index|]
argument_list|,
name|sel_obj
operator|->
name|filename
argument_list|)
expr_stmt|;
name|create_warn_dialog
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
if|if
condition|(
name|gradient_load_options
argument_list|(
name|sel_obj
argument_list|,
name|fp
argument_list|)
condition|)
block|{
name|gchar
name|err
index|[
literal|256
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|err
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_CORRUPTFILE
index|]
argument_list|,
name|filename
argument_list|,
name|line_no
argument_list|)
expr_stmt|;
name|create_warn_dialog
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
operator|(
literal|0
operator|)
return|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
block|}
else|else
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_NULLLIST
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_UNKNOWN_EVENT
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_list_ok_callback (GtkWidget * w,gpointer client_data)
name|fractalexplorer_list_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|fractalexplorerListOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|list
decl_stmt|;
name|gint
name|pos
decl_stmt|;
name|options
operator|=
operator|(
name|fractalexplorerListOptions
operator|*
operator|)
name|client_data
expr_stmt|;
name|list
operator|=
name|options
operator|->
name|list_entry
expr_stmt|;
comment|/*  Set the new layer name  */
if|if
condition|(
name|options
operator|->
name|obj
operator|->
name|draw_name
condition|)
block|{
name|g_free
argument_list|(
name|options
operator|->
name|obj
operator|->
name|draw_name
argument_list|)
expr_stmt|;
block|}
name|options
operator|->
name|obj
operator|->
name|draw_name
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Need to reorder the list */
comment|/* gtk_label_set (GTK_LABEL (options->layer_widget->label), layer->name);*/
name|pos
operator|=
name|gtk_list_child_position
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|,
name|pos
argument_list|,
name|pos
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* remove/Add again */
name|fractalexplorer_list
operator|=
name|g_list_remove
argument_list|(
name|fractalexplorer_list
argument_list|,
name|options
operator|->
name|obj
argument_list|)
expr_stmt|;
name|fractalexplorer_list_add
argument_list|(
name|options
operator|->
name|obj
argument_list|)
expr_stmt|;
name|options
operator|->
name|obj
operator|->
name|obj_status
operator||=
name|fractalexplorer_MODIFIED
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_list_cancel_callback (GtkWidget * w,gpointer client_data)
name|fractalexplorer_list_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|fractalexplorerListOptions
modifier|*
name|options
decl_stmt|;
name|options
operator|=
operator|(
name|fractalexplorerListOptions
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|created
condition|)
block|{
comment|/* We are creating an entry so if cancelled must del the list item as well */
name|delete_button_press_ok
argument_list|(
name|w
argument_list|,
name|fractalexplorer_gtk_list
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_dialog_edit_list (GtkWidget * lwidget,fractalexplorerOBJ * obj,gint created)
name|fractalexplorer_dialog_edit_list
parameter_list|(
name|GtkWidget
modifier|*
name|lwidget
parameter_list|,
name|fractalexplorerOBJ
modifier|*
name|obj
parameter_list|,
name|gint
name|created
parameter_list|)
block|{
name|fractalexplorerListOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
comment|/*  the new options structure  */
name|options
operator|=
operator|(
name|fractalexplorerListOptions
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|fractalexplorerListOptions
argument_list|)
argument_list|)
expr_stmt|;
name|options
operator|->
name|list_entry
operator|=
name|lwidget
expr_stmt|;
name|options
operator|->
name|obj
operator|=
name|obj
expr_stmt|;
name|options
operator|->
name|created
operator|=
name|created
expr_stmt|;
comment|/*  the dialog  */
name|options
operator|->
name|query_box
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_EDIT_FRACNAME
index|]
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
comment|/*  the main vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  the name entry hbox, label and entry  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_FRACNAME
index|]
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|name_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|options
operator|->
name|name_entry
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|,
name|obj
operator|->
name|draw_name
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_OK
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|fractalexplorer_list_ok_callback
argument_list|,
name|options
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_CANCEL
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|fractalexplorer_list_cancel_callback
argument_list|,
name|options
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|new_fractalexplorer_obj (gchar * name)
name|new_fractalexplorer_obj
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
decl_stmt|;
name|GtkWidget
modifier|*
name|new_list_item
decl_stmt|;
comment|/* Create a new entry */
name|fractalexplorer
operator|=
name|fractalexplorer_new
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|name
condition|)
name|name
operator|=
name|msg
index|[
name|lng
index|]
index|[
name|MSG_NEWFRAC
index|]
expr_stmt|;
name|fractalexplorer
operator|->
name|draw_name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
comment|/* Leave options as before */
name|pic_obj
operator|=
name|current_obj
operator|=
name|fractalexplorer
expr_stmt|;
name|new_list_item
operator|=
name|fractalexplorer_list_add
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
comment|/*  obj_creating = tmp_line = NULL; */
comment|/* Redraw areas */
comment|/*  update_draw_area(fractalexplorer_preview,NULL); */
name|list_button_update
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
return|return
operator|(
name|new_list_item
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|new_button_press (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|new_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|new_list_item
decl_stmt|;
name|new_list_item
operator|=
name|new_fractalexplorer_obj
argument_list|(
operator|(
name|gchar
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
name|fractalexplorer_dialog_edit_list
argument_list|(
name|new_list_item
argument_list|,
name|current_obj
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_rescan_cancel_callback (GtkWidget * w,gpointer client_data)
name|fractalexplorer_rescan_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|clear_list_items (GtkList * list)
name|clear_list_items
parameter_list|(
name|GtkList
modifier|*
name|list
parameter_list|)
block|{
name|gtk_list_clear_items
argument_list|(
name|list
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Load all fractalexplorer, which are founded in fractalexplorer-path-list, into fractalexplorer_list.  * fractalexplorer-path-list must be initialized first. (plug_in_parse_fractalexplorer_path ())  * based on code from Gflare.  */
end_comment

begin_function
name|gint
DECL|function|fractalexplorer_list_pos (fractalexplorerOBJ * fractalexplorer)
name|fractalexplorer_list_pos
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
parameter_list|)
block|{
name|fractalexplorerOBJ
modifier|*
name|g
decl_stmt|;
name|int
name|n
decl_stmt|;
name|GList
modifier|*
name|tmp
decl_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|fractalexplorer_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|fractalexplorer
operator|->
name|draw_name
argument_list|,
name|g
operator|->
name|draw_name
argument_list|)
operator|<=
literal|0
condition|)
break|break;
name|n
operator|++
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
block|}
return|return
operator|(
name|n
operator|)
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gradient_list_pos (gradientOBJ * gradi)
name|gradient_list_pos
parameter_list|(
name|gradientOBJ
modifier|*
name|gradi
parameter_list|)
block|{
name|gradientOBJ
modifier|*
name|g
decl_stmt|;
name|int
name|n
decl_stmt|;
name|GList
modifier|*
name|tmp
decl_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gradient_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|gradi
operator|->
name|draw_name
argument_list|,
name|g
operator|->
name|draw_name
argument_list|)
operator|<=
literal|0
condition|)
break|break;
name|n
operator|++
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
block|}
return|return
operator|(
name|n
operator|)
return|;
block|}
end_function

begin_function
name|gint
DECL|function|fractalexplorer_list_insert (fractalexplorerOBJ * fractalexplorer)
name|fractalexplorer_list_insert
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
parameter_list|)
block|{
name|int
name|n
decl_stmt|;
comment|/*    *	Insert fractalexplorers in alphabetical order    */
name|n
operator|=
name|fractalexplorer_list_pos
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
name|fractalexplorer_list
operator|=
name|g_list_insert
argument_list|(
name|fractalexplorer_list
argument_list|,
name|fractalexplorer
argument_list|,
name|n
argument_list|)
expr_stmt|;
return|return
name|n
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gradient_list_insert (gradientOBJ * gradi)
name|gradient_list_insert
parameter_list|(
name|gradientOBJ
modifier|*
name|gradi
parameter_list|)
block|{
name|int
name|n
decl_stmt|;
comment|/*    *	Insert gradis in alphabetical order    */
name|n
operator|=
name|gradient_list_pos
argument_list|(
name|gradi
argument_list|)
expr_stmt|;
name|gradient_list
operator|=
name|g_list_insert
argument_list|(
name|gradient_list
argument_list|,
name|gradi
argument_list|,
name|n
argument_list|)
expr_stmt|;
return|return
name|n
return|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|fractalexplorer_list_item_new_with_label_and_pixmap (fractalexplorerOBJ * obj,gchar * label,GtkWidget * pix_widget)
name|fractalexplorer_list_item_new_with_label_and_pixmap
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|obj
parameter_list|,
name|gchar
modifier|*
name|label
parameter_list|,
name|GtkWidget
modifier|*
name|pix_widget
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|label_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|alignment
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|gtk_list_item_new
argument_list|()
expr_stmt|;
name|label_widget
operator|=
name|gtk_label_new
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label_widget
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|alignment
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|alignment
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|pix_widget
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label_widget
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|obj
operator|->
name|label_widget
operator|=
name|label_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|obj
operator|->
name|pixmap_widget
operator|=
name|pix_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|obj
operator|->
name|list_item
operator|=
name|list_item
argument_list|)
expr_stmt|;
return|return
name|list_item
return|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|gradient_list_item_new_with_label_and_pixmap (gradientOBJ * obj,gchar * label,GtkWidget * pix_widget)
name|gradient_list_item_new_with_label_and_pixmap
parameter_list|(
name|gradientOBJ
modifier|*
name|obj
parameter_list|,
name|gchar
modifier|*
name|label
parameter_list|,
name|GtkWidget
modifier|*
name|pix_widget
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|label_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|alignment
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|gtk_list_item_new
argument_list|()
expr_stmt|;
name|label_widget
operator|=
name|gtk_label_new
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label_widget
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|alignment
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|alignment
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|pix_widget
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label_widget
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|obj
operator|->
name|label_widget
operator|=
name|label_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|obj
operator|->
name|pixmap_widget
operator|=
name|pix_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|obj
operator|->
name|list_item
operator|=
name|list_item
argument_list|)
expr_stmt|;
return|return
name|list_item
return|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|fractalexplorer_new_pixmap (GtkWidget * list,char ** pixdata)
name|fractalexplorer_new_pixmap
parameter_list|(
name|GtkWidget
modifier|*
name|list
parameter_list|,
name|char
modifier|*
modifier|*
name|pixdata
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|pixmap_widget
decl_stmt|;
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
name|GdkColor
name|transparent
decl_stmt|;
name|GdkBitmap
modifier|*
name|mask
decl_stmt|;
name|pixmap
operator|=
name|gdk_pixmap_create_from_xpm_d
argument_list|(
name|list
operator|->
name|window
argument_list|,
operator|&
name|mask
argument_list|,
operator|&
name|transparent
argument_list|,
name|pixdata
argument_list|)
expr_stmt|;
name|pixmap_widget
operator|=
name|gtk_pixmap_new
argument_list|(
name|pixmap
argument_list|,
name|mask
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|pixmap_widget
argument_list|)
expr_stmt|;
return|return
operator|(
name|pixmap_widget
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|fractalexplorer_list_add (fractalexplorerOBJ * obj)
name|fractalexplorer_list_add
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|obj
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|gint
name|pos
decl_stmt|;
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|list_pix
decl_stmt|;
name|list_pix
operator|=
name|fractalexplorer_new_pixmap
argument_list|(
name|fractalexplorer_gtk_list
argument_list|,
name|Floppy6_xpm
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|fractalexplorer_list_item_new_with_label_and_pixmap
argument_list|(
name|obj
argument_list|,
name|obj
operator|->
name|draw_name
argument_list|,
name|list_pix
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|obj
argument_list|)
expr_stmt|;
name|pos
operator|=
name|fractalexplorer_list_insert
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_list_append
argument_list|(
name|NULL
argument_list|,
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|,
name|list
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"button_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|list_button_press
argument_list|,
operator|(
name|gpointer
operator|)
name|obj
argument_list|)
expr_stmt|;
return|return
operator|(
name|list_item
operator|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|list_button_update (fractalexplorerOBJ * obj)
name|list_button_update
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|obj
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|obj
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|pic_obj
operator|=
operator|(
name|fractalexplorerOBJ
operator|*
operator|)
name|obj
expr_stmt|;
comment|/* Draw xxxxxxxxxxxxxxxxxxxx */
block|}
end_function

begin_function
name|fractalexplorerOBJ
modifier|*
DECL|function|fractalexplorer_new (void)
name|fractalexplorer_new
parameter_list|(
name|void
parameter_list|)
block|{
name|fractalexplorerOBJ
modifier|*
name|new
decl_stmt|;
name|new
operator|=
name|g_new0
argument_list|(
name|fractalexplorerOBJ
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
operator|(
name|new
operator|)
return|;
block|}
end_function

begin_function
name|gradientOBJ
modifier|*
DECL|function|gradient_new (void)
name|gradient_new
parameter_list|(
name|void
parameter_list|)
block|{
name|gradientOBJ
modifier|*
name|new
decl_stmt|;
name|new
operator|=
name|g_new0
argument_list|(
name|gradientOBJ
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
operator|(
name|new
operator|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|build_list_items (GtkWidget * list)
name|build_list_items
parameter_list|(
name|GtkWidget
modifier|*
name|list
parameter_list|)
block|{
name|GList
modifier|*
name|tmp
init|=
name|fractalexplorer_list
decl_stmt|;
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|list_pix
decl_stmt|;
name|fractalexplorerOBJ
modifier|*
name|g
decl_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|g
operator|->
name|obj_status
operator|&
name|fractalexplorer_READONLY
condition|)
name|list_pix
operator|=
name|fractalexplorer_new_pixmap
argument_list|(
name|list
argument_list|,
name|mini_cross_xpm
argument_list|)
expr_stmt|;
else|else
name|list_pix
operator|=
name|fractalexplorer_new_pixmap
argument_list|(
name|list
argument_list|,
name|bluedot_xpm
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|fractalexplorer_list_item_new_with_label_and_pixmap
argument_list|(
name|g
argument_list|,
name|g
operator|->
name|draw_name
argument_list|,
name|list_pix
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|g
argument_list|)
expr_stmt|;
name|gtk_list_append_items
argument_list|(
name|GTK_LIST
argument_list|(
name|list
argument_list|)
argument_list|,
name|g_list_append
argument_list|(
name|NULL
argument_list|,
name|list_item
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"button_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|list_button_press
argument_list|,
operator|(
name|gpointer
operator|)
name|g
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gradient_build_list_items (GtkWidget * list)
name|gradient_build_list_items
parameter_list|(
name|GtkWidget
modifier|*
name|list
parameter_list|)
block|{
name|GList
modifier|*
name|tmp
init|=
name|gradient_list
decl_stmt|;
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|list_pix
decl_stmt|;
name|gradientOBJ
modifier|*
name|g
decl_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|g
operator|->
name|obj_status
operator|&
name|gradient_GRADIENTEDITOR
condition|)
name|list_pix
operator|=
name|fractalexplorer_new_pixmap
argument_list|(
name|list
argument_list|,
name|greendot_xpm
argument_list|)
expr_stmt|;
else|else
name|list_pix
operator|=
name|fractalexplorer_new_pixmap
argument_list|(
name|list
argument_list|,
name|bluedot_xpm
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|gradient_list_item_new_with_label_and_pixmap
argument_list|(
name|g
argument_list|,
name|g
operator|->
name|draw_name
argument_list|,
name|list_pix
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|g
argument_list|)
expr_stmt|;
name|gtk_list_append_items
argument_list|(
name|GTK_LIST
argument_list|(
name|list
argument_list|)
argument_list|,
name|g_list_append
argument_list|(
name|NULL
argument_list|,
name|list_item
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"button_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gradient_list_button_press
argument_list|,
operator|(
name|gpointer
operator|)
name|g
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  static void fractalexplorer_save_menu_callback(GtkWidget *widget, gpointer data) {   fractalexplorerOBJ * real_current = current_obj;    current_obj = fractalexplorer_obj_for_menu;    fractalexplorer_save();     current_obj = real_current; }  static void fractalexplorer_load_menu_callback(GtkWidget *widget, gpointer data) {       dialog_change_scale();       set_cmap_preview();       dialog_update_preview(); }  static void fractalexplorer_rename_menu_callback(GtkWidget *widget, gpointer data) {   create_file_selection(fractalexplorer_obj_for_menu,fractalexplorer_obj_for_menu->filename); }  static void fractalexplorer_copy_menu_callback(GtkWidget *widget, gpointer data) {   gchar *new_name = g_malloc(strlen(fractalexplorer_obj_for_menu->draw_name) + 6);    sprintf(new_name,msg[lng][MSG_COPYNAME],fractalexplorer_obj_for_menu->draw_name);   new_fractalexplorer_obj(new_name);   g_free(new_name);    current_obj->opts = fractalexplorer_obj_for_menu->opts;     update_draw_area(fractalexplorer_preview,NULL);   list_button_update(current_obj); }  */
end_comment

begin_comment
comment|/*  static void fractalexplorer_op_menu_create(GtkWidget *window) {   GtkWidget *menu_item;   GtkAcceleratorTable *accelerator_table;    fractalexplorer_op_menu = gtk_menu_new();    accelerator_table = gtk_accelerator_table_new();   gtk_menu_set_accelerator_table(GTK_MENU(fractalexplorer_op_menu), 				 accelerator_table);   gtk_window_add_accelerator_table(GTK_WINDOW(window),accelerator_table);    save_menu_item = menu_item = gtk_menu_item_new_with_label(msg[lng][MSG_SAVE]);   gtk_menu_append(GTK_MENU(fractalexplorer_op_menu),menu_item);   gtk_widget_show(menu_item);    gtk_signal_connect(GTK_OBJECT(menu_item),"activate", 		     (GtkSignalFunc)fractalexplorer_save_menu_callback, 		     NULL);    gtk_widget_install_accelerator(menu_item, 				 accelerator_table, 				"activate",'S',0);    menu_item = gtk_menu_item_new_with_label(msg[lng][MSG_SAVEAS]);   gtk_menu_append(GTK_MENU(fractalexplorer_op_menu),menu_item);   gtk_widget_show(menu_item);   gtk_signal_connect(GTK_OBJECT(menu_item),"activate", 		     (GtkSignalFunc)fractalexplorer_rename_menu_callback, 		     NULL);   gtk_widget_install_accelerator(menu_item, 				 accelerator_table, 				"activate",'A',0);    menu_item = gtk_menu_item_new_with_label(msg[lng][MSG_COPY]);   gtk_menu_append(GTK_MENU(fractalexplorer_op_menu),menu_item);   gtk_widget_show(menu_item);   gtk_signal_connect(GTK_OBJECT(menu_item),"activate", 		     (GtkSignalFunc)fractalexplorer_copy_menu_callback, 		     NULL);   gtk_widget_install_accelerator(menu_item, 				 accelerator_table, 				"activate",'C',0);    menu_item = gtk_menu_item_new_with_label(msg[lng][MSG_LOAD]);   gtk_menu_append(GTK_MENU(fractalexplorer_op_menu),menu_item);   gtk_widget_show(menu_item);   gtk_signal_connect(GTK_OBJECT(menu_item),"activate", 		     (GtkSignalFunc)fractalexplorer_load_menu_callback, 		     NULL);   gtk_widget_install_accelerator(menu_item, 				 accelerator_table, 				"activate",'L',0);  }   static void fractalexplorer_op_menu_popup(gint button, guint32 activate_time,fractalexplorerOBJ *obj) {   fractalexplorer_obj_for_menu = obj;     if(obj->obj_status& fractalexplorer_READONLY)     {       gtk_widget_set_sensitive(save_menu_item,FALSE);     }   else     {       gtk_widget_set_sensitive(save_menu_item,TRUE);     }    gtk_menu_popup(GTK_MENU(fractalexplorer_op_menu),NULL,NULL,NULL,NULL,button,activate_time); }  */
end_comment

begin_function
specifier|static
name|gint
DECL|function|list_button_press (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|list_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|fractalexplorerOBJ
modifier|*
name|sel_obj
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
comment|/*       if(event->button == 3) 	{ 	  fractalexplorer_op_menu_popup(event->button,event->time,(fractalexplorerOBJ *)data); 	  return(FALSE); 	} */
name|list_button_update
argument_list|(
operator|(
name|fractalexplorerOBJ
operator|*
operator|)
name|data
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_2BUTTON_PRESS
case|:
name|sel_obj
operator|=
operator|(
name|fractalexplorerOBJ
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|sel_obj
condition|)
block|{
name|current_obj
operator|=
name|sel_obj
expr_stmt|;
name|wvals
operator|=
name|current_obj
operator|->
name|opts
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
comment|/*    new_obj_2edit(sel_obj); */
else|else
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_NULLLIST
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_UNKNOWN_EVENT
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  *	Query gimprc for fractalexplorer-path, and parse it.  *	This code is based on script_fu_find_scripts ()  *      and the Gflare plugin.  */
end_comment

begin_function
name|void
DECL|function|plug_in_parse_fractalexplorer_path ()
name|plug_in_parse_fractalexplorer_path
parameter_list|()
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|gint
name|nreturn_vals
decl_stmt|;
name|gchar
modifier|*
name|path_string
decl_stmt|;
name|gchar
modifier|*
name|home
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
name|gchar
modifier|*
name|token
decl_stmt|;
name|struct
name|stat
name|filestat
decl_stmt|;
name|gint
name|err
decl_stmt|;
name|gchar
name|buf
index|[
literal|256
index|]
decl_stmt|;
if|if
condition|(
name|fractalexplorer_path_list
condition|)
name|g_list_free
argument_list|(
name|fractalexplorer_path_list
argument_list|)
expr_stmt|;
name|fractalexplorer_path_list
operator|=
name|NULL
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"gimp_gimprc_query"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_STRING
argument_list|,
literal|"fractalexplorer-path"
argument_list|,
name|PARAM_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|!=
name|STATUS_SUCCESS
operator|||
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
operator|==
name|NULL
condition|)
block|{
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_MISSING_GIMPRC
index|]
argument_list|)
expr_stmt|;
name|create_warn_dialog
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_MISSING_GIMPRC
index|]
argument_list|)
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
return|return;
block|}
name|path_string
operator|=
name|g_strdup
argument_list|(
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|)
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
comment|/* Set local path to contain temp_path, where (supposedly)    * there may be working files.    */
name|home
operator|=
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
expr_stmt|;
comment|/* Search through all directories in the  path */
name|token
operator|=
name|strtok
argument_list|(
name|path_string
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
while|while
condition|(
name|token
condition|)
block|{
if|if
condition|(
operator|*
name|token
operator|==
literal|'\0'
condition|)
block|{
name|token
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|*
name|token
operator|==
literal|'~'
condition|)
block|{
name|path
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|home
argument_list|)
operator|+
name|strlen
argument_list|(
name|token
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|path
argument_list|,
literal|"%s%s"
argument_list|,
name|home
argument_list|,
name|token
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|path
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|token
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|path
argument_list|,
name|token
argument_list|)
expr_stmt|;
block|}
comment|/* else */
comment|/* Check if directory exists */
name|err
operator|=
name|stat
argument_list|(
name|path
argument_list|,
operator|&
name|filestat
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
operator|&&
name|S_ISDIR
argument_list|(
name|filestat
operator|.
name|st_mode
argument_list|)
condition|)
block|{
if|if
condition|(
name|path
index|[
name|strlen
argument_list|(
name|path
argument_list|)
operator|-
literal|1
index|]
operator|!=
literal|'/'
condition|)
name|strcat
argument_list|(
name|path
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|fractalexplorer_path_list
operator|=
name|g_list_append
argument_list|(
name|fractalexplorer_path_list
argument_list|,
name|path
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sprintf
argument_list|(
name|buf
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_WRONGPATH
index|]
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|g_warning
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|create_warn_dialog
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|path_string
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|fractalexplorer_free (fractalexplorerOBJ * fractalexplorer)
name|fractalexplorer_free
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
parameter_list|)
block|{
name|g_assert
argument_list|(
name|fractalexplorer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|fractalexplorer
operator|->
name|name
condition|)
name|g_free
argument_list|(
name|fractalexplorer
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|fractalexplorer
operator|->
name|filename
condition|)
name|g_free
argument_list|(
name|fractalexplorer
operator|->
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|fractalexplorer
operator|->
name|draw_name
condition|)
name|g_free
argument_list|(
name|fractalexplorer
operator|->
name|draw_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_free (gradientOBJ * gradi)
name|gradient_free
parameter_list|(
name|gradientOBJ
modifier|*
name|gradi
parameter_list|)
block|{
name|g_assert
argument_list|(
name|gradi
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradi
operator|->
name|name
condition|)
name|g_free
argument_list|(
name|gradi
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradi
operator|->
name|filename
condition|)
name|g_free
argument_list|(
name|gradi
operator|->
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradi
operator|->
name|draw_name
condition|)
name|g_free
argument_list|(
name|gradi
operator|->
name|draw_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradi
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|fractalexplorer_free_everything (fractalexplorerOBJ * fractalexplorer)
name|fractalexplorer_free_everything
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
parameter_list|)
block|{
name|g_assert
argument_list|(
name|fractalexplorer
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|fractalexplorer
operator|->
name|filename
condition|)
block|{
name|remove
argument_list|(
name|fractalexplorer
operator|->
name|filename
argument_list|)
expr_stmt|;
block|}
name|fractalexplorer_free
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_free_everything (gradientOBJ * gradi)
name|gradient_free_everything
parameter_list|(
name|gradientOBJ
modifier|*
name|gradi
parameter_list|)
block|{
name|g_assert
argument_list|(
name|gradi
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradi
operator|->
name|filename
condition|)
block|{
name|remove
argument_list|(
name|gradi
operator|->
name|filename
argument_list|)
expr_stmt|;
block|}
name|gradient_free
argument_list|(
name|gradi
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|fractalexplorer_list_free_all ()
name|fractalexplorer_list_free_all
parameter_list|()
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
decl_stmt|;
name|list
operator|=
name|fractalexplorer_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|fractalexplorer
operator|=
operator|(
name|fractalexplorerOBJ
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|fractalexplorer_free
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|fractalexplorer_list
argument_list|)
expr_stmt|;
name|fractalexplorer_list
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_list_free_all ()
name|gradient_list_free_all
parameter_list|()
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|gradientOBJ
modifier|*
name|gradi
decl_stmt|;
name|list
operator|=
name|gradient_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|gradi
operator|=
operator|(
name|gradientOBJ
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|gradient_free
argument_list|(
name|gradi
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|gradient_list
argument_list|)
expr_stmt|;
name|gradient_list
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
name|fractalexplorerOBJ
modifier|*
DECL|function|fractalexplorer_load (gchar * filename,gchar * name)
name|fractalexplorer_load
parameter_list|(
name|gchar
modifier|*
name|filename
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gchar
name|load_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|g_assert
argument_list|(
name|filename
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_OPENERROR
index|]
argument_list|,
name|filename
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|fractalexplorer
operator|=
name|fractalexplorer_new
argument_list|()
expr_stmt|;
name|fractalexplorer
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|fractalexplorer
operator|->
name|draw_name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|fractalexplorer
operator|->
name|filename
operator|=
name|g_strdup
argument_list|(
name|filename
argument_list|)
expr_stmt|;
comment|/* HEADER    * draw_name    * version    * obj_list    */
name|get_line
argument_list|(
name|load_buf
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|fractalexplorer_HEADER
argument_list|,
name|load_buf
argument_list|,
name|strlen
argument_list|(
name|load_buf
argument_list|)
argument_list|)
condition|)
block|{
name|gchar
name|err
index|[
literal|256
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|err
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_WRONGFILETYPE
index|]
argument_list|,
name|fractalexplorer
operator|->
name|filename
argument_list|)
expr_stmt|;
name|create_warn_dialog
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
if|if
condition|(
name|load_options
argument_list|(
name|fractalexplorer
argument_list|,
name|fp
argument_list|)
condition|)
block|{
comment|/* waste some mem */
name|gchar
name|err
index|[
literal|256
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|err
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_CORRUPTFILE
index|]
argument_list|,
name|filename
argument_list|,
name|line_no
argument_list|)
expr_stmt|;
name|create_warn_dialog
argument_list|(
name|err
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pic_obj
condition|)
name|pic_obj
operator|=
name|fractalexplorer
expr_stmt|;
name|fractalexplorer
operator|->
name|obj_status
operator|=
name|fractalexplorer_OK
expr_stmt|;
return|return
operator|(
name|fractalexplorer
operator|)
return|;
block|}
end_function

begin_function
name|gradientOBJ
modifier|*
DECL|function|gradient_load (gchar * filename,gchar * name)
name|gradient_load
parameter_list|(
name|gchar
modifier|*
name|filename
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|gradientOBJ
modifier|*
name|gradi
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gchar
name|load_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|g_assert
argument_list|(
name|filename
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_OPENERROR
index|]
argument_list|,
name|filename
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|gradi
operator|=
name|gradient_new
argument_list|()
expr_stmt|;
name|gradi
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gradi
operator|->
name|draw_name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gradi
operator|->
name|filename
operator|=
name|g_strdup
argument_list|(
name|filename
argument_list|)
expr_stmt|;
comment|/* HEADER    * draw_name    * version    * obj_list    */
name|get_line
argument_list|(
name|load_buf
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|fractalexplorer_HEADER
argument_list|,
name|load_buf
argument_list|,
name|strlen
argument_list|(
name|load_buf
argument_list|)
argument_list|)
condition|)
block|{
name|gchar
name|err
index|[
literal|256
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|err
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_WRONGFILETYPE
index|]
argument_list|,
name|gradi
operator|->
name|filename
argument_list|)
expr_stmt|;
name|create_warn_dialog
argument_list|(
name|err
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
comment|/*         if(gradient_load_options(gradient,fp))     {       gchar err[256];       sprintf(err, 	      msg[lng][MSG_CORRUPTFILE], 	      filename, 	      line_no);       create_warn_dialog(err);       return(NULL);     } */
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
comment|/*   if(!pic_obj)     pic_obj = fractalexplorer;    fractalexplorer->obj_status = fractalexplorer_OK; */
return|return
operator|(
name|gradi
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_rescan_file_selection_ok (GtkWidget * w,GtkFileSelection * fs,gpointer data)
name|fractalexplorer_rescan_file_selection_ok
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|GtkFileSelection
modifier|*
name|fs
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|lw
init|=
operator|(
name|GtkWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|fs
argument_list|)
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|filenamebuf
decl_stmt|;
name|struct
name|stat
name|filestat
decl_stmt|;
name|gint
name|err
decl_stmt|;
name|filenamebuf
operator|=
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|fs
argument_list|)
argument_list|)
expr_stmt|;
name|err
operator|=
name|stat
argument_list|(
name|filenamebuf
argument_list|,
operator|&
name|filestat
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|S_ISDIR
argument_list|(
name|filestat
operator|.
name|st_mode
argument_list|)
condition|)
block|{
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_NOTDIR
index|]
argument_list|,
name|filenamebuf
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|list_item
operator|=
name|gtk_list_item_new_with_label
argument_list|(
name|filenamebuf
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_prepend_items
argument_list|(
name|GTK_LIST
argument_list|(
name|lw
argument_list|)
argument_list|,
name|g_list_append
argument_list|(
name|NULL
argument_list|,
name|list_item
argument_list|)
argument_list|)
expr_stmt|;
name|rescan_list
operator|=
name|g_list_prepend
argument_list|(
name|rescan_list
argument_list|,
name|g_strdup
argument_list|(
name|filenamebuf
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|fs
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|fractalexplorer_list_load_all (GList * plist)
name|fractalexplorer_list_load_all
parameter_list|(
name|GList
modifier|*
name|plist
parameter_list|)
block|{
name|fractalexplorerOBJ
modifier|*
name|fractalexplorer
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|DIR
modifier|*
name|dir
decl_stmt|;
name|struct
name|dirent
modifier|*
name|dir_ent
decl_stmt|;
name|struct
name|stat
name|filestat
decl_stmt|;
name|gint
name|err
decl_stmt|;
comment|/*  Make sure to clear any existing fractalexplorers  */
name|current_obj
operator|=
name|pic_obj
operator|=
name|NULL
expr_stmt|;
name|fractalexplorer_list_free_all
argument_list|()
expr_stmt|;
name|list
operator|=
name|plist
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|path
operator|=
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
comment|/* Open directory */
name|dir
operator|=
name|opendir
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dir
condition|)
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DIRREADERROR
index|]
argument_list|,
name|path
argument_list|)
expr_stmt|;
else|else
block|{
while|while
condition|(
operator|(
name|dir_ent
operator|=
name|readdir
argument_list|(
name|dir
argument_list|)
operator|)
condition|)
block|{
name|filename
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|path
argument_list|)
operator|+
name|strlen
argument_list|(
name|dir_ent
operator|->
name|d_name
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|filename
argument_list|,
literal|"%s%s"
argument_list|,
name|path
argument_list|,
name|dir_ent
operator|->
name|d_name
argument_list|)
expr_stmt|;
comment|/* Check the file and see that it is not a sub-directory */
name|err
operator|=
name|stat
argument_list|(
name|filename
argument_list|,
operator|&
name|filestat
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
operator|&&
name|S_ISREG
argument_list|(
name|filestat
operator|.
name|st_mode
argument_list|)
condition|)
block|{
name|fractalexplorer
operator|=
name|fractalexplorer_load
argument_list|(
name|filename
argument_list|,
name|dir_ent
operator|->
name|d_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|fractalexplorer
condition|)
block|{
comment|/* Read only ?*/
if|if
condition|(
name|access
argument_list|(
name|filename
argument_list|,
name|W_OK
argument_list|)
condition|)
name|fractalexplorer
operator|->
name|obj_status
operator||=
name|fractalexplorer_READONLY
expr_stmt|;
name|fractalexplorer_list_insert
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
block|}
block|}
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
comment|/* while */
name|closedir
argument_list|(
name|dir
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
if|if
condition|(
operator|!
name|fractalexplorer_list
condition|)
block|{
comment|/* lets have at least one! */
name|fractalexplorer
operator|=
name|fractalexplorer_new
argument_list|()
expr_stmt|;
name|fractalexplorer
operator|->
name|draw_name
operator|=
name|g_strdup
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_FIRSTFRACTAL
index|]
argument_list|)
expr_stmt|;
name|fractalexplorer_list_insert
argument_list|(
name|fractalexplorer
argument_list|)
expr_stmt|;
block|}
name|pic_obj
operator|=
name|current_obj
operator|=
name|fractalexplorer_list
operator|->
name|data
expr_stmt|;
comment|/* set to first entry */
block|}
end_function

begin_function
name|void
DECL|function|gradient_list_load_all (GList * plist)
name|gradient_list_load_all
parameter_list|(
name|GList
modifier|*
name|plist
parameter_list|)
block|{
name|gradientOBJ
modifier|*
name|gradi
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|char
modifier|*
modifier|*
name|gradients
init|=
name|NULL
decl_stmt|;
name|DIR
modifier|*
name|dir
decl_stmt|;
name|struct
name|dirent
modifier|*
name|dir_ent
decl_stmt|;
name|struct
name|stat
name|filestat
decl_stmt|;
name|gint
name|err
decl_stmt|;
name|gint
name|gradnumber
init|=
literal|200
decl_stmt|,
name|i
decl_stmt|;
comment|/*  Make sure to clear any existing gradients  */
name|gradient_list_free_all
argument_list|()
expr_stmt|;
name|list
operator|=
name|plist
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|path
operator|=
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
comment|/* Open directory */
name|dir
operator|=
name|opendir
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dir
condition|)
name|g_warning
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DIRREADERROR
index|]
argument_list|,
name|path
argument_list|)
expr_stmt|;
else|else
block|{
while|while
condition|(
operator|(
name|dir_ent
operator|=
name|readdir
argument_list|(
name|dir
argument_list|)
operator|)
condition|)
block|{
name|filename
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|path
argument_list|)
operator|+
name|strlen
argument_list|(
name|dir_ent
operator|->
name|d_name
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|filename
argument_list|,
literal|"%s%s"
argument_list|,
name|path
argument_list|,
name|dir_ent
operator|->
name|d_name
argument_list|)
expr_stmt|;
comment|/* Check the file and see that it is not a sub-directory */
name|err
operator|=
name|stat
argument_list|(
name|filename
argument_list|,
operator|&
name|filestat
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
operator|&&
name|S_ISREG
argument_list|(
name|filestat
operator|.
name|st_mode
argument_list|)
condition|)
block|{
name|gradi
operator|=
name|gradient_load
argument_list|(
name|filename
argument_list|,
name|dir_ent
operator|->
name|d_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradi
condition|)
block|{
name|gradient_list_insert
argument_list|(
name|gradi
argument_list|)
expr_stmt|;
block|}
block|}
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
comment|/* while */
name|closedir
argument_list|(
name|dir
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
name|gradients
operator|=
name|gimp_gradients_get_list
argument_list|(
operator|&
name|gradnumber
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|gradnumber
condition|;
name|i
operator|++
control|)
block|{
name|gradi
operator|=
name|gradient_new
argument_list|()
expr_stmt|;
name|gradi
operator|->
name|name
operator|=
name|gradi
operator|->
name|draw_name
operator|=
name|gradi
operator|->
name|filename
operator|=
name|gradients
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|gradi
condition|)
block|{
name|gradi
operator|->
name|obj_status
operator|=
name|gradient_GRADIENTEDITOR
expr_stmt|;
name|gradient_list_insert
argument_list|(
name|gradi
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|gradient_list
condition|)
block|{
comment|/* lets have at least one! */
name|gradi
operator|=
name|gradient_new
argument_list|()
expr_stmt|;
name|gradi
operator|->
name|draw_name
operator|=
name|g_strdup
argument_list|(
literal|"Gradient"
argument_list|)
expr_stmt|;
name|gradient_list_insert
argument_list|(
name|gradi
argument_list|)
expr_stmt|;
block|}
comment|/*  pic_obj = current_obj = gradient_list->data;  set to first entry */
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|add_objects_list ()
name|add_objects_list
parameter_list|()
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|list_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
name|GtkWidget
modifier|*
name|list
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_CHOOSE_FRACTAL
index|]
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|4
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
comment|/*  gtk_table_set_col_spacings(GTK_TABLE(table), 10); */
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|delete_frame_to_freeze
operator|=
name|list_frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|list_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_frame
argument_list|)
expr_stmt|;
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_frame
argument_list|)
argument_list|,
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_win
argument_list|)
expr_stmt|;
name|fractalexplorer_gtk_list
operator|=
name|list
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
comment|/* gtk_list_set_selection_mode (GTK_LIST (list), GTK_SELECTION_MULTIPLE); */
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|list
argument_list|)
argument_list|,
name|GTK_SELECTION_BROWSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list
argument_list|)
expr_stmt|;
comment|/* Load saved objects */
name|fractalexplorer_list_load_all
argument_list|(
name|fractalexplorer_path_list
argument_list|)
expr_stmt|;
comment|/* Put list in */
name|build_list_items
argument_list|(
name|list
argument_list|)
expr_stmt|;
comment|/* Put buttons in */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_RESCAN
index|]
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"button_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|rescan_button_press
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tooltips_set_tips
argument_list|(
name|tips
argument_list|,
name|button
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_RESCAN_COMMENT
index|]
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*     button = gtk_button_new_with_label (msg[lng][MSG_NEW]);   gtk_signal_connect (GTK_OBJECT (button), "button_press_event", 		      (GtkSignalFunc) new_button_press, 		      "My New Fractal");   gtk_widget_show(button);   gtk_tooltips_set_tips(tips,button,msg[lng][MSG_NEW_COMMENT]);    gtk_table_attach(GTK_TABLE(table), button, 0, 1, 1, 2, GTK_FILL, GTK_FILL, 0, 0);    button = gtk_button_new_with_label (msg[lng][MSG_RENAME]);   gtk_widget_show(button);   gtk_signal_connect (GTK_OBJECT (button), "button_press_event", 		      (GtkSignalFunc) rename_button_press, 		      (gpointer) list);   gtk_tooltips_set_tips(tips,button,msg[lng][MSG_RENAME_COMMENT]);    gtk_table_attach(GTK_TABLE(table), button, 2, 3, 2, 3, GTK_FILL, GTK_FILL,  0, 0); */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DEL
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"button_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|fractalexplorer_delete_fractalexplorer_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_tooltips_set_tips
argument_list|(
name|tips
argument_list|,
name|button
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_DELETE_COMMENT
index|]
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Attach the frame for the list Show the widgets */
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|list_frame
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|cmap_preview_long
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cmap_preview_long
argument_list|)
argument_list|,
name|GR_WIDTH
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|cmap_preview_long
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|cmap_preview_long
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
return|return
operator|(
name|frame
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|add_gradients_list ()
name|add_gradients_list
parameter_list|()
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|list_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
name|GtkWidget
modifier|*
name|list
decl_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_CHOOSE_GRADIENT
index|]
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|4
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
comment|/*  gtk_table_set_col_spacings(GTK_TABLE(table), 10); */
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|list_frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|list_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_frame
argument_list|)
expr_stmt|;
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_frame
argument_list|)
argument_list|,
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_win
argument_list|)
expr_stmt|;
name|list
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|list
argument_list|)
argument_list|,
name|GTK_SELECTION_BROWSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list
argument_list|)
expr_stmt|;
comment|/* Load saved objects */
name|gradient_list_load_all
argument_list|(
name|fractalexplorer_path_list
argument_list|)
expr_stmt|;
comment|/* Put list in */
name|gradient_build_list_items
argument_list|(
name|list
argument_list|)
expr_stmt|;
comment|/* Put buttons in    button = gtk_button_new_with_label (msg[lng][MSG_RESCAN]);   gtk_widget_show(button);   gtk_signal_connect (GTK_OBJECT (button), "button_press_event", 		      (GtkSignalFunc) rescan_button_press, 		      NULL);   gtk_tooltips_set_tips(tips,button,msg[lng][MSG_RESCAN_COMMENT]);    gtk_table_attach(GTK_TABLE(table), button, 2, 3, 0, 1, GTK_FILL, GTK_FILL,  0, 0);   */
comment|/* Attach the frame for the list Show the widgets */
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|list_frame
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|cmap_preview_long2
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cmap_preview_long2
argument_list|)
argument_list|,
name|GR_WIDTH
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|cmap_preview_long2
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|cmap_preview_long2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
return|return
operator|(
name|frame
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_rescan_ok_callback (GtkWidget * w,gpointer client_data)
name|fractalexplorer_rescan_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|list
operator|=
name|rescan_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|list
operator|=
name|fractalexplorer_path_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|rescan_list
operator|=
name|g_list_append
argument_list|(
name|rescan_list
argument_list|,
name|g_strdup
argument_list|(
name|list
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|clear_list_items
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|)
expr_stmt|;
name|fractalexplorer_list_load_all
argument_list|(
name|rescan_list
argument_list|)
expr_stmt|;
name|build_list_items
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
expr_stmt|;
name|list_button_update
argument_list|(
name|current_obj
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_rescan_add_entry_callback (GtkWidget * w,gpointer client_data)
name|fractalexplorer_rescan_add_entry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|window
init|=
name|NULL
decl_stmt|;
comment|/* Call up the file sel dialouge */
name|window
operator|=
name|gtk_file_selection_new
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_ADDPATH
index|]
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|client_data
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|destroy_window
argument_list|,
operator|&
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|window
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|fractalexplorer_rescan_file_selection_ok
argument_list|,
operator|(
name|gpointer
operator|)
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|window
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gtk_widget_destroy
argument_list|,
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|fractalexplorer_rescan_list (void)
name|fractalexplorer_rescan_list
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
name|GtkWidget
modifier|*
name|list_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
name|GtkWidget
modifier|*
name|list_widget
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
comment|/*  the dialog  */
name|dlg
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|msg
index|[
name|lng
index|]
index|[
name|MSG_RESCANTITLE1
index|]
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
comment|/*  the main vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* path list */
name|list_frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|list_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_frame
argument_list|)
expr_stmt|;
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_frame
argument_list|)
argument_list|,
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_win
argument_list|)
expr_stmt|;
name|list_widget
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|list_widget
argument_list|)
argument_list|,
name|GTK_SELECTION_BROWSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|list_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_widget
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|list_frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|list
operator|=
name|fractalexplorer_path_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|list_item
operator|=
name|gtk_list_item_new_with_label
argument_list|(
name|list
operator|->
name|data
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_widget
argument_list|)
argument_list|,
name|list_item
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_OK
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|fractalexplorer_rescan_ok_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dlg
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Clear the old list out */
if|if
condition|(
operator|(
name|list
operator|=
name|rescan_list
operator|)
condition|)
block|{
while|while
condition|(
name|list
condition|)
block|{
name|g_free
argument_list|(
name|list
operator|->
name|data
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|rescan_list
argument_list|)
expr_stmt|;
name|rescan_list
operator|=
name|NULL
expr_stmt|;
block|}
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_ADDDIR
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|fractalexplorer_rescan_add_entry_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|list_widget
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|list_widget
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|msg
index|[
name|lng
index|]
index|[
name|MSG_CANCEL
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|fractalexplorer_rescan_cancel_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dlg
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|rescan_button_press (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|rescan_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|fractalexplorer_rescan_list
argument_list|()
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|delete_button_press_ok (GtkWidget * widget,gpointer data)
name|delete_button_press_ok
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|pos
decl_stmt|;
name|GList
modifier|*
name|sellist
decl_stmt|;
name|fractalexplorerOBJ
modifier|*
name|sel_obj
decl_stmt|;
name|GtkWidget
modifier|*
name|list
init|=
operator|(
name|GtkWidget
operator|*
operator|)
name|data
decl_stmt|;
comment|/* Must update which object we are editing */
comment|/* Get the list and which item is selected */
comment|/* Only allow single selections */
name|sellist
operator|=
name|GTK_LIST
argument_list|(
name|list
argument_list|)
operator|->
name|selection
expr_stmt|;
name|sel_obj
operator|=
operator|(
name|fractalexplorerOBJ
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
operator|(
name|GtkWidget
operator|*
operator|)
operator|(
name|sellist
operator|->
name|data
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pos
operator|=
name|gtk_list_child_position
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|,
name|sellist
operator|->
name|data
argument_list|)
expr_stmt|;
comment|/* Delete the current  item + asssociated file */
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|,
name|pos
argument_list|,
name|pos
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* Shadow copy for ordering info */
name|fractalexplorer_list
operator|=
name|g_list_remove
argument_list|(
name|fractalexplorer_list
argument_list|,
name|sel_obj
argument_list|)
expr_stmt|;
comment|/*   if(sel_obj == current_obj)     {       clear_undo();     } */
comment|/* Free current obj */
name|fractalexplorer_free_everything
argument_list|(
name|sel_obj
argument_list|)
expr_stmt|;
comment|/* Select previous one */
name|pos
operator|--
expr_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|&&
name|g_list_length
argument_list|(
name|fractalexplorer_list
argument_list|)
operator|==
literal|0
condition|)
block|{
comment|/* Warning - we have a problem here        * since we are not really "creating an entry"        * why call fractalexplorer_new?        */
name|new_button_press
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|pos
operator|=
literal|0
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|delete_dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|delete_frame_to_freeze
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|delete_dialog
operator|=
name|NULL
expr_stmt|;
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|fractalexplorer_gtk_list
argument_list|)
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|current_obj
operator|=
name|g_list_nth
argument_list|(
name|fractalexplorer_list
argument_list|,
name|pos
argument_list|)
operator|->
name|data
expr_stmt|;
comment|/*   draw xxxxxxxxxxxxxxxx    update_draw_area(fractalexplorer_preview,NULL);   */
name|list_button_update
argument_list|(
name|current_obj
argument_list|)
expr_stmt|;
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

end_unit

