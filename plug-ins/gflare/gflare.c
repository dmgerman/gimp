begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * GFlare plug-in -- lense flare effect by using custom gradients  * Copyright (C) 1997 Eiichi Takamori<taka@ma1.sekyou.ne.jp>  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	 See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  *  *  * A fair proportion of this code was taken from GIMP& Script-fu  * copyrighted by Spencer Kimball and Peter Mattis, and from Gradient  * Editor copyrighted by Federico Mena Quintero. (See copyright notice  * below) Thanks for senior GIMP hackers!!  *  * The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * Gradient editor module copyight (C) 1996-1997 Federico Mena Quintero  * federico@nuclecu.unam.mx  */
end_comment

begin_comment
comment|/*   version 0.27   Changed so that it works with GIMP 1.1.x   Default problem solved   Still buggy (GTK!), please report all fixes to martin.weber@usa.net  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|RCSID
end_ifdef

begin_decl_stmt
DECL|variable|rcsid
specifier|static
name|char
name|rcsid
index|[]
init|=
literal|"$Id$"
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<ctype.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<dirent.h>
end_include

begin_include
include|#
directive|include
file|"gtk/gtk.h"
end_include

begin_include
include|#
directive|include
file|"../../libgimp/gimp.h"
end_include

begin_include
include|#
directive|include
file|"asupsample.h"
end_include

begin_include
include|#
directive|include
file|"gtkmultioptionmenu.h"
end_include

begin_comment
comment|/* #define DEBUG */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_define
DECL|macro|DEBUG_PRINT (X)
define|#
directive|define
name|DEBUG_PRINT
parameter_list|(
name|X
parameter_list|)
value|printf X
end_define

begin_else
else|#
directive|else
end_else

begin_define
DECL|macro|DEBUG_PRINT (X)
define|#
directive|define
name|DEBUG_PRINT
parameter_list|(
name|X
parameter_list|)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|BOUNDS (a,x,y)
define|#
directive|define
name|BOUNDS
parameter_list|(
name|a
parameter_list|,
name|x
parameter_list|,
name|y
parameter_list|)
value|((a< x) ? x : ((a> y) ? y : a))
end_define

begin_define
DECL|macro|LUMINOSITY (PIX)
define|#
directive|define
name|LUMINOSITY
parameter_list|(
name|PIX
parameter_list|)
value|(PIX[0] * 0.30 + PIX[1] * 0.59 + PIX[2] * 0.11)
end_define

begin_define
DECL|macro|OFFSETOF (t,f)
define|#
directive|define
name|OFFSETOF
parameter_list|(
name|t
parameter_list|,
name|f
parameter_list|)
value|((int) ((char*)&((t*) 0)->f))
end_define

begin_define
DECL|macro|GRADIENT_NAME_MAX
define|#
directive|define
name|GRADIENT_NAME_MAX
value|256
end_define

begin_define
DECL|macro|GRADIENT_RESOLUTION
define|#
directive|define
name|GRADIENT_RESOLUTION
value|360
end_define

begin_define
DECL|macro|GFLARE_NAME_MAX
define|#
directive|define
name|GFLARE_NAME_MAX
value|256
end_define

begin_define
DECL|macro|GFLARE_FILE_HEADER
define|#
directive|define
name|GFLARE_FILE_HEADER
value|"GIMP GFlare 0.25\n"
end_define

begin_define
DECL|macro|SFLARE_NUM
define|#
directive|define
name|SFLARE_NUM
value|30
end_define

begin_define
DECL|macro|DLG_PREVIEW_WIDTH
define|#
directive|define
name|DLG_PREVIEW_WIDTH
value|256
end_define

begin_define
DECL|macro|DLG_PREVIEW_HEIGHT
define|#
directive|define
name|DLG_PREVIEW_HEIGHT
value|256
end_define

begin_define
DECL|macro|DLG_PREVIEW_MASK
define|#
directive|define
name|DLG_PREVIEW_MASK
value|GDK_EXPOSURE_MASK | \ 			   GDK_BUTTON_PRESS_MASK
end_define

begin_define
DECL|macro|DLG_LISTBOX_WIDTH
define|#
directive|define
name|DLG_LISTBOX_WIDTH
value|80
end_define

begin_define
DECL|macro|DLG_LISTBOX_HEIGHT
define|#
directive|define
name|DLG_LISTBOX_HEIGHT
value|40
end_define

begin_define
DECL|macro|ED_PREVIEW_WIDTH
define|#
directive|define
name|ED_PREVIEW_WIDTH
value|256
end_define

begin_define
DECL|macro|ED_PREVIEW_HEIGHT
define|#
directive|define
name|ED_PREVIEW_HEIGHT
value|256
end_define

begin_define
DECL|macro|GM_PREVIEW_WIDTH
define|#
directive|define
name|GM_PREVIEW_WIDTH
value|80
end_define

begin_define
DECL|macro|GM_PREVIEW_HEIGHT
define|#
directive|define
name|GM_PREVIEW_HEIGHT
value|16
end_define

begin_define
DECL|macro|GM_MENU_MAX
define|#
directive|define
name|GM_MENU_MAX
value|20
end_define

begin_define
DECL|macro|ENTSCALE_SCALE_WIDTH
define|#
directive|define
name|ENTSCALE_SCALE_WIDTH
value|100
end_define

begin_define
DECL|macro|ENTSCALE_ENTRY_WIDTH
define|#
directive|define
name|ENTSCALE_ENTRY_WIDTH
value|50
end_define

begin_define
DECL|macro|ENTRY_WIDTH
define|#
directive|define
name|ENTRY_WIDTH
value|40
end_define

begin_define
DECL|macro|CHECK_SIZE
define|#
directive|define
name|CHECK_SIZE
value|4
end_define

begin_define
DECL|macro|LIGHTCHECK
define|#
directive|define
name|LIGHTCHECK
value|192
end_define

begin_define
DECL|macro|DARKCHECK
define|#
directive|define
name|DARKCHECK
value|128
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|OPAQUE
end_ifndef

begin_define
DECL|macro|OPAQUE
define|#
directive|define
name|OPAQUE
value|255
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|GRAY50
define|#
directive|define
name|GRAY50
value|128
end_define

begin_comment
comment|/* drawable coord to preview coord */
end_comment

begin_define
DECL|macro|DX2PX (DX)
define|#
directive|define
name|DX2PX
parameter_list|(
name|DX
parameter_list|)
value|((double) PREVIEW_WIDTH * ((DX) - dinfo->win.x0) / (dinfo->win.x1 - dinfo->win.x0))
end_define

begin_define
DECL|macro|DY2PY (DY)
define|#
directive|define
name|DY2PY
parameter_list|(
name|DY
parameter_list|)
value|((double) PREVIEW_HEIGHT * ((DY) - dinfo->win.y0) / (dinfo->win.y1 - dinfo->win.y0))
end_define

begin_define
DECL|macro|GRADIENT_CACHE_SIZE
define|#
directive|define
name|GRADIENT_CACHE_SIZE
value|32
end_define

begin_define
DECL|macro|CALC_GLOW
define|#
directive|define
name|CALC_GLOW
value|0x01
end_define

begin_define
DECL|macro|CALC_RAYS
define|#
directive|define
name|CALC_RAYS
value|0x02
end_define

begin_define
DECL|macro|CALC_SFLARE
define|#
directive|define
name|CALC_SFLARE
value|0x04
end_define

begin_typedef
DECL|typedef|Preview
typedef|typedef
name|struct
name|_Preview
name|Preview
typedef|;
end_typedef

begin_typedef
DECL|typedef|GradientName
typedef|typedef
name|gchar
name|GradientName
index|[
name|GRADIENT_NAME_MAX
index|]
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon28e4550f0103
block|{
DECL|enumerator|GF_NORMAL
name|GF_NORMAL
init|=
literal|0
block|,
DECL|enumerator|GF_ADDITION
name|GF_ADDITION
block|,
DECL|enumerator|GF_OVERLAY
name|GF_OVERLAY
block|,
DECL|enumerator|GF_SCREEN
name|GF_SCREEN
block|,
DECL|enumerator|GF_NUM_MODES
name|GF_NUM_MODES
DECL|typedef|GFlareMode
block|}
name|GFlareMode
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon28e4550f0203
block|{
DECL|enumerator|GF_CIRCLE
name|GF_CIRCLE
init|=
literal|0
block|,
DECL|enumerator|GF_POLYGON
name|GF_POLYGON
block|,
DECL|enumerator|GF_NUM_SHAPES
name|GF_NUM_SHAPES
DECL|typedef|GFlareShape
block|}
name|GFlareShape
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28e4550f0308
typedef|typedef
struct|struct
block|{
DECL|member|name
name|gchar
modifier|*
name|name
decl_stmt|;
DECL|member|filename
name|gchar
modifier|*
name|filename
decl_stmt|;
DECL|member|glow_opacity
name|gdouble
name|glow_opacity
decl_stmt|;
DECL|member|glow_mode
name|GFlareMode
name|glow_mode
decl_stmt|;
DECL|member|rays_opacity
name|gdouble
name|rays_opacity
decl_stmt|;
DECL|member|rays_mode
name|GFlareMode
name|rays_mode
decl_stmt|;
DECL|member|sflare_opacity
name|gdouble
name|sflare_opacity
decl_stmt|;
DECL|member|sflare_mode
name|GFlareMode
name|sflare_mode
decl_stmt|;
DECL|member|glow_radial
name|GradientName
name|glow_radial
decl_stmt|;
DECL|member|glow_angular
name|GradientName
name|glow_angular
decl_stmt|;
DECL|member|glow_angular_size
name|GradientName
name|glow_angular_size
decl_stmt|;
DECL|member|glow_size
name|gdouble
name|glow_size
decl_stmt|;
DECL|member|glow_rotation
name|gdouble
name|glow_rotation
decl_stmt|;
DECL|member|glow_hue
name|gdouble
name|glow_hue
decl_stmt|;
DECL|member|rays_radial
name|GradientName
name|rays_radial
decl_stmt|;
DECL|member|rays_angular
name|GradientName
name|rays_angular
decl_stmt|;
DECL|member|rays_angular_size
name|GradientName
name|rays_angular_size
decl_stmt|;
DECL|member|rays_size
name|gdouble
name|rays_size
decl_stmt|;
DECL|member|rays_rotation
name|gdouble
name|rays_rotation
decl_stmt|;
DECL|member|rays_hue
name|gdouble
name|rays_hue
decl_stmt|;
DECL|member|rays_nspikes
name|gint
name|rays_nspikes
decl_stmt|;
DECL|member|rays_thickness
name|gdouble
name|rays_thickness
decl_stmt|;
DECL|member|sflare_radial
name|GradientName
name|sflare_radial
decl_stmt|;
DECL|member|sflare_sizefac
name|GradientName
name|sflare_sizefac
decl_stmt|;
DECL|member|sflare_probability
name|GradientName
name|sflare_probability
decl_stmt|;
DECL|member|sflare_size
name|gdouble
name|sflare_size
decl_stmt|;
DECL|member|sflare_rotation
name|gdouble
name|sflare_rotation
decl_stmt|;
DECL|member|sflare_hue
name|gdouble
name|sflare_hue
decl_stmt|;
DECL|member|sflare_shape
name|GFlareShape
name|sflare_shape
decl_stmt|;
DECL|member|sflare_nverts
name|gint
name|sflare_nverts
decl_stmt|;
DECL|member|sflare_seed
name|gint
name|sflare_seed
decl_stmt|;
DECL|typedef|GFlare
block|}
name|GFlare
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28e4550f0408
typedef|typedef
struct|struct
block|{
DECL|member|fp
name|FILE
modifier|*
name|fp
decl_stmt|;
DECL|member|error
name|int
name|error
decl_stmt|;
DECL|typedef|GFlareFile
block|}
name|GFlareFile
typedef|;
end_typedef

begin_typedef
DECL|enum|__anon28e4550f0503
typedef|typedef
enum|enum
block|{
DECL|enumerator|PAGE_SETTINGS
name|PAGE_SETTINGS
block|,
DECL|enumerator|PAGE_SELECTOR
name|PAGE_SELECTOR
block|,
DECL|enumerator|PAGE_GENERAL
name|PAGE_GENERAL
block|,
DECL|enumerator|PAGE_GLOW
name|PAGE_GLOW
block|,
DECL|enumerator|PAGE_RAYS
name|PAGE_RAYS
block|,
DECL|enumerator|PAGE_SFLARE
name|PAGE_SFLARE
DECL|typedef|PageNum
block|}
name|PageNum
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28e4550f0608
typedef|typedef
struct|struct
block|{
DECL|member|init
name|gint
name|init
decl_stmt|;
DECL|member|gflare
name|GFlare
modifier|*
name|gflare
decl_stmt|;
DECL|member|shell
name|GtkWidget
modifier|*
name|shell
decl_stmt|;
DECL|member|preview
name|Preview
modifier|*
name|preview
decl_stmt|;
DECL|struct|__anon28e4550f0708
struct|struct
block|{
DECL|member|x0
DECL|member|y0
DECL|member|x1
DECL|member|y1
name|gdouble
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
DECL|member|pwin
block|}
name|pwin
struct|;
DECL|member|update_preview
name|gint
name|update_preview
decl_stmt|;
DECL|member|notebook
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
DECL|member|xentry
name|GtkWidget
modifier|*
name|xentry
decl_stmt|;
DECL|member|xentry_id
name|gint
name|xentry_id
decl_stmt|;
DECL|member|yentry
name|GtkWidget
modifier|*
name|yentry
decl_stmt|;
DECL|member|yentry_id
name|gint
name|yentry_id
decl_stmt|;
DECL|member|asupsample_frame
name|GtkWidget
modifier|*
name|asupsample_frame
decl_stmt|;
DECL|member|selector_list
name|GtkWidget
modifier|*
name|selector_list
decl_stmt|;
DECL|member|init_params_done
name|gint
name|init_params_done
decl_stmt|;
DECL|typedef|GFlareDialog
block|}
name|GFlareDialog
typedef|;
end_typedef

begin_typedef
DECL|typedef|GFlareEditorCallback
typedef|typedef
name|void
function_decl|(
modifier|*
name|GFlareEditorCallback
function_decl|)
parameter_list|(
name|gint
name|updated
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_typedef

begin_typedef
DECL|struct|__anon28e4550f0808
typedef|typedef
struct|struct
block|{
DECL|member|init
name|gint
name|init
decl_stmt|;
DECL|member|run
name|gint
name|run
decl_stmt|;
DECL|member|callback
name|GFlareEditorCallback
name|callback
decl_stmt|;
DECL|member|calldata
name|gpointer
name|calldata
decl_stmt|;
DECL|member|target_gflare
name|GFlare
modifier|*
name|target_gflare
decl_stmt|;
DECL|member|gflare
name|GFlare
modifier|*
name|gflare
decl_stmt|;
DECL|member|shell
name|GtkWidget
modifier|*
name|shell
decl_stmt|;
DECL|member|preview
name|Preview
modifier|*
name|preview
decl_stmt|;
DECL|member|notebook
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
DECL|member|cur_page
name|PageNum
name|cur_page
decl_stmt|;
DECL|member|polygon_entry
name|GtkWidget
modifier|*
name|polygon_entry
decl_stmt|;
DECL|member|polygon_toggle
name|GtkWidget
modifier|*
name|polygon_toggle
decl_stmt|;
DECL|member|init_params_done
name|gint
name|init_params_done
decl_stmt|;
DECL|typedef|GFlareEditor
block|}
name|GFlareEditor
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28e4550f0908
block|{
DECL|member|x0
name|gdouble
name|x0
decl_stmt|;
DECL|member|y0
name|gdouble
name|y0
decl_stmt|;
DECL|member|x1
name|gdouble
name|x1
decl_stmt|;
DECL|member|y1
name|gdouble
name|y1
decl_stmt|;
DECL|typedef|CalcBounds
block|}
name|CalcBounds
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28e4550f0a08
block|{
DECL|member|init
name|gint
name|init
decl_stmt|;
DECL|member|type
name|gint
name|type
decl_stmt|;
DECL|member|gflare
name|GFlare
modifier|*
name|gflare
decl_stmt|;
DECL|member|xcenter
name|gdouble
name|xcenter
decl_stmt|;
DECL|member|ycenter
name|gdouble
name|ycenter
decl_stmt|;
DECL|member|radius
name|gdouble
name|radius
decl_stmt|;
DECL|member|rotation
name|gdouble
name|rotation
decl_stmt|;
DECL|member|hue
name|gdouble
name|hue
decl_stmt|;
DECL|member|vangle
name|gdouble
name|vangle
decl_stmt|;
DECL|member|vlength
name|gdouble
name|vlength
decl_stmt|;
DECL|member|glow_opacity
name|gint
name|glow_opacity
decl_stmt|;
DECL|member|glow_bounds
name|CalcBounds
name|glow_bounds
decl_stmt|;
DECL|member|glow_radial
name|guchar
modifier|*
name|glow_radial
decl_stmt|;
DECL|member|glow_angular
name|guchar
modifier|*
name|glow_angular
decl_stmt|;
DECL|member|glow_angular_size
name|guchar
modifier|*
name|glow_angular_size
decl_stmt|;
DECL|member|glow_radius
name|gdouble
name|glow_radius
decl_stmt|;
DECL|member|glow_rotation
name|gdouble
name|glow_rotation
decl_stmt|;
DECL|member|rays_opacity
name|gint
name|rays_opacity
decl_stmt|;
DECL|member|rays_bounds
name|CalcBounds
name|rays_bounds
decl_stmt|;
DECL|member|rays_radial
name|guchar
modifier|*
name|rays_radial
decl_stmt|;
DECL|member|rays_angular
name|guchar
modifier|*
name|rays_angular
decl_stmt|;
DECL|member|rays_angular_size
name|guchar
modifier|*
name|rays_angular_size
decl_stmt|;
DECL|member|rays_radius
name|gdouble
name|rays_radius
decl_stmt|;
DECL|member|rays_rotation
name|gdouble
name|rays_rotation
decl_stmt|;
DECL|member|rays_spike_mod
name|gdouble
name|rays_spike_mod
decl_stmt|;
DECL|member|rays_thinness
name|gdouble
name|rays_thinness
decl_stmt|;
DECL|member|sflare_opacity
name|gint
name|sflare_opacity
decl_stmt|;
DECL|member|sflare_list
name|GList
modifier|*
name|sflare_list
decl_stmt|;
DECL|member|sflare_radial
name|guchar
modifier|*
name|sflare_radial
decl_stmt|;
DECL|member|sflare_sizefac
name|guchar
modifier|*
name|sflare_sizefac
decl_stmt|;
DECL|member|sflare_probability
name|guchar
modifier|*
name|sflare_probability
decl_stmt|;
DECL|member|sflare_radius
name|gdouble
name|sflare_radius
decl_stmt|;
DECL|member|sflare_rotation
name|gdouble
name|sflare_rotation
decl_stmt|;
DECL|member|sflare_shape
name|GFlareShape
name|sflare_shape
decl_stmt|;
DECL|member|sflare_angle
name|gdouble
name|sflare_angle
decl_stmt|;
DECL|member|sflare_factor
name|gdouble
name|sflare_factor
decl_stmt|;
DECL|typedef|CalcParams
block|}
name|CalcParams
typedef|;
end_typedef

begin_comment
comment|/*  * What's the difference between (structure) CalcParams and GFlare ?  * well, radius and lengths are actual length for CalcParams where  * they are typically 0 to 100 for GFlares, and angles are M_PI based  * (radian) for CalcParams where they are degree for GFlares. et cetra.  * This is because convienience for dialog processing and for calculating.  * these conversion is taken place in calc init routines. see below.  */
end_comment

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28e4550f0b08
block|{
DECL|member|xcenter
name|gdouble
name|xcenter
decl_stmt|;
DECL|member|ycenter
name|gdouble
name|ycenter
decl_stmt|;
DECL|member|radius
name|gdouble
name|radius
decl_stmt|;
DECL|member|bounds
name|CalcBounds
name|bounds
decl_stmt|;
DECL|typedef|CalcSFlare
block|}
name|CalcSFlare
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28e4550f0c08
block|{
DECL|member|is_color
name|gint
name|is_color
decl_stmt|;
DECL|member|has_alpha
name|gint
name|has_alpha
decl_stmt|;
DECL|member|x1
DECL|member|y1
DECL|member|x2
DECL|member|y2
name|gint
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
comment|/* mask bounds */
DECL|member|tile_width
DECL|member|tile_height
name|gint
name|tile_width
decl_stmt|,
name|tile_height
decl_stmt|;
comment|/* these values don't belong to drawable, though. */
DECL|typedef|DrawableInfo
block|}
name|DrawableInfo
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28e4550f0d08
block|{
DECL|member|tile
name|GTile
modifier|*
name|tile
decl_stmt|;
DECL|member|col
name|gint
name|col
decl_stmt|;
DECL|member|row
name|gint
name|row
decl_stmt|;
DECL|member|shadow
name|gint
name|shadow
decl_stmt|;
DECL|member|dirty
name|gint
name|dirty
decl_stmt|;
DECL|typedef|TileKeeper
block|}
name|TileKeeper
typedef|;
end_typedef

begin_typedef
DECL|typedef|GradientMenu
typedef|typedef
name|struct
name|_GradientMenu
name|GradientMenu
typedef|;
end_typedef

begin_typedef
DECL|typedef|GradientMenuCallback
typedef|typedef
name|void
function_decl|(
modifier|*
name|GradientMenuCallback
function_decl|)
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_typedef

begin_struct
DECL|struct|_GradientMenu
struct|struct
name|_GradientMenu
block|{
DECL|member|preview
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
DECL|member|option_menu
name|GtkWidget
modifier|*
name|option_menu
decl_stmt|;
DECL|member|callback
name|GradientMenuCallback
name|callback
decl_stmt|;
DECL|member|callback_data
name|gpointer
name|callback_data
decl_stmt|;
DECL|member|gradient_name
name|GradientName
name|gradient_name
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|PreviewInitFunc
typedef|typedef
name|gint
function_decl|(
modifier|*
name|PreviewInitFunc
function_decl|)
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_typedef

begin_typedef
DECL|typedef|PreviewRenderFunc
typedef|typedef
name|void
function_decl|(
modifier|*
name|PreviewRenderFunc
function_decl|)
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_typedef

begin_typedef
DECL|typedef|PreviewDeinitFunc
typedef|typedef
name|void
function_decl|(
modifier|*
name|PreviewDeinitFunc
function_decl|)
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_typedef

begin_struct
DECL|struct|_Preview
struct|struct
name|_Preview
block|{
DECL|member|widget
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
DECL|member|width
name|gint
name|width
decl_stmt|;
DECL|member|height
name|gint
name|height
decl_stmt|;
DECL|member|init_func
name|PreviewInitFunc
name|init_func
decl_stmt|;
DECL|member|init_data
name|gpointer
name|init_data
decl_stmt|;
DECL|member|render_func
name|PreviewRenderFunc
name|render_func
decl_stmt|;
DECL|member|render_data
name|gpointer
name|render_data
decl_stmt|;
DECL|member|deinit_func
name|PreviewDeinitFunc
name|deinit_func
decl_stmt|;
DECL|member|deinit_data
name|gpointer
name|deinit_data
decl_stmt|;
DECL|member|timeout_tag
name|guint
name|timeout_tag
decl_stmt|;
DECL|member|idle_tag
name|guint
name|idle_tag
decl_stmt|;
DECL|member|init_done
name|gint
name|init_done
decl_stmt|;
DECL|member|current_y
name|gint
name|current_y
decl_stmt|;
DECL|member|drawn_y
name|gint
name|drawn_y
decl_stmt|;
DECL|member|buffer
name|guchar
modifier|*
name|buffer
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/* Preview */
end_comment

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28e4550f0e08
block|{
DECL|member|tag
name|gint
name|tag
decl_stmt|;
DECL|member|got_gradients
name|gint
name|got_gradients
decl_stmt|;
DECL|member|current_y
name|gint
name|current_y
decl_stmt|;
DECL|member|drawn_y
name|gint
name|drawn_y
decl_stmt|;
DECL|member|render_func
name|PreviewRenderFunc
name|render_func
decl_stmt|;
DECL|member|buffer
name|guchar
modifier|*
name|buffer
decl_stmt|;
DECL|typedef|PreviewIdle
block|}
name|PreviewIdle
typedef|;
end_typedef

begin_typedef
DECL|typedef|GradientCacheItem
typedef|typedef
name|struct
name|_GradientCacheItem
name|GradientCacheItem
typedef|;
end_typedef

begin_struct
DECL|struct|_GradientCacheItem
struct|struct
name|_GradientCacheItem
block|{
DECL|member|next
name|GradientCacheItem
modifier|*
name|next
decl_stmt|;
DECL|member|prev
name|GradientCacheItem
modifier|*
name|prev
decl_stmt|;
DECL|member|name
name|GradientName
name|name
decl_stmt|;
DECL|member|values
name|guchar
name|values
index|[
literal|4
operator|*
name|GRADIENT_RESOLUTION
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|enum|__anon28e4550f0f03
typedef|typedef
enum|enum
block|{
DECL|enumerator|ENTSCALE_INT
name|ENTSCALE_INT
block|,
DECL|enumerator|ENTSCALE_DOUBLE
name|ENTSCALE_DOUBLE
DECL|typedef|EntscaleType
block|}
name|EntscaleType
typedef|;
end_typedef

begin_typedef
DECL|typedef|EntscaleCallbackFunc
typedef|typedef
name|void
function_decl|(
modifier|*
name|EntscaleCallbackFunc
function_decl|)
parameter_list|(
name|gdouble
name|new_val
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_typedef

begin_typedef
DECL|struct|__anon28e4550f1008
typedef|typedef
struct|struct
block|{
DECL|member|adjustment
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
DECL|member|entry
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
DECL|member|type
name|EntscaleType
name|type
decl_stmt|;
DECL|member|fmt_string
name|gchar
name|fmt_string
index|[
literal|16
index|]
decl_stmt|;
DECL|member|constraint
name|gint
name|constraint
decl_stmt|;
DECL|member|callback
name|EntscaleCallbackFunc
name|callback
decl_stmt|;
DECL|member|call_data
name|gpointer
name|call_data
decl_stmt|;
DECL|typedef|Entscale
block|}
name|Entscale
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28e4550f1108
typedef|typedef
struct|struct
block|{
DECL|member|xcenter
name|gint
name|xcenter
decl_stmt|;
DECL|member|ycenter
name|gint
name|ycenter
decl_stmt|;
DECL|member|radius
name|gdouble
name|radius
decl_stmt|;
DECL|member|rotation
name|gdouble
name|rotation
decl_stmt|;
DECL|member|hue
name|gdouble
name|hue
decl_stmt|;
DECL|member|vangle
name|gdouble
name|vangle
decl_stmt|;
DECL|member|vlength
name|gdouble
name|vlength
decl_stmt|;
DECL|member|use_asupsample
name|gint
name|use_asupsample
decl_stmt|;
DECL|member|asupsample_max_depth
name|gint
name|asupsample_max_depth
decl_stmt|;
DECL|member|asupsample_threshold
name|gdouble
name|asupsample_threshold
decl_stmt|;
DECL|member|gflare_name
name|gchar
name|gflare_name
index|[
name|GFLARE_NAME_MAX
index|]
decl_stmt|;
DECL|typedef|PluginValues
block|}
name|PluginValues
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28e4550f1208
typedef|typedef
struct|struct
block|{
DECL|member|run
name|gint
name|run
decl_stmt|;
DECL|typedef|PluginInterface
block|}
name|PluginInterface
typedef|;
end_typedef

begin_typedef
DECL|typedef|QueryFunc
typedef|typedef
name|void
function_decl|(
modifier|*
name|QueryFunc
function_decl|)
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_typedef

begin_comment
comment|/*** ***	Global Functions Prototypes **/
end_comment

begin_comment
comment|/* *** INSERT-FILE "proto/gflare.c.pro" *** */
end_comment

begin_comment
comment|/* gflare.c */
end_comment

begin_function_decl
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|plugin_query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|plugin_run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|plug_in_parse_gflare_path
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GFlare
modifier|*
name|gflare_new_with_default
parameter_list|(
name|gchar
modifier|*
name|new_name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GFlare
modifier|*
name|gflare_dup
parameter_list|(
name|GFlare
modifier|*
name|src
parameter_list|,
name|gchar
modifier|*
name|new_name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gflare_copy
parameter_list|(
name|GFlare
modifier|*
name|dest
parameter_list|,
name|GFlare
modifier|*
name|src
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GFlare
modifier|*
name|gflare_load
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|,
name|char
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gflare_save
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gflare_name_copy
parameter_list|(
name|gchar
modifier|*
name|dest
parameter_list|,
name|gchar
modifier|*
name|src
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|gint
name|gflares_list_insert
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GFlare
modifier|*
name|gflares_list_lookup
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|gint
name|gflares_list_index
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|gint
name|gflares_list_remove
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gflares_list_load_all
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gflares_list_free_all
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|calc_init_params
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|,
name|gint
name|calc_type
parameter_list|,
name|gdouble
name|xcenter
parameter_list|,
name|gdouble
name|ycenter
parameter_list|,
name|gdouble
name|radius
parameter_list|,
name|gdouble
name|rotation
parameter_list|,
name|gdouble
name|hue
parameter_list|,
name|gdouble
name|vangle
parameter_list|,
name|gdouble
name|vlength
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|calc_init_progress
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|calc_deinit
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|calc_glow_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|calc_rays_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|calc_sflare_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|,
name|guchar
modifier|*
name|src_pix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|calc_gflare_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|,
name|guchar
modifier|*
name|src_pix
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|dlg_run
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|dlg_preview_calc_window
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|ed_preview_calc_window
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GtkWidget
modifier|*
name|ed_mode_menu_new
parameter_list|(
name|GFlareMode
modifier|*
name|mode_var
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|Preview
modifier|*
name|preview_new
parameter_list|(
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|PreviewInitFunc
name|init_func
parameter_list|,
name|gpointer
name|init_data
parameter_list|,
name|PreviewRenderFunc
name|render_func
parameter_list|,
name|gpointer
name|render_data
parameter_list|,
name|PreviewDeinitFunc
name|deinit_func
parameter_list|,
name|gpointer
name|deinit_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|preview_free
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|preview_render_start
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|preview_render_end
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|preview_rgba_to_rgb
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guchar
modifier|*
name|src
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_menu_init
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_menu_rescan
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GradientMenu
modifier|*
name|gradient_menu_new
parameter_list|(
name|GradientMenuCallback
name|callback
parameter_list|,
name|gpointer
name|callback_data
parameter_list|,
name|gchar
modifier|*
name|default_gradient_name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_menu_destroy
parameter_list|(
name|GradientMenu
modifier|*
name|gm
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_name_copy
parameter_list|(
name|gchar
modifier|*
name|dest
parameter_list|,
name|gchar
modifier|*
name|src
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_name_encode
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_name_decode
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_init
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_free
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|char
modifier|*
modifier|*
name|gradient_get_list
parameter_list|(
name|gint
modifier|*
name|num_gradients
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_get_values
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gradient_cache_flush
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|entscale_new
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|EntscaleType
name|type
parameter_list|,
name|gpointer
name|variable
parameter_list|,
name|gdouble
name|min
parameter_list|,
name|gdouble
name|max
parameter_list|,
name|gdouble
name|step
parameter_list|,
name|gint
name|constraint
parameter_list|,
name|EntscaleCallbackFunc
name|callback
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GtkWidget
modifier|*
name|query_string_box
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|char
modifier|*
name|message
parameter_list|,
name|char
modifier|*
name|initial
parameter_list|,
name|QueryFunc
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* *** INSERT-FILE-END *** */
end_comment

begin_comment
comment|/** ***	Variables **/
end_comment

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc */
name|NULL
block|,
comment|/* quit_proc */
name|plugin_query
block|,
comment|/* query_proc */
name|plugin_run
block|,
comment|/* run_proc */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pvals
name|PluginValues
name|pvals
init|=
block|{
literal|128
block|,
comment|/* xcenter */
literal|128
block|,
comment|/* ycenter */
literal|100.0
block|,
comment|/* radius */
literal|0.0
block|,
comment|/* rotation */
literal|0.0
block|,
comment|/* hue */
literal|60.0
block|,
comment|/* vangle */
literal|400.0
block|,
comment|/* vlength */
name|FALSE
block|,
comment|/* use_asupsample */
literal|3
block|,
comment|/* asupsample_max_depth */
literal|0.2
block|,
comment|/* asupsample_threshold */
literal|"Default"
comment|/* gflare_name */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pint
name|PluginInterface
name|pint
init|=
block|{
name|FALSE
comment|/* run */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_gflare
name|GFlare
name|default_gflare
init|=
block|{
name|NULL
block|,
comment|/* name */
name|NULL
block|,
comment|/* filename */
literal|100
block|,
comment|/* glow_opacity */
name|GF_NORMAL
block|,
comment|/* glow_mode */
literal|100
block|,
comment|/* rays_opacity */
name|GF_NORMAL
block|,
comment|/* rays_mode */
literal|100
block|,
comment|/* sflare_opacity */
name|GF_NORMAL
block|,
comment|/* sflare_mode */
literal|"%red_grad"
block|,
comment|/* glow_radial */
literal|"%white"
block|,
comment|/* glow_angular */
literal|"%white"
block|,
comment|/* glow_angular_size */
literal|100.0
block|,
comment|/* glow_size */
literal|0.0
block|,
comment|/* glow_rotation */
literal|0.0
block|,
comment|/* glow_hue */
literal|"%white_grad"
block|,
comment|/* rays_radial */
literal|"%random"
block|,
comment|/* rays_angular */
literal|"%random"
block|,
comment|/* rays_angular_size */
literal|100.0
block|,
comment|/* rays_size */
literal|0.0
block|,
comment|/* rays_rotation */
literal|0.0
block|,
comment|/* rays_hue */
literal|40
block|,
comment|/* rays_nspikes */
literal|20.0
block|,
comment|/* rays_thickness */
literal|"%white_grad"
block|,
comment|/* sflare_radial */
literal|"%random"
block|,
comment|/* sflare_sizefac */
literal|"%random"
block|,
comment|/* sflare_probability */
literal|40.0
block|,
comment|/* sflare_size */
literal|0.0
block|,
comment|/* sflare_rotation */
literal|0.0
block|,
comment|/* sflare_hue */
name|GF_CIRCLE
block|,
comment|/* sflare_shape */
literal|6
block|,
comment|/* sflare_nverts */
literal|1
comment|/* sflare_seed */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gflare_modes
specifier|static
name|gchar
modifier|*
name|gflare_modes
index|[]
init|=
block|{
literal|"NORMAL"
block|,
literal|"ADDITION"
block|,
literal|"OVERLAY"
block|,
literal|"SCREEN"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gflare_shapes
specifier|static
name|gchar
modifier|*
name|gflare_shapes
index|[]
init|=
block|{
literal|"CIRCLE"
block|,
literal|"POLYGON"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|drawable
specifier|static
name|GDrawable
modifier|*
name|drawable
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|dinfo
specifier|static
name|DrawableInfo
name|dinfo
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tk_read
specifier|static
name|TileKeeper
modifier|*
name|tk_read
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tk_write
specifier|static
name|TileKeeper
modifier|*
name|tk_write
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|dlg
specifier|static
name|GFlareDialog
modifier|*
name|dlg
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|ed
specifier|static
name|GFlareEditor
modifier|*
name|ed
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gflares_list
specifier|static
name|GList
modifier|*
name|gflares_list
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|num_gflares
specifier|static
name|gint
name|num_gflares
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gflare_path_list
specifier|static
name|GList
modifier|*
name|gflare_path_list
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|calc
specifier|static
name|CalcParams
name|calc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gradient_menus
name|GList
modifier|*
name|gradient_menus
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gradient_names
specifier|static
name|char
modifier|*
modifier|*
name|gradient_names
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|num_gradient_names
specifier|static
name|int
name|num_gradient_names
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gradient_cache_head
specifier|static
name|GradientCacheItem
modifier|*
name|gradient_cache_head
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gradient_cache_count
specifier|static
name|gint
name|gradient_cache_count
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|internal_gradients
specifier|static
name|char
modifier|*
name|internal_gradients
index|[]
init|=
block|{
literal|"%white"
block|,
literal|"%white_grad"
block|,
literal|"%red_grad"
block|,
literal|"%blue_grad"
block|,
literal|"%yellow_grad"
block|,
literal|"%random"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|internal_ngradients
specifier|static
name|int
name|internal_ngradients
init|=
sizeof|sizeof
argument_list|(
name|internal_gradients
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|internal_gradients
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_decl_stmt
DECL|variable|get_values_external_count
specifier|static
name|int
name|get_values_external_count
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|get_values_external_clock
specifier|static
name|clock_t
name|get_values_external_clock
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/** ***	+++ Static Functions Prototypes **/
end_comment

begin_comment
comment|/* *** INSERT-FILE "proto/gflare.c.prs" *** */
end_comment

begin_function_decl
specifier|static
name|void
name|plugin_do
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|plugin_do_non_asupsample
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|plugin_do_asupsample
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|plugin_render_func
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|,
name|color_t
modifier|*
name|color
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|plugin_put_pixel_func
parameter_list|(
name|int
name|ix
parameter_list|,
name|int
name|iy
parameter_list|,
name|color_t
name|color
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|plugin_progress_func
parameter_list|(
name|int
name|y1
parameter_list|,
name|int
name|y2
parameter_list|,
name|int
name|curr_y
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|TileKeeper
modifier|*
name|tile_keeper_new
parameter_list|(
name|gint
name|shadow
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|guchar
modifier|*
name|tile_keeper_provide
parameter_list|(
name|TileKeeper
modifier|*
name|tk
parameter_list|,
name|gint
name|ix
parameter_list|,
name|gint
name|iy
parameter_list|,
name|gint
name|dirty
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|tile_keeper_free
parameter_list|(
name|TileKeeper
modifier|*
name|tk
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GFlare
modifier|*
name|gflare_new
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gflare_free
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gflare_read_int
parameter_list|(
name|gint
modifier|*
name|intvar
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gflare_read_double
parameter_list|(
name|gdouble
modifier|*
name|dblvar
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gflare_read_gradient_name
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gflare_read_shape
parameter_list|(
name|GFlareShape
modifier|*
name|shape
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gflare_read_mode
parameter_list|(
name|GFlareMode
modifier|*
name|mode
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gflare_write_gradient_name
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|calc_sample_one_gradient
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_place_sflare
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_get_gradient
parameter_list|(
name|guchar
modifier|*
name|pix
parameter_list|,
name|guchar
modifier|*
name|gradient
parameter_list|,
name|gdouble
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gdouble
name|fmod_positive
parameter_list|(
name|gdouble
name|x
parameter_list|,
name|gdouble
name|m
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_paint_func
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|,
name|gint
name|opacity
parameter_list|,
name|GFlareMode
name|mode
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_combine
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|,
name|gint
name|opacity
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_addition
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_screen
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_overlay
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|rgb_to_hsv
parameter_list|(
name|int
modifier|*
name|r
parameter_list|,
name|int
modifier|*
name|g
parameter_list|,
name|int
modifier|*
name|b
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hsv_to_rgb
parameter_list|(
name|int
modifier|*
name|h
parameter_list|,
name|int
modifier|*
name|s
parameter_list|,
name|int
modifier|*
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_setup_gflare
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_page_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|dlg_preview_handle_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|ed_preview_handle_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_preview_update
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|dlg_preview_init_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_preview_render_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|guchar
modifier|*
name|dest
parameter_list|,
name|gint
name|y
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_preview_deinit_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_make_page_settings
parameter_list|(
name|GFlareDialog
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_position_entry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_entscale_callback
parameter_list|(
name|gdouble
name|new_val
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_use_asupsample_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_iscale_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_dscale_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_update_preview_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_make_page_selector
parameter_list|(
name|GFlareDialog
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_setup_listbox
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_insert
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|,
name|int
name|pos
parameter_list|,
name|int
name|select
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_list_item_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_new_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_new_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_edit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_edit_done_callback
parameter_list|(
name|gint
name|updated
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_copy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_copy_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_delete_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dlg_selector_delete_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_run
parameter_list|(
name|GFlare
modifier|*
name|target_gflare
parameter_list|,
name|GFlareEditorCallback
name|callback
parameter_list|,
name|gpointer
name|calldata
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_rescan_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_make_page_general
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_make_page_glow
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_make_page_rays
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_make_page_sflare
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_put_mode_menu
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|GtkWidget
modifier|*
name|option_menu
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_put_gradient_menu
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|GradientMenu
modifier|*
name|gm
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_entscale_callback
parameter_list|(
name|gdouble
name|new_val
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_mode_menu_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_gradient_menu_callback
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_shape_radio_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_ientry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_page_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_preview_update
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|ed_preview_init_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_preview_deinit_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_preview_render_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_preview_render_general
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_preview_render_glow
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_preview_render_rays
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_preview_render_sflare
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|preview_render_start_2
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|preview_handle_idle
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gm_gradient_get_list
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|gm_menu_new
parameter_list|(
name|GradientMenu
modifier|*
name|gm
parameter_list|,
name|gchar
modifier|*
name|default_gradient_name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|gm_menu_create_sub_menus
parameter_list|(
name|GradientMenu
modifier|*
name|gm
parameter_list|,
name|gint
name|start_n
parameter_list|,
name|gchar
modifier|*
modifier|*
name|active_name_ptr
parameter_list|,
name|gchar
modifier|*
name|default_gradient_name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gm_menu_item_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gm_preview_draw
parameter_list|(
name|GtkWidget
modifier|*
name|preview
parameter_list|,
name|gchar
modifier|*
name|gradient_name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gm_option_menu_destroy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_get_values_internal
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_get_blend
parameter_list|(
name|guchar
modifier|*
name|fg
parameter_list|,
name|guchar
modifier|*
name|bg
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_get_random
parameter_list|(
name|gint
name|seed
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_get_default
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_get_values_external
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_get_values_real_external
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GradientCacheItem
modifier|*
name|gradient_cache_lookup
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
modifier|*
name|found
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_cache_zorch
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|entscale_get_precision
parameter_list|(
name|gdouble
name|step
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_destroy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_entry_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|query_box_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|query_box_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* *** INSERT-FILE-END *** */
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**		+++ Plug-in Interfaces					**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_expr_stmt
name|MAIN
argument_list|()
expr_stmt|;
end_expr_stmt

begin_function
name|void
DECL|function|plugin_query ()
name|plugin_query
parameter_list|()
block|{
specifier|static
name|GParamDef
name|args
index|[]
init|=
block|{
block|{
name|PARAM_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|PARAM_IMAGE
block|,
literal|"image"
block|,
literal|"Input image (unused)"
block|}
block|,
block|{
name|PARAM_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|,
block|{
name|PARAM_STRING
block|,
literal|"gflare_name"
block|,
literal|"The name of GFlare"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"xcenter"
block|,
literal|"X coordinate of center of GFlare"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"ycenter"
block|,
literal|"Y coordinate of center of GFlare"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"radius"
block|,
literal|"Radius of GFlare (pixel)"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"rotation"
block|,
literal|"Rotation of GFlare (degree)"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"hue"
block|,
literal|"Hue rotation of GFlare (degree)"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"vangle"
block|,
literal|"Vector angle for second flares (degree)"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"vlength"
block|,
literal|"Vector length for second flares (percentage to Radius)"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"use_asupsample"
block|,
literal|"Whether it uses or not adaptive supersampling while rendering (boolean)"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"asupsample_max_depth"
block|,
literal|"Max depth for adaptive supersampling"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"asupsample_threshold"
block|,
literal|"Threshold for adaptive supersampling"
block|}
block|}
decl_stmt|;
specifier|static
name|GParamDef
modifier|*
name|return_vals
init|=
name|NULL
decl_stmt|;
specifier|static
name|gint
name|nargs
init|=
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
specifier|static
name|gint
name|nreturn_vals
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|help_string
init|=
literal|" This plug-in produces a lense flare effect using custom gradients."
literal|" In interactive call, the user can edit his/her own favorite lense flare"
literal|" (GFlare) and render it. Edited gflare is saved automatically to"
literal|" the directory in gflare-path, if it is defined in gimprc."
literal|" In non-interactive call, the user can only render one of GFlare"
literal|" which has been stored in gflare-path already."
decl_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"plug_in_gflare"
argument_list|,
literal|"Produce lense flare effect using custom gradients"
argument_list|,
name|help_string
argument_list|,
literal|"Eiichi Takamori"
argument_list|,
literal|"Eiichi Takamori, and a lot of GIMP people"
argument_list|,
literal|"1997"
argument_list|,
literal|"<Image>/Filters/Light Effects/GFlare..."
argument_list|,
literal|"RGB*, GRAY*"
argument_list|,
name|PROC_PLUG_IN
argument_list|,
name|nargs
argument_list|,
name|nreturn_vals
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|plugin_run (gchar * name,gint nparams,GParam * param,gint * nreturn_vals,GParam ** return_vals)
name|plugin_run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GParam
name|values
index|[
literal|1
index|]
decl_stmt|;
name|GRunModeType
name|run_mode
decl_stmt|;
name|GStatusType
name|status
init|=
name|STATUS_SUCCESS
decl_stmt|;
comment|/* Initialize */
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
comment|/*    *	Get the specified drawable and its info (global variable)    */
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
name|dinfo
operator|.
name|is_color
operator|=
name|gimp_drawable_is_rgb
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|dinfo
operator|.
name|has_alpha
operator|=
name|gimp_drawable_has_alpha
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
operator|&
name|dinfo
operator|.
name|x1
argument_list|,
operator|&
name|dinfo
operator|.
name|y1
argument_list|,
operator|&
name|dinfo
operator|.
name|x2
argument_list|,
operator|&
name|dinfo
operator|.
name|y2
argument_list|)
expr_stmt|;
name|dinfo
operator|.
name|tile_width
operator|=
name|gimp_tile_width
argument_list|()
expr_stmt|;
name|dinfo
operator|.
name|tile_height
operator|=
name|gimp_tile_height
argument_list|()
expr_stmt|;
comment|/*    *	Start gradient caching    */
name|gradient_init
argument_list|()
expr_stmt|;
comment|/*    *	Parse gflare path from gimprc and load gflares    */
name|plug_in_parse_gflare_path
argument_list|()
expr_stmt|;
name|gflares_list_load_all
argument_list|()
expr_stmt|;
name|gimp_tile_cache_ntiles
argument_list|(
name|drawable
operator|->
name|width
operator|/
name|gimp_tile_width
argument_list|()
operator|+
literal|2
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|RUN_INTERACTIVE
case|:
comment|/*  Possibly retrieve data  */
name|gimp_get_data
argument_list|(
literal|"plug_in_gflare"
argument_list|,
operator|&
name|pvals
argument_list|)
expr_stmt|;
comment|/*  First acquire information with a dialog  */
if|if
condition|(
operator|!
name|dlg_run
argument_list|()
condition|)
block|{
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
return|return;
block|}
break|break;
case|case
name|RUN_NONINTERACTIVE
case|:
if|#
directive|if
literal|0
block|printf("Currently non interactive call of gradient flare is not supported\n");       status = STATUS_CALLING_ERROR;       break;
endif|#
directive|endif
if|if
condition|(
name|nparams
operator|!=
literal|14
condition|)
name|status
operator|=
name|STATUS_CALLING_ERROR
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|gflare_name_copy
argument_list|(
name|pvals
operator|.
name|gflare_name
argument_list|,
name|param
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|)
expr_stmt|;
name|pvals
operator|.
name|xcenter
operator|=
name|param
index|[
literal|4
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|pvals
operator|.
name|ycenter
operator|=
name|param
index|[
literal|5
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|pvals
operator|.
name|radius
operator|=
name|param
index|[
literal|6
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|pvals
operator|.
name|rotation
operator|=
name|param
index|[
literal|7
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|pvals
operator|.
name|hue
operator|=
name|param
index|[
literal|8
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|pvals
operator|.
name|vangle
operator|=
name|param
index|[
literal|9
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|pvals
operator|.
name|vlength
operator|=
name|param
index|[
literal|10
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|pvals
operator|.
name|use_asupsample
operator|=
name|param
index|[
literal|11
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|pvals
operator|.
name|asupsample_max_depth
operator|=
name|param
index|[
literal|12
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|pvals
operator|.
name|asupsample_threshold
operator|=
name|param
index|[
literal|13
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
block|}
if|if
condition|(
name|pvals
operator|.
name|radius
operator|<=
literal|0
condition|)
name|status
operator|=
name|STATUS_CALLING_ERROR
expr_stmt|;
break|break;
case|case
name|RUN_WITH_LAST_VALS
case|:
comment|/*  Possibly retrieve data  */
name|gimp_get_data
argument_list|(
literal|"plug_in_gflare"
argument_list|,
operator|&
name|pvals
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
comment|/*  Make sure that the drawable is gray or RGB color  */
if|if
condition|(
name|gimp_drawable_is_rgb
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
operator|||
name|gimp_drawable_is_gray
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
condition|)
block|{
name|gimp_progress_init
argument_list|(
literal|"Gradient Flare..."
argument_list|)
expr_stmt|;
name|plugin_do
argument_list|()
expr_stmt|;
if|if
condition|(
name|run_mode
operator|!=
name|RUN_NONINTERACTIVE
condition|)
name|gimp_displays_flush
argument_list|()
expr_stmt|;
comment|/*  Store data  */
if|if
condition|(
name|run_mode
operator|==
name|RUN_INTERACTIVE
condition|)
name|gimp_set_data
argument_list|(
literal|"plug_in_gflare"
argument_list|,
operator|&
name|pvals
argument_list|,
sizeof|sizeof
argument_list|(
name|PluginValues
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* gimp_message ("gflare: cannot operate on indexed color images"); */
name|status
operator|=
name|STATUS_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
comment|/*    *	Deinitialization    */
name|gradient_free
argument_list|()
expr_stmt|;
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	Query gimprc for gflare-path, and parse it.  *	This code is based on script_fu_find_scripts ()  */
end_comment

begin_function
name|void
DECL|function|plug_in_parse_gflare_path ()
name|plug_in_parse_gflare_path
parameter_list|()
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|gint
name|nreturn_vals
decl_stmt|;
name|gchar
modifier|*
name|path_string
decl_stmt|;
name|gchar
modifier|*
name|home
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
name|gchar
modifier|*
name|token
decl_stmt|;
name|gchar
modifier|*
name|next_token
decl_stmt|;
name|struct
name|stat
name|filestat
decl_stmt|;
name|gint
name|err
decl_stmt|;
name|gflare_path_list
operator|=
name|NULL
expr_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"gimp_gimprc_query"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_STRING
argument_list|,
literal|"gflare-path"
argument_list|,
name|PARAM_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|!=
name|STATUS_SUCCESS
operator|||
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
operator|==
name|NULL
condition|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"No gflare-path in gimprc: gflare_path_list is NULL\n"
operator|)
argument_list|)
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
return|return;
block|}
name|path_string
operator|=
name|g_strdup
argument_list|(
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|)
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
comment|/* Set local path to contain temp_path, where (supposedly)    * there may be working files.    */
name|home
operator|=
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
expr_stmt|;
comment|/* Search through all directories in the  path */
name|next_token
operator|=
name|path_string
expr_stmt|;
name|token
operator|=
name|strtok
argument_list|(
name|next_token
argument_list|,
name|G_SEARCHPATH_SEPARATOR_S
argument_list|)
expr_stmt|;
while|while
condition|(
name|token
condition|)
block|{
if|if
condition|(
operator|*
name|token
operator|==
literal|'\0'
condition|)
block|{
name|token
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
name|G_SEARCHPATH_SEPARATOR_S
argument_list|)
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|*
name|token
operator|==
literal|'~'
condition|)
block|{
name|path
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|home
argument_list|)
operator|+
name|strlen
argument_list|(
name|token
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|path
argument_list|,
literal|"%s%s"
argument_list|,
name|home
argument_list|,
name|token
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|path
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|token
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|path
argument_list|,
name|token
argument_list|)
expr_stmt|;
block|}
comment|/* else */
comment|/* Check if directory exists */
name|err
operator|=
name|stat
argument_list|(
name|path
argument_list|,
operator|&
name|filestat
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
operator|&&
name|S_ISDIR
argument_list|(
name|filestat
operator|.
name|st_mode
argument_list|)
condition|)
block|{
if|if
condition|(
name|path
index|[
name|strlen
argument_list|(
name|path
argument_list|)
operator|-
literal|1
index|]
operator|!=
literal|'/'
condition|)
name|strcat
argument_list|(
name|path
argument_list|,
literal|"/"
argument_list|)
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"Added `%s' to gflare_path_list\n"
operator|,
name|path
operator|)
argument_list|)
expr_stmt|;
name|gflare_path_list
operator|=
name|g_list_append
argument_list|(
name|gflare_path_list
argument_list|,
name|path
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"Not found `%s'\n"
operator|,
name|path
operator|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
name|G_SEARCHPATH_SEPARATOR_S
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|path_string
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|plugin_do ()
name|plugin_do
parameter_list|()
block|{
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|gflare
operator|=
name|gflares_list_lookup
argument_list|(
name|pvals
operator|.
name|gflare_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|gflare
operator|==
name|NULL
condition|)
block|{
comment|/* FIXME */
name|g_warning
argument_list|(
literal|"Not found %s\n"
argument_list|,
name|pvals
operator|.
name|gflare_name
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Initialize calc params and gradients */
name|calc_init_params
argument_list|(
name|gflare
argument_list|,
name|CALC_GLOW
operator||
name|CALC_RAYS
operator||
name|CALC_SFLARE
argument_list|,
name|pvals
operator|.
name|xcenter
argument_list|,
name|pvals
operator|.
name|ycenter
argument_list|,
name|pvals
operator|.
name|radius
argument_list|,
name|pvals
operator|.
name|rotation
argument_list|,
name|pvals
operator|.
name|hue
argument_list|,
name|pvals
operator|.
name|vangle
argument_list|,
name|pvals
operator|.
name|vlength
argument_list|)
expr_stmt|;
while|while
condition|(
name|calc_init_progress
argument_list|()
condition|)
empty_stmt|;
comment|/* Render it ! */
if|if
condition|(
name|pvals
operator|.
name|use_asupsample
condition|)
name|plugin_do_asupsample
argument_list|()
expr_stmt|;
else|else
name|plugin_do_non_asupsample
argument_list|()
expr_stmt|;
comment|/* Clean up */
name|calc_deinit
argument_list|()
expr_stmt|;
name|gimp_drawable_flush
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|dinfo
operator|.
name|x1
argument_list|,
name|dinfo
operator|.
name|y1
argument_list|,
operator|(
name|dinfo
operator|.
name|x2
operator|-
name|dinfo
operator|.
name|x1
operator|)
argument_list|,
operator|(
name|dinfo
operator|.
name|y2
operator|-
name|dinfo
operator|.
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* these routines should be almost rewritten anyway */
end_comment

begin_function
specifier|static
name|void
DECL|function|plugin_do_non_asupsample ()
name|plugin_do_non_asupsample
parameter_list|()
block|{
name|GPixelRgn
name|src_rgn
decl_stmt|,
name|dest_rgn
decl_stmt|;
name|gpointer
name|pr
decl_stmt|;
name|guchar
modifier|*
name|src_row
decl_stmt|,
modifier|*
name|dest_row
decl_stmt|;
name|guchar
modifier|*
name|src
decl_stmt|,
modifier|*
name|dest
decl_stmt|;
name|gint
name|row
decl_stmt|,
name|col
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gint
name|b
decl_stmt|;
name|gint
name|progress
decl_stmt|,
name|max_progress
decl_stmt|;
name|guchar
name|src_pix
index|[
literal|4
index|]
decl_stmt|,
name|dest_pix
index|[
literal|4
index|]
decl_stmt|;
name|progress
operator|=
literal|0
expr_stmt|;
name|max_progress
operator|=
operator|(
name|dinfo
operator|.
name|x2
operator|-
name|dinfo
operator|.
name|x1
operator|)
operator|*
operator|(
name|dinfo
operator|.
name|y2
operator|-
name|dinfo
operator|.
name|y1
operator|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|src_rgn
argument_list|,
name|drawable
argument_list|,
name|dinfo
operator|.
name|x1
argument_list|,
name|dinfo
operator|.
name|y1
argument_list|,
name|dinfo
operator|.
name|x2
argument_list|,
name|dinfo
operator|.
name|y2
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|dest_rgn
argument_list|,
name|drawable
argument_list|,
name|dinfo
operator|.
name|x1
argument_list|,
name|dinfo
operator|.
name|y1
argument_list|,
name|dinfo
operator|.
name|x2
argument_list|,
name|dinfo
operator|.
name|y2
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|gimp_pixel_rgns_register
argument_list|(
literal|2
argument_list|,
operator|&
name|src_rgn
argument_list|,
operator|&
name|dest_rgn
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|gimp_pixel_rgns_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
name|src_row
operator|=
name|src_rgn
operator|.
name|data
expr_stmt|;
name|dest_row
operator|=
name|dest_rgn
operator|.
name|data
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
operator|,
name|y
operator|=
name|src_rgn
operator|.
name|y
init|;
name|row
operator|<
name|src_rgn
operator|.
name|h
condition|;
name|row
operator|++
operator|,
name|y
operator|++
control|)
block|{
name|src
operator|=
name|src_row
expr_stmt|;
name|dest
operator|=
name|dest_row
expr_stmt|;
for|for
control|(
name|col
operator|=
literal|0
operator|,
name|x
operator|=
name|src_rgn
operator|.
name|x
init|;
name|col
operator|<
name|src_rgn
operator|.
name|w
condition|;
name|col
operator|++
operator|,
name|x
operator|++
control|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|src_pix
index|[
name|b
index|]
operator|=
name|dinfo
operator|.
name|is_color
condition|?
name|src
index|[
name|b
index|]
else|:
name|src
index|[
literal|0
index|]
expr_stmt|;
name|src_pix
index|[
literal|3
index|]
operator|=
name|dinfo
operator|.
name|has_alpha
condition|?
name|src
index|[
name|src_rgn
operator|.
name|bpp
operator|-
literal|1
index|]
else|:
name|OPAQUE
expr_stmt|;
name|calc_gflare_pix
argument_list|(
name|dest_pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|src_pix
argument_list|)
expr_stmt|;
if|if
condition|(
name|dinfo
operator|.
name|is_color
condition|)
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|dest
index|[
name|b
index|]
operator|=
name|dest_pix
index|[
name|b
index|]
expr_stmt|;
else|else
name|dest
index|[
literal|0
index|]
operator|=
name|LUMINOSITY
argument_list|(
name|dest_pix
argument_list|)
expr_stmt|;
if|if
condition|(
name|dinfo
operator|.
name|has_alpha
condition|)
name|dest
index|[
name|src_rgn
operator|.
name|bpp
operator|-
literal|1
index|]
operator|=
name|dest_pix
index|[
literal|3
index|]
expr_stmt|;
name|src
operator|+=
name|src_rgn
operator|.
name|bpp
expr_stmt|;
name|dest
operator|+=
name|dest_rgn
operator|.
name|bpp
expr_stmt|;
block|}
name|src_row
operator|+=
name|src_rgn
operator|.
name|rowstride
expr_stmt|;
name|dest_row
operator|+=
name|dest_rgn
operator|.
name|rowstride
expr_stmt|;
block|}
comment|/* Update progress */
name|progress
operator|+=
name|src_rgn
operator|.
name|w
operator|*
name|src_rgn
operator|.
name|h
expr_stmt|;
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|progress
operator|/
operator|(
name|double
operator|)
name|max_progress
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|plugin_do_asupsample ()
name|plugin_do_asupsample
parameter_list|()
block|{
name|tk_read
operator|=
name|tile_keeper_new
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|tk_write
operator|=
name|tile_keeper_new
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
name|adaptive_supersample_area
argument_list|(
name|dinfo
operator|.
name|x1
argument_list|,
name|dinfo
operator|.
name|y1
argument_list|,
name|dinfo
operator|.
name|x2
operator|-
literal|1
argument_list|,
name|dinfo
operator|.
name|y2
operator|-
literal|1
argument_list|,
name|pvals
operator|.
name|asupsample_max_depth
argument_list|,
name|pvals
operator|.
name|asupsample_threshold
argument_list|,
operator|(
name|render_func_t
operator|)
name|plugin_render_func
argument_list|,
name|NULL
argument_list|,
operator|(
name|put_pixel_func_t
operator|)
name|plugin_put_pixel_func
argument_list|,
name|NULL
argument_list|,
operator|(
name|progress_func_t
operator|)
name|plugin_progress_func
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|tile_keeper_free
argument_list|(
name|tk_read
argument_list|)
expr_stmt|;
name|tile_keeper_free
argument_list|(
name|tk_write
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*   Adaptive supersampling callback functions    These routines may look messy, since adaptive supersampling needs   pixel values in `double' (from 0.0 to 1.0) but calc_*_pix () returns   guchar values. */
end_comment

begin_function
specifier|static
name|void
DECL|function|plugin_render_func (double x,double y,color_t * color,gpointer data)
name|plugin_render_func
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|,
name|color_t
modifier|*
name|color
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|guchar
name|src_pix
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|flare_pix
index|[
literal|4
index|]
decl_stmt|;
name|guchar
modifier|*
name|src
decl_stmt|;
name|gint
name|b
decl_stmt|;
name|gint
name|ix
decl_stmt|,
name|iy
decl_stmt|;
comment|/* translate (0.5, 0.5) before convert to `int' so that it can surely      point the center of pixel */
name|ix
operator|=
name|floor
argument_list|(
name|x
operator|+
literal|0.5
argument_list|)
expr_stmt|;
name|iy
operator|=
name|floor
argument_list|(
name|y
operator|+
literal|0.5
argument_list|)
expr_stmt|;
name|src
operator|=
name|tile_keeper_provide
argument_list|(
name|tk_read
argument_list|,
name|ix
argument_list|,
name|iy
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|src_pix
index|[
name|b
index|]
operator|=
name|dinfo
operator|.
name|is_color
condition|?
name|src
index|[
name|b
index|]
else|:
name|src
index|[
literal|0
index|]
expr_stmt|;
name|src_pix
index|[
literal|3
index|]
operator|=
name|dinfo
operator|.
name|has_alpha
condition|?
name|src
index|[
name|drawable
operator|->
name|bpp
operator|-
literal|1
index|]
else|:
name|OPAQUE
expr_stmt|;
name|calc_gflare_pix
argument_list|(
name|flare_pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|src_pix
argument_list|)
expr_stmt|;
name|color
operator|->
name|r
operator|=
name|flare_pix
index|[
literal|0
index|]
operator|/
literal|255.0
expr_stmt|;
name|color
operator|->
name|g
operator|=
name|flare_pix
index|[
literal|1
index|]
operator|/
literal|255.0
expr_stmt|;
name|color
operator|->
name|b
operator|=
name|flare_pix
index|[
literal|2
index|]
operator|/
literal|255.0
expr_stmt|;
name|color
operator|->
name|a
operator|=
name|flare_pix
index|[
literal|3
index|]
operator|/
literal|255.0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|plugin_put_pixel_func (int ix,int iy,color_t color,gpointer data)
name|plugin_put_pixel_func
parameter_list|(
name|int
name|ix
parameter_list|,
name|int
name|iy
parameter_list|,
name|color_t
name|color
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|guchar
modifier|*
name|dest
decl_stmt|;
name|dest
operator|=
name|tile_keeper_provide
argument_list|(
name|tk_write
argument_list|,
name|ix
argument_list|,
name|iy
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|dinfo
operator|.
name|is_color
condition|)
block|{
name|dest
index|[
literal|0
index|]
operator|=
name|color
operator|.
name|r
operator|*
literal|255
expr_stmt|;
name|dest
index|[
literal|1
index|]
operator|=
name|color
operator|.
name|g
operator|*
literal|255
expr_stmt|;
name|dest
index|[
literal|2
index|]
operator|=
name|color
operator|.
name|b
operator|*
literal|255
expr_stmt|;
block|}
else|else
name|dest
index|[
literal|0
index|]
operator|=
operator|(
name|color
operator|.
name|r
operator|*
literal|0.30
operator|+
name|color
operator|.
name|g
operator|*
literal|0.59
operator|+
name|color
operator|.
name|b
operator|*
literal|0.11
operator|)
operator|*
literal|255
expr_stmt|;
if|if
condition|(
name|dinfo
operator|.
name|has_alpha
condition|)
name|dest
index|[
name|drawable
operator|->
name|bpp
operator|-
literal|1
index|]
operator|=
name|color
operator|.
name|a
operator|*
literal|255
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|plugin_progress_func (int y1,int y2,int curr_y,gpointer data)
name|plugin_progress_func
parameter_list|(
name|int
name|y1
parameter_list|,
name|int
name|y2
parameter_list|,
name|int
name|curr_y
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|curr_y
operator|/
call|(
name|double
call|)
argument_list|(
name|y2
operator|-
name|y1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/** ***	The Tile Keeper **/
end_comment

begin_function
specifier|static
name|TileKeeper
modifier|*
DECL|function|tile_keeper_new (gint shadow)
name|tile_keeper_new
parameter_list|(
name|gint
name|shadow
parameter_list|)
block|{
name|TileKeeper
modifier|*
name|tk
decl_stmt|;
name|tk
operator|=
name|g_new0
argument_list|(
name|TileKeeper
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|tk
operator|->
name|tile
operator|=
name|NULL
expr_stmt|;
name|tk
operator|->
name|col
operator|=
literal|0
expr_stmt|;
name|tk
operator|->
name|row
operator|=
literal|0
expr_stmt|;
name|tk
operator|->
name|shadow
operator|=
name|shadow
expr_stmt|;
name|tk
operator|->
name|dirty
operator|=
name|FALSE
expr_stmt|;
return|return
name|tk
return|;
block|}
end_function

begin_comment
comment|/*   Return the pointer to specified pixel in allocated tile   */
end_comment

begin_function
specifier|static
name|guchar
modifier|*
DECL|function|tile_keeper_provide (TileKeeper * tk,gint ix,gint iy,gint dirty)
name|tile_keeper_provide
parameter_list|(
name|TileKeeper
modifier|*
name|tk
parameter_list|,
name|gint
name|ix
parameter_list|,
name|gint
name|iy
parameter_list|,
name|gint
name|dirty
parameter_list|)
block|{
specifier|static
name|guchar
name|black
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|col
decl_stmt|,
name|row
decl_stmt|,
name|offx
decl_stmt|,
name|offy
decl_stmt|;
if|if
condition|(
name|ix
operator|<
literal|0
operator|||
name|ix
operator|>=
name|drawable
operator|->
name|width
operator|||
name|iy
operator|<
literal|0
operator|||
name|iy
operator|>=
name|drawable
operator|->
name|height
condition|)
block|{
name|black
index|[
literal|0
index|]
operator|=
name|black
index|[
literal|1
index|]
operator|=
name|black
index|[
literal|2
index|]
operator|=
name|black
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|black
return|;
block|}
name|col
operator|=
name|ix
operator|/
name|dinfo
operator|.
name|tile_width
expr_stmt|;
name|row
operator|=
name|iy
operator|/
name|dinfo
operator|.
name|tile_height
expr_stmt|;
name|offx
operator|=
name|ix
operator|%
name|dinfo
operator|.
name|tile_width
expr_stmt|;
name|offy
operator|=
name|iy
operator|%
name|dinfo
operator|.
name|tile_height
expr_stmt|;
if|if
condition|(
name|tk
operator|->
name|tile
operator|==
name|NULL
operator|||
name|col
operator|!=
name|tk
operator|->
name|col
operator|||
name|row
operator|!=
name|tk
operator|->
name|row
condition|)
block|{
if|if
condition|(
name|tk
operator|->
name|tile
condition|)
name|gimp_tile_unref
argument_list|(
name|tk
operator|->
name|tile
argument_list|,
name|tk
operator|->
name|dirty
argument_list|)
expr_stmt|;
name|tk
operator|->
name|col
operator|=
name|col
expr_stmt|;
name|tk
operator|->
name|row
operator|=
name|row
expr_stmt|;
name|tk
operator|->
name|tile
operator|=
name|gimp_drawable_get_tile
argument_list|(
name|drawable
argument_list|,
name|tk
operator|->
name|shadow
argument_list|,
name|row
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|tk
operator|->
name|dirty
operator|=
name|FALSE
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tk
operator|->
name|tile
argument_list|)
expr_stmt|;
block|}
name|tk
operator|->
name|dirty
operator||=
name|dirty
expr_stmt|;
return|return
name|tk
operator|->
name|tile
operator|->
name|data
operator|+
operator|(
name|offy
operator|*
name|tk
operator|->
name|tile
operator|->
name|ewidth
operator|+
name|offx
operator|)
operator|*
name|tk
operator|->
name|tile
operator|->
name|bpp
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|tile_keeper_free (TileKeeper * tk)
name|tile_keeper_free
parameter_list|(
name|TileKeeper
modifier|*
name|tk
parameter_list|)
block|{
if|if
condition|(
name|tk
operator|->
name|tile
condition|)
name|gimp_tile_unref
argument_list|(
name|tk
operator|->
name|tile
argument_list|,
name|tk
operator|->
name|dirty
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tk
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**		+++ GFlare Routines					**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/*  *	These code are more or less based on Quartic's gradient.c,  *	other gimp sources, and script-fu.  */
end_comment

begin_function
specifier|static
name|GFlare
modifier|*
DECL|function|gflare_new ()
name|gflare_new
parameter_list|()
block|{
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|gflare
operator|=
name|g_new0
argument_list|(
name|GFlare
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gflare
operator|->
name|name
operator|=
name|NULL
expr_stmt|;
name|gflare
operator|->
name|filename
operator|=
name|NULL
expr_stmt|;
return|return
name|gflare
return|;
block|}
end_function

begin_function
name|GFlare
modifier|*
DECL|function|gflare_new_with_default (gchar * new_name)
name|gflare_new_with_default
parameter_list|(
name|gchar
modifier|*
name|new_name
parameter_list|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflare_new_with_default %s\n"
operator|,
name|new_name
operator|)
argument_list|)
expr_stmt|;
return|return
name|gflare_dup
argument_list|(
operator|&
name|default_gflare
argument_list|,
name|new_name
argument_list|)
return|;
block|}
end_function

begin_function
name|GFlare
modifier|*
DECL|function|gflare_dup (GFlare * src,gchar * new_name)
name|gflare_dup
parameter_list|(
name|GFlare
modifier|*
name|src
parameter_list|,
name|gchar
modifier|*
name|new_name
parameter_list|)
block|{
name|GFlare
modifier|*
name|dest
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflare_dup %s\n"
operator|,
name|new_name
operator|)
argument_list|)
expr_stmt|;
name|dest
operator|=
name|g_new0
argument_list|(
name|GFlare
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|dest
argument_list|,
name|src
argument_list|,
sizeof|sizeof
argument_list|(
name|GFlare
argument_list|)
argument_list|)
expr_stmt|;
name|dest
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|new_name
argument_list|)
expr_stmt|;
name|dest
operator|->
name|filename
operator|=
name|NULL
expr_stmt|;
return|return
name|dest
return|;
block|}
end_function

begin_function
name|void
DECL|function|gflare_copy (GFlare * dest,GFlare * src)
name|gflare_copy
parameter_list|(
name|GFlare
modifier|*
name|dest
parameter_list|,
name|GFlare
modifier|*
name|src
parameter_list|)
block|{
name|gchar
modifier|*
name|name
decl_stmt|,
modifier|*
name|filename
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflare_copy\n"
operator|)
argument_list|)
expr_stmt|;
name|name
operator|=
name|dest
operator|->
name|name
expr_stmt|;
name|filename
operator|=
name|dest
operator|->
name|filename
expr_stmt|;
name|memcpy
argument_list|(
name|dest
argument_list|,
name|src
argument_list|,
sizeof|sizeof
argument_list|(
name|GFlare
argument_list|)
argument_list|)
expr_stmt|;
name|dest
operator|->
name|name
operator|=
name|name
expr_stmt|;
name|dest
operator|->
name|filename
operator|=
name|filename
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gflare_free (GFlare * gflare)
name|gflare_free
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
block|{
name|g_assert
argument_list|(
name|gflare
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gflare
operator|->
name|name
condition|)
name|g_free
argument_list|(
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|gflare
operator|->
name|filename
condition|)
name|g_free
argument_list|(
name|gflare
operator|->
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gflare
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GFlare
modifier|*
DECL|function|gflare_load (char * filename,char * name)
name|gflare_load
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|,
name|char
modifier|*
name|name
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|GFlareFile
modifier|*
name|gf
decl_stmt|;
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|gchar
name|header
index|[
literal|256
index|]
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflare_load: %s, %s\n"
operator|,
name|filename
operator|,
name|name
operator|)
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|filename
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_warning
argument_list|(
literal|"not found: %s"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|fgets
argument_list|(
name|header
argument_list|,
sizeof|sizeof
argument_list|(
name|header
argument_list|)
argument_list|,
name|fp
argument_list|)
operator|==
name|NULL
operator|||
name|strcmp
argument_list|(
name|header
argument_list|,
name|GFLARE_FILE_HEADER
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|g_warning
argument_list|(
literal|"not valid GFlare file: %s"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|gf
operator|=
name|g_new
argument_list|(
name|GFlareFile
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gf
operator|->
name|fp
operator|=
name|fp
expr_stmt|;
name|gf
operator|->
name|error
operator|=
name|FALSE
expr_stmt|;
name|gflare
operator|=
name|gflare_new
argument_list|()
expr_stmt|;
name|gflare
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gflare
operator|->
name|filename
operator|=
name|g_strdup
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|glow_opacity
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_mode
argument_list|(
operator|&
name|gflare
operator|->
name|glow_mode
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|rays_opacity
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_mode
argument_list|(
operator|&
name|gflare
operator|->
name|rays_mode
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_opacity
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_mode
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_mode
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|glow_radial
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|glow_angular
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|glow_angular_size
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|glow_size
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|glow_rotation
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|glow_hue
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|rays_radial
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|rays_angular
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|rays_angular_size
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|rays_size
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|rays_rotation
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|rays_hue
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_int
argument_list|(
operator|&
name|gflare
operator|->
name|rays_nspikes
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|rays_thickness
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|sflare_radial
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|sflare_sizefac
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_gradient_name
argument_list|(
name|gflare
operator|->
name|sflare_probability
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_size
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_hue
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_double
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_rotation
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_shape
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_shape
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_int
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_nverts
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|gflare_read_int
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_seed
argument_list|,
name|gf
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|gf
operator|->
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|gf
operator|->
name|error
condition|)
block|{
name|g_warning
argument_list|(
literal|"invalid formatted GFlare file: %s\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gflare
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gf
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"Loaded %s\n"
operator|,
name|filename
operator|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gf
argument_list|)
expr_stmt|;
return|return
name|gflare
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gflare_read_int (gint * intvar,GFlareFile * gf)
name|gflare_read_int
parameter_list|(
name|gint
modifier|*
name|intvar
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
block|{
if|if
condition|(
name|gf
operator|->
name|error
condition|)
return|return;
if|if
condition|(
name|fscanf
argument_list|(
name|gf
operator|->
name|fp
argument_list|,
literal|"%d"
argument_list|,
name|intvar
argument_list|)
operator|!=
literal|1
condition|)
name|gf
operator|->
name|error
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gflare_read_double (gdouble * dblvar,GFlareFile * gf)
name|gflare_read_double
parameter_list|(
name|gdouble
modifier|*
name|dblvar
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
block|{
if|if
condition|(
name|gf
operator|->
name|error
condition|)
return|return;
if|if
condition|(
name|fscanf
argument_list|(
name|gf
operator|->
name|fp
argument_list|,
literal|"%le"
argument_list|,
name|dblvar
argument_list|)
operator|!=
literal|1
condition|)
name|gf
operator|->
name|error
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gflare_read_gradient_name (GradientName name,GFlareFile * gf)
name|gflare_read_gradient_name
parameter_list|(
name|GradientName
name|name
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
block|{
name|gchar
name|tmp
index|[
literal|1024
index|]
decl_stmt|,
name|dec
index|[
literal|1024
index|]
decl_stmt|;
if|if
condition|(
name|gf
operator|->
name|error
condition|)
return|return;
comment|/* FIXME: this is buggy */
if|if
condition|(
name|fscanf
argument_list|(
name|gf
operator|->
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|tmp
argument_list|)
operator|==
literal|1
condition|)
block|{
comment|/* @GRADIENT_NAME */
name|gradient_name_decode
argument_list|(
operator|(
name|guchar
operator|*
operator|)
name|dec
argument_list|,
operator|(
name|guchar
operator|*
operator|)
name|tmp
argument_list|)
expr_stmt|;
name|gradient_name_copy
argument_list|(
name|name
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"read_gradient_name: \"%s\" => \"%s\"\n"
operator|,
name|tmp
operator|,
name|dec
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
name|gf
operator|->
name|error
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gflare_read_shape (GFlareShape * shape,GFlareFile * gf)
name|gflare_read_shape
parameter_list|(
name|GFlareShape
modifier|*
name|shape
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
block|{
name|gchar
name|tmp
index|[
literal|1024
index|]
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
name|gf
operator|->
name|error
condition|)
return|return;
if|if
condition|(
name|fscanf
argument_list|(
name|gf
operator|->
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|tmp
argument_list|)
operator|==
literal|1
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GF_NUM_SHAPES
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|tmp
argument_list|,
name|gflare_shapes
index|[
name|i
index|]
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
name|shape
operator|=
name|i
expr_stmt|;
return|return;
block|}
block|}
name|gf
operator|->
name|error
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gflare_read_mode (GFlareMode * mode,GFlareFile * gf)
name|gflare_read_mode
parameter_list|(
name|GFlareMode
modifier|*
name|mode
parameter_list|,
name|GFlareFile
modifier|*
name|gf
parameter_list|)
block|{
name|gchar
name|tmp
index|[
literal|1024
index|]
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
name|gf
operator|->
name|error
condition|)
return|return;
if|if
condition|(
name|fscanf
argument_list|(
name|gf
operator|->
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|tmp
argument_list|)
operator|==
literal|1
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GF_NUM_MODES
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|tmp
argument_list|,
name|gflare_modes
index|[
name|i
index|]
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
name|mode
operator|=
name|i
expr_stmt|;
return|return;
block|}
block|}
name|gf
operator|->
name|error
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gflare_save (GFlare * gflare)
name|gflare_save
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
specifier|static
name|int
name|message_ok
init|=
name|FALSE
decl_stmt|;
specifier|static
name|char
modifier|*
name|message
init|=
literal|"GFlare `%s' is not saved.	If you add a new entry in gimprc, like:\n"
literal|"(gflare-path \"${gimp_dir}/gflare\")\n"
literal|"and make a directory ~/.gimp/gflare, then you can save your own GFlare's\n"
literal|"into that directory."
decl_stmt|;
if|if
condition|(
name|gflare
operator|->
name|filename
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|gflare_path_list
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
operator|!
name|message_ok
condition|)
name|g_message
argument_list|(
name|message
argument_list|,
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
name|message_ok
operator|=
name|TRUE
expr_stmt|;
return|return;
block|}
comment|/* get first entry of path */
name|path
operator|=
name|gflare_path_list
operator|->
name|data
expr_stmt|;
name|gflare
operator|->
name|filename
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|path
argument_list|)
operator|+
name|strlen
argument_list|(
name|gflare
operator|->
name|name
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|gflare
operator|->
name|filename
argument_list|,
literal|"%s%s"
argument_list|,
name|path
argument_list|,
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
name|fp
operator|=
name|fopen
argument_list|(
name|gflare
operator|->
name|filename
argument_list|,
literal|"w"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_warning
argument_list|(
literal|"could not open \"%s\""
argument_list|,
name|gflare
operator|->
name|filename
argument_list|)
expr_stmt|;
return|return;
block|}
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s"
argument_list|,
name|GFLARE_FILE_HEADER
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%f %s\n"
argument_list|,
name|gflare
operator|->
name|glow_opacity
argument_list|,
name|gflare_modes
index|[
name|gflare
operator|->
name|glow_mode
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%f %s\n"
argument_list|,
name|gflare
operator|->
name|rays_opacity
argument_list|,
name|gflare_modes
index|[
name|gflare
operator|->
name|rays_mode
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%f %s\n"
argument_list|,
name|gflare
operator|->
name|sflare_opacity
argument_list|,
name|gflare_modes
index|[
name|gflare
operator|->
name|sflare_mode
index|]
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|glow_radial
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|glow_angular
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|glow_angular_size
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%f %f %f\n"
argument_list|,
name|gflare
operator|->
name|glow_size
argument_list|,
name|gflare
operator|->
name|glow_rotation
argument_list|,
name|gflare
operator|->
name|glow_hue
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|rays_radial
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|rays_angular
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|rays_angular_size
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%f %f %f\n"
argument_list|,
name|gflare
operator|->
name|rays_size
argument_list|,
name|gflare
operator|->
name|rays_rotation
argument_list|,
name|gflare
operator|->
name|rays_hue
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%d %f\n"
argument_list|,
name|gflare
operator|->
name|rays_nspikes
argument_list|,
name|gflare
operator|->
name|rays_thickness
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|sflare_radial
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|sflare_sizefac
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|gflare_write_gradient_name
argument_list|(
name|gflare
operator|->
name|sflare_probability
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%f %f %f\n"
argument_list|,
name|gflare
operator|->
name|sflare_size
argument_list|,
name|gflare
operator|->
name|sflare_rotation
argument_list|,
name|gflare
operator|->
name|sflare_hue
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s %d %d\n"
argument_list|,
name|gflare_shapes
index|[
name|gflare
operator|->
name|sflare_shape
index|]
argument_list|,
name|gflare
operator|->
name|sflare_nverts
argument_list|,
name|gflare
operator|->
name|sflare_seed
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"Saved %s\n"
operator|,
name|gflare
operator|->
name|filename
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gflare_write_gradient_name (GradientName name,FILE * fp)
name|gflare_write_gradient_name
parameter_list|(
name|GradientName
name|name
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|gchar
name|enc
index|[
literal|1024
index|]
decl_stmt|;
comment|/* @GRADIENT_NAME */
comment|/* encode white spaces and control characters (if any) */
name|gradient_name_encode
argument_list|(
operator|(
name|guchar
operator|*
operator|)
name|enc
argument_list|,
operator|(
name|guchar
operator|*
operator|)
name|name
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"%s\n"
argument_list|,
name|enc
argument_list|)
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"write_gradient_name: \"%s\" => \"%s\"\n"
operator|,
name|name
operator|,
name|enc
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gflare_name_copy (gchar * dest,gchar * src)
name|gflare_name_copy
parameter_list|(
name|gchar
modifier|*
name|dest
parameter_list|,
name|gchar
modifier|*
name|src
parameter_list|)
block|{
name|strncpy
argument_list|(
name|dest
argument_list|,
name|src
argument_list|,
name|GFLARE_NAME_MAX
argument_list|)
expr_stmt|;
name|dest
index|[
name|GFLARE_NAME_MAX
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**		+++ GFlares List					**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_function
name|gint
DECL|function|gflares_list_insert (GFlare * gflare)
name|gflares_list_insert
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
block|{
name|GList
modifier|*
name|tmp
decl_stmt|;
name|GFlare
modifier|*
name|g
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/*    *	Insert gflare in alphabetical order    */
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gflares_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|gflare
operator|->
name|name
argument_list|,
name|g
operator|->
name|name
argument_list|)
operator|<=
literal|0
condition|)
break|break;
name|n
operator|++
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
block|}
name|num_gflares
operator|++
expr_stmt|;
name|gflares_list
operator|=
name|g_list_insert
argument_list|(
name|gflares_list
argument_list|,
name|gflare
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflares_list_insert %s => %d\n"
operator|,
name|gflare
operator|->
name|name
operator|,
name|n
operator|)
argument_list|)
expr_stmt|;
return|return
name|n
return|;
block|}
end_function

begin_function
name|GFlare
modifier|*
DECL|function|gflares_list_lookup (gchar * name)
name|gflares_list_lookup
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|GList
modifier|*
name|tmp
decl_stmt|;
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflares_list_lookup %s\n"
operator|,
name|name
operator|)
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|gflares_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|gflare
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|gflare
operator|->
name|name
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
return|return
name|gflare
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gflares_list_index (GFlare * gflare)
name|gflares_list_index
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
block|{
name|GList
modifier|*
name|tmp
decl_stmt|;
name|gint
name|n
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflares_list_index %s\n"
operator|,
name|gflare
operator|->
name|name
operator|)
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gflares_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
if|if
condition|(
name|tmp
operator|->
name|data
operator|==
name|gflare
condition|)
return|return
name|n
return|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gflares_list_remove (GFlare * gflare)
name|gflares_list_remove
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|)
block|{
name|GList
modifier|*
name|tmp
decl_stmt|;
name|gint
name|n
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gflares_list_remove %s\n"
operator|,
name|gflare
operator|->
name|name
operator|)
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gflares_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
if|if
condition|(
name|tmp
operator|->
name|data
operator|==
name|gflare
condition|)
block|{
comment|/* Found! */
if|if
condition|(
name|tmp
operator|->
name|next
operator|==
name|NULL
condition|)
name|num_gflares
operator|--
expr_stmt|;
name|gflares_list
operator|=
name|g_list_remove
argument_list|(
name|gflares_list
argument_list|,
name|gflare
argument_list|)
expr_stmt|;
return|return
name|n
return|;
block|}
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_comment
comment|/*   Load all gflares, which are founded in gflare-path-list, into gflares_list.    gflares-path-list must be initialized first. (plug_in_parse_gflare_path ())  */
end_comment

begin_function
name|void
DECL|function|gflares_list_load_all ()
name|gflares_list_load_all
parameter_list|()
block|{
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|DIR
modifier|*
name|dir
decl_stmt|;
name|struct
name|dirent
modifier|*
name|dir_ent
decl_stmt|;
name|struct
name|stat
name|filestat
decl_stmt|;
name|gint
name|err
decl_stmt|;
if|#
directive|if
literal|0
comment|/* @@@ */
block|printf("Waiting... (pid %d)\n", getpid());   kill(getpid(), 19);
comment|/* SIGSTOP */
endif|#
directive|endif
comment|/*  Make sure to clear any existing gflares  */
name|gflares_list_free_all
argument_list|()
expr_stmt|;
name|list
operator|=
name|gflare_path_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|path
operator|=
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
comment|/* Open directory */
name|dir
operator|=
name|opendir
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dir
condition|)
name|g_warning
argument_list|(
literal|"error reading GFlare directory \"%s\""
argument_list|,
name|path
argument_list|)
expr_stmt|;
else|else
block|{
while|while
condition|(
operator|(
name|dir_ent
operator|=
name|readdir
argument_list|(
name|dir
argument_list|)
operator|)
condition|)
block|{
name|filename
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|path
argument_list|)
operator|+
name|strlen
argument_list|(
name|dir_ent
operator|->
name|d_name
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|filename
argument_list|,
literal|"%s%s"
argument_list|,
name|path
argument_list|,
name|dir_ent
operator|->
name|d_name
argument_list|)
expr_stmt|;
comment|/* Check the file and see that it is not a sub-directory */
name|err
operator|=
name|stat
argument_list|(
name|filename
argument_list|,
operator|&
name|filestat
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|err
operator|&&
name|S_ISREG
argument_list|(
name|filestat
operator|.
name|st_mode
argument_list|)
condition|)
block|{
name|gflare
operator|=
name|gflare_load
argument_list|(
name|filename
argument_list|,
name|dir_ent
operator|->
name|d_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|gflare
condition|)
name|gflares_list_insert
argument_list|(
name|gflare
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
comment|/* while */
name|closedir
argument_list|(
name|dir
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
block|}
end_function

begin_function
name|void
DECL|function|gflares_list_free_all ()
name|gflares_list_free_all
parameter_list|()
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|list
operator|=
name|gflares_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|gflare
operator|=
operator|(
name|GFlare
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|gflare_free
argument_list|(
name|gflare
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|gflares_list
argument_list|)
expr_stmt|;
name|gflares_list
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**		+++ Calculator						**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/*  * These routines calculates pixel values of particular gflare, at  * specified point.  The client which wants to get benefit from these  * calculation routines must call calc_init_params() first, and  * iterate calling calc_init_progress() until it returns FALSE. and  * must call calc_deinit() when job is done.  */
end_comment

begin_function
name|void
DECL|function|calc_init_params (GFlare * gflare,gint calc_type,gdouble xcenter,gdouble ycenter,gdouble radius,gdouble rotation,gdouble hue,gdouble vangle,gdouble vlength)
name|calc_init_params
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|,
name|gint
name|calc_type
parameter_list|,
name|gdouble
name|xcenter
parameter_list|,
name|gdouble
name|ycenter
parameter_list|,
name|gdouble
name|radius
parameter_list|,
name|gdouble
name|rotation
parameter_list|,
name|gdouble
name|hue
parameter_list|,
name|gdouble
name|vangle
parameter_list|,
name|gdouble
name|vlength
parameter_list|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"//// calc_init_params ////\n"
operator|)
argument_list|)
expr_stmt|;
name|calc
operator|.
name|type
operator|=
name|calc_type
expr_stmt|;
name|calc
operator|.
name|gflare
operator|=
name|gflare
expr_stmt|;
name|calc
operator|.
name|xcenter
operator|=
name|xcenter
expr_stmt|;
name|calc
operator|.
name|ycenter
operator|=
name|ycenter
expr_stmt|;
name|calc
operator|.
name|radius
operator|=
name|radius
expr_stmt|;
name|calc
operator|.
name|rotation
operator|=
name|rotation
operator|*
name|M_PI
operator|/
literal|180.0
expr_stmt|;
name|calc
operator|.
name|hue
operator|=
name|hue
expr_stmt|;
name|calc
operator|.
name|vangle
operator|=
name|vangle
operator|*
name|M_PI
operator|/
literal|180.0
expr_stmt|;
name|calc
operator|.
name|vlength
operator|=
name|radius
operator|*
name|vlength
operator|/
literal|100.0
expr_stmt|;
name|calc
operator|.
name|glow_radius
operator|=
name|radius
operator|*
name|gflare
operator|->
name|glow_size
operator|/
literal|100.0
expr_stmt|;
name|calc
operator|.
name|rays_radius
operator|=
name|radius
operator|*
name|gflare
operator|->
name|rays_size
operator|/
literal|100.0
expr_stmt|;
name|calc
operator|.
name|sflare_radius
operator|=
name|radius
operator|*
name|gflare
operator|->
name|sflare_size
operator|/
literal|100.0
expr_stmt|;
name|calc
operator|.
name|glow_rotation
operator|=
operator|(
name|rotation
operator|+
name|gflare
operator|->
name|glow_rotation
operator|)
operator|*
name|M_PI
operator|/
literal|180.0
expr_stmt|;
name|calc
operator|.
name|rays_rotation
operator|=
operator|(
name|rotation
operator|+
name|gflare
operator|->
name|rays_rotation
operator|)
operator|*
name|M_PI
operator|/
literal|180.0
expr_stmt|;
name|calc
operator|.
name|sflare_rotation
operator|=
operator|(
name|rotation
operator|+
name|gflare
operator|->
name|sflare_rotation
operator|)
operator|*
name|M_PI
operator|/
literal|180.0
expr_stmt|;
name|calc
operator|.
name|glow_opacity
operator|=
name|gflare
operator|->
name|glow_opacity
operator|*
literal|255
operator|/
literal|100.0
expr_stmt|;
name|calc
operator|.
name|rays_opacity
operator|=
name|gflare
operator|->
name|rays_opacity
operator|*
literal|255
operator|/
literal|100.0
expr_stmt|;
name|calc
operator|.
name|sflare_opacity
operator|=
name|gflare
operator|->
name|sflare_opacity
operator|*
literal|255
operator|/
literal|100.0
expr_stmt|;
name|calc
operator|.
name|glow_bounds
operator|.
name|x0
operator|=
name|calc
operator|.
name|xcenter
operator|-
name|calc
operator|.
name|glow_radius
operator|-
literal|0.1
expr_stmt|;
name|calc
operator|.
name|glow_bounds
operator|.
name|x1
operator|=
name|calc
operator|.
name|xcenter
operator|+
name|calc
operator|.
name|glow_radius
operator|+
literal|0.1
expr_stmt|;
name|calc
operator|.
name|glow_bounds
operator|.
name|y0
operator|=
name|calc
operator|.
name|ycenter
operator|-
name|calc
operator|.
name|glow_radius
operator|-
literal|0.1
expr_stmt|;
name|calc
operator|.
name|glow_bounds
operator|.
name|y1
operator|=
name|calc
operator|.
name|ycenter
operator|+
name|calc
operator|.
name|glow_radius
operator|+
literal|0.1
expr_stmt|;
name|calc
operator|.
name|rays_bounds
operator|.
name|x0
operator|=
name|calc
operator|.
name|xcenter
operator|-
name|calc
operator|.
name|rays_radius
operator|-
literal|0.1
expr_stmt|;
name|calc
operator|.
name|rays_bounds
operator|.
name|x1
operator|=
name|calc
operator|.
name|xcenter
operator|+
name|calc
operator|.
name|rays_radius
operator|+
literal|0.1
expr_stmt|;
name|calc
operator|.
name|rays_bounds
operator|.
name|y0
operator|=
name|calc
operator|.
name|ycenter
operator|-
name|calc
operator|.
name|rays_radius
operator|-
literal|0.1
expr_stmt|;
name|calc
operator|.
name|rays_bounds
operator|.
name|y1
operator|=
name|calc
operator|.
name|ycenter
operator|+
name|calc
operator|.
name|rays_radius
operator|+
literal|0.1
expr_stmt|;
comment|/* Thanks to Marcelo Malheiros for this algorithm */
name|calc
operator|.
name|rays_thinness
operator|=
name|log
argument_list|(
name|gflare
operator|->
name|rays_thickness
operator|/
literal|100.0
argument_list|)
operator|/
name|log
argument_list|(
literal|0.8
argument_list|)
expr_stmt|;
name|calc
operator|.
name|rays_spike_mod
operator|=
literal|1.0
operator|/
operator|(
literal|2
operator|*
name|gflare
operator|->
name|rays_nspikes
operator|)
expr_stmt|;
comment|/*     Initialize part of sflare     The rest will be initialized in calc_sflare()    */
name|calc
operator|.
name|sflare_list
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|sflare_shape
operator|=
name|gflare
operator|->
name|sflare_shape
expr_stmt|;
if|if
condition|(
name|calc
operator|.
name|sflare_shape
operator|==
name|GF_POLYGON
condition|)
block|{
name|calc
operator|.
name|sflare_angle
operator|=
literal|2
operator|*
name|M_PI
operator|/
operator|(
literal|2
operator|*
name|gflare
operator|->
name|sflare_nverts
operator|)
expr_stmt|;
name|calc
operator|.
name|sflare_factor
operator|=
literal|1.0
operator|/
name|cos
argument_list|(
name|calc
operator|.
name|sflare_angle
argument_list|)
expr_stmt|;
block|}
name|calc
operator|.
name|glow_radial
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|glow_angular
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|glow_angular_size
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|rays_radial
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|rays_angular
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|rays_angular_size
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|sflare_radial
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|sflare_sizefac
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|sflare_probability
operator|=
name|NULL
expr_stmt|;
name|calc
operator|.
name|init
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|int
DECL|function|calc_init_progress ()
name|calc_init_progress
parameter_list|()
block|{
if|if
condition|(
name|calc_sample_one_gradient
argument_list|()
condition|)
return|return
name|TRUE
return|;
name|calc_place_sflare
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*    Store samples of gradient into an array    this routine is called during Calc initialization    this code is very messy... :( */
end_comment

begin_function
specifier|static
name|int
DECL|function|calc_sample_one_gradient ()
name|calc_sample_one_gradient
parameter_list|()
block|{
DECL|struct|__anon28e4550f1308
specifier|static
struct|struct
block|{
DECL|member|values
name|guchar
modifier|*
modifier|*
name|values
decl_stmt|;
DECL|member|name_offset
name|gint
name|name_offset
decl_stmt|;
DECL|member|hue_offset
name|gint
name|hue_offset
decl_stmt|;
DECL|member|gray
name|gint
name|gray
decl_stmt|;
block|}
name|table
index|[]
init|=
block|{
block|{
operator|&
name|calc
operator|.
name|glow_radial
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|glow_radial
argument_list|)
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|glow_hue
argument_list|)
block|,
name|FALSE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|glow_angular
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|glow_angular
argument_list|)
block|,
literal|0
block|,
name|FALSE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|glow_angular_size
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|glow_angular_size
argument_list|)
block|,
literal|0
block|,
name|TRUE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|rays_radial
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|rays_radial
argument_list|)
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|rays_hue
argument_list|)
block|,
name|FALSE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|rays_angular
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|rays_angular
argument_list|)
block|,
literal|0
block|,
name|FALSE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|rays_angular_size
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|rays_angular_size
argument_list|)
block|,
literal|0
block|,
name|TRUE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|sflare_radial
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|sflare_radial
argument_list|)
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|sflare_hue
argument_list|)
block|,
name|FALSE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|sflare_sizefac
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|sflare_sizefac
argument_list|)
block|,
literal|0
block|,
name|TRUE
block|}
block|,
block|{
operator|&
name|calc
operator|.
name|sflare_probability
block|,
name|OFFSETOF
argument_list|(
name|GFlare
argument_list|,
name|sflare_probability
argument_list|)
block|,
literal|0
block|,
name|TRUE
block|}
block|,   }
struct|;
name|GFlare
modifier|*
name|gflare
init|=
name|calc
operator|.
name|gflare
decl_stmt|;
name|GradientName
modifier|*
name|grad_name
decl_stmt|;
name|guchar
modifier|*
name|gradient
decl_stmt|;
name|gdouble
name|hue_deg
decl_stmt|;
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|,
name|hue
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|table
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|table
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|*
operator|(
name|table
index|[
name|i
index|]
operator|.
name|values
operator|)
operator|==
name|NULL
condition|)
block|{
comment|/* @GRADIENT_NAME */
name|grad_name
operator|=
operator|(
name|GradientName
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|gflare
operator|+
name|table
index|[
name|i
index|]
operator|.
name|name_offset
operator|)
expr_stmt|;
name|gradient
operator|=
operator|*
operator|(
name|table
index|[
name|i
index|]
operator|.
name|values
operator|)
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
literal|4
operator|*
name|GRADIENT_RESOLUTION
argument_list|)
expr_stmt|;
name|gradient_get_values
argument_list|(
operator|*
name|grad_name
argument_list|,
name|gradient
argument_list|,
name|GRADIENT_RESOLUTION
argument_list|)
expr_stmt|;
comment|/* 	   * Do hue rotation, if needed 	   */
if|if
condition|(
name|table
index|[
name|i
index|]
operator|.
name|hue_offset
operator|!=
literal|0
condition|)
block|{
name|hue_deg
operator|=
name|calc
operator|.
name|hue
operator|+
operator|*
operator|(
name|gdouble
operator|*
operator|)
operator|(
operator|(
name|char
operator|*
operator|)
name|gflare
operator|+
name|table
index|[
name|i
index|]
operator|.
name|hue_offset
operator|)
expr_stmt|;
name|hue
operator|=
call|(
name|gint
call|)
argument_list|(
name|hue_deg
operator|/
literal|360.0
operator|*
literal|256.0
argument_list|)
operator|%
literal|256
expr_stmt|;
if|if
condition|(
name|hue
operator|<
literal|0
condition|)
name|hue
operator|+=
literal|256
expr_stmt|;
name|g_assert
argument_list|(
literal|0
operator|<=
name|hue
operator|&&
name|hue
operator|<
literal|256
argument_list|)
expr_stmt|;
if|if
condition|(
name|hue
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|GRADIENT_RESOLUTION
condition|;
name|j
operator|++
control|)
block|{
name|gint
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|r
operator|=
name|gradient
index|[
name|j
operator|*
literal|4
index|]
expr_stmt|;
name|g
operator|=
name|gradient
index|[
name|j
operator|*
literal|4
operator|+
literal|1
index|]
expr_stmt|;
name|b
operator|=
name|gradient
index|[
name|j
operator|*
literal|4
operator|+
literal|2
index|]
expr_stmt|;
name|rgb_to_hsv
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
name|r
operator|=
operator|(
name|r
operator|+
name|hue
operator|)
operator|%
literal|256
expr_stmt|;
name|hsv_to_rgb
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
name|gradient
index|[
name|j
operator|*
literal|4
index|]
operator|=
name|r
expr_stmt|;
name|gradient
index|[
name|j
operator|*
literal|4
operator|+
literal|1
index|]
operator|=
name|g
expr_stmt|;
name|gradient
index|[
name|j
operator|*
literal|4
operator|+
literal|2
index|]
operator|=
name|b
expr_stmt|;
block|}
block|}
block|}
comment|/* 	   *	Grayfy gradient, if needed 	   */
if|if
condition|(
name|table
index|[
name|i
index|]
operator|.
name|gray
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|GRADIENT_RESOLUTION
condition|;
name|j
operator|++
control|)
comment|/* the first byte is enough */
name|gradient
index|[
name|j
operator|*
literal|4
index|]
operator|=
name|LUMINOSITY
argument_list|(
operator|(
name|gradient
operator|+
name|j
operator|*
literal|4
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/* sampling of one gradient is done */
return|return
name|TRUE
return|;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_place_sflare ()
name|calc_place_sflare
parameter_list|()
block|{
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|CalcSFlare
modifier|*
name|sflare
decl_stmt|;
name|gdouble
name|prob
index|[
name|GRADIENT_RESOLUTION
index|]
decl_stmt|;
name|gdouble
name|sum
decl_stmt|,
name|sum2
decl_stmt|;
name|gdouble
name|pos
decl_stmt|;
name|gdouble
name|rnd
decl_stmt|,
name|sizefac
decl_stmt|;
name|int
name|n
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|(
name|calc
operator|.
name|type
operator|&
name|CALC_SFLARE
operator|)
operator|==
literal|0
condition|)
return|return;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"calc_place_sflare\n"
operator|)
argument_list|)
expr_stmt|;
name|gflare
operator|=
name|calc
operator|.
name|gflare
expr_stmt|;
comment|/*     Calc cumulative probability     */
name|sum
operator|=
literal|0.0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRADIENT_RESOLUTION
condition|;
name|i
operator|++
control|)
block|{
comment|/* probability gradient was grayfied already */
name|prob
index|[
name|i
index|]
operator|=
name|calc
operator|.
name|sflare_probability
index|[
name|i
operator|*
literal|4
index|]
expr_stmt|;
name|sum
operator|+=
name|prob
index|[
name|i
index|]
expr_stmt|;
block|}
if|if
condition|(
name|sum
operator|==
literal|0.0
condition|)
name|sum
operator|=
literal|1.0
expr_stmt|;
name|sum2
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRADIENT_RESOLUTION
condition|;
name|i
operator|++
control|)
block|{
name|sum2
operator|+=
name|prob
index|[
name|i
index|]
expr_stmt|;
comment|/* cumulation */
name|prob
index|[
name|i
index|]
operator|=
name|sum2
operator|/
name|sum
expr_stmt|;
block|}
if|if
condition|(
name|gflare
operator|->
name|sflare_seed
operator|==
operator|-
literal|1
condition|)
name|srand
argument_list|(
name|time
argument_list|(
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|srand
argument_list|(
name|gflare
operator|->
name|sflare_seed
argument_list|)
expr_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|SFLARE_NUM
condition|;
name|n
operator|++
control|)
block|{
name|sflare
operator|=
name|g_new
argument_list|(
name|CalcSFlare
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rnd
operator|=
operator|(
name|double
operator|)
name|rand
argument_list|()
operator|/
name|RAND_MAX
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRADIENT_RESOLUTION
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|prob
index|[
name|i
index|]
operator|>=
name|rnd
condition|)
break|break;
if|if
condition|(
name|i
operator|>=
name|GRADIENT_RESOLUTION
condition|)
name|i
operator|=
name|GRADIENT_RESOLUTION
operator|-
literal|1
expr_stmt|;
comment|/* sizefac gradient was grayfied already */
name|sizefac
operator|=
name|calc
operator|.
name|sflare_sizefac
index|[
name|i
operator|*
literal|4
index|]
operator|/
literal|255.0
expr_stmt|;
name|sizefac
operator|=
name|pow
argument_list|(
name|sizefac
argument_list|,
literal|5.0
argument_list|)
expr_stmt|;
name|pos
operator|=
call|(
name|double
call|)
argument_list|(
name|i
operator|-
name|GRADIENT_RESOLUTION
operator|/
literal|2
argument_list|)
operator|/
name|GRADIENT_RESOLUTION
expr_stmt|;
name|sflare
operator|->
name|xcenter
operator|=
name|calc
operator|.
name|xcenter
operator|+
name|cos
argument_list|(
name|calc
operator|.
name|vangle
argument_list|)
operator|*
name|calc
operator|.
name|vlength
operator|*
name|pos
expr_stmt|;
name|sflare
operator|->
name|ycenter
operator|=
name|calc
operator|.
name|ycenter
operator|-
name|sin
argument_list|(
name|calc
operator|.
name|vangle
argument_list|)
operator|*
name|calc
operator|.
name|vlength
operator|*
name|pos
expr_stmt|;
name|sflare
operator|->
name|radius
operator|=
name|sizefac
operator|*
name|calc
operator|.
name|sflare_radius
expr_stmt|;
comment|/* FIXME */
name|sflare
operator|->
name|bounds
operator|.
name|x0
operator|=
name|sflare
operator|->
name|xcenter
operator|-
name|sflare
operator|->
name|radius
operator|-
literal|1
expr_stmt|;
name|sflare
operator|->
name|bounds
operator|.
name|x1
operator|=
name|sflare
operator|->
name|xcenter
operator|+
name|sflare
operator|->
name|radius
operator|+
literal|1
expr_stmt|;
name|sflare
operator|->
name|bounds
operator|.
name|y0
operator|=
name|sflare
operator|->
name|ycenter
operator|-
name|sflare
operator|->
name|radius
operator|-
literal|1
expr_stmt|;
name|sflare
operator|->
name|bounds
operator|.
name|y1
operator|=
name|sflare
operator|->
name|ycenter
operator|+
name|sflare
operator|->
name|radius
operator|+
literal|1
expr_stmt|;
name|calc
operator|.
name|sflare_list
operator|=
name|g_list_append
argument_list|(
name|calc
operator|.
name|sflare_list
argument_list|,
name|sflare
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|calc_deinit ()
name|calc_deinit
parameter_list|()
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"\\\\\\\\ calc_deinit \\\\\\\\ \n"
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|calc
operator|.
name|init
condition|)
block|{
name|g_warning
argument_list|(
literal|"calc_deinit: not initialized"
argument_list|)
expr_stmt|;
return|return;
block|}
name|list
operator|=
name|calc
operator|.
name|sflare_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|g_free
argument_list|(
name|list
operator|->
name|data
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|calc
operator|.
name|sflare_list
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|glow_radial
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|glow_angular
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|glow_angular_size
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|rays_radial
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|rays_angular
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|rays_angular_size
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|sflare_radial
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|sflare_sizefac
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|calc
operator|.
name|sflare_probability
argument_list|)
expr_stmt|;
name|calc
operator|.
name|init
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  Get sample value at specified position of a gradient  *  *  gradient samples are stored into array at the time of  *  calc_sample_one_gradients (), and it is now linear interpolated.  *  *  INPUT:  *	guchar	gradient[4*GRADIENT_RESOLUTION]		gradient array(RGBA)  *	gdouble pos					position (0<=pos<=1)  *  OUTPUT:  *	guchar	pix[4]  */
end_comment

begin_function
specifier|static
name|void
DECL|function|calc_get_gradient (guchar * pix,guchar * gradient,gdouble pos)
name|calc_get_gradient
parameter_list|(
name|guchar
modifier|*
name|pix
parameter_list|,
name|guchar
modifier|*
name|gradient
parameter_list|,
name|gdouble
name|pos
parameter_list|)
block|{
name|gint
name|ipos
decl_stmt|;
name|gdouble
name|frac
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
name|pos
operator|<
literal|0
operator|||
name|pos
operator|>
literal|1
condition|)
block|{
name|pix
index|[
literal|0
index|]
operator|=
name|pix
index|[
literal|1
index|]
operator|=
name|pix
index|[
literal|2
index|]
operator|=
name|pix
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
return|return;
block|}
name|pos
operator|*=
name|GRADIENT_RESOLUTION
operator|-
literal|1.0001
expr_stmt|;
name|ipos
operator|=
operator|(
name|gint
operator|)
name|pos
expr_stmt|;
name|frac
operator|=
name|pos
operator|-
name|ipos
expr_stmt|;
name|gradient
operator|+=
name|ipos
operator|*
literal|4
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|pix
index|[
name|i
index|]
operator|=
name|gradient
index|[
name|i
index|]
operator|*
operator|(
literal|1
operator|-
name|frac
operator|)
operator|+
name|gradient
index|[
name|i
operator|+
literal|4
index|]
operator|*
name|frac
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* I need fmod to return always positive value */
end_comment

begin_function
specifier|static
name|gdouble
DECL|function|fmod_positive (gdouble x,gdouble m)
name|fmod_positive
parameter_list|(
name|gdouble
name|x
parameter_list|,
name|gdouble
name|m
parameter_list|)
block|{
return|return
name|x
operator|-
name|floor
argument_list|(
name|x
operator|/
name|m
argument_list|)
operator|*
name|m
return|;
block|}
end_function

begin_comment
comment|/*  *  Calc glow's pixel (RGBA) value  *  INPUT:  *	gdouble x, y			image coordinates  *  OUTPUT:  *	guchar	pix[4]  */
end_comment

begin_function
name|void
DECL|function|calc_glow_pix (guchar * dest_pix,gdouble x,gdouble y)
name|calc_glow_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|)
block|{
name|gdouble
name|radius
decl_stmt|,
name|angle
decl_stmt|;
name|gdouble
name|angular_size
decl_stmt|;
name|guchar
name|radial_pix
index|[
literal|4
index|]
decl_stmt|,
name|angular_pix
index|[
literal|4
index|]
decl_stmt|,
name|size_pix
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
operator|(
name|calc
operator|.
name|type
operator|&
name|CALC_GLOW
operator|)
operator|==
literal|0
operator|||
name|x
operator|<
name|calc
operator|.
name|glow_bounds
operator|.
name|x0
operator|||
name|x
operator|>
name|calc
operator|.
name|glow_bounds
operator|.
name|x1
operator|||
name|y
operator|<
name|calc
operator|.
name|glow_bounds
operator|.
name|y0
operator|||
name|y
operator|>
name|calc
operator|.
name|glow_bounds
operator|.
name|y1
condition|)
block|{
name|memset
argument_list|(
name|dest_pix
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return;
block|}
name|x
operator|-=
name|calc
operator|.
name|xcenter
expr_stmt|;
name|y
operator|-=
name|calc
operator|.
name|ycenter
expr_stmt|;
name|radius
operator|=
name|sqrt
argument_list|(
name|x
operator|*
name|x
operator|+
name|y
operator|*
name|y
argument_list|)
operator|/
name|calc
operator|.
name|glow_radius
expr_stmt|;
name|angle
operator|=
operator|(
name|atan2
argument_list|(
operator|-
name|y
argument_list|,
name|x
argument_list|)
operator|+
name|calc
operator|.
name|glow_rotation
operator|)
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
expr_stmt|;
name|angle
operator|=
name|fmod_positive
argument_list|(
name|angle
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|calc_get_gradient
argument_list|(
name|size_pix
argument_list|,
name|calc
operator|.
name|glow_angular_size
argument_list|,
name|angle
argument_list|)
expr_stmt|;
comment|/* angular_size gradient was grayfied already */
name|angular_size
operator|=
name|size_pix
index|[
literal|0
index|]
operator|/
literal|255.0
expr_stmt|;
name|radius
operator|/=
operator|(
name|angular_size
operator|+
literal|0.0001
operator|)
expr_stmt|;
comment|/* in case angular_size == 0.0 */
if|if
condition|(
name|radius
operator|<
literal|0
operator|||
name|radius
operator|>
literal|1
condition|)
block|{
name|memset
argument_list|(
name|dest_pix
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return;
block|}
name|calc_get_gradient
argument_list|(
name|radial_pix
argument_list|,
name|calc
operator|.
name|glow_radial
argument_list|,
name|radius
argument_list|)
expr_stmt|;
name|calc_get_gradient
argument_list|(
name|angular_pix
argument_list|,
name|calc
operator|.
name|glow_angular
argument_list|,
name|angle
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
name|dest_pix
index|[
name|i
index|]
operator|=
name|radial_pix
index|[
name|i
index|]
operator|*
name|angular_pix
index|[
name|i
index|]
operator|/
literal|255
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  Calc rays's pixel (RGBA) value  *  */
end_comment

begin_function
name|void
DECL|function|calc_rays_pix (guchar * dest_pix,gdouble x,gdouble y)
name|calc_rays_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|)
block|{
name|gdouble
name|radius
decl_stmt|,
name|angle
decl_stmt|;
name|gdouble
name|angular_size
decl_stmt|;
name|gdouble
name|spike_frac
decl_stmt|,
name|spike_inten
decl_stmt|,
name|spike_angle
decl_stmt|;
name|guchar
name|radial_pix
index|[
literal|4
index|]
decl_stmt|,
name|angular_pix
index|[
literal|4
index|]
decl_stmt|,
name|size_pix
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
operator|(
name|calc
operator|.
name|type
operator|&
name|CALC_RAYS
operator|)
operator|==
literal|0
operator|||
name|x
operator|<
name|calc
operator|.
name|rays_bounds
operator|.
name|x0
operator|||
name|x
operator|>
name|calc
operator|.
name|rays_bounds
operator|.
name|x1
operator|||
name|y
operator|<
name|calc
operator|.
name|rays_bounds
operator|.
name|y0
operator|||
name|y
operator|>
name|calc
operator|.
name|rays_bounds
operator|.
name|y1
condition|)
block|{
name|memset
argument_list|(
name|dest_pix
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return;
block|}
name|x
operator|-=
name|calc
operator|.
name|xcenter
expr_stmt|;
name|y
operator|-=
name|calc
operator|.
name|ycenter
expr_stmt|;
name|radius
operator|=
name|sqrt
argument_list|(
name|x
operator|*
name|x
operator|+
name|y
operator|*
name|y
argument_list|)
operator|/
name|calc
operator|.
name|rays_radius
expr_stmt|;
name|angle
operator|=
operator|(
name|atan2
argument_list|(
operator|-
name|y
argument_list|,
name|x
argument_list|)
operator|+
name|calc
operator|.
name|rays_rotation
operator|)
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
expr_stmt|;
name|angle
operator|=
name|fmod_positive
argument_list|(
name|angle
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
comment|/* make sure 0<= angle< 1.0 */
name|spike_frac
operator|=
name|fmod
argument_list|(
name|angle
argument_list|,
name|calc
operator|.
name|rays_spike_mod
operator|*
literal|2
argument_list|)
expr_stmt|;
name|spike_angle
operator|=
name|angle
operator|-
name|spike_frac
operator|+
name|calc
operator|.
name|rays_spike_mod
expr_stmt|;
name|spike_frac
operator|=
operator|(
name|angle
operator|-
name|spike_angle
operator|)
operator|/
name|calc
operator|.
name|rays_spike_mod
expr_stmt|;
comment|/* spike_frac is between -1.0 and 1.0 here (except round error...) */
name|spike_inten
operator|=
name|pow
argument_list|(
literal|1.0
operator|-
name|fabs
argument_list|(
name|spike_frac
argument_list|)
argument_list|,
name|calc
operator|.
name|rays_thinness
argument_list|)
expr_stmt|;
name|calc_get_gradient
argument_list|(
name|size_pix
argument_list|,
name|calc
operator|.
name|rays_angular_size
argument_list|,
name|spike_angle
argument_list|)
expr_stmt|;
comment|/* angular_size gradient was grayfied already */
name|angular_size
operator|=
name|size_pix
index|[
literal|0
index|]
operator|/
literal|255.0
expr_stmt|;
name|radius
operator|/=
operator|(
name|angular_size
operator|+
literal|0.0001
operator|)
expr_stmt|;
comment|/* in case angular_size == 0.0 */
if|if
condition|(
name|radius
operator|<
literal|0
operator|||
name|radius
operator|>
literal|1
condition|)
block|{
name|memset
argument_list|(
name|dest_pix
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return;
block|}
name|calc_get_gradient
argument_list|(
name|radial_pix
argument_list|,
name|calc
operator|.
name|rays_radial
argument_list|,
name|radius
argument_list|)
expr_stmt|;
name|calc_get_gradient
argument_list|(
name|angular_pix
argument_list|,
name|calc
operator|.
name|rays_angular
argument_list|,
name|spike_angle
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
name|dest_pix
index|[
name|i
index|]
operator|=
name|radial_pix
index|[
name|i
index|]
operator|*
name|angular_pix
index|[
name|i
index|]
operator|/
literal|255
expr_stmt|;
name|dest_pix
index|[
literal|3
index|]
operator|=
name|spike_inten
operator|*
name|radial_pix
index|[
literal|3
index|]
operator|*
name|angular_pix
index|[
literal|3
index|]
operator|/
literal|255
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  Calc sflare's pixel (RGBA) value  *  *  the sflare (second flares) are needed to be rendered one each  *  sequencially, onto the source image, such as like usual layer  *  operations. So the function takes src_pix as argment.  glow, rays  *  routines don't have src_pix as argment, because of convienience.  *  *  @JAPANESE  *  sflare
comment|$B$OJ#?t$N%U%l%"$r=g$K
comment|(B(
comment|$B%l%$%dE*$K
comment|(B)
comment|$B$+$V$;$J$,$iIA2h$9$kI,MW$,
comment|(B  *
comment|$B$"$k$N$G!"$3$l$@$1
comment|(B src_pix
comment|$B$r0z?t$K$H$C$F
comment|(B paint_func
comment|$B$rE,MQ$9$k!#
comment|(B  *  glow, rays
comment|$B$O4J0W2=$N$?$a$K$J$7!#
comment|(B  */
end_comment

begin_function
name|void
DECL|function|calc_sflare_pix (guchar * dest_pix,gdouble x,gdouble y,guchar * src_pix)
name|calc_sflare_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|,
name|guchar
modifier|*
name|src_pix
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|CalcSFlare
modifier|*
name|sflare
decl_stmt|;
name|gdouble
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|th
decl_stmt|;
name|gdouble
name|radius
decl_stmt|,
name|angle
decl_stmt|;
name|guchar
name|radial_pix
index|[
literal|4
index|]
decl_stmt|,
name|tmp_pix
index|[
literal|4
index|]
decl_stmt|;
name|memcpy
argument_list|(
name|dest_pix
argument_list|,
name|src_pix
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|calc
operator|.
name|type
operator|&
name|CALC_SFLARE
operator|)
operator|==
literal|0
condition|)
return|return;
name|list
operator|=
name|calc
operator|.
name|sflare_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|sflare
operator|=
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|x
operator|<
name|sflare
operator|->
name|bounds
operator|.
name|x0
operator|||
name|x
operator|>
name|sflare
operator|->
name|bounds
operator|.
name|x1
operator|||
name|y
operator|<
name|sflare
operator|->
name|bounds
operator|.
name|y0
operator|||
name|y
operator|>
name|sflare
operator|->
name|bounds
operator|.
name|y1
condition|)
continue|continue;
name|sx
operator|=
name|x
operator|-
name|sflare
operator|->
name|xcenter
expr_stmt|;
name|sy
operator|=
name|y
operator|-
name|sflare
operator|->
name|ycenter
expr_stmt|;
name|radius
operator|=
name|sqrt
argument_list|(
name|sx
operator|*
name|sx
operator|+
name|sy
operator|*
name|sy
argument_list|)
operator|/
name|sflare
operator|->
name|radius
expr_stmt|;
if|if
condition|(
name|calc
operator|.
name|sflare_shape
operator|==
name|GF_POLYGON
condition|)
block|{
name|angle
operator|=
name|atan2
argument_list|(
operator|-
name|sy
argument_list|,
name|sx
argument_list|)
operator|-
name|calc
operator|.
name|vangle
operator|+
name|calc
operator|.
name|sflare_rotation
expr_stmt|;
name|th
operator|=
name|fmod_positive
argument_list|(
name|angle
argument_list|,
name|calc
operator|.
name|sflare_angle
operator|*
literal|2
argument_list|)
operator|-
name|calc
operator|.
name|sflare_angle
expr_stmt|;
name|radius
operator|*=
name|cos
argument_list|(
name|th
argument_list|)
operator|*
name|calc
operator|.
name|sflare_factor
expr_stmt|;
block|}
if|if
condition|(
name|radius
operator|<
literal|0
operator|||
name|radius
operator|>
literal|1
condition|)
continue|continue;
name|calc_get_gradient
argument_list|(
name|radial_pix
argument_list|,
name|calc
operator|.
name|sflare_radial
argument_list|,
name|radius
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|tmp_pix
argument_list|,
name|dest_pix
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|calc_paint_func
argument_list|(
name|dest_pix
argument_list|,
name|tmp_pix
argument_list|,
name|radial_pix
argument_list|,
name|calc
operator|.
name|sflare_opacity
argument_list|,
name|calc
operator|.
name|gflare
operator|->
name|sflare_mode
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|calc_gflare_pix (guchar * dest_pix,gdouble x,gdouble y,guchar * src_pix)
name|calc_gflare_pix
parameter_list|(
name|guchar
modifier|*
name|dest_pix
parameter_list|,
name|gdouble
name|x
parameter_list|,
name|gdouble
name|y
parameter_list|,
name|guchar
modifier|*
name|src_pix
parameter_list|)
block|{
name|GFlare
modifier|*
name|gflare
init|=
name|calc
operator|.
name|gflare
decl_stmt|;
name|guchar
name|glow_pix
index|[
literal|4
index|]
decl_stmt|,
name|rays_pix
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|tmp_pix
index|[
literal|4
index|]
decl_stmt|;
name|memcpy
argument_list|(
name|dest_pix
argument_list|,
name|src_pix
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|calc
operator|.
name|type
operator|&
name|CALC_GLOW
condition|)
block|{
name|memcpy
argument_list|(
name|tmp_pix
argument_list|,
name|dest_pix
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|calc_glow_pix
argument_list|(
name|glow_pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|calc_paint_func
argument_list|(
name|dest_pix
argument_list|,
name|tmp_pix
argument_list|,
name|glow_pix
argument_list|,
name|calc
operator|.
name|glow_opacity
argument_list|,
name|gflare
operator|->
name|glow_mode
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|calc
operator|.
name|type
operator|&
name|CALC_RAYS
condition|)
block|{
name|memcpy
argument_list|(
name|tmp_pix
argument_list|,
name|dest_pix
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|calc_rays_pix
argument_list|(
name|rays_pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|calc_paint_func
argument_list|(
name|dest_pix
argument_list|,
name|tmp_pix
argument_list|,
name|rays_pix
argument_list|,
name|calc
operator|.
name|rays_opacity
argument_list|,
name|gflare
operator|->
name|rays_mode
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|calc
operator|.
name|type
operator|&
name|CALC_SFLARE
condition|)
block|{
name|memcpy
argument_list|(
name|tmp_pix
argument_list|,
name|dest_pix
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|calc_sflare_pix
argument_list|(
name|dest_pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|tmp_pix
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* 	Paint func routines, such as Normal, Addition, ...  */
end_comment

begin_function
specifier|static
name|void
DECL|function|calc_paint_func (guchar * dest,guchar * src1,guchar * src2,gint opacity,GFlareMode mode)
name|calc_paint_func
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|,
name|gint
name|opacity
parameter_list|,
name|GFlareMode
name|mode
parameter_list|)
block|{
name|guchar
name|buf
index|[
literal|4
index|]
decl_stmt|,
modifier|*
name|s
init|=
name|buf
decl_stmt|;
if|if
condition|(
name|src2
index|[
literal|3
index|]
operator|==
literal|0
operator|||
name|opacity
operator|<=
literal|0
condition|)
block|{
name|memcpy
argument_list|(
name|dest
argument_list|,
name|src1
argument_list|,
literal|4
argument_list|)
expr_stmt|;
return|return;
block|}
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
name|GF_NORMAL
case|:
name|s
operator|=
name|src2
expr_stmt|;
break|break;
case|case
name|GF_ADDITION
case|:
name|calc_addition
argument_list|(
name|s
argument_list|,
name|src1
argument_list|,
name|src2
argument_list|)
expr_stmt|;
break|break;
case|case
name|GF_OVERLAY
case|:
name|calc_overlay
argument_list|(
name|s
argument_list|,
name|src1
argument_list|,
name|src2
argument_list|)
expr_stmt|;
break|break;
case|case
name|GF_SCREEN
case|:
name|calc_screen
argument_list|(
name|s
argument_list|,
name|src1
argument_list|,
name|src2
argument_list|)
expr_stmt|;
break|break;
default|default:
name|s
operator|=
name|src2
expr_stmt|;
break|break;
block|}
name|calc_combine
argument_list|(
name|dest
argument_list|,
name|src1
argument_list|,
name|s
argument_list|,
name|opacity
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_combine (guchar * dest,guchar * src1,guchar * src2,gint opacity)
name|calc_combine
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|,
name|gint
name|opacity
parameter_list|)
block|{
name|gdouble
name|s1_a
decl_stmt|,
name|s2_a
decl_stmt|,
name|new_a
decl_stmt|;
name|gdouble
name|ratio
decl_stmt|,
name|compl_ratio
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|s1_a
operator|=
name|src1
index|[
literal|3
index|]
operator|/
literal|255.0
expr_stmt|;
name|s2_a
operator|=
name|src2
index|[
literal|3
index|]
operator|*
name|opacity
operator|/
literal|65025.0
expr_stmt|;
name|new_a
operator|=
name|s1_a
operator|+
operator|(
literal|1.0
operator|-
name|s1_a
operator|)
operator|*
name|s2_a
expr_stmt|;
if|if
condition|(
name|new_a
operator|!=
literal|0.0
condition|)
name|ratio
operator|=
name|s2_a
operator|/
name|new_a
expr_stmt|;
else|else
name|ratio
operator|=
literal|0.0
expr_stmt|;
name|compl_ratio
operator|=
literal|1.0
operator|-
name|ratio
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
name|dest
index|[
name|i
index|]
operator|=
name|src1
index|[
name|i
index|]
operator|*
name|compl_ratio
operator|+
name|src2
index|[
name|i
index|]
operator|*
name|ratio
expr_stmt|;
name|dest
index|[
literal|3
index|]
operator|=
name|new_a
operator|*
literal|255.0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_addition (guchar * dest,guchar * src1,guchar * src2)
name|calc_addition
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|)
block|{
name|gint
name|tmp
decl_stmt|,
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|tmp
operator|=
name|src1
index|[
name|i
index|]
operator|+
name|src2
index|[
name|i
index|]
expr_stmt|;
name|dest
index|[
name|i
index|]
operator|=
name|tmp
operator|<=
literal|255
condition|?
name|tmp
else|:
literal|255
expr_stmt|;
block|}
name|dest
index|[
literal|3
index|]
operator|=
name|MIN
argument_list|(
name|src1
index|[
literal|3
index|]
argument_list|,
name|src2
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_screen (guchar * dest,guchar * src1,guchar * src2)
name|calc_screen
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|dest
index|[
name|i
index|]
operator|=
literal|255
operator|-
operator|(
operator|(
literal|255
operator|-
name|src1
index|[
name|i
index|]
operator|)
operator|*
operator|(
literal|255
operator|-
name|src2
index|[
name|i
index|]
operator|)
operator|)
operator|/
literal|255
expr_stmt|;
block|}
name|dest
index|[
literal|3
index|]
operator|=
name|MIN
argument_list|(
name|src1
index|[
literal|3
index|]
argument_list|,
name|src2
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_overlay (guchar * dest,guchar * src1,guchar * src2)
name|calc_overlay
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src1
parameter_list|,
name|guchar
modifier|*
name|src2
parameter_list|)
block|{
name|gint
name|screen
decl_stmt|,
name|mult
decl_stmt|,
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|screen
operator|=
literal|255
operator|-
operator|(
operator|(
literal|255
operator|-
name|src1
index|[
name|i
index|]
operator|)
operator|*
operator|(
literal|255
operator|-
name|src2
index|[
name|i
index|]
operator|)
operator|)
operator|/
literal|255
expr_stmt|;
name|mult
operator|=
operator|(
name|src1
index|[
name|i
index|]
operator|*
name|src2
index|[
name|i
index|]
operator|)
operator|/
literal|255
expr_stmt|;
name|dest
index|[
name|i
index|]
operator|=
operator|(
name|screen
operator|*
name|src1
index|[
name|i
index|]
operator|+
name|mult
operator|*
operator|(
literal|255
operator|-
name|src1
index|[
name|i
index|]
operator|)
operator|)
operator|/
literal|255
expr_stmt|;
block|}
name|dest
index|[
literal|3
index|]
operator|=
name|MIN
argument_list|(
name|src1
index|[
literal|3
index|]
argument_list|,
name|src2
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* 	HSV routines, needed for Hue Rotation 	taken from app/paint_funcs.c 	And I don't know what's the difference between HSV and HSL.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|rgb_to_hsv (int * r,int * g,int * b)
name|rgb_to_hsv
parameter_list|(
name|int
modifier|*
name|r
parameter_list|,
name|int
modifier|*
name|g
parameter_list|,
name|int
modifier|*
name|b
parameter_list|)
block|{
name|int
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
name|float
name|h
decl_stmt|,
name|s
decl_stmt|,
name|v
decl_stmt|;
name|int
name|min
decl_stmt|,
name|max
decl_stmt|;
name|int
name|delta
decl_stmt|;
name|h
operator|=
literal|0.0
expr_stmt|;
name|red
operator|=
operator|*
name|r
expr_stmt|;
name|green
operator|=
operator|*
name|g
expr_stmt|;
name|blue
operator|=
operator|*
name|b
expr_stmt|;
if|if
condition|(
name|red
operator|>
name|green
condition|)
block|{
if|if
condition|(
name|red
operator|>
name|blue
condition|)
name|max
operator|=
name|red
expr_stmt|;
else|else
name|max
operator|=
name|blue
expr_stmt|;
if|if
condition|(
name|green
operator|<
name|blue
condition|)
name|min
operator|=
name|green
expr_stmt|;
else|else
name|min
operator|=
name|blue
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|green
operator|>
name|blue
condition|)
name|max
operator|=
name|green
expr_stmt|;
else|else
name|max
operator|=
name|blue
expr_stmt|;
if|if
condition|(
name|red
operator|<
name|blue
condition|)
name|min
operator|=
name|red
expr_stmt|;
else|else
name|min
operator|=
name|blue
expr_stmt|;
block|}
name|v
operator|=
name|max
expr_stmt|;
if|if
condition|(
name|max
operator|!=
literal|0
condition|)
name|s
operator|=
operator|(
operator|(
name|max
operator|-
name|min
operator|)
operator|*
literal|255
operator|)
operator|/
operator|(
name|float
operator|)
name|max
expr_stmt|;
else|else
name|s
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|s
operator|==
literal|0
condition|)
name|h
operator|=
literal|0
expr_stmt|;
else|else
block|{
name|delta
operator|=
name|max
operator|-
name|min
expr_stmt|;
if|if
condition|(
name|red
operator|==
name|max
condition|)
name|h
operator|=
operator|(
name|green
operator|-
name|blue
operator|)
operator|/
operator|(
name|float
operator|)
name|delta
expr_stmt|;
elseif|else
if|if
condition|(
name|green
operator|==
name|max
condition|)
name|h
operator|=
literal|2
operator|+
operator|(
name|blue
operator|-
name|red
operator|)
operator|/
operator|(
name|float
operator|)
name|delta
expr_stmt|;
elseif|else
if|if
condition|(
name|blue
operator|==
name|max
condition|)
name|h
operator|=
literal|4
operator|+
operator|(
name|red
operator|-
name|green
operator|)
operator|/
operator|(
name|float
operator|)
name|delta
expr_stmt|;
name|h
operator|*=
literal|42.5
expr_stmt|;
if|if
condition|(
name|h
operator|<
literal|0
condition|)
name|h
operator|+=
literal|255
expr_stmt|;
if|if
condition|(
name|h
operator|>
literal|255
condition|)
name|h
operator|-=
literal|255
expr_stmt|;
block|}
operator|*
name|r
operator|=
name|h
expr_stmt|;
operator|*
name|g
operator|=
name|s
expr_stmt|;
operator|*
name|b
operator|=
name|v
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hsv_to_rgb (int * h,int * s,int * v)
name|hsv_to_rgb
parameter_list|(
name|int
modifier|*
name|h
parameter_list|,
name|int
modifier|*
name|s
parameter_list|,
name|int
modifier|*
name|v
parameter_list|)
block|{
name|float
name|hue
decl_stmt|,
name|saturation
decl_stmt|,
name|value
decl_stmt|;
name|float
name|f
decl_stmt|,
name|p
decl_stmt|,
name|q
decl_stmt|,
name|t
decl_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|0
condition|)
block|{
operator|*
name|h
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|s
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|v
operator|=
operator|*
name|v
expr_stmt|;
block|}
else|else
block|{
name|hue
operator|=
operator|*
name|h
operator|*
literal|6.0
operator|/
literal|255.0
expr_stmt|;
name|saturation
operator|=
operator|*
name|s
operator|/
literal|255.0
expr_stmt|;
name|value
operator|=
operator|*
name|v
operator|/
literal|255.0
expr_stmt|;
name|f
operator|=
name|hue
operator|-
operator|(
name|int
operator|)
name|hue
expr_stmt|;
name|p
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|)
expr_stmt|;
name|q
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|saturation
operator|*
name|f
operator|)
operator|)
expr_stmt|;
name|t
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|saturation
operator|*
operator|(
literal|1.0
operator|-
name|f
operator|)
operator|)
operator|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|hue
condition|)
block|{
case|case
literal|0
case|:
operator|*
name|h
operator|=
name|value
operator|*
literal|255
expr_stmt|;
operator|*
name|s
operator|=
name|t
operator|*
literal|255
expr_stmt|;
operator|*
name|v
operator|=
name|p
operator|*
literal|255
expr_stmt|;
break|break;
case|case
literal|1
case|:
operator|*
name|h
operator|=
name|q
operator|*
literal|255
expr_stmt|;
operator|*
name|s
operator|=
name|value
operator|*
literal|255
expr_stmt|;
operator|*
name|v
operator|=
name|p
operator|*
literal|255
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|*
name|h
operator|=
name|p
operator|*
literal|255
expr_stmt|;
operator|*
name|s
operator|=
name|value
operator|*
literal|255
expr_stmt|;
operator|*
name|v
operator|=
name|t
operator|*
literal|255
expr_stmt|;
break|break;
case|case
literal|3
case|:
operator|*
name|h
operator|=
name|p
operator|*
literal|255
expr_stmt|;
operator|*
name|s
operator|=
name|q
operator|*
literal|255
expr_stmt|;
operator|*
name|v
operator|=
name|value
operator|*
literal|255
expr_stmt|;
break|break;
case|case
literal|4
case|:
operator|*
name|h
operator|=
name|t
operator|*
literal|255
expr_stmt|;
operator|*
name|s
operator|=
name|p
operator|*
literal|255
expr_stmt|;
operator|*
name|v
operator|=
name|value
operator|*
literal|255
expr_stmt|;
break|break;
case|case
literal|5
case|:
operator|*
name|h
operator|=
name|value
operator|*
literal|255
expr_stmt|;
operator|*
name|s
operator|=
name|p
operator|*
literal|255
expr_stmt|;
operator|*
name|v
operator|=
name|q
operator|*
literal|255
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**			Main Dialog					**/
end_comment

begin_comment
comment|/**			+++ dlg						**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/* 	This is gflare main dialog, one which opens in first.  */
end_comment

begin_function
name|int
DECL|function|dlg_run ()
name|dlg_run
parameter_list|()
block|{
name|GtkWidget
modifier|*
name|shell
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|inner_prv_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|outer_prv_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
name|guchar
modifier|*
name|color_cube
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|argv
decl_stmt|;
name|gint
name|argc
decl_stmt|;
comment|/*    *	Init Gdk& Gtk stuff    */
name|argc
operator|=
literal|1
expr_stmt|;
name|argv
operator|=
name|g_new
argument_list|(
name|gchar
operator|*
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|=
name|g_strdup
argument_list|(
literal|"gflare"
argument_list|)
expr_stmt|;
name|gtk_init
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|)
expr_stmt|;
name|gtk_rc_parse
argument_list|(
name|gimp_gtkrc
argument_list|()
argument_list|)
expr_stmt|;
name|gdk_set_use_xshm
argument_list|(
name|gimp_use_xshm
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_preview_set_gamma
argument_list|(
name|gimp_gamma
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_preview_set_install_cmap
argument_list|(
name|gimp_install_cmap
argument_list|()
argument_list|)
expr_stmt|;
name|color_cube
operator|=
name|gimp_color_cube
argument_list|()
expr_stmt|;
name|gtk_preview_set_color_cube
argument_list|(
name|color_cube
index|[
literal|0
index|]
argument_list|,
name|color_cube
index|[
literal|1
index|]
argument_list|,
name|color_cube
index|[
literal|2
index|]
argument_list|,
name|color_cube
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|gtk_widget_set_default_visual
argument_list|(
name|gtk_preview_get_visual
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_widget_set_default_colormap
argument_list|(
name|gtk_preview_get_cmap
argument_list|()
argument_list|)
expr_stmt|;
comment|/* gdk_set_show_events (TRUE);      gdk_set_debug_level (3); */
comment|/*    *	Init Main Dialog    */
if|#
directive|if
literal|0
comment|/* @@@ debug stuff */
block|printf("Waiting... (pid %d)\n", getpid());   kill(getpid(), 19);
comment|/* SIGSTOP */
endif|#
directive|endif
name|pint
operator|.
name|run
operator|=
name|FALSE
expr_stmt|;
name|dlg
operator|=
name|g_new
argument_list|(
name|GFlareDialog
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|init
operator|=
name|TRUE
expr_stmt|;
name|dlg
operator|->
name|update_preview
operator|=
name|TRUE
expr_stmt|;
name|gradient_menu_init
argument_list|()
expr_stmt|;
comment|/* FIXME: this should go elsewhere  */
name|dlg_setup_gflare
argument_list|()
expr_stmt|;
name|g_assert
argument_list|(
name|gflares_list
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|dlg
operator|->
name|gflare
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|dlg
operator|->
name|gflare
operator|->
name|name
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/*    *	Dialog Shell    */
name|shell
operator|=
name|dlg
operator|->
name|shell
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
literal|"GFlare"
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|shell
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_close_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    *	Action area    */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"OK"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_ok_callback
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/*    *	Preview    */
name|dlg
operator|->
name|preview
operator|=
name|preview_new
argument_list|(
name|DLG_PREVIEW_WIDTH
argument_list|,
name|DLG_PREVIEW_HEIGHT
argument_list|,
name|dlg_preview_init_func
argument_list|,
name|NULL
argument_list|,
name|dlg_preview_render_func
argument_list|,
name|NULL
argument_list|,
name|dlg_preview_deinit_func
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|GTK_WIDGET
argument_list|(
name|dlg
operator|->
name|preview
operator|->
name|widget
argument_list|)
argument_list|,
name|DLG_PREVIEW_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|preview
operator|->
name|widget
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_preview_handle_event
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|dlg_preview_calc_window
argument_list|()
expr_stmt|;
name|inner_prv_frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|inner_prv_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|inner_prv_frame
argument_list|)
argument_list|,
name|dlg
operator|->
name|preview
operator|->
name|widget
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|inner_prv_frame
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|inner_prv_frame
argument_list|)
expr_stmt|;
name|outer_prv_frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Preview"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|outer_prv_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|outer_prv_frame
argument_list|)
argument_list|,
name|inner_prv_frame
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|outer_prv_frame
argument_list|)
expr_stmt|;
comment|/*    *	Notebook    */
name|notebook
operator|=
name|dlg
operator|->
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_tab_pos
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|dlg_make_page_settings
argument_list|(
name|dlg
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|dlg_make_page_selector
argument_list|(
name|dlg
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
comment|/*    *	pack them    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|outer_prv_frame
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|notebook
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"shell is shown\n"
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
argument_list|)
expr_stmt|;
comment|/*    *	Make sure the selector page is realized    *	This idea is from app/layers_dialog.c    */
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"pages are shown\n"
operator|)
argument_list|)
expr_stmt|;
name|gtk_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Initialization done    */
name|dlg
operator|->
name|init
operator|=
name|FALSE
expr_stmt|;
name|dlg_preview_update
argument_list|()
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg init done\n"
operator|)
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
return|return
name|pint
operator|.
name|run
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_ok_callback (GtkWidget * widget,gpointer data)
name|dlg_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
comment|/* @GFLARE_NAME */
name|gflare_name_copy
argument_list|(
name|pvals
operator|.
name|gflare_name
argument_list|,
name|dlg
operator|->
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
name|pint
operator|.
name|run
operator|=
name|TRUE
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_close_callback (GtkWidget * widget,gpointer data)
name|dlg_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_setup_gflare ()
name|dlg_setup_gflare
parameter_list|()
block|{
name|dlg
operator|->
name|gflare
operator|=
name|gflares_list_lookup
argument_list|(
name|pvals
operator|.
name|gflare_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|dlg
operator|->
name|gflare
operator|==
name|NULL
condition|)
block|{
name|dlg
operator|->
name|gflare
operator|=
name|gflares_list_lookup
argument_list|(
literal|"Default"
argument_list|)
expr_stmt|;
if|if
condition|(
name|dlg
operator|->
name|gflare
operator|==
name|NULL
condition|)
block|{
name|g_warning
argument_list|(
literal|"`Default' is created."
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|gflare
operator|=
name|gflare_new_with_default
argument_list|(
literal|"Default"
argument_list|)
expr_stmt|;
name|gflares_list_insert
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_page_map_callback (GtkWidget * widget,gpointer data)
name|dlg_page_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
comment|/* dlg_preview_update (); */
block|}
end_function

begin_comment
comment|/***********************************/
end_comment

begin_comment
comment|/**	Main Dialog / Preview	  **/
end_comment

begin_comment
comment|/***********************************/
end_comment

begin_comment
comment|/*  *	Calculate preview's window, ie. translation of preview widget and  *	drawable.  *  *	x0, x1, y0, y1 are drawable coord, corresponding with top left  *	corner of preview widget, etc.  */
end_comment

begin_function
name|void
DECL|function|dlg_preview_calc_window ()
name|dlg_preview_calc_window
parameter_list|()
block|{
name|int
name|is_wide
decl_stmt|;
name|gdouble
name|offx
decl_stmt|,
name|offy
decl_stmt|;
name|is_wide
operator|=
operator|(
operator|(
name|double
operator|)
name|DLG_PREVIEW_HEIGHT
operator|*
name|drawable
operator|->
name|width
operator|>=
operator|(
name|double
operator|)
name|DLG_PREVIEW_WIDTH
operator|*
name|drawable
operator|->
name|height
operator|)
expr_stmt|;
if|if
condition|(
name|is_wide
condition|)
block|{
name|offy
operator|=
operator|(
operator|(
name|double
operator|)
name|drawable
operator|->
name|width
operator|*
name|DLG_PREVIEW_HEIGHT
operator|/
name|DLG_PREVIEW_WIDTH
operator|)
operator|/
literal|2.0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x0
operator|=
literal|0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x1
operator|=
name|drawable
operator|->
name|width
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y0
operator|=
name|drawable
operator|->
name|height
operator|/
literal|2.0
operator|-
name|offy
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y1
operator|=
name|drawable
operator|->
name|height
operator|/
literal|2.0
operator|+
name|offy
expr_stmt|;
block|}
else|else
block|{
name|offx
operator|=
operator|(
operator|(
name|double
operator|)
name|drawable
operator|->
name|height
operator|*
name|DLG_PREVIEW_WIDTH
operator|/
name|DLG_PREVIEW_HEIGHT
operator|)
operator|/
literal|2.0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x0
operator|=
name|drawable
operator|->
name|width
operator|/
literal|2.0
operator|-
name|offx
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x1
operator|=
name|drawable
operator|->
name|width
operator|/
literal|2.0
operator|+
name|offx
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y0
operator|=
literal|0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y1
operator|=
name|drawable
operator|->
name|height
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|ed_preview_calc_window ()
name|ed_preview_calc_window
parameter_list|()
block|{
name|int
name|is_wide
decl_stmt|;
name|gdouble
name|offx
decl_stmt|,
name|offy
decl_stmt|;
name|is_wide
operator|=
operator|(
operator|(
name|double
operator|)
name|DLG_PREVIEW_HEIGHT
operator|*
name|drawable
operator|->
name|width
operator|>=
operator|(
name|double
operator|)
name|DLG_PREVIEW_WIDTH
operator|*
name|drawable
operator|->
name|height
operator|)
expr_stmt|;
if|if
condition|(
name|is_wide
condition|)
block|{
name|offy
operator|=
operator|(
operator|(
name|double
operator|)
name|drawable
operator|->
name|width
operator|*
name|DLG_PREVIEW_HEIGHT
operator|/
name|DLG_PREVIEW_WIDTH
operator|)
operator|/
literal|2.0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x0
operator|=
literal|0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x1
operator|=
name|drawable
operator|->
name|width
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y0
operator|=
name|drawable
operator|->
name|height
operator|/
literal|2.0
operator|-
name|offy
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y1
operator|=
name|drawable
operator|->
name|height
operator|/
literal|2.0
operator|+
name|offy
expr_stmt|;
block|}
else|else
block|{
name|offx
operator|=
operator|(
operator|(
name|double
operator|)
name|drawable
operator|->
name|height
operator|*
name|DLG_PREVIEW_WIDTH
operator|/
name|DLG_PREVIEW_HEIGHT
operator|)
operator|/
literal|2.0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x0
operator|=
name|drawable
operator|->
name|width
operator|/
literal|2.0
operator|-
name|offx
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|x1
operator|=
name|drawable
operator|->
name|width
operator|/
literal|2.0
operator|+
name|offx
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y0
operator|=
literal|0
expr_stmt|;
name|dlg
operator|->
name|pwin
operator|.
name|y1
operator|=
name|drawable
operator|->
name|height
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gint
DECL|function|dlg_preview_handle_event (GtkWidget * widget,GdkEvent * event)
name|dlg_preview_handle_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|gint
name|bx
decl_stmt|,
name|by
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gchar
name|buf
index|[
literal|256
index|]
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
name|bx
operator|=
name|bevent
operator|->
name|x
expr_stmt|;
name|by
operator|=
name|bevent
operator|->
name|y
expr_stmt|;
comment|/* convert widget coord to drawable coord */
name|x
operator|=
name|dlg
operator|->
name|pwin
operator|.
name|x0
operator|+
call|(
name|double
call|)
argument_list|(
name|dlg
operator|->
name|pwin
operator|.
name|x1
operator|-
name|dlg
operator|->
name|pwin
operator|.
name|x0
argument_list|)
operator|*
name|bx
operator|/
name|DLG_PREVIEW_WIDTH
expr_stmt|;
name|y
operator|=
name|dlg
operator|->
name|pwin
operator|.
name|y0
operator|+
call|(
name|double
call|)
argument_list|(
name|dlg
operator|->
name|pwin
operator|.
name|y1
operator|-
name|dlg
operator|->
name|pwin
operator|.
name|y0
argument_list|)
operator|*
name|by
operator|/
name|DLG_PREVIEW_HEIGHT
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg_preview_handle_event: bxy [%d,%d] xy [%d,%d]\n"
operator|,
name|bx
operator|,
name|by
operator|,
name|x
operator|,
name|y
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|!=
name|pvals
operator|.
name|xcenter
operator|||
name|y
operator|!=
name|pvals
operator|.
name|ycenter
operator|)
condition|)
block|{
if|if
condition|(
name|x
operator|!=
name|pvals
operator|.
name|xcenter
condition|)
block|{
name|pvals
operator|.
name|xcenter
operator|=
name|x
expr_stmt|;
name|gtk_signal_handler_block
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|xentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|xentry_id
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|dlg
operator|->
name|xentry
argument_list|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|xentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|xentry_id
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|y
operator|!=
name|pvals
operator|.
name|ycenter
condition|)
block|{
name|pvals
operator|.
name|ycenter
operator|=
name|y
expr_stmt|;
name|gtk_signal_handler_block
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|yentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|yentry_id
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|dlg
operator|->
name|yentry
argument_list|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|yentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|yentry_id
argument_list|)
expr_stmt|;
block|}
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
return|return
name|TRUE
return|;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|gint
DECL|function|ed_preview_handle_event (GtkWidget * widget,GdkEvent * event)
name|ed_preview_handle_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|gint
name|bx
decl_stmt|,
name|by
decl_stmt|,
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gchar
name|buf
index|[
literal|256
index|]
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
name|bx
operator|=
name|bevent
operator|->
name|x
expr_stmt|;
name|by
operator|=
name|bevent
operator|->
name|y
expr_stmt|;
comment|/* convert widget coord to drawable coord */
name|x
operator|=
name|dlg
operator|->
name|pwin
operator|.
name|x0
operator|+
call|(
name|double
call|)
argument_list|(
name|dlg
operator|->
name|pwin
operator|.
name|x1
operator|-
name|dlg
operator|->
name|pwin
operator|.
name|x0
argument_list|)
operator|*
name|bx
operator|/
name|DLG_PREVIEW_WIDTH
expr_stmt|;
name|y
operator|=
name|dlg
operator|->
name|pwin
operator|.
name|y0
operator|+
call|(
name|double
call|)
argument_list|(
name|dlg
operator|->
name|pwin
operator|.
name|y1
operator|-
name|dlg
operator|->
name|pwin
operator|.
name|y0
argument_list|)
operator|*
name|by
operator|/
name|DLG_PREVIEW_HEIGHT
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg_preview_handle_event: bxy [%d,%d] xy [%d,%d]\n"
operator|,
name|bx
operator|,
name|by
operator|,
name|x
operator|,
name|y
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|!=
name|pvals
operator|.
name|xcenter
operator|||
name|y
operator|!=
name|pvals
operator|.
name|ycenter
operator|)
condition|)
block|{
if|if
condition|(
name|x
operator|!=
name|pvals
operator|.
name|xcenter
condition|)
block|{
name|pvals
operator|.
name|xcenter
operator|=
name|x
expr_stmt|;
name|gtk_signal_handler_block
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|xentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|xentry_id
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|dlg
operator|->
name|xentry
argument_list|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|xentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|xentry_id
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|y
operator|!=
name|pvals
operator|.
name|ycenter
condition|)
block|{
name|pvals
operator|.
name|ycenter
operator|=
name|y
expr_stmt|;
name|gtk_signal_handler_block
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|yentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|yentry_id
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|dlg
operator|->
name|yentry
argument_list|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
operator|->
name|yentry
argument_list|)
argument_list|,
name|dlg
operator|->
name|yentry_id
argument_list|)
expr_stmt|;
block|}
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
return|return
name|TRUE
return|;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_preview_update ()
name|dlg_preview_update
parameter_list|()
block|{
if|if
condition|(
name|dlg
operator|->
name|init
condition|)
return|return;
if|if
condition|(
name|dlg
operator|->
name|update_preview
condition|)
block|{
name|dlg
operator|->
name|init_params_done
operator|=
name|FALSE
expr_stmt|;
name|preview_render_start
argument_list|(
name|dlg
operator|->
name|preview
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*	preview callbacks	*/
end_comment

begin_function
specifier|static
name|gint
DECL|function|dlg_preview_init_func (Preview * preview,gpointer data)
name|dlg_preview_init_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
comment|/* call init_params first, and iterate init_progress while      it returns true */
if|if
condition|(
name|dlg
operator|->
name|init_params_done
operator|==
name|FALSE
condition|)
block|{
name|calc_init_params
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|,
name|CALC_GLOW
operator||
name|CALC_RAYS
operator||
name|CALC_SFLARE
argument_list|,
name|pvals
operator|.
name|xcenter
argument_list|,
name|pvals
operator|.
name|ycenter
argument_list|,
name|pvals
operator|.
name|radius
argument_list|,
name|pvals
operator|.
name|rotation
argument_list|,
name|pvals
operator|.
name|hue
argument_list|,
name|pvals
operator|.
name|vangle
argument_list|,
name|pvals
operator|.
name|vlength
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|init_params_done
operator|=
name|TRUE
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|calc_init_progress
argument_list|()
return|;
block|}
end_function

begin_comment
comment|/* render preview    do what "preview" means, ie. render lense flare effect onto drawable */
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_preview_render_func (Preview * preview,guchar * dest,gint y,gpointer data)
name|dlg_preview_render_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|guchar
modifier|*
name|dest
parameter_list|,
name|gint
name|y
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GPixelRgn
name|srcPR
decl_stmt|;
name|gint
name|x
decl_stmt|;
name|gint
name|dx
decl_stmt|,
name|dy
decl_stmt|;
comment|/* drawable x, y */
name|guchar
modifier|*
name|src_row
decl_stmt|,
modifier|*
name|src
decl_stmt|;
name|guchar
name|src_pix
index|[
literal|4
index|]
decl_stmt|,
name|dest_pix
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|b
decl_stmt|;
name|dy
operator|=
name|dlg
operator|->
name|pwin
operator|.
name|y0
operator|+
call|(
name|double
call|)
argument_list|(
name|dlg
operator|->
name|pwin
operator|.
name|y1
operator|-
name|dlg
operator|->
name|pwin
operator|.
name|y0
argument_list|)
operator|*
name|y
operator|/
name|DLG_PREVIEW_HEIGHT
expr_stmt|;
if|if
condition|(
name|dy
operator|<
literal|0
operator|||
name|dy
operator|>=
name|drawable
operator|->
name|height
condition|)
block|{
name|memset
argument_list|(
name|dest
argument_list|,
name|GRAY50
argument_list|,
literal|3
operator|*
name|DLG_PREVIEW_WIDTH
argument_list|)
expr_stmt|;
return|return;
block|}
name|src_row
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
name|drawable
operator|->
name|bpp
operator|*
name|drawable
operator|->
name|width
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|drawable
operator|->
name|width
argument_list|,
name|drawable
operator|->
name|height
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_get_row
argument_list|(
operator|&
name|srcPR
argument_list|,
name|src_row
argument_list|,
literal|0
argument_list|,
name|dy
argument_list|,
name|drawable
operator|->
name|width
argument_list|)
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|DLG_PREVIEW_HEIGHT
condition|;
name|x
operator|++
control|)
block|{
name|dx
operator|=
name|dlg
operator|->
name|pwin
operator|.
name|x0
operator|+
call|(
name|double
call|)
argument_list|(
name|dlg
operator|->
name|pwin
operator|.
name|x1
operator|-
name|dlg
operator|->
name|pwin
operator|.
name|x0
argument_list|)
operator|*
name|x
operator|/
name|DLG_PREVIEW_WIDTH
expr_stmt|;
if|if
condition|(
name|dx
operator|<
literal|0
operator|||
name|dx
operator|>=
name|drawable
operator|->
name|width
condition|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
operator|*
name|dest
operator|++
operator|=
name|GRAY50
expr_stmt|;
continue|continue;
block|}
comment|/* Get drawable pix value */
name|src
operator|=
operator|&
name|src_row
index|[
name|dx
operator|*
name|drawable
operator|->
name|bpp
index|]
expr_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|src_pix
index|[
name|b
index|]
operator|=
name|dinfo
operator|.
name|is_color
condition|?
name|src
index|[
name|b
index|]
else|:
name|src
index|[
literal|0
index|]
expr_stmt|;
name|src_pix
index|[
literal|3
index|]
operator|=
name|dinfo
operator|.
name|has_alpha
condition|?
name|src
index|[
name|drawable
operator|->
name|bpp
operator|-
literal|1
index|]
else|:
name|OPAQUE
expr_stmt|;
comment|/* Get GFlare pix value */
name|calc_gflare_pix
argument_list|(
name|dest_pix
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|,
name|src_pix
argument_list|)
expr_stmt|;
comment|/* Draw gray check if needed */
name|preview_rgba_to_rgb
argument_list|(
name|dest
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|dest_pix
argument_list|)
expr_stmt|;
name|dest
operator|+=
literal|3
expr_stmt|;
block|}
name|g_free
argument_list|(
name|src_row
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_preview_deinit_func (Preview * preview,gpointer data)
name|dlg_preview_deinit_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|dlg
operator|->
name|init_params_done
condition|)
block|{
name|calc_deinit
argument_list|()
expr_stmt|;
name|dlg
operator|->
name|init_params_done
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*****************************************/
end_comment

begin_comment
comment|/**	Main Dialog / Settings Page	**/
end_comment

begin_comment
comment|/*****************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_make_page_settings (GFlareDialog * dlg,GtkWidget * notebook)
name|dlg_make_page_settings
parameter_list|(
name|GFlareDialog
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|note_label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|asup_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|asup_table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkObject
modifier|*
name|scale_data
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|gchar
name|buffer
index|[
literal|256
index|]
decl_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|10
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Center X:"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|entry
operator|=
name|dlg
operator|->
name|xentry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d"
argument_list|,
name|pvals
operator|.
name|xcenter
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|xentry_id
operator|=
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
operator|&
name|dlg_position_entry_callback
argument_list|,
operator|&
name|pvals
operator|.
name|xcenter
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Center Y:"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|entry
operator|=
name|dlg
operator|->
name|yentry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d"
argument_list|,
name|pvals
operator|.
name|ycenter
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|yentry_id
operator|=
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
operator|&
name|dlg_position_entry_callback
argument_list|,
operator|&
name|pvals
operator|.
name|ycenter
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Radius:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|pvals
operator|.
name|radius
argument_list|,
literal|0.0
argument_list|,
name|drawable
operator|->
name|width
operator|/
literal|2
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|dlg_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SETTINGS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|"Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|pvals
operator|.
name|rotation
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|dlg_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SETTINGS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
literal|"Hue Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|pvals
operator|.
name|hue
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|dlg_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SETTINGS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|"Vector Angle:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|pvals
operator|.
name|vangle
argument_list|,
literal|0.0
argument_list|,
literal|359.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|dlg_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SETTINGS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|6
argument_list|,
literal|"Vector Length:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|pvals
operator|.
name|vlength
argument_list|,
literal|1
argument_list|,
literal|1000
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|dlg_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SETTINGS
argument_list|)
expr_stmt|;
comment|/**   ***	Asupsample settings   ***	This code is stolen from gimp-0.99.x/app/blend.c   **/
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Adaptive Supersampling"
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|pvals
operator|.
name|use_asupsample
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_use_asupsample_callback
argument_list|,
operator|&
name|pvals
operator|.
name|use_asupsample
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/*  asupsample frame */
name|asup_frame
operator|=
name|dlg
operator|->
name|asupsample_frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|asup_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|asup_frame
argument_list|,
name|pvals
operator|.
name|use_asupsample
argument_list|)
expr_stmt|;
name|asup_table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|asup_table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|asup_frame
argument_list|)
argument_list|,
name|asup_table
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Max depth:"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|asup_table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|pvals
operator|.
name|asupsample_max_depth
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_iscale_callback
argument_list|,
operator|&
name|pvals
operator|.
name|asupsample_max_depth
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|asup_table
argument_list|)
argument_list|,
name|scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Threshold:"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|asup_table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|pvals
operator|.
name|asupsample_threshold
argument_list|,
literal|0.0
argument_list|,
literal|4.0
argument_list|,
literal|0.01
argument_list|,
literal|0.01
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_dscale_callback
argument_list|,
operator|&
name|pvals
operator|.
name|asupsample_threshold
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|asup_table
argument_list|)
argument_list|,
name|scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|asup_table
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|asup_frame
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|8
argument_list|,
literal|9
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|asup_frame
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Auto update preview"
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|dlg
operator|->
name|update_preview
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_update_preview_callback
argument_list|,
operator|&
name|dlg
operator|->
name|update_preview
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|9
argument_list|,
literal|10
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/*    *	Create Page    */
name|note_label
operator|=
name|gtk_label_new
argument_list|(
literal|"Settings"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|note_label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|table
argument_list|,
name|note_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|table
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_page_map_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SETTINGS
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|note_label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_position_entry_callback (GtkWidget * widget,gpointer data)
name|dlg_position_entry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
modifier|*
name|var
init|=
name|data
decl_stmt|;
name|gint
name|new_val
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg_position_entry_callback\n"
operator|)
argument_list|)
expr_stmt|;
name|new_val
operator|=
name|atoi
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|var
operator|!=
name|new_val
condition|)
block|{
operator|*
name|var
operator|=
name|new_val
expr_stmt|;
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_entscale_callback (gdouble new_val,gpointer data)
name|dlg_entscale_callback
parameter_list|(
name|gdouble
name|new_val
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg_entscale_callback\n"
operator|)
argument_list|)
expr_stmt|;
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_use_asupsample_callback (GtkWidget * widget,gpointer data)
name|dlg_use_asupsample_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
modifier|*
name|toggle_val
init|=
operator|(
name|gint
operator|*
operator|)
name|data
decl_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
operator|*
name|toggle_val
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|toggle_val
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|!
name|dlg
operator|->
name|init
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|dlg
operator|->
name|asupsample_frame
argument_list|,
operator|*
name|toggle_val
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_iscale_callback (GtkAdjustment * adjustment,gpointer data)
name|dlg_iscale_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
operator|*
operator|(
name|gint
operator|*
operator|)
name|data
operator|=
operator|(
name|gint
operator|)
name|adjustment
operator|->
name|value
expr_stmt|;
comment|/* dlg_preview_update (); */
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_dscale_callback (GtkAdjustment * adjustment,gpointer data)
name|dlg_dscale_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
operator|*
operator|(
name|gdouble
operator|*
operator|)
name|data
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
comment|/* dlg_preview_update (); */
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_update_preview_callback (GtkWidget * widget,gpointer data)
name|dlg_update_preview_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
modifier|*
name|toggle_val
init|=
operator|(
name|gint
operator|*
operator|)
name|data
decl_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
operator|*
name|toggle_val
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|toggle_val
operator|=
name|FALSE
expr_stmt|;
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****************************************/
end_comment

begin_comment
comment|/**	Main Dialog / Selector Page	**/
end_comment

begin_comment
comment|/*****************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_make_page_selector (GFlareDialog * dlg,GtkWidget * notebook)
name|dlg_make_page_selector
parameter_list|(
name|GFlareDialog
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|listbox
decl_stmt|;
name|GtkWidget
modifier|*
name|list
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|note_label
decl_stmt|;
name|int
name|i
decl_stmt|;
DECL|struct|__anon28e4550f1408
specifier|static
struct|struct
block|{
DECL|member|label
name|char
modifier|*
name|label
decl_stmt|;
DECL|member|callback
name|GtkSignalFunc
name|callback
decl_stmt|;
block|}
name|buttons
index|[]
init|=
block|{
block|{
literal|"New"
block|,
operator|(
name|GtkSignalFunc
operator|)
operator|&
name|dlg_selector_new_callback
block|}
block|,
block|{
literal|"Edit"
block|,
operator|(
name|GtkSignalFunc
operator|)
operator|&
name|dlg_selector_edit_callback
block|}
block|,
block|{
literal|"Copy"
block|,
operator|(
name|GtkSignalFunc
operator|)
operator|&
name|dlg_selector_copy_callback
block|}
block|,
block|{
literal|"Delete"
block|,
operator|(
name|GtkSignalFunc
operator|)
operator|&
name|dlg_selector_delete_callback
block|}
block|}
struct|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg_make_page_selector\n"
operator|)
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	List Box    */
name|listbox
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|listbox
argument_list|,
name|DLG_LISTBOX_WIDTH
argument_list|,
name|DLG_LISTBOX_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|listbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|list
operator|=
name|dlg
operator|->
name|selector_list
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_scrolled_window_add_with_viewport
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|listbox
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|listbox
argument_list|)
expr_stmt|;
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|list
argument_list|)
argument_list|,
name|GTK_SELECTION_BROWSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|dlg_selector_setup_listbox
argument_list|()
expr_stmt|;
comment|/*    *	The buttons for the possible listbox operations    */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|buttons
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|buttons
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|buttons
index|[
name|i
index|]
operator|.
name|label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|buttons
index|[
name|i
index|]
operator|.
name|callback
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
block|}
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*    *	Create Page    */
name|note_label
operator|=
name|gtk_label_new
argument_list|(
literal|"Selector"
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|note_label
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|note_label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|note_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_page_map_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SELECTOR
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|note_label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	Set up selector's listbox, according to gflares_list  */
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_selector_setup_listbox ()
name|dlg_selector_setup_listbox
parameter_list|()
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|int
name|n
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg_selector_setup_listbox\n"
operator|)
argument_list|)
expr_stmt|;
name|list
operator|=
name|gflares_list
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|gflare
operator|=
name|list
operator|->
name|data
expr_stmt|;
comment|/* 	dlg->gflare should be valid (ie. not NULL) here. 	*/
if|if
condition|(
name|gflare
operator|==
name|dlg
operator|->
name|gflare
condition|)
name|dlg_selector_insert
argument_list|(
name|gflare
argument_list|,
name|n
argument_list|,
literal|1
argument_list|)
expr_stmt|;
else|else
name|dlg_selector_insert
argument_list|(
name|gflare
argument_list|,
name|n
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  *	Insert new list_item to selector's listbox  */
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_selector_insert (GFlare * gflare,int pos,int select)
name|dlg_selector_insert
parameter_list|(
name|GFlare
modifier|*
name|gflare
parameter_list|,
name|int
name|pos
parameter_list|,
name|int
name|select
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"dlg_selector_insert %s %d\n"
operator|,
name|gflare
operator|->
name|name
operator|,
name|pos
operator|)
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|gtk_list_item_new_with_label
argument_list|(
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
comment|/* gflare->list_item = list_item; */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"select"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_selector_list_item_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|gflare
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_list_append
argument_list|(
name|NULL
argument_list|,
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|dlg
operator|->
name|selector_list
argument_list|)
argument_list|,
name|list
argument_list|,
name|pos
argument_list|)
expr_stmt|;
if|if
condition|(
name|select
condition|)
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|dlg
operator|->
name|selector_list
argument_list|)
argument_list|,
name|pos
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_selector_list_item_callback (GtkWidget * widget,gpointer data)
name|dlg_selector_list_item_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|widget
operator|->
name|state
operator|!=
name|GTK_STATE_SELECTED
condition|)
return|return;
name|dlg
operator|->
name|gflare
operator|=
name|data
expr_stmt|;
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	"New" button in Selector page  */
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_selector_new_callback (GtkWidget * widget,gpointer data)
name|dlg_selector_new_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|query_string_box
argument_list|(
literal|"New GFlare"
argument_list|,
literal|"Enter a name for the new GFlare"
argument_list|,
literal|"untitled"
argument_list|,
name|dlg_selector_new_ok_callback
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_selector_new_ok_callback (GtkWidget * widget,gpointer client_data,gpointer call_data)
name|dlg_selector_new_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
block|{
name|char
modifier|*
name|new_name
init|=
name|call_data
decl_stmt|;
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|gint
name|pos
decl_stmt|;
name|g_assert
argument_list|(
name|new_name
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gflares_list_lookup
argument_list|(
name|new_name
argument_list|)
condition|)
block|{
comment|/* message_box (); */
name|g_warning
argument_list|(
literal|"The name `%s' is used already!"
argument_list|,
name|new_name
argument_list|)
expr_stmt|;
return|return;
block|}
name|gflare
operator|=
name|gflare_new_with_default
argument_list|(
name|new_name
argument_list|)
expr_stmt|;
name|pos
operator|=
name|gflares_list_insert
argument_list|(
name|gflare
argument_list|)
expr_stmt|;
name|dlg_selector_insert
argument_list|(
name|gflare
argument_list|,
name|pos
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|gflare
operator|=
name|gflare
expr_stmt|;
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	"Edit" button in Selector page  */
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_selector_edit_callback (GtkWidget * widget,gpointer data)
name|dlg_selector_edit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|preview_render_end
argument_list|(
name|dlg
operator|->
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|dlg
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|ed_run
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|,
name|dlg_selector_edit_done_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_selector_edit_done_callback (gint updated,gpointer data)
name|dlg_selector_edit_done_callback
parameter_list|(
name|gint
name|updated
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|dlg
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|updated
condition|)
block|{
name|gflare_save
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|)
expr_stmt|;
block|}
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	"Copy" button in Selector page  */
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_selector_copy_callback (GtkWidget * widget,gpointer data)
name|dlg_selector_copy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|name
operator|=
name|g_new
argument_list|(
name|gchar
argument_list|,
name|strlen
argument_list|(
name|dlg
operator|->
name|gflare
operator|->
name|name
argument_list|)
operator|+
literal|6
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|name
argument_list|,
literal|"%s copy"
argument_list|,
name|dlg
operator|->
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
name|query_string_box
argument_list|(
literal|"Copy GFlare"
argument_list|,
literal|"Enter a name for the copied GFlare"
argument_list|,
name|name
argument_list|,
name|dlg_selector_copy_ok_callback
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_selector_copy_ok_callback (GtkWidget * widget,gpointer client_data,gpointer call_data)
name|dlg_selector_copy_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
block|{
name|char
modifier|*
name|copy_name
init|=
name|call_data
decl_stmt|;
name|GFlare
modifier|*
name|gflare
decl_stmt|;
name|gint
name|pos
decl_stmt|;
name|g_assert
argument_list|(
name|copy_name
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gflares_list_lookup
argument_list|(
name|copy_name
argument_list|)
condition|)
block|{
comment|/* message_box (); */
name|g_warning
argument_list|(
literal|"The name `%s' is used already!"
argument_list|,
name|copy_name
argument_list|)
expr_stmt|;
return|return;
block|}
name|gflare
operator|=
name|gflare_dup
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|,
name|copy_name
argument_list|)
expr_stmt|;
name|pos
operator|=
name|gflares_list_insert
argument_list|(
name|gflare
argument_list|)
expr_stmt|;
name|dlg_selector_insert
argument_list|(
name|gflare
argument_list|,
name|pos
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|gflare
operator|=
name|gflare
expr_stmt|;
name|gflare_save
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|)
expr_stmt|;
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *	"Delete" button in Selector page  */
end_comment

begin_function
specifier|static
name|void
DECL|function|dlg_selector_delete_callback (GtkWidget * widget,gpointer data)
name|dlg_selector_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
if|if
condition|(
name|num_gflares
operator|<=
literal|1
condition|)
block|{
comment|/* message_box () */
name|g_warning
argument_list|(
literal|"Cannot delete!! There must be at least one GFlare."
argument_list|)
expr_stmt|;
return|return;
block|}
name|dialog
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"Delete GFlare"
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Question */
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Are you sure you want to delete"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
operator|(
name|strlen
argument_list|(
name|dlg
operator|->
name|gflare
operator|->
name|name
argument_list|)
operator|+
literal|32
operator|*
sizeof|sizeof
argument_list|(
name|char
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"\"%s\" from the list and from disk?"
argument_list|,
name|dlg
operator|->
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
comment|/* Buttons */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Delete"
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_selector_delete_ok_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Cancel"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|dlg_selector_delete_cancel_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Show! */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|dlg
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_selector_delete_ok_callback (GtkWidget * widget,gpointer client_data)
name|dlg_selector_delete_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GFlare
modifier|*
name|old_gflare
decl_stmt|;
name|GList
modifier|*
name|tmp
decl_stmt|;
name|int
name|i
decl_stmt|,
name|new_i
decl_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|dlg
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|i
operator|=
name|gflares_list_index
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|>=
literal|0
condition|)
block|{
comment|/* Remove current gflare from gflares_list and free it */
name|old_gflare
operator|=
name|dlg
operator|->
name|gflare
expr_stmt|;
name|gflares_list_remove
argument_list|(
name|dlg
operator|->
name|gflare
argument_list|)
expr_stmt|;
name|dlg
operator|->
name|gflare
operator|=
name|NULL
expr_stmt|;
comment|/* Remove from listbox */
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|dlg
operator|->
name|selector_list
argument_list|)
argument_list|,
name|i
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|/* Calculate new position of gflare and select it */
name|new_i
operator|=
operator|(
name|i
operator|<
name|num_gflares
operator|)
condition|?
name|i
else|:
name|num_gflares
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|tmp
operator|=
name|g_list_nth
argument_list|(
name|gflares_list
argument_list|,
name|new_i
argument_list|)
operator|)
condition|)
name|dlg
operator|->
name|gflare
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|dlg
operator|->
name|selector_list
argument_list|)
argument_list|,
name|new_i
argument_list|)
expr_stmt|;
comment|/* Delete old one from disk and memory */
if|if
condition|(
name|old_gflare
operator|->
name|filename
condition|)
name|unlink
argument_list|(
name|old_gflare
operator|->
name|filename
argument_list|)
expr_stmt|;
name|gflare_free
argument_list|(
name|old_gflare
argument_list|)
expr_stmt|;
comment|/* Update */
name|dlg_preview_update
argument_list|()
expr_stmt|;
block|}
else|else
name|g_warning
argument_list|(
literal|"not found %s in gflares_list"
argument_list|,
name|dlg
operator|->
name|gflare
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dlg_selector_delete_cancel_callback (GtkWidget * widget,gpointer client_data)
name|dlg_selector_delete_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|dlg
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**			GFlare Editor					**/
end_comment

begin_comment
comment|/**			+++ ed						**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/* 	This is gflare editor dilaog, one which opens by clicking 	"Edit" button on the selector page in the main dialog.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_run (GFlare * target_gflare,GFlareEditorCallback callback,gpointer calldata)
name|ed_run
parameter_list|(
name|GFlare
modifier|*
name|target_gflare
parameter_list|,
name|GFlareEditorCallback
name|callback
parameter_list|,
name|gpointer
name|calldata
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|shell
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|inner_prv_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|outer_prv_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
if|if
condition|(
operator|!
name|ed
condition|)
name|ed
operator|=
name|g_new0
argument_list|(
name|GFlareEditor
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ed
operator|->
name|init
operator|=
name|TRUE
expr_stmt|;
name|ed
operator|->
name|run
operator|=
name|FALSE
expr_stmt|;
name|ed
operator|->
name|target_gflare
operator|=
name|target_gflare
expr_stmt|;
name|ed
operator|->
name|gflare
operator|=
name|gflare_dup
argument_list|(
name|target_gflare
argument_list|,
name|target_gflare
operator|->
name|name
argument_list|)
expr_stmt|;
name|ed
operator|->
name|callback
operator|=
name|callback
expr_stmt|;
name|ed
operator|->
name|calldata
operator|=
name|calldata
expr_stmt|;
comment|/*    *	Dialog Shell    */
name|shell
operator|=
name|ed
operator|->
name|shell
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
literal|"GFlare Editor"
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|shell
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_close_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    *	Action area    */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"OK"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_ok_callback
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Cancel"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gtk_widget_destroy
argument_list|,
name|GTK_OBJECT
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Rescan Gradients"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_rescan_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/*    *	Preview    */
name|ed
operator|->
name|preview
operator|=
name|preview_new
argument_list|(
name|ED_PREVIEW_WIDTH
argument_list|,
name|ED_PREVIEW_HEIGHT
argument_list|,
name|ed_preview_init_func
argument_list|,
name|NULL
argument_list|,
name|ed_preview_render_func
argument_list|,
name|NULL
argument_list|,
name|ed_preview_deinit_func
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|GTK_WIDGET
argument_list|(
name|ed
operator|->
name|preview
operator|->
name|widget
argument_list|)
argument_list|,
name|DLG_PREVIEW_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|ed
operator|->
name|preview
operator|->
name|widget
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_preview_handle_event
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|ed_preview_calc_window
argument_list|()
expr_stmt|;
name|inner_prv_frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|inner_prv_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|inner_prv_frame
argument_list|)
argument_list|,
name|ed
operator|->
name|preview
operator|->
name|widget
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|inner_prv_frame
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|inner_prv_frame
argument_list|)
expr_stmt|;
name|outer_prv_frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Preview"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|outer_prv_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|outer_prv_frame
argument_list|)
argument_list|,
name|inner_prv_frame
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|outer_prv_frame
argument_list|)
expr_stmt|;
comment|/*    *	Notebook    */
name|notebook
operator|=
name|ed
operator|->
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_tab_pos
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|ed_make_page_general
argument_list|(
name|ed
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|ed_make_page_glow
argument_list|(
name|ed
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|ed_make_page_rays
argument_list|(
name|ed
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|ed_make_page_sflare
argument_list|(
name|ed
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
comment|/*    *	pack them    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|outer_prv_frame
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|notebook
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|shell
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
argument_list|)
expr_stmt|;
name|ed
operator|->
name|init
operator|=
name|FALSE
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_close_callback (GtkWidget * widget,gpointer data)
name|ed_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|preview_free
argument_list|(
name|ed
operator|->
name|preview
argument_list|)
expr_stmt|;
name|gflare_free
argument_list|(
name|ed
operator|->
name|gflare
argument_list|)
expr_stmt|;
if|if
condition|(
name|ed
operator|->
name|callback
condition|)
call|(
modifier|*
name|ed
operator|->
name|callback
call|)
argument_list|(
name|ed
operator|->
name|run
argument_list|,
name|ed
operator|->
name|calldata
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_ok_callback (GtkWidget * widget,gpointer data)
name|ed_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ed
operator|->
name|run
operator|=
name|TRUE
expr_stmt|;
name|gflare_copy
argument_list|(
name|ed
operator|->
name|target_gflare
argument_list|,
name|ed
operator|->
name|gflare
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|ed
operator|->
name|shell
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_rescan_callback (GtkWidget * widget,gpointer data)
name|ed_rescan_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ed
operator|->
name|init
operator|=
name|TRUE
expr_stmt|;
name|gradient_menu_rescan
argument_list|()
expr_stmt|;
name|ed
operator|->
name|init
operator|=
name|FALSE
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|ed
operator|->
name|notebook
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_make_page_general (GFlareEditor * ed,GtkWidget * notebook)
name|ed_make_page_general
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GFlare
modifier|*
name|gflare
init|=
name|ed
operator|->
name|gflare
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|note_label
decl_stmt|;
name|GtkWidget
modifier|*
name|option_menu
decl_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Scales    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Glow Opacity (%):"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|glow_opacity
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
name|TRUE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GENERAL
argument_list|)
expr_stmt|;
name|option_menu
operator|=
name|ed_mode_menu_new
argument_list|(
operator|&
name|gflare
operator|->
name|glow_mode
argument_list|)
expr_stmt|;
name|ed_put_mode_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|"Glow Mode:"
argument_list|,
name|option_menu
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Rays Opacity (%):"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|rays_opacity
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
name|TRUE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GENERAL
argument_list|)
expr_stmt|;
name|option_menu
operator|=
name|ed_mode_menu_new
argument_list|(
operator|&
name|gflare
operator|->
name|rays_mode
argument_list|)
expr_stmt|;
name|ed_put_mode_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|"Rays Mode:"
argument_list|,
name|option_menu
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
literal|"Second Flares Opacity (%):"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|sflare_opacity
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
name|TRUE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GENERAL
argument_list|)
expr_stmt|;
name|option_menu
operator|=
name|ed_mode_menu_new
argument_list|(
operator|&
name|gflare
operator|->
name|sflare_mode
argument_list|)
expr_stmt|;
name|ed_put_mode_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|"Second Flares Mode:"
argument_list|,
name|option_menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Create Page    */
name|note_label
operator|=
name|gtk_label_new
argument_list|(
literal|"General"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|note_label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|note_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_page_map_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GENERAL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|note_label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_make_page_glow (GFlareEditor * ed,GtkWidget * notebook)
name|ed_make_page_glow
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GFlare
modifier|*
name|gflare
init|=
name|ed
operator|->
name|gflare
decl_stmt|;
name|GradientMenu
modifier|*
name|gm
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|note_label
decl_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Gradient Menus    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|glow_radial
argument_list|,
name|gflare
operator|->
name|glow_radial
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Radial Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|glow_angular
argument_list|,
name|gflare
operator|->
name|glow_angular
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|"Angular Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|glow_angular_size
argument_list|,
name|gflare
operator|->
name|glow_angular_size
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Angular Size Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    *	Scales    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Size (%):"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|glow_size
argument_list|,
literal|0.0
argument_list|,
literal|200.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GLOW
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|"Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|glow_rotation
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GLOW
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Hue Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|glow_hue
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GLOW
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    *	Create Page    */
name|note_label
operator|=
name|gtk_label_new
argument_list|(
literal|"Glow"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|note_label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|note_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_page_map_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_GLOW
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|note_label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_make_page_rays (GFlareEditor * ed,GtkWidget * notebook)
name|ed_make_page_rays
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GFlare
modifier|*
name|gflare
init|=
name|ed
operator|->
name|gflare
decl_stmt|;
name|GradientMenu
modifier|*
name|gm
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|note_label
decl_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Gradient Menus    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|rays_radial
argument_list|,
name|gflare
operator|->
name|rays_radial
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Radial Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|rays_angular
argument_list|,
name|gflare
operator|->
name|rays_angular
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|"Angular Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|rays_angular_size
argument_list|,
name|gflare
operator|->
name|rays_angular_size
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Angular Size Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    *	Scales    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|5
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Size (%):"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|rays_size
argument_list|,
literal|0.0
argument_list|,
literal|200.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_RAYS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|"Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|rays_rotation
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_RAYS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Hue Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|rays_hue
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_RAYS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|"# of Spikes:"
argument_list|,
name|ENTSCALE_INT
argument_list|,
operator|&
name|gflare
operator|->
name|rays_nspikes
argument_list|,
literal|1
argument_list|,
literal|300
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_RAYS
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
literal|"Spike Thickness:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|rays_thickness
argument_list|,
literal|1.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_RAYS
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    *	Create Pages    */
name|note_label
operator|=
name|gtk_label_new
argument_list|(
literal|"Rays"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|note_label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|note_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_page_map_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_RAYS
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|note_label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_make_page_sflare (GFlareEditor * ed,GtkWidget * notebook)
name|ed_make_page_sflare
parameter_list|(
name|GFlareEditor
modifier|*
name|ed
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GFlare
modifier|*
name|gflare
init|=
name|ed
operator|->
name|gflare
decl_stmt|;
name|GradientMenu
modifier|*
name|gm
decl_stmt|;
name|GtkWidget
modifier|*
name|note_label
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|shape_frame
decl_stmt|;
name|GtkWidget
modifier|*
name|shape_vbox
decl_stmt|;
name|GSList
modifier|*
name|shape_group
init|=
name|NULL
decl_stmt|;
name|GtkWidget
modifier|*
name|polygon_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|seed_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|char
name|buf
index|[
literal|256
index|]
decl_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Gradient Menus    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|sflare_radial
argument_list|,
name|gflare
operator|->
name|sflare_radial
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Radial Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|sflare_sizefac
argument_list|,
name|gflare
operator|->
name|sflare_sizefac
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|"Size Factor Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gm
operator|=
name|gradient_menu_new
argument_list|(
operator|(
name|GradientMenuCallback
operator|)
operator|&
name|ed_gradient_menu_callback
argument_list|,
name|gflare
operator|->
name|sflare_probability
argument_list|,
name|gflare
operator|->
name|sflare_probability
argument_list|)
expr_stmt|;
name|ed_put_gradient_menu
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Probability Gradient:"
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    *	Scales    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|"Size (%):"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|sflare_size
argument_list|,
literal|0.0
argument_list|,
literal|200.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SFLARE
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|"Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|sflare_rotation
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SFLARE
argument_list|)
expr_stmt|;
name|entscale_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|"Hue Rotation:"
argument_list|,
name|ENTSCALE_DOUBLE
argument_list|,
operator|&
name|gflare
operator|->
name|sflare_hue
argument_list|,
operator|-
literal|180.0
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
name|FALSE
argument_list|,
operator|&
name|ed_entscale_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SFLARE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    *	Shape Radio Button Frame    */
name|shape_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|shape_group
argument_list|,
literal|"Circle"
argument_list|)
expr_stmt|;
name|shape_group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_shape_radio_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|GF_CIRCLE
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|gflare
operator|->
name|sflare_shape
operator|==
name|GF_CIRCLE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|shape_vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|ed
operator|->
name|polygon_toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|shape_group
argument_list|,
literal|"Polygon"
argument_list|)
expr_stmt|;
name|shape_group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_shape_radio_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|GF_POLYGON
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|gflare
operator|->
name|sflare_shape
operator|==
name|GF_POLYGON
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|entry
operator|=
name|ed
operator|->
name|polygon_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|gflare
operator|->
name|sflare_nverts
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_ientry_callback
argument_list|,
operator|&
name|gflare
operator|->
name|sflare_nverts
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|polygon_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|polygon_hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|polygon_hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|polygon_hbox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|shape_vbox
argument_list|)
argument_list|,
name|polygon_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shape_vbox
argument_list|)
expr_stmt|;
name|shape_frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Shape of Second Flares"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|shape_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|shape_frame
argument_list|)
argument_list|,
name|shape_vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shape_frame
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|shape_frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Random Seed Entry    */
name|seed_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Random Seed (-1 means current time):"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|seed_hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%d"
argument_list|,
name|gflare
operator|->
name|sflare_seed
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_ientry_callback
argument_list|,
operator|&
name|gflare
operator|->
name|sflare_seed
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|seed_hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|seed_hbox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|seed_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*    *	Create Pages    */
name|note_label
operator|=
name|gtk_label_new
argument_list|(
literal|"Second Flares"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|note_label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|note_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_page_map_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|PAGE_SFLARE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|note_label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|ed_mode_menu_new (GFlareMode * mode_var)
name|ed_mode_menu_new
parameter_list|(
name|GFlareMode
modifier|*
name|mode_var
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|option_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|;
name|gchar
name|buf
index|[
literal|256
index|]
decl_stmt|;
name|GFlareMode
name|mode
decl_stmt|;
name|option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GF_NUM_MODES
condition|;
name|i
operator|++
control|)
block|{
comment|/* Capitalize */
name|strcpy
argument_list|(
name|buf
argument_list|,
name|gflare_modes
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|islower
argument_list|(
name|buf
index|[
literal|0
index|]
argument_list|)
condition|)
comment|/* for BSD? */
name|buf
index|[
literal|0
index|]
operator|=
name|toupper
argument_list|(
name|buf
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|1
init|;
name|buf
index|[
name|j
index|]
condition|;
name|j
operator|++
control|)
if|if
condition|(
name|isupper
argument_list|(
name|buf
index|[
name|j
index|]
argument_list|)
condition|)
name|buf
index|[
name|j
index|]
operator|=
name|tolower
argument_list|(
name|buf
index|[
name|j
index|]
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|i
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_mode_menu_callback
argument_list|,
name|mode_var
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
block|}
name|mode
operator|=
operator|*
name|mode_var
expr_stmt|;
if|if
condition|(
name|mode
operator|<
literal|0
operator|||
name|mode
operator|>=
name|GF_NUM_MODES
condition|)
name|mode
operator|=
name|GF_NORMAL
expr_stmt|;
name|gtk_menu_set_active
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|mode
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|option_menu
argument_list|)
argument_list|,
name|menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|option_menu
argument_list|)
expr_stmt|;
return|return
name|option_menu
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_put_mode_menu (GtkWidget * table,gint x,gint y,gchar * caption,GtkWidget * option_menu)
name|ed_put_mode_menu
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|GtkWidget
modifier|*
name|option_menu
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|caption
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
name|x
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|option_menu
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|x
operator|+
literal|2
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*   puts gradient menu with caption into table   occupies 1 row and 3 cols in table  */
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_put_gradient_menu (GtkWidget * table,gint x,gint y,gchar * caption,GradientMenu * gm)
name|ed_put_gradient_menu
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|GradientMenu
modifier|*
name|gm
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|caption
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
argument_list|,
name|ed
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
name|x
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|gm
operator|->
name|preview
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|x
operator|+
literal|2
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|gm
operator|->
name|option_menu
argument_list|,
name|x
operator|+
literal|2
argument_list|,
name|x
operator|+
literal|3
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_entscale_callback (gdouble new_val,gpointer data)
name|ed_entscale_callback
parameter_list|(
name|gdouble
name|new_val
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"ed_entscale_callback\n"
operator|)
argument_list|)
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_mode_menu_callback (GtkWidget * widget,gpointer data)
name|ed_mode_menu_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GFlareMode
modifier|*
name|mode_var
decl_stmt|;
name|mode_var
operator|=
name|data
expr_stmt|;
operator|*
name|mode_var
operator|=
operator|(
name|GFlareMode
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_gradient_menu_callback (gchar * gradient_name,gpointer data)
name|ed_gradient_menu_callback
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gchar
modifier|*
name|dest_string
init|=
name|data
decl_stmt|;
comment|/* @GRADIENT_NAME */
name|gradient_name_copy
argument_list|(
name|dest_string
argument_list|,
name|gradient_name
argument_list|)
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_shape_radio_callback (GtkWidget * widget,gpointer data)
name|ed_shape_radio_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|state
decl_stmt|;
name|state
operator|=
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
expr_stmt|;
if|if
condition|(
name|state
condition|)
block|{
name|ed
operator|->
name|gflare
operator|->
name|sflare_shape
operator|=
operator|(
name|GFlareShape
operator|)
name|data
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|ed
operator|->
name|init
operator|&&
name|widget
operator|==
name|ed
operator|->
name|polygon_toggle
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|ed
operator|->
name|polygon_entry
argument_list|,
name|state
argument_list|)
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_ientry_callback (GtkWidget * widget,gpointer data)
name|ed_ientry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|new_val
decl_stmt|;
name|new_val
operator|=
name|atoi
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|gint
operator|*
operator|)
name|data
operator|=
name|new_val
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*   NOTE: This is hack, because this code depends on internal "map"   signal of changing pages of gtknotebook.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_page_map_callback (GtkWidget * widget,gpointer data)
name|ed_page_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|page_num
init|=
operator|(
name|gint
operator|)
name|data
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"ed_page_map_callback\n"
operator|)
argument_list|)
expr_stmt|;
name|ed
operator|->
name|cur_page
operator|=
name|page_num
expr_stmt|;
name|ed_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_preview_update ()
name|ed_preview_update
parameter_list|()
block|{
if|if
condition|(
name|ed
operator|->
name|init
condition|)
return|return;
name|ed
operator|->
name|init_params_done
operator|=
name|FALSE
expr_stmt|;
name|preview_render_start
argument_list|(
name|ed
operator|->
name|preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|ed_preview_init_func (Preview * preview,gpointer data)
name|ed_preview_init_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|int
name|type
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|ed
operator|->
name|init_params_done
operator|==
name|FALSE
condition|)
block|{
switch|switch
condition|(
name|ed
operator|->
name|cur_page
condition|)
block|{
case|case
name|PAGE_GENERAL
case|:
name|type
operator|=
operator|(
name|CALC_GLOW
operator||
name|CALC_RAYS
operator||
name|CALC_SFLARE
operator|)
expr_stmt|;
break|break;
case|case
name|PAGE_GLOW
case|:
name|type
operator|=
name|CALC_GLOW
expr_stmt|;
break|break;
case|case
name|PAGE_RAYS
case|:
name|type
operator|=
name|CALC_RAYS
expr_stmt|;
break|break;
case|case
name|PAGE_SFLARE
case|:
name|type
operator|=
name|CALC_SFLARE
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"ed_preview_edit_func: bad page"
argument_list|)
expr_stmt|;
break|break;
block|}
name|calc_init_params
argument_list|(
name|ed
operator|->
name|gflare
argument_list|,
name|type
argument_list|,
name|ED_PREVIEW_WIDTH
operator|/
literal|2
argument_list|,
name|ED_PREVIEW_HEIGHT
operator|/
literal|2
argument_list|,
name|ED_PREVIEW_WIDTH
operator|/
literal|2
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
name|pvals
operator|.
name|vangle
argument_list|,
name|pvals
operator|.
name|vlength
argument_list|)
expr_stmt|;
name|ed
operator|->
name|init_params_done
operator|=
name|TRUE
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|calc_init_progress
argument_list|()
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_preview_deinit_func (Preview * preview,gpointer data)
name|ed_preview_deinit_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|ed
operator|->
name|init_params_done
condition|)
block|{
name|calc_deinit
argument_list|()
expr_stmt|;
name|ed
operator|->
name|init_params_done
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_preview_render_func (Preview * preview,guchar * buffer,gint y,gpointer data)
name|ed_preview_render_func
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|,
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|ed
operator|->
name|cur_page
condition|)
block|{
case|case
name|PAGE_GENERAL
case|:
name|ed_preview_render_general
argument_list|(
name|buffer
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
name|PAGE_GLOW
case|:
name|ed_preview_render_glow
argument_list|(
name|buffer
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
name|PAGE_RAYS
case|:
name|ed_preview_render_rays
argument_list|(
name|buffer
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
name|PAGE_SFLARE
case|:
name|ed_preview_render_sflare
argument_list|(
name|buffer
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"hmm, bad page in ed_preview_render_func ()"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_preview_render_general (guchar * buffer,gint y)
name|ed_preview_render_general
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|i
decl_stmt|;
name|guchar
name|gflare_pix
index|[
literal|4
index|]
decl_stmt|;
specifier|static
name|guchar
name|src_pix
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|OPAQUE
block|}
decl_stmt|;
name|int
name|gflare_a
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|ED_PREVIEW_WIDTH
condition|;
name|x
operator|++
control|)
block|{
name|calc_gflare_pix
argument_list|(
name|gflare_pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|src_pix
argument_list|)
expr_stmt|;
name|gflare_a
operator|=
name|gflare_pix
index|[
literal|3
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|buffer
operator|++
operator|=
name|gflare_pix
index|[
name|i
index|]
operator|*
name|gflare_a
operator|/
literal|255
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_preview_render_glow (guchar * buffer,gint y)
name|ed_preview_render_glow
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|i
decl_stmt|;
name|guchar
name|pix
index|[
literal|4
index|]
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|ED_PREVIEW_WIDTH
condition|;
name|x
operator|++
control|)
block|{
name|calc_glow_pix
argument_list|(
name|pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
operator|*
name|buffer
operator|++
operator|=
name|pix
index|[
name|i
index|]
operator|*
name|pix
index|[
literal|3
index|]
operator|/
literal|255
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_preview_render_rays (guchar * buffer,gint y)
name|ed_preview_render_rays
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|i
decl_stmt|;
name|guchar
name|pix
index|[
literal|4
index|]
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|ED_PREVIEW_WIDTH
condition|;
name|x
operator|++
control|)
block|{
name|calc_rays_pix
argument_list|(
name|pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
operator|*
name|buffer
operator|++
operator|=
name|pix
index|[
name|i
index|]
operator|*
name|pix
index|[
literal|3
index|]
operator|/
literal|255
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_preview_render_sflare (guchar * buffer,gint y)
name|ed_preview_render_sflare
parameter_list|(
name|guchar
modifier|*
name|buffer
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|i
decl_stmt|;
name|guchar
name|pix
index|[
literal|4
index|]
decl_stmt|;
specifier|static
name|guchar
name|src_pix
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|OPAQUE
block|}
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|ED_PREVIEW_WIDTH
condition|;
name|x
operator|++
control|)
block|{
name|calc_sflare_pix
argument_list|(
name|pix
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|src_pix
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
operator|*
name|buffer
operator|++
operator|=
name|pix
index|[
name|i
index|]
operator|*
name|pix
index|[
literal|3
index|]
operator|/
literal|255
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**			+++ Preview					**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/* 	this is generic preview routines.  */
end_comment

begin_comment
comment|/*     Routines to render the preview in background  */
end_comment

begin_function
name|Preview
modifier|*
DECL|function|preview_new (gint width,gint height,PreviewInitFunc init_func,gpointer init_data,PreviewRenderFunc render_func,gpointer render_data,PreviewDeinitFunc deinit_func,gpointer deinit_data)
name|preview_new
parameter_list|(
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|PreviewInitFunc
name|init_func
parameter_list|,
name|gpointer
name|init_data
parameter_list|,
name|PreviewRenderFunc
name|render_func
parameter_list|,
name|gpointer
name|render_data
parameter_list|,
name|PreviewDeinitFunc
name|deinit_func
parameter_list|,
name|gpointer
name|deinit_data
parameter_list|)
block|{
name|Preview
modifier|*
name|preview
decl_stmt|;
name|preview
operator|=
name|g_new0
argument_list|(
name|Preview
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|preview
operator|->
name|widget
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|preview
operator|->
name|widget
argument_list|)
argument_list|,
name|preview
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
operator|->
name|widget
argument_list|)
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|preview
operator|->
name|widget
argument_list|)
expr_stmt|;
name|preview
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|preview
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|preview
operator|->
name|init_func
operator|=
name|init_func
expr_stmt|;
name|preview
operator|->
name|init_data
operator|=
name|init_data
expr_stmt|;
name|preview
operator|->
name|render_func
operator|=
name|render_func
expr_stmt|;
name|preview
operator|->
name|render_data
operator|=
name|render_data
expr_stmt|;
name|preview
operator|->
name|deinit_func
operator|=
name|deinit_func
expr_stmt|;
name|preview
operator|->
name|deinit_data
operator|=
name|deinit_data
expr_stmt|;
name|preview
operator|->
name|idle_tag
operator|=
literal|0
expr_stmt|;
name|preview
operator|->
name|buffer
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
return|return
name|preview
return|;
block|}
end_function

begin_function
name|void
DECL|function|preview_free (Preview * preview)
name|preview_free
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
block|{
name|preview_render_end
argument_list|(
name|preview
argument_list|)
expr_stmt|;
comment|/* not destroy preview->widget */
name|g_free
argument_list|(
name|preview
operator|->
name|buffer
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*   Start rendering of the preview in background using an idle event.   If already started and not yet finished, stop it first.  */
end_comment

begin_function
name|void
DECL|function|preview_render_start (Preview * preview)
name|preview_render_start
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"preview_render_start\n"
operator|)
argument_list|)
expr_stmt|;
name|preview_render_end
argument_list|(
name|preview
argument_list|)
expr_stmt|;
name|preview
operator|->
name|init_done
operator|=
name|FALSE
expr_stmt|;
name|preview
operator|->
name|current_y
operator|=
literal|0
expr_stmt|;
name|preview
operator|->
name|drawn_y
operator|=
literal|0
expr_stmt|;
name|preview
operator|->
name|timeout_tag
operator|=
name|gtk_timeout_add
argument_list|(
literal|100
argument_list|,
operator|(
name|GtkFunction
operator|)
name|preview_render_start_2
argument_list|,
name|preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|preview_render_start_2 (Preview * preview)
name|preview_render_start_2
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
block|{
name|preview
operator|->
name|timeout_tag
operator|=
literal|0
expr_stmt|;
name|preview
operator|->
name|idle_tag
operator|=
name|gtk_idle_add
argument_list|(
operator|(
name|GtkFunction
operator|)
name|preview_handle_idle
argument_list|,
name|preview
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|void
DECL|function|preview_render_end (Preview * preview)
name|preview_render_end
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
block|{
if|if
condition|(
name|preview
operator|->
name|timeout_tag
operator|>
literal|0
condition|)
block|{
name|gtk_timeout_remove
argument_list|(
name|preview
operator|->
name|timeout_tag
argument_list|)
expr_stmt|;
name|preview
operator|->
name|timeout_tag
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|preview
operator|->
name|idle_tag
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|preview
operator|->
name|deinit_func
condition|)
call|(
modifier|*
name|preview
operator|->
name|deinit_func
call|)
argument_list|(
name|preview
argument_list|,
name|preview
operator|->
name|deinit_data
argument_list|)
expr_stmt|;
name|gtk_idle_remove
argument_list|(
name|preview
operator|->
name|idle_tag
argument_list|)
expr_stmt|;
name|preview
operator|->
name|idle_tag
operator|=
literal|0
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"preview_render_end\n\n"
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*   Handle an idle event.   Return FALSE if done, TRUE otherwise.  */
end_comment

begin_function
specifier|static
name|gint
DECL|function|preview_handle_idle (Preview * preview)
name|preview_handle_idle
parameter_list|(
name|Preview
modifier|*
name|preview
parameter_list|)
block|{
name|gint
name|done
init|=
name|FALSE
decl_stmt|;
name|GdkRectangle
name|draw_rect
decl_stmt|;
if|if
condition|(
name|preview
operator|->
name|init_done
operator|==
name|FALSE
condition|)
block|{
if|if
condition|(
name|preview
operator|->
name|init_func
operator|&&
call|(
modifier|*
name|preview
operator|->
name|init_func
call|)
argument_list|(
name|preview
argument_list|,
name|preview
operator|->
name|init_data
argument_list|)
condition|)
return|return
name|TRUE
return|;
name|preview
operator|->
name|init_done
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|preview
operator|->
name|render_func
condition|)
call|(
modifier|*
name|preview
operator|->
name|render_func
call|)
argument_list|(
name|preview
argument_list|,
name|preview
operator|->
name|buffer
argument_list|,
name|preview
operator|->
name|current_y
argument_list|,
name|preview
operator|->
name|render_data
argument_list|)
expr_stmt|;
else|else
name|memset
argument_list|(
name|preview
operator|->
name|buffer
argument_list|,
literal|0
argument_list|,
name|preview
operator|->
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
operator|->
name|widget
argument_list|)
argument_list|,
name|preview
operator|->
name|buffer
argument_list|,
literal|0
argument_list|,
name|preview
operator|->
name|current_y
argument_list|,
name|preview
operator|->
name|width
argument_list|)
expr_stmt|;
if|if
condition|(
operator|++
name|preview
operator|->
name|current_y
operator|>=
name|preview
operator|->
name|height
condition|)
name|done
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|done
operator|||
name|preview
operator|->
name|current_y
operator|%
literal|20
operator|==
literal|0
condition|)
block|{
name|draw_rect
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|draw_rect
operator|.
name|y
operator|=
name|preview
operator|->
name|drawn_y
expr_stmt|;
name|draw_rect
operator|.
name|width
operator|=
name|preview
operator|->
name|width
expr_stmt|;
name|draw_rect
operator|.
name|height
operator|=
name|preview
operator|->
name|current_y
operator|-
name|preview
operator|->
name|drawn_y
expr_stmt|;
name|preview
operator|->
name|drawn_y
operator|=
name|preview
operator|->
name|current_y
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|preview
operator|->
name|widget
argument_list|,
operator|&
name|draw_rect
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|done
condition|)
block|{
name|preview_render_end
argument_list|(
name|preview
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/*   Convert RGBA to RGB with rendering gray check if needed. 	(from nova.c)   input:  guchar src[4]		RGBA pixel   output: guchar dest[3]	RGB pixel  */
end_comment

begin_function
name|void
DECL|function|preview_rgba_to_rgb (guchar * dest,gint x,gint y,guchar * src)
name|preview_rgba_to_rgb
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guchar
modifier|*
name|src
parameter_list|)
block|{
name|gint
name|src_a
decl_stmt|;
name|gint
name|check
decl_stmt|;
name|gint
name|b
decl_stmt|;
name|src_a
operator|=
name|src
index|[
literal|3
index|]
expr_stmt|;
if|if
condition|(
name|src_a
operator|==
name|OPAQUE
condition|)
comment|/* full opaque */
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|dest
index|[
name|b
index|]
operator|=
name|src
index|[
name|b
index|]
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|x
operator|%
operator|(
name|CHECK_SIZE
operator|*
literal|2
operator|)
operator|<
name|CHECK_SIZE
operator|)
operator|^
operator|(
name|y
operator|%
operator|(
name|CHECK_SIZE
operator|*
literal|2
operator|)
operator|<
name|CHECK_SIZE
operator|)
condition|)
name|check
operator|=
name|LIGHTCHECK
expr_stmt|;
else|else
name|check
operator|=
name|DARKCHECK
expr_stmt|;
if|if
condition|(
name|src_a
operator|==
literal|0
condition|)
comment|/* full transparent */
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|dest
index|[
name|b
index|]
operator|=
name|check
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|dest
index|[
name|b
index|]
operator|=
operator|(
name|src
index|[
name|b
index|]
operator|*
name|src_a
operator|+
name|check
operator|*
operator|(
name|OPAQUE
operator|-
name|src_a
operator|)
operator|)
operator|/
name|OPAQUE
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**			+++ Gradient Menu				**/
end_comment

begin_comment
comment|/**			+++ gm						**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_function
name|void
DECL|function|gradient_menu_init ()
name|gradient_menu_init
parameter_list|()
block|{
name|gm_gradient_get_list
argument_list|()
expr_stmt|;
name|gradient_menus
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_menu_rescan ()
name|gradient_menu_rescan
parameter_list|()
block|{
name|GList
modifier|*
name|tmp
decl_stmt|;
name|GradientMenu
modifier|*
name|gm
decl_stmt|;
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
comment|/* Detach and destroy menus first */
name|tmp
operator|=
name|gradient_menus
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|gm
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
name|menu
operator|=
name|GTK_MULTI_OPTION_MENU
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
operator|->
name|menu
expr_stmt|;
if|if
condition|(
name|menu
condition|)
block|{
name|gtk_multi_option_menu_remove_menu
argument_list|(
name|GTK_MULTI_OPTION_MENU
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* reget list of gradient names */
name|gm_gradient_get_list
argument_list|()
expr_stmt|;
comment|/* Create menus and attach them again */
name|tmp
operator|=
name|gradient_menus
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|GtkWidget
modifier|*
name|parent
decl_stmt|;
name|gm
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
name|tmp
operator|=
name|tmp
operator|->
name|next
expr_stmt|;
comment|/* @GRADIENT_NAME */
name|menu
operator|=
name|gm_menu_new
argument_list|(
name|gm
argument_list|,
name|gm
operator|->
name|gradient_name
argument_list|)
expr_stmt|;
comment|/* 	FIXME: 	This is a kind of hack so that it doesn't mess up gtknotebook 	to set menu into an option menu which is not shown (but 	GTK_WIDGET_VISIBLE)        */
name|parent
operator|=
name|gm
operator|->
name|option_menu
operator|->
name|parent
expr_stmt|;
if|if
condition|(
literal|0
operator|&&
operator|(
name|parent
operator|!=
name|NULL
operator|)
operator|&&
name|GTK_CHECK_TYPE
argument_list|(
name|parent
argument_list|,
name|gtk_container_get_type
argument_list|()
argument_list|)
condition|)
block|{
comment|/*gtk_container_block_resize (GTK_CONTAINER (parent));*/
name|gtk_multi_option_menu_set_menu
argument_list|(
name|GTK_MULTI_OPTION_MENU
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
argument_list|,
name|menu
argument_list|)
expr_stmt|;
comment|/*gtk_container_unblock_resize (GTK_CONTAINER (parent));*/
block|}
else|else
name|gtk_multi_option_menu_set_menu
argument_list|(
name|GTK_MULTI_OPTION_MENU
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
argument_list|,
name|menu
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|GradientMenu
modifier|*
DECL|function|gradient_menu_new (GradientMenuCallback callback,gpointer callback_data,gchar * default_gradient_name)
name|gradient_menu_new
parameter_list|(
name|GradientMenuCallback
name|callback
parameter_list|,
name|gpointer
name|callback_data
parameter_list|,
name|gchar
modifier|*
name|default_gradient_name
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GradientMenu
modifier|*
name|gm
decl_stmt|;
name|gm
operator|=
name|g_new
argument_list|(
name|GradientMenu
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gm
operator|->
name|callback
operator|=
name|callback
expr_stmt|;
name|gm
operator|->
name|callback_data
operator|=
name|callback_data
expr_stmt|;
name|gm
operator|->
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gm
operator|->
name|preview
argument_list|)
argument_list|,
name|GM_PREVIEW_WIDTH
argument_list|,
name|GM_PREVIEW_HEIGHT
argument_list|)
expr_stmt|;
name|gm
operator|->
name|option_menu
operator|=
name|gtk_multi_option_menu_new
argument_list|()
expr_stmt|;
comment|/* @GRADIENT_NAME */
name|menu
operator|=
name|gm_menu_new
argument_list|(
name|gm
argument_list|,
name|default_gradient_name
argument_list|)
expr_stmt|;
name|gtk_multi_option_menu_set_menu
argument_list|(
name|GTK_MULTI_OPTION_MENU
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
argument_list|,
name|menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gm
operator|->
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
expr_stmt|;
name|gradient_menus
operator|=
name|g_list_append
argument_list|(
name|gradient_menus
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
operator|&
name|gm_option_menu_destroy_callback
argument_list|,
name|gm
argument_list|)
expr_stmt|;
return|return
name|gm
return|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_menu_destroy (GradientMenu * gm)
name|gradient_menu_destroy
parameter_list|(
name|GradientMenu
modifier|*
name|gm
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|gm
operator|->
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|gm
operator|->
name|option_menu
argument_list|)
expr_stmt|;
comment|/* gm is removed from gradient_menus too */
name|g_free
argument_list|(
name|gm
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Local Functions */
end_comment

begin_function
specifier|static
name|void
DECL|function|gm_gradient_get_list ()
name|gm_gradient_get_list
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
name|gradient_names
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_gradient_names
condition|;
name|i
operator|++
control|)
name|g_free
argument_list|(
name|gradient_names
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradient_names
argument_list|)
expr_stmt|;
block|}
name|gradient_cache_flush
argument_list|()
expr_stmt|;
comment|/* to make sure */
name|gradient_names
operator|=
name|gradient_get_list
argument_list|(
operator|&
name|num_gradient_names
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  Create GtkMenu and arrange GtkMenuItem's of gradient names into it  */
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|gm_menu_new (GradientMenu * gm,gchar * default_gradient_name)
name|gm_menu_new
parameter_list|(
name|GradientMenu
modifier|*
name|gm
parameter_list|,
name|gchar
modifier|*
name|default_gradient_name
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|gchar
modifier|*
name|active_name
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|num_gradient_names
operator|==
literal|0
condition|)
block|{
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"none"
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|menuitem
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_menu_set_active
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* num_gradient_names == 0 */
block|{
name|menu
operator|=
name|gm_menu_create_sub_menus
argument_list|(
name|gm
argument_list|,
literal|0
argument_list|,
operator|&
name|active_name
argument_list|,
name|default_gradient_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|active_name
operator|==
name|NULL
condition|)
block|{
name|active_name
operator|=
name|gradient_names
index|[
literal|0
index|]
expr_stmt|;
name|g_warning
argument_list|(
literal|"Not found \"%s\": used \"%s\" instead"
argument_list|,
name|default_gradient_name
argument_list|,
name|active_name
argument_list|)
expr_stmt|;
block|}
name|gradient_name_copy
argument_list|(
name|gm
operator|->
name|gradient_name
argument_list|,
name|active_name
argument_list|)
expr_stmt|;
name|gm_preview_draw
argument_list|(
name|gm
operator|->
name|preview
argument_list|,
name|active_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|gm
operator|->
name|preview
argument_list|)
operator|&&
name|GTK_WIDGET_MAPPED
argument_list|(
name|gm
operator|->
name|preview
argument_list|)
condition|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gm_menu_new: preview is visible and mapped\n"
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|gm
operator|->
name|preview
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gm
operator|->
name|callback
condition|)
call|(
modifier|*
name|gm
operator|->
name|callback
call|)
argument_list|(
name|active_name
argument_list|,
name|gm
operator|->
name|callback_data
argument_list|)
expr_stmt|;
block|}
comment|/* num_gradient_names == 0 */
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|gm_menu_create_sub_menus (GradientMenu * gm,gint start_n,gchar ** active_name_ptr,gchar * default_gradient_name)
name|gm_menu_create_sub_menus
parameter_list|(
name|GradientMenu
modifier|*
name|gm
parameter_list|,
name|gint
name|start_n
parameter_list|,
name|gchar
modifier|*
modifier|*
name|active_name_ptr
parameter_list|,
name|gchar
modifier|*
name|default_gradient_name
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|,
modifier|*
name|sub_menu
decl_stmt|;
name|gchar
modifier|*
name|sub_active_name
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|gint
name|active_i
init|=
literal|0
decl_stmt|;
name|gint
name|i
decl_stmt|,
name|n
decl_stmt|;
operator|*
name|active_name_ptr
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|start_n
operator|>=
name|num_gradient_names
condition|)
block|{
return|return
name|NULL
return|;
block|}
comment|/* gradient_names[] are malloced strings and alive during      this menuitem lives */
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|n
operator|=
name|start_n
init|;
name|i
operator|<
name|GM_MENU_MAX
operator|&&
name|n
operator|<
name|num_gradient_names
condition|;
name|i
operator|++
operator|,
name|n
operator|++
control|)
block|{
name|name
operator|=
name|gradient_names
index|[
name|n
index|]
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|default_gradient_name
argument_list|)
operator|==
literal|0
condition|)
block|{
name|active_i
operator|=
name|i
expr_stmt|;
operator|*
name|active_name_ptr
operator|=
name|name
expr_stmt|;
block|}
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gm
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gm_menu_item_callback
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
block|}
comment|/* for */
name|sub_menu
operator|=
name|gm_menu_create_sub_menus
argument_list|(
name|gm
argument_list|,
name|n
argument_list|,
operator|&
name|sub_active_name
argument_list|,
name|default_gradient_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|sub_menu
condition|)
block|{
name|active_i
operator|+=
literal|2
expr_stmt|;
comment|/* hline */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_menu_prepend
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"More..."
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_menu_prepend
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|sub_menu
argument_list|)
expr_stmt|;
if|if
condition|(
name|sub_active_name
condition|)
block|{
operator|*
name|active_name_ptr
operator|=
name|sub_active_name
expr_stmt|;
name|active_i
operator|=
literal|0
expr_stmt|;
comment|/* "More ..." */
block|}
block|}
name|gtk_menu_set_active
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|active_i
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gm_menu_item_callback (GtkWidget * w,gpointer data)
name|gm_menu_item_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GradientMenu
modifier|*
name|gm
decl_stmt|;
name|gchar
modifier|*
name|gradient_name
init|=
operator|(
name|gchar
operator|*
operator|)
name|data
decl_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gm_menu_item_callback\n"
operator|)
argument_list|)
expr_stmt|;
name|gm
operator|=
operator|(
name|GradientMenu
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|w
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_name_copy
argument_list|(
name|gm
operator|->
name|gradient_name
argument_list|,
name|gradient_name
argument_list|)
expr_stmt|;
name|gm_preview_draw
argument_list|(
name|gm
operator|->
name|preview
argument_list|,
name|gradient_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|gm
operator|->
name|preview
argument_list|)
operator|&&
name|GTK_WIDGET_MAPPED
argument_list|(
name|gm
operator|->
name|preview
argument_list|)
condition|)
block|{
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"gm_menu_item_callback: preview is visible and mapped\n"
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|gm
operator|->
name|preview
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gm
operator|->
name|callback
condition|)
call|(
modifier|*
name|gm
operator|->
name|callback
call|)
argument_list|(
name|gradient_name
argument_list|,
name|gm
operator|->
name|callback_data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gm_preview_draw (GtkWidget * preview,gchar * gradient_name)
name|gm_preview_draw
parameter_list|(
name|GtkWidget
modifier|*
name|preview
parameter_list|,
name|gchar
modifier|*
name|gradient_name
parameter_list|)
block|{
name|guchar
name|values
index|[
name|GM_PREVIEW_WIDTH
index|]
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|nvalues
init|=
name|GM_PREVIEW_WIDTH
decl_stmt|;
name|int
name|row
decl_stmt|,
name|irow
decl_stmt|,
name|col
decl_stmt|;
name|guchar
name|dest_row
index|[
name|GM_PREVIEW_WIDTH
index|]
index|[
literal|3
index|]
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|,
modifier|*
name|src
decl_stmt|;
name|int
name|check
decl_stmt|,
name|b
decl_stmt|;
specifier|const
name|int
name|alpha
init|=
literal|3
decl_stmt|;
name|gradient_get_values
argument_list|(
name|gradient_name
argument_list|,
operator|(
name|guchar
operator|*
operator|)
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
for|for
control|(
name|row
operator|=
literal|0
init|;
name|row
operator|<
name|GM_PREVIEW_HEIGHT
condition|;
name|row
operator|+=
name|CHECK_SIZE
control|)
block|{
for|for
control|(
name|col
operator|=
literal|0
init|;
name|col
operator|<
name|GM_PREVIEW_WIDTH
condition|;
name|col
operator|++
control|)
block|{
name|dest
operator|=
name|dest_row
index|[
name|col
index|]
expr_stmt|;
name|src
operator|=
name|values
index|[
name|col
index|]
expr_stmt|;
if|if
condition|(
name|src
index|[
name|alpha
index|]
operator|==
name|OPAQUE
condition|)
block|{
comment|/* no alpha channel or opaque -- simple way */
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|alpha
condition|;
name|b
operator|++
control|)
name|dest
index|[
name|b
index|]
operator|=
name|src
index|[
name|b
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* more or less transparent */
if|if
condition|(
operator|(
name|col
operator|%
operator|(
name|CHECK_SIZE
operator|*
literal|2
operator|)
operator|<
name|CHECK_SIZE
operator|)
operator|^
operator|(
name|row
operator|%
operator|(
name|CHECK_SIZE
operator|*
literal|2
operator|)
operator|<
name|CHECK_SIZE
operator|)
condition|)
name|check
operator|=
name|LIGHTCHECK
expr_stmt|;
else|else
name|check
operator|=
name|DARKCHECK
expr_stmt|;
if|if
condition|(
name|src
index|[
name|alpha
index|]
operator|==
literal|0
condition|)
block|{
comment|/* full transparent -- check */
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|alpha
condition|;
name|b
operator|++
control|)
name|dest
index|[
name|b
index|]
operator|=
name|check
expr_stmt|;
block|}
else|else
block|{
comment|/* middlemost transparent -- mix check and src */
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|alpha
condition|;
name|b
operator|++
control|)
name|dest
index|[
name|b
index|]
operator|=
operator|(
name|src
index|[
name|b
index|]
operator|*
name|src
index|[
name|alpha
index|]
operator|+
name|check
operator|*
operator|(
name|OPAQUE
operator|-
name|src
index|[
name|alpha
index|]
operator|)
operator|)
operator|/
name|OPAQUE
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
name|irow
operator|=
literal|0
init|;
name|irow
operator|<
name|CHECK_SIZE
operator|&&
name|row
operator|+
name|irow
operator|<
name|GM_PREVIEW_HEIGHT
condition|;
name|irow
operator|++
control|)
block|{
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
argument_list|)
argument_list|,
operator|(
name|guchar
operator|*
operator|)
name|dest_row
argument_list|,
literal|0
argument_list|,
name|row
operator|+
name|irow
argument_list|,
name|GM_PREVIEW_WIDTH
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gm_option_menu_destroy_callback (GtkWidget * w,gpointer data)
name|gm_option_menu_destroy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GradientMenu
modifier|*
name|gm
init|=
name|data
decl_stmt|;
name|gradient_menus
operator|=
name|g_list_remove
argument_list|(
name|gradient_menus
argument_list|,
name|gm
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**			+++ Gradients					**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/*     Manage both internal and external gradients: list up, cache,     sampling, etc.      External gradients are cached.  */
end_comment

begin_function
name|void
DECL|function|gradient_name_copy (gchar * dest,gchar * src)
name|gradient_name_copy
parameter_list|(
name|gchar
modifier|*
name|dest
parameter_list|,
name|gchar
modifier|*
name|src
parameter_list|)
block|{
name|strncpy
argument_list|(
name|dest
argument_list|,
name|src
argument_list|,
name|GRADIENT_NAME_MAX
argument_list|)
expr_stmt|;
name|dest
index|[
name|GRADIENT_NAME_MAX
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_comment
comment|/*   Translate SPACE to "\\040", etc.  */
end_comment

begin_function
name|void
DECL|function|gradient_name_encode (guchar * dest,guchar * src)
name|gradient_name_encode
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src
parameter_list|)
block|{
name|int
name|cnt
init|=
name|GRADIENT_NAME_MAX
operator|-
literal|1
decl_stmt|;
while|while
condition|(
operator|*
name|src
operator|&&
name|cnt
operator|--
condition|)
block|{
if|if
condition|(
name|iscntrl
argument_list|(
operator|*
name|src
argument_list|)
operator|||
name|isspace
argument_list|(
operator|*
name|src
argument_list|)
operator|||
operator|*
name|src
operator|==
literal|'\\'
condition|)
block|{
name|sprintf
argument_list|(
name|dest
argument_list|,
literal|"\\%03o"
argument_list|,
operator|*
name|src
operator|++
argument_list|)
expr_stmt|;
name|dest
operator|+=
literal|4
expr_stmt|;
block|}
else|else
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
operator|*
name|dest
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_comment
comment|/*   Translate "\\040" to SPACE, etc.  */
end_comment

begin_function
name|void
DECL|function|gradient_name_decode (guchar * dest,guchar * src)
name|gradient_name_decode
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|guchar
modifier|*
name|src
parameter_list|)
block|{
name|int
name|cnt
init|=
name|GRADIENT_NAME_MAX
operator|-
literal|1
decl_stmt|;
name|int
name|tmp
decl_stmt|;
while|while
condition|(
operator|*
name|src
operator|&&
name|cnt
operator|--
condition|)
block|{
if|if
condition|(
operator|*
name|src
operator|==
literal|'\\'
operator|&&
operator|*
operator|(
name|src
operator|+
literal|1
operator|)
operator|&&
operator|*
operator|(
name|src
operator|+
literal|2
operator|)
operator|&&
operator|*
operator|(
name|src
operator|+
literal|3
operator|)
condition|)
block|{
name|sscanf
argument_list|(
name|src
operator|+
literal|1
argument_list|,
literal|"%3o"
argument_list|,
operator|&
name|tmp
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|tmp
expr_stmt|;
name|src
operator|+=
literal|4
expr_stmt|;
block|}
else|else
operator|*
name|dest
operator|++
operator|=
operator|*
name|src
operator|++
expr_stmt|;
block|}
operator|*
name|dest
operator|=
literal|'\0'
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_init ()
name|gradient_init
parameter_list|()
block|{
name|gradient_cache_head
operator|=
name|NULL
expr_stmt|;
name|gradient_cache_count
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_free ()
name|gradient_free
parameter_list|()
block|{
name|gradient_cache_flush
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
modifier|*
DECL|function|gradient_get_list (gint * num_gradients)
name|gradient_get_list
parameter_list|(
name|gint
modifier|*
name|num_gradients
parameter_list|)
block|{
name|gchar
modifier|*
modifier|*
name|gradients
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|external_gradients
init|=
name|NULL
decl_stmt|;
name|gint
name|external_ngradients
init|=
literal|0
decl_stmt|;
name|gint
name|i
decl_stmt|,
name|n
decl_stmt|;
name|gradient_cache_flush
argument_list|()
expr_stmt|;
name|external_gradients
operator|=
name|gimp_gradients_get_list
argument_list|(
operator|&
name|external_ngradients
argument_list|)
expr_stmt|;
operator|*
name|num_gradients
operator|=
name|internal_ngradients
operator|+
name|external_ngradients
expr_stmt|;
name|gradients
operator|=
name|g_new
argument_list|(
name|gchar
operator|*
argument_list|,
operator|*
name|num_gradients
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|internal_ngradients
condition|;
name|i
operator|++
control|)
block|{
name|gradients
index|[
name|n
operator|++
index|]
operator|=
name|g_strdup
argument_list|(
name|internal_gradients
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|external_ngradients
condition|;
name|i
operator|++
control|)
block|{
name|gradients
index|[
name|n
operator|++
index|]
operator|=
name|g_strdup
argument_list|(
name|external_gradients
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
return|return
name|gradients
return|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_get_values (gchar * gradient_name,guchar * values,gint nvalues)
name|gradient_get_values
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
block|{
comment|/* DEBUG_PRINT (("gradient_get_values: %s %d\n", gradient_name, nvalues)); */
comment|/*     Criteria to distinguish internal and external is rather simple here.     It should be fixed later.    */
if|if
condition|(
name|gradient_name
index|[
literal|0
index|]
operator|==
literal|'%'
condition|)
name|gradient_get_values_internal
argument_list|(
name|gradient_name
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
else|else
name|gradient_get_values_external
argument_list|(
name|gradient_name
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_get_values_internal (gchar * gradient_name,guchar * values,gint nvalues)
name|gradient_get_values_internal
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
block|{
specifier|static
name|guchar
name|white
index|[
literal|4
index|]
init|=
block|{
literal|255
block|,
literal|255
block|,
literal|255
block|,
literal|255
block|}
decl_stmt|;
specifier|static
name|guchar
name|white_trans
index|[
literal|4
index|]
init|=
block|{
literal|255
block|,
literal|255
block|,
literal|255
block|,
literal|0
block|}
decl_stmt|;
specifier|static
name|guchar
name|red_trans
index|[
literal|4
index|]
init|=
block|{
literal|255
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
specifier|static
name|guchar
name|blue_trans
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|255
block|,
literal|0
block|}
decl_stmt|;
specifier|static
name|guchar
name|yellow_trans
index|[
literal|4
index|]
init|=
block|{
literal|255
block|,
literal|255
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
comment|/*     The internal gradients here are example --     What kind of internals would be useful ?    */
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|gradient_name
argument_list|,
literal|"%white"
argument_list|)
condition|)
block|{
name|gradient_get_blend
argument_list|(
name|white
argument_list|,
name|white
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|gradient_name
argument_list|,
literal|"%white_grad"
argument_list|)
condition|)
block|{
name|gradient_get_blend
argument_list|(
name|white
argument_list|,
name|white_trans
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|gradient_name
argument_list|,
literal|"%red_grad"
argument_list|)
condition|)
block|{
name|gradient_get_blend
argument_list|(
name|white
argument_list|,
name|red_trans
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|gradient_name
argument_list|,
literal|"%blue_grad"
argument_list|)
condition|)
block|{
name|gradient_get_blend
argument_list|(
name|white
argument_list|,
name|blue_trans
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|gradient_name
argument_list|,
literal|"%yellow_grad"
argument_list|)
condition|)
block|{
name|gradient_get_blend
argument_list|(
name|white
argument_list|,
name|yellow_trans
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|gradient_name
argument_list|,
literal|"%random"
argument_list|)
condition|)
block|{
name|gradient_get_random
argument_list|(
literal|1
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gradient_get_default
argument_list|(
name|gradient_name
argument_list|,
name|values
argument_list|,
name|nvalues
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_get_blend (guchar * fg,guchar * bg,guchar * values,gint nvalues)
name|gradient_get_blend
parameter_list|(
name|guchar
modifier|*
name|fg
parameter_list|,
name|guchar
modifier|*
name|bg
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
block|{
name|gdouble
name|x
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|guchar
modifier|*
name|v
init|=
name|values
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nvalues
condition|;
name|i
operator|++
control|)
block|{
name|x
operator|=
operator|(
name|double
operator|)
name|i
operator|/
name|nvalues
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
name|j
operator|++
control|)
operator|*
name|v
operator|++
operator|=
name|fg
index|[
name|j
index|]
operator|*
operator|(
literal|1
operator|-
name|x
operator|)
operator|+
name|bg
index|[
name|j
index|]
operator|*
name|x
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_get_random (gint seed,guchar * values,gint nvalues)
name|gradient_get_random
parameter_list|(
name|gint
name|seed
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|inten
decl_stmt|;
name|guchar
modifier|*
name|v
init|=
name|values
decl_stmt|;
comment|/*     This is really simple  -- gaussian noise might be better    */
name|srand
argument_list|(
name|seed
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nvalues
condition|;
name|i
operator|++
control|)
block|{
name|inten
operator|=
name|rand
argument_list|()
operator|%
literal|256
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
operator|*
name|v
operator|++
operator|=
name|inten
expr_stmt|;
operator|*
name|v
operator|++
operator|=
literal|255
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_get_default (gchar * name,guchar * values,gint nvalues)
name|gradient_get_default
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
block|{
name|double
name|e
index|[
literal|3
index|]
decl_stmt|;
name|double
name|x
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|guchar
modifier|*
name|v
init|=
name|values
decl_stmt|;
comment|/*     Create gradient by name    */
name|name
operator|++
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
name|e
index|[
name|j
index|]
operator|=
name|name
index|[
name|j
index|]
operator|/
literal|255.0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nvalues
condition|;
name|i
operator|++
control|)
block|{
name|x
operator|=
operator|(
name|double
operator|)
name|i
operator|/
name|nvalues
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
operator|*
name|v
operator|++
operator|=
literal|255
operator|*
name|pow
argument_list|(
name|x
argument_list|,
name|e
index|[
name|j
index|]
argument_list|)
expr_stmt|;
operator|*
name|v
operator|++
operator|=
literal|255
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*   Caching gradients is really needed. It really takes 0.2 seconds each   time to resample an external gradient. (And this plug-in has   currently 6 gradient menus.)    However, this caching routine is not too good. It picks up just   GRADIENT_RESOLUTION samples everytime, and rescales it later.	 And   cached values are stored in guchar array. No accuracy.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gradient_get_values_external (gchar * gradient_name,guchar * values,gint nvalues)
name|gradient_get_values_external
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
block|{
name|GradientCacheItem
modifier|*
name|ci
decl_stmt|;
name|gint
name|found
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|clock_t
name|clk
init|=
name|clock
argument_list|()
decl_stmt|;
endif|#
directive|endif
name|g_return_if_fail
argument_list|(
name|nvalues
operator|>=
literal|2
argument_list|)
expr_stmt|;
name|ci
operator|=
name|gradient_cache_lookup
argument_list|(
name|gradient_name
argument_list|,
operator|&
name|found
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|found
condition|)
block|{
name|gradient_get_values_real_external
argument_list|(
name|gradient_name
argument_list|,
name|ci
operator|->
name|values
argument_list|,
name|GRADIENT_RESOLUTION
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|nvalues
operator|==
name|GRADIENT_RESOLUTION
condition|)
block|{
name|memcpy
argument_list|(
name|values
argument_list|,
name|ci
operator|->
name|values
argument_list|,
literal|4
operator|*
name|GRADIENT_RESOLUTION
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|double
name|pos
decl_stmt|,
name|frac
decl_stmt|;
name|int
name|ipos
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nvalues
condition|;
name|i
operator|++
control|)
block|{
name|pos
operator|=
operator|(
operator|(
name|double
operator|)
name|i
operator|/
operator|(
name|nvalues
operator|-
literal|1
operator|)
operator|)
operator|*
operator|(
name|GRADIENT_RESOLUTION
operator|-
literal|1
operator|)
expr_stmt|;
name|g_assert
argument_list|(
literal|0
operator|<=
name|pos
operator|&&
name|pos
operator|<=
name|GRADIENT_RESOLUTION
operator|-
literal|1
argument_list|)
expr_stmt|;
name|ipos
operator|=
operator|(
name|int
operator|)
name|pos
expr_stmt|;
name|frac
operator|=
name|pos
operator|-
name|ipos
expr_stmt|;
if|if
condition|(
name|frac
operator|==
literal|0.0
condition|)
block|{
name|memcpy
argument_list|(
operator|&
name|values
index|[
literal|4
operator|*
name|i
index|]
argument_list|,
operator|&
name|ci
operator|->
name|values
index|[
literal|4
operator|*
name|ipos
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
else|else
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
name|j
operator|++
control|)
name|values
index|[
literal|4
operator|*
name|i
operator|+
name|j
index|]
operator|=
name|ci
operator|->
name|values
index|[
literal|4
operator|*
name|ipos
operator|+
name|j
index|]
operator|*
operator|(
literal|1
operator|-
name|frac
operator|)
operator|+
name|ci
operator|->
name|values
index|[
literal|4
operator|*
operator|(
name|ipos
operator|+
literal|1
operator|)
operator|+
name|j
index|]
operator|*
name|frac
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|get_values_external_clock
operator|+=
name|clock
argument_list|()
operator|-
name|clk
expr_stmt|;
name|get_values_external_count
operator|++
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_get_values_real_external (gchar * gradient_name,guchar * values,gint nvalues)
name|gradient_get_values_real_external
parameter_list|(
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|guchar
modifier|*
name|values
parameter_list|,
name|gint
name|nvalues
parameter_list|)
block|{
name|gchar
modifier|*
name|old_name
decl_stmt|;
name|gdouble
modifier|*
name|tmp_values
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|old_name
operator|=
name|gimp_gradients_get_active
argument_list|()
expr_stmt|;
name|gimp_gradients_set_active
argument_list|(
name|gradient_name
argument_list|)
expr_stmt|;
name|tmp_values
operator|=
name|gimp_gradients_sample_uniform
argument_list|(
name|nvalues
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nvalues
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
name|j
operator|++
control|)
name|values
index|[
literal|4
operator|*
name|i
operator|+
name|j
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|tmp_values
index|[
literal|4
operator|*
name|i
operator|+
name|j
index|]
operator|*
literal|255
argument_list|)
expr_stmt|;
name|gimp_gradients_set_active
argument_list|(
name|old_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp_values
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|old_name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_cache_flush ()
name|gradient_cache_flush
parameter_list|()
block|{
name|GradientCacheItem
modifier|*
name|ci
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|ci
operator|=
name|gradient_cache_head
expr_stmt|;
while|while
condition|(
name|ci
condition|)
block|{
name|tmp
operator|=
name|ci
operator|->
name|next
expr_stmt|;
name|g_free
argument_list|(
name|ci
argument_list|)
expr_stmt|;
name|ci
operator|=
name|tmp
expr_stmt|;
block|}
name|gradient_cache_head
operator|=
name|NULL
expr_stmt|;
name|gradient_cache_count
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GradientCacheItem
modifier|*
DECL|function|gradient_cache_lookup (gchar * name,gint * found)
name|gradient_cache_lookup
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
modifier|*
name|found
parameter_list|)
block|{
name|GradientCacheItem
modifier|*
name|ci
decl_stmt|;
name|ci
operator|=
name|gradient_cache_head
expr_stmt|;
while|while
condition|(
name|ci
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|ci
operator|->
name|name
argument_list|,
name|name
argument_list|)
condition|)
break|break;
name|ci
operator|=
name|ci
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
name|ci
condition|)
block|{
operator|*
name|found
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|!
name|ci
operator|->
name|prev
condition|)
block|{
name|g_assert
argument_list|(
name|ci
operator|==
name|gradient_cache_head
argument_list|)
expr_stmt|;
return|return
name|ci
return|;
block|}
name|ci
operator|->
name|prev
operator|->
name|next
operator|=
name|ci
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|ci
operator|->
name|next
condition|)
name|ci
operator|->
name|next
operator|->
name|prev
operator|=
name|ci
operator|->
name|prev
expr_stmt|;
name|ci
operator|->
name|next
operator|=
name|gradient_cache_head
expr_stmt|;
name|gradient_cache_head
operator|->
name|prev
operator|=
name|ci
expr_stmt|;
name|gradient_cache_head
operator|=
name|ci
expr_stmt|;
name|ci
operator|->
name|prev
operator|=
name|NULL
expr_stmt|;
return|return
name|ci
return|;
block|}
else|else
block|{
operator|*
name|found
operator|=
name|FALSE
expr_stmt|;
while|while
condition|(
name|gradient_cache_count
operator|>=
name|GRADIENT_CACHE_SIZE
condition|)
name|gradient_cache_zorch
argument_list|()
expr_stmt|;
name|ci
operator|=
name|g_new
argument_list|(
name|GradientCacheItem
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|ci
operator|->
name|name
argument_list|,
name|name
argument_list|,
name|GRADIENT_NAME_MAX
operator|-
literal|1
argument_list|)
expr_stmt|;
name|ci
operator|->
name|next
operator|=
name|gradient_cache_head
expr_stmt|;
name|ci
operator|->
name|prev
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|gradient_cache_head
condition|)
name|gradient_cache_head
operator|->
name|prev
operator|=
name|ci
expr_stmt|;
name|gradient_cache_head
operator|=
name|ci
expr_stmt|;
operator|++
name|gradient_cache_count
expr_stmt|;
return|return
name|ci
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_cache_zorch ()
name|gradient_cache_zorch
parameter_list|()
block|{
name|GradientCacheItem
modifier|*
name|ci
init|=
name|gradient_cache_head
decl_stmt|;
while|while
condition|(
name|ci
operator|&&
name|ci
operator|->
name|next
condition|)
block|{
name|ci
operator|=
name|ci
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
name|ci
condition|)
block|{
name|g_assert
argument_list|(
name|ci
operator|->
name|next
operator|==
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|ci
operator|->
name|prev
condition|)
name|ci
operator|->
name|prev
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
else|else
name|gradient_cache_head
operator|=
name|NULL
expr_stmt|;
name|g_free
argument_list|(
name|ci
argument_list|)
expr_stmt|;
operator|--
name|gradient_cache_count
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_function
name|void
DECL|function|gradient_report ()
name|gradient_report
parameter_list|()
block|{
name|double
name|total
init|=
operator|(
name|double
operator|)
name|get_values_external_clock
operator|/
name|CLOCKS_PER_SEC
decl_stmt|;
name|printf
argument_list|(
literal|"gradient_get_values_external %.2f sec. / %d times (ave %.2f sec.)\n"
argument_list|,
name|total
argument_list|,
name|get_values_external_count
argument_list|,
name|total
operator|/
name|get_values_external_count
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**			+++ Entscale					**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/* these routines are taken from my private subroutine collection. */
end_comment

begin_comment
comment|/* -*- mode:c -*- */
end_comment

begin_comment
comment|/*   Entry and Scale pair (int and double integrated)    This is an attempt to combine entscale_int and double.   Never compiled yet.    TODO:   - Do the proper thing when the user changes value in entry,   so that callback should not be called when value is actually not changed.   - Update delay  */
end_comment

begin_comment
comment|/* $Id$ */
end_comment

begin_function_decl
specifier|static
name|void
name|entscale_destroy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_entry_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  *  Create an entry, a scale and a label, then attach them to  *  specified table.  *  1 row and 2 cols of table are needed.  *  *  Input:  *    table:	  table which entscale is attached to  *    x, y:	  starting row and col in table  *    caption:	  label string  *    type:	  type of variable (ENTSCALE_INT or ENTSCALE_DOUBLE)  *    variable:	  pointer to variable  *    min, max:	  boundary of scale  *    step:	  step of scale (ignored when (type == ENTSCALE_INT))  *    constraint: (bool) true iff the value of *variable should be  *		  constraint by min and max  *    callback:	  called when the value is actually changed  *		  (*variable is automatically changed, so there's no  *		  need of callback func usually.)  *    call_data:  data for callback func  */
end_comment

begin_function
name|void
DECL|function|entscale_new (GtkWidget * table,gint x,gint y,gchar * caption,EntscaleType type,gpointer variable,gdouble min,gdouble max,gdouble step,gint constraint,EntscaleCallbackFunc callback,gpointer call_data)
name|entscale_new
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|EntscaleType
name|type
parameter_list|,
name|gpointer
name|variable
parameter_list|,
name|gdouble
name|min
parameter_list|,
name|gdouble
name|max
parameter_list|,
name|gdouble
name|step
parameter_list|,
name|gint
name|constraint
parameter_list|,
name|EntscaleCallbackFunc
name|callback
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
block|{
name|Entscale
modifier|*
name|entscale
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
name|gchar
name|buffer
index|[
literal|256
index|]
decl_stmt|;
name|gdouble
name|val
decl_stmt|;
name|gdouble
name|constraint_val
decl_stmt|;
name|entscale
operator|=
name|g_new0
argument_list|(
name|Entscale
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|entscale
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|entscale
operator|->
name|constraint
operator|=
name|constraint
expr_stmt|;
name|entscale
operator|->
name|callback
operator|=
name|callback
expr_stmt|;
name|entscale
operator|->
name|call_data
operator|=
name|call_data
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|ENTSCALE_INT
case|:
name|step
operator|=
literal|1.0
expr_stmt|;
name|strcpy
argument_list|(
name|entscale
operator|->
name|fmt_string
argument_list|,
literal|"%.0f"
argument_list|)
expr_stmt|;
name|val
operator|=
operator|*
operator|(
name|gint
operator|*
operator|)
name|variable
expr_stmt|;
break|break;
case|case
name|ENTSCALE_DOUBLE
case|:
name|sprintf
argument_list|(
name|entscale
operator|->
name|fmt_string
argument_list|,
literal|"%%.%df"
argument_list|,
name|entscale_get_precision
argument_list|(
name|step
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|val
operator|=
operator|*
operator|(
name|gdouble
operator|*
operator|)
name|variable
expr_stmt|;
break|break;
default|default:
name|g_error
argument_list|(
literal|"TYPE must be either ENTSCALE_INT or ENTSCALE_DOUBLE"
argument_list|)
expr_stmt|;
name|val
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|label
operator|=
name|gtk_label_new
argument_list|(
name|caption
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
comment|/*     If the first arg of gtk_adjustment_new() isn't between min and     max, it is automatically corrected by gtk later with     "value_changed" signal. I don't like this, since I want to leave     *variable untouched when `constraint' is false.     The lines below might look oppositely, but this is OK.    */
if|if
condition|(
name|constraint
condition|)
name|constraint_val
operator|=
name|val
expr_stmt|;
else|else
name|constraint_val
operator|=
name|BOUNDS
argument_list|(
name|val
argument_list|,
name|min
argument_list|,
name|max
argument_list|)
expr_stmt|;
name|adjustment
operator|=
name|entscale
operator|->
name|adjustment
operator|=
name|gtk_adjustment_new
argument_list|(
name|constraint_val
argument_list|,
name|min
argument_list|,
name|max
argument_list|,
name|step
argument_list|,
name|step
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|scale
argument_list|,
name|ENTSCALE_SCALE_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_draw_value
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|entry
operator|=
name|entscale
operator|->
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|entry
argument_list|,
name|ENTSCALE_ENTRY_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
name|entscale
operator|->
name|fmt_string
argument_list|,
name|val
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
comment|/* entscale is done */
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|,
name|entscale
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
name|entscale
argument_list|)
expr_stmt|;
comment|/* now ready for signals */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|entscale_entry_update
argument_list|,
name|variable
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|entscale_scale_update
argument_list|,
name|variable
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|entscale_destroy_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* start packing */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|scale
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
name|x
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|x
operator|+
literal|2
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|entscale_get_precision (gdouble step)
name|entscale_get_precision
parameter_list|(
name|gdouble
name|step
parameter_list|)
block|{
name|int
name|precision
decl_stmt|;
if|if
condition|(
name|step
operator|<=
literal|0
condition|)
return|return
literal|0
return|;
for|for
control|(
name|precision
operator|=
literal|0
init|;
name|pow
argument_list|(
literal|0.1
argument_list|,
name|precision
argument_list|)
operator|>
name|step
condition|;
name|precision
operator|++
control|)
empty_stmt|;
return|return
name|precision
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|entscale_destroy_callback (GtkWidget * widget,gpointer data)
name|entscale_destroy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|Entscale
modifier|*
name|entscale
decl_stmt|;
name|entscale
operator|=
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|entscale
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|entscale_scale_update (GtkAdjustment * adjustment,gpointer data)
name|entscale_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|Entscale
modifier|*
name|entscale
decl_stmt|;
name|GtkEntry
modifier|*
name|entry
decl_stmt|;
name|gchar
name|buffer
index|[
literal|256
index|]
decl_stmt|;
name|gdouble
name|old_val
decl_stmt|,
name|new_val
decl_stmt|;
name|entscale
operator|=
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|new_val
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
comment|/* adjustmet->value is always constrainted */
switch|switch
condition|(
name|entscale
operator|->
name|type
condition|)
block|{
case|case
name|ENTSCALE_INT
case|:
name|old_val
operator|=
operator|*
operator|(
name|gint
operator|*
operator|)
name|data
expr_stmt|;
operator|*
operator|(
name|gint
operator|*
operator|)
name|data
operator|=
operator|(
name|gint
operator|)
name|new_val
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"entscale_scale_update(int): fmt=\"%s\" old=%g new=%g\n"
operator|,
name|entscale
operator|->
name|fmt_string
operator|,
name|old_val
operator|,
name|new_val
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ENTSCALE_DOUBLE
case|:
name|old_val
operator|=
operator|*
operator|(
name|gdouble
operator|*
operator|)
name|data
expr_stmt|;
operator|*
operator|(
name|gdouble
operator|*
operator|)
name|data
operator|=
name|new_val
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"entscale_scale_update(double): fmt=\"%s\" old=%g new=%g\n"
operator|,
name|entscale
operator|->
name|fmt_string
operator|,
name|old_val
operator|,
name|new_val
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"entscale_scale_update: invalid type"
argument_list|)
expr_stmt|;
return|return;
block|}
name|entry
operator|=
name|GTK_ENTRY
argument_list|(
name|entscale
operator|->
name|entry
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
name|entscale
operator|->
name|fmt_string
argument_list|,
name|new_val
argument_list|)
expr_stmt|;
comment|/* avoid infinite loop (scale, entry, scale, entry ...) */
name|gtk_signal_handler_block_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|entry
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|entscale
operator|->
name|callback
operator|&&
operator|(
name|old_val
operator|!=
name|new_val
operator|)
condition|)
call|(
modifier|*
name|entscale
operator|->
name|callback
call|)
argument_list|(
name|new_val
argument_list|,
name|entscale
operator|->
name|call_data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|entscale_entry_update (GtkWidget * widget,gpointer data)
name|entscale_entry_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|Entscale
modifier|*
name|entscale
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|gdouble
name|old_val
decl_stmt|,
name|val
decl_stmt|,
name|new_val
decl_stmt|,
name|constraint_val
decl_stmt|;
name|entscale
operator|=
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|entscale
operator|->
name|adjustment
argument_list|)
expr_stmt|;
name|val
operator|=
name|atof
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|constraint_val
operator|=
name|BOUNDS
argument_list|(
name|val
argument_list|,
name|adjustment
operator|->
name|lower
argument_list|,
name|adjustment
operator|->
name|upper
argument_list|)
expr_stmt|;
if|if
condition|(
name|entscale
operator|->
name|constraint
condition|)
name|new_val
operator|=
name|constraint_val
expr_stmt|;
else|else
name|new_val
operator|=
name|val
expr_stmt|;
switch|switch
condition|(
name|entscale
operator|->
name|type
condition|)
block|{
case|case
name|ENTSCALE_INT
case|:
name|old_val
operator|=
operator|*
operator|(
name|gint
operator|*
operator|)
name|data
expr_stmt|;
operator|*
operator|(
name|gint
operator|*
operator|)
name|data
operator|=
operator|(
name|gint
operator|)
name|new_val
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"entscale_entry_update(int): old=%g new=%g const=%g\n"
operator|,
name|old_val
operator|,
name|new_val
operator|,
name|constraint_val
operator|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ENTSCALE_DOUBLE
case|:
name|old_val
operator|=
operator|*
operator|(
name|gdouble
operator|*
operator|)
name|data
expr_stmt|;
operator|*
operator|(
name|gdouble
operator|*
operator|)
name|data
operator|=
name|new_val
expr_stmt|;
name|DEBUG_PRINT
argument_list|(
operator|(
literal|"entscale_entry_update(double): old=%g new=%g const=%g\n"
operator|,
name|old_val
operator|,
name|new_val
operator|,
name|constraint_val
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"entscale_entry_update: invalid type"
argument_list|)
expr_stmt|;
return|return;
block|}
name|adjustment
operator|->
name|value
operator|=
name|constraint_val
expr_stmt|;
comment|/* avoid infinite loop (scale, entry, scale, entry ...) */
name|gtk_signal_handler_block_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|gtk_signal_emit_by_name
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|entscale
operator|->
name|callback
operator|&&
operator|(
name|old_val
operator|!=
name|new_val
operator|)
condition|)
call|(
modifier|*
name|entscale
operator|->
name|callback
call|)
argument_list|(
name|new_val
argument_list|,
name|entscale
operator|->
name|call_data
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/**			+++ Miscellaneous				**/
end_comment

begin_comment
comment|/**									**/
end_comment

begin_comment
comment|/*************************************************************************/
end_comment

begin_comment
comment|/*   These query box functions are yanked from app/interface.c.	taka  */
end_comment

begin_comment
comment|/*  *  A text string query box  */
end_comment

begin_typedef
DECL|typedef|QueryBox
typedef|typedef
name|struct
name|_QueryBox
name|QueryBox
typedef|;
end_typedef

begin_struct
DECL|struct|_QueryBox
struct|struct
name|_QueryBox
block|{
DECL|member|qbox
name|GtkWidget
modifier|*
name|qbox
decl_stmt|;
DECL|member|entry
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
DECL|member|callback
name|QueryFunc
name|callback
decl_stmt|;
DECL|member|data
name|gpointer
name|data
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|void
name|query_box_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|query_box_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|GtkWidget
modifier|*
DECL|function|query_string_box (char * title,char * message,char * initial,QueryFunc callback,gpointer data)
name|query_string_box
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|char
modifier|*
name|message
parameter_list|,
name|char
modifier|*
name|initial
parameter_list|,
name|QueryFunc
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|GtkWidget
modifier|*
name|qbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|query_box
operator|=
operator|(
name|QueryBox
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|QueryBox
argument_list|)
argument_list|)
expr_stmt|;
name|qbox
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|qbox
argument_list|)
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|qbox
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|qbox
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"OK"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|query_box_ok_callback
argument_list|,
name|query_box
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|qbox
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Cancel"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|query_box_cancel_callback
argument_list|,
name|query_box
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|qbox
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|qbox
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|initial
condition|)
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|initial
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|query_box
operator|->
name|qbox
operator|=
name|qbox
expr_stmt|;
name|query_box
operator|->
name|entry
operator|=
name|entry
expr_stmt|;
name|query_box
operator|->
name|callback
operator|=
name|callback
expr_stmt|;
name|query_box
operator|->
name|data
operator|=
name|data
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|qbox
argument_list|)
expr_stmt|;
return|return
name|qbox
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|query_box_cancel_callback (GtkWidget * w,gpointer client_data)
name|query_box_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|query_box
operator|=
operator|(
name|QueryBox
operator|*
operator|)
name|client_data
expr_stmt|;
comment|/*  Destroy the box  */
name|gtk_widget_destroy
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|query_box_ok_callback (GtkWidget * w,gpointer client_data)
name|query_box_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|QueryBox
modifier|*
name|query_box
decl_stmt|;
name|char
modifier|*
name|string
decl_stmt|;
name|query_box
operator|=
operator|(
name|QueryBox
operator|*
operator|)
name|client_data
expr_stmt|;
comment|/*  Get the entry data  */
name|string
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|query_box
operator|->
name|entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Call the user defined callback  */
call|(
modifier|*
name|query_box
operator|->
name|callback
call|)
argument_list|(
name|w
argument_list|,
name|query_box
operator|->
name|data
argument_list|,
operator|(
name|gpointer
operator|)
name|string
argument_list|)
expr_stmt|;
comment|/*  Destroy the box  */
name|gtk_widget_destroy
argument_list|(
name|query_box
operator|->
name|qbox
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

