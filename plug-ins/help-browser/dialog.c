begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * GIMP Help Browser  * Copyright (C) 1999-2008 Sven Neumann<sven@gimp.org>  *                         Michael Natterer<mitch@gimp.org>  *  * dialog.c  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_include
include|#
directive|include
file|<glib/gstdio.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<webkit/webkit.h>
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimp.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpui.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_include
include|#
directive|include
file|"libgimpbase/gimpwin32-io.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"plug-ins/help/gimphelp.h"
end_include

begin_include
include|#
directive|include
file|"gimpthrobber.h"
end_include

begin_include
include|#
directive|include
file|"gimpthrobberaction.h"
end_include

begin_include
include|#
directive|include
file|"dialog.h"
end_include

begin_include
include|#
directive|include
file|"uri.h"
end_include

begin_include
include|#
directive|include
file|"logo-pixbuf.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|_O_BINARY
end_ifndef

begin_define
DECL|macro|_O_BINARY
define|#
directive|define
name|_O_BINARY
value|0
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|GIMP_HELP_BROWSER_DIALOG_DATA
define|#
directive|define
name|GIMP_HELP_BROWSER_DIALOG_DATA
value|"gimp-help-browser-dialog"
end_define

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon29308ccd0108
block|{
DECL|member|width
name|gint
name|width
decl_stmt|;
DECL|member|height
name|gint
name|height
decl_stmt|;
DECL|member|paned_position
name|gint
name|paned_position
decl_stmt|;
DECL|member|zoom
name|gdouble
name|zoom
decl_stmt|;
DECL|typedef|DialogData
block|}
name|DialogData
typedef|;
end_typedef

begin_enum
enum|enum
DECL|enum|__anon29308ccd0203
block|{
DECL|enumerator|HISTORY_TITLE
name|HISTORY_TITLE
block|,
DECL|enumerator|HISTORY_URI
name|HISTORY_URI
block|}
enum|;
end_enum

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|GtkUIManager
modifier|*
name|ui_manager_new
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|back_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|forward_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|reload_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|stop_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|index_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|zoom_in_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|zoom_out_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|close_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|website_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|copy_location_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|update_actions
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|row_activated
parameter_list|(
name|GtkTreeView
modifier|*
name|tree_view
parameter_list|,
name|GtkTreePath
modifier|*
name|path
parameter_list|,
name|GtkTreeViewColumn
modifier|*
name|column
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dialog_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|,
name|GtkWidget
modifier|*
name|paned
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|view_realize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|view_unrealize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|view_popup_menu
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|view_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|title_changed
parameter_list|(
name|GtkWidget
modifier|*
name|view
parameter_list|,
name|WebKitWebFrame
modifier|*
name|frame
parameter_list|,
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|window
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|load_started
parameter_list|(
name|GtkWidget
modifier|*
name|view
parameter_list|,
name|WebKitWebFrame
modifier|*
name|frame
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|load_finished
parameter_list|(
name|GtkWidget
modifier|*
name|view
parameter_list|,
name|WebKitWebFrame
modifier|*
name|frame
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|select_index
parameter_list|(
specifier|const
name|gchar
modifier|*
name|uri
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  private variables  */
end_comment

begin_decl_stmt
DECL|variable|uri_hash_table
specifier|static
name|GHashTable
modifier|*
name|uri_hash_table
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|view
specifier|static
name|GtkWidget
modifier|*
name|view
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tree_view
specifier|static
name|GtkWidget
modifier|*
name|tree_view
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|ui_manager
specifier|static
name|GtkUIManager
modifier|*
name|ui_manager
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|button_prev
specifier|static
name|GtkWidget
modifier|*
name|button_prev
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|button_next
specifier|static
name|GtkWidget
modifier|*
name|button_next
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|busy_cursor
specifier|static
name|GdkCursor
modifier|*
name|busy_cursor
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  public functions  */
end_comment

begin_function
name|void
DECL|function|browser_dialog_open (void)
name|browser_dialog_open
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|window
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|toolbar
decl_stmt|;
name|GtkWidget
modifier|*
name|paned
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkToolItem
modifier|*
name|item
decl_stmt|;
name|GtkAction
modifier|*
name|action
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|DialogData
name|data
init|=
block|{
literal|720
block|,
literal|560
block|,
literal|240
block|,
literal|1.0
block|}
decl_stmt|;
name|gimp_ui_init
argument_list|(
literal|"helpbrowser"
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_get_data
argument_list|(
name|GIMP_HELP_BROWSER_DIALOG_DATA
argument_list|,
operator|&
name|data
argument_list|)
expr_stmt|;
comment|/*  the dialog window  */
name|window
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_TOPLEVEL
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP Help Browser"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_set_role
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"help-browser"
argument_list|)
expr_stmt|;
name|gtk_window_set_default_size
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|data
operator|.
name|width
argument_list|,
name|data
operator|.
name|height
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_main_quit
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_new_from_inline
argument_list|(
operator|-
literal|1
argument_list|,
name|logo_data
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_window_set_icon
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|pixbuf
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|window
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|ui_manager
operator|=
name|ui_manager_new
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|toolbar
operator|=
name|gtk_ui_manager_get_widget
argument_list|(
name|ui_manager
argument_list|,
literal|"/help-browser-toolbar"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|toolbar
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toolbar
argument_list|)
expr_stmt|;
name|item
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_MENU_TOOL_BUTTON
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_toolbar_insert
argument_list|(
name|GTK_TOOLBAR
argument_list|(
name|toolbar
argument_list|)
argument_list|,
name|item
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|GTK_WIDGET
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|=
name|gtk_ui_manager_get_action
argument_list|(
name|ui_manager
argument_list|,
literal|"/ui/help-browser-popup/forward"
argument_list|)
expr_stmt|;
name|gtk_action_connect_proxy
argument_list|(
name|action
argument_list|,
name|GTK_WIDGET
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|action
argument_list|)
argument_list|,
literal|"tooltip"
argument_list|)
expr_stmt|;
name|button_next
operator|=
name|GTK_WIDGET
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_MENU_TOOL_BUTTON
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_toolbar_insert
argument_list|(
name|GTK_TOOLBAR
argument_list|(
name|toolbar
argument_list|)
argument_list|,
name|item
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|GTK_WIDGET
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|=
name|gtk_ui_manager_get_action
argument_list|(
name|ui_manager
argument_list|,
literal|"/ui/help-browser-popup/back"
argument_list|)
expr_stmt|;
name|gtk_action_connect_proxy
argument_list|(
name|action
argument_list|,
name|GTK_WIDGET
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|action
argument_list|)
argument_list|,
literal|"tooltip"
argument_list|)
expr_stmt|;
name|button_prev
operator|=
name|GTK_WIDGET
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|=
name|GTK_TOOL_ITEM
argument_list|(
name|gtk_ui_manager_get_widget
argument_list|(
name|ui_manager
argument_list|,
literal|"/help-browser-toolbar/space"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_separator_tool_item_set_draw
argument_list|(
name|GTK_SEPARATOR_TOOL_ITEM
argument_list|(
name|item
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_tool_item_set_expand
argument_list|(
name|item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_ui_manager_get_widget
argument_list|(
name|ui_manager
argument_list|,
literal|"/help-browser-toolbar/website"
argument_list|)
expr_stmt|;
name|gimp_throbber_set_image
argument_list|(
name|GIMP_THROBBER
argument_list|(
name|button
argument_list|)
argument_list|,
name|gtk_image_new_from_pixbuf
argument_list|(
name|pixbuf
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  the horizontal paned  */
name|paned
operator|=
name|gtk_hpaned_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|paned
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|paned
argument_list|)
expr_stmt|;
name|scrolled
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_paned_add1
argument_list|(
name|GTK_PANED
argument_list|(
name|paned
argument_list|)
argument_list|,
name|scrolled
argument_list|)
expr_stmt|;
name|gtk_paned_set_position
argument_list|(
name|GTK_PANED
argument_list|(
name|paned
argument_list|)
argument_list|,
name|data
operator|.
name|paned_position
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled
argument_list|)
expr_stmt|;
name|tree_view
operator|=
name|gtk_tree_view_new
argument_list|()
expr_stmt|;
name|gtk_tree_view_set_headers_visible
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled
argument_list|)
argument_list|,
name|tree_view
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|tree_view
argument_list|)
expr_stmt|;
name|gtk_tree_view_insert_column_with_attributes
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|,
name|gtk_cell_renderer_text_new
argument_list|()
argument_list|,
literal|"text"
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|tree_view
argument_list|,
literal|"row-activated"
argument_list|,
name|G_CALLBACK
argument_list|(
name|row_activated
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  HTML view  */
name|scrolled
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|scrolled
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|gtk_paned_add2
argument_list|(
name|GTK_PANED
argument_list|(
name|paned
argument_list|)
argument_list|,
name|scrolled
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled
argument_list|)
expr_stmt|;
name|view
operator|=
name|webkit_web_view_new
argument_list|()
expr_stmt|;
name|webkit_web_view_set_maintains_back_forward_list
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled
argument_list|)
argument_list|,
name|view
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|view
argument_list|,
literal|"realize"
argument_list|,
name|G_CALLBACK
argument_list|(
name|view_realize
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|view
argument_list|,
literal|"unrealize"
argument_list|,
name|G_CALLBACK
argument_list|(
name|view_unrealize
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|view
argument_list|,
literal|"popup-menu"
argument_list|,
name|G_CALLBACK
argument_list|(
name|view_popup_menu
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|view
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|view_button_press
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|#
directive|if
name|HAVE_WEBKIT_ZOOM_API
name|webkit_web_view_set_zoom_level
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|,
name|data
operator|.
name|zoom
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|g_signal_connect
argument_list|(
name|view
argument_list|,
literal|"title-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|title_changed
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|view
argument_list|,
literal|"load-started"
argument_list|,
name|G_CALLBACK
argument_list|(
name|load_started
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|view
argument_list|,
literal|"load-finished"
argument_list|,
name|G_CALLBACK
argument_list|(
name|load_finished
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"unmap"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_unmap
argument_list|)
argument_list|,
name|paned
argument_list|)
expr_stmt|;
name|update_actions
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|browser_dialog_load (const gchar * uri)
name|browser_dialog_load
parameter_list|(
specifier|const
name|gchar
modifier|*
name|uri
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|uri
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|webkit_web_view_open
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|,
name|uri
argument_list|)
expr_stmt|;
name|select_index
argument_list|(
name|uri
argument_list|)
expr_stmt|;
name|gtk_window_present
argument_list|(
name|GTK_WINDOW
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|view
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|browser_dialog_make_index_foreach (const gchar * help_id,GimpHelpItem * item,GimpHelpLocale * locale)
name|browser_dialog_make_index_foreach
parameter_list|(
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
name|GimpHelpItem
modifier|*
name|item
parameter_list|,
name|GimpHelpLocale
modifier|*
name|locale
parameter_list|)
block|{
if|#
directive|if
literal|0
block|g_printerr ("%s: processing %s (parent %s)\n",               G_STRFUNC,               item->title  ? item->title  : "NULL",               item->parent ? item->parent : "NULL");
endif|#
directive|endif
if|if
condition|(
name|item
operator|->
name|title
condition|)
block|{
name|gchar
modifier|*
modifier|*
name|indices
init|=
name|g_strsplit
argument_list|(
name|item
operator|->
name|title
argument_list|,
literal|"."
argument_list|,
operator|-
literal|1
argument_list|)
decl_stmt|;
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|indices
index|[
name|i
index|]
condition|)
break|break;
name|item
operator|->
name|index
operator|+=
name|atoi
argument_list|(
name|indices
index|[
name|i
index|]
argument_list|)
operator|<<
operator|(
literal|8
operator|*
operator|(
literal|5
operator|-
name|i
operator|)
operator|)
expr_stmt|;
block|}
name|g_strfreev
argument_list|(
name|indices
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|item
operator|->
name|parent
operator|&&
name|strlen
argument_list|(
name|item
operator|->
name|parent
argument_list|)
condition|)
block|{
name|GimpHelpItem
modifier|*
name|parent
decl_stmt|;
name|parent
operator|=
name|g_hash_table_lookup
argument_list|(
name|locale
operator|->
name|help_id_mapping
argument_list|,
name|item
operator|->
name|parent
argument_list|)
expr_stmt|;
if|if
condition|(
name|parent
condition|)
name|parent
operator|->
name|children
operator|=
name|g_list_prepend
argument_list|(
name|parent
operator|->
name|children
argument_list|,
name|item
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|locale
operator|->
name|toplevel_items
operator|=
name|g_list_prepend
argument_list|(
name|locale
operator|->
name|toplevel_items
argument_list|,
name|item
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|help_item_compare (gconstpointer a,gconstpointer b)
name|help_item_compare
parameter_list|(
name|gconstpointer
name|a
parameter_list|,
name|gconstpointer
name|b
parameter_list|)
block|{
name|GimpHelpItem
modifier|*
name|item_a
init|=
operator|(
name|GimpHelpItem
operator|*
operator|)
name|a
decl_stmt|;
name|GimpHelpItem
modifier|*
name|item_b
init|=
operator|(
name|GimpHelpItem
operator|*
operator|)
name|b
decl_stmt|;
if|if
condition|(
name|item_a
operator|->
name|index
operator|>
name|item_b
operator|->
name|index
condition|)
return|return
literal|1
return|;
elseif|else
if|if
condition|(
name|item_a
operator|->
name|index
operator|<
name|item_b
operator|->
name|index
condition|)
return|return
operator|-
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|add_child (GtkTreeStore * store,GimpHelpDomain * domain,GimpHelpLocale * locale,GtkTreeIter * parent,GimpHelpItem * item)
name|add_child
parameter_list|(
name|GtkTreeStore
modifier|*
name|store
parameter_list|,
name|GimpHelpDomain
modifier|*
name|domain
parameter_list|,
name|GimpHelpLocale
modifier|*
name|locale
parameter_list|,
name|GtkTreeIter
modifier|*
name|parent
parameter_list|,
name|GimpHelpItem
modifier|*
name|item
parameter_list|)
block|{
name|GtkTreeIter
name|iter
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
name|uri
decl_stmt|;
name|gtk_tree_store_append
argument_list|(
name|store
argument_list|,
operator|&
name|iter
argument_list|,
name|parent
argument_list|)
expr_stmt|;
name|gtk_tree_store_set
argument_list|(
name|store
argument_list|,
operator|&
name|iter
argument_list|,
literal|0
argument_list|,
name|item
argument_list|,
literal|1
argument_list|,
name|item
operator|->
name|title
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|uri
operator|=
name|g_strconcat
argument_list|(
name|domain
operator|->
name|help_uri
argument_list|,
literal|"/"
argument_list|,
name|locale
operator|->
name|locale_id
argument_list|,
literal|"/"
argument_list|,
name|item
operator|->
name|ref
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_hash_table_insert
argument_list|(
name|uri_hash_table
argument_list|,
name|uri
argument_list|,
name|gtk_tree_iter_copy
argument_list|(
operator|&
name|iter
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|children
operator|=
name|g_list_sort
argument_list|(
name|item
operator|->
name|children
argument_list|,
name|help_item_compare
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|item
operator|->
name|children
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpHelpItem
modifier|*
name|item
init|=
name|list
operator|->
name|data
decl_stmt|;
name|add_child
argument_list|(
name|store
argument_list|,
name|domain
argument_list|,
name|locale
argument_list|,
operator|&
name|iter
argument_list|,
name|item
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|browser_dialog_make_index (GimpHelpDomain * domain,GimpHelpLocale * locale)
name|browser_dialog_make_index
parameter_list|(
name|GimpHelpDomain
modifier|*
name|domain
parameter_list|,
name|GimpHelpLocale
modifier|*
name|locale
parameter_list|)
block|{
name|GtkTreeStore
modifier|*
name|store
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
if|if
condition|(
operator|!
name|locale
operator|->
name|toplevel_items
condition|)
block|{
name|g_hash_table_foreach
argument_list|(
name|locale
operator|->
name|help_id_mapping
argument_list|,
operator|(
name|GHFunc
operator|)
name|browser_dialog_make_index_foreach
argument_list|,
name|locale
argument_list|)
expr_stmt|;
name|locale
operator|->
name|toplevel_items
operator|=
name|g_list_sort
argument_list|(
name|locale
operator|->
name|toplevel_items
argument_list|,
name|help_item_compare
argument_list|)
expr_stmt|;
block|}
name|store
operator|=
name|gtk_tree_store_new
argument_list|(
literal|2
argument_list|,
name|G_TYPE_POINTER
argument_list|,
name|G_TYPE_STRING
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|store
argument_list|)
argument_list|,
literal|"domain"
argument_list|,
name|domain
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|store
argument_list|)
argument_list|,
literal|"locale"
argument_list|,
name|locale
argument_list|)
expr_stmt|;
if|if
condition|(
name|uri_hash_table
condition|)
name|g_hash_table_unref
argument_list|(
name|uri_hash_table
argument_list|)
expr_stmt|;
name|uri_hash_table
operator|=
name|g_hash_table_new_full
argument_list|(
name|g_str_hash
argument_list|,
name|g_str_equal
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|g_free
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|gtk_tree_iter_free
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|locale
operator|->
name|toplevel_items
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpHelpItem
modifier|*
name|item
init|=
name|list
operator|->
name|data
decl_stmt|;
name|add_child
argument_list|(
name|store
argument_list|,
name|domain
argument_list|,
name|locale
argument_list|,
name|NULL
argument_list|,
name|item
argument_list|)
expr_stmt|;
block|}
name|gtk_tree_view_set_model
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|,
name|GTK_TREE_MODEL
argument_list|(
name|store
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|store
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|select_index (const gchar * uri)
name|select_index
parameter_list|(
specifier|const
name|gchar
modifier|*
name|uri
parameter_list|)
block|{
name|GtkTreeSelection
modifier|*
name|selection
decl_stmt|;
name|GtkTreeIter
modifier|*
name|iter
decl_stmt|;
name|selection
operator|=
name|gtk_tree_view_get_selection
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|)
expr_stmt|;
name|iter
operator|=
name|g_hash_table_lookup
argument_list|(
name|uri_hash_table
argument_list|,
name|uri
argument_list|)
expr_stmt|;
if|if
condition|(
name|iter
condition|)
block|{
name|GtkTreeModel
modifier|*
name|model
init|=
name|gtk_tree_view_get_model
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|)
decl_stmt|;
name|GtkTreePath
modifier|*
name|path
decl_stmt|;
name|GtkTreePath
modifier|*
name|scroll_path
decl_stmt|;
name|path
operator|=
name|gtk_tree_model_get_path
argument_list|(
name|model
argument_list|,
name|iter
argument_list|)
expr_stmt|;
name|scroll_path
operator|=
name|gtk_tree_path_copy
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|gtk_tree_path_up
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|gtk_tree_view_expand_to_path
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|gtk_tree_view_scroll_to_cell
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|,
name|scroll_path
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_tree_path_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|gtk_tree_path_free
argument_list|(
name|scroll_path
argument_list|)
expr_stmt|;
name|gtk_tree_selection_select_iter
argument_list|(
name|selection
argument_list|,
name|iter
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_tree_selection_unselect_all
argument_list|(
name|selection
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  private functions  */
end_comment

begin_function
specifier|static
name|GtkUIManager
modifier|*
DECL|function|ui_manager_new (GtkWidget * window)
name|ui_manager_new
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|)
block|{
specifier|static
specifier|const
name|GtkActionEntry
name|actions
index|[]
init|=
block|{
block|{
literal|"back"
block|,
name|GTK_STOCK_GO_BACK
block|,
name|NULL
block|,
literal|"<alt>Left"
block|,
name|N_
argument_list|(
literal|"Go back one page"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|back_callback
argument_list|)
block|}
block|,
block|{
literal|"forward"
block|,
name|GTK_STOCK_GO_FORWARD
block|,
name|NULL
block|,
literal|"<alt>Right"
block|,
name|N_
argument_list|(
literal|"Go forward one page"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|forward_callback
argument_list|)
block|}
block|,
block|{
literal|"reload"
block|,
name|GTK_STOCK_REFRESH
block|,
name|N_
argument_list|(
literal|"Reload"
argument_list|)
block|,
literal|"<control>R"
block|,
name|N_
argument_list|(
literal|"Reload current page"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|reload_callback
argument_list|)
block|}
block|,
block|{
literal|"stop"
block|,
name|GTK_STOCK_CANCEL
block|,
name|N_
argument_list|(
literal|"Stop"
argument_list|)
block|,
literal|"Escape"
block|,
name|N_
argument_list|(
literal|"Stop loading this page"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|stop_callback
argument_list|)
block|}
block|,
block|{
literal|"index"
block|,
name|GTK_STOCK_INDEX
block|,
name|NULL
block|,
literal|"<alt>Home"
block|,
name|N_
argument_list|(
literal|"Go to the index page"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|index_callback
argument_list|)
block|}
block|,
block|{
literal|"copy-location"
block|,
name|GTK_STOCK_COPY
block|,
name|N_
argument_list|(
literal|"Copy location"
argument_list|)
block|,
literal|""
block|,
name|N_
argument_list|(
literal|"Copy the location of this page to the clipboard"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|copy_location_callback
argument_list|)
block|}
block|,
block|{
literal|"zoom-in"
block|,
name|GTK_STOCK_ZOOM_IN
block|,
name|NULL
block|,
literal|"<control>plus"
block|,
name|NULL
block|,
name|G_CALLBACK
argument_list|(
argument|zoom_in_callback
argument_list|)
block|}
block|,
block|{
literal|"zoom-out"
block|,
name|GTK_STOCK_ZOOM_OUT
block|,
name|NULL
block|,
literal|"<control>minus"
block|,
name|NULL
block|,
name|G_CALLBACK
argument_list|(
argument|zoom_out_callback
argument_list|)
block|}
block|,
block|{
literal|"close"
block|,
name|GTK_STOCK_CLOSE
block|,
name|NULL
block|,
literal|"<control>W"
block|,
name|NULL
block|,
name|G_CALLBACK
argument_list|(
argument|close_callback
argument_list|)
block|}
block|,
block|{
literal|"quit"
block|,
name|GTK_STOCK_QUIT
block|,
name|NULL
block|,
literal|"<control>Q"
block|,
name|NULL
block|,
name|G_CALLBACK
argument_list|(
argument|close_callback
argument_list|)
block|}
block|}
decl_stmt|;
name|GtkUIManager
modifier|*
name|ui_manager
init|=
name|gtk_ui_manager_new
argument_list|()
decl_stmt|;
name|GtkActionGroup
modifier|*
name|group
init|=
name|gtk_action_group_new
argument_list|(
literal|"Actions"
argument_list|)
decl_stmt|;
name|GtkAction
modifier|*
name|action
decl_stmt|;
name|GError
modifier|*
name|error
init|=
name|NULL
decl_stmt|;
name|gtk_action_group_set_translation_domain
argument_list|(
name|group
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_action_group_add_actions
argument_list|(
name|group
argument_list|,
name|actions
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|actions
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|action
operator|=
name|gimp_throbber_action_new
argument_list|(
literal|"website"
argument_list|,
literal|"docs.gimp.org"
argument_list|,
name|_
argument_list|(
literal|"Visit the GIMP documentation website"
argument_list|)
argument_list|,
name|GIMP_STOCK_WILBER
argument_list|)
expr_stmt|;
name|g_signal_connect_closure
argument_list|(
name|action
argument_list|,
literal|"activate"
argument_list|,
name|g_cclosure_new
argument_list|(
name|G_CALLBACK
argument_list|(
name|website_callback
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_action_group_add_action
argument_list|(
name|group
argument_list|,
name|action
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|action
argument_list|)
expr_stmt|;
name|gtk_window_add_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|gtk_ui_manager_get_accel_group
argument_list|(
name|ui_manager
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_accel_group_lock
argument_list|(
name|gtk_ui_manager_get_accel_group
argument_list|(
name|ui_manager
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_ui_manager_insert_action_group
argument_list|(
name|ui_manager
argument_list|,
name|group
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|gtk_ui_manager_add_ui_from_string
argument_list|(
name|ui_manager
argument_list|,
literal|"<ui>"
literal|"<toolbar name=\"help-browser-toolbar\">"
literal|"<toolitem action=\"reload\" />"
literal|"<toolitem action=\"stop\" />"
literal|"<toolitem action=\"index\" />"
literal|"<separator name=\"space\" />"
literal|"<toolitem action=\"website\" />"
literal|"</toolbar>"
literal|"<accelerator action=\"close\" />"
literal|"<accelerator action=\"quit\" />"
literal|"</ui>"
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
block|{
name|g_warning
argument_list|(
literal|"error parsing ui: %s"
argument_list|,
name|error
operator|->
name|message
argument_list|)
expr_stmt|;
name|g_clear_error
argument_list|(
operator|&
name|error
argument_list|)
expr_stmt|;
block|}
name|gtk_ui_manager_add_ui_from_string
argument_list|(
name|ui_manager
argument_list|,
literal|"<ui>"
literal|"<popup name=\"help-browser-popup\">"
literal|"<menuitem action=\"back\" />"
literal|"<menuitem action=\"forward\" />"
literal|"<menuitem action=\"reload\" />"
literal|"<menuitem action=\"stop\" />"
literal|"<separator />"
literal|"<menuitem action=\"index\" />"
literal|"<menuitem action=\"copy-location\" />"
ifdef|#
directive|ifdef
name|HAVE_WEBKIT_ZOOM_API
literal|"<separator />"
literal|"<menuitem action=\"zoom-in\" />"
literal|"<menuitem action=\"zoom-out\" />"
endif|#
directive|endif
literal|"<separator />"
literal|"<menuitem action=\"close\" />"
literal|"</popup>"
literal|"</ui>"
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
block|{
name|g_warning
argument_list|(
literal|"error parsing ui: %s"
argument_list|,
name|error
operator|->
name|message
argument_list|)
expr_stmt|;
name|g_clear_error
argument_list|(
operator|&
name|error
argument_list|)
expr_stmt|;
block|}
return|return
name|ui_manager
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|back_callback (GtkAction * action,gpointer data)
name|back_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|webkit_web_view_go_back
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|forward_callback (GtkAction * action,gpointer data)
name|forward_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|webkit_web_view_go_forward
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|reload_callback (GtkAction * action,gpointer data)
name|reload_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|webkit_web_view_reload
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|stop_callback (GtkAction * action,gpointer data)
name|stop_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|webkit_web_view_stop_loading
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|index_callback (GtkAction * action,gpointer data)
name|index_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkTreeModel
modifier|*
name|model
init|=
name|gtk_tree_view_get_model
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tree_view
argument_list|)
argument_list|)
decl_stmt|;
name|GimpHelpDomain
modifier|*
name|domain
init|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|model
argument_list|)
argument_list|,
literal|"domain"
argument_list|)
decl_stmt|;
name|GimpHelpLocale
modifier|*
name|locale
init|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|model
argument_list|)
argument_list|,
literal|"locale"
argument_list|)
decl_stmt|;
if|if
condition|(
name|domain
operator|&&
name|locale
condition|)
block|{
name|gchar
modifier|*
name|uri
init|=
name|g_strconcat
argument_list|(
name|domain
operator|->
name|help_uri
argument_list|,
literal|"/"
argument_list|,
name|locale
operator|->
name|locale_id
argument_list|,
literal|"/"
argument_list|,
name|gimp_help_locale_map
argument_list|(
name|locale
argument_list|,
name|GIMP_HELP_DEFAULT_ID
argument_list|)
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|browser_dialog_load
argument_list|(
name|uri
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|copy_location_callback (GtkAction * action,gpointer data)
name|copy_location_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|WebKitWebFrame
modifier|*
name|frame
init|=
name|webkit_web_view_get_main_frame
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|uri
decl_stmt|;
name|uri
operator|=
name|webkit_web_frame_get_uri
argument_list|(
name|frame
argument_list|)
expr_stmt|;
if|if
condition|(
name|uri
condition|)
block|{
name|GtkClipboard
modifier|*
name|clipboard
decl_stmt|;
name|clipboard
operator|=
name|gtk_clipboard_get_for_display
argument_list|(
name|gtk_widget_get_display
argument_list|(
name|view
argument_list|)
argument_list|,
name|GDK_SELECTION_CLIPBOARD
argument_list|)
expr_stmt|;
name|gtk_clipboard_set_text
argument_list|(
name|clipboard
argument_list|,
name|uri
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|zoom_in_callback (GtkAction * action,gpointer data)
name|zoom_in_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_WEBKIT_ZOOM_API
name|webkit_web_view_zoom_in
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|zoom_out_callback (GtkAction * action,gpointer data)
name|zoom_out_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_WEBKIT_ZOOM_API
name|webkit_web_view_zoom_out
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|website_callback (GtkAction * action,gpointer data)
name|website_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|browser_dialog_load
argument_list|(
literal|"http://docs.gimp.org/"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|close_callback (GtkAction * action,gpointer data)
name|close_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|menu_callback (GtkWidget * menu,WebKitWebHistoryItem * item)
name|menu_callback
parameter_list|(
name|GtkWidget
modifier|*
name|menu
parameter_list|,
name|WebKitWebHistoryItem
modifier|*
name|item
parameter_list|)
block|{
name|browser_dialog_load
argument_list|(
name|webkit_web_history_item_get_uri
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  this function unrefs the items and frees the list  */
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|build_menu (GList * list)
name|build_menu
parameter_list|(
name|GList
modifier|*
name|list
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
if|if
condition|(
operator|!
name|list
condition|)
return|return
name|NULL
return|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
do|do
block|{
name|WebKitWebHistoryItem
modifier|*
name|item
init|=
name|list
operator|->
name|data
decl_stmt|;
name|GtkWidget
modifier|*
name|menu_item
decl_stmt|;
name|menu_item
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|webkit_web_history_item_get_title
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_menu_shell_append
argument_list|(
name|GTK_MENU_SHELL
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menu_item
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menu_item
argument_list|)
expr_stmt|;
name|g_signal_connect_object
argument_list|(
name|menu_item
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|menu_callback
argument_list|)
argument_list|,
name|item
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
operator|)
condition|)
do|;
name|g_list_free
argument_list|(
name|list
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|update_actions (void)
name|update_actions
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkAction
modifier|*
name|action
decl_stmt|;
name|WebKitWebBackForwardList
modifier|*
name|back_forward_list
decl_stmt|;
name|WebKitWebFrame
modifier|*
name|frame
decl_stmt|;
name|back_forward_list
operator|=
name|webkit_web_view_get_back_forward_list
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  update the back button and its menu  */
name|action
operator|=
name|gtk_ui_manager_get_action
argument_list|(
name|ui_manager
argument_list|,
literal|"/ui/help-browser-popup/back"
argument_list|)
expr_stmt|;
name|gtk_action_set_sensitive
argument_list|(
name|action
argument_list|,
name|webkit_web_view_can_go_back
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|back_forward_list
condition|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|list
operator|=
name|webkit_web_back_forward_list_get_back_list_with_limit
argument_list|(
name|back_forward_list
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_menu_tool_button_set_menu
argument_list|(
name|GTK_MENU_TOOL_BUTTON
argument_list|(
name|button_prev
argument_list|)
argument_list|,
name|build_menu
argument_list|(
name|list
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_menu_tool_button_set_menu
argument_list|(
name|GTK_MENU_TOOL_BUTTON
argument_list|(
name|button_prev
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
comment|/*  update the forward button and its menu  */
name|action
operator|=
name|gtk_ui_manager_get_action
argument_list|(
name|ui_manager
argument_list|,
literal|"/ui/help-browser-popup/forward"
argument_list|)
expr_stmt|;
name|gtk_action_set_sensitive
argument_list|(
name|action
argument_list|,
name|webkit_web_view_can_go_forward
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|back_forward_list
condition|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|list
operator|=
name|webkit_web_back_forward_list_get_forward_list_with_limit
argument_list|(
name|back_forward_list
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_menu_tool_button_set_menu
argument_list|(
name|GTK_MENU_TOOL_BUTTON
argument_list|(
name|button_next
argument_list|)
argument_list|,
name|build_menu
argument_list|(
name|list
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_menu_tool_button_set_menu
argument_list|(
name|GTK_MENU_TOOL_BUTTON
argument_list|(
name|button_next
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
comment|/*  update the copy-location action  */
name|action
operator|=
name|gtk_ui_manager_get_action
argument_list|(
name|ui_manager
argument_list|,
literal|"/ui/help-browser-popup/copy-location"
argument_list|)
expr_stmt|;
name|frame
operator|=
name|webkit_web_view_get_main_frame
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_action_set_sensitive
argument_list|(
name|action
argument_list|,
name|webkit_web_frame_get_uri
argument_list|(
name|frame
argument_list|)
operator|!=
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|row_activated (GtkTreeView * tree_view,GtkTreePath * path,GtkTreeViewColumn * column)
name|row_activated
parameter_list|(
name|GtkTreeView
modifier|*
name|tree_view
parameter_list|,
name|GtkTreePath
modifier|*
name|path
parameter_list|,
name|GtkTreeViewColumn
modifier|*
name|column
parameter_list|)
block|{
name|GtkTreeModel
modifier|*
name|model
init|=
name|gtk_tree_view_get_model
argument_list|(
name|tree_view
argument_list|)
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|;
name|GimpHelpDomain
modifier|*
name|domain
decl_stmt|;
name|GimpHelpLocale
modifier|*
name|locale
decl_stmt|;
name|GimpHelpItem
modifier|*
name|item
decl_stmt|;
name|gchar
modifier|*
name|uri
decl_stmt|;
name|gtk_tree_model_get_iter
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|gtk_tree_model_get
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|,
literal|0
argument_list|,
operator|&
name|item
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|domain
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|model
argument_list|)
argument_list|,
literal|"domain"
argument_list|)
expr_stmt|;
name|locale
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|model
argument_list|)
argument_list|,
literal|"locale"
argument_list|)
expr_stmt|;
name|uri
operator|=
name|g_strconcat
argument_list|(
name|domain
operator|->
name|help_uri
argument_list|,
literal|"/"
argument_list|,
name|locale
operator|->
name|locale_id
argument_list|,
literal|"/"
argument_list|,
name|item
operator|->
name|ref
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|browser_dialog_load
argument_list|(
name|uri
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dialog_unmap (GtkWidget * window,GtkWidget * paned)
name|dialog_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|,
name|GtkWidget
modifier|*
name|paned
parameter_list|)
block|{
name|DialogData
name|data
decl_stmt|;
name|gtk_window_get_size
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
operator|&
name|data
operator|.
name|width
argument_list|,
operator|&
name|data
operator|.
name|height
argument_list|)
expr_stmt|;
name|data
operator|.
name|paned_position
operator|=
name|gtk_paned_get_position
argument_list|(
name|GTK_PANED
argument_list|(
name|paned
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HAVE_WEBKIT_ZOOM_API
name|data
operator|.
name|zoom
operator|=
operator|(
name|view
condition|?
name|webkit_web_view_get_zoom_level
argument_list|(
name|WEBKIT_WEB_VIEW
argument_list|(
name|view
argument_list|)
argument_list|)
else|:
literal|1.0
operator|)
expr_stmt|;
else|#
directive|else
name|data
operator|.
name|zoom
operator|=
literal|1.0
expr_stmt|;
endif|#
directive|endif
name|gimp_set_data
argument_list|(
name|GIMP_HELP_BROWSER_DIALOG_DATA
argument_list|,
operator|&
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|view_realize (GtkWidget * widget)
name|view_realize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|busy_cursor
operator|==
name|NULL
argument_list|)
expr_stmt|;
name|busy_cursor
operator|=
name|gdk_cursor_new_for_display
argument_list|(
name|gtk_widget_get_display
argument_list|(
name|widget
argument_list|)
argument_list|,
name|GDK_WATCH
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|view_unrealize (GtkWidget * widget)
name|view_unrealize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
if|if
condition|(
name|busy_cursor
condition|)
block|{
name|gdk_cursor_unref
argument_list|(
name|busy_cursor
argument_list|)
expr_stmt|;
name|busy_cursor
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|view_popup_menu (GtkWidget * widget,GdkEventButton * event)
name|view_popup_menu
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
init|=
name|gtk_ui_manager_get_widget
argument_list|(
name|ui_manager
argument_list|,
literal|"/help-browser-popup"
argument_list|)
decl_stmt|;
name|gtk_menu_set_screen
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|gtk_widget_get_screen
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|event
condition|?
name|event
operator|->
name|button
else|:
literal|0
argument_list|,
name|event
condition|?
name|event
operator|->
name|time
else|:
name|gtk_get_current_event_time
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|view_button_press (GtkWidget * widget,GdkEventButton * event)
name|view_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|button
operator|==
literal|3
operator|&&
name|event
operator|->
name|type
operator|==
name|GDK_BUTTON_PRESS
condition|)
return|return
name|view_popup_menu
argument_list|(
name|widget
argument_list|,
name|event
argument_list|)
return|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|title_changed (GtkWidget * view,WebKitWebFrame * frame,const gchar * title,GtkWidget * window)
name|title_changed
parameter_list|(
name|GtkWidget
modifier|*
name|view
parameter_list|,
name|WebKitWebFrame
modifier|*
name|frame
parameter_list|,
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|GtkWidget
modifier|*
name|window
parameter_list|)
block|{
name|gchar
modifier|*
name|full_title
decl_stmt|;
name|full_title
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s - %s"
argument_list|,
name|title
condition|?
name|title
else|:
name|_
argument_list|(
literal|"Untitled"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP Help Browser"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|full_title
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|full_title
argument_list|)
expr_stmt|;
name|update_actions
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|load_started (GtkWidget * view,WebKitWebFrame * frame)
name|load_started
parameter_list|(
name|GtkWidget
modifier|*
name|view
parameter_list|,
name|WebKitWebFrame
modifier|*
name|frame
parameter_list|)
block|{
name|GtkAction
modifier|*
name|action
init|=
name|gtk_ui_manager_get_action
argument_list|(
name|ui_manager
argument_list|,
literal|"/ui/help-browser-popup/stop"
argument_list|)
decl_stmt|;
name|gtk_action_set_sensitive
argument_list|(
name|action
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|load_finished (GtkWidget * view,WebKitWebFrame * frame)
name|load_finished
parameter_list|(
name|GtkWidget
modifier|*
name|view
parameter_list|,
name|WebKitWebFrame
modifier|*
name|frame
parameter_list|)
block|{
name|GtkAction
modifier|*
name|action
init|=
name|gtk_ui_manager_get_action
argument_list|(
name|ui_manager
argument_list|,
literal|"/ui/help-browser-popup/stop"
argument_list|)
decl_stmt|;
name|gtk_action_set_sensitive
argument_list|(
name|action
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|update_actions
argument_list|()
expr_stmt|;
block|}
end_function

end_unit

