begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * "$Id$"  *  *   Print plug-in HP PCL driver for the GIMP.  *  *   Copyright 1997-2000 Michael Sweet (mike@easysw.com),  *	Robert Krawitz (rlk@alum.mit.edu) and  *      Dave Hill (dave@minnie.demon.co.uk)  *  *   This program is free software; you can redistribute it and/or modify it  *   under the terms of the GNU General Public License as published by the Free  *   Software Foundation; either version 2 of the License, or (at your option)  *   any later version.  *  *   This program is distributed in the hope that it will be useful, but  *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY  *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License  *   for more details.  *  *   You should have received a copy of the GNU General Public License  *   along with this program; if not, write to the Free Software  *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/*  * This file must include only standard C header files.  The core code must  * compile on generic platforms that don't support glib, gimp, gtk, etc.  */
end_comment

begin_include
include|#
directive|include
file|"print.h"
end_include

begin_comment
comment|/* #define DEBUG */
end_comment

begin_comment
comment|/* #define PCL_DEBUG_DISABLE_COMPRESSION */
end_comment

begin_comment
comment|/*  * Local functions...  */
end_comment

begin_function_decl
specifier|static
name|void
name|pcl_mode0
parameter_list|(
name|FILE
modifier|*
parameter_list|,
name|unsigned
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|pcl_mode2
parameter_list|(
name|FILE
modifier|*
parameter_list|,
name|unsigned
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  * Generic define for a name/value set  */
end_comment

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b430ba20108
block|{
DECL|member|pcl_name
name|char
modifier|*
name|pcl_name
decl_stmt|;
DECL|member|pcl_code
name|int
name|pcl_code
decl_stmt|;
DECL|typedef|pcl_t
block|}
name|pcl_t
typedef|;
end_typedef

begin_comment
comment|/*  * Media size to PCL media size code table  *  * Note, you can force the list of papersizes given in the GUI to be only those  * supported by defining PCL_NO_CUSTOM_PAPERSIZES  */
end_comment

begin_comment
comment|/* #define PCL_NO_CUSTOM_PAPERSIZES */
end_comment

begin_define
DECL|macro|PCL_PAPERSIZE_EXECUTIVE
define|#
directive|define
name|PCL_PAPERSIZE_EXECUTIVE
value|1
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_LETTER
define|#
directive|define
name|PCL_PAPERSIZE_LETTER
value|2
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_LEGAL
define|#
directive|define
name|PCL_PAPERSIZE_LEGAL
value|3
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_TABLOID
define|#
directive|define
name|PCL_PAPERSIZE_TABLOID
value|6
end_define

begin_comment
DECL|macro|PCL_PAPERSIZE_TABLOID
comment|/* "Ledger" */
end_comment

begin_define
DECL|macro|PCL_PAPERSIZE_STATEMENT
define|#
directive|define
name|PCL_PAPERSIZE_STATEMENT
value|15
end_define

begin_comment
DECL|macro|PCL_PAPERSIZE_STATEMENT
comment|/* Called "Manual" in print-util */
end_comment

begin_define
DECL|macro|PCL_PAPERSIZE_SUPER_B
define|#
directive|define
name|PCL_PAPERSIZE_SUPER_B
value|16
end_define

begin_comment
DECL|macro|PCL_PAPERSIZE_SUPER_B
comment|/* Called "13x19" in print-util */
end_comment

begin_define
DECL|macro|PCL_PAPERSIZE_A5
define|#
directive|define
name|PCL_PAPERSIZE_A5
value|25
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_A4
define|#
directive|define
name|PCL_PAPERSIZE_A4
value|26
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_A3
define|#
directive|define
name|PCL_PAPERSIZE_A3
value|27
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_JIS_B5
define|#
directive|define
name|PCL_PAPERSIZE_JIS_B5
value|45
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_JIS_B4
define|#
directive|define
name|PCL_PAPERSIZE_JIS_B4
value|46
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_HAGAKI_CARD
define|#
directive|define
name|PCL_PAPERSIZE_HAGAKI_CARD
value|71
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_OUFUKU_CARD
define|#
directive|define
name|PCL_PAPERSIZE_OUFUKU_CARD
value|72
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_A6_CARD
define|#
directive|define
name|PCL_PAPERSIZE_A6_CARD
value|73
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_4x6
define|#
directive|define
name|PCL_PAPERSIZE_4x6
value|74
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_5x8
define|#
directive|define
name|PCL_PAPERSIZE_5x8
value|75
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_3x5
define|#
directive|define
name|PCL_PAPERSIZE_3x5
value|78
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_MONARCH_ENV
define|#
directive|define
name|PCL_PAPERSIZE_MONARCH_ENV
value|80
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_COMMERCIAL10_ENV
define|#
directive|define
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
value|81
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_DL_ENV
define|#
directive|define
name|PCL_PAPERSIZE_DL_ENV
value|90
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_C5_ENV
define|#
directive|define
name|PCL_PAPERSIZE_C5_ENV
value|91
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_C6_ENV
define|#
directive|define
name|PCL_PAPERSIZE_C6_ENV
value|92
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_CUSTOM
define|#
directive|define
name|PCL_PAPERSIZE_CUSTOM
value|101
end_define

begin_comment
DECL|macro|PCL_PAPERSIZE_CUSTOM
comment|/* Custom size */
end_comment

begin_define
DECL|macro|PCL_PAPERSIZE_INVITATION_ENV
define|#
directive|define
name|PCL_PAPERSIZE_INVITATION_ENV
value|109
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_JAPANESE_3_ENV
define|#
directive|define
name|PCL_PAPERSIZE_JAPANESE_3_ENV
value|110
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_JAPANESE_4_ENV
define|#
directive|define
name|PCL_PAPERSIZE_JAPANESE_4_ENV
value|111
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_KAKU_ENV
define|#
directive|define
name|PCL_PAPERSIZE_KAKU_ENV
value|113
end_define

begin_define
DECL|macro|PCL_PAPERSIZE_HP_CARD
define|#
directive|define
name|PCL_PAPERSIZE_HP_CARD
value|114
end_define

begin_comment
DECL|macro|PCL_PAPERSIZE_HP_CARD
comment|/* HP Greeting card!?? */
end_comment

begin_comment
comment|/*  * This data comes from the HP documentation "Deskjet 1220C and 1120C  * PCL reference guide 2.0, Nov 1999". NOTE: The names *must* match  * those in print-util.c for the lookups to work properly!  */
end_comment

begin_decl_stmt
DECL|variable|pcl_media_sizes
specifier|const
specifier|static
name|pcl_t
name|pcl_media_sizes
index|[]
init|=
block|{
block|{
literal|"Executive"
block|,
name|PCL_PAPERSIZE_EXECUTIVE
block|}
block|,
comment|/* US Exec (7.25 x 10.5 in) */
block|{
literal|"Letter"
block|,
name|PCL_PAPERSIZE_LETTER
block|}
block|,
comment|/* US Letter (8.5 x 11 in) */
block|{
literal|"Legal"
block|,
name|PCL_PAPERSIZE_LEGAL
block|}
block|,
comment|/* US Legal (8.5 x 14 in) */
block|{
literal|"Tabloid"
block|,
name|PCL_PAPERSIZE_TABLOID
block|}
block|,
comment|/* US Tabloid (11 x 17 in) */
block|{
literal|"Manual"
block|,
name|PCL_PAPERSIZE_STATEMENT
block|}
block|,
comment|/* US Manual/Statement (5.5 x 8.5 in) */
block|{
literal|"13x19"
block|,
name|PCL_PAPERSIZE_SUPER_B
block|}
block|,
comment|/* US 13x19/Super B (13 x 19 in) */
block|{
literal|"A5"
block|,
name|PCL_PAPERSIZE_A5
block|}
block|,
comment|/* ISO/JIS A5 (148 x 210 mm) */
block|{
literal|"A4"
block|,
name|PCL_PAPERSIZE_A4
block|}
block|,
comment|/* ISO/JIS A4 (210 x 297 mm) */
block|{
literal|"A3"
block|,
name|PCL_PAPERSIZE_A3
block|}
block|,
comment|/* ISO/JIS A3 (297 x 420 mm) */
block|{
literal|"B5 JIS"
block|,
name|PCL_PAPERSIZE_JIS_B5
block|}
block|,
comment|/* JIS B5 (182 x 257 mm). */
block|{
literal|"B4 JIS"
block|,
name|PCL_PAPERSIZE_JIS_B4
block|}
block|,
comment|/* JIS B4 (257 x 364 mm). */
block|{
literal|"Hagaki Card"
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|}
block|,
comment|/* Japanese Hagaki Card (100 x 148 mm) */
block|{
literal|"Oufuku Card"
block|,
name|PCL_PAPERSIZE_OUFUKU_CARD
block|}
block|,
comment|/* Japanese Oufuku Card (148 x 200 mm) */
block|{
literal|"A6"
block|,
name|PCL_PAPERSIZE_A6_CARD
block|}
block|,
comment|/* ISO/JIS A6 card */
block|{
literal|"4x6"
block|,
name|PCL_PAPERSIZE_4x6
block|}
block|,
comment|/* US Index card (4 x 6 in) */
block|{
literal|"5x8"
block|,
name|PCL_PAPERSIZE_5x8
block|}
block|,
comment|/* US Index card (5 x 8 in) */
block|{
literal|"3x5"
block|,
name|PCL_PAPERSIZE_3x5
block|}
block|,
comment|/* US Index card (3 x 5 in) */
block|{
literal|"Monarch"
block|,
name|PCL_PAPERSIZE_MONARCH_ENV
block|}
block|,
comment|/* Monarch Envelope (3 7/8 x 7 1/2 in) */
block|{
literal|"Commercial 10"
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|}
block|,
comment|/* US Commercial 10 Envelope (4.125 x 9.5 in) Portrait */
block|{
literal|"DL"
block|,
name|PCL_PAPERSIZE_DL_ENV
block|}
block|,
comment|/* DL envelope (110 x 220 mm) Portrait */
block|{
literal|"C5"
block|,
name|PCL_PAPERSIZE_C5_ENV
block|}
block|,
comment|/* C5 envelope (162 x 229 mm) */
block|{
literal|"C6"
block|,
name|PCL_PAPERSIZE_C6_ENV
block|}
block|,
comment|/* C6 envelope (114 x 162 mm) */
block|{
literal|"A2 Invitation"
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|}
block|,
comment|/* US A2 Invitation envelope (4 3/8 x 5 3/4 in) */
block|{
literal|"Long 3"
block|,
name|PCL_PAPERSIZE_JAPANESE_3_ENV
block|}
block|,
comment|/* Japanese Long Envelope #3 (120 x 235 mm) */
block|{
literal|"Long 4"
block|,
name|PCL_PAPERSIZE_JAPANESE_4_ENV
block|}
block|,
comment|/* Japanese Long Envelope #4 (90 x 205 mm) */
block|{
literal|"Kaku"
block|,
name|PCL_PAPERSIZE_KAKU_ENV
block|}
block|,
comment|/* Japanese Kaku Envelope (240 x 332.1 mm) */
block|{
literal|"HP Greeting Card"
block|,
name|PCL_PAPERSIZE_HP_CARD
block|}
block|,
comment|/* Hp greeting card (size?? */
block|}
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|NUM_PRINTER_PAPER_SIZES
define|#
directive|define
name|NUM_PRINTER_PAPER_SIZES
value|(sizeof(pcl_media_sizes) / sizeof(pcl_t))
end_define

begin_comment
comment|/*  * Media type to code table  */
end_comment

begin_define
DECL|macro|PCL_PAPERTYPE_PLAIN
define|#
directive|define
name|PCL_PAPERTYPE_PLAIN
value|0
end_define

begin_define
DECL|macro|PCL_PAPERTYPE_BOND
define|#
directive|define
name|PCL_PAPERTYPE_BOND
value|1
end_define

begin_define
DECL|macro|PCL_PAPERTYPE_PREMIUM
define|#
directive|define
name|PCL_PAPERTYPE_PREMIUM
value|2
end_define

begin_define
DECL|macro|PCL_PAPERTYPE_GLOSSY
define|#
directive|define
name|PCL_PAPERTYPE_GLOSSY
value|3
end_define

begin_comment
DECL|macro|PCL_PAPERTYPE_GLOSSY
comment|/* or photo */
end_comment

begin_define
DECL|macro|PCL_PAPERTYPE_TRANS
define|#
directive|define
name|PCL_PAPERTYPE_TRANS
value|4
end_define

begin_define
DECL|macro|PCL_PAPERTYPE_QPHOTO
define|#
directive|define
name|PCL_PAPERTYPE_QPHOTO
value|5
end_define

begin_comment
DECL|macro|PCL_PAPERTYPE_QPHOTO
comment|/* Quick dry photo (2000 only) */
end_comment

begin_define
DECL|macro|PCL_PAPERTYPE_QTRANS
define|#
directive|define
name|PCL_PAPERTYPE_QTRANS
value|6
end_define

begin_comment
DECL|macro|PCL_PAPERTYPE_QTRANS
comment|/* Quick dry transparency (2000 only) */
end_comment

begin_decl_stmt
DECL|variable|pcl_media_types
specifier|const
specifier|static
name|pcl_t
name|pcl_media_types
index|[]
init|=
block|{
block|{
literal|"Plain"
block|,
name|PCL_PAPERTYPE_PLAIN
block|}
block|,
block|{
literal|"Bond"
block|,
name|PCL_PAPERTYPE_BOND
block|}
block|,
block|{
literal|"Premium"
block|,
name|PCL_PAPERTYPE_PREMIUM
block|}
block|,
block|{
literal|"Glossy/Photo"
block|,
name|PCL_PAPERTYPE_GLOSSY
block|}
block|,
block|{
literal|"Transparency"
block|,
name|PCL_PAPERTYPE_TRANS
block|}
block|,
block|{
literal|"Quick-dry Photo"
block|,
name|PCL_PAPERTYPE_QPHOTO
block|}
block|,
block|{
literal|"Quick-dry Transparency"
block|,
name|PCL_PAPERTYPE_QTRANS
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|NUM_PRINTER_PAPER_TYPES
define|#
directive|define
name|NUM_PRINTER_PAPER_TYPES
value|(sizeof(pcl_media_types) / sizeof(pcl_t))
end_define

begin_comment
comment|/*  * Media feed to code table. There are different names for the same code,  * so we encode them by adding "lumps" of "PAPERSOURCE_MOD".  * This is removed later to get back to the main codes.  */
end_comment

begin_define
DECL|macro|PAPERSOURCE_MOD
define|#
directive|define
name|PAPERSOURCE_MOD
value|16
end_define

begin_define
DECL|macro|PCL_PAPERSOURCE_STANDARD
define|#
directive|define
name|PCL_PAPERSOURCE_STANDARD
value|0
end_define

begin_comment
DECL|macro|PCL_PAPERSOURCE_STANDARD
comment|/* Don't output code */
end_comment

begin_define
DECL|macro|PCL_PAPERSOURCE_MANUAL
define|#
directive|define
name|PCL_PAPERSOURCE_MANUAL
value|2
end_define

begin_define
DECL|macro|PCL_PAPERSOURCE_ENVELOPE
define|#
directive|define
name|PCL_PAPERSOURCE_ENVELOPE
value|3
end_define

begin_comment
DECL|macro|PCL_PAPERSOURCE_ENVELOPE
comment|/* Not used */
end_comment

begin_comment
comment|/* LaserJet types */
end_comment

begin_define
DECL|macro|PCL_PAPERSOURCE_LJ_TRAY2
define|#
directive|define
name|PCL_PAPERSOURCE_LJ_TRAY2
value|1
end_define

begin_define
DECL|macro|PCL_PAPERSOURCE_LJ_TRAY3
define|#
directive|define
name|PCL_PAPERSOURCE_LJ_TRAY3
value|4
end_define

begin_define
DECL|macro|PCL_PAPERSOURCE_LJ_TRAY4
define|#
directive|define
name|PCL_PAPERSOURCE_LJ_TRAY4
value|5
end_define

begin_define
DECL|macro|PCL_PAPERSOURCE_LJ_TRAY1
define|#
directive|define
name|PCL_PAPERSOURCE_LJ_TRAY1
value|8
end_define

begin_comment
comment|/* Deskjet 340 types */
end_comment

begin_define
DECL|macro|PCL_PAPERSOURCE_340_PCSF
define|#
directive|define
name|PCL_PAPERSOURCE_340_PCSF
value|1 + PAPERSOURCE_MOD
end_define

begin_comment
comment|/* Portable sheet feeder for 340 */
end_comment

begin_define
DECL|macro|PCL_PAPERSOURCE_340_DCSF
define|#
directive|define
name|PCL_PAPERSOURCE_340_DCSF
value|4 + PAPERSOURCE_MOD
end_define

begin_comment
comment|/* Desktop sheet feeder for 340 */
end_comment

begin_comment
comment|/* Other Deskjet types */
end_comment

begin_define
DECL|macro|PCL_PAPERSOURCE_DJ_TRAY
define|#
directive|define
name|PCL_PAPERSOURCE_DJ_TRAY
value|1 + PAPERSOURCE_MOD + PAPERSOURCE_MOD
end_define

begin_define
DECL|macro|PCL_PAPERSOURCE_DJ_TRAY2
define|#
directive|define
name|PCL_PAPERSOURCE_DJ_TRAY2
value|4 + PAPERSOURCE_MOD + PAPERSOURCE_MOD
end_define

begin_comment
comment|/* Tray 2 for 2500 */
end_comment

begin_define
DECL|macro|PCL_PAPERSOURCE_DJ_OPTIONAL
define|#
directive|define
name|PCL_PAPERSOURCE_DJ_OPTIONAL
value|5 + PAPERSOURCE_MOD + PAPERSOURCE_MOD
end_define

begin_comment
comment|/* Optional source for 2500 */
end_comment

begin_define
DECL|macro|PCL_PAPERSOURCE_DJ_AUTO
define|#
directive|define
name|PCL_PAPERSOURCE_DJ_AUTO
value|7 + PAPERSOURCE_MOD + PAPERSOURCE_MOD
end_define

begin_comment
comment|/* Autoselect for 2500 */
end_comment

begin_decl_stmt
DECL|variable|pcl_media_sources
specifier|const
specifier|static
name|pcl_t
name|pcl_media_sources
index|[]
init|=
block|{
block|{
literal|"Standard"
block|,
name|PCL_PAPERSOURCE_STANDARD
block|}
block|,
block|{
literal|"Manual"
block|,
name|PCL_PAPERSOURCE_MANUAL
block|}
block|,
comment|/*  {"Envelope", PCL_PAPERSOURCE_ENVELOPE}, */
block|{
literal|"Tray 1"
block|,
name|PCL_PAPERSOURCE_LJ_TRAY1
block|}
block|,
block|{
literal|"Tray 2"
block|,
name|PCL_PAPERSOURCE_LJ_TRAY2
block|}
block|,
block|{
literal|"Tray 3"
block|,
name|PCL_PAPERSOURCE_LJ_TRAY3
block|}
block|,
block|{
literal|"Tray 4"
block|,
name|PCL_PAPERSOURCE_LJ_TRAY4
block|}
block|,
block|{
literal|"Portable Sheet Feeder"
block|,
name|PCL_PAPERSOURCE_340_PCSF
block|}
block|,
block|{
literal|"Desktop Sheet Feeder"
block|,
name|PCL_PAPERSOURCE_340_DCSF
block|}
block|,
block|{
literal|"Tray"
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|}
block|,
block|{
literal|"Tray 2"
block|,
name|PCL_PAPERSOURCE_DJ_TRAY2
block|}
block|,
block|{
literal|"Optional Source"
block|,
name|PCL_PAPERSOURCE_DJ_OPTIONAL
block|}
block|,
block|{
literal|"Autoselect"
block|,
name|PCL_PAPERSOURCE_DJ_AUTO
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|NUM_PRINTER_PAPER_SOURCES
define|#
directive|define
name|NUM_PRINTER_PAPER_SOURCES
value|(sizeof(pcl_media_sources) / sizeof(pcl_t))
end_define

begin_define
DECL|macro|PCL_RES_150_150
define|#
directive|define
name|PCL_RES_150_150
value|1
end_define

begin_define
DECL|macro|PCL_RES_300_300
define|#
directive|define
name|PCL_RES_300_300
value|2
end_define

begin_define
DECL|macro|PCL_RES_600_300
define|#
directive|define
name|PCL_RES_600_300
value|4
end_define

begin_comment
DECL|macro|PCL_RES_600_300
comment|/* DJ 600 series */
end_comment

begin_define
DECL|macro|PCL_RES_600_600_MONO
define|#
directive|define
name|PCL_RES_600_600_MONO
value|8
end_define

begin_comment
DECL|macro|PCL_RES_600_600_MONO
comment|/* DJ 600/800/1100/2000 b/w only */
end_comment

begin_define
DECL|macro|PCL_RES_600_600
define|#
directive|define
name|PCL_RES_600_600
value|16
end_define

begin_comment
DECL|macro|PCL_RES_600_600
comment|/* DJ 9xx/1220C/PhotoSmart */
end_comment

begin_define
DECL|macro|PCL_RES_1200_600
define|#
directive|define
name|PCL_RES_1200_600
value|32
end_define

begin_comment
DECL|macro|PCL_RES_1200_600
comment|/* DJ 9xx/1220C/PhotoSmart */
end_comment

begin_define
DECL|macro|PCL_RES_2400_600
define|#
directive|define
name|PCL_RES_2400_600
value|64
end_define

begin_comment
DECL|macro|PCL_RES_2400_600
comment|/* DJ 9xx/1220C/PhotoSmart */
end_comment

begin_decl_stmt
DECL|variable|pcl_resolutions
specifier|const
specifier|static
name|pcl_t
name|pcl_resolutions
index|[]
init|=
block|{
block|{
literal|"150x150 DPI"
block|,
name|PCL_RES_150_150
block|}
block|,
block|{
literal|"300x300 DPI"
block|,
name|PCL_RES_300_300
block|}
block|,
block|{
literal|"600x300 DPI"
block|,
name|PCL_RES_600_300
block|}
block|,
block|{
literal|"600x600 DPI monochrome"
block|,
name|PCL_RES_600_600_MONO
block|}
block|,
block|{
literal|"600x600 DPI"
block|,
name|PCL_RES_600_600
block|}
block|,
block|{
literal|"1200x600 DPI"
block|,
name|PCL_RES_1200_600
block|}
block|,
block|{
literal|"2400x600 DPI"
block|,
name|PCL_RES_2400_600
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|NUM_RESOLUTIONS
define|#
directive|define
name|NUM_RESOLUTIONS
value|(sizeof(pcl_resolutions) / sizeof (pcl_t))
end_define

begin_function
specifier|const
name|char
modifier|*
DECL|function|pcl_default_resolution (const printer_t * printer)
name|pcl_default_resolution
parameter_list|(
specifier|const
name|printer_t
modifier|*
name|printer
parameter_list|)
block|{
return|return
name|pcl_resolutions
index|[
literal|0
index|]
operator|.
name|pcl_name
return|;
block|}
end_function

begin_comment
comment|/*  * Printer capability data  */
end_comment

begin_typedef
DECL|struct|__anon2b430ba20208
typedef|typedef
struct|struct
block|{
DECL|member|model
name|int
name|model
decl_stmt|;
DECL|member|max_width
name|int
name|max_width
decl_stmt|;
DECL|member|max_height
name|int
name|max_height
decl_stmt|;
DECL|member|resolutions
name|int
name|resolutions
decl_stmt|;
DECL|member|top_margin
name|int
name|top_margin
decl_stmt|;
DECL|member|bottom_margin
name|int
name|bottom_margin
decl_stmt|;
DECL|member|left_margin
name|int
name|left_margin
decl_stmt|;
DECL|member|right_margin
name|int
name|right_margin
decl_stmt|;
DECL|member|color_type
name|int
name|color_type
decl_stmt|;
comment|/* 2 print head or one, 2 level or 4 */
DECL|member|printer_type
name|int
name|printer_type
decl_stmt|;
comment|/* Deskjet/Laserjet and quirks */
comment|/* The paper size, paper type and paper source codes cannot be combined */
DECL|member|paper_sizes
name|int
name|paper_sizes
index|[
name|NUM_PRINTER_PAPER_SIZES
operator|+
literal|1
index|]
decl_stmt|;
comment|/* Paper sizes */
DECL|member|paper_types
name|int
name|paper_types
index|[
name|NUM_PRINTER_PAPER_TYPES
operator|+
literal|1
index|]
decl_stmt|;
comment|/* Paper types */
DECL|member|paper_sources
name|int
name|paper_sources
index|[
name|NUM_PRINTER_PAPER_SOURCES
operator|+
literal|1
index|]
decl_stmt|;
comment|/* Paper sources */
DECL|typedef|pcl_cap_t
block|}
name|pcl_cap_t
typedef|;
end_typedef

begin_define
DECL|macro|PCL_COLOR_NONE
define|#
directive|define
name|PCL_COLOR_NONE
value|0
end_define

begin_define
DECL|macro|PCL_COLOR_CMY
define|#
directive|define
name|PCL_COLOR_CMY
value|1
end_define

begin_comment
DECL|macro|PCL_COLOR_CMY
comment|/* One print head */
end_comment

begin_define
DECL|macro|PCL_COLOR_CMYK
define|#
directive|define
name|PCL_COLOR_CMYK
value|2
end_define

begin_comment
DECL|macro|PCL_COLOR_CMYK
comment|/* Two print heads */
end_comment

begin_define
DECL|macro|PCL_COLOR_CMYK4
define|#
directive|define
name|PCL_COLOR_CMYK4
value|4
end_define

begin_comment
DECL|macro|PCL_COLOR_CMYK4
comment|/* CRet printing */
end_comment

begin_define
DECL|macro|PCL_COLOR_CMYKcm
define|#
directive|define
name|PCL_COLOR_CMYKcm
value|8
end_define

begin_comment
DECL|macro|PCL_COLOR_CMYKcm
comment|/* CMY + Photo Cart */
end_comment

begin_define
DECL|macro|PCL_PRINTER_LJ
define|#
directive|define
name|PCL_PRINTER_LJ
value|1
end_define

begin_define
DECL|macro|PCL_PRINTER_DJ
define|#
directive|define
name|PCL_PRINTER_DJ
value|2
end_define

begin_define
DECL|macro|PCL_PRINTER_NEW_ERG
define|#
directive|define
name|PCL_PRINTER_NEW_ERG
value|4
end_define

begin_comment
DECL|macro|PCL_PRINTER_NEW_ERG
comment|/* use "\033*rC" to end raster graphics, 					   instead of "\033*rB" */
end_comment

begin_define
DECL|macro|PCL_PRINTER_TIFF
define|#
directive|define
name|PCL_PRINTER_TIFF
value|8
end_define

begin_comment
DECL|macro|PCL_PRINTER_TIFF
comment|/* Use TIFF compression */
end_comment

begin_define
DECL|macro|PCL_PRINTER_MEDIATYPE
define|#
directive|define
name|PCL_PRINTER_MEDIATYPE
value|16
end_define

begin_comment
DECL|macro|PCL_PRINTER_MEDIATYPE
comment|/* Use media type& print quality */
end_comment

begin_define
DECL|macro|PCL_PRINTER_CUSTOM_SIZE
define|#
directive|define
name|PCL_PRINTER_CUSTOM_SIZE
value|32
end_define

begin_comment
DECL|macro|PCL_PRINTER_CUSTOM_SIZE
comment|/* Custom sizes supported */
end_comment

begin_comment
comment|/*  * FIXME - the 520 shouldn't be lumped in with the 500 as it supports  * more paper sizes.  *  * The following models use depletion, raster quality and shingling:-  * 500, 500c, 510, 520, 550c, 560c.  * The rest use Media Type and Print Quality.  *  * This data comes from the HP documentation "Deskjet 1220C and 1120C  * PCL reference guide 2.0, Nov 1999".   */
end_comment

begin_decl_stmt
DECL|variable|pcl_model_capabilities
specifier|static
name|pcl_cap_t
name|pcl_model_capabilities
index|[]
init|=
block|{
comment|/* Default/unknown printer - assume laserjet */
block|{
literal|0
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
comment|/* Max paper size */
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
comment|/* Resolutions */
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
comment|/* Margins */
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_LJ
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
literal|0
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper types */
block|}
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper sources */
block|}
block|,   }
block|,
comment|/* Deskjet 340 */
block|{
literal|340
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|7
block|,
literal|41
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMY
block|,
name|PCL_PRINTER_DJ
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_340_PCSF
block|,
name|PCL_PAPERSOURCE_340_DCSF
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 400 */
block|{
literal|400
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|7
block|,
literal|41
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMY
block|,
name|PCL_PRINTER_DJ
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_JIS_B5
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper sources */
block|}
block|,   }
block|,
comment|/* Deskjet 500, 520 */
block|{
literal|500
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|7
block|,
literal|41
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_DJ
block|,
block|{
comment|/*    PCL_PAPERSIZE_EXECUTIVE,	The 500 doesn't support this, the 520 does */
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
comment|/*    PCL_PAPERSIZE_DL_ENV,	The 500 doesn't support this, the 520 does */
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 500C */
block|{
literal|501
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|7
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMY
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 540C */
block|{
literal|540
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|7
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMY
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_JIS_B5
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 550C, 560C */
block|{
literal|550
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|3
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
comment|/* The 550/560 support COM10 and DL envelope, but the control codes    are negative, indicating landscape mode. This needs thinking about! */
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 600/600C */
block|{
literal|600
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_300
operator||
name|PCL_RES_600_600_MONO
block|,
literal|0
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMY
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper sources */
block|}
block|,   }
block|,
comment|/* Deskjet 6xx series, plus 810/812/840/842/895 */
block|{
literal|601
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_300
operator||
name|PCL_RES_600_600_MONO
block|,
literal|0
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 69x series (Photo Capable) */
block|{
literal|690
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_300
operator||
name|PCL_RES_600_600
block|,
literal|0
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
operator||
name|PCL_COLOR_CMYKcm
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 850/855/870/890 (C-RET) */
block|{
literal|800
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600_MONO
block|,
literal|3
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
operator||
name|PCL_COLOR_CMYK4
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 900 series, 1220C, PhotoSmart P1000/P1100 */
block|{
literal|900
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600
comment|/* | PCL_RES_1200_600 | PCL_RES_2400_600 */
block|,
literal|3
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper sources */
block|}
block|,   }
block|,
comment|/* Deskjet 1220C (or other large format 900) */
block|{
literal|901
block|,
literal|13
operator|*
literal|72
block|,
literal|19
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600
comment|/* | PCL_RES_1200_600 | PCL_RES_2400_600 */
block|,
literal|3
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_TABLOID
block|,
name|PCL_PAPERSIZE_STATEMENT
block|,
name|PCL_PAPERSIZE_SUPER_B
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_A3
block|,
name|PCL_PAPERSIZE_JIS_B5
block|,
name|PCL_PAPERSIZE_JIS_B4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_OUFUKU_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_3x5
block|,
name|PCL_PAPERSIZE_HP_CARD
block|,
name|PCL_PAPERSIZE_MONARCH_ENV
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C5_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
name|PCL_PAPERSIZE_JAPANESE_3_ENV
block|,
name|PCL_PAPERSIZE_JAPANESE_4_ENV
block|,
name|PCL_PAPERSIZE_KAKU_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper sources */
block|}
block|,   }
block|,
comment|/* Deskjet 1100C, 1120C */
block|{
literal|1100
block|,
literal|13
operator|*
literal|72
block|,
literal|19
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600_MONO
block|,
literal|3
block|,
literal|33
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
operator||
name|PCL_COLOR_CMYK4
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_TABLOID
block|,
name|PCL_PAPERSIZE_STATEMENT
block|,
name|PCL_PAPERSIZE_SUPER_B
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_A3
block|,
name|PCL_PAPERSIZE_JIS_B5
block|,
name|PCL_PAPERSIZE_JIS_B4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
name|PCL_PAPERSIZE_JAPANESE_3_ENV
block|,
name|PCL_PAPERSIZE_JAPANESE_4_ENV
block|,
name|PCL_PAPERSIZE_KAKU_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 1200C */
block|{
literal|1200
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMY
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
comment|/* This printer is not mentioned in the Comparison tables,    so I'll just pick some likely sizes... */
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 1600C */
block|{
literal|1600
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
comment|/* This printer is not mentioned in the Comparison tables,    so I'll just pick some likely sizes... */
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 2000 */
block|{
literal|2000
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_3x5
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
name|PCL_PAPERSIZE_C6_ENV
block|,
name|PCL_PAPERSIZE_INVITATION_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
name|PCL_PAPERTYPE_QPHOTO
block|,
name|PCL_PAPERTYPE_QTRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* Deskjet 2500 */
block|{
literal|2500
block|,
literal|13
operator|*
literal|72
block|,
literal|19
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_CMYK
block|,
name|PCL_PRINTER_DJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
operator||
name|PCL_PRINTER_MEDIATYPE
operator||
name|PCL_PRINTER_CUSTOM_SIZE
block|,
block|{
name|PCL_PAPERSIZE_EXECUTIVE
block|,
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_TABLOID
block|,
name|PCL_PAPERSIZE_STATEMENT
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_A3
block|,
name|PCL_PAPERSIZE_JIS_B5
block|,
name|PCL_PAPERSIZE_JIS_B4
block|,
name|PCL_PAPERSIZE_HAGAKI_CARD
block|,
name|PCL_PAPERSIZE_A6_CARD
block|,
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
name|PCL_PAPERSIZE_COMMERCIAL10_ENV
block|,
name|PCL_PAPERSIZE_DL_ENV
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERTYPE_PLAIN
block|,
name|PCL_PAPERTYPE_BOND
block|,
name|PCL_PAPERTYPE_PREMIUM
block|,
name|PCL_PAPERTYPE_GLOSSY
block|,
name|PCL_PAPERTYPE_TRANS
block|,
name|PCL_PAPERTYPE_QPHOTO
block|,
name|PCL_PAPERTYPE_QTRANS
block|,
operator|-
literal|1
block|,     }
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_DJ_AUTO
block|,
name|PCL_PAPERSOURCE_DJ_TRAY
block|,
name|PCL_PAPERSOURCE_DJ_TRAY2
block|,
name|PCL_PAPERSOURCE_DJ_OPTIONAL
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* LaserJet II series */
block|{
literal|2
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_LJ
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper types */
block|}
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_LJ_TRAY1
block|,
name|PCL_PAPERSOURCE_LJ_TRAY2
block|,
name|PCL_PAPERSOURCE_LJ_TRAY3
block|,
name|PCL_PAPERSOURCE_LJ_TRAY4
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* LaserJet III series */
block|{
literal|3
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_LJ
operator||
name|PCL_PRINTER_TIFF
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper types */
block|}
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_LJ_TRAY1
block|,
name|PCL_PAPERSOURCE_LJ_TRAY2
block|,
name|PCL_PAPERSOURCE_LJ_TRAY3
block|,
name|PCL_PAPERSOURCE_LJ_TRAY4
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* LaserJet 4L */
block|{
literal|4
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_LJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper types */
block|}
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_LJ_TRAY1
block|,
name|PCL_PAPERSOURCE_LJ_TRAY2
block|,
name|PCL_PAPERSOURCE_LJ_TRAY3
block|,
name|PCL_PAPERSOURCE_LJ_TRAY4
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* LaserJet 4V, 4Si, 5Si */
block|{
literal|5
block|,
literal|13
operator|*
literal|72
block|,
literal|19
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_LJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_TABLOID
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_A3
block|,
name|PCL_PAPERSIZE_JIS_B5
block|,
name|PCL_PAPERSIZE_JIS_B4
block|,
comment|/* Guess */
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper types */
block|}
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_LJ_TRAY1
block|,
name|PCL_PAPERSOURCE_LJ_TRAY2
block|,
name|PCL_PAPERSOURCE_LJ_TRAY3
block|,
name|PCL_PAPERSOURCE_LJ_TRAY4
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* LaserJet 4 series (except as above), 5 series, 6 series */
block|{
literal|6
block|,
literal|17
operator|*
literal|72
operator|/
literal|2
block|,
literal|14
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_LJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_A4
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper types */
block|}
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_LJ_TRAY1
block|,
name|PCL_PAPERSOURCE_LJ_TRAY2
block|,
name|PCL_PAPERSOURCE_LJ_TRAY3
block|,
name|PCL_PAPERSOURCE_LJ_TRAY4
block|,
operator|-
literal|1
block|,     }
block|,   }
block|,
comment|/* LaserJet 5Si */
block|{
literal|7
block|,
literal|13
operator|*
literal|72
block|,
literal|19
operator|*
literal|72
block|,
name|PCL_RES_150_150
operator||
name|PCL_RES_300_300
operator||
name|PCL_RES_600_600
block|,
literal|12
block|,
literal|12
block|,
literal|18
block|,
literal|18
block|,
name|PCL_COLOR_NONE
block|,
name|PCL_PRINTER_LJ
operator||
name|PCL_PRINTER_NEW_ERG
operator||
name|PCL_PRINTER_TIFF
block|,
block|{
name|PCL_PAPERSIZE_LETTER
block|,
name|PCL_PAPERSIZE_LEGAL
block|,
name|PCL_PAPERSIZE_TABLOID
block|,
name|PCL_PAPERSIZE_A5
block|,
name|PCL_PAPERSIZE_A4
block|,
name|PCL_PAPERSIZE_A3
block|,
name|PCL_PAPERSIZE_JIS_B5
block|,
name|PCL_PAPERSIZE_JIS_B4
block|,
comment|/* Guess */
name|PCL_PAPERSIZE_4x6
block|,
name|PCL_PAPERSIZE_5x8
block|,
operator|-
literal|1
block|,     }
block|,
block|{
operator|-
literal|1
block|,
comment|/* No selectable paper types */
block|}
block|,
block|{
name|PCL_PAPERSOURCE_STANDARD
block|,
name|PCL_PAPERSOURCE_MANUAL
block|,
name|PCL_PAPERSOURCE_LJ_TRAY1
block|,
name|PCL_PAPERSOURCE_LJ_TRAY2
block|,
name|PCL_PAPERSOURCE_LJ_TRAY3
block|,
name|PCL_PAPERSOURCE_LJ_TRAY4
block|,
operator|-
literal|1
block|,     }
block|,   }
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * Convert a name into it's option value  */
end_comment

begin_function
DECL|function|pcl_string_to_val (const char * string,const pcl_t * options,int num_options)
specifier|static
name|int
name|pcl_string_to_val
parameter_list|(
specifier|const
name|char
modifier|*
name|string
parameter_list|,
comment|/* I: String */
specifier|const
name|pcl_t
modifier|*
name|options
parameter_list|,
comment|/* I: Options */
name|int
name|num_options
parameter_list|)
comment|/* I: Num options */
block|{
name|int
name|i
decl_stmt|;
name|int
name|code
init|=
operator|-
literal|1
decl_stmt|;
comment|/*   * Look up the string in the table and convert to the code.   */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_options
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|string
argument_list|,
name|options
index|[
name|i
index|]
operator|.
name|pcl_name
argument_list|)
condition|)
block|{
name|code
operator|=
name|options
index|[
name|i
index|]
operator|.
name|pcl_code
expr_stmt|;
break|break;
block|}
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"String: %s, Code: %d\n"
argument_list|,
name|string
argument_list|,
name|code
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
operator|(
name|code
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * Convert a value into it's option name  */
end_comment

begin_function
DECL|function|pcl_val_to_string (int code,const pcl_t * options,int num_options)
specifier|static
name|char
modifier|*
name|pcl_val_to_string
parameter_list|(
name|int
name|code
parameter_list|,
comment|/* I: Code */
specifier|const
name|pcl_t
modifier|*
name|options
parameter_list|,
comment|/* I: Options */
name|int
name|num_options
parameter_list|)
comment|/* I: Num options */
block|{
name|int
name|i
decl_stmt|;
name|char
modifier|*
name|string
init|=
name|NULL
decl_stmt|;
comment|/*   * Look up the code in the table and convert to the string.   */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_options
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|code
operator|==
name|options
index|[
name|i
index|]
operator|.
name|pcl_code
condition|)
block|{
name|string
operator|=
name|options
index|[
name|i
index|]
operator|.
name|pcl_name
expr_stmt|;
break|break;
block|}
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Code: %d, String: %s\n"
argument_list|,
name|code
argument_list|,
name|string
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
operator|(
name|string
operator|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|dot_sizes
specifier|static
name|double
name|dot_sizes
index|[]
init|=
block|{
literal|0.5
block|,
literal|0.832
block|,
literal|1.0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|variable_dither_ranges
specifier|static
name|simple_dither_range_t
name|variable_dither_ranges
index|[]
init|=
block|{
block|{
literal|0.152
block|,
literal|0x1
block|,
literal|0
block|}
block|,
block|{
literal|0.255
block|,
literal|0x2
block|,
literal|0
block|}
block|,
block|{
literal|0.38
block|,
literal|0x3
block|,
literal|0
block|}
block|,
block|{
literal|0.5
block|,
literal|0x1
block|,
literal|1
block|}
block|,
block|{
literal|0.67
block|,
literal|0x2
block|,
literal|1
block|}
block|,
block|{
literal|1.0
block|,
literal|0x3
block|,
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  * pcl_get_model_capabilities() - Return struct of model capabilities  */
end_comment

begin_function
specifier|static
name|pcl_cap_t
comment|/* O: Capabilities */
DECL|function|pcl_get_model_capabilities (int model)
name|pcl_get_model_capabilities
parameter_list|(
name|int
name|model
parameter_list|)
comment|/* I: Model */
block|{
name|int
name|i
decl_stmt|;
name|int
name|models
init|=
sizeof|sizeof
argument_list|(
name|pcl_model_capabilities
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|pcl_cap_t
argument_list|)
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|models
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|pcl_model_capabilities
index|[
name|i
index|]
operator|.
name|model
operator|==
name|model
condition|)
block|{
return|return
name|pcl_model_capabilities
index|[
name|i
index|]
return|;
block|}
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"pcl: model %d not found in capabilities list.\n"
argument_list|,
name|model
argument_list|)
expr_stmt|;
return|return
name|pcl_model_capabilities
index|[
literal|0
index|]
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|c_strdup (const char * s)
name|c_strdup
parameter_list|(
specifier|const
name|char
modifier|*
name|s
parameter_list|)
block|{
name|char
modifier|*
name|ret
init|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|s
argument_list|)
operator|+
literal|1
argument_list|)
decl_stmt|;
name|strcpy
argument_list|(
name|ret
argument_list|,
name|s
argument_list|)
expr_stmt|;
return|return
name|ret
return|;
block|}
end_function

begin_comment
comment|/*  * Convert Media size name into PCL media code for printer  */
end_comment

begin_function
DECL|function|pcl_convert_media_size (const char * media_size,int model)
specifier|static
name|int
name|pcl_convert_media_size
parameter_list|(
specifier|const
name|char
modifier|*
name|media_size
parameter_list|,
comment|/* I: Media size string */
name|int
name|model
parameter_list|)
comment|/* I: model number */
block|{
name|int
name|i
decl_stmt|;
name|int
name|media_code
init|=
literal|0
decl_stmt|;
name|pcl_cap_t
name|caps
decl_stmt|;
comment|/*   * First look up the media size in the table and convert to the code.   */
name|media_code
operator|=
name|pcl_string_to_val
argument_list|(
name|media_size
argument_list|,
name|pcl_media_sizes
argument_list|,
sizeof|sizeof
argument_list|(
name|pcl_media_sizes
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|pcl_t
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Media Size: %s, Code: %d\n"
argument_list|,
name|media_size
argument_list|,
name|media_code
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/*   * Now see if the printer supports the code found.   */
if|if
condition|(
name|media_code
operator|!=
operator|-
literal|1
condition|)
block|{
name|caps
operator|=
name|pcl_get_model_capabilities
argument_list|(
name|model
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
name|NUM_PRINTER_PAPER_SIZES
operator|)
operator|&&
operator|(
name|caps
operator|.
name|paper_sizes
index|[
name|i
index|]
operator|!=
operator|-
literal|1
operator|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|media_code
operator|==
name|caps
operator|.
name|paper_sizes
index|[
name|i
index|]
condition|)
return|return
operator|(
name|media_code
operator|)
return|;
comment|/* Is supported */
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Media Code %d not supported by printer model %d.\n"
argument_list|,
name|media_code
argument_list|,
name|model
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
operator|(
operator|-
literal|1
operator|)
return|;
comment|/* Not supported */
block|}
else|else
return|return
operator|(
operator|-
literal|1
operator|)
return|;
comment|/* Not supported */
block|}
end_function

begin_comment
comment|/*  * 'pcl_parameters()' - Return the parameter values for the given parameter.  */
end_comment

begin_function
name|char
modifier|*
modifier|*
comment|/* O - Parameter values */
DECL|function|pcl_parameters (const printer_t * printer,char * ppd_file,char * name,int * count)
name|pcl_parameters
parameter_list|(
specifier|const
name|printer_t
modifier|*
name|printer
parameter_list|,
comment|/* I - Printer model */
name|char
modifier|*
name|ppd_file
parameter_list|,
comment|/* I - PPD file (not used) */
name|char
modifier|*
name|name
parameter_list|,
comment|/* I - Name of parameter */
name|int
modifier|*
name|count
parameter_list|)
comment|/* O - Number of values */
block|{
name|int
name|i
decl_stmt|;
name|char
modifier|*
modifier|*
name|valptrs
decl_stmt|;
name|pcl_cap_t
name|caps
decl_stmt|;
specifier|static
name|char
modifier|*
name|ink_types
index|[]
init|=
block|{
literal|"Color + Black Cartridges"
block|,
literal|"Color + Photo Cartridges"
block|}
decl_stmt|;
if|if
condition|(
name|count
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
operator|*
name|count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|caps
operator|=
name|pcl_get_model_capabilities
argument_list|(
name|printer
operator|->
name|model
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Printer model = %d\n"
argument_list|,
name|printer
operator|->
name|model
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"PageWidth = %d, PageLength = %d\n"
argument_list|,
name|caps
operator|.
name|max_width
argument_list|,
name|caps
operator|.
name|max_height
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Margins: top = %d, bottom = %d, left = %d, right = %d\n"
argument_list|,
name|caps
operator|.
name|top_margin
argument_list|,
name|caps
operator|.
name|bottom_margin
argument_list|,
name|caps
operator|.
name|left_margin
argument_list|,
name|caps
operator|.
name|right_margin
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Resolutions: %d\n"
argument_list|,
name|caps
operator|.
name|resolutions
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"ColorType = %d, PrinterType = %d\n"
argument_list|,
name|caps
operator|.
name|color_type
argument_list|,
name|caps
operator|.
name|printer_type
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"PageSize"
argument_list|)
operator|==
literal|0
condition|)
block|{
specifier|const
name|papersize_t
modifier|*
name|papersizes
init|=
name|get_papersizes
argument_list|()
decl_stmt|;
ifdef|#
directive|ifdef
name|PCL_NO_CUSTOM_PAPERSIZES
name|int
name|use_custom
init|=
literal|0
decl_stmt|;
else|#
directive|else
name|int
name|use_custom
init|=
operator|(
operator|(
name|caps
operator|.
name|printer_type
operator|&
name|PCL_PRINTER_CUSTOM_SIZE
operator|)
operator|==
name|PCL_PRINTER_CUSTOM_SIZE
operator|)
decl_stmt|;
endif|#
directive|endif
name|valptrs
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|known_papersizes
argument_list|()
argument_list|)
expr_stmt|;
operator|*
name|count
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|known_papersizes
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strlen
argument_list|(
name|papersizes
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|>
literal|0
operator|&&
name|papersizes
index|[
name|i
index|]
operator|.
name|width
operator|<=
name|caps
operator|.
name|max_width
operator|&&
name|papersizes
index|[
name|i
index|]
operator|.
name|length
operator|<=
name|caps
operator|.
name|max_height
operator|&&
operator|(
operator|(
name|use_custom
operator|==
literal|1
operator|)
operator|||
operator|(
operator|(
name|use_custom
operator|==
literal|0
operator|)
operator|&&
operator|(
name|pcl_convert_media_size
argument_list|(
name|papersizes
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|printer
operator|->
name|model
argument_list|)
operator|!=
operator|-
literal|1
operator|)
operator|)
operator|)
condition|)
block|{
name|valptrs
index|[
operator|*
name|count
index|]
operator|=
name|malloc
argument_list|(
name|strlen
argument_list|(
name|papersizes
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|valptrs
index|[
operator|*
name|count
index|]
argument_list|,
name|papersizes
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
operator|(
operator|*
name|count
operator|)
operator|++
expr_stmt|;
block|}
block|}
return|return
operator|(
name|valptrs
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"MediaType"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|caps
operator|.
name|paper_types
index|[
literal|0
index|]
operator|==
operator|-
literal|1
condition|)
block|{
operator|*
name|count
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
block|{
name|valptrs
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|NUM_PRINTER_PAPER_TYPES
argument_list|)
expr_stmt|;
operator|*
name|count
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
name|NUM_PRINTER_PAPER_TYPES
operator|)
operator|&&
operator|(
name|caps
operator|.
name|paper_types
index|[
name|i
index|]
operator|!=
operator|-
literal|1
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|valptrs
index|[
name|i
index|]
operator|=
name|c_strdup
argument_list|(
name|pcl_val_to_string
argument_list|(
name|caps
operator|.
name|paper_types
index|[
name|i
index|]
argument_list|,
name|pcl_media_types
argument_list|,
name|NUM_PRINTER_PAPER_TYPES
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|count
operator|)
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|valptrs
operator|)
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"InputSlot"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|caps
operator|.
name|paper_sources
index|[
literal|0
index|]
operator|==
operator|-
literal|1
condition|)
block|{
operator|*
name|count
operator|=
literal|0
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
block|{
name|valptrs
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|NUM_PRINTER_PAPER_SOURCES
argument_list|)
expr_stmt|;
operator|*
name|count
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
operator|(
name|i
operator|<
name|NUM_PRINTER_PAPER_SOURCES
operator|)
operator|&&
operator|(
name|caps
operator|.
name|paper_sources
index|[
name|i
index|]
operator|!=
operator|-
literal|1
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|valptrs
index|[
name|i
index|]
operator|=
name|c_strdup
argument_list|(
name|pcl_val_to_string
argument_list|(
name|caps
operator|.
name|paper_sources
index|[
name|i
index|]
argument_list|,
name|pcl_media_sources
argument_list|,
name|NUM_PRINTER_PAPER_SOURCES
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|count
operator|)
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|valptrs
operator|)
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"Resolution"
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
name|count
operator|=
literal|0
expr_stmt|;
name|valptrs
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|NUM_RESOLUTIONS
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|NUM_RESOLUTIONS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|caps
operator|.
name|resolutions
operator|&
name|pcl_resolutions
index|[
name|i
index|]
operator|.
name|pcl_code
condition|)
block|{
name|valptrs
index|[
operator|*
name|count
index|]
operator|=
name|c_strdup
argument_list|(
name|pcl_val_to_string
argument_list|(
name|pcl_resolutions
index|[
name|i
index|]
operator|.
name|pcl_code
argument_list|,
name|pcl_resolutions
argument_list|,
name|NUM_RESOLUTIONS
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|*
name|count
operator|)
operator|++
expr_stmt|;
block|}
block|}
return|return
operator|(
name|valptrs
operator|)
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"InkType"
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|caps
operator|.
name|color_type
operator|&
name|PCL_COLOR_CMYKcm
condition|)
block|{
name|valptrs
operator|=
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
literal|2
argument_list|)
expr_stmt|;
name|valptrs
index|[
literal|0
index|]
operator|=
name|c_strdup
argument_list|(
name|ink_types
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|valptrs
index|[
literal|1
index|]
operator|=
name|c_strdup
argument_list|(
name|ink_types
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
operator|*
name|count
operator|=
literal|2
expr_stmt|;
return|return
operator|(
name|valptrs
operator|)
return|;
block|}
else|else
return|return
operator|(
name|NULL
operator|)
return|;
block|}
else|else
return|return
operator|(
name|NULL
operator|)
return|;
block|}
end_function

begin_comment
comment|/*  * 'pcl_imageable_area()' - Return the imageable area of the page.  */
end_comment

begin_function
name|void
DECL|function|pcl_imageable_area (const printer_t * printer,const vars_t * v,int * left,int * right,int * bottom,int * top)
name|pcl_imageable_area
parameter_list|(
specifier|const
name|printer_t
modifier|*
name|printer
parameter_list|,
comment|/* I - Printer model */
specifier|const
name|vars_t
modifier|*
name|v
parameter_list|,
comment|/* I */
name|int
modifier|*
name|left
parameter_list|,
comment|/* O - Left position in points */
name|int
modifier|*
name|right
parameter_list|,
comment|/* O - Right position in points */
name|int
modifier|*
name|bottom
parameter_list|,
comment|/* O - Bottom position in points */
name|int
modifier|*
name|top
parameter_list|)
comment|/* O - Top position in points */
block|{
name|int
name|width
decl_stmt|,
name|length
decl_stmt|;
comment|/* Size of page */
name|pcl_cap_t
name|caps
decl_stmt|;
comment|/* Printer caps */
name|caps
operator|=
name|pcl_get_model_capabilities
argument_list|(
name|printer
operator|->
name|model
argument_list|)
expr_stmt|;
name|default_media_size
argument_list|(
name|printer
argument_list|,
name|v
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|length
argument_list|)
expr_stmt|;
comment|/*  * Note: The margins actually vary with paper size, but since you can  * move the image around on the page anyway, it hardly matters.  */
operator|*
name|left
operator|=
name|caps
operator|.
name|left_margin
expr_stmt|;
operator|*
name|right
operator|=
name|width
operator|-
name|caps
operator|.
name|right_margin
expr_stmt|;
operator|*
name|top
operator|=
name|length
operator|-
name|caps
operator|.
name|top_margin
expr_stmt|;
operator|*
name|bottom
operator|=
name|caps
operator|.
name|bottom_margin
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|pcl_limit (const printer_t * printer,const vars_t * v,int * width,int * length)
name|pcl_limit
parameter_list|(
specifier|const
name|printer_t
modifier|*
name|printer
parameter_list|,
comment|/* I - Printer model */
specifier|const
name|vars_t
modifier|*
name|v
parameter_list|,
comment|/* I */
name|int
modifier|*
name|width
parameter_list|,
comment|/* O - Left position in points */
name|int
modifier|*
name|length
parameter_list|)
comment|/* O - Top position in points */
block|{
name|pcl_cap_t
name|caps
init|=
name|pcl_get_model_capabilities
argument_list|(
name|printer
operator|->
name|model
argument_list|)
decl_stmt|;
operator|*
name|width
operator|=
name|caps
operator|.
name|max_width
expr_stmt|;
operator|*
name|length
operator|=
name|caps
operator|.
name|max_height
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * 'pcl_print()' - Print an image to an HP printer.  */
end_comment

begin_function
name|void
DECL|function|pcl_print (const printer_t * printer,int copies,FILE * prn,Image image,const vars_t * v)
name|pcl_print
parameter_list|(
specifier|const
name|printer_t
modifier|*
name|printer
parameter_list|,
comment|/* I - Model */
name|int
name|copies
parameter_list|,
comment|/* I - Number of copies */
name|FILE
modifier|*
name|prn
parameter_list|,
comment|/* I - File to print to */
name|Image
name|image
parameter_list|,
comment|/* I - Image to print */
specifier|const
name|vars_t
modifier|*
name|v
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|cmap
init|=
name|v
operator|->
name|cmap
decl_stmt|;
name|int
name|model
init|=
name|printer
operator|->
name|model
decl_stmt|;
specifier|const
name|char
modifier|*
name|resolution
init|=
name|v
operator|->
name|resolution
decl_stmt|;
specifier|const
name|char
modifier|*
name|media_size
decl_stmt|;
specifier|const
name|char
modifier|*
name|media_type
init|=
name|v
operator|->
name|media_type
decl_stmt|;
specifier|const
name|char
modifier|*
name|media_source
init|=
name|v
operator|->
name|media_source
decl_stmt|;
specifier|const
name|char
modifier|*
name|ink_type
init|=
name|v
operator|->
name|ink_type
decl_stmt|;
name|int
name|output_type
init|=
name|v
operator|->
name|output_type
decl_stmt|;
name|int
name|orientation
init|=
name|v
operator|->
name|orientation
decl_stmt|;
name|double
name|scaling
init|=
name|v
operator|->
name|scaling
decl_stmt|;
name|int
name|top
init|=
name|v
operator|->
name|top
decl_stmt|;
name|int
name|left
init|=
name|v
operator|->
name|left
decl_stmt|;
name|int
name|y
decl_stmt|;
comment|/* Looping vars */
name|int
name|xdpi
decl_stmt|,
name|ydpi
decl_stmt|;
comment|/* Resolution */
name|unsigned
name|short
modifier|*
name|out
decl_stmt|;
name|unsigned
name|char
modifier|*
name|in
decl_stmt|,
comment|/* Input pixels */
modifier|*
name|black
decl_stmt|,
comment|/* Black bitmap data */
modifier|*
name|cyan
decl_stmt|,
comment|/* Cyan bitmap data */
modifier|*
name|magenta
decl_stmt|,
comment|/* Magenta bitmap data */
modifier|*
name|yellow
decl_stmt|,
comment|/* Yellow bitmap data */
modifier|*
name|lcyan
decl_stmt|,
comment|/* Light Cyan bitmap data */
modifier|*
name|lmagenta
decl_stmt|;
comment|/* Light Magenta bitmap data */
name|int
name|page_left
decl_stmt|,
comment|/* Left margin of page */
name|page_right
decl_stmt|,
comment|/* Right margin of page */
name|page_top
decl_stmt|,
comment|/* Top of page */
name|page_bottom
decl_stmt|,
comment|/* Bottom of page */
name|page_width
decl_stmt|,
comment|/* Width of page */
name|page_height
decl_stmt|,
comment|/* Height of page */
name|out_width
decl_stmt|,
comment|/* Width of image on page */
name|out_height
decl_stmt|,
comment|/* Height of image on page */
name|out_bpp
decl_stmt|,
comment|/* Output bytes per pixel */
name|length
decl_stmt|,
comment|/* Length of raster data */
name|errdiv
decl_stmt|,
comment|/* Error dividend */
name|errmod
decl_stmt|,
comment|/* Error modulus */
name|errval
decl_stmt|,
comment|/* Current error value */
name|errline
decl_stmt|,
comment|/* Current raster line */
name|errlast
decl_stmt|;
comment|/* Last raster line loaded */
name|convert_t
name|colorfunc
decl_stmt|;
comment|/* Color conversion function... */
name|void
function_decl|(
modifier|*
name|writefunc
function_decl|)
parameter_list|(
name|FILE
modifier|*
parameter_list|,
name|unsigned
name|char
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
comment|/* PCL output function */
name|int
name|image_height
decl_stmt|,
name|image_width
decl_stmt|,
name|image_bpp
decl_stmt|;
name|void
modifier|*
name|dither
decl_stmt|;
name|pcl_cap_t
name|caps
decl_stmt|;
comment|/* Printer capabilities */
name|int
name|do_cret
decl_stmt|,
comment|/* 300 DPI CRet printing */
name|do_6color
decl_stmt|,
comment|/* CMY + cmK printing */
name|planes
decl_stmt|;
comment|/* # of output planes */
name|int
name|pcl_media_size
decl_stmt|,
comment|/* PCL media size code */
name|pcl_media_type
decl_stmt|,
comment|/* PCL media type code */
name|pcl_media_source
decl_stmt|;
comment|/* PCL media source code */
name|vars_t
name|nv
decl_stmt|;
specifier|const
name|papersize_t
modifier|*
name|pp
decl_stmt|;
name|memcpy
argument_list|(
operator|&
name|nv
argument_list|,
name|v
argument_list|,
sizeof|sizeof
argument_list|(
name|vars_t
argument_list|)
argument_list|)
expr_stmt|;
name|caps
operator|=
name|pcl_get_model_capabilities
argument_list|(
name|model
argument_list|)
expr_stmt|;
comment|/*   * Setup a read-only pixel region for the entire image...   */
name|Image_init
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|image_height
operator|=
name|Image_height
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|image_width
operator|=
name|Image_width
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|image_bpp
operator|=
name|Image_bpp
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*   * Figure out the output resolution...   */
name|sscanf
argument_list|(
name|resolution
argument_list|,
literal|"%dx%d"
argument_list|,
operator|&
name|xdpi
argument_list|,
operator|&
name|ydpi
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"pcl: resolution=%dx%d\n"
argument_list|,
name|xdpi
argument_list|,
name|ydpi
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/*   * Choose the correct color conversion function...   */
if|if
condition|(
operator|(
operator|(
name|caps
operator|.
name|resolutions
operator|&
name|PCL_RES_600_600_MONO
operator|)
operator|==
name|PCL_RES_600_600_MONO
operator|)
operator|&&
name|output_type
operator|!=
name|OUTPUT_GRAY
operator|&&
name|xdpi
operator|==
literal|600
operator|&&
name|ydpi
operator|==
literal|600
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"600x600 resolution only available in MONO\n"
argument_list|)
expr_stmt|;
name|output_type
operator|=
name|OUTPUT_GRAY
expr_stmt|;
block|}
if|if
condition|(
name|nv
operator|.
name|image_type
operator|==
name|IMAGE_MONOCHROME
condition|)
block|{
name|output_type
operator|=
name|OUTPUT_GRAY
expr_stmt|;
block|}
if|if
condition|(
name|caps
operator|.
name|color_type
operator|==
name|PCL_COLOR_NONE
condition|)
name|output_type
operator|=
name|OUTPUT_GRAY
expr_stmt|;
name|colorfunc
operator|=
name|choose_colorfunc
argument_list|(
name|output_type
argument_list|,
name|image_bpp
argument_list|,
name|cmap
argument_list|,
operator|&
name|out_bpp
argument_list|,
operator|&
name|nv
argument_list|)
expr_stmt|;
name|do_cret
operator|=
operator|(
name|xdpi
operator|>=
literal|300
operator|&&
operator|(
operator|(
name|caps
operator|.
name|color_type
operator|&
name|PCL_COLOR_CMYK4
operator|)
operator|==
name|PCL_COLOR_CMYK4
operator|)
operator|&&
name|nv
operator|.
name|image_type
operator|!=
name|IMAGE_MONOCHROME
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"do_cret = %d\n"
argument_list|,
name|do_cret
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|do_6color
operator|=
operator|(
name|strcmp
argument_list|(
name|ink_type
argument_list|,
literal|"Color + Photo Cartridges"
argument_list|)
operator|==
literal|0
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"do_6color = %d\n"
argument_list|,
name|do_6color
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/*   * Compute the output size...   */
name|pcl_imageable_area
argument_list|(
name|printer
argument_list|,
operator|&
name|nv
argument_list|,
operator|&
name|page_left
argument_list|,
operator|&
name|page_right
argument_list|,
operator|&
name|page_bottom
argument_list|,
operator|&
name|page_top
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"Before compute_page_parameters()\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"page_left = %d, page_right = %d, page_top = %d, page_bottom = %d\n"
argument_list|,
name|page_left
argument_list|,
name|page_right
argument_list|,
name|page_top
argument_list|,
name|page_bottom
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"top = %d, left = %d\n"
argument_list|,
name|top
argument_list|,
name|left
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"scaling = %f, image_width = %d, image_height = %d\n"
argument_list|,
name|scaling
argument_list|,
name|image_width
argument_list|,
name|image_height
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|compute_page_parameters
argument_list|(
name|page_right
argument_list|,
name|page_left
argument_list|,
name|page_top
argument_list|,
name|page_bottom
argument_list|,
name|scaling
argument_list|,
name|image_width
argument_list|,
name|image_height
argument_list|,
name|image
argument_list|,
operator|&
name|orientation
argument_list|,
operator|&
name|page_width
argument_list|,
operator|&
name|page_height
argument_list|,
operator|&
name|out_width
argument_list|,
operator|&
name|out_height
argument_list|,
operator|&
name|left
argument_list|,
operator|&
name|top
argument_list|)
expr_stmt|;
comment|/*    * Recompute the image height and width.  If the image has been    * rotated, these will change from previously.    */
name|image_height
operator|=
name|Image_height
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|image_width
operator|=
name|Image_width
argument_list|(
name|image
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"After compute_page_parameters()\n"
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"page_width = %d, page_height = %d\n"
argument_list|,
name|page_width
argument_list|,
name|page_height
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"out_width = %d, out_height = %d\n"
argument_list|,
name|out_width
argument_list|,
name|out_height
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"top = %d, left = %d\n"
argument_list|,
name|top
argument_list|,
name|left
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG */
comment|/*   * Let the user know what we're doing...   */
name|Image_progress_init
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*   * Send PCL initialization commands...   */
name|fputs
argument_list|(
literal|"\033E"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* PCL reset */
comment|/*   * Set media size   */
if|if
condition|(
name|strlen
argument_list|(
name|v
operator|->
name|media_size
argument_list|)
operator|>
literal|0
condition|)
name|media_size
operator|=
name|v
operator|->
name|media_size
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pp
operator|=
name|get_papersize_by_size
argument_list|(
name|v
operator|->
name|page_height
argument_list|,
name|v
operator|->
name|page_width
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|media_size
operator|=
name|pp
operator|->
name|name
expr_stmt|;
else|else
name|media_size
operator|=
literal|""
expr_stmt|;
name|pcl_media_size
operator|=
name|pcl_convert_media_size
argument_list|(
name|media_size
argument_list|,
name|model
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"pcl_media_size = %d, media_size = %s\n"
argument_list|,
name|pcl_media_size
argument_list|,
name|media_size
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/*   * If the media size requested is unknown, try it as a custom size.   *   * Warning: The margins may need to be fixed for this!   */
if|if
condition|(
name|pcl_media_size
operator|==
operator|-
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Paper size %s is not directly supported by printer.\n"
argument_list|,
name|media_size
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Trying as custom pagesize (watch the margins!)\n"
argument_list|)
expr_stmt|;
name|pcl_media_size
operator|=
name|PCL_PAPERSIZE_CUSTOM
expr_stmt|;
comment|/* Custom */
block|}
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033&l%dA"
argument_list|,
name|pcl_media_size
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"\033&l0L"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Turn off perforation skip */
name|fputs
argument_list|(
literal|"\033&l0E"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Reset top margin to 0 */
comment|/*   * Convert media source string to the code, if specified.   */
if|if
condition|(
name|strlen
argument_list|(
name|media_source
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|pcl_media_source
operator|=
name|pcl_string_to_val
argument_list|(
name|media_source
argument_list|,
name|pcl_media_sources
argument_list|,
sizeof|sizeof
argument_list|(
name|pcl_media_sources
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|pcl_t
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"pcl_media_source = %d, media_source = %s\n"
argument_list|,
name|pcl_media_source
argument_list|,
name|media_source
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pcl_media_source
operator|==
operator|-
literal|1
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Unknown media source %s, ignored.\n"
argument_list|,
name|media_source
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|pcl_media_source
operator|!=
name|PCL_PAPERSOURCE_STANDARD
condition|)
block|{
comment|/* Correct the value by taking the modulus */
name|pcl_media_source
operator|=
name|pcl_media_source
operator|%
name|PAPERSOURCE_MOD
expr_stmt|;
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033&l%dH"
argument_list|,
name|pcl_media_source
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*   * Convert media type string to the code, if specified.   */
if|if
condition|(
name|strlen
argument_list|(
name|media_type
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|pcl_media_type
operator|=
name|pcl_string_to_val
argument_list|(
name|media_type
argument_list|,
name|pcl_media_types
argument_list|,
sizeof|sizeof
argument_list|(
name|pcl_media_types
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|pcl_t
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"pcl_media_type = %d, media_type = %s\n"
argument_list|,
name|pcl_media_type
argument_list|,
name|media_type
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pcl_media_type
operator|==
operator|-
literal|1
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Unknown media type %s, set to PLAIN.\n"
argument_list|,
name|media_type
argument_list|)
expr_stmt|;
name|pcl_media_type
operator|=
name|PCL_PAPERTYPE_PLAIN
expr_stmt|;
block|}
block|}
else|else
name|pcl_media_type
operator|=
name|PCL_PAPERTYPE_PLAIN
expr_stmt|;
comment|/*   * Set DJ print quality to "best" if resolution>= 300   */
if|if
condition|(
operator|(
name|xdpi
operator|>=
literal|300
operator|)
operator|&&
operator|(
operator|(
name|caps
operator|.
name|printer_type
operator|&
name|PCL_PRINTER_DJ
operator|)
operator|==
name|PCL_PRINTER_DJ
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|caps
operator|.
name|printer_type
operator|&
name|PCL_PRINTER_MEDIATYPE
operator|)
operator|==
name|PCL_PRINTER_MEDIATYPE
condition|)
block|{
name|fputs
argument_list|(
literal|"\033*o1M"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Quality = presentation */
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033&l%dM"
argument_list|,
name|pcl_media_type
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fputs
argument_list|(
literal|"\033*r2Q"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Quality (high) */
name|fputs
argument_list|(
literal|"\033*o2Q"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Shingling (4 passes) */
comment|/* Depletion depends on media type and cart type. */
if|if
condition|(
operator|(
name|pcl_media_type
operator|==
name|PCL_PAPERTYPE_PLAIN
operator|)
operator|||
operator|(
name|pcl_media_type
operator|==
name|PCL_PAPERTYPE_BOND
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|caps
operator|.
name|color_type
operator|&
name|PCL_COLOR_CMY
operator|)
operator|==
name|PCL_COLOR_CMY
condition|)
name|fputs
argument_list|(
literal|"\033*o2D"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Depletion 25% */
else|else
name|fputs
argument_list|(
literal|"\033*o5D"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Depletion 50% with gamma correction */
block|}
elseif|else
if|if
condition|(
operator|(
name|pcl_media_type
operator|==
name|PCL_PAPERTYPE_PREMIUM
operator|)
operator|||
operator|(
name|pcl_media_type
operator|==
name|PCL_PAPERTYPE_GLOSSY
operator|)
operator|||
operator|(
name|pcl_media_type
operator|==
name|PCL_PAPERTYPE_TRANS
operator|)
condition|)
name|fputs
argument_list|(
literal|"\033*o1D"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Depletion none */
block|}
block|}
if|if
condition|(
operator|(
name|xdpi
operator|!=
name|ydpi
operator|)
operator|||
operator|(
name|do_cret
operator|)
operator|||
operator|(
name|do_6color
operator|)
condition|)
comment|/* Set resolution using CRD */
block|{
comment|/*     * Send configure image data command with horizontal and     * vertical resolutions as well as a color count...     */
if|if
condition|(
name|output_type
operator|!=
name|OUTPUT_GRAY
condition|)
if|if
condition|(
operator|(
name|caps
operator|.
name|color_type
operator|&
name|PCL_COLOR_CMY
operator|)
operator|==
name|PCL_COLOR_CMY
condition|)
name|planes
operator|=
literal|3
expr_stmt|;
elseif|else
if|if
condition|(
name|do_6color
condition|)
name|planes
operator|=
literal|6
expr_stmt|;
else|else
name|planes
operator|=
literal|4
expr_stmt|;
else|else
name|planes
operator|=
literal|1
expr_stmt|;
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033*g%dW"
argument_list|,
literal|2
operator|+
operator|(
name|planes
operator|*
literal|6
operator|)
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|2
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Format 2 (Complex Direct Planar) */
name|putc
argument_list|(
name|planes
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* # output planes */
if|if
condition|(
name|planes
operator|!=
literal|3
condition|)
block|{
name|putc
argument_list|(
name|xdpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Black resolution */
name|putc
argument_list|(
name|xdpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|0
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|do_cret
condition|?
literal|4
else|:
literal|2
argument_list|,
name|prn
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|planes
operator|!=
literal|1
condition|)
block|{
name|putc
argument_list|(
name|xdpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Cyan resolution */
name|putc
argument_list|(
name|xdpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|0
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|do_cret
condition|?
literal|4
else|:
literal|2
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|xdpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Magenta resolution */
name|putc
argument_list|(
name|xdpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|0
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|do_cret
condition|?
literal|4
else|:
literal|2
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|xdpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Yellow resolution */
name|putc
argument_list|(
name|xdpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|0
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|do_cret
condition|?
literal|4
else|:
literal|2
argument_list|,
name|prn
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|planes
operator|==
literal|6
condition|)
block|{
name|putc
argument_list|(
name|xdpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Light Cyan resolution */
name|putc
argument_list|(
name|xdpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|0
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|do_cret
condition|?
literal|4
else|:
literal|2
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|xdpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Light Magenta resolution */
name|putc
argument_list|(
name|xdpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
operator|>>
literal|8
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|ydpi
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
literal|0
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|putc
argument_list|(
name|do_cret
condition|?
literal|4
else|:
literal|2
argument_list|,
name|prn
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033*t%dR"
argument_list|,
name|xdpi
argument_list|)
expr_stmt|;
comment|/* Simple resolution */
if|if
condition|(
name|output_type
operator|!=
name|OUTPUT_GRAY
condition|)
block|{
if|if
condition|(
operator|(
name|caps
operator|.
name|color_type
operator|&
name|PCL_COLOR_CMY
operator|)
operator|==
name|PCL_COLOR_CMY
condition|)
name|fputs
argument_list|(
literal|"\033*r-3U"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Simple CMY color */
else|else
name|fputs
argument_list|(
literal|"\033*r-4U"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Simple KCMY color */
block|}
block|}
ifndef|#
directive|ifndef
name|PCL_DEBUG_DISABLE_COMPRESSION
if|if
condition|(
operator|(
name|caps
operator|.
name|printer_type
operator|&
name|PCL_PRINTER_TIFF
operator|)
operator|==
name|PCL_PRINTER_TIFF
condition|)
block|{
name|fputs
argument_list|(
literal|"\033*b2M"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Mode 2 (TIFF) */
name|writefunc
operator|=
name|pcl_mode2
expr_stmt|;
block|}
else|else
endif|#
directive|endif
block|{
name|fputs
argument_list|(
literal|"\033*b0M"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Mode 0 (no compression) */
name|writefunc
operator|=
name|pcl_mode0
expr_stmt|;
block|}
comment|/*   * Convert image size to printer resolution and setup the page for printing...   */
name|out_width
operator|=
name|xdpi
operator|*
name|out_width
operator|/
literal|72
expr_stmt|;
name|out_height
operator|=
name|ydpi
operator|*
name|out_height
operator|/
literal|72
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"left %d margin %d top %d margin %d width %d height %d\n"
argument_list|,
name|left
argument_list|,
name|caps
operator|.
name|left_margin
argument_list|,
name|top
argument_list|,
name|caps
operator|.
name|top_margin
argument_list|,
name|out_width
argument_list|,
name|out_height
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033&a%dH"
argument_list|,
literal|10
operator|*
name|left
argument_list|)
expr_stmt|;
comment|/* Set left raster position */
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033&a%dV"
argument_list|,
literal|10
operator|*
operator|(
name|top
operator|+
name|caps
operator|.
name|top_margin
operator|)
argument_list|)
expr_stmt|;
comment|/* Set top raster position */
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033*r%dS"
argument_list|,
name|out_width
argument_list|)
expr_stmt|;
comment|/* Set raster width */
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033*r%dT"
argument_list|,
name|out_height
argument_list|)
expr_stmt|;
comment|/* Set raster height */
name|fputs
argument_list|(
literal|"\033*r1A"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Start GFX */
comment|/*   * Allocate memory for the raster data...   */
name|length
operator|=
operator|(
name|out_width
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
if|if
condition|(
name|do_cret
condition|)
name|length
operator|*=
literal|2
expr_stmt|;
if|if
condition|(
name|output_type
operator|==
name|OUTPUT_GRAY
condition|)
block|{
name|black
operator|=
name|malloc
argument_list|(
name|length
argument_list|)
expr_stmt|;
name|cyan
operator|=
name|NULL
expr_stmt|;
name|magenta
operator|=
name|NULL
expr_stmt|;
name|yellow
operator|=
name|NULL
expr_stmt|;
name|lcyan
operator|=
name|NULL
expr_stmt|;
name|lmagenta
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|cyan
operator|=
name|malloc
argument_list|(
name|length
argument_list|)
expr_stmt|;
name|magenta
operator|=
name|malloc
argument_list|(
name|length
argument_list|)
expr_stmt|;
name|yellow
operator|=
name|malloc
argument_list|(
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|caps
operator|.
name|color_type
operator|&
name|PCL_COLOR_CMY
operator|)
operator|==
name|PCL_COLOR_CMY
condition|)
name|black
operator|=
name|NULL
expr_stmt|;
else|else
name|black
operator|=
name|malloc
argument_list|(
name|length
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_6color
condition|)
block|{
name|lcyan
operator|=
name|malloc
argument_list|(
name|length
argument_list|)
expr_stmt|;
name|lmagenta
operator|=
name|malloc
argument_list|(
name|length
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|lcyan
operator|=
name|NULL
expr_stmt|;
name|lmagenta
operator|=
name|NULL
expr_stmt|;
block|}
block|}
comment|/*   * Output the page, rotating as necessary...   */
name|compute_lut
argument_list|(
literal|256
argument_list|,
operator|&
name|nv
argument_list|)
expr_stmt|;
if|if
condition|(
name|xdpi
operator|>
name|ydpi
condition|)
name|dither
operator|=
name|init_dither
argument_list|(
name|image_width
argument_list|,
name|out_width
argument_list|,
literal|1
argument_list|,
name|xdpi
operator|/
name|ydpi
argument_list|,
operator|&
name|nv
argument_list|)
expr_stmt|;
else|else
name|dither
operator|=
name|init_dither
argument_list|(
name|image_width
argument_list|,
name|out_width
argument_list|,
name|ydpi
operator|/
name|xdpi
argument_list|,
literal|1
argument_list|,
operator|&
name|nv
argument_list|)
expr_stmt|;
comment|/* Set up dithering for special printers. */
if|#
directive|if
literal|0
comment|/* Leave alone for now */
block|dither_set_black_levels(dither, 1.5, 1.5, 1.5);   dither_set_black_lower(dither, .4);   dither_set_black_upper(dither, .999);
endif|#
directive|endif
if|if
condition|(
name|do_cret
condition|)
comment|/* 4-level printing for 800/1120 */
block|{
name|dither_set_y_ranges_simple
argument_list|(
name|dither
argument_list|,
literal|3
argument_list|,
name|dot_sizes
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
name|dither_set_k_ranges_simple
argument_list|(
name|dither
argument_list|,
literal|3
argument_list|,
name|dot_sizes
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
comment|/* Note: no printer I know of does both CRet (4-level) and 6 colour, but    what the heck. variable_dither_ranges copied from print-escp2.c */
if|if
condition|(
name|do_6color
condition|)
comment|/* Photo for 69x */
block|{
name|dither_set_c_ranges
argument_list|(
name|dither
argument_list|,
literal|6
argument_list|,
name|variable_dither_ranges
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
name|dither_set_m_ranges
argument_list|(
name|dither
argument_list|,
literal|6
argument_list|,
name|variable_dither_ranges
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dither_set_c_ranges_simple
argument_list|(
name|dither
argument_list|,
literal|3
argument_list|,
name|dot_sizes
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
name|dither_set_m_ranges_simple
argument_list|(
name|dither
argument_list|,
literal|3
argument_list|,
name|dot_sizes
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
comment|/* Set light inks for 6 colour printers. Numbers copied from print-escp2.c */
if|if
condition|(
name|do_6color
condition|)
name|dither_set_light_inks
argument_list|(
name|dither
argument_list|,
literal|.25
argument_list|,
literal|.25
argument_list|,
literal|0.0
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|nv
operator|.
name|image_type
condition|)
block|{
case|case
name|IMAGE_LINE_ART
case|:
name|dither_set_ink_spread
argument_list|(
name|dither
argument_list|,
literal|19
argument_list|)
expr_stmt|;
break|break;
case|case
name|IMAGE_SOLID_TONE
case|:
name|dither_set_ink_spread
argument_list|(
name|dither
argument_list|,
literal|15
argument_list|)
expr_stmt|;
break|break;
case|case
name|IMAGE_CONTINUOUS
case|:
name|dither_set_ink_spread
argument_list|(
name|dither
argument_list|,
literal|14
argument_list|)
expr_stmt|;
break|break;
block|}
name|dither_set_density
argument_list|(
name|dither
argument_list|,
name|nv
operator|.
name|density
argument_list|)
expr_stmt|;
name|in
operator|=
name|malloc
argument_list|(
name|image_width
operator|*
name|image_bpp
argument_list|)
expr_stmt|;
name|out
operator|=
name|malloc
argument_list|(
name|image_width
operator|*
name|out_bpp
operator|*
literal|2
argument_list|)
expr_stmt|;
name|errdiv
operator|=
name|image_height
operator|/
name|out_height
expr_stmt|;
name|errmod
operator|=
name|image_height
operator|%
name|out_height
expr_stmt|;
name|errval
operator|=
literal|0
expr_stmt|;
name|errlast
operator|=
operator|-
literal|1
expr_stmt|;
name|errline
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|out_height
condition|;
name|y
operator|++
control|)
block|{
name|int
name|duplicate_line
init|=
literal|1
decl_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|printf
argument_list|(
literal|"pcl_print: y = %d, line = %d, val = %d, mod = %d, height = %d\n"
argument_list|,
name|y
argument_list|,
name|errline
argument_list|,
name|errval
argument_list|,
name|errmod
argument_list|,
name|out_height
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* DEBUG */
if|if
condition|(
operator|(
name|y
operator|&
literal|63
operator|)
operator|==
literal|0
condition|)
name|Image_note_progress
argument_list|(
name|image
argument_list|,
name|y
argument_list|,
name|out_height
argument_list|)
expr_stmt|;
if|if
condition|(
name|errline
operator|!=
name|errlast
condition|)
block|{
name|errlast
operator|=
name|errline
expr_stmt|;
name|duplicate_line
operator|=
literal|0
expr_stmt|;
name|Image_get_row
argument_list|(
name|image
argument_list|,
name|in
argument_list|,
name|errline
argument_list|)
expr_stmt|;
call|(
modifier|*
name|colorfunc
call|)
argument_list|(
name|in
argument_list|,
name|out
argument_list|,
name|image_width
argument_list|,
name|image_bpp
argument_list|,
name|cmap
argument_list|,
operator|&
name|nv
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|do_cret
condition|)
block|{
comment|/*       * 4-level (CRet) dithers...       */
if|if
condition|(
name|output_type
operator|==
name|OUTPUT_GRAY
condition|)
block|{
name|dither_black
argument_list|(
name|out
argument_list|,
name|y
argument_list|,
name|dither
argument_list|,
name|black
argument_list|,
name|duplicate_line
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|black
operator|+
name|length
operator|/
literal|2
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|black
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dither_cmyk
argument_list|(
name|out
argument_list|,
name|y
argument_list|,
name|dither
argument_list|,
name|cyan
argument_list|,
name|lcyan
argument_list|,
name|magenta
argument_list|,
name|lmagenta
argument_list|,
name|yellow
argument_list|,
name|NULL
argument_list|,
name|black
argument_list|,
name|duplicate_line
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|black
operator|+
name|length
operator|/
literal|2
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|black
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|cyan
operator|+
name|length
operator|/
literal|2
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|cyan
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|magenta
operator|+
name|length
operator|/
literal|2
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|magenta
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|yellow
operator|+
name|length
operator|/
literal|2
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_6color
condition|)
block|{
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|yellow
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|lcyan
operator|+
name|length
operator|/
literal|2
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|lcyan
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|lmagenta
operator|+
name|length
operator|/
literal|2
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|lmagenta
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Last plane set on light magenta */
block|}
else|else
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|yellow
argument_list|,
name|length
operator|/
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Last plane set on yellow */
block|}
block|}
else|else
block|{
comment|/*       * Standard 2-level dithers...       */
if|if
condition|(
name|output_type
operator|==
name|OUTPUT_GRAY
condition|)
block|{
if|if
condition|(
name|nv
operator|.
name|image_type
operator|==
name|IMAGE_MONOCHROME
condition|)
name|dither_monochrome
argument_list|(
name|out
argument_list|,
name|y
argument_list|,
name|dither
argument_list|,
name|black
argument_list|,
name|duplicate_line
argument_list|)
expr_stmt|;
else|else
name|dither_black
argument_list|(
name|out
argument_list|,
name|y
argument_list|,
name|dither
argument_list|,
name|black
argument_list|,
name|duplicate_line
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|black
argument_list|,
name|length
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dither_cmyk
argument_list|(
name|out
argument_list|,
name|y
argument_list|,
name|dither
argument_list|,
name|cyan
argument_list|,
name|lcyan
argument_list|,
name|magenta
argument_list|,
name|lmagenta
argument_list|,
name|yellow
argument_list|,
name|NULL
argument_list|,
name|black
argument_list|,
name|duplicate_line
argument_list|)
expr_stmt|;
if|if
condition|(
name|black
operator|!=
name|NULL
condition|)
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|black
argument_list|,
name|length
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|cyan
argument_list|,
name|length
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|magenta
argument_list|,
name|length
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_6color
condition|)
block|{
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|yellow
argument_list|,
name|length
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|lcyan
argument_list|,
name|length
argument_list|,
literal|0
argument_list|)
expr_stmt|;
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|lmagenta
argument_list|,
name|length
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Last plane set on light magenta */
block|}
else|else
call|(
modifier|*
name|writefunc
call|)
argument_list|(
name|prn
argument_list|,
name|yellow
argument_list|,
name|length
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Last plane set on yellow */
block|}
block|}
name|errval
operator|+=
name|errmod
expr_stmt|;
name|errline
operator|+=
name|errdiv
expr_stmt|;
if|if
condition|(
name|errval
operator|>=
name|out_height
condition|)
block|{
name|errval
operator|-=
name|out_height
expr_stmt|;
name|errline
operator|++
expr_stmt|;
block|}
block|}
name|Image_progress_conclude
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|free_dither
argument_list|(
name|dither
argument_list|)
expr_stmt|;
comment|/*   * Cleanup...   */
name|free_lut
argument_list|(
operator|&
name|nv
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|out
argument_list|)
expr_stmt|;
if|if
condition|(
name|black
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|black
argument_list|)
expr_stmt|;
if|if
condition|(
name|cyan
operator|!=
name|NULL
condition|)
block|{
name|free
argument_list|(
name|cyan
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|magenta
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|yellow
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|lcyan
operator|!=
name|NULL
condition|)
block|{
name|free
argument_list|(
name|lcyan
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|lmagenta
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|caps
operator|.
name|printer_type
operator|&
name|PCL_PRINTER_NEW_ERG
operator|)
operator|==
name|PCL_PRINTER_NEW_ERG
condition|)
name|fputs
argument_list|(
literal|"\033*rC"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
else|else
name|fputs
argument_list|(
literal|"\033*rB"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"\033&l0H"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* Eject page */
name|fputs
argument_list|(
literal|"\033E"
argument_list|,
name|prn
argument_list|)
expr_stmt|;
comment|/* PCL reset */
block|}
end_function

begin_comment
comment|/*  * 'pcl_mode0()' - Send PCL graphics using mode 0 (no) compression.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|pcl_mode0 (FILE * prn,unsigned char * line,int length,int last_plane)
name|pcl_mode0
parameter_list|(
name|FILE
modifier|*
name|prn
parameter_list|,
comment|/* I - Print file or command */
name|unsigned
name|char
modifier|*
name|line
parameter_list|,
comment|/* I - Output bitmap data */
name|int
name|length
parameter_list|,
comment|/* I - Length of bitmap data */
name|int
name|last_plane
parameter_list|)
comment|/* I - True if this is the last plane */
block|{
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033*b%d%c"
argument_list|,
name|length
argument_list|,
name|last_plane
condition|?
literal|'W'
else|:
literal|'V'
argument_list|)
expr_stmt|;
name|fwrite
argument_list|(
name|line
argument_list|,
name|length
argument_list|,
literal|1
argument_list|,
name|prn
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * 'pcl_mode2()' - Send PCL graphics using mode 2 (TIFF) compression.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|pcl_mode2 (FILE * prn,unsigned char * line,int length,int last_plane)
name|pcl_mode2
parameter_list|(
name|FILE
modifier|*
name|prn
parameter_list|,
comment|/* I - Print file or command */
name|unsigned
name|char
modifier|*
name|line
parameter_list|,
comment|/* I - Output bitmap data */
name|int
name|length
parameter_list|,
comment|/* I - Length of bitmap data */
name|int
name|last_plane
parameter_list|)
comment|/* I - True if this is the last plane */
block|{
name|unsigned
name|char
name|comp_buf
index|[
literal|1536
index|]
decl_stmt|,
comment|/* Compression buffer */
modifier|*
name|comp_ptr
decl_stmt|,
comment|/* Current slot in buffer */
modifier|*
name|start
decl_stmt|,
comment|/* Start of compressed data */
name|repeat
decl_stmt|;
comment|/* Repeating char */
name|int
name|count
decl_stmt|,
comment|/* Count of compressed bytes */
name|tcount
decl_stmt|;
comment|/* Temporary count< 128 */
comment|/*   * Compress using TIFF "packbits" run-length encoding...   */
name|comp_ptr
operator|=
name|comp_buf
expr_stmt|;
while|while
condition|(
name|length
operator|>
literal|0
condition|)
block|{
comment|/*     * Get a run of non-repeated chars...     */
name|start
operator|=
name|line
expr_stmt|;
name|line
operator|+=
literal|2
expr_stmt|;
name|length
operator|-=
literal|2
expr_stmt|;
while|while
condition|(
name|length
operator|>
literal|0
operator|&&
operator|(
name|line
index|[
operator|-
literal|2
index|]
operator|!=
name|line
index|[
operator|-
literal|1
index|]
operator|||
name|line
index|[
operator|-
literal|1
index|]
operator|!=
name|line
index|[
literal|0
index|]
operator|)
condition|)
block|{
name|line
operator|++
expr_stmt|;
name|length
operator|--
expr_stmt|;
block|}
name|line
operator|-=
literal|2
expr_stmt|;
name|length
operator|+=
literal|2
expr_stmt|;
comment|/*     * Output the non-repeated sequences (max 128 at a time).     */
name|count
operator|=
name|line
operator|-
name|start
expr_stmt|;
while|while
condition|(
name|count
operator|>
literal|0
condition|)
block|{
name|tcount
operator|=
name|count
operator|>
literal|128
condition|?
literal|128
else|:
name|count
expr_stmt|;
name|comp_ptr
index|[
literal|0
index|]
operator|=
name|tcount
operator|-
literal|1
expr_stmt|;
name|memcpy
argument_list|(
name|comp_ptr
operator|+
literal|1
argument_list|,
name|start
argument_list|,
name|tcount
argument_list|)
expr_stmt|;
name|comp_ptr
operator|+=
name|tcount
operator|+
literal|1
expr_stmt|;
name|start
operator|+=
name|tcount
expr_stmt|;
name|count
operator|-=
name|tcount
expr_stmt|;
block|}
if|if
condition|(
name|length
operator|<=
literal|0
condition|)
break|break;
comment|/*     * Find the repeated sequences...     */
name|start
operator|=
name|line
expr_stmt|;
name|repeat
operator|=
name|line
index|[
literal|0
index|]
expr_stmt|;
name|line
operator|++
expr_stmt|;
name|length
operator|--
expr_stmt|;
while|while
condition|(
name|length
operator|>
literal|0
operator|&&
operator|*
name|line
operator|==
name|repeat
condition|)
block|{
name|line
operator|++
expr_stmt|;
name|length
operator|--
expr_stmt|;
block|}
comment|/*     * Output the repeated sequences (max 128 at a time).     */
name|count
operator|=
name|line
operator|-
name|start
expr_stmt|;
while|while
condition|(
name|count
operator|>
literal|0
condition|)
block|{
name|tcount
operator|=
name|count
operator|>
literal|128
condition|?
literal|128
else|:
name|count
expr_stmt|;
name|comp_ptr
index|[
literal|0
index|]
operator|=
literal|1
operator|-
name|tcount
expr_stmt|;
name|comp_ptr
index|[
literal|1
index|]
operator|=
name|repeat
expr_stmt|;
name|comp_ptr
operator|+=
literal|2
expr_stmt|;
name|count
operator|-=
name|tcount
expr_stmt|;
block|}
block|}
comment|/*   * Send a line of raster graphics...   */
name|fprintf
argument_list|(
name|prn
argument_list|,
literal|"\033*b%d%c"
argument_list|,
call|(
name|int
call|)
argument_list|(
name|comp_ptr
operator|-
name|comp_buf
argument_list|)
argument_list|,
name|last_plane
condition|?
literal|'W'
else|:
literal|'V'
argument_list|)
expr_stmt|;
name|fwrite
argument_list|(
name|comp_buf
argument_list|,
name|comp_ptr
operator|-
name|comp_buf
argument_list|,
literal|1
argument_list|,
name|prn
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

