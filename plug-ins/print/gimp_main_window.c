begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *   Main window code for Print plug-in for the GIMP.  *  *   Copyright 1997-2000 Michael Sweet (mike@easysw.com),  *	Robert Krawitz (rlk@alum.mit.edu), Steve Miller (smiller@rni.net)  *      and Michael Natterer (mitch@gimp.org)  *  *   This program is free software; you can redistribute it and/or modify it  *   under the terms of the GNU General Public License as published by the Free  *   Software Foundation; either version 2 of the License, or (at your option)  *   any later version.  *  *   This program is distributed in the hope that it will be useful, but  *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY  *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License  *   for more details.  *  *   You should have received a copy of the GNU General Public License  *   along with this program; if not, write to the Free Software  *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_warning
warning|#
directive|warning
warning|GTK_DISABLE_DEPRECATED
end_warning

begin_endif
endif|#
directive|endif
end_endif

begin_undef
undef|#
directive|undef
name|GTK_DISABLE_DEPRECATED
end_undef

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<gimp-print/gimp-print.h>
end_include

begin_include
include|#
directive|include
file|"libgimp/gimp.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpui.h"
end_include

begin_include
include|#
directive|include
file|"print_gimp.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|RESPONSE_ABOUT
define|#
directive|define
name|RESPONSE_ABOUT
value|1
end_define

begin_define
DECL|macro|RESPONSE_SAVE
define|#
directive|define
name|RESPONSE_SAVE
value|2
end_define

begin_define
DECL|macro|RESPONSE_PRINTSAVE
define|#
directive|define
name|RESPONSE_PRINTSAVE
value|3
end_define

begin_define
DECL|macro|MAX_PREVIEW_PPI
define|#
directive|define
name|MAX_PREVIEW_PPI
value|40
end_define

begin_comment
comment|/*  * Constants for GUI.  */
end_comment

begin_define
DECL|macro|PREVIEW_SIZE_VERT
define|#
directive|define
name|PREVIEW_SIZE_VERT
value|360
end_define

begin_define
DECL|macro|PREVIEW_SIZE_HORIZ
define|#
directive|define
name|PREVIEW_SIZE_HORIZ
value|260
end_define

begin_define
DECL|macro|MOVE_CONSTRAIN
define|#
directive|define
name|MOVE_CONSTRAIN
value|0
end_define

begin_define
DECL|macro|MOVE_HORIZONTAL
define|#
directive|define
name|MOVE_HORIZONTAL
value|1
end_define

begin_define
DECL|macro|MOVE_VERTICAL
define|#
directive|define
name|MOVE_VERTICAL
value|2
end_define

begin_define
DECL|macro|MOVE_ANY
define|#
directive|define
name|MOVE_ANY
value|(MOVE_HORIZONTAL | MOVE_VERTICAL)
end_define

begin_comment
comment|/*  *  Main window widgets  */
end_comment

begin_decl_stmt
DECL|variable|main_vbox
specifier|static
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|main_hbox
specifier|static
name|GtkWidget
modifier|*
name|main_hbox
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|right_vbox
specifier|static
name|GtkWidget
modifier|*
name|right_vbox
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|notebook
specifier|static
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|print_dialog
specifier|static
name|GtkWidget
modifier|*
name|print_dialog
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|print_dialog
comment|/* Print dialog window */
end_comment

begin_decl_stmt
DECL|variable|recenter_button
specifier|static
name|GtkWidget
modifier|*
name|recenter_button
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|recenter_vertical_button
specifier|static
name|GtkWidget
modifier|*
name|recenter_vertical_button
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|recenter_horizontal_button
specifier|static
name|GtkWidget
modifier|*
name|recenter_horizontal_button
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|left_entry
specifier|static
name|GtkWidget
modifier|*
name|left_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|right_entry
specifier|static
name|GtkWidget
modifier|*
name|right_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|right_border_entry
specifier|static
name|GtkWidget
modifier|*
name|right_border_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|width_entry
specifier|static
name|GtkWidget
modifier|*
name|width_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|top_entry
specifier|static
name|GtkWidget
modifier|*
name|top_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|bottom_entry
specifier|static
name|GtkWidget
modifier|*
name|bottom_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|bottom_border_entry
specifier|static
name|GtkWidget
modifier|*
name|bottom_border_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|height_entry
specifier|static
name|GtkWidget
modifier|*
name|height_entry
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|unit_inch
specifier|static
name|GtkWidget
modifier|*
name|unit_inch
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|unit_cm
specifier|static
name|GtkWidget
modifier|*
name|unit_cm
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|media_size_combo
specifier|static
name|GtkWidget
modifier|*
name|media_size_combo
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|media_size_combo
comment|/* Media size combo box */
end_comment

begin_decl_stmt
DECL|variable|custom_size_width
specifier|static
name|GtkWidget
modifier|*
name|custom_size_width
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|custom_size_height
specifier|static
name|GtkWidget
modifier|*
name|custom_size_height
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|media_size_callback_id
specifier|static
name|gint
name|media_size_callback_id
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|media_type_combo
specifier|static
name|GtkWidget
modifier|*
name|media_type_combo
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|media_type_combo
comment|/* Media type combo box */
end_comment

begin_decl_stmt
DECL|variable|media_type_callback_id
specifier|static
name|gint
name|media_type_callback_id
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|media_type_callback_id
comment|/* Media type calback ID */
end_comment

begin_decl_stmt
DECL|variable|media_source_combo
specifier|static
name|GtkWidget
modifier|*
name|media_source_combo
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|media_source_combo
comment|/* Media source combo box */
end_comment

begin_decl_stmt
DECL|variable|media_source_callback_id
specifier|static
name|gint
name|media_source_callback_id
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|media_source_callback_id
comment|/* Media source calback ID */
end_comment

begin_decl_stmt
DECL|variable|ink_type_combo
specifier|static
name|GtkWidget
modifier|*
name|ink_type_combo
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|ink_type_combo
comment|/* Ink type combo box */
end_comment

begin_decl_stmt
DECL|variable|ink_type_callback_id
specifier|static
name|gint
name|ink_type_callback_id
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|ink_type_callback_id
comment|/* Ink type calback ID */
end_comment

begin_decl_stmt
DECL|variable|resolution_combo
specifier|static
name|GtkWidget
modifier|*
name|resolution_combo
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|resolution_combo
comment|/* Resolution combo box */
end_comment

begin_decl_stmt
DECL|variable|resolution_callback_id
specifier|static
name|gint
name|resolution_callback_id
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|resolution_callback_id
comment|/* Resolution calback ID */
end_comment

begin_decl_stmt
DECL|variable|orientation_menu
specifier|static
name|GtkWidget
modifier|*
name|orientation_menu
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|orientation_menu
comment|/* Orientation menu */
end_comment

begin_decl_stmt
DECL|variable|scaling_percent
specifier|static
name|GtkWidget
modifier|*
name|scaling_percent
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|scaling_percent
comment|/* Scale by percent */
end_comment

begin_decl_stmt
DECL|variable|scaling_ppi
specifier|static
name|GtkWidget
modifier|*
name|scaling_ppi
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|scaling_ppi
comment|/* Scale by pixels-per-inch */
end_comment

begin_decl_stmt
DECL|variable|scaling_image
specifier|static
name|GtkWidget
modifier|*
name|scaling_image
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|scaling_image
comment|/* Scale to the image */
end_comment

begin_decl_stmt
DECL|variable|output_gray
specifier|static
name|GtkWidget
modifier|*
name|output_gray
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|output_gray
comment|/* Output type toggle, black */
end_comment

begin_decl_stmt
DECL|variable|output_color
specifier|static
name|GtkWidget
modifier|*
name|output_color
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|output_color
comment|/* Output type toggle, color */
end_comment

begin_decl_stmt
DECL|variable|output_monochrome
specifier|static
name|GtkWidget
modifier|*
name|output_monochrome
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|image_line_art
specifier|static
name|GtkWidget
modifier|*
name|image_line_art
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|image_solid_tone
specifier|static
name|GtkWidget
modifier|*
name|image_solid_tone
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|image_continuous_tone
specifier|static
name|GtkWidget
modifier|*
name|image_continuous_tone
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|setup_dialog
specifier|static
name|GtkWidget
modifier|*
name|setup_dialog
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|setup_dialog
comment|/* Setup dialog window */
end_comment

begin_decl_stmt
DECL|variable|printer_driver
specifier|static
name|GtkWidget
modifier|*
name|printer_driver
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printer_driver
comment|/* Printer driver widget */
end_comment

begin_decl_stmt
DECL|variable|printer_model_label
specifier|static
name|GtkWidget
modifier|*
name|printer_model_label
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printer_model_label
comment|/* Printer model name */
end_comment

begin_decl_stmt
DECL|variable|printer_crawler
specifier|static
name|GtkWidget
modifier|*
name|printer_crawler
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printer_crawler
comment|/* Scrolled Window for menu */
end_comment

begin_decl_stmt
DECL|variable|printer_combo
specifier|static
name|GtkWidget
modifier|*
name|printer_combo
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printer_combo
comment|/* Combo for menu */
end_comment

begin_decl_stmt
DECL|variable|plist_callback_id
specifier|static
name|gint
name|plist_callback_id
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|ppd_file
specifier|static
name|GtkWidget
modifier|*
name|ppd_file
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|ppd_file
comment|/* PPD file entry */
end_comment

begin_decl_stmt
DECL|variable|ppd_label
specifier|static
name|GtkWidget
modifier|*
name|ppd_label
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|ppd_label
comment|/* PPD file entry */
end_comment

begin_decl_stmt
DECL|variable|ppd_button
specifier|static
name|GtkWidget
modifier|*
name|ppd_button
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|ppd_button
comment|/* PPD file browse button */
end_comment

begin_decl_stmt
DECL|variable|output_cmd
specifier|static
name|GtkWidget
modifier|*
name|output_cmd
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|output_cmd
comment|/* Output command text entry */
end_comment

begin_decl_stmt
DECL|variable|output_label
specifier|static
name|GtkWidget
modifier|*
name|output_label
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|output_label
comment|/* Output command label */
end_comment

begin_decl_stmt
DECL|variable|ppd_browser
specifier|static
name|GtkWidget
modifier|*
name|ppd_browser
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|ppd_browser
comment|/* File selection dialog for PPD files */
end_comment

begin_decl_stmt
DECL|variable|new_printer_dialog
specifier|static
name|GtkWidget
modifier|*
name|new_printer_dialog
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|new_printer_dialog
comment|/* New printer dialog window */
end_comment

begin_decl_stmt
DECL|variable|new_printer_entry
specifier|static
name|GtkWidget
modifier|*
name|new_printer_entry
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|new_printer_entry
comment|/* New printer text entry */
end_comment

begin_decl_stmt
DECL|variable|file_browser
specifier|static
name|GtkWidget
modifier|*
name|file_browser
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|file_browser
comment|/* FSD for print files */
end_comment

begin_decl_stmt
DECL|variable|adjust_color_button
specifier|static
name|GtkWidget
modifier|*
name|adjust_color_button
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|about_dialog
specifier|static
name|GtkWidget
modifier|*
name|about_dialog
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|scaling_adjustment
specifier|static
name|GtkObject
modifier|*
name|scaling_adjustment
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|scaling_adjustment
comment|/* Adjustment object for scaling */
end_comment

begin_decl_stmt
DECL|variable|suppress_scaling_adjustment
specifier|static
name|gboolean
name|suppress_scaling_adjustment
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|suppress_scaling_callback
specifier|static
name|gboolean
name|suppress_scaling_callback
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|suppress_preview_update
specifier|static
name|gint
name|suppress_preview_update
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|preview_valid
specifier|static
name|gint
name|preview_valid
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|preview
specifier|static
name|GtkWidget
modifier|*
name|preview
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|preview
comment|/* Preview drawing area widget */
end_comment

begin_decl_stmt
DECL|variable|paper_left
specifier|static
name|gint
name|paper_left
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|paper_top
specifier|static
name|gint
name|paper_top
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|orient
specifier|static
name|gint
name|orient
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|mouse_x
specifier|static
name|gint
name|mouse_x
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|mouse_x
comment|/* Last mouse X */
end_comment

begin_decl_stmt
DECL|variable|mouse_y
specifier|static
name|gint
name|mouse_y
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|mouse_y
comment|/* Last mouse Y */
end_comment

begin_decl_stmt
DECL|variable|old_top
specifier|static
name|gint
name|old_top
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|old_top
comment|/* Previous position */
end_comment

begin_decl_stmt
DECL|variable|old_left
specifier|static
name|gint
name|old_left
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|old_left
comment|/* Previous position */
end_comment

begin_decl_stmt
DECL|variable|buttons_pressed
specifier|static
name|gint
name|buttons_pressed
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|preview_active
specifier|static
name|gint
name|preview_active
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|buttons_mask
specifier|static
name|gint
name|buttons_mask
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|move_constraint
specifier|static
name|gint
name|move_constraint
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|mouse_button
specifier|static
name|gint
name|mouse_button
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|mouse_button
comment|/* Button being dragged with */
end_comment

begin_decl_stmt
DECL|variable|suppress_preview_reset
specifier|static
name|gint
name|suppress_preview_reset
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|printable_left
specifier|static
name|gint
name|printable_left
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printable_left
comment|/* Left pixel column of page */
end_comment

begin_decl_stmt
DECL|variable|printable_top
specifier|static
name|gint
name|printable_top
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printable_top
comment|/* Top pixel row of page */
end_comment

begin_decl_stmt
DECL|variable|printable_width
specifier|static
name|gint
name|printable_width
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printable_width
comment|/* Width of page on screen */
end_comment

begin_decl_stmt
DECL|variable|printable_height
specifier|static
name|gint
name|printable_height
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|printable_height
comment|/* Height of page on screen */
end_comment

begin_decl_stmt
DECL|variable|print_width
specifier|static
name|gint
name|print_width
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|print_width
comment|/* Printed width of image */
end_comment

begin_decl_stmt
DECL|variable|print_height
specifier|static
name|gint
name|print_height
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|print_height
comment|/* Printed height of image */
end_comment

begin_decl_stmt
DECL|variable|left
DECL|variable|right
specifier|static
name|gint
name|left
decl_stmt|,
name|right
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|left
DECL|variable|right
comment|/* Imageable area */
end_comment

begin_decl_stmt
DECL|variable|top
DECL|variable|bottom
specifier|static
name|gint
name|top
decl_stmt|,
name|bottom
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|paper_width
DECL|variable|paper_height
specifier|static
name|gint
name|paper_width
decl_stmt|,
name|paper_height
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|paper_width
DECL|variable|paper_height
comment|/* Physical width */
end_comment

begin_decl_stmt
DECL|variable|num_media_sizes
specifier|static
name|gint
name|num_media_sizes
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|media_sizes
specifier|static
name|stp_param_t
modifier|*
name|media_sizes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|num_media_types
specifier|static
name|gint
name|num_media_types
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|num_media_types
comment|/* Number of media types */
end_comment

begin_decl_stmt
DECL|variable|media_types
specifier|static
name|stp_param_t
modifier|*
name|media_types
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|media_types
comment|/* Media type strings */
end_comment

begin_decl_stmt
DECL|variable|num_media_sources
specifier|static
name|gint
name|num_media_sources
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|num_media_sources
comment|/* Number of media sources */
end_comment

begin_decl_stmt
DECL|variable|media_sources
specifier|static
name|stp_param_t
modifier|*
name|media_sources
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|media_sources
comment|/* Media source strings */
end_comment

begin_decl_stmt
DECL|variable|num_ink_types
specifier|static
name|gint
name|num_ink_types
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|num_ink_types
comment|/* Number of ink types */
end_comment

begin_decl_stmt
DECL|variable|ink_types
specifier|static
name|stp_param_t
modifier|*
name|ink_types
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|ink_types
comment|/* Ink type strings */
end_comment

begin_decl_stmt
DECL|variable|num_resolutions
specifier|static
name|gint
name|num_resolutions
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|num_resolutions
comment|/* Number of resolutions */
end_comment

begin_decl_stmt
DECL|variable|resolutions
specifier|static
name|stp_param_t
modifier|*
name|resolutions
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|resolutions
comment|/* Resolution strings */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_scaling_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_scaling_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_plist_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_media_size_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_media_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_media_source_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_ink_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_output_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_unit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_orientation_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_response_callback
parameter_list|(
name|GtkWidget
modifier|*
name|dialog
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_setup_update
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_setup_open_callback
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_setup_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_new_printer_open_callback
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_new_printer_activate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_new_printer_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_ppd_browse_callback
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_ppd_response
parameter_list|(
name|GtkWidget
modifier|*
name|dialog
parameter_list|,
name|gint
name|response_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_print_driver_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_file_response
parameter_list|(
name|GtkWidget
modifier|*
name|dialog
parameter_list|,
name|gint
name|response_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_preview_update
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_preview_expose
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_preview_button_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_preview_motion_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventMotion
modifier|*
name|mevent
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_position_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|preview_ppi
specifier|static
name|gdouble
name|preview_ppi
init|=
literal|10
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pv
name|stp_vars_t
modifier|*
name|pv
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|set_adjustment_tooltip (GtkObject * adj,const gchar * tip,const gchar * private)
name|set_adjustment_tooltip
parameter_list|(
name|GtkObject
modifier|*
name|adj
parameter_list|,
specifier|const
name|gchar
modifier|*
name|tip
parameter_list|,
specifier|const
name|gchar
modifier|*
name|private
parameter_list|)
block|{
name|gimp_help_set_help_data
argument_list|(
name|GTK_WIDGET
argument_list|(
name|GIMP_SCALE_ENTRY_SCALE
argument_list|(
name|adj
argument_list|)
argument_list|)
argument_list|,
name|tip
argument_list|,
name|private
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|GTK_WIDGET
argument_list|(
name|GIMP_SCALE_ENTRY_SPINBUTTON
argument_list|(
name|adj
argument_list|)
argument_list|)
argument_list|,
name|tip
argument_list|,
name|private
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|char
modifier|*
DECL|function|Combo_get_name (GtkWidget * combo,gint num_options,stp_param_t * options)
name|Combo_get_name
parameter_list|(
name|GtkWidget
modifier|*
name|combo
parameter_list|,
name|gint
name|num_options
parameter_list|,
name|stp_param_t
modifier|*
name|options
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|text
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|GTK_COMBO
argument_list|(
name|combo
argument_list|)
operator|->
name|entry
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|text
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|num_options
operator|==
literal|0
condition|)
return|return
name|text
return|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_options
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcasecmp
argument_list|(
name|options
index|[
name|i
index|]
operator|.
name|text
argument_list|,
name|text
argument_list|)
operator|==
literal|0
condition|)
return|return
operator|(
name|options
index|[
name|i
index|]
operator|.
name|name
operator|)
return|;
return|return
name|NULL
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|printer_list
specifier|static
name|stp_param_t
modifier|*
name|printer_list
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|printer_count
specifier|static
name|int
name|printer_count
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|reset_preview (void)
name|reset_preview
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
operator|!
name|suppress_preview_reset
condition|)
block|{
name|gimp_help_enable_tooltips
argument_list|()
expr_stmt|;
name|buttons_pressed
operator|=
name|preview_active
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_entry_value (GtkWidget * entry,gdouble value,gboolean block)
name|set_entry_value
parameter_list|(
name|GtkWidget
modifier|*
name|entry
parameter_list|,
name|gdouble
name|value
parameter_list|,
name|gboolean
name|block
parameter_list|)
block|{
name|gchar
name|s
index|[
literal|255
index|]
decl_stmt|;
name|g_snprintf
argument_list|(
name|s
argument_list|,
sizeof|sizeof
argument_list|(
name|s
argument_list|)
argument_list|,
literal|"%.2f"
argument_list|,
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|block
condition|)
block|{
name|g_signal_handlers_block_by_func
argument_list|(
name|entry
argument_list|,
name|gimp_position_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_handlers_block_by_func
argument_list|(
name|entry
argument_list|,
name|gimp_media_size_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|block
condition|)
block|{
name|g_signal_handlers_unblock_by_func
argument_list|(
name|entry
argument_list|,
name|gimp_position_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_handlers_unblock_by_func
argument_list|(
name|entry
argument_list|,
name|gimp_media_size_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_build_printer_combo (void)
name|gimp_build_printer_combo
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
if|if
condition|(
name|printer_list
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|printer_count
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|printer_list
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|printer_list
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|printer_list
argument_list|)
expr_stmt|;
block|}
name|printer_list
operator|=
name|g_new
argument_list|(
name|stp_param_t
argument_list|,
name|plist_count
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|plist_count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|plist
index|[
name|i
index|]
operator|.
name|active
condition|)
block|{
name|printer_list
index|[
name|i
index|]
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|plist
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|printer_list
index|[
name|i
index|]
operator|.
name|text
operator|=
name|g_strdup
argument_list|(
name|plist
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|printer_list
index|[
name|i
index|]
operator|.
name|name
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|plist
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|printer_list
index|[
name|i
index|]
operator|.
name|text
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|plist
index|[
name|i
index|]
operator|.
name|name
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|printer_list
index|[
name|i
index|]
operator|.
name|name
operator|+
literal|1
argument_list|,
name|plist
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
operator|(
operator|(
name|char
operator|*
operator|)
name|printer_list
index|[
name|i
index|]
operator|.
name|name
operator|)
index|[
literal|0
index|]
operator|=
literal|'*'
expr_stmt|;
name|strcpy
argument_list|(
operator|(
name|char
operator|*
operator|)
name|printer_list
index|[
name|i
index|]
operator|.
name|text
operator|+
literal|1
argument_list|,
name|plist
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
operator|(
operator|(
name|char
operator|*
operator|)
name|printer_list
index|[
name|i
index|]
operator|.
name|text
operator|)
index|[
literal|0
index|]
operator|=
literal|'*'
expr_stmt|;
block|}
block|}
name|printer_count
operator|=
name|plist_count
expr_stmt|;
name|gimp_plist_build_combo
argument_list|(
name|printer_combo
argument_list|,
name|printer_count
argument_list|,
name|printer_list
argument_list|,
name|printer_list
index|[
name|plist_current
index|]
operator|.
name|text
argument_list|,
name|NULL
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_plist_callback
argument_list|)
argument_list|,
operator|&
name|plist_callback_id
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_top_level_structure (void)
name|create_top_level_structure
parameter_list|(
name|void
parameter_list|)
block|{
name|gchar
modifier|*
name|plug_in_name
decl_stmt|;
comment|/*    * Create the main dialog    */
name|plug_in_name
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%s -- Print v%s"
argument_list|)
argument_list|,
name|image_name
argument_list|,
name|PLUG_IN_VERSION
argument_list|)
expr_stmt|;
name|print_dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|plug_in_name
argument_list|,
literal|"print"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"file-print-gimp"
argument_list|,
name|_
argument_list|(
literal|"About"
argument_list|)
argument_list|,
name|RESPONSE_ABOUT
argument_list|,
name|_
argument_list|(
literal|"Save\nSettings"
argument_list|)
argument_list|,
name|RESPONSE_SAVE
argument_list|,
name|_
argument_list|(
literal|"Print and\nSave Settings"
argument_list|)
argument_list|,
name|RESPONSE_PRINTSAVE
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_PRINT
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|print_dialog
argument_list|)
argument_list|,
name|RESPONSE_ABOUT
argument_list|,
name|RESPONSE_SAVE
argument_list|,
name|RESPONSE_PRINTSAVE
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|plug_in_name
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|print_dialog
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_response_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|print_dialog
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_main_quit
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * Top-level containers    */
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|print_dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|main_vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
name|main_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|main_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_hbox
argument_list|)
expr_stmt|;
name|right_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|right_vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|right_vbox
argument_list|)
expr_stmt|;
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|right_vbox
argument_list|)
argument_list|,
name|notebook
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_preview (void)
name|create_preview
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|event_box
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|event_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|event_box
argument_list|)
expr_stmt|;
name|preview
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|preview
argument_list|,
name|PREVIEW_SIZE_HORIZ
operator|+
literal|1
argument_list|,
name|PREVIEW_SIZE_VERT
operator|+
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|preview
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|preview
argument_list|,
literal|"expose-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_preview_expose
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|preview
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_preview_button_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|preview
argument_list|,
literal|"button-release-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_preview_button_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|preview
argument_list|,
literal|"motion-notify-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_preview_motion_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|GTK_WIDGET
argument_list|(
name|preview
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Position the image on the page.\n"
literal|"Click and drag with the primary button to position the image.\n"
literal|"Click and drag with the second button to move the image with finer precision; "
literal|"each unit of motion moves the image one point (1/72\")\n"
literal|"Click and drag with the third (middle) button to move the image in units of "
literal|"the image size.\n"
literal|"Holding down the shift key while clicking and dragging constrains the image to "
literal|"only horizontal or vertical motion.\n"
literal|"If you click another button while dragging the mouse, the image will return "
literal|"to its original position."
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|GTK_WIDGET
argument_list|(
name|preview
argument_list|)
argument_list|,
name|GDK_EXPOSURE_MASK
operator||
name|GDK_BUTTON_MOTION_MASK
operator||
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_positioning_frame (void)
name|create_positioning_frame
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|box
decl_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Position"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|right_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|5
argument_list|,
literal|4
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    * Orientation option menu.    */
name|orientation_menu
operator|=
name|gimp_int_combo_box_new
argument_list|(
name|_
argument_list|(
literal|"Auto"
argument_list|)
argument_list|,
name|ORIENT_AUTO
argument_list|,
name|_
argument_list|(
literal|"Portrait"
argument_list|)
argument_list|,
name|ORIENT_PORTRAIT
argument_list|,
name|_
argument_list|(
literal|"Landscape"
argument_list|)
argument_list|,
name|ORIENT_LANDSCAPE
argument_list|,
name|_
argument_list|(
literal|"Upside down"
argument_list|)
argument_list|,
name|ORIENT_UPSIDEDOWN
argument_list|,
name|_
argument_list|(
literal|"Seascape"
argument_list|)
argument_list|,
name|ORIENT_SEASCAPE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|orientation_menu
argument_list|)
argument_list|,
name|ORIENT_AUTO
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|orientation_menu
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_orientation_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|orientation_menu
argument_list|,
name|_
argument_list|(
literal|"Select the orientation: portrait, landscape, "
literal|"upside down, or seascape (upside down "
literal|"landscape)"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Orientation:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|orientation_menu
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*    * Position entries    */
name|left_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|left_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"Left:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|left_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|left_entry
argument_list|,
name|_
argument_list|(
literal|"Distance from the left of the paper to the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|left_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|top_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|top_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"Top:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|top_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|top_entry
argument_list|,
name|_
argument_list|(
literal|"Distance from the top of the paper to the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|top_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|right_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|right_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"Right:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|right_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|right_entry
argument_list|,
name|_
argument_list|(
literal|"Distance from the left of the paper to "
literal|"the right of the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|right_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|right_border_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|right_border_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
name|_
argument_list|(
literal|"Right border:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|right_border_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|right_border_entry
argument_list|,
name|_
argument_list|(
literal|"Distance from the right of the paper to "
literal|"the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|right_border_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|bottom_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|bottom_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"Bottom:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|bottom_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|bottom_entry
argument_list|,
name|_
argument_list|(
literal|"Distance from the top of the paper to "
literal|"the bottom of the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|bottom_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|bottom_border_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|bottom_border_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|4
argument_list|,
name|_
argument_list|(
literal|"Bottom border:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|bottom_border_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|bottom_border_entry
argument_list|,
name|_
argument_list|(
literal|"Distance from the bottom of the paper to "
literal|"the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|bottom_border_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * Center options    */
name|box
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|6
argument_list|,
name|_
argument_list|(
literal|"Center:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|box
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|recenter_vertical_button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Vertically"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|recenter_vertical_button
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|recenter_vertical_button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|recenter_vertical_button
argument_list|,
name|_
argument_list|(
literal|"Center the image vertically on the paper"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|recenter_vertical_button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|recenter_button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Both"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|recenter_button
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|recenter_button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|recenter_button
argument_list|,
name|_
argument_list|(
literal|"Center the image on the paper"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|recenter_button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|recenter_horizontal_button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Horizontally"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|recenter_horizontal_button
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|recenter_horizontal_button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|recenter_horizontal_button
argument_list|,
name|_
argument_list|(
literal|"Center the image horizontally on the paper"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|recenter_horizontal_button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_printer_dialog (void)
name|create_printer_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|box
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|event_box
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|setup_dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Setup Printer"
argument_list|)
argument_list|,
literal|"print"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"file-print-gimp"
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|setup_dialog
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_setup_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * Top-level table for dialog.    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|5
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|setup_dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    * Printer driver option menu.    */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Printer Model:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|event_box
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|event_box
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Select your printer model"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|printer_crawler
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|printer_crawler
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|printer_crawler
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|printer_crawler
argument_list|)
expr_stmt|;
name|printer_driver
operator|=
name|gtk_clist_new
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|printer_driver
argument_list|,
literal|200
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_clist_set_selection_mode
argument_list|(
name|GTK_CLIST
argument_list|(
name|printer_driver
argument_list|)
argument_list|,
name|GTK_SELECTION_SINGLE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|printer_crawler
argument_list|)
argument_list|,
name|printer_driver
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|printer_driver
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|printer_driver
argument_list|,
literal|"select_row"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_print_driver_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|stp_known_printers
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|stp_printer_t
name|the_printer
init|=
name|stp_get_printer_by_index
argument_list|(
name|i
argument_list|)
decl_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|stp_printer_get_long_name
argument_list|(
name|the_printer
argument_list|)
argument_list|,
literal|""
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|gchar
modifier|*
name|tmp
init|=
name|g_strdup
argument_list|(
name|gettext
argument_list|(
name|stp_printer_get_long_name
argument_list|(
name|the_printer
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|gtk_clist_insert
argument_list|(
name|GTK_CLIST
argument_list|(
name|printer_driver
argument_list|)
argument_list|,
name|i
argument_list|,
operator|&
name|tmp
argument_list|)
expr_stmt|;
name|gtk_clist_set_row_data
argument_list|(
name|GTK_CLIST
argument_list|(
name|printer_driver
argument_list|)
argument_list|,
name|i
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*    * PPD file.    */
name|ppd_label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"PPD File:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|ppd_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|ppd_label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ppd_label
argument_list|)
expr_stmt|;
name|box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|box
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|box
argument_list|)
expr_stmt|;
name|ppd_file
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|ppd_file
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ppd_file
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|ppd_file
argument_list|,
name|_
argument_list|(
literal|"Enter the PPD filename for your printer"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|ppd_button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Browse"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|ppd_button
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|ppd_button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ppd_button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|ppd_button
argument_list|,
name|_
argument_list|(
literal|"Choose the PPD file for your printer"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|ppd_button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_ppd_browse_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * Print command.    */
name|output_label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Command:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|output_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|output_label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|output_label
argument_list|)
expr_stmt|;
name|output_cmd
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|output_cmd
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|output_cmd
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|output_cmd
argument_list|,
name|_
argument_list|(
literal|"Enter the command to print to your printer. "
literal|"Note: Please do not remove the `-l' or `-oraw' from "
literal|"the command string, or printing will probably fail!"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * PPD file selection dialog.    */
name|ppd_browser
operator|=
name|gtk_file_chooser_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Choose PPD File"
argument_list|)
argument_list|,
name|GTK_WINDOW
argument_list|(
name|setup_dialog
argument_list|)
argument_list|,
name|GTK_FILE_CHOOSER_ACTION_OPEN
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|ppd_browser
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|ppd_browser
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|ppd_browser
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_ppd_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_new_printer_dialog (void)
name|create_new_printer_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|new_printer_dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Define New Printer"
argument_list|)
argument_list|,
literal|"print"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"file-print-gimp"
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|new_printer_dialog
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_new_printer_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|new_printer_dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|new_printer_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_entry_set_max_length
argument_list|(
name|GTK_ENTRY
argument_list|(
name|new_printer_entry
argument_list|)
argument_list|,
literal|127
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Printer name:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|new_printer_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|new_printer_entry
argument_list|,
name|_
argument_list|(
literal|"Enter the name you wish to give this logical printer"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|new_printer_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_new_printer_activate
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_about_dialog (void)
name|create_about_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|about_dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"About Gimp-Print "
name|PLUG_IN_VERSION
argument_list|)
argument_list|,
literal|"print"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"file-print-gimp"
argument_list|,
name|GTK_STOCK_CLOSE
argument_list|,
name|GTK_RESPONSE_CLOSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|about_dialog
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_hide
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Gimp-Print Version "
name|PLUG_IN_VERSION
literal|"\n"
literal|"\n"
literal|"Copyright (C) 1997-2001 Michael Sweet, Robert Krawitz,\n"
literal|"and the rest of the Gimp-Print Development Team.\n"
literal|"\n"
literal|"Please visit our web site at http://gimp-print.sourceforge.net.\n"
literal|"\n"
literal|"This program is free software; you can redistribute it and/or modify\n"
literal|"it under the terms of the GNU General Public License as published by\n"
literal|"the Free Software Foundation; either version 2 of the License, or\n"
literal|"(at your option) any later version.\n"
literal|"\n"
literal|"This program is distributed in the hope that it will be useful,\n"
literal|"but WITHOUT ANY WARRANTY; without even the implied warranty of\n"
literal|"MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n"
literal|"GNU General Public License for more details.\n"
literal|"\n"
literal|"You should have received a copy of the GNU General Public License\n"
literal|"along with this program; if not, write to the Free Software\n"
literal|"Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  "
literal|"USA\n"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|12
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|about_dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_printer_settings_frame (void)
name|create_printer_settings_frame
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|printer_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|media_size_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|event_box
decl_stmt|;
name|create_printer_dialog
argument_list|()
expr_stmt|;
name|create_about_dialog
argument_list|()
expr_stmt|;
name|create_new_printer_dialog
argument_list|()
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|9
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|table
argument_list|,
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Printer Settings"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    * Printer option menu.    */
name|printer_combo
operator|=
name|gtk_combo_new
argument_list|()
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|printer_combo
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|printer_combo
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Select the name of the printer (not the type, "
literal|"or model, of printer) that you wish to print to"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Printer name:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|event_box
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|printer_model_label
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|printer_model_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"Printer model:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|printer_model_label
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|printer_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|printer_hbox
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|printer_hbox
argument_list|)
expr_stmt|;
comment|/*    * Setup printer button    */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Setup Printer..."
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Choose the printer model, PPD file, and command "
literal|"that is used to print to this printer"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|button
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|printer_hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_setup_open_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * New printer button    */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"New Printer..."
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Define a new logical printer. This can be used to "
literal|"name a collection of settings that you wish to "
literal|"remember for future use."
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|printer_hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_new_printer_open_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * Media size combo box.    */
name|media_size_combo
operator|=
name|gtk_combo_new
argument_list|()
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|media_size_combo
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|media_size_combo
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Size of paper that you wish to print to"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"Media size:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|event_box
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*    * Custom media size entries    */
name|media_size_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
name|_
argument_list|(
literal|"Dimensions:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|media_size_hbox
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Width:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|media_size_hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|custom_size_width
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|custom_size_width
argument_list|,
literal|40
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|media_size_hbox
argument_list|)
argument_list|,
name|custom_size_width
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|custom_size_width
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|custom_size_width
argument_list|,
name|_
argument_list|(
literal|"Width of the paper that you wish to print to"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|custom_size_width
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_media_size_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Height:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|media_size_hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|custom_size_height
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|custom_size_height
argument_list|,
literal|50
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|media_size_hbox
argument_list|)
argument_list|,
name|custom_size_height
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|custom_size_height
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|custom_size_height
argument_list|,
name|_
argument_list|(
literal|"Height of the paper that you wish to print to"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|custom_size_height
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_media_size_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * Media type combo box.    */
name|media_type_combo
operator|=
name|gtk_combo_new
argument_list|()
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|media_type_combo
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|media_type_combo
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Type of media you're printing to"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
name|_
argument_list|(
literal|"Media type:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|event_box
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*    * Media source combo box.    */
name|media_source_combo
operator|=
name|gtk_combo_new
argument_list|()
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|media_source_combo
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|media_source_combo
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Source (input slot) of media you're printing to"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|6
argument_list|,
name|_
argument_list|(
literal|"Media source:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|event_box
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*    * Ink type combo box.    */
name|ink_type_combo
operator|=
name|gtk_combo_new
argument_list|()
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|ink_type_combo
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ink_type_combo
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Type of ink in the printer"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|7
argument_list|,
name|_
argument_list|(
literal|"Ink type:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|event_box
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*    * Resolution combo box.    */
name|resolution_combo
operator|=
name|gtk_combo_new
argument_list|()
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|resolution_combo
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|resolution_combo
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Resolution and quality of the print"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|8
argument_list|,
name|_
argument_list|(
literal|"Resolution:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|event_box
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_scaling_frame (void)
name|create_scaling_frame
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|box
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|event_box
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Size"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*    * Create the scaling adjustment using percent.  It doesn't really matter,    * since as soon as we call gimp_plist_callback at the end of initialization    * everything will be put right.    */
name|scaling_adjustment
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Scaling:"
argument_list|)
argument_list|,
literal|100
argument_list|,
literal|75
argument_list|,
name|stp_get_scaling
argument_list|(
name|stp_default_settings
argument_list|()
argument_list|)
argument_list|,
name|stp_get_scaling
argument_list|(
name|stp_minimum_settings
argument_list|()
argument_list|)
argument_list|,
name|stp_get_scaling
argument_list|(
name|stp_maximum_settings
argument_list|()
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|set_adjustment_tooltip
argument_list|(
name|scaling_adjustment
argument_list|,
name|_
argument_list|(
literal|"Set the scale (size) of the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|scaling_adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_scaling_update
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|box
argument_list|)
expr_stmt|;
comment|/*    * The scale by percent/ppi toggles    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|event_box
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|event_box
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Scale by:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Select whether scaling is measured as percent of "
literal|"available page size or number of output dots per "
literal|"inch"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|scaling_percent
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Percent"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|scaling_percent
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|scaling_percent
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|scaling_percent
argument_list|,
name|_
argument_list|(
literal|"Scale the print to the size of the page"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|scaling_percent
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_scaling_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|scaling_ppi
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"PPI"
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|scaling_ppi
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|scaling_ppi
argument_list|,
name|_
argument_list|(
literal|"Scale the print to the number of dots per inch"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|scaling_ppi
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_scaling_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * The width/height enries    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|width_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|width_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Width:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|width_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|width_entry
argument_list|,
name|_
argument_list|(
literal|"Set the width of the print"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|width_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|height_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|height_entry
argument_list|,
literal|60
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"Height:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|height_entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|height_entry
argument_list|,
name|_
argument_list|(
literal|"Set the height of the print"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|height_entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_position_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * The inch/cm toggles    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|event_box
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|event_box
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Units:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Select the base unit of measurement for printing"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|unit_inch
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Inch"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|unit_inch
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|unit_inch
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|unit_inch
argument_list|,
name|_
argument_list|(
literal|"Set the base unit of measurement to inches"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|unit_inch
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_unit_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|unit_cm
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"cm"
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|unit_cm
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|unit_cm
argument_list|,
name|_
argument_list|(
literal|"Set the base unit of measurement to centimetres"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|unit_cm
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_unit_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
comment|/*    * The "image size" button    */
name|scaling_image
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Use Original\nImage Size"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|scaling_image
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|6
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|scaling_image
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scaling_image
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|scaling_image
argument_list|,
name|_
argument_list|(
literal|"Set the print size to the size of the image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|scaling_image
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_scaling_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_image_settings_frame (void)
name|create_image_settings_frame
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkSizeGroup
modifier|*
name|size_group
init|=
name|gtk_size_group_new
argument_list|(
name|GTK_SIZE_GROUP_HORIZONTAL
argument_list|)
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|event_box
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|gimp_create_color_adjust_window
argument_list|()
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Image / Output Settings"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|event_box
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|event_box
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Image type:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_size_group_add_widget
argument_list|(
name|size_group
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|size_group
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Optimize the output for the type of image "
literal|"being printed"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|image_line_art
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Line art"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|image_line_art
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|image_line_art
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|image_line_art
argument_list|,
name|_
argument_list|(
literal|"Fastest and brightest color for text and "
literal|"line art"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|image_line_art
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_type_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|IMAGE_LINE_ART
argument_list|)
argument_list|)
expr_stmt|;
name|image_solid_tone
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"Solid colors"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|image_solid_tone
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|image_solid_tone
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|image_solid_tone
argument_list|,
name|_
argument_list|(
literal|"Best for images dominated by regions of "
literal|"solid color"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|image_solid_tone
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_type_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|IMAGE_SOLID_TONE
argument_list|)
argument_list|)
expr_stmt|;
name|image_continuous_tone
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"Photograph"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|image_continuous_tone
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|image_continuous_tone
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image_continuous_tone
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|image_continuous_tone
argument_list|,
name|_
argument_list|(
literal|"Slowest, but most accurate and smoothest color "
literal|"for continuous tone images and photographs"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|image_continuous_tone
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_type_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|IMAGE_CONTINUOUS
argument_list|)
argument_list|)
expr_stmt|;
comment|/*    * Output type toggles.    */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|event_box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|event_box
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|event_box
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Output type:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|event_box
argument_list|)
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_size_group_add_widget
argument_list|(
name|size_group
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|event_box
argument_list|,
name|_
argument_list|(
literal|"Select the desired output type"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|output_color
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Color"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|output_color
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|output_color
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|output_color
argument_list|,
name|_
argument_list|(
literal|"Color output"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|output_color
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_output_type_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|OUTPUT_COLOR
argument_list|)
argument_list|)
expr_stmt|;
name|output_gray
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"Grayscale"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|output_gray
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|output_gray
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|output_gray
argument_list|,
name|_
argument_list|(
literal|"Print in shades of gray using black ink"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|output_gray
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_output_type_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|OUTPUT_GRAY
argument_list|)
argument_list|)
expr_stmt|;
name|output_monochrome
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"Black and white"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|output_monochrome
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|output_monochrome
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|output_monochrome
argument_list|,
name|_
argument_list|(
literal|"Print in black and white (no color, and no shades "
literal|"of gray)"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|output_monochrome
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_output_type_callback
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|OUTPUT_MONOCHROME
argument_list|)
argument_list|)
expr_stmt|;
comment|/*    *  Color adjust button    */
name|adjust_color_button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Adjust Output..."
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|adjust_color_button
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|NULL
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
name|adjust_color_button
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|adjust_color_button
argument_list|,
name|_
argument_list|(
literal|"Adjust color balance, brightness, contrast, "
literal|"saturation, and dither algorithm"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|adjust_color_button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_window_present
argument_list|)
argument_list|,
name|gimp_color_adjust_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_create_main_window()  */
end_comment

begin_function
name|void
DECL|function|gimp_create_main_window (void)
name|gimp_create_main_window
parameter_list|(
name|void
parameter_list|)
block|{
name|pv
operator|=
operator|&
operator|(
name|plist
index|[
name|plist_current
index|]
operator|.
name|v
operator|)
expr_stmt|;
comment|/*    * Create the various dialog components.  Note that we're not    * actually initializing the values at this point; that will be done after    * the UI is fully created.    */
name|create_top_level_structure
argument_list|()
expr_stmt|;
name|create_preview
argument_list|()
expr_stmt|;
name|create_printer_settings_frame
argument_list|()
expr_stmt|;
name|create_positioning_frame
argument_list|()
expr_stmt|;
name|create_scaling_frame
argument_list|()
expr_stmt|;
name|create_image_settings_frame
argument_list|()
expr_stmt|;
comment|/*    * Output file selection dialog.    */
name|file_browser
operator|=
name|gtk_file_chooser_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Print to File"
argument_list|)
argument_list|,
name|GTK_WINDOW
argument_list|(
name|print_dialog
argument_list|)
argument_list|,
name|GTK_FILE_CHOOSER_ACTION_SAVE
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_PRINT
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|file_browser
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|file_browser
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|file_browser
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_file_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*    * Now actually set up the correct values in the dialog    */
name|gimp_build_printer_combo
argument_list|()
expr_stmt|;
name|gimp_plist_callback
argument_list|(
name|NULL
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|plist_current
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_update_adjusted_thumbnail
argument_list|()
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|print_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_scaling_update() - Update the scaling scale using the slider.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_scaling_update (GtkAdjustment * adjustment)
name|gimp_scaling_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|)
block|{
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|!=
name|adjustment
operator|->
name|value
condition|)
block|{
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_ppi
argument_list|)
operator|->
name|active
condition|)
name|stp_set_scaling
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
name|adjustment
operator|->
name|value
argument_list|)
expr_stmt|;
else|else
name|stp_set_scaling
argument_list|(
operator|*
name|pv
argument_list|,
name|adjustment
operator|->
name|value
argument_list|)
expr_stmt|;
block|}
name|suppress_scaling_adjustment
operator|=
name|TRUE
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
name|suppress_scaling_adjustment
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_scaling_callback() - Update the scaling scale using radio buttons.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_scaling_callback (GtkWidget * widget)
name|gimp_scaling_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
specifier|const
name|stp_vars_t
name|lower
init|=
name|stp_minimum_settings
argument_list|()
decl_stmt|;
name|gdouble
name|max_ppi_scaling
decl_stmt|;
name|gdouble
name|min_ppi_scaling
decl_stmt|,
name|min_ppi_scaling1
decl_stmt|,
name|min_ppi_scaling2
decl_stmt|;
name|gdouble
name|current_scale
decl_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|suppress_scaling_callback
condition|)
return|return;
name|min_ppi_scaling1
operator|=
literal|72.0
operator|*
operator|(
name|gdouble
operator|)
name|image_width
operator|/
operator|(
name|gdouble
operator|)
name|printable_width
expr_stmt|;
name|min_ppi_scaling2
operator|=
literal|72.0
operator|*
operator|(
name|gdouble
operator|)
name|image_height
operator|/
operator|(
name|gdouble
operator|)
name|printable_height
expr_stmt|;
if|if
condition|(
name|min_ppi_scaling1
operator|>
name|min_ppi_scaling2
condition|)
name|min_ppi_scaling
operator|=
name|min_ppi_scaling1
expr_stmt|;
else|else
name|min_ppi_scaling
operator|=
name|min_ppi_scaling2
expr_stmt|;
name|max_ppi_scaling
operator|=
name|min_ppi_scaling
operator|*
literal|100
operator|/
name|stp_get_scaling
argument_list|(
name|lower
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|scaling_ppi
condition|)
block|{
if|if
condition|(
operator|!
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_ppi
argument_list|)
operator|->
name|active
condition|)
return|return;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|lower
operator|=
name|min_ppi_scaling
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|upper
operator|=
name|max_ppi_scaling
expr_stmt|;
comment|/*        * Compute the correct PPI to create an image of the same size        * as the one measured in percent        */
name|current_scale
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
name|min_ppi_scaling
operator|/
operator|(
name|current_scale
operator|/
literal|100
operator|)
expr_stmt|;
name|stp_set_scaling
argument_list|(
operator|*
name|pv
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|widget
operator|==
name|scaling_percent
condition|)
block|{
name|gdouble
name|new_percent
decl_stmt|;
if|if
condition|(
operator|!
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_percent
argument_list|)
operator|->
name|active
condition|)
return|return;
name|current_scale
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|lower
operator|=
name|stp_get_scaling
argument_list|(
name|lower
argument_list|)
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|upper
operator|=
literal|100.0
expr_stmt|;
name|new_percent
operator|=
literal|100
operator|*
name|min_ppi_scaling
operator|/
name|current_scale
expr_stmt|;
if|if
condition|(
name|new_percent
operator|>
literal|100
condition|)
name|new_percent
operator|=
literal|100
expr_stmt|;
if|if
condition|(
name|new_percent
operator|<
name|stp_get_scaling
argument_list|(
name|lower
argument_list|)
condition|)
name|new_percent
operator|=
name|stp_get_scaling
argument_list|(
name|lower
argument_list|)
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
name|new_percent
expr_stmt|;
name|stp_set_scaling
argument_list|(
operator|*
name|pv
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|widget
operator|==
name|scaling_image
condition|)
block|{
name|gdouble
name|xres
decl_stmt|,
name|yres
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|gimp_image_get_resolution
argument_list|(
name|image_ID
argument_list|,
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|lower
operator|=
name|min_ppi_scaling
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|upper
operator|=
name|max_ppi_scaling
expr_stmt|;
if|if
condition|(
name|yres
operator|<
name|min_ppi_scaling
condition|)
name|yres
operator|=
name|min_ppi_scaling
expr_stmt|;
if|if
condition|(
name|yres
operator|>
name|max_ppi_scaling
condition|)
name|yres
operator|=
name|max_ppi_scaling
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_ppi
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
name|yres
expr_stmt|;
name|stp_set_scaling
argument_list|(
operator|*
name|pv
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
name|gtk_adjustment_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/****************************************************************************  *  * gimp_plist_build_combo  *  ****************************************************************************/
end_comment

begin_function
name|void
DECL|function|gimp_plist_build_combo (GtkWidget * combo,gint num_items,stp_param_t * items,const gchar * cur_item,const gchar * def_value,GCallback callback,gint * callback_id)
name|gimp_plist_build_combo
parameter_list|(
name|GtkWidget
modifier|*
name|combo
parameter_list|,
comment|/* I - Combo widget */
name|gint
name|num_items
parameter_list|,
comment|/* I - Number of items */
name|stp_param_t
modifier|*
name|items
parameter_list|,
comment|/* I - Menu items */
specifier|const
name|gchar
modifier|*
name|cur_item
parameter_list|,
comment|/* I - Current item */
specifier|const
name|gchar
modifier|*
name|def_value
parameter_list|,
comment|/* I - default item */
name|GCallback
name|callback
parameter_list|,
comment|/* I - Callback */
name|gint
modifier|*
name|callback_id
parameter_list|)
comment|/* IO - Callback ID (init to -1) */
block|{
name|gint
name|i
decl_stmt|;
comment|/* Looping var */
name|GList
modifier|*
name|list
init|=
name|NULL
decl_stmt|;
name|GtkEntry
modifier|*
name|entry
init|=
name|GTK_ENTRY
argument_list|(
name|GTK_COMBO
argument_list|(
name|combo
argument_list|)
operator|->
name|entry
argument_list|)
decl_stmt|;
if|if
condition|(
operator|*
name|callback_id
operator|!=
operator|-
literal|1
condition|)
name|g_signal_handler_disconnect
argument_list|(
name|entry
argument_list|,
operator|*
name|callback_id
argument_list|)
expr_stmt|;
name|gtk_editable_set_editable
argument_list|(
name|GTK_EDITABLE
argument_list|(
name|entry
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_items
operator|==
literal|0
condition|)
block|{
name|list
operator|=
name|g_list_append
argument_list|(
name|list
argument_list|,
name|_
argument_list|(
literal|"Standard"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_combo_set_popdown_strings
argument_list|(
name|GTK_COMBO
argument_list|(
name|combo
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
operator|*
name|callback_id
operator|=
operator|-
literal|1
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|combo
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|combo
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|list
operator|=
name|g_list_prepend
argument_list|(
name|list
argument_list|,
name|g_strdup
argument_list|(
name|items
index|[
name|i
index|]
operator|.
name|text
argument_list|)
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_list_reverse
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|gtk_combo_set_popdown_strings
argument_list|(
name|GTK_COMBO
argument_list|(
name|combo
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
operator|*
name|callback_id
operator|=
name|g_signal_connect
argument_list|(
name|entry
argument_list|,
literal|"changed"
argument_list|,
name|callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|items
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|cur_item
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|i
operator|>=
name|num_items
condition|)
block|{
if|if
condition|(
name|def_value
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|items
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|def_value
argument_list|)
operator|==
literal|0
condition|)
break|break;
if|if
condition|(
name|i
operator|>=
name|num_items
condition|)
name|i
operator|=
literal|0
expr_stmt|;
block|}
name|gtk_entry_set_text
argument_list|(
name|entry
argument_list|,
name|g_strdup
argument_list|(
name|items
index|[
name|i
index|]
operator|.
name|text
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_combo_set_value_in_list
argument_list|(
name|GTK_COMBO
argument_list|(
name|combo
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|combo
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|combo
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_do_misc_updates() - Build an option menu for the given parameters.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_do_misc_updates (void)
name|gimp_do_misc_updates
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|stp_vars_t
name|lower
init|=
name|stp_minimum_settings
argument_list|()
decl_stmt|;
name|suppress_preview_update
operator|++
expr_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
if|if
condition|(
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
block|{
name|gdouble
name|tmp
init|=
operator|-
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
decl_stmt|;
name|gdouble
name|max_ppi_scaling
decl_stmt|;
name|gdouble
name|min_ppi_scaling
decl_stmt|,
name|min_ppi_scaling1
decl_stmt|,
name|min_ppi_scaling2
decl_stmt|;
name|min_ppi_scaling1
operator|=
literal|72.0
operator|*
operator|(
name|gdouble
operator|)
name|image_width
operator|/
operator|(
name|gdouble
operator|)
name|printable_width
expr_stmt|;
name|min_ppi_scaling2
operator|=
literal|72.0
operator|*
operator|(
name|gdouble
operator|)
name|image_height
operator|/
operator|(
name|gdouble
operator|)
name|printable_height
expr_stmt|;
if|if
condition|(
name|min_ppi_scaling1
operator|>
name|min_ppi_scaling2
condition|)
name|min_ppi_scaling
operator|=
name|min_ppi_scaling1
expr_stmt|;
else|else
name|min_ppi_scaling
operator|=
name|min_ppi_scaling2
expr_stmt|;
name|max_ppi_scaling
operator|=
name|min_ppi_scaling
operator|*
literal|100
operator|/
name|stp_get_scaling
argument_list|(
name|lower
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_ppi
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|lower
operator|=
name|min_ppi_scaling
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|upper
operator|=
name|max_ppi_scaling
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
name|tmp
expr_stmt|;
name|gtk_adjustment_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gdouble
name|tmp
init|=
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
decl_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_percent
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|lower
operator|=
name|stp_get_scaling
argument_list|(
name|lower
argument_list|)
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|upper
operator|=
literal|100.0
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
name|tmp
expr_stmt|;
name|gtk_adjustment_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|stp_get_output_type
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
block|{
case|case
name|OUTPUT_GRAY
case|:
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|output_gray
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|OUTPUT_COLOR
case|:
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|output_color
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|OUTPUT_MONOCHROME
case|:
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|output_monochrome
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
name|gimp_do_color_updates
argument_list|()
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|orientation_menu
argument_list|)
argument_list|,
name|stp_get_orientation
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
operator|==
literal|0
condition|)
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|unit_inch
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|unit_cm
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|stp_get_image_type
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
block|{
case|case
name|IMAGE_LINE_ART
case|:
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|image_line_art
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|IMAGE_SOLID_TONE
case|:
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|image_solid_tone
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|IMAGE_CONTINUOUS
case|:
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|image_continuous_tone
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|image_continuous_tone
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|stp_set_image_type
argument_list|(
operator|*
name|pv
argument_list|,
name|IMAGE_CONTINUOUS
argument_list|)
expr_stmt|;
break|break;
block|}
name|suppress_preview_update
operator|--
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * gimp_position_callback() - callback for position entry widgets  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_position_callback (GtkWidget * widget)
name|gimp_position_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|reset_preview
argument_list|()
expr_stmt|;
name|suppress_preview_update
operator|++
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|recenter_button
condition|)
block|{
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|widget
operator|==
name|recenter_horizontal_button
condition|)
block|{
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|widget
operator|==
name|recenter_vertical_button
condition|)
block|{
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gdouble
name|new_value
init|=
name|atof
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|gdouble
name|unit_scaler
init|=
literal|1.0
decl_stmt|;
name|gboolean
name|was_percent
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|unit_scaler
operator|/=
literal|2.54
expr_stmt|;
name|new_value
operator|*=
name|unit_scaler
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|top_entry
condition|)
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|(
operator|(
name|new_value
operator|+
operator|(
literal|1.0
operator|/
literal|144.0
operator|)
operator|)
operator|*
literal|72
operator|)
operator|-
name|top
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|widget
operator|==
name|bottom_entry
condition|)
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|(
operator|(
name|new_value
operator|+
operator|(
literal|1.0
operator|/
literal|144.0
operator|)
operator|)
operator|*
literal|72
operator|)
operator|-
operator|(
name|top
operator|+
name|print_height
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|widget
operator|==
name|bottom_border_entry
condition|)
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
name|paper_height
operator|-
name|print_height
operator|-
name|top
operator|-
operator|(
name|new_value
operator|*
literal|72
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|widget
operator|==
name|left_entry
condition|)
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|(
operator|(
name|new_value
operator|+
operator|(
literal|1.0
operator|/
literal|144.0
operator|)
operator|)
operator|*
literal|72
operator|)
operator|-
name|left
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|widget
operator|==
name|right_entry
condition|)
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|(
operator|(
name|new_value
operator|+
operator|(
literal|1.0
operator|/
literal|144.0
operator|)
operator|)
operator|*
literal|72
operator|)
operator|-
operator|(
name|left
operator|+
name|print_width
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|widget
operator|==
name|right_border_entry
condition|)
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
name|paper_width
operator|-
name|print_width
operator|-
name|left
operator|-
operator|(
name|new_value
operator|*
literal|72
operator|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|widget
operator|==
name|width_entry
condition|)
block|{
if|if
condition|(
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|>=
literal|0
condition|)
block|{
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_ppi
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_scaling_callback
argument_list|(
name|scaling_ppi
argument_list|)
expr_stmt|;
name|was_percent
operator|=
literal|1
expr_stmt|;
block|}
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
operator|(
operator|(
name|gdouble
operator|)
name|image_width
operator|)
operator|/
name|new_value
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|was_percent
condition|)
block|{
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_percent
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|widget
operator|==
name|height_entry
condition|)
block|{
if|if
condition|(
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|>=
literal|0
condition|)
block|{
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_ppi
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_scaling_callback
argument_list|(
name|scaling_ppi
argument_list|)
expr_stmt|;
name|was_percent
operator|=
literal|1
expr_stmt|;
block|}
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
operator|(
operator|(
name|gdouble
operator|)
name|image_height
operator|)
operator|/
name|new_value
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|was_percent
condition|)
block|{
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_percent
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|suppress_preview_update
operator|--
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_plist_callback() - Update the current system printer.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_plist_callback (GtkWidget * widget,gpointer data)
name|gimp_plist_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|default_parameter
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|widget
condition|)
block|{
specifier|const
name|gchar
modifier|*
name|text
decl_stmt|;
name|text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|GTK_COMBO
argument_list|(
name|printer_combo
argument_list|)
operator|->
name|entry
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|plist_count
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|text
argument_list|,
name|printer_list
index|[
name|i
index|]
operator|.
name|text
argument_list|)
condition|)
block|{
name|plist_current
operator|=
name|i
expr_stmt|;
break|break;
block|}
block|}
block|}
else|else
block|{
name|plist_current
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
expr_stmt|;
block|}
name|pv
operator|=
operator|&
operator|(
name|plist
index|[
name|plist_current
index|]
operator|.
name|v
operator|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|stp_get_driver
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
literal|""
argument_list|)
condition|)
name|current_printer
operator|=
name|stp_get_printer_by_driver
argument_list|(
name|stp_get_driver
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|)
expr_stmt|;
name|suppress_preview_update
operator|++
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|GTK_COMBO
argument_list|(
name|dither_algo_combo
argument_list|)
operator|->
name|entry
argument_list|)
argument_list|,
name|stp_get_dither_algorithm
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_setup_update
argument_list|()
expr_stmt|;
name|gimp_do_misc_updates
argument_list|()
expr_stmt|;
comment|/*    * Now get option parameters.    */
if|if
condition|(
name|num_media_sizes
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_media_sizes
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|media_sizes
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|media_sizes
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|media_sizes
argument_list|)
expr_stmt|;
name|num_media_sizes
operator|=
literal|0
expr_stmt|;
block|}
name|media_sizes
operator|=
operator|(
operator|*
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|parameters
operator|)
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"PageSize"
operator|,
operator|&
name|num_media_sizes
operator|)
expr_stmt|;
name|default_parameter
operator|=
operator|(
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|default_parameters
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"PageSize"
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|stp_get_media_size
argument_list|(
operator|*
name|pv
argument_list|)
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
name|stp_set_media_size
argument_list|(
operator|*
name|pv
argument_list|,
name|default_parameter
argument_list|)
expr_stmt|;
name|gimp_plist_build_combo
argument_list|(
name|media_size_combo
argument_list|,
name|num_media_sizes
argument_list|,
name|media_sizes
argument_list|,
name|stp_get_media_size
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
name|default_parameter
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_media_size_callback
argument_list|)
argument_list|,
operator|&
name|media_size_callback_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_media_types
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_media_types
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|media_types
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|media_types
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|media_types
argument_list|)
expr_stmt|;
name|num_media_types
operator|=
literal|0
expr_stmt|;
block|}
name|media_types
operator|=
operator|(
operator|*
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|parameters
operator|)
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"MediaType"
operator|,
operator|&
name|num_media_types
operator|)
expr_stmt|;
name|default_parameter
operator|=
operator|(
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|default_parameters
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"MediaType"
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|stp_get_media_type
argument_list|(
operator|*
name|pv
argument_list|)
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|&&
name|media_types
operator|!=
name|NULL
condition|)
name|stp_set_media_type
argument_list|(
operator|*
name|pv
argument_list|,
name|default_parameter
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|media_types
operator|==
name|NULL
condition|)
name|stp_set_media_type
argument_list|(
operator|*
name|pv
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_plist_build_combo
argument_list|(
name|media_type_combo
argument_list|,
name|num_media_types
argument_list|,
name|media_types
argument_list|,
name|stp_get_media_type
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
name|default_parameter
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_media_type_callback
argument_list|)
argument_list|,
operator|&
name|media_type_callback_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_media_sources
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_media_sources
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|media_sources
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|media_sources
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|media_sources
argument_list|)
expr_stmt|;
name|num_media_sources
operator|=
literal|0
expr_stmt|;
block|}
name|media_sources
operator|=
operator|(
operator|*
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|parameters
operator|)
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"InputSlot"
operator|,
operator|&
name|num_media_sources
operator|)
expr_stmt|;
name|default_parameter
operator|=
operator|(
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|default_parameters
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"InputSlot"
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|stp_get_media_source
argument_list|(
operator|*
name|pv
argument_list|)
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|&&
name|media_sources
operator|!=
name|NULL
condition|)
name|stp_set_media_source
argument_list|(
operator|*
name|pv
argument_list|,
name|default_parameter
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|media_sources
operator|==
name|NULL
condition|)
name|stp_set_media_source
argument_list|(
operator|*
name|pv
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_plist_build_combo
argument_list|(
name|media_source_combo
argument_list|,
name|num_media_sources
argument_list|,
name|media_sources
argument_list|,
name|stp_get_media_source
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
name|default_parameter
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_media_source_callback
argument_list|)
argument_list|,
operator|&
name|media_source_callback_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_ink_types
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_ink_types
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|ink_types
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|ink_types
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|ink_types
argument_list|)
expr_stmt|;
name|num_ink_types
operator|=
literal|0
expr_stmt|;
block|}
name|ink_types
operator|=
operator|(
operator|*
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|parameters
operator|)
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"InkType"
operator|,
operator|&
name|num_ink_types
operator|)
expr_stmt|;
name|default_parameter
operator|=
operator|(
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|default_parameters
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"InkType"
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|stp_get_ink_type
argument_list|(
operator|*
name|pv
argument_list|)
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|&&
name|ink_types
operator|!=
name|NULL
condition|)
name|stp_set_ink_type
argument_list|(
operator|*
name|pv
argument_list|,
name|default_parameter
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|ink_types
operator|==
name|NULL
condition|)
name|stp_set_ink_type
argument_list|(
operator|*
name|pv
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_plist_build_combo
argument_list|(
name|ink_type_combo
argument_list|,
name|num_ink_types
argument_list|,
name|ink_types
argument_list|,
name|stp_get_ink_type
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
name|default_parameter
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_ink_type_callback
argument_list|)
argument_list|,
operator|&
name|ink_type_callback_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_resolutions
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_resolutions
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|resolutions
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
operator|(
name|void
operator|*
operator|)
name|resolutions
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|resolutions
argument_list|)
expr_stmt|;
name|num_resolutions
operator|=
literal|0
expr_stmt|;
block|}
name|resolutions
operator|=
operator|(
operator|*
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|parameters
operator|)
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"Resolution"
operator|,
operator|&
name|num_resolutions
operator|)
expr_stmt|;
name|default_parameter
operator|=
operator|(
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|default_parameters
operator|)
operator|(
name|current_printer
operator|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
operator|,
literal|"Resolution"
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|stp_get_resolution
argument_list|(
operator|*
name|pv
argument_list|)
index|[
literal|0
index|]
operator|==
literal|'\0'
operator|&&
name|resolutions
operator|!=
name|NULL
condition|)
name|stp_set_resolution
argument_list|(
operator|*
name|pv
argument_list|,
name|default_parameter
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|resolutions
operator|==
name|NULL
condition|)
name|stp_set_resolution
argument_list|(
operator|*
name|pv
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_plist_build_combo
argument_list|(
name|resolution_combo
argument_list|,
name|num_resolutions
argument_list|,
name|resolutions
argument_list|,
name|stp_get_resolution
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
name|default_parameter
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_resolution_callback
argument_list|)
argument_list|,
operator|&
name|resolution_callback_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|dither_algo_combo
condition|)
name|gimp_build_dither_combo
argument_list|()
expr_stmt|;
name|suppress_preview_update
operator|--
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_media_size_callback() - Update the current media size.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_media_size_callback (GtkWidget * widget,gpointer data)
name|gimp_media_size_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|custom_size_width
condition|)
block|{
name|gint
name|width_limit
decl_stmt|,
name|height_limit
decl_stmt|;
name|gint
name|min_width_limit
decl_stmt|,
name|min_height_limit
decl_stmt|;
name|gdouble
name|new_value
init|=
name|atof
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|gdouble
name|unit_scaler
init|=
literal|1.0
decl_stmt|;
name|new_value
operator|*=
literal|72
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|unit_scaler
operator|/=
literal|2.54
expr_stmt|;
name|new_value
operator|*=
name|unit_scaler
expr_stmt|;
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|limit
operator|)
operator|(
name|current_printer
operator|,
operator|*
name|pv
operator|,
operator|&
name|width_limit
operator|,
operator|&
name|height_limit
operator|,
operator|&
name|min_width_limit
operator|,
operator|&
name|min_height_limit
operator|)
expr_stmt|;
if|if
condition|(
name|new_value
operator|<
name|min_width_limit
condition|)
name|new_value
operator|=
name|min_width_limit
expr_stmt|;
elseif|else
if|if
condition|(
name|new_value
operator|>
name|width_limit
condition|)
name|new_value
operator|=
name|width_limit
expr_stmt|;
name|stp_set_page_width
argument_list|(
operator|*
name|pv
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|new_value
operator|=
name|new_value
operator|/
literal|72.0
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|new_value
operator|*=
literal|2.54
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_width
argument_list|,
name|new_value
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|widget
operator|==
name|custom_size_height
condition|)
block|{
name|gint
name|width_limit
decl_stmt|,
name|height_limit
decl_stmt|;
name|gint
name|min_width_limit
decl_stmt|,
name|min_height_limit
decl_stmt|;
name|gdouble
name|new_value
init|=
name|atof
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|gdouble
name|unit_scaler
init|=
literal|1.0
decl_stmt|;
name|new_value
operator|*=
literal|72
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|unit_scaler
operator|/=
literal|2.54
expr_stmt|;
name|new_value
operator|*=
name|unit_scaler
expr_stmt|;
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|limit
operator|)
operator|(
name|current_printer
operator|,
operator|*
name|pv
operator|,
operator|&
name|width_limit
operator|,
operator|&
name|height_limit
operator|,
operator|&
name|min_width_limit
operator|,
operator|&
name|min_height_limit
operator|)
expr_stmt|;
if|if
condition|(
name|new_value
operator|<
name|min_height_limit
condition|)
name|new_value
operator|=
name|min_height_limit
expr_stmt|;
elseif|else
if|if
condition|(
name|new_value
operator|>
name|height_limit
condition|)
name|new_value
operator|=
name|height_limit
expr_stmt|;
name|stp_set_page_height
argument_list|(
operator|*
name|pv
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|new_value
operator|=
name|new_value
operator|/
literal|72.0
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|new_value
operator|*=
literal|2.54
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_height
argument_list|,
name|new_value
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
else|else
block|{
specifier|const
name|gchar
modifier|*
name|new_media_size
decl_stmt|;
name|stp_papersize_t
name|pap
decl_stmt|;
name|new_media_size
operator|=
name|Combo_get_name
argument_list|(
name|media_size_combo
argument_list|,
name|num_media_sizes
argument_list|,
name|media_sizes
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|new_media_size
condition|)
return|return;
name|pap
operator|=
name|stp_get_papersize_by_name
argument_list|(
name|new_media_size
argument_list|)
expr_stmt|;
if|if
condition|(
name|pap
condition|)
block|{
name|gint
name|default_width
decl_stmt|,
name|default_height
decl_stmt|;
name|gdouble
name|size
decl_stmt|;
if|if
condition|(
name|stp_papersize_get_width
argument_list|(
name|pap
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|media_size
operator|)
operator|(
name|current_printer
operator|,
operator|*
name|pv
operator|,
operator|&
name|default_width
operator|,
operator|&
name|default_height
operator|)
expr_stmt|;
name|size
operator|=
name|default_width
operator|/
literal|72.0
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|size
operator|*=
literal|2.54
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_width
argument_list|,
name|size
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|GTK_WIDGET
argument_list|(
name|custom_size_width
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_editable_set_editable
argument_list|(
name|GTK_EDITABLE
argument_list|(
name|custom_size_width
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|stp_set_page_width
argument_list|(
operator|*
name|pv
argument_list|,
name|default_width
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|size
operator|=
name|stp_papersize_get_width
argument_list|(
name|pap
argument_list|)
operator|/
literal|72.0
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|size
operator|*=
literal|2.54
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_width
argument_list|,
name|size
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|GTK_WIDGET
argument_list|(
name|custom_size_width
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_editable_set_editable
argument_list|(
name|GTK_EDITABLE
argument_list|(
name|custom_size_width
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|stp_set_page_width
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_papersize_get_width
argument_list|(
name|pap
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|stp_papersize_get_height
argument_list|(
name|pap
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|media_size
operator|)
operator|(
name|current_printer
operator|,
operator|*
name|pv
operator|,
operator|&
name|default_width
operator|,
operator|&
name|default_height
operator|)
expr_stmt|;
name|size
operator|=
name|default_height
operator|/
literal|72.0
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|size
operator|*=
literal|2.54
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_height
argument_list|,
name|size
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|GTK_WIDGET
argument_list|(
name|custom_size_height
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_editable_set_editable
argument_list|(
name|GTK_EDITABLE
argument_list|(
name|custom_size_height
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|stp_set_page_height
argument_list|(
operator|*
name|pv
argument_list|,
name|default_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|size
operator|=
name|stp_papersize_get_height
argument_list|(
name|pap
argument_list|)
operator|/
literal|72.0
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|size
operator|*=
literal|2.54
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_height
argument_list|,
name|size
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|GTK_WIDGET
argument_list|(
name|custom_size_height
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_editable_set_editable
argument_list|(
name|GTK_EDITABLE
argument_list|(
name|custom_size_height
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|stp_set_page_height
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_papersize_get_height
argument_list|(
name|pap
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|strcmp
argument_list|(
name|stp_get_media_size
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
name|new_media_size
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|stp_set_media_size
argument_list|(
operator|*
name|pv
argument_list|,
name|new_media_size
argument_list|)
expr_stmt|;
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  *  gimp_media_type_callback() - Update the current media type.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_media_type_callback (GtkWidget * widget,gpointer data)
name|gimp_media_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|new_media_type
init|=
name|Combo_get_name
argument_list|(
name|media_type_combo
argument_list|,
name|num_media_types
argument_list|,
name|media_types
argument_list|)
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
name|stp_set_media_type
argument_list|(
operator|*
name|pv
argument_list|,
name|new_media_type
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_media_source_callback() - Update the current media source.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_media_source_callback (GtkWidget * widget,gpointer data)
name|gimp_media_source_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|new_media_source
init|=
name|Combo_get_name
argument_list|(
name|media_source_combo
argument_list|,
name|num_media_sources
argument_list|,
name|media_sources
argument_list|)
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
name|stp_set_media_source
argument_list|(
operator|*
name|pv
argument_list|,
name|new_media_source
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_ink_type_callback() - Update the current ink type.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_ink_type_callback (GtkWidget * widget,gpointer data)
name|gimp_ink_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|new_ink_type
init|=
name|Combo_get_name
argument_list|(
name|ink_type_combo
argument_list|,
name|num_ink_types
argument_list|,
name|ink_types
argument_list|)
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
name|stp_set_ink_type
argument_list|(
operator|*
name|pv
argument_list|,
name|new_ink_type
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_resolution_callback() - Update the current resolution.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_callback (GtkWidget * widget,gpointer data)
name|gimp_resolution_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|new_resolution
init|=
name|Combo_get_name
argument_list|(
name|resolution_combo
argument_list|,
name|num_resolutions
argument_list|,
name|resolutions
argument_list|)
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
name|stp_set_resolution
argument_list|(
operator|*
name|pv
argument_list|,
name|new_resolution
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_orientation_callback() - Update the current media size.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_orientation_callback (GtkWidget * widget,gpointer data)
name|gimp_orientation_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|orientation
decl_stmt|;
name|gimp_int_combo_box_get_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|widget
argument_list|)
argument_list|,
operator|&
name|orientation
argument_list|)
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|stp_get_orientation
argument_list|(
operator|*
name|pv
argument_list|)
operator|!=
name|orientation
condition|)
block|{
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|stp_set_orientation
argument_list|(
operator|*
name|pv
argument_list|,
name|orientation
argument_list|)
expr_stmt|;
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_output_type_callback() - Update the current output type.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_output_type_callback (GtkWidget * widget,gpointer data)
name|gimp_output_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|stp_set_output_type
argument_list|(
operator|*
name|pv
argument_list|,
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|gimp_update_adjusted_thumbnail
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|widget
operator|==
name|output_color
condition|)
name|gimp_set_color_sliders_active
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|gimp_set_color_sliders_active
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_unit_callback() - Update the current unit.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_unit_callback (GtkWidget * widget,gpointer data)
name|gimp_unit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|stp_set_unit
argument_list|(
operator|*
name|pv
argument_list|,
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  *  gimp_image_type_callback() - Update the current image type mode.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_image_type_callback (GtkWidget * widget,gpointer data)
name|gimp_image_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|stp_set_image_type
argument_list|(
operator|*
name|pv
argument_list|,
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|gimp_update_adjusted_thumbnail
argument_list|()
expr_stmt|;
block|}
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_destroy_dialogs (void)
name|gimp_destroy_dialogs
parameter_list|(
name|void
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|gimp_color_adjust_dialog
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|setup_dialog
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|print_dialog
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|new_printer_dialog
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|about_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dialogs_set_sensitive (gboolean sensitive)
name|gimp_dialogs_set_sensitive
parameter_list|(
name|gboolean
name|sensitive
parameter_list|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|gimp_color_adjust_dialog
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|setup_dialog
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|print_dialog
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|new_printer_dialog
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|about_dialog
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_response_callback (GtkWidget * dialog,gint response_id,gpointer data)
name|gimp_response_callback
parameter_list|(
name|GtkWidget
modifier|*
name|dialog
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|response_id
condition|)
block|{
case|case
name|RESPONSE_ABOUT
case|:
name|gtk_widget_show
argument_list|(
name|about_dialog
argument_list|)
expr_stmt|;
break|break;
case|case
name|RESPONSE_SAVE
case|:
name|reset_preview
argument_list|()
expr_stmt|;
name|printrc_save
argument_list|()
expr_stmt|;
break|break;
case|case
name|RESPONSE_PRINTSAVE
case|:
name|saveme
operator|=
name|TRUE
expr_stmt|;
case|case
name|GTK_RESPONSE_OK
case|:
if|if
condition|(
name|plist_current
operator|>
literal|0
condition|)
block|{
name|runme
operator|=
name|TRUE
expr_stmt|;
name|gimp_destroy_dialogs
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|gimp_dialogs_set_sensitive
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|file_browser
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|gimp_destroy_dialogs
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/*  *  gimp_setup_update() - update widgets in the setup dialog  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_setup_update (void)
name|gimp_setup_update
parameter_list|(
name|void
parameter_list|)
block|{
name|gboolean
name|ppd
decl_stmt|;
name|gint
name|idx
decl_stmt|;
name|current_printer
operator|=
name|stp_get_printer_by_driver
argument_list|(
name|stp_get_driver
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|)
expr_stmt|;
name|idx
operator|=
name|stp_get_printer_index_by_driver
argument_list|(
name|stp_get_driver
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_select_row
argument_list|(
name|GTK_CLIST
argument_list|(
name|printer_driver
argument_list|)
argument_list|,
name|idx
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|ppd_file
argument_list|)
argument_list|,
name|stp_get_ppd_file
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|)
expr_stmt|;
name|ppd
operator|=
operator|(
name|strncmp
argument_list|(
name|stp_get_driver
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
literal|"ps"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
operator|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|ppd_label
argument_list|,
name|ppd
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|ppd_file
argument_list|,
name|ppd
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|ppd_button
argument_list|,
name|ppd
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|output_cmd
argument_list|)
argument_list|,
name|stp_get_output_to
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|output_label
argument_list|,
name|plist_current
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|output_cmd
argument_list|,
name|plist_current
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|printer_driver
argument_list|)
argument_list|,
name|idx
argument_list|,
operator|-
literal|1
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_setup_open_callback() -  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_setup_open_callback (void)
name|gimp_setup_open_callback
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|gboolean
name|first_time
init|=
name|TRUE
decl_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
name|gimp_setup_update
argument_list|()
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|setup_dialog
argument_list|)
expr_stmt|;
if|if
condition|(
name|first_time
condition|)
block|{
comment|/* Make sure the driver scroller gets positioned correctly. */
name|gimp_setup_update
argument_list|()
expr_stmt|;
name|first_time
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  *  gimp_new_printer_open_callback() -  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_new_printer_open_callback (void)
name|gimp_new_printer_open_callback
parameter_list|(
name|void
parameter_list|)
block|{
name|reset_preview
argument_list|()
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|new_printer_entry
argument_list|)
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|new_printer_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_setup_ok_callback() -  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_setup_response (GtkWidget * widget,gint response_id,gpointer data)
name|gimp_setup_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
name|reset_preview
argument_list|()
expr_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|stp_set_driver
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_printer_get_driver
argument_list|(
name|current_printer
argument_list|)
argument_list|)
expr_stmt|;
name|stp_set_output_to
argument_list|(
operator|*
name|pv
argument_list|,
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|output_cmd
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|stp_set_ppd_file
argument_list|(
operator|*
name|pv
argument_list|,
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|ppd_file
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_plist_callback
argument_list|(
name|NULL
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|plist_current
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_hide
argument_list|(
name|setup_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_setup_ok_callback() -  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_new_printer_activate (GtkWidget * widget,gpointer data)
name|gimp_new_printer_activate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_dialog_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_new_printer_response (GtkWidget * widget,gint response_id,gpointer data)
name|gimp_new_printer_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
specifier|const
name|gchar
modifier|*
name|data
init|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|new_printer_entry
argument_list|)
argument_list|)
decl_stmt|;
name|gp_plist_t
name|key
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
name|initialize_printer
argument_list|(
operator|&
name|key
argument_list|)
expr_stmt|;
operator|(
name|void
operator|)
name|strncpy
argument_list|(
name|key
operator|.
name|name
argument_list|,
name|data
argument_list|,
sizeof|sizeof
argument_list|(
name|key
operator|.
name|name
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|key
operator|.
name|name
argument_list|)
condition|)
block|{
name|key
operator|.
name|active
operator|=
literal|0
expr_stmt|;
name|key
operator|.
name|v
operator|=
name|stp_allocate_copy
argument_list|(
operator|*
name|pv
argument_list|)
expr_stmt|;
if|if
condition|(
name|add_printer
argument_list|(
operator|&
name|key
argument_list|,
literal|1
argument_list|)
condition|)
block|{
name|plist_current
operator|=
name|plist_count
operator|-
literal|1
expr_stmt|;
name|gimp_build_printer_combo
argument_list|()
expr_stmt|;
name|stp_set_driver
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_printer_get_driver
argument_list|(
name|current_printer
argument_list|)
argument_list|)
expr_stmt|;
name|stp_set_output_to
argument_list|(
operator|*
name|pv
argument_list|,
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|output_cmd
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|stp_set_ppd_file
argument_list|(
operator|*
name|pv
argument_list|,
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|ppd_file
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_plist_callback
argument_list|(
name|NULL
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|plist_current
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|gtk_widget_hide
argument_list|(
name|new_printer_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_print_driver_callback() - Update the current printer driver.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_print_driver_callback (GtkWidget * widget,gint row,gint column,GdkEventButton * event,gpointer data)
name|gimp_print_driver_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
comment|/* I - Driver list */
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
comment|/* I - Data */
block|{
name|stp_vars_t
name|printvars
decl_stmt|;
name|gboolean
name|ppd
decl_stmt|;
name|gimp_invalidate_preview_thumbnail
argument_list|()
expr_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
name|data
operator|=
name|gtk_clist_get_row_data
argument_list|(
name|GTK_CLIST
argument_list|(
name|widget
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|current_printer
operator|=
name|stp_get_printer_by_index
argument_list|(
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|printer_model_label
argument_list|)
argument_list|,
name|gettext
argument_list|(
name|stp_printer_get_long_name
argument_list|(
name|current_printer
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ppd
operator|=
operator|(
name|strncmp
argument_list|(
name|stp_printer_get_driver
argument_list|(
name|current_printer
argument_list|)
argument_list|,
literal|"ps"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
operator|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|ppd_label
argument_list|,
name|ppd
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|ppd_file
argument_list|,
name|ppd
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|ppd_button
argument_list|,
name|ppd
argument_list|)
expr_stmt|;
name|printvars
operator|=
name|stp_printer_get_printvars
argument_list|(
name|current_printer
argument_list|)
expr_stmt|;
if|if
condition|(
name|stp_get_output_type
argument_list|(
name|printvars
argument_list|)
operator|==
name|OUTPUT_COLOR
condition|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|output_color
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|output_gray
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|output_color
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_ppd_browse_callback (void)
name|gimp_ppd_browse_callback
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|filename
init|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|ppd_file
argument_list|)
argument_list|)
decl_stmt|;
name|reset_preview
argument_list|()
expr_stmt|;
if|if
condition|(
name|filename
operator|&&
name|g_path_is_absolute
argument_list|(
name|filename
argument_list|)
condition|)
name|gtk_file_chooser_set_filename
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|ppd_browser
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ppd_browser
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_ppd_response (GtkWidget * dialog,gint response_id)
name|gimp_ppd_response
parameter_list|(
name|GtkWidget
modifier|*
name|dialog
parameter_list|,
name|gint
name|response_id
parameter_list|)
block|{
name|gtk_widget_hide
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
name|gchar
modifier|*
name|filename
decl_stmt|;
name|filename
operator|=
name|gtk_file_chooser_get_filename
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|ppd_file
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_file_response (GtkWidget * dialog,gint response_id)
name|gimp_file_response
parameter_list|(
name|GtkWidget
modifier|*
name|dialog
parameter_list|,
name|gint
name|response_id
parameter_list|)
block|{
name|gtk_widget_hide
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
name|gchar
modifier|*
name|filename
decl_stmt|;
name|filename
operator|=
name|gtk_file_chooser_get_filename
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|stp_set_output_to
argument_list|(
operator|*
name|pv
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|runme
operator|=
name|TRUE
expr_stmt|;
name|gimp_destroy_dialogs
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|gimp_dialogs_set_sensitive
argument_list|(
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * gimp_update_adjusted_thumbnail()  */
end_comment

begin_function
name|void
DECL|function|gimp_update_adjusted_thumbnail (void)
name|gimp_update_adjusted_thumbnail
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|stp_convert_t
name|colorfunc
decl_stmt|;
name|gushort
name|out
index|[
literal|3
operator|*
name|THUMBNAIL_MAXW
index|]
decl_stmt|;
name|guchar
modifier|*
name|adjusted_data
init|=
name|adjusted_thumbnail_data
decl_stmt|;
name|gfloat
name|old_density
init|=
name|stp_get_density
argument_list|(
operator|*
name|pv
argument_list|)
decl_stmt|;
if|if
condition|(
name|thumbnail_data
operator|==
literal|0
operator|||
name|adjusted_thumbnail_data
operator|==
literal|0
condition|)
return|return;
name|stp_set_density
argument_list|(
operator|*
name|pv
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|stp_compute_lut
argument_list|(
operator|*
name|pv
argument_list|,
literal|256
argument_list|)
expr_stmt|;
name|colorfunc
operator|=
name|stp_choose_colorfunc
argument_list|(
name|stp_get_output_type
argument_list|(
operator|*
name|pv
argument_list|)
argument_list|,
name|thumbnail_bpp
argument_list|,
name|NULL
argument_list|,
operator|&
name|adjusted_thumbnail_bpp
argument_list|,
operator|*
name|pv
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|thumbnail_h
condition|;
name|y
operator|++
control|)
block|{
call|(
modifier|*
name|colorfunc
call|)
argument_list|(
operator|*
name|pv
argument_list|,
name|thumbnail_data
operator|+
name|thumbnail_bpp
operator|*
name|thumbnail_w
operator|*
name|y
argument_list|,
name|out
argument_list|,
name|NULL
argument_list|,
name|thumbnail_w
argument_list|,
name|thumbnail_bpp
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|adjusted_thumbnail_bpp
operator|*
name|thumbnail_w
condition|;
name|x
operator|++
control|)
block|{
operator|*
name|adjusted_data
operator|++
operator|=
name|out
index|[
name|x
index|]
operator|/
literal|0x0101U
expr_stmt|;
block|}
block|}
name|stp_free_lut
argument_list|(
operator|*
name|pv
argument_list|)
expr_stmt|;
name|stp_set_density
argument_list|(
operator|*
name|pv
argument_list|,
name|old_density
argument_list|)
expr_stmt|;
name|gimp_redraw_color_swatch
argument_list|()
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_invalidate_preview_thumbnail (void)
name|gimp_invalidate_preview_thumbnail
parameter_list|(
name|void
parameter_list|)
block|{
name|preview_valid
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|draw_arrow (GdkWindow * w,GdkGC * gc,gint paper_left,gint paper_top,gint orient)
name|draw_arrow
parameter_list|(
name|GdkWindow
modifier|*
name|w
parameter_list|,
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|gint
name|paper_left
parameter_list|,
name|gint
name|paper_top
parameter_list|,
name|gint
name|orient
parameter_list|)
block|{
name|gint
name|u
init|=
name|preview_ppi
operator|/
literal|2
decl_stmt|;
name|gint
name|ox
init|=
name|paper_left
operator|+
name|preview_ppi
operator|*
name|paper_width
operator|/
literal|72
operator|/
literal|2
decl_stmt|;
name|gint
name|oy
init|=
name|paper_top
operator|+
name|preview_ppi
operator|*
name|paper_height
operator|/
literal|72
operator|/
literal|2
decl_stmt|;
if|if
condition|(
name|orient
operator|==
name|ORIENT_LANDSCAPE
condition|)
block|{
name|ox
operator|+=
name|preview_ppi
operator|*
name|paper_width
operator|/
literal|72
operator|/
literal|4
expr_stmt|;
if|if
condition|(
name|ox
operator|>
name|paper_left
operator|+
name|preview_ppi
operator|*
name|paper_width
operator|/
literal|72
operator|-
name|u
condition|)
name|ox
operator|=
name|paper_left
operator|+
name|preview_ppi
operator|*
name|paper_width
operator|/
literal|72
operator|-
name|u
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
operator|+
name|u
argument_list|,
name|oy
argument_list|,
name|ox
argument_list|,
name|oy
operator|-
name|u
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
operator|+
name|u
argument_list|,
name|oy
argument_list|,
name|ox
argument_list|,
name|oy
operator|+
name|u
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
operator|+
name|u
argument_list|,
name|oy
argument_list|,
name|ox
operator|-
name|u
argument_list|,
name|oy
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|orient
operator|==
name|ORIENT_SEASCAPE
condition|)
block|{
name|ox
operator|-=
name|preview_ppi
operator|*
name|paper_width
operator|/
literal|72
operator|/
literal|4
expr_stmt|;
if|if
condition|(
name|ox
operator|<
name|paper_left
operator|+
name|u
condition|)
name|ox
operator|=
name|paper_left
operator|+
name|u
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
operator|-
name|u
argument_list|,
name|oy
argument_list|,
name|ox
argument_list|,
name|oy
operator|-
name|u
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
operator|-
name|u
argument_list|,
name|oy
argument_list|,
name|ox
argument_list|,
name|oy
operator|+
name|u
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
operator|-
name|u
argument_list|,
name|oy
argument_list|,
name|ox
operator|+
name|u
argument_list|,
name|oy
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|orient
operator|==
name|ORIENT_UPSIDEDOWN
condition|)
block|{
name|oy
operator|+=
name|preview_ppi
operator|*
name|paper_height
operator|/
literal|72
operator|/
literal|4
expr_stmt|;
if|if
condition|(
name|oy
operator|>
name|paper_top
operator|+
name|preview_ppi
operator|*
name|paper_height
operator|/
literal|72
operator|-
name|u
condition|)
name|oy
operator|=
name|paper_top
operator|+
name|preview_ppi
operator|*
name|paper_height
operator|/
literal|72
operator|-
name|u
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
argument_list|,
name|oy
operator|+
name|u
argument_list|,
name|ox
operator|-
name|u
argument_list|,
name|oy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
argument_list|,
name|oy
operator|+
name|u
argument_list|,
name|ox
operator|+
name|u
argument_list|,
name|oy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
argument_list|,
name|oy
operator|+
name|u
argument_list|,
name|ox
argument_list|,
name|oy
operator|-
name|u
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* (orient == ORIENT_PORTRAIT) */
block|{
name|oy
operator|-=
name|preview_ppi
operator|*
name|paper_height
operator|/
literal|72
operator|/
literal|4
expr_stmt|;
if|if
condition|(
name|oy
operator|<
name|paper_top
operator|+
name|u
condition|)
name|oy
operator|=
name|paper_top
operator|+
name|u
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
argument_list|,
name|oy
operator|-
name|u
argument_list|,
name|ox
operator|-
name|u
argument_list|,
name|oy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
argument_list|,
name|oy
operator|-
name|u
argument_list|,
name|ox
operator|+
name|u
argument_list|,
name|oy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|w
argument_list|,
name|gc
argument_list|,
name|ox
argument_list|,
name|oy
operator|-
name|u
argument_list|,
name|ox
argument_list|,
name|oy
operator|+
name|u
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  *  gimp_preview_update_callback() -  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_do_preview_thumbnail (void)
name|gimp_do_preview_thumbnail
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GdkGC
modifier|*
name|gc
init|=
name|NULL
decl_stmt|;
specifier|static
name|GdkGC
modifier|*
name|gcinv
init|=
name|NULL
decl_stmt|;
specifier|static
name|GdkGC
modifier|*
name|gcset
init|=
name|NULL
decl_stmt|;
specifier|static
name|guchar
modifier|*
name|preview_data
init|=
name|NULL
decl_stmt|;
specifier|static
name|gint
name|opx
init|=
literal|0
decl_stmt|;
specifier|static
name|gint
name|opy
init|=
literal|0
decl_stmt|;
specifier|static
name|gint
name|oph
init|=
literal|0
decl_stmt|;
specifier|static
name|gint
name|opw
init|=
literal|0
decl_stmt|;
name|gint
name|preview_x
init|=
literal|1
operator|+
name|printable_left
operator|+
name|preview_ppi
operator|*
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|/
literal|72
decl_stmt|;
name|gint
name|preview_y
init|=
literal|1
operator|+
name|printable_top
operator|+
name|preview_ppi
operator|*
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|/
literal|72
decl_stmt|;
name|gint
name|preview_w
init|=
name|MAX
argument_list|(
literal|1
argument_list|,
operator|(
name|preview_ppi
operator|*
name|print_width
operator|)
operator|/
literal|72
operator|-
literal|1
argument_list|)
decl_stmt|;
name|gint
name|preview_h
init|=
name|MAX
argument_list|(
literal|1
argument_list|,
operator|(
name|preview_ppi
operator|*
name|print_height
operator|)
operator|/
literal|72
operator|-
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
name|gc
operator|==
name|NULL
condition|)
block|{
name|gc
operator|=
name|gdk_gc_new
argument_list|(
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|gcinv
operator|=
name|gdk_gc_new
argument_list|(
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|gcinv
argument_list|,
name|GDK_INVERT
argument_list|)
expr_stmt|;
name|gcset
operator|=
name|gdk_gc_new
argument_list|(
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|gcset
argument_list|,
name|GDK_SET
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|preview_valid
condition|)
block|{
name|gint
name|v_denominator
init|=
name|preview_h
operator|>
literal|1
condition|?
name|preview_h
operator|-
literal|1
else|:
literal|1
decl_stmt|;
name|gint
name|v_numerator
init|=
operator|(
name|thumbnail_h
operator|-
literal|1
operator|)
operator|%
name|v_denominator
decl_stmt|;
name|gint
name|v_whole
init|=
operator|(
name|thumbnail_h
operator|-
literal|1
operator|)
operator|/
name|v_denominator
decl_stmt|;
name|gint
name|h_denominator
init|=
name|preview_w
operator|>
literal|1
condition|?
name|preview_w
operator|-
literal|1
else|:
literal|1
decl_stmt|;
name|gint
name|h_numerator
init|=
operator|(
name|thumbnail_w
operator|-
literal|1
operator|)
operator|%
name|h_denominator
decl_stmt|;
name|gint
name|h_whole
init|=
operator|(
name|thumbnail_w
operator|-
literal|1
operator|)
operator|/
name|h_denominator
decl_stmt|;
name|gint
name|adjusted_preview_width
init|=
name|adjusted_thumbnail_bpp
operator|*
name|preview_w
decl_stmt|;
name|gint
name|adjusted_thumbnail_width
init|=
name|adjusted_thumbnail_bpp
operator|*
name|thumbnail_w
decl_stmt|;
name|gint
name|v_cur
init|=
literal|0
decl_stmt|;
name|gint
name|v_last
init|=
operator|-
literal|1
decl_stmt|;
name|gint
name|v_error
init|=
name|v_denominator
operator|/
literal|2
decl_stmt|;
name|gint
name|y
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
name|preview_data
condition|)
name|g_free
argument_list|(
name|preview_data
argument_list|)
expr_stmt|;
name|preview_data
operator|=
name|g_malloc
argument_list|(
literal|3
operator|*
name|preview_h
operator|*
name|preview_w
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|preview_h
condition|;
name|y
operator|++
control|)
block|{
name|guchar
modifier|*
name|outbuf
init|=
name|preview_data
operator|+
name|adjusted_preview_width
operator|*
name|y
decl_stmt|;
if|if
condition|(
name|v_cur
operator|==
name|v_last
condition|)
block|{
name|memcpy
argument_list|(
name|outbuf
argument_list|,
name|outbuf
operator|-
name|adjusted_preview_width
argument_list|,
name|adjusted_preview_width
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|guchar
modifier|*
name|inbuf
init|=
name|adjusted_thumbnail_data
operator|-
name|adjusted_thumbnail_bpp
operator|+
name|adjusted_thumbnail_width
operator|*
name|v_cur
decl_stmt|;
name|gint
name|h_cur
init|=
literal|0
decl_stmt|;
name|gint
name|h_last
init|=
operator|-
literal|1
decl_stmt|;
name|gint
name|h_error
init|=
name|h_denominator
operator|/
literal|2
decl_stmt|;
name|gint
name|x
decl_stmt|;
name|v_last
operator|=
name|v_cur
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|preview_w
condition|;
name|x
operator|++
control|)
block|{
if|if
condition|(
name|h_cur
operator|==
name|h_last
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|adjusted_thumbnail_bpp
condition|;
name|i
operator|++
control|)
name|outbuf
index|[
name|i
index|]
operator|=
name|outbuf
index|[
name|i
operator|-
name|adjusted_thumbnail_bpp
index|]
expr_stmt|;
block|}
else|else
block|{
name|inbuf
operator|+=
name|adjusted_thumbnail_bpp
operator|*
operator|(
name|h_cur
operator|-
name|h_last
operator|)
expr_stmt|;
name|h_last
operator|=
name|h_cur
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|adjusted_thumbnail_bpp
condition|;
name|i
operator|++
control|)
name|outbuf
index|[
name|i
index|]
operator|=
name|inbuf
index|[
name|i
index|]
expr_stmt|;
block|}
name|outbuf
operator|+=
name|adjusted_thumbnail_bpp
expr_stmt|;
name|h_cur
operator|+=
name|h_whole
expr_stmt|;
name|h_error
operator|+=
name|h_numerator
expr_stmt|;
if|if
condition|(
name|h_error
operator|>=
name|h_denominator
condition|)
block|{
name|h_error
operator|-=
name|h_denominator
expr_stmt|;
name|h_cur
operator|++
expr_stmt|;
block|}
block|}
block|}
name|v_cur
operator|+=
name|v_whole
expr_stmt|;
name|v_error
operator|+=
name|v_numerator
expr_stmt|;
if|if
condition|(
name|v_error
operator|>=
name|v_denominator
condition|)
block|{
name|v_error
operator|-=
name|v_denominator
expr_stmt|;
name|v_cur
operator|++
expr_stmt|;
block|}
block|}
name|preview_valid
operator|=
literal|1
expr_stmt|;
block|}
comment|/* draw paper frame */
name|gdk_draw_rectangle
argument_list|(
name|preview
operator|->
name|window
argument_list|,
name|gc
argument_list|,
literal|0
argument_list|,
name|paper_left
argument_list|,
name|paper_top
argument_list|,
name|MAX
argument_list|(
literal|2
argument_list|,
name|preview_ppi
operator|*
name|paper_width
operator|/
literal|72
argument_list|)
argument_list|,
name|MAX
argument_list|(
literal|2
argument_list|,
name|preview_ppi
operator|*
name|paper_height
operator|/
literal|72
argument_list|)
argument_list|)
expr_stmt|;
comment|/* draw printable frame */
name|gdk_draw_rectangle
argument_list|(
name|preview
operator|->
name|window
argument_list|,
name|gc
argument_list|,
literal|0
argument_list|,
name|printable_left
argument_list|,
name|printable_top
argument_list|,
name|MAX
argument_list|(
literal|2
argument_list|,
name|preview_ppi
operator|*
name|printable_width
operator|/
literal|72
argument_list|)
argument_list|,
name|MAX
argument_list|(
literal|2
argument_list|,
name|preview_ppi
operator|*
name|printable_height
operator|/
literal|72
argument_list|)
argument_list|)
expr_stmt|;
name|draw_arrow
argument_list|(
name|preview
operator|->
name|window
argument_list|,
name|gcset
argument_list|,
name|paper_left
argument_list|,
name|paper_top
argument_list|,
name|orient
argument_list|)
expr_stmt|;
if|if
condition|(
name|adjusted_thumbnail_bpp
operator|==
literal|1
condition|)
name|gdk_draw_gray_image
argument_list|(
name|preview
operator|->
name|window
argument_list|,
name|gc
argument_list|,
name|preview_x
argument_list|,
name|preview_y
argument_list|,
name|preview_w
argument_list|,
name|preview_h
argument_list|,
name|GDK_RGB_DITHER_NORMAL
argument_list|,
name|preview_data
argument_list|,
name|preview_w
argument_list|)
expr_stmt|;
else|else
name|gdk_draw_rgb_image
argument_list|(
name|preview
operator|->
name|window
argument_list|,
name|gc
argument_list|,
name|preview_x
argument_list|,
name|preview_y
argument_list|,
name|preview_w
argument_list|,
name|preview_h
argument_list|,
name|GDK_RGB_DITHER_NORMAL
argument_list|,
name|preview_data
argument_list|,
literal|3
operator|*
name|preview_w
argument_list|)
expr_stmt|;
comment|/* draw orientation arrow pointing to top-of-paper */
name|draw_arrow
argument_list|(
name|preview
operator|->
name|window
argument_list|,
name|gcinv
argument_list|,
name|paper_left
argument_list|,
name|paper_top
argument_list|,
name|orient
argument_list|)
expr_stmt|;
name|opx
operator|=
name|preview_x
expr_stmt|;
name|opy
operator|=
name|preview_y
expr_stmt|;
name|oph
operator|=
name|preview_h
expr_stmt|;
name|opw
operator|=
name|preview_w
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_preview_expose (void)
name|gimp_preview_expose
parameter_list|(
name|void
parameter_list|)
block|{
name|gimp_do_preview_thumbnail
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_preview_update (void)
name|gimp_preview_update
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|temp
decl_stmt|;
name|gint
name|orient
decl_stmt|;
comment|/* True orientation of page */
name|gdouble
name|max_ppi_scaling
decl_stmt|;
comment|/* Maximum PPI for current page size */
name|gdouble
name|min_ppi_scaling
decl_stmt|;
comment|/* Minimum PPI for current page size */
name|gdouble
name|min_ppi_scaling1
decl_stmt|;
comment|/* Minimum PPI for current page size */
name|gdouble
name|min_ppi_scaling2
decl_stmt|;
comment|/* Minimum PPI for current page size */
name|gdouble
name|unit_scaler
init|=
literal|72.0
decl_stmt|;
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|media_size
operator|)
operator|(
name|current_printer
operator|,
operator|*
name|pv
operator|,
operator|&
name|paper_width
operator|,
operator|&
name|paper_height
operator|)
expr_stmt|;
operator|(
name|stp_printer_get_printfuncs
argument_list|(
name|current_printer
argument_list|)
operator|->
name|imageable_area
operator|)
operator|(
name|current_printer
operator|,
operator|*
name|pv
operator|,
operator|&
name|left
operator|,
operator|&
name|right
operator|,
operator|&
name|bottom
operator|,
operator|&
name|top
operator|)
expr_stmt|;
comment|/* Rationalise things a bit by measuring everything from the top left */
name|top
operator|=
name|paper_height
operator|-
name|top
expr_stmt|;
name|bottom
operator|=
name|paper_height
operator|-
name|bottom
expr_stmt|;
name|printable_width
operator|=
name|right
operator|-
name|left
expr_stmt|;
name|printable_height
operator|=
name|bottom
operator|-
name|top
expr_stmt|;
if|if
condition|(
name|stp_get_orientation
argument_list|(
operator|*
name|pv
argument_list|)
operator|==
name|ORIENT_AUTO
condition|)
block|{
if|if
condition|(
operator|(
name|printable_width
operator|>=
name|printable_height
operator|&&
name|image_width
operator|>=
name|image_height
operator|)
operator|||
operator|(
name|printable_height
operator|>=
name|printable_width
operator|&&
name|image_height
operator|>=
name|image_width
operator|)
condition|)
name|orient
operator|=
name|ORIENT_PORTRAIT
expr_stmt|;
else|else
name|orient
operator|=
name|ORIENT_LANDSCAPE
expr_stmt|;
block|}
else|else
name|orient
operator|=
name|stp_get_orientation
argument_list|(
operator|*
name|pv
argument_list|)
expr_stmt|;
comment|/*    * Adjust page dimensions depending on the page orientation.    */
name|bottom
operator|=
name|paper_height
operator|-
name|bottom
expr_stmt|;
name|right
operator|=
name|paper_width
operator|-
name|right
expr_stmt|;
if|if
condition|(
name|orient
operator|==
name|ORIENT_LANDSCAPE
operator|||
name|orient
operator|==
name|ORIENT_SEASCAPE
condition|)
block|{
name|temp
operator|=
name|printable_width
expr_stmt|;
name|printable_width
operator|=
name|printable_height
expr_stmt|;
name|printable_height
operator|=
name|temp
expr_stmt|;
name|temp
operator|=
name|paper_width
expr_stmt|;
name|paper_width
operator|=
name|paper_height
expr_stmt|;
name|paper_height
operator|=
name|temp
expr_stmt|;
if|if
condition|(
name|orient
operator|==
name|ORIENT_LANDSCAPE
condition|)
block|{
name|temp
operator|=
name|left
expr_stmt|;
name|left
operator|=
name|bottom
expr_stmt|;
name|bottom
operator|=
name|right
expr_stmt|;
name|right
operator|=
name|top
expr_stmt|;
name|top
operator|=
name|temp
expr_stmt|;
block|}
else|else
block|{
name|temp
operator|=
name|left
expr_stmt|;
name|left
operator|=
name|top
expr_stmt|;
name|top
operator|=
name|right
expr_stmt|;
name|right
operator|=
name|bottom
expr_stmt|;
name|bottom
operator|=
name|temp
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|orient
operator|==
name|ORIENT_UPSIDEDOWN
condition|)
block|{
name|temp
operator|=
name|left
expr_stmt|;
name|left
operator|=
name|right
expr_stmt|;
name|right
operator|=
name|temp
expr_stmt|;
name|temp
operator|=
name|top
expr_stmt|;
name|top
operator|=
name|bottom
expr_stmt|;
name|bottom
operator|=
name|temp
expr_stmt|;
block|}
name|bottom
operator|=
name|paper_height
operator|-
name|bottom
expr_stmt|;
name|right
operator|=
name|paper_width
operator|-
name|right
expr_stmt|;
if|if
condition|(
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
block|{
name|gdouble
name|twidth
decl_stmt|;
name|min_ppi_scaling1
operator|=
literal|72.0
operator|*
operator|(
name|gdouble
operator|)
name|image_width
operator|/
name|printable_width
expr_stmt|;
name|min_ppi_scaling2
operator|=
literal|72.0
operator|*
operator|(
name|gdouble
operator|)
name|image_height
operator|/
name|printable_height
expr_stmt|;
if|if
condition|(
name|min_ppi_scaling1
operator|>
name|min_ppi_scaling2
condition|)
name|min_ppi_scaling
operator|=
name|min_ppi_scaling1
expr_stmt|;
else|else
name|min_ppi_scaling
operator|=
name|min_ppi_scaling2
expr_stmt|;
name|max_ppi_scaling
operator|=
name|min_ppi_scaling
operator|*
literal|20
expr_stmt|;
if|if
condition|(
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
operator|&&
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|>
operator|-
name|min_ppi_scaling
condition|)
name|stp_set_scaling
argument_list|(
operator|*
name|pv
argument_list|,
operator|-
name|min_ppi_scaling
argument_list|)
expr_stmt|;
name|twidth
operator|=
operator|(
literal|72.0
operator|*
operator|(
name|gdouble
operator|)
name|image_width
operator|/
operator|-
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|)
expr_stmt|;
name|print_width
operator|=
name|twidth
operator|+
literal|.5
expr_stmt|;
name|print_height
operator|=
operator|(
name|twidth
operator|*
operator|(
name|gdouble
operator|)
name|image_height
operator|/
name|image_width
operator|)
operator|+
literal|.5
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|lower
operator|=
name|min_ppi_scaling
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|upper
operator|=
name|max_ppi_scaling
expr_stmt|;
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
operator|->
name|value
operator|=
operator|-
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|suppress_scaling_adjustment
condition|)
block|{
name|suppress_preview_reset
operator|++
expr_stmt|;
name|gtk_adjustment_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|suppress_scaling_callback
operator|=
name|TRUE
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|scaling_ppi
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|suppress_scaling_callback
operator|=
name|FALSE
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaling_adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|suppress_preview_reset
operator|--
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* we do stp_get_scaling(*pv) % of height or width, whatever is less */
comment|/* this is relative to printable size */
if|if
condition|(
name|image_width
operator|*
name|printable_height
operator|>
name|printable_width
operator|*
name|image_height
condition|)
comment|/* if image_width/image_height> printable_width/printable_height */
comment|/* i.e. if image is wider relative to its height than the width 	   of the printable area relative to its height */
block|{
name|gdouble
name|twidth
init|=
literal|.5
operator|+
name|printable_width
operator|*
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|/
literal|100
decl_stmt|;
name|print_width
operator|=
name|twidth
expr_stmt|;
name|print_height
operator|=
name|twidth
operator|*
operator|(
name|gdouble
operator|)
name|image_height
operator|/
operator|(
name|gdouble
operator|)
name|image_width
expr_stmt|;
block|}
else|else
block|{
name|gdouble
name|theight
init|=
literal|.5
operator|+
name|printable_height
operator|*
name|stp_get_scaling
argument_list|(
operator|*
name|pv
argument_list|)
operator|/
literal|100
decl_stmt|;
name|print_height
operator|=
name|theight
expr_stmt|;
name|print_width
operator|=
name|theight
operator|*
operator|(
name|gdouble
operator|)
name|image_width
operator|/
operator|(
name|gdouble
operator|)
name|image_height
expr_stmt|;
block|}
block|}
name|preview_ppi
operator|=
name|PREVIEW_SIZE_HORIZ
operator|*
literal|72.0
operator|/
operator|(
name|gdouble
operator|)
name|paper_width
expr_stmt|;
if|if
condition|(
name|PREVIEW_SIZE_VERT
operator|*
literal|72
operator|/
name|paper_height
operator|<
name|preview_ppi
condition|)
name|preview_ppi
operator|=
name|PREVIEW_SIZE_VERT
operator|*
literal|72.0
operator|/
operator|(
name|gdouble
operator|)
name|paper_height
expr_stmt|;
if|if
condition|(
name|preview_ppi
operator|>
name|MAX_PREVIEW_PPI
condition|)
name|preview_ppi
operator|=
name|MAX_PREVIEW_PPI
expr_stmt|;
name|paper_left
operator|=
operator|(
name|PREVIEW_SIZE_HORIZ
operator|-
name|preview_ppi
operator|*
name|paper_width
operator|/
literal|72
operator|)
operator|/
literal|2
expr_stmt|;
name|paper_top
operator|=
operator|(
name|PREVIEW_SIZE_VERT
operator|-
name|preview_ppi
operator|*
name|paper_height
operator|/
literal|72
operator|)
operator|/
literal|2
expr_stmt|;
name|printable_left
operator|=
name|paper_left
operator|+
name|preview_ppi
operator|*
name|left
operator|/
literal|72
expr_stmt|;
name|printable_top
operator|=
name|paper_top
operator|+
name|preview_ppi
operator|*
name|top
operator|/
literal|72
expr_stmt|;
if|if
condition|(
name|preview
operator|==
name|NULL
operator|||
name|preview
operator|->
name|window
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
block|{
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
operator|(
name|paper_width
operator|-
name|print_width
operator|)
operator|/
literal|2
operator|-
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/* we leave stp_get_left(*pv) etc. relative to printable area */
if|if
condition|(
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|>
operator|(
name|printable_width
operator|-
name|print_width
operator|)
condition|)
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
name|printable_width
operator|-
name|print_width
argument_list|)
expr_stmt|;
if|if
condition|(
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
block|{
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
operator|(
operator|(
name|paper_height
operator|-
name|print_height
operator|)
operator|/
literal|2
operator|)
operator|-
name|top
argument_list|)
expr_stmt|;
if|if
condition|(
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|>
operator|(
name|printable_height
operator|-
name|print_height
operator|)
condition|)
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
name|printable_height
operator|-
name|print_height
argument_list|)
expr_stmt|;
if|if
condition|(
name|stp_get_unit
argument_list|(
operator|*
name|pv
argument_list|)
condition|)
name|unit_scaler
operator|/=
literal|2.54
expr_stmt|;
name|set_entry_value
argument_list|(
name|top_entry
argument_list|,
operator|(
name|top
operator|+
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|left_entry
argument_list|,
operator|(
name|left
operator|+
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|bottom_entry
argument_list|,
operator|(
name|top
operator|+
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
name|print_height
operator|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|bottom_border_entry
argument_list|,
operator|(
name|paper_height
operator|-
operator|(
name|top
operator|+
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
name|print_height
operator|)
operator|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|right_entry
argument_list|,
operator|(
name|left
operator|+
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
name|print_width
operator|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|right_border_entry
argument_list|,
operator|(
name|paper_width
operator|-
operator|(
name|left
operator|+
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
name|print_width
operator|)
operator|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|width_entry
argument_list|,
name|print_width
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|height_entry
argument_list|,
name|print_height
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_width
argument_list|,
name|stp_get_page_width
argument_list|(
operator|*
name|pv
argument_list|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|set_entry_value
argument_list|(
name|custom_size_height
argument_list|,
name|stp_get_page_height
argument_list|(
operator|*
name|pv
argument_list|)
operator|/
name|unit_scaler
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* draw image */
if|if
condition|(
operator|!
name|suppress_preview_update
condition|)
name|gtk_widget_queue_draw
argument_list|(
name|preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  gimp_preview_button_callback() -  */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|gimp_preview_button_callback (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|gimp_preview_button_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|GDK_BUTTON_PRESS
condition|)
block|{
if|if
condition|(
name|preview_active
operator|==
literal|0
condition|)
block|{
name|mouse_x
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|mouse_y
operator|=
name|event
operator|->
name|y
expr_stmt|;
name|old_left
operator|=
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
expr_stmt|;
name|old_top
operator|=
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
expr_stmt|;
name|mouse_button
operator|=
name|event
operator|->
name|button
expr_stmt|;
name|buttons_mask
operator|=
literal|1
operator|<<
name|event
operator|->
name|button
expr_stmt|;
name|buttons_pressed
operator|++
expr_stmt|;
name|preview_active
operator|=
literal|1
expr_stmt|;
name|gimp_help_disable_tooltips
argument_list|()
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
name|move_constraint
operator|=
name|MOVE_CONSTRAIN
expr_stmt|;
else|else
name|move_constraint
operator|=
name|MOVE_ANY
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|preview_active
operator|==
literal|1
condition|)
block|{
if|if
condition|(
operator|(
name|buttons_mask
operator|&
operator|(
literal|1
operator|<<
name|event
operator|->
name|button
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|gimp_help_enable_tooltips
argument_list|()
expr_stmt|;
name|preview_active
operator|=
operator|-
literal|1
expr_stmt|;
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
name|old_left
argument_list|)
expr_stmt|;
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
name|old_top
argument_list|)
expr_stmt|;
name|gimp_preview_update
argument_list|()
expr_stmt|;
name|buttons_mask
operator||=
literal|1
operator|<<
name|event
operator|->
name|button
expr_stmt|;
name|buttons_pressed
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
operator|(
name|buttons_mask
operator|&
operator|(
literal|1
operator|<<
name|event
operator|->
name|button
operator|)
operator|)
operator|==
literal|0
condition|)
block|{
name|buttons_mask
operator||=
literal|1
operator|<<
name|event
operator|->
name|button
expr_stmt|;
name|buttons_pressed
operator|++
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|GDK_BUTTON_RELEASE
condition|)
block|{
name|buttons_pressed
operator|--
expr_stmt|;
name|buttons_mask
operator|&=
operator|~
operator|(
literal|1
operator|<<
name|event
operator|->
name|button
operator|)
expr_stmt|;
if|if
condition|(
name|buttons_pressed
operator|==
literal|0
condition|)
block|{
name|gimp_help_enable_tooltips
argument_list|()
expr_stmt|;
name|preview_active
operator|=
literal|0
expr_stmt|;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*  *  gimp_preview_motion_callback() -  */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|gimp_preview_motion_callback (GtkWidget * widget,GdkEventMotion * event,gpointer data)
name|gimp_preview_motion_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventMotion
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|!=
name|GDK_MOTION_NOTIFY
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|preview_active
operator|!=
literal|1
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
operator|||
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|<
literal|0
condition|)
block|{
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
literal|72
operator|*
operator|(
name|printable_width
operator|-
name|print_width
operator|)
operator|/
literal|20
argument_list|)
expr_stmt|;
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
literal|72
operator|*
operator|(
name|printable_height
operator|-
name|print_height
operator|)
operator|/
literal|20
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|move_constraint
operator|==
name|MOVE_CONSTRAIN
condition|)
block|{
name|int
name|dx
init|=
name|abs
argument_list|(
name|event
operator|->
name|x
operator|-
name|mouse_x
argument_list|)
decl_stmt|;
name|int
name|dy
init|=
name|abs
argument_list|(
name|event
operator|->
name|y
operator|-
name|mouse_y
argument_list|)
decl_stmt|;
if|if
condition|(
name|dx
operator|>
name|dy
operator|&&
name|dx
operator|>
literal|3
condition|)
name|move_constraint
operator|=
name|MOVE_HORIZONTAL
expr_stmt|;
elseif|else
if|if
condition|(
name|dy
operator|>
name|dx
operator|&&
name|dy
operator|>
literal|3
condition|)
name|move_constraint
operator|=
name|MOVE_VERTICAL
expr_stmt|;
else|else
return|return
name|FALSE
return|;
block|}
if|if
condition|(
name|mouse_button
operator|==
literal|2
condition|)
block|{
name|int
name|changes
init|=
literal|0
decl_stmt|;
name|int
name|y_threshold
init|=
name|MAX
argument_list|(
literal|1
argument_list|,
operator|(
name|preview_ppi
operator|*
name|print_height
operator|)
operator|/
literal|72
argument_list|)
decl_stmt|;
if|if
condition|(
name|move_constraint
operator|&
name|MOVE_HORIZONTAL
condition|)
block|{
name|int
name|x_threshold
init|=
name|MAX
argument_list|(
literal|1
argument_list|,
operator|(
name|preview_ppi
operator|*
name|print_width
operator|)
operator|/
literal|72
argument_list|)
decl_stmt|;
while|while
condition|(
name|event
operator|->
name|x
operator|-
name|mouse_x
operator|>=
name|x_threshold
condition|)
block|{
if|if
condition|(
name|left
operator|+
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
operator|(
name|print_width
operator|*
literal|2
operator|)
operator|<=
name|right
condition|)
block|{
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
name|print_width
argument_list|)
expr_stmt|;
name|mouse_x
operator|+=
name|x_threshold
expr_stmt|;
name|changes
operator|=
literal|1
expr_stmt|;
block|}
else|else
break|break;
block|}
while|while
condition|(
name|mouse_x
operator|-
name|event
operator|->
name|x
operator|>=
name|x_threshold
condition|)
block|{
if|if
condition|(
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|>=
name|print_width
condition|)
block|{
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
operator|-
name|print_width
argument_list|)
expr_stmt|;
name|mouse_x
operator|-=
name|x_threshold
expr_stmt|;
name|changes
operator|=
literal|1
expr_stmt|;
block|}
else|else
break|break;
block|}
block|}
if|if
condition|(
name|move_constraint
operator|&
name|MOVE_VERTICAL
condition|)
block|{
while|while
condition|(
name|event
operator|->
name|y
operator|-
name|mouse_y
operator|>=
name|y_threshold
condition|)
block|{
if|if
condition|(
name|top
operator|+
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
operator|(
name|print_height
operator|*
literal|2
operator|)
operator|<=
name|bottom
condition|)
block|{
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|+
name|print_height
argument_list|)
expr_stmt|;
name|mouse_y
operator|+=
name|y_threshold
expr_stmt|;
name|changes
operator|=
literal|1
expr_stmt|;
block|}
else|else
break|break;
block|}
while|while
condition|(
name|mouse_y
operator|-
name|event
operator|->
name|y
operator|>=
name|y_threshold
condition|)
block|{
if|if
condition|(
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|>=
name|print_height
condition|)
block|{
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
operator|-
name|print_height
argument_list|)
expr_stmt|;
name|mouse_y
operator|-=
name|y_threshold
expr_stmt|;
name|changes
operator|=
literal|1
expr_stmt|;
block|}
else|else
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|changes
condition|)
return|return
name|FALSE
return|;
block|}
else|else
block|{
name|gint
name|old_top
init|=
name|stp_get_top
argument_list|(
operator|*
name|pv
argument_list|)
decl_stmt|;
name|gint
name|old_left
init|=
name|stp_get_left
argument_list|(
operator|*
name|pv
argument_list|)
decl_stmt|;
name|gint
name|new_top
init|=
name|old_top
decl_stmt|;
name|gint
name|new_left
init|=
name|old_left
decl_stmt|;
name|gint
name|changes
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|mouse_button
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|move_constraint
operator|&
name|MOVE_VERTICAL
condition|)
name|new_top
operator|+=
literal|72
operator|*
operator|(
name|event
operator|->
name|y
operator|-
name|mouse_y
operator|)
operator|/
name|preview_ppi
expr_stmt|;
if|if
condition|(
name|move_constraint
operator|&
name|MOVE_HORIZONTAL
condition|)
name|new_left
operator|+=
literal|72
operator|*
operator|(
name|event
operator|->
name|x
operator|-
name|mouse_x
operator|)
operator|/
name|preview_ppi
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|move_constraint
operator|&
name|MOVE_VERTICAL
condition|)
name|new_top
operator|+=
name|event
operator|->
name|y
operator|-
name|mouse_y
expr_stmt|;
if|if
condition|(
name|move_constraint
operator|&
name|MOVE_HORIZONTAL
condition|)
name|new_left
operator|+=
name|event
operator|->
name|x
operator|-
name|mouse_x
expr_stmt|;
block|}
if|if
condition|(
name|new_top
operator|<
literal|0
condition|)
name|new_top
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|new_top
operator|>
operator|(
name|bottom
operator|-
name|top
operator|)
operator|-
name|print_height
condition|)
name|new_top
operator|=
operator|(
name|bottom
operator|-
name|top
operator|)
operator|-
name|print_height
expr_stmt|;
if|if
condition|(
name|new_left
operator|<
literal|0
condition|)
name|new_left
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|new_left
operator|>
operator|(
name|right
operator|-
name|left
operator|)
operator|-
name|print_width
condition|)
name|new_left
operator|=
operator|(
name|right
operator|-
name|left
operator|)
operator|-
name|print_width
expr_stmt|;
if|if
condition|(
name|new_top
operator|!=
name|old_top
condition|)
block|{
name|stp_set_top
argument_list|(
operator|*
name|pv
argument_list|,
name|new_top
argument_list|)
expr_stmt|;
name|changes
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|new_left
operator|!=
name|old_left
condition|)
block|{
name|stp_set_left
argument_list|(
operator|*
name|pv
argument_list|,
name|new_left
argument_list|)
expr_stmt|;
name|changes
operator|=
literal|1
expr_stmt|;
block|}
name|mouse_x
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|mouse_y
operator|=
name|event
operator|->
name|y
expr_stmt|;
if|if
condition|(
operator|!
name|changes
condition|)
return|return
name|FALSE
return|;
block|}
name|gimp_preview_update
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

end_unit

