begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * Screenshot plug-in  * Copyright 1998-2007 Sven Neumann<sven@gimp.org>  * Copyright 2003      Henrik Brix Andersen<brix@gimp.org>  * Copyright 2012      Simone Karin Lehmann - OS X patches  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"screenshot.h"
end_include

begin_include
include|#
directive|include
file|"screenshot-osx.h"
end_include

begin_include
include|#
directive|include
file|"screenshot-gnome-shell.h"
end_include

begin_include
include|#
directive|include
file|"screenshot-x11.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_comment
comment|/* GdkPixbuf RGBA C-Source image dump 1-byte-run-length-encoded */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__SUNPRO_C
end_ifdef

begin_pragma
pragma|#
directive|pragma
name|align
name|4
name|(
name|screenshot_icon
name|)
end_pragma

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_decl_stmt
DECL|variable|screenshot_icon
specifier|static
specifier|const
name|guint8
name|screenshot_icon
index|[]
name|__attribute__
argument_list|(
operator|(
name|__aligned__
argument_list|(
literal|4
argument_list|)
operator|)
argument_list|)
init|=
else|#
directive|else
specifier|static
specifier|const
name|guint8
name|screenshot_icon
index|[]
operator|=
endif|#
directive|endif
block|{
literal|""
comment|/* Pixbuf magic (0x47646b50) */
literal|"GdkP"
comment|/* length: header (24) + pixel_data (1582) */
literal|"\0\0\6F"
comment|/* pixdata_type (0x2010002) */
literal|"\2\1\0\2"
comment|/* rowstride (88) */
literal|"\0\0\0X"
comment|/* width (22) */
literal|"\0\0\0\26"
comment|/* height (22) */
literal|"\0\0\0\26"
comment|/* pixel_data: */
literal|"\213\0\0\0\0\1\242\242\242\5\203\242\242\242\31\221\0\0\0\0\2\27\27\26"
literal|"D\40\40\40\372\203)))\375\2\32\32\32\362\26\26\25"
literal|"0\217\0\0\0\0\2\2"
literal|"\2\2\322\307\310\307\377\203\377\377\377\377\2\263\263\262\363\0\0\0"
literal|"\314\217\0\0\0\0\2\6\6\6\334\206\207\205\377\202\252\253\251\377\3\252"
literal|"\252\251\377ghe\376\1\1\1\320\217\0\0\0\0\2\11\11\11\346./-\345\202G"
literal|"HE\25\3JKH\32"
literal|"01/\364\5\5\5\333\212\0\0\0\0\17\26\26\25\31\26\26\25"
literal|"0\26\26\25g\0\0\0\314+,+\331LMK\375EFD\362ffe\347iig\346lmk\346RSQ\362"
literal|"\13\13\13\360\0\0\0\314\2\2\2\321\26\26\25V\203\0\0\0\0#\26\26\25\31"
literal|"\26\26\25"
literal|"0\26\26\25n\3\3\3\331\2\2\2\332JJI\355\215\215\215\372\246"
literal|"\246\246\347\267\270\266\362\177\202~\377BC\77\377TUR\377\\]Y\377gid"
literal|"\377[]X\377\204\206\204\374wxw\276\224\225\224\314LLK\343\26\26\25D\0"
literal|"\0\0\0\26\26\25D\3\3\3\341\17\17\17\373ghg\377\237\240\236\377\273\274"
literal|"\272\377\302\303\300\377\272\273\270\377\200\201\177\377zzz\377tws\377"
literal|"\220\223\217\377\221\225\221\377\224\227\223\377\202\226\232\226\377"
literal|"K\177\202}\377xyu\377\217\221\215\377\226\227\226\365\0\0\0\371\0\0\0"
literal|"\0\2\2\2\330\257\261\257\377\275\276\273\377\262\263\260\377UWT\377Q"
literal|"SP\377suq\377]^[\377\304\304\304\377\303\303\303\377kmi\377MNJ\377WZ"
literal|"X\377[`_\377aeb\377gid\377}\200{\377SUQ\377FGE\377\200\201\200\377\12"
literal|"\12\12\357\0\0\0\0\4\4\4\345xyv\377\241\242\236\377\210\212\205\377v"
literal|"xt\377\220\222\217\377GIF\377+,)\377```\377jji\377UXV\377y\204\210\377"
literal|"\203\215\220\377~\204\207\377flo\377PW\\\377SWU\377JLI\377452\377tut"
literal|"\377\12\12\12\357\0\0\0\0\4\4\4\344opm\377\221\223\217\377}\177{\377"
literal|"\215\217\213\377`b_\377()'\377*+)\377785\377VXV\377u~\202\377nsu\377"
literal|"VYZ\377OST\377OQS\377JOP\377^cd\377698\377!\"!\377llk\377\12\12\12\357"
literal|"\0\0\0\0\3\3\3\345npl\377\220\221\216\377\202UWS\377\24GIF\377\40!\37"
literal|"\377*+)\3779:7\377^ce\377NRT\377UXY\377(,.\377\22\24\25\377!$&\377IL"
literal|"M\3778=\77\377RVX\377''&\377klk\377\12\12\12\357\0\0\0\1\3\3\3\345no"
literal|"l\377\220\221\216\377\202UWS\377\24GIF\377\40!\37\377*+)\3778:8\377T"
literal|"XY\377289\377\23\25\26\377\16\16\16\377\1\1\1\377\2\2\2\377\24\25\25"
literal|"\377.34\377289\377011\377aa`\377\11\11\11\360\0\0\0\3\3\3\3\345nol\377"
literal|"\204\205\202\377\202UWS\377\24GIF\377\40!\37\377*+)\377\77BA\37728:\377"
literal|"\34\40!\377\31\32\32\377\377\377\377\377hhh\377\40\40\40\377\22\22\22"
literal|"\377.00\377.46\377:>\77\377`a`\377\11\11\10\361\0\0\0\7\3\3\3\345mok"
literal|"\377z{x\377\202UWS\377\24GIF\377\40!\37\377*+)\377HJI\377.46\377\25\27"
literal|"\30\377\40\40\40\377hhh\377\232\232\232\377}}}\377'''\3779;;\377/57\377"
literal|"599\377``_\377\11\11\10\362\0\0\0\15\3\3\3\345lnk\377rsp\377\202UWS\377"
literal|"\24GIF\377\40!\37\377,-*\377>@>\377.46\377\35\37\40\377\1\1\1\377888"
literal|"\377\214\214\214\377\213\213\213\377AAA\377JKK\377/57\3776:;\377WXV\377"
literal|"\6\6\6\364\0\0\0\21\0\0\0\371\201\202\177\377mok\377\202UWS\377iGIF\377"
literal|"MNM\377RRR\372ghg\364[`b\377+/0\377\17\17\17\377\"\"\"\377'''\377HHH"
literal|"\377\263\263\263\377SUU\377W\\^\377CFF\374<<<\376\20\20\17\317\0\0\0"
literal|"\20\24\24\23]\4\4\4\353\177\177~\375|}z\373}~|\374hih\3769:9\371\0\0"
literal|"\0\347\0\0\0\351\7\7\7\367.46\377256\377\40\40\40\377(((\377:::\377`"
literal|"ab\3779>\77\377\11\13\13\376\0\0\0\353\0\0\0\300\14\14\13H\0\0\0\15\0"
literal|"\0\0\4\23\23\22L\0\0\0\332\0\0\0\341\0\0\0\346\0\0\0\341\14\14\13{\0"
literal|"\0\0V\0\0\0a\0\0\0l\10\11\11\371\\^_\377LOP\377ILL\377LOQ\377QUV\377"
literal|"\16\17\17\377\34\37\40\244\0\0\0`\0\0\0"
literal|"4\0\0\0\27\0\0\0\7\0\0\0\1\0"
literal|"\0\0\3\0\0\0\10\0\0\0\21\0\0\0\34\0\0\0'\0\0\0"
literal|"0\0\0\0"
literal|"6\0\0\0=\0\0"
literal|"\0A\0\0\0F\4\5\5\355\12\13\13\371\17\20\20\376\15\16\16\375\10\10\11"
literal|"\365\7\10\11j\0\0\0G\0\0\0-\0\0\0\30\0\0\0\13\0\0\0\4\0\0\0\0\0\0\0\1"
literal|"\0\0\0\2\0\0\0\4\0\0\0\11\0\0\0\16\0\0\0\23\0\0\0\31\0\0\0\35\0\0\0!"
literal|"\0\0\0#\0\0\0$\0\0\0%\0\0\0$\0\0\0&\0\0\0%\0\0\0\36\0\0\0\27\0\0\0\20"
literal|"\0\0\0\10\0\0\0\3\0\0\0\1\204\0\0\0\0\5\0\0\0\1\0\0\0\2\0\0\0\4\0\0\0"
literal|"\5\0\0\0\6\202\0\0\0\10\11\0\0\0\11\0\0\0\7\0\0\0\10\0\0\0\5\0\0\0\7"
literal|"\0\0\0\6\0\0\0\5\0\0\0\3\0\0\0\1\202\0\0\0\0"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Defines */
end_comment

begin_define
DECL|macro|PLUG_IN_PROC
define|#
directive|define
name|PLUG_IN_PROC
value|"plug-in-screenshot"
end_define

begin_define
DECL|macro|PLUG_IN_BINARY
define|#
directive|define
name|PLUG_IN_BINARY
value|"screenshot"
end_define

begin_define
DECL|macro|PLUG_IN_ROLE
define|#
directive|define
name|PLUG_IN_ROLE
value|"gimp-screenshot"
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|GDK_NATIVE_WINDOW_POINTER
end_ifdef

begin_if
if|#
directive|if
name|GLIB_SIZEOF_VOID_P
operator|!=
literal|4
end_if

begin_warning
warning|#
directive|warning
warning|window_id does not fit in PDB_INT32
end_warning

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpPDBStatusType
name|shoot
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|,
name|gint32
modifier|*
name|image_ID
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|shoot_dialog
parameter_list|(
name|GdkScreen
modifier|*
modifier|*
name|screen
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|shoot_quit_timeout
parameter_list|(
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Global Variables */
end_comment

begin_decl_stmt
DECL|variable|backend
specifier|static
name|ScreenshotBackend
name|backend
init|=
name|SCREENSHOT_BACKEND_NONE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|capabilities
specifier|static
name|ScreenshotCapabilities
name|capabilities
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|shootvals
specifier|static
name|ScreenshotValues
name|shootvals
init|=
block|{
name|SHOOT_WINDOW
block|,
comment|/* root window  */
ifdef|#
directive|ifdef
name|PLATFORM_OSX
name|FALSE
block|,
else|#
directive|else
name|TRUE
block|,
comment|/* include WM decorations */
endif|#
directive|endif
literal|0
block|,
comment|/* window ID    */
literal|0
block|,
comment|/* select delay */
literal|0
block|,
comment|/* coords of region dragged out by pointer */
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|FALSE
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
specifier|const
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Functions */
end_comment

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
specifier|const
name|GimpParamDef
name|args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode { RUN-INTERACTIVE (0), RUN-NONINTERACTIVE (1) }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"root"
block|,
literal|"Root window { TRUE, FALSE }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"window-id"
block|,
literal|"Window id"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"x1"
block|,
literal|"(optional) Region left x coord"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"y1"
block|,
literal|"(optional) Region top y coord"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"x2"
block|,
literal|"(optional) Region right x coord"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"y2"
block|,
literal|"(optional) Region bottom y coord"
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Output image"
block|}
block|}
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|N_
argument_list|(
literal|"Create an image from an area of the screen"
argument_list|)
argument_list|,
literal|"The plug-in takes screenshots of an "
literal|"interactively selected window or of the desktop, "
literal|"either the whole desktop or an interactively "
literal|"selected region. When called non-interactively, it "
literal|"may grab the root window or use the window-id "
literal|"passed as a parameter.  The last four parameters "
literal|"are optional and can be used to specify the corners "
literal|"of the region to be grabbed."
ifdef|#
directive|ifdef
name|PLATFORM_OSX
literal|"On Mac OS X, when called non-interactively, the plugin"
literal|"only can take screenshots of the entire root window."
literal|"Grabbing a window or a region is not supported"
literal|"non-interactively. To grab a region or a particular"
literal|"window, you need to use the interactive mode."
endif|#
directive|endif
argument_list|,
literal|"Sven Neumann<sven@gimp.org>, "
literal|"Henrik Brix Andersen<brix@gimp.org>,"
literal|"Simone Karin Lehmann"
argument_list|,
literal|"1998 - 2008"
argument_list|,
literal|"v1.1 (2008/04)"
argument_list|,
name|N_
argument_list|(
literal|"_Screenshot..."
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|args
argument_list|)
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|return_vals
argument_list|)
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
name|gimp_plugin_menu_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
literal|"<Image>/File/Create/Acquire"
argument_list|)
expr_stmt|;
name|gimp_plugin_icon_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|GIMP_ICON_TYPE_INLINE_PIXBUF
argument_list|,
name|screenshot_icon
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (const gchar * name,gint nparams,const GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GimpParam
name|values
index|[
literal|2
index|]
decl_stmt|;
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
name|GimpRunMode
name|run_mode
decl_stmt|;
name|GdkScreen
modifier|*
name|screen
init|=
name|NULL
decl_stmt|;
name|gint32
name|image_ID
decl_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
name|gegl_init
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
ifdef|#
directive|ifdef
name|PLATFORM_OSX
if|if
condition|(
operator|!
name|backend
operator|&&
name|screenshot_osx_available
argument_list|()
condition|)
block|{
name|backend
operator|=
name|SCREENSHOT_BACKEND_OSX
expr_stmt|;
name|capabilities
operator|=
name|screenshot_osx_get_capabilities
argument_list|()
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
operator|!
name|backend
operator|&&
name|screenshot_gnome_shell_available
argument_list|()
condition|)
block|{
name|backend
operator|=
name|SCREENSHOT_BACKEND_GNOME_SHELL
expr_stmt|;
name|capabilities
operator|=
name|screenshot_gnome_shell_get_capabilities
argument_list|()
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|GDK_WINDOWING_X11
if|if
condition|(
operator|!
name|backend
operator|&&
name|screenshot_x11_available
argument_list|()
condition|)
block|{
name|backend
operator|=
name|SCREENSHOT_BACKEND_X11
expr_stmt|;
name|capabilities
operator|=
name|screenshot_x11_get_capabilities
argument_list|()
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* how are we running today? */
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|GIMP_RUN_INTERACTIVE
case|:
comment|/* Possibly retrieve data from a previous run */
name|gimp_get_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|shootvals
argument_list|)
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
literal|0
expr_stmt|;
comment|/* Get information from the dialog */
if|if
condition|(
operator|!
name|shoot_dialog
argument_list|(
operator|&
name|screen
argument_list|)
condition|)
name|status
operator|=
name|GIMP_PDB_CANCEL
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_NONINTERACTIVE
case|:
if|if
condition|(
name|nparams
operator|==
literal|3
condition|)
block|{
name|gboolean
name|do_root
init|=
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_int32
decl_stmt|;
name|shootvals
operator|.
name|shoot_type
operator|=
name|do_root
condition|?
name|SHOOT_ROOT
else|:
name|SHOOT_WINDOW
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|select_delay
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|nparams
operator|==
literal|7
condition|)
block|{
name|shootvals
operator|.
name|shoot_type
operator|=
name|SHOOT_REGION
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|select_delay
operator|=
literal|0
expr_stmt|;
name|shootvals
operator|.
name|x1
operator|=
name|param
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|y1
operator|=
name|param
index|[
literal|4
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|x2
operator|=
name|param
index|[
literal|5
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|y2
operator|=
name|param
index|[
literal|6
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|gdk_init_check
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
condition|)
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|capabilities
operator|&
name|SCREENSHOT_CAN_PICK_NONINTERACTIVELY
operator|)
condition|)
block|{
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_WINDOW
operator|||
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_REGION
condition|)
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_RUN_WITH_LAST_VALS
case|:
comment|/* Possibly retrieve data from a previous run */
name|gimp_get_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|shootvals
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|status
operator|=
name|shoot
argument_list|(
name|screen
argument_list|,
operator|&
name|image_ID
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
if|if
condition|(
name|run_mode
operator|==
name|GIMP_RUN_INTERACTIVE
condition|)
block|{
comment|/* Store variable states for next run */
name|gimp_set_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|shootvals
argument_list|,
sizeof|sizeof
argument_list|(
name|ScreenshotValues
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_display_new
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
comment|/* Give some sort of feedback that the shot is done */
if|if
condition|(
name|shootvals
operator|.
name|select_delay
operator|>
literal|0
condition|)
block|{
name|gdk_display_beep
argument_list|(
name|gdk_screen_get_display
argument_list|(
name|screen
argument_list|)
argument_list|)
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
comment|/* flush so the beep makes it to the server */
block|}
block|}
comment|/* set return values */
operator|*
name|nreturn_vals
operator|=
literal|2
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image_ID
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_comment
comment|/* The main Screenshot function */
end_comment

begin_function
specifier|static
name|GimpPDBStatusType
DECL|function|shoot (GdkScreen * screen,gint32 * image_ID)
name|shoot
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|,
name|gint32
modifier|*
name|image_ID
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|PLATFORM_OSX
if|if
condition|(
name|backend
operator|==
name|SCREENSHOT_BACKEND_OSX
condition|)
return|return
name|screenshot_osx_shoot
argument_list|(
operator|&
name|shootvals
argument_list|,
name|screen
argument_list|,
name|image_ID
argument_list|)
return|;
endif|#
directive|endif
if|if
condition|(
name|backend
operator|==
name|SCREENSHOT_BACKEND_GNOME_SHELL
condition|)
return|return
name|screenshot_gnome_shell_shoot
argument_list|(
operator|&
name|shootvals
argument_list|,
name|screen
argument_list|,
name|image_ID
argument_list|)
return|;
ifdef|#
directive|ifdef
name|GDK_WINDOWING_X11
if|if
condition|(
name|backend
operator|==
name|SCREENSHOT_BACKEND_X11
condition|)
return|return
name|screenshot_x11_shoot
argument_list|(
operator|&
name|shootvals
argument_list|,
name|screen
argument_list|,
name|image_ID
argument_list|)
return|;
endif|#
directive|endif
return|return
name|GIMP_PDB_CALLING_ERROR
return|;
comment|/* silence compiler */
block|}
end_function

begin_comment
comment|/*  Screenshot dialog  */
end_comment

begin_function
specifier|static
name|void
DECL|function|shoot_dialog_add_hint (GtkNotebook * notebook,ShootType type,const gchar * hint)
name|shoot_dialog_add_hint
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|ShootType
name|type
parameter_list|,
specifier|const
name|gchar
modifier|*
name|hint
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_LABEL
argument_list|,
literal|"label"
argument_list|,
name|hint
argument_list|,
literal|"wrap"
argument_list|,
name|TRUE
argument_list|,
literal|"justify"
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|,
literal|"xalign"
argument_list|,
literal|0.0
argument_list|,
literal|"yalign"
argument_list|,
literal|0.0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_label_set_attributes
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|PANGO_ATTR_STYLE
argument_list|,
name|PANGO_STYLE_ITALIC
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_notebook_insert_page
argument_list|(
name|notebook
argument_list|,
name|label
argument_list|,
name|NULL
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|shoot_radio_button_toggled (GtkWidget * widget,GtkWidget * notebook)
name|shoot_radio_button_toggled
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|gimp_radio_button_update
argument_list|(
name|widget
argument_list|,
operator|&
name|shootvals
operator|.
name|shoot_type
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|shoot_dialog (GdkScreen ** screen)
name|shoot_dialog
parameter_list|(
name|GdkScreen
modifier|*
modifier|*
name|screen
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|spinner
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|GSList
modifier|*
name|radio_group
init|=
name|NULL
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gboolean
name|run
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Screenshot"
argument_list|)
argument_list|,
name|PLUG_IN_ROLE
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_dialog_add_button
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"S_nap"
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_new_from_inline
argument_list|(
operator|-
literal|1
argument_list|,
name|screenshot_icon
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|pixbuf
condition|)
block|{
name|gtk_button_set_image
argument_list|(
name|GTK_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|gtk_image_new_from_pixbuf
argument_list|(
name|pixbuf
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
block|}
name|main_vbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|main_vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
comment|/*  Hints  */
name|notebook
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_NOTEBOOK
argument_list|,
literal|"show-border"
argument_list|,
name|FALSE
argument_list|,
literal|"show-tabs"
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|notebook
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|shoot_dialog_add_hint
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|SHOOT_ROOT
argument_list|,
name|_
argument_list|(
literal|"After the delay, the screenshot is taken."
argument_list|)
argument_list|)
expr_stmt|;
name|shoot_dialog_add_hint
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|SHOOT_REGION
argument_list|,
name|_
argument_list|(
literal|"After the delay, drag your mouse to select "
literal|"the region for the screenshot."
argument_list|)
argument_list|)
expr_stmt|;
name|shoot_dialog_add_hint
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|SHOOT_WINDOW
argument_list|,
name|_
argument_list|(
literal|"At the end of the delay, click in a window "
literal|"to snap it."
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
argument_list|)
expr_stmt|;
comment|/*  Area  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Area"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  single window  */
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"Take a screenshot of "
literal|"a single _window"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|SHOOT_WINDOW
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|shoot_radio_button_toggled
argument_list|)
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
comment|/*  window decorations  */
if|if
condition|(
name|capabilities
operator|&
name|SCREENSHOT_CAN_SHOOT_DECORATIONS
condition|)
block|{
name|hbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Include window _decoration"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|shootvals
operator|.
name|decorate
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|decorate
argument_list|)
expr_stmt|;
name|g_object_bind_property
argument_list|(
name|button
argument_list|,
literal|"active"
argument_list|,
name|toggle
argument_list|,
literal|"sensitive"
argument_list|,
name|G_BINDING_SYNC_CREATE
argument_list|)
expr_stmt|;
block|}
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_WINDOW
argument_list|)
expr_stmt|;
comment|/*  whole screen  */
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"Take a screenshot of "
literal|"the entire _screen"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|SHOOT_ROOT
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|shoot_radio_button_toggled
argument_list|)
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
comment|/*  mouse pointer  */
if|if
condition|(
name|capabilities
operator|&
name|SCREENSHOT_CAN_SHOOT_POINTER
condition|)
block|{
name|hbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Include _mouse pointer"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|shootvals
operator|.
name|show_cursor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|show_cursor
argument_list|)
expr_stmt|;
name|g_object_bind_property
argument_list|(
name|button
argument_list|,
literal|"active"
argument_list|,
name|toggle
argument_list|,
literal|"sensitive"
argument_list|,
name|G_BINDING_SYNC_CREATE
argument_list|)
expr_stmt|;
block|}
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_ROOT
argument_list|)
expr_stmt|;
comment|/*  dragged region  */
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"Select a _region to grab"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_REGION
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|SHOOT_REGION
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|shoot_radio_button_toggled
argument_list|)
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
comment|/*  Delay  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Delay"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|adj
operator|=
operator|(
name|GtkAdjustment
operator|*
operator|)
name|gtk_adjustment_new
argument_list|(
name|shootvals
operator|.
name|select_delay
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|spinner
operator|=
name|gtk_spin_button_new
argument_list|(
name|adj
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_numeric
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spinner
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|spinner
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinner
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_int_adjustment_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|select_delay
argument_list|)
expr_stmt|;
comment|/* this is the unit label of a spinbutton */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"seconds"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|run
operator|=
operator|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_OK
operator|)
expr_stmt|;
if|if
condition|(
name|run
condition|)
block|{
comment|/* get the screen on which we are running */
operator|*
name|screen
operator|=
name|gtk_widget_get_screen
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
if|if
condition|(
name|run
condition|)
block|{
comment|/*  A short timeout to give the server a chance to        *  redraw the area that was obscured by our dialog.        */
name|g_timeout_add
argument_list|(
literal|100
argument_list|,
name|shoot_quit_timeout
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
block|}
return|return
name|run
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|shoot_quit_timeout (gpointer data)
name|shoot_quit_timeout
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_main_quit
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

end_unit

