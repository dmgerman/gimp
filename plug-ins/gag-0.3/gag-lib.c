begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|<strings.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"gag.h"
end_include

begin_define
DECL|macro|LIB_DATA
define|#
directive|define
name|LIB_DATA
value|"lib_data"
end_define

begin_typedef
DECL|typedef|LENTRY
typedef|typedef
name|struct
name|library_entry_struct
name|LENTRY
typedef|;
end_typedef

begin_struct
DECL|struct|library_entry_struct
struct|struct
name|library_entry_struct
block|{
DECL|member|expression
name|NODE
modifier|*
name|expression
decl_stmt|;
DECL|member|list_item
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
DECL|member|label
name|GtkWidget
modifier|*
name|label
decl_stmt|;
DECL|member|name
name|char
name|name
index|[
literal|30
index|]
decl_stmt|;
DECL|member|Next
name|LENTRY
modifier|*
name|Next
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
DECL|variable|Library
specifier|static
name|LENTRY
modifier|*
name|Library
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|CurrentLentry
specifier|static
name|LENTRY
modifier|*
name|CurrentLentry
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|SaveWindow
specifier|static
name|ENTRY_DIALOG
name|SaveWindow
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|RenameWindow
specifier|static
name|ENTRY_DIALOG
name|RenameWindow
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|save_counter
specifier|static
name|int
name|save_counter
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_struct
DECL|struct|__anon2956734f0108
specifier|static
struct|struct
block|{
DECL|member|window
name|GtkWidget
modifier|*
name|window
decl_stmt|;
DECL|member|list
name|GtkWidget
modifier|*
name|list
decl_stmt|;
DECL|member|popup_menu
name|GtkWidget
modifier|*
name|popup_menu
decl_stmt|;
DECL|member|preview
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
DECL|member|progress
name|GtkWidget
modifier|*
name|progress
decl_stmt|;
DECL|member|ind
name|INDIVIDUAL
modifier|*
name|ind
decl_stmt|;
DECL|variable|LibraryWin
block|}
name|LibraryWin
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
struct|;
end_struct

begin_function_decl
name|void
name|gag_destroy_window
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gag_cancel_button
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gag_hide_window
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function
DECL|function|gag_add_lentry_2_list (LENTRY * n)
name|void
name|gag_add_lentry_2_list
parameter_list|(
name|LENTRY
modifier|*
name|n
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
if|if
condition|(
name|LibraryWin
operator|.
name|window
operator|==
name|NULL
condition|)
return|return;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|n
operator|->
name|name
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|list_item
operator|=
name|gtk_list_item_new
argument_list|( )
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|LibraryWin
operator|.
name|list
argument_list|)
argument_list|,
name|list_item
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|LIB_DATA
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|n
operator|->
name|list_item
operator|=
name|list_item
expr_stmt|;
name|n
operator|->
name|label
operator|=
name|label
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|SaveWindow_callback (GtkWidget * widget,gpointer data)
name|void
name|SaveWindow_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|LENTRY
modifier|*
modifier|*
name|ptr
init|=
operator|&
name|Library
decl_stmt|,
modifier|*
name|n
decl_stmt|;
if|if
condition|(
name|SaveWindow
operator|.
name|ind
operator|->
name|expression
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|SaveWindow
operator|.
name|dialog
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|SaveWindow
operator|.
name|dialog
argument_list|)
expr_stmt|;
name|n
operator|=
operator|(
name|LENTRY
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|LENTRY
argument_list|)
argument_list|)
expr_stmt|;
name|n
operator|->
name|expression
operator|=
name|node_copy
argument_list|(
name|SaveWindow
operator|.
name|ind
operator|->
name|expression
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
name|n
operator|->
name|name
argument_list|,
name|GTK_ENTRY
argument_list|(
name|SaveWindow
operator|.
name|entry
argument_list|)
operator|->
name|text
argument_list|,
literal|29
argument_list|)
expr_stmt|;
name|n
operator|->
name|Next
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
operator|*
name|ptr
operator|!=
name|NULL
condition|)
name|ptr
operator|=
operator|&
operator|(
operator|(
operator|*
name|ptr
operator|)
operator|->
name|Next
operator|)
expr_stmt|;
operator|*
name|ptr
operator|=
name|n
expr_stmt|;
name|gag_add_lentry_2_list
argument_list|(
name|n
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_show_save_dialog (GtkWidget * w,gpointer data)
name|void
name|gag_show_save_dialog
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|SaveWindow
operator|.
name|dialog
operator|==
name|NULL
condition|)
name|gag_create_entry
argument_list|(
operator|&
name|SaveWindow
argument_list|,
literal|"Enter name of expression"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|SaveWindow_callback
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|SaveWindow
operator|.
name|dialog
argument_list|)
operator|)
condition|)
block|{
name|char
name|buff
index|[
literal|20
index|]
decl_stmt|;
name|sprintf
argument_list|(
name|buff
argument_list|,
literal|"Noname%0d"
argument_list|,
name|save_counter
operator|++
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|SaveWindow
operator|.
name|entry
argument_list|)
argument_list|,
name|buff
argument_list|)
expr_stmt|;
name|SaveWindow
operator|.
name|ind
operator|=
name|ui
operator|.
name|popup_individual
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|SaveWindow
operator|.
name|dialog
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************************     Main Library window  ******************************/
end_comment

begin_function
DECL|function|gag_lib_Copy (GtkWidget * widget,gpointer data)
name|void
name|gag_lib_Copy
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{ }
end_function

begin_function
DECL|function|gag_lib_Delete (GtkWidget * widget,gpointer data)
name|void
name|gag_lib_Delete
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|LENTRY
modifier|*
modifier|*
name|ptr
init|=
operator|&
name|Library
decl_stmt|,
modifier|*
name|n
decl_stmt|;
while|while
condition|(
operator|*
name|ptr
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
operator|*
name|ptr
operator|==
name|CurrentLentry
condition|)
break|break;
name|ptr
operator|=
operator|&
operator|(
operator|(
operator|*
name|ptr
operator|)
operator|->
name|Next
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|ptr
operator|!=
name|NULL
condition|)
block|{
name|GList
modifier|*
name|tmp
decl_stmt|;
name|n
operator|=
operator|*
name|ptr
expr_stmt|;
operator|*
name|ptr
operator|=
name|n
operator|->
name|Next
expr_stmt|;
name|tmp
operator|->
name|data
operator|=
name|n
operator|->
name|list_item
expr_stmt|;
name|tmp
operator|->
name|prev
operator|=
name|tmp
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|gtk_list_remove_items
argument_list|(
name|GTK_LIST
argument_list|(
name|LibraryWin
operator|.
name|list
argument_list|)
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|n
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|n
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|RenameWindow_callback (GtkWidget * widget,gpointer * data)
specifier|static
name|void
name|RenameWindow_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
modifier|*
name|data
parameter_list|)
block|{
name|LENTRY
modifier|*
name|lptr
decl_stmt|;
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|RenameWindow
operator|.
name|dialog
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|RenameWindow
operator|.
name|dialog
argument_list|)
expr_stmt|;
name|lptr
operator|=
operator|(
name|LENTRY
operator|*
operator|)
operator|(
name|RenameWindow
operator|.
name|ind
operator|)
expr_stmt|;
name|strncpy
argument_list|(
name|lptr
operator|->
name|name
argument_list|,
name|GTK_ENTRY
argument_list|(
name|RenameWindow
operator|.
name|entry
argument_list|)
operator|->
name|text
argument_list|,
literal|29
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|lptr
operator|->
name|label
argument_list|)
argument_list|,
name|lptr
operator|->
name|name
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|lptr
operator|->
name|label
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_lib_Rename (GtkWidget * widget,gpointer data)
name|void
name|gag_lib_Rename
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|RenameWindow
operator|.
name|dialog
operator|==
name|NULL
condition|)
name|gag_create_entry
argument_list|(
operator|&
name|RenameWindow
argument_list|,
literal|"Enter name of expression"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|RenameWindow_callback
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|RenameWindow
operator|.
name|dialog
argument_list|)
operator|)
condition|)
block|{
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|RenameWindow
operator|.
name|entry
argument_list|)
argument_list|,
name|CurrentLentry
operator|->
name|name
argument_list|)
expr_stmt|;
name|RenameWindow
operator|.
name|ind
operator|=
operator|(
name|INDIVIDUAL
operator|*
operator|)
name|CurrentLentry
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|RenameWindow
operator|.
name|dialog
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|gag_lib_Evoke (GtkWidget * widget,gpointer data)
name|void
name|gag_lib_Evoke
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|destroy_node
argument_list|(
name|LibraryWin
operator|.
name|ind
operator|->
name|expression
argument_list|)
expr_stmt|;
name|LibraryWin
operator|.
name|ind
operator|->
name|expression
operator|=
name|node_copy
argument_list|(
name|CurrentLentry
operator|->
name|expression
argument_list|)
expr_stmt|;
name|gag_repaint_ind
argument_list|(
name|NULL
argument_list|,
name|LibraryWin
operator|.
name|ind
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ui
operator|.
name|repaint_preview
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_lib_render_pic (GtkWidget * widget,gpointer data)
name|void
name|gag_lib_render_pic
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|INDIVIDUAL
name|tmp
decl_stmt|,
modifier|*
name|tmpptr
decl_stmt|;
name|tmpptr
operator|=
operator|&
name|tmp
expr_stmt|;
name|tmp
operator|.
name|expression
operator|=
name|CurrentLentry
operator|->
name|expression
expr_stmt|;
name|gag_render_picture_ptr
argument_list|(
name|NULL
argument_list|,
operator|&
name|tmpptr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_Create_FS (GtkWidget ** window,char * label,void * ok_cb)
specifier|static
name|void
name|gag_Create_FS
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|window
parameter_list|,
name|char
modifier|*
name|label
parameter_list|,
name|void
modifier|*
name|ok_cb
parameter_list|)
block|{
operator|*
name|window
operator|=
name|gtk_file_selection_new
argument_list|(
literal|"file selection dialog"
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
operator|*
name|window
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
operator|*
name|window
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_destroy_window
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
operator|*
name|window
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ok_cb
argument_list|,
operator|*
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
operator|*
name|window
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_hide_window
argument_list|,
operator|*
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
operator|*
name|window
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gtk_widget_destroy
argument_list|,
name|GTK_OBJECT
argument_list|(
operator|*
name|window
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_lib_load_cb (GtkWidget * widget,GtkWidget * fs)
specifier|static
name|void
name|gag_lib_load_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|fs
parameter_list|)
block|{
name|DPRINT
argument_list|(
literal|"Loading Library"
argument_list|)
expr_stmt|;
name|gag_load_library
argument_list|(
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|fs
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_lib_save_cb (GtkWidget * widget,GtkWidget * fs)
specifier|static
name|void
name|gag_lib_save_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|fs
parameter_list|)
block|{
name|gag_save_library
argument_list|(
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|fs
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_lib_Load (GtkWidget * widget,gpointer data)
specifier|static
name|void
name|gag_lib_Load
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|LoadWin
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|LoadWin
operator|==
name|NULL
condition|)
name|gag_Create_FS
argument_list|(
operator|&
name|LoadWin
argument_list|,
literal|"Load Library"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|gag_lib_load_cb
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|LoadWin
argument_list|)
operator|)
condition|)
name|gtk_widget_show
argument_list|(
name|LoadWin
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_lib_Save (GtkWidget * widget,gpointer data)
name|void
name|gag_lib_Save
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|SaveWin
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|SaveWin
operator|==
name|NULL
condition|)
name|gag_Create_FS
argument_list|(
operator|&
name|SaveWin
argument_list|,
literal|"Save Library as"
argument_list|,
operator|(
name|void
operator|*
operator|)
name|gag_lib_save_cb
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|SaveWin
argument_list|)
operator|)
condition|)
name|gtk_widget_show
argument_list|(
name|SaveWin
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_lib_popup (GtkWidget * widget,GdkEventButton * event,gpointer user_data)
name|int
name|gag_lib_popup
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|event_widget
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|event_widget
operator|=
name|gtk_get_event_widget
argument_list|(
operator|(
name|GdkEvent
operator|*
operator|)
name|event
argument_list|)
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_2BUTTON_PRESS
case|:
switch|switch
condition|(
name|bevent
operator|->
name|button
condition|)
block|{
case|case
literal|1
case|:
block|{
name|INDIVIDUAL
name|i
decl_stmt|;
name|LENTRY
modifier|*
name|lptr
decl_stmt|;
name|lptr
operator|=
name|gtk_object_get_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|event_widget
argument_list|)
argument_list|,
name|LIB_DATA
argument_list|)
expr_stmt|;
name|i
operator|.
name|preview
operator|=
name|LibraryWin
operator|.
name|preview
expr_stmt|;
name|i
operator|.
name|expression
operator|=
name|lptr
operator|->
name|expression
expr_stmt|;
name|gag_repaint_ind
argument_list|(
name|LibraryWin
operator|.
name|progress
argument_list|,
operator|&
name|i
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
break|break;
block|}
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
name|CurrentLentry
operator|=
name|gtk_object_get_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|event_widget
argument_list|)
argument_list|,
name|LIB_DATA
argument_list|)
expr_stmt|;
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|LibraryWin
operator|.
name|popup_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
DECL|function|gag_library_show (GtkWidget * widget,gpointer data)
name|void
name|gag_library_show
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|LibraryWin
operator|.
name|popup_menu
operator|==
name|NULL
condition|)
block|{
name|GtkMenu
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|menu
operator|=
name|GTK_MENU
argument_list|(
name|gtk_menu_new
argument_list|()
argument_list|)
expr_stmt|;
comment|/* for now this seems needless  	 menuitem= gtk_menu_item_new_with_label("Copy"); 	 gtk_signal_connect( GTK_OBJECT(menuitem), "activate", 	 (GtkSignalFunc) gag_lib_Copy, NULL); 	 gtk_menu_append(menu, menuitem); 	 gtk_widget_show( menuitem );        */
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"Evoke"
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_lib_Evoke
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
if|if
condition|(
name|gag_render_picture_ptr
operator|!=
name|NULL
condition|)
block|{
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"Render picture"
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_lib_render_pic
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
block|}
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"Rename"
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_lib_Rename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"Delete"
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_lib_Delete
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"Load from file"
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_lib_Load
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
literal|"Save to file"
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_lib_Save
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|menu
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|LibraryWin
operator|.
name|popup_menu
operator|=
name|GTK_WIDGET
argument_list|(
name|menu
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|LibraryWin
operator|.
name|window
operator|==
name|NULL
condition|)
block|{
name|GtkWidget
modifier|*
name|window
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|,
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|list
decl_stmt|;
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
name|GtkWidget
modifier|*
name|scwin
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|progress
decl_stmt|;
name|LENTRY
modifier|*
name|lptr
decl_stmt|;
name|gtk_widget_push_visual
argument_list|(
name|gtk_preview_get_visual
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_widget_push_colormap
argument_list|(
name|gtk_preview_get_cmap
argument_list|()
argument_list|)
expr_stmt|;
name|window
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_TOPLEVEL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_destroy_window
argument_list|,
operator|&
operator|(
name|LibraryWin
operator|.
name|window
operator|)
argument_list|)
expr_stmt|;
name|gtk_window_set_policy
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"GAG Library"
argument_list|)
expr_stmt|;
name|LibraryWin
operator|.
name|window
operator|=
name|window
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|window
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|scwin
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scwin
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|scwin
argument_list|,
literal|300
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|scwin
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|LibraryWin
operator|.
name|list
operator|=
name|list
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|list
argument_list|)
argument_list|,
name|GTK_SELECTION_BROWSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scwin
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list
argument_list|)
argument_list|,
literal|"button_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_lib_popup
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scwin
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|LibraryWin
operator|.
name|preview
operator|=
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|PREVIEW_MODE
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
argument_list|)
argument_list|,
name|PREVIEW_WIDTH
argument_list|,
name|PREVIEW_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Close"
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_cancel_button
argument_list|,
operator|(
name|gpointer
operator|)
name|window
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|progress
operator|=
name|gtk_progress_bar_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|progress
argument_list|,
literal|80
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|progress
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|LibraryWin
operator|.
name|progress
operator|=
name|progress
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|progress
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
for|for
control|(
name|lptr
operator|=
name|Library
init|;
name|lptr
operator|!=
name|NULL
condition|;
name|lptr
operator|=
name|lptr
operator|->
name|Next
control|)
name|gag_add_lentry_2_list
argument_list|(
name|lptr
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|LibraryWin
operator|.
name|window
argument_list|)
operator|)
condition|)
block|{
name|gtk_widget_show
argument_list|(
name|LibraryWin
operator|.
name|window
argument_list|)
expr_stmt|;
block|}
name|LibraryWin
operator|.
name|ind
operator|=
name|ui
operator|.
name|popup_individual
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************    GAG LIB LOAD/SAVE functions  ******************************/
end_comment

begin_function
DECL|function|translate_name2esc (char * s,char * d)
name|void
name|translate_name2esc
parameter_list|(
name|char
modifier|*
name|s
parameter_list|,
name|char
modifier|*
name|d
parameter_list|)
block|{
while|while
condition|(
operator|(
operator|*
name|d
operator|=
operator|*
name|s
operator|)
operator|!=
literal|'\000'
condition|)
block|{
if|if
condition|(
operator|*
name|d
operator|==
literal|'\\'
condition|)
block|{
name|d
operator|++
expr_stmt|;
operator|*
name|d
operator|=
literal|'\\'
expr_stmt|;
block|}
if|if
condition|(
operator|*
name|d
operator|==
literal|'"'
condition|)
block|{
operator|*
name|d
operator|=
literal|'\\'
expr_stmt|;
name|d
operator|++
expr_stmt|;
operator|*
name|d
operator|=
literal|'"'
expr_stmt|;
block|}
name|d
operator|++
expr_stmt|;
name|s
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|gag_save_library (char * file)
name|void
name|gag_save_library
parameter_list|(
name|char
modifier|*
name|file
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|LENTRY
modifier|*
name|lptr
decl_stmt|;
name|char
name|buff
index|[
literal|100
index|]
decl_stmt|;
name|lptr
operator|=
name|Library
expr_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|file
argument_list|,
literal|"wt"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|";;; GAG Library file\n\n"
argument_list|)
expr_stmt|;
while|while
condition|(
name|lptr
operator|!=
name|NULL
condition|)
block|{
name|translate_name2esc
argument_list|(
name|lptr
operator|->
name|name
argument_list|,
name|buff
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"(insert-to-library \"%s\" \n"
argument_list|,
name|buff
argument_list|)
expr_stmt|;
name|expr_fprint
argument_list|(
name|f
argument_list|,
literal|2
argument_list|,
name|lptr
operator|->
name|expression
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|") ;;; end of function\n\n"
argument_list|)
expr_stmt|;
name|lptr
operator|=
name|lptr
operator|->
name|Next
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|string_convert (char * line,char * pline,char * name)
specifier|static
name|void
name|string_convert
parameter_list|(
name|char
modifier|*
name|line
parameter_list|,
name|char
modifier|*
name|pline
parameter_list|,
name|char
modifier|*
name|name
parameter_list|)
block|{
name|int
name|state
init|=
literal|0
decl_stmt|;
comment|/* 0 - ok, 1 - inside string */
name|guchar
name|prevchar
init|=
literal|0
decl_stmt|;
while|while
condition|(
operator|(
operator|*
name|pline
operator|=
operator|*
name|line
operator|)
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
operator|(
name|state
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|*
name|line
operator|==
literal|';'
operator|)
condition|)
block|{
operator|*
name|pline
operator|=
literal|'\000'
expr_stmt|;
return|return;
block|}
name|pline
operator|++
expr_stmt|;
if|if
condition|(
operator|(
name|state
operator|==
literal|0
operator|)
operator|&&
operator|(
operator|*
name|line
operator|==
literal|'"'
operator|)
condition|)
block|{
name|state
operator|=
literal|1
expr_stmt|;
name|line
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
operator|(
name|state
operator|==
literal|1
operator|)
operator|&&
operator|(
name|prevchar
operator|!=
literal|'\\'
operator|)
operator|&&
operator|(
operator|*
name|line
operator|==
literal|'"'
operator|)
condition|)
block|{
name|state
operator|=
literal|0
expr_stmt|;
operator|*
name|name
operator|=
literal|'\000'
expr_stmt|;
name|line
operator|++
expr_stmt|;
continue|continue;
block|}
if|if
condition|(
name|state
operator|==
literal|1
condition|)
block|{
switch|switch
condition|(
name|prevchar
condition|)
block|{
case|case
literal|'\\'
case|:
switch|switch
condition|(
operator|*
name|line
condition|)
block|{
case|case
literal|'"'
case|:
case|case
literal|'\\'
case|:
operator|*
operator|(
name|name
operator|-
literal|1
operator|)
operator|=
operator|*
name|line
expr_stmt|;
break|break;
default|default:
name|printf
argument_list|(
literal|"Warning: Unknown prefix"
argument_list|)
expr_stmt|;
break|break;
block|}
name|prevchar
operator|=
literal|'\000'
expr_stmt|;
break|break;
default|default:
operator|*
name|name
operator|=
operator|*
name|line
expr_stmt|;
operator|++
name|name
expr_stmt|;
break|break;
block|}
block|}
name|prevchar
operator|=
operator|*
name|line
expr_stmt|;
name|line
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|state
operator|!=
literal|0
condition|)
block|{
name|printf
argument_list|(
literal|"Error: Unterminated string constant: %s\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|readln (FILE * f,guchar * str,int max)
specifier|static
name|void
name|readln
parameter_list|(
name|FILE
modifier|*
name|f
parameter_list|,
name|guchar
modifier|*
name|str
parameter_list|,
name|int
name|max
parameter_list|)
block|{
name|int
name|z
decl_stmt|;
do|do
block|{
if|if
condition|(
operator|(
name|z
operator|=
name|fgetc
argument_list|(
name|f
argument_list|)
operator|)
operator|==
name|EOF
condition|)
break|break;
if|if
condition|(
operator|(
name|z
operator|==
literal|'\n'
operator|)
operator|||
operator|(
name|z
operator|==
literal|'\r'
operator|)
operator|||
operator|(
name|z
operator|==
literal|'\f'
operator|)
operator|||
operator|(
name|z
operator|==
literal|'\v'
operator|)
condition|)
break|break;
else|else
operator|*
name|str
operator|=
operator|(
name|guchar
operator|)
name|z
expr_stmt|;
name|str
operator|++
expr_stmt|;
name|max
operator|--
expr_stmt|;
block|}
do|while
condition|(
name|max
condition|)
do|;
operator|*
name|str
operator|=
literal|'\000'
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_load_library (char * file)
name|void
name|gag_load_library
parameter_list|(
name|char
modifier|*
name|file
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
modifier|*
name|buff
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|char
name|line
index|[
literal|500
index|]
decl_stmt|;
name|char
name|smbuff
index|[
literal|500
index|]
decl_stmt|;
name|char
name|name
index|[
literal|30
index|]
decl_stmt|,
name|tmp
index|[
literal|100
index|]
decl_stmt|;
name|int
name|state
init|=
literal|0
decl_stmt|;
comment|/* 0 - waiting, 1 - recieving */
name|int
name|ll
decl_stmt|;
name|NODE
modifier|*
name|n
decl_stmt|;
name|LENTRY
modifier|*
name|v
decl_stmt|,
modifier|*
modifier|*
name|head
decl_stmt|;
name|DPRINT
argument_list|(
literal|"Loading library..."
argument_list|)
expr_stmt|;
name|head
operator|=
operator|&
name|Library
expr_stmt|;
while|while
condition|(
operator|*
name|head
operator|!=
name|NULL
condition|)
name|head
operator|=
operator|&
operator|(
operator|(
operator|*
name|head
operator|)
operator|->
name|Next
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|f
operator|=
name|fopen
argument_list|(
name|file
argument_list|,
literal|"rt"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
return|return;
name|buff
operator|=
name|malloc
argument_list|(
literal|200
operator|*
literal|1000
argument_list|)
expr_stmt|;
comment|/* oh - we are lazy programmers !!!) */
while|while
condition|(
operator|!
operator|(
name|feof
argument_list|(
name|f
argument_list|)
operator|)
condition|)
block|{
name|readln
argument_list|(
name|f
argument_list|,
operator|(
name|guchar
operator|*
operator|)
name|line
argument_list|,
literal|499
argument_list|)
expr_stmt|;
name|string_convert
argument_list|(
name|line
argument_list|,
name|smbuff
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
if|if
condition|(
name|smbuff
index|[
literal|0
index|]
operator|==
literal|'\000'
condition|)
continue|continue;
if|if
condition|(
name|state
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
name|smbuff
argument_list|,
literal|"(insert-to-library "
argument_list|,
literal|18
argument_list|)
operator|==
literal|0
condition|)
block|{
name|strncpy
argument_list|(
name|name
argument_list|,
name|tmp
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|state
operator|=
literal|1
expr_stmt|;
name|s
operator|=
name|buff
expr_stmt|;
name|memset
argument_list|(
name|buff
argument_list|,
literal|' '
argument_list|,
literal|200
operator|*
literal|1000
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|printf
argument_list|(
literal|"Error: unexpected line %s\n"
argument_list|,
name|line
argument_list|)
expr_stmt|;
continue|continue;
block|}
else|else
block|{
if|if
condition|(
name|strncmp
argument_list|(
name|line
argument_list|,
literal|") ;;; end of function"
argument_list|,
literal|20
argument_list|)
operator|==
literal|0
condition|)
block|{
name|s
operator|=
name|buff
expr_stmt|;
name|n
operator|=
name|parse_prefix_expression
argument_list|(
operator|&
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
name|NULL
condition|)
goto|goto
name|end_of_loading
goto|;
name|v
operator|=
operator|(
name|LENTRY
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|LENTRY
argument_list|)
argument_list|)
expr_stmt|;
name|v
operator|->
name|expression
operator|=
name|n
expr_stmt|;
name|v
operator|->
name|Next
operator|=
name|NULL
expr_stmt|;
name|v
operator|->
name|list_item
operator|=
name|NULL
expr_stmt|;
name|strncpy
argument_list|(
name|v
operator|->
name|name
argument_list|,
name|name
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|gag_add_lentry_2_list
argument_list|(
name|v
argument_list|)
expr_stmt|;
operator|*
name|head
operator|=
name|v
expr_stmt|;
name|head
operator|=
operator|&
operator|(
name|v
operator|->
name|Next
operator|)
expr_stmt|;
name|state
operator|=
literal|0
expr_stmt|;
continue|continue;
block|}
operator|*
operator|(
name|s
operator|++
operator|)
operator|=
literal|' '
expr_stmt|;
name|ll
operator|=
name|strlen
argument_list|(
name|smbuff
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|s
argument_list|,
name|smbuff
argument_list|)
expr_stmt|;
name|s
operator|+=
name|ll
expr_stmt|;
block|}
block|}
comment|/* end of while */
if|if
condition|(
name|state
operator|==
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"Error: corrupted library\n"
argument_list|)
expr_stmt|;
block|}
name|end_of_loading
label|:
if|if
condition|(
name|f
operator|!=
name|NULL
condition|)
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
if|if
condition|(
name|buff
operator|!=
name|NULL
condition|)
name|free
argument_list|(
name|buff
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/******************************     MISC FUNCTIONS  ******************************/
end_comment

begin_function
DECL|function|gag_hide_window (GtkWidget * widget,gpointer data)
name|void
name|gag_hide_window
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
operator|(
name|GtkWidget
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|tmp
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_destroy_window (GtkWidget * widget,gpointer data)
name|void
name|gag_destroy_window
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
operator|(
name|GtkWidget
operator|*
operator|*
operator|)
name|data
expr_stmt|;
operator|*
name|tmp
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_cancel_button (GtkWidget * widget,gpointer data)
name|void
name|gag_cancel_button
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_clear_entry (GtkWidget * widget,GtkEntry * entry)
name|void
name|gag_clear_entry
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkEntry
modifier|*
name|entry
parameter_list|)
block|{
name|gtk_entry_set_text
argument_list|(
name|entry
argument_list|,
literal|""
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|gag_create_entry (ENTRY_DIALOG * ed,char * title,GtkSignalFunc OkFunc)
name|void
name|gag_create_entry
parameter_list|(
name|ENTRY_DIALOG
modifier|*
name|ed
parameter_list|,
name|char
modifier|*
name|title
parameter_list|,
name|GtkSignalFunc
name|OkFunc
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|vb
decl_stmt|;
name|dialog
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|ed
operator|->
name|dialog
operator|=
name|dialog
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_destroy_window
argument_list|,
operator|&
operator|(
name|ed
operator|->
name|dialog
operator|)
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|vb
operator|=
name|gtk_vbox_new
argument_list|(
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vb
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vb
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|entry
argument_list|,
literal|400
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vb
argument_list|)
argument_list|,
name|entry
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|ed
operator|->
name|entry
operator|=
name|entry
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vb
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"OK"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|OkFunc
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Clear"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_clear_entry
argument_list|,
name|entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Cancel"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gag_cancel_button
argument_list|,
name|GTK_OBJECT
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

