begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/***************************************************************************/
end_comment

begin_comment
comment|/* GCK - The General Convenience Kit. Generally useful conveniece routines */
end_comment

begin_comment
comment|/* for GIMP plug-in writers and users of the GDK/GTK libraries.            */
end_comment

begin_comment
comment|/* Copyright (C) 1996 Tom Bech                                             */
end_comment

begin_comment
comment|/*                                                                         */
end_comment

begin_comment
comment|/* This program is free software; you can redistribute it and/or modify    */
end_comment

begin_comment
comment|/* it under the terms of the GNU General Public License as published by    */
end_comment

begin_comment
comment|/* the Free Software Foundation; either version 2 of the License, or       */
end_comment

begin_comment
comment|/* (at your option) any later version.                                     */
end_comment

begin_comment
comment|/*                                                                         */
end_comment

begin_comment
comment|/* This program is distributed in the hope that it will be useful,         */
end_comment

begin_comment
comment|/* but WITHOUT ANY WARRANTY; without even the implied warranty of          */
end_comment

begin_comment
comment|/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           */
end_comment

begin_comment
comment|/* GNU General Public License for more details.                            */
end_comment

begin_comment
comment|/*                                                                         */
end_comment

begin_comment
comment|/* You should have received a copy of the GNU General Public License       */
end_comment

begin_comment
comment|/* along with this program; if not, write to the Free Software             */
end_comment

begin_comment
comment|/* Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.               */
end_comment

begin_comment
comment|/***************************************************************************/
end_comment

begin_comment
comment|/*********************************************************/
end_comment

begin_comment
comment|/* The GCK version of the very handy notebook component. */
end_comment

begin_comment
comment|/* The basic functionality is there, but there's still   */
end_comment

begin_comment
comment|/* a thing or two to be desired of the apperance. It     */
end_comment

begin_comment
comment|/* doesn't handle resizes particulary graciously yet.    */
end_comment

begin_comment
comment|/*********************************************************/
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdk.h>
end_include

begin_include
include|#
directive|include
file|<gck/gck.h>
end_include

begin_define
DECL|macro|GCK_NOTEBOOK_TAB_HEIGHT
define|#
directive|define
name|GCK_NOTEBOOK_TAB_HEIGHT
value|24
end_define

begin_define
DECL|macro|GCK_NOTEBOOK_TAB_PADDING
define|#
directive|define
name|GCK_NOTEBOOK_TAB_PADDING
value|12
end_define

begin_decl_stmt
specifier|extern
name|gint
name|_GckAutoShowFlag
decl_stmt|;
end_decl_stmt

begin_comment
comment|/***********************/
end_comment

begin_comment
comment|/* Draw frame and tabs */
end_comment

begin_comment
comment|/***********************/
end_comment

begin_function
DECL|function|gck_notebook_draw_tabframe (GdkWindow * window,GtkStyle * style,GdkRectangle * area,GtkPositionType pos)
name|void
name|gck_notebook_draw_tabframe
parameter_list|(
name|GdkWindow
modifier|*
name|window
parameter_list|,
name|GtkStyle
modifier|*
name|style
parameter_list|,
name|GdkRectangle
modifier|*
name|area
parameter_list|,
name|GtkPositionType
name|pos
parameter_list|)
block|{
name|gint
name|foldy
decl_stmt|,
name|foldx
decl_stmt|;
name|foldy
operator|=
literal|3
expr_stmt|;
name|foldx
operator|=
literal|3
expr_stmt|;
if|if
condition|(
name|pos
operator|==
name|GTK_POS_TOP
condition|)
block|{
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|light_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|,
name|area
operator|->
name|x
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|,
name|area
operator|->
name|x
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|light_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
argument_list|,
name|area
operator|->
name|y
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|light_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
argument_list|,
name|area
operator|->
name|y
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
literal|1
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|mid_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
literal|1
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|mid_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|light_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|,
name|area
operator|->
name|x
argument_list|,
name|area
operator|->
name|y
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|light_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|mid_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
name|foldx
operator|+
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
literal|1
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|mid_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
name|foldx
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
literal|1
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
argument_list|,
name|area
operator|->
name|y
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|mid_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
literal|1
argument_list|,
name|area
operator|->
name|y
operator|+
name|area
operator|->
name|height
operator|-
name|foldy
argument_list|,
name|area
operator|->
name|x
operator|+
name|area
operator|->
name|width
operator|-
literal|1
argument_list|,
name|area
operator|->
name|y
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|gck_notebook_draw_frames (GckNoteBook * notebook)
name|void
name|gck_notebook_draw_frames
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|)
block|{
name|GList
modifier|*
name|current_page
decl_stmt|;
name|GckNoteBookPage
modifier|*
name|page
decl_stmt|,
modifier|*
name|activepage
init|=
name|NULL
decl_stmt|;
name|GtkStyle
modifier|*
name|style
init|=
name|notebook
operator|->
name|widget
operator|->
name|style
decl_stmt|;
name|GdkWindow
modifier|*
name|mainwindow
decl_stmt|,
modifier|*
name|window
decl_stmt|;
name|GtkAllocation
name|mainallocation
decl_stmt|;
name|gint
name|xpos
decl_stmt|,
name|ypos
decl_stmt|,
name|strwid
decl_stmt|,
name|fontheight
decl_stmt|;
name|gint
name|win_x
decl_stmt|,
name|win_y
decl_stmt|,
name|win_width
decl_stmt|,
name|win_height
decl_stmt|;
name|mainwindow
operator|=
name|notebook
operator|->
name|widget
operator|->
name|window
expr_stmt|;
name|mainallocation
operator|=
name|notebook
operator|->
name|widget
operator|->
name|allocation
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|tab_position
operator|==
name|GTK_POS_TOP
condition|)
block|{
name|mainallocation
operator|.
name|y
operator|-=
literal|1
expr_stmt|;
name|mainallocation
operator|.
name|height
operator|+=
literal|1
expr_stmt|;
block|}
else|else
name|mainallocation
operator|.
name|height
operator|+=
literal|2
expr_stmt|;
name|gtk_draw_shadow
argument_list|(
name|style
argument_list|,
name|mainwindow
argument_list|,
name|GTK_STATE_NORMAL
argument_list|,
name|GTK_SHADOW_OUT
argument_list|,
name|mainallocation
operator|.
name|x
argument_list|,
name|mainallocation
operator|.
name|y
argument_list|,
name|mainallocation
operator|.
name|width
argument_list|,
name|mainallocation
operator|.
name|height
argument_list|)
expr_stmt|;
name|current_page
operator|=
name|g_list_first
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|)
expr_stmt|;
name|window
operator|=
name|notebook
operator|->
name|tab_box
operator|->
name|window
expr_stmt|;
name|win_x
operator|=
name|notebook
operator|->
name|tab_box
operator|->
name|allocation
operator|.
name|x
expr_stmt|;
name|win_y
operator|=
name|notebook
operator|->
name|tab_box
operator|->
name|allocation
operator|.
name|y
expr_stmt|;
name|win_width
operator|=
name|notebook
operator|->
name|tab_box
operator|->
name|allocation
operator|.
name|width
expr_stmt|;
name|win_height
operator|=
name|notebook
operator|->
name|tab_box
operator|->
name|allocation
operator|.
name|height
expr_stmt|;
comment|/* Font height is the distance from the baseline to the top (ascent) */
comment|/* plus the distance from the baseline to the bottom (descent).      */
comment|/* ================================================================= */
name|fontheight
operator|=
name|style
operator|->
name|font
operator|->
name|ascent
operator|+
name|style
operator|->
name|font
operator|->
name|descent
expr_stmt|;
name|xpos
operator|=
name|GCK_NOTEBOOK_TAB_PADDING
expr_stmt|;
name|ypos
operator|=
operator|(
name|win_height
operator|-
name|fontheight
operator|)
operator|>>
literal|1
expr_stmt|;
comment|/* First, draw the tabs of the inactive pages */
comment|/* ========================================== */
while|while
condition|(
name|current_page
operator|!=
name|NULL
condition|)
block|{
name|page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current_page
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|page
operator|->
name|active
operator|==
name|FALSE
condition|)
block|{
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|=
name|xpos
operator|-
name|GCK_NOTEBOOK_TAB_PADDING
operator|+
literal|2
expr_stmt|;
name|strwid
operator|=
name|gdk_string_width
argument_list|(
name|style
operator|->
name|font
argument_list|,
name|page
operator|->
name|tab
operator|->
name|label
argument_list|)
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|width
operator|=
name|strwid
operator|+
operator|(
name|GCK_NOTEBOOK_TAB_PADDING
operator|<<
literal|1
operator|)
operator|-
literal|4
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|tab_position
operator|==
name|GTK_POS_TOP
condition|)
block|{
name|gdk_draw_string
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|font
argument_list|,
name|style
operator|->
name|fg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|xpos
argument_list|,
name|ypos
operator|+
name|style
operator|->
name|font
operator|->
name|ascent
operator|+
literal|2
argument_list|,
name|page
operator|->
name|tab
operator|->
name|label
argument_list|)
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|=
literal|2
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|height
operator|=
name|win_height
expr_stmt|;
block|}
else|else
block|{
name|gdk_draw_string
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|font
argument_list|,
name|style
operator|->
name|fg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|xpos
argument_list|,
name|ypos
operator|+
name|style
operator|->
name|font
operator|->
name|ascent
operator|-
literal|2
argument_list|,
name|page
operator|->
name|tab
operator|->
name|label
argument_list|)
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|=
operator|-
literal|2
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|height
operator|=
name|win_height
operator|-
literal|1
expr_stmt|;
block|}
name|gck_notebook_draw_tabframe
argument_list|(
name|window
argument_list|,
name|style
argument_list|,
operator|&
name|page
operator|->
name|tab
operator|->
name|area
argument_list|,
name|notebook
operator|->
name|tab_position
argument_list|)
expr_stmt|;
name|xpos
operator|+=
operator|(
operator|(
name|GCK_NOTEBOOK_TAB_PADDING
operator|<<
literal|1
operator|)
operator|+
name|strwid
operator|)
operator|-
literal|4
operator|+
literal|1
expr_stmt|;
block|}
else|else
block|{
name|activepage
operator|=
name|page
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|=
name|xpos
operator|-
name|GCK_NOTEBOOK_TAB_PADDING
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|tab_position
operator|==
name|GTK_POS_TOP
condition|)
block|{
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|height
operator|=
name|win_height
operator|+
literal|2
expr_stmt|;
block|}
else|else
block|{
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|=
operator|-
literal|2
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|height
operator|=
name|win_height
operator|+
literal|1
expr_stmt|;
block|}
name|strwid
operator|=
name|gdk_string_width
argument_list|(
name|style
operator|->
name|font
argument_list|,
name|page
operator|->
name|tab
operator|->
name|label
argument_list|)
expr_stmt|;
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|width
operator|=
name|strwid
operator|+
operator|(
name|GCK_NOTEBOOK_TAB_PADDING
operator|<<
literal|1
operator|)
expr_stmt|;
name|xpos
operator|+=
operator|(
operator|(
name|GCK_NOTEBOOK_TAB_PADDING
operator|<<
literal|1
operator|)
operator|+
name|strwid
operator|)
operator|-
literal|4
operator|+
literal|1
expr_stmt|;
block|}
name|current_page
operator|=
name|current_page
operator|->
name|next
expr_stmt|;
block|}
comment|/* Draw the active page tab a little */
comment|/* bigger and with "raised" text.    */
comment|/* ================================= */
name|gdk_draw_rectangle
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|TRUE
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|y
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|width
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|height
argument_list|)
expr_stmt|;
name|gdk_draw_string
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|font
argument_list|,
name|style
operator|->
name|fg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|+
name|GCK_NOTEBOOK_TAB_PADDING
argument_list|,
name|ypos
operator|+
name|style
operator|->
name|font
operator|->
name|ascent
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|label
argument_list|)
expr_stmt|;
name|gck_notebook_draw_tabframe
argument_list|(
name|window
argument_list|,
name|style
argument_list|,
operator|&
name|activepage
operator|->
name|tab
operator|->
name|area
argument_list|,
name|notebook
operator|->
name|tab_position
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|tab_position
operator|==
name|GTK_POS_TOP
condition|)
block|{
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|light_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
literal|0
argument_list|,
name|win_height
operator|-
literal|1
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
argument_list|,
name|win_height
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|light_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|+
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|width
argument_list|,
name|win_height
operator|-
literal|1
argument_list|,
name|win_width
argument_list|,
name|win_height
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|!=
literal|0
condition|)
block|{
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|mid_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|-
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|mid_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|+
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|width
argument_list|,
literal|0
argument_list|,
name|win_width
operator|-
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|+
name|activepage
operator|->
name|tab
operator|->
name|area
operator|.
name|width
argument_list|,
literal|1
argument_list|,
name|win_width
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|style
operator|->
name|black_gc
argument_list|,
name|win_width
operator|-
literal|1
argument_list|,
literal|1
argument_list|,
name|win_width
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/***********************************************************/
end_comment

begin_comment
comment|/* Check if we've hit any of the tabs; return TRUE and the */
end_comment

begin_comment
comment|/* page we hit if we did, FALSE otherwise.                 */
end_comment

begin_comment
comment|/***********************************************************/
end_comment

begin_function
DECL|function|gck_notebook_tab_hit (GckNoteBook * notebook,gint x,gint y,gint * tab_num)
name|gint
name|gck_notebook_tab_hit
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
modifier|*
name|tab_num
parameter_list|)
block|{
name|gint
name|tabno
init|=
literal|0
decl_stmt|;
name|GList
modifier|*
name|current
decl_stmt|;
name|GckNoteBookPage
modifier|*
name|page
decl_stmt|;
comment|/* First check if we've hit the current page tab */
comment|/* ============================================= */
name|current
operator|=
name|g_list_nth
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|,
name|notebook
operator|->
name|current_page
argument_list|)
expr_stmt|;
name|page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|x
operator|>
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|&&
name|x
operator|<
operator|(
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|+
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|width
operator|)
operator|&&
name|y
operator|>
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|&&
name|y
operator|<
operator|(
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|+
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|height
operator|)
condition|)
block|{
if|if
condition|(
name|tab_num
operator|!=
name|NULL
condition|)
operator|*
name|tab_num
operator|=
name|notebook
operator|->
name|current_page
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
name|current
operator|=
name|g_list_first
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|)
expr_stmt|;
while|while
condition|(
name|current
operator|!=
name|NULL
condition|)
block|{
name|page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|page
operator|->
name|active
operator|==
name|FALSE
operator|&&
name|x
operator|>
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|&&
name|x
operator|<
operator|(
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|x
operator|+
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|width
operator|)
operator|&&
name|y
operator|>
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|&&
name|y
operator|<
operator|(
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|y
operator|+
name|page
operator|->
name|tab
operator|->
name|area
operator|.
name|height
operator|)
condition|)
block|{
if|if
condition|(
name|tab_num
operator|!=
name|NULL
condition|)
operator|*
name|tab_num
operator|=
name|tabno
expr_stmt|;
return|return
operator|(
name|TRUE
operator|)
return|;
block|}
name|current
operator|=
name|current
operator|->
name|next
expr_stmt|;
name|tabno
operator|++
expr_stmt|;
block|}
return|return
operator|(
name|FALSE
operator|)
return|;
block|}
end_function

begin_comment
comment|/******************************/
end_comment

begin_comment
comment|/* The notebook event handler */
end_comment

begin_comment
comment|/******************************/
end_comment

begin_function
DECL|function|_gck_notebook_eventhandler (GtkWidget * widget,GdkEvent * event)
name|gint
name|_gck_notebook_eventhandler
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GckNoteBook
modifier|*
name|notebook
decl_stmt|;
name|gint
name|returnval
init|=
name|FALSE
decl_stmt|,
name|page
decl_stmt|;
name|notebook
operator|=
operator|(
name|GckNoteBook
operator|*
operator|)
name|gtk_object_get_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"_GckNoteBook"
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|gck_notebook_draw_frames
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
if|if
condition|(
name|gck_notebook_tab_hit
argument_list|(
name|notebook
argument_list|,
name|event
operator|->
name|button
operator|.
name|x
argument_list|,
name|event
operator|->
name|button
operator|.
name|y
argument_list|,
operator|&
name|page
argument_list|)
operator|==
name|TRUE
condition|)
name|notebook
operator|->
name|button_down
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
if|if
condition|(
name|notebook
operator|->
name|button_down
operator|==
name|TRUE
operator|&&
name|gck_notebook_tab_hit
argument_list|(
name|notebook
argument_list|,
name|event
operator|->
name|button
operator|.
name|x
argument_list|,
name|event
operator|->
name|button
operator|.
name|y
argument_list|,
operator|&
name|page
argument_list|)
operator|==
name|TRUE
condition|)
name|gck_notebook_set_page
argument_list|(
name|notebook
argument_list|,
name|page
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|button_down
operator|=
name|FALSE
expr_stmt|;
default|default:
break|break;
block|}
return|return
operator|(
name|returnval
operator|)
return|;
block|}
end_function

begin_function
DECL|function|_gck_notebook_frame_eventhandler (GtkWidget * widget,GdkEvent * event)
name|gint
name|_gck_notebook_frame_eventhandler
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GckNoteBook
modifier|*
name|notebook
decl_stmt|;
name|gint
name|returnval
init|=
name|FALSE
decl_stmt|;
name|notebook
operator|=
operator|(
name|GckNoteBook
operator|*
operator|)
name|gtk_object_get_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"_GckNoteBook"
argument_list|)
expr_stmt|;
name|gck_notebook_draw_frames
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
return|return
operator|(
name|returnval
operator|)
return|;
block|}
end_function

begin_comment
comment|/**************************************************/
end_comment

begin_comment
comment|/* Create and initialize a instance of a notebook */
end_comment

begin_comment
comment|/**************************************************/
end_comment

begin_function
DECL|function|gck_notebook_new (GtkWidget * container,gint width,gint height,GtkPositionType tab_position)
name|GckNoteBook
modifier|*
name|gck_notebook_new
parameter_list|(
name|GtkWidget
modifier|*
name|container
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|GtkPositionType
name|tab_position
parameter_list|)
block|{
name|GckNoteBook
modifier|*
name|notebook
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_new"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|container
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|notebook
operator|=
operator|(
name|GckNoteBook
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|GckNoteBook
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|==
name|NULL
condition|)
block|{
name|g_function_leave
argument_list|(
literal|"gck_notebook_new"
argument_list|)
expr_stmt|;
return|return
operator|(
name|NULL
operator|)
return|;
block|}
name|notebook
operator|->
name|page_list
operator|=
name|NULL
expr_stmt|;
name|notebook
operator|->
name|num_pages
operator|=
literal|0
expr_stmt|;
name|notebook
operator|->
name|tab_position
operator|=
name|tab_position
expr_stmt|;
name|notebook
operator|->
name|button_down
operator|=
name|FALSE
expr_stmt|;
name|notebook
operator|->
name|current_page
operator|=
literal|0
expr_stmt|;
name|notebook
operator|->
name|width
operator|=
name|width
expr_stmt|;
name|notebook
operator|->
name|height
operator|=
name|height
expr_stmt|;
name|notebook
operator|->
name|workbox
operator|=
name|gck_vbox_new
argument_list|(
name|container
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|,
name|GDK_EXPOSURE_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|_gck_notebook_frame_eventhandler
argument_list|,
operator|(
name|gpointer
operator|)
name|notebook
operator|->
name|workbox
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|)
argument_list|,
literal|"_GckNoteBook"
argument_list|,
operator|(
name|gpointer
operator|)
name|notebook
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|tab_box
operator|=
name|gck_drawing_area_new
argument_list|(
name|NULL
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|GCK_NOTEBOOK_TAB_HEIGHT
argument_list|,
name|GDK_EXPOSURE_MASK
operator||
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|_gck_notebook_eventhandler
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|notebook
operator|->
name|tab_box
argument_list|)
argument_list|,
literal|"_GckNoteBook"
argument_list|,
operator|(
name|gpointer
operator|)
name|notebook
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|tab_position
operator|==
name|GTK_POS_TOP
condition|)
block|{
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|)
argument_list|,
name|notebook
operator|->
name|tab_box
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|widget
operator|=
name|gck_vbox_new
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|notebook
operator|->
name|widget
operator|=
name|gck_vbox_new
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|)
argument_list|,
name|notebook
operator|->
name|tab_box
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|notebook
operator|->
name|tab_box
argument_list|)
expr_stmt|;
name|g_function_leave
argument_list|(
literal|"gck_notebook_new"
argument_list|)
expr_stmt|;
return|return
operator|(
name|notebook
operator|)
return|;
block|}
end_function

begin_comment
comment|/*********************************************************/
end_comment

begin_comment
comment|/* Free memory associated with the GckNoteBook structure */
end_comment

begin_comment
comment|/*********************************************************/
end_comment

begin_function
DECL|function|gck_notebook_destroy (GckNoteBook * notebook)
name|void
name|gck_notebook_destroy
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|)
block|{
name|GList
modifier|*
name|current
decl_stmt|;
name|GckNoteBookPage
modifier|*
name|page
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_destroy"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|page_list
operator|!=
name|NULL
condition|)
block|{
name|current
operator|=
name|g_list_first
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|)
expr_stmt|;
while|while
condition|(
name|current
operator|!=
name|NULL
condition|)
block|{
name|page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|page
operator|->
name|tab
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|page
operator|->
name|tab
operator|->
name|image
operator|!=
name|NULL
condition|)
name|gdk_image_destroy
argument_list|(
name|page
operator|->
name|tab
operator|->
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|page
operator|->
name|tab
operator|->
name|pixmap
operator|!=
name|NULL
condition|)
name|gdk_pixmap_destroy
argument_list|(
name|page
operator|->
name|tab
operator|->
name|pixmap
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|page
operator|->
name|tab
argument_list|)
expr_stmt|;
block|}
name|free
argument_list|(
name|page
argument_list|)
expr_stmt|;
name|current
operator|=
name|current
operator|->
name|next
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|notebook
operator|->
name|workbox
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|g_function_leave
argument_list|(
literal|"gck_notebook_destroy"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****************************************/
end_comment

begin_comment
comment|/* Create and initialize a notebook page */
end_comment

begin_comment
comment|/*****************************************/
end_comment

begin_function
DECL|function|gck_notebook_page_new (gchar * label,GckNoteBook * notebook)
name|GckNoteBookPage
modifier|*
name|gck_notebook_page_new
parameter_list|(
name|gchar
modifier|*
name|label
parameter_list|,
name|GckNoteBook
modifier|*
name|notebook
parameter_list|)
block|{
name|GckNoteBookPage
modifier|*
name|page
init|=
name|NULL
decl_stmt|;
name|GckNoteBookTab
modifier|*
name|tab
init|=
name|NULL
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_page_new"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|GckNoteBookPage
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|page
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
name|tab
operator|=
operator|(
name|GckNoteBookTab
operator|*
operator|)
name|malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|GckNoteBookTab
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|tab
operator|==
name|NULL
condition|)
block|{
name|free
argument_list|(
name|page
argument_list|)
expr_stmt|;
name|page
operator|=
name|NULL
expr_stmt|;
block|}
else|else
block|{
name|tab
operator|->
name|label
operator|=
name|label
expr_stmt|;
name|tab
operator|->
name|image
operator|=
name|NULL
expr_stmt|;
name|tab
operator|->
name|pixmap
operator|=
name|NULL
expr_stmt|;
name|page
operator|->
name|label
operator|=
name|label
expr_stmt|;
name|page
operator|->
name|position
operator|=
literal|0
expr_stmt|;
name|page
operator|->
name|active
operator|=
name|FALSE
expr_stmt|;
name|page
operator|->
name|tab
operator|=
name|tab
expr_stmt|;
name|page
operator|->
name|notebook
operator|=
name|notebook
expr_stmt|;
name|page
operator|->
name|widget
operator|=
name|gck_vbox_new
argument_list|(
name|notebook
operator|->
name|widget
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|g_function_leave
argument_list|(
literal|"gck_notebook_page_new"
argument_list|)
expr_stmt|;
return|return
operator|(
name|page
operator|)
return|;
block|}
end_function

begin_comment
comment|/*********************************/
end_comment

begin_comment
comment|/* Insert a page in the notebook */
end_comment

begin_comment
comment|/*********************************/
end_comment

begin_function
DECL|function|gck_notebook_insert_page (GckNoteBook * notebook,GckNoteBookPage * page,gint position)
name|void
name|gck_notebook_insert_page
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|,
name|GckNoteBookPage
modifier|*
name|page
parameter_list|,
name|gint
name|position
parameter_list|)
block|{
name|GList
modifier|*
name|node
decl_stmt|,
modifier|*
name|current
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_insert_page"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|page
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|position
operator|<=
literal|0
condition|)
name|gck_notebook_prepend_page
argument_list|(
name|notebook
argument_list|,
name|page
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|position
operator|>=
name|notebook
operator|->
name|num_pages
condition|)
name|gck_notebook_append_page
argument_list|(
name|notebook
argument_list|,
name|page
argument_list|)
expr_stmt|;
else|else
block|{
name|node
operator|=
name|g_list_alloc
argument_list|()
expr_stmt|;
name|current
operator|=
name|g_list_nth
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|,
name|position
operator|-
literal|1
argument_list|)
expr_stmt|;
name|node
operator|->
name|next
operator|=
name|current
operator|->
name|next
expr_stmt|;
name|node
operator|->
name|prev
operator|=
name|current
expr_stmt|;
name|node
operator|->
name|data
operator|=
operator|(
name|gpointer
operator|)
name|page
expr_stmt|;
if|if
condition|(
name|current
operator|->
name|next
operator|!=
name|NULL
condition|)
name|current
operator|->
name|next
operator|->
name|prev
operator|=
name|node
expr_stmt|;
name|current
operator|->
name|next
operator|=
name|node
expr_stmt|;
name|page
operator|->
name|position
operator|=
name|position
expr_stmt|;
name|page
operator|->
name|active
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|page
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|notebook
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
while|while
condition|(
name|current
operator|->
name|next
operator|!=
name|NULL
condition|)
block|{
name|page
operator|=
operator|(
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current
operator|->
name|data
operator|)
expr_stmt|;
name|page
operator|->
name|position
operator|++
expr_stmt|;
name|current
operator|=
name|current
operator|->
name|next
expr_stmt|;
block|}
name|notebook
operator|->
name|num_pages
operator|++
expr_stmt|;
block|}
name|g_function_leave
argument_list|(
literal|"gck_notebook_insert_page"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*********************************/
end_comment

begin_comment
comment|/* Append a page to the notebook */
end_comment

begin_comment
comment|/*********************************/
end_comment

begin_function
DECL|function|gck_notebook_append_page (GckNoteBook * notebook,GckNoteBookPage * page)
name|void
name|gck_notebook_append_page
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|,
name|GckNoteBookPage
modifier|*
name|page
parameter_list|)
block|{
name|g_function_enter
argument_list|(
literal|"gck_notebook_append_page"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|page
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|page_list
operator|=
name|g_list_append
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|,
operator|(
name|gpointer
operator|)
name|page
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|num_pages
operator|>
literal|0
condition|)
block|{
name|page
operator|->
name|active
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_unmap
argument_list|(
name|page
operator|->
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|page
operator|->
name|widget
argument_list|)
expr_stmt|;
block|}
else|else
name|page
operator|->
name|active
operator|=
name|TRUE
expr_stmt|;
name|page
operator|->
name|position
operator|=
name|notebook
operator|->
name|num_pages
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|page
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|notebook
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|num_pages
operator|++
expr_stmt|;
name|g_function_leave
argument_list|(
literal|"gck_notebook_append_page"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************/
end_comment

begin_comment
comment|/* Prepend a page to the notebook */
end_comment

begin_comment
comment|/**********************************/
end_comment

begin_function
DECL|function|gck_notebook_prepend_page (GckNoteBook * notebook,GckNoteBookPage * page)
name|void
name|gck_notebook_prepend_page
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|,
name|GckNoteBookPage
modifier|*
name|page
parameter_list|)
block|{
name|GckNoteBookPage
modifier|*
name|current_page
decl_stmt|;
name|GList
modifier|*
name|current
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_prepend_page"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|page
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|num_pages
operator|>
literal|0
condition|)
block|{
name|current_page
operator|=
name|gck_notebook_get_page
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|current_page
operator|->
name|active
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_unmap
argument_list|(
name|current_page
operator|->
name|widget
argument_list|)
expr_stmt|;
block|}
name|notebook
operator|->
name|page_list
operator|=
name|g_list_prepend
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|,
operator|(
name|gpointer
operator|)
name|page
argument_list|)
expr_stmt|;
name|page
operator|->
name|active
operator|=
name|TRUE
expr_stmt|;
name|page
operator|->
name|position
operator|=
literal|0
expr_stmt|;
name|current
operator|=
name|g_list_first
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|)
expr_stmt|;
name|current
operator|=
name|current
operator|->
name|next
expr_stmt|;
while|while
condition|(
name|current
operator|!=
name|NULL
condition|)
block|{
name|current_page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current
operator|->
name|data
expr_stmt|;
name|current_page
operator|->
name|position
operator|++
expr_stmt|;
name|current
operator|=
name|current
operator|->
name|next
expr_stmt|;
block|}
name|gtk_widget_set_usize
argument_list|(
name|page
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|notebook
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|num_pages
operator|++
expr_stmt|;
name|g_function_leave
argument_list|(
literal|"gck_notebook_prepend_page"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************/
end_comment

begin_comment
comment|/* Tear out a page from the notebook */
end_comment

begin_comment
comment|/*************************************/
end_comment

begin_function
DECL|function|gck_notebook_remove_page (GckNoteBook * notebook,gint page_num)
name|void
name|gck_notebook_remove_page
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|,
name|gint
name|page_num
parameter_list|)
block|{
name|GList
modifier|*
name|current
decl_stmt|,
modifier|*
name|temp
decl_stmt|;
name|GckNoteBookPage
modifier|*
name|page
decl_stmt|,
modifier|*
name|pg
decl_stmt|;
name|gint
name|newactive
init|=
name|page_num
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_remove_page"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|num_pages
operator|>
literal|1
condition|)
block|{
if|if
condition|(
name|page_num
operator|<
literal|0
condition|)
name|page_num
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|page_num
operator|>=
name|notebook
operator|->
name|num_pages
condition|)
name|page_num
operator|=
name|notebook
operator|->
name|num_pages
operator|-
literal|1
expr_stmt|;
name|current
operator|=
name|g_list_nth
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|,
name|page_num
argument_list|)
expr_stmt|;
name|page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_DRAWABLE
argument_list|(
name|page
operator|->
name|widget
argument_list|)
condition|)
name|gtk_widget_unmap
argument_list|(
name|page
operator|->
name|widget
argument_list|)
expr_stmt|;
name|temp
operator|=
name|current
expr_stmt|;
while|while
condition|(
name|temp
operator|!=
name|NULL
condition|)
block|{
name|pg
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|temp
operator|->
name|data
expr_stmt|;
name|pg
operator|->
name|position
operator|--
expr_stmt|;
name|temp
operator|=
name|temp
operator|->
name|next
expr_stmt|;
block|}
name|notebook
operator|->
name|page_list
operator|=
name|g_list_remove_link
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|,
name|current
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|num_pages
operator|--
expr_stmt|;
if|if
condition|(
name|page_num
operator|<=
name|notebook
operator|->
name|current_page
condition|)
name|notebook
operator|->
name|current_page
operator|--
expr_stmt|;
if|if
condition|(
name|page
operator|->
name|active
operator|==
name|TRUE
condition|)
block|{
if|if
condition|(
name|newactive
operator|>=
name|notebook
operator|->
name|num_pages
condition|)
name|newactive
operator|=
name|notebook
operator|->
name|num_pages
operator|-
literal|1
expr_stmt|;
name|gck_notebook_set_page
argument_list|(
name|notebook
argument_list|,
name|newactive
argument_list|)
expr_stmt|;
block|}
else|else
name|gck_notebook_set_page
argument_list|(
name|notebook
argument_list|,
name|gck_notebook_get_page
argument_list|(
name|notebook
argument_list|)
operator|->
name|position
argument_list|)
expr_stmt|;
comment|/*      gtk_widget_destroy (page->widget);       free(page); */
name|g_list_free
argument_list|(
name|current
argument_list|)
expr_stmt|;
block|}
name|g_function_leave
argument_list|(
literal|"gck_notebook_remove_page"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* void gck_notebook_remove_page(GckNoteBook *notebook,gint page_num) {   GList *current,*temp;   GckNoteBookPage *page;   gint newactive=page_num;    g_function_enter("gck_notebook_remove_page");   g_assert(notebook!=NULL);    if (notebook->num_pages>1)     {       if (page_num<0)         page_num=0;       else if (page_num>notebook->num_pages)         page_num=notebook->num_pages;        current=g_list_nth(notebook->page_list,page_num);       notebook->page_list=g_list_remove_link(notebook->page_list,current);       page=(GckNoteBookPage *)current->data;       gtk_widget_unmap(page->widget);        if (page->active==TRUE)         {           if (current->next==NULL) newactive--;           notebook->current_page=newactive;           free(page);           page=gck_notebook_get_page(notebook);           page->active=TRUE;           gtk_widget_map(page->widget);         }       temp=current;       while (temp!=NULL)         {           page=(GckNoteBookPage *)temp->data;           page->position--;           temp=temp->next;         }       g_list_free(current);     }    g_function_leave("gck_notebook_remove_page"); } */
end_comment

begin_comment
comment|/*******************************/
end_comment

begin_comment
comment|/* Get the current active page */
end_comment

begin_comment
comment|/*******************************/
end_comment

begin_function
DECL|function|gck_notebook_get_page (GckNoteBook * notebook)
name|GckNoteBookPage
modifier|*
name|gck_notebook_get_page
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|)
block|{
name|GList
modifier|*
name|current
init|=
name|NULL
decl_stmt|;
name|GckNoteBookPage
modifier|*
name|page
init|=
name|NULL
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_get_page"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|notebook
operator|->
name|num_pages
operator|>
literal|0
condition|)
block|{
name|current
operator|=
name|g_list_nth
argument_list|(
name|g_list_first
argument_list|(
name|notebook
operator|->
name|page_list
argument_list|)
argument_list|,
name|notebook
operator|->
name|current_page
argument_list|)
expr_stmt|;
name|page
operator|=
operator|(
name|GckNoteBookPage
operator|*
operator|)
name|current
operator|->
name|data
expr_stmt|;
block|}
name|g_function_leave
argument_list|(
literal|"gck_notebook_get_page"
argument_list|)
expr_stmt|;
return|return
operator|(
name|page
operator|)
return|;
block|}
end_function

begin_comment
comment|/*******************************/
end_comment

begin_comment
comment|/* Set the current active page */
end_comment

begin_comment
comment|/*******************************/
end_comment

begin_function
DECL|function|gck_notebook_set_page (GckNoteBook * notebook,gint page_num)
name|void
name|gck_notebook_set_page
parameter_list|(
name|GckNoteBook
modifier|*
name|notebook
parameter_list|,
name|gint
name|page_num
parameter_list|)
block|{
name|GckNoteBookPage
modifier|*
name|page
decl_stmt|;
name|g_function_enter
argument_list|(
literal|"gck_notebook_set_page"
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|notebook
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|page
operator|=
name|gck_notebook_get_page
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|page
operator|->
name|active
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_unmap
argument_list|(
name|page
operator|->
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|page
operator|->
name|widget
argument_list|)
expr_stmt|;
comment|/* Hmm.. some widgets (gtkframe for example) doesn't handle */
comment|/* unmap calls very graciously. Lets clean up to be safe..  */
comment|/* ======================================================== */
name|gdk_window_clear
argument_list|(
name|page
operator|->
name|widget
operator|->
name|window
argument_list|)
expr_stmt|;
name|notebook
operator|->
name|current_page
operator|=
name|page_num
expr_stmt|;
name|page
operator|=
name|gck_notebook_get_page
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|page
operator|->
name|active
operator|=
name|TRUE
expr_stmt|;
name|gtk_widget_set_uposition
argument_list|(
name|page
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|widget
operator|->
name|allocation
operator|.
name|x
operator|+
literal|2
argument_list|,
name|notebook
operator|->
name|widget
operator|->
name|allocation
operator|.
name|y
operator|+
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|page
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|notebook
operator|->
name|widget
argument_list|,
name|notebook
operator|->
name|width
argument_list|,
name|notebook
operator|->
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
operator|->
name|widget
argument_list|)
expr_stmt|;
name|gdk_window_clear
argument_list|(
name|notebook
operator|->
name|tab_box
operator|->
name|window
argument_list|)
expr_stmt|;
name|gck_notebook_draw_frames
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|g_function_leave
argument_list|(
literal|"gck_notebook_set_page"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

