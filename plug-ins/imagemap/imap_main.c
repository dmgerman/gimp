begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * This is a plug-in for the GIMP.  *  * Generates clickable image maps.  *  * Copyright (C) 1998-1999 Maurits Rijk  lpeek.mrijk@consunet.nl  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  *  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_comment
comment|/* for keyboard values */
end_comment

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"imap_about.h"
end_include

begin_include
include|#
directive|include
file|"imap_circle.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_clear.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_copy.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_cut.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_create.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_guides.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_move.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_move_down.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_move_sash.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_move_selected.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_move_to_front.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_move_up.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_object_move.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_paste.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_select.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_select_all.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_select_next.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_select_prev.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_select_region.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_send_to_back.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_unselect.h"
end_include

begin_include
include|#
directive|include
file|"imap_cmd_unselect_all.h"
end_include

begin_include
include|#
directive|include
file|"imap_default_dialog.h"
end_include

begin_include
include|#
directive|include
file|"imap_edit_area_info.h"
end_include

begin_include
include|#
directive|include
file|"imap_file.h"
end_include

begin_include
include|#
directive|include
file|"imap_grid.h"
end_include

begin_include
include|#
directive|include
file|"imap_main.h"
end_include

begin_include
include|#
directive|include
file|"imap_menu.h"
end_include

begin_include
include|#
directive|include
file|"imap_object.h"
end_include

begin_include
include|#
directive|include
file|"imap_polygon.h"
end_include

begin_include
include|#
directive|include
file|"imap_popup.h"
end_include

begin_include
include|#
directive|include
file|"imap_preview.h"
end_include

begin_include
include|#
directive|include
file|"imap_rectangle.h"
end_include

begin_include
include|#
directive|include
file|"imap_selection.h"
end_include

begin_include
include|#
directive|include
file|"imap_settings.h"
end_include

begin_include
include|#
directive|include
file|"imap_source.h"
end_include

begin_include
include|#
directive|include
file|"imap_statusbar.h"
end_include

begin_include
include|#
directive|include
file|"imap_string.h"
end_include

begin_include
include|#
directive|include
file|"imap_toolbar.h"
end_include

begin_include
include|#
directive|include
file|"imap_tools.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|MAX_ZOOM_FACTOR
define|#
directive|define
name|MAX_ZOOM_FACTOR
value|8
end_define

begin_define
DECL|macro|ZOOMED (x)
define|#
directive|define
name|ZOOMED
parameter_list|(
name|x
parameter_list|)
value|(_zoom_factor * (x))
end_define

begin_define
DECL|macro|GET_REAL_COORD (x)
define|#
directive|define
name|GET_REAL_COORD
parameter_list|(
name|x
parameter_list|)
value|((x) / _zoom_factor)
end_define

begin_comment
comment|/* Global variables */
end_comment

begin_decl_stmt
DECL|variable|_map_info
specifier|static
name|MapInfo_t
name|_map_info
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_preferences
specifier|static
name|PreferencesData_t
name|_preferences
init|=
block|{
name|CSIM
block|,
name|TRUE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|DEFAULT_UNDO_LEVELS
block|,
name|DEFAULT_MRU_SIZE
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_mru
specifier|static
name|MRU_t
modifier|*
name|_mru
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_cursor
specifier|static
name|GdkCursorType
name|_cursor
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_show_url
specifier|static
name|gboolean
name|_show_url
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_filename
specifier|static
name|gchar
modifier|*
name|_filename
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_image_name
specifier|static
name|char
modifier|*
name|_image_name
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_image_width
specifier|static
name|gint
name|_image_width
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_image_height
specifier|static
name|gint
name|_image_height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_dlg
specifier|static
name|GtkWidget
modifier|*
name|_dlg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_preview
specifier|static
name|Preview_t
modifier|*
name|_preview
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_selection
specifier|static
name|Selection_t
modifier|*
name|_selection
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_statusbar
specifier|static
name|StatusBar_t
modifier|*
name|_statusbar
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_toolbar
specifier|static
name|ToolBar_t
modifier|*
name|_toolbar
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_shapes
specifier|static
name|ObjectList_t
modifier|*
name|_shapes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_zoom_factor
specifier|static
name|gint
name|_zoom_factor
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_function_decl
DECL|variable|_button_press_func
specifier|static
name|void
function_decl|(
modifier|*
name|_button_press_func
function_decl|)
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|_button_press_param
specifier|static
name|gpointer
name|_button_press_param
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Declare local functions. */
end_comment

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|int
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|dialog
parameter_list|(
name|GDrawable
modifier|*
name|drawable
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc */
name|NULL
block|,
comment|/* quit_proc */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|run_flag
specifier|static
name|int
name|run_flag
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|()
block|{
specifier|static
name|GParamDef
name|args
index|[]
init|=
block|{
block|{
name|PARAM_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive"
block|}
block|,
block|{
name|PARAM_IMAGE
block|,
literal|"image"
block|,
literal|"Input image (unused)"
block|}
block|,
block|{
name|PARAM_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|,    }
decl_stmt|;
specifier|static
name|GParamDef
modifier|*
name|return_vals
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|nargs
init|=
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
specifier|static
name|int
name|nreturn_vals
init|=
literal|0
decl_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"plug_in_imagemap"
argument_list|,
literal|"Creates a clickable imagemap."
argument_list|,
literal|""
argument_list|,
literal|"Maurits Rijk"
argument_list|,
literal|"Maurits Rijk"
argument_list|,
literal|"1998-1999"
argument_list|,
name|N_
argument_list|(
literal|"<Image>/Filters/Web/ImageMap..."
argument_list|)
argument_list|,
literal|"RGB*, GRAY*, INDEXED*"
argument_list|,
name|PROC_PLUG_IN
argument_list|,
name|nargs
argument_list|,
name|nreturn_vals
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (char * name,int n_params,GParam * param,int * nreturn_vals,GParam ** return_vals)
name|run
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|n_params
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|int
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GParam
name|values
index|[
literal|1
index|]
decl_stmt|;
name|GDrawable
modifier|*
name|drawable
decl_stmt|;
name|GRunModeType
name|run_mode
decl_stmt|;
name|GStatusType
name|status
init|=
name|STATUS_SUCCESS
decl_stmt|;
name|INIT_I18N_UI
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
comment|/*  Get the specified drawable  */
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
name|_image_name
operator|=
name|gimp_image_get_filename
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
argument_list|)
expr_stmt|;
name|_image_width
operator|=
name|gimp_image_width
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
argument_list|)
expr_stmt|;
name|_image_height
operator|=
name|gimp_image_height
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
argument_list|)
expr_stmt|;
name|_map_info
operator|.
name|color
operator|=
name|gimp_drawable_is_rgb
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|run_mode
operator|=
operator|(
name|GRunModeType
operator|)
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
if|if
condition|(
name|run_mode
operator|==
name|RUN_INTERACTIVE
condition|)
block|{
if|if
condition|(
operator|!
name|dialog
argument_list|(
name|drawable
argument_list|)
condition|)
block|{
comment|/* The dialog was closed, or something similarly evil happened. */
name|status
operator|=
name|STATUS_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
if|if
condition|(
name|status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_function
name|MRU_t
modifier|*
DECL|function|get_mru (void)
name|get_mru
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
operator|!
name|_mru
condition|)
name|_mru
operator|=
name|mru_create
argument_list|()
expr_stmt|;
return|return
name|_mru
return|;
block|}
end_function

begin_function
name|MapInfo_t
modifier|*
DECL|function|get_map_info (void)
name|get_map_info
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|&
name|_map_info
return|;
block|}
end_function

begin_function
name|PreferencesData_t
modifier|*
DECL|function|get_preferences (void)
name|get_preferences
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|&
name|_preferences
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|init_preferences (void)
name|init_preferences
parameter_list|(
name|void
parameter_list|)
block|{
name|GdkColormap
modifier|*
name|colormap
init|=
name|gdk_window_get_colormap
argument_list|(
name|_dlg
operator|->
name|window
argument_list|)
decl_stmt|;
name|ColorSelData_t
modifier|*
name|colors
init|=
operator|&
name|_preferences
operator|.
name|colors
decl_stmt|;
name|colors
operator|->
name|normal_fg
operator|.
name|red
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_fg
operator|.
name|green
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|normal_fg
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_bg
operator|.
name|red
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_bg
operator|.
name|green
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_bg
operator|.
name|blue
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|selected_fg
operator|.
name|red
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|selected_fg
operator|.
name|green
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_fg
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_bg
operator|.
name|red
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_bg
operator|.
name|green
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_bg
operator|.
name|blue
operator|=
literal|0xFFFF
expr_stmt|;
name|preferences_load
argument_list|(
operator|&
name|_preferences
argument_list|)
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|colormap
argument_list|,
operator|&
name|colors
operator|->
name|normal_fg
argument_list|)
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|colormap
argument_list|,
operator|&
name|colors
operator|->
name|normal_bg
argument_list|)
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|colormap
argument_list|,
operator|&
name|colors
operator|->
name|selected_fg
argument_list|)
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|colormap
argument_list|,
operator|&
name|colors
operator|->
name|selected_bg
argument_list|)
expr_stmt|;
name|_preferences
operator|.
name|normal_gc
operator|=
name|gdk_gc_new
argument_list|(
name|_preview
operator|->
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|_preferences
operator|.
name|selected_gc
operator|=
name|gdk_gc_new
argument_list|(
name|_preview
operator|->
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_gc_set_line_attributes
argument_list|(
name|_preferences
operator|.
name|normal_gc
argument_list|,
literal|1
argument_list|,
name|GDK_LINE_DOUBLE_DASH
argument_list|,
name|GDK_CAP_BUTT
argument_list|,
name|GDK_JOIN_BEVEL
argument_list|)
expr_stmt|;
name|gdk_gc_set_line_attributes
argument_list|(
name|_preferences
operator|.
name|selected_gc
argument_list|,
literal|1
argument_list|,
name|GDK_LINE_DOUBLE_DASH
argument_list|,
name|GDK_CAP_BUTT
argument_list|,
name|GDK_JOIN_BEVEL
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|_preferences
operator|.
name|normal_gc
argument_list|,
operator|&
name|colors
operator|->
name|normal_fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_background
argument_list|(
name|_preferences
operator|.
name|normal_gc
argument_list|,
operator|&
name|colors
operator|->
name|normal_bg
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|_preferences
operator|.
name|selected_gc
argument_list|,
operator|&
name|colors
operator|->
name|selected_fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_background
argument_list|(
name|_preferences
operator|.
name|selected_gc
argument_list|,
operator|&
name|colors
operator|->
name|selected_bg
argument_list|)
expr_stmt|;
name|mru_set_size
argument_list|(
name|_mru
argument_list|,
name|_preferences
operator|.
name|mru_size
argument_list|)
expr_stmt|;
name|command_list_set_undo_level
argument_list|(
name|_preferences
operator|.
name|undo_levels
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gint
DECL|function|get_image_width (void)
name|get_image_width
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_image_width
return|;
block|}
end_function

begin_function
name|gint
DECL|function|get_image_height (void)
name|get_image_height
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_image_height
return|;
block|}
end_function

begin_function
name|void
DECL|function|set_busy_cursor (void)
name|set_busy_cursor
parameter_list|(
name|void
parameter_list|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|GDK_WATCH
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|remove_busy_cursor (void)
name|remove_busy_cursor
parameter_list|(
name|void
parameter_list|)
block|{
name|gdk_window_set_cursor
argument_list|(
name|_dlg
operator|->
name|window
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|zoom_in (void)
name|zoom_in
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|_zoom_factor
operator|<
name|MAX_ZOOM_FACTOR
condition|)
block|{
name|set_zoom
argument_list|(
name|_zoom_factor
operator|+
literal|1
argument_list|)
expr_stmt|;
name|menu_set_zoom
argument_list|(
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
return|return
name|_zoom_factor
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|zoom_out (void)
name|zoom_out
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|_zoom_factor
operator|>
literal|1
condition|)
block|{
name|set_zoom
argument_list|(
name|_zoom_factor
operator|-
literal|1
argument_list|)
expr_stmt|;
name|menu_set_zoom
argument_list|(
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
return|return
name|_zoom_factor
return|;
block|}
end_function

begin_function
name|void
DECL|function|set_zoom (gint zoom_factor)
name|set_zoom
parameter_list|(
name|gint
name|zoom_factor
parameter_list|)
block|{
name|set_busy_cursor
argument_list|()
expr_stmt|;
name|_zoom_factor
operator|=
name|zoom_factor
expr_stmt|;
name|toolbar_set_zoom_sensitivity
argument_list|(
name|_toolbar
argument_list|,
name|zoom_factor
argument_list|)
expr_stmt|;
name|preview_zoom
argument_list|(
name|_preview
argument_list|,
name|zoom_factor
argument_list|)
expr_stmt|;
name|statusbar_set_zoom
argument_list|(
name|_statusbar
argument_list|,
name|zoom_factor
argument_list|)
expr_stmt|;
name|remove_busy_cursor
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|main_toolbar_set_grid (gboolean active)
name|main_toolbar_set_grid
parameter_list|(
name|gboolean
name|active
parameter_list|)
block|{
name|toolbar_set_grid
argument_list|(
name|_toolbar
argument_list|,
name|active
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gint
DECL|function|get_real_coord (gint coord)
name|get_real_coord
parameter_list|(
name|gint
name|coord
parameter_list|)
block|{
return|return
name|GET_REAL_COORD
argument_list|(
name|coord
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|draw_line (GdkWindow * window,GdkGC * gc,gint x1,gint y1,gint x2,gint y2)
name|draw_line
parameter_list|(
name|GdkWindow
modifier|*
name|window
parameter_list|,
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gint
name|y1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gint
name|y2
parameter_list|)
block|{
name|gdk_draw_line
argument_list|(
name|window
argument_list|,
name|gc
argument_list|,
name|ZOOMED
argument_list|(
name|x1
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|y1
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|x2
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|y2
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_rectangle (GdkWindow * window,GdkGC * gc,gint filled,gint x,gint y,gint width,gint height)
name|draw_rectangle
parameter_list|(
name|GdkWindow
modifier|*
name|window
parameter_list|,
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|gint
name|filled
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|gdk_draw_rectangle
argument_list|(
name|window
argument_list|,
name|gc
argument_list|,
name|filled
argument_list|,
name|ZOOMED
argument_list|(
name|x
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|y
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|width
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|height
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_arc (GdkWindow * window,GdkGC * gc,gint filled,gint x,gint y,gint width,gint height,gint angle1,gint angle2)
name|draw_arc
parameter_list|(
name|GdkWindow
modifier|*
name|window
parameter_list|,
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|gint
name|filled
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|gint
name|angle1
parameter_list|,
name|gint
name|angle2
parameter_list|)
block|{
name|gdk_draw_arc
argument_list|(
name|window
argument_list|,
name|gc
argument_list|,
name|filled
argument_list|,
name|ZOOMED
argument_list|(
name|x
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|y
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|width
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|height
argument_list|)
argument_list|,
name|angle1
argument_list|,
name|angle2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_circle (GdkWindow * window,GdkGC * gc,gint filled,gint x,gint y,gint r)
name|draw_circle
parameter_list|(
name|GdkWindow
modifier|*
name|window
parameter_list|,
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|gint
name|filled
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|r
parameter_list|)
block|{
name|draw_arc
argument_list|(
name|window
argument_list|,
name|gc
argument_list|,
name|filled
argument_list|,
name|x
operator|-
name|r
argument_list|,
name|y
operator|-
name|r
argument_list|,
literal|2
operator|*
name|r
argument_list|,
literal|2
operator|*
name|r
argument_list|,
literal|0
argument_list|,
literal|360
operator|*
literal|64
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_polygon (GdkWindow * window,GdkGC * gc,GList * list)
name|draw_polygon
parameter_list|(
name|GdkWindow
modifier|*
name|window
parameter_list|,
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|GList
modifier|*
name|list
parameter_list|)
block|{
name|gint
name|npoints
init|=
name|g_list_length
argument_list|(
name|list
argument_list|)
decl_stmt|;
name|GdkPoint
modifier|*
name|points
init|=
name|g_new
argument_list|(
name|GdkPoint
argument_list|,
name|npoints
argument_list|)
decl_stmt|;
name|GdkPoint
modifier|*
name|des
init|=
name|points
decl_stmt|;
name|GList
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|list
init|;
name|p
condition|;
name|p
operator|=
name|p
operator|->
name|next
operator|,
name|des
operator|++
control|)
block|{
name|GdkPoint
modifier|*
name|src
init|=
operator|(
name|GdkPoint
operator|*
operator|)
name|p
operator|->
name|data
decl_stmt|;
name|des
operator|->
name|x
operator|=
name|ZOOMED
argument_list|(
name|src
operator|->
name|x
argument_list|)
expr_stmt|;
name|des
operator|->
name|y
operator|=
name|ZOOMED
argument_list|(
name|src
operator|->
name|y
argument_list|)
expr_stmt|;
block|}
name|gdk_draw_polygon
argument_list|(
name|window
argument_list|,
name|gc
argument_list|,
name|FALSE
argument_list|,
name|points
argument_list|,
name|npoints
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|points
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
DECL|variable|_preview_redraw_blocked
specifier|static
name|gboolean
name|_preview_redraw_blocked
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_pending_redraw
specifier|static
name|gboolean
name|_pending_redraw
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|preview_freeze (void)
name|preview_freeze
parameter_list|(
name|void
parameter_list|)
block|{
name|_preview_redraw_blocked
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|preview_thaw (void)
name|preview_thaw
parameter_list|(
name|void
parameter_list|)
block|{
name|_preview_redraw_blocked
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|_pending_redraw
condition|)
block|{
name|_pending_redraw
operator|=
name|FALSE
expr_stmt|;
name|redraw_preview
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|redraw_preview (void)
name|redraw_preview
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|_preview_redraw_blocked
condition|)
name|_pending_redraw
operator|=
name|TRUE
expr_stmt|;
else|else
name|preview_redraw
argument_list|(
name|_preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_preview_gray (void)
name|set_preview_gray
parameter_list|(
name|void
parameter_list|)
block|{
name|_map_info
operator|.
name|show_gray
operator|=
name|TRUE
expr_stmt|;
name|set_zoom
argument_list|(
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_preview_color (void)
name|set_preview_color
parameter_list|(
name|void
parameter_list|)
block|{
name|_map_info
operator|.
name|show_gray
operator|=
name|FALSE
expr_stmt|;
name|set_zoom
argument_list|(
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
DECL|function|get_image_name (void)
name|get_image_name
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_image_name
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
DECL|function|get_filename (void)
name|get_filename
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_filename
return|;
block|}
end_function

begin_function
name|void
DECL|function|set_arrow_func (void)
name|set_arrow_func
parameter_list|(
name|void
parameter_list|)
block|{
name|_button_press_func
operator|=
name|arrow_on_button_press
expr_stmt|;
name|_cursor
operator|=
name|GDK_TOP_LEFT_ARROW
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_object_func (void (* func)(GtkWidget *,GdkEventButton *,gpointer),gpointer param)
name|set_object_func
parameter_list|(
name|void
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
parameter_list|,
name|gpointer
name|param
parameter_list|)
block|{
name|_button_press_func
operator|=
name|func
expr_stmt|;
name|_button_press_param
operator|=
name|param
expr_stmt|;
name|_cursor
operator|=
name|GDK_CROSSHAIR
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|set_rectangle_func (void)
name|set_rectangle_func
parameter_list|(
name|void
parameter_list|)
block|{
name|set_object_func
argument_list|(
name|object_on_button_press
argument_list|,
name|get_rectangle_factory
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|set_circle_func (void)
name|set_circle_func
parameter_list|(
name|void
parameter_list|)
block|{
name|set_object_func
argument_list|(
name|object_on_button_press
argument_list|,
name|get_circle_factory
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|set_polygon_func (void)
name|set_polygon_func
parameter_list|(
name|void
parameter_list|)
block|{
name|set_object_func
argument_list|(
name|object_on_button_press
argument_list|,
name|get_polygon_factory
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|add_shape (Object_t * obj)
name|add_shape
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|)
block|{
name|object_list_append
argument_list|(
name|_shapes
argument_list|,
name|obj
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|ObjectList_t
modifier|*
DECL|function|get_shapes (void)
name|get_shapes
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_shapes
return|;
block|}
end_function

begin_function
name|void
DECL|function|update_shape (Object_t * obj)
name|update_shape
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|)
block|{
name|object_list_update
argument_list|(
name|_shapes
argument_list|,
name|obj
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|edit_selected_shape (void)
name|edit_selected_shape
parameter_list|(
name|void
parameter_list|)
block|{
name|object_list_edit_selected
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_popup_menu (GdkEventButton * event)
name|do_popup_menu
parameter_list|(
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|gint
name|x
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|x
argument_list|)
decl_stmt|;
name|gint
name|y
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|y
argument_list|)
decl_stmt|;
name|Object_t
modifier|*
name|obj
init|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
decl_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
name|obj
operator|->
name|class
operator|->
name|do_popup
argument_list|(
name|obj
argument_list|,
name|event
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|do_main_popup_menu
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_all_sensitivities (void)
name|set_all_sensitivities
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|count
init|=
name|object_list_nr_selected
argument_list|(
name|_shapes
argument_list|)
decl_stmt|;
name|menu_shapes_selected
argument_list|(
name|count
argument_list|)
expr_stmt|;
name|toolbar_shapes_selected
argument_list|(
name|_toolbar
argument_list|,
name|count
argument_list|)
expr_stmt|;
name|tools_set_sensitive
argument_list|(
name|count
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|main_set_title (const char * filename)
name|main_set_title
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|char
modifier|*
name|title
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_filename
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|p
operator|=
operator|(
name|filename
operator|)
condition|?
name|g_basename
argument_list|(
name|filename
argument_list|)
else|:
name|_
argument_list|(
literal|"<Untitled>"
argument_list|)
expr_stmt|;
name|title
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s - ImageMap 1.3"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|_dlg
argument_list|)
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|title
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|main_set_dimension (gint width,gint height)
name|main_set_dimension
parameter_list|(
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|statusbar_set_dimension
argument_list|(
name|_statusbar
argument_list|,
name|width
operator|/
name|_zoom_factor
argument_list|,
name|height
operator|/
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|main_clear_dimension (void)
name|main_clear_dimension
parameter_list|(
name|void
parameter_list|)
block|{
name|statusbar_clear_dimension
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|show_url (void)
name|show_url
parameter_list|(
name|void
parameter_list|)
block|{
name|_show_url
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|hide_url (void)
name|hide_url
parameter_list|(
name|void
parameter_list|)
block|{
name|_show_url
operator|=
name|FALSE
expr_stmt|;
name|statusbar_clear_status
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|select_shape (GtkWidget * widget,GdkEventButton * event)
name|select_shape
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|Object_t
modifier|*
name|obj
decl_stmt|;
name|gint
name|x
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|x
argument_list|)
decl_stmt|;
name|gint
name|y
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|y
argument_list|)
decl_stmt|;
name|MoveSashFunc_t
name|sash_func
decl_stmt|;
name|obj
operator|=
name|object_list_near_sash
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|sash_func
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
comment|/* Start resizing */
name|Command_t
modifier|*
name|command
init|=
name|move_sash_command_new
argument_list|(
name|widget
argument_list|,
name|obj
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|sash_func
argument_list|)
decl_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Command_t
modifier|*
name|command
decl_stmt|;
name|obj
operator|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
if|if
condition|(
name|event
operator|->
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
if|if
condition|(
name|obj
operator|->
name|selected
condition|)
name|command
operator|=
name|unselect_command_new
argument_list|(
name|obj
argument_list|)
expr_stmt|;
else|else
name|command
operator|=
name|select_command_new
argument_list|(
name|obj
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* No Shift key pressed */
if|if
condition|(
name|obj
operator|->
name|selected
condition|)
block|{
name|command
operator|=
name|unselect_all_command_new
argument_list|(
name|_shapes
argument_list|,
name|obj
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Command_t
modifier|*
name|sub_command
decl_stmt|;
name|command
operator|=
name|subcommand_start
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|sub_command
operator|=
name|unselect_all_command_new
argument_list|(
name|_shapes
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|command_add_subcommand
argument_list|(
name|command
argument_list|,
name|sub_command
argument_list|)
expr_stmt|;
name|sub_command
operator|=
name|select_command_new
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|command_add_subcommand
argument_list|(
name|command
argument_list|,
name|sub_command
argument_list|)
expr_stmt|;
name|command_set_name
argument_list|(
name|command
argument_list|,
name|sub_command
operator|->
name|name
argument_list|)
expr_stmt|;
name|subcommand_end
argument_list|()
expr_stmt|;
block|}
block|}
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
name|command
operator|=
name|move_command_new
argument_list|(
name|_preview
argument_list|,
name|obj
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* Start selection rectangle */
name|command
operator|=
name|select_region_command_new
argument_list|(
name|widget
argument_list|,
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|edit_shape (gint x,gint y)
name|edit_shape
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|Object_t
modifier|*
name|obj
decl_stmt|;
name|x
operator|=
name|GET_REAL_COORD
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|y
operator|=
name|GET_REAL_COORD
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|obj
operator|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
name|object_select
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|object_edit
argument_list|(
name|obj
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|toolbar_grid (void)
name|toolbar_grid
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|grid
init|=
name|toggle_grid
argument_list|()
decl_stmt|;
name|popup_check_grid
argument_list|(
name|grid
argument_list|)
expr_stmt|;
name|menu_check_grid
argument_list|(
name|grid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|menu_zoom_in (void)
name|menu_zoom_in
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|factor
init|=
name|zoom_in
argument_list|()
decl_stmt|;
name|menu_set_zoom_sensitivity
argument_list|(
name|factor
argument_list|)
expr_stmt|;
name|popup_set_zoom_sensitivity
argument_list|(
name|factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|menu_zoom_out (void)
name|menu_zoom_out
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|factor
init|=
name|zoom_out
argument_list|()
decl_stmt|;
name|menu_set_zoom_sensitivity
argument_list|(
name|factor
argument_list|)
expr_stmt|;
name|popup_set_zoom_sensitivity
argument_list|(
name|factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_shapes (GtkWidget * preview)
name|draw_shapes
parameter_list|(
name|GtkWidget
modifier|*
name|preview
parameter_list|)
block|{
if|if
condition|(
operator|!
name|_preview_redraw_blocked
condition|)
name|object_list_draw
argument_list|(
name|_shapes
argument_list|,
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|clear_map_info (void)
name|clear_map_info
parameter_list|(
name|void
parameter_list|)
block|{
name|gchar
modifier|*
name|author
init|=
name|g_get_real_name
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
operator|*
name|author
condition|)
name|author
operator|=
name|g_get_user_name
argument_list|()
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|image_name
argument_list|,
name|_image_name
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|title
argument_list|,
literal|"map"
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|author
argument_list|,
name|author
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|default_url
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|description
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|_map_info
operator|.
name|map_format
operator|=
name|CSIM
expr_stmt|;
name|_map_info
operator|.
name|show_gray
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_data_changed_dialog (void (* continue_cb)(gpointer),gpointer param)
name|do_data_changed_dialog
parameter_list|(
name|void
function_decl|(
modifier|*
name|continue_cb
function_decl|)
parameter_list|(
name|gpointer
parameter_list|)
parameter_list|,
name|gpointer
name|param
parameter_list|)
block|{
specifier|static
name|DefaultDialog_t
modifier|*
name|dialog
decl_stmt|;
if|if
condition|(
operator|!
name|dialog
condition|)
block|{
name|dialog
operator|=
name|make_default_dialog
argument_list|(
name|_
argument_list|(
literal|"Data changed"
argument_list|)
argument_list|)
expr_stmt|;
name|default_dialog_hide_apply_button
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|default_dialog_set_label
argument_list|(
name|dialog
argument_list|,
name|_
argument_list|(
literal|"Some data has been changed.\n"
literal|"Do you really want to continue?"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|default_dialog_set_ok_cb
argument_list|(
name|dialog
argument_list|,
name|continue_cb
argument_list|,
name|param
argument_list|)
expr_stmt|;
name|default_dialog_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|check_if_changed (void (* func)(gpointer),gpointer param)
name|check_if_changed
parameter_list|(
name|void
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|gpointer
parameter_list|)
parameter_list|,
name|gpointer
name|param
parameter_list|)
block|{
if|if
condition|(
name|object_list_get_changed
argument_list|(
name|_shapes
argument_list|)
condition|)
name|do_data_changed_dialog
argument_list|(
name|func
argument_list|,
name|param
argument_list|)
expr_stmt|;
else|else
name|func
argument_list|(
name|param
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|close_current (void)
name|close_current
parameter_list|(
name|void
parameter_list|)
block|{
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|object_list_remove_all
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|clear_map_info
argument_list|()
expr_stmt|;
name|main_set_title
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|set_all_sensitivities
argument_list|()
expr_stmt|;
name|redraw_preview
argument_list|()
expr_stmt|;
name|object_list_clear_changed
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|command_list_remove_all
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_close (gpointer data)
name|really_close
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|close_current
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_close (void)
name|do_close
parameter_list|(
name|void
parameter_list|)
block|{
name|check_if_changed
argument_list|(
name|really_close
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_quit (gpointer data)
name|really_quit
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|preferences_save
argument_list|(
operator|&
name|_preferences
argument_list|)
expr_stmt|;
name|run_flag
operator|=
literal|1
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|_dlg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_quit (void)
name|do_quit
parameter_list|(
name|void
parameter_list|)
block|{
name|check_if_changed
argument_list|(
name|really_quit
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_undo (void)
name|do_undo
parameter_list|(
name|void
parameter_list|)
block|{
name|preview_freeze
argument_list|()
expr_stmt|;
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|last_command_undo
argument_list|()
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|preview_thaw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_redo (void)
name|do_redo
parameter_list|(
name|void
parameter_list|)
block|{
name|preview_freeze
argument_list|()
expr_stmt|;
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|last_command_redo
argument_list|()
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|preview_thaw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save (void)
name|save
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|_filename
condition|)
name|save_as
argument_list|(
name|_filename
argument_list|)
expr_stmt|;
else|else
name|do_file_save_as_dialog
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|write_cern_comment (gpointer param,OutputFunc_t output)
name|write_cern_comment
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|output
argument_list|(
name|param
argument_list|,
literal|"rect (4096,4096) (4096,4096) imap:#$"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_as_cern (gpointer param,OutputFunc_t output)
name|save_as_cern
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|gchar
modifier|*
name|description
decl_stmt|;
name|gchar
modifier|*
name|next_token
decl_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"-:Image Map file created by GIMP Imagemap Plugin\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"-:GIMP Imagemap Plugin by Maurits Rijk\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"-:Please do not edit lines starting with \"#$\"\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"VERSION:1.3\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"TITLE:%s\n"
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"AUTHOR:%s\n"
argument_list|,
name|_map_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"FORMAT:cern\n"
argument_list|)
expr_stmt|;
name|description
operator|=
name|g_strdup
argument_list|(
name|_map_info
operator|.
name|description
argument_list|)
expr_stmt|;
name|next_token
operator|=
name|description
expr_stmt|;
for|for
control|(
name|p
operator|=
name|strtok
argument_list|(
name|next_token
argument_list|,
literal|"\n"
argument_list|)
init|;
name|p
condition|;
name|p
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|"\n"
argument_list|)
control|)
block|{
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"DESCRIPTION:%s\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|description
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|_map_info
operator|.
name|default_url
condition|)
name|output
argument_list|(
name|param
argument_list|,
literal|"default %s\n"
argument_list|,
name|_map_info
operator|.
name|default_url
argument_list|)
expr_stmt|;
name|object_list_write_cern
argument_list|(
name|_shapes
argument_list|,
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_as_csim (gpointer param,OutputFunc_t output)
name|save_as_csim
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|gchar
modifier|*
name|description
decl_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<IMG SRC=\"%s\" WIDTH=%d HEIGHT=%d BORDER=0 "
literal|"USEMAP=\"#%s\">\n\n"
argument_list|,
name|_map_info
operator|.
name|image_name
argument_list|,
name|_image_width
argument_list|,
name|_image_height
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<MAP NAME=\"%s\">\n"
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$-:Image Map file created by GIMP Imagemap Plugin -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$-:GIMP Imagemap Plugin by Maurits Rijk -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$-:Please do not edit lines starting with \"#$\" -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$VERSION:1.3 -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$AUTHOR:%s -->\n"
argument_list|,
name|_map_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|description
operator|=
name|g_strdup
argument_list|(
name|_map_info
operator|.
name|description
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|strtok
argument_list|(
name|description
argument_list|,
literal|"\n"
argument_list|)
init|;
name|p
condition|;
name|p
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|"\n"
argument_list|)
control|)
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$DESCRIPTION:%s -->\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|description
argument_list|)
expr_stmt|;
name|object_list_write_csim
argument_list|(
name|_shapes
argument_list|,
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|_map_info
operator|.
name|default_url
condition|)
name|output
argument_list|(
name|param
argument_list|,
literal|"<AREA SHAPE=\"DEFAULT\" HREF=\"%s\">\n"
argument_list|,
name|_map_info
operator|.
name|default_url
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"</MAP>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_as_ncsa (gpointer param,OutputFunc_t output)
name|save_as_ncsa
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|gchar
modifier|*
name|description
decl_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$-:Image Map file created by GIMP Imagemap Plugin\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$-:GIMP Imagemap Plugin by Maurits Rijk\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$-:Please do not edit lines starting with \"#$\"\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$VERSION:1.3\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$TITLE:%s\n"
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$AUTHOR:%s\n"
argument_list|,
name|_map_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$FORMAT:ncsa\n"
argument_list|)
expr_stmt|;
name|description
operator|=
name|g_strdup
argument_list|(
name|_map_info
operator|.
name|description
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|strtok
argument_list|(
name|description
argument_list|,
literal|"\n"
argument_list|)
init|;
name|p
condition|;
name|p
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|"\n"
argument_list|)
control|)
name|output
argument_list|(
name|param
argument_list|,
literal|"#$DESCRIPTION:%s\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|description
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|_map_info
operator|.
name|default_url
condition|)
name|output
argument_list|(
name|param
argument_list|,
literal|"default %s\n"
argument_list|,
name|_map_info
operator|.
name|default_url
argument_list|)
expr_stmt|;
name|object_list_write_ncsa
argument_list|(
name|_shapes
argument_list|,
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_to_file (gpointer param,const char * format,...)
name|save_to_file
parameter_list|(
name|gpointer
name|param
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|vfprintf
argument_list|(
operator|(
name|FILE
operator|*
operator|)
name|param
argument_list|,
name|format
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|dump_output (gpointer param,OutputFunc_t output)
name|dump_output
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
if|if
condition|(
name|_map_info
operator|.
name|map_format
operator|==
name|NCSA
condition|)
name|save_as_ncsa
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|_map_info
operator|.
name|map_format
operator|==
name|CERN
condition|)
name|save_as_cern
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|_map_info
operator|.
name|map_format
operator|==
name|CSIM
condition|)
name|save_as_csim
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|save_as (const gchar * filename)
name|save_as
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
name|FILE
modifier|*
name|out
init|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"w"
argument_list|)
decl_stmt|;
if|if
condition|(
name|out
condition|)
block|{
name|dump_output
argument_list|(
name|out
argument_list|,
name|save_to_file
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|statusbar_set_status
argument_list|(
name|_statusbar
argument_list|,
name|_
argument_list|(
literal|"File \"%s\" saved."
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|main_set_title
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|object_list_clear_changed
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|do_file_error_dialog
argument_list|(
name|_
argument_list|(
literal|"Couldn't save file:"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|resize_image_ok_cb (gpointer data)
name|resize_image_ok_cb
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|per_x
init|=
name|_image_width
operator|*
literal|100
operator|/
name|_map_info
operator|.
name|old_image_width
decl_stmt|;
name|gint
name|per_y
init|=
name|_image_height
operator|*
literal|100
operator|/
name|_map_info
operator|.
name|old_image_height
decl_stmt|;
name|object_list_resize
argument_list|(
name|_shapes
argument_list|,
name|per_x
argument_list|,
name|per_y
argument_list|)
expr_stmt|;
name|preview_thaw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|resize_image_cancel_cb (gpointer data)
name|resize_image_cancel_cb
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|preview_thaw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_image_size_changed_dialog (void)
name|do_image_size_changed_dialog
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|DefaultDialog_t
modifier|*
name|dialog
decl_stmt|;
if|if
condition|(
operator|!
name|dialog
condition|)
block|{
name|dialog
operator|=
name|make_default_dialog
argument_list|(
name|_
argument_list|(
literal|"Image size changed"
argument_list|)
argument_list|)
expr_stmt|;
name|default_dialog_hide_apply_button
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|default_dialog_set_label
argument_list|(
name|dialog
argument_list|,
name|_
argument_list|(
literal|"Image size has changed.\n"
literal|"Resize Area's?"
argument_list|)
argument_list|)
expr_stmt|;
name|default_dialog_set_ok_cb
argument_list|(
name|dialog
argument_list|,
name|resize_image_ok_cb
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|default_dialog_set_cancel_cb
argument_list|(
name|dialog
argument_list|,
name|resize_image_cancel_cb
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|default_dialog_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_load (gpointer data)
name|really_load
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gchar
modifier|*
name|filename
init|=
operator|(
name|gchar
operator|*
operator|)
name|data
decl_stmt|;
name|close_current
argument_list|()
expr_stmt|;
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|_map_info
operator|.
name|old_image_width
operator|=
name|_image_width
expr_stmt|;
name|_map_info
operator|.
name|old_image_height
operator|=
name|_image_height
expr_stmt|;
if|if
condition|(
name|load_csim
argument_list|(
name|filename
argument_list|)
condition|)
block|{
name|_map_info
operator|.
name|map_format
operator|=
name|CSIM
expr_stmt|;
if|if
condition|(
name|_image_width
operator|!=
name|_map_info
operator|.
name|old_image_width
operator|||
name|_image_height
operator|!=
name|_map_info
operator|.
name|old_image_height
condition|)
block|{
name|preview_freeze
argument_list|()
expr_stmt|;
name|do_image_size_changed_dialog
argument_list|()
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|load_ncsa
argument_list|(
name|filename
argument_list|)
condition|)
block|{
name|_map_info
operator|.
name|map_format
operator|=
name|NCSA
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|load_cern
argument_list|(
name|filename
argument_list|)
condition|)
block|{
name|_map_info
operator|.
name|map_format
operator|=
name|CERN
expr_stmt|;
block|}
else|else
block|{
name|do_file_error_dialog
argument_list|(
name|_
argument_list|(
literal|"Couldn't read file:"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|close_current
argument_list|()
expr_stmt|;
return|return;
block|}
name|mru_set_first
argument_list|(
name|_mru
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|menu_build_mru_items
argument_list|(
name|_mru
argument_list|)
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|main_set_title
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|object_list_clear_changed
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|redraw_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|load (const gchar * filename)
name|load
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
specifier|static
name|gchar
modifier|*
name|tmp_filename
decl_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|tmp_filename
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|check_if_changed
argument_list|(
name|really_load
argument_list|,
operator|(
name|gpointer
operator|)
name|tmp_filename
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|toggle_area_list (void)
name|toggle_area_list
parameter_list|(
name|void
parameter_list|)
block|{
name|selection_toggle_visibility
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|close_callback (GtkWidget * widget,gpointer data)
name|close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_move (GtkWidget * widget,GdkEventMotion * event)
name|preview_move
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventMotion
modifier|*
name|event
parameter_list|)
block|{
name|gint
name|x
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|x
argument_list|)
decl_stmt|;
name|gint
name|y
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|y
argument_list|)
decl_stmt|;
specifier|static
name|Object_t
modifier|*
name|prev_obj
init|=
name|NULL
decl_stmt|;
name|Object_t
modifier|*
name|obj
init|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
decl_stmt|;
name|statusbar_set_xy
argument_list|(
name|_statusbar
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|!=
name|prev_obj
condition|)
block|{
name|prev_obj
operator|=
name|obj
expr_stmt|;
if|if
condition|(
name|obj
operator|&&
name|_show_url
condition|)
block|{
name|statusbar_set_status
argument_list|(
name|_statusbar
argument_list|,
name|_
argument_list|(
literal|"URL: %s"
argument_list|)
argument_list|,
name|obj
operator|->
name|url
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|statusbar_clear_status
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|_NOT_READY_YET_
if|if
condition|(
operator|!
name|obj
condition|)
block|{
if|if
condition|(
name|grid_near_x
argument_list|(
name|x
argument_list|)
condition|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|GDK_SB_H_DOUBLE_ARROW
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|grid_near_y
argument_list|(
name|y
argument_list|)
condition|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|GDK_SB_V_DOUBLE_ARROW
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|_cursor
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_enter (GtkWidget * widget,GdkEventCrossing * event)
name|preview_enter
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventCrossing
modifier|*
name|event
parameter_list|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|_cursor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_leave (GtkWidget * widget,GdkEventCrossing * event)
name|preview_leave
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventCrossing
modifier|*
name|event
parameter_list|)
block|{
name|gdk_window_set_cursor
argument_list|(
name|_dlg
operator|->
name|window
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|statusbar_clear_xy
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|button_press (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|_button_press_func
argument_list|(
name|widget
argument_list|,
name|event
argument_list|,
name|_button_press_param
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* A few global vars for key movement */
end_comment

begin_decl_stmt
DECL|variable|_timeout
specifier|static
name|gint
name|_timeout
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_keyval
specifier|static
name|guint
name|_keyval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_dx
DECL|variable|_dy
specifier|static
name|gint
name|_dx
decl_stmt|,
name|_dy
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|move_selected_objects (gint dx,gint dy,gboolean fast)
name|move_selected_objects
parameter_list|(
name|gint
name|dx
parameter_list|,
name|gint
name|dy
parameter_list|,
name|gboolean
name|fast
parameter_list|)
block|{
if|if
condition|(
name|fast
condition|)
block|{
name|dx
operator|*=
literal|5
expr_stmt|;
name|dy
operator|*=
literal|5
expr_stmt|;
block|}
name|_dx
operator|+=
name|dx
expr_stmt|;
name|_dy
operator|+=
name|dy
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|_preferences
operator|.
name|normal_gc
argument_list|,
name|GDK_EQUIV
argument_list|)
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|_preferences
operator|.
name|selected_gc
argument_list|,
name|GDK_EQUIV
argument_list|)
expr_stmt|;
name|object_list_draw_selected
argument_list|(
name|_shapes
argument_list|,
name|_preview
operator|->
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|object_list_move_selected
argument_list|(
name|_shapes
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
name|object_list_draw_selected
argument_list|(
name|_shapes
argument_list|,
name|_preview
operator|->
name|preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|_preferences
operator|.
name|normal_gc
argument_list|,
name|GDK_COPY
argument_list|)
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|_preferences
operator|.
name|selected_gc
argument_list|,
name|GDK_COPY
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|key_timeout_cb (gpointer data)
name|key_timeout_cb
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|_keyval
condition|)
block|{
case|case
name|GDK_Left
case|:
case|case
name|GDK_Right
case|:
case|case
name|GDK_Up
case|:
case|case
name|GDK_Down
case|:
name|command_list_add
argument_list|(
name|move_selected_command_new
argument_list|(
name|_shapes
argument_list|,
name|_dx
argument_list|,
name|_dy
argument_list|)
argument_list|)
expr_stmt|;
name|_dx
operator|=
name|_dy
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|preview_thaw
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|key_press_cb (GtkWidget * widget,GdkEventKey * event)
name|key_press_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|)
block|{
name|gint
name|handled
init|=
name|FALSE
decl_stmt|;
name|gboolean
name|shift
init|=
name|event
operator|->
name|state
operator|&
name|GDK_SHIFT_MASK
decl_stmt|;
name|Command_t
modifier|*
name|command
decl_stmt|;
name|preview_freeze
argument_list|()
expr_stmt|;
if|if
condition|(
name|_timeout
condition|)
name|gtk_timeout_remove
argument_list|(
name|_timeout
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|keyval
condition|)
block|{
case|case
name|GDK_Left
case|:
name|move_selected_objects
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_Right
case|:
name|move_selected_objects
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_Up
case|:
name|move_selected_objects
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_Down
case|:
name|move_selected_objects
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_Tab
case|:
if|if
condition|(
name|shift
condition|)
name|command
operator|=
name|select_prev_command_new
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
else|else
name|command
operator|=
name|select_next_command_new
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|handled
condition|)
name|gtk_signal_emit_stop_by_name
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"key_press_event"
argument_list|)
expr_stmt|;
return|return
name|handled
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|key_release_cb (GtkWidget * widget,GdkEventKey * event)
name|key_release_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|)
block|{
name|_keyval
operator|=
name|event
operator|->
name|keyval
expr_stmt|;
name|_timeout
operator|=
name|gtk_timeout_add
argument_list|(
literal|250
argument_list|,
name|key_timeout_cb
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|geometry_changed (Object_t * obj,gpointer data)
name|geometry_changed
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|redraw_preview
argument_list|()
expr_stmt|;
comment|/* Fix me! */
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|data_changed (Object_t * obj,gpointer data)
name|data_changed
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|set_all_sensitivities
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|data_selected (Object_t * obj,gpointer data)
name|data_selected
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|set_all_sensitivities
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_file_open_dialog (void)
name|factory_file_open_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_file_open_dialog
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_save (void)
name|factory_save
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|save
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_save_as (void)
name|factory_save_as
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_file_save_as_dialog
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_preferences_dialog (void)
name|factory_preferences_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_preferences_dialog
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_close (void)
name|factory_close
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_close
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_quit (void)
name|factory_quit
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_quit
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_undo (void)
name|factory_undo
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_undo
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_redo (void)
name|factory_redo
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_redo
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_cut (void)
name|factory_cut
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|cut_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_copy (void)
name|factory_copy
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|copy_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_paste (void)
name|factory_paste
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|paste_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_select_all (void)
name|factory_select_all
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|select_all_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_clear (void)
name|factory_clear
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|clear_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_edit (void)
name|factory_edit
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|edit_selected_shape
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_toggle_area_list (void)
name|factory_toggle_area_list
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|toggle_area_list
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_source_dialog (void)
name|factory_source_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_source_dialog
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_preview_color (void)
name|factory_preview_color
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|set_preview_color
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_preview_gray (void)
name|factory_preview_gray
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|set_preview_gray
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_menu_zoom_in (void)
name|factory_menu_zoom_in
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|menu_zoom_in
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_menu_zoom_out (void)
name|factory_menu_zoom_out
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|menu_zoom_out
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_zoom_in (void)
name|factory_zoom_in
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|zoom_in
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_zoom_out (void)
name|factory_zoom_out
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|zoom_out
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_settings_dialog (void)
name|factory_settings_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_settings_dialog
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_move_to_front (void)
name|factory_move_to_front
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|move_to_front_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_send_to_back (void)
name|factory_send_to_back
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|send_to_back_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_toolbar_grid (void)
name|factory_toolbar_grid
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|toolbar_grid
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_grid_settings_dialog (void)
name|factory_grid_settings_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_grid_settings_dialog
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_create_guides_dialog (void)
name|factory_create_guides_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|guides_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_about_dialog (void)
name|factory_about_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|command_new
argument_list|(
name|do_about_dialog
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_move_up (void)
name|factory_move_up
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|move_up_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_move_down (void)
name|factory_move_down
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|move_down_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|dialog (GDrawable * drawable)
name|dialog
parameter_list|(
name|GDrawable
modifier|*
name|drawable
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|Tools_t
modifier|*
name|tools
decl_stmt|;
name|Menu_t
modifier|*
name|menu
decl_stmt|;
name|PopupMenu_t
modifier|*
name|popup
decl_stmt|;
name|gimp_ui_init
argument_list|(
literal|"imagemap"
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|_shapes
operator|=
name|make_object_list
argument_list|()
expr_stmt|;
name|_dlg
operator|=
name|dlg
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_TOPLEVEL
argument_list|)
expr_stmt|;
name|gtk_window_set_policy
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_realize
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
name|main_set_title
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_connect_help_accel
argument_list|(
name|dlg
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"filters/imagemap.html"
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|close_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
argument_list|)
argument_list|,
literal|"key_press_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|key_press_cb
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
argument_list|)
argument_list|,
literal|"key_release_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|key_release_cb
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|main_vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
comment|/* Create menu */
name|menu
operator|=
name|make_menu
argument_list|(
name|main_vbox
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
name|menu_set_open_command
argument_list|(
name|menu
argument_list|,
name|factory_file_open_dialog
argument_list|)
expr_stmt|;
name|menu_set_save_command
argument_list|(
name|menu
argument_list|,
name|factory_save
argument_list|)
expr_stmt|;
name|menu_set_save_as_command
argument_list|(
name|menu
argument_list|,
name|factory_save_as
argument_list|)
expr_stmt|;
name|menu_set_preferences_command
argument_list|(
name|menu
argument_list|,
name|factory_preferences_dialog
argument_list|)
expr_stmt|;
name|menu_set_close_command
argument_list|(
name|menu
argument_list|,
name|factory_close
argument_list|)
expr_stmt|;
name|menu_set_quit_command
argument_list|(
name|menu
argument_list|,
name|factory_quit
argument_list|)
expr_stmt|;
name|menu_set_undo_command
argument_list|(
name|menu
argument_list|,
name|factory_undo
argument_list|)
expr_stmt|;
name|menu_set_redo_command
argument_list|(
name|menu
argument_list|,
name|factory_redo
argument_list|)
expr_stmt|;
name|menu_set_cut_command
argument_list|(
name|menu
argument_list|,
name|factory_cut
argument_list|)
expr_stmt|;
name|menu_set_copy_command
argument_list|(
name|menu
argument_list|,
name|factory_copy
argument_list|)
expr_stmt|;
name|menu_set_paste_command
argument_list|(
name|menu
argument_list|,
name|factory_paste
argument_list|)
expr_stmt|;
name|menu_set_select_all_command
argument_list|(
name|menu
argument_list|,
name|factory_select_all
argument_list|)
expr_stmt|;
name|menu_set_clear_command
argument_list|(
name|menu
argument_list|,
name|factory_clear
argument_list|)
expr_stmt|;
name|menu_set_edit_erea_info_command
argument_list|(
name|menu
argument_list|,
name|factory_edit
argument_list|)
expr_stmt|;
name|menu_set_area_list_command
argument_list|(
name|menu
argument_list|,
name|factory_toggle_area_list
argument_list|)
expr_stmt|;
name|menu_set_source_command
argument_list|(
name|menu
argument_list|,
name|factory_source_dialog
argument_list|)
expr_stmt|;
name|menu_set_color_command
argument_list|(
name|menu
argument_list|,
name|factory_preview_color
argument_list|)
expr_stmt|;
name|menu_set_gray_command
argument_list|(
name|menu
argument_list|,
name|factory_preview_gray
argument_list|)
expr_stmt|;
name|menu_set_zoom_in_command
argument_list|(
name|menu
argument_list|,
name|factory_menu_zoom_in
argument_list|)
expr_stmt|;
name|menu_set_zoom_out_command
argument_list|(
name|menu
argument_list|,
name|factory_menu_zoom_out
argument_list|)
expr_stmt|;
name|menu_set_edit_map_info_command
argument_list|(
name|menu
argument_list|,
name|factory_settings_dialog
argument_list|)
expr_stmt|;
name|menu_set_grid_settings_command
argument_list|(
name|menu
argument_list|,
name|factory_grid_settings_dialog
argument_list|)
expr_stmt|;
name|menu_set_create_guides_command
argument_list|(
name|menu
argument_list|,
name|factory_create_guides_dialog
argument_list|)
expr_stmt|;
name|menu_set_about_command
argument_list|(
name|menu
argument_list|,
name|factory_about_dialog
argument_list|)
expr_stmt|;
comment|/* Create popup */
name|popup
operator|=
name|create_main_popup_menu
argument_list|()
expr_stmt|;
name|popup_set_zoom_in_command
argument_list|(
name|popup
argument_list|,
name|factory_zoom_in
argument_list|)
expr_stmt|;
name|popup_set_zoom_out_command
argument_list|(
name|popup
argument_list|,
name|factory_zoom_out
argument_list|)
expr_stmt|;
name|popup_set_edit_map_info_command
argument_list|(
name|popup
argument_list|,
name|factory_settings_dialog
argument_list|)
expr_stmt|;
name|popup_set_grid_settings_command
argument_list|(
name|popup
argument_list|,
name|factory_grid_settings_dialog
argument_list|)
expr_stmt|;
name|popup_set_create_guides_command
argument_list|(
name|popup
argument_list|,
name|factory_create_guides_dialog
argument_list|)
expr_stmt|;
name|popup_set_paste_command
argument_list|(
name|popup
argument_list|,
name|factory_paste
argument_list|)
expr_stmt|;
comment|/* Create toolbar */
name|_toolbar
operator|=
name|make_toolbar
argument_list|(
name|main_vbox
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
name|toolbar_set_open_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_file_open_dialog
argument_list|)
expr_stmt|;
name|toolbar_set_save_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_save
argument_list|)
expr_stmt|;
name|toolbar_set_preferences_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_preferences_dialog
argument_list|)
expr_stmt|;
name|toolbar_set_undo_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_undo
argument_list|)
expr_stmt|;
name|toolbar_set_redo_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_redo
argument_list|)
expr_stmt|;
name|toolbar_set_cut_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_cut
argument_list|)
expr_stmt|;
name|toolbar_set_copy_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_copy
argument_list|)
expr_stmt|;
name|toolbar_set_paste_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_paste
argument_list|)
expr_stmt|;
name|toolbar_set_zoom_in_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_zoom_in
argument_list|)
expr_stmt|;
name|toolbar_set_zoom_out_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_zoom_out
argument_list|)
expr_stmt|;
name|toolbar_set_edit_map_info_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_settings_dialog
argument_list|)
expr_stmt|;
name|toolbar_set_move_to_front_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_move_to_front
argument_list|)
expr_stmt|;
name|toolbar_set_send_to_back_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_send_to_back
argument_list|)
expr_stmt|;
name|toolbar_set_grid_command
argument_list|(
name|_toolbar
argument_list|,
name|factory_toolbar_grid
argument_list|)
expr_stmt|;
comment|/*  Dialog area  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|tools
operator|=
name|make_tools
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
name|selection_set_delete_command
argument_list|(
name|tools
argument_list|,
name|factory_clear
argument_list|)
expr_stmt|;
name|selection_set_edit_command
argument_list|(
name|tools
argument_list|,
name|factory_edit
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|tools
operator|->
name|container
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|_preview
operator|=
name|make_preview
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|add_preview_motion_event
argument_list|(
name|_preview
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|preview_move
argument_list|)
expr_stmt|;
name|add_enter_notify_event
argument_list|(
name|_preview
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|preview_enter
argument_list|)
expr_stmt|;
name|add_leave_notify_event
argument_list|(
name|_preview
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|preview_leave
argument_list|)
expr_stmt|;
name|add_preview_button_press_event
argument_list|(
name|_preview
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|button_press
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|_preview
operator|->
name|window
argument_list|)
expr_stmt|;
name|object_list_add_geometry_cb
argument_list|(
name|_shapes
argument_list|,
name|geometry_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_update_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_add_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_remove_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_move_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_select_cb
argument_list|(
name|_shapes
argument_list|,
name|data_selected
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Selection */
name|_selection
operator|=
name|make_selection
argument_list|(
name|dlg
argument_list|,
name|_shapes
argument_list|)
expr_stmt|;
name|selection_set_move_up_command
argument_list|(
name|_selection
argument_list|,
name|factory_move_up
argument_list|)
expr_stmt|;
name|selection_set_move_down_command
argument_list|(
name|_selection
argument_list|,
name|factory_move_down
argument_list|)
expr_stmt|;
name|selection_set_delete_command
argument_list|(
name|_selection
argument_list|,
name|factory_clear
argument_list|)
expr_stmt|;
name|selection_set_edit_command
argument_list|(
name|_selection
argument_list|,
name|factory_edit
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|_selection
operator|->
name|container
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|_statusbar
operator|=
name|make_statusbar
argument_list|(
name|main_vbox
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
name|statusbar_set_zoom
argument_list|(
name|_statusbar
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|clear_map_info
argument_list|()
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
name|_mru
operator|=
name|mru_create
argument_list|()
expr_stmt|;
name|init_preferences
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|mru_empty
argument_list|(
name|_mru
argument_list|)
condition|)
name|menu_build_mru_items
argument_list|(
name|_mru
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
return|return
name|run_flag
return|;
block|}
end_function

end_unit

