begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * This is a plug-in for GIMP.  *  * Generates clickable image maps.  *  * Copyright (C) 1998-2006 Maurits Rijk  m.rijk@chello.nl  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<https://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<glib/gstdio.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_comment
comment|/* for keyboard values */
end_comment

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"imap_about.h"
end_include

begin_include
include|#
directive|include
file|"imap_circle.h"
end_include

begin_include
include|#
directive|include
file|"imap_commands.h"
end_include

begin_include
include|#
directive|include
file|"imap_default_dialog.h"
end_include

begin_include
include|#
directive|include
file|"imap_edit_area_info.h"
end_include

begin_include
include|#
directive|include
file|"imap_file.h"
end_include

begin_include
include|#
directive|include
file|"imap_main.h"
end_include

begin_include
include|#
directive|include
file|"imap_menu.h"
end_include

begin_include
include|#
directive|include
file|"imap_misc.h"
end_include

begin_include
include|#
directive|include
file|"imap_object.h"
end_include

begin_include
include|#
directive|include
file|"imap_polygon.h"
end_include

begin_include
include|#
directive|include
file|"imap_preview.h"
end_include

begin_include
include|#
directive|include
file|"imap_rectangle.h"
end_include

begin_include
include|#
directive|include
file|"imap_selection.h"
end_include

begin_include
include|#
directive|include
file|"imap_settings.h"
end_include

begin_include
include|#
directive|include
file|"imap_source.h"
end_include

begin_include
include|#
directive|include
file|"imap_statusbar.h"
end_include

begin_include
include|#
directive|include
file|"imap_stock.h"
end_include

begin_include
include|#
directive|include
file|"imap_string.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|MAX_ZOOM_FACTOR
define|#
directive|define
name|MAX_ZOOM_FACTOR
value|8
end_define

begin_define
DECL|macro|ZOOMED (x)
define|#
directive|define
name|ZOOMED
parameter_list|(
name|x
parameter_list|)
value|(_zoom_factor * (x))
end_define

begin_define
DECL|macro|GET_REAL_COORD (x)
define|#
directive|define
name|GET_REAL_COORD
parameter_list|(
name|x
parameter_list|)
value|((x) / _zoom_factor)
end_define

begin_function_decl
specifier|static
name|gint
name|zoom_in
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|zoom_out
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Global variables */
end_comment

begin_decl_stmt
DECL|variable|_map_info
specifier|static
name|MapInfo_t
name|_map_info
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_preferences
specifier|static
name|PreferencesData_t
name|_preferences
init|=
block|{
name|CSIM
block|,
name|TRUE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|DEFAULT_UNDO_LEVELS
block|,
name|DEFAULT_MRU_SIZE
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_mru
specifier|static
name|MRU_t
modifier|*
name|_mru
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_drawable_id
specifier|static
name|gint32
name|_drawable_id
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_cursor
specifier|static
name|GdkCursorType
name|_cursor
init|=
name|GDK_TOP_LEFT_ARROW
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_show_url
specifier|static
name|gboolean
name|_show_url
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_filename
specifier|static
name|gchar
modifier|*
name|_filename
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_image_name
specifier|static
name|gchar
modifier|*
name|_image_name
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_image_width
specifier|static
name|gint
name|_image_width
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_image_height
specifier|static
name|gint
name|_image_height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_dlg
specifier|static
name|GtkWidget
modifier|*
name|_dlg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_preview
specifier|static
name|Preview_t
modifier|*
name|_preview
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_selection
specifier|static
name|Selection_t
modifier|*
name|_selection
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_statusbar
specifier|static
name|StatusBar_t
modifier|*
name|_statusbar
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_shapes
specifier|static
name|ObjectList_t
modifier|*
name|_shapes
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_zoom_factor
specifier|static
name|gint
name|_zoom_factor
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_function_decl
DECL|variable|_button_press_func
specifier|static
name|gboolean
function_decl|(
modifier|*
name|_button_press_func
function_decl|)
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|_button_press_param
specifier|static
name|gpointer
name|_button_press_param
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Declare local functions. */
end_comment

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|dialog
parameter_list|(
name|gint32
name|drawable_id
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
specifier|const
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc */
name|NULL
block|,
comment|/* quit_proc */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|run_flag
specifier|static
name|int
name|run_flag
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
specifier|const
name|GimpParamDef
name|args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode { RUN-INTERACTIVE (0) }"
block|}
block|,
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Input image (unused)"
block|}
block|,
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|,    }
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
modifier|*
name|return_vals
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|nreturn_vals
init|=
literal|0
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|N_
argument_list|(
literal|"Create a clickable imagemap"
argument_list|)
argument_list|,
literal|""
argument_list|,
literal|"Maurits Rijk"
argument_list|,
literal|"Maurits Rijk"
argument_list|,
literal|"1998-2005"
argument_list|,
name|N_
argument_list|(
literal|"_Image Map..."
argument_list|)
argument_list|,
literal|"RGB*, GRAY*, INDEXED*"
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|args
argument_list|)
argument_list|,
name|nreturn_vals
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
name|gimp_plugin_menu_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
literal|"<Image>/Filters/Web"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (const gchar * name,gint n_params,const GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|n_params
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GimpParam
name|values
index|[
literal|1
index|]
decl_stmt|;
name|GimpRunMode
name|run_mode
decl_stmt|;
name|gint32
name|drawable_id
decl_stmt|;
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
name|gegl_init
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|drawable_id
operator|=
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
expr_stmt|;
name|_drawable_id
operator|=
name|drawable_id
expr_stmt|;
name|_image_name
operator|=
name|gimp_image_get_name
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
argument_list|)
expr_stmt|;
name|_image_width
operator|=
name|gimp_image_width
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
argument_list|)
expr_stmt|;
name|_image_height
operator|=
name|gimp_image_height
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
argument_list|)
expr_stmt|;
name|_map_info
operator|.
name|color
operator|=
name|gimp_drawable_is_rgb
argument_list|(
name|drawable_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|run_mode
operator|==
name|GIMP_RUN_INTERACTIVE
condition|)
block|{
if|if
condition|(
operator|!
name|dialog
argument_list|(
name|drawable_id
argument_list|)
condition|)
block|{
comment|/* The dialog was closed, or something similarly evil happened. */
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|get_dialog (void)
name|get_dialog
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_dlg
return|;
block|}
end_function

begin_function
name|MRU_t
modifier|*
DECL|function|get_mru (void)
name|get_mru
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
operator|!
name|_mru
condition|)
name|_mru
operator|=
name|mru_create
argument_list|()
expr_stmt|;
return|return
name|_mru
return|;
block|}
end_function

begin_function
name|MapInfo_t
modifier|*
DECL|function|get_map_info (void)
name|get_map_info
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|&
name|_map_info
return|;
block|}
end_function

begin_function
name|PreferencesData_t
modifier|*
DECL|function|get_preferences (void)
name|get_preferences
parameter_list|(
name|void
parameter_list|)
block|{
return|return
operator|&
name|_preferences
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|init_preferences (void)
name|init_preferences
parameter_list|(
name|void
parameter_list|)
block|{
name|ColorSelData_t
modifier|*
name|colors
init|=
operator|&
name|_preferences
operator|.
name|colors
decl_stmt|;
name|colors
operator|->
name|normal_fg
operator|.
name|red
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_fg
operator|.
name|green
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|normal_fg
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_bg
operator|.
name|red
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_bg
operator|.
name|green
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|normal_bg
operator|.
name|blue
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|selected_fg
operator|.
name|red
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|selected_fg
operator|.
name|green
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_fg
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_bg
operator|.
name|red
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_bg
operator|.
name|green
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|selected_bg
operator|.
name|blue
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|interactive_fg
operator|.
name|red
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|interactive_fg
operator|.
name|green
operator|=
literal|0
expr_stmt|;
name|colors
operator|->
name|interactive_fg
operator|.
name|blue
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|interactive_bg
operator|.
name|red
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|interactive_bg
operator|.
name|green
operator|=
literal|0xFFFF
expr_stmt|;
name|colors
operator|->
name|interactive_bg
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|preferences_load
argument_list|(
operator|&
name|_preferences
argument_list|)
expr_stmt|;
name|mru_set_size
argument_list|(
name|_mru
argument_list|,
name|_preferences
operator|.
name|mru_size
argument_list|)
expr_stmt|;
name|command_list_set_undo_level
argument_list|(
name|_preferences
operator|.
name|undo_levels
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gint
DECL|function|get_image_width (void)
name|get_image_width
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_image_width
return|;
block|}
end_function

begin_function
name|gint
DECL|function|get_image_height (void)
name|get_image_height
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_image_height
return|;
block|}
end_function

begin_function
name|void
DECL|function|set_busy_cursor (void)
name|set_busy_cursor
parameter_list|(
name|void
parameter_list|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|GDK_WATCH
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|remove_busy_cursor (void)
name|remove_busy_cursor
parameter_list|(
name|void
parameter_list|)
block|{
name|gdk_window_set_cursor
argument_list|(
name|gtk_widget_get_window
argument_list|(
name|_dlg
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|zoom_in (void)
name|zoom_in
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|_zoom_factor
operator|<
name|MAX_ZOOM_FACTOR
condition|)
block|{
name|set_zoom
argument_list|(
name|_zoom_factor
operator|+
literal|1
argument_list|)
expr_stmt|;
name|menu_set_zoom
argument_list|(
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
return|return
name|_zoom_factor
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|zoom_out (void)
name|zoom_out
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|_zoom_factor
operator|>
literal|1
condition|)
block|{
name|set_zoom
argument_list|(
name|_zoom_factor
operator|-
literal|1
argument_list|)
expr_stmt|;
name|menu_set_zoom
argument_list|(
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
return|return
name|_zoom_factor
return|;
block|}
end_function

begin_function
name|void
DECL|function|set_zoom (gint zoom_factor)
name|set_zoom
parameter_list|(
name|gint
name|zoom_factor
parameter_list|)
block|{
name|set_busy_cursor
argument_list|()
expr_stmt|;
name|_zoom_factor
operator|=
name|zoom_factor
expr_stmt|;
name|preview_zoom
argument_list|(
name|_preview
argument_list|,
name|zoom_factor
argument_list|)
expr_stmt|;
name|statusbar_set_zoom
argument_list|(
name|_statusbar
argument_list|,
name|zoom_factor
argument_list|)
expr_stmt|;
name|remove_busy_cursor
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|gint
DECL|function|get_real_coord (gint coord)
name|get_real_coord
parameter_list|(
name|gint
name|coord
parameter_list|)
block|{
return|return
name|GET_REAL_COORD
argument_list|(
name|coord
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|draw_line (cairo_t * cr,gint x1,gint y1,gint x2,gint y2)
name|draw_line
parameter_list|(
name|cairo_t
modifier|*
name|cr
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gint
name|y1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gint
name|y2
parameter_list|)
block|{
name|cairo_move_to
argument_list|(
name|cr
argument_list|,
name|ZOOMED
argument_list|(
name|x1
argument_list|)
operator|+
literal|.5
argument_list|,
name|ZOOMED
argument_list|(
name|y1
argument_list|)
operator|+
literal|.5
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|ZOOMED
argument_list|(
name|x2
argument_list|)
operator|+
literal|.5
argument_list|,
name|ZOOMED
argument_list|(
name|y2
argument_list|)
operator|+
literal|.5
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_rectangle (cairo_t * cr,gboolean filled,gint x,gint y,gint width,gint height)
name|draw_rectangle
parameter_list|(
name|cairo_t
modifier|*
name|cr
parameter_list|,
name|gboolean
name|filled
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|cairo_rectangle
argument_list|(
name|cr
argument_list|,
name|ZOOMED
argument_list|(
name|x
argument_list|)
operator|+
operator|(
name|filled
condition|?
literal|0.
else|:
literal|.5
operator|)
argument_list|,
name|ZOOMED
argument_list|(
name|y
argument_list|)
operator|+
operator|(
name|filled
condition|?
literal|0.
else|:
literal|.5
operator|)
argument_list|,
name|ZOOMED
argument_list|(
name|width
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|height
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|filled
condition|)
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
else|else
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_circle (cairo_t * cr,gint x,gint y,gint r)
name|draw_circle
parameter_list|(
name|cairo_t
modifier|*
name|cr
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|r
parameter_list|)
block|{
name|cairo_arc
argument_list|(
name|cr
argument_list|,
name|ZOOMED
argument_list|(
name|x
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|y
argument_list|)
argument_list|,
name|ZOOMED
argument_list|(
name|r
argument_list|)
argument_list|,
literal|0.
argument_list|,
literal|2
operator|*
name|G_PI
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_polygon (cairo_t * cr,GList * list)
name|draw_polygon
parameter_list|(
name|cairo_t
modifier|*
name|cr
parameter_list|,
name|GList
modifier|*
name|list
parameter_list|)
block|{
name|GList
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|p
operator|=
name|list
init|;
name|p
condition|;
name|p
operator|=
name|p
operator|->
name|next
control|)
block|{
name|GdkPoint
modifier|*
name|src
init|=
operator|(
name|GdkPoint
operator|*
operator|)
name|p
operator|->
name|data
decl_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|ZOOMED
argument_list|(
name|src
operator|->
name|x
argument_list|)
operator|+
literal|.5
argument_list|,
name|ZOOMED
argument_list|(
name|src
operator|->
name|y
argument_list|)
operator|+
literal|.5
argument_list|)
expr_stmt|;
block|}
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|set_preview_color (GtkRadioAction * action,GtkRadioAction * current,gpointer user_data)
name|set_preview_color
parameter_list|(
name|GtkRadioAction
modifier|*
name|action
parameter_list|,
name|GtkRadioAction
modifier|*
name|current
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|_map_info
operator|.
name|show_gray
operator|=
operator|(
name|gtk_radio_action_get_current_value
argument_list|(
name|current
argument_list|)
operator|==
literal|1
operator|)
expr_stmt|;
name|set_zoom
argument_list|(
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|preview_redraw (void)
name|preview_redraw
parameter_list|(
name|void
parameter_list|)
block|{
name|gtk_widget_queue_draw
argument_list|(
name|_preview
operator|->
name|preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|set_zoom_factor (GtkRadioAction * action,GtkRadioAction * current,gpointer user_data)
name|set_zoom_factor
parameter_list|(
name|GtkRadioAction
modifier|*
name|action
parameter_list|,
name|GtkRadioAction
modifier|*
name|current
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|gint
name|factor
init|=
name|gtk_radio_action_get_current_value
argument_list|(
name|current
argument_list|)
decl_stmt|;
name|set_zoom
argument_list|(
name|factor
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|const
name|gchar
modifier|*
DECL|function|get_image_name (void)
name|get_image_name
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_image_name
return|;
block|}
end_function

begin_function
specifier|const
name|char
modifier|*
DECL|function|get_filename (void)
name|get_filename
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_filename
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|arrow_on_button_press (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|arrow_on_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|gdk_event_triggers_context_menu
argument_list|(
operator|(
name|GdkEvent
operator|*
operator|)
name|event
argument_list|)
condition|)
block|{
name|do_popup_menu
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|event
operator|->
name|button
operator|==
literal|1
condition|)
block|{
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|GDK_2BUTTON_PRESS
condition|)
name|edit_shape
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|x
argument_list|,
operator|(
name|gint
operator|)
name|event
operator|->
name|y
argument_list|)
expr_stmt|;
else|else
name|select_shape
argument_list|(
name|widget
argument_list|,
name|event
argument_list|)
expr_stmt|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_arrow_func (void)
name|set_arrow_func
parameter_list|(
name|void
parameter_list|)
block|{
name|_button_press_func
operator|=
name|arrow_on_button_press
expr_stmt|;
name|_cursor
operator|=
name|GDK_TOP_LEFT_ARROW
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_object_func (gboolean (* func)(GtkWidget *,GdkEventButton *,gpointer),gpointer param)
name|set_object_func
parameter_list|(
name|gboolean
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
parameter_list|,
name|gpointer
name|param
parameter_list|)
block|{
name|_button_press_func
operator|=
name|func
expr_stmt|;
name|_button_press_param
operator|=
name|param
expr_stmt|;
name|_cursor
operator|=
name|GDK_CROSSHAIR
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|set_func (GtkRadioAction * action,GtkRadioAction * current,gpointer user_data)
name|set_func
parameter_list|(
name|GtkRadioAction
modifier|*
name|action
parameter_list|,
name|GtkRadioAction
modifier|*
name|current
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|gint
name|value
init|=
name|gtk_radio_action_get_current_value
argument_list|(
name|current
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|value
condition|)
block|{
case|case
literal|0
case|:
name|set_arrow_func
argument_list|()
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|set_object_func
argument_list|(
name|object_on_button_press
argument_list|,
name|get_rectangle_factory
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|set_object_func
argument_list|(
name|object_on_button_press
argument_list|,
name|get_circle_factory
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|set_object_func
argument_list|(
name|object_on_button_press
argument_list|,
name|get_polygon_factory
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
name|void
DECL|function|add_shape (Object_t * obj)
name|add_shape
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|)
block|{
name|object_list_append
argument_list|(
name|_shapes
argument_list|,
name|obj
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|ObjectList_t
modifier|*
DECL|function|get_shapes (void)
name|get_shapes
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|_shapes
return|;
block|}
end_function

begin_function
name|void
DECL|function|update_shape (Object_t * obj)
name|update_shape
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|)
block|{
name|object_list_update
argument_list|(
name|_shapes
argument_list|,
name|obj
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_edit_selected_shape (void)
name|do_edit_selected_shape
parameter_list|(
name|void
parameter_list|)
block|{
name|object_list_edit_selected
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_popup_menu (GdkEventButton * event)
name|do_popup_menu
parameter_list|(
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|gint
name|x
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|x
argument_list|)
decl_stmt|;
name|gint
name|y
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|y
argument_list|)
decl_stmt|;
name|Object_t
modifier|*
name|obj
init|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
decl_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
name|obj
operator|->
name|class
operator|->
name|do_popup
argument_list|(
name|obj
argument_list|,
name|event
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|do_main_popup_menu
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_all_sensitivities (void)
name|set_all_sensitivities
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|count
init|=
name|object_list_nr_selected
argument_list|(
name|_shapes
argument_list|)
decl_stmt|;
name|menu_shapes_selected
argument_list|(
name|count
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|main_set_title (const char * filename)
name|main_set_title
parameter_list|(
specifier|const
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|char
modifier|*
name|title
decl_stmt|,
modifier|*
name|p
decl_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_filename
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|p
operator|=
name|filename
condition|?
name|g_filename_display_basename
argument_list|(
name|filename
argument_list|)
else|:
operator|(
name|gchar
operator|*
operator|)
name|_
argument_list|(
literal|"<Untitled>"
argument_list|)
expr_stmt|;
name|title
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s - Image Map"
argument_list|,
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|filename
condition|)
name|g_free
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|_dlg
argument_list|)
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|title
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|main_set_dimension (gint width,gint height)
name|main_set_dimension
parameter_list|(
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|statusbar_set_dimension
argument_list|(
name|_statusbar
argument_list|,
name|width
operator|/
name|_zoom_factor
argument_list|,
name|height
operator|/
name|_zoom_factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|main_clear_dimension (void)
name|main_clear_dimension
parameter_list|(
name|void
parameter_list|)
block|{
name|statusbar_clear_dimension
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|show_url (void)
name|show_url
parameter_list|(
name|void
parameter_list|)
block|{
name|_show_url
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|hide_url (void)
name|hide_url
parameter_list|(
name|void
parameter_list|)
block|{
name|_show_url
operator|=
name|FALSE
expr_stmt|;
name|statusbar_clear_status
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|select_shape (GtkWidget * widget,GdkEventButton * event)
name|select_shape
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|Object_t
modifier|*
name|obj
decl_stmt|;
name|gint
name|x
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|x
argument_list|)
decl_stmt|;
name|gint
name|y
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|y
argument_list|)
decl_stmt|;
name|MoveSashFunc_t
name|sash_func
decl_stmt|;
name|obj
operator|=
name|object_list_near_sash
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|sash_func
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
comment|/* Start resizing */
name|Command_t
modifier|*
name|command
init|=
name|move_sash_command_new
argument_list|(
name|widget
argument_list|,
name|obj
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|sash_func
argument_list|)
decl_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Command_t
modifier|*
name|command
decl_stmt|;
name|obj
operator|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
if|if
condition|(
name|event
operator|->
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
if|if
condition|(
name|obj
operator|->
name|selected
condition|)
name|command
operator|=
name|unselect_command_new
argument_list|(
name|obj
argument_list|)
expr_stmt|;
else|else
name|command
operator|=
name|select_command_new
argument_list|(
name|obj
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* No Shift key pressed */
if|if
condition|(
name|obj
operator|->
name|selected
condition|)
block|{
name|command
operator|=
name|unselect_all_command_new
argument_list|(
name|_shapes
argument_list|,
name|obj
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Command_t
modifier|*
name|sub_command
decl_stmt|;
name|command
operator|=
name|subcommand_start
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|sub_command
operator|=
name|unselect_all_command_new
argument_list|(
name|_shapes
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|command_add_subcommand
argument_list|(
name|command
argument_list|,
name|sub_command
argument_list|)
expr_stmt|;
name|sub_command
operator|=
name|select_command_new
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|command_add_subcommand
argument_list|(
name|command
argument_list|,
name|sub_command
argument_list|)
expr_stmt|;
name|command_set_name
argument_list|(
name|command
argument_list|,
name|sub_command
operator|->
name|name
argument_list|)
expr_stmt|;
name|subcommand_end
argument_list|()
expr_stmt|;
block|}
block|}
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
name|command
operator|=
name|move_command_new
argument_list|(
name|_preview
argument_list|,
name|obj
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* Start selection rectangle */
name|command
operator|=
name|select_region_command_new
argument_list|(
name|widget
argument_list|,
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|edit_shape (gint x,gint y)
name|edit_shape
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|Object_t
modifier|*
name|obj
decl_stmt|;
name|x
operator|=
name|GET_REAL_COORD
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|y
operator|=
name|GET_REAL_COORD
argument_list|(
name|y
argument_list|)
expr_stmt|;
name|obj
operator|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
condition|)
block|{
name|object_select
argument_list|(
name|obj
argument_list|)
expr_stmt|;
name|object_edit
argument_list|(
name|obj
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|do_zoom_in (void)
name|do_zoom_in
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|factor
init|=
name|zoom_in
argument_list|()
decl_stmt|;
name|menu_set_zoom_sensitivity
argument_list|(
name|factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_zoom_out (void)
name|do_zoom_out
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|factor
init|=
name|zoom_out
argument_list|()
decl_stmt|;
name|menu_set_zoom_sensitivity
argument_list|(
name|factor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|draw_shapes (cairo_t * cr)
name|draw_shapes
parameter_list|(
name|cairo_t
modifier|*
name|cr
parameter_list|)
block|{
name|object_list_draw
argument_list|(
name|_shapes
argument_list|,
name|cr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|clear_map_info (void)
name|clear_map_info
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|author
init|=
name|g_get_real_name
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
operator|*
name|author
condition|)
name|author
operator|=
name|g_get_user_name
argument_list|()
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|image_name
argument_list|,
name|_image_name
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|title
argument_list|,
literal|"map"
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|author
argument_list|,
name|author
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|default_url
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|_map_info
operator|.
name|description
argument_list|,
literal|""
argument_list|)
expr_stmt|;
name|_map_info
operator|.
name|map_format
operator|=
name|_preferences
operator|.
name|default_map_type
expr_stmt|;
name|_map_info
operator|.
name|show_gray
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_data_changed_dialog (void (* continue_cb)(gpointer),gpointer param)
name|do_data_changed_dialog
parameter_list|(
name|void
function_decl|(
modifier|*
name|continue_cb
function_decl|)
parameter_list|(
name|gpointer
parameter_list|)
parameter_list|,
name|gpointer
name|param
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
init|=
name|gtk_message_dialog_new
argument_list|(
name|NULL
argument_list|,
name|GTK_DIALOG_DESTROY_WITH_PARENT
argument_list|,
name|GTK_MESSAGE_QUESTION
argument_list|,
name|GTK_BUTTONS_YES_NO
argument_list|,
name|_
argument_list|(
literal|"Some data has been changed!"
argument_list|)
argument_list|)
decl_stmt|;
name|gtk_message_dialog_format_secondary_text
argument_list|(
name|GTK_MESSAGE_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Do you really want to discard your changes?"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtk_dialog_run
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_YES
condition|)
name|continue_cb
argument_list|(
name|param
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|check_if_changed (void (* func)(gpointer),gpointer param)
name|check_if_changed
parameter_list|(
name|void
function_decl|(
modifier|*
name|func
function_decl|)
parameter_list|(
name|gpointer
parameter_list|)
parameter_list|,
name|gpointer
name|param
parameter_list|)
block|{
if|if
condition|(
name|object_list_get_changed
argument_list|(
name|_shapes
argument_list|)
condition|)
name|do_data_changed_dialog
argument_list|(
name|func
argument_list|,
name|param
argument_list|)
expr_stmt|;
else|else
name|func
argument_list|(
name|param
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|close_current (void)
name|close_current
parameter_list|(
name|void
parameter_list|)
block|{
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|object_list_remove_all
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|clear_map_info
argument_list|()
expr_stmt|;
name|main_set_title
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|set_all_sensitivities
argument_list|()
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
name|object_list_clear_changed
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|command_list_remove_all
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_close (gpointer data)
name|really_close
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|close_current
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_close (void)
name|do_close
parameter_list|(
name|void
parameter_list|)
block|{
name|check_if_changed
argument_list|(
name|really_close
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_quit (gpointer data)
name|really_quit
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|preferences_save
argument_list|(
operator|&
name|_preferences
argument_list|)
expr_stmt|;
name|run_flag
operator|=
literal|1
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|_dlg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_quit (void)
name|do_quit
parameter_list|(
name|void
parameter_list|)
block|{
name|check_if_changed
argument_list|(
name|really_quit
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_undo (void)
name|do_undo
parameter_list|(
name|void
parameter_list|)
block|{
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|last_command_undo
argument_list|()
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_redo (void)
name|do_redo
parameter_list|(
name|void
parameter_list|)
block|{
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|last_command_redo
argument_list|()
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|save (void)
name|save
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|_filename
condition|)
name|save_as
argument_list|(
name|_filename
argument_list|)
expr_stmt|;
else|else
name|do_file_save_as_dialog
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|write_cern_comment (gpointer param,OutputFunc_t output)
name|write_cern_comment
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|output
argument_list|(
name|param
argument_list|,
literal|"rect (4096,4096) (4096,4096) imap:#$"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_as_cern (gpointer param,OutputFunc_t output)
name|save_as_cern
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|gchar
modifier|*
name|description
decl_stmt|;
name|gchar
modifier|*
name|next_token
decl_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"-:Image map file created by GIMP Image Map plug-in\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"-:GIMP Image Map plug-in by Maurits Rijk\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"-:Please do not edit lines starting with \"#$\"\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"VERSION:2.3\n"
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"TITLE:%s\n"
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"AUTHOR:%s\n"
argument_list|,
name|_map_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"FORMAT:cern\n"
argument_list|)
expr_stmt|;
name|description
operator|=
name|g_strdup
argument_list|(
name|_map_info
operator|.
name|description
argument_list|)
expr_stmt|;
name|next_token
operator|=
name|description
expr_stmt|;
for|for
control|(
name|p
operator|=
name|strtok
argument_list|(
name|next_token
argument_list|,
literal|"\n"
argument_list|)
init|;
name|p
condition|;
name|p
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|"\n"
argument_list|)
control|)
block|{
name|write_cern_comment
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"DESCRIPTION:%s\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|description
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|_map_info
operator|.
name|default_url
condition|)
name|output
argument_list|(
name|param
argument_list|,
literal|"default %s\n"
argument_list|,
name|_map_info
operator|.
name|default_url
argument_list|)
expr_stmt|;
name|object_list_write_cern
argument_list|(
name|_shapes
argument_list|,
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_as_csim (gpointer param,OutputFunc_t output)
name|save_as_csim
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|gchar
modifier|*
name|description
decl_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<img src=\"%s\" width=\"%d\" height=\"%d\" border=\"0\" "
literal|"usemap=\"#%s\" />\n\n"
argument_list|,
name|_map_info
operator|.
name|image_name
argument_list|,
name|_image_width
argument_list|,
name|_image_height
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<map name=\"%s\">\n"
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$-:Image map file created by GIMP Image Map plug-in -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$-:GIMP Image Map plug-in by Maurits Rijk -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$-:Please do not edit lines starting with \"#$\" -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$VERSION:2.3 -->\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$AUTHOR:%s -->\n"
argument_list|,
name|_map_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|description
operator|=
name|g_strdup
argument_list|(
name|_map_info
operator|.
name|description
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|strtok
argument_list|(
name|description
argument_list|,
literal|"\n"
argument_list|)
init|;
name|p
condition|;
name|p
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|"\n"
argument_list|)
control|)
name|output
argument_list|(
name|param
argument_list|,
literal|"<!-- #$DESCRIPTION:%s -->\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|description
argument_list|)
expr_stmt|;
name|object_list_write_csim
argument_list|(
name|_shapes
argument_list|,
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|_map_info
operator|.
name|default_url
condition|)
name|output
argument_list|(
name|param
argument_list|,
literal|"<area shape=\"default\" href=\"%s\" />\n"
argument_list|,
name|_map_info
operator|.
name|default_url
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"</map>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_as_ncsa (gpointer param,OutputFunc_t output)
name|save_as_ncsa
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
name|char
modifier|*
name|p
decl_stmt|;
name|gchar
modifier|*
name|description
decl_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$-:Image map file created by GIMP Image Map plug-in\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$-:GIMP Image Map plug-in by Maurits Rijk\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$-:Please do not edit lines starting with \"#$\"\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$VERSION:2.3\n"
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$TITLE:%s\n"
argument_list|,
name|_map_info
operator|.
name|title
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$AUTHOR:%s\n"
argument_list|,
name|_map_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|output
argument_list|(
name|param
argument_list|,
literal|"#$FORMAT:ncsa\n"
argument_list|)
expr_stmt|;
name|description
operator|=
name|g_strdup
argument_list|(
name|_map_info
operator|.
name|description
argument_list|)
expr_stmt|;
for|for
control|(
name|p
operator|=
name|strtok
argument_list|(
name|description
argument_list|,
literal|"\n"
argument_list|)
init|;
name|p
condition|;
name|p
operator|=
name|strtok
argument_list|(
name|NULL
argument_list|,
literal|"\n"
argument_list|)
control|)
name|output
argument_list|(
name|param
argument_list|,
literal|"#$DESCRIPTION:%s\n"
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|description
argument_list|)
expr_stmt|;
if|if
condition|(
operator|*
name|_map_info
operator|.
name|default_url
condition|)
name|output
argument_list|(
name|param
argument_list|,
literal|"default %s\n"
argument_list|,
name|_map_info
operator|.
name|default_url
argument_list|)
expr_stmt|;
name|object_list_write_ncsa
argument_list|(
name|_shapes
argument_list|,
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
block|}
end_function

begin_function_decl
specifier|static
name|void
name|save_to_file
parameter_list|(
name|gpointer
name|param
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
function_decl|G_GNUC_PRINTF
parameter_list|(
function_decl|2
operator|,
function_decl|3
end_function_decl

begin_empty_stmt
unit|)
empty_stmt|;
end_empty_stmt

begin_function
specifier|static
name|void
DECL|function|save_to_file (gpointer param,const char * format,...)
name|save_to_file
parameter_list|(
name|gpointer
name|param
parameter_list|,
specifier|const
name|char
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|ap
decl_stmt|;
name|va_start
argument_list|(
name|ap
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|vfprintf
argument_list|(
operator|(
name|FILE
operator|*
operator|)
name|param
argument_list|,
name|format
argument_list|,
name|ap
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|ap
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|dump_output (gpointer param,OutputFunc_t output)
name|dump_output
parameter_list|(
name|gpointer
name|param
parameter_list|,
name|OutputFunc_t
name|output
parameter_list|)
block|{
if|if
condition|(
name|_map_info
operator|.
name|map_format
operator|==
name|NCSA
condition|)
name|save_as_ncsa
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|_map_info
operator|.
name|map_format
operator|==
name|CERN
condition|)
name|save_as_cern
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|_map_info
operator|.
name|map_format
operator|==
name|CSIM
condition|)
name|save_as_csim
argument_list|(
name|param
argument_list|,
name|output
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|save_as (const gchar * filename)
name|save_as
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
name|FILE
modifier|*
name|out
init|=
name|g_fopen
argument_list|(
name|filename
argument_list|,
literal|"w"
argument_list|)
decl_stmt|;
if|if
condition|(
name|out
condition|)
block|{
name|dump_output
argument_list|(
name|out
argument_list|,
name|save_to_file
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|statusbar_set_status
argument_list|(
name|_statusbar
argument_list|,
name|_
argument_list|(
literal|"File \"%s\" saved."
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|main_set_title
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|object_list_clear_changed
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|do_file_error_dialog
argument_list|(
name|_
argument_list|(
literal|"Couldn't save file:"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_image_size_changed_dialog (void)
name|do_image_size_changed_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
init|=
name|gtk_message_dialog_new_with_markup
argument_list|(
name|NULL
argument_list|,
name|GTK_DIALOG_DESTROY_WITH_PARENT
argument_list|,
name|GTK_MESSAGE_QUESTION
argument_list|,
name|GTK_BUTTONS_YES_NO
argument_list|,
literal|"<span weight=\"bold\" size=\"larger\">%s</span>\n\n%s"
argument_list|,
name|_
argument_list|(
literal|"Image size has changed."
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Resize area's?"
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|gtk_dialog_run
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_YES
condition|)
block|{
name|gint
name|per_x
init|=
name|_image_width
operator|*
literal|100
operator|/
name|_map_info
operator|.
name|old_image_width
decl_stmt|;
name|gint
name|per_y
init|=
name|_image_height
operator|*
literal|100
operator|/
name|_map_info
operator|.
name|old_image_height
decl_stmt|;
name|object_list_resize
argument_list|(
name|_shapes
argument_list|,
name|per_x
argument_list|,
name|per_y
argument_list|)
expr_stmt|;
block|}
name|preview_redraw
argument_list|()
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_load (gpointer data)
name|really_load
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gchar
modifier|*
name|filename
init|=
operator|(
name|gchar
operator|*
operator|)
name|data
decl_stmt|;
name|close_current
argument_list|()
expr_stmt|;
name|selection_freeze
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|_map_info
operator|.
name|old_image_width
operator|=
name|_image_width
expr_stmt|;
name|_map_info
operator|.
name|old_image_height
operator|=
name|_image_height
expr_stmt|;
if|if
condition|(
name|load_csim
argument_list|(
name|filename
argument_list|)
condition|)
block|{
name|_map_info
operator|.
name|map_format
operator|=
name|CSIM
expr_stmt|;
if|if
condition|(
name|_image_width
operator|!=
name|_map_info
operator|.
name|old_image_width
operator|||
name|_image_height
operator|!=
name|_map_info
operator|.
name|old_image_height
condition|)
block|{
name|do_image_size_changed_dialog
argument_list|()
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|load_ncsa
argument_list|(
name|filename
argument_list|)
condition|)
block|{
name|_map_info
operator|.
name|map_format
operator|=
name|NCSA
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|load_cern
argument_list|(
name|filename
argument_list|)
condition|)
block|{
name|_map_info
operator|.
name|map_format
operator|=
name|CERN
expr_stmt|;
block|}
else|else
block|{
name|do_file_error_dialog
argument_list|(
name|_
argument_list|(
literal|"Couldn't read file:"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|close_current
argument_list|()
expr_stmt|;
return|return;
block|}
name|mru_set_first
argument_list|(
name|_mru
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|menu_build_mru_items
argument_list|(
name|_mru
argument_list|)
expr_stmt|;
name|selection_thaw
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
name|main_set_title
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|object_list_clear_changed
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|load (const gchar * filename)
name|load
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
specifier|static
name|gchar
modifier|*
name|tmp_filename
decl_stmt|;
name|g_strreplace
argument_list|(
operator|&
name|tmp_filename
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|check_if_changed
argument_list|(
name|really_load
argument_list|,
operator|(
name|gpointer
operator|)
name|tmp_filename
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|toggle_area_list (void)
name|toggle_area_list
parameter_list|(
name|void
parameter_list|)
block|{
name|selection_toggle_visibility
argument_list|(
name|_selection
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|close_callback (GtkWidget * widget,gpointer data)
name|close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|do_quit
argument_list|()
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|preview_move (GtkWidget * widget,GdkEventMotion * event)
name|preview_move
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventMotion
modifier|*
name|event
parameter_list|)
block|{
name|gint
name|x
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|x
argument_list|)
decl_stmt|;
name|gint
name|y
init|=
name|GET_REAL_COORD
argument_list|(
operator|(
name|gint
operator|)
name|event
operator|->
name|y
argument_list|)
decl_stmt|;
specifier|static
name|Object_t
modifier|*
name|prev_obj
init|=
name|NULL
decl_stmt|;
name|Object_t
modifier|*
name|obj
init|=
name|object_list_find
argument_list|(
name|_shapes
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
decl_stmt|;
name|statusbar_set_xy
argument_list|(
name|_statusbar
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|obj
operator|!=
name|prev_obj
condition|)
block|{
name|prev_obj
operator|=
name|obj
expr_stmt|;
if|if
condition|(
name|obj
operator|&&
name|_show_url
condition|)
block|{
name|statusbar_set_status
argument_list|(
name|_statusbar
argument_list|,
name|_
argument_list|(
literal|"URL: %s"
argument_list|)
argument_list|,
name|obj
operator|->
name|url
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|statusbar_clear_status
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|_NOT_READY_YET_
if|if
condition|(
operator|!
name|obj
condition|)
block|{
if|if
condition|(
name|grid_near_x
argument_list|(
name|x
argument_list|)
condition|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|GDK_SB_H_DOUBLE_ARROW
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|grid_near_y
argument_list|(
name|y
argument_list|)
condition|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|GDK_SB_V_DOUBLE_ARROW
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|_cursor
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_enter (GtkWidget * widget,GdkEventCrossing * event)
name|preview_enter
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventCrossing
modifier|*
name|event
parameter_list|)
block|{
name|preview_set_cursor
argument_list|(
name|_preview
argument_list|,
name|_cursor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_leave (GtkWidget * widget,GdkEventCrossing * event)
name|preview_leave
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventCrossing
modifier|*
name|event
parameter_list|)
block|{
name|gdk_window_set_cursor
argument_list|(
name|gtk_widget_get_window
argument_list|(
name|_dlg
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|statusbar_clear_xy
argument_list|(
name|_statusbar
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|button_press (GtkWidget * widget,GdkEventButton * event,gpointer data)
name|button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|_button_press_func
condition|)
return|return
name|_button_press_func
argument_list|(
name|widget
argument_list|,
name|event
argument_list|,
name|_button_press_param
argument_list|)
return|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* A few global vars for key movement */
end_comment

begin_decl_stmt
DECL|variable|_timeout
specifier|static
name|guint
name|_timeout
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_keyval
specifier|static
name|guint
name|_keyval
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|_dx
DECL|variable|_dy
specifier|static
name|gint
name|_dx
decl_stmt|,
name|_dy
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|move_sash_selected_objects (gint dx,gint dy,gboolean fast)
name|move_sash_selected_objects
parameter_list|(
name|gint
name|dx
parameter_list|,
name|gint
name|dy
parameter_list|,
name|gboolean
name|fast
parameter_list|)
block|{
if|if
condition|(
name|fast
condition|)
block|{
name|dx
operator|*=
literal|5
expr_stmt|;
name|dy
operator|*=
literal|5
expr_stmt|;
block|}
name|object_list_move_sash_selected
argument_list|(
name|_shapes
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|move_selected_objects (gint dx,gint dy,gboolean fast)
name|move_selected_objects
parameter_list|(
name|gint
name|dx
parameter_list|,
name|gint
name|dy
parameter_list|,
name|gboolean
name|fast
parameter_list|)
block|{
if|if
condition|(
name|fast
condition|)
block|{
name|dx
operator|*=
literal|5
expr_stmt|;
name|dy
operator|*=
literal|5
expr_stmt|;
block|}
name|_dx
operator|+=
name|dx
expr_stmt|;
name|_dy
operator|+=
name|dy
expr_stmt|;
name|object_list_move_selected
argument_list|(
name|_shapes
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|key_timeout_cb (gpointer data)
name|key_timeout_cb
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|_keyval
condition|)
block|{
case|case
name|GDK_KEY_Left
case|:
case|case
name|GDK_KEY_Right
case|:
case|case
name|GDK_KEY_Up
case|:
case|case
name|GDK_KEY_Down
case|:
name|command_list_add
argument_list|(
name|move_selected_command_new
argument_list|(
name|_shapes
argument_list|,
name|_dx
argument_list|,
name|_dy
argument_list|)
argument_list|)
expr_stmt|;
name|_dx
operator|=
name|_dy
operator|=
literal|0
expr_stmt|;
break|break;
block|}
name|preview_redraw
argument_list|()
expr_stmt|;
name|_timeout
operator|=
literal|0
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|key_press_cb (GtkWidget * widget,GdkEventKey * event)
name|key_press_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|)
block|{
name|gboolean
name|handled
init|=
name|FALSE
decl_stmt|;
name|gboolean
name|shift
init|=
name|event
operator|->
name|state
operator|&
name|GDK_SHIFT_MASK
decl_stmt|;
name|gboolean
name|ctrl
init|=
name|event
operator|->
name|state
operator|&
name|GDK_CONTROL_MASK
decl_stmt|;
name|Command_t
modifier|*
name|command
decl_stmt|;
if|if
condition|(
name|_timeout
condition|)
name|g_source_remove
argument_list|(
name|_timeout
argument_list|)
expr_stmt|;
name|_timeout
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|keyval
condition|)
block|{
case|case
name|GDK_KEY_Left
case|:
if|if
condition|(
name|ctrl
condition|)
name|move_sash_selected_objects
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
name|shift
argument_list|)
expr_stmt|;
else|else
name|move_selected_objects
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_KEY_Right
case|:
if|if
condition|(
name|ctrl
condition|)
name|move_sash_selected_objects
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
name|shift
argument_list|)
expr_stmt|;
else|else
name|move_selected_objects
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_KEY_Up
case|:
if|if
condition|(
name|ctrl
condition|)
name|move_sash_selected_objects
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|,
name|shift
argument_list|)
expr_stmt|;
else|else
name|move_selected_objects
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_KEY_Down
case|:
if|if
condition|(
name|ctrl
condition|)
name|move_sash_selected_objects
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|shift
argument_list|)
expr_stmt|;
else|else
name|move_selected_objects
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|GDK_KEY_Tab
case|:
if|if
condition|(
name|shift
condition|)
name|command
operator|=
name|select_prev_command_new
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
else|else
name|command
operator|=
name|select_next_command_new
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|command_execute
argument_list|(
name|command
argument_list|)
expr_stmt|;
name|handled
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|handled
condition|)
name|g_signal_stop_emission_by_name
argument_list|(
name|widget
argument_list|,
literal|"key-press-event"
argument_list|)
expr_stmt|;
return|return
name|handled
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|key_release_cb (GtkWidget * widget,GdkEventKey * event)
name|key_release_cb
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|)
block|{
name|_keyval
operator|=
name|event
operator|->
name|keyval
expr_stmt|;
name|_timeout
operator|=
name|g_timeout_add
argument_list|(
literal|250
argument_list|,
name|key_timeout_cb
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|geometry_changed (Object_t * obj,gpointer data)
name|geometry_changed
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|data_changed (Object_t * obj,gpointer data)
name|data_changed
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|preview_redraw
argument_list|()
expr_stmt|;
name|set_all_sensitivities
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|data_selected (Object_t * obj,gpointer data)
name|data_selected
parameter_list|(
name|Object_t
modifier|*
name|obj
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|set_all_sensitivities
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|imap_help (void)
name|imap_help
parameter_list|(
name|void
parameter_list|)
block|{
name|gimp_standard_help_func
argument_list|(
literal|"plug-in-imagemap"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_cut (void)
name|do_cut
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|cut_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_copy (void)
name|do_copy
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|copy_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_paste (void)
name|do_paste
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|paste_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_select_all (void)
name|do_select_all
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|select_all_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_deselect_all (void)
name|do_deselect_all
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|unselect_all_command_new
argument_list|(
name|_shapes
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_clear (void)
name|do_clear
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|clear_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_move_up (void)
name|do_move_up
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* Fix me!    Command_t *command = object_up_command_new(_current_obj->list,                                               _current_obj);    command_execute(command);   */
block|}
end_function

begin_function
name|void
DECL|function|do_move_down (void)
name|do_move_down
parameter_list|(
name|void
parameter_list|)
block|{
comment|/* Fix me!    Command_t *command = object_down_command_new(_current_obj->list,                                                 _current_obj);    command_execute(command);   */
block|}
end_function

begin_function
name|void
DECL|function|do_move_to_front (void)
name|do_move_to_front
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|move_to_front_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_send_to_back (void)
name|do_send_to_back
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|send_to_back_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_use_gimp_guides_dialog (void)
name|do_use_gimp_guides_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|gimp_guides_command_new
argument_list|(
name|_shapes
argument_list|,
name|_drawable_id
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|do_create_guides_dialog (void)
name|do_create_guides_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|command_execute
argument_list|(
name|guides_command_new
argument_list|(
name|_shapes
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_move_up (void)
name|factory_move_up
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|move_up_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|Command_t
modifier|*
DECL|function|factory_move_down (void)
name|factory_move_down
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|move_down_command_new
argument_list|(
name|_shapes
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|dialog (gint32 drawable_id)
name|dialog
parameter_list|(
name|gint32
name|drawable_id
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|tools
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|set_arrow_func
argument_list|()
expr_stmt|;
name|_shapes
operator|=
name|make_object_list
argument_list|()
expr_stmt|;
name|_dlg
operator|=
name|dlg
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_TOPLEVEL
argument_list|)
expr_stmt|;
name|gtk_window_set_resizable
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|main_set_title
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_connect
argument_list|(
name|dlg
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gimp_window_set_transient
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dlg
argument_list|,
literal|"delete-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|close_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dlg
argument_list|,
literal|"key-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|key_press_cb
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dlg
argument_list|,
literal|"key-release-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|key_release_cb
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dlg
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_main_quit
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|main_vbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|main_vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
name|init_stock_icons
argument_list|()
expr_stmt|;
comment|/* Create menu */
name|make_menu
argument_list|(
name|main_vbox
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
comment|/* Create toolbar */
name|make_toolbar
argument_list|(
name|main_vbox
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
comment|/*  Dialog area  */
name|hbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|tools
operator|=
name|make_tools
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
comment|/* selection_set_edit_command(tools, factory_edit); */
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|tools
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|_preview
operator|=
name|make_preview
argument_list|(
name|drawable_id
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|_preview
operator|->
name|preview
argument_list|,
literal|"motion-notify-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_move
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|_preview
operator|->
name|preview
argument_list|,
literal|"enter-notify-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_enter
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|_preview
operator|->
name|preview
argument_list|,
literal|"leave-notify-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_leave
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|_preview
operator|->
name|preview
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|button_press
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|_preview
operator|->
name|window
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|object_list_add_geometry_cb
argument_list|(
name|_shapes
argument_list|,
name|geometry_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_update_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_add_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_remove_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_move_cb
argument_list|(
name|_shapes
argument_list|,
name|data_changed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|object_list_add_select_cb
argument_list|(
name|_shapes
argument_list|,
name|data_selected
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Selection */
name|_selection
operator|=
name|make_selection
argument_list|(
name|_shapes
argument_list|)
expr_stmt|;
name|selection_set_move_up_command
argument_list|(
name|_selection
argument_list|,
name|factory_move_up
argument_list|)
expr_stmt|;
name|selection_set_move_down_command
argument_list|(
name|_selection
argument_list|,
name|factory_move_down
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|_selection
operator|->
name|container
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|_statusbar
operator|=
name|make_statusbar
argument_list|(
name|main_vbox
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
name|statusbar_set_zoom
argument_list|(
name|_statusbar
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
name|_mru
operator|=
name|mru_create
argument_list|()
expr_stmt|;
name|init_preferences
argument_list|()
expr_stmt|;
name|clear_map_info
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|mru_empty
argument_list|(
name|_mru
argument_list|)
condition|)
name|menu_build_mru_items
argument_list|(
name|_mru
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
return|return
name|run_flag
return|;
block|}
end_function

end_unit

