begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/**********************************************************************    GIMP - The GNU Image Manipulation Program    Copyright (C) 1995 Spencer Kimball and Peter Mattis     This program is free software: you can redistribute it and/or modify    it under the terms of the GNU General Public License as published by    the Free Software Foundation; either version 3 of the License, or    (at your option) any later version.     This program is distributed in the hope that it will be useful,    but WITHOUT ANY WARRANTY; without even the implied warranty of    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    GNU General Public License for more details.     You should have received a copy of the GNU General Public License    along with this program.  If not, see<http://www.gnu.org/licenses/>.  *********************************************************************/
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<glib/gstdio.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"fractal-explorer.h"
end_include

begin_include
include|#
directive|include
file|"fractal-explorer-dialogs.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|ZOOM_UNDO_SIZE
define|#
directive|define
name|ZOOM_UNDO_SIZE
value|100
end_define

begin_decl_stmt
DECL|variable|n_gradient_samples
specifier|static
name|gint
name|n_gradient_samples
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gradient_samples
specifier|static
name|gdouble
modifier|*
name|gradient_samples
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gradient_name
specifier|static
name|gchar
modifier|*
name|gradient_name
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|ready_now
specifier|static
name|gboolean
name|ready_now
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tpath
specifier|static
name|gchar
modifier|*
name|tpath
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|elements
specifier|static
name|DialogElements
modifier|*
name|elements
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|cmap_preview
specifier|static
name|GtkWidget
modifier|*
name|cmap_preview
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|maindlg
specifier|static
name|GtkWidget
modifier|*
name|maindlg
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|zooms
specifier|static
name|explorer_vals_t
name|zooms
index|[
name|ZOOM_UNDO_SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|zoomindex
specifier|static
name|gint
name|zoomindex
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|zoommax
specifier|static
name|gint
name|zoommax
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|oldxpos
specifier|static
name|gint
name|oldxpos
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|oldypos
specifier|static
name|gint
name|oldypos
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|x_press
specifier|static
name|gdouble
name|x_press
init|=
operator|-
literal|1.0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|y_press
specifier|static
name|gdouble
name|y_press
init|=
operator|-
literal|1.0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|standardvals
specifier|static
name|explorer_vals_t
name|standardvals
init|=
block|{
literal|0
block|,
operator|-
literal|2.0
block|,
literal|2.0
block|,
operator|-
literal|1.5
block|,
literal|1.5
block|,
literal|50.0
block|,
operator|-
literal|0.75
block|,
operator|-
literal|0.2
block|,
literal|0
block|,
literal|1.0
block|,
literal|1.0
block|,
literal|1.0
block|,
literal|1
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|256
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**********************************************************************  FORWARD DECLARATIONS  *********************************************************************/
end_comment

begin_function_decl
specifier|static
name|void
name|load_file_chooser_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|save_file_chooser_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|create_load_file_chooser
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|dialog
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|create_save_file_chooser
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|dialog
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cmap_preview_size_allocate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkAllocation
modifier|*
name|allocation
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**********************************************************************  CALLBACKS  *********************************************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|dialog_response (GtkWidget * widget,gint response_id,gpointer data)
name|dialog_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|response_id
condition|)
block|{
case|case
name|GTK_RESPONSE_OK
case|:
name|wint
operator|.
name|run
operator|=
name|TRUE
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|widget
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gtk_widget_destroy
argument_list|(
name|widget
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dialog_reset_callback (GtkWidget * widget,gpointer data)
name|dialog_reset_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|wvals
operator|.
name|xmin
operator|=
name|standardvals
operator|.
name|xmin
expr_stmt|;
name|wvals
operator|.
name|xmax
operator|=
name|standardvals
operator|.
name|xmax
expr_stmt|;
name|wvals
operator|.
name|ymin
operator|=
name|standardvals
operator|.
name|ymin
expr_stmt|;
name|wvals
operator|.
name|ymax
operator|=
name|standardvals
operator|.
name|ymax
expr_stmt|;
name|wvals
operator|.
name|iter
operator|=
name|standardvals
operator|.
name|iter
expr_stmt|;
name|wvals
operator|.
name|cx
operator|=
name|standardvals
operator|.
name|cx
expr_stmt|;
name|wvals
operator|.
name|cy
operator|=
name|standardvals
operator|.
name|cy
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dialog_redraw_callback (GtkWidget * widget,gpointer data)
name|dialog_redraw_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
name|alwaysprev
init|=
name|wvals
operator|.
name|alwayspreview
decl_stmt|;
name|wvals
operator|.
name|alwayspreview
operator|=
name|TRUE
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
name|wvals
operator|.
name|alwayspreview
operator|=
name|alwaysprev
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dialog_undo_zoom_callback (GtkWidget * widget,gpointer data)
name|dialog_undo_zoom_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|zoomindex
operator|>
literal|0
condition|)
block|{
name|zooms
index|[
name|zoomindex
index|]
operator|=
name|wvals
expr_stmt|;
name|zoomindex
operator|--
expr_stmt|;
name|wvals
operator|=
name|zooms
index|[
name|zoomindex
index|]
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dialog_redo_zoom_callback (GtkWidget * widget,gpointer data)
name|dialog_redo_zoom_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|zoomindex
operator|<
name|zoommax
condition|)
block|{
name|zoomindex
operator|++
expr_stmt|;
name|wvals
operator|=
name|zooms
index|[
name|zoomindex
index|]
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dialog_step_in_callback (GtkWidget * widget,gpointer data)
name|dialog_step_in_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|double
name|xdifferenz
decl_stmt|;
name|double
name|ydifferenz
decl_stmt|;
if|if
condition|(
name|zoomindex
operator|<
name|ZOOM_UNDO_SIZE
operator|-
literal|1
condition|)
block|{
name|zooms
index|[
name|zoomindex
index|]
operator|=
name|wvals
expr_stmt|;
name|zoomindex
operator|++
expr_stmt|;
block|}
name|zoommax
operator|=
name|zoomindex
expr_stmt|;
name|xdifferenz
operator|=
name|wvals
operator|.
name|xmax
operator|-
name|wvals
operator|.
name|xmin
expr_stmt|;
name|ydifferenz
operator|=
name|wvals
operator|.
name|ymax
operator|-
name|wvals
operator|.
name|ymin
expr_stmt|;
name|wvals
operator|.
name|xmin
operator|+=
literal|1.0
operator|/
literal|6.0
operator|*
name|xdifferenz
expr_stmt|;
name|wvals
operator|.
name|ymin
operator|+=
literal|1.0
operator|/
literal|6.0
operator|*
name|ydifferenz
expr_stmt|;
name|wvals
operator|.
name|xmax
operator|-=
literal|1.0
operator|/
literal|6.0
operator|*
name|xdifferenz
expr_stmt|;
name|wvals
operator|.
name|ymax
operator|-=
literal|1.0
operator|/
literal|6.0
operator|*
name|ydifferenz
expr_stmt|;
name|zooms
index|[
name|zoomindex
index|]
operator|=
name|wvals
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dialog_step_out_callback (GtkWidget * widget,gpointer data)
name|dialog_step_out_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gdouble
name|xdifferenz
decl_stmt|;
name|gdouble
name|ydifferenz
decl_stmt|;
if|if
condition|(
name|zoomindex
operator|<
name|ZOOM_UNDO_SIZE
operator|-
literal|1
condition|)
block|{
name|zooms
index|[
name|zoomindex
index|]
operator|=
name|wvals
expr_stmt|;
name|zoomindex
operator|++
expr_stmt|;
block|}
name|zoommax
operator|=
name|zoomindex
expr_stmt|;
name|xdifferenz
operator|=
name|wvals
operator|.
name|xmax
operator|-
name|wvals
operator|.
name|xmin
expr_stmt|;
name|ydifferenz
operator|=
name|wvals
operator|.
name|ymax
operator|-
name|wvals
operator|.
name|ymin
expr_stmt|;
name|wvals
operator|.
name|xmin
operator|-=
literal|1.0
operator|/
literal|4.0
operator|*
name|xdifferenz
expr_stmt|;
name|wvals
operator|.
name|ymin
operator|-=
literal|1.0
operator|/
literal|4.0
operator|*
name|ydifferenz
expr_stmt|;
name|wvals
operator|.
name|xmax
operator|+=
literal|1.0
operator|/
literal|4.0
operator|*
name|xdifferenz
expr_stmt|;
name|wvals
operator|.
name|ymax
operator|+=
literal|1.0
operator|/
literal|4.0
operator|*
name|ydifferenz
expr_stmt|;
name|zooms
index|[
name|zoomindex
index|]
operator|=
name|wvals
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|explorer_toggle_update (GtkWidget * widget,gpointer data)
name|explorer_toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_toggle_button_update
argument_list|(
name|widget
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|explorer_radio_update (GtkWidget * widget,gpointer data)
name|explorer_radio_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gboolean
name|c_sensitive
decl_stmt|;
name|gimp_radio_button_update
argument_list|(
name|widget
argument_list|,
name|data
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|wvals
operator|.
name|fractaltype
condition|)
block|{
case|case
name|TYPE_MANDELBROT
case|:
case|case
name|TYPE_SIERPINSKI
case|:
name|c_sensitive
operator|=
name|FALSE
expr_stmt|;
break|break;
default|default:
name|c_sensitive
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
name|gimp_scale_entry_set_sensitive
argument_list|(
name|elements
operator|->
name|cx
argument_list|,
name|c_sensitive
argument_list|)
expr_stmt|;
name|gimp_scale_entry_set_sensitive
argument_list|(
name|elements
operator|->
name|cy
argument_list|,
name|c_sensitive
argument_list|)
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|explorer_double_adjustment_update (GtkAdjustment * adjustment,gpointer data)
name|explorer_double_adjustment_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_double_adjustment_update
argument_list|(
name|adjustment
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|explorer_number_of_colors_callback (GtkAdjustment * adjustment,gpointer data)
name|explorer_number_of_colors_callback
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gimp_int_adjustment_update
argument_list|(
name|adjustment
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradient_samples
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gradient_name
condition|)
name|gradient_name
operator|=
name|gimp_context_get_gradient
argument_list|()
expr_stmt|;
name|gimp_gradient_get_uniform_samples
argument_list|(
name|gradient_name
argument_list|,
name|wvals
operator|.
name|ncolors
argument_list|,
name|wvals
operator|.
name|gradinvert
argument_list|,
operator|&
name|n_gradient_samples
argument_list|,
operator|&
name|gradient_samples
argument_list|)
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|explorer_gradient_select_callback (GimpGradientSelectButton * gradient_button,const gchar * name,gint width,const gdouble * gradient_data,gboolean dialog_closing,gpointer data)
name|explorer_gradient_select_callback
parameter_list|(
name|GimpGradientSelectButton
modifier|*
name|gradient_button
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|width
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|gradient_data
parameter_list|,
name|gboolean
name|dialog_closing
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_free
argument_list|(
name|gradient_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradient_samples
argument_list|)
expr_stmt|;
name|gradient_name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gimp_gradient_get_uniform_samples
argument_list|(
name|gradient_name
argument_list|,
name|wvals
operator|.
name|ncolors
argument_list|,
name|wvals
operator|.
name|gradinvert
argument_list|,
operator|&
name|n_gradient_samples
argument_list|,
operator|&
name|gradient_samples
argument_list|)
expr_stmt|;
if|if
condition|(
name|wvals
operator|.
name|colormode
operator|==
literal|1
condition|)
block|{
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_draw_crosshair (gint px,gint py)
name|preview_draw_crosshair
parameter_list|(
name|gint
name|px
parameter_list|,
name|gint
name|py
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guchar
modifier|*
name|p_ul
decl_stmt|;
name|p_ul
operator|=
name|wint
operator|.
name|wimage
operator|+
literal|3
operator|*
operator|(
name|preview_width
operator|*
name|py
operator|+
literal|0
operator|)
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|preview_width
condition|;
name|x
operator|++
control|)
block|{
name|p_ul
index|[
literal|0
index|]
operator|^=
literal|254
expr_stmt|;
name|p_ul
index|[
literal|1
index|]
operator|^=
literal|254
expr_stmt|;
name|p_ul
index|[
literal|2
index|]
operator|^=
literal|254
expr_stmt|;
name|p_ul
operator|+=
literal|3
expr_stmt|;
block|}
name|p_ul
operator|=
name|wint
operator|.
name|wimage
operator|+
literal|3
operator|*
operator|(
name|preview_width
operator|*
literal|0
operator|+
name|px
operator|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|preview_height
condition|;
name|y
operator|++
control|)
block|{
name|p_ul
index|[
literal|0
index|]
operator|^=
literal|254
expr_stmt|;
name|p_ul
index|[
literal|1
index|]
operator|^=
literal|254
expr_stmt|;
name|p_ul
index|[
literal|2
index|]
operator|^=
literal|254
expr_stmt|;
name|p_ul
operator|+=
literal|3
operator|*
name|preview_width
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_redraw (void)
name|preview_redraw
parameter_list|(
name|void
parameter_list|)
block|{
name|gimp_preview_area_draw
argument_list|(
name|GIMP_PREVIEW_AREA
argument_list|(
name|wint
operator|.
name|preview
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|preview_width
argument_list|,
name|preview_height
argument_list|,
name|GIMP_RGB_IMAGE
argument_list|,
name|wint
operator|.
name|wimage
argument_list|,
name|preview_width
operator|*
literal|3
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|wint
operator|.
name|preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|preview_button_press_event (GtkWidget * widget,GdkEventButton * event)
name|preview_button_press_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|button
operator|==
literal|1
condition|)
block|{
name|x_press
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|y_press
operator|=
name|event
operator|->
name|y
expr_stmt|;
name|xbild
operator|=
name|preview_width
expr_stmt|;
name|ybild
operator|=
name|preview_height
expr_stmt|;
name|xdiff
operator|=
operator|(
name|xmax
operator|-
name|xmin
operator|)
operator|/
name|xbild
expr_stmt|;
name|ydiff
operator|=
operator|(
name|ymax
operator|-
name|ymin
operator|)
operator|/
name|ybild
expr_stmt|;
name|preview_draw_crosshair
argument_list|(
name|x_press
argument_list|,
name|y_press
argument_list|)
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|preview_motion_notify_event (GtkWidget * widget,GdkEventButton * event)
name|preview_motion_notify_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|oldypos
operator|!=
operator|-
literal|1
condition|)
block|{
name|preview_draw_crosshair
argument_list|(
name|oldxpos
argument_list|,
name|oldypos
argument_list|)
expr_stmt|;
block|}
name|oldxpos
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|oldypos
operator|=
name|event
operator|->
name|y
expr_stmt|;
if|if
condition|(
operator|(
name|oldxpos
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|oldypos
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|oldxpos
operator|<
name|preview_width
operator|)
operator|&&
operator|(
name|oldypos
operator|<
name|preview_height
operator|)
condition|)
block|{
name|preview_draw_crosshair
argument_list|(
name|oldxpos
argument_list|,
name|oldypos
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|oldypos
operator|=
operator|-
literal|1
expr_stmt|;
name|oldxpos
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|preview_redraw
argument_list|()
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|preview_leave_notify_event (GtkWidget * widget,GdkEventButton * event)
name|preview_leave_notify_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|oldypos
operator|!=
operator|-
literal|1
condition|)
block|{
name|preview_draw_crosshair
argument_list|(
name|oldxpos
argument_list|,
name|oldypos
argument_list|)
expr_stmt|;
block|}
name|oldxpos
operator|=
operator|-
literal|1
expr_stmt|;
name|oldypos
operator|=
operator|-
literal|1
expr_stmt|;
name|preview_redraw
argument_list|()
expr_stmt|;
name|gdk_window_set_cursor
argument_list|(
name|gtk_widget_get_window
argument_list|(
name|maindlg
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|preview_enter_notify_event (GtkWidget * widget,GdkEventButton * event)
name|preview_enter_notify_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
specifier|static
name|GdkCursor
modifier|*
name|cursor
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|cursor
condition|)
block|{
name|GdkDisplay
modifier|*
name|display
init|=
name|gtk_widget_get_display
argument_list|(
name|maindlg
argument_list|)
decl_stmt|;
name|cursor
operator|=
name|gdk_cursor_new_for_display
argument_list|(
name|display
argument_list|,
name|GDK_TCROSS
argument_list|)
expr_stmt|;
block|}
name|gdk_window_set_cursor
argument_list|(
name|gtk_widget_get_window
argument_list|(
name|maindlg
argument_list|)
argument_list|,
name|cursor
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|preview_button_release_event (GtkWidget * widget,GdkEventButton * event)
name|preview_button_release_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|gdouble
name|l_xmin
decl_stmt|;
name|gdouble
name|l_xmax
decl_stmt|;
name|gdouble
name|l_ymin
decl_stmt|;
name|gdouble
name|l_ymax
decl_stmt|;
if|if
condition|(
name|event
operator|->
name|button
operator|==
literal|1
condition|)
block|{
name|gdouble
name|x_release
decl_stmt|,
name|y_release
decl_stmt|;
name|x_release
operator|=
name|event
operator|->
name|x
expr_stmt|;
name|y_release
operator|=
name|event
operator|->
name|y
expr_stmt|;
if|if
condition|(
operator|(
name|x_press
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|y_press
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|x_release
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|y_release
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|x_press
operator|<
name|preview_width
operator|)
operator|&&
operator|(
name|y_press
operator|<
name|preview_height
operator|)
operator|&&
operator|(
name|x_release
operator|<
name|preview_width
operator|)
operator|&&
operator|(
name|y_release
operator|<
name|preview_height
operator|)
condition|)
block|{
name|l_xmin
operator|=
operator|(
name|wvals
operator|.
name|xmin
operator|+
operator|(
name|wvals
operator|.
name|xmax
operator|-
name|wvals
operator|.
name|xmin
operator|)
operator|*
operator|(
name|x_press
operator|/
name|preview_width
operator|)
operator|)
expr_stmt|;
name|l_xmax
operator|=
operator|(
name|wvals
operator|.
name|xmin
operator|+
operator|(
name|wvals
operator|.
name|xmax
operator|-
name|wvals
operator|.
name|xmin
operator|)
operator|*
operator|(
name|x_release
operator|/
name|preview_width
operator|)
operator|)
expr_stmt|;
name|l_ymin
operator|=
operator|(
name|wvals
operator|.
name|ymin
operator|+
operator|(
name|wvals
operator|.
name|ymax
operator|-
name|wvals
operator|.
name|ymin
operator|)
operator|*
operator|(
name|y_press
operator|/
name|preview_height
operator|)
operator|)
expr_stmt|;
name|l_ymax
operator|=
operator|(
name|wvals
operator|.
name|ymin
operator|+
operator|(
name|wvals
operator|.
name|ymax
operator|-
name|wvals
operator|.
name|ymin
operator|)
operator|*
operator|(
name|y_release
operator|/
name|preview_height
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|zoomindex
operator|<
name|ZOOM_UNDO_SIZE
operator|-
literal|1
condition|)
block|{
name|zooms
index|[
name|zoomindex
index|]
operator|=
name|wvals
expr_stmt|;
name|zoomindex
operator|++
expr_stmt|;
block|}
name|zoommax
operator|=
name|zoomindex
expr_stmt|;
name|wvals
operator|.
name|xmin
operator|=
name|l_xmin
expr_stmt|;
name|wvals
operator|.
name|xmax
operator|=
name|l_xmax
expr_stmt|;
name|wvals
operator|.
name|ymin
operator|=
name|l_ymin
expr_stmt|;
name|wvals
operator|.
name|ymax
operator|=
name|l_ymax
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
name|oldypos
operator|=
name|oldxpos
operator|=
operator|-
literal|1
expr_stmt|;
block|}
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: explorer_dialog  *********************************************************************/
end_comment

begin_function
name|gint
DECL|function|explorer_dialog (void)
name|explorer_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|top_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|left_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|abox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|bbox
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle_vbox2
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle_vbox3
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|gradient
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
name|gchar
modifier|*
name|gradient_name
decl_stmt|;
name|GSList
modifier|*
name|group
init|=
name|NULL
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|path
operator|=
name|gimp_gimprc_query
argument_list|(
literal|"fractalexplorer-path"
argument_list|)
expr_stmt|;
if|if
condition|(
name|path
condition|)
block|{
name|fractalexplorer_path
operator|=
name|g_filename_from_utf8
argument_list|(
name|path
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gchar
modifier|*
name|gimprc
init|=
name|gimp_personal_rc_file
argument_list|(
literal|"gimprc"
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|full_path
init|=
name|gimp_config_build_data_path
argument_list|(
literal|"fractalexplorer"
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|esc_path
init|=
name|g_strescape
argument_list|(
name|full_path
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|g_free
argument_list|(
name|full_path
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
name|_
argument_list|(
literal|"No %s in gimprc:\n"
literal|"You need to add an entry like\n"
literal|"(%s \"%s\")\n"
literal|"to your %s file."
argument_list|)
argument_list|,
literal|"fractalexplorer-path"
argument_list|,
literal|"fractalexplorer-path"
argument_list|,
name|esc_path
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|gimprc
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gimprc
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|esc_path
argument_list|)
expr_stmt|;
block|}
name|wint
operator|.
name|wimage
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
name|preview_width
operator|*
name|preview_height
operator|*
literal|3
argument_list|)
expr_stmt|;
name|elements
operator|=
name|g_new
argument_list|(
name|DialogElements
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|maindlg
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Fractal Explorer"
argument_list|)
argument_list|,
name|PLUG_IN_ROLE
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_window_set_transient
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dialog
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dialog
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_main_quit
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|top_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|top_hbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|top_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|top_hbox
argument_list|)
expr_stmt|;
name|left_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|top_hbox
argument_list|)
argument_list|,
name|left_vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|left_vbox
argument_list|)
expr_stmt|;
comment|/*  Preview  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|left_vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|abox
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|abox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|abox
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|abox
argument_list|)
argument_list|,
name|frame
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|wint
operator|.
name|preview
operator|=
name|gimp_preview_area_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|wint
operator|.
name|preview
argument_list|,
name|preview_width
argument_list|,
name|preview_height
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|wint
operator|.
name|preview
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|wint
operator|.
name|preview
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_button_press_event
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|wint
operator|.
name|preview
argument_list|,
literal|"button-release-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_button_release_event
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|wint
operator|.
name|preview
argument_list|,
literal|"motion-notify-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_motion_notify_event
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|wint
operator|.
name|preview
argument_list|,
literal|"leave-notify-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_leave_notify_event
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|wint
operator|.
name|preview
argument_list|,
literal|"enter-notify-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|preview_enter_notify_event
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|wint
operator|.
name|preview
argument_list|,
operator|(
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
operator||
name|GDK_POINTER_MOTION_MASK
operator||
name|GDK_LEAVE_NOTIFY_MASK
operator||
name|GDK_ENTER_NOTIFY_MASK
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|wint
operator|.
name|preview
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Realtime preview"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_toggle_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|alwayspreview
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|wvals
operator|.
name|alwayspreview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"If enabled the preview will "
literal|"be redrawn automatically"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"R_edraw preview"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_redraw_callback
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/*  Zoom Options  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Zoom"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|left_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|bbox
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|bbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|bbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_ZOOM_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|bbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_step_in_callback
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_ZOOM_OUT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|bbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_step_out_callback
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|bbox
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|bbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|bbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_UNDO
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|bbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Undo last zoom change"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_undo_zoom_callback
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_REDO
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|bbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Redo last zoom change"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_redo_zoom_callback
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
comment|/*  Create notebook  */
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|top_hbox
argument_list|)
argument_list|,
name|notebook
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
comment|/*  "Parameters" page  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Parameters"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Fractal Parameters"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|8
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|elements
operator|->
name|xmin
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Left:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|10
argument_list|,
name|wvals
operator|.
name|xmin
argument_list|,
operator|-
literal|3
argument_list|,
literal|3
argument_list|,
literal|0.001
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|xmin
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|xmin
argument_list|)
expr_stmt|;
name|elements
operator|->
name|xmax
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"Right:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|10
argument_list|,
name|wvals
operator|.
name|xmax
argument_list|,
operator|-
literal|3
argument_list|,
literal|3
argument_list|,
literal|0.001
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|xmax
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|xmax
argument_list|)
expr_stmt|;
name|elements
operator|->
name|ymin
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"Top:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|10
argument_list|,
name|wvals
operator|.
name|ymin
argument_list|,
operator|-
literal|3
argument_list|,
literal|3
argument_list|,
literal|0.001
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|ymin
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|ymin
argument_list|)
expr_stmt|;
name|elements
operator|->
name|ymax
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"Bottom:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|10
argument_list|,
name|wvals
operator|.
name|ymax
argument_list|,
operator|-
literal|3
argument_list|,
literal|3
argument_list|,
literal|0.001
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|ymax
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|ymax
argument_list|)
expr_stmt|;
name|elements
operator|->
name|iter
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
name|_
argument_list|(
literal|"Iterations:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|10
argument_list|,
name|wvals
operator|.
name|iter
argument_list|,
literal|1
argument_list|,
literal|1000
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"The higher the number of iterations, "
literal|"the more details will be calculated"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|iter
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|iter
argument_list|)
expr_stmt|;
name|elements
operator|->
name|cx
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
name|_
argument_list|(
literal|"CX:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|10
argument_list|,
name|wvals
operator|.
name|cx
argument_list|,
operator|-
literal|2.5
argument_list|,
literal|2.5
argument_list|,
literal|0.001
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Changes aspect of fractal"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|cx
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|cx
argument_list|)
expr_stmt|;
name|elements
operator|->
name|cy
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|6
argument_list|,
name|_
argument_list|(
literal|"CY:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|10
argument_list|,
name|wvals
operator|.
name|cy
argument_list|,
operator|-
literal|2.5
argument_list|,
literal|2.5
argument_list|,
literal|0.001
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Changes aspect of fractal"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|cy
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|cy
argument_list|)
expr_stmt|;
name|bbox
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|bbox
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|bbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_OPEN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|bbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|create_load_file_chooser
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Load a fractal from file"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GIMP_STOCK_RESET
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|bbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|dialog_reset_callback
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Reset parameters to default values"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_from_stock
argument_list|(
name|GTK_STOCK_SAVE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|bbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|create_save_file_chooser
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Save active fractal to file"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Fractal type toggle box  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Fractal Type"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|toggle_vbox
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_radio_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|fractaltype
argument_list|,
name|wvals
operator|.
name|fractaltype
argument_list|,
name|_
argument_list|(
literal|"Mandelbrot"
argument_list|)
argument_list|,
name|TYPE_MANDELBROT
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_MANDELBROT
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Julia"
argument_list|)
argument_list|,
name|TYPE_JULIA
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_JULIA
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Barnsley 1"
argument_list|)
argument_list|,
name|TYPE_BARNSLEY_1
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_BARNSLEY_1
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Barnsley 2"
argument_list|)
argument_list|,
name|TYPE_BARNSLEY_2
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_BARNSLEY_2
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Barnsley 3"
argument_list|)
argument_list|,
name|TYPE_BARNSLEY_3
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_BARNSLEY_3
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Spider"
argument_list|)
argument_list|,
name|TYPE_SPIDER
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_SPIDER
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Man'o'war"
argument_list|)
argument_list|,
name|TYPE_MAN_O_WAR
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_MAN_O_WAR
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Lambda"
argument_list|)
argument_list|,
name|TYPE_LAMBDA
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_LAMBDA
index|]
operator|)
argument_list|,
name|_
argument_list|(
literal|"Sierpinski"
argument_list|)
argument_list|,
name|TYPE_SIERPINSKI
argument_list|,
operator|&
operator|(
name|elements
operator|->
name|type
index|[
name|TYPE_SIERPINSKI
index|]
operator|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|toggle_vbox2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|TYPE_BARNSLEY_2
init|;
name|i
operator|<=
name|TYPE_SPIDER
condition|;
name|i
operator|++
control|)
block|{
name|g_object_ref
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox2
argument_list|)
argument_list|,
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|toggle_vbox3
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|TYPE_MAN_O_WAR
init|;
name|i
operator|<=
name|TYPE_SIERPINSKI
condition|;
name|i
operator|++
control|)
block|{
name|g_object_ref
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox3
argument_list|)
argument_list|,
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|elements
operator|->
name|type
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle_vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle_vbox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle_vbox2
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle_vbox2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle_vbox3
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle_vbox3
argument_list|)
expr_stmt|;
comment|/*  Color page  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Co_lors"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  Number of Colors frame  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Number of Colors"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|elements
operator|->
name|ncol
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Number of colors:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|,
name|wvals
operator|.
name|ncolors
argument_list|,
literal|2
argument_list|,
name|MAXNCOLORS
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Change the number of colors in the mapping"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|ncol
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_number_of_colors_callback
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|ncolors
argument_list|)
expr_stmt|;
name|elements
operator|->
name|useloglog
operator|=
name|toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Use loglog smoothing"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|toggle
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_toggle_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|useloglog
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|wvals
operator|.
name|useloglog
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Use log log smoothing to eliminate "
literal|"\"banding\" in the result"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Color Density frame  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Color Density"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|elements
operator|->
name|red
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Red:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|,
name|wvals
operator|.
name|redstretch
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|2
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Change the intensity of the red channel"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|red
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|redstretch
argument_list|)
expr_stmt|;
name|elements
operator|->
name|green
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"Green:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|,
name|wvals
operator|.
name|greenstretch
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|2
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Change the intensity of the green channel"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|green
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|greenstretch
argument_list|)
expr_stmt|;
name|elements
operator|->
name|blue
operator|=
name|gimp_scale_entry_new
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"Blue:"
argument_list|)
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|,
name|wvals
operator|.
name|bluestretch
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|2
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Change the intensity of the blue channel"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|elements
operator|->
name|blue
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|bluestretch
argument_list|)
expr_stmt|;
comment|/*  Color Function frame  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Color Function"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/*  Redmode radio frame  */
name|frame
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"Red"
argument_list|)
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_radio_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|redmode
argument_list|,
name|wvals
operator|.
name|redmode
argument_list|,
name|_
argument_list|(
literal|"Sine"
argument_list|)
argument_list|,
name|SINUS
argument_list|,
operator|&
name|elements
operator|->
name|redmode
index|[
name|SINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Cosine"
argument_list|)
argument_list|,
name|COSINUS
argument_list|,
operator|&
name|elements
operator|->
name|redmode
index|[
name|COSINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"None"
argument_list|)
argument_list|,
name|NONE
argument_list|,
operator|&
name|elements
operator|->
name|redmode
index|[
name|NONE
index|]
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|redmode
index|[
name|SINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Use sine-function for this color component"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|redmode
index|[
name|COSINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Use cosine-function for this color "
literal|"component"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|redmode
index|[
name|NONE
index|]
argument_list|,
name|_
argument_list|(
literal|"Use linear mapping instead of any "
literal|"trigonometrical function for this color "
literal|"channel"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|toggle_vbox
operator|=
name|gtk_bin_get_child
argument_list|(
name|GTK_BIN
argument_list|(
name|frame
argument_list|)
argument_list|)
expr_stmt|;
name|elements
operator|->
name|redinvert
operator|=
name|toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Inversion"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|wvals
operator|.
name|redinvert
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_toggle_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|redinvert
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"If you enable this option higher color values "
literal|"will be swapped with lower ones and vice "
literal|"versa"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Greenmode radio frame  */
name|frame
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"Green"
argument_list|)
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_radio_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|greenmode
argument_list|,
name|wvals
operator|.
name|greenmode
argument_list|,
name|_
argument_list|(
literal|"Sine"
argument_list|)
argument_list|,
name|SINUS
argument_list|,
operator|&
name|elements
operator|->
name|greenmode
index|[
name|SINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Cosine"
argument_list|)
argument_list|,
name|COSINUS
argument_list|,
operator|&
name|elements
operator|->
name|greenmode
index|[
name|COSINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"None"
argument_list|)
argument_list|,
name|NONE
argument_list|,
operator|&
name|elements
operator|->
name|greenmode
index|[
name|NONE
index|]
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|greenmode
index|[
name|SINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Use sine-function for this color component"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|greenmode
index|[
name|COSINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Use cosine-function for this color "
literal|"component"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|greenmode
index|[
name|NONE
index|]
argument_list|,
name|_
argument_list|(
literal|"Use linear mapping instead of any "
literal|"trigonometrical function for this color "
literal|"channel"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|toggle_vbox
operator|=
name|gtk_bin_get_child
argument_list|(
name|GTK_BIN
argument_list|(
name|frame
argument_list|)
argument_list|)
expr_stmt|;
name|elements
operator|->
name|greeninvert
operator|=
name|toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Inversion"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|wvals
operator|.
name|greeninvert
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_toggle_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|greeninvert
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"If you enable this option higher color values "
literal|"will be swapped with lower ones and vice "
literal|"versa"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Bluemode radio frame  */
name|frame
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"Blue"
argument_list|)
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_radio_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|bluemode
argument_list|,
name|wvals
operator|.
name|bluemode
argument_list|,
name|_
argument_list|(
literal|"Sine"
argument_list|)
argument_list|,
name|SINUS
argument_list|,
operator|&
name|elements
operator|->
name|bluemode
index|[
name|SINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Cosine"
argument_list|)
argument_list|,
name|COSINUS
argument_list|,
operator|&
name|elements
operator|->
name|bluemode
index|[
name|COSINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"None"
argument_list|)
argument_list|,
name|NONE
argument_list|,
operator|&
name|elements
operator|->
name|bluemode
index|[
name|NONE
index|]
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|bluemode
index|[
name|SINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Use sine-function for this color component"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|bluemode
index|[
name|COSINUS
index|]
argument_list|,
name|_
argument_list|(
literal|"Use cosine-function for this color "
literal|"component"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|elements
operator|->
name|bluemode
index|[
name|NONE
index|]
argument_list|,
name|_
argument_list|(
literal|"Use linear mapping instead of any "
literal|"trigonometrical function for this color "
literal|"channel"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|toggle_vbox
operator|=
name|gtk_bin_get_child
argument_list|(
name|GTK_BIN
argument_list|(
name|frame
argument_list|)
argument_list|)
expr_stmt|;
name|elements
operator|->
name|blueinvert
operator|=
name|toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Inversion"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|wvals
operator|.
name|blueinvert
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_toggle_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|blueinvert
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"If you enable this option higher color values "
literal|"will be swapped with lower ones and vice "
literal|"versa"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Colormode toggle box  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Color Mode"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|toggle_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|toggle_vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle_vbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|elements
operator|->
name|colormode
index|[
literal|0
index|]
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"As specified above"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_radio_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|colormode
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|wvals
operator|.
name|colormode
operator|==
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Create a color-map with the options you "
literal|"specified above (color density/function). The "
literal|"result is visible in the preview image"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|elements
operator|->
name|colormode
index|[
literal|1
index|]
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"Apply active gradient to final image"
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_radio_update
argument_list|)
argument_list|,
operator|&
name|wvals
operator|.
name|colormode
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|wvals
operator|.
name|colormode
operator|==
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|toggle
argument_list|,
name|_
argument_list|(
literal|"Create a color-map using a gradient from "
literal|"the gradient editor"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gradient_name
operator|=
name|gimp_context_get_gradient
argument_list|()
expr_stmt|;
name|gimp_gradient_get_uniform_samples
argument_list|(
name|gradient_name
argument_list|,
name|wvals
operator|.
name|ncolors
argument_list|,
name|wvals
operator|.
name|gradinvert
argument_list|,
operator|&
name|n_gradient_samples
argument_list|,
operator|&
name|gradient_samples
argument_list|)
expr_stmt|;
name|gradient
operator|=
name|gimp_gradient_select_button_new
argument_list|(
name|_
argument_list|(
literal|"FractalExplorer Gradient"
argument_list|)
argument_list|,
name|gradient_name
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gradient
argument_list|,
literal|"gradient-set"
argument_list|,
name|G_CALLBACK
argument_list|(
name|explorer_gradient_select_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradient_name
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|gradient
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient
argument_list|)
expr_stmt|;
name|abox
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|{
name|gint
name|xsize
decl_stmt|,
name|ysize
decl_stmt|;
for|for
control|(
name|ysize
operator|=
literal|1
init|;
name|ysize
operator|*
name|ysize
operator|*
name|ysize
operator|<
literal|8192
condition|;
name|ysize
operator|++
control|)
comment|/**/
empty_stmt|;
name|xsize
operator|=
name|wvals
operator|.
name|ncolors
operator|/
name|ysize
expr_stmt|;
while|while
condition|(
name|xsize
operator|*
name|ysize
operator|<
literal|8192
condition|)
name|xsize
operator|++
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|abox
argument_list|,
name|xsize
argument_list|,
name|ysize
operator|*
literal|4
argument_list|)
expr_stmt|;
block|}
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|abox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|abox
argument_list|)
expr_stmt|;
name|cmap_preview
operator|=
name|gimp_preview_area_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|cmap_preview
argument_list|,
literal|32
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|abox
argument_list|)
argument_list|,
name|cmap_preview
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|cmap_preview
argument_list|,
literal|"size-allocate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cmap_preview_size_allocate
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|cmap_preview
argument_list|)
expr_stmt|;
name|frame
operator|=
name|add_objects_list
argument_list|()
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|frame
argument_list|,
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Fractals"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|ready_now
operator|=
name|TRUE
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|g_free
argument_list|(
name|wint
operator|.
name|wimage
argument_list|)
expr_stmt|;
return|return
name|wint
operator|.
name|run
return|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: dialog_update_preview  *********************************************************************/
end_comment

begin_function
name|void
DECL|function|dialog_update_preview (void)
name|dialog_update_preview
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|ycoord
decl_stmt|;
name|guchar
modifier|*
name|p_ul
decl_stmt|;
if|if
condition|(
name|NULL
operator|==
name|wint
operator|.
name|preview
condition|)
return|return;
if|if
condition|(
name|ready_now
operator|&&
name|wvals
operator|.
name|alwayspreview
condition|)
block|{
name|xmin
operator|=
name|wvals
operator|.
name|xmin
expr_stmt|;
name|xmax
operator|=
name|wvals
operator|.
name|xmax
expr_stmt|;
name|ymin
operator|=
name|wvals
operator|.
name|ymin
expr_stmt|;
name|ymax
operator|=
name|wvals
operator|.
name|ymax
expr_stmt|;
name|xbild
operator|=
name|preview_width
expr_stmt|;
name|ybild
operator|=
name|preview_height
expr_stmt|;
name|xdiff
operator|=
operator|(
name|xmax
operator|-
name|xmin
operator|)
operator|/
name|xbild
expr_stmt|;
name|ydiff
operator|=
operator|(
name|ymax
operator|-
name|ymin
operator|)
operator|/
name|ybild
expr_stmt|;
name|p_ul
operator|=
name|wint
operator|.
name|wimage
expr_stmt|;
for|for
control|(
name|ycoord
operator|=
literal|0
init|;
name|ycoord
operator|<
name|preview_height
condition|;
name|ycoord
operator|++
control|)
block|{
name|explorer_render_row
argument_list|(
name|NULL
argument_list|,
name|p_ul
argument_list|,
name|ycoord
argument_list|,
name|preview_width
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|p_ul
operator|+=
name|preview_width
operator|*
literal|3
expr_stmt|;
block|}
name|preview_redraw
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: cmap_preview_size_allocate()  *********************************************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|cmap_preview_size_allocate (GtkWidget * widget,GtkAllocation * allocation)
name|cmap_preview_size_allocate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkAllocation
modifier|*
name|allocation
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|gint
name|x
decl_stmt|;
name|gint
name|y
decl_stmt|;
name|gint
name|j
decl_stmt|;
name|guchar
modifier|*
name|b
decl_stmt|;
name|GimpPreviewArea
modifier|*
name|preview
init|=
name|GIMP_PREVIEW_AREA
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|b
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
name|allocation
operator|->
name|width
operator|*
name|allocation
operator|->
name|height
operator|*
literal|3
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|allocation
operator|->
name|height
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|allocation
operator|->
name|width
condition|;
name|x
operator|++
control|)
block|{
name|i
operator|=
name|x
operator|+
operator|(
name|y
operator|/
literal|4
operator|)
operator|*
name|allocation
operator|->
name|width
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|wvals
operator|.
name|ncolors
condition|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
name|b
index|[
operator|(
name|y
operator|*
name|allocation
operator|->
name|width
operator|+
name|x
operator|)
operator|*
literal|3
operator|+
name|j
index|]
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|b
index|[
operator|(
name|y
operator|*
name|allocation
operator|->
name|width
operator|+
name|x
operator|)
operator|*
literal|3
index|]
operator|=
name|colormap
index|[
name|i
index|]
operator|.
name|r
expr_stmt|;
name|b
index|[
operator|(
name|y
operator|*
name|allocation
operator|->
name|width
operator|+
name|x
operator|)
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|colormap
index|[
name|i
index|]
operator|.
name|g
expr_stmt|;
name|b
index|[
operator|(
name|y
operator|*
name|allocation
operator|->
name|width
operator|+
name|x
operator|)
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|colormap
index|[
name|i
index|]
operator|.
name|b
expr_stmt|;
block|}
block|}
block|}
name|gimp_preview_area_draw
argument_list|(
name|preview
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|allocation
operator|->
name|width
argument_list|,
name|allocation
operator|->
name|height
argument_list|,
name|GIMP_RGB_IMAGE
argument_list|,
name|b
argument_list|,
name|allocation
operator|->
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|cmap_preview
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|b
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: set_cmap_preview()  *********************************************************************/
end_comment

begin_function
name|void
DECL|function|set_cmap_preview (void)
name|set_cmap_preview
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|xsize
decl_stmt|,
name|ysize
decl_stmt|;
if|if
condition|(
name|NULL
operator|==
name|cmap_preview
condition|)
return|return;
name|make_color_map
argument_list|()
expr_stmt|;
for|for
control|(
name|ysize
operator|=
literal|1
init|;
name|ysize
operator|*
name|ysize
operator|*
name|ysize
operator|<
name|wvals
operator|.
name|ncolors
condition|;
name|ysize
operator|++
control|)
comment|/**/
empty_stmt|;
name|xsize
operator|=
name|wvals
operator|.
name|ncolors
operator|/
name|ysize
expr_stmt|;
while|while
condition|(
name|xsize
operator|*
name|ysize
operator|<
name|wvals
operator|.
name|ncolors
condition|)
name|xsize
operator|++
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|cmap_preview
argument_list|,
name|xsize
argument_list|,
name|ysize
operator|*
literal|4
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: make_color_map()  *********************************************************************/
end_comment

begin_function
name|void
DECL|function|make_color_map (void)
name|make_color_map
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|gint
name|r
decl_stmt|;
name|gint
name|gr
decl_stmt|;
name|gint
name|bl
decl_stmt|;
name|gdouble
name|redstretch
decl_stmt|;
name|gdouble
name|greenstretch
decl_stmt|;
name|gdouble
name|bluestretch
decl_stmt|;
name|gdouble
name|pi
init|=
name|atan
argument_list|(
literal|1
argument_list|)
operator|*
literal|4
decl_stmt|;
comment|/*  get gradient samples if they don't exist -- fixes gradient color    *  mode for noninteractive use (bug #103470).    */
if|if
condition|(
name|gradient_samples
operator|==
name|NULL
condition|)
block|{
name|gchar
modifier|*
name|gradient_name
init|=
name|gimp_context_get_gradient
argument_list|()
decl_stmt|;
name|gimp_gradient_get_uniform_samples
argument_list|(
name|gradient_name
argument_list|,
name|wvals
operator|.
name|ncolors
argument_list|,
name|wvals
operator|.
name|gradinvert
argument_list|,
operator|&
name|n_gradient_samples
argument_list|,
operator|&
name|gradient_samples
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradient_name
argument_list|)
expr_stmt|;
block|}
name|redstretch
operator|=
name|wvals
operator|.
name|redstretch
operator|*
literal|127.5
expr_stmt|;
name|greenstretch
operator|=
name|wvals
operator|.
name|greenstretch
operator|*
literal|127.5
expr_stmt|;
name|bluestretch
operator|=
name|wvals
operator|.
name|bluestretch
operator|*
literal|127.5
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|wvals
operator|.
name|ncolors
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|wvals
operator|.
name|colormode
operator|==
literal|1
condition|)
block|{
name|colormap
index|[
name|i
index|]
operator|.
name|r
operator|=
call|(
name|guchar
call|)
argument_list|(
name|gradient_samples
index|[
name|i
operator|*
literal|4
index|]
operator|*
literal|255.9
argument_list|)
expr_stmt|;
name|colormap
index|[
name|i
index|]
operator|.
name|g
operator|=
call|(
name|guchar
call|)
argument_list|(
name|gradient_samples
index|[
name|i
operator|*
literal|4
operator|+
literal|1
index|]
operator|*
literal|255.9
argument_list|)
expr_stmt|;
name|colormap
index|[
name|i
index|]
operator|.
name|b
operator|=
call|(
name|guchar
call|)
argument_list|(
name|gradient_samples
index|[
name|i
operator|*
literal|4
operator|+
literal|2
index|]
operator|*
literal|255.9
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|double
name|x
init|=
operator|(
name|i
operator|*
literal|2.0
operator|)
operator|/
name|wvals
operator|.
name|ncolors
decl_stmt|;
name|r
operator|=
name|gr
operator|=
name|bl
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|wvals
operator|.
name|redmode
condition|)
block|{
case|case
name|SINUS
case|:
name|r
operator|=
operator|(
name|int
operator|)
name|redstretch
operator|*
operator|(
literal|1.0
operator|+
name|sin
argument_list|(
operator|(
name|x
operator|-
literal|1
operator|)
operator|*
name|pi
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
name|COSINUS
case|:
name|r
operator|=
operator|(
name|int
operator|)
name|redstretch
operator|*
operator|(
literal|1.0
operator|+
name|cos
argument_list|(
operator|(
name|x
operator|-
literal|1
operator|)
operator|*
name|pi
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
name|NONE
case|:
name|r
operator|=
call|(
name|int
call|)
argument_list|(
name|redstretch
operator|*
operator|(
name|x
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
switch|switch
condition|(
name|wvals
operator|.
name|greenmode
condition|)
block|{
case|case
name|SINUS
case|:
name|gr
operator|=
operator|(
name|int
operator|)
name|greenstretch
operator|*
operator|(
literal|1.0
operator|+
name|sin
argument_list|(
operator|(
name|x
operator|-
literal|1
operator|)
operator|*
name|pi
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
name|COSINUS
case|:
name|gr
operator|=
operator|(
name|int
operator|)
name|greenstretch
operator|*
operator|(
literal|1.0
operator|+
name|cos
argument_list|(
operator|(
name|x
operator|-
literal|1
operator|)
operator|*
name|pi
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
name|NONE
case|:
name|gr
operator|=
call|(
name|int
call|)
argument_list|(
name|greenstretch
operator|*
operator|(
name|x
operator|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
switch|switch
condition|(
name|wvals
operator|.
name|bluemode
condition|)
block|{
case|case
name|SINUS
case|:
name|bl
operator|=
operator|(
name|int
operator|)
name|bluestretch
operator|*
operator|(
literal|1.0
operator|+
name|sin
argument_list|(
operator|(
name|x
operator|-
literal|1
operator|)
operator|*
name|pi
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
name|COSINUS
case|:
name|bl
operator|=
operator|(
name|int
operator|)
name|bluestretch
operator|*
operator|(
literal|1.0
operator|+
name|cos
argument_list|(
operator|(
name|x
operator|-
literal|1
operator|)
operator|*
name|pi
argument_list|)
operator|)
expr_stmt|;
break|break;
case|case
name|NONE
case|:
name|bl
operator|=
call|(
name|int
call|)
argument_list|(
name|bluestretch
operator|*
name|x
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|r
operator|=
name|MIN
argument_list|(
name|r
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|gr
operator|=
name|MIN
argument_list|(
name|gr
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|bl
operator|=
name|MIN
argument_list|(
name|bl
argument_list|,
literal|255
argument_list|)
expr_stmt|;
if|if
condition|(
name|wvals
operator|.
name|redinvert
condition|)
name|r
operator|=
literal|255
operator|-
name|r
expr_stmt|;
if|if
condition|(
name|wvals
operator|.
name|greeninvert
condition|)
name|gr
operator|=
literal|255
operator|-
name|gr
expr_stmt|;
if|if
condition|(
name|wvals
operator|.
name|blueinvert
condition|)
name|bl
operator|=
literal|255
operator|-
name|bl
expr_stmt|;
name|colormap
index|[
name|i
index|]
operator|.
name|r
operator|=
name|r
expr_stmt|;
name|colormap
index|[
name|i
index|]
operator|.
name|g
operator|=
name|gr
expr_stmt|;
name|colormap
index|[
name|i
index|]
operator|.
name|b
operator|=
name|bl
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: dialog_change_scale  *********************************************************************/
end_comment

begin_function
name|void
DECL|function|dialog_change_scale (void)
name|dialog_change_scale
parameter_list|(
name|void
parameter_list|)
block|{
name|ready_now
operator|=
name|FALSE
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|xmin
argument_list|)
argument_list|,
name|wvals
operator|.
name|xmin
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|xmax
argument_list|)
argument_list|,
name|wvals
operator|.
name|xmax
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|ymin
argument_list|)
argument_list|,
name|wvals
operator|.
name|ymin
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|ymax
argument_list|)
argument_list|,
name|wvals
operator|.
name|ymax
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|iter
argument_list|)
argument_list|,
name|wvals
operator|.
name|iter
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|cx
argument_list|)
argument_list|,
name|wvals
operator|.
name|cx
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|cy
argument_list|)
argument_list|,
name|wvals
operator|.
name|cy
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|red
argument_list|)
argument_list|,
name|wvals
operator|.
name|redstretch
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|green
argument_list|)
argument_list|,
name|wvals
operator|.
name|greenstretch
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|elements
operator|->
name|blue
argument_list|)
argument_list|,
name|wvals
operator|.
name|bluestretch
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|type
index|[
name|wvals
operator|.
name|fractaltype
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|redmode
index|[
name|wvals
operator|.
name|redmode
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|greenmode
index|[
name|wvals
operator|.
name|greenmode
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|bluemode
index|[
name|wvals
operator|.
name|bluemode
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|redinvert
argument_list|)
argument_list|,
name|wvals
operator|.
name|redinvert
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|greeninvert
argument_list|)
argument_list|,
name|wvals
operator|.
name|greeninvert
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|blueinvert
argument_list|)
argument_list|,
name|wvals
operator|.
name|blueinvert
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|elements
operator|->
name|colormode
index|[
name|wvals
operator|.
name|colormode
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|ready_now
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************************************************  FUNCTION: save_options  *********************************************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|save_options (FILE * fp)
name|save_options
parameter_list|(
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|gchar
name|buf
index|[
literal|64
index|]
decl_stmt|;
comment|/* Save options */
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"fractaltype: %i\n"
argument_list|,
name|wvals
operator|.
name|fractaltype
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|xmin
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"xmin: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|xmax
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"xmax: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|ymin
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"ymin: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|ymax
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"ymax: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|iter
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"iter: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|cx
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"cx: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|cy
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"cy: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|redstretch
operator|*
literal|128.0
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"redstretch: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|greenstretch
operator|*
literal|128.0
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"greenstretch: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|g_ascii_formatd
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%0.15f"
argument_list|,
name|wvals
operator|.
name|bluestretch
operator|*
literal|128.0
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"bluestretch: %s\n"
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"redmode: %i\n"
argument_list|,
name|wvals
operator|.
name|redmode
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"greenmode: %i\n"
argument_list|,
name|wvals
operator|.
name|greenmode
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"bluemode: %i\n"
argument_list|,
name|wvals
operator|.
name|bluemode
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"redinvert: %i\n"
argument_list|,
name|wvals
operator|.
name|redinvert
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"greeninvert: %i\n"
argument_list|,
name|wvals
operator|.
name|greeninvert
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"blueinvert: %i\n"
argument_list|,
name|wvals
operator|.
name|blueinvert
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"colormode: %i\n"
argument_list|,
name|wvals
operator|.
name|colormode
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"#**********************************************************************\n"
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp
argument_list|,
literal|"<EOF>\n"
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"#**********************************************************************\n"
argument_list|,
name|fp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_callback (void)
name|save_callback
parameter_list|(
name|void
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|savename
init|=
name|filename
decl_stmt|;
name|fp
operator|=
name|g_fopen
argument_list|(
name|savename
argument_list|,
literal|"wt+"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Could not open '%s' for writing: %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|savename
argument_list|)
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Write header out */
name|fputs
argument_list|(
name|FRACTAL_HEADER
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"#**********************************************************************\n"
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"# This is a data file for the Fractal Explorer plug-in for GIMP       *\n"
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fputs
argument_list|(
literal|"#**********************************************************************\n"
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|save_options
argument_list|(
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|fp
argument_list|)
condition|)
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Could not write '%s': %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|savename
argument_list|)
argument_list|,
name|g_strerror
argument_list|(
name|ferror
argument_list|(
name|fp
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|save_file_chooser_response (GtkFileChooser * chooser,gint response_id,gpointer data)
name|save_file_chooser_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
name|filename
operator|=
name|gtk_file_chooser_get_filename
argument_list|(
name|chooser
argument_list|)
expr_stmt|;
name|save_callback
argument_list|()
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chooser
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|file_chooser_set_default_folder (GtkFileChooser * chooser)
name|file_chooser_set_default_folder
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|)
block|{
name|GList
modifier|*
name|path_list
decl_stmt|;
name|gchar
modifier|*
name|dir
decl_stmt|;
if|if
condition|(
operator|!
name|fractalexplorer_path
condition|)
return|return;
name|path_list
operator|=
name|gimp_path_parse
argument_list|(
name|fractalexplorer_path
argument_list|,
literal|16
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|dir
operator|=
name|gimp_path_get_user_writable_dir
argument_list|(
name|path_list
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dir
condition|)
name|dir
operator|=
name|g_strdup
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_file_chooser_set_current_folder
argument_list|(
name|chooser
argument_list|,
name|dir
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|dir
argument_list|)
expr_stmt|;
name|gimp_path_free
argument_list|(
name|path_list
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|load_file_chooser_response (GtkFileChooser * chooser,gint response_id,gpointer data)
name|load_file_chooser_response
parameter_list|(
name|GtkFileChooser
modifier|*
name|chooser
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
name|filename
operator|=
name|gtk_file_chooser_get_filename
argument_list|(
name|chooser
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_file_test
argument_list|(
name|filename
argument_list|,
name|G_FILE_TEST_IS_REGULAR
argument_list|)
condition|)
block|{
name|explorer_load
argument_list|()
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|maindlg
argument_list|)
expr_stmt|;
name|dialog_change_scale
argument_list|()
expr_stmt|;
name|set_cmap_preview
argument_list|()
expr_stmt|;
name|dialog_update_preview
argument_list|()
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chooser
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_load_file_chooser (GtkWidget * widget,GtkWidget * dialog)
name|create_load_file_chooser
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|dialog
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|window
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|window
condition|)
block|{
name|window
operator|=
name|gtk_file_chooser_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Load Fractal Parameters"
argument_list|)
argument_list|,
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_FILE_CHOOSER_ACTION_OPEN
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OPEN
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|file_chooser_set_default_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|window
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|load_file_chooser_response
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
block|}
name|gtk_window_present
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|create_save_file_chooser (GtkWidget * widget,GtkWidget * dialog)
name|create_save_file_chooser
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|dialog
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|window
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|window
condition|)
block|{
name|window
operator|=
name|gtk_file_chooser_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Save Fractal Parameters"
argument_list|)
argument_list|,
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_FILE_CHOOSER_ACTION_SAVE
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_SAVE
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|gtk_file_chooser_set_do_overwrite_confirmation
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|window
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|window
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|save_file_chooser_response
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|tpath
condition|)
block|{
name|gtk_file_chooser_set_filename
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|,
name|tpath
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|file_chooser_set_default_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gtk_window_present
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gchar
modifier|*
DECL|function|get_line (gchar * buf,gint s,FILE * from,gint init)
name|get_line
parameter_list|(
name|gchar
modifier|*
name|buf
parameter_list|,
name|gint
name|s
parameter_list|,
name|FILE
modifier|*
name|from
parameter_list|,
name|gint
name|init
parameter_list|)
block|{
name|gint
name|slen
decl_stmt|;
name|gchar
modifier|*
name|ret
decl_stmt|;
if|if
condition|(
name|init
condition|)
name|line_no
operator|=
literal|1
expr_stmt|;
else|else
name|line_no
operator|++
expr_stmt|;
do|do
block|{
name|ret
operator|=
name|fgets
argument_list|(
name|buf
argument_list|,
name|s
argument_list|,
name|from
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
operator|!
name|ferror
argument_list|(
name|from
argument_list|)
operator|&&
name|buf
index|[
literal|0
index|]
operator|==
literal|'#'
condition|)
do|;
name|slen
operator|=
name|strlen
argument_list|(
name|buf
argument_list|)
expr_stmt|;
comment|/* The last newline is a pain */
if|if
condition|(
name|slen
operator|>
literal|0
condition|)
name|buf
index|[
name|slen
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|ferror
argument_list|(
name|from
argument_list|)
condition|)
block|{
name|g_warning
argument_list|(
literal|"Error reading file"
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
name|gint
DECL|function|load_options (fractalexplorerOBJ * xxx,FILE * fp)
name|load_options
parameter_list|(
name|fractalexplorerOBJ
modifier|*
name|xxx
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|gchar
name|load_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|gchar
name|str_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|gchar
name|opt_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
comment|/*  default values  */
name|xxx
operator|->
name|opts
operator|=
name|standardvals
expr_stmt|;
name|xxx
operator|->
name|opts
operator|.
name|gradinvert
operator|=
name|FALSE
expr_stmt|;
name|get_line
argument_list|(
name|load_buf
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|feof
argument_list|(
name|fp
argument_list|)
operator|&&
name|strcmp
argument_list|(
name|load_buf
argument_list|,
literal|"<EOF>"
argument_list|)
condition|)
block|{
comment|/* Get option name */
name|sscanf
argument_list|(
name|load_buf
argument_list|,
literal|"%255s %255s"
argument_list|,
name|str_buf
argument_list|,
name|opt_buf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"fractaltype:"
argument_list|)
condition|)
block|{
name|gint
name|sp
init|=
literal|0
decl_stmt|;
name|sp
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|sp
operator|<
literal|0
condition|)
return|return
operator|-
literal|1
return|;
name|xxx
operator|->
name|opts
operator|.
name|fractaltype
operator|=
name|sp
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"xmin:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|xmin
operator|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"xmax:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|xmax
operator|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"ymin:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|ymin
operator|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"ymax:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|ymax
operator|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"redstretch:"
argument_list|)
condition|)
block|{
name|gdouble
name|sp
init|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|xxx
operator|->
name|opts
operator|.
name|redstretch
operator|=
name|sp
operator|/
literal|128.0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"greenstretch:"
argument_list|)
condition|)
block|{
name|gdouble
name|sp
init|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|xxx
operator|->
name|opts
operator|.
name|greenstretch
operator|=
name|sp
operator|/
literal|128.0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"bluestretch:"
argument_list|)
condition|)
block|{
name|gdouble
name|sp
init|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|xxx
operator|->
name|opts
operator|.
name|bluestretch
operator|=
name|sp
operator|/
literal|128.0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"iter:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|iter
operator|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"cx:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|cx
operator|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"cy:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|cy
operator|=
name|g_ascii_strtod
argument_list|(
name|opt_buf
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"redmode:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|redmode
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"greenmode:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|greenmode
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"bluemode:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|bluemode
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"redinvert:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|redinvert
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"greeninvert:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|greeninvert
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"blueinvert:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|blueinvert
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|str_buf
argument_list|,
literal|"colormode:"
argument_list|)
condition|)
block|{
name|xxx
operator|->
name|opts
operator|.
name|colormode
operator|=
name|atoi
argument_list|(
name|opt_buf
argument_list|)
expr_stmt|;
block|}
name|get_line
argument_list|(
name|load_buf
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
return|return
literal|0
return|;
block|}
end_function

begin_function
name|void
DECL|function|explorer_load (void)
name|explorer_load
parameter_list|(
name|void
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|gchar
name|load_buf
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|g_assert
argument_list|(
name|filename
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|fp
operator|=
name|g_fopen
argument_list|(
name|filename
argument_list|,
literal|"rt"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Could not open '%s' for reading: %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|get_line
argument_list|(
name|load_buf
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|FRACTAL_HEADER
argument_list|,
name|load_buf
argument_list|,
name|strlen
argument_list|(
name|load_buf
argument_list|)
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"'%s' is not a FractalExplorer file"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|load_options
argument_list|(
name|current_obj
argument_list|,
name|fp
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"'%s' is corrupt. Line %d Option section incorrect"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|,
name|line_no
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return;
block|}
name|wvals
operator|=
name|current_obj
operator|->
name|opts
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

