begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* -*- mode: C; c-file-style: "gnu"; c-basic-offset: 2; -*- */
end_comment

begin_comment
comment|/* $Id$  * User interface for plug-in-maze.  *  * Implemented as a GIMP 0.99 Plugin by  * Kevin Turner<acapnotic@users.sourceforge.net>  * http://gimp-plug-ins.sourceforge.net/maze/  */
end_comment

begin_comment
comment|/*  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  *  */
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|SOLO_COMPILE
end_ifndef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"maze.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|BORDER_TOLERANCE
define|#
directive|define
name|BORDER_TOLERANCE
value|1.00
end_define

begin_comment
DECL|macro|BORDER_TOLERANCE
comment|/* maximum ratio of (max % divs) to width */
end_comment

begin_define
DECL|macro|ENTRY_WIDTH
define|#
directive|define
name|ENTRY_WIDTH
value|75
end_define

begin_comment
comment|/* entscale stuff begin */
end_comment

begin_comment
comment|/* FIXME: Entry-Scale stuff is probably in libgimpui by now.           Should use that instead.*/
end_comment

begin_comment
comment|/* Indeed! By using the gimp_scale_entry you could get along without the    EntscaleIntData structure, since it has accessors to all objects  (Sven) */
end_comment

begin_define
DECL|macro|ENTSCALE_INT_SCALE_WIDTH
define|#
directive|define
name|ENTSCALE_INT_SCALE_WIDTH
value|125
end_define

begin_define
DECL|macro|ENTSCALE_INT_ENTRY_WIDTH
define|#
directive|define
name|ENTSCALE_INT_ENTRY_WIDTH
value|40
end_define

begin_define
DECL|macro|MORE
define|#
directive|define
name|MORE
value|1
end_define

begin_define
DECL|macro|LESS
define|#
directive|define
name|LESS
value|-1
end_define

begin_typedef
DECL|typedef|EntscaleIntCallbackFunc
typedef|typedef
name|void
function_decl|(
modifier|*
name|EntscaleIntCallbackFunc
function_decl|)
parameter_list|(
name|gint
name|value
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2c10cf080108
block|{
DECL|member|adjustment
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
DECL|member|entry
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
DECL|member|constraint
name|gint
name|constraint
decl_stmt|;
DECL|member|callback
name|EntscaleIntCallbackFunc
name|callback
decl_stmt|;
DECL|member|call_data
name|gpointer
name|call_data
decl_stmt|;
DECL|typedef|EntscaleIntData
block|}
name|EntscaleIntData
typedef|;
end_typedef

begin_comment
comment|/* entscale stuff end */
end_comment

begin_comment
comment|/* one buffer fits all */
end_comment

begin_define
DECL|macro|BUFSIZE
define|#
directive|define
name|BUFSIZE
value|128
end_define

begin_decl_stmt
DECL|variable|buffer
name|gchar
name|buffer
index|[
name|BUFSIZE
index|]
decl_stmt|;
end_decl_stmt

begin_function_decl
name|gint
name|maze_dialog
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|maze_msg
parameter_list|(
name|gchar
modifier|*
name|msg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|maze_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|maze_help
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|SHOW_PRNG_PRIVATES
end_ifdef

begin_function_decl
specifier|static
name|void
name|maze_entry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Looking back, it would probably have been easier to completely  * re-write the whole entry/scale thing to work with the divbox stuff.  * It would undoubtably be cleaner code.  But since I already *had*  * the entry/scale routines, I was under the (somewhat mistaken)  * impression that it would be easier to work with them... */
end_comment

begin_comment
comment|/* Now, it goes like this:     To update entscale (width) when div_entry changes:      entscale_int_new has been slightly modified to return a pointer to       its entry widget.      This is fed to divbox_new as a "friend", which is in turn fed to       the div_entry_callback routine.  And that's not really so bad,       except...      Oh, well, maybe it isn't so bad.  We can play with our friend's       userdata to block his callbacks so we don't get feedback loops,       that works nicely enough.     To update div_entry when entscale (width) changes:      The entry/scale setup graciously provides for callbacks.  However,       this means we need to know about div_entry when we set up       entry/scale, which we don't...  Chicken and egg problem.  So we       set up a pointer to where div_entry will be, and pass this       through to divbox_new when it happens.      We need to block signal handlers for div_entry this time.  We       happen to know that div_entry's callback data is our old       "friend", so we pull our friend out from where we stuck him in       the entry's userdata...  Hopefully that does it.  */
end_comment

begin_comment
comment|/* Questions:       Gosh that was dumb.  Is there a way to        signal_handler_block_by_name?      That would make life so much nicer.           You could pass the handler_id around and use          gtk_signal_handler_block ().   (Sven) */
end_comment

begin_function_decl
specifier|static
name|void
name|div_button_callback
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GtkWidget
modifier|*
name|entry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|div_entry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|entry
parameter_list|,
name|GtkWidget
modifier|*
name|friend
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|height_width_callback
parameter_list|(
name|gint
name|width
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|div_entry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|divbox_new
parameter_list|(
name|guint
modifier|*
name|max
parameter_list|,
name|GtkWidget
modifier|*
name|friend
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|div_entry
parameter_list|)
function_decl|;
end_function_decl

begin_if
if|#
directive|if
literal|0
end_if

begin_endif
unit|static void div_buttonl_callback (GtkObject *object); static void div_buttonr_callback (GtkObject *object);
endif|#
directive|endif
end_endif

begin_comment
comment|/* entscale stuff begin */
end_comment

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|entscale_int_new
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|gint
modifier|*
name|intvar
parameter_list|,
name|gint
name|min
parameter_list|,
name|gint
name|max
parameter_list|,
name|gboolean
name|constraint
parameter_list|,
name|EntscaleIntCallbackFunc
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_int_destroy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_int_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|entscale_int_entry_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_define
DECL|macro|ISODD (X)
define|#
directive|define
name|ISODD
parameter_list|(
name|X
parameter_list|)
value|((X)& 1)
end_define

begin_comment
comment|/* entscale stuff end */
end_comment

begin_decl_stmt
specifier|extern
name|MazeValues
name|mvals
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|guint
name|sel_w
decl_stmt|,
name|sel_h
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|maze_run
specifier|static
name|gint
name|maze_run
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|msg_label
specifier|static
name|GtkWidget
modifier|*
name|msg_label
decl_stmt|;
end_decl_stmt

begin_function
name|gint
DECL|function|maze_dialog (void)
name|maze_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|tilecheck
decl_stmt|;
name|GtkWidget
modifier|*
name|width_entry
decl_stmt|,
modifier|*
name|height_entry
decl_stmt|;
name|GtkWidget
modifier|*
name|seed_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|div_x_hbox
decl_stmt|,
modifier|*
name|div_y_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|div_x_entry
decl_stmt|,
modifier|*
name|div_y_entry
decl_stmt|;
name|gint
name|trow
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|message
decl_stmt|;
name|gimp_ui_init
argument_list|(
literal|"maze"
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dlg
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
name|MAZE_TITLE
argument_list|)
argument_list|,
literal|"maze"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"filters/maze.html"
argument_list|,
name|GTK_STOCK_HELP
argument_list|,
name|GTK_RESPONSE_HELP
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dlg
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|maze_response
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dlg
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_main_quit
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|_
argument_list|(
literal|"Parameter Settings"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|SHOW_PRNG_PRIVATES
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|8
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
else|#
directive|else
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
comment|/* entscale == Entry and Scale pair function found in pixelize.c */
name|width_entry
operator|=
name|entscale_int_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|_
argument_list|(
literal|"Width (Pixels):"
argument_list|)
argument_list|,
operator|&
name|mvals
operator|.
name|width
argument_list|,
literal|1
argument_list|,
name|sel_w
operator|/
literal|4
argument_list|,
name|TRUE
argument_list|,
operator|(
name|EntscaleIntCallbackFunc
operator|)
name|height_width_callback
argument_list|,
operator|&
name|div_x_entry
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
comment|/* Number of Divisions entry */
name|div_x_hbox
operator|=
name|divbox_new
argument_list|(
operator|&
name|sel_w
argument_list|,
name|width_entry
argument_list|,
operator|&
name|div_x_entry
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
operator|(
name|sel_w
operator|/
name|mvals
operator|.
name|width
operator|)
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|div_x_entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|_
argument_list|(
literal|"Pieces:"
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|,
name|div_x_hbox
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|trow
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
name|height_entry
operator|=
name|entscale_int_new
argument_list|(
name|table
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|_
argument_list|(
literal|"Height (Pixels):"
argument_list|)
argument_list|,
operator|&
name|mvals
operator|.
name|height
argument_list|,
literal|1
argument_list|,
name|sel_h
operator|/
literal|4
argument_list|,
name|TRUE
argument_list|,
operator|(
name|EntscaleIntCallbackFunc
operator|)
name|height_width_callback
argument_list|,
operator|&
name|div_y_entry
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
name|div_y_hbox
operator|=
name|divbox_new
argument_list|(
operator|&
name|sel_h
argument_list|,
name|height_entry
argument_list|,
operator|&
name|div_y_entry
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
operator|(
name|sel_h
operator|/
name|mvals
operator|.
name|height
operator|)
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|div_y_entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|_
argument_list|(
literal|"Pieces:"
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|,
name|div_y_hbox
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|trow
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
ifdef|#
directive|ifdef
name|SHOW_PRNG_PRIVATES
comment|/* Multiple input box */
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
name|mvals
operator|.
name|multiple
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|_
argument_list|(
literal|"Multiple (57):"
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
name|g_signal_connect
argument_list|(
name|entry
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|maze_entry_callback
argument_list|)
argument_list|,
operator|&
name|mvals
operator|.
name|multiple
argument_list|)
expr_stmt|;
comment|/* Offset input box */
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
name|mvals
operator|.
name|offset
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|_
argument_list|(
literal|"Offset (1):"
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
name|g_signal_connect
argument_list|(
name|entry
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|maze_entry_callback
argument_list|)
argument_list|,
operator|&
name|mvals
operator|.
name|offset
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Tileable checkbox */
name|tilecheck
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Tileable"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|tilecheck
argument_list|)
argument_list|,
name|mvals
operator|.
name|tile
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|NULL
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|,
name|tilecheck
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
name|g_signal_connect
argument_list|(
name|tilecheck
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|mvals
operator|.
name|tile
argument_list|)
expr_stmt|;
comment|/* Seed input box */
name|seed_hbox
operator|=
name|gimp_random_seed_new
argument_list|(
operator|&
name|mvals
operator|.
name|seed
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
name|trow
argument_list|,
name|_
argument_list|(
literal|"Seed:"
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|,
name|seed_hbox
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|trow
operator|++
expr_stmt|;
comment|/* Algorithm Choice */
name|frame
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"Style"
argument_list|)
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_radio_button_update
argument_list|)
argument_list|,
operator|&
name|mvals
operator|.
name|algorithm
argument_list|,
name|mvals
operator|.
name|algorithm
argument_list|,
name|_
argument_list|(
literal|"Depth First"
argument_list|)
argument_list|,
name|DEPTH_FIRST
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Prim's Algorithm"
argument_list|)
argument_list|,
name|PRIMS_ALGORITHM
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Message label */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Selection is %dx%d"
argument_list|)
argument_list|,
name|sel_w
argument_list|,
name|sel_h
argument_list|)
expr_stmt|;
name|msg_label
operator|=
name|gtk_label_new
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|msg_label
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|msg_label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|msg_label
argument_list|)
expr_stmt|;
name|gtk_widget_show_all
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
return|return
name|maze_run
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|divbox_new (guint * max,GtkWidget * friend,GtkWidget ** div_entry)
name|divbox_new
parameter_list|(
name|guint
modifier|*
name|max
parameter_list|,
name|GtkWidget
modifier|*
name|friend
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|div_entry
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|align
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|arrowl
decl_stmt|,
modifier|*
name|arrowr
decl_stmt|;
name|GtkWidget
modifier|*
name|buttonl
decl_stmt|,
modifier|*
name|buttonr
decl_stmt|;
if|#
directive|if
name|DIVBOX_LOOKS_LIKE_SPINBUTTON
name|GtkWidget
modifier|*
name|buttonbox
decl_stmt|;
endif|#
directive|endif
name|align
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|align
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
if|#
directive|if
name|DIVBOX_LOOKS_LIKE_SPINBUTTON
name|arrowl
operator|=
name|gtk_arrow_new
argument_list|(
name|GTK_ARROW_DOWN
argument_list|,
name|GTK_SHADOW_OUT
argument_list|)
expr_stmt|;
name|arrowr
operator|=
name|gtk_arrow_new
argument_list|(
name|GTK_ARROW_UP
argument_list|,
name|GTK_SHADOW_OUT
argument_list|)
expr_stmt|;
else|#
directive|else
name|arrowl
operator|=
name|gtk_arrow_new
argument_list|(
name|GTK_ARROW_LEFT
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|arrowr
operator|=
name|gtk_arrow_new
argument_list|(
name|GTK_ARROW_RIGHT
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|buttonl
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|buttonr
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|buttonl
argument_list|)
argument_list|,
literal|"direction"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|LESS
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|buttonr
argument_list|)
argument_list|,
literal|"direction"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|MORE
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|div_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
operator|*
name|div_entry
argument_list|)
argument_list|,
literal|"max"
argument_list|,
name|max
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
operator|*
name|div_entry
argument_list|)
argument_list|,
literal|"friend"
argument_list|,
name|friend
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|buttonl
argument_list|)
argument_list|,
name|arrowl
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|buttonr
argument_list|)
argument_list|,
name|arrowr
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
operator|*
name|div_entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|#
directive|if
name|DIVBOX_LOOKS_LIKE_SPINBUTTON
name|buttonbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|buttonbox
argument_list|)
argument_list|,
name|buttonr
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|buttonbox
argument_list|)
argument_list|,
name|buttonl
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|buttonbox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
operator|*
name|div_entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|buttonbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|#
directive|else
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|arrowl
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|arrowr
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|buttonl
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
operator|*
name|div_entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|buttonr
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|gtk_widget_show_all
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|buttonl
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|div_button_callback
argument_list|)
argument_list|,
operator|*
name|div_entry
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|buttonr
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|div_button_callback
argument_list|)
argument_list|,
operator|*
name|div_entry
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
operator|*
name|div_entry
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|div_entry_callback
argument_list|)
argument_list|,
name|friend
argument_list|)
expr_stmt|;
return|return
name|align
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|div_button_callback (GtkWidget * button,GtkWidget * entry)
name|div_button_callback
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GtkWidget
modifier|*
name|entry
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|text
decl_stmt|;
name|guint
name|max
decl_stmt|,
name|divs
decl_stmt|;
name|gint
name|direction
decl_stmt|;
name|direction
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"direction"
argument_list|)
argument_list|)
expr_stmt|;
name|max
operator|=
operator|*
operator|(
operator|(
name|guint
operator|*
operator|)
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"max"
argument_list|)
operator|)
expr_stmt|;
comment|/* Tileable mazes shall have only an even number of divisions.      Other mazes have odd. */
comment|/* Sanity check: */
if|if
condition|(
name|mvals
operator|.
name|tile
operator|&&
name|ISODD
argument_list|(
name|max
argument_list|)
condition|)
block|{
name|maze_msg
argument_list|(
name|_
argument_list|(
literal|"Selection size is not even.\n"
literal|"Tileable maze won't work perfectly."
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|)
expr_stmt|;
name|divs
operator|=
name|atoi
argument_list|(
name|text
argument_list|)
expr_stmt|;
if|if
condition|(
name|divs
operator|<=
literal|3
condition|)
block|{
name|divs
operator|=
name|mvals
operator|.
name|tile
condition|?
name|max
operator|-
operator|(
name|ISODD
argument_list|(
name|max
argument_list|)
condition|?
literal|1
else|:
literal|0
operator|)
else|:
name|max
operator|-
operator|(
name|ISODD
argument_list|(
name|max
argument_list|)
condition|?
literal|0
else|:
literal|1
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|divs
operator|>
name|max
condition|)
block|{
name|divs
operator|=
name|mvals
operator|.
name|tile
condition|?
literal|6
else|:
literal|5
expr_stmt|;
block|}
comment|/* Makes sure we're appropriately even or odd, adjusting in the      proper direction. */
name|divs
operator|+=
name|direction
operator|*
operator|(
name|mvals
operator|.
name|tile
condition|?
operator|(
name|ISODD
argument_list|(
name|divs
argument_list|)
condition|?
literal|1
else|:
literal|0
operator|)
else|:
operator|(
name|ISODD
argument_list|(
name|divs
argument_list|)
condition|?
literal|0
else|:
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|mvals
operator|.
name|tile
condition|)
block|{
if|if
condition|(
name|direction
operator|>
literal|0
condition|)
block|{
do|do
block|{
name|divs
operator|+=
literal|2
expr_stmt|;
if|if
condition|(
name|divs
operator|>
name|max
condition|)
name|divs
operator|=
literal|4
expr_stmt|;
block|}
do|while
condition|(
name|max
operator|%
name|divs
condition|)
do|;
block|}
else|else
block|{
comment|/* direction< 0 */
do|do
block|{
name|divs
operator|-=
literal|2
expr_stmt|;
if|if
condition|(
name|divs
operator|<
literal|4
condition|)
name|divs
operator|=
name|max
operator|-
operator|(
name|max
operator|&
literal|1
operator|)
expr_stmt|;
block|}
do|while
condition|(
name|max
operator|%
name|divs
condition|)
do|;
block|}
comment|/* endif direction< 0 */
block|}
else|else
block|{
comment|/* If not tiling, having a non-zero remainder doesn't bother us much. */
if|if
condition|(
name|direction
operator|>
literal|0
condition|)
block|{
do|do
block|{
name|divs
operator|+=
literal|2
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|max
operator|%
name|divs
operator|>
name|max
operator|/
name|divs
operator|*
name|BORDER_TOLERANCE
operator|)
operator|&&
name|divs
operator|<
name|max
condition|)
do|;
block|}
else|else
block|{
comment|/* direction< 0 */
do|do
block|{
name|divs
operator|-=
literal|2
expr_stmt|;
block|}
do|while
condition|(
operator|(
name|max
operator|%
name|divs
operator|>
name|max
operator|/
name|divs
operator|*
name|BORDER_TOLERANCE
operator|)
operator|&&
name|divs
operator|>
literal|5
condition|)
do|;
block|}
comment|/* endif direction< 0 */
block|}
comment|/* endif not tiling */
if|if
condition|(
name|divs
operator|<=
literal|3
condition|)
block|{
name|divs
operator|=
name|mvals
operator|.
name|tile
condition|?
name|max
operator|-
operator|(
name|ISODD
argument_list|(
name|max
argument_list|)
condition|?
literal|1
else|:
literal|0
operator|)
else|:
name|max
operator|-
operator|(
name|ISODD
argument_list|(
name|max
argument_list|)
condition|?
literal|0
else|:
literal|1
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|divs
operator|>
name|max
condition|)
block|{
name|divs
operator|=
name|mvals
operator|.
name|tile
condition|?
literal|4
else|:
literal|5
expr_stmt|;
block|}
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
name|divs
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|div_entry_callback (GtkWidget * entry,GtkWidget * friend)
name|div_entry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|entry
parameter_list|,
name|GtkWidget
modifier|*
name|friend
parameter_list|)
block|{
name|guint
name|divs
decl_stmt|,
name|width
decl_stmt|,
name|max
decl_stmt|;
name|EntscaleIntData
modifier|*
name|userdata
decl_stmt|;
name|EntscaleIntCallbackFunc
name|friend_callback
decl_stmt|;
name|divs
operator|=
name|atoi
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|divs
operator|<
literal|4
condition|)
comment|/* If this is under 4 (e.g. 0), something's weird.      */
return|return;
comment|/* But it'll probably be ok, so just return and ignore. */
name|max
operator|=
operator|*
operator|(
operator|(
name|guint
operator|*
operator|)
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"max"
argument_list|)
operator|)
expr_stmt|;
comment|/* I say "width" here, but it could be height.*/
name|width
operator|=
name|max
operator|/
name|divs
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
name|width
argument_list|)
expr_stmt|;
comment|/* No tagbacks from our friend... */
name|userdata
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|friend
argument_list|)
argument_list|,
literal|"userdata"
argument_list|)
expr_stmt|;
name|friend_callback
operator|=
name|userdata
operator|->
name|callback
expr_stmt|;
name|userdata
operator|->
name|callback
operator|=
name|NULL
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|friend
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|userdata
operator|->
name|callback
operator|=
name|friend_callback
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|height_width_callback (gint width,GtkWidget ** div_entry)
name|height_width_callback
parameter_list|(
name|gint
name|width
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|div_entry
parameter_list|)
block|{
name|guint
name|divs
decl_stmt|,
name|max
decl_stmt|;
name|gpointer
name|data
decl_stmt|;
name|max
operator|=
operator|*
operator|(
operator|(
name|guint
operator|*
operator|)
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
operator|*
name|div_entry
argument_list|)
argument_list|,
literal|"max"
argument_list|)
operator|)
expr_stmt|;
name|divs
operator|=
name|max
operator|/
name|width
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
name|divs
argument_list|)
expr_stmt|;
name|data
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
operator|*
name|div_entry
argument_list|)
argument_list|,
literal|"friend"
argument_list|)
expr_stmt|;
name|g_signal_handlers_block_by_func
argument_list|(
operator|*
name|div_entry
argument_list|,
name|entscale_int_entry_update
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
operator|*
name|div_entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|g_signal_handlers_unblock_by_func
argument_list|(
operator|*
name|div_entry
argument_list|,
name|entscale_int_entry_update
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|maze_help (void)
name|maze_help
parameter_list|(
name|void
parameter_list|)
block|{
name|gchar
modifier|*
name|proc_blurb
decl_stmt|;
name|gchar
modifier|*
name|proc_help
decl_stmt|;
name|gchar
modifier|*
name|proc_author
decl_stmt|;
name|gchar
modifier|*
name|proc_copyright
decl_stmt|;
name|gchar
modifier|*
name|proc_date
decl_stmt|;
name|GimpPDBProcType
name|proc_type
decl_stmt|;
name|gint
name|nparams
decl_stmt|;
name|gint
name|nreturn_vals
decl_stmt|;
name|GimpParamDef
modifier|*
name|params
decl_stmt|;
name|GimpParamDef
modifier|*
name|return_vals
decl_stmt|;
name|gint
name|baz
decl_stmt|;
name|gchar
modifier|*
name|message
decl_stmt|;
if|if
condition|(
name|gimp_procedural_db_proc_info
argument_list|(
literal|"plug_in_web_browser"
argument_list|,
operator|&
name|proc_blurb
argument_list|,
operator|&
name|proc_help
argument_list|,
operator|&
name|proc_author
argument_list|,
operator|&
name|proc_copyright
argument_list|,
operator|&
name|proc_date
argument_list|,
operator|&
name|proc_type
argument_list|,
operator|&
name|nparams
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
operator|&
name|params
argument_list|,
operator|&
name|return_vals
argument_list|)
condition|)
block|{
comment|/* open URL for help */
name|message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Opening %s"
argument_list|)
argument_list|,
name|MAZE_URL
argument_list|)
expr_stmt|;
name|maze_msg
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|gimp_run_procedure
argument_list|(
literal|"plug_in_web_browser"
argument_list|,
operator|&
name|baz
argument_list|,
name|GIMP_PDB_STRING
argument_list|,
name|MAZE_URL
argument_list|,
name|GIMP_PDB_END
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"See %s"
argument_list|)
argument_list|,
name|MAZE_URL
argument_list|)
expr_stmt|;
name|maze_msg
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|message
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|maze_msg (gchar * msg)
name|maze_msg
parameter_list|(
name|gchar
modifier|*
name|msg
parameter_list|)
block|{
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|msg_label
argument_list|)
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|maze_response (GtkWidget * widget,gint response_id,gpointer data)
name|maze_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|response_id
condition|)
block|{
case|case
name|GTK_RESPONSE_HELP
case|:
name|maze_help
argument_list|()
expr_stmt|;
break|break;
case|case
name|GTK_RESPONSE_OK
case|:
name|maze_run
operator|=
name|TRUE
expr_stmt|;
default|default:
name|gtk_widget_destroy
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|SHOW_PRNG_PRIVATES
end_ifdef

begin_function
specifier|static
name|void
DECL|function|maze_entry_callback (GtkWidget * widget,gpointer data)
name|maze_entry_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gint
modifier|*
name|text_val
decl_stmt|;
name|text_val
operator|=
operator|(
name|gint
operator|*
operator|)
name|data
expr_stmt|;
operator|*
name|text_val
operator|=
name|atoi
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ==================================================================== */
end_comment

begin_comment
comment|/* As found in pixelize.c,  * hacked to return a pointer to the entry widget. */
end_comment

begin_comment
comment|/*   Entry and Scale pair 1.03    TODO:   - Do the proper thing when the user changes value in entry,   so that callback should not be called when value is actually not changed.   - Update delay  */
end_comment

begin_comment
comment|/*  *  entscale: create new entscale with label. (int)  *  1 row and 2 cols of table are needed.  *  Input:  *    x, y:       starting row and col in table  *    caption:    label string  *    intvar:     pointer to variable  *    min, max:   the boundary of scale  *    constraint: (bool) true iff the value of *intvar should be constraint  *                by min and max  *    callback:	  called when the value is actually changed  *    call_data:  data for callback func  */
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|entscale_int_new (GtkWidget * table,gint x,gint y,gchar * caption,gint * intvar,gint min,gint max,gboolean constraint,EntscaleIntCallbackFunc callback,gpointer call_data)
name|entscale_int_new
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gchar
modifier|*
name|caption
parameter_list|,
name|gint
modifier|*
name|intvar
parameter_list|,
name|gint
name|min
parameter_list|,
name|gint
name|max
parameter_list|,
name|gboolean
name|constraint
parameter_list|,
name|EntscaleIntCallbackFunc
name|callback
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
block|{
name|EntscaleIntData
modifier|*
name|userdata
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
name|gint
name|constraint_val
decl_stmt|;
name|userdata
operator|=
name|g_new
argument_list|(
name|EntscaleIntData
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|caption
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
comment|/*     If the first arg of gtk_adjustment_new() isn't between min and     max, it is automatically corrected by gtk later with     "value_changed" signal. I don't like this, since I want to leave     *intvar untouched when `constraint' is false.     The lines below might look oppositely, but this is OK.    */
name|userdata
operator|->
name|constraint
operator|=
name|constraint
expr_stmt|;
if|if
condition|(
name|constraint
condition|)
name|constraint_val
operator|=
operator|*
name|intvar
expr_stmt|;
else|else
name|constraint_val
operator|=
operator|(
operator|*
name|intvar
operator|<
name|min
condition|?
name|min
else|:
operator|*
name|intvar
operator|>
name|max
condition|?
name|max
else|:
operator|*
name|intvar
operator|)
expr_stmt|;
name|userdata
operator|->
name|adjustment
operator|=
name|adjustment
operator|=
name|gtk_adjustment_new
argument_list|(
name|constraint_val
argument_list|,
name|min
argument_list|,
name|max
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|scale
argument_list|,
name|ENTSCALE_INT_SCALE_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_scale_set_draw_value
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|userdata
operator|->
name|entry
operator|=
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|entry
argument_list|,
name|ENTSCALE_INT_ENTRY_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
operator|*
name|intvar
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|userdata
operator|->
name|callback
operator|=
name|callback
expr_stmt|;
name|userdata
operator|->
name|call_data
operator|=
name|call_data
expr_stmt|;
comment|/* userdata is done */
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|,
literal|"userdata"
argument_list|,
name|userdata
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"userdata"
argument_list|,
name|userdata
argument_list|)
expr_stmt|;
comment|/* now ready for signals */
name|g_signal_connect
argument_list|(
name|entry
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|entscale_int_entry_update
argument_list|)
argument_list|,
name|intvar
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adjustment
argument_list|,
literal|"value_changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|entscale_int_scale_update
argument_list|)
argument_list|,
name|intvar
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|entry
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|entscale_int_destroy_callback
argument_list|)
argument_list|,
name|userdata
argument_list|)
expr_stmt|;
comment|/* start packing */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|scale
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
name|x
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|x
operator|+
literal|2
argument_list|,
name|y
argument_list|,
name|y
operator|+
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
return|return
name|entry
return|;
block|}
end_function

begin_comment
comment|/* when destroyed, userdata is destroyed too */
end_comment

begin_function
specifier|static
name|void
DECL|function|entscale_int_destroy_callback (GtkWidget * widget,gpointer data)
name|entscale_int_destroy_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|EntscaleIntData
modifier|*
name|userdata
decl_stmt|;
name|userdata
operator|=
name|data
expr_stmt|;
name|g_free
argument_list|(
name|userdata
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|entscale_int_scale_update (GtkAdjustment * adjustment,gpointer data)
name|entscale_int_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|EntscaleIntData
modifier|*
name|userdata
decl_stmt|;
name|GtkEntry
modifier|*
name|entry
decl_stmt|;
name|gint
modifier|*
name|intvar
init|=
name|data
decl_stmt|;
name|gint
name|new_val
decl_stmt|;
name|userdata
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|adjustment
argument_list|)
argument_list|,
literal|"userdata"
argument_list|)
expr_stmt|;
name|new_val
operator|=
operator|(
name|gint
operator|)
name|adjustment
operator|->
name|value
expr_stmt|;
operator|*
name|intvar
operator|=
name|new_val
expr_stmt|;
name|entry
operator|=
name|GTK_ENTRY
argument_list|(
name|userdata
operator|->
name|entry
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
name|BUFSIZE
argument_list|,
literal|"%d"
argument_list|,
operator|(
name|int
operator|)
name|new_val
argument_list|)
expr_stmt|;
comment|/* avoid infinite loop (scale, entry, scale, entry ...) */
name|g_signal_handlers_block_by_func
argument_list|(
name|entry
argument_list|,
name|entscale_int_entry_update
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|entry
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|g_signal_handlers_unblock_by_func
argument_list|(
name|entry
argument_list|,
name|entscale_int_entry_update
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|userdata
operator|->
name|callback
condition|)
call|(
modifier|*
name|userdata
operator|->
name|callback
call|)
argument_list|(
operator|*
name|intvar
argument_list|,
name|userdata
operator|->
name|call_data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|entscale_int_entry_update (GtkWidget * widget,gpointer data)
name|entscale_int_entry_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|EntscaleIntData
modifier|*
name|userdata
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|gint
name|new_val
decl_stmt|,
name|constraint_val
decl_stmt|;
name|gint
modifier|*
name|intvar
init|=
name|data
decl_stmt|;
name|userdata
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"userdata"
argument_list|)
expr_stmt|;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|userdata
operator|->
name|adjustment
argument_list|)
expr_stmt|;
name|new_val
operator|=
name|atoi
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|constraint_val
operator|=
name|new_val
expr_stmt|;
if|if
condition|(
name|constraint_val
operator|<
name|adjustment
operator|->
name|lower
condition|)
name|constraint_val
operator|=
name|adjustment
operator|->
name|lower
expr_stmt|;
if|if
condition|(
name|constraint_val
operator|>
name|adjustment
operator|->
name|upper
condition|)
name|constraint_val
operator|=
name|adjustment
operator|->
name|upper
expr_stmt|;
if|if
condition|(
name|userdata
operator|->
name|constraint
condition|)
operator|*
name|intvar
operator|=
name|constraint_val
expr_stmt|;
else|else
operator|*
name|intvar
operator|=
name|new_val
expr_stmt|;
name|adjustment
operator|->
name|value
operator|=
name|constraint_val
expr_stmt|;
name|g_signal_handlers_block_by_func
argument_list|(
name|adjustment
argument_list|,
name|entscale_int_scale_update
argument_list|,
name|data
argument_list|)
expr_stmt|;
name|gtk_adjustment_value_changed
argument_list|(
name|adjustment
argument_list|)
expr_stmt|;
name|g_signal_handlers_unblock_by_func
argument_list|(
name|adjustment
argument_list|,
name|entscale_int_scale_update
argument_list|,
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|userdata
operator|->
name|callback
condition|)
call|(
modifier|*
name|userdata
operator|->
name|callback
call|)
argument_list|(
operator|*
name|intvar
argument_list|,
name|userdata
operator|->
name|call_data
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

