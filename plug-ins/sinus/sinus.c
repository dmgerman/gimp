begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * This is a plugin for the GIMP.  *  * Copyright (C) 1997 Xavier Bouchoux  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  *  */
end_comment

begin_comment
comment|/*  * This plug-in produces sinus textures.  *  * Please send any patches or suggestions to me: Xavier.Bouchoux@ensimag.imag.fr.  */
end_comment

begin_comment
comment|/* Version 0.99 */
end_comment

begin_define
DECL|macro|USE_LOGO
define|#
directive|define
name|USE_LOGO
end_define

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdk.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<plug-ins/megawidget/megawidget.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|USE_LOGO
end_ifdef

begin_include
include|#
directive|include
file|"sinus_logo.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_define
DECL|macro|inline
define|#
directive|define
name|inline
value|inline
end_define

begin_else
else|#
directive|else
end_else

begin_define
DECL|macro|inline
define|#
directive|define
name|inline
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|ROUND_TO_INT (val)
define|#
directive|define
name|ROUND_TO_INT
parameter_list|(
name|val
parameter_list|)
value|((val) + 0.5)
end_define

begin_typedef
DECL|typedef|colRGBA
typedef|typedef
name|gdouble
name|colRGBA
index|[
literal|4
index|]
typedef|;
end_typedef

begin_comment
comment|/*  * This structure is used for persistent data.  */
end_comment

begin_define
DECL|macro|B_W
define|#
directive|define
name|B_W
value|0
end_define

begin_comment
DECL|macro|B_W
comment|/* colors setting */
end_comment

begin_define
DECL|macro|USE_FG_BG
define|#
directive|define
name|USE_FG_BG
value|1
end_define

begin_define
DECL|macro|USE_COLORS
define|#
directive|define
name|USE_COLORS
value|2
end_define

begin_define
DECL|macro|LINEAR
define|#
directive|define
name|LINEAR
value|0
end_define

begin_comment
DECL|macro|LINEAR
comment|/* colorization settings */
end_comment

begin_define
DECL|macro|BILINEAR
define|#
directive|define
name|BILINEAR
value|1
end_define

begin_define
DECL|macro|SINUS
define|#
directive|define
name|SINUS
value|2
end_define

begin_define
DECL|macro|IDEAL
define|#
directive|define
name|IDEAL
value|0
end_define

begin_comment
DECL|macro|IDEAL
comment|/* Perturbation settings */
end_comment

begin_define
DECL|macro|PERTURBED
define|#
directive|define
name|PERTURBED
value|1
end_define

begin_typedef
DECL|struct|__anon2b92fecd0108
typedef|typedef
struct|struct
block|{
DECL|member|scalex
DECL|member|scaley
name|gdouble
name|scalex
decl_stmt|,
name|scaley
decl_stmt|;
DECL|member|cmplx
name|gdouble
name|cmplx
decl_stmt|;
DECL|member|blend_power
name|gdouble
name|blend_power
decl_stmt|;
DECL|member|seed
name|gint
name|seed
decl_stmt|;
DECL|member|tiling
name|gint
name|tiling
decl_stmt|;
DECL|member|perturbation
name|gint
name|perturbation
decl_stmt|;
DECL|member|colorization
name|gint
name|colorization
decl_stmt|;
DECL|member|colors
name|gint
name|colors
decl_stmt|;
DECL|member|col1
DECL|member|col2
name|colRGBA
name|col1
decl_stmt|,
name|col2
decl_stmt|;
DECL|typedef|SinusVals
block|}
name|SinusVals
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|svals
specifier|static
name|SinusVals
name|svals
init|=
block|{
literal|15.0
block|,
literal|15.0
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|42
block|,
name|TRUE
block|,
name|PERTURBED
block|,
name|LINEAR
block|,
name|USE_COLORS
block|,
block|{
literal|1
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|1
block|,
literal|1
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_typedef
DECL|struct|__anon2b92fecd0208
typedef|typedef
struct|struct
block|{
DECL|member|height
DECL|member|width
name|gint
name|height
decl_stmt|,
name|width
decl_stmt|;
DECL|member|c11
DECL|member|c12
DECL|member|c13
DECL|member|c21
DECL|member|c22
DECL|member|c23
DECL|member|c31
DECL|member|c32
DECL|member|c33
name|double
name|c11
decl_stmt|,
name|c12
decl_stmt|,
name|c13
decl_stmt|,
name|c21
decl_stmt|,
name|c22
decl_stmt|,
name|c23
decl_stmt|,
name|c31
decl_stmt|,
name|c32
decl_stmt|,
name|c33
decl_stmt|;
DECL|member|blend
name|double
function_decl|(
modifier|*
name|blend
function_decl|)
parameter_list|(
name|double
parameter_list|)
function_decl|;
DECL|member|r
DECL|member|g
DECL|member|b
DECL|member|a
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
DECL|member|dr
DECL|member|dg
DECL|member|db
DECL|member|da
name|int
name|dr
decl_stmt|,
name|dg
decl_stmt|,
name|db
decl_stmt|,
name|da
decl_stmt|;
DECL|typedef|params
block|}
name|params
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|drawable_is_grayscale
specifier|static
name|gint
name|drawable_is_grayscale
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|thePreview
specifier|static
name|struct
name|mwPreview
modifier|*
name|thePreview
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|drawable
specifier|static
name|GDrawable
modifier|*
name|drawable
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Declare functions */
end_comment

begin_function_decl
specifier|static
name|void
name|query
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|sinus
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
name|double
name|frac
parameter_list|(
name|double
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|double
name|linear
parameter_list|(
name|double
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|double
name|bilinear
parameter_list|(
name|double
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|double
name|cosinus
parameter_list|(
name|double
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|int
name|sinus_dialog
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|sinus_do_preview
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|DrawPreviewImage
parameter_list|(
name|gint
name|DoCompute
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|inline
name|void
name|compute_block_4
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|h
parameter_list|,
name|gint
name|w
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|inline
name|void
name|compute_block_3
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|h
parameter_list|,
name|gint
name|w
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|inline
name|void
name|compute_block_2
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|h
parameter_list|,
name|gint
name|w
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|inline
name|void
name|compute_block_1
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|h
parameter_list|,
name|gint
name|w
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc */
name|NULL
block|,
comment|/* quit_proc */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc */
block|}
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|()
block|{
specifier|static
name|GParamDef
name|args
index|[]
init|=
block|{
block|{
name|PARAM_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|PARAM_IMAGE
block|,
literal|"image"
block|,
literal|"Input image (unused)"
block|}
block|,
block|{
name|PARAM_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"xscale"
block|,
literal|"Scale value for x axis"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"yscale"
block|,
literal|"Scale value dor y axis"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"complex"
block|,
literal|"Complexity factor"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"seed"
block|,
literal|"Seed value for random number generator"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"tiling"
block|,
literal|"If set, the pattern generated will tile"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"perturb"
block|,
literal|"If set, the pattern is a little more distorted..."
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"colors"
block|,
literal|"where to take the colors (0= B&W,  1= fg/bg, 2= col1/col2)"
block|}
block|,
comment|/*    { PARAM_COLOR, "col1", "fist color (sometimes unused)" },     { PARAM_COLOR, "col2", "second color (sometimes unused)" },*/
block|{
name|PARAM_FLOAT
block|,
literal|"alpha1"
block|,
literal|"alpha for the first color (used if the drawable has an alpha chanel)"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"alpha2"
block|,
literal|"alpha for the second color (used if the drawable has an alpha chanel)"
block|}
block|,
block|{
name|PARAM_INT32
block|,
literal|"blend"
block|,
literal|"0= linear, 1= bilinear, 2= sinusoidal"
block|}
block|,
block|{
name|PARAM_FLOAT
block|,
literal|"blend_power"
block|,
literal|"Power used to strech the blend"
block|}
block|}
decl_stmt|;
specifier|static
name|GParamDef
modifier|*
name|return_vals
init|=
name|NULL
decl_stmt|;
specifier|static
name|gint
name|nargs
init|=
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
specifier|static
name|gint
name|nreturn_vals
init|=
literal|0
decl_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"plug_in_sinus"
argument_list|,
literal|"Generates a texture with sinus functions"
argument_list|,
literal|"FIX ME: sinus help"
argument_list|,
literal|"Xavier Bouchoux"
argument_list|,
literal|"Xavier Bouchoux"
argument_list|,
literal|"1997"
argument_list|,
literal|"<Image>/Filters/Render/Sinus"
argument_list|,
literal|"RGB*, GRAY*"
argument_list|,
name|PROC_PLUG_IN
argument_list|,
name|nargs
argument_list|,
name|nreturn_vals
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|run (gchar * name,gint nparams,GParam * param,gint * nreturn_vals,GParam ** return_vals)
specifier|static
name|void
name|run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GParam
name|values
index|[
literal|1
index|]
decl_stmt|;
name|GRunModeType
name|run_mode
decl_stmt|;
name|GStatusType
name|status
init|=
name|STATUS_SUCCESS
decl_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|RUN_INTERACTIVE
case|:
comment|/*  Possibly retrieve data  */
name|gimp_get_data
argument_list|(
literal|"plug_in_sinus"
argument_list|,
operator|&
name|svals
argument_list|)
expr_stmt|;
comment|/* In order to prepare the dialog I need to know wether it's grayscale or not */
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
name|thePreview
operator|=
name|mw_preview_build_virgin
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_drawable_gray
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
condition|)
name|drawable_is_grayscale
operator|=
name|TRUE
expr_stmt|;
else|else
name|drawable_is_grayscale
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|!
name|sinus_dialog
argument_list|()
condition|)
return|return;
break|break;
case|case
name|RUN_NONINTERACTIVE
case|:
comment|/*  Make sure all the arguments are there!  */
if|if
condition|(
name|nparams
operator|!=
literal|14
condition|)
name|status
operator|=
name|STATUS_CALLING_ERROR
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|STATUS_SUCCESS
condition|)
block|{
name|svals
operator|.
name|seed
operator|=
name|param
index|[
literal|6
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|svals
operator|.
name|scalex
operator|=
name|param
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|svals
operator|.
name|scaley
operator|=
name|param
index|[
literal|4
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|svals
operator|.
name|cmplx
operator|=
name|param
index|[
literal|5
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|svals
operator|.
name|blend_power
operator|=
name|param
index|[
literal|15
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|svals
operator|.
name|tiling
operator|=
name|param
index|[
literal|7
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|svals
operator|.
name|perturbation
operator|=
name|param
index|[
literal|8
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|svals
operator|.
name|colorization
operator|=
name|param
index|[
literal|14
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|svals
operator|.
name|colors
operator|=
name|param
index|[
literal|9
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|svals
operator|.
name|col1
index|[
literal|3
index|]
operator|=
name|param
index|[
literal|12
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|svals
operator|.
name|col2
index|[
literal|3
index|]
operator|=
name|param
index|[
literal|13
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|svals
operator|.
name|col1
index|[
literal|0
index|]
operator|=
name|param
index|[
literal|10
index|]
operator|.
name|data
operator|.
name|d_color
operator|.
name|red
operator|/
literal|255.999
expr_stmt|;
name|svals
operator|.
name|col1
index|[
literal|1
index|]
operator|=
name|param
index|[
literal|10
index|]
operator|.
name|data
operator|.
name|d_color
operator|.
name|green
operator|/
literal|255.999
expr_stmt|;
name|svals
operator|.
name|col1
index|[
literal|2
index|]
operator|=
name|param
index|[
literal|10
index|]
operator|.
name|data
operator|.
name|d_color
operator|.
name|blue
operator|/
literal|255.999
expr_stmt|;
name|svals
operator|.
name|col2
index|[
literal|0
index|]
operator|=
name|param
index|[
literal|11
index|]
operator|.
name|data
operator|.
name|d_color
operator|.
name|red
operator|/
literal|255.999
expr_stmt|;
name|svals
operator|.
name|col2
index|[
literal|1
index|]
operator|=
name|param
index|[
literal|11
index|]
operator|.
name|data
operator|.
name|d_color
operator|.
name|green
operator|/
literal|255.999
expr_stmt|;
name|svals
operator|.
name|col2
index|[
literal|2
index|]
operator|=
name|param
index|[
literal|11
index|]
operator|.
name|data
operator|.
name|d_color
operator|.
name|blue
operator|/
literal|255.999
expr_stmt|;
block|}
break|break;
case|case
name|RUN_WITH_LAST_VALS
case|:
comment|/*  Possibly retrieve data  */
name|gimp_get_data
argument_list|(
literal|"plug_in_sinus"
argument_list|,
operator|&
name|svals
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/*  Get the specified drawable  */
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
comment|/*  Make sure that the drawable is gray or RGB */
if|if
condition|(
operator|(
name|status
operator|==
name|STATUS_SUCCESS
operator|)
operator|&&
operator|(
name|gimp_drawable_color
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
operator|||
name|gimp_drawable_gray
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
operator|)
condition|)
block|{
name|gimp_progress_init
argument_list|(
literal|"Calculating picture..."
argument_list|)
expr_stmt|;
name|gimp_tile_cache_ntiles
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|sinus
argument_list|()
expr_stmt|;
if|if
condition|(
name|run_mode
operator|!=
name|RUN_NONINTERACTIVE
condition|)
name|gimp_displays_flush
argument_list|()
expr_stmt|;
comment|/*  Store data  */
if|if
condition|(
name|run_mode
operator|==
name|RUN_INTERACTIVE
condition|)
name|gimp_set_data
argument_list|(
literal|"plug_in_sinus"
argument_list|,
operator|&
name|svals
argument_list|,
sizeof|sizeof
argument_list|(
name|SinusVals
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|STATUS_EXECUTION_ERROR
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  Main procedure  */
end_comment

begin_function
DECL|function|prepare_coef (params * p)
name|void
name|prepare_coef
parameter_list|(
name|params
modifier|*
name|p
parameter_list|)
block|{
DECL|struct|__anon2b92fecd0308
DECL|member|r
DECL|member|g
DECL|member|b
DECL|member|a
DECL|typedef|type_color
typedef|typedef
struct|struct
block|{
name|guchar
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
block|}
name|type_color
typedef|;
name|type_color
name|col1
decl_stmt|,
name|col2
decl_stmt|;
name|double
name|scalex
init|=
name|svals
operator|.
name|scalex
decl_stmt|;
name|double
name|scaley
init|=
name|svals
operator|.
name|scaley
decl_stmt|;
name|srand
argument_list|(
name|svals
operator|.
name|seed
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|svals
operator|.
name|colorization
condition|)
block|{
case|case
name|BILINEAR
case|:
name|p
operator|->
name|blend
operator|=
name|bilinear
expr_stmt|;
break|break;
case|case
name|SINUS
case|:
name|p
operator|->
name|blend
operator|=
name|cosinus
expr_stmt|;
break|break;
case|case
name|LINEAR
case|:
default|default:
name|p
operator|->
name|blend
operator|=
name|linear
expr_stmt|;
block|}
if|if
condition|(
name|svals
operator|.
name|perturbation
operator|==
name|IDEAL
condition|)
block|{
name|p
operator|->
name|c11
operator|=
literal|0
operator|*
name|rand
argument_list|()
expr_stmt|;
name|p
operator|->
name|c12
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scaley
expr_stmt|;
comment|/*rand+rand is used to keep */
name|p
operator|->
name|c13
operator|=
operator|(
literal|2
operator|*
name|M_PI
operator|*
name|rand
argument_list|()
operator|)
operator|/
name|RAND_MAX
expr_stmt|;
name|p
operator|->
name|c21
operator|=
literal|0
operator|*
name|rand
argument_list|()
expr_stmt|;
name|p
operator|->
name|c22
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scaley
expr_stmt|;
comment|/*correspondance beetween Ideal*/
name|p
operator|->
name|c23
operator|=
operator|(
literal|2
operator|*
name|M_PI
operator|*
name|rand
argument_list|()
operator|)
operator|/
name|RAND_MAX
expr_stmt|;
name|p
operator|->
name|c31
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scalex
expr_stmt|;
comment|/*and perturbed coefs (I hope...)*/
name|p
operator|->
name|c32
operator|=
literal|0
operator|*
name|rand
argument_list|()
expr_stmt|;
name|p
operator|->
name|c33
operator|=
operator|(
literal|2
operator|*
name|M_PI
operator|*
name|rand
argument_list|()
operator|)
operator|/
name|RAND_MAX
expr_stmt|;
block|}
else|else
block|{
name|p
operator|->
name|c11
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scalex
expr_stmt|;
name|p
operator|->
name|c12
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scaley
expr_stmt|;
name|p
operator|->
name|c13
operator|=
operator|(
literal|2
operator|*
name|M_PI
operator|*
name|rand
argument_list|()
operator|)
operator|/
name|RAND_MAX
expr_stmt|;
name|p
operator|->
name|c21
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scalex
expr_stmt|;
name|p
operator|->
name|c22
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scaley
expr_stmt|;
name|p
operator|->
name|c23
operator|=
operator|(
literal|2
operator|*
name|M_PI
operator|*
name|rand
argument_list|()
operator|)
operator|/
name|RAND_MAX
expr_stmt|;
name|p
operator|->
name|c31
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scalex
expr_stmt|;
name|p
operator|->
name|c32
operator|=
operator|(
literal|2.0
operator|*
name|rand
argument_list|()
operator|/
operator|(
name|RAND_MAX
operator|+
literal|1.0
operator|)
operator|-
literal|1
operator|)
operator|*
name|scaley
expr_stmt|;
name|p
operator|->
name|c33
operator|=
operator|(
literal|2
operator|*
name|M_PI
operator|*
name|rand
argument_list|()
operator|)
operator|/
name|RAND_MAX
expr_stmt|;
block|}
if|if
condition|(
name|svals
operator|.
name|tiling
condition|)
block|{
name|p
operator|->
name|c11
operator|=
name|ROUND_TO_INT
argument_list|(
name|p
operator|->
name|c11
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
argument_list|)
operator|*
literal|2
operator|*
name|M_PI
expr_stmt|;
name|p
operator|->
name|c12
operator|=
name|ROUND_TO_INT
argument_list|(
name|p
operator|->
name|c12
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
argument_list|)
operator|*
literal|2
operator|*
name|M_PI
expr_stmt|;
name|p
operator|->
name|c21
operator|=
name|ROUND_TO_INT
argument_list|(
name|p
operator|->
name|c21
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
argument_list|)
operator|*
literal|2
operator|*
name|M_PI
expr_stmt|;
name|p
operator|->
name|c22
operator|=
name|ROUND_TO_INT
argument_list|(
name|p
operator|->
name|c22
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
argument_list|)
operator|*
literal|2
operator|*
name|M_PI
expr_stmt|;
name|p
operator|->
name|c31
operator|=
name|ROUND_TO_INT
argument_list|(
name|p
operator|->
name|c31
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
argument_list|)
operator|*
literal|2
operator|*
name|M_PI
expr_stmt|;
name|p
operator|->
name|c32
operator|=
name|ROUND_TO_INT
argument_list|(
name|p
operator|->
name|c32
operator|/
operator|(
literal|2
operator|*
name|M_PI
operator|)
argument_list|)
operator|*
literal|2
operator|*
name|M_PI
expr_stmt|;
block|}
name|col2
operator|.
name|a
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col2
index|[
literal|3
index|]
expr_stmt|;
name|col1
operator|.
name|a
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col1
index|[
literal|3
index|]
expr_stmt|;
if|if
condition|(
name|drawable_is_grayscale
condition|)
block|{
name|col1
operator|.
name|r
operator|=
name|col1
operator|.
name|g
operator|=
name|col1
operator|.
name|b
operator|=
literal|255
expr_stmt|;
name|col2
operator|.
name|r
operator|=
name|col2
operator|.
name|g
operator|=
name|col2
operator|.
name|b
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
switch|switch
condition|(
name|svals
operator|.
name|colors
condition|)
block|{
case|case
name|USE_COLORS
case|:
name|col1
operator|.
name|r
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col1
index|[
literal|0
index|]
expr_stmt|;
name|col1
operator|.
name|g
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col1
index|[
literal|1
index|]
expr_stmt|;
name|col1
operator|.
name|b
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col1
index|[
literal|2
index|]
expr_stmt|;
name|col2
operator|.
name|r
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col2
index|[
literal|0
index|]
expr_stmt|;
name|col2
operator|.
name|g
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col2
index|[
literal|1
index|]
expr_stmt|;
name|col2
operator|.
name|b
operator|=
literal|255.999
operator|*
name|svals
operator|.
name|col2
index|[
literal|2
index|]
expr_stmt|;
break|break;
case|case
name|B_W
case|:
name|col1
operator|.
name|r
operator|=
name|col1
operator|.
name|g
operator|=
name|col1
operator|.
name|b
operator|=
literal|255
expr_stmt|;
name|col2
operator|.
name|r
operator|=
name|col2
operator|.
name|g
operator|=
name|col2
operator|.
name|b
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|USE_FG_BG
case|:
name|gimp_palette_get_foreground
argument_list|(
operator|&
name|col2
operator|.
name|r
argument_list|,
operator|&
name|col2
operator|.
name|g
argument_list|,
operator|&
name|col2
operator|.
name|b
argument_list|)
expr_stmt|;
name|gimp_palette_get_background
argument_list|(
operator|&
name|col1
operator|.
name|r
argument_list|,
operator|&
name|col1
operator|.
name|g
argument_list|,
operator|&
name|col1
operator|.
name|b
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|p
operator|->
name|r
operator|=
name|col1
operator|.
name|r
expr_stmt|;
name|p
operator|->
name|g
operator|=
name|col1
operator|.
name|g
expr_stmt|;
name|p
operator|->
name|b
operator|=
name|col1
operator|.
name|b
expr_stmt|;
name|p
operator|->
name|a
operator|=
name|col1
operator|.
name|a
expr_stmt|;
name|p
operator|->
name|dr
operator|=
operator|(
name|int
operator|)
name|col2
operator|.
name|r
operator|-
name|col1
operator|.
name|r
expr_stmt|;
name|p
operator|->
name|dg
operator|=
operator|(
name|int
operator|)
name|col2
operator|.
name|g
operator|-
name|col1
operator|.
name|g
expr_stmt|;
name|p
operator|->
name|db
operator|=
operator|(
name|int
operator|)
name|col2
operator|.
name|b
operator|-
name|col1
operator|.
name|b
expr_stmt|;
name|p
operator|->
name|da
operator|=
operator|(
name|int
operator|)
name|col2
operator|.
name|a
operator|-
name|col1
operator|.
name|a
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|sinus ()
name|sinus
parameter_list|()
block|{
name|params
name|p
decl_stmt|;
name|gint
name|bytes
decl_stmt|;
name|GPixelRgn
name|dest_rgn
decl_stmt|;
name|int
name|ix1
decl_stmt|,
name|iy1
decl_stmt|,
name|ix2
decl_stmt|,
name|iy2
decl_stmt|;
comment|/* Selected image size. */
name|gpointer
name|pr
decl_stmt|;
name|gint
name|progress
decl_stmt|,
name|max_progress
decl_stmt|;
name|prepare_coef
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
operator|&
name|ix1
argument_list|,
operator|&
name|iy1
argument_list|,
operator|&
name|ix2
argument_list|,
operator|&
name|iy2
argument_list|)
expr_stmt|;
name|p
operator|.
name|width
operator|=
name|drawable
operator|->
name|width
expr_stmt|;
name|p
operator|.
name|height
operator|=
name|drawable
operator|->
name|height
expr_stmt|;
name|bytes
operator|=
name|drawable
operator|->
name|bpp
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|dest_rgn
argument_list|,
name|drawable
argument_list|,
name|ix1
argument_list|,
name|iy1
argument_list|,
name|ix2
operator|-
name|ix1
argument_list|,
name|iy2
operator|-
name|iy1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|progress
operator|=
literal|0
expr_stmt|;
name|max_progress
operator|=
operator|(
name|ix2
operator|-
name|ix1
operator|)
operator|*
operator|(
name|iy2
operator|-
name|iy1
operator|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|gimp_pixel_rgns_register
argument_list|(
literal|1
argument_list|,
operator|&
name|dest_rgn
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|gimp_pixel_rgns_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
switch|switch
condition|(
name|bytes
condition|)
block|{
case|case
literal|4
case|:
name|compute_block_4
argument_list|(
name|dest_rgn
operator|.
name|data
argument_list|,
name|dest_rgn
operator|.
name|rowstride
argument_list|,
name|dest_rgn
operator|.
name|x
argument_list|,
name|dest_rgn
operator|.
name|y
argument_list|,
name|dest_rgn
operator|.
name|w
argument_list|,
name|dest_rgn
operator|.
name|h
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|compute_block_3
argument_list|(
name|dest_rgn
operator|.
name|data
argument_list|,
name|dest_rgn
operator|.
name|rowstride
argument_list|,
name|dest_rgn
operator|.
name|x
argument_list|,
name|dest_rgn
operator|.
name|y
argument_list|,
name|dest_rgn
operator|.
name|w
argument_list|,
name|dest_rgn
operator|.
name|h
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|compute_block_2
argument_list|(
name|dest_rgn
operator|.
name|data
argument_list|,
name|dest_rgn
operator|.
name|rowstride
argument_list|,
name|dest_rgn
operator|.
name|x
argument_list|,
name|dest_rgn
operator|.
name|y
argument_list|,
name|dest_rgn
operator|.
name|w
argument_list|,
name|dest_rgn
operator|.
name|h
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|compute_block_1
argument_list|(
name|dest_rgn
operator|.
name|data
argument_list|,
name|dest_rgn
operator|.
name|rowstride
argument_list|,
name|dest_rgn
operator|.
name|x
argument_list|,
name|dest_rgn
operator|.
name|y
argument_list|,
name|dest_rgn
operator|.
name|w
argument_list|,
name|dest_rgn
operator|.
name|h
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
break|break;
block|}
name|progress
operator|+=
name|dest_rgn
operator|.
name|w
operator|*
name|dest_rgn
operator|.
name|h
expr_stmt|;
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|progress
operator|/
operator|(
name|double
operator|)
name|max_progress
argument_list|)
expr_stmt|;
block|}
name|gimp_drawable_flush
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|ix1
argument_list|,
name|iy1
argument_list|,
operator|(
name|ix2
operator|-
name|ix1
operator|)
argument_list|,
operator|(
name|iy2
operator|-
name|iy1
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|linear (double v)
name|double
name|linear
parameter_list|(
name|double
name|v
parameter_list|)
block|{
specifier|register
name|double
name|a
init|=
name|v
operator|-
operator|(
name|int
operator|)
name|v
decl_stmt|;
return|return
operator|(
name|a
operator|<
literal|0
condition|?
literal|1.0
operator|+
name|a
else|:
name|a
operator|)
return|;
block|}
end_function

begin_function
DECL|function|bilinear (double v)
name|double
name|bilinear
parameter_list|(
name|double
name|v
parameter_list|)
block|{
specifier|register
name|double
name|a
init|=
name|v
operator|-
operator|(
name|int
operator|)
name|v
decl_stmt|;
name|a
operator|=
operator|(
name|a
operator|<
literal|0
condition|?
literal|1.0
operator|+
name|a
else|:
name|a
operator|)
expr_stmt|;
return|return
operator|(
name|a
operator|>
literal|0.5
condition|?
literal|2
operator|-
literal|2
operator|*
name|a
else|:
literal|2
operator|*
name|a
operator|)
return|;
block|}
end_function

begin_function
DECL|function|cosinus (double v)
name|double
name|cosinus
parameter_list|(
name|double
name|v
parameter_list|)
block|{
return|return
literal|0.5
operator|-
literal|0.5
operator|*
name|sin
argument_list|(
operator|(
name|v
operator|+
literal|0.25
operator|)
operator|*
name|M_PI
operator|*
literal|2
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|compute_block_4 (guchar * dest_row,guint rowstride,gint x0,gint y0,gint w,gint h,params * p)
specifier|inline
name|void
name|compute_block_4
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|w
parameter_list|,
name|gint
name|h
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
block|{
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|;
name|double
name|x
decl_stmt|,
name|y
decl_stmt|,
name|grey
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
for|for
control|(
name|j
operator|=
name|y0
init|;
name|j
operator|<
operator|(
name|y0
operator|+
name|h
operator|)
condition|;
name|j
operator|++
control|)
block|{
name|y
operator|=
operator|(
operator|(
name|double
operator|)
name|j
operator|)
operator|/
name|p
operator|->
name|height
expr_stmt|;
name|dest
operator|=
name|dest_row
expr_stmt|;
for|for
control|(
name|i
operator|=
name|x0
init|;
name|i
operator|<
operator|(
name|x0
operator|+
name|w
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|x
operator|=
operator|(
operator|(
name|double
operator|)
name|i
operator|)
operator|/
name|p
operator|->
name|width
expr_stmt|;
name|grey
operator|=
name|sin
argument_list|(
name|p
operator|->
name|c11
operator|*
name|x
operator|+
name|p
operator|->
name|c12
operator|*
name|y
operator|+
name|p
operator|->
name|c13
argument_list|)
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr|\
operator|+
name|sin
argument_list|(
name|p
operator|->
name|c21
operator|*
name|x
operator|+
name|p
operator|->
name|c22
operator|*
name|y
operator|+
name|p
operator|->
name|c23
argument_list|)
operator|*
operator|(
literal|0.5
operator|-
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr_stmt|;
name|grey
operator|=
name|pow
argument_list|(
name|p
operator|->
name|blend
argument_list|(
name|svals
operator|.
name|cmplx
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|grey
operator|)
argument_list|)
argument_list|,
name|exp
argument_list|(
name|svals
operator|.
name|blend_power
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|r
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|dr
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|g
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|dg
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|b
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|db
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|a
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|da
argument_list|)
expr_stmt|;
block|}
name|dest_row
operator|+=
name|rowstride
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|compute_block_3 (guchar * dest_row,guint rowstride,gint x0,gint y0,gint w,gint h,params * p)
specifier|inline
name|void
name|compute_block_3
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|w
parameter_list|,
name|gint
name|h
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
block|{
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|;
name|double
name|x
decl_stmt|,
name|y
decl_stmt|,
name|grey
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
for|for
control|(
name|j
operator|=
name|y0
init|;
name|j
operator|<
operator|(
name|y0
operator|+
name|h
operator|)
condition|;
name|j
operator|++
control|)
block|{
name|y
operator|=
operator|(
operator|(
name|double
operator|)
name|j
operator|)
operator|/
name|p
operator|->
name|height
expr_stmt|;
name|dest
operator|=
name|dest_row
expr_stmt|;
for|for
control|(
name|i
operator|=
name|x0
init|;
name|i
operator|<
operator|(
name|x0
operator|+
name|w
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|x
operator|=
operator|(
operator|(
name|double
operator|)
name|i
operator|)
operator|/
name|p
operator|->
name|width
expr_stmt|;
name|grey
operator|=
name|sin
argument_list|(
name|p
operator|->
name|c11
operator|*
name|x
operator|+
name|p
operator|->
name|c12
operator|*
name|y
operator|+
name|p
operator|->
name|c13
argument_list|)
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr|\
operator|+
name|sin
argument_list|(
name|p
operator|->
name|c21
operator|*
name|x
operator|+
name|p
operator|->
name|c22
operator|*
name|y
operator|+
name|p
operator|->
name|c23
argument_list|)
operator|*
operator|(
literal|0.5
operator|-
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr_stmt|;
name|grey
operator|=
name|pow
argument_list|(
name|p
operator|->
name|blend
argument_list|(
name|svals
operator|.
name|cmplx
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|grey
operator|)
argument_list|)
argument_list|,
name|exp
argument_list|(
name|svals
operator|.
name|blend_power
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|r
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|dr
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|g
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|dg
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|b
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|db
argument_list|)
expr_stmt|;
block|}
name|dest_row
operator|+=
name|rowstride
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|compute_block_2 (guchar * dest_row,guint rowstride,gint x0,gint y0,gint w,gint h,params * p)
specifier|inline
name|void
name|compute_block_2
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|w
parameter_list|,
name|gint
name|h
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
block|{
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|;
name|double
name|x
decl_stmt|,
name|y
decl_stmt|,
name|grey
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
for|for
control|(
name|j
operator|=
name|y0
init|;
name|j
operator|<
operator|(
name|y0
operator|+
name|h
operator|)
condition|;
name|j
operator|++
control|)
block|{
name|y
operator|=
operator|(
operator|(
name|double
operator|)
name|j
operator|)
operator|/
name|p
operator|->
name|height
expr_stmt|;
name|dest
operator|=
name|dest_row
expr_stmt|;
for|for
control|(
name|i
operator|=
name|x0
init|;
name|i
operator|<
operator|(
name|x0
operator|+
name|w
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|x
operator|=
operator|(
operator|(
name|double
operator|)
name|i
operator|)
operator|/
name|p
operator|->
name|width
expr_stmt|;
name|grey
operator|=
name|sin
argument_list|(
name|p
operator|->
name|c11
operator|*
name|x
operator|+
name|p
operator|->
name|c12
operator|*
name|y
operator|+
name|p
operator|->
name|c13
argument_list|)
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr|\
operator|+
name|sin
argument_list|(
name|p
operator|->
name|c21
operator|*
name|x
operator|+
name|p
operator|->
name|c22
operator|*
name|y
operator|+
name|p
operator|->
name|c23
argument_list|)
operator|*
operator|(
literal|0.5
operator|-
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr_stmt|;
name|grey
operator|=
name|pow
argument_list|(
name|p
operator|->
name|blend
argument_list|(
name|svals
operator|.
name|cmplx
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|grey
operator|)
argument_list|)
argument_list|,
name|exp
argument_list|(
name|svals
operator|.
name|blend_power
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
call|(
name|guchar
call|)
argument_list|(
name|grey
operator|*
literal|255.0
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
name|p
operator|->
name|a
operator|+
call|(
name|int
call|)
argument_list|(
name|grey
operator|*
name|p
operator|->
name|da
argument_list|)
expr_stmt|;
block|}
name|dest_row
operator|+=
name|rowstride
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|compute_block_1 (guchar * dest_row,guint rowstride,gint x0,gint y0,gint w,gint h,params * p)
specifier|inline
name|void
name|compute_block_1
parameter_list|(
name|guchar
modifier|*
name|dest_row
parameter_list|,
name|guint
name|rowstride
parameter_list|,
name|gint
name|x0
parameter_list|,
name|gint
name|y0
parameter_list|,
name|gint
name|w
parameter_list|,
name|gint
name|h
parameter_list|,
name|params
modifier|*
name|p
parameter_list|)
block|{
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|;
name|double
name|x
decl_stmt|,
name|y
decl_stmt|,
name|grey
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
for|for
control|(
name|j
operator|=
name|y0
init|;
name|j
operator|<
operator|(
name|y0
operator|+
name|h
operator|)
condition|;
name|j
operator|++
control|)
block|{
name|y
operator|=
operator|(
operator|(
name|double
operator|)
name|j
operator|)
operator|/
name|p
operator|->
name|height
expr_stmt|;
name|dest
operator|=
name|dest_row
expr_stmt|;
for|for
control|(
name|i
operator|=
name|x0
init|;
name|i
operator|<
operator|(
name|x0
operator|+
name|w
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|x
operator|=
operator|(
operator|(
name|double
operator|)
name|i
operator|)
operator|/
name|p
operator|->
name|width
expr_stmt|;
name|grey
operator|=
name|sin
argument_list|(
name|p
operator|->
name|c11
operator|*
name|x
operator|+
name|p
operator|->
name|c12
operator|*
name|y
operator|+
name|p
operator|->
name|c13
argument_list|)
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr|\
operator|+
name|sin
argument_list|(
name|p
operator|->
name|c21
operator|*
name|x
operator|+
name|p
operator|->
name|c22
operator|*
name|y
operator|+
name|p
operator|->
name|c23
argument_list|)
operator|*
operator|(
literal|0.5
operator|-
literal|0.5
operator|*
name|sin
argument_list|(
name|p
operator|->
name|c31
operator|*
name|x
operator|+
name|p
operator|->
name|c32
operator|*
name|y
operator|+
name|p
operator|->
name|c33
argument_list|)
operator|)
expr_stmt|;
name|grey
operator|=
name|pow
argument_list|(
name|p
operator|->
name|blend
argument_list|(
name|svals
operator|.
name|cmplx
operator|*
operator|(
literal|0.5
operator|+
literal|0.5
operator|*
name|grey
operator|)
argument_list|)
argument_list|,
name|exp
argument_list|(
name|svals
operator|.
name|blend_power
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|dest
operator|++
operator|=
call|(
name|guchar
call|)
argument_list|(
name|grey
operator|*
literal|255.0
argument_list|)
expr_stmt|;
block|}
name|dest_row
operator|+=
name|rowstride
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* ---------------------------------------------------------------*/
end_comment

begin_comment
comment|/*  -------------------------- UI ------------------------------- */
end_comment

begin_comment
comment|/* -------------------------------------------------------------- */
end_comment

begin_comment
comment|/*****************************************/
end_comment

begin_comment
comment|/* The note book                         */
end_comment

begin_comment
comment|/*****************************************/
end_comment

begin_function
DECL|function|sinus_dialog (void)
name|int
name|sinus_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
name|gint
name|runp
decl_stmt|;
name|GtkWidget
modifier|*
name|main_hbox
decl_stmt|,
modifier|*
name|notebook
decl_stmt|;
name|GtkWidget
modifier|*
name|page
decl_stmt|,
modifier|*
name|frame
decl_stmt|,
modifier|*
name|label
decl_stmt|,
modifier|*
name|vbox
decl_stmt|,
modifier|*
name|hbox
decl_stmt|,
modifier|*
name|table
decl_stmt|;
name|struct
name|mwColorSel
modifier|*
name|push_col1
decl_stmt|,
modifier|*
name|push_col2
decl_stmt|;
ifdef|#
directive|ifdef
name|USE_LOGO
name|GtkWidget
modifier|*
name|logo
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|char
name|buf
index|[
literal|3
operator|*
literal|100
index|]
decl_stmt|;
name|guchar
modifier|*
name|data
decl_stmt|;
endif|#
directive|endif
name|gchar
modifier|*
modifier|*
name|argv
decl_stmt|;
name|gint
name|argc
decl_stmt|;
specifier|static
name|struct
name|mwValueRadioGroup
name|coloriz_radio
index|[]
init|=
block|{
block|{
literal|"Linear"
block|,
name|LINEAR
block|}
block|,
block|{
literal|"Bilinear"
block|,
name|BILINEAR
block|}
block|,
block|{
literal|"Sinusoidal"
block|,
name|SINUS
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,   }
decl_stmt|;
specifier|static
name|struct
name|mwValueRadioGroup
name|colors_radio
index|[]
init|=
block|{
block|{
literal|"Black& White"
block|,
name|B_W
block|}
block|,
block|{
literal|"Foreground& Background"
block|,
name|USE_FG_BG
block|}
block|,
block|{
literal|"Choose here:"
block|,
name|USE_COLORS
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,   }
decl_stmt|;
specifier|static
name|struct
name|mwValueRadioGroup
name|coefs_radio
index|[]
init|=
block|{
block|{
literal|"Ideal"
block|,
name|IDEAL
block|}
block|,
block|{
literal|"Distorted"
block|,
name|PERTURBED
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|}
block|,   }
decl_stmt|;
comment|/* Set args */
name|argc
operator|=
literal|1
expr_stmt|;
name|argv
operator|=
name|g_new
argument_list|(
name|gchar
operator|*
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|=
name|g_strdup
argument_list|(
literal|"sinus"
argument_list|)
expr_stmt|;
name|gtk_init
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|)
expr_stmt|;
name|gtk_rc_parse
argument_list|(
name|gimp_gtkrc
argument_list|()
argument_list|)
expr_stmt|;
comment|/* Create Main window with a vbox */
comment|/* ============================== */
name|dlg
operator|=
name|mw_app_new
argument_list|(
literal|"plug_in_sinus"
argument_list|,
literal|"Sinus"
argument_list|,
operator|&
name|runp
argument_list|)
expr_stmt|;
name|main_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|main_hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_hbox
argument_list|)
expr_stmt|;
comment|/* Create preview */
comment|/* ============== */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|TRUE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|preview
operator|=
name|mw_preview_new
argument_list|(
name|vbox
argument_list|,
name|thePreview
argument_list|,
operator|&
name|sinus_do_preview
argument_list|)
expr_stmt|;
name|sinus_do_preview
argument_list|(
name|preview
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|USE_LOGO
name|logo
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|logo
argument_list|)
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|logo
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|logo
argument_list|)
expr_stmt|;
name|data
operator|=
name|logo_data
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
literal|100
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
literal|100
condition|;
name|x
operator|++
control|)
block|{
name|HEADER_PIXEL
argument_list|(
name|data
argument_list|,
operator|(
operator|&
name|buf
index|[
literal|3
operator|*
name|x
index|]
operator|)
argument_list|)
expr_stmt|;
block|}
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|logo
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
literal|100
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* Create the notebook */
comment|/* =================== */
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_tab_pos
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|notebook
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
comment|/* Create the drawing settings frame */
comment|/* ================================= */
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Drawing settings"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|mw_fscale_entry_new
argument_list|(
name|table
argument_list|,
literal|"X scale: "
argument_list|,
literal|0.0001
argument_list|,
literal|100.0
argument_list|,
literal|0.001
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
operator|&
operator|(
name|svals
operator|.
name|scalex
operator|)
argument_list|)
expr_stmt|;
name|mw_fscale_entry_new
argument_list|(
name|table
argument_list|,
literal|"Y scale: "
argument_list|,
literal|0.0001
argument_list|,
literal|100.0
argument_list|,
literal|0.001
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
operator|&
operator|(
name|svals
operator|.
name|scaley
operator|)
argument_list|)
expr_stmt|;
name|mw_fscale_entry_new
argument_list|(
name|table
argument_list|,
literal|"Complexity: "
argument_list|,
literal|0
argument_list|,
literal|15.0
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
operator|&
operator|(
name|svals
operator|.
name|cmplx
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Calculation settings"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|mw_ientry_new
argument_list|(
name|vbox
argument_list|,
name|NULL
argument_list|,
literal|"Random seed:"
argument_list|,
operator|&
name|svals
operator|.
name|seed
argument_list|)
expr_stmt|;
name|mw_toggle_button_new
argument_list|(
name|vbox
argument_list|,
name|NULL
argument_list|,
literal|"Force tiling?"
argument_list|,
operator|&
name|svals
operator|.
name|tiling
argument_list|)
expr_stmt|;
name|mw_value_radio_group_new
argument_list|(
name|vbox
argument_list|,
name|NULL
argument_list|,
name|coefs_radio
argument_list|,
operator|&
name|svals
operator|.
name|perturbation
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Settings"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|page
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
comment|/* Color settings dialog: */
comment|/* ====================== */
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Colors"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable_is_grayscale
condition|)
block|{
comment|/*if in grey scale, the colors are necessarily black and white */
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"The colors are white and black."
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|mw_value_radio_group_new
argument_list|(
name|vbox
argument_list|,
name|NULL
argument_list|,
name|colors_radio
argument_list|,
operator|&
name|svals
operator|.
name|colors
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|push_col1
operator|=
name|mw_color_select_button_create
argument_list|(
name|hbox
argument_list|,
literal|"Fisrt Color"
argument_list|,
name|svals
operator|.
name|col1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|push_col2
operator|=
name|mw_color_select_button_create
argument_list|(
name|hbox
argument_list|,
literal|"Second Color"
argument_list|,
name|svals
operator|.
name|col2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
block|}
name|frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Alpha Channels"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|mw_fscale_entry_new
argument_list|(
name|table
argument_list|,
literal|"first color "
argument_list|,
literal|0
argument_list|,
literal|1.0
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
operator|&
operator|(
name|svals
operator|.
name|col1
index|[
literal|3
index|]
operator|)
argument_list|)
expr_stmt|;
name|mw_fscale_entry_new
argument_list|(
name|table
argument_list|,
literal|"last color "
argument_list|,
literal|0
argument_list|,
literal|1.0
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
operator|&
operator|(
name|svals
operator|.
name|col2
index|[
literal|3
index|]
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Colors"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|page
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
comment|/* blend settings dialog: */
comment|/* ====================== */
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Blend"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|page
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
literal|"Blend settings"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|mw_value_radio_group_new
argument_list|(
name|vbox
argument_list|,
literal|"Gradient"
argument_list|,
name|coloriz_radio
argument_list|,
operator|&
name|svals
operator|.
name|colorization
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|mw_fscale_entry_new
argument_list|(
name|table
argument_list|,
literal|"Exponent "
argument_list|,
operator|-
literal|7.5
argument_list|,
literal|7.5
argument_list|,
literal|0.01
argument_list|,
literal|5.0
argument_list|,
literal|0.0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
operator|&
name|svals
operator|.
name|blend_power
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|page
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
comment|/* argp->type = mw_radio_result(mode); */
return|return
name|runp
return|;
block|}
end_function

begin_comment
comment|/******************************************************************/
end_comment

begin_comment
comment|/* Draw preview image. if DoCompute is TRUE then recompute image. */
end_comment

begin_comment
comment|/******************************************************************/
end_comment

begin_function
DECL|function|sinus_do_preview (GtkWidget * w)
name|void
name|sinus_do_preview
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|theWidget
init|=
name|NULL
decl_stmt|;
name|gint
name|y
decl_stmt|,
name|rowsize
decl_stmt|;
name|guchar
modifier|*
name|buf
decl_stmt|,
modifier|*
name|savbuf
decl_stmt|;
name|params
name|p
decl_stmt|;
if|if
condition|(
name|theWidget
operator|==
name|NULL
condition|)
block|{
name|theWidget
operator|=
name|w
expr_stmt|;
block|}
name|rowsize
operator|=
name|thePreview
operator|->
name|width
operator|*
name|thePreview
operator|->
name|bpp
expr_stmt|;
name|savbuf
operator|=
name|buf
operator|=
operator|(
name|guchar
operator|*
operator|)
name|malloc
argument_list|(
name|thePreview
operator|->
name|width
operator|*
name|thePreview
operator|->
name|height
operator|*
name|thePreview
operator|->
name|bpp
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
operator|!=
name|NULL
condition|)
block|{
name|p
operator|.
name|height
operator|=
name|thePreview
operator|->
name|height
expr_stmt|;
name|p
operator|.
name|width
operator|=
name|thePreview
operator|->
name|width
expr_stmt|;
name|prepare_coef
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|thePreview
operator|->
name|bpp
operator|==
literal|3
condition|)
name|compute_block_3
argument_list|(
name|buf
argument_list|,
name|rowsize
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|thePreview
operator|->
name|width
argument_list|,
name|thePreview
operator|->
name|height
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|thePreview
operator|->
name|bpp
operator|==
literal|1
condition|)
block|{
name|compute_block_1
argument_list|(
name|buf
argument_list|,
name|rowsize
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|thePreview
operator|->
name|width
argument_list|,
name|thePreview
operator|->
name|height
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
block|}
else|else
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Uh Oh....  Little sinus preview-only problem...\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|thePreview
operator|->
name|height
condition|;
name|y
operator|++
control|)
block|{
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|theWidget
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|thePreview
operator|->
name|width
argument_list|)
expr_stmt|;
name|buf
operator|+=
name|rowsize
expr_stmt|;
block|}
name|free
argument_list|(
name|savbuf
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|theWidget
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Not enough mem for sinus Preview...\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

