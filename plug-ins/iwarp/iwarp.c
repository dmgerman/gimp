begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_comment
comment|/* IWarp  a plug-in for the GIMP    Version 0.1         IWarp is a gimp plug-in for interactive image warping. To apply the     selected deformation to the image, press the left mouse button and     move the mouse pointer in the preview image.        Copyright (C) 1997 Norbert Schmitz    nobert.schmitz@student.uni-tuebingen.de     Most of the gimp and gtk specific code is taken from other plug-ins      v0.11     animation of non-alpha layers (background) creates now layers with alpha     channel. (thanks to Adrian Likins for reporting this bug)  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"gtk/gtk.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimp.h"
end_include

begin_define
DECL|macro|MAX_PREVIEW_WIDTH
define|#
directive|define
name|MAX_PREVIEW_WIDTH
value|256
end_define

begin_define
DECL|macro|MAX_PREVIEW_HEIGHT
define|#
directive|define
name|MAX_PREVIEW_HEIGHT
value|256
end_define

begin_define
DECL|macro|MAX_DEFORM_AREA_RADIUS
define|#
directive|define
name|MAX_DEFORM_AREA_RADIUS
value|100
end_define

begin_define
DECL|macro|SCALE_WIDTH
define|#
directive|define
name|SCALE_WIDTH
value|150
end_define

begin_define
DECL|macro|MAX_NUM_FRAMES
define|#
directive|define
name|MAX_NUM_FRAMES
value|100
end_define

begin_define
DECL|macro|CHECK_SIZE
define|#
directive|define
name|CHECK_SIZE
value|32
end_define

begin_define
DECL|macro|CHECK_LIGHT
define|#
directive|define
name|CHECK_LIGHT
value|170
end_define

begin_define
DECL|macro|CHECK_DARK
define|#
directive|define
name|CHECK_DARK
value|85
end_define

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2acc3f0f0108
block|{
DECL|member|x
name|gfloat
name|x
decl_stmt|;
DECL|member|y
name|gfloat
name|y
decl_stmt|;
DECL|typedef|vector_2d
block|}
name|vector_2d
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2acc3f0f0208
block|{
DECL|member|run
name|gint
name|run
decl_stmt|;
DECL|typedef|iwarp_interface
block|}
name|iwarp_interface
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2acc3f0f0308
block|{
DECL|member|deform_area_radius
name|gint
name|deform_area_radius
decl_stmt|;
DECL|member|deform_amount
name|gfloat
name|deform_amount
decl_stmt|;
DECL|member|do_grow
name|gint
name|do_grow
decl_stmt|;
DECL|member|do_shrink
name|gint
name|do_shrink
decl_stmt|;
DECL|member|do_move
name|gint
name|do_move
decl_stmt|;
DECL|member|do_remove
name|gint
name|do_remove
decl_stmt|;
DECL|member|do_swirl_ccw
name|gint
name|do_swirl_ccw
decl_stmt|;
DECL|member|do_swirl_cw
name|gint
name|do_swirl_cw
decl_stmt|;
DECL|member|do_bilinear
name|gint
name|do_bilinear
decl_stmt|;
DECL|member|do_supersample
name|gint
name|do_supersample
decl_stmt|;
DECL|member|supersample_threshold
name|gfloat
name|supersample_threshold
decl_stmt|;
DECL|member|max_supersample_depth
name|gint
name|max_supersample_depth
decl_stmt|;
DECL|typedef|iwarp_vals_t
block|}
name|iwarp_vals_t
typedef|;
end_typedef

begin_comment
comment|/* Declare local functions.  */
end_comment

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|int
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|iwarp_dialog
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_frame
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|iwarp_motion_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_iscale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gint
modifier|*
name|scale_val
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_fscale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gfloat
modifier|*
name|scale_val
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|int
modifier|*
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_supersample_toggle
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|int
modifier|*
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_animate_toggle
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|int
modifier|*
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_reset_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_update_preview
parameter_list|(
name|int
name|x0
parameter_list|,
name|int
name|y0
parameter_list|,
name|int
name|x1
parameter_list|,
name|int
name|y1
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|iwarp_layer_copy
parameter_list|(
name|gint32
name|layerID
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_get_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_get_deform_vector
parameter_list|(
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|gfloat
modifier|*
name|xv
parameter_list|,
name|gfloat
modifier|*
name|yv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_get_point
parameter_list|(
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|guchar
modifier|*
name|color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|iwarp_supersample_test
parameter_list|(
name|vector_2d
modifier|*
name|v0
parameter_list|,
name|vector_2d
modifier|*
name|v1
parameter_list|,
name|vector_2d
modifier|*
name|v2
parameter_list|,
name|vector_2d
modifier|*
name|v3
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_getsample
parameter_list|(
name|vector_2d
name|v0
parameter_list|,
name|vector_2d
name|v1
parameter_list|,
name|vector_2d
name|v2
parameter_list|,
name|vector_2d
name|v3
parameter_list|,
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|gint
modifier|*
name|sample
parameter_list|,
name|gint
modifier|*
name|cc
parameter_list|,
name|gint
name|depth
parameter_list|,
name|gfloat
name|scale
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_supersample
parameter_list|(
name|gint
name|sxl
parameter_list|,
name|gint
name|syl
parameter_list|,
name|gint
name|sxr
parameter_list|,
name|gint
name|syr
parameter_list|,
name|guchar
modifier|*
name|dest_data
parameter_list|,
name|int
name|stride
parameter_list|,
name|int
modifier|*
name|progress
parameter_list|,
name|int
name|max_progress
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|guchar
name|iwarp_transparent_color
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_cpy_images
parameter_list|()
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_animate_dialog
parameter_list|(
name|GtkWidget
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_settings_dialog
parameter_list|(
name|GtkWidget
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_preview_get_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|guchar
modifier|*
modifier|*
name|color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_preview_get_point
parameter_list|(
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|guchar
modifier|*
name|color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_deform
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|gfloat
name|vx
parameter_list|,
name|gfloat
name|vy
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|iwarp_move
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|xx
parameter_list|,
name|int
name|yy
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc */
name|NULL
block|,
comment|/* quit_proc */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|wint
specifier|static
name|iwarp_interface
name|wint
init|=
block|{
name|FALSE
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|iwarp_vals
specifier|static
name|iwarp_vals_t
name|iwarp_vals
init|=
block|{
literal|20
block|,
literal|0.3
block|,
name|FALSE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|FALSE
block|,
name|TRUE
block|,
name|FALSE
block|,
literal|2.0
block|,
literal|2
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|drawable
specifier|static
name|GDrawable
modifier|*
name|drawable
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|destdrawable
specifier|static
name|GDrawable
modifier|*
name|destdrawable
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|preview
specifier|static
name|GtkWidget
modifier|*
name|preview
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|supersample_frame
specifier|static
name|GtkWidget
modifier|*
name|supersample_frame
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|animate_frame
specifier|static
name|GtkWidget
modifier|*
name|animate_frame
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|srcimage
specifier|static
name|guchar
modifier|*
name|srcimage
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|dstimage
specifier|static
name|guchar
modifier|*
name|dstimage
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|preview_width
DECL|variable|preview_height
DECL|variable|sel_width
DECL|variable|sel_height
specifier|static
name|gint
name|preview_width
decl_stmt|,
name|preview_height
decl_stmt|,
name|sel_width
decl_stmt|,
name|sel_height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|image_bpp
specifier|static
name|gint
name|image_bpp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|deform_vectors
specifier|static
name|vector_2d
modifier|*
name|deform_vectors
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|deform_area_vectors
specifier|static
name|vector_2d
modifier|*
name|deform_area_vectors
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|lastx
DECL|variable|lasty
specifier|static
name|int
name|lastx
decl_stmt|,
name|lasty
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|filter
specifier|static
name|gfloat
name|filter
index|[
name|MAX_DEFORM_AREA_RADIUS
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|do_animate
specifier|static
name|int
name|do_animate
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|do_animate_reverse
specifier|static
name|int
name|do_animate_reverse
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|do_animate_ping_pong
specifier|static
name|int
name|do_animate_ping_pong
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|supersample_threshold_2
specifier|static
name|gfloat
name|supersample_threshold_2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|xl
DECL|variable|yl
DECL|variable|xh
DECL|variable|yh
specifier|static
name|int
name|xl
decl_stmt|,
name|yl
decl_stmt|,
name|xh
decl_stmt|,
name|yh
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tile_width
DECL|variable|tile_height
specifier|static
name|int
name|tile_width
decl_stmt|,
name|tile_height
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tile
specifier|static
name|GTile
modifier|*
name|tile
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pre2img
DECL|variable|img2pre
specifier|static
name|gfloat
name|pre2img
decl_stmt|,
name|img2pre
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|preview_bpp
specifier|static
name|int
name|preview_bpp
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|animate_deform_value
specifier|static
name|gfloat
name|animate_deform_value
init|=
literal|1.0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|imageID
specifier|static
name|gint32
name|imageID
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|animate_num_frames
specifier|static
name|int
name|animate_num_frames
init|=
literal|2
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|frame_number
specifier|static
name|int
name|frame_number
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|layer_alpha
specifier|static
name|int
name|layer_alpha
decl_stmt|;
end_decl_stmt

begin_expr_stmt
name|MAIN
argument_list|()
expr_stmt|;
end_expr_stmt

begin_function
specifier|static
name|void
DECL|function|query ()
name|query
parameter_list|()
block|{
specifier|static
name|GParamDef
name|args
index|[]
init|=
block|{
block|{
name|PARAM_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|PARAM_IMAGE
block|,
literal|"image"
block|,
literal|"Input image (unused)"
block|}
block|,
block|{
name|PARAM_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|,   }
decl_stmt|;
specifier|static
name|GParamDef
modifier|*
name|return_vals
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|nargs
init|=
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
specifier|static
name|int
name|nreturn_vals
init|=
literal|0
decl_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"plug_in_iwarp"
argument_list|,
literal|"Interactive warping of the specified drawable"
argument_list|,
literal|"Interactive warping of the specified drawable "
argument_list|,
literal|"Norbert Schmitz"
argument_list|,
literal|"Norbert Schmitz"
argument_list|,
literal|"1997"
argument_list|,
literal|"<Image>/Filters/Distorts/IWarp"
argument_list|,
literal|"RGB*, GRAY*"
argument_list|,
name|PROC_PLUG_IN
argument_list|,
name|nargs
argument_list|,
name|nreturn_vals
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (char * name,int nparams,GParam * param,int * nreturn_vals,GParam ** return_vals)
name|run
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|int
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|int
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GParam
name|values
index|[
literal|1
index|]
decl_stmt|;
name|GRunModeType
name|run_mode
decl_stmt|;
name|GStatusType
name|status
init|=
name|STATUS_SUCCESS
decl_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
comment|/*  Get the specified drawable  */
name|destdrawable
operator|=
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
name|imageID
operator|=
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
comment|/*  Make sure that the drawable is gray or RGB color  */
if|if
condition|(
name|gimp_drawable_color
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
operator|||
name|gimp_drawable_gray
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
condition|)
block|{
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|RUN_INTERACTIVE
case|:
name|gimp_get_data
argument_list|(
literal|"plug_in_iwarp"
argument_list|,
operator|&
name|iwarp_vals
argument_list|)
expr_stmt|;
name|gimp_tile_cache_ntiles
argument_list|(
literal|2
operator|*
operator|(
name|drawable
operator|->
name|width
operator|+
name|gimp_tile_width
argument_list|()
operator|-
literal|1
operator|)
operator|/
name|gimp_tile_width
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|iwarp_dialog
argument_list|()
condition|)
name|iwarp
argument_list|()
expr_stmt|;
name|gimp_set_data
argument_list|(
literal|"plug_in_iwarp"
argument_list|,
operator|&
name|iwarp_vals
argument_list|,
sizeof|sizeof
argument_list|(
name|iwarp_vals_t
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_displays_flush
argument_list|()
expr_stmt|;
break|break;
case|case
name|RUN_NONINTERACTIVE
case|:
name|status
operator|=
name|STATUS_CALLING_ERROR
expr_stmt|;
break|break;
case|case
name|RUN_WITH_LAST_VALS
case|:
name|status
operator|=
name|STATUS_CALLING_ERROR
expr_stmt|;
break|break;
default|default :
break|break;
block|}
block|}
else|else
block|{
name|status
operator|=
name|STATUS_EXECUTION_ERROR
expr_stmt|;
block|}
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcimage
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|srcimage
argument_list|)
expr_stmt|;
if|if
condition|(
name|dstimage
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|dstimage
argument_list|)
expr_stmt|;
if|if
condition|(
name|deform_vectors
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|deform_vectors
argument_list|)
expr_stmt|;
if|if
condition|(
name|deform_area_vectors
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|deform_area_vectors
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_get_pixel (int x,int y,guchar * pixel)
name|iwarp_get_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|static
name|gint
name|old_col
init|=
operator|-
literal|1
decl_stmt|,
name|old_row
init|=
operator|-
literal|1
decl_stmt|;
name|guchar
modifier|*
name|data
decl_stmt|;
name|gint
name|col
decl_stmt|,
name|row
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|x
operator|>=
name|xl
operator|&&
name|x
operator|<
name|xh
operator|&&
name|y
operator|>=
name|yl
operator|&&
name|y
operator|<
name|yh
condition|)
block|{
name|col
operator|=
name|x
operator|/
name|tile_width
expr_stmt|;
name|row
operator|=
name|y
operator|/
name|tile_height
expr_stmt|;
if|if
condition|(
name|col
operator|!=
name|old_col
operator|||
name|row
operator|!=
name|old_row
condition|)
block|{
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|tile
operator|=
name|gimp_drawable_get_tile
argument_list|(
name|drawable
argument_list|,
name|FALSE
argument_list|,
name|row
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|gimp_tile_ref
argument_list|(
name|tile
argument_list|)
expr_stmt|;
name|old_col
operator|=
name|col
expr_stmt|;
name|old_row
operator|=
name|row
expr_stmt|;
block|}
name|data
operator|=
name|tile
operator|->
name|data
operator|+
operator|(
name|tile
operator|->
name|ewidth
operator|*
operator|(
name|y
operator|%
name|tile_height
operator|)
operator|+
name|x
operator|%
name|tile_width
operator|)
operator|*
name|image_bpp
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
operator|*
name|pixel
operator|++
operator|=
operator|*
name|data
operator|++
expr_stmt|;
block|}
else|else
block|{
name|pixel
index|[
literal|0
index|]
operator|=
name|pixel
index|[
literal|1
index|]
operator|=
name|pixel
index|[
literal|2
index|]
operator|=
name|pixel
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_get_deform_vector (gfloat x,gfloat y,gfloat * xv,gfloat * yv)
name|iwarp_get_deform_vector
parameter_list|(
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|gfloat
modifier|*
name|xv
parameter_list|,
name|gfloat
modifier|*
name|yv
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|xi
decl_stmt|,
name|yi
decl_stmt|;
name|gfloat
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|my0
decl_stmt|,
name|my1
decl_stmt|,
name|mx0
decl_stmt|,
name|mx1
decl_stmt|;
if|if
condition|(
name|x
operator|>=
literal|0
operator|&&
name|x
operator|<
operator|(
name|preview_width
operator|-
literal|1
operator|)
operator|&&
name|y
operator|>=
literal|0
operator|&&
name|y
operator|<
operator|(
name|preview_height
operator|-
literal|1
operator|)
condition|)
block|{
name|xi
operator|=
operator|(
name|int
operator|)
name|x
expr_stmt|;
name|yi
operator|=
operator|(
name|int
operator|)
name|y
expr_stmt|;
name|dx
operator|=
name|x
operator|-
name|xi
expr_stmt|;
name|dy
operator|=
name|y
operator|-
name|yi
expr_stmt|;
name|i
operator|=
operator|(
name|yi
operator|*
name|preview_width
operator|+
name|xi
operator|)
expr_stmt|;
name|mx0
operator|=
name|deform_vectors
index|[
name|i
index|]
operator|.
name|x
operator|+
operator|(
name|deform_vectors
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|x
operator|-
name|deform_vectors
index|[
name|i
index|]
operator|.
name|x
operator|)
operator|*
name|dx
expr_stmt|;
name|mx1
operator|=
name|deform_vectors
index|[
name|i
operator|+
name|preview_width
index|]
operator|.
name|x
operator|+
operator|(
name|deform_vectors
index|[
name|i
operator|+
name|preview_width
operator|+
literal|1
index|]
operator|.
name|x
operator|-
name|deform_vectors
index|[
name|i
operator|+
name|preview_width
index|]
operator|.
name|x
operator|)
operator|*
name|dx
expr_stmt|;
name|my0
operator|=
name|deform_vectors
index|[
name|i
index|]
operator|.
name|y
operator|+
name|dx
operator|*
operator|(
name|deform_vectors
index|[
name|i
operator|+
literal|1
index|]
operator|.
name|y
operator|-
name|deform_vectors
index|[
name|i
index|]
operator|.
name|y
operator|)
expr_stmt|;
name|my1
operator|=
name|deform_vectors
index|[
name|i
operator|+
name|preview_width
index|]
operator|.
name|y
operator|+
name|dx
operator|*
operator|(
name|deform_vectors
index|[
name|i
operator|+
name|preview_width
operator|+
literal|1
index|]
operator|.
name|y
operator|-
name|deform_vectors
index|[
name|i
operator|+
name|preview_width
index|]
operator|.
name|y
operator|)
expr_stmt|;
operator|*
name|xv
operator|=
name|mx0
operator|+
name|dy
operator|*
operator|(
name|mx1
operator|-
name|mx0
operator|)
expr_stmt|;
operator|*
name|yv
operator|=
name|my0
operator|+
name|dy
operator|*
operator|(
name|my1
operator|-
name|my0
operator|)
expr_stmt|;
block|}
else|else
operator|*
name|xv
operator|=
operator|*
name|yv
operator|=
literal|0.0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_get_point (gfloat x,gfloat y,guchar * color)
name|iwarp_get_point
parameter_list|(
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|guchar
modifier|*
name|color
parameter_list|)
block|{
name|gfloat
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|m0
decl_stmt|,
name|m1
decl_stmt|;
name|guchar
name|p0
index|[
literal|4
index|]
decl_stmt|,
name|p1
index|[
literal|4
index|]
decl_stmt|,
name|p2
index|[
literal|4
index|]
decl_stmt|,
name|p3
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|xi
decl_stmt|,
name|yi
decl_stmt|,
name|i
decl_stmt|;
name|xi
operator|=
operator|(
name|int
operator|)
name|x
expr_stmt|;
name|yi
operator|=
operator|(
name|int
operator|)
name|y
expr_stmt|;
name|dx
operator|=
name|x
operator|-
name|xi
expr_stmt|;
name|dy
operator|=
name|y
operator|-
name|yi
expr_stmt|;
name|iwarp_get_pixel
argument_list|(
name|xi
argument_list|,
name|yi
argument_list|,
name|p0
argument_list|)
expr_stmt|;
name|iwarp_get_pixel
argument_list|(
name|xi
operator|+
literal|1
argument_list|,
name|yi
argument_list|,
name|p1
argument_list|)
expr_stmt|;
name|iwarp_get_pixel
argument_list|(
name|xi
argument_list|,
name|yi
operator|+
literal|1
argument_list|,
name|p2
argument_list|)
expr_stmt|;
name|iwarp_get_pixel
argument_list|(
name|xi
operator|+
literal|1
argument_list|,
name|yi
operator|+
literal|1
argument_list|,
name|p3
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
block|{
name|m0
operator|=
name|p0
index|[
name|i
index|]
operator|+
name|dx
operator|*
operator|(
name|p1
index|[
name|i
index|]
operator|-
name|p0
index|[
name|i
index|]
operator|)
expr_stmt|;
name|m1
operator|=
name|p2
index|[
name|i
index|]
operator|+
name|dx
operator|*
operator|(
name|p3
index|[
name|i
index|]
operator|-
name|p2
index|[
name|i
index|]
operator|)
expr_stmt|;
name|color
index|[
name|i
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|m0
operator|+
name|dy
operator|*
operator|(
name|m1
operator|-
name|m0
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|iwarp_supersample_test (vector_2d * v0,vector_2d * v1,vector_2d * v2,vector_2d * v3)
name|iwarp_supersample_test
parameter_list|(
name|vector_2d
modifier|*
name|v0
parameter_list|,
name|vector_2d
modifier|*
name|v1
parameter_list|,
name|vector_2d
modifier|*
name|v2
parameter_list|,
name|vector_2d
modifier|*
name|v3
parameter_list|)
block|{
name|gfloat
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|dx
operator|=
literal|1.0
operator|+
name|v1
operator|->
name|x
operator|-
name|v0
operator|->
name|x
expr_stmt|;
name|dy
operator|=
name|v1
operator|->
name|y
operator|-
name|v0
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
operator|>
name|supersample_threshold_2
condition|)
return|return
literal|1
return|;
name|dx
operator|=
literal|1.0
operator|+
name|v2
operator|->
name|x
operator|-
name|v3
operator|->
name|x
expr_stmt|;
name|dy
operator|=
name|v2
operator|->
name|y
operator|-
name|v3
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
operator|>
name|supersample_threshold_2
condition|)
return|return
literal|1
return|;
name|dx
operator|=
name|v2
operator|->
name|x
operator|-
name|v0
operator|->
name|x
expr_stmt|;
name|dy
operator|=
literal|1.0
operator|+
name|v2
operator|->
name|y
operator|-
name|v0
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
operator|>
name|supersample_threshold_2
condition|)
return|return
literal|1
return|;
name|dx
operator|=
name|v3
operator|->
name|x
operator|-
name|v1
operator|->
name|x
expr_stmt|;
name|dy
operator|=
literal|1.0
operator|+
name|v3
operator|->
name|y
operator|-
name|v1
operator|->
name|y
expr_stmt|;
if|if
condition|(
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
operator|>
name|supersample_threshold_2
condition|)
return|return
literal|1
return|;
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_getsample (vector_2d v0,vector_2d v1,vector_2d v2,vector_2d v3,gfloat x,gfloat y,gint * sample,gint * cc,gint depth,gfloat scale)
name|iwarp_getsample
parameter_list|(
name|vector_2d
name|v0
parameter_list|,
name|vector_2d
name|v1
parameter_list|,
name|vector_2d
name|v2
parameter_list|,
name|vector_2d
name|v3
parameter_list|,
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|gint
modifier|*
name|sample
parameter_list|,
name|gint
modifier|*
name|cc
parameter_list|,
name|gint
name|depth
parameter_list|,
name|gfloat
name|scale
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|gfloat
name|xv
decl_stmt|,
name|yv
decl_stmt|;
name|vector_2d
name|v01
decl_stmt|,
name|v13
decl_stmt|,
name|v23
decl_stmt|,
name|v02
decl_stmt|,
name|vm
decl_stmt|;
name|guchar
name|c
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|depth
operator|>=
name|iwarp_vals
operator|.
name|max_supersample_depth
operator|)
operator|||
operator|(
operator|!
name|iwarp_supersample_test
argument_list|(
operator|&
name|v0
argument_list|,
operator|&
name|v1
argument_list|,
operator|&
name|v2
argument_list|,
operator|&
name|v3
argument_list|)
operator|)
condition|)
block|{
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
name|x
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
name|y
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|iwarp_get_point
argument_list|(
name|pre2img
operator|*
name|xv
operator|+
name|x
argument_list|,
name|pre2img
operator|*
name|yv
operator|+
name|y
argument_list|,
name|c
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
name|sample
index|[
name|i
index|]
operator|+=
name|c
index|[
name|i
index|]
expr_stmt|;
operator|(
operator|*
name|cc
operator|)
operator|++
expr_stmt|;
block|}
else|else
block|{
name|scale
operator|*=
literal|0.5
expr_stmt|;
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
name|x
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
name|y
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|iwarp_get_point
argument_list|(
name|pre2img
operator|*
name|xv
operator|+
name|x
argument_list|,
name|pre2img
operator|*
name|yv
operator|+
name|y
argument_list|,
name|c
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
name|sample
index|[
name|i
index|]
operator|+=
name|c
index|[
name|i
index|]
expr_stmt|;
operator|(
operator|*
name|cc
operator|)
operator|++
expr_stmt|;
name|vm
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|vm
operator|.
name|y
operator|=
name|yv
expr_stmt|;
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
name|x
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
name|y
operator|-
name|yl
operator|-
name|scale
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|v01
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|v01
operator|.
name|y
operator|=
name|yv
expr_stmt|;
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
name|x
operator|-
name|xl
operator|+
name|scale
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
name|y
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|v13
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|v13
operator|.
name|y
operator|=
name|yv
expr_stmt|;
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
name|x
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
name|y
operator|-
name|yl
operator|+
name|scale
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|v23
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|v23
operator|.
name|y
operator|=
name|yv
expr_stmt|;
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
name|x
operator|-
name|xl
operator|-
name|scale
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
name|y
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|v02
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|v02
operator|.
name|y
operator|=
name|yv
expr_stmt|;
name|iwarp_getsample
argument_list|(
name|v0
argument_list|,
name|v01
argument_list|,
name|vm
argument_list|,
name|v02
argument_list|,
name|x
operator|-
name|scale
argument_list|,
name|y
operator|-
name|scale
argument_list|,
name|sample
argument_list|,
name|cc
argument_list|,
name|depth
operator|+
literal|1
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|iwarp_getsample
argument_list|(
name|v01
argument_list|,
name|v1
argument_list|,
name|v13
argument_list|,
name|vm
argument_list|,
name|x
operator|+
name|scale
argument_list|,
name|y
operator|-
name|scale
argument_list|,
name|sample
argument_list|,
name|cc
argument_list|,
name|depth
operator|+
literal|1
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|iwarp_getsample
argument_list|(
name|v02
argument_list|,
name|vm
argument_list|,
name|v23
argument_list|,
name|v2
argument_list|,
name|x
operator|-
name|scale
argument_list|,
name|y
operator|+
name|scale
argument_list|,
name|sample
argument_list|,
name|cc
argument_list|,
name|depth
operator|+
literal|1
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|iwarp_getsample
argument_list|(
name|vm
argument_list|,
name|v13
argument_list|,
name|v3
argument_list|,
name|v23
argument_list|,
name|x
operator|+
name|scale
argument_list|,
name|y
operator|+
name|scale
argument_list|,
name|sample
argument_list|,
name|cc
argument_list|,
name|depth
operator|+
literal|1
argument_list|,
name|scale
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_supersample (gint sxl,gint syl,gint sxr,gint syr,guchar * dest_data,int stride,int * progress,int max_progress)
name|iwarp_supersample
parameter_list|(
name|gint
name|sxl
parameter_list|,
name|gint
name|syl
parameter_list|,
name|gint
name|sxr
parameter_list|,
name|gint
name|syr
parameter_list|,
name|guchar
modifier|*
name|dest_data
parameter_list|,
name|int
name|stride
parameter_list|,
name|int
modifier|*
name|progress
parameter_list|,
name|int
name|max_progress
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|wx
decl_stmt|,
name|wy
decl_stmt|,
name|col
decl_stmt|,
name|row
decl_stmt|,
name|cc
decl_stmt|;
name|vector_2d
modifier|*
name|srow
decl_stmt|,
modifier|*
name|srow_old
decl_stmt|,
modifier|*
name|vh
decl_stmt|;
name|gfloat
name|xv
decl_stmt|,
name|yv
decl_stmt|;
name|gint
name|color
index|[
literal|4
index|]
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
name|wx
operator|=
name|sxr
operator|-
name|sxl
operator|+
literal|1
expr_stmt|;
name|wy
operator|=
name|syr
operator|-
name|syl
operator|+
literal|1
expr_stmt|;
name|srow
operator|=
name|g_malloc
argument_list|(
operator|(
name|sxr
operator|-
name|sxl
operator|+
literal|1
operator|)
operator|*
literal|2
operator|*
sizeof|sizeof
argument_list|(
name|gfloat
argument_list|)
argument_list|)
expr_stmt|;
name|srow_old
operator|=
name|g_malloc
argument_list|(
operator|(
name|sxr
operator|-
name|sxl
operator|+
literal|1
operator|)
operator|*
literal|2
operator|*
sizeof|sizeof
argument_list|(
name|gfloat
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
name|sxl
init|;
name|i
operator|<
operator|(
name|sxr
operator|+
literal|1
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
operator|-
literal|0.5
operator|+
name|i
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
operator|-
literal|0.5
operator|+
name|syl
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|srow_old
index|[
name|i
operator|-
name|sxl
index|]
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|srow_old
index|[
name|i
operator|-
name|sxl
index|]
operator|.
name|y
operator|=
name|yv
expr_stmt|;
block|}
for|for
control|(
name|col
operator|=
name|syl
init|;
name|col
operator|<
name|syr
condition|;
name|col
operator|++
control|)
block|{
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
operator|-
literal|0.5
operator|+
name|sxl
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
literal|0.5
operator|+
name|col
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|srow
index|[
literal|0
index|]
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|srow
index|[
literal|0
index|]
operator|.
name|y
operator|=
name|yv
expr_stmt|;
for|for
control|(
name|row
operator|=
name|sxl
init|;
name|row
operator|<
name|sxr
condition|;
name|row
operator|++
control|)
block|{
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
literal|0.5
operator|+
name|row
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
literal|0.5
operator|+
name|col
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
name|srow
index|[
name|row
operator|-
name|sxl
operator|+
literal|1
index|]
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|srow
index|[
name|row
operator|-
name|sxl
operator|+
literal|1
index|]
operator|.
name|y
operator|=
name|yv
expr_stmt|;
name|cc
operator|=
literal|0
expr_stmt|;
name|color
index|[
literal|0
index|]
operator|=
name|color
index|[
literal|1
index|]
operator|=
name|color
index|[
literal|2
index|]
operator|=
name|color
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|iwarp_getsample
argument_list|(
name|srow_old
index|[
name|row
operator|-
name|sxl
index|]
argument_list|,
name|srow_old
index|[
name|row
operator|-
name|sxl
operator|+
literal|1
index|]
argument_list|,
name|srow
index|[
name|row
operator|-
name|sxl
index|]
argument_list|,
name|srow
index|[
name|row
operator|-
name|sxl
operator|+
literal|1
index|]
argument_list|,
name|row
argument_list|,
name|col
argument_list|,
name|color
argument_list|,
operator|&
name|cc
argument_list|,
literal|0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|layer_alpha
condition|)
name|dest
operator|=
name|dest_data
operator|+
operator|(
name|col
operator|-
name|syl
operator|)
operator|*
operator|(
name|stride
operator|)
operator|+
operator|(
name|row
operator|-
name|sxl
operator|)
operator|*
operator|(
name|image_bpp
operator|+
literal|1
operator|)
expr_stmt|;
else|else
name|dest
operator|=
name|dest_data
operator|+
operator|(
name|col
operator|-
name|syl
operator|)
operator|*
name|stride
operator|+
operator|(
name|row
operator|-
name|sxl
operator|)
operator|*
name|image_bpp
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
operator|*
name|dest
operator|++
operator|=
name|color
index|[
name|i
index|]
operator|/
name|cc
expr_stmt|;
if|if
condition|(
name|layer_alpha
condition|)
name|dest
operator|++
expr_stmt|;
operator|(
operator|*
name|progress
operator|)
operator|++
expr_stmt|;
block|}
name|gimp_progress_update
argument_list|(
call|(
name|double
call|)
argument_list|(
operator|*
name|progress
argument_list|)
operator|/
name|max_progress
argument_list|)
expr_stmt|;
name|vh
operator|=
name|srow_old
expr_stmt|;
name|srow_old
operator|=
name|srow
expr_stmt|;
name|srow
operator|=
name|vh
expr_stmt|;
block|}
name|g_free
argument_list|(
name|srow
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|srow_old
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_frame ()
name|iwarp_frame
parameter_list|()
block|{
name|GPixelRgn
name|dest_rgn
decl_stmt|;
name|gpointer
name|pr
decl_stmt|;
name|guchar
modifier|*
name|dest_row
decl_stmt|,
modifier|*
name|dest
decl_stmt|;
name|gint
name|row
decl_stmt|,
name|col
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|progress
decl_stmt|,
name|max_progress
decl_stmt|;
name|guchar
name|color
index|[
literal|4
index|]
decl_stmt|;
name|gfloat
name|xv
decl_stmt|,
name|yv
decl_stmt|;
name|progress
operator|=
literal|0
expr_stmt|;
name|max_progress
operator|=
operator|(
name|yh
operator|-
name|yl
operator|)
operator|*
operator|(
name|xh
operator|-
name|xl
operator|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|dest_rgn
argument_list|,
name|destdrawable
argument_list|,
name|xl
argument_list|,
name|yl
argument_list|,
name|xh
operator|-
name|xl
argument_list|,
name|yh
operator|-
name|yl
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|do_animate
condition|)
name|gimp_progress_init
argument_list|(
literal|"Warping ..."
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|gimp_pixel_rgns_register
argument_list|(
literal|1
argument_list|,
operator|&
name|dest_rgn
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|gimp_pixel_rgns_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
name|dest_row
operator|=
name|dest_rgn
operator|.
name|data
expr_stmt|;
if|if
condition|(
operator|!
name|iwarp_vals
operator|.
name|do_supersample
condition|)
block|{
for|for
control|(
name|row
operator|=
name|dest_rgn
operator|.
name|y
init|;
name|row
operator|<
operator|(
name|dest_rgn
operator|.
name|y
operator|+
name|dest_rgn
operator|.
name|h
operator|)
condition|;
name|row
operator|++
control|)
block|{
name|dest
operator|=
name|dest_row
expr_stmt|;
for|for
control|(
name|col
operator|=
name|dest_rgn
operator|.
name|x
init|;
name|col
operator|<
operator|(
name|dest_rgn
operator|.
name|x
operator|+
name|dest_rgn
operator|.
name|w
operator|)
condition|;
name|col
operator|++
control|)
block|{
name|progress
operator|++
expr_stmt|;
name|iwarp_get_deform_vector
argument_list|(
name|img2pre
operator|*
operator|(
name|col
operator|-
name|xl
operator|)
argument_list|,
name|img2pre
operator|*
operator|(
name|row
operator|-
name|yl
operator|)
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|*=
name|animate_deform_value
expr_stmt|;
name|yv
operator|*=
name|animate_deform_value
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|xv
argument_list|)
operator|>
literal|0.0
operator|||
name|fabs
argument_list|(
name|yv
argument_list|)
operator|>
literal|0.0
condition|)
block|{
name|iwarp_get_point
argument_list|(
name|pre2img
operator|*
name|xv
operator|+
name|col
argument_list|,
name|pre2img
operator|*
name|yv
operator|+
name|row
argument_list|,
name|color
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
operator|*
name|dest
operator|++
operator|=
name|color
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|layer_alpha
condition|)
name|dest
operator|++
expr_stmt|;
block|}
else|else
block|{
name|iwarp_get_pixel
argument_list|(
name|col
argument_list|,
name|row
argument_list|,
name|color
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
operator|*
name|dest
operator|++
operator|=
name|color
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|layer_alpha
condition|)
name|dest
operator|++
expr_stmt|;
block|}
block|}
name|dest_row
operator|+=
name|dest_rgn
operator|.
name|rowstride
expr_stmt|;
name|gimp_progress_update
argument_list|(
call|(
name|double
call|)
argument_list|(
name|progress
argument_list|)
operator|/
name|max_progress
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|supersample_threshold_2
operator|=
name|iwarp_vals
operator|.
name|supersample_threshold
operator|*
name|iwarp_vals
operator|.
name|supersample_threshold
expr_stmt|;
name|iwarp_supersample
argument_list|(
name|dest_rgn
operator|.
name|x
argument_list|,
name|dest_rgn
operator|.
name|y
argument_list|,
name|dest_rgn
operator|.
name|x
operator|+
name|dest_rgn
operator|.
name|w
argument_list|,
name|dest_rgn
operator|.
name|y
operator|+
name|dest_rgn
operator|.
name|h
argument_list|,
name|dest_rgn
operator|.
name|data
argument_list|,
name|dest_rgn
operator|.
name|rowstride
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
block|}
block|}
name|gimp_drawable_flush
argument_list|(
name|destdrawable
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|destdrawable
operator|->
name|id
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|destdrawable
operator|->
name|id
argument_list|,
name|xl
argument_list|,
name|yl
argument_list|,
operator|(
name|xh
operator|-
name|xl
operator|)
argument_list|,
operator|(
name|yh
operator|-
name|yl
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint32
DECL|function|iwarp_layer_copy (gint32 layerID)
name|iwarp_layer_copy
parameter_list|(
name|gint32
name|layerID
parameter_list|)
block|{
name|GParam
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
name|gint32
name|nlayer
decl_stmt|;
name|return_vals
operator|=
name|gimp_run_procedure
argument_list|(
literal|"gimp_layer_copy"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PARAM_LAYER
argument_list|,
name|layerID
argument_list|,
name|PARAM_INT32
argument_list|,
name|TRUE
argument_list|,
name|PARAM_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|==
name|STATUS_SUCCESS
condition|)
name|nlayer
operator|=
name|return_vals
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_layer
expr_stmt|;
else|else
name|nlayer
operator|=
operator|-
literal|1
expr_stmt|;
name|gimp_destroy_params
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
return|return
name|nlayer
return|;
block|}
end_function

begin_function
DECL|function|iwarp ()
name|void
name|iwarp
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
name|gint32
name|layerID
decl_stmt|;
name|gint32
modifier|*
name|animlayers
decl_stmt|;
name|char
name|st
index|[
literal|100
index|]
decl_stmt|;
name|gfloat
name|delta
decl_stmt|;
if|if
condition|(
name|animate_num_frames
operator|>
literal|1
operator|&&
name|do_animate
condition|)
block|{
name|animlayers
operator|=
name|g_malloc
argument_list|(
name|animate_num_frames
operator|*
sizeof|sizeof
argument_list|(
name|gint32
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|do_animate_reverse
condition|)
block|{
name|animate_deform_value
operator|=
literal|1.0
expr_stmt|;
name|delta
operator|=
operator|-
literal|1.0
operator|/
operator|(
name|animate_num_frames
operator|-
literal|1
operator|)
expr_stmt|;
block|}
else|else
block|{
name|animate_deform_value
operator|=
literal|0.0
expr_stmt|;
name|delta
operator|=
literal|1.0
operator|/
operator|(
name|animate_num_frames
operator|-
literal|1
operator|)
expr_stmt|;
block|}
name|layerID
operator|=
name|gimp_image_get_active_layer
argument_list|(
name|imageID
argument_list|)
expr_stmt|;
if|if
condition|(
name|image_bpp
operator|==
literal|1
operator|||
name|image_bpp
operator|==
literal|3
condition|)
name|layer_alpha
operator|=
name|TRUE
expr_stmt|;
else|else
name|layer_alpha
operator|=
name|FALSE
expr_stmt|;
name|frame_number
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|animate_num_frames
condition|;
name|i
operator|++
control|)
block|{
name|sprintf
argument_list|(
name|st
argument_list|,
literal|"Frame %d"
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|animlayers
index|[
name|i
index|]
operator|=
name|iwarp_layer_copy
argument_list|(
name|layerID
argument_list|)
expr_stmt|;
name|gimp_layer_set_name
argument_list|(
name|animlayers
index|[
name|i
index|]
argument_list|,
name|st
argument_list|)
expr_stmt|;
name|destdrawable
operator|=
name|gimp_drawable_get
argument_list|(
name|animlayers
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|st
argument_list|,
literal|"Warping Frame Nr %d ..."
argument_list|,
name|frame_number
argument_list|)
expr_stmt|;
name|gimp_progress_init
argument_list|(
name|st
argument_list|)
expr_stmt|;
if|if
condition|(
name|animate_deform_value
operator|>
literal|0.0
condition|)
name|iwarp_frame
argument_list|()
expr_stmt|;
name|gimp_image_add_layer
argument_list|(
name|imageID
argument_list|,
name|animlayers
index|[
name|i
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|animate_deform_value
operator|=
name|animate_deform_value
operator|+
name|delta
expr_stmt|;
name|frame_number
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|do_animate_ping_pong
condition|)
block|{
name|sprintf
argument_list|(
name|st
argument_list|,
literal|"Warping Frame Nr %d ..."
argument_list|,
name|frame_number
argument_list|)
expr_stmt|;
name|gimp_progress_init
argument_list|(
literal|"Ping Pong"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|animate_num_frames
condition|;
name|i
operator|++
control|)
block|{
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|i
operator|/
operator|(
name|animate_num_frames
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
name|layerID
operator|=
name|iwarp_layer_copy
argument_list|(
name|animlayers
index|[
name|animate_num_frames
operator|-
name|i
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|st
argument_list|,
literal|"Frame %d"
argument_list|,
name|i
operator|+
name|animate_num_frames
argument_list|)
expr_stmt|;
name|gimp_layer_set_name
argument_list|(
name|layerID
argument_list|,
name|st
argument_list|)
expr_stmt|;
name|gimp_image_add_layer
argument_list|(
name|imageID
argument_list|,
name|layerID
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
name|g_free
argument_list|(
name|animlayers
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|animate_deform_value
operator|=
literal|1.0
expr_stmt|;
name|iwarp_frame
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|tile
operator|!=
name|NULL
condition|)
block|{
name|gimp_tile_unref
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|tile
operator|=
name|NULL
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|guchar
DECL|function|iwarp_transparent_color (int x,int y)
name|iwarp_transparent_color
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
if|if
condition|(
operator|(
name|y
operator|%
name|CHECK_SIZE
operator|)
operator|>
operator|(
name|CHECK_SIZE
operator|/
literal|2
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|x
operator|%
name|CHECK_SIZE
operator|)
operator|>
operator|(
name|CHECK_SIZE
operator|/
literal|2
operator|)
condition|)
return|return
name|CHECK_DARK
return|;
else|else
return|return
name|CHECK_LIGHT
return|;
block|}
elseif|else
if|if
condition|(
operator|(
name|x
operator|%
name|CHECK_SIZE
operator|)
operator|<
operator|(
name|CHECK_SIZE
operator|/
literal|2
operator|)
condition|)
return|return
name|CHECK_DARK
return|;
else|else
return|return
name|CHECK_LIGHT
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_cpy_images ()
name|iwarp_cpy_images
parameter_list|()
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|,
name|p
decl_stmt|;
name|gfloat
name|alpha
decl_stmt|;
name|guchar
modifier|*
name|srccolor
decl_stmt|,
modifier|*
name|dstcolor
decl_stmt|;
if|if
condition|(
name|image_bpp
operator|==
literal|1
operator|||
name|image_bpp
operator|==
literal|3
condition|)
name|memcpy
argument_list|(
name|dstimage
argument_list|,
name|srcimage
argument_list|,
name|preview_width
operator|*
name|preview_height
operator|*
name|preview_bpp
argument_list|)
expr_stmt|;
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|preview_width
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|preview_height
condition|;
name|j
operator|++
control|)
block|{
name|p
operator|=
operator|(
name|j
operator|*
name|preview_width
operator|+
name|i
operator|)
expr_stmt|;
name|srccolor
operator|=
name|srcimage
operator|+
name|p
operator|*
name|image_bpp
expr_stmt|;
name|alpha
operator|=
operator|(
name|gfloat
operator|)
name|srccolor
index|[
name|image_bpp
operator|-
literal|1
index|]
operator|/
literal|255
expr_stmt|;
name|dstcolor
operator|=
name|dstimage
operator|+
name|p
operator|*
name|preview_bpp
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|preview_bpp
condition|;
name|k
operator|++
control|)
block|{
operator|*
name|dstcolor
operator|++
operator|=
call|(
name|guchar
call|)
argument_list|(
name|alpha
operator|*
name|srccolor
index|[
name|k
index|]
operator|+
operator|(
literal|1.0
operator|-
name|alpha
operator|)
operator|*
name|iwarp_transparent_color
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_init ()
name|iwarp_init
parameter_list|()
block|{
name|int
name|y
decl_stmt|,
name|x
decl_stmt|,
name|xi
decl_stmt|,
name|i
decl_stmt|;
name|GPixelRgn
name|srcrgn
decl_stmt|;
name|guchar
modifier|*
name|pts
decl_stmt|;
name|guchar
modifier|*
name|linebuffer
init|=
name|NULL
decl_stmt|;
name|gfloat
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
operator|&
name|xl
argument_list|,
operator|&
name|yl
argument_list|,
operator|&
name|xh
argument_list|,
operator|&
name|yh
argument_list|)
expr_stmt|;
name|sel_width
operator|=
name|xh
operator|-
name|xl
expr_stmt|;
name|sel_height
operator|=
name|yh
operator|-
name|yl
expr_stmt|;
name|image_bpp
operator|=
name|gimp_drawable_bpp
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
if|if
condition|(
name|image_bpp
operator|<
literal|3
condition|)
name|preview_bpp
operator|=
literal|1
expr_stmt|;
else|else
name|preview_bpp
operator|=
literal|3
expr_stmt|;
name|dx
operator|=
operator|(
name|gfloat
operator|)
name|sel_width
operator|/
name|MAX_PREVIEW_WIDTH
expr_stmt|;
name|dy
operator|=
operator|(
name|gfloat
operator|)
name|sel_height
operator|/
name|MAX_PREVIEW_HEIGHT
expr_stmt|;
if|if
condition|(
name|dx
operator|>
name|dy
condition|)
name|pre2img
operator|=
name|dx
expr_stmt|;
else|else
name|pre2img
operator|=
name|dy
expr_stmt|;
if|if
condition|(
name|dx
operator|<=
literal|1.0
operator|&&
name|dy
operator|<=
literal|1.0
condition|)
name|pre2img
operator|=
literal|1.0
expr_stmt|;
name|img2pre
operator|=
literal|1.0
operator|/
name|pre2img
expr_stmt|;
name|preview_width
operator|=
call|(
name|int
call|)
argument_list|(
name|sel_width
operator|/
name|pre2img
argument_list|)
expr_stmt|;
name|preview_height
operator|=
call|(
name|int
call|)
argument_list|(
name|sel_height
operator|/
name|pre2img
argument_list|)
expr_stmt|;
name|tile_width
operator|=
name|gimp_tile_width
argument_list|()
expr_stmt|;
name|tile_height
operator|=
name|gimp_tile_height
argument_list|()
expr_stmt|;
name|srcimage
operator|=
name|g_malloc
argument_list|(
name|preview_width
operator|*
name|preview_height
operator|*
name|image_bpp
operator|*
sizeof|sizeof
argument_list|(
name|guchar
argument_list|)
argument_list|)
expr_stmt|;
name|dstimage
operator|=
name|g_malloc
argument_list|(
name|preview_width
operator|*
name|preview_height
operator|*
name|preview_bpp
operator|*
sizeof|sizeof
argument_list|(
name|guchar
argument_list|)
argument_list|)
expr_stmt|;
name|deform_vectors
operator|=
name|g_malloc
argument_list|(
name|preview_width
operator|*
name|preview_height
operator|*
sizeof|sizeof
argument_list|(
name|gfloat
argument_list|)
operator|*
literal|2
argument_list|)
expr_stmt|;
name|deform_area_vectors
operator|=
name|g_malloc
argument_list|(
operator|(
name|MAX_DEFORM_AREA_RADIUS
operator|*
literal|2
operator|+
literal|1
operator|)
operator|*
operator|(
name|MAX_DEFORM_AREA_RADIUS
operator|*
literal|2
operator|+
literal|1
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|gfloat
argument_list|)
operator|*
literal|2
argument_list|)
expr_stmt|;
name|linebuffer
operator|=
name|g_malloc
argument_list|(
name|sel_width
operator|*
name|image_bpp
operator|*
sizeof|sizeof
argument_list|(
name|guchar
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|preview_width
operator|*
name|preview_height
condition|;
name|i
operator|++
control|)
name|deform_vectors
index|[
name|i
index|]
operator|.
name|x
operator|=
name|deform_vectors
index|[
name|i
index|]
operator|.
name|y
operator|=
literal|0.0
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|srcrgn
argument_list|,
name|drawable
argument_list|,
name|xl
argument_list|,
name|yl
argument_list|,
name|sel_width
argument_list|,
name|sel_height
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|preview_height
condition|;
name|y
operator|++
control|)
block|{
name|gimp_pixel_rgn_get_row
argument_list|(
operator|&
name|srcrgn
argument_list|,
name|linebuffer
argument_list|,
name|xl
argument_list|,
call|(
name|int
call|)
argument_list|(
name|pre2img
operator|*
name|y
argument_list|)
operator|+
name|yl
argument_list|,
name|sel_width
argument_list|)
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|preview_width
condition|;
name|x
operator|++
control|)
block|{
name|pts
operator|=
name|srcimage
operator|+
operator|(
name|y
operator|*
name|preview_width
operator|+
name|x
operator|)
operator|*
name|image_bpp
expr_stmt|;
name|xi
operator|=
call|(
name|int
call|)
argument_list|(
name|pre2img
operator|*
name|x
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|image_bpp
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|pts
operator|++
operator|=
name|linebuffer
index|[
name|xi
operator|*
name|image_bpp
operator|+
name|i
index|]
expr_stmt|;
block|}
block|}
block|}
name|iwarp_cpy_images
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_DEFORM_AREA_RADIUS
condition|;
name|i
operator|++
control|)
block|{
name|filter
index|[
name|i
index|]
operator|=
name|pow
argument_list|(
operator|(
name|cos
argument_list|(
name|sqrt
argument_list|(
operator|(
name|gfloat
operator|)
name|i
operator|/
name|MAX_DEFORM_AREA_RADIUS
argument_list|)
operator|*
name|M_PI
argument_list|)
operator|+
literal|1
operator|)
operator|*
literal|0.5
argument_list|,
literal|0.7
argument_list|)
expr_stmt|;
comment|/*0.7*/
block|}
name|g_free
argument_list|(
name|linebuffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_animate_dialog (GtkWidget * dlg,GtkWidget * notebook)
name|iwarp_animate_dialog
parameter_list|(
name|GtkWidget
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|animate_table
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkObject
modifier|*
name|scale_data
decl_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Animate"
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_animate_toggle
argument_list|,
operator|&
name|do_animate
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|animate_table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|5
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|animate_table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|animate_table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|animate_table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|animate_frame
operator|=
name|gtk_frame_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|animate_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|animate_frame
argument_list|)
argument_list|,
name|animate_table
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Number of Frames"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|animate_table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|animate_num_frames
argument_list|,
literal|2
argument_list|,
name|MAX_NUM_FRAMES
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|scale
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|animate_table
argument_list|)
argument_list|,
name|scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_iscale_update
argument_list|,
operator|&
name|animate_num_frames
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Reverse"
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|animate_table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|do_animate_reverse
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Ping Pong"
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|animate_table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|do_animate_ping_pong
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|animate_table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|animate_frame
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|animate_frame
argument_list|,
name|do_animate
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|animate_frame
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Animate"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|table
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_settings_dialog (GtkWidget * dlg,GtkWidget * notebook)
name|iwarp_settings_dialog
parameter_list|(
name|GtkWidget
modifier|*
name|dlg
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|separator
decl_stmt|;
name|GtkObject
modifier|*
name|scale_data
decl_stmt|;
name|GtkWidget
modifier|*
name|supersample_table
decl_stmt|;
name|GSList
modifier|*
name|group
init|=
name|NULL
decl_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|12
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Deform Radius"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|iwarp_vals
operator|.
name|deform_area_radius
argument_list|,
literal|5.0
argument_list|,
name|MAX_DEFORM_AREA_RADIUS
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|scale
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_iscale_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|deform_area_radius
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Deform Amount"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|iwarp_vals
operator|.
name|deform_amount
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
literal|0.01
argument_list|,
literal|0.01
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|scale
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_fscale_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|deform_amount
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|separator
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|separator
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|separator
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Move"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|toggle
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_move
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_move
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Shrink"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|toggle
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_shrink
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_shrink
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Grow"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|toggle
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_grow
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_grow
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Remove"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|toggle
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_remove
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_remove
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Swirl CW"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|toggle
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_swirl_cw
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_swirl_cw
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Swirl CCW"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|toggle
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_swirl_ccw
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_swirl_ccw
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|separator
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|separator
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|separator
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Bilinear"
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_bilinear
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_toggle_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_bilinear
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Reset"
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_reset_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|separator
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|separator
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|8
argument_list|,
literal|9
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|separator
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Adaptive Supersample"
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|iwarp_vals
operator|.
name|do_supersample
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|9
argument_list|,
literal|10
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_supersample_toggle
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|do_supersample
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|supersample_frame
operator|=
name|gtk_frame_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|supersample_frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|supersample_table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|supersample_table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|supersample_table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|supersample_table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|supersample_frame
argument_list|)
argument_list|,
name|supersample_table
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Max Depth"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|supersample_table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|iwarp_vals
operator|.
name|max_supersample_depth
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|scale
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|supersample_table
argument_list|)
argument_list|,
name|scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_iscale_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|max_supersample_depth
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Threshold"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|supersample_table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|iwarp_vals
operator|.
name|supersample_threshold
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|0.01
argument_list|,
literal|0.01
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|scale
argument_list|,
name|SCALE_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|supersample_table
argument_list|)
argument_list|,
name|scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_fscale_update
argument_list|,
operator|&
name|iwarp_vals
operator|.
name|supersample_threshold
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|supersample_table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|supersample_frame
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|supersample_frame
argument_list|,
name|iwarp_vals
operator|.
name|do_supersample
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|supersample_frame
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|11
argument_list|,
literal|12
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Settings"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|table
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|iwarp_dialog ()
name|iwarp_dialog
parameter_list|()
block|{
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
name|GtkWidget
modifier|*
name|pframe
decl_stmt|;
name|GtkWidget
modifier|*
name|top_table
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|guchar
modifier|*
name|color_cube
decl_stmt|;
name|gint
name|argc
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|argv
decl_stmt|;
name|argc
operator|=
literal|1
expr_stmt|;
name|argv
operator|=
name|g_new
argument_list|(
name|gchar
operator|*
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|=
name|g_strdup
argument_list|(
literal|"iwarp"
argument_list|)
expr_stmt|;
name|gtk_init
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|)
expr_stmt|;
name|gtk_rc_parse
argument_list|(
name|gimp_gtkrc
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_preview_set_gamma
argument_list|(
name|gimp_gamma
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_preview_set_install_cmap
argument_list|(
name|gimp_install_cmap
argument_list|()
argument_list|)
expr_stmt|;
name|color_cube
operator|=
name|gimp_color_cube
argument_list|()
expr_stmt|;
name|gtk_preview_set_color_cube
argument_list|(
name|color_cube
index|[
literal|0
index|]
argument_list|,
name|color_cube
index|[
literal|1
index|]
argument_list|,
name|color_cube
index|[
literal|2
index|]
argument_list|,
name|color_cube
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|gtk_widget_set_default_visual
argument_list|(
name|gtk_preview_get_visual
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_widget_set_default_colormap
argument_list|(
name|gtk_preview_get_cmap
argument_list|()
argument_list|)
expr_stmt|;
name|iwarp_init
argument_list|()
expr_stmt|;
name|dlg
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
literal|"IWarp"
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dlg
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dlg
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_close_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"OK"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_ok_callback
argument_list|,
name|dlg
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Cancel"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|gtk_widget_destroy
argument_list|,
name|GTK_OBJECT
argument_list|(
name|dlg
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|pframe
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|pframe
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|pframe
argument_list|)
expr_stmt|;
if|if
condition|(
name|preview_bpp
operator|==
literal|3
condition|)
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
else|else
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_GRAYSCALE
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
argument_list|)
argument_list|,
name|preview_width
argument_list|,
name|preview_height
argument_list|)
expr_stmt|;
name|iwarp_update_preview
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|preview_width
argument_list|,
name|preview_height
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|pframe
argument_list|)
argument_list|,
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|preview
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|preview
argument_list|,
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
operator||
name|GDK_BUTTON1_MOTION_MASK
operator||
name|GDK_POINTER_MOTION_HINT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|preview
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|iwarp_motion_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_tab_pos
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|iwarp_settings_dialog
argument_list|(
name|dlg
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|iwarp_animate_dialog
argument_list|(
name|dlg
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|top_table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|top_table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|top_table
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|top_table
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|top_table
argument_list|)
argument_list|,
name|pframe
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|top_table
argument_list|)
argument_list|,
name|notebook
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|top_table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|top_table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dlg
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
return|return
name|wint
operator|.
name|run
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_update_preview (int x0,int y0,int x1,int y1)
name|iwarp_update_preview
parameter_list|(
name|int
name|x0
parameter_list|,
name|int
name|y0
parameter_list|,
name|int
name|x1
parameter_list|,
name|int
name|y1
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|GdkRectangle
name|rect
decl_stmt|;
if|if
condition|(
name|x0
operator|<
literal|0
condition|)
name|x0
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|y0
operator|<
literal|0
condition|)
name|y0
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|x1
operator|>=
name|preview_width
condition|)
name|x1
operator|=
name|preview_width
expr_stmt|;
if|if
condition|(
name|y1
operator|>=
name|preview_height
condition|)
name|y1
operator|=
name|preview_height
expr_stmt|;
for|for
control|(
name|i
operator|=
name|y0
init|;
name|i
operator|<
name|y1
condition|;
name|i
operator|++
control|)
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
argument_list|)
argument_list|,
name|dstimage
operator|+
operator|(
name|i
operator|*
name|preview_width
operator|+
name|x0
operator|)
operator|*
name|preview_bpp
argument_list|,
name|x0
argument_list|,
name|i
argument_list|,
name|x1
operator|-
name|x0
argument_list|)
expr_stmt|;
name|rect
operator|.
name|x
operator|=
name|x0
expr_stmt|;
name|rect
operator|.
name|y
operator|=
name|y0
expr_stmt|;
name|rect
operator|.
name|width
operator|=
name|x1
operator|-
name|x0
expr_stmt|;
name|rect
operator|.
name|height
operator|=
name|y1
operator|-
name|y0
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|preview
argument_list|,
operator|&
name|rect
argument_list|)
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_preview_get_pixel (int x,int y,guchar ** color)
name|iwarp_preview_get_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|guchar
modifier|*
modifier|*
name|color
parameter_list|)
block|{
specifier|static
name|guchar
name|black
index|[
literal|4
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
if|if
condition|(
name|x
operator|<
literal|0
operator|||
name|x
operator|>=
name|preview_width
operator|||
name|y
operator|<
literal|0
operator|||
name|y
operator|>=
name|preview_height
condition|)
block|{
operator|*
name|color
operator|=
name|black
expr_stmt|;
return|return;
block|}
operator|*
name|color
operator|=
name|srcimage
operator|+
operator|(
name|y
operator|*
name|preview_width
operator|+
name|x
operator|)
operator|*
name|image_bpp
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_preview_get_point (gfloat x,gfloat y,guchar * color)
name|iwarp_preview_get_point
parameter_list|(
name|gfloat
name|x
parameter_list|,
name|gfloat
name|y
parameter_list|,
name|guchar
modifier|*
name|color
parameter_list|)
block|{
name|int
name|xi
decl_stmt|,
name|yi
decl_stmt|,
name|j
decl_stmt|;
name|gfloat
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|m0
decl_stmt|,
name|m1
decl_stmt|;
name|guchar
modifier|*
name|p0
decl_stmt|,
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|,
modifier|*
name|p3
decl_stmt|;
name|xi
operator|=
operator|(
name|int
operator|)
name|x
expr_stmt|;
name|yi
operator|=
operator|(
name|int
operator|)
name|y
expr_stmt|;
if|if
condition|(
name|iwarp_vals
operator|.
name|do_bilinear
condition|)
block|{
name|dx
operator|=
name|x
operator|-
name|xi
expr_stmt|;
name|dy
operator|=
name|y
operator|-
name|yi
expr_stmt|;
name|iwarp_preview_get_pixel
argument_list|(
name|xi
argument_list|,
name|yi
argument_list|,
operator|&
name|p0
argument_list|)
expr_stmt|;
name|iwarp_preview_get_pixel
argument_list|(
name|xi
operator|+
literal|1
argument_list|,
name|yi
argument_list|,
operator|&
name|p1
argument_list|)
expr_stmt|;
name|iwarp_preview_get_pixel
argument_list|(
name|xi
argument_list|,
name|yi
operator|+
literal|1
argument_list|,
operator|&
name|p2
argument_list|)
expr_stmt|;
name|iwarp_preview_get_pixel
argument_list|(
name|xi
operator|+
literal|1
argument_list|,
name|yi
operator|+
literal|1
argument_list|,
operator|&
name|p3
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|image_bpp
condition|;
name|j
operator|++
control|)
block|{
name|m0
operator|=
name|p0
index|[
name|j
index|]
operator|+
name|dx
operator|*
operator|(
name|p1
index|[
name|j
index|]
operator|-
name|p0
index|[
name|j
index|]
operator|)
expr_stmt|;
name|m1
operator|=
name|p2
index|[
name|j
index|]
operator|+
name|dx
operator|*
operator|(
name|p3
index|[
name|j
index|]
operator|-
name|p2
index|[
name|j
index|]
operator|)
expr_stmt|;
name|color
index|[
name|j
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|m0
operator|+
name|dy
operator|*
operator|(
name|m1
operator|-
name|m0
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|iwarp_preview_get_pixel
argument_list|(
name|xi
argument_list|,
name|yi
argument_list|,
operator|&
name|p0
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|image_bpp
condition|;
name|j
operator|++
control|)
name|color
index|[
name|j
index|]
operator|=
name|p0
index|[
name|j
index|]
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_deform (int x,int y,gfloat vx,gfloat vy)
name|iwarp_deform
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|gfloat
name|vx
parameter_list|,
name|gfloat
name|vy
parameter_list|)
block|{
name|int
name|xi
decl_stmt|,
name|yi
decl_stmt|,
name|ptr
decl_stmt|,
name|fptr
decl_stmt|,
name|x0
decl_stmt|,
name|x1
decl_stmt|,
name|y0
decl_stmt|,
name|y1
decl_stmt|,
name|radius2
decl_stmt|,
name|length2
decl_stmt|;
name|gfloat
name|deform_value
decl_stmt|,
name|xn
decl_stmt|,
name|yn
decl_stmt|,
name|nvx
init|=
literal|0
decl_stmt|,
name|nvy
init|=
literal|0
decl_stmt|,
name|emh
decl_stmt|,
name|em
decl_stmt|,
name|edge_width
decl_stmt|,
name|xv
decl_stmt|,
name|yv
decl_stmt|,
name|alpha
decl_stmt|;
name|guchar
name|color
index|[
literal|3
index|]
decl_stmt|;
if|if
condition|(
name|x
operator|-
name|iwarp_vals
operator|.
name|deform_area_radius
operator|<
literal|0
condition|)
name|x0
operator|=
operator|-
name|x
expr_stmt|;
else|else
name|x0
operator|=
operator|-
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
if|if
condition|(
name|x
operator|+
name|iwarp_vals
operator|.
name|deform_area_radius
operator|>=
name|preview_width
condition|)
name|x1
operator|=
name|preview_width
operator|-
name|x
operator|-
literal|1
expr_stmt|;
else|else
name|x1
operator|=
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
if|if
condition|(
name|y
operator|-
name|iwarp_vals
operator|.
name|deform_area_radius
operator|<
literal|0
condition|)
name|y0
operator|=
operator|-
name|y
expr_stmt|;
else|else
name|y0
operator|=
operator|-
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
if|if
condition|(
name|y
operator|+
name|iwarp_vals
operator|.
name|deform_area_radius
operator|>=
name|preview_height
condition|)
name|y1
operator|=
name|preview_height
operator|-
name|y
operator|-
literal|1
expr_stmt|;
else|else
name|y1
operator|=
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
name|radius2
operator|=
name|iwarp_vals
operator|.
name|deform_area_radius
operator|*
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
for|for
control|(
name|yi
operator|=
name|y0
init|;
name|yi
operator|<=
name|y1
condition|;
name|yi
operator|++
control|)
for|for
control|(
name|xi
operator|=
name|x0
init|;
name|xi
operator|<=
name|x1
condition|;
name|xi
operator|++
control|)
block|{
name|length2
operator|=
operator|(
name|xi
operator|*
name|xi
operator|+
name|yi
operator|*
name|yi
operator|)
operator|*
name|MAX_DEFORM_AREA_RADIUS
operator|/
name|radius2
expr_stmt|;
if|if
condition|(
name|length2
operator|<
name|MAX_DEFORM_AREA_RADIUS
condition|)
block|{
name|ptr
operator|=
operator|(
name|y
operator|+
name|yi
operator|)
operator|*
name|preview_width
operator|+
name|x
operator|+
name|xi
expr_stmt|;
name|fptr
operator|=
operator|(
name|yi
operator|+
name|iwarp_vals
operator|.
name|deform_area_radius
operator|)
operator|*
operator|(
name|iwarp_vals
operator|.
name|deform_area_radius
operator|*
literal|2
operator|+
literal|1
operator|)
operator|+
name|xi
operator|+
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
if|if
condition|(
name|iwarp_vals
operator|.
name|do_grow
condition|)
block|{
name|deform_value
operator|=
name|filter
index|[
name|length2
index|]
operator|*
literal|0.1
operator|*
name|iwarp_vals
operator|.
name|deform_amount
expr_stmt|;
name|nvx
operator|=
operator|-
name|deform_value
operator|*
name|xi
expr_stmt|;
name|nvy
operator|=
operator|-
name|deform_value
operator|*
name|yi
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iwarp_vals
operator|.
name|do_shrink
condition|)
block|{
name|deform_value
operator|=
name|filter
index|[
name|length2
index|]
operator|*
literal|0.1
operator|*
name|iwarp_vals
operator|.
name|deform_amount
expr_stmt|;
name|nvx
operator|=
name|deform_value
operator|*
name|xi
expr_stmt|;
name|nvy
operator|=
name|deform_value
operator|*
name|yi
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iwarp_vals
operator|.
name|do_swirl_cw
condition|)
block|{
name|deform_value
operator|=
name|filter
index|[
name|length2
index|]
operator|*
name|iwarp_vals
operator|.
name|deform_amount
operator|*
literal|0.5
expr_stmt|;
name|nvx
operator|=
name|deform_value
operator|*
name|yi
expr_stmt|;
name|nvy
operator|=
operator|-
name|deform_value
operator|*
name|xi
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iwarp_vals
operator|.
name|do_swirl_ccw
condition|)
block|{
name|deform_value
operator|=
name|filter
index|[
name|length2
index|]
operator|*
name|iwarp_vals
operator|.
name|deform_amount
operator|*
literal|0.5
expr_stmt|;
name|nvx
operator|=
operator|-
name|deform_value
operator|*
name|yi
expr_stmt|;
name|nvy
operator|=
name|deform_value
operator|*
name|xi
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iwarp_vals
operator|.
name|do_move
condition|)
block|{
name|deform_value
operator|=
name|filter
index|[
name|length2
index|]
operator|*
name|iwarp_vals
operator|.
name|deform_amount
expr_stmt|;
name|nvx
operator|=
name|deform_value
operator|*
name|vx
expr_stmt|;
name|nvy
operator|=
name|deform_value
operator|*
name|vy
expr_stmt|;
block|}
if|if
condition|(
name|iwarp_vals
operator|.
name|do_remove
condition|)
block|{
name|deform_value
operator|=
literal|1.0
operator|-
literal|0.5
operator|*
name|iwarp_vals
operator|.
name|deform_amount
operator|*
name|filter
index|[
name|length2
index|]
expr_stmt|;
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|x
operator|=
name|deform_value
operator|*
name|deform_vectors
index|[
name|ptr
index|]
operator|.
name|x
expr_stmt|;
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|y
operator|=
name|deform_value
operator|*
name|deform_vectors
index|[
name|ptr
index|]
operator|.
name|y
expr_stmt|;
block|}
else|else
block|{
name|edge_width
operator|=
literal|0.2
operator|*
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
name|emh
operator|=
name|em
operator|=
literal|1.0
expr_stmt|;
if|if
condition|(
name|x
operator|+
name|xi
operator|<
name|edge_width
condition|)
name|em
operator|=
call|(
name|gfloat
call|)
argument_list|(
name|x
operator|+
name|xi
argument_list|)
operator|/
operator|(
name|edge_width
operator|)
expr_stmt|;
if|if
condition|(
name|y
operator|+
name|yi
operator|<
name|edge_width
condition|)
name|emh
operator|=
call|(
name|gfloat
call|)
argument_list|(
name|y
operator|+
name|yi
argument_list|)
operator|/
operator|(
name|edge_width
operator|)
expr_stmt|;
if|if
condition|(
name|emh
operator|<
name|em
condition|)
name|em
operator|=
name|emh
expr_stmt|;
if|if
condition|(
name|preview_width
operator|-
name|x
operator|-
name|xi
operator|-
literal|1
operator|<
name|edge_width
condition|)
name|emh
operator|=
call|(
name|gfloat
call|)
argument_list|(
name|preview_width
operator|-
name|x
operator|-
name|xi
operator|-
literal|1
argument_list|)
operator|/
operator|(
name|edge_width
operator|)
expr_stmt|;
if|if
condition|(
name|emh
operator|<
name|em
condition|)
name|em
operator|=
name|emh
expr_stmt|;
if|if
condition|(
name|preview_height
operator|-
name|y
operator|-
name|yi
operator|-
literal|1
operator|<
name|edge_width
condition|)
name|emh
operator|=
call|(
name|gfloat
call|)
argument_list|(
name|preview_height
operator|-
name|y
operator|-
name|yi
operator|-
literal|1
argument_list|)
operator|/
operator|(
name|edge_width
operator|)
expr_stmt|;
if|if
condition|(
name|emh
operator|<
name|em
condition|)
name|em
operator|=
name|emh
expr_stmt|;
name|nvx
operator|=
name|nvx
operator|*
name|em
expr_stmt|;
name|nvy
operator|=
name|nvy
operator|*
name|em
expr_stmt|;
name|iwarp_get_deform_vector
argument_list|(
name|nvx
operator|+
name|x
operator|+
name|xi
argument_list|,
name|nvy
operator|+
name|y
operator|+
name|yi
argument_list|,
operator|&
name|xv
argument_list|,
operator|&
name|yv
argument_list|)
expr_stmt|;
name|xv
operator|=
name|nvx
operator|+
name|xv
expr_stmt|;
if|if
condition|(
name|xv
operator|+
name|x
operator|+
name|xi
operator|<
literal|0.0
condition|)
name|xv
operator|=
operator|-
name|x
operator|-
name|xi
expr_stmt|;
elseif|else
if|if
condition|(
name|xv
operator|+
name|x
operator|+
name|xi
operator|>
operator|(
name|preview_width
operator|-
literal|1
operator|)
condition|)
name|xv
operator|=
name|preview_width
operator|-
name|x
operator|-
name|xi
operator|-
literal|1
expr_stmt|;
name|yv
operator|=
name|nvy
operator|+
name|yv
expr_stmt|;
if|if
condition|(
name|yv
operator|+
name|y
operator|+
name|yi
operator|<
literal|0.0
condition|)
name|yv
operator|=
operator|-
name|y
operator|-
name|yi
expr_stmt|;
elseif|else
if|if
condition|(
name|yv
operator|+
name|y
operator|+
name|yi
operator|>
operator|(
name|preview_height
operator|-
literal|1
operator|)
condition|)
name|yv
operator|=
name|preview_height
operator|-
name|y
operator|-
name|yi
operator|-
literal|1
expr_stmt|;
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|x
operator|=
name|xv
expr_stmt|;
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|y
operator|=
name|yv
expr_stmt|;
block|}
name|xn
operator|=
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|x
operator|+
name|x
operator|+
name|xi
expr_stmt|;
name|yn
operator|=
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|y
operator|+
name|y
operator|+
name|yi
expr_stmt|;
name|iwarp_preview_get_point
argument_list|(
name|xn
argument_list|,
name|yn
argument_list|,
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
name|preview_bpp
operator|==
literal|3
condition|)
block|{
if|if
condition|(
name|image_bpp
operator|==
literal|4
condition|)
block|{
name|alpha
operator|=
operator|(
name|gfloat
operator|)
name|color
index|[
literal|3
index|]
operator|/
literal|255
expr_stmt|;
name|dstimage
index|[
name|ptr
operator|*
literal|3
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|alpha
operator|*
name|color
index|[
literal|0
index|]
operator|+
operator|(
literal|1.0
operator|-
name|alpha
operator|)
operator|*
name|iwarp_transparent_color
argument_list|(
name|x
operator|+
name|xi
argument_list|,
name|y
operator|+
name|yi
argument_list|)
argument_list|)
expr_stmt|;
name|dstimage
index|[
name|ptr
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|alpha
operator|*
name|color
index|[
literal|1
index|]
operator|+
operator|(
literal|1.0
operator|-
name|alpha
operator|)
operator|*
name|iwarp_transparent_color
argument_list|(
name|x
operator|+
name|xi
argument_list|,
name|y
operator|+
name|yi
argument_list|)
argument_list|)
expr_stmt|;
name|dstimage
index|[
name|ptr
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|alpha
operator|*
name|color
index|[
literal|2
index|]
operator|+
operator|(
literal|1.0
operator|-
name|alpha
operator|)
operator|*
name|iwarp_transparent_color
argument_list|(
name|x
operator|+
name|xi
argument_list|,
name|y
operator|+
name|yi
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|dstimage
index|[
name|ptr
operator|*
literal|3
index|]
operator|=
name|color
index|[
literal|0
index|]
expr_stmt|;
name|dstimage
index|[
name|ptr
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|color
index|[
literal|1
index|]
expr_stmt|;
name|dstimage
index|[
name|ptr
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|color
index|[
literal|2
index|]
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|image_bpp
operator|==
literal|2
condition|)
block|{
name|alpha
operator|=
operator|(
name|gfloat
operator|)
name|color
index|[
literal|1
index|]
operator|/
literal|255
expr_stmt|;
name|dstimage
index|[
name|ptr
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|alpha
operator|*
name|color
index|[
literal|0
index|]
operator|+
operator|(
literal|1.0
operator|-
name|alpha
operator|)
operator|*
name|iwarp_transparent_color
argument_list|(
name|x
operator|+
name|xi
argument_list|,
name|y
operator|+
name|yi
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|dstimage
index|[
name|ptr
index|]
operator|=
name|color
index|[
literal|0
index|]
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
name|yi
operator|=
name|y0
init|;
name|yi
operator|<=
name|y1
condition|;
name|yi
operator|++
control|)
for|for
control|(
name|xi
operator|=
name|x0
init|;
name|xi
operator|<=
name|x1
condition|;
name|xi
operator|++
control|)
block|{
name|length2
operator|=
operator|(
name|xi
operator|*
name|xi
operator|+
name|yi
operator|*
name|yi
operator|)
operator|*
name|MAX_DEFORM_AREA_RADIUS
operator|/
name|radius2
expr_stmt|;
if|if
condition|(
name|length2
operator|<
name|MAX_DEFORM_AREA_RADIUS
condition|)
block|{
name|ptr
operator|=
operator|(
name|yi
operator|+
name|y
operator|)
operator|*
name|preview_width
operator|+
name|xi
operator|+
name|x
expr_stmt|;
name|fptr
operator|=
operator|(
name|yi
operator|+
name|iwarp_vals
operator|.
name|deform_area_radius
operator|)
operator|*
operator|(
name|iwarp_vals
operator|.
name|deform_area_radius
operator|*
literal|2
operator|+
literal|1
operator|)
operator|+
name|xi
operator|+
name|iwarp_vals
operator|.
name|deform_area_radius
expr_stmt|;
name|deform_vectors
index|[
name|ptr
index|]
operator|.
name|x
operator|=
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|x
expr_stmt|;
name|deform_vectors
index|[
name|ptr
index|]
operator|.
name|y
operator|=
name|deform_area_vectors
index|[
name|fptr
index|]
operator|.
name|y
expr_stmt|;
block|}
block|}
name|iwarp_update_preview
argument_list|(
name|x
operator|+
name|x0
argument_list|,
name|y
operator|+
name|y0
argument_list|,
name|x
operator|+
name|x1
operator|+
literal|1
argument_list|,
name|y
operator|+
name|y1
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_move (int x,int y,int xx,int yy)
name|iwarp_move
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|xx
parameter_list|,
name|int
name|yy
parameter_list|)
block|{
name|gfloat
name|l
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|xf
decl_stmt|,
name|yf
decl_stmt|;
name|int
name|num
decl_stmt|,
name|i
decl_stmt|,
name|x0
decl_stmt|,
name|y0
decl_stmt|;
name|dx
operator|=
name|x
operator|-
name|xx
expr_stmt|;
name|dy
operator|=
name|y
operator|-
name|yy
expr_stmt|;
name|l
operator|=
name|sqrt
argument_list|(
name|dx
operator|*
name|dx
operator|+
name|dy
operator|*
name|dy
argument_list|)
expr_stmt|;
name|num
operator|=
call|(
name|int
call|)
argument_list|(
name|l
operator|*
literal|2
operator|/
name|iwarp_vals
operator|.
name|deform_area_radius
argument_list|)
operator|+
literal|1
expr_stmt|;
name|dx
operator|/=
name|num
expr_stmt|;
name|dy
operator|/=
name|num
expr_stmt|;
name|xf
operator|=
name|xx
operator|+
name|dx
expr_stmt|;
name|yf
operator|=
name|yy
operator|+
name|dy
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num
condition|;
name|i
operator|++
control|)
block|{
name|x0
operator|=
call|(
name|int
call|)
argument_list|(
name|xf
argument_list|)
expr_stmt|;
name|y0
operator|=
call|(
name|int
call|)
argument_list|(
name|yf
argument_list|)
expr_stmt|;
name|iwarp_deform
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|,
operator|-
name|dx
argument_list|,
operator|-
name|dy
argument_list|)
expr_stmt|;
name|xf
operator|+=
name|dx
expr_stmt|;
name|yf
operator|+=
name|dy
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_close_callback (GtkWidget * widget,gpointer data)
name|iwarp_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_ok_callback (GtkWidget * widget,gpointer data)
name|iwarp_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|wint
operator|.
name|run
operator|=
name|TRUE
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|iwarp_motion_callback (GtkWidget * widget,GdkEvent * event)
name|iwarp_motion_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventButton
modifier|*
name|mb
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|mb
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
name|x
operator|=
name|mb
operator|->
name|x
expr_stmt|;
name|y
operator|=
name|mb
operator|->
name|y
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|lastx
operator|=
name|x
expr_stmt|;
name|lasty
operator|=
name|y
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
if|if
condition|(
name|mb
operator|->
name|state
operator|&
name|GDK_BUTTON1_MASK
condition|)
block|{
if|if
condition|(
name|iwarp_vals
operator|.
name|do_move
condition|)
name|iwarp_move
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|lastx
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
else|else
name|iwarp_deform
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GDK_MOTION_NOTIFY
case|:
if|if
condition|(
name|mb
operator|->
name|state
operator|&
name|GDK_BUTTON1_MASK
condition|)
block|{
if|if
condition|(
name|iwarp_vals
operator|.
name|do_move
condition|)
name|iwarp_move
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|lastx
argument_list|,
name|lasty
argument_list|)
expr_stmt|;
else|else
name|iwarp_deform
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|lastx
operator|=
name|x
expr_stmt|;
name|lasty
operator|=
name|y
expr_stmt|;
name|gtk_widget_get_pointer
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_iscale_update (GtkAdjustment * adjustment,gint * scale_val)
name|iwarp_iscale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gint
modifier|*
name|scale_val
parameter_list|)
block|{
operator|*
name|scale_val
operator|=
operator|(
name|gint
operator|)
name|adjustment
operator|->
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_fscale_update (GtkAdjustment * adjustment,gfloat * scale_val)
name|iwarp_fscale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gfloat
modifier|*
name|scale_val
parameter_list|)
block|{
operator|*
name|scale_val
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_toggle_update (GtkWidget * widget,int * data)
name|iwarp_toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|int
modifier|*
name|data
parameter_list|)
block|{
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
operator|*
name|data
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|data
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_supersample_toggle (GtkWidget * widget,int * data)
name|iwarp_supersample_toggle
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|int
modifier|*
name|data
parameter_list|)
block|{
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
operator|*
name|data
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|data
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|supersample_frame
argument_list|,
name|iwarp_vals
operator|.
name|do_supersample
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_animate_toggle (GtkWidget * widget,int * data)
name|iwarp_animate_toggle
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|int
modifier|*
name|data
parameter_list|)
block|{
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
operator|*
name|data
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|data
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|animate_frame
argument_list|,
name|do_animate
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|iwarp_reset_callback (GtkWidget * widget,gpointer data)
name|iwarp_reset_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|iwarp_cpy_images
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|preview_width
operator|*
name|preview_height
condition|;
name|i
operator|++
control|)
name|deform_vectors
index|[
name|i
index|]
operator|.
name|x
operator|=
name|deform_vectors
index|[
name|i
index|]
operator|.
name|y
operator|=
literal|0.0
expr_stmt|;
name|iwarp_update_preview
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|preview_width
argument_list|,
name|preview_height
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

