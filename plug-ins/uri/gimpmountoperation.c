begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* -*- Mode: C; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */
end_comment

begin_comment
comment|/* GTK - The GIMP Toolkit  * Copyright (C) Christian Kellner<gicmo@gnome.org>  *  * This library is free software; you can redistribute it and/or  * modify it under the terms of the GNU Lesser General Public  * License as published by the Free Software Foundation; either  * version 2 of the License, or (at your option) any later version.  *  * This library is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  * Lesser General Public License for more details.  *  * You should have received a copy of the GNU Lesser General Public  * License along with this library; if not, write to the  * Free Software Foundation, Inc., 59 Temple Place - Suite 330,  * Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/*  * Modified by the GTK+ Team and others 1997-2000.  See the AUTHORS  * file for a list of people on the GTK+ Team.  See the ChangeLog  * files for a list of changes.  These files are distributed with  * GTK+ at ftp://ftp.gtk.org/pub/gtk/.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"gimpmountoperation.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_comment
comment|/* GObject, GtkObject methods  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_mount_operation_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_mount_operation_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_mount_operation_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* GMountOperation methods  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_mount_operation_ask_password
parameter_list|(
name|GMountOperation
modifier|*
name|op
parameter_list|,
specifier|const
name|char
modifier|*
name|message
parameter_list|,
specifier|const
name|char
modifier|*
name|default_user
parameter_list|,
specifier|const
name|char
modifier|*
name|default_domain
parameter_list|,
name|GAskPasswordFlags
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_mount_operation_ask_question
parameter_list|(
name|GMountOperation
modifier|*
name|op
parameter_list|,
specifier|const
name|char
modifier|*
name|message
parameter_list|,
specifier|const
name|char
modifier|*
name|choices
index|[]
parameter_list|)
function_decl|;
end_function_decl

begin_expr_stmt
name|G_DEFINE_TYPE
argument_list|(
name|GimpMountOperation
argument_list|,
name|gimp_mount_operation
argument_list|,
name|G_TYPE_MOUNT_OPERATION
argument_list|)
expr_stmt|;
end_expr_stmt

begin_enum
DECL|enum|__anon28f0406d0103
enum|enum
block|{
DECL|enumerator|PROP_0
name|PROP_0
block|,
DECL|enumerator|PROP_PARENT
name|PROP_PARENT
block|,
DECL|enumerator|PROP_IS_SHOWING
name|PROP_IS_SHOWING
block|,
DECL|enumerator|PROP_SCREEN
name|PROP_SCREEN
block|}
enum|;
end_enum

begin_struct
DECL|struct|GimpMountOperationPrivate
struct|struct
name|GimpMountOperationPrivate
block|{
DECL|member|parent_window
name|GtkWindow
modifier|*
name|parent_window
decl_stmt|;
DECL|member|dialog
name|GtkDialog
modifier|*
name|dialog
decl_stmt|;
DECL|member|screen
name|GdkScreen
modifier|*
name|screen
decl_stmt|;
comment|/* for the ask-password dialog */
DECL|member|entry_container
name|GtkWidget
modifier|*
name|entry_container
decl_stmt|;
DECL|member|username_entry
name|GtkWidget
modifier|*
name|username_entry
decl_stmt|;
DECL|member|domain_entry
name|GtkWidget
modifier|*
name|domain_entry
decl_stmt|;
DECL|member|password_entry
name|GtkWidget
modifier|*
name|password_entry
decl_stmt|;
DECL|member|anonymous_toggle
name|GtkWidget
modifier|*
name|anonymous_toggle
decl_stmt|;
DECL|member|ask_flags
name|GAskPasswordFlags
name|ask_flags
decl_stmt|;
DECL|member|password_save
name|GPasswordSave
name|password_save
decl_stmt|;
DECL|member|anonymous
name|gboolean
name|anonymous
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
DECL|function|gimp_mount_operation_finalize (GObject * object)
name|gimp_mount_operation_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpMountOperation
modifier|*
name|operation
decl_stmt|;
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|operation
operator|=
name|GIMP_MOUNT_OPERATION
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|priv
operator|=
name|operation
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|parent_window
condition|)
name|g_object_unref
argument_list|(
name|priv
operator|->
name|parent_window
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|screen
condition|)
name|g_object_unref
argument_list|(
name|priv
operator|->
name|screen
argument_list|)
expr_stmt|;
name|G_OBJECT_CLASS
argument_list|(
name|gimp_mount_operation_parent_class
argument_list|)
operator|->
name|finalize
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_mount_operation_class_init (GimpMountOperationClass * klass)
name|gimp_mount_operation_class_init
parameter_list|(
name|GimpMountOperationClass
modifier|*
name|klass
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|object_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GMountOperationClass
modifier|*
name|mount_op_class
decl_stmt|;
name|g_type_class_add_private
argument_list|(
name|klass
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpMountOperationPrivate
argument_list|)
argument_list|)
expr_stmt|;
name|object_class
operator|->
name|finalize
operator|=
name|gimp_mount_operation_finalize
expr_stmt|;
name|object_class
operator|->
name|get_property
operator|=
name|gimp_mount_operation_get_property
expr_stmt|;
name|object_class
operator|->
name|set_property
operator|=
name|gimp_mount_operation_set_property
expr_stmt|;
name|mount_op_class
operator|=
name|G_MOUNT_OPERATION_CLASS
argument_list|(
name|klass
argument_list|)
expr_stmt|;
name|mount_op_class
operator|->
name|ask_password
operator|=
name|gimp_mount_operation_ask_password
expr_stmt|;
name|mount_op_class
operator|->
name|ask_question
operator|=
name|gimp_mount_operation_ask_question
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_PARENT
argument_list|,
name|g_param_spec_object
argument_list|(
literal|"parent"
argument_list|,
literal|"Parent"
argument_list|,
literal|"The parent window"
argument_list|,
name|GTK_TYPE_WINDOW
argument_list|,
name|G_PARAM_READWRITE
operator||
name|G_PARAM_STATIC_STRINGS
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_IS_SHOWING
argument_list|,
name|g_param_spec_boolean
argument_list|(
literal|"is-showing"
argument_list|,
literal|"Is Showing"
argument_list|,
literal|"Are we showing a dialog"
argument_list|,
name|FALSE
argument_list|,
name|G_PARAM_READABLE
operator||
name|G_PARAM_STATIC_STRINGS
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_SCREEN
argument_list|,
name|g_param_spec_object
argument_list|(
literal|"screen"
argument_list|,
literal|"Screen"
argument_list|,
literal|"The screen where this window will be displayed."
argument_list|,
name|GTK_TYPE_WINDOW
argument_list|,
name|G_PARAM_READWRITE
operator||
name|G_PARAM_STATIC_STRINGS
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_mount_operation_set_property (GObject * object,guint prop_id,const GValue * value,GParamSpec * pspec)
name|gimp_mount_operation_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GimpMountOperation
modifier|*
name|operation
decl_stmt|;
name|gpointer
name|tmp
decl_stmt|;
name|operation
operator|=
name|GIMP_MOUNT_OPERATION
argument_list|(
name|object
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|prop_id
condition|)
block|{
case|case
name|PROP_PARENT
case|:
name|tmp
operator|=
name|g_value_get_object
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|gimp_mount_operation_set_parent
argument_list|(
name|operation
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_SCREEN
case|:
name|tmp
operator|=
name|g_value_get_object
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|gimp_mount_operation_set_screen
argument_list|(
name|operation
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_IS_SHOWING
case|:
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|prop_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_mount_operation_get_property (GObject * object,guint prop_id,GValue * value,GParamSpec * pspec)
name|gimp_mount_operation_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpMountOperation
modifier|*
name|operation
decl_stmt|;
name|operation
operator|=
name|GIMP_MOUNT_OPERATION
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|priv
operator|=
name|operation
operator|->
name|priv
expr_stmt|;
switch|switch
condition|(
name|prop_id
condition|)
block|{
case|case
name|PROP_PARENT
case|:
name|g_value_set_object
argument_list|(
name|value
argument_list|,
name|priv
operator|->
name|parent_window
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_IS_SHOWING
case|:
name|g_value_set_boolean
argument_list|(
name|value
argument_list|,
name|priv
operator|->
name|dialog
operator|!=
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_SCREEN
case|:
name|g_value_set_object
argument_list|(
name|value
argument_list|,
name|priv
operator|->
name|screen
argument_list|)
expr_stmt|;
break|break;
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|prop_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_mount_operation_init (GimpMountOperation * operation)
name|gimp_mount_operation_init
parameter_list|(
name|GimpMountOperation
modifier|*
name|operation
parameter_list|)
block|{
name|operation
operator|->
name|priv
operator|=
name|G_TYPE_INSTANCE_GET_PRIVATE
argument_list|(
name|operation
argument_list|,
name|GIMP_TYPE_MOUNT_OPERATION
argument_list|,
name|GimpMountOperationPrivate
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|remember_button_toggled (GtkWidget * widget,GimpMountOperation * operation)
name|remember_button_toggled
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpMountOperation
modifier|*
name|operation
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
init|=
name|operation
operator|->
name|priv
decl_stmt|;
name|gpointer
name|data
decl_stmt|;
name|data
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"password-save"
argument_list|)
expr_stmt|;
name|priv
operator|->
name|password_save
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pw_dialog_got_response (GtkDialog * dialog,gint response_id,GimpMountOperation * mount_op)
name|pw_dialog_got_response
parameter_list|(
name|GtkDialog
modifier|*
name|dialog
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|GimpMountOperation
modifier|*
name|mount_op
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|GMountOperation
modifier|*
name|op
decl_stmt|;
name|priv
operator|=
name|mount_op
operator|->
name|priv
expr_stmt|;
name|op
operator|=
name|G_MOUNT_OPERATION
argument_list|(
name|mount_op
argument_list|)
expr_stmt|;
if|if
condition|(
name|response_id
operator|==
name|GTK_RESPONSE_OK
condition|)
block|{
specifier|const
name|char
modifier|*
name|text
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|ask_flags
operator|&
name|G_ASK_PASSWORD_ANONYMOUS_SUPPORTED
condition|)
name|g_mount_operation_set_anonymous
argument_list|(
name|op
argument_list|,
name|priv
operator|->
name|anonymous
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|username_entry
condition|)
block|{
name|text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|priv
operator|->
name|username_entry
argument_list|)
argument_list|)
expr_stmt|;
name|g_mount_operation_set_username
argument_list|(
name|op
argument_list|,
name|text
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|domain_entry
condition|)
block|{
name|text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|priv
operator|->
name|domain_entry
argument_list|)
argument_list|)
expr_stmt|;
name|g_mount_operation_set_domain
argument_list|(
name|op
argument_list|,
name|text
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|password_entry
condition|)
block|{
name|text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|priv
operator|->
name|password_entry
argument_list|)
argument_list|)
expr_stmt|;
name|g_mount_operation_set_password
argument_list|(
name|op
argument_list|,
name|text
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|ask_flags
operator|&
name|G_ASK_PASSWORD_SAVING_SUPPORTED
condition|)
name|g_mount_operation_set_password_save
argument_list|(
name|op
argument_list|,
name|priv
operator|->
name|password_save
argument_list|)
expr_stmt|;
name|g_mount_operation_reply
argument_list|(
name|op
argument_list|,
name|G_MOUNT_OPERATION_HANDLED
argument_list|)
expr_stmt|;
block|}
else|else
name|g_mount_operation_reply
argument_list|(
name|op
argument_list|,
name|G_MOUNT_OPERATION_ABORTED
argument_list|)
expr_stmt|;
name|priv
operator|->
name|dialog
operator|=
name|NULL
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|op
argument_list|)
argument_list|,
literal|"is-showing"
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|op
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|entry_has_input (GtkWidget * entry_widget)
name|entry_has_input
parameter_list|(
name|GtkWidget
modifier|*
name|entry_widget
parameter_list|)
block|{
specifier|const
name|char
modifier|*
name|text
decl_stmt|;
if|if
condition|(
name|entry_widget
operator|==
name|NULL
condition|)
return|return
name|TRUE
return|;
name|text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry_widget
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|text
operator|!=
name|NULL
operator|&&
name|text
index|[
literal|0
index|]
operator|!=
literal|'\0'
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|pw_dialog_input_is_valid (GimpMountOperation * operation)
name|pw_dialog_input_is_valid
parameter_list|(
name|GimpMountOperation
modifier|*
name|operation
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
init|=
name|operation
operator|->
name|priv
decl_stmt|;
name|gboolean
name|is_valid
init|=
name|TRUE
decl_stmt|;
name|is_valid
operator|=
name|entry_has_input
argument_list|(
name|priv
operator|->
name|username_entry
argument_list|)
operator|&&
name|entry_has_input
argument_list|(
name|priv
operator|->
name|domain_entry
argument_list|)
operator|&&
name|entry_has_input
argument_list|(
name|priv
operator|->
name|password_entry
argument_list|)
expr_stmt|;
return|return
name|is_valid
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pw_dialog_verify_input (GtkEditable * editable,GimpMountOperation * operation)
name|pw_dialog_verify_input
parameter_list|(
name|GtkEditable
modifier|*
name|editable
parameter_list|,
name|GimpMountOperation
modifier|*
name|operation
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
init|=
name|operation
operator|->
name|priv
decl_stmt|;
name|gboolean
name|is_valid
decl_stmt|;
name|is_valid
operator|=
name|pw_dialog_input_is_valid
argument_list|(
name|operation
argument_list|)
expr_stmt|;
name|gtk_dialog_set_response_sensitive
argument_list|(
name|GTK_DIALOG
argument_list|(
name|priv
operator|->
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|is_valid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pw_dialog_anonymous_toggled (GtkWidget * widget,GimpMountOperation * operation)
name|pw_dialog_anonymous_toggled
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpMountOperation
modifier|*
name|operation
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
init|=
name|operation
operator|->
name|priv
decl_stmt|;
name|gboolean
name|is_valid
decl_stmt|;
name|priv
operator|->
name|anonymous
operator|=
name|widget
operator|==
name|priv
operator|->
name|anonymous_toggle
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|anonymous
condition|)
name|is_valid
operator|=
name|TRUE
expr_stmt|;
else|else
name|is_valid
operator|=
name|pw_dialog_input_is_valid
argument_list|(
name|operation
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|priv
operator|->
name|entry_container
argument_list|,
name|priv
operator|->
name|anonymous
operator|==
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_dialog_set_response_sensitive
argument_list|(
name|GTK_DIALOG
argument_list|(
name|priv
operator|->
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|is_valid
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pw_dialog_cycle_focus (GtkWidget * widget,GimpMountOperation * operation)
name|pw_dialog_cycle_focus
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpMountOperation
modifier|*
name|operation
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkWidget
modifier|*
name|next_widget
init|=
name|NULL
decl_stmt|;
name|priv
operator|=
name|operation
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|priv
operator|->
name|username_entry
condition|)
block|{
if|if
condition|(
name|priv
operator|->
name|domain_entry
operator|!=
name|NULL
condition|)
name|next_widget
operator|=
name|priv
operator|->
name|domain_entry
expr_stmt|;
elseif|else
if|if
condition|(
name|priv
operator|->
name|password_entry
operator|!=
name|NULL
condition|)
name|next_widget
operator|=
name|priv
operator|->
name|password_entry
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|widget
operator|==
name|priv
operator|->
name|domain_entry
operator|&&
name|priv
operator|->
name|password_entry
condition|)
name|next_widget
operator|=
name|priv
operator|->
name|password_entry
expr_stmt|;
if|if
condition|(
name|next_widget
condition|)
name|gtk_widget_grab_focus
argument_list|(
name|next_widget
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|pw_dialog_input_is_valid
argument_list|(
name|operation
argument_list|)
condition|)
name|gtk_window_activate_default
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|table_add_entry (GtkWidget * table,int row,const char * label_text,const char * value,gpointer user_data)
name|table_add_entry
parameter_list|(
name|GtkWidget
modifier|*
name|table
parameter_list|,
name|int
name|row
parameter_list|,
specifier|const
name|char
modifier|*
name|label_text
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|gtk_label_new_with_mnemonic
argument_list|(
name|label_text
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|value
condition|)
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|)
expr_stmt|;
name|gtk_label_set_mnemonic_widget
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|entry
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|entry
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|pw_dialog_verify_input
argument_list|)
argument_list|,
name|user_data
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|entry
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|pw_dialog_cycle_focus
argument_list|)
argument_list|,
name|user_data
argument_list|)
expr_stmt|;
return|return
name|entry
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_mount_operation_ask_password (GMountOperation * mount_op,const char * message,const char * default_user,const char * default_domain,GAskPasswordFlags flags)
name|gimp_mount_operation_ask_password
parameter_list|(
name|GMountOperation
modifier|*
name|mount_op
parameter_list|,
specifier|const
name|char
modifier|*
name|message
parameter_list|,
specifier|const
name|char
modifier|*
name|default_user
parameter_list|,
specifier|const
name|char
modifier|*
name|default_domain
parameter_list|,
name|GAskPasswordFlags
name|flags
parameter_list|)
block|{
name|GimpMountOperation
modifier|*
name|operation
decl_stmt|;
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
name|GtkDialog
modifier|*
name|dialog
decl_stmt|;
name|GtkWindow
modifier|*
name|window
decl_stmt|;
name|GtkWidget
modifier|*
name|entry_container
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|,
modifier|*
name|main_vbox
decl_stmt|,
modifier|*
name|vbox
decl_stmt|,
modifier|*
name|icon
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|message_label
decl_stmt|;
name|gboolean
name|can_anonymous
decl_stmt|;
name|guint
name|rows
decl_stmt|;
name|operation
operator|=
name|GIMP_MOUNT_OPERATION
argument_list|(
name|mount_op
argument_list|)
expr_stmt|;
name|priv
operator|=
name|operation
operator|->
name|priv
expr_stmt|;
name|priv
operator|->
name|ask_flags
operator|=
name|flags
expr_stmt|;
name|widget
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|dialog
operator|=
name|GTK_DIALOG
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|window
operator|=
name|GTK_WINDOW
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|priv
operator|->
name|dialog
operator|=
name|dialog
expr_stmt|;
comment|/* Set the dialog up with HIG properties */
name|gtk_dialog_set_has_separator
argument_list|(
name|dialog
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_set_spacing
argument_list|(
name|GTK_BOX
argument_list|(
name|dialog
operator|->
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* 2 * 5 + 2 = 12 */
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dialog
operator|->
name|action_area
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_set_spacing
argument_list|(
name|GTK_BOX
argument_list|(
name|dialog
operator|->
name|action_area
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_window_set_resizable
argument_list|(
name|window
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_window_set_icon_name
argument_list|(
name|window
argument_list|,
name|GTK_STOCK_DIALOG_AUTHENTICATION
argument_list|)
expr_stmt|;
name|gtk_dialog_add_buttons
argument_list|(
name|dialog
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|_
argument_list|(
literal|"Co_nnect"
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|dialog
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|dialog
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Build contents */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|dialog
operator|->
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|icon
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|GTK_STOCK_DIALOG_AUTHENTICATION
argument_list|,
name|GTK_ICON_SIZE_DIALOG
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|icon
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|icon
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|18
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|main_vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|message_label
operator|=
name|gtk_label_new
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|message_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_label_set_line_wrap
argument_list|(
name|GTK_LABEL
argument_list|(
name|message_label
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|GTK_WIDGET
argument_list|(
name|message_label
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|can_anonymous
operator|=
name|flags
operator|&
name|G_ASK_PASSWORD_ANONYMOUS_SUPPORTED
expr_stmt|;
if|if
condition|(
name|can_anonymous
condition|)
block|{
name|GtkWidget
modifier|*
name|anon_box
decl_stmt|;
name|GtkWidget
modifier|*
name|choice
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|anon_box
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|anon_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|choice
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Connect _anonymously"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|anon_box
argument_list|)
argument_list|,
name|choice
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|choice
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|pw_dialog_anonymous_toggled
argument_list|)
argument_list|,
name|operation
argument_list|)
expr_stmt|;
name|priv
operator|->
name|anonymous_toggle
operator|=
name|choice
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|choice
argument_list|)
argument_list|)
expr_stmt|;
name|choice
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"Connect as u_ser:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|anon_box
argument_list|)
argument_list|,
name|choice
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|choice
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|pw_dialog_anonymous_toggled
argument_list|)
argument_list|,
name|operation
argument_list|)
expr_stmt|;
block|}
name|rows
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|G_ASK_PASSWORD_NEED_PASSWORD
condition|)
name|rows
operator|++
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|G_ASK_PASSWORD_NEED_USERNAME
condition|)
name|rows
operator|++
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|G_ASK_PASSWORD_NEED_DOMAIN
condition|)
name|rows
operator|++
expr_stmt|;
comment|/* The table that holds the entries */
name|entry_container
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_alignment_set_padding
argument_list|(
name|GTK_ALIGNMENT
argument_list|(
name|entry_container
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|can_anonymous
condition|?
literal|12
else|:
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|entry_container
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|priv
operator|->
name|entry_container
operator|=
name|entry_container
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
name|rows
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|entry_container
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|rows
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|G_ASK_PASSWORD_NEED_USERNAME
condition|)
name|priv
operator|->
name|username_entry
operator|=
name|table_add_entry
argument_list|(
name|table
argument_list|,
name|rows
operator|++
argument_list|,
name|_
argument_list|(
literal|"_Username:"
argument_list|)
argument_list|,
name|default_user
argument_list|,
name|operation
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|G_ASK_PASSWORD_NEED_DOMAIN
condition|)
name|priv
operator|->
name|domain_entry
operator|=
name|table_add_entry
argument_list|(
name|table
argument_list|,
name|rows
operator|++
argument_list|,
name|_
argument_list|(
literal|"_Domain:"
argument_list|)
argument_list|,
name|default_domain
argument_list|,
name|operation
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|G_ASK_PASSWORD_NEED_PASSWORD
condition|)
block|{
name|priv
operator|->
name|password_entry
operator|=
name|table_add_entry
argument_list|(
name|table
argument_list|,
name|rows
operator|++
argument_list|,
name|_
argument_list|(
literal|"_Password:"
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|operation
argument_list|)
expr_stmt|;
name|gtk_entry_set_visibility
argument_list|(
name|GTK_ENTRY
argument_list|(
name|priv
operator|->
name|password_entry
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|flags
operator|&
name|G_ASK_PASSWORD_SAVING_SUPPORTED
condition|)
block|{
name|GtkWidget
modifier|*
name|choice
decl_stmt|;
name|GtkWidget
modifier|*
name|remember_box
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|remember_box
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|remember_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|choice
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|NULL
argument_list|,
name|_
argument_list|(
literal|"_Forget password immediately"
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|choice
argument_list|)
argument_list|,
literal|"password-save"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|G_PASSWORD_SAVE_NEVER
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|choice
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|remember_button_toggled
argument_list|)
argument_list|,
name|operation
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|remember_box
argument_list|)
argument_list|,
name|choice
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|choice
argument_list|)
argument_list|)
expr_stmt|;
name|choice
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"_Remember password until you logout"
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|choice
argument_list|)
argument_list|,
literal|"password-save"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|G_PASSWORD_SAVE_FOR_SESSION
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|choice
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|remember_button_toggled
argument_list|)
argument_list|,
name|operation
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|remember_box
argument_list|)
argument_list|,
name|choice
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|choice
argument_list|)
argument_list|)
expr_stmt|;
name|choice
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"_Remember forever"
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|choice
argument_list|)
argument_list|,
literal|"password-save"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|G_PASSWORD_SAVE_PERMANENTLY
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|choice
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|remember_button_toggled
argument_list|)
argument_list|,
name|operation
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|remember_box
argument_list|)
argument_list|,
name|choice
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|pw_dialog_got_response
argument_list|)
argument_list|,
name|operation
argument_list|)
expr_stmt|;
if|if
condition|(
name|can_anonymous
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|priv
operator|->
name|entry_container
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|pw_dialog_input_is_valid
argument_list|(
name|operation
argument_list|)
condition|)
name|gtk_dialog_set_response_sensitive
argument_list|(
name|dialog
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|operation
argument_list|)
argument_list|,
literal|"is-showing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|parent_window
operator|==
name|NULL
operator|&&
name|priv
operator|->
name|screen
condition|)
name|gtk_window_set_screen
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|priv
operator|->
name|screen
argument_list|)
expr_stmt|;
name|gtk_widget_show_all
argument_list|(
name|GTK_WIDGET
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|operation
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|question_dialog_button_clicked (GtkDialog * dialog,gint button_number,GMountOperation * op)
name|question_dialog_button_clicked
parameter_list|(
name|GtkDialog
modifier|*
name|dialog
parameter_list|,
name|gint
name|button_number
parameter_list|,
name|GMountOperation
modifier|*
name|op
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpMountOperation
modifier|*
name|operation
decl_stmt|;
name|operation
operator|=
name|GIMP_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
expr_stmt|;
name|priv
operator|=
name|operation
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|button_number
operator|>=
literal|0
condition|)
block|{
name|g_mount_operation_set_choice
argument_list|(
name|op
argument_list|,
name|button_number
argument_list|)
expr_stmt|;
name|g_mount_operation_reply
argument_list|(
name|op
argument_list|,
name|G_MOUNT_OPERATION_HANDLED
argument_list|)
expr_stmt|;
block|}
else|else
name|g_mount_operation_reply
argument_list|(
name|op
argument_list|,
name|G_MOUNT_OPERATION_ABORTED
argument_list|)
expr_stmt|;
name|priv
operator|->
name|dialog
operator|=
name|NULL
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|operation
argument_list|)
argument_list|,
literal|"is-showing"
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|op
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_mount_operation_ask_question (GMountOperation * op,const char * message,const char * choices[])
name|gimp_mount_operation_ask_question
parameter_list|(
name|GMountOperation
modifier|*
name|op
parameter_list|,
specifier|const
name|char
modifier|*
name|message
parameter_list|,
specifier|const
name|char
modifier|*
name|choices
index|[]
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
specifier|const
name|char
modifier|*
name|secondary
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|primary
decl_stmt|;
name|int
name|count
decl_stmt|,
name|len
init|=
literal|0
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|message
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|choices
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|=
name|GIMP_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
operator|->
name|priv
expr_stmt|;
name|primary
operator|=
name|strstr
argument_list|(
name|message
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|primary
condition|)
block|{
name|secondary
operator|=
name|primary
operator|+
literal|1
expr_stmt|;
name|primary
operator|=
name|g_strndup
argument_list|(
name|message
argument_list|,
name|primary
operator|-
name|message
argument_list|)
expr_stmt|;
block|}
name|dialog
operator|=
name|gtk_message_dialog_new
argument_list|(
name|priv
operator|->
name|parent_window
argument_list|,
literal|0
argument_list|,
name|GTK_MESSAGE_QUESTION
argument_list|,
name|GTK_BUTTONS_NONE
argument_list|,
literal|"%s"
argument_list|,
name|primary
operator|!=
name|NULL
condition|?
name|primary
else|:
name|message
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|primary
argument_list|)
expr_stmt|;
if|if
condition|(
name|secondary
condition|)
name|gtk_message_dialog_format_secondary_text
argument_list|(
name|GTK_MESSAGE_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"%s"
argument_list|,
name|secondary
argument_list|)
expr_stmt|;
comment|/* First count the items in the list then    * add the buttons in reverse order */
while|while
condition|(
name|choices
index|[
name|len
index|]
operator|!=
name|NULL
condition|)
name|len
operator|++
expr_stmt|;
for|for
control|(
name|count
operator|=
name|len
operator|-
literal|1
init|;
name|count
operator|>=
literal|0
condition|;
name|count
operator|--
control|)
name|gtk_dialog_add_button
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|choices
index|[
name|count
index|]
argument_list|,
name|count
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|question_dialog_button_clicked
argument_list|)
argument_list|,
name|op
argument_list|)
expr_stmt|;
name|priv
operator|->
name|dialog
operator|=
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|op
argument_list|)
argument_list|,
literal|"is-showing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|parent_window
operator|==
name|NULL
operator|&&
name|priv
operator|->
name|screen
condition|)
name|gtk_window_set_screen
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|priv
operator|->
name|screen
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|op
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GMountOperation
modifier|*
DECL|function|gimp_mount_operation_new (GtkWindow * parent)
name|gimp_mount_operation_new
parameter_list|(
name|GtkWindow
modifier|*
name|parent
parameter_list|)
block|{
name|GMountOperation
modifier|*
name|mount_operation
decl_stmt|;
name|mount_operation
operator|=
name|g_object_new
argument_list|(
name|GIMP_TYPE_MOUNT_OPERATION
argument_list|,
literal|"parent"
argument_list|,
name|parent
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|mount_operation
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_mount_operation_is_showing (GimpMountOperation * op)
name|gimp_mount_operation_is_showing
parameter_list|(
name|GimpMountOperation
modifier|*
name|op
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|op
operator|->
name|priv
operator|->
name|dialog
operator|!=
name|NULL
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_mount_operation_set_parent (GimpMountOperation * op,GtkWindow * parent)
name|gimp_mount_operation_set_parent
parameter_list|(
name|GimpMountOperation
modifier|*
name|op
parameter_list|,
name|GtkWindow
modifier|*
name|parent
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|parent
operator|==
name|NULL
operator|||
name|GTK_IS_WINDOW
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|op
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|parent_window
operator|==
name|parent
condition|)
return|return;
if|if
condition|(
name|priv
operator|->
name|parent_window
condition|)
block|{
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|priv
operator|->
name|parent_window
argument_list|,
name|gtk_widget_destroyed
argument_list|,
operator|&
name|priv
operator|->
name|parent_window
argument_list|)
expr_stmt|;
name|priv
operator|->
name|parent_window
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|parent
condition|)
block|{
name|priv
operator|->
name|parent_window
operator|=
name|g_object_ref
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|parent
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|priv
operator|->
name|parent_window
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|dialog
condition|)
name|gtk_window_set_transient_for
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dialog
argument_list|)
argument_list|,
name|parent
argument_list|)
expr_stmt|;
block|}
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|op
argument_list|)
argument_list|,
literal|"parent"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GtkWindow
modifier|*
DECL|function|gimp_mount_operation_get_parent (GimpMountOperation * op)
name|gimp_mount_operation_get_parent
parameter_list|(
name|GimpMountOperation
modifier|*
name|op
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|op
operator|->
name|priv
operator|->
name|parent_window
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_mount_operation_set_screen (GimpMountOperation * op,GdkScreen * screen)
name|gimp_mount_operation_set_screen
parameter_list|(
name|GimpMountOperation
modifier|*
name|op
parameter_list|,
name|GdkScreen
modifier|*
name|screen
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GDK_IS_SCREEN
argument_list|(
name|screen
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|op
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|screen
operator|==
name|screen
condition|)
return|return;
if|if
condition|(
name|priv
operator|->
name|screen
condition|)
name|g_object_unref
argument_list|(
name|priv
operator|->
name|screen
argument_list|)
expr_stmt|;
name|priv
operator|->
name|screen
operator|=
name|g_object_ref
argument_list|(
name|screen
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|dialog
condition|)
name|gtk_window_set_screen
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dialog
argument_list|)
argument_list|,
name|screen
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|op
argument_list|)
argument_list|,
literal|"screen"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GdkScreen
modifier|*
DECL|function|gimp_mount_operation_get_screen (GimpMountOperation * op)
name|gimp_mount_operation_get_screen
parameter_list|(
name|GimpMountOperation
modifier|*
name|op
parameter_list|)
block|{
name|GimpMountOperationPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_MOUNT_OPERATION
argument_list|(
name|op
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|=
name|op
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|dialog
condition|)
return|return
name|gtk_window_get_screen
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dialog
argument_list|)
argument_list|)
return|;
elseif|else
if|if
condition|(
name|priv
operator|->
name|parent_window
condition|)
return|return
name|gtk_window_get_screen
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|parent_window
argument_list|)
argument_list|)
return|;
elseif|else
if|if
condition|(
name|priv
operator|->
name|screen
condition|)
return|return
name|priv
operator|->
name|screen
return|;
else|else
return|return
name|gdk_screen_get_default
argument_list|()
return|;
block|}
end_function

end_unit

