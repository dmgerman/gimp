begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_warning
warning|#
directive|warning
warning|GTK_DISABLE_DEPRECATED
end_warning

begin_endif
endif|#
directive|endif
end_endif

begin_undef
undef|#
directive|undef
name|GTK_DISABLE_DEPRECATED
end_undef

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_include
include|#
directive|include
file|<io.h>
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|W_OK
end_ifndef

begin_define
DECL|macro|W_OK
define|#
directive|define
name|W_OK
value|2
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|<gdk-pixbuf/gdk-pixbuf.h>
end_include

begin_include
include|#
directive|include
file|<gdk-pixbuf/gdk-pixdata.h>
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_include
include|#
directive|include
file|"gfig.h"
end_include

begin_include
include|#
directive|include
file|"gfig-style.h"
end_include

begin_function_decl
specifier|static
name|void
name|gfig_read_parameter_string
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|gchar
modifier|*
modifier|*
name|style_entry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gfig_read_parameter_int
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
modifier|*
name|style_entry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gfig_read_parameter_double
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|gdouble
modifier|*
name|style_entry
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gfig_read_parameter_gimp_rgb
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|GimpRGB
modifier|*
name|style_entry
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
DECL|function|gfig_read_parameter_string (gchar ** text,gint nitems,gchar * name,gchar ** style_entry)
name|gfig_read_parameter_string
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|gchar
modifier|*
modifier|*
name|style_entry
parameter_list|)
block|{
name|gint
name|n
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|ptr
decl_stmt|;
name|gchar
modifier|*
name|tmpstr
decl_stmt|;
operator|*
name|style_entry
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|n
operator|<
name|nitems
condition|)
block|{
name|ptr
operator|=
name|strchr
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
condition|)
block|{
name|tmpstr
operator|=
name|g_strndup
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
name|ptr
operator|-
name|text
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|tmpstr
argument_list|,
name|name
argument_list|)
condition|)
block|{
operator|*
name|style_entry
operator|=
name|g_strdup
argument_list|(
name|g_strchug
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
return|return;
block|}
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
block|}
operator|++
name|n
expr_stmt|;
block|}
name|g_message
argument_list|(
literal|"Parameter '%s' not found"
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gfig_read_parameter_int (gchar ** text,gint nitems,gchar * name,gint * style_entry)
name|gfig_read_parameter_int
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
modifier|*
name|style_entry
parameter_list|)
block|{
name|gint
name|n
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|ptr
decl_stmt|;
name|gchar
modifier|*
name|tmpstr
decl_stmt|;
operator|*
name|style_entry
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|n
operator|<
name|nitems
condition|)
block|{
name|ptr
operator|=
name|strchr
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
condition|)
block|{
name|tmpstr
operator|=
name|g_strndup
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
name|ptr
operator|-
name|text
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|tmpstr
argument_list|,
name|name
argument_list|)
condition|)
block|{
operator|*
name|style_entry
operator|=
name|atoi
argument_list|(
name|g_strchug
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
return|return;
block|}
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
block|}
operator|++
name|n
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gfig_read_parameter_double (gchar ** text,gint nitems,gchar * name,gdouble * style_entry)
name|gfig_read_parameter_double
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|gdouble
modifier|*
name|style_entry
parameter_list|)
block|{
name|gint
name|n
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|ptr
decl_stmt|;
name|gchar
modifier|*
name|endptr
decl_stmt|;
name|gchar
modifier|*
name|tmpstr
decl_stmt|;
operator|*
name|style_entry
operator|=
literal|0.
expr_stmt|;
while|while
condition|(
name|n
operator|<
name|nitems
condition|)
block|{
name|ptr
operator|=
name|strchr
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
condition|)
block|{
name|tmpstr
operator|=
name|g_strndup
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
name|ptr
operator|-
name|text
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|tmpstr
argument_list|,
name|name
argument_list|)
condition|)
block|{
operator|*
name|style_entry
operator|=
name|g_ascii_strtod
argument_list|(
name|g_strchug
argument_list|(
name|ptr
argument_list|)
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
return|return;
block|}
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
block|}
operator|++
name|n
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gfig_read_parameter_gimp_rgb (gchar ** text,gint nitems,gchar * name,GimpRGB * style_entry)
name|gfig_read_parameter_gimp_rgb
parameter_list|(
name|gchar
modifier|*
modifier|*
name|text
parameter_list|,
name|gint
name|nitems
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|,
name|GimpRGB
modifier|*
name|style_entry
parameter_list|)
block|{
name|gint
name|n
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|ptr
decl_stmt|;
name|gchar
modifier|*
name|tmpstr
decl_stmt|;
name|gchar
modifier|*
name|endptr
decl_stmt|;
name|gchar
name|colorstr_r
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|colorstr_g
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|colorstr_b
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|colorstr_a
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|style_entry
operator|->
name|r
operator|=
name|style_entry
operator|->
name|g
operator|=
name|style_entry
operator|->
name|b
operator|=
name|style_entry
operator|->
name|a
operator|=
literal|0.
expr_stmt|;
while|while
condition|(
name|n
operator|<
name|nitems
condition|)
block|{
name|ptr
operator|=
name|strchr
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
literal|':'
argument_list|)
expr_stmt|;
if|if
condition|(
name|ptr
condition|)
block|{
name|tmpstr
operator|=
name|g_strndup
argument_list|(
name|text
index|[
name|n
index|]
argument_list|,
name|ptr
operator|-
name|text
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|ptr
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|tmpstr
argument_list|,
name|name
argument_list|)
condition|)
block|{
name|sscanf
argument_list|(
name|ptr
argument_list|,
literal|"%s %s %s %s"
argument_list|,
name|colorstr_r
argument_list|,
name|colorstr_g
argument_list|,
name|colorstr_b
argument_list|,
name|colorstr_a
argument_list|)
expr_stmt|;
name|style_entry
operator|->
name|r
operator|=
name|g_ascii_strtod
argument_list|(
name|colorstr_r
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|style_entry
operator|->
name|g
operator|=
name|g_ascii_strtod
argument_list|(
name|colorstr_g
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|style_entry
operator|->
name|b
operator|=
name|g_ascii_strtod
argument_list|(
name|colorstr_b
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|style_entry
operator|->
name|a
operator|=
name|g_ascii_strtod
argument_list|(
name|colorstr_a
argument_list|,
operator|&
name|endptr
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
return|return;
block|}
name|g_free
argument_list|(
name|tmpstr
argument_list|)
expr_stmt|;
block|}
operator|++
name|n
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gfig_load_style (Style * style,FILE * fp)
name|gfig_load_style
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|gulong
name|offset
decl_stmt|;
name|gchar
name|load_buf2
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|gchar
modifier|*
name|style_text
index|[
literal|100
index|]
decl_stmt|;
name|gint
name|nitems
init|=
literal|0
decl_stmt|;
name|gint
name|k
decl_stmt|;
name|gchar
name|name
index|[
literal|100
index|]
decl_stmt|;
name|offset
operator|=
name|ftell
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|get_line
argument_list|(
name|load_buf2
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
literal|1
operator|!=
name|sscanf
argument_list|(
name|load_buf2
argument_list|,
literal|"<Style %s>"
argument_list|,
name|name
argument_list|)
condition|)
block|{
comment|/* no style data */
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"No style data\n"
argument_list|)
expr_stmt|;
name|fseek
argument_list|(
name|fp
argument_list|,
name|offset
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Loading style '%s' -- "
argument_list|,
name|name
argument_list|)
expr_stmt|;
comment|/* nuke final> in name */
operator|*
name|strrchr
argument_list|(
name|name
argument_list|,
literal|'>'
argument_list|)
operator|=
literal|'\0'
expr_stmt|;
name|style
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
while|while
condition|(
name|TRUE
condition|)
block|{
name|get_line
argument_list|(
name|load_buf2
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|load_buf2
argument_list|,
literal|"</Style>"
argument_list|)
operator|||
name|feof
argument_list|(
name|fp
argument_list|)
condition|)
break|break;
name|style_text
index|[
name|nitems
index|]
operator|=
operator|(
name|gchar
operator|*
operator|)
name|g_malloc
argument_list|(
name|MAX_LOAD_LINE
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|style_text
index|[
name|nitems
index|]
argument_list|,
name|load_buf2
argument_list|)
expr_stmt|;
name|nitems
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|feof
argument_list|(
name|fp
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"Error reading style data"
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
name|gfig_read_parameter_string
argument_list|(
name|style_text
argument_list|,
name|nitems
argument_list|,
literal|"BrushName"
argument_list|,
operator|&
name|style
operator|->
name|brush_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|&
name|style
operator|->
name|brush_name
condition|)
name|g_message
argument_list|(
literal|"Error loading style: got NULL for brush name."
argument_list|)
expr_stmt|;
name|gfig_read_parameter_string
argument_list|(
name|style_text
argument_list|,
name|nitems
argument_list|,
literal|"Pattern"
argument_list|,
operator|&
name|style
operator|->
name|pattern
argument_list|)
expr_stmt|;
name|gfig_read_parameter_string
argument_list|(
name|style_text
argument_list|,
name|nitems
argument_list|,
literal|"Gradient"
argument_list|,
operator|&
name|style
operator|->
name|gradient
argument_list|)
expr_stmt|;
name|gfig_read_parameter_gimp_rgb
argument_list|(
name|style_text
argument_list|,
name|nitems
argument_list|,
literal|"Foreground"
argument_list|,
operator|&
name|style
operator|->
name|foreground
argument_list|)
expr_stmt|;
name|gfig_read_parameter_gimp_rgb
argument_list|(
name|style_text
argument_list|,
name|nitems
argument_list|,
literal|"Background"
argument_list|,
operator|&
name|style
operator|->
name|background
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|nitems
condition|;
name|k
operator|++
control|)
block|{
name|g_free
argument_list|(
name|style_text
index|[
name|k
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"done\n"
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gfig_skip_style (Style * style,FILE * fp)
name|gfig_skip_style
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|gulong
name|offset
decl_stmt|;
name|gchar
name|load_buf2
index|[
name|MAX_LOAD_LINE
index|]
decl_stmt|;
name|offset
operator|=
name|ftell
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|get_line
argument_list|(
name|load_buf2
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|strncmp
argument_list|(
name|load_buf2
argument_list|,
literal|"<Style "
argument_list|,
literal|7
argument_list|)
condition|)
block|{
comment|/* no style data */
name|fseek
argument_list|(
name|fp
argument_list|,
name|offset
argument_list|,
name|SEEK_SET
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
while|while
condition|(
name|TRUE
condition|)
block|{
name|get_line
argument_list|(
name|load_buf2
argument_list|,
name|MAX_LOAD_LINE
argument_list|,
name|fp
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|load_buf2
argument_list|,
literal|"</Style>"
argument_list|)
operator|||
name|feof
argument_list|(
name|fp
argument_list|)
condition|)
break|break;
block|}
if|if
condition|(
name|feof
argument_list|(
name|fp
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"Error trying to skip style data"
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*  * FIXME: need to make this load a list of styles if there are more than one.  */
end_comment

begin_function
name|gboolean
DECL|function|gfig_load_styles (GFigObj * gfig,FILE * fp)
name|gfig_load_styles
parameter_list|(
name|GFigObj
modifier|*
name|gfig
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Loading global styles -- "
argument_list|)
expr_stmt|;
comment|/* currently we only have the default style */
name|gfig_load_style
argument_list|(
operator|&
name|gfig_context
operator|->
name|default_style
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"done\n"
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_save_style (Style * style,GString * string)
name|gfig_save_style
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|,
name|GString
modifier|*
name|string
parameter_list|)
block|{
name|gchar
name|buffer_r
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|buffer_g
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|buffer_b
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gchar
name|buffer_a
index|[
name|G_ASCII_DTOSTR_BUF_SIZE
index|]
decl_stmt|;
name|gint
name|blen
init|=
name|G_ASCII_DTOSTR_BUF_SIZE
decl_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Saving style %s, brush name '%s'\n"
argument_list|,
name|style
operator|->
name|name
argument_list|,
name|style
operator|->
name|brush_name
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"<Style %s>\n"
argument_list|,
name|style
operator|->
name|name
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"BrushName:      %s\n"
argument_list|,
name|style
operator|->
name|brush_name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|style
operator|->
name|brush_name
condition|)
name|g_message
argument_list|(
literal|"Error saving style %s: saving NULL for brush name"
argument_list|,
name|style
operator|->
name|name
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"BrushSource:    %d\n"
argument_list|,
name|style
operator|->
name|brush_source
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"FillType:       %d\n"
argument_list|,
name|style
operator|->
name|fill_type
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"FillTypeSource: %d\n"
argument_list|,
name|style
operator|->
name|fill_type_source
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"Pattern:        %s\n"
argument_list|,
name|style
operator|->
name|pattern
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"PatternSource:  %d\n"
argument_list|,
name|style
operator|->
name|pattern_source
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"Gradient:       %s\n"
argument_list|,
name|style
operator|->
name|gradient
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"GradientSource: %d\n"
argument_list|,
name|style
operator|->
name|gradient_source
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"Foreground: %s %s %s %s\n"
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_r
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|foreground
operator|.
name|r
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_g
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|foreground
operator|.
name|g
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_b
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|foreground
operator|.
name|b
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_a
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|foreground
operator|.
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"ForegroundSource: %d\n"
argument_list|,
name|style
operator|->
name|background_source
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"Background: %s %s %s %s\n"
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_r
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|background
operator|.
name|r
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_g
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|background
operator|.
name|g
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_b
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|background
operator|.
name|b
argument_list|)
argument_list|,
name|g_ascii_dtostr
argument_list|(
name|buffer_a
argument_list|,
name|blen
argument_list|,
name|style
operator|->
name|background
operator|.
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"BackgroundSource: %d\n"
argument_list|,
name|style
operator|->
name|background_source
argument_list|)
expr_stmt|;
name|g_string_append_printf
argument_list|(
name|string
argument_list|,
literal|"</Style>\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_save_styles (GString * string)
name|gfig_save_styles
parameter_list|(
name|GString
modifier|*
name|string
parameter_list|)
block|{
name|gint
name|k
decl_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Saving global styles.\n"
argument_list|)
expr_stmt|;
name|gfig_style_copy
argument_list|(
operator|&
name|gfig_context
operator|->
name|default_style
argument_list|,
name|gfig_context
operator|->
name|current_style
argument_list|,
literal|"object"
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|1
init|;
name|k
operator|<
name|gfig_context
operator|->
name|num_styles
condition|;
name|k
operator|++
control|)
name|gfig_save_style
argument_list|(
name|gfig_context
operator|->
name|style
index|[
name|k
index|]
argument_list|,
name|string
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * set_foreground_callback() is the callback for the Foreground color select  * widget.  It reads the color from the widget, and applies this color  * to both the default style and the current style.  It then produces a  * repaint (which will be suppressed if gfig_context->enable_repaint is  * FALSE).  */
end_comment

begin_function
name|void
DECL|function|set_foreground_callback (GimpColorButton * button,gpointer data)
name|set_foreground_callback
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpRGB
name|color2
decl_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Setting foreground color from color selector\n"
argument_list|)
expr_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|button
argument_list|,
operator|&
name|color2
argument_list|)
expr_stmt|;
name|gimp_rgba_set
argument_list|(
operator|&
name|gfig_context
operator|->
name|default_style
operator|.
name|foreground
argument_list|,
name|color2
operator|.
name|r
argument_list|,
name|color2
operator|.
name|g
argument_list|,
name|color2
operator|.
name|b
argument_list|,
name|color2
operator|.
name|a
argument_list|)
expr_stmt|;
name|gimp_rgba_set
argument_list|(
operator|&
name|gfig_context
operator|->
name|current_style
operator|->
name|foreground
argument_list|,
name|color2
operator|.
name|r
argument_list|,
name|color2
operator|.
name|g
argument_list|,
name|color2
operator|.
name|b
argument_list|,
name|color2
operator|.
name|a
argument_list|)
expr_stmt|;
name|gfig_paint_callback
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|set_background_callback (GimpColorButton * button,gpointer data)
name|set_background_callback
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpRGB
name|color2
decl_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|button
argument_list|,
operator|&
name|color2
argument_list|)
expr_stmt|;
name|gimp_rgba_set
argument_list|(
operator|&
name|gfig_context
operator|->
name|default_style
operator|.
name|background
argument_list|,
name|color2
operator|.
name|r
argument_list|,
name|color2
operator|.
name|g
argument_list|,
name|color2
operator|.
name|b
argument_list|,
name|color2
operator|.
name|a
argument_list|)
expr_stmt|;
name|gimp_rgba_set
argument_list|(
operator|&
name|gfig_context
operator|->
name|current_style
operator|->
name|background
argument_list|,
name|color2
operator|.
name|r
argument_list|,
name|color2
operator|.
name|g
argument_list|,
name|color2
operator|.
name|b
argument_list|,
name|color2
operator|.
name|a
argument_list|)
expr_stmt|;
name|gfig_paint_callback
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * gfig_brush_changed_callback() is the callback for the brush  * selector widget.  It reads the brush name from the widget, and  * applies this to both the default style and the current style,  * as well as the gfig_context->bdesc values.  It then produces a  * repaint (which will be suppressed if gfig_context->enable_repaint is  * FALSE).  */
end_comment

begin_function
name|void
DECL|function|gfig_brush_changed_callback (const gchar * brush_name,gdouble opacity,gint spacing,GimpLayerModeEffects paint_mode,gint width,gint height,const guchar * mask_data,gboolean dialog_closing,gpointer user_data)
name|gfig_brush_changed_callback
parameter_list|(
specifier|const
name|gchar
modifier|*
name|brush_name
parameter_list|,
name|gdouble
name|opacity
parameter_list|,
name|gint
name|spacing
parameter_list|,
name|GimpLayerModeEffects
name|paint_mode
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
specifier|const
name|guchar
modifier|*
name|mask_data
parameter_list|,
name|gboolean
name|dialog_closing
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|brush_name
condition|)
name|g_message
argument_list|(
literal|"Error: setting brush name to NULL in color selector callback."
argument_list|)
expr_stmt|;
name|gfig_context
operator|->
name|current_style
operator|->
name|brush_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|brush_name
expr_stmt|;
name|gfig_context
operator|->
name|default_style
operator|.
name|brush_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|brush_name
expr_stmt|;
comment|/* this will soon be unneeded */
name|gfig_context
operator|->
name|bdesc
operator|.
name|name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|brush_name
expr_stmt|;
name|gfig_context
operator|->
name|bdesc
operator|.
name|width
operator|=
name|width
expr_stmt|;
name|gfig_context
operator|->
name|bdesc
operator|.
name|height
operator|=
name|height
expr_stmt|;
name|gimp_brushes_set_brush
argument_list|(
name|brush_name
argument_list|)
expr_stmt|;
name|gfig_paint_callback
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_pattern_changed_callback (const gchar * pattern_name,gint width,gint height,gint bpp,const guchar * mask_data,gboolean dialog_closing,gpointer user_data)
name|gfig_pattern_changed_callback
parameter_list|(
specifier|const
name|gchar
modifier|*
name|pattern_name
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|gint
name|bpp
parameter_list|,
specifier|const
name|guchar
modifier|*
name|mask_data
parameter_list|,
name|gboolean
name|dialog_closing
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|gfig_context
operator|->
name|current_style
operator|->
name|pattern
operator|=
operator|(
name|gchar
operator|*
operator|)
name|pattern_name
expr_stmt|;
name|gfig_context
operator|->
name|default_style
operator|.
name|pattern
operator|=
operator|(
name|gchar
operator|*
operator|)
name|pattern_name
expr_stmt|;
name|gfig_paint_callback
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_gradient_changed_callback (const gchar * gradient_name,gint width,const gdouble * grad_data,gboolean dialog_closing,gpointer user_data)
name|gfig_gradient_changed_callback
parameter_list|(
specifier|const
name|gchar
modifier|*
name|gradient_name
parameter_list|,
name|gint
name|width
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|grad_data
parameter_list|,
name|gboolean
name|dialog_closing
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|gfig_context
operator|->
name|current_style
operator|->
name|gradient
operator|=
operator|(
name|gchar
operator|*
operator|)
name|gradient_name
expr_stmt|;
name|gfig_context
operator|->
name|default_style
operator|.
name|gradient
operator|=
operator|(
name|gchar
operator|*
operator|)
name|gradient_name
expr_stmt|;
name|gfig_paint_callback
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_rgba_copy (GimpRGB * color1,GimpRGB * color2)
name|gfig_rgba_copy
parameter_list|(
name|GimpRGB
modifier|*
name|color1
parameter_list|,
name|GimpRGB
modifier|*
name|color2
parameter_list|)
block|{
name|color1
operator|->
name|r
operator|=
name|color2
operator|->
name|r
expr_stmt|;
name|color1
operator|->
name|g
operator|=
name|color2
operator|->
name|g
expr_stmt|;
name|color1
operator|->
name|b
operator|=
name|color2
operator|->
name|b
expr_stmt|;
name|color1
operator|->
name|a
operator|=
name|color2
operator|->
name|a
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_style_copy (Style * style1,Style * style0,const gchar * name)
name|gfig_style_copy
parameter_list|(
name|Style
modifier|*
name|style1
parameter_list|,
name|Style
modifier|*
name|style0
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
if|if
condition|(
name|name
condition|)
name|style1
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
else|else
name|g_message
argument_list|(
literal|"Eror: name is NULL in gfig_style_copy."
argument_list|)
expr_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Copying style %s as style %s\n"
argument_list|,
name|style0
operator|->
name|name
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|gfig_rgba_copy
argument_list|(
operator|&
name|style1
operator|->
name|foreground
argument_list|,
operator|&
name|style0
operator|->
name|foreground
argument_list|)
expr_stmt|;
name|gfig_rgba_copy
argument_list|(
operator|&
name|style1
operator|->
name|background
argument_list|,
operator|&
name|style0
operator|->
name|background
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|style0
operator|->
name|brush_name
condition|)
name|g_message
argument_list|(
literal|"Error copying style %s: brush name is NULL."
argument_list|,
name|style0
operator|->
name|name
argument_list|)
expr_stmt|;
name|style1
operator|->
name|brush_name
operator|=
name|g_strdup
argument_list|(
name|style0
operator|->
name|brush_name
argument_list|)
expr_stmt|;
name|style1
operator|->
name|gradient
operator|=
name|g_strdup
argument_list|(
name|style0
operator|->
name|gradient
argument_list|)
expr_stmt|;
name|style1
operator|->
name|pattern
operator|=
name|g_strdup
argument_list|(
name|style0
operator|->
name|pattern
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * gfig_style_apply() applies the settings from the specified style to  * the Gimp core.  It does not change any widgets, and does not cause  * a repaint.  */
end_comment

begin_function
name|void
DECL|function|gfig_style_apply (Style * style)
name|gfig_style_apply
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|)
block|{
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Applying style '%s' -- "
argument_list|,
name|style
operator|->
name|name
argument_list|)
expr_stmt|;
name|gimp_palette_set_foreground
argument_list|(
operator|&
name|style
operator|->
name|foreground
argument_list|)
expr_stmt|;
name|gimp_palette_set_background
argument_list|(
operator|&
name|style
operator|->
name|background
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_brushes_set_brush
argument_list|(
name|style
operator|->
name|brush_name
argument_list|)
condition|)
name|g_message
argument_list|(
literal|"Style apply: Failed to set brush to '%s' in style '%s'"
argument_list|,
name|style
operator|->
name|brush_name
argument_list|,
name|style
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"done.\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_style_set_all_sources (Style * style,StyleSource source)
name|gfig_style_set_all_sources
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|,
name|StyleSource
name|source
parameter_list|)
block|{
name|style
operator|->
name|foreground_source
operator|=
name|source
expr_stmt|;
name|style
operator|->
name|background_source
operator|=
name|source
expr_stmt|;
name|style
operator|->
name|brush_source
operator|=
name|source
expr_stmt|;
name|style
operator|->
name|gradient_source
operator|=
name|source
expr_stmt|;
name|style
operator|->
name|pattern_source
operator|=
name|source
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gfig_style_append (Style * style)
name|gfig_style_append
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|)
block|{
name|gfig_context
operator|->
name|style
index|[
name|gfig_context
operator|->
name|num_styles
index|]
operator|=
name|style
expr_stmt|;
operator|++
name|gfig_context
operator|->
name|num_styles
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * gfig_read_gimp_style() reads the style settings from the Gimp core,  * and applies them to the specified style, giving that style the  * specified name.  This is mainly useful as a way of initializing  * a style.  The function does not cause a repaint.  */
end_comment

begin_function
name|void
DECL|function|gfig_read_gimp_style (Style * style,const gchar * name)
name|gfig_read_gimp_style
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|gint
name|w
decl_stmt|,
name|h
decl_stmt|;
if|if
condition|(
operator|!
name|name
condition|)
name|g_message
argument_list|(
literal|"Error: name is NULL in gfig_read_gimp_style."
argument_list|)
expr_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Reading Gimp settings as style %s\n"
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|style
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gimp_palette_get_foreground
argument_list|(
operator|&
name|style
operator|->
name|foreground
argument_list|)
expr_stmt|;
name|gimp_palette_get_background
argument_list|(
operator|&
name|style
operator|->
name|background
argument_list|)
expr_stmt|;
name|style
operator|->
name|brush_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|gimp_brushes_get_brush
argument_list|(
operator|&
name|style
operator|->
name|brush_width
argument_list|,
operator|&
name|style
operator|->
name|brush_height
argument_list|,
operator|&
name|style
operator|->
name|brush_spacing
argument_list|)
expr_stmt|;
name|style
operator|->
name|gradient
operator|=
name|gimp_gradients_get_gradient
argument_list|()
expr_stmt|;
name|style
operator|->
name|pattern
operator|=
name|gimp_patterns_get_pattern
argument_list|(
operator|&
name|w
argument_list|,
operator|&
name|h
argument_list|)
expr_stmt|;
name|gfig_context
operator|->
name|bdesc
operator|.
name|name
operator|=
name|style
operator|->
name|brush_name
expr_stmt|;
name|gfig_context
operator|->
name|bdesc
operator|.
name|width
operator|=
name|style
operator|->
name|brush_width
expr_stmt|;
name|gfig_context
operator|->
name|bdesc
operator|.
name|height
operator|=
name|style
operator|->
name|brush_height
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * gfig_style_set_content_from_style() sets all of the style control widgets  * to values from the specified style.  This in turn sets the Gimp core's  * values to the same things.  Repainting is suppressed while this happens,  * so calling this function will not produce a repaint.  *  */
end_comment

begin_function
name|void
DECL|function|gfig_style_set_context_from_style (Style * style)
name|gfig_style_set_context_from_style
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|)
block|{
name|gboolean
name|enable_repaint
decl_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Setting context from style '%s' -- "
argument_list|,
name|style
operator|->
name|name
argument_list|)
expr_stmt|;
name|enable_repaint
operator|=
name|gfig_context
operator|->
name|enable_repaint
expr_stmt|;
name|gfig_context
operator|->
name|enable_repaint
operator|=
name|FALSE
expr_stmt|;
name|gfig_context
operator|->
name|current_style
operator|=
name|style
expr_stmt|;
name|gimp_color_button_set_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|gfig_context
operator|->
name|fg_color_button
argument_list|)
argument_list|,
operator|&
name|style
operator|->
name|foreground
argument_list|)
expr_stmt|;
name|gimp_color_button_set_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|gfig_context
operator|->
name|bg_color_button
argument_list|)
argument_list|,
operator|&
name|style
operator|->
name|background
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_brushes_set_brush
argument_list|(
name|style
operator|->
name|brush_name
argument_list|)
condition|)
name|g_message
argument_list|(
literal|"Style from context: Failed to set brush to '%s'"
argument_list|,
name|style
operator|->
name|brush_name
argument_list|)
expr_stmt|;
name|gimp_brush_select_widget_set
argument_list|(
name|gfig_context
operator|->
name|brush_select
argument_list|,
name|style
operator|->
name|brush_name
argument_list|,
operator|-
literal|1.
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* FIXME */
name|gfig_context
operator|->
name|bdesc
operator|.
name|name
operator|=
name|style
operator|->
name|brush_name
expr_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"done.\n"
argument_list|)
expr_stmt|;
name|gfig_context
operator|->
name|enable_repaint
operator|=
name|enable_repaint
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * gfig_style_set_style_from_context() sets the values in the specified  * style to those that appear in the style control widgets f  */
end_comment

begin_function
name|void
DECL|function|gfig_style_set_style_from_context (Style * style)
name|gfig_style_set_style_from_context
parameter_list|(
name|Style
modifier|*
name|style
parameter_list|)
block|{
name|GimpRGB
name|color
decl_stmt|;
name|style
operator|->
name|name
operator|=
literal|"object"
expr_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|gfig_context
operator|->
name|fg_color_button
argument_list|)
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
name|gfig_context
operator|->
name|debug_styles
condition|)
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Setting foreground color to %lg %lg %lg\n"
argument_list|,
name|color
operator|.
name|r
argument_list|,
name|color
operator|.
name|g
argument_list|,
name|color
operator|.
name|b
argument_list|)
expr_stmt|;
name|gfig_rgba_copy
argument_list|(
operator|&
name|style
operator|->
name|foreground
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|gfig_context
operator|->
name|bg_color_button
argument_list|)
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gfig_rgba_copy
argument_list|(
operator|&
name|style
operator|->
name|background
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|style
operator|->
name|brush_name
operator|=
name|gfig_context
operator|->
name|current_style
operator|->
name|brush_name
expr_stmt|;
name|style
operator|->
name|pattern
operator|=
name|gfig_context
operator|->
name|current_style
operator|->
name|pattern
expr_stmt|;
name|style
operator|->
name|gradient
operator|=
name|gfig_context
operator|->
name|current_style
operator|->
name|gradient
expr_stmt|;
block|}
end_function

begin_function
name|char
modifier|*
DECL|function|mygimp_brush_get (void)
name|mygimp_brush_get
parameter_list|(
name|void
parameter_list|)
block|{
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|,
name|spacing
decl_stmt|;
return|return
name|gimp_brushes_get_brush
argument_list|(
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|,
operator|&
name|spacing
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|mygimp_brush_info (gint * width,gint * height)
name|mygimp_brush_info
parameter_list|(
name|gint
modifier|*
name|width
parameter_list|,
name|gint
modifier|*
name|height
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|gint
name|spacing
decl_stmt|;
name|name
operator|=
name|gimp_brushes_get_brush
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
operator|&
name|spacing
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
condition|)
block|{
operator|*
name|width
operator|=
name|MAX
argument_list|(
operator|*
name|width
argument_list|,
literal|32
argument_list|)
expr_stmt|;
operator|*
name|height
operator|=
name|MAX
argument_list|(
operator|*
name|height
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_message
argument_list|(
literal|"Failed to get brush info"
argument_list|)
expr_stmt|;
operator|*
name|width
operator|=
operator|*
name|height
operator|=
literal|48
expr_stmt|;
block|}
block|}
end_function

end_unit

