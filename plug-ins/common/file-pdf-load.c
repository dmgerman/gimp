begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  *  * file-pdf-load.c - PDF file loader  *  * Copyright (C) 2005 Nathan Summers  *  * Some code in render_page_to_surface() borrowed from  * poppler.git/glib/poppler-page.cc.  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_undef
undef|#
directive|undef
name|GTK_DISABLE_SINGLE_INCLUDES
end_undef

begin_include
include|#
directive|include
file|<poppler.h>
end_include

begin_define
DECL|macro|GTK_DISABLE_SINGLE_INCLUDES
define|#
directive|define
name|GTK_DISABLE_SINGLE_INCLUDES
end_define

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|LOAD_PROC
define|#
directive|define
name|LOAD_PROC
value|"file-pdf-load"
end_define

begin_define
DECL|macro|LOAD_THUMB_PROC
define|#
directive|define
name|LOAD_THUMB_PROC
value|"file-pdf-load-thumb"
end_define

begin_define
DECL|macro|PLUG_IN_BINARY
define|#
directive|define
name|PLUG_IN_BINARY
value|"file-pdf-load"
end_define

begin_define
DECL|macro|PLUG_IN_ROLE
define|#
directive|define
name|PLUG_IN_ROLE
value|"gimp-file-pdf-load"
end_define

begin_define
DECL|macro|THUMBNAIL_SIZE
define|#
directive|define
name|THUMBNAIL_SIZE
value|128
end_define

begin_comment
comment|/* Structs for the load dialog */
end_comment

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2c76d6db0108
block|{
DECL|member|target
name|GimpPageSelectorTarget
name|target
decl_stmt|;
DECL|member|resolution
name|gdouble
name|resolution
decl_stmt|;
DECL|member|antialias
name|gboolean
name|antialias
decl_stmt|;
DECL|typedef|PdfLoadVals
block|}
name|PdfLoadVals
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|loadvals
specifier|static
name|PdfLoadVals
name|loadvals
init|=
block|{
name|GIMP_PAGE_SELECTOR_TARGET_LAYERS
block|,
literal|100.00
block|,
comment|/* 100 dpi   */
name|TRUE
block|}
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2c76d6db0208
block|{
DECL|member|n_pages
name|gint
name|n_pages
decl_stmt|;
DECL|member|pages
name|gint
modifier|*
name|pages
decl_stmt|;
DECL|typedef|PdfSelectedPages
block|}
name|PdfSelectedPages
typedef|;
end_typedef

begin_comment
comment|/* Declare local functions */
end_comment

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|load_image
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|,
name|GimpRunMode
name|run_mode
parameter_list|,
name|GimpPageSelectorTarget
name|target
parameter_list|,
name|guint32
name|resolution
parameter_list|,
name|gboolean
name|antialias
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpPDBStatusType
name|load_dialog
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|PopplerDocument
modifier|*
name|open_document
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|cairo_surface_t
modifier|*
name|get_thumb_surface
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|gint
name|page
parameter_list|,
name|gint
name|preferred_size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GdkPixbuf
modifier|*
name|get_thumb_pixbuf
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|gint
name|page
parameter_list|,
name|gint
name|preferred_size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|layer_from_surface
parameter_list|(
name|gint32
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|layer_name
parameter_list|,
name|gint
name|position
parameter_list|,
name|cairo_surface_t
modifier|*
name|surface
parameter_list|,
name|gdouble
name|progress_start
parameter_list|,
name|gdouble
name|progress_scale
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  ** the following was formerly part of  ** gimpresolutionentry.h and gimpresolutionentry.c,  ** moved here because this is the only thing that uses  ** it, and it is undesirable to maintain all that api.  ** Most unused functions have been removed.  **/
end_comment

begin_define
DECL|macro|GIMP_TYPE_RESOLUTION_ENTRY
define|#
directive|define
name|GIMP_TYPE_RESOLUTION_ENTRY
value|(gimp_resolution_entry_get_type ())
end_define

begin_define
DECL|macro|GIMP_RESOLUTION_ENTRY (obj)
define|#
directive|define
name|GIMP_RESOLUTION_ENTRY
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_CHECK_INSTANCE_CAST ((obj), GIMP_TYPE_RESOLUTION_ENTRY, GimpResolutionEntry))
end_define

begin_define
DECL|macro|GIMP_RESOLUTION_ENTRY_CLASS (klass)
define|#
directive|define
name|GIMP_RESOLUTION_ENTRY_CLASS
parameter_list|(
name|klass
parameter_list|)
value|(G_TYPE_CHECK_CLASS_CAST ((klass), GIMP_TYPE_RESOLUTION_ENTRY, GimpResolutionEntryClass))
end_define

begin_define
DECL|macro|GIMP_IS_RESOLUTION_ENTRY (obj)
define|#
directive|define
name|GIMP_IS_RESOLUTION_ENTRY
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_CHECK_INSTANCE_TYPE (obj, GIMP_TYPE_RESOLUTION_ENTRY))
end_define

begin_define
DECL|macro|GIMP_IS_RESOLUTION_ENTRY_CLASS (klass)
define|#
directive|define
name|GIMP_IS_RESOLUTION_ENTRY_CLASS
parameter_list|(
name|klass
parameter_list|)
value|(G_TYPE_CHECK_CLASS_TYPE ((klass), GIMP_TYPE_RESOLUTION_ENTRY))
end_define

begin_define
DECL|macro|GIMP_RESOLUTION_ENTRY_GET_CLASS (obj)
define|#
directive|define
name|GIMP_RESOLUTION_ENTRY_GET_CLASS
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_INSTANCE_GET_CLASS ((obj), GIMP_TYPE_RESOLUTION_ENTRY, GimpResolutionEntryClass))
end_define

begin_typedef
DECL|typedef|GimpResolutionEntry
typedef|typedef
name|struct
name|_GimpResolutionEntry
name|GimpResolutionEntry
typedef|;
end_typedef

begin_typedef
DECL|typedef|GimpResolutionEntryClass
typedef|typedef
name|struct
name|_GimpResolutionEntryClass
name|GimpResolutionEntryClass
typedef|;
end_typedef

begin_typedef
DECL|typedef|GimpResolutionEntryField
typedef|typedef
name|struct
name|_GimpResolutionEntryField
name|GimpResolutionEntryField
typedef|;
end_typedef

begin_struct
DECL|struct|_GimpResolutionEntryField
struct|struct
name|_GimpResolutionEntryField
block|{
DECL|member|gre
name|GimpResolutionEntry
modifier|*
name|gre
decl_stmt|;
DECL|member|corresponding
name|GimpResolutionEntryField
modifier|*
name|corresponding
decl_stmt|;
DECL|member|size
name|gboolean
name|size
decl_stmt|;
DECL|member|label
name|GtkWidget
modifier|*
name|label
decl_stmt|;
DECL|member|changed_signal
name|guint
name|changed_signal
decl_stmt|;
DECL|member|adjustment
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
DECL|member|spinbutton
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
DECL|member|phy_size
name|gdouble
name|phy_size
decl_stmt|;
DECL|member|value
name|gdouble
name|value
decl_stmt|;
DECL|member|min_value
name|gdouble
name|min_value
decl_stmt|;
DECL|member|max_value
name|gdouble
name|max_value
decl_stmt|;
DECL|member|stop_recursion
name|gint
name|stop_recursion
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_GimpResolutionEntry
struct|struct
name|_GimpResolutionEntry
block|{
DECL|member|parent_instance
name|GtkTable
name|parent_instance
decl_stmt|;
DECL|member|size_unit
name|GimpUnit
name|size_unit
decl_stmt|;
DECL|member|unit
name|GimpUnit
name|unit
decl_stmt|;
DECL|member|unitmenu
name|GtkWidget
modifier|*
name|unitmenu
decl_stmt|;
DECL|member|chainbutton
name|GtkWidget
modifier|*
name|chainbutton
decl_stmt|;
DECL|member|width
name|GimpResolutionEntryField
name|width
decl_stmt|;
DECL|member|height
name|GimpResolutionEntryField
name|height
decl_stmt|;
DECL|member|x
name|GimpResolutionEntryField
name|x
decl_stmt|;
DECL|member|y
name|GimpResolutionEntryField
name|y
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_GimpResolutionEntryClass
struct|struct
name|_GimpResolutionEntryClass
block|{
DECL|member|parent_class
name|GtkTableClass
name|parent_class
decl_stmt|;
DECL|member|value_changed
name|void
function_decl|(
modifier|*
name|value_changed
function_decl|)
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gse
parameter_list|)
function_decl|;
DECL|member|refval_changed
name|void
function_decl|(
modifier|*
name|refval_changed
function_decl|)
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gse
parameter_list|)
function_decl|;
DECL|member|unit_changed
name|void
function_decl|(
modifier|*
name|unit_changed
function_decl|)
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gse
parameter_list|)
function_decl|;
block|}
struct|;
end_struct

begin_decl_stmt
name|GType
name|gimp_resolution_entry_get_type
argument_list|(
name|void
argument_list|)
name|G_GNUC_CONST
decl_stmt|;
end_decl_stmt

begin_function_decl
name|GtkWidget
modifier|*
name|gimp_resolution_entry_new
parameter_list|(
specifier|const
name|gchar
modifier|*
name|width_label
parameter_list|,
name|gdouble
name|width
parameter_list|,
specifier|const
name|gchar
modifier|*
name|height_label
parameter_list|,
name|gdouble
name|height
parameter_list|,
name|GimpUnit
name|size_unit
parameter_list|,
specifier|const
name|gchar
modifier|*
name|res_label
parameter_list|,
name|gdouble
name|initial_res
parameter_list|,
name|GimpUnit
name|initial_unit
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|GtkWidget
modifier|*
name|gimp_resolution_entry_attach_label
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
specifier|const
name|gchar
modifier|*
name|text
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|gfloat
name|alignment
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|gdouble
name|gimp_resolution_entry_get_x_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|gdouble
name|gimp_resolution_entry_get_y_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* signal callback convenience functions */
end_comment

begin_function_decl
name|void
name|gimp_resolution_entry_update_x_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gimp_resolution_entry_update_y_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_enum
enum|enum
DECL|enum|__anon2c76d6db0303
block|{
DECL|enumerator|WIDTH_CHANGED
name|WIDTH_CHANGED
block|,
DECL|enumerator|HEIGHT_CHANGED
name|HEIGHT_CHANGED
block|,
DECL|enumerator|X_CHANGED
name|X_CHANGED
block|,
DECL|enumerator|Y_CHANGED
name|Y_CHANGED
block|,
DECL|enumerator|UNIT_CHANGED
name|UNIT_CHANGED
block|,
DECL|enumerator|LAST_SIGNAL
name|LAST_SIGNAL
block|}
enum|;
end_enum

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_class_init
parameter_list|(
name|GimpResolutionEntryClass
modifier|*
name|class
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_init
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_update_value
parameter_list|(
name|GimpResolutionEntryField
modifier|*
name|gref
parameter_list|,
name|gdouble
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_value_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_update_unit
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|GimpUnit
name|unit
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_unit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_field_init
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|GimpResolutionEntryField
modifier|*
name|gref
parameter_list|,
name|GimpResolutionEntryField
modifier|*
name|corresponding
parameter_list|,
name|guint
name|changed_signal
parameter_list|,
name|gdouble
name|initial_val
parameter_list|,
name|GimpUnit
name|initial_unit
parameter_list|,
name|gboolean
name|size
parameter_list|,
name|gint
name|spinbutton_width
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_resolution_entry_format_label
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|GtkWidget
modifier|*
name|label
parameter_list|,
name|gdouble
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/**  ** end of gimpresolutionentry stuff  ** the actual code can be found at the end of this file  **/
end_comment

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
specifier|const
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
specifier|const
name|GimpParamDef
name|load_args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode { RUN-INTERACTIVE (0), RUN-NONINTERACTIVE (1) }"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to load"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"raw-filename"
block|,
literal|"The name entered"
block|}
comment|/* XXX: Nice to have API at some point, but needs work     { GIMP_PDB_INT32,     "resolution",   "Resolution to rasterize to (dpi)" },     { GIMP_PDB_INT32,     "antialiasing", "Enable antialiasing" },     { GIMP_PDB_INT32,     "n-pages",      "Number of pages to load (0 for all)" },     { GIMP_PDB_INT32ARRAY,"pages",        "The pages to load"                }     */
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|load_return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Output image"
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|thumb_args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to load"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"thumb-size"
block|,
literal|"Preferred thumbnail size"
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|thumb_return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Thumbnail image"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"image-width"
block|,
literal|"Width of full-sized image"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"image-height"
block|,
literal|"Height of full-sized image"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"image-type"
block|,
literal|"Image type"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"num-layers"
block|,
literal|"Number of pages"
block|}
block|}
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|LOAD_PROC
argument_list|,
literal|"Load file in PDF format"
argument_list|,
literal|"Loads files in Adobe's Portable Document Format. "
literal|"PDF is designed to be easily processed by a variety "
literal|"of different platforms, and is a distant cousin of "
literal|"PostScript."
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"2005"
argument_list|,
name|N_
argument_list|(
literal|"Portable Document Format"
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|load_args
argument_list|)
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|load_return_vals
argument_list|)
argument_list|,
name|load_args
argument_list|,
name|load_return_vals
argument_list|)
expr_stmt|;
name|gimp_register_file_handler_mime
argument_list|(
name|LOAD_PROC
argument_list|,
literal|"application/pdf"
argument_list|)
expr_stmt|;
name|gimp_register_magic_load_handler
argument_list|(
name|LOAD_PROC
argument_list|,
literal|"pdf"
argument_list|,
literal|""
argument_list|,
literal|"0, string,%PDF-"
argument_list|)
expr_stmt|;
name|gimp_install_procedure
argument_list|(
name|LOAD_THUMB_PROC
argument_list|,
literal|"Loads a preview from a PDF file."
argument_list|,
literal|"Loads a small preview of the first page of the PDF "
literal|"format file. Uses the embedded thumbnail if "
literal|"present."
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"2005"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|thumb_args
argument_list|)
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|thumb_return_vals
argument_list|)
argument_list|,
name|thumb_args
argument_list|,
name|thumb_return_vals
argument_list|)
expr_stmt|;
name|gimp_register_thumbnail_loader
argument_list|(
name|LOAD_PROC
argument_list|,
name|LOAD_THUMB_PROC
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (const gchar * name,gint nparams,const GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GimpParam
name|values
index|[
literal|6
index|]
decl_stmt|;
name|GimpRunMode
name|run_mode
decl_stmt|;
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
name|gint32
name|image_ID
init|=
operator|-
literal|1
decl_stmt|;
name|PopplerDocument
modifier|*
name|doc
init|=
name|NULL
decl_stmt|;
name|GError
modifier|*
name|error
init|=
name|NULL
decl_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
if|if
condition|(
operator|!
name|g_thread_supported
argument_list|()
condition|)
name|g_thread_init
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|LOAD_PROC
argument_list|)
operator|==
literal|0
condition|)
block|{
name|PdfSelectedPages
name|pages
init|=
block|{
literal|0
block|,
name|NULL
block|}
decl_stmt|;
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|GIMP_RUN_INTERACTIVE
case|:
comment|/* Possibly retrieve last settings */
name|gimp_get_data
argument_list|(
name|LOAD_PROC
argument_list|,
operator|&
name|loadvals
argument_list|)
expr_stmt|;
name|doc
operator|=
name|open_document
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|doc
condition|)
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
break|break;
block|}
name|status
operator|=
name|load_dialog
argument_list|(
name|doc
argument_list|,
operator|&
name|pages
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
name|gimp_set_data
argument_list|(
name|LOAD_PROC
argument_list|,
operator|&
name|loadvals
argument_list|,
sizeof|sizeof
argument_list|(
name|loadvals
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_WITH_LAST_VALS
case|:
comment|/* FIXME: implement last vals mode */
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_NONINTERACTIVE
case|:
name|doc
operator|=
name|open_document
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
name|doc
condition|)
block|{
name|PopplerPage
modifier|*
name|test_page
init|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|test_page
condition|)
block|{
name|pages
operator|.
name|n_pages
operator|=
literal|1
expr_stmt|;
name|pages
operator|.
name|pages
operator|=
name|g_new
argument_list|(
name|gint
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pages
operator|.
name|pages
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|g_object_unref
argument_list|(
name|test_page
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
name|g_object_unref
argument_list|(
name|doc
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|image_ID
operator|=
name|load_image
argument_list|(
name|doc
argument_list|,
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|,
name|run_mode
argument_list|,
name|loadvals
operator|.
name|target
argument_list|,
name|loadvals
operator|.
name|resolution
argument_list|,
name|loadvals
operator|.
name|antialias
argument_list|,
operator|&
name|pages
argument_list|)
expr_stmt|;
if|if
condition|(
name|image_ID
operator|!=
operator|-
literal|1
condition|)
block|{
operator|*
name|nreturn_vals
operator|=
literal|2
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image_ID
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
if|if
condition|(
name|doc
condition|)
name|g_object_unref
argument_list|(
name|doc
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pages
operator|.
name|pages
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|LOAD_THUMB_PROC
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|nparams
operator|<
literal|2
condition|)
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
else|else
block|{
name|gdouble
name|width
init|=
literal|0
decl_stmt|;
name|gdouble
name|height
init|=
literal|0
decl_stmt|;
name|gdouble
name|scale
decl_stmt|;
name|gint32
name|image
init|=
operator|-
literal|1
decl_stmt|;
name|gint
name|num_pages
init|=
literal|0
decl_stmt|;
name|cairo_surface_t
modifier|*
name|surface
init|=
name|NULL
decl_stmt|;
comment|/* Possibly retrieve last settings */
name|gimp_get_data
argument_list|(
name|LOAD_PROC
argument_list|,
operator|&
name|loadvals
argument_list|)
expr_stmt|;
name|doc
operator|=
name|open_document
argument_list|(
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
name|doc
condition|)
block|{
name|PopplerPage
modifier|*
name|page
init|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|page
condition|)
block|{
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|page
argument_list|)
expr_stmt|;
block|}
name|num_pages
operator|=
name|poppler_document_get_n_pages
argument_list|(
name|doc
argument_list|)
expr_stmt|;
name|surface
operator|=
name|get_thumb_surface
argument_list|(
name|doc
argument_list|,
literal|0
argument_list|,
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_int32
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|doc
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|surface
condition|)
block|{
name|image
operator|=
name|gimp_image_new
argument_list|(
name|cairo_image_surface_get_width
argument_list|(
name|surface
argument_list|)
argument_list|,
name|cairo_image_surface_get_height
argument_list|(
name|surface
argument_list|)
argument_list|,
name|GIMP_RGB
argument_list|)
expr_stmt|;
name|gimp_image_undo_disable
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|layer_from_surface
argument_list|(
name|image
argument_list|,
literal|"thumbnail"
argument_list|,
literal|0
argument_list|,
name|surface
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|cairo_surface_destroy
argument_list|(
name|surface
argument_list|)
expr_stmt|;
name|gimp_image_undo_enable
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_image_clean_all
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
name|scale
operator|=
name|loadvals
operator|.
name|resolution
operator|/
name|gimp_unit_get_factor
argument_list|(
name|GIMP_UNIT_POINT
argument_list|)
expr_stmt|;
name|width
operator|*=
name|scale
expr_stmt|;
name|height
operator|*=
name|scale
expr_stmt|;
if|if
condition|(
name|image
operator|!=
operator|-
literal|1
condition|)
block|{
operator|*
name|nreturn_vals
operator|=
literal|6
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image
expr_stmt|;
name|values
index|[
literal|2
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_INT32
expr_stmt|;
name|values
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int32
operator|=
name|width
expr_stmt|;
name|values
index|[
literal|3
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_INT32
expr_stmt|;
name|values
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_int32
operator|=
name|height
expr_stmt|;
name|values
index|[
literal|4
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_INT32
expr_stmt|;
name|values
index|[
literal|4
index|]
operator|.
name|data
operator|.
name|d_int32
operator|=
name|GIMP_RGB_IMAGE
expr_stmt|;
name|values
index|[
literal|5
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_INT32
expr_stmt|;
name|values
index|[
literal|5
index|]
operator|.
name|data
operator|.
name|d_int32
operator|=
name|num_pages
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|!=
name|GIMP_PDB_SUCCESS
operator|&&
name|error
condition|)
block|{
operator|*
name|nreturn_vals
operator|=
literal|2
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STRING
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
operator|=
name|error
operator|->
name|message
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|PopplerDocument
modifier|*
DECL|function|open_document (const gchar * filename,GError ** load_error)
name|open_document
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|,
name|GError
modifier|*
modifier|*
name|load_error
parameter_list|)
block|{
name|PopplerDocument
modifier|*
name|doc
decl_stmt|;
name|GMappedFile
modifier|*
name|mapped_file
decl_stmt|;
name|GError
modifier|*
name|error
init|=
name|NULL
decl_stmt|;
name|mapped_file
operator|=
name|g_mapped_file_new
argument_list|(
name|filename
argument_list|,
name|FALSE
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|mapped_file
condition|)
block|{
name|g_set_error
argument_list|(
name|load_error
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Could not load '%s': %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|,
name|error
operator|->
name|message
argument_list|)
expr_stmt|;
name|g_error_free
argument_list|(
name|error
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|doc
operator|=
name|poppler_document_new_from_data
argument_list|(
name|g_mapped_file_get_contents
argument_list|(
name|mapped_file
argument_list|)
argument_list|,
name|g_mapped_file_get_length
argument_list|(
name|mapped_file
argument_list|)
argument_list|,
name|NULL
argument_list|,
operator|&
name|error
argument_list|)
expr_stmt|;
comment|/* We can't g_mapped_file_unref(mapped_file) as apparently doc has    * references to data in there. No big deal, this is just a    * short-lived plug-in.    */
if|if
condition|(
operator|!
name|doc
condition|)
block|{
name|g_set_error
argument_list|(
name|load_error
argument_list|,
name|G_FILE_ERROR
argument_list|,
name|G_FILE_ERROR_FAILED
argument_list|,
name|_
argument_list|(
literal|"Could not load '%s': %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|,
name|error
operator|->
name|message
argument_list|)
expr_stmt|;
name|g_error_free
argument_list|(
name|error
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|doc
return|;
block|}
end_function

begin_comment
comment|/* FIXME: Remove this someday when we depend fully on GTK+>= 3 */
end_comment

begin_if
if|#
directive|if
operator|(
operator|!
name|GTK_CHECK_VERSION
argument_list|(
literal|3
operator|,
literal|0
operator|,
literal|0
argument_list|)
operator|)
end_if

begin_function
specifier|static
name|cairo_format_t
DECL|function|gdk_cairo_format_for_content (cairo_content_t content)
name|gdk_cairo_format_for_content
parameter_list|(
name|cairo_content_t
name|content
parameter_list|)
block|{
switch|switch
condition|(
name|content
condition|)
block|{
case|case
name|CAIRO_CONTENT_COLOR
case|:
return|return
name|CAIRO_FORMAT_RGB24
return|;
case|case
name|CAIRO_CONTENT_ALPHA
case|:
return|return
name|CAIRO_FORMAT_A8
return|;
case|case
name|CAIRO_CONTENT_COLOR_ALPHA
case|:
default|default:
return|return
name|CAIRO_FORMAT_ARGB32
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|cairo_surface_t
modifier|*
DECL|function|gdk_cairo_surface_coerce_to_image (cairo_surface_t * surface,cairo_content_t content,int src_x,int src_y,int width,int height)
name|gdk_cairo_surface_coerce_to_image
parameter_list|(
name|cairo_surface_t
modifier|*
name|surface
parameter_list|,
name|cairo_content_t
name|content
parameter_list|,
name|int
name|src_x
parameter_list|,
name|int
name|src_y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|cairo_surface_t
modifier|*
name|copy
decl_stmt|;
name|cairo_t
modifier|*
name|cr
decl_stmt|;
name|copy
operator|=
name|cairo_image_surface_create
argument_list|(
name|gdk_cairo_format_for_content
argument_list|(
name|content
argument_list|)
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|cr
operator|=
name|cairo_create
argument_list|(
name|copy
argument_list|)
expr_stmt|;
name|cairo_set_operator
argument_list|(
name|cr
argument_list|,
name|CAIRO_OPERATOR_SOURCE
argument_list|)
expr_stmt|;
name|cairo_set_source_surface
argument_list|(
name|cr
argument_list|,
name|surface
argument_list|,
operator|-
name|src_x
argument_list|,
operator|-
name|src_y
argument_list|)
expr_stmt|;
name|cairo_paint
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_destroy
argument_list|(
name|cr
argument_list|)
expr_stmt|;
return|return
name|copy
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|convert_alpha (guchar * dest_data,int dest_stride,guchar * src_data,int src_stride,int src_x,int src_y,int width,int height)
name|convert_alpha
parameter_list|(
name|guchar
modifier|*
name|dest_data
parameter_list|,
name|int
name|dest_stride
parameter_list|,
name|guchar
modifier|*
name|src_data
parameter_list|,
name|int
name|src_stride
parameter_list|,
name|int
name|src_x
parameter_list|,
name|int
name|src_y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|src_data
operator|+=
name|src_stride
operator|*
name|src_y
operator|+
name|src_x
operator|*
literal|4
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
block|{
name|guint32
modifier|*
name|src
init|=
operator|(
name|guint32
operator|*
operator|)
name|src_data
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|width
condition|;
name|x
operator|++
control|)
block|{
name|guint
name|alpha
init|=
name|src
index|[
name|x
index|]
operator|>>
literal|24
decl_stmt|;
if|if
condition|(
name|alpha
operator|==
literal|0
condition|)
block|{
name|dest_data
index|[
name|x
operator|*
literal|4
operator|+
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|dest_data
index|[
name|x
operator|*
literal|4
operator|+
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|dest_data
index|[
name|x
operator|*
literal|4
operator|+
literal|2
index|]
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|dest_data
index|[
name|x
operator|*
literal|4
operator|+
literal|0
index|]
operator|=
operator|(
operator|(
operator|(
name|src
index|[
name|x
index|]
operator|&
literal|0xff0000
operator|)
operator|>>
literal|16
operator|)
operator|*
literal|255
operator|+
name|alpha
operator|/
literal|2
operator|)
operator|/
name|alpha
expr_stmt|;
name|dest_data
index|[
name|x
operator|*
literal|4
operator|+
literal|1
index|]
operator|=
operator|(
operator|(
operator|(
name|src
index|[
name|x
index|]
operator|&
literal|0x00ff00
operator|)
operator|>>
literal|8
operator|)
operator|*
literal|255
operator|+
name|alpha
operator|/
literal|2
operator|)
operator|/
name|alpha
expr_stmt|;
name|dest_data
index|[
name|x
operator|*
literal|4
operator|+
literal|2
index|]
operator|=
operator|(
operator|(
operator|(
name|src
index|[
name|x
index|]
operator|&
literal|0x0000ff
operator|)
operator|>>
literal|0
operator|)
operator|*
literal|255
operator|+
name|alpha
operator|/
literal|2
operator|)
operator|/
name|alpha
expr_stmt|;
block|}
name|dest_data
index|[
name|x
operator|*
literal|4
operator|+
literal|3
index|]
operator|=
name|alpha
expr_stmt|;
block|}
name|src_data
operator|+=
name|src_stride
expr_stmt|;
name|dest_data
operator|+=
name|dest_stride
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|convert_no_alpha (guchar * dest_data,int dest_stride,guchar * src_data,int src_stride,int src_x,int src_y,int width,int height)
name|convert_no_alpha
parameter_list|(
name|guchar
modifier|*
name|dest_data
parameter_list|,
name|int
name|dest_stride
parameter_list|,
name|guchar
modifier|*
name|src_data
parameter_list|,
name|int
name|src_stride
parameter_list|,
name|int
name|src_x
parameter_list|,
name|int
name|src_y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|src_data
operator|+=
name|src_stride
operator|*
name|src_y
operator|+
name|src_x
operator|*
literal|4
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
block|{
name|guint32
modifier|*
name|src
init|=
operator|(
name|guint32
operator|*
operator|)
name|src_data
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|width
condition|;
name|x
operator|++
control|)
block|{
name|dest_data
index|[
name|x
operator|*
literal|3
operator|+
literal|0
index|]
operator|=
name|src
index|[
name|x
index|]
operator|>>
literal|16
expr_stmt|;
name|dest_data
index|[
name|x
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|src
index|[
name|x
index|]
operator|>>
literal|8
expr_stmt|;
name|dest_data
index|[
name|x
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|src
index|[
name|x
index|]
expr_stmt|;
block|}
name|src_data
operator|+=
name|src_stride
expr_stmt|;
name|dest_data
operator|+=
name|dest_stride
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * gdk_pixbuf_get_from_surface:  * @surface: surface to copy from  * @src_x: Source X coordinate within @surface  * @src_y: Source Y coordinate within @surface  * @width: Width in pixels of region to get  * @height: Height in pixels of region to get  *  * Transfers image data from a #cairo_surface_t and converts it to an RGB(A)  * representation inside a #GdkPixbuf. This allows you to efficiently read  * individual pixels from cairo surfaces. For #GdkWindows, use  * gdk_pixbuf_get_from_window() instead.  *  * This function will create an RGB pixbuf with 8 bits per channel.  * The pixbuf will contain an alpha channel if the @surface contains one.  *  * Return value: (transfer full): A newly-created pixbuf with a reference  *     count of 1, or %NULL on error  */
end_comment

begin_function
specifier|static
name|GdkPixbuf
modifier|*
DECL|function|gdk_pixbuf_get_from_surface (cairo_surface_t * surface,gint src_x,gint src_y,gint width,gint height)
name|gdk_pixbuf_get_from_surface
parameter_list|(
name|cairo_surface_t
modifier|*
name|surface
parameter_list|,
name|gint
name|src_x
parameter_list|,
name|gint
name|src_y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|cairo_content_t
name|content
decl_stmt|;
name|GdkPixbuf
modifier|*
name|dest
decl_stmt|;
comment|/* General sanity checks */
name|g_return_val_if_fail
argument_list|(
name|surface
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|width
operator|>
literal|0
operator|&&
name|height
operator|>
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|content
operator|=
name|cairo_surface_get_content
argument_list|(
name|surface
argument_list|)
operator||
name|CAIRO_CONTENT_COLOR
expr_stmt|;
name|dest
operator|=
name|gdk_pixbuf_new
argument_list|(
name|GDK_COLORSPACE_RGB
argument_list|,
operator|!
operator|!
operator|(
name|content
operator|&
name|CAIRO_CONTENT_ALPHA
operator|)
argument_list|,
literal|8
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|surface
operator|=
name|gdk_cairo_surface_coerce_to_image
argument_list|(
name|surface
argument_list|,
name|content
argument_list|,
name|src_x
argument_list|,
name|src_y
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|cairo_surface_flush
argument_list|(
name|surface
argument_list|)
expr_stmt|;
if|if
condition|(
name|cairo_surface_status
argument_list|(
name|surface
argument_list|)
operator|||
name|dest
operator|==
name|NULL
condition|)
block|{
name|cairo_surface_destroy
argument_list|(
name|surface
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|gdk_pixbuf_get_has_alpha
argument_list|(
name|dest
argument_list|)
condition|)
name|convert_alpha
argument_list|(
name|gdk_pixbuf_get_pixels
argument_list|(
name|dest
argument_list|)
argument_list|,
name|gdk_pixbuf_get_rowstride
argument_list|(
name|dest
argument_list|)
argument_list|,
name|cairo_image_surface_get_data
argument_list|(
name|surface
argument_list|)
argument_list|,
name|cairo_image_surface_get_stride
argument_list|(
name|surface
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
else|else
name|convert_no_alpha
argument_list|(
name|gdk_pixbuf_get_pixels
argument_list|(
name|dest
argument_list|)
argument_list|,
name|gdk_pixbuf_get_rowstride
argument_list|(
name|dest
argument_list|)
argument_list|,
name|cairo_image_surface_get_data
argument_list|(
name|surface
argument_list|)
argument_list|,
name|cairo_image_surface_get_stride
argument_list|(
name|surface
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|cairo_surface_destroy
argument_list|(
name|surface
argument_list|)
expr_stmt|;
return|return
name|dest
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|gint32
DECL|function|layer_from_surface (gint32 image,const gchar * layer_name,gint position,cairo_surface_t * surface,gdouble progress_start,gdouble progress_scale)
name|layer_from_surface
parameter_list|(
name|gint32
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|layer_name
parameter_list|,
name|gint
name|position
parameter_list|,
name|cairo_surface_t
modifier|*
name|surface
parameter_list|,
name|gdouble
name|progress_start
parameter_list|,
name|gdouble
name|progress_scale
parameter_list|)
block|{
name|gint32
name|layer
init|=
name|gimp_layer_new_from_surface
argument_list|(
name|image
argument_list|,
name|layer_name
argument_list|,
name|surface
argument_list|,
name|progress_start
argument_list|,
name|progress_start
operator|+
name|progress_scale
argument_list|)
decl_stmt|;
name|gimp_image_insert_layer
argument_list|(
name|image
argument_list|,
name|layer
argument_list|,
operator|-
literal|1
argument_list|,
name|position
argument_list|)
expr_stmt|;
return|return
name|layer
return|;
block|}
end_function

begin_function
specifier|static
name|cairo_surface_t
modifier|*
DECL|function|render_page_to_surface (PopplerPage * page,int width,int height,double scale,gboolean antialias)
name|render_page_to_surface
parameter_list|(
name|PopplerPage
modifier|*
name|page
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|double
name|scale
parameter_list|,
name|gboolean
name|antialias
parameter_list|)
block|{
name|cairo_surface_t
modifier|*
name|surface
decl_stmt|;
name|cairo_t
modifier|*
name|cr
decl_stmt|;
name|surface
operator|=
name|cairo_image_surface_create
argument_list|(
name|CAIRO_FORMAT_ARGB32
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|cr
operator|=
name|cairo_create
argument_list|(
name|surface
argument_list|)
expr_stmt|;
name|cairo_save
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_translate
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|scale
operator|!=
literal|1.0
condition|)
name|cairo_scale
argument_list|(
name|cr
argument_list|,
name|scale
argument_list|,
name|scale
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|antialias
condition|)
block|{
name|cairo_font_options_t
modifier|*
name|options
init|=
name|cairo_font_options_create
argument_list|()
decl_stmt|;
name|cairo_get_font_options
argument_list|(
name|cr
argument_list|,
name|options
argument_list|)
expr_stmt|;
name|cairo_font_options_set_antialias
argument_list|(
name|options
argument_list|,
name|CAIRO_ANTIALIAS_NONE
argument_list|)
expr_stmt|;
name|cairo_set_font_options
argument_list|(
name|cr
argument_list|,
name|options
argument_list|)
expr_stmt|;
name|cairo_set_antialias
argument_list|(
name|cr
argument_list|,
name|CAIRO_ANTIALIAS_NONE
argument_list|)
expr_stmt|;
name|cairo_font_options_destroy
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
name|poppler_page_render
argument_list|(
name|page
argument_list|,
name|cr
argument_list|)
expr_stmt|;
name|cairo_restore
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_set_operator
argument_list|(
name|cr
argument_list|,
name|CAIRO_OPERATOR_DEST_OVER
argument_list|)
expr_stmt|;
name|cairo_set_source_rgb
argument_list|(
name|cr
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|cairo_paint
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_destroy
argument_list|(
name|cr
argument_list|)
expr_stmt|;
return|return
name|surface
return|;
block|}
end_function

begin_if
if|#
directive|if
literal|0
end_if

begin_comment
comment|/* This is currently unused, but we'll have it here in case the military    wants it. */
end_comment

begin_endif
unit|static GdkPixbuf * render_page_to_pixbuf (PopplerPage *page,                        int          width,                        int          height,                        double       scale) {   GdkPixbuf *pixbuf;   cairo_surface_t *surface;    surface = render_page_to_surface (page, width, height, scale);   pixbuf = gdk_pixbuf_get_from_surface (surface, 0, 0,                                         cairo_image_surface_get_width (surface),                                         cairo_image_surface_get_height (surface));   cairo_surface_destroy (surface);    return pixbuf; }
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|gint32
DECL|function|load_image (PopplerDocument * doc,const gchar * filename,GimpRunMode run_mode,GimpPageSelectorTarget target,guint32 resolution,gboolean antialias,PdfSelectedPages * pages)
name|load_image
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|,
name|GimpRunMode
name|run_mode
parameter_list|,
name|GimpPageSelectorTarget
name|target
parameter_list|,
name|guint32
name|resolution
parameter_list|,
name|gboolean
name|antialias
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
block|{
name|gint32
name|image_ID
init|=
literal|0
decl_stmt|;
name|gint32
modifier|*
name|images
init|=
name|NULL
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gdouble
name|scale
decl_stmt|;
name|gdouble
name|doc_progress
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
name|images
operator|=
name|g_new0
argument_list|(
name|gint32
argument_list|,
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
name|gimp_progress_init_printf
argument_list|(
name|_
argument_list|(
literal|"Opening '%s'"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|)
expr_stmt|;
name|scale
operator|=
name|resolution
operator|/
name|gimp_unit_get_factor
argument_list|(
name|GIMP_UNIT_POINT
argument_list|)
expr_stmt|;
comment|/* read the file */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pages
operator|->
name|n_pages
condition|;
name|i
operator|++
control|)
block|{
name|PopplerPage
modifier|*
name|page
decl_stmt|;
name|gchar
modifier|*
name|page_label
decl_stmt|;
name|gdouble
name|page_width
decl_stmt|;
name|gdouble
name|page_height
decl_stmt|;
name|cairo_surface_t
modifier|*
name|surface
decl_stmt|;
name|gint
name|width
decl_stmt|;
name|gint
name|height
decl_stmt|;
name|page
operator|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
name|pages
operator|->
name|pages
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|page_width
argument_list|,
operator|&
name|page_height
argument_list|)
expr_stmt|;
name|width
operator|=
name|page_width
operator|*
name|scale
expr_stmt|;
name|height
operator|=
name|page_height
operator|*
name|scale
expr_stmt|;
name|g_object_get
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"label"
argument_list|,
operator|&
name|page_label
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|image_ID
condition|)
block|{
name|gchar
modifier|*
name|name
decl_stmt|;
name|image_ID
operator|=
name|gimp_image_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|GIMP_RGB
argument_list|)
expr_stmt|;
name|gimp_image_undo_disable
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
name|name
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%s-%s"
argument_list|)
argument_list|,
name|filename
argument_list|,
name|page_label
argument_list|)
expr_stmt|;
else|else
name|name
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%s-pages"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|gimp_image_set_filename
argument_list|(
name|image_ID
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gimp_image_set_resolution
argument_list|(
name|image_ID
argument_list|,
name|resolution
argument_list|,
name|resolution
argument_list|)
expr_stmt|;
block|}
name|surface
operator|=
name|render_page_to_surface
argument_list|(
name|page
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|scale
argument_list|,
name|antialias
argument_list|)
expr_stmt|;
name|layer_from_surface
argument_list|(
name|image_ID
argument_list|,
name|page_label
argument_list|,
name|i
argument_list|,
name|surface
argument_list|,
name|doc_progress
argument_list|,
literal|1.0
operator|/
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|page_label
argument_list|)
expr_stmt|;
name|cairo_surface_destroy
argument_list|(
name|surface
argument_list|)
expr_stmt|;
name|doc_progress
operator|=
call|(
name|double
call|)
argument_list|(
name|i
operator|+
literal|1
argument_list|)
operator|/
name|pages
operator|->
name|n_pages
expr_stmt|;
name|gimp_progress_update
argument_list|(
name|doc_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
block|{
name|images
index|[
name|i
index|]
operator|=
name|image_ID
expr_stmt|;
name|gimp_image_undo_enable
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
name|gimp_image_clean_all
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
name|image_ID
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|gimp_progress_update
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|image_ID
condition|)
block|{
name|gimp_image_undo_enable
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
name|gimp_image_clean_all
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
block|{
if|if
condition|(
name|run_mode
operator|!=
name|GIMP_RUN_NONINTERACTIVE
condition|)
block|{
comment|/* Display images in reverse order.  The last will be            * displayed by GIMP itself            */
for|for
control|(
name|i
operator|=
name|pages
operator|->
name|n_pages
operator|-
literal|1
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
name|gimp_display_new
argument_list|(
name|images
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|image_ID
operator|=
name|images
index|[
literal|0
index|]
expr_stmt|;
name|g_free
argument_list|(
name|images
argument_list|)
expr_stmt|;
block|}
return|return
name|image_ID
return|;
block|}
end_function

begin_function
specifier|static
name|cairo_surface_t
modifier|*
DECL|function|get_thumb_surface (PopplerDocument * doc,gint page_num,gint preferred_size)
name|get_thumb_surface
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|gint
name|page_num
parameter_list|,
name|gint
name|preferred_size
parameter_list|)
block|{
name|PopplerPage
modifier|*
name|page
decl_stmt|;
name|cairo_surface_t
modifier|*
name|surface
decl_stmt|;
name|page
operator|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
name|page_num
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|page
condition|)
return|return
name|NULL
return|;
name|surface
operator|=
name|poppler_page_get_thumbnail
argument_list|(
name|page
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|surface
condition|)
block|{
name|gdouble
name|width
decl_stmt|;
name|gdouble
name|height
decl_stmt|;
name|gdouble
name|scale
decl_stmt|;
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
name|scale
operator|=
operator|(
name|gdouble
operator|)
name|preferred_size
operator|/
name|MAX
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|width
operator|*=
name|scale
expr_stmt|;
name|height
operator|*=
name|scale
expr_stmt|;
name|surface
operator|=
name|render_page_to_surface
argument_list|(
name|page
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|scale
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|g_object_unref
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|surface
return|;
block|}
end_function

begin_function
specifier|static
name|GdkPixbuf
modifier|*
DECL|function|get_thumb_pixbuf (PopplerDocument * doc,gint page_num,gint preferred_size)
name|get_thumb_pixbuf
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|gint
name|page_num
parameter_list|,
name|gint
name|preferred_size
parameter_list|)
block|{
name|cairo_surface_t
modifier|*
name|surface
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|surface
operator|=
name|get_thumb_surface
argument_list|(
name|doc
argument_list|,
name|page_num
argument_list|,
name|preferred_size
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_get_from_surface
argument_list|(
name|surface
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|cairo_image_surface_get_width
argument_list|(
name|surface
argument_list|)
argument_list|,
name|cairo_image_surface_get_height
argument_list|(
name|surface
argument_list|)
argument_list|)
expr_stmt|;
name|cairo_surface_destroy
argument_list|(
name|surface
argument_list|)
expr_stmt|;
return|return
name|pixbuf
return|;
block|}
end_function

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2c76d6db0408
block|{
DECL|member|document
name|PopplerDocument
modifier|*
name|document
decl_stmt|;
DECL|member|selector
name|GimpPageSelector
modifier|*
name|selector
decl_stmt|;
DECL|member|stop_thumbnailing
name|gboolean
name|stop_thumbnailing
decl_stmt|;
DECL|typedef|ThreadData
block|}
name|ThreadData
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2c76d6db0508
block|{
DECL|member|selector
name|GimpPageSelector
modifier|*
name|selector
decl_stmt|;
DECL|member|page_no
name|gint
name|page_no
decl_stmt|;
DECL|member|pixbuf
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
DECL|typedef|IdleData
block|}
name|IdleData
typedef|;
end_typedef

begin_function
specifier|static
name|gboolean
DECL|function|idle_set_thumbnail (gpointer data)
name|idle_set_thumbnail
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|IdleData
modifier|*
name|idle_data
init|=
name|data
decl_stmt|;
name|gimp_page_selector_set_page_thumbnail
argument_list|(
name|idle_data
operator|->
name|selector
argument_list|,
name|idle_data
operator|->
name|page_no
argument_list|,
name|idle_data
operator|->
name|pixbuf
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|idle_data
operator|->
name|pixbuf
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|idle_data
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gpointer
DECL|function|thumbnail_thread (gpointer data)
name|thumbnail_thread
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|ThreadData
modifier|*
name|thread_data
init|=
name|data
decl_stmt|;
name|gint
name|n_pages
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|n_pages
operator|=
name|poppler_document_get_n_pages
argument_list|(
name|thread_data
operator|->
name|document
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_pages
condition|;
name|i
operator|++
control|)
block|{
name|IdleData
modifier|*
name|idle_data
init|=
name|g_new0
argument_list|(
name|IdleData
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|idle_data
operator|->
name|selector
operator|=
name|thread_data
operator|->
name|selector
expr_stmt|;
name|idle_data
operator|->
name|page_no
operator|=
name|i
expr_stmt|;
comment|/* FIXME get preferred size from somewhere? */
name|idle_data
operator|->
name|pixbuf
operator|=
name|get_thumb_pixbuf
argument_list|(
name|thread_data
operator|->
name|document
argument_list|,
name|i
argument_list|,
name|THUMBNAIL_SIZE
argument_list|)
expr_stmt|;
name|g_idle_add
argument_list|(
name|idle_set_thumbnail
argument_list|,
name|idle_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|thread_data
operator|->
name|stop_thumbnailing
condition|)
break|break;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|GimpPDBStatusType
DECL|function|load_dialog (PopplerDocument * doc,PdfSelectedPages * pages)
name|load_dialog
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|title
decl_stmt|;
name|GtkWidget
modifier|*
name|selector
decl_stmt|;
name|GtkWidget
modifier|*
name|resolution
decl_stmt|;
name|GtkWidget
modifier|*
name|antialias
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|ThreadData
name|thread_data
decl_stmt|;
name|GThread
modifier|*
name|thread
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|n_pages
decl_stmt|;
name|gdouble
name|width
decl_stmt|;
name|gdouble
name|height
decl_stmt|;
name|gboolean
name|run
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Import from PDF"
argument_list|)
argument_list|,
name|PLUG_IN_ROLE
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|LOAD_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|_
argument_list|(
literal|"_Import"
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_window_set_transient
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Title */
name|title
operator|=
name|gimp_prop_label_new
argument_list|(
name|G_OBJECT
argument_list|(
name|doc
argument_list|)
argument_list|,
literal|"title"
argument_list|)
expr_stmt|;
name|gtk_label_set_ellipsize
argument_list|(
name|GTK_LABEL
argument_list|(
name|title
argument_list|)
argument_list|,
name|PANGO_ELLIPSIZE_END
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|title
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title
argument_list|)
expr_stmt|;
comment|/* Page Selector */
name|selector
operator|=
name|gimp_page_selector_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|selector
argument_list|,
literal|380
argument_list|,
literal|360
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|selector
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|selector
argument_list|)
expr_stmt|;
name|n_pages
operator|=
name|poppler_document_get_n_pages
argument_list|(
name|doc
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_pages
operator|<=
literal|0
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Error getting number of pages from the given PDF file."
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|GIMP_PDB_EXECUTION_ERROR
return|;
block|}
name|gimp_page_selector_set_n_pages
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
name|n_pages
argument_list|)
expr_stmt|;
name|gimp_page_selector_set_target
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
name|loadvals
operator|.
name|target
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_pages
condition|;
name|i
operator|++
control|)
block|{
name|PopplerPage
modifier|*
name|page
decl_stmt|;
name|gchar
modifier|*
name|label
decl_stmt|;
name|page
operator|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|g_object_get
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"label"
argument_list|,
operator|&
name|label
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_page_selector_set_page_label
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
name|i
argument_list|,
name|label
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|page
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
name|g_signal_connect_swapped
argument_list|(
name|selector
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_window_activate_default
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|thread_data
operator|.
name|document
operator|=
name|doc
expr_stmt|;
name|thread_data
operator|.
name|selector
operator|=
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
expr_stmt|;
name|thread_data
operator|.
name|stop_thumbnailing
operator|=
name|FALSE
expr_stmt|;
name|thread
operator|=
name|g_thread_create
argument_list|(
name|thumbnail_thread
argument_list|,
operator|&
name|thread_data
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Resolution */
name|hbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|resolution
operator|=
name|gimp_resolution_entry_new
argument_list|(
name|_
argument_list|(
literal|"_Width (pixels):"
argument_list|)
argument_list|,
name|width
argument_list|,
name|_
argument_list|(
literal|"_Height (pixels):"
argument_list|)
argument_list|,
name|height
argument_list|,
name|GIMP_UNIT_POINT
argument_list|,
name|_
argument_list|(
literal|"_Resolution:"
argument_list|)
argument_list|,
name|loadvals
operator|.
name|resolution
argument_list|,
name|GIMP_UNIT_INCH
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|resolution
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|resolution
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|resolution
argument_list|,
literal|"x-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_resolution_entry_update_x_in_dpi
argument_list|)
argument_list|,
operator|&
name|loadvals
operator|.
name|resolution
argument_list|)
expr_stmt|;
comment|/* Antialiasing*/
name|antialias
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Enable Antialiasing"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|antialias
argument_list|)
argument_list|,
name|loadvals
operator|.
name|antialias
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|antialias
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|antialias
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|loadvals
operator|.
name|antialias
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|antialias
argument_list|)
expr_stmt|;
comment|/* Setup done; display the dialog */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
comment|/* run the dialog */
name|run
operator|=
operator|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_OK
operator|)
expr_stmt|;
name|loadvals
operator|.
name|target
operator|=
name|gimp_page_selector_get_target
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|)
expr_stmt|;
name|pages
operator|->
name|pages
operator|=
name|gimp_page_selector_get_selected_pages
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
operator|&
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
comment|/* select all if none selected */
if|if
condition|(
name|pages
operator|->
name|n_pages
operator|==
literal|0
condition|)
block|{
name|gimp_page_selector_select_all
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|)
expr_stmt|;
name|pages
operator|->
name|pages
operator|=
name|gimp_page_selector_get_selected_pages
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
operator|&
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
block|}
comment|/* cleanup */
name|thread_data
operator|.
name|stop_thumbnailing
operator|=
name|TRUE
expr_stmt|;
name|g_thread_join
argument_list|(
name|thread
argument_list|)
expr_stmt|;
return|return
name|run
condition|?
name|GIMP_PDB_SUCCESS
else|:
name|GIMP_PDB_CANCEL
return|;
block|}
end_function

begin_comment
comment|/**  ** code for GimpResolutionEntry widget, formerly in libgimpwidgets  **/
end_comment

begin_decl_stmt
DECL|variable|gimp_resolution_entry_signals
specifier|static
name|guint
name|gimp_resolution_entry_signals
index|[
name|LAST_SIGNAL
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|parent_class
specifier|static
name|GtkTableClass
modifier|*
name|parent_class
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
name|GType
DECL|function|gimp_resolution_entry_get_type (void)
name|gimp_resolution_entry_get_type
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GType
name|gre_type
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|gre_type
condition|)
block|{
specifier|const
name|GTypeInfo
name|gre_info
init|=
block|{
sizeof|sizeof
argument_list|(
name|GimpResolutionEntryClass
argument_list|)
block|,
operator|(
name|GBaseInitFunc
operator|)
name|NULL
block|,
operator|(
name|GBaseFinalizeFunc
operator|)
name|NULL
block|,
operator|(
name|GClassInitFunc
operator|)
name|gimp_resolution_entry_class_init
block|,
name|NULL
block|,
comment|/* class_finalize */
name|NULL
block|,
comment|/* class_data     */
sizeof|sizeof
argument_list|(
name|GimpResolutionEntry
argument_list|)
block|,
literal|0
block|,
comment|/* n_preallocs    */
operator|(
name|GInstanceInitFunc
operator|)
name|gimp_resolution_entry_init
block|,       }
decl_stmt|;
name|gre_type
operator|=
name|g_type_register_static
argument_list|(
name|GTK_TYPE_TABLE
argument_list|,
literal|"GimpResolutionEntry"
argument_list|,
operator|&
name|gre_info
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
return|return
name|gre_type
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_class_init (GimpResolutionEntryClass * klass)
name|gimp_resolution_entry_class_init
parameter_list|(
name|GimpResolutionEntryClass
modifier|*
name|klass
parameter_list|)
block|{
name|parent_class
operator|=
name|g_type_class_peek_parent
argument_list|(
name|klass
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_signals
index|[
name|HEIGHT_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"height-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpResolutionEntryClass
argument_list|,
name|value_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_signals
index|[
name|WIDTH_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"width-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpResolutionEntryClass
argument_list|,
name|value_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_signals
index|[
name|X_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"x-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpResolutionEntryClass
argument_list|,
name|value_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_signals
index|[
name|Y_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"y-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpResolutionEntryClass
argument_list|,
name|refval_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_signals
index|[
name|UNIT_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"unit-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpResolutionEntryClass
argument_list|,
name|unit_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|klass
operator|->
name|value_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|refval_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|unit_changed
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_init (GimpResolutionEntry * gre)
name|gimp_resolution_entry_init
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
block|{
name|gre
operator|->
name|unitmenu
operator|=
name|NULL
expr_stmt|;
name|gre
operator|->
name|unit
operator|=
name|GIMP_UNIT_INCH
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_field_init (GimpResolutionEntry * gre,GimpResolutionEntryField * gref,GimpResolutionEntryField * corresponding,guint changed_signal,gdouble initial_val,GimpUnit initial_unit,gboolean size,gint spinbutton_width)
name|gimp_resolution_entry_field_init
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|GimpResolutionEntryField
modifier|*
name|gref
parameter_list|,
name|GimpResolutionEntryField
modifier|*
name|corresponding
parameter_list|,
name|guint
name|changed_signal
parameter_list|,
name|gdouble
name|initial_val
parameter_list|,
name|GimpUnit
name|initial_unit
parameter_list|,
name|gboolean
name|size
parameter_list|,
name|gint
name|spinbutton_width
parameter_list|)
block|{
name|gint
name|digits
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_RESOLUTION_ENTRY
argument_list|(
name|gre
argument_list|)
argument_list|)
expr_stmt|;
name|gref
operator|->
name|gre
operator|=
name|gre
expr_stmt|;
name|gref
operator|->
name|corresponding
operator|=
name|corresponding
expr_stmt|;
name|gref
operator|->
name|changed_signal
operator|=
name|gimp_resolution_entry_signals
index|[
name|changed_signal
index|]
expr_stmt|;
if|if
condition|(
name|size
condition|)
block|{
name|gref
operator|->
name|value
operator|=
name|initial_val
operator|/
name|gimp_unit_get_factor
argument_list|(
name|initial_unit
argument_list|)
operator|*
name|corresponding
operator|->
name|value
operator|*
name|gimp_unit_get_factor
argument_list|(
name|gre
operator|->
name|unit
argument_list|)
expr_stmt|;
name|gref
operator|->
name|phy_size
operator|=
name|initial_val
operator|/
name|gimp_unit_get_factor
argument_list|(
name|initial_unit
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gref
operator|->
name|value
operator|=
name|initial_val
expr_stmt|;
block|}
name|gref
operator|->
name|min_value
operator|=
name|GIMP_MIN_RESOLUTION
expr_stmt|;
name|gref
operator|->
name|max_value
operator|=
name|GIMP_MAX_RESOLUTION
expr_stmt|;
name|gref
operator|->
name|adjustment
operator|=
name|NULL
expr_stmt|;
name|gref
operator|->
name|stop_recursion
operator|=
literal|0
expr_stmt|;
name|gref
operator|->
name|size
operator|=
name|size
expr_stmt|;
if|if
condition|(
name|size
condition|)
block|{
name|gref
operator|->
name|label
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_LABEL
argument_list|,
literal|"xalign"
argument_list|,
literal|0.0
argument_list|,
literal|"yalign"
argument_list|,
literal|0.5
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_label_set_attributes
argument_list|(
name|GTK_LABEL
argument_list|(
name|gref
operator|->
name|label
argument_list|)
argument_list|,
name|PANGO_ATTR_STYLE
argument_list|,
name|PANGO_STYLE_ITALIC
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_format_label
argument_list|(
name|gre
argument_list|,
name|gref
operator|->
name|label
argument_list|,
name|gref
operator|->
name|phy_size
argument_list|)
expr_stmt|;
block|}
name|digits
operator|=
name|size
condition|?
literal|0
else|:
name|MIN
argument_list|(
name|gimp_unit_get_digits
argument_list|(
name|initial_unit
argument_list|)
argument_list|,
literal|5
argument_list|)
operator|+
literal|1
expr_stmt|;
name|gref
operator|->
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|gref
operator|->
name|adjustment
argument_list|,
name|gref
operator|->
name|value
argument_list|,
name|gref
operator|->
name|min_value
argument_list|,
name|gref
operator|->
name|max_value
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
name|digits
argument_list|)
expr_stmt|;
if|if
condition|(
name|spinbutton_width
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|spinbutton_width
operator|<
literal|17
condition|)
name|gtk_entry_set_width_chars
argument_list|(
name|GTK_ENTRY
argument_list|(
name|gref
operator|->
name|spinbutton
argument_list|)
argument_list|,
name|spinbutton_width
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_set_size_request
argument_list|(
name|gref
operator|->
name|spinbutton
argument_list|,
name|spinbutton_width
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * gimp_resolution_entry_new:  * @width_label:       Optional label for the width control.  * @width:             Width of the item, specified in terms of @size_unit.  * @height_label:      Optional label for the height control.  * @height:            Height of the item, specified in terms of @size_unit.  * @size_unit:         Unit used to specify the width and height.  * @res_label:         Optional label for the resolution entry.  * @initial_res:       The initial resolution.  * @initial_unit:      The initial unit.  *  * Creates a new #GimpResolutionEntry widget.  *  * The #GimpResolutionEntry is derived from #GtkTable and will have  * an empty border of one cell width on each side plus an empty column left  * of the #GimpUnitMenu to allow the caller to add labels or other widgets.  *  * A #GimpChainButton is displayed if independent is set to %TRUE.  *  * Returns: A pointer to the new #GimpResolutionEntry widget.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_resolution_entry_new (const gchar * width_label,gdouble width,const gchar * height_label,gdouble height,GimpUnit size_unit,const gchar * res_label,gdouble initial_res,GimpUnit initial_unit)
name|gimp_resolution_entry_new
parameter_list|(
specifier|const
name|gchar
modifier|*
name|width_label
parameter_list|,
name|gdouble
name|width
parameter_list|,
specifier|const
name|gchar
modifier|*
name|height_label
parameter_list|,
name|gdouble
name|height
parameter_list|,
name|GimpUnit
name|size_unit
parameter_list|,
specifier|const
name|gchar
modifier|*
name|res_label
parameter_list|,
name|gdouble
name|initial_res
parameter_list|,
name|GimpUnit
name|initial_unit
parameter_list|)
block|{
name|GimpResolutionEntry
modifier|*
name|gre
decl_stmt|;
name|GtkTreeModel
modifier|*
name|model
decl_stmt|;
name|gre
operator|=
name|g_object_new
argument_list|(
name|GIMP_TYPE_RESOLUTION_ENTRY
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gre
operator|->
name|unit
operator|=
name|initial_unit
expr_stmt|;
name|gtk_table_resize
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_field_init
argument_list|(
name|gre
argument_list|,
operator|&
name|gre
operator|->
name|x
argument_list|,
operator|&
name|gre
operator|->
name|width
argument_list|,
name|X_CHANGED
argument_list|,
name|initial_res
argument_list|,
name|initial_unit
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
name|gre
operator|->
name|x
operator|.
name|spinbutton
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gre
operator|->
name|x
operator|.
name|adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_resolution_entry_value_callback
argument_list|)
argument_list|,
operator|&
name|gre
operator|->
name|x
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gre
operator|->
name|x
operator|.
name|spinbutton
argument_list|)
expr_stmt|;
name|gre
operator|->
name|unitmenu
operator|=
name|gimp_unit_combo_box_new
argument_list|()
expr_stmt|;
name|model
operator|=
name|gtk_combo_box_get_model
argument_list|(
name|GTK_COMBO_BOX
argument_list|(
name|gre
operator|->
name|unitmenu
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_unit_store_set_has_pixels
argument_list|(
name|GIMP_UNIT_STORE
argument_list|(
name|model
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_unit_store_set_has_percent
argument_list|(
name|GIMP_UNIT_STORE
argument_list|(
name|model
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_object_set
argument_list|(
name|model
argument_list|,
literal|"short-format"
argument_list|,
name|_
argument_list|(
literal|"pixels/%a"
argument_list|)
argument_list|,
literal|"long-format"
argument_list|,
name|_
argument_list|(
literal|"pixels/%a"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_unit_combo_box_set_active
argument_list|(
name|GIMP_UNIT_COMBO_BOX
argument_list|(
name|gre
operator|->
name|unitmenu
argument_list|)
argument_list|,
name|initial_unit
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
name|gre
operator|->
name|unitmenu
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gre
operator|->
name|unitmenu
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_resolution_entry_unit_callback
argument_list|)
argument_list|,
name|gre
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gre
operator|->
name|unitmenu
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_field_init
argument_list|(
name|gre
argument_list|,
operator|&
name|gre
operator|->
name|width
argument_list|,
operator|&
name|gre
operator|->
name|x
argument_list|,
name|WIDTH_CHANGED
argument_list|,
name|width
argument_list|,
name|size_unit
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
name|gre
operator|->
name|width
operator|.
name|spinbutton
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
name|gre
operator|->
name|width
operator|.
name|label
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gre
operator|->
name|width
operator|.
name|adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_resolution_entry_value_callback
argument_list|)
argument_list|,
operator|&
name|gre
operator|->
name|width
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gre
operator|->
name|width
operator|.
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gre
operator|->
name|width
operator|.
name|label
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_field_init
argument_list|(
name|gre
argument_list|,
operator|&
name|gre
operator|->
name|height
argument_list|,
operator|&
name|gre
operator|->
name|x
argument_list|,
name|HEIGHT_CHANGED
argument_list|,
name|height
argument_list|,
name|size_unit
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
name|gre
operator|->
name|height
operator|.
name|spinbutton
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
name|gre
operator|->
name|height
operator|.
name|label
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gre
operator|->
name|height
operator|.
name|adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_resolution_entry_value_callback
argument_list|)
argument_list|,
operator|&
name|gre
operator|->
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gre
operator|->
name|height
operator|.
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gre
operator|->
name|height
operator|.
name|label
argument_list|)
expr_stmt|;
if|if
condition|(
name|width_label
condition|)
name|gimp_resolution_entry_attach_label
argument_list|(
name|gre
argument_list|,
name|width_label
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|height_label
condition|)
name|gimp_resolution_entry_attach_label
argument_list|(
name|gre
argument_list|,
name|height_label
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|res_label
condition|)
name|gimp_resolution_entry_attach_label
argument_list|(
name|gre
argument_list|,
name|res_label
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
return|return
name|GTK_WIDGET
argument_list|(
name|gre
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_resolution_entry_attach_label:  * @gre:       The #GimpResolutionEntry you want to add a label to.  * @text:      The text of the label.  * @row:       The row where the label will be attached.  * @column:    The column where the label will be attached.  * @alignment: The horizontal alignment of the label.  *  * Attaches a #GtkLabel to the #GimpResolutionEntry (which is a #GtkTable).  *  * Returns: A pointer to the new #GtkLabel widget.  **/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_resolution_entry_attach_label (GimpResolutionEntry * gre,const gchar * text,gint row,gint column,gfloat alignment)
name|gimp_resolution_entry_attach_label
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
specifier|const
name|gchar
modifier|*
name|text
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|gfloat
name|alignment
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_RESOLUTION_ENTRY
argument_list|(
name|gre
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|text
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new_with_mnemonic
argument_list|(
name|text
argument_list|)
expr_stmt|;
if|if
condition|(
name|column
operator|==
literal|0
condition|)
block|{
name|GList
modifier|*
name|children
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|children
operator|=
name|gtk_container_get_children
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|gre
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|children
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GtkWidget
modifier|*
name|child
init|=
name|list
operator|->
name|data
decl_stmt|;
name|gint
name|left_attach
decl_stmt|;
name|gint
name|top_attach
decl_stmt|;
name|gtk_container_child_get
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|gre
argument_list|)
argument_list|,
name|child
argument_list|,
literal|"left-attach"
argument_list|,
operator|&
name|left_attach
argument_list|,
literal|"top-attach"
argument_list|,
operator|&
name|top_attach
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|left_attach
operator|==
literal|1
operator|&&
name|top_attach
operator|==
name|row
condition|)
block|{
name|gtk_label_set_mnemonic_widget
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|child
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|g_list_free
argument_list|(
name|children
argument_list|)
expr_stmt|;
block|}
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
name|alignment
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|gre
argument_list|)
argument_list|,
name|label
argument_list|,
name|column
argument_list|,
name|column
operator|+
literal|1
argument_list|,
name|row
argument_list|,
name|row
operator|+
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
return|return
name|label
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_resolution_entry_get_x_in_dpi;  * @gre:   The #GimpResolutionEntry you want to know the resolution of.  *  * Returns the X resolution of the #GimpResolutionEntry in pixels per inch.  **/
end_comment

begin_function
name|gdouble
DECL|function|gimp_resolution_entry_get_x_in_dpi (GimpResolutionEntry * gre)
name|gimp_resolution_entry_get_x_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_RESOLUTION_ENTRY
argument_list|(
name|gre
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* dots_in_one_unit * units_in_one_inch -> dpi */
return|return
name|gre
operator|->
name|x
operator|.
name|value
operator|*
name|gimp_unit_get_factor
argument_list|(
name|gre
operator|->
name|unit
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_resolution_entry_get_y_in_dpi;  * @gre:   The #GimpResolutionEntry you want to know the resolution of.  *  * Returns the Y resolution of the #GimpResolutionEntry in pixels per inch.  **/
end_comment

begin_function
name|gdouble
DECL|function|gimp_resolution_entry_get_y_in_dpi (GimpResolutionEntry * gre)
name|gimp_resolution_entry_get_y_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_RESOLUTION_ENTRY
argument_list|(
name|gre
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|gre
operator|->
name|y
operator|.
name|value
operator|*
name|gimp_unit_get_factor
argument_list|(
name|gre
operator|->
name|unit
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_update_value (GimpResolutionEntryField * gref,gdouble value)
name|gimp_resolution_entry_update_value
parameter_list|(
name|GimpResolutionEntryField
modifier|*
name|gref
parameter_list|,
name|gdouble
name|value
parameter_list|)
block|{
if|if
condition|(
name|gref
operator|->
name|stop_recursion
operator|>
literal|0
condition|)
return|return;
name|gref
operator|->
name|value
operator|=
name|value
expr_stmt|;
name|gref
operator|->
name|stop_recursion
operator|++
expr_stmt|;
if|if
condition|(
name|gref
operator|->
name|size
condition|)
name|gimp_resolution_entry_update_value
argument_list|(
name|gref
operator|->
name|corresponding
argument_list|,
name|gref
operator|->
name|value
operator|/
name|gref
operator|->
name|phy_size
operator|/
name|gimp_unit_get_factor
argument_list|(
name|gref
operator|->
name|gre
operator|->
name|unit
argument_list|)
argument_list|)
expr_stmt|;
else|else
block|{
name|gdouble
name|factor
init|=
name|gimp_unit_get_factor
argument_list|(
name|gref
operator|->
name|gre
operator|->
name|unit
argument_list|)
decl_stmt|;
name|gimp_resolution_entry_update_value
argument_list|(
operator|&
name|gref
operator|->
name|gre
operator|->
name|width
argument_list|,
name|gref
operator|->
name|value
operator|*
name|gref
operator|->
name|gre
operator|->
name|width
operator|.
name|phy_size
operator|*
name|factor
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_update_value
argument_list|(
operator|&
name|gref
operator|->
name|gre
operator|->
name|height
argument_list|,
name|gref
operator|->
name|value
operator|*
name|gref
operator|->
name|gre
operator|->
name|height
operator|.
name|phy_size
operator|*
name|factor
argument_list|)
expr_stmt|;
block|}
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|gref
operator|->
name|adjustment
argument_list|)
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|gref
operator|->
name|stop_recursion
operator|--
expr_stmt|;
name|g_signal_emit
argument_list|(
name|gref
operator|->
name|gre
argument_list|,
name|gref
operator|->
name|changed_signal
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_value_callback (GtkWidget * widget,gpointer data)
name|gimp_resolution_entry_value_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpResolutionEntryField
modifier|*
name|gref
init|=
operator|(
name|GimpResolutionEntryField
operator|*
operator|)
name|data
decl_stmt|;
name|gdouble
name|new_value
decl_stmt|;
name|new_value
operator|=
name|gtk_adjustment_get_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gref
operator|->
name|value
operator|!=
name|new_value
condition|)
name|gimp_resolution_entry_update_value
argument_list|(
name|gref
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_update_unit (GimpResolutionEntry * gre,GimpUnit unit)
name|gimp_resolution_entry_update_unit
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|GimpUnit
name|unit
parameter_list|)
block|{
name|GimpUnit
name|old_unit
decl_stmt|;
name|gint
name|digits
decl_stmt|;
name|gdouble
name|factor
decl_stmt|;
name|old_unit
operator|=
name|gre
operator|->
name|unit
expr_stmt|;
name|gre
operator|->
name|unit
operator|=
name|unit
expr_stmt|;
name|digits
operator|=
operator|(
name|gimp_unit_get_digits
argument_list|(
name|GIMP_UNIT_INCH
argument_list|)
operator|-
name|gimp_unit_get_digits
argument_list|(
name|unit
argument_list|)
operator|)
expr_stmt|;
name|gtk_spin_button_set_digits
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|gre
operator|->
name|x
operator|.
name|spinbutton
argument_list|)
argument_list|,
name|MAX
argument_list|(
literal|3
operator|+
name|digits
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|factor
operator|=
name|gimp_unit_get_factor
argument_list|(
name|old_unit
argument_list|)
operator|/
name|gimp_unit_get_factor
argument_list|(
name|unit
argument_list|)
expr_stmt|;
name|gre
operator|->
name|x
operator|.
name|min_value
operator|*=
name|factor
expr_stmt|;
name|gre
operator|->
name|x
operator|.
name|max_value
operator|*=
name|factor
expr_stmt|;
name|gre
operator|->
name|x
operator|.
name|value
operator|*=
name|factor
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|gre
operator|->
name|x
operator|.
name|adjustment
argument_list|)
argument_list|,
name|gre
operator|->
name|x
operator|.
name|value
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_format_label
argument_list|(
name|gre
argument_list|,
name|gre
operator|->
name|width
operator|.
name|label
argument_list|,
name|gre
operator|->
name|width
operator|.
name|phy_size
argument_list|)
expr_stmt|;
name|gimp_resolution_entry_format_label
argument_list|(
name|gre
argument_list|,
name|gre
operator|->
name|height
operator|.
name|label
argument_list|,
name|gre
operator|->
name|height
operator|.
name|phy_size
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|gre
argument_list|,
name|gimp_resolution_entry_signals
index|[
name|UNIT_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_unit_callback (GtkWidget * widget,GimpResolutionEntry * gre)
name|gimp_resolution_entry_unit_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|)
block|{
name|GimpUnit
name|new_unit
decl_stmt|;
name|new_unit
operator|=
name|gimp_unit_combo_box_get_active
argument_list|(
name|GIMP_UNIT_COMBO_BOX
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gre
operator|->
name|unit
operator|!=
name|new_unit
condition|)
name|gimp_resolution_entry_update_unit
argument_list|(
name|gre
argument_list|,
name|new_unit
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_resolution_entry_update_x_in_dpi:  * @gre: the #GimpResolutionEntry  * @data: a pointer to a gdouble  *  * Convenience function to set a double to the X resolution, suitable  * for use as a signal callback.  */
end_comment

begin_function
name|void
DECL|function|gimp_resolution_entry_update_x_in_dpi (GimpResolutionEntry * gre,gpointer data)
name|gimp_resolution_entry_update_x_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gdouble
modifier|*
name|val
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|gre
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|data
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_RESOLUTION_ENTRY
argument_list|(
name|gre
argument_list|)
argument_list|)
expr_stmt|;
name|val
operator|=
operator|(
name|gdouble
operator|*
operator|)
name|data
expr_stmt|;
operator|*
name|val
operator|=
name|gimp_resolution_entry_get_x_in_dpi
argument_list|(
name|gre
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_resolution_entry_update_y_in_dpi:  * @gre: the #GimpResolutionEntry  * @data: a pointer to a gdouble  *  * Convenience function to set a double to the Y resolution, suitable  * for use as a signal callback.  */
end_comment

begin_function
name|void
DECL|function|gimp_resolution_entry_update_y_in_dpi (GimpResolutionEntry * gre,gpointer data)
name|gimp_resolution_entry_update_y_in_dpi
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gdouble
modifier|*
name|val
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|gre
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|data
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_RESOLUTION_ENTRY
argument_list|(
name|gre
argument_list|)
argument_list|)
expr_stmt|;
name|val
operator|=
operator|(
name|gdouble
operator|*
operator|)
name|data
expr_stmt|;
operator|*
name|val
operator|=
name|gimp_resolution_entry_get_y_in_dpi
argument_list|(
name|gre
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_resolution_entry_format_label (GimpResolutionEntry * gre,GtkWidget * label,gdouble size)
name|gimp_resolution_entry_format_label
parameter_list|(
name|GimpResolutionEntry
modifier|*
name|gre
parameter_list|,
name|GtkWidget
modifier|*
name|label
parameter_list|,
name|gdouble
name|size
parameter_list|)
block|{
name|gchar
modifier|*
name|format
init|=
name|g_strdup_printf
argument_list|(
literal|"%%.%df %%s"
argument_list|,
name|gimp_unit_get_digits
argument_list|(
name|gre
operator|->
name|unit
argument_list|)
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|text
init|=
name|g_strdup_printf
argument_list|(
name|format
argument_list|,
name|size
operator|*
name|gimp_unit_get_factor
argument_list|(
name|gre
operator|->
name|unit
argument_list|)
argument_list|,
name|gimp_unit_get_plural
argument_list|(
name|gre
operator|->
name|unit
argument_list|)
argument_list|)
decl_stmt|;
name|g_free
argument_list|(
name|format
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|text
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

