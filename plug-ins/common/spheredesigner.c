begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  * The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * SphereDesigner v0.4 - creates textured spheres  * by Vidar Madsen<vidar@prosalg.no>  *  * Status: Last updated 1999-09-11  *  * Known issues:  * - Might crash if you click OK or Cancel before first preview is rendered  * - Phong might look weird with transparent textures  *  * Todo:  * - Saving / Loading of presets needs an overhaul  * - Antialiasing  * - Global controls: Gamma, ++  * - Beautification of GUI  * - Clean up messy source (lots of Glade remnants)  * - (Probably more. ;-)  */
end_comment

begin_define
DECL|macro|PLUG_IN_NAME
define|#
directive|define
name|PLUG_IN_NAME
value|"SphereDesigner"
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CONFIG_H
end_ifdef

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_TIME_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/time.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|SRAND_FUNC
end_ifndef

begin_define
DECL|macro|SRAND_FUNC
define|#
directive|define
name|SRAND_FUNC
value|srand
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifndef
ifndef|#
directive|ifndef
name|RAND_FUNC
end_ifndef

begin_define
DECL|macro|RAND_FUNC
define|#
directive|define
name|RAND_FUNC
value|rand
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|PREVIEWSIZE
define|#
directive|define
name|PREVIEWSIZE
value|150
end_define

begin_comment
comment|/* These must be adjusted as more functionality is added */
end_comment

begin_define
DECL|macro|MAXOBJECT
define|#
directive|define
name|MAXOBJECT
value|5
end_define

begin_define
DECL|macro|MAXLIGHT
define|#
directive|define
name|MAXLIGHT
value|5
end_define

begin_define
DECL|macro|MAXTEXTURE
define|#
directive|define
name|MAXTEXTURE
value|20
end_define

begin_define
DECL|macro|MAXTEXTUREPEROBJ
define|#
directive|define
name|MAXTEXTUREPEROBJ
value|20
end_define

begin_define
DECL|macro|MAXNORMAL
define|#
directive|define
name|MAXNORMAL
value|20
end_define

begin_define
DECL|macro|MAXNORMALPEROBJ
define|#
directive|define
name|MAXNORMALPEROBJ
value|20
end_define

begin_define
DECL|macro|MAXATMOS
define|#
directive|define
name|MAXATMOS
value|1
end_define

begin_define
DECL|macro|MAXCOLPERGRADIENT
define|#
directive|define
name|MAXCOLPERGRADIENT
value|5
end_define

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_enum
DECL|enum|__anon28b6bfad0103
enum|enum
block|{
DECL|enumerator|TRIANGLE
DECL|enumerator|DISC
DECL|enumerator|PLANE
DECL|enumerator|SPHERE
DECL|enumerator|CYLINDER
DECL|enumerator|LIGHT
name|TRIANGLE
block|,
name|DISC
block|,
name|PLANE
block|,
name|SPHERE
block|,
name|CYLINDER
block|,
name|LIGHT
block|}
enum|;
end_enum

begin_enum
DECL|enum|__anon28b6bfad0203
enum|enum
block|{
DECL|enumerator|SOLID
DECL|enumerator|CHECKER
DECL|enumerator|MARBLE
DECL|enumerator|LIZARD
DECL|enumerator|IMAGE
DECL|enumerator|PHONG
DECL|enumerator|REFLECTION
DECL|enumerator|REFRACTION
DECL|enumerator|PERLIN
name|SOLID
block|,
name|CHECKER
block|,
name|MARBLE
block|,
name|LIZARD
block|,
name|IMAGE
block|,
name|PHONG
block|,
name|REFLECTION
block|,
name|REFRACTION
block|,
name|PERLIN
block|,
DECL|enumerator|WOOD
DECL|enumerator|TRANSPARENT
DECL|enumerator|SPIRAL
DECL|enumerator|SPOTS
DECL|enumerator|SMOKE
name|WOOD
block|,
name|TRANSPARENT
block|,
name|SPIRAL
block|,
name|SPOTS
block|,
name|SMOKE
block|}
enum|;
end_enum

begin_enum
DECL|enum|__anon28b6bfad0303
enum|enum
block|{
DECL|enumerator|PERSPECTIVE
DECL|enumerator|ORTHOGONAL
DECL|enumerator|FISHEYE
name|PERSPECTIVE
block|,
name|ORTHOGONAL
block|,
name|FISHEYE
block|}
enum|;
end_enum

begin_enum
DECL|enum|__anon28b6bfad0403
enum|enum
block|{
DECL|enumerator|FOG
name|FOG
block|}
enum|;
end_enum

begin_comment
comment|/* World-flags */
end_comment

begin_define
DECL|macro|SMARTAMBIENT
define|#
directive|define
name|SMARTAMBIENT
value|0x00000001
end_define

begin_comment
comment|/* Object-flags */
end_comment

begin_define
DECL|macro|NOSHADOW
define|#
directive|define
name|NOSHADOW
value|0x00000001
end_define

begin_comment
comment|/* Texture-flags */
end_comment

begin_define
DECL|macro|GRADIENT
define|#
directive|define
name|GRADIENT
value|0x00000001
end_define

begin_typedef
DECL|struct|__anon28b6bfad0508
typedef|typedef
struct|struct
block|{
DECL|member|x
DECL|member|y
DECL|member|z
DECL|member|w
name|double
name|x
decl_stmt|,
name|y
decl_stmt|,
name|z
decl_stmt|,
name|w
decl_stmt|;
DECL|typedef|vector
block|}
name|vector
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0608
typedef|typedef
struct|struct
block|{
DECL|member|xsize
DECL|member|ysize
name|short
name|xsize
decl_stmt|,
name|ysize
decl_stmt|;
DECL|member|rgb
name|unsigned
name|char
modifier|*
name|rgb
decl_stmt|;
DECL|typedef|image
block|}
name|image
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0708
typedef|typedef
struct|struct
block|{
DECL|member|numcol
name|short
name|numcol
decl_stmt|;
DECL|member|pos
name|double
name|pos
index|[
name|MAXCOLPERGRADIENT
index|]
decl_stmt|;
DECL|member|color
name|vector
name|color
index|[
name|MAXCOLPERGRADIENT
index|]
decl_stmt|;
DECL|typedef|gradient
block|}
name|gradient
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0808
typedef|typedef
struct|struct
block|{
DECL|member|majtype
name|int
name|majtype
decl_stmt|;
DECL|member|type
name|int
name|type
decl_stmt|;
DECL|member|flags
name|unsigned
name|long
name|flags
decl_stmt|;
DECL|member|color1
DECL|member|color2
name|vector
name|color1
decl_stmt|,
name|color2
decl_stmt|;
DECL|member|gradient
name|gradient
name|gradient
decl_stmt|;
DECL|member|ambient
DECL|member|diffuse
name|vector
name|ambient
decl_stmt|,
name|diffuse
decl_stmt|;
DECL|member|oscale
name|double
name|oscale
decl_stmt|;
DECL|member|scale
DECL|member|translate
DECL|member|rotate
name|vector
name|scale
decl_stmt|,
name|translate
decl_stmt|,
name|rotate
decl_stmt|;
DECL|member|image
name|image
name|image
decl_stmt|;
DECL|member|reflection
name|vector
name|reflection
decl_stmt|;
DECL|member|refraction
name|vector
name|refraction
decl_stmt|;
DECL|member|transparent
name|vector
name|transparent
decl_stmt|;
DECL|member|ior
name|double
name|ior
decl_stmt|;
DECL|member|phongcolor
name|vector
name|phongcolor
decl_stmt|;
DECL|member|phongsize
name|double
name|phongsize
decl_stmt|;
DECL|member|amount
name|double
name|amount
decl_stmt|;
DECL|member|exp
name|double
name|exp
decl_stmt|;
DECL|member|turbulence
name|vector
name|turbulence
decl_stmt|;
DECL|typedef|texture
block|}
name|texture
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0908
typedef|typedef
struct|struct
block|{
DECL|member|type
name|short
name|type
decl_stmt|;
DECL|member|density
name|double
name|density
decl_stmt|;
DECL|member|color
name|vector
name|color
decl_stmt|;
DECL|member|turbulence
name|double
name|turbulence
decl_stmt|;
DECL|typedef|atmos
block|}
name|atmos
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0a08
typedef|typedef
struct|struct
block|{
DECL|member|type
name|short
name|type
decl_stmt|;
DECL|member|flags
name|unsigned
name|long
name|flags
decl_stmt|;
DECL|member|numtexture
name|short
name|numtexture
decl_stmt|;
DECL|member|texture
name|texture
name|texture
index|[
name|MAXTEXTUREPEROBJ
index|]
decl_stmt|;
DECL|member|numnormal
name|short
name|numnormal
decl_stmt|;
DECL|member|normal
name|texture
name|normal
index|[
name|MAXNORMALPEROBJ
index|]
decl_stmt|;
DECL|typedef|common
block|}
name|common
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0b08
typedef|typedef
struct|struct
block|{
DECL|member|com
name|common
name|com
decl_stmt|;
DECL|member|a
DECL|member|b
DECL|member|c
name|vector
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|;
DECL|typedef|triangle
block|}
name|triangle
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0c08
typedef|typedef
struct|struct
block|{
DECL|member|com
name|common
name|com
decl_stmt|;
DECL|member|a
name|vector
name|a
decl_stmt|;
DECL|member|b
DECL|member|r
name|double
name|b
decl_stmt|,
name|r
decl_stmt|;
DECL|typedef|disc
block|}
name|disc
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0d08
typedef|typedef
struct|struct
block|{
DECL|member|com
name|common
name|com
decl_stmt|;
DECL|member|a
name|vector
name|a
decl_stmt|;
DECL|member|r
name|double
name|r
decl_stmt|;
DECL|typedef|sphere
block|}
name|sphere
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0e08
typedef|typedef
struct|struct
block|{
DECL|member|com
name|common
name|com
decl_stmt|;
DECL|member|a
DECL|member|b
DECL|member|c
name|vector
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|;
DECL|typedef|cylinder
block|}
name|cylinder
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad0f08
typedef|typedef
struct|struct
block|{
DECL|member|com
name|common
name|com
decl_stmt|;
DECL|member|a
name|vector
name|a
decl_stmt|;
DECL|member|b
name|double
name|b
decl_stmt|;
DECL|typedef|plane
block|}
name|plane
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad1008
typedef|typedef
struct|struct
block|{
DECL|member|com
name|common
name|com
decl_stmt|;
DECL|member|color
name|vector
name|color
decl_stmt|;
DECL|member|a
name|vector
name|a
decl_stmt|;
DECL|typedef|light
block|}
name|light
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon28b6bfad1108
typedef|typedef
struct|struct
block|{
DECL|member|v1
DECL|member|v2
name|vector
name|v1
decl_stmt|,
name|v2
decl_stmt|;
DECL|member|inside
name|short
name|inside
decl_stmt|;
DECL|member|ior
name|double
name|ior
decl_stmt|;
DECL|typedef|ray
block|}
name|ray
typedef|;
end_typedef

begin_typedef
DECL|union|__anon28b6bfad120a
typedef|typedef
union|union
block|{
DECL|member|com
name|common
name|com
decl_stmt|;
DECL|member|tri
name|triangle
name|tri
decl_stmt|;
DECL|member|disc
name|disc
name|disc
decl_stmt|;
DECL|member|plane
name|plane
name|plane
decl_stmt|;
DECL|member|sphere
name|sphere
name|sphere
decl_stmt|;
DECL|member|cylinder
name|cylinder
name|cylinder
decl_stmt|;
DECL|typedef|object
block|}
name|object
typedef|;
end_typedef

begin_struct
DECL|struct|world_t
struct|struct
name|world_t
block|{
DECL|member|numobj
name|int
name|numobj
decl_stmt|;
DECL|member|obj
name|object
name|obj
index|[
name|MAXOBJECT
index|]
decl_stmt|;
DECL|member|numlight
name|int
name|numlight
decl_stmt|;
DECL|member|light
name|light
name|light
index|[
name|MAXLIGHT
index|]
decl_stmt|;
DECL|member|numtexture
name|int
name|numtexture
decl_stmt|;
DECL|member|texture
name|texture
name|texture
index|[
name|MAXTEXTURE
index|]
decl_stmt|;
DECL|member|flags
name|unsigned
name|long
name|flags
decl_stmt|;
DECL|member|quality
name|short
name|quality
decl_stmt|;
DECL|member|smartambient
name|double
name|smartambient
decl_stmt|;
DECL|member|numatmos
name|short
name|numatmos
decl_stmt|;
DECL|member|atmos
name|atmos
name|atmos
index|[
name|MAXATMOS
index|]
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|camera_t
struct|struct
name|camera_t
block|{
DECL|member|location
DECL|member|lookat
DECL|member|up
DECL|member|right
name|vector
name|location
decl_stmt|,
name|lookat
decl_stmt|,
name|up
decl_stmt|,
name|right
decl_stmt|;
DECL|member|type
name|short
name|type
decl_stmt|;
DECL|member|fov
DECL|member|tilt
name|double
name|fov
decl_stmt|,
name|tilt
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
name|int
name|traceray
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|int
name|level
parameter_list|,
name|double
name|imp
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|drawarea
name|GtkWidget
modifier|*
name|drawarea
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|img
name|unsigned
name|char
name|img
index|[
name|PREVIEWSIZE
operator|*
name|PREVIEWSIZE
operator|*
literal|3
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|running
name|int
name|running
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|s
name|sphere
name|s
decl_stmt|;
end_decl_stmt

begin_struct
DECL|struct|textures_t
struct|struct
name|textures_t
block|{
DECL|member|index
name|int
name|index
decl_stmt|;
DECL|member|s
name|char
modifier|*
name|s
decl_stmt|;
DECL|member|n
name|long
name|n
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
DECL|variable|textures
name|struct
name|textures_t
name|textures
index|[]
init|=
block|{
block|{
literal|0
block|,
name|N_
argument_list|(
literal|"Solid"
argument_list|)
block|,
name|SOLID
block|}
block|,
block|{
literal|1
block|,
name|N_
argument_list|(
literal|"Checker"
argument_list|)
block|,
name|CHECKER
block|}
block|,
block|{
literal|2
block|,
name|N_
argument_list|(
literal|"Marble"
argument_list|)
block|,
name|MARBLE
block|}
block|,
block|{
literal|3
block|,
name|N_
argument_list|(
literal|"Lizard"
argument_list|)
block|,
name|LIZARD
block|}
block|,
block|{
literal|4
block|,
name|N_
argument_list|(
literal|"Phong"
argument_list|)
block|,
name|PHONG
block|}
block|,
block|{
literal|5
block|,
name|N_
argument_list|(
literal|"Noise"
argument_list|)
block|,
name|PERLIN
block|}
block|,
block|{
literal|6
block|,
name|N_
argument_list|(
literal|"Wood"
argument_list|)
block|,
name|WOOD
block|}
block|,
block|{
literal|7
block|,
name|N_
argument_list|(
literal|"Spiral"
argument_list|)
block|,
name|SPIRAL
block|}
block|,
block|{
literal|8
block|,
name|N_
argument_list|(
literal|"Spots"
argument_list|)
block|,
name|SPOTS
block|}
block|,
block|{
literal|0
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_struct
DECL|struct|__anon28b6bfad1308
struct|struct
block|{
DECL|member|solid
DECL|member|phong
DECL|member|light
name|int
name|solid
decl_stmt|,
name|phong
decl_stmt|,
name|light
decl_stmt|;
DECL|variable|settings
block|}
name|settings
init|=
block|{
literal|1
block|,
literal|1
block|,
literal|1
block|}
struct|;
end_struct

begin_function_decl
specifier|inline
name|void
name|vset
parameter_list|(
name|vector
modifier|*
name|v
parameter_list|,
name|double
name|a
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|c
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|gint
name|restartrender
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|drawcolor1
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|drawcolor2
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|render
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|realrender
parameter_list|(
name|GDrawable
modifier|*
name|drawable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|fileselect
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_define
DECL|macro|COLORBUTTONWIDTH
define|#
directive|define
name|COLORBUTTONWIDTH
value|30
end_define

begin_define
DECL|macro|COLORBUTTONHEIGHT
define|#
directive|define
name|COLORBUTTONHEIGHT
value|20
end_define

begin_decl_stmt
DECL|variable|texturelist
name|GtkWidget
modifier|*
name|texturelist
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|scalexscale
DECL|variable|scaleyscale
DECL|variable|scalezscale
name|GtkObject
modifier|*
name|scalexscale
decl_stmt|,
modifier|*
name|scaleyscale
decl_stmt|,
modifier|*
name|scalezscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|rotxscale
DECL|variable|rotyscale
DECL|variable|rotzscale
name|GtkObject
modifier|*
name|rotxscale
decl_stmt|,
modifier|*
name|rotyscale
decl_stmt|,
modifier|*
name|rotzscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|posxscale
DECL|variable|posyscale
DECL|variable|poszscale
name|GtkObject
modifier|*
name|posxscale
decl_stmt|,
modifier|*
name|posyscale
decl_stmt|,
modifier|*
name|poszscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|scalescale
name|GtkObject
modifier|*
name|scalescale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|turbulencescale
name|GtkObject
modifier|*
name|turbulencescale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|amountscale
name|GtkObject
modifier|*
name|amountscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|expscale
name|GtkObject
modifier|*
name|expscale
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|typemenu_menu
name|GtkWidget
modifier|*
name|typemenu_menu
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|texturemenu_menu
name|GtkWidget
modifier|*
name|texturemenu_menu
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|typemenu
name|GtkWidget
modifier|*
name|typemenu
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|texturemenu
name|GtkWidget
modifier|*
name|texturemenu
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|DOT (a,b)
define|#
directive|define
name|DOT
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|(a[0] * b[0] + a[1] * b[1] + a[2] * b[2])
end_define

begin_define
DECL|macro|B
define|#
directive|define
name|B
value|256
end_define

begin_decl_stmt
DECL|variable|p
specifier|static
name|int
name|p
index|[
name|B
operator|+
name|B
operator|+
literal|2
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|g
specifier|static
name|double
name|g
index|[
name|B
operator|+
name|B
operator|+
literal|2
index|]
index|[
literal|3
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|start
specifier|static
name|int
name|start
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_function
DECL|function|init (void)
name|void
name|init
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|;
name|double
name|v
index|[
literal|3
index|]
decl_stmt|,
name|s
decl_stmt|;
comment|/* Create an array of random gradient vectors uniformly on the unit sphere */
name|SRAND_FUNC
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|/* Use static seed, to get reproducable results */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|B
condition|;
name|i
operator|++
control|)
block|{
do|do
block|{
comment|/* Choose uniformly in a cube */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
name|v
index|[
name|j
index|]
operator|=
call|(
name|double
call|)
argument_list|(
operator|(
name|RAND_FUNC
argument_list|()
operator|%
operator|(
name|B
operator|+
name|B
operator|)
operator|)
operator|-
name|B
argument_list|)
operator|/
name|B
expr_stmt|;
name|s
operator|=
name|DOT
argument_list|(
name|v
argument_list|,
name|v
argument_list|)
expr_stmt|;
block|}
do|while
condition|(
name|s
operator|>
literal|1.0
condition|)
do|;
comment|/* If not in sphere try again */
name|s
operator|=
name|sqrt
argument_list|(
name|s
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
comment|/* Else normalize */
name|g
index|[
name|i
index|]
index|[
name|j
index|]
operator|=
name|v
index|[
name|j
index|]
operator|/
name|s
expr_stmt|;
block|}
comment|/* Create a pseudorandom permutation of [1..B] */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|B
condition|;
name|i
operator|++
control|)
name|p
index|[
name|i
index|]
operator|=
name|i
expr_stmt|;
for|for
control|(
name|i
operator|=
name|B
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|-=
literal|2
control|)
block|{
name|k
operator|=
name|p
index|[
name|i
index|]
expr_stmt|;
name|p
index|[
name|i
index|]
operator|=
name|p
index|[
name|j
operator|=
name|RAND_FUNC
argument_list|()
operator|%
name|B
index|]
expr_stmt|;
name|p
index|[
name|j
index|]
operator|=
name|k
expr_stmt|;
block|}
comment|/* Extend g and p arrays to allow for faster indexing */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|B
operator|+
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|p
index|[
name|B
operator|+
name|i
index|]
operator|=
name|p
index|[
name|i
index|]
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
name|g
index|[
name|B
operator|+
name|i
index|]
index|[
name|j
index|]
operator|=
name|g
index|[
name|i
index|]
index|[
name|j
index|]
expr_stmt|;
block|}
block|}
end_function

begin_define
DECL|macro|setup (i,b0,b1,r0,r1)
define|#
directive|define
name|setup
parameter_list|(
name|i
parameter_list|,
name|b0
parameter_list|,
name|b1
parameter_list|,
name|r0
parameter_list|,
name|r1
parameter_list|)
define|\
value|t = vec[i] + 10000.; \         b0 = ((int)t)& (B-1); \         b1 = (b0+1)& (B-1); \         r0 = t - (int)t; \         r1 = r0 - 1.;
end_define

begin_function
DECL|function|noise3 (double * vec)
name|double
name|noise3
parameter_list|(
name|double
modifier|*
name|vec
parameter_list|)
block|{
name|int
name|bx0
decl_stmt|,
name|bx1
decl_stmt|,
name|by0
decl_stmt|,
name|by1
decl_stmt|,
name|bz0
decl_stmt|,
name|bz1
decl_stmt|,
name|b00
decl_stmt|,
name|b10
decl_stmt|,
name|b01
decl_stmt|,
name|b11
decl_stmt|;
name|double
name|rx0
decl_stmt|,
name|rx1
decl_stmt|,
name|ry0
decl_stmt|,
name|ry1
decl_stmt|,
name|rz0
decl_stmt|,
name|rz1
decl_stmt|,
modifier|*
name|q
decl_stmt|,
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|sz
decl_stmt|,
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|d
decl_stmt|,
name|t
decl_stmt|,
name|u
decl_stmt|,
name|v
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|start
condition|)
block|{
name|start
operator|=
literal|0
expr_stmt|;
name|init
argument_list|()
expr_stmt|;
block|}
name|setup
argument_list|(
literal|0
argument_list|,
name|bx0
argument_list|,
name|bx1
argument_list|,
name|rx0
argument_list|,
name|rx1
argument_list|)
expr_stmt|;
name|setup
argument_list|(
literal|1
argument_list|,
name|by0
argument_list|,
name|by1
argument_list|,
name|ry0
argument_list|,
name|ry1
argument_list|)
expr_stmt|;
name|setup
argument_list|(
literal|2
argument_list|,
name|bz0
argument_list|,
name|bz1
argument_list|,
name|rz0
argument_list|,
name|rz1
argument_list|)
expr_stmt|;
name|i
operator|=
name|p
index|[
name|bx0
index|]
expr_stmt|;
name|j
operator|=
name|p
index|[
name|bx1
index|]
expr_stmt|;
name|b00
operator|=
name|p
index|[
name|i
operator|+
name|by0
index|]
expr_stmt|;
name|b10
operator|=
name|p
index|[
name|j
operator|+
name|by0
index|]
expr_stmt|;
name|b01
operator|=
name|p
index|[
name|i
operator|+
name|by1
index|]
expr_stmt|;
name|b11
operator|=
name|p
index|[
name|j
operator|+
name|by1
index|]
expr_stmt|;
DECL|macro|at (rx,ry,rz)
define|#
directive|define
name|at
parameter_list|(
name|rx
parameter_list|,
name|ry
parameter_list|,
name|rz
parameter_list|)
value|( rx * q[0] + ry * q[1] + rz * q[2] )
DECL|macro|surve (t)
define|#
directive|define
name|surve
parameter_list|(
name|t
parameter_list|)
value|( t * t * (3. - 2. * t) )
DECL|macro|lerp (t,a,b)
define|#
directive|define
name|lerp
parameter_list|(
name|t
parameter_list|,
name|a
parameter_list|,
name|b
parameter_list|)
value|( a + t * (b - a) )
name|sx
operator|=
name|surve
argument_list|(
name|rx0
argument_list|)
expr_stmt|;
name|sy
operator|=
name|surve
argument_list|(
name|ry0
argument_list|)
expr_stmt|;
name|sz
operator|=
name|surve
argument_list|(
name|rz0
argument_list|)
expr_stmt|;
name|q
operator|=
name|g
index|[
name|b00
operator|+
name|bz0
index|]
expr_stmt|;
name|u
operator|=
name|at
argument_list|(
name|rx0
argument_list|,
name|ry0
argument_list|,
name|rz0
argument_list|)
expr_stmt|;
name|q
operator|=
name|g
index|[
name|b10
operator|+
name|bz0
index|]
expr_stmt|;
name|v
operator|=
name|at
argument_list|(
name|rx1
argument_list|,
name|ry0
argument_list|,
name|rz0
argument_list|)
expr_stmt|;
name|a
operator|=
name|lerp
argument_list|(
name|sx
argument_list|,
name|u
argument_list|,
name|v
argument_list|)
expr_stmt|;
name|q
operator|=
name|g
index|[
name|b01
operator|+
name|bz0
index|]
expr_stmt|;
name|u
operator|=
name|at
argument_list|(
name|rx0
argument_list|,
name|ry1
argument_list|,
name|rz0
argument_list|)
expr_stmt|;
name|q
operator|=
name|g
index|[
name|b11
operator|+
name|bz0
index|]
expr_stmt|;
name|v
operator|=
name|at
argument_list|(
name|rx1
argument_list|,
name|ry1
argument_list|,
name|rz0
argument_list|)
expr_stmt|;
name|b
operator|=
name|lerp
argument_list|(
name|sx
argument_list|,
name|u
argument_list|,
name|v
argument_list|)
expr_stmt|;
name|c
operator|=
name|lerp
argument_list|(
name|sy
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
comment|/* interpolate in y at lo x */
name|q
operator|=
name|g
index|[
name|b00
operator|+
name|bz1
index|]
expr_stmt|;
name|u
operator|=
name|at
argument_list|(
name|rx0
argument_list|,
name|ry0
argument_list|,
name|rz1
argument_list|)
expr_stmt|;
name|q
operator|=
name|g
index|[
name|b10
operator|+
name|bz1
index|]
expr_stmt|;
name|v
operator|=
name|at
argument_list|(
name|rx1
argument_list|,
name|ry0
argument_list|,
name|rz1
argument_list|)
expr_stmt|;
name|a
operator|=
name|lerp
argument_list|(
name|sx
argument_list|,
name|u
argument_list|,
name|v
argument_list|)
expr_stmt|;
name|q
operator|=
name|g
index|[
name|b01
operator|+
name|bz1
index|]
expr_stmt|;
name|u
operator|=
name|at
argument_list|(
name|rx0
argument_list|,
name|ry1
argument_list|,
name|rz1
argument_list|)
expr_stmt|;
name|q
operator|=
name|g
index|[
name|b11
operator|+
name|bz1
index|]
expr_stmt|;
name|v
operator|=
name|at
argument_list|(
name|rx1
argument_list|,
name|ry1
argument_list|,
name|rz1
argument_list|)
expr_stmt|;
name|b
operator|=
name|lerp
argument_list|(
name|sx
argument_list|,
name|u
argument_list|,
name|v
argument_list|)
expr_stmt|;
name|d
operator|=
name|lerp
argument_list|(
name|sy
argument_list|,
name|a
argument_list|,
name|b
argument_list|)
expr_stmt|;
comment|/* interpolate in y at hi x */
return|return
literal|1.5
operator|*
name|lerp
argument_list|(
name|sz
argument_list|,
name|c
argument_list|,
name|d
argument_list|)
return|;
comment|/* interpolate in z */
block|}
end_function

begin_function
DECL|function|turbulence (double * point,double lofreq,double hifreq)
name|double
name|turbulence
parameter_list|(
name|double
modifier|*
name|point
parameter_list|,
name|double
name|lofreq
parameter_list|,
name|double
name|hifreq
parameter_list|)
block|{
name|double
name|noise3
argument_list|()
decl_stmt|,
name|freq
decl_stmt|,
name|t
decl_stmt|,
name|p
index|[
literal|3
index|]
decl_stmt|;
name|p
index|[
literal|0
index|]
operator|=
name|point
index|[
literal|0
index|]
operator|+
literal|123.456
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|=
name|point
index|[
literal|1
index|]
operator|+
literal|234.567
expr_stmt|;
name|p
index|[
literal|2
index|]
operator|=
name|point
index|[
literal|2
index|]
operator|+
literal|345.678
expr_stmt|;
name|t
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|freq
operator|=
name|lofreq
init|;
name|freq
operator|<
name|hifreq
condition|;
name|freq
operator|*=
literal|2.
control|)
block|{
name|t
operator|+=
name|noise3
argument_list|(
name|p
argument_list|)
operator|/
name|freq
expr_stmt|;
name|p
index|[
literal|0
index|]
operator|*=
literal|2.
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|*=
literal|2.
expr_stmt|;
name|p
index|[
literal|2
index|]
operator|*=
literal|2.
expr_stmt|;
block|}
return|return
name|t
operator|-
literal|0.3
return|;
comment|/* readjust to make mean value = 0.0 */
block|}
end_function

begin_decl_stmt
DECL|variable|camera
name|struct
name|camera_t
name|camera
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|world
name|struct
name|world_t
name|world
decl_stmt|;
end_decl_stmt

begin_function
DECL|function|vcopy (vector * a,vector * b)
specifier|inline
name|void
name|vcopy
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|a
operator|->
name|x
operator|=
name|b
operator|->
name|x
expr_stmt|;
name|a
operator|->
name|y
operator|=
name|b
operator|->
name|y
expr_stmt|;
name|a
operator|->
name|z
operator|=
name|b
operator|->
name|z
expr_stmt|;
name|a
operator|->
name|w
operator|=
name|b
operator|->
name|w
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vcross (vector * r,vector * a,vector * b)
specifier|inline
name|void
name|vcross
parameter_list|(
name|vector
modifier|*
name|r
parameter_list|,
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|vector
name|t
decl_stmt|;
name|t
operator|.
name|x
operator|=
name|a
operator|->
name|y
operator|*
name|b
operator|->
name|z
operator|-
name|a
operator|->
name|z
operator|*
name|b
operator|->
name|y
expr_stmt|;
name|t
operator|.
name|y
operator|=
operator|-
operator|(
name|a
operator|->
name|x
operator|*
name|b
operator|->
name|z
operator|-
name|a
operator|->
name|z
operator|*
name|b
operator|->
name|x
operator|)
expr_stmt|;
name|t
operator|.
name|z
operator|=
name|a
operator|->
name|x
operator|*
name|b
operator|->
name|y
operator|-
name|a
operator|->
name|y
operator|*
name|b
operator|->
name|x
expr_stmt|;
name|vcopy
argument_list|(
name|r
argument_list|,
operator|&
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vdot (vector * a,vector * b)
specifier|inline
name|double
name|vdot
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|double
name|s
decl_stmt|;
name|s
operator|=
name|a
operator|->
name|x
operator|*
name|b
operator|->
name|x
expr_stmt|;
name|s
operator|+=
name|a
operator|->
name|y
operator|*
name|b
operator|->
name|y
expr_stmt|;
name|s
operator|+=
name|a
operator|->
name|z
operator|*
name|b
operator|->
name|z
expr_stmt|;
return|return
name|s
return|;
block|}
end_function

begin_function
DECL|function|vdist (vector * a,vector * b)
specifier|inline
name|double
name|vdist
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|double
name|x
decl_stmt|,
name|y
decl_stmt|,
name|z
decl_stmt|;
name|x
operator|=
name|a
operator|->
name|x
operator|-
name|b
operator|->
name|x
expr_stmt|;
name|y
operator|=
name|a
operator|->
name|y
operator|-
name|b
operator|->
name|y
expr_stmt|;
name|z
operator|=
name|a
operator|->
name|z
operator|-
name|b
operator|->
name|z
expr_stmt|;
return|return
name|sqrt
argument_list|(
name|x
operator|*
name|x
operator|+
name|y
operator|*
name|y
operator|+
name|z
operator|*
name|z
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|vlen (vector * a)
specifier|inline
name|double
name|vlen
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|)
block|{
name|double
name|l
decl_stmt|;
name|l
operator|=
name|sqrt
argument_list|(
name|a
operator|->
name|x
operator|*
name|a
operator|->
name|x
operator|+
name|a
operator|->
name|y
operator|*
name|a
operator|->
name|y
operator|+
name|a
operator|->
name|z
operator|*
name|a
operator|->
name|z
argument_list|)
expr_stmt|;
return|return
name|l
return|;
block|}
end_function

begin_function
DECL|function|vnorm (vector * a,double v)
specifier|inline
name|void
name|vnorm
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|double
name|v
parameter_list|)
block|{
name|double
name|d
decl_stmt|;
name|d
operator|=
name|sqrt
argument_list|(
name|a
operator|->
name|x
operator|*
name|a
operator|->
name|x
operator|+
name|a
operator|->
name|y
operator|*
name|a
operator|->
name|y
operator|+
name|a
operator|->
name|z
operator|*
name|a
operator|->
name|z
argument_list|)
expr_stmt|;
name|a
operator|->
name|x
operator|*=
name|v
operator|/
name|d
expr_stmt|;
name|a
operator|->
name|y
operator|*=
name|v
operator|/
name|d
expr_stmt|;
name|a
operator|->
name|z
operator|*=
name|v
operator|/
name|d
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vrotate (vector * axis,double ang,vector * vector)
specifier|inline
name|void
name|vrotate
parameter_list|(
name|vector
modifier|*
name|axis
parameter_list|,
name|double
name|ang
parameter_list|,
name|vector
modifier|*
name|vector
parameter_list|)
block|{
name|double
name|rad
init|=
name|ang
operator|/
literal|180.0
operator|*
name|G_PI
decl_stmt|;
name|double
name|ax
init|=
name|vector
operator|->
name|x
decl_stmt|;
name|double
name|ay
init|=
name|vector
operator|->
name|y
decl_stmt|;
name|double
name|az
init|=
name|vector
operator|->
name|z
decl_stmt|;
name|double
name|x
init|=
name|axis
operator|->
name|x
decl_stmt|;
name|double
name|y
init|=
name|axis
operator|->
name|y
decl_stmt|;
name|double
name|z
init|=
name|axis
operator|->
name|z
decl_stmt|;
name|double
name|c
init|=
name|cos
argument_list|(
name|rad
argument_list|)
decl_stmt|;
name|double
name|s
init|=
name|sin
argument_list|(
name|rad
argument_list|)
decl_stmt|;
name|double
name|c1
init|=
literal|1.0
operator|-
name|c
decl_stmt|;
name|double
name|xx
init|=
name|c1
operator|*
name|x
operator|*
name|x
decl_stmt|;
name|double
name|yy
init|=
name|c1
operator|*
name|y
operator|*
name|y
decl_stmt|;
name|double
name|zz
init|=
name|c1
operator|*
name|z
operator|*
name|z
decl_stmt|;
name|double
name|xy
init|=
name|c1
operator|*
name|x
operator|*
name|y
decl_stmt|;
name|double
name|xz
init|=
name|c1
operator|*
name|x
operator|*
name|z
decl_stmt|;
name|double
name|yz
init|=
name|c1
operator|*
name|y
operator|*
name|z
decl_stmt|;
name|double
name|sx
init|=
name|s
operator|*
name|x
decl_stmt|;
name|double
name|sy
init|=
name|s
operator|*
name|y
decl_stmt|;
name|double
name|sz
init|=
name|s
operator|*
name|z
decl_stmt|;
name|vector
operator|->
name|x
operator|=
operator|(
name|xx
operator|+
name|c
operator|)
operator|*
name|ax
operator|+
operator|(
name|xy
operator|+
name|sz
operator|)
operator|*
name|ay
operator|+
operator|(
name|xz
operator|-
name|sy
operator|)
operator|*
name|az
expr_stmt|;
name|vector
operator|->
name|y
operator|=
operator|(
name|xy
operator|-
name|sz
operator|)
operator|*
name|ax
operator|+
operator|(
name|yy
operator|+
name|c
operator|)
operator|*
name|ay
operator|+
operator|(
name|yz
operator|+
name|sx
operator|)
operator|*
name|az
expr_stmt|;
name|vector
operator|->
name|z
operator|=
operator|(
name|xz
operator|+
name|sy
operator|)
operator|*
name|ax
operator|+
operator|(
name|yz
operator|-
name|sx
operator|)
operator|*
name|ay
operator|+
operator|(
name|zz
operator|+
name|c
operator|)
operator|*
name|az
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vset (vector * v,double a,double b,double c)
specifier|inline
name|void
name|vset
parameter_list|(
name|vector
modifier|*
name|v
parameter_list|,
name|double
name|a
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|c
parameter_list|)
block|{
name|v
operator|->
name|x
operator|=
name|a
expr_stmt|;
name|v
operator|->
name|y
operator|=
name|b
expr_stmt|;
name|v
operator|->
name|z
operator|=
name|c
expr_stmt|;
name|v
operator|->
name|w
operator|=
literal|1.0
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vcset (vector * v,double a,double b,double c,double d)
specifier|inline
name|void
name|vcset
parameter_list|(
name|vector
modifier|*
name|v
parameter_list|,
name|double
name|a
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|c
parameter_list|,
name|double
name|d
parameter_list|)
block|{
name|v
operator|->
name|x
operator|=
name|a
expr_stmt|;
name|v
operator|->
name|y
operator|=
name|b
expr_stmt|;
name|v
operator|->
name|z
operator|=
name|c
expr_stmt|;
name|v
operator|->
name|w
operator|=
name|d
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vvrotate (vector * p,vector * rot)
specifier|inline
name|void
name|vvrotate
parameter_list|(
name|vector
modifier|*
name|p
parameter_list|,
name|vector
modifier|*
name|rot
parameter_list|)
block|{
name|vector
name|axis
decl_stmt|;
if|if
condition|(
name|rot
operator|->
name|x
operator|!=
literal|0.0
condition|)
block|{
name|vset
argument_list|(
operator|&
name|axis
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vrotate
argument_list|(
operator|&
name|axis
argument_list|,
name|rot
operator|->
name|x
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|rot
operator|->
name|y
operator|!=
literal|0.0
condition|)
block|{
name|vset
argument_list|(
operator|&
name|axis
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vrotate
argument_list|(
operator|&
name|axis
argument_list|,
name|rot
operator|->
name|y
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|rot
operator|->
name|z
operator|!=
literal|0.0
condition|)
block|{
name|vset
argument_list|(
operator|&
name|axis
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vrotate
argument_list|(
operator|&
name|axis
argument_list|,
name|rot
operator|->
name|z
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|vsub (vector * a,vector * b)
specifier|inline
name|void
name|vsub
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|a
operator|->
name|x
operator|-=
name|b
operator|->
name|x
expr_stmt|;
name|a
operator|->
name|y
operator|-=
name|b
operator|->
name|y
expr_stmt|;
name|a
operator|->
name|z
operator|-=
name|b
operator|->
name|z
expr_stmt|;
name|a
operator|->
name|w
operator|-=
name|b
operator|->
name|w
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vadd (vector * a,vector * b)
specifier|inline
name|void
name|vadd
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|a
operator|->
name|x
operator|+=
name|b
operator|->
name|x
expr_stmt|;
name|a
operator|->
name|y
operator|+=
name|b
operator|->
name|y
expr_stmt|;
name|a
operator|->
name|z
operator|+=
name|b
operator|->
name|z
expr_stmt|;
name|a
operator|->
name|w
operator|+=
name|b
operator|->
name|w
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vneg (vector * a)
specifier|inline
name|void
name|vneg
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|)
block|{
name|a
operator|->
name|x
operator|=
operator|-
name|a
operator|->
name|x
expr_stmt|;
name|a
operator|->
name|y
operator|=
operator|-
name|a
operator|->
name|y
expr_stmt|;
name|a
operator|->
name|z
operator|=
operator|-
name|a
operator|->
name|z
expr_stmt|;
name|a
operator|->
name|w
operator|=
operator|-
name|a
operator|->
name|w
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vmul (vector * v,double a)
specifier|inline
name|void
name|vmul
parameter_list|(
name|vector
modifier|*
name|v
parameter_list|,
name|double
name|a
parameter_list|)
block|{
name|v
operator|->
name|x
operator|*=
name|a
expr_stmt|;
name|v
operator|->
name|y
operator|*=
name|a
expr_stmt|;
name|v
operator|->
name|z
operator|*=
name|a
expr_stmt|;
name|v
operator|->
name|w
operator|*=
name|a
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vvmul (vector * a,vector * b)
specifier|inline
name|void
name|vvmul
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|a
operator|->
name|x
operator|*=
name|b
operator|->
name|x
expr_stmt|;
name|a
operator|->
name|y
operator|*=
name|b
operator|->
name|y
expr_stmt|;
name|a
operator|->
name|z
operator|*=
name|b
operator|->
name|z
expr_stmt|;
name|a
operator|->
name|w
operator|*=
name|b
operator|->
name|w
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vvdiv (vector * a,vector * b)
specifier|inline
name|void
name|vvdiv
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|)
block|{
name|a
operator|->
name|x
operator|/=
name|b
operator|->
name|x
expr_stmt|;
name|a
operator|->
name|y
operator|/=
name|b
operator|->
name|y
expr_stmt|;
name|a
operator|->
name|z
operator|/=
name|b
operator|->
name|z
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vmix (vector * r,vector * a,vector * b,double v)
name|void
name|vmix
parameter_list|(
name|vector
modifier|*
name|r
parameter_list|,
name|vector
modifier|*
name|a
parameter_list|,
name|vector
modifier|*
name|b
parameter_list|,
name|double
name|v
parameter_list|)
block|{
name|double
name|i
init|=
literal|1.0
operator|-
name|v
decl_stmt|;
name|r
operator|->
name|x
operator|=
name|a
operator|->
name|x
operator|*
name|v
operator|+
name|b
operator|->
name|x
operator|*
name|i
expr_stmt|;
name|r
operator|->
name|y
operator|=
name|a
operator|->
name|y
operator|*
name|v
operator|+
name|b
operator|->
name|y
operator|*
name|i
expr_stmt|;
name|r
operator|->
name|z
operator|=
name|a
operator|->
name|z
operator|*
name|v
operator|+
name|b
operator|->
name|z
operator|*
name|i
expr_stmt|;
name|r
operator|->
name|w
operator|=
name|a
operator|->
name|w
operator|*
name|v
operator|+
name|b
operator|->
name|w
operator|*
name|i
expr_stmt|;
block|}
end_function

begin_function
DECL|function|vmax (vector * a)
name|double
name|vmax
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|)
block|{
name|double
name|max
init|=
name|fabs
argument_list|(
name|a
operator|->
name|x
argument_list|)
decl_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|a
operator|->
name|y
argument_list|)
operator|>
name|max
condition|)
name|max
operator|=
name|fabs
argument_list|(
name|a
operator|->
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|a
operator|->
name|z
argument_list|)
operator|>
name|max
condition|)
name|max
operator|=
name|fabs
argument_list|(
name|a
operator|->
name|z
argument_list|)
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|a
operator|->
name|w
argument_list|)
operator|>
name|max
condition|)
name|max
operator|=
name|fabs
argument_list|(
name|a
operator|->
name|w
argument_list|)
expr_stmt|;
return|return
name|max
return|;
block|}
end_function

begin_function
DECL|function|vavg (vector * a)
name|void
name|vavg
parameter_list|(
name|vector
modifier|*
name|a
parameter_list|)
block|{
name|double
name|s
init|=
operator|(
name|a
operator|->
name|x
operator|+
name|a
operator|->
name|y
operator|+
name|a
operator|->
name|z
operator|)
operator|/
literal|3.0
decl_stmt|;
name|a
operator|->
name|x
operator|=
name|a
operator|->
name|y
operator|=
name|a
operator|->
name|z
operator|=
name|s
expr_stmt|;
block|}
end_function

begin_function
DECL|function|trianglenormal (vector * n,double * t,triangle * tri)
name|void
name|trianglenormal
parameter_list|(
name|vector
modifier|*
name|n
parameter_list|,
name|double
modifier|*
name|t
parameter_list|,
name|triangle
modifier|*
name|tri
parameter_list|)
block|{
name|triangle
name|tmp
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|tmp
operator|.
name|b
argument_list|,
operator|&
name|tri
operator|->
name|b
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|tmp
operator|.
name|c
argument_list|,
operator|&
name|tri
operator|->
name|c
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|tmp
operator|.
name|b
argument_list|,
operator|&
name|tri
operator|->
name|a
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|tmp
operator|.
name|c
argument_list|,
operator|&
name|tri
operator|->
name|a
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|tmp
operator|.
name|a
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vcross
argument_list|(
name|n
argument_list|,
operator|&
name|tmp
operator|.
name|b
argument_list|,
operator|&
name|tmp
operator|.
name|c
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
condition|)
operator|*
name|t
operator|=
name|vdot
argument_list|(
operator|&
name|tmp
operator|.
name|b
argument_list|,
operator|&
name|tmp
operator|.
name|c
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|checkdisc (ray * r,disc * disc)
name|double
name|checkdisc
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|disc
modifier|*
name|disc
parameter_list|)
block|{
name|vector
name|p
decl_stmt|,
modifier|*
name|v
init|=
operator|&
name|disc
operator|->
name|a
decl_stmt|;
name|double
name|t
decl_stmt|,
name|d
decl_stmt|;
name|double
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|;
name|i
operator|=
name|r
operator|->
name|v2
operator|.
name|x
operator|-
name|r
operator|->
name|v1
operator|.
name|x
expr_stmt|;
name|j
operator|=
name|r
operator|->
name|v2
operator|.
name|y
operator|-
name|r
operator|->
name|v1
operator|.
name|y
expr_stmt|;
name|k
operator|=
name|r
operator|->
name|v2
operator|.
name|z
operator|-
name|r
operator|->
name|v1
operator|.
name|z
expr_stmt|;
name|t
operator|=
operator|-
operator|(
name|v
operator|->
name|x
operator|*
name|r
operator|->
name|v1
operator|.
name|x
operator|+
name|v
operator|->
name|y
operator|*
name|r
operator|->
name|v1
operator|.
name|y
operator|+
name|v
operator|->
name|z
operator|*
name|r
operator|->
name|v1
operator|.
name|z
operator|-
name|disc
operator|->
name|b
operator|)
operator|/
operator|(
name|v
operator|->
name|x
operator|*
name|i
operator|+
name|v
operator|->
name|y
operator|*
name|j
operator|+
name|v
operator|->
name|z
operator|*
name|k
operator|)
expr_stmt|;
name|p
operator|.
name|x
operator|=
name|r
operator|->
name|v1
operator|.
name|x
operator|+
name|i
operator|*
name|t
expr_stmt|;
name|p
operator|.
name|y
operator|=
name|r
operator|->
name|v1
operator|.
name|y
operator|+
name|j
operator|*
name|t
expr_stmt|;
name|p
operator|.
name|z
operator|=
name|r
operator|->
name|v1
operator|.
name|z
operator|+
name|k
operator|*
name|t
expr_stmt|;
name|d
operator|=
name|vdist
argument_list|(
operator|&
name|p
argument_list|,
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|>
name|disc
operator|->
name|r
condition|)
name|t
operator|=
literal|0.0
expr_stmt|;
return|return
name|t
return|;
block|}
end_function

begin_function
DECL|function|checksphere (ray * r,sphere * sphere)
name|double
name|checksphere
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|sphere
modifier|*
name|sphere
parameter_list|)
block|{
name|vector
name|cendir
decl_stmt|,
name|rdir
decl_stmt|;
name|double
name|dirproj
decl_stmt|,
name|cdlensq
decl_stmt|;
name|double
name|linear
decl_stmt|,
name|constant
decl_stmt|,
name|rsq
decl_stmt|,
name|quadratic
decl_stmt|,
name|discriminant
decl_stmt|;
name|double
name|smallzero
decl_stmt|,
name|solmin
decl_stmt|,
name|solmax
decl_stmt|,
name|tolerance
init|=
literal|0.001
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|rdir
argument_list|,
operator|&
name|r
operator|->
name|v2
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|rdir
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|rsq
operator|=
name|sphere
operator|->
name|r
operator|*
name|sphere
operator|->
name|r
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|cendir
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|cendir
argument_list|,
operator|&
name|sphere
operator|->
name|a
argument_list|)
expr_stmt|;
name|dirproj
operator|=
name|vdot
argument_list|(
operator|&
name|rdir
argument_list|,
operator|&
name|cendir
argument_list|)
expr_stmt|;
name|cdlensq
operator|=
name|vdot
argument_list|(
operator|&
name|cendir
argument_list|,
operator|&
name|cendir
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|cdlensq
operator|>=
name|rsq
operator|)
operator|&&
operator|(
name|dirproj
operator|>
literal|0.0
operator|)
condition|)
return|return
literal|0.0
return|;
name|linear
operator|=
literal|2.0
operator|*
name|dirproj
expr_stmt|;
name|constant
operator|=
name|cdlensq
operator|-
name|rsq
expr_stmt|;
name|quadratic
operator|=
name|vdot
argument_list|(
operator|&
name|rdir
argument_list|,
operator|&
name|rdir
argument_list|)
expr_stmt|;
name|smallzero
operator|=
operator|(
name|constant
operator|/
name|linear
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|smallzero
operator|<
name|tolerance
operator|)
operator|&&
operator|(
name|smallzero
operator|>
operator|-
name|tolerance
operator|)
condition|)
block|{
name|solmin
operator|=
operator|-
name|linear
operator|/
name|quadratic
expr_stmt|;
if|if
condition|(
name|solmin
operator|>
name|tolerance
condition|)
block|{
return|return
name|solmin
return|;
comment|/*       *hits = solmin;       return 1;       */
block|}
else|else
return|return
literal|0.0
return|;
block|}
name|discriminant
operator|=
name|linear
operator|*
name|linear
operator|-
literal|4.0
operator|*
name|quadratic
operator|*
name|constant
expr_stmt|;
if|if
condition|(
name|discriminant
operator|<
literal|0.0
condition|)
return|return
literal|0.0
return|;
name|quadratic
operator|*=
literal|2.0
expr_stmt|;
name|discriminant
operator|=
name|sqrt
argument_list|(
name|discriminant
argument_list|)
expr_stmt|;
name|solmax
operator|=
operator|(
operator|-
name|linear
operator|+
name|discriminant
operator|)
operator|/
operator|(
name|quadratic
operator|)
expr_stmt|;
name|solmin
operator|=
operator|(
operator|-
name|linear
operator|-
name|discriminant
operator|)
operator|/
operator|(
name|quadratic
operator|)
expr_stmt|;
if|if
condition|(
name|solmax
operator|<
name|tolerance
condition|)
return|return
literal|0.0
return|;
if|if
condition|(
name|solmin
operator|<
name|tolerance
condition|)
block|{
return|return
name|solmax
return|;
comment|/*     *hits = solmax;     return 1;     */
block|}
else|else
block|{
return|return
name|solmin
return|;
comment|/*     *hits++ = solmin;     *hits = solmax;     return 2;     */
block|}
block|}
end_function

begin_function
DECL|function|checkcylinder (ray * r,cylinder * cylinder)
name|double
name|checkcylinder
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|cylinder
modifier|*
name|cylinder
parameter_list|)
block|{
comment|/* fixme */
return|return
literal|0
return|;
block|}
end_function

begin_function
DECL|function|checkplane (ray * r,plane * plane)
name|double
name|checkplane
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|plane
modifier|*
name|plane
parameter_list|)
block|{
name|vector
modifier|*
name|v
init|=
operator|&
name|plane
operator|->
name|a
decl_stmt|;
name|double
name|t
decl_stmt|;
name|double
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|;
name|i
operator|=
name|r
operator|->
name|v2
operator|.
name|x
operator|-
name|r
operator|->
name|v1
operator|.
name|x
expr_stmt|;
name|j
operator|=
name|r
operator|->
name|v2
operator|.
name|y
operator|-
name|r
operator|->
name|v1
operator|.
name|y
expr_stmt|;
name|k
operator|=
name|r
operator|->
name|v2
operator|.
name|z
operator|-
name|r
operator|->
name|v1
operator|.
name|z
expr_stmt|;
name|t
operator|=
operator|-
operator|(
name|v
operator|->
name|x
operator|*
name|r
operator|->
name|v1
operator|.
name|x
operator|+
name|v
operator|->
name|y
operator|*
name|r
operator|->
name|v1
operator|.
name|y
operator|+
name|v
operator|->
name|z
operator|*
name|r
operator|->
name|v1
operator|.
name|z
operator|-
name|plane
operator|->
name|b
operator|)
operator|/
operator|(
name|v
operator|->
name|x
operator|*
name|i
operator|+
name|v
operator|->
name|y
operator|*
name|j
operator|+
name|v
operator|->
name|z
operator|*
name|k
operator|)
expr_stmt|;
return|return
name|t
return|;
block|}
end_function

begin_function
DECL|function|checktri (ray * r,triangle * tri)
name|double
name|checktri
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|triangle
modifier|*
name|tri
parameter_list|)
block|{
name|vector
name|ed1
decl_stmt|,
name|ed2
decl_stmt|;
name|vector
name|tvec
decl_stmt|,
name|pvec
decl_stmt|,
name|qvec
decl_stmt|;
name|double
name|det
decl_stmt|,
name|idet
decl_stmt|,
name|t
decl_stmt|,
name|u
decl_stmt|,
name|v
decl_stmt|;
name|vector
modifier|*
name|orig
decl_stmt|,
name|dir
decl_stmt|;
name|orig
operator|=
operator|&
name|r
operator|->
name|v1
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|dir
argument_list|,
operator|&
name|r
operator|->
name|v2
argument_list|,
sizeof|sizeof
argument_list|(
name|vector
argument_list|)
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|dir
argument_list|,
name|orig
argument_list|)
expr_stmt|;
name|ed1
operator|.
name|x
operator|=
name|tri
operator|->
name|c
operator|.
name|x
operator|-
name|tri
operator|->
name|a
operator|.
name|x
expr_stmt|;
name|ed1
operator|.
name|y
operator|=
name|tri
operator|->
name|c
operator|.
name|y
operator|-
name|tri
operator|->
name|a
operator|.
name|y
expr_stmt|;
name|ed1
operator|.
name|z
operator|=
name|tri
operator|->
name|c
operator|.
name|z
operator|-
name|tri
operator|->
name|a
operator|.
name|z
expr_stmt|;
name|ed2
operator|.
name|x
operator|=
name|tri
operator|->
name|b
operator|.
name|x
operator|-
name|tri
operator|->
name|a
operator|.
name|x
expr_stmt|;
name|ed2
operator|.
name|y
operator|=
name|tri
operator|->
name|b
operator|.
name|y
operator|-
name|tri
operator|->
name|a
operator|.
name|y
expr_stmt|;
name|ed2
operator|.
name|z
operator|=
name|tri
operator|->
name|b
operator|.
name|z
operator|-
name|tri
operator|->
name|a
operator|.
name|z
expr_stmt|;
name|vcross
argument_list|(
operator|&
name|pvec
argument_list|,
operator|&
name|dir
argument_list|,
operator|&
name|ed2
argument_list|)
expr_stmt|;
name|det
operator|=
name|vdot
argument_list|(
operator|&
name|ed1
argument_list|,
operator|&
name|pvec
argument_list|)
expr_stmt|;
name|idet
operator|=
literal|1.0
operator|/
name|det
expr_stmt|;
name|tvec
operator|.
name|x
operator|=
name|orig
operator|->
name|x
expr_stmt|;
name|tvec
operator|.
name|y
operator|=
name|orig
operator|->
name|y
expr_stmt|;
name|tvec
operator|.
name|z
operator|=
name|orig
operator|->
name|z
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|tvec
argument_list|,
operator|&
name|tri
operator|->
name|a
argument_list|)
expr_stmt|;
name|u
operator|=
name|vdot
argument_list|(
operator|&
name|tvec
argument_list|,
operator|&
name|pvec
argument_list|)
operator|*
name|idet
expr_stmt|;
if|if
condition|(
name|u
operator|<
literal|0.0
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|u
operator|>
literal|1.0
condition|)
return|return
literal|0
return|;
name|vcross
argument_list|(
operator|&
name|qvec
argument_list|,
operator|&
name|tvec
argument_list|,
operator|&
name|ed1
argument_list|)
expr_stmt|;
name|v
operator|=
name|vdot
argument_list|(
operator|&
name|dir
argument_list|,
operator|&
name|qvec
argument_list|)
operator|*
name|idet
expr_stmt|;
if|if
condition|(
operator|(
name|v
operator|<
literal|0.0
operator|)
operator|||
operator|(
name|u
operator|+
name|v
operator|>
literal|1.0
operator|)
condition|)
return|return
literal|0
return|;
name|t
operator|=
name|vdot
argument_list|(
operator|&
name|ed2
argument_list|,
operator|&
name|qvec
argument_list|)
operator|*
name|idet
expr_stmt|;
return|return
name|t
return|;
block|}
end_function

begin_function_decl
name|double
name|turbulence
parameter_list|(
name|double
modifier|*
name|point
parameter_list|,
name|double
name|lofreq
parameter_list|,
name|double
name|hifreq
parameter_list|)
function_decl|;
end_function_decl

begin_function
DECL|function|transformpoint (vector * p,texture * t)
name|void
name|transformpoint
parameter_list|(
name|vector
modifier|*
name|p
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|double
name|point
index|[
literal|3
index|]
decl_stmt|,
name|f
decl_stmt|;
if|if
condition|(
operator|(
name|t
operator|->
name|rotate
operator|.
name|x
operator|!=
literal|0.0
operator|)
operator|||
operator|(
name|t
operator|->
name|rotate
operator|.
name|y
operator|!=
literal|0.0
operator|)
operator|||
operator|(
name|t
operator|->
name|rotate
operator|.
name|z
operator|!=
literal|0.0
operator|)
condition|)
name|vvrotate
argument_list|(
name|p
argument_list|,
operator|&
name|t
operator|->
name|rotate
argument_list|)
expr_stmt|;
name|vvdiv
argument_list|(
name|p
argument_list|,
operator|&
name|t
operator|->
name|scale
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
name|p
argument_list|,
operator|&
name|t
operator|->
name|translate
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|t
operator|->
name|turbulence
operator|.
name|x
operator|!=
literal|0.0
operator|)
operator|||
operator|(
name|t
operator|->
name|turbulence
operator|.
name|y
operator|!=
literal|0.0
operator|)
operator|||
operator|(
name|t
operator|->
name|turbulence
operator|.
name|z
operator|!=
literal|0.0
operator|)
condition|)
block|{
name|point
index|[
literal|0
index|]
operator|=
name|p
operator|->
name|x
expr_stmt|;
name|point
index|[
literal|1
index|]
operator|=
name|p
operator|->
name|y
expr_stmt|;
name|point
index|[
literal|2
index|]
operator|=
name|p
operator|->
name|z
expr_stmt|;
name|f
operator|=
name|turbulence
argument_list|(
name|point
argument_list|,
literal|1
argument_list|,
literal|256
argument_list|)
expr_stmt|;
name|p
operator|->
name|x
operator|+=
name|t
operator|->
name|turbulence
operator|.
name|x
operator|*
name|f
expr_stmt|;
name|p
operator|->
name|y
operator|+=
name|t
operator|->
name|turbulence
operator|.
name|y
operator|*
name|f
expr_stmt|;
name|p
operator|->
name|z
operator|+=
name|t
operator|->
name|turbulence
operator|.
name|z
operator|*
name|f
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|checker (vector * q,vector * col,texture * t)
name|void
name|checker
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|int
name|c
init|=
literal|0
decl_stmt|;
name|vector
name|p
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|p
argument_list|,
literal|0.25
argument_list|)
expr_stmt|;
name|p
operator|.
name|x
operator|+=
literal|0.00001
expr_stmt|;
name|p
operator|.
name|y
operator|+=
literal|0.00001
expr_stmt|;
name|p
operator|.
name|z
operator|+=
literal|0.00001
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|x
operator|<
literal|0.0
condition|)
name|p
operator|.
name|x
operator|=
literal|0.5
operator|-
name|p
operator|.
name|x
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|y
operator|<
literal|0.0
condition|)
name|p
operator|.
name|y
operator|=
literal|0.5
operator|-
name|p
operator|.
name|y
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|z
operator|<
literal|0.0
condition|)
name|p
operator|.
name|z
operator|=
literal|0.5
operator|-
name|p
operator|.
name|z
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|.
name|x
operator|-
operator|(
name|int
operator|)
name|p
operator|.
name|x
operator|)
operator|<
literal|0.5
condition|)
name|c
operator|^=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|.
name|y
operator|-
operator|(
name|int
operator|)
name|p
operator|.
name|y
operator|)
operator|<
literal|0.5
condition|)
name|c
operator|^=
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|.
name|z
operator|-
operator|(
name|int
operator|)
name|p
operator|.
name|z
operator|)
operator|<
literal|0.5
condition|)
name|c
operator|^=
literal|1
expr_stmt|;
if|if
condition|(
name|c
condition|)
block|{
name|vcopy
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|vcopy
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color2
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|gradcolor (vector * col,gradient * t,double val)
name|void
name|gradcolor
parameter_list|(
name|vector
modifier|*
name|col
parameter_list|,
name|gradient
modifier|*
name|t
parameter_list|,
name|double
name|val
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|double
name|d
decl_stmt|;
name|vector
name|tmpcol
decl_stmt|;
if|if
condition|(
name|val
operator|<
literal|0.0
condition|)
name|val
operator|=
literal|0.0
expr_stmt|;
if|if
condition|(
name|val
operator|>
literal|1.0
condition|)
name|val
operator|=
literal|1.0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|t
operator|->
name|numcol
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|t
operator|->
name|pos
index|[
name|i
index|]
operator|==
name|val
condition|)
block|{
name|vcopy
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color
index|[
name|i
index|]
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|t
operator|->
name|pos
index|[
name|i
index|]
operator|>
name|val
condition|)
block|{
name|d
operator|=
operator|(
name|val
operator|-
name|t
operator|->
name|pos
index|[
name|i
operator|-
literal|1
index|]
operator|)
operator|/
operator|(
name|t
operator|->
name|pos
index|[
name|i
index|]
operator|-
name|t
operator|->
name|pos
index|[
name|i
operator|-
literal|1
index|]
operator|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|tmpcol
argument_list|,
operator|&
name|t
operator|->
name|color
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|tmpcol
argument_list|,
name|d
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
name|col
argument_list|,
operator|&
name|tmpcol
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|tmpcol
argument_list|,
operator|&
name|t
operator|->
name|color
index|[
name|i
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|tmpcol
argument_list|,
literal|1.0
operator|-
name|d
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|tmpcol
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Error in gradient!\n"
argument_list|)
expr_stmt|;
name|vset
argument_list|(
name|col
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|marble (vector * q,vector * col,texture * t)
name|void
name|marble
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|double
name|f
decl_stmt|;
name|vector
name|p
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|f
operator|=
name|sin
argument_list|(
name|p
operator|.
name|x
operator|*
literal|4
argument_list|)
operator|/
literal|2
operator|+
literal|0.5
expr_stmt|;
name|f
operator|=
name|pow
argument_list|(
name|f
argument_list|,
name|t
operator|->
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|flags
operator|&
name|GRADIENT
condition|)
name|gradcolor
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|gradient
argument_list|,
name|f
argument_list|)
expr_stmt|;
else|else
name|vmix
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|,
operator|&
name|t
operator|->
name|color2
argument_list|,
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|lizard (vector * q,vector * col,texture * t)
name|void
name|lizard
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|double
name|f
decl_stmt|;
name|vector
name|p
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|f
operator|=
name|fabs
argument_list|(
name|sin
argument_list|(
name|p
operator|.
name|x
operator|*
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|f
operator|+=
name|fabs
argument_list|(
name|sin
argument_list|(
name|p
operator|.
name|y
operator|*
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|f
operator|+=
name|fabs
argument_list|(
name|sin
argument_list|(
name|p
operator|.
name|z
operator|*
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|f
operator|/=
literal|3.0
expr_stmt|;
name|f
operator|=
name|pow
argument_list|(
name|f
argument_list|,
name|t
operator|->
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|flags
operator|&
name|GRADIENT
condition|)
name|gradcolor
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|gradient
argument_list|,
name|f
argument_list|)
expr_stmt|;
else|else
name|vmix
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|,
operator|&
name|t
operator|->
name|color2
argument_list|,
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|wood (vector * q,vector * col,texture * t)
name|void
name|wood
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|double
name|f
decl_stmt|;
name|vector
name|p
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|f
operator|=
name|fabs
argument_list|(
name|p
operator|.
name|x
argument_list|)
expr_stmt|;
name|f
operator|=
name|f
operator|-
operator|(
name|int
operator|)
name|f
expr_stmt|;
name|f
operator|=
name|pow
argument_list|(
name|f
argument_list|,
name|t
operator|->
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|flags
operator|&
name|GRADIENT
condition|)
name|gradcolor
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|gradient
argument_list|,
name|f
argument_list|)
expr_stmt|;
else|else
name|vmix
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|,
operator|&
name|t
operator|->
name|color2
argument_list|,
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|spiral (vector * q,vector * col,texture * t)
name|void
name|spiral
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|double
name|f
decl_stmt|;
name|vector
name|p
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|f
operator|=
name|fabs
argument_list|(
name|atan2
argument_list|(
name|p
operator|.
name|x
argument_list|,
name|p
operator|.
name|z
argument_list|)
operator|/
name|G_PI
operator|/
literal|2
operator|+
name|p
operator|.
name|y
operator|+
literal|99999
argument_list|)
expr_stmt|;
name|f
operator|=
name|f
operator|-
operator|(
name|int
operator|)
name|f
expr_stmt|;
name|f
operator|=
name|pow
argument_list|(
name|f
argument_list|,
name|t
operator|->
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|flags
operator|&
name|GRADIENT
condition|)
name|gradcolor
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|gradient
argument_list|,
name|f
argument_list|)
expr_stmt|;
else|else
name|vmix
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|,
operator|&
name|t
operator|->
name|color2
argument_list|,
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|spots (vector * q,vector * col,texture * t)
name|void
name|spots
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|double
name|f
decl_stmt|;
name|vector
name|p
decl_stmt|,
name|r
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|p
operator|.
name|x
operator|+=
literal|10000.0
expr_stmt|;
name|p
operator|.
name|y
operator|+=
literal|10000.0
expr_stmt|;
name|p
operator|.
name|z
operator|+=
literal|10000.0
expr_stmt|;
name|vset
argument_list|(
operator|&
name|r
argument_list|,
call|(
name|int
call|)
argument_list|(
name|p
operator|.
name|x
operator|+
literal|0.5
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
name|p
operator|.
name|y
operator|+
literal|0.5
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
name|p
operator|.
name|z
operator|+
literal|0.5
argument_list|)
argument_list|)
expr_stmt|;
name|f
operator|=
name|vdist
argument_list|(
operator|&
name|p
argument_list|,
operator|&
name|r
argument_list|)
expr_stmt|;
name|f
operator|=
name|cos
argument_list|(
name|f
operator|*
name|G_PI
argument_list|)
expr_stmt|;
if|if
condition|(
name|f
operator|<
literal|0.0
condition|)
name|f
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|f
operator|>
literal|1.0
condition|)
name|f
operator|=
literal|1.0
expr_stmt|;
name|f
operator|=
name|pow
argument_list|(
name|f
argument_list|,
name|t
operator|->
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|flags
operator|&
name|GRADIENT
condition|)
name|gradcolor
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|gradient
argument_list|,
name|f
argument_list|)
expr_stmt|;
else|else
name|vmix
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|,
operator|&
name|t
operator|->
name|color2
argument_list|,
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|perlin (vector * q,vector * col,texture * t)
name|void
name|perlin
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|double
name|f
decl_stmt|,
name|point
index|[
literal|3
index|]
decl_stmt|;
name|vector
name|p
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|point
index|[
literal|0
index|]
operator|=
name|p
operator|.
name|x
expr_stmt|;
name|point
index|[
literal|1
index|]
operator|=
name|p
operator|.
name|y
expr_stmt|;
name|point
index|[
literal|2
index|]
operator|=
name|p
operator|.
name|z
expr_stmt|;
name|f
operator|=
name|turbulence
argument_list|(
name|point
argument_list|,
literal|1
argument_list|,
literal|256
argument_list|)
operator|*
literal|0.3
operator|+
literal|0.5
expr_stmt|;
name|f
operator|=
name|pow
argument_list|(
name|f
argument_list|,
name|t
operator|->
name|exp
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|flags
operator|&
name|GRADIENT
condition|)
name|gradcolor
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|gradient
argument_list|,
name|f
argument_list|)
expr_stmt|;
else|else
name|vmix
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|,
operator|&
name|t
operator|->
name|color2
argument_list|,
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|imagepixel (vector * q,vector * col,texture * t)
name|void
name|imagepixel
parameter_list|(
name|vector
modifier|*
name|q
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|vector
name|p
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|unsigned
name|char
modifier|*
name|rgb
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|p
argument_list|,
name|q
argument_list|)
expr_stmt|;
name|transformpoint
argument_list|(
operator|&
name|p
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|x
operator|=
operator|(
name|p
operator|.
name|x
operator|*
name|t
operator|->
name|image
operator|.
name|xsize
operator|)
expr_stmt|;
name|y
operator|=
operator|(
name|p
operator|.
name|y
operator|*
name|t
operator|->
name|image
operator|.
name|ysize
operator|)
expr_stmt|;
name|x
operator|=
operator|(
name|x
operator|%
name|t
operator|->
name|image
operator|.
name|xsize
operator|+
name|t
operator|->
name|image
operator|.
name|xsize
operator|)
operator|%
name|t
operator|->
name|image
operator|.
name|xsize
expr_stmt|;
name|y
operator|=
operator|(
name|y
operator|%
name|t
operator|->
name|image
operator|.
name|ysize
operator|+
name|t
operator|->
name|image
operator|.
name|ysize
operator|)
operator|%
name|t
operator|->
name|image
operator|.
name|ysize
expr_stmt|;
name|rgb
operator|=
operator|&
name|t
operator|->
name|image
operator|.
name|rgb
index|[
name|x
operator|*
literal|3
operator|+
operator|(
name|t
operator|->
name|image
operator|.
name|ysize
operator|-
literal|1
operator|-
name|y
operator|)
operator|*
name|t
operator|->
name|image
operator|.
name|xsize
operator|*
literal|3
index|]
expr_stmt|;
name|vset
argument_list|(
name|col
argument_list|,
name|rgb
index|[
literal|0
index|]
operator|/
literal|255.0
argument_list|,
name|rgb
index|[
literal|1
index|]
operator|/
literal|255.0
argument_list|,
name|rgb
index|[
literal|2
index|]
operator|/
literal|255.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|frand (double v)
name|double
name|frand
parameter_list|(
name|double
name|v
parameter_list|)
block|{
return|return
operator|(
name|RAND_FUNC
argument_list|()
operator|/
operator|(
name|double
operator|)
name|G_MAXRAND
operator|-
literal|0.5
operator|)
operator|*
name|v
return|;
block|}
end_function

begin_function_decl
name|int
name|traceray
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|int
name|level
parameter_list|,
name|double
name|imp
parameter_list|)
function_decl|;
end_function_decl

begin_function
DECL|function|objcolor (vector * col,vector * p,common * obj)
name|void
name|objcolor
parameter_list|(
name|vector
modifier|*
name|col
parameter_list|,
name|vector
modifier|*
name|p
parameter_list|,
name|common
modifier|*
name|obj
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|texture
modifier|*
name|t
decl_stmt|;
name|vector
name|tmpcol
decl_stmt|;
name|vcset
argument_list|(
name|col
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|obj
operator|->
name|numtexture
condition|;
name|i
operator|++
control|)
block|{
name|t
operator|=
operator|&
name|obj
operator|->
name|texture
index|[
name|i
index|]
expr_stmt|;
if|if
condition|(
name|world
operator|.
name|quality
operator|<
literal|1
condition|)
block|{
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|vset
argument_list|(
operator|&
name|tmpcol
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|t
operator|->
name|type
condition|)
block|{
case|case
name|SOLID
case|:
name|vcopy
argument_list|(
operator|&
name|tmpcol
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|)
expr_stmt|;
break|break;
case|case
name|CHECKER
case|:
name|checker
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|MARBLE
case|:
name|marble
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|LIZARD
case|:
name|lizard
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|PERLIN
case|:
name|perlin
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|WOOD
case|:
name|wood
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPIRAL
case|:
name|spiral
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPOTS
case|:
name|spots
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|IMAGE
case|:
name|imagepixel
argument_list|(
name|p
argument_list|,
operator|&
name|tmpcol
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|PHONG
case|:
case|case
name|REFRACTION
case|:
case|case
name|REFLECTION
case|:
case|case
name|TRANSPARENT
case|:
case|case
name|SMOKE
case|:
comment|/* Silently ignore non-color textures */
continue|continue;
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Warning: unknown texture %d\n"
argument_list|,
name|t
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
name|vmul
argument_list|(
operator|&
name|tmpcol
argument_list|,
name|t
operator|->
name|amount
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|tmpcol
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Warning: object %p has no textures\n"
argument_list|,
name|obj
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|objnormal (vector * res,common * obj,vector * p)
name|void
name|objnormal
parameter_list|(
name|vector
modifier|*
name|res
parameter_list|,
name|common
modifier|*
name|obj
parameter_list|,
name|vector
modifier|*
name|p
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
switch|switch
condition|(
name|obj
operator|->
name|type
condition|)
block|{
case|case
name|TRIANGLE
case|:
name|trianglenormal
argument_list|(
name|res
argument_list|,
name|NULL
argument_list|,
operator|(
name|triangle
operator|*
operator|)
name|obj
argument_list|)
expr_stmt|;
break|break;
case|case
name|DISC
case|:
name|vcopy
argument_list|(
name|res
argument_list|,
operator|&
operator|(
operator|(
name|disc
operator|*
operator|)
name|obj
operator|)
operator|->
name|a
argument_list|)
expr_stmt|;
break|break;
case|case
name|PLANE
case|:
name|vcopy
argument_list|(
name|res
argument_list|,
operator|&
operator|(
operator|(
name|plane
operator|*
operator|)
name|obj
operator|)
operator|->
name|a
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPHERE
case|:
name|vcopy
argument_list|(
name|res
argument_list|,
operator|&
operator|(
operator|(
name|sphere
operator|*
operator|)
name|obj
operator|)
operator|->
name|a
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
name|res
argument_list|,
name|p
argument_list|)
expr_stmt|;
break|break;
case|case
name|CYLINDER
case|:
name|vset
argument_list|(
name|res
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* fixme */
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"objnormal(): Unsupported object type!?\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|vnorm
argument_list|(
name|res
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|obj
operator|->
name|numnormal
condition|;
name|i
operator|++
control|)
block|{
name|vector
name|tmpcol
index|[
literal|3
index|]
decl_stmt|;
name|vector
name|q
index|[
literal|3
index|]
decl_stmt|,
name|rot
init|=
block|{
literal|90
block|,
literal|90
block|,
literal|90
block|}
decl_stmt|;
name|texture
modifier|*
name|t
init|=
operator|&
name|obj
operator|->
name|normal
index|[
name|i
index|]
decl_stmt|;
name|double
name|nstep
init|=
literal|0.1
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
name|res
argument_list|)
expr_stmt|;
name|vvrotate
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|rot
argument_list|)
expr_stmt|;
name|vcross
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
name|res
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
name|nstep
argument_list|)
expr_stmt|;
name|vcross
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
name|res
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
name|nstep
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|t
operator|->
name|type
condition|)
block|{
case|case
name|MARBLE
case|:
name|marble
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|marble
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|marble
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|LIZARD
case|:
name|lizard
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|lizard
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|lizard
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|PERLIN
case|:
name|perlin
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|perlin
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|perlin
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|WOOD
case|:
name|wood
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|wood
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|wood
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPIRAL
case|:
name|spiral
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|spiral
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|spiral
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPOTS
case|:
name|spots
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|spots
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|spots
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|IMAGE
case|:
name|imagepixel
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|imagepixel
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|imagepixel
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
name|t
argument_list|)
expr_stmt|;
break|break;
case|case
name|CHECKER
case|:
case|case
name|SOLID
case|:
case|case
name|PHONG
case|:
case|case
name|REFRACTION
case|:
case|case
name|REFLECTION
case|:
case|case
name|TRANSPARENT
case|:
case|case
name|SMOKE
case|:
continue|continue;
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Warning: unknown texture %d\n"
argument_list|,
name|t
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
name|vavg
argument_list|(
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|vavg
argument_list|(
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|vavg
argument_list|(
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|q
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|q
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|q
index|[
literal|2
index|]
argument_list|,
operator|&
name|tmpcol
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|vcross
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
operator|&
name|q
index|[
literal|1
index|]
argument_list|,
operator|&
name|q
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|q
index|[
literal|0
index|]
argument_list|,
name|t
operator|->
name|amount
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|res
argument_list|,
operator|&
name|q
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
name|res
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*     Quality:    0 = Color only    1 = Textures    2 = Light + Normals    3 = Shadows    4 = Phong    5 = Reflection + Refraction  */
end_comment

begin_function
DECL|function|calclight (vector * col,vector * point,common * obj)
name|void
name|calclight
parameter_list|(
name|vector
modifier|*
name|col
parameter_list|,
name|vector
modifier|*
name|point
parameter_list|,
name|common
modifier|*
name|obj
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|o
decl_stmt|;
name|ray
name|r
decl_stmt|;
name|double
name|d
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|vector
name|lcol
decl_stmt|;
name|vector
name|norm
decl_stmt|;
name|vector
name|pcol
decl_stmt|;
name|vcset
argument_list|(
name|col
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|objcolor
argument_list|(
operator|&
name|pcol
argument_list|,
name|point
argument_list|,
name|obj
argument_list|)
expr_stmt|;
name|a
operator|=
name|pcol
operator|.
name|w
expr_stmt|;
if|if
condition|(
name|world
operator|.
name|quality
operator|<
literal|2
condition|)
block|{
name|vcopy
argument_list|(
name|col
argument_list|,
operator|&
name|pcol
argument_list|)
expr_stmt|;
return|return;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|obj
operator|->
name|numtexture
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|PHONG
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|REFLECTION
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|REFRACTION
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|TRANSPARENT
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|SMOKE
condition|)
continue|continue;
name|vcopy
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|pcol
argument_list|)
expr_stmt|;
name|vvmul
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|obj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|ambient
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|lcol
argument_list|)
expr_stmt|;
block|}
name|objnormal
argument_list|(
operator|&
name|norm
argument_list|,
name|obj
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|norm
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|r
operator|.
name|inside
operator|=
operator|-
literal|1
expr_stmt|;
name|r
operator|.
name|ior
operator|=
literal|1.0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|world
operator|.
name|numlight
condition|;
name|i
operator|++
control|)
block|{
name|vcopy
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|r
operator|.
name|v2
argument_list|,
operator|&
name|world
operator|.
name|light
index|[
name|i
index|]
operator|.
name|a
argument_list|)
expr_stmt|;
name|vmix
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v2
argument_list|,
literal|0.9999
argument_list|)
expr_stmt|;
name|d
operator|=
name|vdist
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v2
argument_list|)
expr_stmt|;
if|if
condition|(
name|world
operator|.
name|quality
operator|>=
literal|3
condition|)
block|{
name|o
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|world
operator|.
name|light
index|[
name|i
index|]
operator|.
name|com
operator|.
name|flags
operator|&
name|NOSHADOW
operator|)
condition|)
name|o
operator|=
name|traceray
argument_list|(
operator|&
name|r
argument_list|,
name|NULL
argument_list|,
operator|-
literal|1
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
condition|)
block|{
continue|continue;
block|}
block|}
comment|/* OK, light is visible */
name|vsub
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v2
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|b
operator|=
name|vdot
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|norm
argument_list|)
expr_stmt|;
name|b
operator|=
name|fabs
argument_list|(
name|b
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|obj
operator|->
name|numtexture
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|type
operator|==
name|PHONG
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|type
operator|==
name|REFLECTION
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|type
operator|==
name|REFRACTION
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|type
operator|==
name|TRANSPARENT
condition|)
continue|continue;
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|type
operator|==
name|SMOKE
condition|)
continue|continue;
name|vcopy
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|pcol
argument_list|)
expr_stmt|;
name|vvmul
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|world
operator|.
name|light
index|[
name|i
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
name|vvmul
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|diffuse
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|lcol
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|lcol
argument_list|)
expr_stmt|;
block|}
block|}
name|col
operator|->
name|w
operator|=
name|a
expr_stmt|;
block|}
end_function

begin_function
DECL|function|calcphong (common * obj,ray * r2,vector * col)
name|void
name|calcphong
parameter_list|(
name|common
modifier|*
name|obj
parameter_list|,
name|ray
modifier|*
name|r2
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|o
decl_stmt|;
name|ray
name|r
decl_stmt|;
name|double
name|d
decl_stmt|,
name|b
decl_stmt|;
name|vector
name|lcol
decl_stmt|;
name|vector
name|norm
decl_stmt|;
name|vector
name|pcol
decl_stmt|;
name|double
name|ps
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|pcol
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|norm
argument_list|,
operator|&
name|r2
operator|->
name|v2
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|norm
argument_list|,
operator|&
name|r2
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|norm
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|r
operator|.
name|inside
operator|=
operator|-
literal|1
expr_stmt|;
name|r
operator|.
name|ior
operator|=
literal|1.0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|world
operator|.
name|numlight
condition|;
name|i
operator|++
control|)
block|{
name|vcopy
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r2
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|r
operator|.
name|v2
argument_list|,
operator|&
name|world
operator|.
name|light
index|[
name|i
index|]
operator|.
name|a
argument_list|)
expr_stmt|;
name|vmix
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v2
argument_list|,
literal|0.9999
argument_list|)
expr_stmt|;
name|d
operator|=
name|vdist
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v2
argument_list|)
expr_stmt|;
name|o
operator|=
name|traceray
argument_list|(
operator|&
name|r
argument_list|,
name|NULL
argument_list|,
operator|-
literal|1
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|o
condition|)
block|{
continue|continue;
block|}
comment|/* OK, light is visible */
name|vsub
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|r
operator|.
name|v2
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|b
operator|=
operator|-
name|vdot
argument_list|(
operator|&
name|r
operator|.
name|v1
argument_list|,
operator|&
name|norm
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|obj
operator|->
name|numtexture
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|type
operator|!=
name|PHONG
condition|)
continue|continue;
name|ps
operator|=
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|phongsize
expr_stmt|;
if|if
condition|(
name|b
operator|<
operator|(
literal|1
operator|-
name|ps
operator|)
condition|)
continue|continue;
name|ps
operator|=
operator|(
name|b
operator|-
operator|(
literal|1
operator|-
name|ps
operator|)
operator|)
operator|/
name|ps
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|obj
operator|->
name|texture
index|[
name|j
index|]
operator|.
name|phongcolor
argument_list|)
expr_stmt|;
name|vvmul
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|world
operator|.
name|light
index|[
name|i
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|lcol
argument_list|,
name|ps
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|lcol
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
DECL|function|traceray (ray * r,vector * col,int level,double imp)
name|int
name|traceray
parameter_list|(
name|ray
modifier|*
name|r
parameter_list|,
name|vector
modifier|*
name|col
parameter_list|,
name|int
name|level
parameter_list|,
name|double
name|imp
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|b
init|=
operator|-
literal|1
decl_stmt|;
name|double
name|t
init|=
operator|-
literal|1.0
decl_stmt|,
name|min
init|=
literal|0.0
decl_stmt|;
name|int
name|type
init|=
operator|-
literal|1
decl_stmt|;
name|common
modifier|*
name|obj
decl_stmt|,
modifier|*
name|bobj
init|=
name|NULL
decl_stmt|;
name|int
name|hits
init|=
literal|0
decl_stmt|;
name|vector
name|p
decl_stmt|;
if|if
condition|(
operator|(
name|level
operator|==
literal|0
operator|)
operator|||
operator|(
name|imp
operator|<
literal|0.005
operator|)
condition|)
block|{
name|vset
argument_list|(
name|col
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|world
operator|.
name|numobj
condition|;
name|i
operator|++
control|)
block|{
name|obj
operator|=
operator|(
name|common
operator|*
operator|)
operator|&
name|world
operator|.
name|obj
index|[
name|i
index|]
expr_stmt|;
switch|switch
condition|(
name|obj
operator|->
name|type
condition|)
block|{
case|case
name|TRIANGLE
case|:
name|t
operator|=
name|checktri
argument_list|(
name|r
argument_list|,
operator|(
name|triangle
operator|*
operator|)
operator|&
name|world
operator|.
name|obj
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|DISC
case|:
name|t
operator|=
name|checkdisc
argument_list|(
name|r
argument_list|,
operator|(
name|disc
operator|*
operator|)
operator|&
name|world
operator|.
name|obj
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|PLANE
case|:
name|t
operator|=
name|checkplane
argument_list|(
name|r
argument_list|,
operator|(
name|plane
operator|*
operator|)
operator|&
name|world
operator|.
name|obj
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|SPHERE
case|:
name|t
operator|=
name|checksphere
argument_list|(
name|r
argument_list|,
operator|(
name|sphere
operator|*
operator|)
operator|&
name|world
operator|.
name|obj
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
case|case
name|CYLINDER
case|:
name|t
operator|=
name|checkcylinder
argument_list|(
name|r
argument_list|,
operator|(
name|cylinder
operator|*
operator|)
operator|&
name|world
operator|.
name|obj
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"Illegal object!!\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|t
operator|<=
literal|0.0
condition|)
continue|continue;
if|if
condition|(
operator|!
operator|(
name|obj
operator|->
name|flags
operator|&
name|NOSHADOW
operator|)
operator|&&
operator|(
name|level
operator|==
operator|-
literal|1
operator|)
condition|)
block|{
return|return
name|i
operator|+
literal|1
return|;
block|}
name|hits
operator|++
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|bobj
operator|)
operator|||
operator|(
name|t
operator|<
name|min
operator|)
condition|)
block|{
name|min
operator|=
name|t
expr_stmt|;
name|b
operator|=
name|i
expr_stmt|;
name|type
operator|=
name|obj
operator|->
name|type
expr_stmt|;
name|bobj
operator|=
name|obj
expr_stmt|;
block|}
block|}
if|if
condition|(
name|level
operator|==
operator|-
literal|1
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|bobj
condition|)
block|{
name|p
operator|.
name|x
operator|=
name|r
operator|->
name|v1
operator|.
name|x
operator|+
operator|(
name|r
operator|->
name|v2
operator|.
name|x
operator|-
name|r
operator|->
name|v1
operator|.
name|x
operator|)
operator|*
name|min
expr_stmt|;
name|p
operator|.
name|y
operator|=
name|r
operator|->
name|v1
operator|.
name|y
operator|+
operator|(
name|r
operator|->
name|v2
operator|.
name|y
operator|-
name|r
operator|->
name|v1
operator|.
name|y
operator|)
operator|*
name|min
expr_stmt|;
name|p
operator|.
name|z
operator|=
name|r
operator|->
name|v1
operator|.
name|z
operator|+
operator|(
name|r
operator|->
name|v2
operator|.
name|z
operator|-
name|r
operator|->
name|v1
operator|.
name|z
operator|)
operator|*
name|min
expr_stmt|;
name|calclight
argument_list|(
name|col
argument_list|,
operator|&
name|p
argument_list|,
name|bobj
argument_list|)
expr_stmt|;
if|if
condition|(
name|world
operator|.
name|flags
operator|&
name|SMARTAMBIENT
condition|)
block|{
name|double
name|ambient
init|=
literal|0.3
operator|*
name|exp
argument_list|(
operator|-
name|min
operator|/
name|world
operator|.
name|smartambient
argument_list|)
decl_stmt|;
name|vector
name|lcol
decl_stmt|;
name|objcolor
argument_list|(
operator|&
name|lcol
argument_list|,
operator|&
name|p
argument_list|,
name|bobj
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|lcol
argument_list|,
name|ambient
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|lcol
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|bobj
operator|->
name|numtexture
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|world
operator|.
name|quality
operator|>=
literal|4
operator|)
operator|&&
operator|(
operator|(
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|REFLECTION
operator|)
operator|||
operator|(
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|PHONG
operator|)
operator|)
condition|)
block|{
name|vector
name|refcol
decl_stmt|,
name|norm
decl_stmt|,
name|ocol
decl_stmt|;
name|ray
name|ref
decl_stmt|;
name|objcolor
argument_list|(
operator|&
name|ocol
argument_list|,
operator|&
name|p
argument_list|,
name|bobj
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|ref
operator|.
name|inside
operator|=
name|r
operator|->
name|inside
expr_stmt|;
name|ref
operator|.
name|ior
operator|=
name|r
operator|->
name|ior
expr_stmt|;
name|vmix
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|0.9999
argument_list|)
expr_stmt|;
comment|/* push it a tad */
name|vsub
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|objnormal
argument_list|(
operator|&
name|norm
argument_list|,
name|bobj
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|norm
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|vrotate
argument_list|(
operator|&
name|norm
argument_list|,
literal|180.0
argument_list|,
operator|&
name|ref
operator|.
name|v2
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|norm
argument_list|,
operator|-
literal|0.0001
argument_list|)
expr_stmt|;
comment|/* push it a tad */
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|norm
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|world
operator|.
name|quality
operator|>=
literal|5
operator|)
operator|&&
operator|(
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|REFLECTION
operator|)
condition|)
block|{
name|traceray
argument_list|(
operator|&
name|ref
argument_list|,
operator|&
name|refcol
argument_list|,
name|level
operator|-
literal|1
argument_list|,
name|imp
operator|*
name|vmax
argument_list|(
operator|&
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|reflection
argument_list|)
argument_list|)
expr_stmt|;
name|vvmul
argument_list|(
operator|&
name|refcol
argument_list|,
operator|&
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|reflection
argument_list|)
expr_stmt|;
name|refcol
operator|.
name|w
operator|=
name|ocol
operator|.
name|w
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|refcol
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|PHONG
condition|)
block|{
name|vcset
argument_list|(
operator|&
name|refcol
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|calcphong
argument_list|(
name|bobj
argument_list|,
operator|&
name|ref
argument_list|,
operator|&
name|refcol
argument_list|)
expr_stmt|;
name|refcol
operator|.
name|w
operator|=
name|ocol
operator|.
name|w
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|refcol
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|world
operator|.
name|quality
operator|>=
literal|5
operator|)
operator|&&
operator|(
name|col
operator|->
name|w
operator|<
literal|1.0
operator|)
condition|)
block|{
name|vector
name|refcol
decl_stmt|;
name|ray
name|ref
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vmix
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|0.999
argument_list|)
expr_stmt|;
comment|/* push it a tad */
name|traceray
argument_list|(
operator|&
name|ref
argument_list|,
operator|&
name|refcol
argument_list|,
name|level
operator|-
literal|1
argument_list|,
name|imp
operator|*
operator|(
literal|1.0
operator|-
name|col
operator|->
name|w
operator|)
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|refcol
argument_list|,
operator|(
literal|1.0
operator|-
name|col
operator|->
name|w
operator|)
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|refcol
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|world
operator|.
name|quality
operator|>=
literal|5
operator|)
operator|&&
operator|(
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|TRANSPARENT
operator|)
condition|)
block|{
name|vector
name|refcol
decl_stmt|;
name|ray
name|ref
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vmix
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|0.999
argument_list|)
expr_stmt|;
comment|/* push it a tad */
name|traceray
argument_list|(
operator|&
name|ref
argument_list|,
operator|&
name|refcol
argument_list|,
name|level
operator|-
literal|1
argument_list|,
name|imp
operator|*
name|vmax
argument_list|(
operator|&
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|transparent
argument_list|)
argument_list|)
expr_stmt|;
name|vvmul
argument_list|(
operator|&
name|refcol
argument_list|,
operator|&
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|transparent
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|refcol
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|world
operator|.
name|quality
operator|>=
literal|5
operator|)
operator|&&
operator|(
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|SMOKE
operator|)
condition|)
block|{
name|vector
name|smcol
decl_stmt|,
name|raydir
decl_stmt|,
name|norm
decl_stmt|;
name|double
name|tran
decl_stmt|;
name|ray
name|ref
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|objnormal
argument_list|(
operator|&
name|norm
argument_list|,
name|bobj
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|raydir
argument_list|,
operator|&
name|r
operator|->
name|v2
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|raydir
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|raydir
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|tran
operator|=
name|vdot
argument_list|(
operator|&
name|norm
argument_list|,
operator|&
name|raydir
argument_list|)
expr_stmt|;
if|if
condition|(
name|tran
operator|<
literal|0.0
condition|)
continue|continue;
name|tran
operator|*=
name|tran
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|smcol
argument_list|,
operator|&
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|color1
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|smcol
argument_list|,
name|tran
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|smcol
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|world
operator|.
name|quality
operator|>=
literal|5
operator|)
operator|&&
operator|(
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|type
operator|==
name|REFRACTION
operator|)
condition|)
block|{
name|vector
name|refcol
decl_stmt|,
name|norm
decl_stmt|,
name|tmpv
decl_stmt|;
name|ray
name|ref
decl_stmt|;
name|double
name|c1
decl_stmt|,
name|c2
decl_stmt|,
name|n1
decl_stmt|,
name|n2
decl_stmt|,
name|n
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|vsub
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|r
operator|->
name|v1
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|r
operator|->
name|v2
argument_list|)
expr_stmt|;
name|vmix
argument_list|(
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v1
argument_list|,
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|0.999
argument_list|)
expr_stmt|;
comment|/* push it a tad */
name|vsub
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|objnormal
argument_list|(
operator|&
name|norm
argument_list|,
name|bobj
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|->
name|inside
operator|==
name|b
condition|)
block|{
name|ref
operator|.
name|inside
operator|=
operator|-
literal|1
expr_stmt|;
name|ref
operator|.
name|ior
operator|=
literal|1.0
expr_stmt|;
block|}
else|else
block|{
name|ref
operator|.
name|inside
operator|=
name|b
expr_stmt|;
name|ref
operator|.
name|ior
operator|=
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|ior
expr_stmt|;
block|}
name|c1
operator|=
name|vdot
argument_list|(
operator|&
name|norm
argument_list|,
operator|&
name|ref
operator|.
name|v2
argument_list|)
expr_stmt|;
if|if
condition|(
name|ref
operator|.
name|inside
operator|<
literal|0
condition|)
name|c1
operator|=
operator|-
name|c1
expr_stmt|;
name|n1
operator|=
name|r
operator|->
name|ior
expr_stmt|;
comment|/* IOR of current media  */
name|n2
operator|=
name|ref
operator|.
name|ior
expr_stmt|;
comment|/* IOR of new media  */
name|n
operator|=
name|n1
operator|/
name|n2
expr_stmt|;
name|c2
operator|=
literal|1.0
operator|-
name|n
operator|*
name|n
operator|*
operator|(
literal|1.0
operator|-
name|c1
operator|*
name|c1
operator|)
expr_stmt|;
if|if
condition|(
name|c2
operator|<
literal|0.0
condition|)
block|{
comment|/* FIXME: Internal reflection should occur */
name|c2
operator|=
name|sqrt
argument_list|(
operator|-
name|c2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|c2
operator|=
name|sqrt
argument_list|(
name|c2
argument_list|)
expr_stmt|;
block|}
name|vmul
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|tmpv
argument_list|,
operator|&
name|norm
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|tmpv
argument_list|,
name|n
operator|*
name|c1
operator|-
name|c2
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|tmpv
argument_list|)
expr_stmt|;
name|vnorm
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
operator|&
name|ref
operator|.
name|v2
argument_list|,
operator|&
name|p
argument_list|)
expr_stmt|;
name|traceray
argument_list|(
operator|&
name|ref
argument_list|,
operator|&
name|refcol
argument_list|,
name|level
operator|-
literal|1
argument_list|,
name|imp
operator|*
name|vmax
argument_list|(
operator|&
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|refraction
argument_list|)
argument_list|)
expr_stmt|;
name|vvmul
argument_list|(
operator|&
name|refcol
argument_list|,
operator|&
name|bobj
operator|->
name|texture
index|[
name|i
index|]
operator|.
name|refraction
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|refcol
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|vcset
argument_list|(
name|col
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|min
operator|=
literal|10000.0
expr_stmt|;
name|vcset
argument_list|(
operator|&
name|p
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|world
operator|.
name|numatmos
condition|;
name|i
operator|++
control|)
block|{
name|vector
name|tmpcol
decl_stmt|;
if|if
condition|(
name|world
operator|.
name|atmos
index|[
name|i
index|]
operator|.
name|type
operator|==
name|FOG
condition|)
block|{
name|double
name|v
decl_stmt|,
name|pt
index|[
literal|3
index|]
decl_stmt|;
name|pt
index|[
literal|0
index|]
operator|=
name|p
operator|.
name|x
expr_stmt|;
name|pt
index|[
literal|1
index|]
operator|=
name|p
operator|.
name|y
expr_stmt|;
name|pt
index|[
literal|2
index|]
operator|=
name|p
operator|.
name|z
expr_stmt|;
if|if
condition|(
operator|(
name|v
operator|=
name|world
operator|.
name|atmos
index|[
name|i
index|]
operator|.
name|turbulence
operator|)
operator|>
literal|0.0
condition|)
name|v
operator|=
name|turbulence
argument_list|(
name|pt
argument_list|,
literal|1
argument_list|,
literal|256
argument_list|)
operator|*
name|world
operator|.
name|atmos
index|[
name|i
index|]
operator|.
name|turbulence
expr_stmt|;
name|v
operator|=
name|exp
argument_list|(
operator|-
operator|(
name|min
operator|+
name|v
operator|)
operator|/
name|world
operator|.
name|atmos
index|[
name|i
index|]
operator|.
name|density
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
name|col
argument_list|,
name|v
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|tmpcol
argument_list|,
operator|&
name|world
operator|.
name|atmos
index|[
name|i
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|tmpcol
argument_list|,
literal|1.0
operator|-
name|v
argument_list|)
expr_stmt|;
name|vadd
argument_list|(
name|col
argument_list|,
operator|&
name|tmpcol
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|hits
return|;
block|}
end_function

begin_function
DECL|function|setdefaults (texture * t)
name|void
name|setdefaults
parameter_list|(
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|memset
argument_list|(
name|t
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|t
operator|->
name|type
operator|=
name|SOLID
expr_stmt|;
name|vcset
argument_list|(
operator|&
name|t
operator|->
name|color1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vcset
argument_list|(
operator|&
name|t
operator|->
name|color2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vcset
argument_list|(
operator|&
name|t
operator|->
name|diffuse
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vcset
argument_list|(
operator|&
name|t
operator|->
name|ambient
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|t
operator|->
name|scale
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|t
operator|->
name|rotate
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|t
operator|->
name|translate
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|t
operator|->
name|oscale
operator|=
literal|1.0
expr_stmt|;
name|t
operator|->
name|amount
operator|=
literal|1.0
expr_stmt|;
name|t
operator|->
name|exp
operator|=
literal|1.0
expr_stmt|;
block|}
end_function

begin_function
DECL|function|mklabel (texture * t)
name|char
modifier|*
name|mklabel
parameter_list|(
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|struct
name|textures_t
modifier|*
name|l
decl_stmt|;
specifier|static
name|char
name|tmps
index|[
literal|100
index|]
decl_stmt|;
if|if
condition|(
name|t
operator|->
name|majtype
operator|==
literal|0
condition|)
name|strcpy
argument_list|(
name|tmps
argument_list|,
name|_
argument_list|(
literal|"Texture"
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|t
operator|->
name|majtype
operator|==
literal|1
condition|)
name|strcpy
argument_list|(
name|tmps
argument_list|,
name|_
argument_list|(
literal|"Bumpmap"
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|t
operator|->
name|majtype
operator|==
literal|2
condition|)
name|strcpy
argument_list|(
name|tmps
argument_list|,
name|_
argument_list|(
literal|"Light"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|strcpy
argument_list|(
name|tmps
argument_list|,
name|_
argument_list|(
literal|"(unknown!?)"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|t
operator|->
name|majtype
operator|==
literal|0
operator|)
operator|||
operator|(
name|t
operator|->
name|majtype
operator|==
literal|1
operator|)
condition|)
block|{
name|strcat
argument_list|(
name|tmps
argument_list|,
literal|" / "
argument_list|)
expr_stmt|;
name|l
operator|=
name|textures
expr_stmt|;
while|while
condition|(
name|l
operator|->
name|s
condition|)
block|{
if|if
condition|(
name|t
operator|->
name|type
operator|==
name|l
operator|->
name|n
condition|)
block|{
name|strcat
argument_list|(
name|tmps
argument_list|,
name|gettext
argument_list|(
name|l
operator|->
name|s
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|l
operator|++
expr_stmt|;
block|}
block|}
return|return
name|tmps
return|;
block|}
end_function

begin_function
DECL|function|currentitem (GtkWidget * list)
name|GtkWidget
modifier|*
name|currentitem
parameter_list|(
name|GtkWidget
modifier|*
name|list
parameter_list|)
block|{
name|GList
modifier|*
name|h
decl_stmt|;
name|GtkWidget
modifier|*
name|tmpw
decl_stmt|;
name|h
operator|=
name|GTK_LIST
argument_list|(
name|list
argument_list|)
operator|->
name|selection
expr_stmt|;
if|if
condition|(
operator|!
name|h
condition|)
return|return
name|NULL
return|;
name|tmpw
operator|=
name|h
operator|->
name|data
expr_stmt|;
return|return
name|tmpw
return|;
block|}
end_function

begin_function
DECL|function|currenttexture (void)
name|texture
modifier|*
name|currenttexture
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|tmpw
decl_stmt|;
name|texture
modifier|*
name|t
decl_stmt|;
name|tmpw
operator|=
name|currentitem
argument_list|(
name|texturelist
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmpw
condition|)
return|return
name|NULL
return|;
name|t
operator|=
name|gtk_object_get_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|tmpw
argument_list|)
argument_list|,
literal|"texture"
argument_list|)
expr_stmt|;
return|return
name|t
return|;
block|}
end_function

begin_function
DECL|function|relabel (void)
name|void
name|relabel
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|tmpw
init|=
name|currentitem
argument_list|(
name|texturelist
argument_list|)
decl_stmt|;
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|tmpw
operator|||
operator|!
name|t
condition|)
return|return;
name|tmpw
operator|=
name|GTK_BIN
argument_list|(
name|tmpw
argument_list|)
operator|->
name|child
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|tmpw
argument_list|)
argument_list|,
name|mklabel
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
DECL|variable|noupdate
name|int
name|noupdate
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
DECL|function|setvals (texture * t)
name|void
name|setvals
parameter_list|(
name|texture
modifier|*
name|t
parameter_list|)
block|{
name|struct
name|textures_t
modifier|*
name|l
decl_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|noupdate
operator|=
literal|1
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|amountscale
argument_list|)
argument_list|,
name|t
operator|->
name|amount
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scalescale
argument_list|)
argument_list|,
name|t
operator|->
name|oscale
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scalexscale
argument_list|)
argument_list|,
name|t
operator|->
name|scale
operator|.
name|x
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaleyscale
argument_list|)
argument_list|,
name|t
operator|->
name|scale
operator|.
name|y
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scalezscale
argument_list|)
argument_list|,
name|t
operator|->
name|scale
operator|.
name|z
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|rotxscale
argument_list|)
argument_list|,
name|t
operator|->
name|rotate
operator|.
name|x
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|rotyscale
argument_list|)
argument_list|,
name|t
operator|->
name|rotate
operator|.
name|y
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|rotzscale
argument_list|)
argument_list|,
name|t
operator|->
name|rotate
operator|.
name|z
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|posxscale
argument_list|)
argument_list|,
name|t
operator|->
name|translate
operator|.
name|x
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|posyscale
argument_list|)
argument_list|,
name|t
operator|->
name|translate
operator|.
name|y
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|poszscale
argument_list|)
argument_list|,
name|t
operator|->
name|translate
operator|.
name|z
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|turbulencescale
argument_list|)
argument_list|,
name|t
operator|->
name|turbulence
operator|.
name|x
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|expscale
argument_list|)
argument_list|,
name|t
operator|->
name|exp
argument_list|)
expr_stmt|;
name|drawcolor1
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|drawcolor2
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|l
operator|=
name|textures
expr_stmt|;
while|while
condition|(
name|l
operator|->
name|s
condition|)
block|{
if|if
condition|(
name|l
operator|->
name|n
operator|==
name|t
operator|->
name|type
condition|)
block|{
name|gtk_option_menu_set_history
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|texturemenu
argument_list|)
argument_list|,
name|l
operator|->
name|index
argument_list|)
expr_stmt|;
break|break;
block|}
name|l
operator|++
expr_stmt|;
block|}
name|gtk_option_menu_set_history
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|typemenu
argument_list|)
argument_list|,
name|t
operator|->
name|majtype
argument_list|)
expr_stmt|;
name|noupdate
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
DECL|function|selectitem (GtkWidget * wg,GtkWidget * p)
name|void
name|selectitem
parameter_list|(
name|GtkWidget
modifier|*
name|wg
parameter_list|,
name|GtkWidget
modifier|*
name|p
parameter_list|)
block|{
name|setvals
argument_list|(
name|currenttexture
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|addtexture (void)
name|void
name|addtexture
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|item
decl_stmt|;
name|int
name|n
init|=
name|s
operator|.
name|com
operator|.
name|numtexture
decl_stmt|;
if|if
condition|(
name|n
operator|==
name|MAXTEXTUREPEROBJ
operator|-
literal|1
condition|)
return|return;
name|setdefaults
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|item
operator|=
name|gtk_list_item_new_with_label
argument_list|(
name|mklabel
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"texture"
argument_list|,
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|texturelist
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gtk_list_select_child
argument_list|(
name|GTK_LIST
argument_list|(
name|texturelist
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|numtexture
operator|++
expr_stmt|;
name|restartrender
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|duptexture (void)
name|void
name|duptexture
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|item
decl_stmt|;
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
name|int
name|n
init|=
name|s
operator|.
name|com
operator|.
name|numtexture
decl_stmt|;
if|if
condition|(
name|n
operator|==
name|MAXTEXTUREPEROBJ
operator|-
literal|1
condition|)
return|return;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|memcpy
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|,
name|t
argument_list|,
sizeof|sizeof
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|=
name|gtk_list_item_new_with_label
argument_list|(
name|mklabel
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"texture"
argument_list|,
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|texturelist
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gtk_list_select_child
argument_list|(
name|GTK_LIST
argument_list|(
name|texturelist
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|numtexture
operator|++
expr_stmt|;
name|restartrender
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|rebuildlist (void)
name|void
name|rebuildlist
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|item
decl_stmt|;
name|int
name|n
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|s
operator|.
name|com
operator|.
name|numtexture
condition|;
name|n
operator|++
control|)
block|{
if|if
condition|(
name|s
operator|.
name|com
operator|.
name|numtexture
operator|&&
operator|(
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
operator|.
name|majtype
operator|<
literal|0
operator|)
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|n
init|;
name|i
operator|<
name|s
operator|.
name|com
operator|.
name|numtexture
operator|-
literal|1
condition|;
name|i
operator|++
control|)
name|memcpy
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|i
index|]
argument_list|,
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|i
operator|+
literal|1
index|]
argument_list|,
sizeof|sizeof
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|numtexture
operator|--
expr_stmt|;
name|n
operator|--
expr_stmt|;
block|}
block|}
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|s
operator|.
name|com
operator|.
name|numtexture
condition|;
name|n
operator|++
control|)
block|{
name|item
operator|=
name|gtk_list_item_new_with_label
argument_list|(
name|mklabel
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"texture"
argument_list|,
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|n
index|]
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|texturelist
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
name|restartrender
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|sphere_reset (void)
name|void
name|sphere_reset
parameter_list|(
name|void
parameter_list|)
block|{
name|s
operator|.
name|com
operator|.
name|numtexture
operator|=
literal|3
expr_stmt|;
name|setdefaults
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|setdefaults
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|setdefaults
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|1
index|]
operator|.
name|majtype
operator|=
literal|2
expr_stmt|;
name|vset
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|1
index|]
operator|.
name|color1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|1
index|]
operator|.
name|translate
argument_list|,
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|2
index|]
operator|.
name|majtype
operator|=
literal|2
expr_stmt|;
name|vset
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|2
index|]
operator|.
name|color1
argument_list|,
literal|0
argument_list|,
literal|0.4
argument_list|,
literal|0.4
argument_list|)
expr_stmt|;
name|vset
argument_list|(
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
literal|2
index|]
operator|.
name|translate
argument_list|,
literal|15
argument_list|,
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
expr_stmt|;
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|texturelist
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|rebuildlist
argument_list|()
expr_stmt|;
name|restartrender
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|deltexture (void)
name|void
name|deltexture
parameter_list|(
name|void
parameter_list|)
block|{
name|texture
modifier|*
name|t
decl_stmt|;
name|GtkWidget
modifier|*
name|tmpw
decl_stmt|;
name|tmpw
operator|=
name|currentitem
argument_list|(
name|texturelist
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tmpw
condition|)
return|return;
name|t
operator|=
name|currenttexture
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|t
operator|->
name|majtype
operator|=
operator|-
literal|1
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|tmpw
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|loadit (char * fn)
name|void
name|loadit
parameter_list|(
name|char
modifier|*
name|fn
parameter_list|)
block|{
name|FILE
modifier|*
name|f
decl_stmt|;
name|char
name|line
index|[
literal|1024
index|]
decl_stmt|;
name|int
name|i
decl_stmt|;
name|texture
modifier|*
name|t
decl_stmt|;
name|s
operator|.
name|com
operator|.
name|numtexture
operator|=
literal|0
expr_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|fn
argument_list|,
literal|"rt"
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|feof
argument_list|(
name|f
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|fgets
argument_list|(
name|line
argument_list|,
literal|1023
argument_list|,
name|f
argument_list|)
condition|)
break|break;
name|i
operator|=
name|s
operator|.
name|com
operator|.
name|numtexture
expr_stmt|;
name|t
operator|=
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|i
index|]
expr_stmt|;
name|setdefaults
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|sscanf
argument_list|(
name|line
argument_list|,
literal|"%d %d %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf %lf\n"
argument_list|,
operator|&
name|t
operator|->
name|majtype
argument_list|,
operator|&
name|t
operator|->
name|type
argument_list|,
operator|&
name|t
operator|->
name|color1
operator|.
name|x
argument_list|,
operator|&
name|t
operator|->
name|color1
operator|.
name|y
argument_list|,
operator|&
name|t
operator|->
name|color1
operator|.
name|z
argument_list|,
operator|&
name|t
operator|->
name|color1
operator|.
name|w
argument_list|,
operator|&
name|t
operator|->
name|color2
operator|.
name|x
argument_list|,
operator|&
name|t
operator|->
name|color2
operator|.
name|y
argument_list|,
operator|&
name|t
operator|->
name|color2
operator|.
name|z
argument_list|,
operator|&
name|t
operator|->
name|color2
operator|.
name|w
argument_list|,
operator|&
name|t
operator|->
name|oscale
argument_list|,
operator|&
name|t
operator|->
name|turbulence
operator|.
name|x
argument_list|,
operator|&
name|t
operator|->
name|amount
argument_list|,
operator|&
name|t
operator|->
name|exp
argument_list|,
operator|&
name|t
operator|->
name|scale
operator|.
name|x
argument_list|,
operator|&
name|t
operator|->
name|scale
operator|.
name|y
argument_list|,
operator|&
name|t
operator|->
name|scale
operator|.
name|z
argument_list|,
operator|&
name|t
operator|->
name|rotate
operator|.
name|x
argument_list|,
operator|&
name|t
operator|->
name|rotate
operator|.
name|y
argument_list|,
operator|&
name|t
operator|->
name|rotate
operator|.
name|z
argument_list|,
operator|&
name|t
operator|->
name|translate
operator|.
name|x
argument_list|,
operator|&
name|t
operator|->
name|translate
operator|.
name|y
argument_list|,
operator|&
name|t
operator|->
name|translate
operator|.
name|z
argument_list|)
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|numtexture
operator|++
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|loadpreset_ok (GtkWidget * w,GtkFileSelection * fs)
name|void
name|loadpreset_ok
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|GtkFileSelection
modifier|*
name|fs
parameter_list|)
block|{
name|char
modifier|*
name|fn
init|=
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|fs
argument_list|)
argument_list|)
decl_stmt|;
name|gtk_widget_hide
argument_list|(
name|GTK_WIDGET
argument_list|(
name|fs
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|texturelist
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|loadit
argument_list|(
name|fn
argument_list|)
expr_stmt|;
name|rebuildlist
argument_list|()
expr_stmt|;
name|restartrender
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|saveit (char * fn)
name|void
name|saveit
parameter_list|(
name|char
modifier|*
name|fn
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|FILE
modifier|*
name|f
decl_stmt|;
name|f
operator|=
name|fopen
argument_list|(
name|fn
argument_list|,
literal|"wt"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|s
operator|.
name|com
operator|.
name|numtexture
condition|;
name|i
operator|++
control|)
block|{
name|texture
modifier|*
name|t
init|=
operator|&
name|s
operator|.
name|com
operator|.
name|texture
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
name|t
operator|->
name|majtype
operator|<
literal|0
condition|)
continue|continue;
name|fprintf
argument_list|(
name|f
argument_list|,
literal|"%d %d %f %f %f %f %f %f %f %f %f %f %f %f %f %f %f %f %f %f %f %f %f\n"
argument_list|,
name|t
operator|->
name|majtype
argument_list|,
name|t
operator|->
name|type
argument_list|,
name|t
operator|->
name|color1
operator|.
name|x
argument_list|,
name|t
operator|->
name|color1
operator|.
name|y
argument_list|,
name|t
operator|->
name|color1
operator|.
name|z
argument_list|,
name|t
operator|->
name|color1
operator|.
name|w
argument_list|,
name|t
operator|->
name|color2
operator|.
name|x
argument_list|,
name|t
operator|->
name|color2
operator|.
name|y
argument_list|,
name|t
operator|->
name|color2
operator|.
name|z
argument_list|,
name|t
operator|->
name|color2
operator|.
name|w
argument_list|,
name|t
operator|->
name|oscale
argument_list|,
name|t
operator|->
name|turbulence
operator|.
name|x
argument_list|,
name|t
operator|->
name|amount
argument_list|,
name|t
operator|->
name|exp
argument_list|,
name|t
operator|->
name|scale
operator|.
name|x
argument_list|,
name|t
operator|->
name|scale
operator|.
name|y
argument_list|,
name|t
operator|->
name|scale
operator|.
name|z
argument_list|,
name|t
operator|->
name|rotate
operator|.
name|x
argument_list|,
name|t
operator|->
name|rotate
operator|.
name|y
argument_list|,
name|t
operator|->
name|rotate
operator|.
name|z
argument_list|,
name|t
operator|->
name|translate
operator|.
name|x
argument_list|,
name|t
operator|->
name|translate
operator|.
name|y
argument_list|,
name|t
operator|->
name|translate
operator|.
name|z
argument_list|)
expr_stmt|;
block|}
name|fclose
argument_list|(
name|f
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|savepreset_ok (GtkWidget * w,GtkFileSelection * fs)
name|void
name|savepreset_ok
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|GtkFileSelection
modifier|*
name|fs
parameter_list|)
block|{
name|char
modifier|*
name|fn
init|=
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|fs
argument_list|)
argument_list|)
decl_stmt|;
name|gtk_widget_hide
argument_list|(
name|GTK_WIDGET
argument_list|(
name|fs
argument_list|)
argument_list|)
expr_stmt|;
name|saveit
argument_list|(
name|fn
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|loadpreset (void)
name|void
name|loadpreset
parameter_list|(
name|void
parameter_list|)
block|{
name|fileselect
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|savepreset (void)
name|void
name|savepreset
parameter_list|(
name|void
parameter_list|)
block|{
name|fileselect
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|fileselect (int action)
name|void
name|fileselect
parameter_list|(
name|int
name|action
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|windows
index|[
literal|2
index|]
init|=
block|{
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
name|char
modifier|*
name|titles
index|[]
init|=
block|{
name|N_
argument_list|(
literal|"Open file"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Save file"
argument_list|)
block|}
decl_stmt|;
name|void
modifier|*
name|handlers
index|[]
init|=
block|{
name|loadpreset_ok
block|,
name|savepreset_ok
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|windows
index|[
name|action
index|]
condition|)
block|{
name|windows
index|[
name|action
index|]
operator|=
name|gtk_file_selection_new
argument_list|(
name|gettext
argument_list|(
name|titles
index|[
name|action
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_widget_destroy
argument_list|)
argument_list|,
operator|&
name|windows
index|[
name|action
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_widget_hide
argument_list|)
argument_list|,
operator|&
name|windows
index|[
name|action
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|handlers
index|[
name|action
index|]
argument_list|)
argument_list|,
name|windows
index|[
name|action
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_widget_destroy
argument_list|)
argument_list|,
name|GTK_OBJECT
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_help_connect_help_accel
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"filters/spheredesigner.html"
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|windows
index|[
name|action
index|]
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|initworld (void)
name|void
name|initworld
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|memset
argument_list|(
operator|&
name|world
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|world
argument_list|)
argument_list|)
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|type
operator|=
name|SPHERE
expr_stmt|;
name|s
operator|.
name|a
operator|.
name|x
operator|=
name|s
operator|.
name|a
operator|.
name|y
operator|=
name|s
operator|.
name|a
operator|.
name|z
operator|=
literal|0.0
expr_stmt|;
name|s
operator|.
name|r
operator|=
literal|4.0
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|world
operator|.
name|obj
index|[
literal|0
index|]
argument_list|,
operator|&
name|s
argument_list|,
sizeof|sizeof
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|world
operator|.
name|numobj
operator|=
literal|1
expr_stmt|;
name|world
operator|.
name|obj
index|[
literal|0
index|]
operator|.
name|com
operator|.
name|numtexture
operator|=
literal|0
expr_stmt|;
name|world
operator|.
name|obj
index|[
literal|0
index|]
operator|.
name|com
operator|.
name|numnormal
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|s
operator|.
name|com
operator|.
name|numtexture
condition|;
name|i
operator|++
control|)
block|{
name|common
modifier|*
name|c
init|=
operator|&
name|s
operator|.
name|com
decl_stmt|;
name|common
modifier|*
name|d
init|=
operator|&
name|world
operator|.
name|obj
index|[
literal|0
index|]
operator|.
name|com
decl_stmt|;
name|texture
modifier|*
name|t
init|=
operator|&
name|c
operator|->
name|texture
index|[
name|i
index|]
decl_stmt|;
if|if
condition|(
operator|(
name|t
operator|->
name|amount
operator|<=
literal|0.0
operator|)
operator|||
operator|(
name|t
operator|->
name|majtype
operator|<
literal|0
operator|)
condition|)
continue|continue;
if|if
condition|(
name|t
operator|->
name|majtype
operator|==
literal|0
condition|)
block|{
comment|/* Normal texture */
if|if
condition|(
name|t
operator|->
name|type
operator|==
name|PHONG
condition|)
block|{
name|memcpy
argument_list|(
operator|&
name|t
operator|->
name|phongcolor
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|,
sizeof|sizeof
argument_list|(
name|t
operator|->
name|color1
argument_list|)
argument_list|)
expr_stmt|;
name|t
operator|->
name|phongsize
operator|=
name|t
operator|->
name|oscale
operator|/
literal|25.0
expr_stmt|;
block|}
name|memcpy
argument_list|(
operator|&
name|d
operator|->
name|texture
index|[
name|d
operator|->
name|numtexture
index|]
argument_list|,
name|t
argument_list|,
sizeof|sizeof
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|d
operator|->
name|texture
index|[
name|d
operator|->
name|numtexture
index|]
operator|.
name|scale
argument_list|,
name|d
operator|->
name|texture
index|[
name|d
operator|->
name|numtexture
index|]
operator|.
name|oscale
argument_list|)
expr_stmt|;
name|d
operator|->
name|numtexture
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|t
operator|->
name|majtype
operator|==
literal|1
condition|)
block|{
comment|/* Bumpmap */
name|memcpy
argument_list|(
operator|&
name|d
operator|->
name|normal
index|[
name|d
operator|->
name|numnormal
index|]
argument_list|,
name|t
argument_list|,
sizeof|sizeof
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|d
operator|->
name|normal
index|[
name|d
operator|->
name|numnormal
index|]
operator|.
name|scale
argument_list|,
name|d
operator|->
name|texture
index|[
name|d
operator|->
name|numnormal
index|]
operator|.
name|oscale
argument_list|)
expr_stmt|;
name|d
operator|->
name|numnormal
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|t
operator|->
name|majtype
operator|==
literal|2
condition|)
block|{
comment|/* Lightsource */
name|light
name|l
decl_stmt|;
name|vcopy
argument_list|(
operator|&
name|l
operator|.
name|a
argument_list|,
operator|&
name|t
operator|->
name|translate
argument_list|)
expr_stmt|;
name|vcopy
argument_list|(
operator|&
name|l
operator|.
name|color
argument_list|,
operator|&
name|t
operator|->
name|color1
argument_list|)
expr_stmt|;
name|vmul
argument_list|(
operator|&
name|l
operator|.
name|color
argument_list|,
name|t
operator|->
name|amount
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
operator|&
name|world
operator|.
name|light
index|[
name|world
operator|.
name|numlight
index|]
argument_list|,
operator|&
name|l
argument_list|,
sizeof|sizeof
argument_list|(
name|l
argument_list|)
argument_list|)
expr_stmt|;
name|world
operator|.
name|numlight
operator|++
expr_stmt|;
block|}
block|}
name|world
operator|.
name|quality
operator|=
literal|5
expr_stmt|;
name|world
operator|.
name|flags
operator||=
name|SMARTAMBIENT
expr_stmt|;
name|world
operator|.
name|smartambient
operator|=
literal|40.0
expr_stmt|;
block|}
end_function

begin_function
DECL|function|drawit (gpointer data)
name|void
name|drawit
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|drawarea
condition|)
return|return;
name|gdk_draw_rgb_image
argument_list|(
name|drawarea
operator|->
name|window
argument_list|,
name|drawarea
operator|->
name|style
operator|->
name|white_gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|PREVIEWSIZE
argument_list|,
name|PREVIEWSIZE
argument_list|,
name|GDK_RGB_DITHER_MAX
argument_list|,
name|data
argument_list|,
name|PREVIEWSIZE
operator|*
literal|3
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|expose_event (GtkWidget * widget,GdkEventExpose * event)
name|expose_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|event
parameter_list|)
block|{
name|drawit
argument_list|(
name|img
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
DECL|function|restartrender (void)
name|gint
name|restartrender
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|running
condition|)
block|{
name|running
operator|=
literal|2
expr_stmt|;
return|return
literal|0
return|;
block|}
name|render
argument_list|()
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_function
DECL|function|destroy_window (GtkWidget * widget,GtkWidget ** window)
name|void
name|destroy_window
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|window
parameter_list|)
block|{
operator|*
name|window
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
DECL|function|selecttexture (GtkWidget * wg,gpointer data)
name|void
name|selecttexture
parameter_list|(
name|GtkWidget
modifier|*
name|wg
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|texture
modifier|*
name|t
decl_stmt|;
name|int
name|n
init|=
operator|(
name|long
operator|)
name|data
decl_stmt|;
if|if
condition|(
name|noupdate
condition|)
return|return;
name|t
operator|=
name|currenttexture
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|t
operator|->
name|type
operator|=
name|n
expr_stmt|;
name|relabel
argument_list|()
expr_stmt|;
name|restartrender
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|selecttype (GtkWidget * wg,gpointer data)
name|void
name|selecttype
parameter_list|(
name|GtkWidget
modifier|*
name|wg
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|texture
modifier|*
name|t
decl_stmt|;
name|long
name|n
init|=
operator|(
name|long
operator|)
name|data
decl_stmt|;
if|if
condition|(
name|noupdate
condition|)
return|return;
name|t
operator|=
name|currenttexture
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|t
operator|->
name|majtype
operator|=
name|n
expr_stmt|;
name|relabel
argument_list|()
expr_stmt|;
name|restartrender
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|getscales (GtkWidget * wg,gpointer data)
name|void
name|getscales
parameter_list|(
name|GtkWidget
modifier|*
name|wg
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|double
name|f
decl_stmt|;
name|texture
modifier|*
name|t
decl_stmt|;
if|if
condition|(
name|noupdate
condition|)
return|return;
name|t
operator|=
name|currenttexture
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|t
operator|->
name|amount
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|amountscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|exp
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|expscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|f
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|turbulencescale
argument_list|)
operator|->
name|value
expr_stmt|;
name|vset
argument_list|(
operator|&
name|t
operator|->
name|turbulence
argument_list|,
name|f
argument_list|,
name|f
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|t
operator|->
name|oscale
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|scalescale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|scale
operator|.
name|x
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|scalexscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|scale
operator|.
name|y
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|scaleyscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|scale
operator|.
name|z
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|scalezscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|rotate
operator|.
name|x
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|rotxscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|rotate
operator|.
name|y
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|rotyscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|rotate
operator|.
name|z
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|rotzscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|translate
operator|.
name|x
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|posxscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|translate
operator|.
name|y
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|posyscale
argument_list|)
operator|->
name|value
expr_stmt|;
name|t
operator|->
name|translate
operator|.
name|z
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|poszscale
argument_list|)
operator|->
name|value
expr_stmt|;
block|}
end_function

begin_function
DECL|function|mktexturemenu (GtkWidget * texturemenu_menu)
name|void
name|mktexturemenu
parameter_list|(
name|GtkWidget
modifier|*
name|texturemenu_menu
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|item
decl_stmt|;
name|struct
name|textures_t
modifier|*
name|t
decl_stmt|;
name|t
operator|=
name|textures
expr_stmt|;
while|while
condition|(
name|t
operator|->
name|s
condition|)
block|{
name|item
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|gettext
argument_list|(
name|t
operator|->
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|texturemenu_menu
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|selecttexture
argument_list|)
argument_list|,
operator|(
name|void
operator|*
operator|)
name|t
operator|->
name|n
argument_list|)
expr_stmt|;
name|t
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
DECL|function|drawcolor1 (GtkWidget * w)
name|void
name|drawcolor1
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|lastw
init|=
name|NULL
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guchar
name|buf
index|[
name|COLORBUTTONWIDTH
operator|*
literal|3
index|]
decl_stmt|;
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
if|if
condition|(
name|w
condition|)
name|lastw
operator|=
name|w
expr_stmt|;
else|else
name|w
operator|=
name|lastw
expr_stmt|;
if|if
condition|(
operator|!
name|w
condition|)
return|return;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|COLORBUTTONWIDTH
condition|;
name|x
operator|++
control|)
block|{
name|buf
index|[
name|x
operator|*
literal|3
operator|+
literal|0
index|]
operator|=
name|t
operator|->
name|color1
operator|.
name|x
operator|*
literal|255.0
expr_stmt|;
name|buf
index|[
name|x
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|t
operator|->
name|color1
operator|.
name|y
operator|*
literal|255.0
expr_stmt|;
name|buf
index|[
name|x
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|t
operator|->
name|color1
operator|.
name|z
operator|*
literal|255.0
expr_stmt|;
block|}
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|COLORBUTTONHEIGHT
condition|;
name|y
operator|++
control|)
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|w
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|COLORBUTTONWIDTH
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|w
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|drawcolor2 (GtkWidget * w)
name|void
name|drawcolor2
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|lastw
init|=
name|NULL
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guchar
name|buf
index|[
name|COLORBUTTONWIDTH
operator|*
literal|3
index|]
decl_stmt|;
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
if|if
condition|(
name|w
condition|)
name|lastw
operator|=
name|w
expr_stmt|;
else|else
name|w
operator|=
name|lastw
expr_stmt|;
if|if
condition|(
operator|!
name|w
condition|)
return|return;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|COLORBUTTONWIDTH
condition|;
name|x
operator|++
control|)
block|{
name|buf
index|[
name|x
operator|*
literal|3
operator|+
literal|0
index|]
operator|=
name|t
operator|->
name|color2
operator|.
name|x
operator|*
literal|255.0
expr_stmt|;
name|buf
index|[
name|x
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|t
operator|->
name|color2
operator|.
name|y
operator|*
literal|255.0
expr_stmt|;
name|buf
index|[
name|x
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|t
operator|->
name|color2
operator|.
name|z
operator|*
literal|255.0
expr_stmt|;
block|}
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|COLORBUTTONHEIGHT
condition|;
name|y
operator|++
control|)
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|w
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|COLORBUTTONWIDTH
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|w
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|selectcolor1_ok (GtkWidget * w,gpointer d)
name|void
name|selectcolor1_ok
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|d
parameter_list|)
block|{
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
name|GtkWidget
modifier|*
name|win
init|=
operator|(
name|GtkWidget
operator|*
operator|)
name|d
decl_stmt|;
name|gdouble
name|tmpcol
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|gtk_color_selection_get_color
argument_list|(
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|win
argument_list|)
operator|->
name|colorsel
argument_list|)
argument_list|,
name|tmpcol
argument_list|)
expr_stmt|;
name|t
operator|->
name|color1
operator|.
name|x
operator|=
name|tmpcol
index|[
literal|0
index|]
expr_stmt|;
name|t
operator|->
name|color1
operator|.
name|y
operator|=
name|tmpcol
index|[
literal|1
index|]
expr_stmt|;
name|t
operator|->
name|color1
operator|.
name|z
operator|=
name|tmpcol
index|[
literal|2
index|]
expr_stmt|;
name|t
operator|->
name|color1
operator|.
name|w
operator|=
name|tmpcol
index|[
literal|3
index|]
expr_stmt|;
name|drawcolor1
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|win
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|selectcolor2_ok (GtkWidget * w,gpointer d)
name|void
name|selectcolor2_ok
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|d
parameter_list|)
block|{
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
name|GtkWidget
modifier|*
name|win
init|=
operator|(
name|GtkWidget
operator|*
operator|)
name|d
decl_stmt|;
name|gdouble
name|tmpcol
index|[
literal|4
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
name|gtk_color_selection_get_color
argument_list|(
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|win
argument_list|)
operator|->
name|colorsel
argument_list|)
argument_list|,
name|tmpcol
argument_list|)
expr_stmt|;
name|t
operator|->
name|color2
operator|.
name|x
operator|=
name|tmpcol
index|[
literal|0
index|]
expr_stmt|;
name|t
operator|->
name|color2
operator|.
name|y
operator|=
name|tmpcol
index|[
literal|1
index|]
expr_stmt|;
name|t
operator|->
name|color2
operator|.
name|z
operator|=
name|tmpcol
index|[
literal|2
index|]
expr_stmt|;
name|t
operator|->
name|color2
operator|.
name|w
operator|=
name|tmpcol
index|[
literal|3
index|]
expr_stmt|;
name|drawcolor2
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|win
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|selectcolor1 (vector * col)
name|void
name|selectcolor1
parameter_list|(
name|vector
modifier|*
name|col
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|window
init|=
name|NULL
decl_stmt|;
name|gdouble
name|tmpcol
index|[
literal|4
index|]
decl_stmt|;
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
if|if
condition|(
name|window
condition|)
block|{
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|gdk_window_raise
argument_list|(
name|window
operator|->
name|window
argument_list|)
expr_stmt|;
return|return;
block|}
name|window
operator|=
name|gtk_color_selection_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Color Selection Dialog"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_color_selection_set_opacity
argument_list|(
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|colorsel
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|window
argument_list|)
expr_stmt|;
name|tmpcol
index|[
literal|0
index|]
operator|=
name|t
operator|->
name|color1
operator|.
name|x
expr_stmt|;
name|tmpcol
index|[
literal|1
index|]
operator|=
name|t
operator|->
name|color1
operator|.
name|y
expr_stmt|;
name|tmpcol
index|[
literal|2
index|]
operator|=
name|t
operator|->
name|color1
operator|.
name|z
expr_stmt|;
name|tmpcol
index|[
literal|3
index|]
operator|=
name|t
operator|->
name|color1
operator|.
name|w
expr_stmt|;
name|gtk_color_selection_set_color
argument_list|(
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|colorsel
argument_list|)
argument_list|,
name|tmpcol
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|selectcolor1_ok
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_widget_destroy
argument_list|)
argument_list|,
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|selectcolor2 (vector * col)
name|void
name|selectcolor2
parameter_list|(
name|vector
modifier|*
name|col
parameter_list|)
block|{
specifier|static
name|GtkWidget
modifier|*
name|window
init|=
name|NULL
decl_stmt|;
name|gdouble
name|tmpcol
index|[
literal|4
index|]
decl_stmt|;
name|texture
modifier|*
name|t
init|=
name|currenttexture
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|t
condition|)
return|return;
if|if
condition|(
name|window
condition|)
block|{
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|gdk_window_raise
argument_list|(
name|window
operator|->
name|window
argument_list|)
expr_stmt|;
return|return;
block|}
name|window
operator|=
name|gtk_color_selection_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Color Selection Dialog"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_color_selection_set_opacity
argument_list|(
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|colorsel
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_widget_destroyed
argument_list|)
argument_list|,
operator|&
name|window
argument_list|)
expr_stmt|;
name|tmpcol
index|[
literal|0
index|]
operator|=
name|t
operator|->
name|color2
operator|.
name|x
expr_stmt|;
name|tmpcol
index|[
literal|1
index|]
operator|=
name|t
operator|->
name|color2
operator|.
name|y
expr_stmt|;
name|tmpcol
index|[
literal|2
index|]
operator|=
name|t
operator|->
name|color2
operator|.
name|z
expr_stmt|;
name|tmpcol
index|[
literal|3
index|]
operator|=
name|t
operator|->
name|color2
operator|.
name|w
expr_stmt|;
name|gtk_color_selection_set_color
argument_list|(
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|colorsel
argument_list|)
argument_list|,
name|tmpcol
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|selectcolor2_ok
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_widget_destroy
argument_list|)
argument_list|,
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
DECL|variable|do_run
name|int
name|do_run
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
DECL|function|sphere_ok (GtkWidget * widget,gpointer data)
name|void
name|sphere_ok
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|running
operator|=
operator|-
literal|1
expr_stmt|;
name|do_run
operator|=
literal|1
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|sphere_cancel (GtkWidget * widget,gpointer data)
name|void
name|sphere_cancel
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_widget_hide
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
DECL|function|makewindow (void)
name|GtkWidget
modifier|*
name|makewindow
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|window
decl_stmt|;
name|GtkWidget
modifier|*
name|table1
decl_stmt|;
name|GtkWidget
modifier|*
name|frame2
decl_stmt|;
name|GtkWidget
modifier|*
name|frame3
decl_stmt|;
name|GtkWidget
modifier|*
name|viewport2
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox1
decl_stmt|;
name|GtkWidget
modifier|*
name|addbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|dupbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|delbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|loadbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|savebutton
decl_stmt|;
name|GtkWidget
modifier|*
name|okbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|cancelbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|resetbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|frame4
decl_stmt|;
name|GtkWidget
modifier|*
name|table2
decl_stmt|;
name|GtkWidget
modifier|*
name|label2
decl_stmt|;
name|GtkWidget
modifier|*
name|label3
decl_stmt|;
name|GtkWidget
modifier|*
name|label4
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox3
decl_stmt|;
name|GtkWidget
modifier|*
name|colorbutton1
decl_stmt|;
name|GtkWidget
modifier|*
name|colorbutton2
decl_stmt|;
name|GtkWidget
modifier|*
name|label5
decl_stmt|;
name|GtkWidget
modifier|*
name|label6
decl_stmt|;
name|GtkWidget
modifier|*
name|item
decl_stmt|;
name|GtkWidget
modifier|*
name|label7
decl_stmt|;
name|GtkWidget
modifier|*
name|label8
decl_stmt|;
name|GtkWidget
modifier|*
name|updatebutton
decl_stmt|;
name|GtkWidget
modifier|*
name|label1
decl_stmt|;
name|GtkWidget
modifier|*
name|_scalescale
decl_stmt|;
name|GtkWidget
modifier|*
name|_rotscale
decl_stmt|;
name|GtkWidget
modifier|*
name|_turbulencescale
decl_stmt|;
name|GtkWidget
modifier|*
name|_amountscale
decl_stmt|;
name|GtkWidget
modifier|*
name|_expscale
decl_stmt|;
name|GtkWidget
modifier|*
name|tmpw
decl_stmt|;
name|window
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Sphere Designer"
argument_list|)
argument_list|,
literal|"spheredesigner"
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"filters/spheredesigner.html"
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"OK"
argument_list|)
argument_list|,
name|sphere_ok
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|okbutton
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Reset"
argument_list|)
argument_list|,
name|sphere_reset
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|resetbutton
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
name|sphere_cancel
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|cancelbutton
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"window"
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"okbutton"
argument_list|,
name|okbutton
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"cancelbutton"
argument_list|,
name|cancelbutton
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"resetbutton"
argument_list|,
name|cancelbutton
argument_list|)
expr_stmt|;
name|table1
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"table1"
argument_list|,
name|table1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|table1
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table1
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|frame2
operator|=
name|gtk_frame_new
argument_list|(
name|_
argument_list|(
literal|"Preview"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"frame2"
argument_list|,
name|frame2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame2
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
name|frame2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|drawarea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"drawarea"
argument_list|,
name|drawarea
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|drawarea
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame2
argument_list|)
argument_list|,
name|drawarea
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|drawarea
argument_list|,
name|PREVIEWSIZE
argument_list|,
name|PREVIEWSIZE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|drawarea
argument_list|)
argument_list|,
literal|"expose_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|expose_event
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|updatebutton
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Update"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"updatebutton"
argument_list|,
name|updatebutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|updatebutton
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
name|updatebutton
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|updatebutton
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|restartrender
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|frame3
operator|=
name|gtk_frame_new
argument_list|(
name|_
argument_list|(
literal|"Textures"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"frame3"
argument_list|,
name|frame3
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame3
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
name|frame3
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|viewport2
operator|=
name|gtk_viewport_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"viewport2"
argument_list|,
name|viewport2
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|viewport2
argument_list|,
literal|150
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|viewport2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame3
argument_list|)
argument_list|,
name|viewport2
argument_list|)
expr_stmt|;
name|texturelist
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"texturelist"
argument_list|,
name|texturelist
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|texturelist
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|viewport2
argument_list|)
argument_list|,
name|texturelist
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|texturelist
argument_list|)
argument_list|,
literal|"selection_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|selectitem
argument_list|)
argument_list|,
name|texturelist
argument_list|)
expr_stmt|;
name|hbox1
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"hbox1"
argument_list|,
name|hbox1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox1
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
name|hbox1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|addbutton
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Add"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"addbutton"
argument_list|,
name|addbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|addbutton
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox1
argument_list|)
argument_list|,
name|addbutton
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|addbutton
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|addtexture
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|dupbutton
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Dup"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"dupbutton"
argument_list|,
name|dupbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dupbutton
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox1
argument_list|)
argument_list|,
name|dupbutton
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dupbutton
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|duptexture
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|delbutton
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Del"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"delbutton"
argument_list|,
name|delbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|delbutton
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox1
argument_list|)
argument_list|,
name|delbutton
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|delbutton
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|deltexture
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|hbox1
operator|=
name|gtk_hbox_new
argument_list|(
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"hbox1"
argument_list|,
name|hbox1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox1
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
name|hbox1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|loadbutton
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Load"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"loadbutton"
argument_list|,
name|loadbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|loadbutton
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox1
argument_list|)
argument_list|,
name|loadbutton
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|loadbutton
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|loadpreset
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|savebutton
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Save"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"savebutton"
argument_list|,
name|savebutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|savebutton
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox1
argument_list|)
argument_list|,
name|savebutton
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|savebutton
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|savepreset
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|frame4
operator|=
name|gtk_frame_new
argument_list|(
name|_
argument_list|(
literal|"Texture Properties"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"frame4"
argument_list|,
name|frame4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame4
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table1
argument_list|)
argument_list|,
name|frame4
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|table2
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|4
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"table2"
argument_list|,
name|table2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame4
argument_list|)
argument_list|,
name|table2
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table2
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|label2
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Type:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label2"
argument_list|,
name|label2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label2
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label2
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|label3
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Texture:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label3"
argument_list|,
name|label3
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label3
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label3
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label3
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|label4
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Colors:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label4"
argument_list|,
name|label4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label4
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label4
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label4
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|hbox3
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"hbox3"
argument_list|,
name|hbox3
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox3
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|hbox3
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|colorbutton1
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"colorbutton1"
argument_list|,
name|colorbutton1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|colorbutton1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox3
argument_list|)
argument_list|,
name|colorbutton1
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|colorbutton1
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|selectcolor1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|tmpw
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|tmpw
argument_list|)
argument_list|,
name|COLORBUTTONWIDTH
argument_list|,
name|COLORBUTTONHEIGHT
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|colorbutton1
argument_list|)
argument_list|,
name|tmpw
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|tmpw
argument_list|)
expr_stmt|;
name|drawcolor1
argument_list|(
name|tmpw
argument_list|)
expr_stmt|;
name|colorbutton2
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"colorbutton2"
argument_list|,
name|colorbutton2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|colorbutton2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox3
argument_list|)
argument_list|,
name|colorbutton2
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|colorbutton2
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|selectcolor2
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|tmpw
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|tmpw
argument_list|)
argument_list|,
name|COLORBUTTONWIDTH
argument_list|,
name|COLORBUTTONHEIGHT
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|colorbutton2
argument_list|)
argument_list|,
name|tmpw
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|tmpw
argument_list|)
expr_stmt|;
name|drawcolor2
argument_list|(
name|tmpw
argument_list|)
expr_stmt|;
name|label5
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Scale:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label5"
argument_list|,
name|label5
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label5
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label5
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_scalescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scalescale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|5.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_scalescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_scalescale"
argument_list|,
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_scalescale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_scalescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scalescale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label5
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Turbulence:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label5"
argument_list|,
name|label5
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label5
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label5
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_turbulencescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|turbulencescale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|5.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_turbulencescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_turbulencescale"
argument_list|,
name|_turbulencescale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_turbulencescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_turbulencescale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_turbulencescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|turbulencescale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Scale X:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_scalescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scalexscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|5.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_scalescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_scalescale"
argument_list|,
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_scalescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_scalescale
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scalexscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Scale Y:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_scalescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scaleyscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|5.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_scalescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_scalescale"
argument_list|,
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_scalescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_scalescale
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scaleyscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Scale Z:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_scalescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scalezscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|5.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_scalescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_scalescale"
argument_list|,
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_scalescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_scalescale
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|scalezscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Rotate X:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_rotscale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|rotxscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|360.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_rotscale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_rotscale"
argument_list|,
name|_rotscale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_rotscale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_rotscale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_rotscale
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|rotxscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Rotate Y:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_rotscale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|rotyscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|360.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_rotscale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_rotscale"
argument_list|,
name|_rotscale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_rotscale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_rotscale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_rotscale
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|rotyscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Rotate Z:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_rotscale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|rotzscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|360.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_rotscale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_rotscale"
argument_list|,
name|_rotscale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_rotscale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_rotscale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_rotscale
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|rotzscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Pos X:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_scalescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|posxscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
operator|-
literal|20.0
argument_list|,
literal|20.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_scalescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_scalescale"
argument_list|,
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_scalescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_scalescale
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|posxscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Pos Y:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_scalescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|posyscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
operator|-
literal|20.0
argument_list|,
literal|20.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_scalescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_scalescale"
argument_list|,
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_scalescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_scalescale
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|posyscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label6
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Pos Z:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label6"
argument_list|,
name|label6
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label6
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label6
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label6
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_scalescale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|poszscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
operator|-
literal|20.0
argument_list|,
literal|20.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_scalescale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_scalescale"
argument_list|,
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_scalescale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_scalescale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_scalescale
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|poszscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|typemenu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"typemenu"
argument_list|,
name|typemenu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|typemenu
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|typemenu
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|typemenu_menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|item
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Texture"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|selecttype
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|typemenu_menu
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Bump"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|selecttype
argument_list|)
argument_list|,
operator|(
name|long
operator|*
operator|)
literal|1
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|typemenu_menu
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Light"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|selecttype
argument_list|)
argument_list|,
operator|(
name|long
operator|*
operator|)
literal|2
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|typemenu_menu
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|typemenu
argument_list|)
argument_list|,
name|typemenu_menu
argument_list|)
expr_stmt|;
name|texturemenu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"texturemenu"
argument_list|,
name|texturemenu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|texturemenu
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|texturemenu
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|texturemenu_menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|mktexturemenu
argument_list|(
name|texturemenu_menu
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|texturemenu
argument_list|)
argument_list|,
name|texturemenu_menu
argument_list|)
expr_stmt|;
name|label7
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Amount:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label7"
argument_list|,
name|label7
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label7
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label7
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label7
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_amountscale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|amountscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0
argument_list|,
literal|1.01
argument_list|,
literal|.01
argument_list|,
literal|.01
argument_list|,
literal|.01
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_amountscale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_amountscale"
argument_list|,
name|_amountscale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_amountscale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_amountscale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_amountscale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|amountscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label8
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Exp:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label8"
argument_list|,
name|label8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label8
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|label8
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label8
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|_expscale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|expscale
operator|=
name|gtk_adjustment_new
argument_list|(
literal|1.0
argument_list|,
literal|0
argument_list|,
literal|1.01
argument_list|,
literal|.01
argument_list|,
literal|.01
argument_list|,
literal|.01
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|_expscale
argument_list|,
literal|100
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"_expscale"
argument_list|,
name|_expscale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|_expscale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table2
argument_list|)
argument_list|,
name|_expscale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|6
argument_list|,
literal|7
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
operator|(
name|GtkAttachOptions
operator|)
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|_expscale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|expscale
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|getscales
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|label1
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"by Vidar Madsen\nSeptember 1999"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"label1"
argument_list|,
name|label1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|window
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|label1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
return|return
name|window
return|;
block|}
end_function

begin_function
DECL|function|pixelval (double v)
name|unsigned
name|char
name|pixelval
parameter_list|(
name|double
name|v
parameter_list|)
block|{
name|v
operator|+=
literal|0.5
expr_stmt|;
if|if
condition|(
name|v
operator|<
literal|0.0
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|v
operator|>
literal|255.0
condition|)
return|return
literal|255
return|;
return|return
name|v
return|;
block|}
end_function

begin_function
DECL|function|render (void)
name|void
name|render
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|p
decl_stmt|;
name|ray
name|r
decl_stmt|;
name|vector
name|col
decl_stmt|;
name|int
name|hit
decl_stmt|;
name|int
name|tx
decl_stmt|,
name|ty
decl_stmt|;
name|guchar
modifier|*
name|dest_row
decl_stmt|;
name|int
name|bpp
decl_stmt|;
name|r
operator|.
name|v1
operator|.
name|z
operator|=
operator|-
literal|10.0
expr_stmt|;
name|r
operator|.
name|v2
operator|.
name|z
operator|=
literal|0.0
expr_stmt|;
name|running
operator|=
literal|2
expr_stmt|;
name|tx
operator|=
name|PREVIEWSIZE
expr_stmt|;
name|ty
operator|=
name|PREVIEWSIZE
expr_stmt|;
name|bpp
operator|=
literal|3
expr_stmt|;
while|while
condition|(
name|running
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|running
operator|==
literal|2
condition|)
block|{
name|running
operator|=
literal|1
expr_stmt|;
name|initworld
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|world
operator|.
name|obj
index|[
literal|0
index|]
operator|.
name|com
operator|.
name|numtexture
operator|==
literal|0
condition|)
break|break;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|ty
condition|;
name|y
operator|++
control|)
block|{
name|dest_row
operator|=
name|img
operator|+
name|y
operator|*
name|PREVIEWSIZE
operator|*
literal|3
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|tx
condition|;
name|x
operator|++
control|)
block|{
name|int
name|g
decl_stmt|,
name|gridsize
init|=
literal|16
decl_stmt|;
name|g
operator|=
operator|(
operator|(
name|x
operator|/
name|gridsize
operator|+
name|y
operator|/
name|gridsize
operator|)
operator|%
literal|2
operator|)
operator|*
literal|60
operator|+
literal|100
expr_stmt|;
name|r
operator|.
name|v1
operator|.
name|x
operator|=
name|r
operator|.
name|v2
operator|.
name|x
operator|=
literal|8.5
operator|*
operator|(
name|x
operator|/
call|(
name|float
call|)
argument_list|(
name|tx
operator|-
literal|1
argument_list|)
operator|-
literal|0.5
operator|)
expr_stmt|;
name|r
operator|.
name|v1
operator|.
name|y
operator|=
name|r
operator|.
name|v2
operator|.
name|y
operator|=
literal|8.5
operator|*
operator|(
name|y
operator|/
call|(
name|float
call|)
argument_list|(
name|ty
operator|-
literal|1
argument_list|)
operator|-
literal|0.5
operator|)
expr_stmt|;
name|p
operator|=
name|x
operator|*
name|bpp
expr_stmt|;
name|hit
operator|=
name|traceray
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|col
argument_list|,
literal|10
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|col
operator|.
name|w
operator|<
literal|0.0
condition|)
name|col
operator|.
name|w
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|col
operator|.
name|w
operator|>
literal|1.0
condition|)
name|col
operator|.
name|w
operator|=
literal|1.0
expr_stmt|;
name|dest_row
index|[
name|p
operator|+
literal|0
index|]
operator|=
name|pixelval
argument_list|(
literal|255
operator|*
name|col
operator|.
name|x
argument_list|)
operator|*
name|col
operator|.
name|w
operator|+
name|g
operator|*
operator|(
literal|1.0
operator|-
name|col
operator|.
name|w
operator|)
expr_stmt|;
name|dest_row
index|[
name|p
operator|+
literal|1
index|]
operator|=
name|pixelval
argument_list|(
literal|255
operator|*
name|col
operator|.
name|y
argument_list|)
operator|*
name|col
operator|.
name|w
operator|+
name|g
operator|*
operator|(
literal|1.0
operator|-
name|col
operator|.
name|w
operator|)
expr_stmt|;
name|dest_row
index|[
name|p
operator|+
literal|2
index|]
operator|=
name|pixelval
argument_list|(
literal|255
operator|*
name|col
operator|.
name|z
argument_list|)
operator|*
name|col
operator|.
name|w
operator|+
name|g
operator|*
operator|(
literal|1.0
operator|-
name|col
operator|.
name|w
operator|)
expr_stmt|;
if|if
condition|(
name|running
operator|!=
literal|1
condition|)
block|{
break|break;
block|}
block|}
name|drawit
argument_list|(
name|img
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
if|if
condition|(
name|running
operator|!=
literal|1
condition|)
block|{
break|break;
block|}
block|}
if|if
condition|(
name|running
operator|==
literal|1
condition|)
break|break;
if|if
condition|(
name|running
operator|==
operator|-
literal|1
condition|)
break|break;
block|}
name|running
operator|=
literal|0
expr_stmt|;
name|drawit
argument_list|(
name|img
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|realrender (GDrawable * drawable)
name|void
name|realrender
parameter_list|(
name|GDrawable
modifier|*
name|drawable
parameter_list|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|,
name|alpha
decl_stmt|;
name|ray
name|r
decl_stmt|;
name|vector
name|rcol
decl_stmt|;
name|int
name|tx
decl_stmt|,
name|ty
decl_stmt|;
name|gint
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
name|int
name|bpp
decl_stmt|;
name|GPixelRgn
name|pr
decl_stmt|,
name|dpr
decl_stmt|;
name|guchar
modifier|*
name|buffer
decl_stmt|,
modifier|*
name|ibuffer
decl_stmt|;
if|if
condition|(
name|running
operator|>
literal|0
condition|)
return|return;
comment|/* Fixme: abort preview-render instead! */
name|initworld
argument_list|()
expr_stmt|;
name|r
operator|.
name|v1
operator|.
name|z
operator|=
operator|-
literal|10.0
expr_stmt|;
name|r
operator|.
name|v2
operator|.
name|z
operator|=
literal|0.0
expr_stmt|;
name|alpha
operator|=
name|gimp_drawable_has_alpha
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|pr
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|gimp_drawable_width
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
argument_list|,
name|gimp_drawable_height
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|dpr
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|gimp_drawable_width
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
argument_list|,
name|gimp_drawable_height
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|bpp
operator|=
name|gimp_drawable_bpp
argument_list|(
name|drawable
operator|->
name|id
argument_list|)
expr_stmt|;
name|buffer
operator|=
name|g_malloc
argument_list|(
operator|(
name|x2
operator|-
name|x1
operator|)
operator|*
literal|4
argument_list|)
expr_stmt|;
name|ibuffer
operator|=
name|g_malloc
argument_list|(
operator|(
name|x2
operator|-
name|x1
operator|)
operator|*
literal|4
argument_list|)
expr_stmt|;
name|tx
operator|=
name|x2
operator|-
name|x1
expr_stmt|;
name|ty
operator|=
name|y2
operator|-
name|y1
expr_stmt|;
name|gimp_progress_init
argument_list|(
name|_
argument_list|(
literal|"Rendering..."
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|ty
condition|;
name|y
operator|++
control|)
block|{
name|dest
operator|=
name|buffer
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|tx
condition|;
name|x
operator|++
control|)
block|{
name|r
operator|.
name|v1
operator|.
name|x
operator|=
name|r
operator|.
name|v2
operator|.
name|x
operator|=
literal|8.1
operator|*
operator|(
name|x
operator|/
call|(
name|float
call|)
argument_list|(
name|tx
operator|-
literal|1
argument_list|)
operator|-
literal|0.5
operator|)
expr_stmt|;
name|r
operator|.
name|v1
operator|.
name|y
operator|=
name|r
operator|.
name|v2
operator|.
name|y
operator|=
literal|8.1
operator|*
operator|(
name|y
operator|/
call|(
name|float
call|)
argument_list|(
name|ty
operator|-
literal|1
argument_list|)
operator|-
literal|0.5
operator|)
expr_stmt|;
name|traceray
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|rcol
argument_list|,
literal|10
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|dest
index|[
literal|0
index|]
operator|=
name|pixelval
argument_list|(
literal|255
operator|*
name|rcol
operator|.
name|x
argument_list|)
expr_stmt|;
name|dest
index|[
literal|1
index|]
operator|=
name|pixelval
argument_list|(
literal|255
operator|*
name|rcol
operator|.
name|y
argument_list|)
expr_stmt|;
name|dest
index|[
literal|2
index|]
operator|=
name|pixelval
argument_list|(
literal|255
operator|*
name|rcol
operator|.
name|z
argument_list|)
expr_stmt|;
name|dest
index|[
literal|3
index|]
operator|=
name|pixelval
argument_list|(
literal|255
operator|*
name|rcol
operator|.
name|w
argument_list|)
expr_stmt|;
name|dest
operator|+=
literal|4
expr_stmt|;
block|}
name|gimp_pixel_rgn_get_row
argument_list|(
operator|&
name|pr
argument_list|,
name|ibuffer
argument_list|,
name|x1
argument_list|,
name|y1
operator|+
name|y
argument_list|,
name|x2
operator|-
name|x1
argument_list|)
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
operator|(
name|x2
operator|-
name|x1
operator|)
condition|;
name|x
operator|++
control|)
block|{
name|int
name|k
decl_stmt|,
name|dx
init|=
name|x
operator|*
literal|4
decl_stmt|,
name|sx
init|=
name|x
operator|*
name|bpp
decl_stmt|;
name|float
name|a
init|=
name|buffer
index|[
name|dx
operator|+
literal|3
index|]
operator|/
literal|255.0
decl_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|bpp
condition|;
name|k
operator|++
control|)
block|{
name|ibuffer
index|[
name|sx
operator|+
name|k
index|]
operator|=
name|buffer
index|[
name|dx
operator|+
name|k
index|]
operator|*
name|a
operator|+
name|ibuffer
index|[
name|sx
operator|+
name|k
index|]
operator|*
operator|(
literal|1.0
operator|-
name|a
operator|)
expr_stmt|;
block|}
block|}
name|gimp_pixel_rgn_set_row
argument_list|(
operator|&
name|dpr
argument_list|,
name|ibuffer
argument_list|,
name|x1
argument_list|,
name|y1
operator|+
name|y
argument_list|,
name|x2
operator|-
name|x1
argument_list|)
expr_stmt|;
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|y
operator|/
operator|(
name|double
operator|)
name|ty
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|ibuffer
argument_list|)
expr_stmt|;
name|gimp_drawable_flush
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
operator|->
name|id
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|query (void)
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GParamDef
name|args
index|[]
init|=
block|{
block|{
name|PARAM_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|PARAM_IMAGE
block|,
literal|"image"
block|,
literal|"Input image (unused)"
block|}
block|,
block|{
name|PARAM_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|}
decl_stmt|;
specifier|static
name|gint
name|nargs
init|=
sizeof|sizeof
argument_list|(
name|args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"plug_in_spheredesigner"
argument_list|,
literal|"Renders textures spheres"
argument_list|,
literal|"This plugin can be used to create textured and/or bumpmapped spheres, and uses a small lightweight raytracer to perform the task with good quality"
argument_list|,
literal|"Vidar Madsen"
argument_list|,
literal|"Vidar Madsen"
argument_list|,
literal|"1999"
argument_list|,
name|N_
argument_list|(
literal|"<Image>/Filters/Render/Sphere Designer..."
argument_list|)
argument_list|,
literal|"RGB*, GRAY*"
argument_list|,
name|PROC_PLUG_IN
argument_list|,
name|nargs
argument_list|,
literal|0
argument_list|,
name|args
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|sphere_main (GDrawable * drawable)
name|int
name|sphere_main
parameter_list|(
name|GDrawable
modifier|*
name|drawable
parameter_list|)
block|{
name|initworld
argument_list|()
expr_stmt|;
name|gimp_ui_init
argument_list|(
literal|"spheredesigner"
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|img
argument_list|,
literal|0
argument_list|,
name|PREVIEWSIZE
operator|*
name|PREVIEWSIZE
operator|*
literal|3
argument_list|)
expr_stmt|;
name|makewindow
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|s
operator|.
name|com
operator|.
name|numtexture
condition|)
name|sphere_reset
argument_list|()
expr_stmt|;
else|else
name|rebuildlist
argument_list|()
expr_stmt|;
name|drawit
argument_list|(
name|img
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
return|return
name|do_run
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (gchar * name,gint nparams,GParam * param,gint * nreturn_vals,GParam ** return_vals)
name|run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GParam
name|values
index|[
literal|1
index|]
decl_stmt|;
name|GDrawable
modifier|*
name|drawable
decl_stmt|;
name|GRunModeType
name|run_mode
decl_stmt|;
name|GStatusType
name|status
init|=
name|STATUS_SUCCESS
decl_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|RUN_INTERACTIVE
case|:
name|INIT_I18N_UI
argument_list|()
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|numtexture
operator|=
literal|0
expr_stmt|;
name|gimp_get_data
argument_list|(
name|PLUG_IN_NAME
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|sphere_main
argument_list|(
name|drawable
argument_list|)
condition|)
block|{
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
return|return;
block|}
break|break;
case|case
name|RUN_WITH_LAST_VALS
case|:
name|INIT_I18N
argument_list|()
expr_stmt|;
name|s
operator|.
name|com
operator|.
name|numtexture
operator|=
literal|0
expr_stmt|;
name|gimp_get_data
argument_list|(
name|PLUG_IN_NAME
argument_list|,
operator|&
name|s
argument_list|)
expr_stmt|;
if|if
condition|(
name|s
operator|.
name|com
operator|.
name|numtexture
operator|==
literal|0
condition|)
block|{
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
return|return;
block|}
break|break;
case|case
name|RUN_NONINTERACTIVE
case|:
default|default:
comment|/* Not implementet yet... */
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
return|return;
block|}
name|gimp_set_data
argument_list|(
name|PLUG_IN_NAME
argument_list|,
operator|&
name|s
argument_list|,
sizeof|sizeof
argument_list|(
name|s
argument_list|)
argument_list|)
expr_stmt|;
name|realrender
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|gimp_displays_flush
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|PARAM_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
end_function

begin_macro
name|MAIN
argument_list|()
end_macro

end_unit

