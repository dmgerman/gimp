begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This is a plug-in for GIMP.  *  * Copyright (C) 2000 Michael Natterer<mitch@gimp.org>  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|PLUG_IN_PROC
define|#
directive|define
name|PLUG_IN_PROC
value|"plug-in-unit-editor"
end_define

begin_define
DECL|macro|PLUG_IN_BINARY
define|#
directive|define
name|PLUG_IN_BINARY
value|"unit-editor"
end_define

begin_define
DECL|macro|RESPONSE_REFRESH
define|#
directive|define
name|RESPONSE_REFRESH
value|1
end_define

begin_enum
enum|enum
DECL|enum|__anon27b581830103
block|{
DECL|enumerator|SAVE
name|SAVE
block|,
DECL|enumerator|IDENTIFIER
name|IDENTIFIER
block|,
DECL|enumerator|FACTOR
name|FACTOR
block|,
DECL|enumerator|DIGITS
name|DIGITS
block|,
DECL|enumerator|SYMBOL
name|SYMBOL
block|,
DECL|enumerator|ABBREVIATION
name|ABBREVIATION
block|,
DECL|enumerator|SINGULAR
name|SINGULAR
block|,
DECL|enumerator|PLURAL
name|PLURAL
block|,
DECL|enumerator|UNIT
name|UNIT
block|,
DECL|enumerator|USER_UNIT
name|USER_UNIT
block|,
DECL|enumerator|BG_COLOR
name|BG_COLOR
block|,
DECL|enumerator|NUM_COLUMNS
name|NUM_COLUMNS
block|}
enum|;
end_enum

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon27b581830208
block|{
DECL|member|title
specifier|const
name|gchar
modifier|*
name|title
decl_stmt|;
DECL|member|help
specifier|const
name|gchar
modifier|*
name|help
decl_stmt|;
DECL|typedef|UnitColumn
block|}
name|UnitColumn
typedef|;
end_typedef

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|n_params
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|n_return_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpUnit
name|new_unit_dialog
parameter_list|(
name|GtkWidget
modifier|*
name|main_dialog
parameter_list|,
name|GimpUnit
name|template
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|unit_editor_dialog
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|unit_editor_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|new_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|GtkTreeView
modifier|*
name|tv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|duplicate_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|GtkTreeView
modifier|*
name|tv
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|saved_toggled_callback
parameter_list|(
name|GtkCellRendererToggle
modifier|*
name|celltoggle
parameter_list|,
name|gchar
modifier|*
name|path_string
parameter_list|,
name|GtkListStore
modifier|*
name|list_store
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|unit_list_init
parameter_list|(
name|GtkTreeView
modifier|*
name|tv
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
specifier|const
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|columns
specifier|static
specifier|const
name|UnitColumn
name|columns
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"Saved"
argument_list|)
block|,
name|N_
argument_list|(
literal|"A unit definition will only be saved before "
literal|"GIMP exits if this column is checked."
argument_list|)
block|}
block|,
block|{
name|N_
argument_list|(
literal|"ID"
argument_list|)
block|,
name|N_
argument_list|(
literal|"This string will be used to identify a "
literal|"unit in GIMP's configuration files."
argument_list|)
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Factor"
argument_list|)
block|,
name|N_
argument_list|(
literal|"How many units make up an inch."
argument_list|)
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Digits"
argument_list|)
block|,
name|N_
argument_list|(
literal|"This field is a hint for numerical input "
literal|"fields. It specifies how many decimal digits "
literal|"the input field should provide to get "
literal|"approximately the same accuracy as an "
literal|"\"inch\" input field with two decimal digits."
argument_list|)
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Symbol"
argument_list|)
block|,
name|N_
argument_list|(
literal|"The unit's symbol if it has one (e.g. \" "
literal|"for inches). The unit's abbreviation is used "
literal|"if doesn't have a symbol."
argument_list|)
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Abbreviation"
argument_list|)
block|,
name|N_
argument_list|(
literal|"The unit's abbreviation (e.g. \"cm\" for "
literal|"centimeters)."
argument_list|)
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Singular"
argument_list|)
block|,
name|N_
argument_list|(
literal|"The unit's singular form."
argument_list|)
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Plural"
argument_list|)
block|,
name|N_
argument_list|(
literal|"The unit's plural form."
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|actions
specifier|static
name|GtkActionEntry
name|actions
index|[]
init|=
block|{
block|{
literal|"unit-editor-toolbar"
block|,
name|NULL
block|,
literal|"Unit Editor Toolbar"
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"unit-editor-new"
block|,
name|GTK_STOCK_NEW
block|,
name|NULL
block|,
literal|"<control>N"
block|,
name|N_
argument_list|(
literal|"Create a new unit from scratch"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|new_callback
argument_list|)
block|}
block|,
block|{
literal|"unit-editor-duplicate"
block|,
name|GIMP_STOCK_DUPLICATE
block|,
name|NULL
block|,
literal|"<control>D"
block|,
name|N_
argument_list|(
literal|"Create a new unit using the currently selected unit as template"
argument_list|)
block|,
name|G_CALLBACK
argument_list|(
argument|duplicate_callback
argument_list|)
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
specifier|const
name|GimpParamDef
name|args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode { RUN-INTERACTIVE (0) }"
block|}
block|}
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|N_
argument_list|(
literal|"Create or alter units used in GIMP"
argument_list|)
argument_list|,
literal|"The GIMP unit editor"
argument_list|,
literal|"Michael Natterer<mitch@gimp.org>"
argument_list|,
literal|"Michael Natterer<mitch@gimp.org>"
argument_list|,
literal|"2000"
argument_list|,
name|N_
argument_list|(
literal|"U_nits"
argument_list|)
argument_list|,
literal|""
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|args
argument_list|)
argument_list|,
literal|0
argument_list|,
name|args
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_plugin_menu_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
literal|"<Image>/Edit/Preferences"
argument_list|)
expr_stmt|;
name|gimp_plugin_icon_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|GIMP_ICON_TYPE_STOCK_ID
argument_list|,
operator|(
specifier|const
name|guint8
operator|*
operator|)
name|GIMP_STOCK_TOOL_MEASURE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (const gchar * name,gint nparams,const GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GimpParam
name|values
index|[
literal|2
index|]
decl_stmt|;
name|GimpRunMode
name|run_mode
decl_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|PLUG_IN_PROC
argument_list|)
operator|==
literal|0
condition|)
block|{
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_SUCCESS
expr_stmt|;
name|unit_editor_dialog
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|GimpUnit
DECL|function|new_unit_dialog (GtkWidget * main_dialog,GimpUnit template)
name|new_unit_dialog
parameter_list|(
name|GtkWidget
modifier|*
name|main_dialog
parameter_list|,
name|GimpUnit
name|template
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|identifier_entry
decl_stmt|;
name|GtkObject
modifier|*
name|factor_adj
decl_stmt|;
name|GtkObject
modifier|*
name|digits_adj
decl_stmt|;
name|GtkWidget
modifier|*
name|symbol_entry
decl_stmt|;
name|GtkWidget
modifier|*
name|abbreviation_entry
decl_stmt|;
name|GtkWidget
modifier|*
name|singular_entry
decl_stmt|;
name|GtkWidget
modifier|*
name|plural_entry
decl_stmt|;
name|GimpUnit
name|unit
init|=
name|GIMP_UNIT_PIXEL
decl_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Add a New Unit"
argument_list|)
argument_list|,
name|PLUG_IN_BINARY
argument_list|,
name|main_dialog
argument_list|,
name|GTK_DIALOG_MODAL
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_ADD
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|7
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|entry
operator|=
name|identifier_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|template
operator|!=
name|GIMP_UNIT_PIXEL
condition|)
block|{
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|gimp_unit_get_identifier
argument_list|(
name|template
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"_ID:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|entry
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|IDENTIFIER
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|factor_adj
argument_list|,
operator|(
name|template
operator|!=
name|GIMP_UNIT_PIXEL
operator|)
condition|?
name|gimp_unit_get_factor
argument_list|(
name|template
argument_list|)
else|:
literal|1.0
argument_list|,
name|GIMP_MIN_RESOLUTION
argument_list|,
name|GIMP_MAX_RESOLUTION
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|,
literal|0.01
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"_Factor:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spinbutton
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spinbutton
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|FACTOR
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|digits_adj
argument_list|,
operator|(
name|template
operator|!=
name|GIMP_UNIT_PIXEL
operator|)
condition|?
name|gimp_unit_get_digits
argument_list|(
name|template
argument_list|)
else|:
literal|2.0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"_Digits:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|spinbutton
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|spinbutton
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|DIGITS
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|entry
operator|=
name|symbol_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|template
operator|!=
name|GIMP_UNIT_PIXEL
condition|)
block|{
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|gimp_unit_get_symbol
argument_list|(
name|template
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"_Symbol:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|entry
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|SYMBOL
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|entry
operator|=
name|abbreviation_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|template
operator|!=
name|GIMP_UNIT_PIXEL
condition|)
block|{
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|gimp_unit_get_abbreviation
argument_list|(
name|template
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|4
argument_list|,
name|_
argument_list|(
literal|"_Abbreviation:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|entry
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|ABBREVIATION
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|entry
operator|=
name|singular_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|template
operator|!=
name|GIMP_UNIT_PIXEL
condition|)
block|{
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|gimp_unit_get_singular
argument_list|(
name|template
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
name|_
argument_list|(
literal|"Si_ngular:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|entry
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|SINGULAR
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|entry
operator|=
name|plural_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|template
operator|!=
name|GIMP_UNIT_PIXEL
condition|)
block|{
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|gimp_unit_get_plural
argument_list|(
name|template
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|6
argument_list|,
name|_
argument_list|(
literal|"_Plural:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|entry
argument_list|,
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|entry
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|PLURAL
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
while|while
condition|(
name|TRUE
condition|)
block|{
name|gchar
modifier|*
name|identifier
decl_stmt|;
name|gdouble
name|factor
decl_stmt|;
name|gint
name|digits
decl_stmt|;
name|gchar
modifier|*
name|symbol
decl_stmt|;
name|gchar
modifier|*
name|abbreviation
decl_stmt|;
name|gchar
modifier|*
name|singular
decl_stmt|;
name|gchar
modifier|*
name|plural
decl_stmt|;
if|if
condition|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|!=
name|GTK_RESPONSE_OK
condition|)
break|break;
name|identifier
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|identifier_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|factor
operator|=
name|gtk_adjustment_get_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|factor_adj
argument_list|)
argument_list|)
expr_stmt|;
name|digits
operator|=
name|gtk_adjustment_get_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|digits_adj
argument_list|)
argument_list|)
expr_stmt|;
name|symbol
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|symbol_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|abbreviation
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|abbreviation_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|singular
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|singular_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|plural
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|plural_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|identifier
operator|=
name|g_strstrip
argument_list|(
name|identifier
argument_list|)
expr_stmt|;
name|symbol
operator|=
name|g_strstrip
argument_list|(
name|symbol
argument_list|)
expr_stmt|;
name|abbreviation
operator|=
name|g_strstrip
argument_list|(
name|abbreviation
argument_list|)
expr_stmt|;
name|singular
operator|=
name|g_strstrip
argument_list|(
name|singular
argument_list|)
expr_stmt|;
name|plural
operator|=
name|g_strstrip
argument_list|(
name|plural
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strlen
argument_list|(
name|identifier
argument_list|)
operator||
operator|!
name|strlen
argument_list|(
name|symbol
argument_list|)
operator||
operator|!
name|strlen
argument_list|(
name|abbreviation
argument_list|)
operator||
operator|!
name|strlen
argument_list|(
name|singular
argument_list|)
operator||
operator|!
name|strlen
argument_list|(
name|plural
argument_list|)
condition|)
block|{
name|GtkWidget
modifier|*
name|msg
init|=
name|gtk_message_dialog_new
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|0
argument_list|,
name|GTK_MESSAGE_ERROR
argument_list|,
name|GTK_BUTTONS_OK
argument_list|,
name|_
argument_list|(
literal|"Incomplete input"
argument_list|)
argument_list|)
decl_stmt|;
name|gtk_message_dialog_format_secondary_text
argument_list|(
name|GTK_MESSAGE_DIALOG
argument_list|(
name|msg
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Please fill in all text fields."
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_dialog_run
argument_list|(
name|GTK_DIALOG
argument_list|(
name|msg
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|msg
argument_list|)
expr_stmt|;
continue|continue;
block|}
name|unit
operator|=
name|gimp_unit_new
argument_list|(
name|identifier
argument_list|,
name|factor
argument_list|,
name|digits
argument_list|,
name|symbol
argument_list|,
name|abbreviation
argument_list|,
name|singular
argument_list|,
name|plural
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|identifier
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|symbol
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|abbreviation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|singular
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|plural
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
return|return
name|unit
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|unit_editor_dialog (void)
name|unit_editor_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
name|GtkUIManager
modifier|*
name|ui_manager
decl_stmt|;
name|GtkActionGroup
modifier|*
name|group
decl_stmt|;
name|GtkWidget
modifier|*
name|toolbar
decl_stmt|;
name|GtkListStore
modifier|*
name|list_store
decl_stmt|;
name|GtkWidget
modifier|*
name|tv
decl_stmt|;
name|GtkTreeViewColumn
modifier|*
name|col
decl_stmt|;
name|GtkWidget
modifier|*
name|col_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkCellRenderer
modifier|*
name|rend
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|list_store
operator|=
name|gtk_list_store_new
argument_list|(
name|NUM_COLUMNS
argument_list|,
name|G_TYPE_BOOLEAN
argument_list|,
comment|/*  SAVE          */
name|G_TYPE_STRING
argument_list|,
comment|/*  IDENTIFIER    */
name|G_TYPE_DOUBLE
argument_list|,
comment|/*  FACTOR        */
name|G_TYPE_INT
argument_list|,
comment|/*  DIGITS        */
name|G_TYPE_STRING
argument_list|,
comment|/*  SYMBOL        */
name|G_TYPE_STRING
argument_list|,
comment|/*  ABBREVIATION  */
name|G_TYPE_STRING
argument_list|,
comment|/*  SINGULAR      */
name|G_TYPE_STRING
argument_list|,
comment|/*  PLURAL        */
name|GIMP_TYPE_UNIT
argument_list|,
comment|/*  UNIT          */
name|G_TYPE_BOOLEAN
argument_list|,
comment|/*  USER_UNIT     */
name|GDK_TYPE_COLOR
argument_list|)
expr_stmt|;
comment|/*  BG_COLOR      */
name|tv
operator|=
name|gtk_tree_view_new_with_model
argument_list|(
name|GTK_TREE_MODEL
argument_list|(
name|list_store
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|list_store
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Unit Editor"
argument_list|)
argument_list|,
name|PLUG_IN_BINARY
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|GTK_STOCK_REFRESH
argument_list|,
name|RESPONSE_REFRESH
argument_list|,
name|GTK_STOCK_CLOSE
argument_list|,
name|GTK_RESPONSE_CLOSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_default_response
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_CLOSE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dialog
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|unit_editor_response
argument_list|)
argument_list|,
name|tv
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dialog
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_main_quit
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  the toolbar  */
name|ui_manager
operator|=
name|gtk_ui_manager_new
argument_list|()
expr_stmt|;
name|group
operator|=
name|gtk_action_group_new
argument_list|(
literal|"unit-editor"
argument_list|)
expr_stmt|;
name|gtk_action_group_set_translation_domain
argument_list|(
name|group
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_action_group_add_actions
argument_list|(
name|group
argument_list|,
name|actions
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|actions
argument_list|)
argument_list|,
name|tv
argument_list|)
expr_stmt|;
name|gtk_window_add_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|gtk_ui_manager_get_accel_group
argument_list|(
name|ui_manager
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_accel_group_lock
argument_list|(
name|gtk_ui_manager_get_accel_group
argument_list|(
name|ui_manager
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_ui_manager_insert_action_group
argument_list|(
name|ui_manager
argument_list|,
name|group
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|gtk_ui_manager_add_ui_from_string
argument_list|(
name|ui_manager
argument_list|,
literal|"<ui>\n"
literal|"<toolbar action=\"unit-editor-toolbar\">\n"
literal|"<toolitem action=\"unit-editor-new\" />\n"
literal|"<toolitem action=\"unit-editor-duplicate\" />\n"
literal|"</toolbar>\n"
literal|"</ui>\n"
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|toolbar
operator|=
name|gtk_ui_manager_get_widget
argument_list|(
name|ui_manager
argument_list|,
literal|"/unit-editor-toolbar"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|toolbar
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toolbar
argument_list|)
expr_stmt|;
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_shadow_type
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_NEVER
argument_list|,
name|GTK_POLICY_ALWAYS
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|tv
argument_list|,
operator|-
literal|1
argument_list|,
literal|220
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|tv
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|rend
operator|=
name|gtk_cell_renderer_toggle_new
argument_list|()
expr_stmt|;
name|col
operator|=
name|gtk_tree_view_column_new_with_attributes
argument_list|(
name|gettext
argument_list|(
name|columns
index|[
name|SAVE
index|]
operator|.
name|title
argument_list|)
argument_list|,
name|rend
argument_list|,
literal|"active"
argument_list|,
name|SAVE
argument_list|,
literal|"activatable"
argument_list|,
name|USER_UNIT
argument_list|,
literal|"cell-background-gdk"
argument_list|,
name|BG_COLOR
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_view_append_column
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|col_widget
operator|=
name|gtk_tree_view_column_get_widget
argument_list|(
name|col
argument_list|)
expr_stmt|;
if|if
condition|(
name|col_widget
condition|)
block|{
name|button
operator|=
name|gtk_widget_get_ancestor
argument_list|(
name|col_widget
argument_list|,
name|GTK_TYPE_BUTTON
argument_list|)
expr_stmt|;
if|if
condition|(
name|button
condition|)
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|SAVE
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|g_signal_connect
argument_list|(
name|rend
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|saved_toggled_callback
argument_list|)
argument_list|,
name|list_store
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|columns
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
name|SAVE
condition|)
continue|continue;
name|col
operator|=
name|gtk_tree_view_column_new_with_attributes
argument_list|(
name|gettext
argument_list|(
name|columns
index|[
name|i
index|]
operator|.
name|title
argument_list|)
argument_list|,
name|gtk_cell_renderer_text_new
argument_list|()
argument_list|,
literal|"text"
argument_list|,
name|i
argument_list|,
literal|"cell-background-gdk"
argument_list|,
name|BG_COLOR
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_view_append_column
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|col_widget
operator|=
name|gtk_tree_view_column_get_widget
argument_list|(
name|col
argument_list|)
expr_stmt|;
if|if
condition|(
name|col_widget
condition|)
block|{
name|button
operator|=
name|gtk_widget_get_ancestor
argument_list|(
name|col_widget
argument_list|,
name|GTK_TYPE_BUTTON
argument_list|)
expr_stmt|;
if|if
condition|(
name|button
condition|)
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|gettext
argument_list|(
name|columns
index|[
name|i
index|]
operator|.
name|help
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
name|unit_list_init
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|unit_editor_response (GtkWidget * widget,gint response_id,gpointer data)
name|unit_editor_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|response_id
condition|)
block|{
case|case
name|RESPONSE_REFRESH
case|:
name|unit_list_init
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gtk_widget_destroy
argument_list|(
name|widget
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|new_callback (GtkAction * action,GtkTreeView * tv)
name|new_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|GtkTreeView
modifier|*
name|tv
parameter_list|)
block|{
name|GimpUnit
name|unit
decl_stmt|;
name|unit
operator|=
name|new_unit_dialog
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|GTK_WIDGET
argument_list|(
name|tv
argument_list|)
argument_list|)
argument_list|,
name|GIMP_UNIT_PIXEL
argument_list|)
expr_stmt|;
if|if
condition|(
name|unit
operator|!=
name|GIMP_UNIT_PIXEL
condition|)
block|{
name|GtkTreeModel
modifier|*
name|model
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|;
name|unit_list_init
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|model
operator|=
name|gtk_tree_view_get_model
argument_list|(
name|tv
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtk_tree_model_get_iter_first
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|)
operator|&&
name|gtk_tree_model_iter_nth_child
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|,
name|NULL
argument_list|,
name|unit
operator|-
name|GIMP_UNIT_INCH
argument_list|)
condition|)
block|{
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gtk_tree_selection_select_iter
argument_list|(
name|gtk_tree_view_get_selection
argument_list|(
name|tv
argument_list|)
argument_list|,
operator|&
name|iter
argument_list|)
expr_stmt|;
name|adj
operator|=
name|gtk_tree_view_get_vadjustment
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adj
argument_list|,
name|gtk_adjustment_get_upper
argument_list|(
name|adj
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|duplicate_callback (GtkAction * action,GtkTreeView * tv)
name|duplicate_callback
parameter_list|(
name|GtkAction
modifier|*
name|action
parameter_list|,
name|GtkTreeView
modifier|*
name|tv
parameter_list|)
block|{
name|GtkTreeModel
modifier|*
name|model
decl_stmt|;
name|GtkTreeSelection
modifier|*
name|sel
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|;
name|model
operator|=
name|gtk_tree_view_get_model
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|sel
operator|=
name|gtk_tree_view_get_selection
argument_list|(
name|tv
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtk_tree_selection_get_selected
argument_list|(
name|sel
argument_list|,
name|NULL
argument_list|,
operator|&
name|iter
argument_list|)
condition|)
block|{
name|GimpUnit
name|unit
decl_stmt|;
name|gtk_tree_model_get
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|,
name|UNIT
argument_list|,
operator|&
name|unit
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|unit
operator|=
name|new_unit_dialog
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|GTK_WIDGET
argument_list|(
name|tv
argument_list|)
argument_list|)
argument_list|,
name|unit
argument_list|)
expr_stmt|;
if|if
condition|(
name|unit
operator|!=
name|GIMP_UNIT_PIXEL
condition|)
block|{
name|GtkTreeIter
name|iter
decl_stmt|;
name|unit_list_init
argument_list|(
name|tv
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtk_tree_model_get_iter_first
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|)
operator|&&
name|gtk_tree_model_iter_nth_child
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|,
name|NULL
argument_list|,
name|unit
operator|-
name|GIMP_UNIT_INCH
argument_list|)
condition|)
block|{
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gtk_tree_selection_select_iter
argument_list|(
name|sel
argument_list|,
operator|&
name|iter
argument_list|)
expr_stmt|;
name|adj
operator|=
name|gtk_tree_view_get_vadjustment
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adj
argument_list|,
name|gtk_adjustment_get_upper
argument_list|(
name|adj
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|saved_toggled_callback (GtkCellRendererToggle * celltoggle,gchar * path_string,GtkListStore * list_store)
name|saved_toggled_callback
parameter_list|(
name|GtkCellRendererToggle
modifier|*
name|celltoggle
parameter_list|,
name|gchar
modifier|*
name|path_string
parameter_list|,
name|GtkListStore
modifier|*
name|list_store
parameter_list|)
block|{
name|GtkTreePath
modifier|*
name|path
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|;
name|gboolean
name|saved
decl_stmt|;
name|GimpUnit
name|unit
decl_stmt|;
name|path
operator|=
name|gtk_tree_path_new_from_string
argument_list|(
name|path_string
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gtk_tree_model_get_iter
argument_list|(
name|GTK_TREE_MODEL
argument_list|(
name|list_store
argument_list|)
argument_list|,
operator|&
name|iter
argument_list|,
name|path
argument_list|)
condition|)
block|{
name|g_warning
argument_list|(
literal|"%s: bad tree path?"
argument_list|,
name|G_STRLOC
argument_list|)
expr_stmt|;
return|return;
block|}
name|gtk_tree_path_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|gtk_tree_model_get
argument_list|(
name|GTK_TREE_MODEL
argument_list|(
name|list_store
argument_list|)
argument_list|,
operator|&
name|iter
argument_list|,
name|SAVE
argument_list|,
operator|&
name|saved
argument_list|,
name|UNIT
argument_list|,
operator|&
name|unit
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|unit
operator|>=
name|gimp_unit_get_number_of_built_in_units
argument_list|()
condition|)
block|{
name|gimp_unit_set_deletion_flag
argument_list|(
name|unit
argument_list|,
name|saved
argument_list|)
expr_stmt|;
name|gtk_list_store_set
argument_list|(
name|GTK_LIST_STORE
argument_list|(
name|list_store
argument_list|)
argument_list|,
operator|&
name|iter
argument_list|,
name|SAVE
argument_list|,
operator|!
name|saved
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|unit_list_init (GtkTreeView * tv)
name|unit_list_init
parameter_list|(
name|GtkTreeView
modifier|*
name|tv
parameter_list|)
block|{
name|GtkListStore
modifier|*
name|list_store
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|;
name|gint
name|num_units
decl_stmt|;
name|GimpUnit
name|unit
decl_stmt|;
name|GdkColor
name|color
decl_stmt|;
name|list_store
operator|=
name|GTK_LIST_STORE
argument_list|(
name|gtk_tree_view_get_model
argument_list|(
name|tv
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_list_store_clear
argument_list|(
name|list_store
argument_list|)
expr_stmt|;
name|num_units
operator|=
name|gimp_unit_get_number_of_units
argument_list|()
expr_stmt|;
name|color
operator|.
name|red
operator|=
literal|0xdddd
expr_stmt|;
name|color
operator|.
name|green
operator|=
literal|0xdddd
expr_stmt|;
name|color
operator|.
name|blue
operator|=
literal|0xffff
expr_stmt|;
for|for
control|(
name|unit
operator|=
name|GIMP_UNIT_INCH
init|;
name|unit
operator|<
name|num_units
condition|;
name|unit
operator|++
control|)
block|{
name|gboolean
name|user_unit
init|=
operator|(
name|unit
operator|>=
name|gimp_unit_get_number_of_built_in_units
argument_list|()
operator|)
decl_stmt|;
name|gtk_list_store_append
argument_list|(
name|list_store
argument_list|,
operator|&
name|iter
argument_list|)
expr_stmt|;
name|gtk_list_store_set
argument_list|(
name|list_store
argument_list|,
operator|&
name|iter
argument_list|,
name|SAVE
argument_list|,
operator|!
name|gimp_unit_get_deletion_flag
argument_list|(
name|unit
argument_list|)
argument_list|,
name|IDENTIFIER
argument_list|,
name|gimp_unit_get_identifier
argument_list|(
name|unit
argument_list|)
argument_list|,
name|FACTOR
argument_list|,
name|gimp_unit_get_factor
argument_list|(
name|unit
argument_list|)
argument_list|,
name|DIGITS
argument_list|,
name|gimp_unit_get_digits
argument_list|(
name|unit
argument_list|)
argument_list|,
name|SYMBOL
argument_list|,
name|gimp_unit_get_symbol
argument_list|(
name|unit
argument_list|)
argument_list|,
name|ABBREVIATION
argument_list|,
name|gimp_unit_get_abbreviation
argument_list|(
name|unit
argument_list|)
argument_list|,
name|SINGULAR
argument_list|,
name|gimp_unit_get_singular
argument_list|(
name|unit
argument_list|)
argument_list|,
name|PLURAL
argument_list|,
name|gimp_unit_get_plural
argument_list|(
name|unit
argument_list|)
argument_list|,
name|UNIT
argument_list|,
name|unit
argument_list|,
name|USER_UNIT
argument_list|,
name|user_unit
argument_list|,
name|user_unit
condition|?
operator|-
literal|1
else|:
name|BG_COLOR
argument_list|,
operator|&
name|color
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gtk_tree_model_get_iter_first
argument_list|(
name|GTK_TREE_MODEL
argument_list|(
name|list_store
argument_list|)
argument_list|,
operator|&
name|iter
argument_list|)
condition|)
name|gtk_tree_selection_select_iter
argument_list|(
name|gtk_tree_view_get_selection
argument_list|(
name|tv
argument_list|)
argument_list|,
operator|&
name|iter
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

