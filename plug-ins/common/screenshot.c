begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_comment
comment|/*  *  Screenshot plug-in  *  Copyright 1998-2007 Sven Neumann<sven@gimp.org>  *  Copyright 2003      Henrik Brix Andersen<brix@gimp.org>  *  *  Any suggestions, bug-reports or patches are very welcome.  *  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|GDK_WINDOWING_X11
argument_list|)
end_if

begin_include
include|#
directive|include
file|<gdk/gdkx.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_X11_EXTENSIONS_SHAPE_H
end_ifdef

begin_include
include|#
directive|include
file|<X11/extensions/shape.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_X11_XMU_WINUTIL_H
end_ifdef

begin_include
include|#
directive|include
file|<X11/Xmu/WinUtil.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_XFIXES
end_ifdef

begin_include
include|#
directive|include
file|<X11/extensions/Xfixes.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|GDK_WINDOWING_WIN32
argument_list|)
end_elif

begin_include
include|#
directive|include
file|<windows.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_comment
comment|/* GdkPixbuf RGBA C-Source image dump 1-byte-run-length-encoded */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__SUNPRO_C
end_ifdef

begin_pragma
pragma|#
directive|pragma
name|align
name|4
name|(
name|screenshot_icon
name|)
end_pragma

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_decl_stmt
DECL|variable|screenshot_icon
specifier|static
specifier|const
name|guint8
name|screenshot_icon
index|[]
name|__attribute__
argument_list|(
operator|(
name|__aligned__
argument_list|(
literal|4
argument_list|)
operator|)
argument_list|)
init|=
else|#
directive|else
specifier|static
specifier|const
name|guint8
name|screenshot_icon
index|[]
operator|=
endif|#
directive|endif
block|{
literal|""
comment|/* Pixbuf magic (0x47646b50) */
literal|"GdkP"
comment|/* length: header (24) + pixel_data (1582) */
literal|"\0\0\6F"
comment|/* pixdata_type (0x2010002) */
literal|"\2\1\0\2"
comment|/* rowstride (88) */
literal|"\0\0\0X"
comment|/* width (22) */
literal|"\0\0\0\26"
comment|/* height (22) */
literal|"\0\0\0\26"
comment|/* pixel_data: */
literal|"\213\0\0\0\0\1\242\242\242\5\203\242\242\242\31\221\0\0\0\0\2\27\27\26"
literal|"D\40\40\40\372\203)))\375\2\32\32\32\362\26\26\25"
literal|"0\217\0\0\0\0\2\2"
literal|"\2\2\322\307\310\307\377\203\377\377\377\377\2\263\263\262\363\0\0\0"
literal|"\314\217\0\0\0\0\2\6\6\6\334\206\207\205\377\202\252\253\251\377\3\252"
literal|"\252\251\377ghe\376\1\1\1\320\217\0\0\0\0\2\11\11\11\346./-\345\202G"
literal|"HE\25\3JKH\32"
literal|"01/\364\5\5\5\333\212\0\0\0\0\17\26\26\25\31\26\26\25"
literal|"0\26\26\25g\0\0\0\314+,+\331LMK\375EFD\362ffe\347iig\346lmk\346RSQ\362"
literal|"\13\13\13\360\0\0\0\314\2\2\2\321\26\26\25V\203\0\0\0\0#\26\26\25\31"
literal|"\26\26\25"
literal|"0\26\26\25n\3\3\3\331\2\2\2\332JJI\355\215\215\215\372\246"
literal|"\246\246\347\267\270\266\362\177\202~\377BC\77\377TUR\377\\]Y\377gid"
literal|"\377[]X\377\204\206\204\374wxw\276\224\225\224\314LLK\343\26\26\25D\0"
literal|"\0\0\0\26\26\25D\3\3\3\341\17\17\17\373ghg\377\237\240\236\377\273\274"
literal|"\272\377\302\303\300\377\272\273\270\377\200\201\177\377zzz\377tws\377"
literal|"\220\223\217\377\221\225\221\377\224\227\223\377\202\226\232\226\377"
literal|"K\177\202}\377xyu\377\217\221\215\377\226\227\226\365\0\0\0\371\0\0\0"
literal|"\0\2\2\2\330\257\261\257\377\275\276\273\377\262\263\260\377UWT\377Q"
literal|"SP\377suq\377]^[\377\304\304\304\377\303\303\303\377kmi\377MNJ\377WZ"
literal|"X\377[`_\377aeb\377gid\377}\200{\377SUQ\377FGE\377\200\201\200\377\12"
literal|"\12\12\357\0\0\0\0\4\4\4\345xyv\377\241\242\236\377\210\212\205\377v"
literal|"xt\377\220\222\217\377GIF\377+,)\377```\377jji\377UXV\377y\204\210\377"
literal|"\203\215\220\377~\204\207\377flo\377PW\\\377SWU\377JLI\377452\377tut"
literal|"\377\12\12\12\357\0\0\0\0\4\4\4\344opm\377\221\223\217\377}\177{\377"
literal|"\215\217\213\377`b_\377()'\377*+)\377785\377VXV\377u~\202\377nsu\377"
literal|"VYZ\377OST\377OQS\377JOP\377^cd\377698\377!\"!\377llk\377\12\12\12\357"
literal|"\0\0\0\0\3\3\3\345npl\377\220\221\216\377\202UWS\377\24GIF\377\40!\37"
literal|"\377*+)\3779:7\377^ce\377NRT\377UXY\377(,.\377\22\24\25\377!$&\377IL"
literal|"M\3778=\77\377RVX\377''&\377klk\377\12\12\12\357\0\0\0\1\3\3\3\345no"
literal|"l\377\220\221\216\377\202UWS\377\24GIF\377\40!\37\377*+)\3778:8\377T"
literal|"XY\377289\377\23\25\26\377\16\16\16\377\1\1\1\377\2\2\2\377\24\25\25"
literal|"\377.34\377289\377011\377aa`\377\11\11\11\360\0\0\0\3\3\3\3\345nol\377"
literal|"\204\205\202\377\202UWS\377\24GIF\377\40!\37\377*+)\377\77BA\37728:\377"
literal|"\34\40!\377\31\32\32\377\377\377\377\377hhh\377\40\40\40\377\22\22\22"
literal|"\377.00\377.46\377:>\77\377`a`\377\11\11\10\361\0\0\0\7\3\3\3\345mok"
literal|"\377z{x\377\202UWS\377\24GIF\377\40!\37\377*+)\377HJI\377.46\377\25\27"
literal|"\30\377\40\40\40\377hhh\377\232\232\232\377}}}\377'''\3779;;\377/57\377"
literal|"599\377``_\377\11\11\10\362\0\0\0\15\3\3\3\345lnk\377rsp\377\202UWS\377"
literal|"\24GIF\377\40!\37\377,-*\377>@>\377.46\377\35\37\40\377\1\1\1\377888"
literal|"\377\214\214\214\377\213\213\213\377AAA\377JKK\377/57\3776:;\377WXV\377"
literal|"\6\6\6\364\0\0\0\21\0\0\0\371\201\202\177\377mok\377\202UWS\377iGIF\377"
literal|"MNM\377RRR\372ghg\364[`b\377+/0\377\17\17\17\377\"\"\"\377'''\377HHH"
literal|"\377\263\263\263\377SUU\377W\\^\377CFF\374<<<\376\20\20\17\317\0\0\0"
literal|"\20\24\24\23]\4\4\4\353\177\177~\375|}z\373}~|\374hih\3769:9\371\0\0"
literal|"\0\347\0\0\0\351\7\7\7\367.46\377256\377\40\40\40\377(((\377:::\377`"
literal|"ab\3779>\77\377\11\13\13\376\0\0\0\353\0\0\0\300\14\14\13H\0\0\0\15\0"
literal|"\0\0\4\23\23\22L\0\0\0\332\0\0\0\341\0\0\0\346\0\0\0\341\14\14\13{\0"
literal|"\0\0V\0\0\0a\0\0\0l\10\11\11\371\\^_\377LOP\377ILL\377LOQ\377QUV\377"
literal|"\16\17\17\377\34\37\40\244\0\0\0`\0\0\0"
literal|"4\0\0\0\27\0\0\0\7\0\0\0\1\0"
literal|"\0\0\3\0\0\0\10\0\0\0\21\0\0\0\34\0\0\0'\0\0\0"
literal|"0\0\0\0"
literal|"6\0\0\0=\0\0"
literal|"\0A\0\0\0F\4\5\5\355\12\13\13\371\17\20\20\376\15\16\16\375\10\10\11"
literal|"\365\7\10\11j\0\0\0G\0\0\0-\0\0\0\30\0\0\0\13\0\0\0\4\0\0\0\0\0\0\0\1"
literal|"\0\0\0\2\0\0\0\4\0\0\0\11\0\0\0\16\0\0\0\23\0\0\0\31\0\0\0\35\0\0\0!"
literal|"\0\0\0#\0\0\0$\0\0\0%\0\0\0$\0\0\0&\0\0\0%\0\0\0\36\0\0\0\27\0\0\0\20"
literal|"\0\0\0\10\0\0\0\3\0\0\0\1\204\0\0\0\0\5\0\0\0\1\0\0\0\2\0\0\0\4\0\0\0"
literal|"\5\0\0\0\6\202\0\0\0\10\11\0\0\0\11\0\0\0\7\0\0\0\10\0\0\0\5\0\0\0\7"
literal|"\0\0\0\6\0\0\0\5\0\0\0\3\0\0\0\1\202\0\0\0\0"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Defines */
end_comment

begin_define
DECL|macro|PLUG_IN_PROC
define|#
directive|define
name|PLUG_IN_PROC
value|"plug-in-screenshot"
end_define

begin_define
DECL|macro|PLUG_IN_BINARY
define|#
directive|define
name|PLUG_IN_BINARY
value|"screenshot"
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|GDK_NATIVE_WINDOW_POINTER
end_ifdef

begin_if
if|#
directive|if
name|GLIB_SIZEOF_VOID_P
operator|!=
literal|4
end_if

begin_warning
warning|#
directive|warning
warning|window_id does not fit in PDB_INT32
end_warning

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2b0a3f6f0103
block|{
DECL|enumerator|SHOOT_ROOT
name|SHOOT_ROOT
block|,
DECL|enumerator|SHOOT_REGION
name|SHOOT_REGION
block|,
DECL|enumerator|SHOOT_WINDOW
name|SHOOT_WINDOW
DECL|typedef|ShootType
block|}
name|ShootType
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b0a3f6f0208
block|{
DECL|member|shoot_type
name|ShootType
name|shoot_type
decl_stmt|;
DECL|member|decorate
name|gboolean
name|decorate
decl_stmt|;
DECL|member|window_id
name|guint
name|window_id
decl_stmt|;
DECL|member|select_delay
name|guint
name|select_delay
decl_stmt|;
DECL|member|x1
name|gint
name|x1
decl_stmt|;
DECL|member|y1
name|gint
name|y1
decl_stmt|;
DECL|member|x2
name|gint
name|x2
decl_stmt|;
DECL|member|y2
name|gint
name|y2
decl_stmt|;
DECL|member|show_cursor
name|gboolean
name|show_cursor
decl_stmt|;
DECL|typedef|ScreenshotValues
block|}
name|ScreenshotValues
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|shootvals
specifier|static
name|ScreenshotValues
name|shootvals
init|=
block|{
name|SHOOT_WINDOW
block|,
comment|/* root window  */
name|TRUE
block|,
comment|/* include WM decorations */
literal|0
block|,
comment|/* window ID    */
literal|0
block|,
comment|/* select delay */
literal|0
block|,
comment|/* coords of region dragged out by pointer */
literal|0
block|,
literal|0
block|,
literal|0
block|,
name|FALSE
block|}
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GdkNativeWindow
name|select_window
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|create_image
parameter_list|(
name|GdkPixbuf
modifier|*
name|pixbuf
parameter_list|,
name|GdkRegion
modifier|*
name|shape
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|shoot
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|shoot_dialog
parameter_list|(
name|GdkScreen
modifier|*
modifier|*
name|screen
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|shoot_delay
parameter_list|(
name|gint32
name|delay
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|shoot_delay_callback
parameter_list|(
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|shoot_quit_timeout
parameter_list|(
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Global Variables */
end_comment

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
specifier|const
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Functions */
end_comment

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
specifier|const
name|GimpParamDef
name|args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode { RUN-INTERACTIVE (0), RUN-NONINTERACTIVE (1) }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"root"
block|,
literal|"Root window { TRUE, FALSE }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"window-id"
block|,
literal|"Window id"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"x1"
block|,
literal|"(optional) Region left x coord"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"y1"
block|,
literal|"(optional) Region top y coord"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"x2"
block|,
literal|"(optional) Region right x coord"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"y2"
block|,
literal|"(optional) Region bottom y coord"
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Output image"
block|}
block|}
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|N_
argument_list|(
literal|"Create an image from an area of the screen"
argument_list|)
argument_list|,
literal|"The plug-in allows to take screenshots of an "
literal|"interactively selected window or of the desktop, "
literal|"either the whole desktop or an interactively "
literal|"selected region. When called non-interactively, it "
literal|"may grab the root window or use the window-id "
literal|"passed as a parameter.  The last four parameters "
literal|"are optional and can be used to specify the corners "
literal|"of the region to be grabbed."
argument_list|,
literal|"Sven Neumann<sven@gimp.org>, "
literal|"Henrik Brix Andersen<brix@gimp.org>"
argument_list|,
literal|"1998 - 2008"
argument_list|,
literal|"v1.1 (2008/04)"
argument_list|,
name|N_
argument_list|(
literal|"_Screenshot..."
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|args
argument_list|)
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|return_vals
argument_list|)
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
name|gimp_plugin_menu_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
literal|"<Image>/File/Create/Acquire"
argument_list|)
expr_stmt|;
name|gimp_plugin_icon_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|GIMP_ICON_TYPE_INLINE_PIXBUF
argument_list|,
name|screenshot_icon
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (const gchar * name,gint nparams,const GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
name|GimpRunMode
name|run_mode
init|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
decl_stmt|;
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
name|GdkScreen
modifier|*
name|screen
init|=
name|NULL
decl_stmt|;
name|gint32
name|image_ID
decl_stmt|;
specifier|static
name|GimpParam
name|values
index|[
literal|2
index|]
decl_stmt|;
comment|/* initialize the return of the status */
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
comment|/* how are we running today? */
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|GIMP_RUN_INTERACTIVE
case|:
comment|/* Possibly retrieve data from a previous run */
name|gimp_get_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|shootvals
argument_list|)
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
literal|0
expr_stmt|;
comment|/* Get information from the dialog */
if|if
condition|(
operator|!
name|shoot_dialog
argument_list|(
operator|&
name|screen
argument_list|)
condition|)
name|status
operator|=
name|GIMP_PDB_CANCEL
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_NONINTERACTIVE
case|:
if|if
condition|(
name|nparams
operator|==
literal|3
condition|)
block|{
name|gboolean
name|do_root
init|=
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_int32
decl_stmt|;
name|shootvals
operator|.
name|shoot_type
operator|=
name|do_root
condition|?
name|SHOOT_ROOT
else|:
name|SHOOT_WINDOW
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|select_delay
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|nparams
operator|==
literal|7
condition|)
block|{
name|shootvals
operator|.
name|shoot_type
operator|=
name|SHOOT_REGION
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|select_delay
operator|=
literal|0
expr_stmt|;
name|shootvals
operator|.
name|x1
operator|=
name|param
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|y1
operator|=
name|param
index|[
literal|4
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|x2
operator|=
name|param
index|[
literal|5
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|y2
operator|=
name|param
index|[
literal|6
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|gdk_init_check
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
condition|)
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_WITH_LAST_VALS
case|:
comment|/* Possibly retrieve data from a previous run */
name|gimp_get_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|shootvals
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
if|if
condition|(
name|shootvals
operator|.
name|select_delay
operator|>
literal|0
condition|)
name|shoot_delay
argument_list|(
name|shootvals
operator|.
name|select_delay
argument_list|)
expr_stmt|;
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|!=
name|SHOOT_ROOT
operator|&&
operator|!
name|shootvals
operator|.
name|window_id
condition|)
block|{
name|shootvals
operator|.
name|window_id
operator|=
name|select_window
argument_list|(
name|screen
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|shootvals
operator|.
name|window_id
condition|)
name|status
operator|=
name|GIMP_PDB_CANCEL
expr_stmt|;
block|}
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|image_ID
operator|=
name|shoot
argument_list|(
name|screen
argument_list|)
expr_stmt|;
if|if
condition|(
name|image_ID
operator|==
operator|-
literal|1
condition|)
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
if|if
condition|(
name|run_mode
operator|==
name|GIMP_RUN_INTERACTIVE
condition|)
block|{
comment|/* Store variable states for next run */
name|gimp_set_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|shootvals
argument_list|,
sizeof|sizeof
argument_list|(
name|ScreenshotValues
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_display_new
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
block|}
comment|/* set return values */
operator|*
name|nreturn_vals
operator|=
literal|2
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image_ID
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Allow the user to select a window or a region with the mouse */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|GDK_WINDOWING_X11
end_ifdef

begin_function
specifier|static
name|GdkNativeWindow
DECL|function|select_window_x11 (GdkScreen * screen)
name|select_window_x11
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
block|{
name|Display
modifier|*
name|x_dpy
init|=
name|GDK_SCREEN_XDISPLAY
argument_list|(
name|screen
argument_list|)
decl_stmt|;
name|gint
name|x_scr
init|=
name|GDK_SCREEN_XNUMBER
argument_list|(
name|screen
argument_list|)
decl_stmt|;
name|Window
name|x_root
init|=
name|RootWindow
argument_list|(
name|x_dpy
argument_list|,
name|x_scr
argument_list|)
decl_stmt|;
name|Window
name|x_win
init|=
name|None
decl_stmt|;
name|GC
name|x_gc
init|=
name|NULL
decl_stmt|;
name|Cursor
name|x_cursor
init|=
name|XCreateFontCursor
argument_list|(
name|x_dpy
argument_list|,
name|GDK_CROSSHAIR
argument_list|)
decl_stmt|;
name|GdkKeymapKey
modifier|*
name|keys
init|=
name|NULL
decl_stmt|;
name|gint
name|status
decl_stmt|;
name|gint
name|i
decl_stmt|,
name|num_keys
decl_stmt|;
name|gint
name|buttons
init|=
literal|0
decl_stmt|;
name|gint
name|mask
init|=
name|ButtonPressMask
operator||
name|ButtonReleaseMask
decl_stmt|;
name|gboolean
name|cancel
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_REGION
condition|)
name|mask
operator||=
name|PointerMotionMask
expr_stmt|;
name|status
operator|=
name|XGrabPointer
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|False
argument_list|,
name|mask
argument_list|,
name|GrabModeSync
argument_list|,
name|GrabModeAsync
argument_list|,
name|x_root
argument_list|,
name|x_cursor
argument_list|,
name|CurrentTime
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|GrabSuccess
condition|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guint
name|xmask
decl_stmt|;
comment|/* if we can't grab the pointer, return the window under the pointer */
name|XQueryPointer
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
operator|&
name|x_root
argument_list|,
operator|&
name|x_win
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
operator|&
name|xmask
argument_list|)
expr_stmt|;
if|if
condition|(
name|x_win
operator|==
name|None
operator|||
name|x_win
operator|==
name|x_root
condition|)
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Error selecting the window"
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_REGION
condition|)
block|{
name|XGCValues
name|gc_values
decl_stmt|;
name|gc_values
operator|.
name|function
operator|=
name|GXxor
expr_stmt|;
name|gc_values
operator|.
name|plane_mask
operator|=
name|AllPlanes
expr_stmt|;
name|gc_values
operator|.
name|foreground
operator|=
name|WhitePixel
argument_list|(
name|x_dpy
argument_list|,
name|x_scr
argument_list|)
expr_stmt|;
name|gc_values
operator|.
name|background
operator|=
name|BlackPixel
argument_list|(
name|x_dpy
argument_list|,
name|x_scr
argument_list|)
expr_stmt|;
name|gc_values
operator|.
name|line_width
operator|=
literal|0
expr_stmt|;
name|gc_values
operator|.
name|line_style
operator|=
name|LineSolid
expr_stmt|;
name|gc_values
operator|.
name|fill_style
operator|=
name|FillSolid
expr_stmt|;
name|gc_values
operator|.
name|cap_style
operator|=
name|CapButt
expr_stmt|;
name|gc_values
operator|.
name|join_style
operator|=
name|JoinMiter
expr_stmt|;
name|gc_values
operator|.
name|graphics_exposures
operator|=
name|FALSE
expr_stmt|;
name|gc_values
operator|.
name|clip_x_origin
operator|=
literal|0
expr_stmt|;
name|gc_values
operator|.
name|clip_y_origin
operator|=
literal|0
expr_stmt|;
name|gc_values
operator|.
name|clip_mask
operator|=
name|None
expr_stmt|;
name|gc_values
operator|.
name|subwindow_mode
operator|=
name|IncludeInferiors
expr_stmt|;
name|x_gc
operator|=
name|XCreateGC
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|GCFunction
operator||
name|GCPlaneMask
operator||
name|GCForeground
operator||
name|GCLineWidth
operator||
name|GCLineStyle
operator||
name|GCCapStyle
operator||
name|GCJoinStyle
operator||
name|GCGraphicsExposures
operator||
name|GCBackground
operator||
name|GCFillStyle
operator||
name|GCClipXOrigin
operator||
name|GCClipYOrigin
operator||
name|GCClipMask
operator||
name|GCSubwindowMode
argument_list|,
operator|&
name|gc_values
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gdk_keymap_get_entries_for_keyval
argument_list|(
name|NULL
argument_list|,
name|GDK_Escape
argument_list|,
operator|&
name|keys
argument_list|,
operator|&
name|num_keys
argument_list|)
condition|)
block|{
name|gdk_error_trap_push
argument_list|()
expr_stmt|;
DECL|macro|X_GRAB_KEY (index,modifiers)
define|#
directive|define
name|X_GRAB_KEY
parameter_list|(
name|index
parameter_list|,
name|modifiers
parameter_list|)
define|\
value|XGrabKey (x_dpy, keys[index].keycode, modifiers, x_root, False, \                 GrabModeAsync, GrabModeAsync)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_keys
condition|;
name|i
operator|++
control|)
block|{
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
argument_list|)
expr_stmt|;
comment|/* CapsLock              */
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
name|Mod2Mask
argument_list|)
expr_stmt|;
comment|/* NumLock               */
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* ScrollLock            */
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
operator||
name|Mod2Mask
argument_list|)
expr_stmt|;
comment|/* CapsLock + NumLock    */
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
operator||
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* CapsLock + ScrollLock */
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
name|Mod2Mask
operator||
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* NumLock  + ScrollLock */
name|X_GRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
operator||
name|Mod2Mask
operator||
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* all        */
block|}
undef|#
directive|undef
name|X_GRAB_KEY
name|gdk_flush
argument_list|()
expr_stmt|;
name|gdk_error_trap_pop
argument_list|()
expr_stmt|;
block|}
while|while
condition|(
operator|!
name|cancel
operator|&&
operator|(
operator|(
name|x_win
operator|==
name|None
operator|)
operator|||
operator|(
name|buttons
operator|!=
literal|0
operator|)
operator|)
condition|)
block|{
name|XEvent
name|x_event
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|;
name|XAllowEvents
argument_list|(
name|x_dpy
argument_list|,
name|SyncPointer
argument_list|,
name|CurrentTime
argument_list|)
expr_stmt|;
name|XWindowEvent
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|mask
operator||
name|KeyPressMask
argument_list|,
operator|&
name|x_event
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|x_event
operator|.
name|type
condition|)
block|{
case|case
name|ButtonPress
case|:
if|if
condition|(
name|x_win
operator|==
name|None
condition|)
block|{
name|x_win
operator|=
name|x_event
operator|.
name|xbutton
operator|.
name|subwindow
expr_stmt|;
if|if
condition|(
name|x_win
operator|==
name|None
condition|)
name|x_win
operator|=
name|x_root
expr_stmt|;
ifdef|#
directive|ifdef
name|HAVE_X11_XMU_WINUTIL_H
elseif|else
if|if
condition|(
operator|!
name|shootvals
operator|.
name|decorate
condition|)
name|x_win
operator|=
name|XmuClientWindow
argument_list|(
name|x_dpy
argument_list|,
name|x_win
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|shootvals
operator|.
name|x2
operator|=
name|shootvals
operator|.
name|x1
operator|=
name|x_event
operator|.
name|xbutton
operator|.
name|x_root
expr_stmt|;
name|shootvals
operator|.
name|y2
operator|=
name|shootvals
operator|.
name|y1
operator|=
name|x_event
operator|.
name|xbutton
operator|.
name|y_root
expr_stmt|;
block|}
name|buttons
operator|++
expr_stmt|;
break|break;
case|case
name|ButtonRelease
case|:
if|if
condition|(
name|buttons
operator|>
literal|0
condition|)
name|buttons
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|buttons
operator|&&
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_REGION
condition|)
block|{
name|x
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|x1
argument_list|,
name|shootvals
operator|.
name|x2
argument_list|)
expr_stmt|;
name|y
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|y1
argument_list|,
name|shootvals
operator|.
name|y2
argument_list|)
expr_stmt|;
name|w
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|x2
operator|-
name|shootvals
operator|.
name|x1
argument_list|)
expr_stmt|;
name|h
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|y2
operator|-
name|shootvals
operator|.
name|y1
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|>
literal|0
operator|&&
name|h
operator|>
literal|0
condition|)
name|XDrawRectangle
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|x_gc
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|shootvals
operator|.
name|x2
operator|=
name|x_event
operator|.
name|xbutton
operator|.
name|x_root
expr_stmt|;
name|shootvals
operator|.
name|y2
operator|=
name|x_event
operator|.
name|xbutton
operator|.
name|y_root
expr_stmt|;
block|}
break|break;
case|case
name|MotionNotify
case|:
if|if
condition|(
name|buttons
operator|>
literal|0
condition|)
block|{
name|x
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|x1
argument_list|,
name|shootvals
operator|.
name|x2
argument_list|)
expr_stmt|;
name|y
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|y1
argument_list|,
name|shootvals
operator|.
name|y2
argument_list|)
expr_stmt|;
name|w
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|x2
operator|-
name|shootvals
operator|.
name|x1
argument_list|)
expr_stmt|;
name|h
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|y2
operator|-
name|shootvals
operator|.
name|y1
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|>
literal|0
operator|&&
name|h
operator|>
literal|0
condition|)
name|XDrawRectangle
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|x_gc
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
name|shootvals
operator|.
name|x2
operator|=
name|x_event
operator|.
name|xmotion
operator|.
name|x_root
expr_stmt|;
name|shootvals
operator|.
name|y2
operator|=
name|x_event
operator|.
name|xmotion
operator|.
name|y_root
expr_stmt|;
name|x
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|x1
argument_list|,
name|shootvals
operator|.
name|x2
argument_list|)
expr_stmt|;
name|y
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|y1
argument_list|,
name|shootvals
operator|.
name|y2
argument_list|)
expr_stmt|;
name|w
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|x2
operator|-
name|shootvals
operator|.
name|x1
argument_list|)
expr_stmt|;
name|h
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|y2
operator|-
name|shootvals
operator|.
name|y1
argument_list|)
expr_stmt|;
if|if
condition|(
name|w
operator|>
literal|0
operator|&&
name|h
operator|>
literal|0
condition|)
name|XDrawRectangle
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|x_gc
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|KeyPress
case|:
block|{
name|guint
modifier|*
name|keyvals
decl_stmt|;
name|gint
name|n
decl_stmt|;
if|if
condition|(
name|gdk_keymap_get_entries_for_keycode
argument_list|(
name|NULL
argument_list|,
name|x_event
operator|.
name|xkey
operator|.
name|keycode
argument_list|,
name|NULL
argument_list|,
operator|&
name|keyvals
argument_list|,
operator|&
name|n
argument_list|)
condition|)
block|{
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
operator|&&
operator|!
name|cancel
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|keyvals
index|[
name|i
index|]
operator|==
name|GDK_Escape
condition|)
name|cancel
operator|=
name|TRUE
expr_stmt|;
name|g_free
argument_list|(
name|keyvals
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
default|default:
break|break;
block|}
block|}
if|if
condition|(
name|keys
condition|)
block|{
DECL|macro|X_UNGRAB_KEY (index,modifiers)
define|#
directive|define
name|X_UNGRAB_KEY
parameter_list|(
name|index
parameter_list|,
name|modifiers
parameter_list|)
define|\
value|XUngrabKey (x_dpy, keys[index].keycode, modifiers, x_root)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_keys
condition|;
name|i
operator|++
control|)
block|{
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
argument_list|)
expr_stmt|;
comment|/* CapsLock              */
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
name|Mod2Mask
argument_list|)
expr_stmt|;
comment|/* NumLock               */
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* ScrollLock            */
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
operator||
name|Mod2Mask
argument_list|)
expr_stmt|;
comment|/* CapsLock + NumLock    */
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
operator||
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* CapsLock + ScrollLock */
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
name|Mod2Mask
operator||
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* NumLock  + ScrollLock */
name|X_UNGRAB_KEY
argument_list|(
name|i
argument_list|,
name|LockMask
operator||
name|Mod2Mask
operator||
name|Mod5Mask
argument_list|)
expr_stmt|;
comment|/* all        */
block|}
undef|#
directive|undef
name|X_UNGRAB_KEY
name|g_free
argument_list|(
name|keys
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
name|GrabSuccess
condition|)
name|XUngrabPointer
argument_list|(
name|x_dpy
argument_list|,
name|CurrentTime
argument_list|)
expr_stmt|;
name|XFreeCursor
argument_list|(
name|x_dpy
argument_list|,
name|x_cursor
argument_list|)
expr_stmt|;
if|if
condition|(
name|x_gc
operator|!=
name|NULL
condition|)
name|XFreeGC
argument_list|(
name|x_dpy
argument_list|,
name|x_gc
argument_list|)
expr_stmt|;
return|return
name|x_win
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|GDK_WINDOWING_WIN32
end_ifdef

begin_function
specifier|static
name|GdkNativeWindow
DECL|function|select_window_win32 (GdkScreen * screen)
name|select_window_win32
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
block|{
comment|/* MS Windows specific code goes here (yet to be written) */
comment|/* basically the code should grab the pointer using a crosshair    * cursor, allow the user to click on a window and return the    * obtained HWND (as a GdkNativeWindow) - for more details consult    * the X11 specific code above    */
comment|/* note to self: take a look at the winsnap plug-in for example code */
ifdef|#
directive|ifdef
name|__GNUC__
warning|#
directive|warning
warning|Win32 screenshot window chooser not implemented yet
else|#
directive|else
pragma|#
directive|pragma
name|message
name|(
literal|"Win32 screenshot window chooser not implemented yet"
name|)
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|GdkNativeWindow
DECL|function|select_window (GdkScreen * screen)
name|select_window
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|GDK_WINDOWING_X11
argument_list|)
return|return
name|select_window_x11
argument_list|(
name|screen
argument_list|)
return|;
elif|#
directive|elif
name|defined
argument_list|(
name|GDK_WINDOWING_WIN32
argument_list|)
return|return
name|select_window_win32
argument_list|(
name|screen
argument_list|)
return|;
else|#
directive|else
warning|#
directive|warning
warning|screenshot window chooser not implemented yet for this GDK backend
return|return
literal|0
return|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|window_get_utf8_property (GdkDisplay * display,GdkNativeWindow window,const gchar * name)
name|window_get_utf8_property
parameter_list|(
name|GdkDisplay
modifier|*
name|display
parameter_list|,
name|GdkNativeWindow
name|window
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|gchar
modifier|*
name|retval
init|=
name|NULL
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|GDK_WINDOWING_X11
argument_list|)
name|Atom
name|utf8_string
decl_stmt|;
name|Atom
name|type
init|=
name|None
decl_stmt|;
name|guchar
modifier|*
name|val
init|=
name|NULL
decl_stmt|;
name|gulong
name|nitems
init|=
literal|0
decl_stmt|;
name|gulong
name|after
init|=
literal|0
decl_stmt|;
name|gint
name|format
init|=
literal|0
decl_stmt|;
name|utf8_string
operator|=
name|gdk_x11_get_xatom_by_name_for_display
argument_list|(
name|display
argument_list|,
literal|"UTF8_STRING"
argument_list|)
expr_stmt|;
name|XGetWindowProperty
argument_list|(
name|GDK_DISPLAY_XDISPLAY
argument_list|(
name|display
argument_list|)
argument_list|,
name|window
argument_list|,
name|gdk_x11_get_xatom_by_name_for_display
argument_list|(
name|display
argument_list|,
name|name
argument_list|)
argument_list|,
literal|0
argument_list|,
name|G_MAXLONG
argument_list|,
name|False
argument_list|,
name|utf8_string
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|format
argument_list|,
operator|&
name|nitems
argument_list|,
operator|&
name|after
argument_list|,
operator|&
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|!=
name|utf8_string
operator|||
name|format
operator|!=
literal|8
operator|||
name|nitems
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|val
condition|)
name|XFree
argument_list|(
name|val
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
if|if
condition|(
name|g_utf8_validate
argument_list|(
operator|(
specifier|const
name|gchar
operator|*
operator|)
name|val
argument_list|,
name|nitems
argument_list|,
name|NULL
argument_list|)
condition|)
name|retval
operator|=
name|g_strndup
argument_list|(
operator|(
specifier|const
name|gchar
operator|*
operator|)
name|val
argument_list|,
name|nitems
argument_list|)
expr_stmt|;
name|XFree
argument_list|(
name|val
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|retval
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|window_get_title (GdkDisplay * display,GdkNativeWindow window)
name|window_get_title
parameter_list|(
name|GdkDisplay
modifier|*
name|display
parameter_list|,
name|GdkNativeWindow
name|window
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|GDK_WINDOWING_X11
argument_list|)
ifdef|#
directive|ifdef
name|HAVE_X11_XMU_WINUTIL_H
name|window
operator|=
name|XmuClientWindow
argument_list|(
name|GDK_DISPLAY_XDISPLAY
argument_list|(
name|display
argument_list|)
argument_list|,
name|window
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|window_get_utf8_property
argument_list|(
name|display
argument_list|,
name|window
argument_list|,
literal|"_NET_WM_NAME"
argument_list|)
return|;
else|#
directive|else
return|return
name|NULL
return|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|GdkRegion
modifier|*
DECL|function|window_get_shape (GdkScreen * screen,GdkNativeWindow window)
name|window_get_shape
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|,
name|GdkNativeWindow
name|window
parameter_list|)
block|{
name|GdkRegion
modifier|*
name|shape
init|=
name|NULL
decl_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|GDK_WINDOWING_X11
argument_list|)
operator|&&
name|defined
argument_list|(
name|HAVE_X11_EXTENSIONS_SHAPE_H
argument_list|)
name|XRectangle
modifier|*
name|rects
decl_stmt|;
name|gint
name|rect_count
decl_stmt|;
name|gint
name|rect_order
decl_stmt|;
name|rects
operator|=
name|XShapeGetRectangles
argument_list|(
name|GDK_SCREEN_XDISPLAY
argument_list|(
name|screen
argument_list|)
argument_list|,
name|window
argument_list|,
name|ShapeBounding
argument_list|,
operator|&
name|rect_count
argument_list|,
operator|&
name|rect_order
argument_list|)
expr_stmt|;
if|if
condition|(
name|rects
condition|)
block|{
if|if
condition|(
name|rect_count
operator|>
literal|1
condition|)
block|{
name|gint
name|i
decl_stmt|;
name|shape
operator|=
name|gdk_region_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|rect_count
condition|;
name|i
operator|++
control|)
block|{
name|GdkRectangle
name|rect
init|=
block|{
name|rects
index|[
name|i
index|]
operator|.
name|x
block|,
name|rects
index|[
name|i
index|]
operator|.
name|y
block|,
name|rects
index|[
name|i
index|]
operator|.
name|width
block|,
name|rects
index|[
name|i
index|]
operator|.
name|height
block|}
decl_stmt|;
name|gdk_region_union_with_rect
argument_list|(
name|shape
argument_list|,
operator|&
name|rect
argument_list|)
expr_stmt|;
block|}
block|}
name|XFree
argument_list|(
name|rects
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
return|return
name|shape
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|image_select_shape (gint32 image,GdkRegion * shape)
name|image_select_shape
parameter_list|(
name|gint32
name|image
parameter_list|,
name|GdkRegion
modifier|*
name|shape
parameter_list|)
block|{
name|GdkRectangle
modifier|*
name|rects
decl_stmt|;
name|gint
name|num_rects
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gimp_selection_none
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gdk_region_get_rectangles
argument_list|(
name|shape
argument_list|,
operator|&
name|rects
argument_list|,
operator|&
name|num_rects
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_rects
condition|;
name|i
operator|++
control|)
block|{
name|gimp_rect_select
argument_list|(
name|image
argument_list|,
name|rects
index|[
name|i
index|]
operator|.
name|x
argument_list|,
name|rects
index|[
name|i
index|]
operator|.
name|y
argument_list|,
name|rects
index|[
name|i
index|]
operator|.
name|width
argument_list|,
name|rects
index|[
name|i
index|]
operator|.
name|height
argument_list|,
name|GIMP_CHANNEL_OP_ADD
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|rects
argument_list|)
expr_stmt|;
name|gimp_selection_invert
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Create a GimpImage from a GdkPixbuf */
end_comment

begin_function
specifier|static
name|gint32
DECL|function|create_image (GdkPixbuf * pixbuf,GdkRegion * shape,const gchar * name)
name|create_image
parameter_list|(
name|GdkPixbuf
modifier|*
name|pixbuf
parameter_list|,
name|GdkRegion
modifier|*
name|shape
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|gint32
name|image
decl_stmt|;
name|gint32
name|layer
decl_stmt|;
name|gdouble
name|xres
decl_stmt|,
name|yres
decl_stmt|;
name|gchar
modifier|*
name|comment
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
name|gboolean
name|status
decl_stmt|;
name|status
operator|=
name|gimp_progress_init
argument_list|(
name|_
argument_list|(
literal|"Importing screenshot"
argument_list|)
argument_list|)
expr_stmt|;
name|width
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|height
operator|=
name|gdk_pixbuf_get_height
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|image
operator|=
name|gimp_image_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|GIMP_RGB
argument_list|)
expr_stmt|;
name|gimp_image_undo_disable
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_get_monitor_resolution
argument_list|(
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|gimp_image_set_resolution
argument_list|(
name|image
argument_list|,
name|xres
argument_list|,
name|yres
argument_list|)
expr_stmt|;
name|comment
operator|=
name|gimp_get_default_comment
argument_list|()
expr_stmt|;
if|if
condition|(
name|comment
condition|)
block|{
name|GimpParasite
modifier|*
name|parasite
decl_stmt|;
name|parasite
operator|=
name|gimp_parasite_new
argument_list|(
literal|"gimp-comment"
argument_list|,
name|GIMP_PARASITE_PERSISTENT
argument_list|,
name|strlen
argument_list|(
name|comment
argument_list|)
operator|+
literal|1
argument_list|,
name|comment
argument_list|)
expr_stmt|;
name|gimp_image_parasite_attach
argument_list|(
name|image
argument_list|,
name|parasite
argument_list|)
expr_stmt|;
name|gimp_parasite_free
argument_list|(
name|parasite
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|comment
argument_list|)
expr_stmt|;
block|}
name|layer
operator|=
name|gimp_layer_new_from_pixbuf
argument_list|(
name|image
argument_list|,
name|name
condition|?
name|name
else|:
name|_
argument_list|(
literal|"Screenshot"
argument_list|)
argument_list|,
name|pixbuf
argument_list|,
literal|100
argument_list|,
name|GIMP_NORMAL_MODE
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gimp_image_insert_layer
argument_list|(
name|image
argument_list|,
name|layer
argument_list|,
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|shape
operator|&&
operator|!
name|gdk_region_empty
argument_list|(
name|shape
argument_list|)
condition|)
block|{
name|image_select_shape
argument_list|(
name|image
argument_list|,
name|shape
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_selection_is_empty
argument_list|(
name|image
argument_list|)
condition|)
block|{
name|gimp_layer_add_alpha
argument_list|(
name|layer
argument_list|)
expr_stmt|;
name|gimp_edit_clear
argument_list|(
name|layer
argument_list|)
expr_stmt|;
name|gimp_selection_none
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
block|}
name|gimp_image_undo_enable
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|image
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|add_cursor_image (gint32 image,GdkDisplay * display)
name|add_cursor_image
parameter_list|(
name|gint32
name|image
parameter_list|,
name|GdkDisplay
modifier|*
name|display
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|HAVE_XFIXES
name|XFixesCursorImage
modifier|*
name|cursor
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|GimpPixelRgn
name|rgn
decl_stmt|;
name|gpointer
name|pr
decl_stmt|;
name|gint32
name|layer
decl_stmt|;
name|gint32
name|active
decl_stmt|;
name|cursor
operator|=
name|XFixesGetCursorImage
argument_list|(
name|GDK_DISPLAY_XDISPLAY
argument_list|(
name|display
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|cursor
condition|)
return|return;
name|active
operator|=
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|layer
operator|=
name|gimp_layer_new
argument_list|(
name|image
argument_list|,
name|_
argument_list|(
literal|"Mouse Pointer"
argument_list|)
argument_list|,
name|cursor
operator|->
name|width
argument_list|,
name|cursor
operator|->
name|height
argument_list|,
name|GIMP_RGBA_IMAGE
argument_list|,
literal|100.0
argument_list|,
name|GIMP_NORMAL_MODE
argument_list|)
expr_stmt|;
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|layer
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|rgn
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|drawable
operator|->
name|width
argument_list|,
name|drawable
operator|->
name|height
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|gimp_pixel_rgns_register
argument_list|(
literal|1
argument_list|,
operator|&
name|rgn
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|gimp_pixel_rgns_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
specifier|const
name|gulong
modifier|*
name|src
init|=
name|cursor
operator|->
name|pixels
operator|+
name|rgn
operator|.
name|y
operator|*
name|cursor
operator|->
name|width
operator|+
name|rgn
operator|.
name|x
decl_stmt|;
name|guchar
modifier|*
name|dest
init|=
name|rgn
operator|.
name|data
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|rgn
operator|.
name|h
condition|;
name|y
operator|++
control|)
block|{
specifier|const
name|gulong
modifier|*
name|s
init|=
name|src
decl_stmt|;
name|guchar
modifier|*
name|d
init|=
name|dest
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|rgn
operator|.
name|w
condition|;
name|x
operator|++
control|)
block|{
comment|/*  the cursor pixels are pre-multiplied ARGB  */
name|guint
name|a
init|=
operator|(
operator|*
name|s
operator|>>
literal|24
operator|)
operator|&
literal|0xff
decl_stmt|;
name|guint
name|r
init|=
operator|(
operator|*
name|s
operator|>>
literal|16
operator|)
operator|&
literal|0xff
decl_stmt|;
name|guint
name|g
init|=
operator|(
operator|*
name|s
operator|>>
literal|8
operator|)
operator|&
literal|0xff
decl_stmt|;
name|guint
name|b
init|=
operator|(
operator|*
name|s
operator|>>
literal|0
operator|)
operator|&
literal|0xff
decl_stmt|;
name|d
index|[
literal|0
index|]
operator|=
name|a
condition|?
operator|(
name|r
operator|*
literal|255
operator|)
operator|/
name|a
else|:
name|r
expr_stmt|;
name|d
index|[
literal|1
index|]
operator|=
name|a
condition|?
operator|(
name|g
operator|*
literal|255
operator|)
operator|/
name|a
else|:
name|g
expr_stmt|;
name|d
index|[
literal|2
index|]
operator|=
name|a
condition|?
operator|(
name|b
operator|*
literal|255
operator|)
operator|/
name|a
else|:
name|b
expr_stmt|;
name|d
index|[
literal|3
index|]
operator|=
name|a
expr_stmt|;
name|s
operator|++
expr_stmt|;
name|d
operator|+=
literal|4
expr_stmt|;
block|}
name|src
operator|+=
name|cursor
operator|->
name|width
expr_stmt|;
name|dest
operator|+=
name|rgn
operator|.
name|rowstride
expr_stmt|;
block|}
block|}
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|gimp_image_insert_layer
argument_list|(
name|image
argument_list|,
name|layer
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_layer_set_offsets
argument_list|(
name|layer
argument_list|,
name|cursor
operator|->
name|x
operator|-
name|cursor
operator|->
name|xhot
argument_list|,
name|cursor
operator|->
name|y
operator|-
name|cursor
operator|->
name|yhot
argument_list|)
expr_stmt|;
name|gimp_image_set_active_layer
argument_list|(
name|image
argument_list|,
name|active
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* The main Screenshot function */
end_comment

begin_function
specifier|static
name|gint32
DECL|function|shoot (GdkScreen * screen)
name|shoot
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
block|{
name|GdkDisplay
modifier|*
name|display
decl_stmt|;
name|GdkWindow
modifier|*
name|window
decl_stmt|;
name|GdkPixbuf
modifier|*
name|screenshot
decl_stmt|;
name|GdkRegion
modifier|*
name|shape
init|=
name|NULL
decl_stmt|;
name|GdkRectangle
name|rect
decl_stmt|;
name|GdkRectangle
name|screen_rect
decl_stmt|;
name|gchar
modifier|*
name|name
init|=
name|NULL
decl_stmt|;
name|gint32
name|image
decl_stmt|;
name|gint
name|screen_x
decl_stmt|;
name|gint
name|screen_y
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
comment|/* use default screen if we are running non-interactively */
if|if
condition|(
name|screen
operator|==
name|NULL
condition|)
name|screen
operator|=
name|gdk_screen_get_default
argument_list|()
expr_stmt|;
name|display
operator|=
name|gdk_screen_get_display
argument_list|(
name|screen
argument_list|)
expr_stmt|;
name|screen_rect
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|screen_rect
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|screen_rect
operator|.
name|width
operator|=
name|gdk_screen_get_width
argument_list|(
name|screen
argument_list|)
expr_stmt|;
name|screen_rect
operator|.
name|height
operator|=
name|gdk_screen_get_height
argument_list|(
name|screen
argument_list|)
expr_stmt|;
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_REGION
condition|)
block|{
name|rect
operator|.
name|x
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|x1
argument_list|,
name|shootvals
operator|.
name|x2
argument_list|)
expr_stmt|;
name|rect
operator|.
name|y
operator|=
name|MIN
argument_list|(
name|shootvals
operator|.
name|y1
argument_list|,
name|shootvals
operator|.
name|y2
argument_list|)
expr_stmt|;
name|rect
operator|.
name|width
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|x2
operator|-
name|shootvals
operator|.
name|x1
argument_list|)
expr_stmt|;
name|rect
operator|.
name|height
operator|=
name|ABS
argument_list|(
name|shootvals
operator|.
name|y2
operator|-
name|shootvals
operator|.
name|y1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_ROOT
condition|)
block|{
name|window
operator|=
name|gdk_screen_get_root_window
argument_list|(
name|screen
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|window
operator|=
name|gdk_window_foreign_new_for_display
argument_list|(
name|display
argument_list|,
name|shootvals
operator|.
name|window_id
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|window
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Specified window not found"
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gdk_drawable_get_size
argument_list|(
name|GDK_DRAWABLE
argument_list|(
name|window
argument_list|)
argument_list|,
operator|&
name|rect
operator|.
name|width
argument_list|,
operator|&
name|rect
operator|.
name|height
argument_list|)
expr_stmt|;
name|gdk_window_get_origin
argument_list|(
name|window
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|rect
operator|.
name|x
operator|=
name|x
expr_stmt|;
name|rect
operator|.
name|y
operator|=
name|y
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|gdk_rectangle_intersect
argument_list|(
operator|&
name|rect
argument_list|,
operator|&
name|screen_rect
argument_list|,
operator|&
name|rect
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|window
operator|=
name|gdk_screen_get_root_window
argument_list|(
name|screen
argument_list|)
expr_stmt|;
name|gdk_window_get_origin
argument_list|(
name|window
argument_list|,
operator|&
name|screen_x
argument_list|,
operator|&
name|screen_y
argument_list|)
expr_stmt|;
name|screenshot
operator|=
name|gdk_pixbuf_get_from_drawable
argument_list|(
name|NULL
argument_list|,
name|window
argument_list|,
name|NULL
argument_list|,
name|rect
operator|.
name|x
operator|-
name|screen_x
argument_list|,
name|rect
operator|.
name|y
operator|-
name|screen_y
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|rect
operator|.
name|width
argument_list|,
name|rect
operator|.
name|height
argument_list|)
expr_stmt|;
name|gdk_display_beep
argument_list|(
name|display
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|screenshot
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"There was an error taking the screenshot."
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_WINDOW
condition|)
block|{
name|name
operator|=
name|window_get_title
argument_list|(
name|display
argument_list|,
name|shootvals
operator|.
name|window_id
argument_list|)
expr_stmt|;
name|shape
operator|=
name|window_get_shape
argument_list|(
name|screen
argument_list|,
name|shootvals
operator|.
name|window_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|shape
condition|)
name|gdk_region_offset
argument_list|(
name|shape
argument_list|,
name|x
operator|-
name|rect
operator|.
name|x
argument_list|,
name|y
operator|-
name|rect
operator|.
name|y
argument_list|)
expr_stmt|;
block|}
name|image
operator|=
name|create_image
argument_list|(
name|screenshot
argument_list|,
name|shape
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|screenshot
argument_list|)
expr_stmt|;
if|if
condition|(
name|shape
condition|)
name|gdk_region_destroy
argument_list|(
name|shape
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
comment|/* FIXME: Some time might have passed until we get here.    *        The cursor image should be grabbed together with the screenshot.    */
if|if
condition|(
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_ROOT
operator|&&
name|shootvals
operator|.
name|show_cursor
condition|)
name|add_cursor_image
argument_list|(
name|image
argument_list|,
name|display
argument_list|)
expr_stmt|;
return|return
name|image
return|;
block|}
end_function

begin_comment
comment|/*  Screenshot dialog  */
end_comment

begin_function
specifier|static
name|void
DECL|function|shoot_dialog_add_hint (GtkNotebook * notebook,ShootType type,const gchar * hint)
name|shoot_dialog_add_hint
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|ShootType
name|type
parameter_list|,
specifier|const
name|gchar
modifier|*
name|hint
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_LABEL
argument_list|,
literal|"label"
argument_list|,
name|hint
argument_list|,
literal|"wrap"
argument_list|,
name|TRUE
argument_list|,
literal|"justify"
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|,
literal|"xalign"
argument_list|,
literal|0.0
argument_list|,
literal|"yalign"
argument_list|,
literal|0.0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_label_set_attributes
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|PANGO_ATTR_STYLE
argument_list|,
name|PANGO_STYLE_ITALIC
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_notebook_insert_page
argument_list|(
name|notebook
argument_list|,
name|label
argument_list|,
name|NULL
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|shoot_radio_button_toggled (GtkWidget * widget,GtkWidget * notebook)
name|shoot_radio_button_toggled
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|notebook
parameter_list|)
block|{
name|gimp_radio_button_update
argument_list|(
name|widget
argument_list|,
operator|&
name|shootvals
operator|.
name|shoot_type
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|shoot_dialog (GdkScreen ** screen)
name|shoot_dialog
parameter_list|(
name|GdkScreen
modifier|*
modifier|*
name|screen
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|spinner
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|GSList
modifier|*
name|radio_group
init|=
name|NULL
decl_stmt|;
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|gboolean
name|run
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Screenshot"
argument_list|)
argument_list|,
name|PLUG_IN_BINARY
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_dialog_add_button
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"S_nap"
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_new_from_inline
argument_list|(
operator|-
literal|1
argument_list|,
name|screenshot_icon
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|pixbuf
condition|)
block|{
name|gtk_button_set_image
argument_list|(
name|GTK_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|gtk_image_new_from_pixbuf
argument_list|(
name|pixbuf
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
block|}
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|main_vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
comment|/*  Hints  */
name|notebook
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_NOTEBOOK
argument_list|,
literal|"show-border"
argument_list|,
name|FALSE
argument_list|,
literal|"show-tabs"
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|notebook
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|shoot_dialog_add_hint
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|SHOOT_ROOT
argument_list|,
name|_
argument_list|(
literal|"After the delay, the screenshot is taken."
argument_list|)
argument_list|)
expr_stmt|;
name|shoot_dialog_add_hint
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|SHOOT_REGION
argument_list|,
name|_
argument_list|(
literal|"After the delay, drag your mouse to select "
literal|"the region for the screenshot."
argument_list|)
argument_list|)
expr_stmt|;
name|shoot_dialog_add_hint
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|SHOOT_WINDOW
argument_list|,
name|_
argument_list|(
literal|"At the end of the delay, click in a window "
literal|"to snap it."
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
argument_list|)
expr_stmt|;
comment|/*  Area  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Area"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  single window  */
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"Take a screenshot of "
literal|"a single _window"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|SHOOT_WINDOW
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|shoot_radio_button_toggled
argument_list|)
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HAVE_X11_XMU_WINUTIL_H
comment|/*  window decorations  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Include window _decoration"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|shootvals
operator|.
name|decorate
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"set_sensitive"
argument_list|,
name|toggle
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|decorate
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* HAVE_X11_XMU_WINUTIL_H */
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_WINDOW
argument_list|)
expr_stmt|;
comment|/*  whole screen  */
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"Take a screenshot of "
literal|"the entire _screen"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|SHOOT_ROOT
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|shoot_radio_button_toggled
argument_list|)
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|HAVE_XFIXES
comment|/*  mouse pointer  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Include _mouse pointer"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|shootvals
operator|.
name|show_cursor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|toggle
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"set_sensitive"
argument_list|,
name|toggle
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|show_cursor
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_ROOT
argument_list|)
expr_stmt|;
comment|/*  dragged region  */
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"Select a _region to grab"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|shootvals
operator|.
name|shoot_type
operator|==
name|SHOOT_REGION
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|SHOOT_REGION
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|shoot_radio_button_toggled
argument_list|)
argument_list|,
name|notebook
argument_list|)
expr_stmt|;
comment|/*  Delay  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Delay"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|spinner
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adj
argument_list|,
name|shootvals
operator|.
name|select_delay
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0.0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|spinner
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinner
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_int_adjustment_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|select_delay
argument_list|)
expr_stmt|;
comment|/* this is the unit label of a spinbutton */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"seconds"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|run
operator|=
operator|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_OK
operator|)
expr_stmt|;
if|if
condition|(
name|run
condition|)
block|{
comment|/* get the screen on which we are running */
operator|*
name|screen
operator|=
name|gtk_widget_get_screen
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
if|if
condition|(
name|run
condition|)
block|{
comment|/*  A short timeout to give the server a chance to        *  redraw the area that was obscured by our dialog.        */
name|g_timeout_add
argument_list|(
literal|100
argument_list|,
name|shoot_quit_timeout
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
block|}
return|return
name|run
return|;
block|}
end_function

begin_comment
comment|/*  delay functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|shoot_delay (gint delay)
name|shoot_delay
parameter_list|(
name|gint
name|delay
parameter_list|)
block|{
name|g_timeout_add
argument_list|(
literal|1000
argument_list|,
name|shoot_delay_callback
argument_list|,
operator|&
name|delay
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|shoot_delay_callback (gpointer data)
name|shoot_delay_callback
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gint
modifier|*
name|seconds_left
init|=
name|data
decl_stmt|;
operator|(
operator|*
name|seconds_left
operator|)
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|seconds_left
condition|)
name|gtk_main_quit
argument_list|()
expr_stmt|;
return|return
operator|*
name|seconds_left
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|shoot_quit_timeout (gpointer data)
name|shoot_quit_timeout
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_main_quit
argument_list|()
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

end_unit

