begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*  *  ScreenShot plug-in  *  Copyright 1998-2000 Sven Neumann<sven@gimp.org>  *  Copyright 2003      Henrik Brix Andersen<brix@gimp.org>  *  *  Any suggestions, bug-reports or patches are very welcome.  *  */
end_comment

begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_if
if|#
directive|if
name|defined
argument_list|(
name|GDK_WINDOWING_X11
argument_list|)
end_if

begin_include
include|#
directive|include
file|<gdk/gdkx.h>
end_include

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|GDK_WINDOWING_WIN32
argument_list|)
end_elif

begin_include
include|#
directive|include
file|<windows.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_comment
comment|/* GdkPixbuf RGBA C-Source image dump 1-byte-run-length-encoded */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|__SUNPRO_C
end_ifdef

begin_pragma
pragma|#
directive|pragma
name|align
name|4
name|(
name|screenshot_icon
name|)
end_pragma

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_decl_stmt
DECL|variable|screenshot_icon
specifier|static
specifier|const
name|guint8
name|screenshot_icon
index|[]
name|__attribute__
argument_list|(
operator|(
name|__aligned__
argument_list|(
literal|4
argument_list|)
operator|)
argument_list|)
init|=
else|#
directive|else
specifier|static
specifier|const
name|guint8
name|screenshot_icon
index|[]
operator|=
endif|#
directive|endif
block|{
literal|""
comment|/* Pixbuf magic (0x47646b50) */
literal|"GdkP"
comment|/* length: header (24) + pixel_data (2735) */
literal|"\0\0\12\307"
comment|/* pixdata_type (0x2010002) */
literal|"\2\1\0\2"
comment|/* rowstride (128) */
literal|"\0\0\0\200"
comment|/* width (32) */
literal|"\0\0\0\40"
comment|/* height (32) */
literal|"\0\0\0\40"
comment|/* pixel_data: */
literal|"\326\0\0\0\0\1eee\13\230\0\0\0\0\1\15\15\15z\207\0\0\0\377\1\14\14\14"
literal|"W\227\0\0\0\0\11\0\0\0\377\306\306\306\354\364\364\364\377\372\372\372"
literal|"\377\375\375\375\377\372\372\372\377\357\357\357\377\257\257\257\310"
literal|"\0\0\0\377\226\0\0\0\0\12]]]\14\0\0\0\377\304\304\304\377\354\354\354"
literal|"\377\367\367\367\377\372\372\372\377\366\366\366\377\352\352\352\377"
literal|"\257\257\257\354\0\0\0\377\226\0\0\0\0\4QQQ+\0\0\0\377}}}\374\177\177"
literal|"\177\366\204\200\200\200\366\2xxx\377\0\0\0\377\226\0\0\0\0\4\35\35\35"
literal|"[\0\0\0\377333\343AAA\206\202PPPL\5KKKYBBB\211555\377\0\0\0\377'''\30"
literal|"\225\0\0\0\0\4\6\6\6\226\0\0\0\377\35\35\35\324GGGc\203QQQU\4"
literal|"777p\35"
literal|"\35\35\377\0\0\0\377\6\6\6K\224\0\0\0\0\5\0\0\0\33\7\7\7\317\0\0\0\377"
literal|"ZZZ\377eee\377\203fff\377\4ddd\377EEE\377\0\0\0\377\0\0\0\201\215\0\0"
literal|"\0\0\6\0\0\0\4\0\0\0\20\0\0\0\30\2\2\1"
literal|"4\0\0\0B\0\0\0S\202\0\0\0\377"
literal|"\3''&\264ZYY\365uuu\377\205\217\217\217\377\3sss\377HHH\357\17\17\17"
literal|"\330\202\0\0\0\377\3\0\0\0\233\37\37\37B\0\0\0\16\205\0\0\0\0\2\0\0\0"
literal|"\14\0\0\0u\206\0\0\0\377\6XXX\354LLL\354OOO\345ppp\343\233\233\233\377"
literal|"\252\252\252\377\205\265\265\265\377\10\262\262\262\377\221\221\221\377"
literal|"PPP\372LLL\361===\353\36\36\36\343\37\37\37\330\0\0\0"
literal|"0\203\0\0\0\0"
literal|"\1\0\0\0\217\203\0\0\0\377\15kjh\377dca\377gec\377jig\377srp\377\243"
literal|"\243\243\377eee\377\345\345\345\377\340\340\340\377|||\377\255\255\255"
literal|"\377\213\213\213\377\212\212\212\377\204\204\204\204\377\10\206\206\206"
literal|"\377\232\232\232\377xxx\377ooo\377|||\377sss\377HHH\367\27\27\27\243"
literal|"\203\0\0\0\0\35\0\0\0\377cb^\377oom\377|{y\377a`^\377YYY\377222\377U"
literal|"TS\377vur\377\217\217\217\377ZZZ\377\346\346\346\377\336\336\336\377"
literal|"\203\203\203\377\242\242\242\377\213\213\213\377\220\217\217\377\201"
literal|"\200\200\377zzx\377mlk\377rqp\377vvu\377\204\204\204\377\213\213\213"
literal|"\377lll\377xxx\377\177\177\177\377ppp\377\0\0\0\377\203\0\0\0\0\35\0"
literal|"\0\0\377\261\257\254\377\206\205\202\377\201\200|\377onk\377onl\377N"
literal|"ML\377\200\200~\377feb\377@@@\377bbb\377RRR\377fff\377\262\262\262\377"
literal|"\221\221\221\377\221\220\216\377rrp\377vwu\377iji\377QSR\377XYX\377c"
literal|"eb\377_`]\377\202\202\201\377rrr\377iii\377bbb\377nnn\377\0\0\0\377\203"
literal|"\0\0\0\0\23\0\0\0\377\210\207\201\377\265\264\262\377\262\262\260\377"
literal|"\302\301\277\377\307\307\306\377\267\267\266\377`_]\377\"\"\40\377JJ"
literal|"J\377sss\377iii\377www\377\264\263\263\377\200\200\177\377hkh\377[_]"
literal|"\377_bb\377]aa\377\202RVV\377\5JNK\377>B=\377QSO\377hig\377jjj\377\202"
literal|"\177\177\177\377\1\0\0\0\377\203\0\0\0\0\35\0\0\0\377\202\200w\377\177"
literal|"}t\377tqh\377ljb\377a^W\377WUO\377\77=9\377$#\40\377LLL\377uuu\377pp"
literal|"p\377\236\236\236\377\222\223\222\377\\__\377bfe\377JNP\377BHI\377CH"
literal|"J\377BGJ\377>CE\3776::\377/3.\377/2,\377:=8\377jih\377}}}\377\200\200"
literal|"\200\377\0\0\0\377\203\0\0\0\0\35\0\0\0\377\202\177w\377\200}u\377tq"
literal|"h\377mjc\377a_X\377WUO\377@\77;\377.,*\377KKK\377mmm\377yyy\377\224\223"
literal|"\222\377aee\377X]]\377\77DD\377VYW\377\\_^\377MQS\377GLM\377TXZ\377Q"
literal|"TV\377;@A\377,/*\377**#\377SRO\377zzz\377\177\177\177\377\0\0\0\377\203"
literal|"\0\0\0\0\12\0\0\0\377\201~u\377\177|t\377sph\377mjb\377a_X\377WUO\377"
literal|"@>9\377/.+\377KKK\377\202ttt\377\21{}}\377QVW\377DHG\377`bb\377599\377"
literal|"\20\21\21\377\6\6\6\377\11\11\11\377\25\27\27\377DFG\377SVW\3777<>\377"
literal|"+,(\377860\377poo\377zzz\377\0\0\0\377\203\0\0\0\0\23\0\0\0\377\200}"
literal|"u\377\177|t\377spg\377ljb\377a_X\377WTN\377@>9\377/.+\377KKK\377ttt\377"
literal|"bdd\377rvw\377\77DD\377\\_^\3778;9\377444\377FFF\377111\377\202\37\37"
literal|"\37\377\10\35\36\36\3778<<\377DIL\377154\377*)\"\377nmk\377\200\200\200"
literal|"\377\0\0\0\377\203\0\0\0\0>\0\0\0\377\177}u\377~{s\377sph\377ljb\377"
literal|"`^W\377UTM\377@=9\377..*\377III\377nnn\377_`a\377@FG\377HLL\377LPQ\377"
literal|",-+\377\251\251\251\377\200\200\200\377\242\242\242\377OOO\377\77\77"
literal|"\77\377111\377)++\377HMP\377BIK\377\34\34\27\377NMK\377qqq\377\0\0\0"
literal|"\377\0\0\0\2\0\0\0\1\0\0\0\0\0\0\0\377\177}t\377~{s\377rog\377lia\377"
literal|"`^W\377USM\377\77=8\377..*\377III\377lll\377ghh\3779>\77\377SWV\377F"
literal|"JG\377$$#\377lll\377\242\242\242\377\363\363\363\377\221\221\221\377"
literal|"ddd\377DDD\377111\377GLO\377HNQ\377\35\35\32\377QPN\377lll\377\0\0\0"
literal|"\377\0\0\0\6\202\0\0\0\3\36\0\0\0\377\177|t\377}zs\377rog\377kha\377"
literal|"`]W\377USM\377>=8\377.-*\377HHH\377rrr\377dee\3777;<\377LRS\377:>:\377"
literal|"\10\10\7\377CCC\377yyy\377\233\233\233\377\242\242\242\377{{{\377TTT"
literal|"\377<<<\377INQ\377HMQ\377$%#\377mmk\377ttt\377\0\0\0\377\0\0\0\21\202"
literal|"\0\0\0\10"
literal|"3\0\0\0\377~{s\377}zr\377qog\377kha\377_]V\377TRL\377><8\377"
literal|".-*\377JJJ\377uuu\377iij\3777;<\3779AC\377387\377\21\22\20\377\37\37"
literal|"\37\377\77\77\77\377ddd\377{{{\377ppp\377\223\223\223\377@AA\377CJM\377"
literal|"\77FI\377-/.\377ssr\377ppp\377\0\0\0\377\0\0\0\31\0\0\0\14\0\0\0\16\0"
literal|"\0\0\377~{t\377}zr\377qnf\377jh`\377^\\V\377SQL\377><7\377.-*\377HHH"
literal|"\377www\377non\377/12\3776>>\377;CF\377%)&\377\33\34\33\377111\377DD"
literal|"D\377\202TTT\377\23FFG\377MOR\377;BG\377058\377DEE\377uuu\377NNN\374"
literal|"\21\21\21\302\0\0\0\34\0\0\0\15\0\0\0\17\0\0\0\264NLJ\377{xq\377ome\377"
literal|"jg`\377`]V\377TQL\377973\377\204\0\0\0\377\14\22\23\23\3774:;\377;CG"
literal|"\377>DC\377*.-\377'((\377111\377;;;\377<>>\377FJM\377FLO\377=BG\377\203"
literal|"\0\0\0\377\7\10\10\10\273\1\1\1l\0\0\0\26\0\0\0\11\0\0\0\12\0\0\0m\0"
literal|"\0\0\256\206\0\0\0\377\40\3\3\2\301\0\0\0\236\0\0\0n\0\0\0t\1\1\1\204"
literal|"\17\20\21\354\0\0\0\377Z]^\377RVW\377<AC\3779>B\377\77EH\377HLO\377["
literal|"]_\377UY[\377\0\0\0\377\14\15\16\266\0\0\0_\0\0\0I\0\0\0-\0\0\0\32\0"
literal|"\0\0\13\0\0\0\4\0\0\0\5\0\0\0\14\0\0\0#\0\0\0;\0\0\0P\0\0\0\\\3\3\3f"
literal|"\11\10\10[\4\4\4N\202\0\0\0B\24\0\0\0E\0\0\0O\0\0\0[\4\5\5\212\20\22"
literal|"\24\321\0\0\0\377INR\377BIM\377BHL\377Z^`\377KOR\377NRU\377\0\0\0\377"
literal|"\17\20\21\265\5\5\6c\0\0\0@\0\0\0-\0\0\0\31\0\0\0\15\0\0\0\4\202\0\0"
literal|"\0\1\4\0\0\0\3\0\0\0\6\0\0\0\11\0\0\0\13\202\0\0\0\15\13\0\0\0\17\0\0"
literal|"\0\22\0\0\0\24\0\0\0\26\0\0\0\32\0\0\0&\0\0\0"
literal|"0\0\0\0<\1\1\2M\11\12"
literal|"\13\232\34\37!\320\204\0\0\0\377\10\16\17\17\300\14\14\14w\0\0\0<\0\0"
literal|"\0.\0\0\0\35\0\0\0\21\0\0\0\7\0\0\0\3\204\0\0\0\0\6\0\0\0\1\0\0\0\2\0"
literal|"\0\0\1\0\0\0\2\0\0\0\1\0\0\0\2\202\0\0\0\3\23\0\0\0\5\0\0\0\6\0\0\0\17"
literal|"\0\0\0\26\0\0\0\37\0\0\0#\0\0\0-\4\4\5@\3\3\3[\0\0\0p\2\3\3d\7\10\10"
literal|"O\7\10\10"
literal|"7\0\0\0&\0\0\0\35\0\0\0\24\0\0\0\12\0\0\0\5\0\0\0\1\217\0"
literal|"\0\0\0\6\0\0\0\3\0\0\0\5\0\0\0\11\0\0\0\14\0\0\0\20\0\0\0\23\202\0\0"
literal|"\0\25\7\0\0\0\23\0\0\0\21\0\0\0\15\0\0\0\13\0\0\0\7\0\0\0\4\0\0\0\2\222"
literal|"\0\0\0\0\5\0\0\0\1\0\0\0\2\0\0\0\4\0\0\0\5\0\0\0\7\202\0\0\0\10\5\0\0"
literal|"\0\6\0\0\0\5\0\0\0\3\0\0\0\2\0\0\0\1\207\0\0\0\0"
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Defines */
end_comment

begin_define
DECL|macro|PLUG_IN_NAME
define|#
directive|define
name|PLUG_IN_NAME
value|"plug_in_screenshot"
end_define

begin_define
DECL|macro|HELP_ID
define|#
directive|define
name|HELP_ID
value|"plug-in-screenshot"
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|GDK_NATIVE_WINDOW_POINTER
end_ifdef

begin_if
if|#
directive|if
name|GLIB_SIZEOF_VOID_P
operator|!=
literal|4
end_if

begin_warning
warning|#
directive|warning
warning|window_id does not fit in PDB_INT32
end_warning

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2bd27e910108
block|{
DECL|member|root
name|gboolean
name|root
decl_stmt|;
DECL|member|window_id
name|guint
name|window_id
decl_stmt|;
DECL|member|select_delay
name|guint
name|select_delay
decl_stmt|;
DECL|member|grab_delay
name|guint
name|grab_delay
decl_stmt|;
DECL|typedef|ScreenShotValues
block|}
name|ScreenShotValues
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|shootvals
specifier|static
name|ScreenShotValues
name|shootvals
init|=
block|{
name|FALSE
block|,
comment|/* root window  */
literal|0
block|,
comment|/* window ID    */
literal|0
block|,
comment|/* select delay */
literal|0
block|,
comment|/* grab delay   */
block|}
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GdkNativeWindow
name|select_window
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|create_image
parameter_list|(
specifier|const
name|GdkPixbuf
modifier|*
name|pixbuf
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|shoot
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|shoot_dialog
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|shoot_delay
parameter_list|(
name|gint32
name|delay
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|shoot_delay_callback
parameter_list|(
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Global Variables */
end_comment

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the image that will be returned */
end_comment

begin_decl_stmt
DECL|variable|image_ID
specifier|static
name|gint32
name|image_ID
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the screen on which we are running */
end_comment

begin_decl_stmt
DECL|variable|cur_screen
specifier|static
name|GdkScreen
modifier|*
name|cur_screen
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the window the user selected */
end_comment

begin_decl_stmt
DECL|variable|selected_native
specifier|static
name|GdkNativeWindow
name|selected_native
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Functions */
end_comment

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GimpParamDef
name|args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"root"
block|,
literal|"Root window { TRUE, FALSE }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"window_id"
block|,
literal|"Window id"
block|}
block|}
decl_stmt|;
specifier|static
name|GimpParamDef
name|return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Output image"
block|}
block|}
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|PLUG_IN_NAME
argument_list|,
literal|"Creates a screenshot of a single window or the whole screen"
argument_list|,
literal|"After a user specified time out the user selects a window and "
literal|"another time out is started. At the end of the second time out "
literal|"the window is grabbed and the image is loaded into The GIMP. "
literal|"Alternatively the whole screen can be grabbed. When called "
literal|"non-interactively it may grab the root window or use the "
literal|"window-id passed as a parameter."
argument_list|,
literal|"Sven Neumann<sven@gimp.org>, Henrik Brix Andersen<brix@gimp.org>"
argument_list|,
literal|"1998 - 2003"
argument_list|,
literal|"v0.9.7 (2003/11/15)"
argument_list|,
name|N_
argument_list|(
literal|"_Screen Shot..."
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|args
argument_list|)
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|return_vals
argument_list|)
argument_list|,
name|args
argument_list|,
name|return_vals
argument_list|)
expr_stmt|;
name|gimp_plugin_menu_register
argument_list|(
name|PLUG_IN_NAME
argument_list|,
name|N_
argument_list|(
literal|"<Toolbox>/File/Acquire"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* gimp_plugin_menu_register (PLUG_IN_NAME, N_("<Image>/File/Acquire")); */
name|gimp_plugin_icon_register
argument_list|(
name|PLUG_IN_NAME
argument_list|,
name|GIMP_ICON_TYPE_INLINE_PIXBUF
argument_list|,
name|screenshot_icon
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (const gchar * name,gint nparams,const GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
comment|/* Get the runmode from the in-parameters */
name|GimpRunMode
name|run_mode
init|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
decl_stmt|;
comment|/* status variable, use it to check for errors in invocation usually only    * during non-interactive calling    */
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
comment|/* always return at least the status to the caller. */
specifier|static
name|GimpParam
name|values
index|[
literal|2
index|]
decl_stmt|;
comment|/* initialize the return of the status */
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
comment|/* how are we running today? */
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|GIMP_RUN_INTERACTIVE
case|:
comment|/* Possibly retrieve data from a previous run */
name|gimp_get_data
argument_list|(
name|PLUG_IN_NAME
argument_list|,
operator|&
name|shootvals
argument_list|)
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
literal|0
expr_stmt|;
comment|/* Get information from the dialog */
if|if
condition|(
operator|!
name|shoot_dialog
argument_list|()
condition|)
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_NONINTERACTIVE
case|:
if|if
condition|(
name|nparams
operator|==
literal|3
condition|)
block|{
name|shootvals
operator|.
name|root
operator|=
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|window_id
operator|=
name|param
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|shootvals
operator|.
name|select_delay
operator|=
literal|0
expr_stmt|;
name|shootvals
operator|.
name|grab_delay
operator|=
literal|0
expr_stmt|;
block|}
else|else
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
if|if
condition|(
operator|!
name|gdk_init_check
argument_list|(
literal|0
argument_list|,
name|NULL
argument_list|)
condition|)
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_WITH_LAST_VALS
case|:
comment|/* Possibly retrieve data from a previous run */
name|gimp_get_data
argument_list|(
name|PLUG_IN_NAME
argument_list|,
operator|&
name|shootvals
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
if|if
condition|(
name|shootvals
operator|.
name|grab_delay
operator|>
literal|0
condition|)
name|shoot_delay
argument_list|(
name|shootvals
operator|.
name|grab_delay
argument_list|)
expr_stmt|;
comment|/* Run the main function */
name|shoot
argument_list|()
expr_stmt|;
name|status
operator|=
operator|(
name|image_ID
operator|!=
operator|-
literal|1
operator|)
condition|?
name|GIMP_PDB_SUCCESS
else|:
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
if|if
condition|(
name|run_mode
operator|==
name|GIMP_RUN_INTERACTIVE
condition|)
block|{
comment|/* Store variable states for next run */
name|gimp_set_data
argument_list|(
name|PLUG_IN_NAME
argument_list|,
operator|&
name|shootvals
argument_list|,
sizeof|sizeof
argument_list|(
name|ScreenShotValues
argument_list|)
argument_list|)
expr_stmt|;
comment|/* display the image */
name|gimp_display_new
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
block|}
comment|/* set return values */
operator|*
name|nreturn_vals
operator|=
literal|2
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image_ID
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Allow the user to select a window with the mouse */
end_comment

begin_function
specifier|static
name|GdkNativeWindow
DECL|function|select_window (GdkScreen * screen)
name|select_window
parameter_list|(
name|GdkScreen
modifier|*
name|screen
parameter_list|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|GDK_WINDOWING_X11
argument_list|)
comment|/* X11 specific code */
DECL|macro|MASK
define|#
directive|define
name|MASK
value|(ButtonPressMask | ButtonReleaseMask)
name|Display
modifier|*
name|x_dpy
decl_stmt|;
name|Cursor
name|x_cursor
decl_stmt|;
name|XEvent
name|x_event
decl_stmt|;
name|Window
name|x_win
decl_stmt|;
name|Window
name|x_root
decl_stmt|;
name|gint
name|x_scr
decl_stmt|;
name|gint
name|status
decl_stmt|;
name|gint
name|buttons
decl_stmt|;
name|x_dpy
operator|=
name|GDK_SCREEN_XDISPLAY
argument_list|(
name|screen
argument_list|)
expr_stmt|;
name|x_scr
operator|=
name|GDK_SCREEN_XNUMBER
argument_list|(
name|screen
argument_list|)
expr_stmt|;
name|x_win
operator|=
name|None
expr_stmt|;
name|x_root
operator|=
name|RootWindow
argument_list|(
name|x_dpy
argument_list|,
name|x_scr
argument_list|)
expr_stmt|;
name|x_cursor
operator|=
name|XCreateFontCursor
argument_list|(
name|x_dpy
argument_list|,
name|GDK_CROSSHAIR
argument_list|)
expr_stmt|;
name|buttons
operator|=
literal|0
expr_stmt|;
name|status
operator|=
name|XGrabPointer
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|False
argument_list|,
name|MASK
argument_list|,
name|GrabModeSync
argument_list|,
name|GrabModeAsync
argument_list|,
name|x_root
argument_list|,
name|x_cursor
argument_list|,
name|CurrentTime
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|!=
name|GrabSuccess
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Error grabbing the pointer"
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
while|while
condition|(
operator|(
name|x_win
operator|==
name|None
operator|)
operator|||
operator|(
name|buttons
operator|!=
literal|0
operator|)
condition|)
block|{
name|XAllowEvents
argument_list|(
name|x_dpy
argument_list|,
name|SyncPointer
argument_list|,
name|CurrentTime
argument_list|)
expr_stmt|;
name|XWindowEvent
argument_list|(
name|x_dpy
argument_list|,
name|x_root
argument_list|,
name|MASK
argument_list|,
operator|&
name|x_event
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|x_event
operator|.
name|type
condition|)
block|{
case|case
name|ButtonPress
case|:
if|if
condition|(
name|x_win
operator|==
name|None
condition|)
block|{
name|x_win
operator|=
name|x_event
operator|.
name|xbutton
operator|.
name|subwindow
expr_stmt|;
if|if
condition|(
name|x_win
operator|==
name|None
condition|)
name|x_win
operator|=
name|x_root
expr_stmt|;
block|}
name|buttons
operator|++
expr_stmt|;
break|break;
case|case
name|ButtonRelease
case|:
if|if
condition|(
name|buttons
operator|>
literal|0
condition|)
name|buttons
operator|--
expr_stmt|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
block|}
block|}
name|XUngrabPointer
argument_list|(
name|x_dpy
argument_list|,
name|CurrentTime
argument_list|)
expr_stmt|;
name|XFreeCursor
argument_list|(
name|x_dpy
argument_list|,
name|x_cursor
argument_list|)
expr_stmt|;
return|return
name|x_win
return|;
elif|#
directive|elif
name|defined
argument_list|(
name|GDK_WINDOWING_WIN32
argument_list|)
comment|/* MS Windows specific code goes here (yet to be written) */
comment|/* basically the code should grab the pointer using a crosshair      cursor, allow the user to click on a window and return the      obtained HWND (as a GdkNativeWindow) - for more details consult      the X11 specific code above */
comment|/* note to self: take a look at the winsnap plug-in for example      code */
ifdef|#
directive|ifdef
name|__GNUC__
warning|#
directive|warning
warning|Win32 screenshot window chooser not implemented yet
else|#
directive|else
pragma|#
directive|pragma
name|message
literal|"Win32 screenshot window chooser not implemented yet"
endif|#
directive|endif
return|return
literal|0
return|;
else|#
directive|else
comment|/* GDK_WINDOWING_WIN32 */
warning|#
directive|warning
warning|screenshot window chooser not implemented yet for this GDK backend
return|return
literal|0
return|;
endif|#
directive|endif
block|}
end_function

begin_comment
comment|/* Create a GimpImage from a GdkPixbuf */
end_comment

begin_function
specifier|static
name|gint32
DECL|function|create_image (const GdkPixbuf * pixbuf)
name|create_image
parameter_list|(
specifier|const
name|GdkPixbuf
modifier|*
name|pixbuf
parameter_list|)
block|{
name|GimpPixelRgn
name|rgn
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|image
decl_stmt|;
name|gint32
name|layer
decl_stmt|;
name|gdouble
name|xres
decl_stmt|,
name|yres
decl_stmt|;
name|gchar
modifier|*
name|comment
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
name|gint
name|rowstride
decl_stmt|;
name|gint
name|bpp
decl_stmt|;
name|gboolean
name|status
decl_stmt|;
name|gchar
modifier|*
name|pixels
decl_stmt|;
name|gpointer
name|pr
decl_stmt|;
name|status
operator|=
name|gimp_progress_init
argument_list|(
name|_
argument_list|(
literal|"Loading Screen Shot..."
argument_list|)
argument_list|)
expr_stmt|;
name|width
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|height
operator|=
name|gdk_pixbuf_get_height
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|image
operator|=
name|gimp_image_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|GIMP_RGB
argument_list|)
expr_stmt|;
name|gimp_image_undo_disable
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|layer
operator|=
name|gimp_layer_new
argument_list|(
name|image
argument_list|,
name|_
argument_list|(
literal|"Screen Shot"
argument_list|)
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|GIMP_RGB_IMAGE
argument_list|,
literal|100
argument_list|,
name|GIMP_NORMAL_MODE
argument_list|)
expr_stmt|;
name|gimp_image_add_layer
argument_list|(
name|image
argument_list|,
name|layer
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|layer
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|rgn
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|rowstride
operator|=
name|gdk_pixbuf_get_rowstride
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|bpp
operator|=
name|gdk_pixbuf_get_n_channels
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|pixels
operator|=
name|gdk_pixbuf_get_pixels
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|bpp
operator|==
name|rgn
operator|.
name|bpp
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|gimp_pixel_rgns_register
argument_list|(
literal|1
argument_list|,
operator|&
name|rgn
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|gimp_pixel_rgns_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
specifier|const
name|guchar
modifier|*
name|src
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
name|gint
name|y
decl_stmt|;
name|src
operator|=
name|pixels
operator|+
name|rgn
operator|.
name|y
operator|*
name|rowstride
operator|+
name|rgn
operator|.
name|x
operator|*
name|bpp
expr_stmt|;
name|dest
operator|=
name|rgn
operator|.
name|data
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|rgn
operator|.
name|h
condition|;
name|y
operator|++
control|)
block|{
name|memcpy
argument_list|(
name|dest
argument_list|,
name|src
argument_list|,
name|rgn
operator|.
name|w
operator|*
name|rgn
operator|.
name|bpp
argument_list|)
expr_stmt|;
name|src
operator|+=
name|rowstride
expr_stmt|;
name|dest
operator|+=
name|rgn
operator|.
name|rowstride
expr_stmt|;
block|}
block|}
name|gimp_drawable_detach
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|gimp_progress_update
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|gimp_get_monitor_resolution
argument_list|(
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|gimp_image_set_resolution
argument_list|(
name|image
argument_list|,
name|xres
argument_list|,
name|yres
argument_list|)
expr_stmt|;
name|comment
operator|=
name|gimp_get_default_comment
argument_list|()
expr_stmt|;
if|if
condition|(
name|comment
condition|)
block|{
name|GimpParasite
modifier|*
name|parasite
decl_stmt|;
name|parasite
operator|=
name|gimp_parasite_new
argument_list|(
literal|"gimp-comment"
argument_list|,
name|GIMP_PARASITE_PERSISTENT
argument_list|,
name|g_utf8_strlen
argument_list|(
name|comment
argument_list|,
operator|-
literal|1
argument_list|)
operator|+
literal|1
argument_list|,
name|comment
argument_list|)
expr_stmt|;
name|gimp_image_parasite_attach
argument_list|(
name|image_ID
argument_list|,
name|parasite
argument_list|)
expr_stmt|;
name|gimp_parasite_free
argument_list|(
name|parasite
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|comment
argument_list|)
expr_stmt|;
block|}
name|gimp_image_undo_enable
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|image
return|;
block|}
end_function

begin_comment
comment|/* The main ScreenShot function */
end_comment

begin_function
specifier|static
name|void
DECL|function|shoot (void)
name|shoot
parameter_list|(
name|void
parameter_list|)
block|{
name|GdkWindow
modifier|*
name|window
decl_stmt|;
name|GdkPixbuf
modifier|*
name|screenshot
decl_stmt|;
name|GdkRectangle
name|rect
decl_stmt|;
name|GdkRectangle
name|screen_rect
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
comment|/* use default screen if we are running non-interactively */
if|if
condition|(
name|cur_screen
operator|==
name|NULL
condition|)
name|cur_screen
operator|=
name|gdk_screen_get_default
argument_list|()
expr_stmt|;
name|screen_rect
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|screen_rect
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|screen_rect
operator|.
name|width
operator|=
name|gdk_screen_get_width
argument_list|(
name|cur_screen
argument_list|)
expr_stmt|;
name|screen_rect
operator|.
name|height
operator|=
name|gdk_screen_get_height
argument_list|(
name|cur_screen
argument_list|)
expr_stmt|;
if|if
condition|(
name|shootvals
operator|.
name|root
condition|)
block|{
comment|/* entire screen */
name|window
operator|=
name|gdk_screen_get_root_window
argument_list|(
name|cur_screen
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|GdkDisplay
modifier|*
name|display
decl_stmt|;
name|display
operator|=
name|gdk_screen_get_display
argument_list|(
name|cur_screen
argument_list|)
expr_stmt|;
comment|/* single window */
if|if
condition|(
name|shootvals
operator|.
name|window_id
condition|)
block|{
name|window
operator|=
name|gdk_window_foreign_new_for_display
argument_list|(
name|display
argument_list|,
name|shootvals
operator|.
name|window_id
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|window
operator|=
name|gdk_window_foreign_new_for_display
argument_list|(
name|display
argument_list|,
name|selected_native
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|window
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Specified window not found"
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|gdk_window_get_origin
argument_list|(
name|window
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|rect
operator|.
name|x
operator|=
name|x
expr_stmt|;
name|rect
operator|.
name|y
operator|=
name|y
expr_stmt|;
name|gdk_drawable_get_size
argument_list|(
name|GDK_DRAWABLE
argument_list|(
name|window
argument_list|)
argument_list|,
operator|&
name|rect
operator|.
name|width
argument_list|,
operator|&
name|rect
operator|.
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gdk_rectangle_intersect
argument_list|(
operator|&
name|rect
argument_list|,
operator|&
name|screen_rect
argument_list|,
operator|&
name|rect
argument_list|)
condition|)
return|return;
name|screenshot
operator|=
name|gdk_pixbuf_get_from_drawable
argument_list|(
name|NULL
argument_list|,
name|window
argument_list|,
name|NULL
argument_list|,
name|rect
operator|.
name|x
operator|-
name|x
argument_list|,
name|rect
operator|.
name|y
operator|-
name|y
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|rect
operator|.
name|width
argument_list|,
name|rect
operator|.
name|height
argument_list|)
expr_stmt|;
name|gdk_display_beep
argument_list|(
name|gdk_screen_get_display
argument_list|(
name|cur_screen
argument_list|)
argument_list|)
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|screenshot
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Error obtaining Screen Shot"
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|image_ID
operator|=
name|create_image
argument_list|(
name|screenshot
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|screenshot
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  ScreenShot dialog  */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|shoot_dialog (void)
name|shoot_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|spinner
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|GSList
modifier|*
name|radio_group
init|=
name|NULL
decl_stmt|;
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|gboolean
name|run
decl_stmt|;
name|gimp_ui_init
argument_list|(
literal|"screenshot"
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Screen Shot"
argument_list|)
argument_list|,
literal|"screenshot"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|HELP_ID
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|main_vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_new_from_inline
argument_list|(
operator|-
literal|1
argument_list|,
name|screenshot_icon
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|pixbuf
condition|)
block|{
name|GtkWidget
modifier|*
name|image
init|=
name|gtk_image_new_from_pixbuf
argument_list|(
name|pixbuf
argument_list|)
decl_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|image
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
comment|/*  single window  */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Grab"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"a _Single Window"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
operator|!
name|shootvals
operator|.
name|root
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|FALSE
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_radio_button_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|root
argument_list|)
expr_stmt|;
comment|/*  select window delay  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"S_elect Window After"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|adj
operator|=
name|gtk_adjustment_new
argument_list|(
name|shootvals
operator|.
name|select_delay
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|spinner
operator|=
name|gtk_spin_button_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|adj
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|spinner
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinner
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value_changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_int_adjustment_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|select_delay
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Seconds Delay"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/*  root window  */
name|button
operator|=
name|gtk_radio_button_new_with_mnemonic
argument_list|(
name|radio_group
argument_list|,
name|_
argument_list|(
literal|"the _Whole Screen"
argument_list|)
argument_list|)
expr_stmt|;
name|radio_group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|shootvals
operator|.
name|root
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-item-data"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|TRUE
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_radio_button_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|root
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
comment|/*  grab delay  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"Grab _After"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|adj
operator|=
name|gtk_adjustment_new
argument_list|(
name|shootvals
operator|.
name|grab_delay
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|spinner
operator|=
name|gtk_spin_button_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|adj
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|spinner
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinner
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adj
argument_list|,
literal|"value_changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_int_adjustment_update
argument_list|)
argument_list|,
operator|&
name|shootvals
operator|.
name|grab_delay
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Seconds Delay"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|run
operator|=
operator|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_OK
operator|)
expr_stmt|;
if|if
condition|(
name|run
condition|)
block|{
comment|/* get the screen on which we are running */
name|cur_screen
operator|=
name|gtk_widget_get_screen
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
if|if
condition|(
name|run
condition|)
block|{
if|if
condition|(
operator|!
name|shootvals
operator|.
name|root
operator|&&
operator|!
name|shootvals
operator|.
name|window_id
condition|)
block|{
if|if
condition|(
name|shootvals
operator|.
name|select_delay
operator|>
literal|0
condition|)
name|shoot_delay
argument_list|(
name|shootvals
operator|.
name|select_delay
argument_list|)
expr_stmt|;
name|selected_native
operator|=
name|select_window
argument_list|(
name|cur_screen
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|run
return|;
block|}
end_function

begin_comment
comment|/*  delay functions  */
end_comment

begin_function
name|void
DECL|function|shoot_delay (gint delay)
name|shoot_delay
parameter_list|(
name|gint
name|delay
parameter_list|)
block|{
name|g_timeout_add
argument_list|(
literal|1000
argument_list|,
name|shoot_delay_callback
argument_list|,
operator|&
name|delay
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|gboolean
DECL|function|shoot_delay_callback (gpointer data)
name|shoot_delay_callback
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gint
modifier|*
name|seconds_left
init|=
name|data
decl_stmt|;
operator|(
operator|*
name|seconds_left
operator|)
operator|--
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|seconds_left
condition|)
name|gtk_main_quit
argument_list|()
expr_stmt|;
return|return
operator|*
name|seconds_left
return|;
block|}
end_function

end_unit

