begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  *  * poppler.c - PDF file loader  *  * Copyright (C) 2005 Nathan Summers  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|<poppler.h>
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_define
DECL|macro|LOAD_PROC
define|#
directive|define
name|LOAD_PROC
value|"file-pdf-load"
end_define

begin_define
DECL|macro|LOAD_THUMB_PROC
define|#
directive|define
name|LOAD_THUMB_PROC
value|"file-pdf-load-thumb"
end_define

begin_define
DECL|macro|PLUG_IN_BINARY
define|#
directive|define
name|PLUG_IN_BINARY
value|"poppler"
end_define

begin_define
DECL|macro|THUMBNAIL_SIZE
define|#
directive|define
name|THUMBNAIL_SIZE
value|128
end_define

begin_comment
comment|/* Structs for the load dialog */
end_comment

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28c762010108
block|{
DECL|member|target
name|GimpPageSelectorTarget
name|target
decl_stmt|;
DECL|member|resolution
name|gdouble
name|resolution
decl_stmt|;
DECL|member|antialias
name|gboolean
name|antialias
decl_stmt|;
DECL|typedef|PdfLoadVals
block|}
name|PdfLoadVals
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|loadvals
specifier|static
name|PdfLoadVals
name|loadvals
init|=
block|{
name|GIMP_PAGE_SELECTOR_TARGET_LAYERS
block|,
literal|100.00
block|,
comment|/* 100 dpi   */
name|TRUE
comment|/* antialias */
block|}
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28c762010208
block|{
DECL|member|n_pages
name|gint
name|n_pages
decl_stmt|;
DECL|member|pages
name|gint
modifier|*
name|pages
decl_stmt|;
DECL|typedef|PdfSelectedPages
block|}
name|PdfSelectedPages
typedef|;
end_typedef

begin_comment
comment|/* Declare local functions */
end_comment

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|load_image
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|,
name|GimpRunMode
name|run_mode
parameter_list|,
name|GimpPageSelectorTarget
name|target
parameter_list|,
name|guint32
name|resolution
parameter_list|,
name|gboolean
name|antialias
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|load_dialog
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|PopplerDocument
modifier|*
name|open_document
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GdkPixbuf
modifier|*
name|get_thumbnail
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|gint
name|page
parameter_list|,
name|gint
name|preferred_size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|layer_from_pixbuf
parameter_list|(
name|gint32
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|layer_name
parameter_list|,
name|gint
name|position
parameter_list|,
name|GdkPixbuf
modifier|*
name|buf
parameter_list|,
name|gdouble
name|progress_start
parameter_list|,
name|gdouble
name|progress_scale
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
specifier|const
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
specifier|const
name|GimpParamDef
name|load_args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to load"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"raw-filename"
block|,
literal|"The name entered"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"resolution"
block|,
literal|"Resolution to rasterize to (dpi)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"antialias"
block|,
literal|"Whether to antialias"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"n-pages"
block|,
literal|"Number of pages to load (0 for all)"
block|}
block|,
block|{
name|GIMP_PDB_INT32ARRAY
block|,
literal|"page"
block|,
literal|"The pages to load"
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|load_return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Output image"
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|thumb_args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to load"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"thumb-size"
block|,
literal|"Preferred thumbnail size"
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|GimpParamDef
name|thumb_return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Thumbnail image"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"image-width"
block|,
literal|"Width of full-sized image"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"image-height"
block|,
literal|"Height of full-sized image"
block|}
block|}
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|LOAD_PROC
argument_list|,
literal|"Load file in PDF format."
argument_list|,
literal|"Load file in PDF format. "
literal|"PDF is a portable document format created by Adobe. "
literal|"It is designed to be easily processed by a variety "
literal|"of different platforms, and is a distant cousin of "
literal|"postscript. "
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"2005"
argument_list|,
name|N_
argument_list|(
literal|"Portable Document Format"
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|load_args
argument_list|)
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|load_return_vals
argument_list|)
argument_list|,
name|load_args
argument_list|,
name|load_return_vals
argument_list|)
expr_stmt|;
name|gimp_register_file_handler_mime
argument_list|(
name|LOAD_PROC
argument_list|,
literal|"application/pdf"
argument_list|)
expr_stmt|;
name|gimp_register_magic_load_handler
argument_list|(
name|LOAD_PROC
argument_list|,
literal|"pdf"
argument_list|,
literal|""
argument_list|,
literal|"0, string,%PDF-"
argument_list|)
expr_stmt|;
name|gimp_install_procedure
argument_list|(
name|LOAD_THUMB_PROC
argument_list|,
literal|"Loads a preview from a PDF file."
argument_list|,
literal|"Loads a small preview of the first page of the PDF "
literal|"format file. Uses the embedded thumbnail if "
literal|"present."
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"Nathan Summers"
argument_list|,
literal|"2005"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|thumb_args
argument_list|)
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|thumb_return_vals
argument_list|)
argument_list|,
name|thumb_args
argument_list|,
name|thumb_return_vals
argument_list|)
expr_stmt|;
name|gimp_register_thumbnail_loader
argument_list|(
name|LOAD_PROC
argument_list|,
name|LOAD_THUMB_PROC
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (const gchar * name,gint nparams,const GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GimpParam
name|values
index|[
literal|2
index|]
decl_stmt|;
name|GimpRunMode
name|run_mode
decl_stmt|;
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
name|gint32
name|image_ID
init|=
operator|-
literal|1
decl_stmt|;
name|PopplerDocument
modifier|*
name|doc
init|=
name|NULL
decl_stmt|;
name|run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
if|if
condition|(
operator|!
name|g_thread_supported
argument_list|()
condition|)
name|g_thread_init
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|LOAD_PROC
argument_list|)
operator|==
literal|0
condition|)
block|{
name|PdfSelectedPages
modifier|*
name|pages
init|=
name|g_new
argument_list|(
name|PdfSelectedPages
argument_list|,
literal|1
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|run_mode
condition|)
block|{
case|case
name|GIMP_RUN_INTERACTIVE
case|:
comment|/* Possibly retrieve last settings */
name|gimp_get_data
argument_list|(
name|LOAD_PROC
argument_list|,
operator|&
name|loadvals
argument_list|)
expr_stmt|;
name|doc
operator|=
name|open_document
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|doc
condition|)
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|load_dialog
argument_list|(
name|doc
argument_list|,
name|pages
argument_list|)
condition|)
name|gimp_set_data
argument_list|(
name|LOAD_PROC
argument_list|,
operator|&
name|loadvals
argument_list|,
sizeof|sizeof
argument_list|(
name|loadvals
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|status
operator|=
name|GIMP_PDB_CANCEL
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_WITH_LAST_VALS
case|:
case|case
name|GIMP_RUN_NONINTERACTIVE
case|:
comment|/* bah! hardly any file plugins work non-interactively.            * why should we? */
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|image_ID
operator|=
name|load_image
argument_list|(
name|doc
argument_list|,
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|,
name|run_mode
argument_list|,
name|loadvals
operator|.
name|target
argument_list|,
name|loadvals
operator|.
name|resolution
argument_list|,
name|loadvals
operator|.
name|antialias
argument_list|,
name|pages
argument_list|)
expr_stmt|;
if|if
condition|(
name|image_ID
operator|!=
operator|-
literal|1
condition|)
block|{
operator|*
name|nreturn_vals
operator|=
literal|2
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image_ID
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
if|if
condition|(
name|doc
condition|)
name|g_object_unref
argument_list|(
name|doc
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pages
operator|->
name|pages
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pages
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|LOAD_THUMB_PROC
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|nparams
operator|<
literal|2
condition|)
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
else|else
block|{
name|gdouble
name|width
init|=
literal|0
decl_stmt|;
name|gdouble
name|height
init|=
literal|0
decl_stmt|;
name|gdouble
name|scale
decl_stmt|;
name|gint32
name|image
init|=
operator|-
literal|1
decl_stmt|;
name|GdkPixbuf
modifier|*
name|buf
init|=
name|NULL
decl_stmt|;
comment|/* Possibly retrieve last settings */
name|gimp_get_data
argument_list|(
name|LOAD_PROC
argument_list|,
operator|&
name|loadvals
argument_list|)
expr_stmt|;
name|doc
operator|=
name|open_document
argument_list|(
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|doc
condition|)
block|{
name|PopplerPage
modifier|*
name|page
init|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|page
condition|)
block|{
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|page
argument_list|)
expr_stmt|;
block|}
name|buf
operator|=
name|get_thumbnail
argument_list|(
name|doc
argument_list|,
literal|0
argument_list|,
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_int32
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|buf
condition|)
block|{
name|image
operator|=
name|gimp_image_new
argument_list|(
name|gdk_pixbuf_get_width
argument_list|(
name|buf
argument_list|)
argument_list|,
name|gdk_pixbuf_get_height
argument_list|(
name|buf
argument_list|)
argument_list|,
name|GIMP_RGB
argument_list|)
expr_stmt|;
name|gimp_image_undo_disable
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|layer_from_pixbuf
argument_list|(
name|image
argument_list|,
literal|"thumbnail"
argument_list|,
literal|0
argument_list|,
name|buf
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gimp_image_undo_enable
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_image_clean_all
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
name|scale
operator|=
name|loadvals
operator|.
name|resolution
operator|/
name|gimp_unit_get_factor
argument_list|(
name|GIMP_UNIT_POINT
argument_list|)
expr_stmt|;
name|width
operator|*=
name|scale
expr_stmt|;
name|height
operator|*=
name|scale
expr_stmt|;
if|if
condition|(
name|doc
condition|)
name|g_object_unref
argument_list|(
name|doc
argument_list|)
expr_stmt|;
if|if
condition|(
name|buf
condition|)
name|g_object_unref
argument_list|(
name|buf
argument_list|)
expr_stmt|;
if|if
condition|(
name|image
operator|!=
operator|-
literal|1
condition|)
block|{
operator|*
name|nreturn_vals
operator|=
literal|4
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image
expr_stmt|;
name|values
index|[
literal|2
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_INT32
expr_stmt|;
name|values
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_int32
operator|=
name|width
expr_stmt|;
name|values
index|[
literal|3
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_INT32
expr_stmt|;
name|values
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_int32
operator|=
name|height
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|PopplerDocument
modifier|*
DECL|function|open_document (const gchar * filename)
name|open_document
parameter_list|(
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
name|PopplerDocument
modifier|*
name|doc
decl_stmt|;
name|GError
modifier|*
name|err
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|uri
decl_stmt|;
name|uri
operator|=
name|g_filename_to_uri
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|g_warning
argument_list|(
literal|"Could not convert '%s' to an URI: %s"
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|,
name|err
operator|->
name|message
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
name|doc
operator|=
name|poppler_document_new_from_file
argument_list|(
name|uri
argument_list|,
name|NULL
argument_list|,
operator|&
name|err
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Could not open '%s' for reading: %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|,
name|err
operator|->
name|message
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
return|return
name|doc
return|;
block|}
end_function

begin_function
specifier|static
name|gint32
DECL|function|layer_from_pixbuf (gint32 image,const gchar * layer_name,gint position,GdkPixbuf * pixbuf,gdouble progress_start,gdouble progress_scale)
name|layer_from_pixbuf
parameter_list|(
name|gint32
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|layer_name
parameter_list|,
name|gint
name|position
parameter_list|,
name|GdkPixbuf
modifier|*
name|pixbuf
parameter_list|,
name|gdouble
name|progress_start
parameter_list|,
name|gdouble
name|progress_scale
parameter_list|)
block|{
name|gint32
name|layer
init|=
name|gimp_layer_new_from_pixbuf
argument_list|(
name|image
argument_list|,
name|layer_name
argument_list|,
name|pixbuf
argument_list|,
literal|100.0
argument_list|,
name|GIMP_NORMAL_MODE
argument_list|,
name|progress_start
argument_list|,
name|progress_start
operator|+
name|progress_scale
argument_list|)
decl_stmt|;
name|gimp_image_add_layer
argument_list|(
name|image
argument_list|,
name|layer
argument_list|,
name|position
argument_list|)
expr_stmt|;
return|return
name|layer
return|;
block|}
end_function

begin_function
specifier|static
name|gint32
DECL|function|load_image (PopplerDocument * doc,const gchar * filename,GimpRunMode run_mode,GimpPageSelectorTarget target,guint32 resolution,gboolean antialias,PdfSelectedPages * pages)
name|load_image
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|,
name|GimpRunMode
name|run_mode
parameter_list|,
name|GimpPageSelectorTarget
name|target
parameter_list|,
name|guint32
name|resolution
parameter_list|,
name|gboolean
name|antialias
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
block|{
name|gint32
name|image_ID
init|=
literal|0
decl_stmt|;
name|gint32
modifier|*
name|images
init|=
name|NULL
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gdouble
name|scale
decl_stmt|;
name|gdouble
name|doc_progress
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
name|images
operator|=
name|g_new0
argument_list|(
name|gint32
argument_list|,
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
name|gimp_progress_init_printf
argument_list|(
name|_
argument_list|(
literal|"Opening '%s'"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|filename
argument_list|)
argument_list|)
expr_stmt|;
name|scale
operator|=
name|resolution
operator|/
name|gimp_unit_get_factor
argument_list|(
name|GIMP_UNIT_POINT
argument_list|)
expr_stmt|;
comment|/* read the file */
if|#
directive|if
literal|0
block|poppler_set_antialias (antialias);
endif|#
directive|endif
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pages
operator|->
name|n_pages
condition|;
name|i
operator|++
control|)
block|{
name|PopplerPage
modifier|*
name|page
decl_stmt|;
name|gchar
modifier|*
name|page_label
decl_stmt|;
name|gdouble
name|page_width
decl_stmt|;
name|gdouble
name|page_height
decl_stmt|;
name|GdkPixbuf
modifier|*
name|buf
decl_stmt|;
name|gint
name|width
decl_stmt|;
name|gint
name|height
decl_stmt|;
name|page
operator|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
name|pages
operator|->
name|pages
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|page_width
argument_list|,
operator|&
name|page_height
argument_list|)
expr_stmt|;
name|width
operator|=
name|page_width
operator|*
name|scale
expr_stmt|;
name|height
operator|=
name|page_height
operator|*
name|scale
expr_stmt|;
name|g_object_get
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"label"
argument_list|,
operator|&
name|page_label
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|image_ID
condition|)
block|{
name|gchar
modifier|*
name|name
decl_stmt|;
name|image_ID
operator|=
name|gimp_image_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|GIMP_RGB
argument_list|)
expr_stmt|;
name|gimp_image_undo_disable
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
name|name
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%s-%s"
argument_list|)
argument_list|,
name|filename
argument_list|,
name|page_label
argument_list|)
expr_stmt|;
else|else
name|name
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%s-pages"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|gimp_image_set_filename
argument_list|(
name|image_ID
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|gimp_image_set_resolution
argument_list|(
name|image_ID
argument_list|,
name|resolution
argument_list|,
name|resolution
argument_list|)
expr_stmt|;
block|}
name|buf
operator|=
name|gdk_pixbuf_new
argument_list|(
name|GDK_COLORSPACE_RGB
argument_list|,
name|FALSE
argument_list|,
literal|8
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|poppler_page_render_to_pixbuf
argument_list|(
name|page
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|scale
argument_list|,
ifdef|#
directive|ifdef
name|HAVE_POPPLER_0_4_1
literal|0
argument_list|,
endif|#
directive|endif
name|buf
ifndef|#
directive|ifndef
name|HAVE_POPPLER_0_4
argument_list|,
literal|0
argument_list|,
literal|0
endif|#
directive|endif
argument_list|)
expr_stmt|;
name|layer_from_pixbuf
argument_list|(
name|image_ID
argument_list|,
name|page_label
argument_list|,
name|i
argument_list|,
name|buf
argument_list|,
name|doc_progress
argument_list|,
literal|1.0
operator|/
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|page_label
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|doc_progress
operator|=
call|(
name|double
call|)
argument_list|(
name|i
operator|+
literal|1
argument_list|)
operator|/
name|pages
operator|->
name|n_pages
expr_stmt|;
name|gimp_progress_update
argument_list|(
name|doc_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
block|{
name|images
index|[
name|i
index|]
operator|=
name|image_ID
expr_stmt|;
name|gimp_image_undo_enable
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
name|gimp_image_clean_all
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
name|image_ID
operator|=
literal|0
expr_stmt|;
block|}
block|}
if|if
condition|(
name|image_ID
condition|)
block|{
name|gimp_image_undo_enable
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
name|gimp_image_clean_all
argument_list|(
name|image_ID
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|target
operator|==
name|GIMP_PAGE_SELECTOR_TARGET_IMAGES
condition|)
block|{
if|if
condition|(
name|run_mode
operator|!=
name|GIMP_RUN_NONINTERACTIVE
condition|)
block|{
comment|/* Display images in reverse order.  The last will be            * displayed by GIMP itself            */
for|for
control|(
name|i
operator|=
name|pages
operator|->
name|n_pages
operator|-
literal|1
init|;
name|i
operator|>
literal|0
condition|;
name|i
operator|--
control|)
name|gimp_display_new
argument_list|(
name|images
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|image_ID
operator|=
name|images
index|[
literal|0
index|]
expr_stmt|;
name|g_free
argument_list|(
name|images
argument_list|)
expr_stmt|;
block|}
return|return
name|image_ID
return|;
block|}
end_function

begin_function
specifier|static
name|GdkPixbuf
modifier|*
DECL|function|get_thumbnail (PopplerDocument * doc,gint page_num,gint preferred_size)
name|get_thumbnail
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|gint
name|page_num
parameter_list|,
name|gint
name|preferred_size
parameter_list|)
block|{
name|PopplerPage
modifier|*
name|page
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|page
operator|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
name|page_num
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|page
condition|)
return|return
name|NULL
return|;
name|pixbuf
operator|=
name|poppler_page_get_thumbnail
argument_list|(
name|page
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pixbuf
condition|)
block|{
name|double
name|width
decl_stmt|,
name|height
decl_stmt|,
name|scale
decl_stmt|;
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
name|scale
operator|=
operator|(
name|double
operator|)
name|preferred_size
operator|/
name|MAX
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|width
operator|*=
name|scale
expr_stmt|;
name|height
operator|*=
name|scale
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_new
argument_list|(
name|GDK_COLORSPACE_RGB
argument_list|,
name|FALSE
argument_list|,
literal|8
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|poppler_page_render_to_pixbuf
argument_list|(
name|page
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|scale
argument_list|,
ifdef|#
directive|ifdef
name|HAVE_POPPLER_0_4_1
literal|0
argument_list|,
endif|#
directive|endif
name|pixbuf
ifndef|#
directive|ifndef
name|HAVE_POPPLER_0_4
argument_list|,
literal|0
argument_list|,
literal|0
endif|#
directive|endif
argument_list|)
expr_stmt|;
block|}
name|g_object_unref
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|pixbuf
return|;
block|}
end_function

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28c762010308
block|{
DECL|member|document
name|PopplerDocument
modifier|*
name|document
decl_stmt|;
DECL|member|selector
name|GimpPageSelector
modifier|*
name|selector
decl_stmt|;
DECL|member|stop_thumbnailing
name|gboolean
name|stop_thumbnailing
decl_stmt|;
DECL|typedef|ThreadData
block|}
name|ThreadData
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon28c762010408
block|{
DECL|member|selector
name|GimpPageSelector
modifier|*
name|selector
decl_stmt|;
DECL|member|page_no
name|gint
name|page_no
decl_stmt|;
DECL|member|pixbuf
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
DECL|typedef|IdleData
block|}
name|IdleData
typedef|;
end_typedef

begin_function
specifier|static
name|gboolean
DECL|function|idle_set_thumbnail (gpointer data)
name|idle_set_thumbnail
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|IdleData
modifier|*
name|idle_data
init|=
name|data
decl_stmt|;
name|gimp_page_selector_set_page_thumbnail
argument_list|(
name|idle_data
operator|->
name|selector
argument_list|,
name|idle_data
operator|->
name|page_no
argument_list|,
name|idle_data
operator|->
name|pixbuf
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|idle_data
operator|->
name|pixbuf
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|idle_data
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gpointer
DECL|function|thumbnail_thread (gpointer data)
name|thumbnail_thread
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|ThreadData
modifier|*
name|thread_data
init|=
name|data
decl_stmt|;
name|gint
name|n_pages
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|n_pages
operator|=
name|poppler_document_get_n_pages
argument_list|(
name|thread_data
operator|->
name|document
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_pages
condition|;
name|i
operator|++
control|)
block|{
name|IdleData
modifier|*
name|idle_data
init|=
name|g_new0
argument_list|(
name|IdleData
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|idle_data
operator|->
name|selector
operator|=
name|thread_data
operator|->
name|selector
expr_stmt|;
name|idle_data
operator|->
name|page_no
operator|=
name|i
expr_stmt|;
comment|/* FIXME get preferred size from somewhere? */
name|idle_data
operator|->
name|pixbuf
operator|=
name|get_thumbnail
argument_list|(
name|thread_data
operator|->
name|document
argument_list|,
name|i
argument_list|,
name|THUMBNAIL_SIZE
argument_list|)
expr_stmt|;
name|g_idle_add
argument_list|(
name|idle_set_thumbnail
argument_list|,
name|idle_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|thread_data
operator|->
name|stop_thumbnailing
condition|)
break|break;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|load_dialog (PopplerDocument * doc,PdfSelectedPages * pages)
name|load_dialog
parameter_list|(
name|PopplerDocument
modifier|*
name|doc
parameter_list|,
name|PdfSelectedPages
modifier|*
name|pages
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|title
decl_stmt|;
name|GtkWidget
modifier|*
name|selector
decl_stmt|;
name|GtkWidget
modifier|*
name|resolution
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|ThreadData
name|thread_data
decl_stmt|;
name|GThread
modifier|*
name|thread
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|n_pages
decl_stmt|;
name|gdouble
name|width
decl_stmt|;
name|gdouble
name|height
decl_stmt|;
name|gboolean
name|run
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Import from PDF"
argument_list|)
argument_list|,
name|PLUG_IN_BINARY
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|LOAD_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|_
argument_list|(
literal|"_Import"
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Title */
name|title
operator|=
name|gimp_prop_label_new
argument_list|(
name|G_OBJECT
argument_list|(
name|doc
argument_list|)
argument_list|,
literal|"title"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|title
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title
argument_list|)
expr_stmt|;
comment|/* Page Selector */
name|selector
operator|=
name|gimp_page_selector_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|selector
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|n_pages
operator|=
name|poppler_document_get_n_pages
argument_list|(
name|doc
argument_list|)
expr_stmt|;
name|gimp_page_selector_set_n_pages
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
name|n_pages
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_pages
condition|;
name|i
operator|++
control|)
block|{
name|PopplerPage
modifier|*
name|page
decl_stmt|;
name|gchar
modifier|*
name|label
decl_stmt|;
name|page
operator|=
name|poppler_document_get_page
argument_list|(
name|doc
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|g_object_get
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"label"
argument_list|,
operator|&
name|label
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_page_selector_set_page_label
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
name|i
argument_list|,
name|label
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|poppler_page_get_size
argument_list|(
name|page
argument_list|,
operator|&
name|width
argument_list|,
operator|&
name|height
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|page
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
name|g_signal_connect_swapped
argument_list|(
name|selector
argument_list|,
literal|"activate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_window_activate_default
argument_list|)
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|selector
argument_list|)
expr_stmt|;
name|thread_data
operator|.
name|document
operator|=
name|doc
expr_stmt|;
name|thread_data
operator|.
name|selector
operator|=
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
expr_stmt|;
name|thread_data
operator|.
name|stop_thumbnailing
operator|=
name|FALSE
expr_stmt|;
name|thread
operator|=
name|g_thread_create
argument_list|(
name|thumbnail_thread
argument_list|,
operator|&
name|thread_data
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Resolution */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|resolution
operator|=
name|gimp_resolution_entry_new
argument_list|(
name|_
argument_list|(
literal|"_Width (pixels):"
argument_list|)
argument_list|,
name|width
argument_list|,
name|_
argument_list|(
literal|"_Height (pixels):"
argument_list|)
argument_list|,
name|height
argument_list|,
name|GIMP_UNIT_POINT
argument_list|,
name|_
argument_list|(
literal|"_Resolution:"
argument_list|)
argument_list|,
name|loadvals
operator|.
name|resolution
argument_list|,
name|_
argument_list|(
literal|"_Resolution:"
argument_list|)
argument_list|,
name|loadvals
operator|.
name|resolution
argument_list|,
name|GIMP_UNIT_INCH
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|resolution
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|resolution
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|resolution
argument_list|,
literal|"x-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_resolution_entry_update_x_in_dpi
argument_list|)
argument_list|,
operator|&
name|loadvals
operator|.
name|resolution
argument_list|)
expr_stmt|;
comment|/* Antialiasing */
name|toggle
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"A_ntialiasing"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|loadvals
operator|.
name|antialias
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|toggle
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|loadvals
operator|.
name|antialias
argument_list|)
expr_stmt|;
comment|/* Setup done; display the dialog */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
comment|/* run the dialog */
name|run
operator|=
operator|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_OK
operator|)
expr_stmt|;
name|loadvals
operator|.
name|target
operator|=
name|gimp_page_selector_get_target
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|)
expr_stmt|;
name|pages
operator|->
name|pages
operator|=
name|gimp_page_selector_get_selected_pages
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
operator|&
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
comment|/* select all if none selected */
if|if
condition|(
name|pages
operator|->
name|n_pages
operator|==
literal|0
condition|)
block|{
name|gimp_page_selector_select_all
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|)
expr_stmt|;
name|pages
operator|->
name|pages
operator|=
name|gimp_page_selector_get_selected_pages
argument_list|(
name|GIMP_PAGE_SELECTOR
argument_list|(
name|selector
argument_list|)
argument_list|,
operator|&
name|pages
operator|->
name|n_pages
argument_list|)
expr_stmt|;
block|}
comment|/* cleanup */
name|thread_data
operator|.
name|stop_thumbnailing
operator|=
name|TRUE
expr_stmt|;
name|g_thread_join
argument_list|(
name|thread
argument_list|)
expr_stmt|;
return|return
name|run
return|;
block|}
end_function

end_unit

