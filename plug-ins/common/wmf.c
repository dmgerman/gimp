begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* WMF plug-in for The GIMP  * Copyright (C) 1998 Tor Lillqvist  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  *  * See http://www.iki.fi/tml/gimp/wmf/  */
end_comment

begin_define
DECL|macro|VERSION
define|#
directive|define
name|VERSION
value|"1999-10-30"
end_define

begin_comment
comment|/* #define DEBUG */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_typedef
DECL|typedef|BYTE
typedef|typedef
name|guchar
name|BYTE
typedef|;
end_typedef

begin_typedef
DECL|typedef|WORD
typedef|typedef
name|guint16
name|WORD
typedef|;
end_typedef

begin_typedef
DECL|typedef|DWORD
typedef|typedef
name|guint32
name|DWORD
typedef|;
end_typedef

begin_typedef
DECL|typedef|SHORT
typedef|typedef
name|gint16
name|SHORT
typedef|;
end_typedef

begin_typedef
DECL|typedef|LONG
typedef|typedef
name|gint32
name|LONG
typedef|;
end_typedef

begin_comment
comment|/* The following information is from O'Reilly's updates to the  * Encyclopedia of Graphics File Formats,  * http://www.ora.com/centers/gff/formats/micmeta/index.htm  */
end_comment

begin_typedef
DECL|struct|_WindowsMetaHeader
typedef|typedef
struct|struct
name|_WindowsMetaHeader
block|{
DECL|member|FileType
name|WORD
name|FileType
decl_stmt|;
comment|/* Type of metafile (0=memory, 1=disk) */
DECL|member|HeaderSize
name|WORD
name|HeaderSize
decl_stmt|;
comment|/* Size of header in WORDS (always 9) */
DECL|member|Version
name|WORD
name|Version
decl_stmt|;
comment|/* Version of Microsoft Windows used */
DECL|member|FileSize
name|DWORD
name|FileSize
decl_stmt|;
comment|/* Total size of the metafile in WORDs */
DECL|member|NumOfObjects
name|WORD
name|NumOfObjects
decl_stmt|;
comment|/* Number of objects in the file */
DECL|member|MaxRecordSize
name|DWORD
name|MaxRecordSize
decl_stmt|;
comment|/* The size of largest record in WORDs */
DECL|member|NumOfParams
name|WORD
name|NumOfParams
decl_stmt|;
comment|/* Not Used (always 0) */
DECL|typedef|WMFHEAD
block|}
name|WMFHEAD
typedef|;
end_typedef

begin_define
DECL|macro|SIZE_WMFHEAD
define|#
directive|define
name|SIZE_WMFHEAD
value|18
end_define

begin_typedef
DECL|struct|_PlaceableMetaHeader
typedef|typedef
struct|struct
name|_PlaceableMetaHeader
block|{
DECL|member|Key
name|DWORD
name|Key
decl_stmt|;
comment|/* Magic number (always 9AC6CDD7h) */
DECL|member|Handle
name|WORD
name|Handle
decl_stmt|;
comment|/* Metafile HANDLE number (always 0) */
DECL|member|Left
name|SHORT
name|Left
decl_stmt|;
comment|/* Left coordinate in metafile units */
DECL|member|Top
name|SHORT
name|Top
decl_stmt|;
comment|/* Top coordinate in metafile units */
DECL|member|Right
name|SHORT
name|Right
decl_stmt|;
comment|/* Right coordinate in metafile units */
DECL|member|Bottom
name|SHORT
name|Bottom
decl_stmt|;
comment|/* Bottom coordinate in metafile units */
DECL|member|Inch
name|WORD
name|Inch
decl_stmt|;
comment|/* Number of metafile units per inch */
DECL|member|Reserved
name|DWORD
name|Reserved
decl_stmt|;
comment|/* Reserved (always 0) */
DECL|member|Checksum
name|WORD
name|Checksum
decl_stmt|;
comment|/* Checksum value for previous 10 WORDs */
DECL|typedef|PLACEABLEMETAHEADER
block|}
name|PLACEABLEMETAHEADER
typedef|;
end_typedef

begin_define
DECL|macro|SIZE_PLACEABLEMETAHEADER
define|#
directive|define
name|SIZE_PLACEABLEMETAHEADER
value|22
end_define

begin_typedef
DECL|struct|_Clipboard16MetaHeader
typedef|typedef
struct|struct
name|_Clipboard16MetaHeader
block|{
DECL|member|MappingMode
name|SHORT
name|MappingMode
decl_stmt|;
comment|/* Units used to playback metafile */
DECL|member|Width
name|SHORT
name|Width
decl_stmt|;
comment|/* Width of the metafile */
DECL|member|Height
name|SHORT
name|Height
decl_stmt|;
comment|/* Height of the metafile */
DECL|member|Handle
name|WORD
name|Handle
decl_stmt|;
comment|/* Handle to the metafile in memory */
DECL|typedef|CLIPBOARD16METAHEADER
block|}
name|CLIPBOARD16METAHEADER
typedef|;
end_typedef

begin_define
DECL|macro|SIZE_CLIPBOARD16METAHEADER
define|#
directive|define
name|SIZE_CLIPBOARD16METAHEADER
value|8
end_define

begin_typedef
DECL|struct|_Clipboard32MetaHeader
typedef|typedef
struct|struct
name|_Clipboard32MetaHeader
block|{
DECL|member|MappingMode
name|LONG
name|MappingMode
decl_stmt|;
comment|/* Units used to playback metafile */
DECL|member|Width
name|LONG
name|Width
decl_stmt|;
comment|/* Width of the metafile */
DECL|member|Height
name|LONG
name|Height
decl_stmt|;
comment|/* Height of the metafile */
DECL|member|Handle
name|DWORD
name|Handle
decl_stmt|;
comment|/* Handle to the metafile in memory */
DECL|typedef|CLIPBOARD32METAHEADER
block|}
name|CLIPBOARD32METAHEADER
typedef|;
end_typedef

begin_define
DECL|macro|SIZE_CLIPBOARD32METAHEADER
define|#
directive|define
name|SIZE_CLIPBOARD32METAHEADER
value|16
end_define

begin_typedef
DECL|struct|_EnhancedMetaHeader
typedef|typedef
struct|struct
name|_EnhancedMetaHeader
block|{
DECL|member|RecordType
name|DWORD
name|RecordType
decl_stmt|;
comment|/* Record type */
DECL|member|RecordSize
name|DWORD
name|RecordSize
decl_stmt|;
comment|/* Size of the record in bytes */
DECL|member|BoundsLeft
name|LONG
name|BoundsLeft
decl_stmt|;
comment|/* Left inclusive bounds */
DECL|member|BoundsRight
name|LONG
name|BoundsRight
decl_stmt|;
comment|/* Right inclusive bounds */
DECL|member|BoundsTop
name|LONG
name|BoundsTop
decl_stmt|;
comment|/* Top inclusive bounds */
DECL|member|BoundsBottom
name|LONG
name|BoundsBottom
decl_stmt|;
comment|/* Bottom inclusive bounds */
DECL|member|FrameLeft
name|LONG
name|FrameLeft
decl_stmt|;
comment|/* Left side of inclusive picture frame */
DECL|member|FrameRight
name|LONG
name|FrameRight
decl_stmt|;
comment|/* Right side of inclusive picture frame */
DECL|member|FrameTop
name|LONG
name|FrameTop
decl_stmt|;
comment|/* Top side of inclusive picture frame */
DECL|member|FrameBottom
name|LONG
name|FrameBottom
decl_stmt|;
comment|/* Bottom side of inclusive picture frame */
DECL|member|Signature
name|DWORD
name|Signature
decl_stmt|;
comment|/* Signature ID (always 0x464D4520) */
DECL|member|Version
name|DWORD
name|Version
decl_stmt|;
comment|/* Version of the metafile */
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Size of the metafile in bytes */
DECL|member|NumOfRecords
name|DWORD
name|NumOfRecords
decl_stmt|;
comment|/* Number of records in the metafile */
DECL|member|NumOfHandles
name|WORD
name|NumOfHandles
decl_stmt|;
comment|/* Number of handles in the handle table */
DECL|member|Reserved
name|WORD
name|Reserved
decl_stmt|;
comment|/* Not used (always 0) */
DECL|member|SizeOfDescrip
name|DWORD
name|SizeOfDescrip
decl_stmt|;
comment|/* Size of description string in WORDs */
DECL|member|OffsOfDescrip
name|DWORD
name|OffsOfDescrip
decl_stmt|;
comment|/* Offset of description string in metafile */
DECL|member|NumPalEntries
name|DWORD
name|NumPalEntries
decl_stmt|;
comment|/* Number of color palette entries */
DECL|member|WidthDevPixels
name|LONG
name|WidthDevPixels
decl_stmt|;
comment|/* Width of reference device in pixels */
DECL|member|HeightDevPixels
name|LONG
name|HeightDevPixels
decl_stmt|;
comment|/* Height of reference device in pixels */
DECL|member|WidthDevMM
name|LONG
name|WidthDevMM
decl_stmt|;
comment|/* Width of reference device in millimeters */
DECL|member|HeightDevMM
name|LONG
name|HeightDevMM
decl_stmt|;
comment|/* Height of reference device in millimeters */
DECL|typedef|ENHANCEDMETAHEADER
block|}
name|ENHANCEDMETAHEADER
typedef|;
end_typedef

begin_define
DECL|macro|SIZE_ENHANCEDMETAHEADER
define|#
directive|define
name|SIZE_ENHANCEDMETAHEADER
value|88
end_define

begin_typedef
DECL|struct|_StandardMetaRecord
typedef|typedef
struct|struct
name|_StandardMetaRecord
block|{
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Total size of the record in WORDs */
DECL|member|Function
name|WORD
name|Function
decl_stmt|;
comment|/* Function number (defined in WINDOWS.H) */
if|#
directive|if
name|DOCUMENTATION_ONLY_ILLEGAL_C
DECL|member|Parameters
name|WORD
name|Parameters
index|[]
decl_stmt|;
comment|/* Parameter values passed to function */
endif|#
directive|endif
DECL|typedef|WMFRECORD
block|}
name|WMFRECORD
typedef|;
end_typedef

begin_define
DECL|macro|SIZE_WMFRECORD
define|#
directive|define
name|SIZE_WMFRECORD
value|6
end_define

begin_define
DECL|macro|WORDSIZE_WMFRECORD
define|#
directive|define
name|WORDSIZE_WMFRECORD
value|3
end_define

begin_define
DECL|macro|EndOfFile
define|#
directive|define
name|EndOfFile
value|0x0000
end_define

begin_define
DECL|macro|AbortDoc
define|#
directive|define
name|AbortDoc
value|0x0052
end_define

begin_define
DECL|macro|Arc
define|#
directive|define
name|Arc
value|0x0817
end_define

begin_define
DECL|macro|Chord
define|#
directive|define
name|Chord
value|0x0830
end_define

begin_define
DECL|macro|Ellipse
define|#
directive|define
name|Ellipse
value|0x0418
end_define

begin_define
DECL|macro|EndDoc
define|#
directive|define
name|EndDoc
value|0x005E
end_define

begin_define
DECL|macro|EndPage
define|#
directive|define
name|EndPage
value|0x0050
end_define

begin_define
DECL|macro|ExcludeClipRect
define|#
directive|define
name|ExcludeClipRect
value|0x0415
end_define

begin_define
DECL|macro|ExtFloodFill
define|#
directive|define
name|ExtFloodFill
value|0x0548
end_define

begin_define
DECL|macro|FillRegion
define|#
directive|define
name|FillRegion
value|0x0228
end_define

begin_define
DECL|macro|FloodFill
define|#
directive|define
name|FloodFill
value|0x0419
end_define

begin_define
DECL|macro|FrameRegion
define|#
directive|define
name|FrameRegion
value|0x0429
end_define

begin_define
DECL|macro|IntersectClipRect
define|#
directive|define
name|IntersectClipRect
value|0x0416
end_define

begin_define
DECL|macro|InvertRegion
define|#
directive|define
name|InvertRegion
value|0x012A
end_define

begin_define
DECL|macro|LineTo
define|#
directive|define
name|LineTo
value|0x0213
end_define

begin_define
DECL|macro|MoveTo
define|#
directive|define
name|MoveTo
value|0x0214
end_define

begin_define
DECL|macro|OffsetClipRgn
define|#
directive|define
name|OffsetClipRgn
value|0x0220
end_define

begin_define
DECL|macro|OffsetViewportOrg
define|#
directive|define
name|OffsetViewportOrg
value|0x0211
end_define

begin_define
DECL|macro|OffsetWindowOrg
define|#
directive|define
name|OffsetWindowOrg
value|0x020F
end_define

begin_define
DECL|macro|PaintRegion
define|#
directive|define
name|PaintRegion
value|0x012B
end_define

begin_define
DECL|macro|PatBlt
define|#
directive|define
name|PatBlt
value|0x061D
end_define

begin_define
DECL|macro|Pie
define|#
directive|define
name|Pie
value|0x081A
end_define

begin_define
DECL|macro|RealizePalette
define|#
directive|define
name|RealizePalette
value|0x0035
end_define

begin_define
DECL|macro|Rectangle
define|#
directive|define
name|Rectangle
value|0x041B
end_define

begin_define
DECL|macro|ResetDc
define|#
directive|define
name|ResetDc
value|0x014C
end_define

begin_define
DECL|macro|ResizePalette
define|#
directive|define
name|ResizePalette
value|0x0139
end_define

begin_define
DECL|macro|RestoreDC
define|#
directive|define
name|RestoreDC
value|0x0127
end_define

begin_define
DECL|macro|RoundRect
define|#
directive|define
name|RoundRect
value|0x061C
end_define

begin_define
DECL|macro|SaveDC
define|#
directive|define
name|SaveDC
value|0x001E
end_define

begin_define
DECL|macro|ScaleViewportExt
define|#
directive|define
name|ScaleViewportExt
value|0x0412
end_define

begin_define
DECL|macro|ScaleWindowExt
define|#
directive|define
name|ScaleWindowExt
value|0x0410
end_define

begin_define
DECL|macro|SelectClipRegion
define|#
directive|define
name|SelectClipRegion
value|0x012C
end_define

begin_define
DECL|macro|SelectObject
define|#
directive|define
name|SelectObject
value|0x012D
end_define

begin_define
DECL|macro|SelectPalette
define|#
directive|define
name|SelectPalette
value|0x0234
end_define

begin_define
DECL|macro|SetBkColor
define|#
directive|define
name|SetBkColor
value|0x0201
end_define

begin_define
DECL|macro|SetBkMode
define|#
directive|define
name|SetBkMode
value|0x0102
end_define

begin_define
DECL|macro|SetDibToDev
define|#
directive|define
name|SetDibToDev
value|0x0d33
end_define

begin_define
DECL|macro|SetMapMode
define|#
directive|define
name|SetMapMode
value|0x0103
end_define

begin_define
DECL|macro|SetMapperFlags
define|#
directive|define
name|SetMapperFlags
value|0x0231
end_define

begin_define
DECL|macro|SetPalEntries
define|#
directive|define
name|SetPalEntries
value|0x0037
end_define

begin_define
DECL|macro|SetPixel
define|#
directive|define
name|SetPixel
value|0x041F
end_define

begin_define
DECL|macro|SetPolyFillMode
define|#
directive|define
name|SetPolyFillMode
value|0x0106
end_define

begin_define
DECL|macro|SetRelabs
define|#
directive|define
name|SetRelabs
value|0x0105
end_define

begin_define
DECL|macro|SetROP2
define|#
directive|define
name|SetROP2
value|0x0104
end_define

begin_define
DECL|macro|SetStretchBltMode
define|#
directive|define
name|SetStretchBltMode
value|0x0107
end_define

begin_define
DECL|macro|SetTextAlign
define|#
directive|define
name|SetTextAlign
value|0x012E
end_define

begin_define
DECL|macro|SetTextCharExtra
define|#
directive|define
name|SetTextCharExtra
value|0x0108
end_define

begin_define
DECL|macro|SetTextColor
define|#
directive|define
name|SetTextColor
value|0x0209
end_define

begin_define
DECL|macro|SetTextJustification
define|#
directive|define
name|SetTextJustification
value|0x020A
end_define

begin_define
DECL|macro|SetViewportExt
define|#
directive|define
name|SetViewportExt
value|0x020E
end_define

begin_define
DECL|macro|SetViewportOrg
define|#
directive|define
name|SetViewportOrg
value|0x020D
end_define

begin_define
DECL|macro|SetWindowExt
define|#
directive|define
name|SetWindowExt
value|0x020C
end_define

begin_define
DECL|macro|SetWindowOrg
define|#
directive|define
name|SetWindowOrg
value|0x020B
end_define

begin_define
DECL|macro|StartDoc
define|#
directive|define
name|StartDoc
value|0x014D
end_define

begin_define
DECL|macro|StartPage
define|#
directive|define
name|StartPage
value|0x004F
end_define

begin_define
DECL|macro|AnimatePalette
define|#
directive|define
name|AnimatePalette
value|0x0436
end_define

begin_define
DECL|macro|BitBlt
define|#
directive|define
name|BitBlt
value|0x0922
end_define

begin_define
DECL|macro|CreateBitmap
define|#
directive|define
name|CreateBitmap
value|0x06FE
end_define

begin_define
DECL|macro|CreateBitmapIndirect
define|#
directive|define
name|CreateBitmapIndirect
value|0x02FD
end_define

begin_define
DECL|macro|CreateBrush
define|#
directive|define
name|CreateBrush
value|0x00F8
end_define

begin_define
DECL|macro|CreateBrushIndirect
define|#
directive|define
name|CreateBrushIndirect
value|0x02FC
end_define

begin_define
DECL|macro|CreateFontIndirect
define|#
directive|define
name|CreateFontIndirect
value|0x02FB
end_define

begin_define
DECL|macro|CreatePalette
define|#
directive|define
name|CreatePalette
value|0x00F7
end_define

begin_define
DECL|macro|CreatePatternBrush
define|#
directive|define
name|CreatePatternBrush
value|0x01F9
end_define

begin_define
DECL|macro|CreatePenIndirect
define|#
directive|define
name|CreatePenIndirect
value|0x02FA
end_define

begin_define
DECL|macro|CreateRegion
define|#
directive|define
name|CreateRegion
value|0x06FF
end_define

begin_define
DECL|macro|DeleteObject
define|#
directive|define
name|DeleteObject
value|0x01F0
end_define

begin_define
DECL|macro|DibBitblt
define|#
directive|define
name|DibBitblt
value|0x0940
end_define

begin_define
DECL|macro|DibCreatePatternBrush
define|#
directive|define
name|DibCreatePatternBrush
value|0x0142
end_define

begin_define
DECL|macro|DibStretchBlt
define|#
directive|define
name|DibStretchBlt
value|0x0B41
end_define

begin_define
DECL|macro|DrawText
define|#
directive|define
name|DrawText
value|0x062F
end_define

begin_define
DECL|macro|Escape
define|#
directive|define
name|Escape
value|0x0626
end_define

begin_define
DECL|macro|ExtTextOut
define|#
directive|define
name|ExtTextOut
value|0x0A32
end_define

begin_define
DECL|macro|Polygon
define|#
directive|define
name|Polygon
value|0x0324
end_define

begin_define
DECL|macro|PolyPolygon
define|#
directive|define
name|PolyPolygon
value|0x0538
end_define

begin_define
DECL|macro|Polyline
define|#
directive|define
name|Polyline
value|0x0325
end_define

begin_define
DECL|macro|TextOut
define|#
directive|define
name|TextOut
value|0x0521
end_define

begin_define
DECL|macro|StretchBlt
define|#
directive|define
name|StretchBlt
value|0x0B23
end_define

begin_define
DECL|macro|StretchDIBits
define|#
directive|define
name|StretchDIBits
value|0x0F43
end_define

begin_typedef
DECL|struct|_RGBTriple
typedef|typedef
struct|struct
name|_RGBTriple
block|{
DECL|member|Red
name|BYTE
name|Red
decl_stmt|;
DECL|member|Green
name|BYTE
name|Green
decl_stmt|;
DECL|member|Blue
name|BYTE
name|Blue
decl_stmt|;
DECL|typedef|RGBTRIPLE
block|}
name|RGBTRIPLE
typedef|;
end_typedef

begin_typedef
DECL|struct|_BitBltRecord
typedef|typedef
struct|struct
name|_BitBltRecord
block|{
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Total size of the record in WORDs */
DECL|member|Function
name|WORD
name|Function
decl_stmt|;
comment|/* Function number (0x0922) */
DECL|member|RasterOp
name|WORD
name|RasterOp
decl_stmt|;
comment|/* High-order word for the raster operation */
DECL|member|YSrcOrigin
name|WORD
name|YSrcOrigin
decl_stmt|;
comment|/* Y-coordinate of the source origin */
DECL|member|XSrcOrigin
name|WORD
name|XSrcOrigin
decl_stmt|;
comment|/* X-coordinate of the source origin */
DECL|member|YDest
name|WORD
name|YDest
decl_stmt|;
comment|/* Destination width */
DECL|member|XDest
name|WORD
name|XDest
decl_stmt|;
comment|/* Destination height */
DECL|member|YDestOrigin
name|WORD
name|YDestOrigin
decl_stmt|;
comment|/* Y-coordinate of the destination origin */
DECL|member|XDestOrigin
name|WORD
name|XDestOrigin
decl_stmt|;
comment|/* X-coordinate of the destination origin */
comment|/* DDB Bitmap */
DECL|member|Width
name|DWORD
name|Width
decl_stmt|;
comment|/* Width of bitmap in pixels */
DECL|member|Height
name|DWORD
name|Height
decl_stmt|;
comment|/* Height of bitmap in scan lines */
DECL|member|BytesPerLine
name|DWORD
name|BytesPerLine
decl_stmt|;
comment|/* Number of bytes in each scan line */
DECL|member|NumColorPlanes
name|WORD
name|NumColorPlanes
decl_stmt|;
comment|/* Number of color planes in the bitmap */
DECL|member|BitsPerPixel
name|WORD
name|BitsPerPixel
decl_stmt|;
comment|/* Number of bits in each pixel */
if|#
directive|if
name|DOCUMENTATION_ONLY_ILLEGAL_C
DECL|member|Bitmap
name|RGBTRIPLE
name|Bitmap
index|[]
decl_stmt|;
comment|/* Bitmap data */
endif|#
directive|endif
DECL|typedef|BITBLTRECORD
block|}
name|BITBLTRECORD
typedef|;
end_typedef

begin_typedef
DECL|struct|_RGBQuad
typedef|typedef
struct|struct
name|_RGBQuad
block|{
DECL|member|Red
name|BYTE
name|Red
decl_stmt|;
DECL|member|Green
name|BYTE
name|Green
decl_stmt|;
DECL|member|Blue
name|BYTE
name|Blue
decl_stmt|;
DECL|member|Reserved
name|BYTE
name|Reserved
decl_stmt|;
DECL|typedef|RGBQUAD
block|}
name|RGBQUAD
typedef|;
end_typedef

begin_typedef
DECL|struct|_DibBitBltRecord
typedef|typedef
struct|struct
name|_DibBitBltRecord
block|{
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Total size of the record in WORDs */
DECL|member|Function
name|WORD
name|Function
decl_stmt|;
comment|/* Function number (0x0940) */
DECL|member|RasterOp
name|WORD
name|RasterOp
decl_stmt|;
comment|/* High-order word for the raster operation */
DECL|member|YSrcOrigin
name|WORD
name|YSrcOrigin
decl_stmt|;
comment|/* Y-coordinate of the source origin */
DECL|member|XSrcOrigin
name|WORD
name|XSrcOrigin
decl_stmt|;
comment|/* X-coordinate of the source origin */
DECL|member|YDest
name|WORD
name|YDest
decl_stmt|;
comment|/* Destination width */
DECL|member|XDest
name|WORD
name|XDest
decl_stmt|;
comment|/* Destination height */
DECL|member|YDestOrigin
name|WORD
name|YDestOrigin
decl_stmt|;
comment|/* Y-coordinate of the destination origin */
DECL|member|XDestOrigin
name|WORD
name|XDestOrigin
decl_stmt|;
comment|/* X-coordinate of the destination origin */
comment|/* DIB Bitmap */
DECL|member|Width
name|DWORD
name|Width
decl_stmt|;
comment|/* Width of bitmap in pixels */
DECL|member|Height
name|DWORD
name|Height
decl_stmt|;
comment|/* Height of bitmap in scan lines */
DECL|member|BytesPerLine
name|DWORD
name|BytesPerLine
decl_stmt|;
comment|/* Number of bytes in each scan line */
DECL|member|NumColorPlanes
name|WORD
name|NumColorPlanes
decl_stmt|;
comment|/* Number of color planes in the bitmap */
DECL|member|BitsPerPixel
name|WORD
name|BitsPerPixel
decl_stmt|;
comment|/* Number of bits in each pixel */
DECL|member|Compression
name|DWORD
name|Compression
decl_stmt|;
comment|/* Compression type */
DECL|member|SizeImage
name|DWORD
name|SizeImage
decl_stmt|;
comment|/* Size of bitmap in bytes */
DECL|member|XPelsPerMeter
name|LONG
name|XPelsPerMeter
decl_stmt|;
comment|/* Width of image in pixels per meter */
DECL|member|YPelsPerMeter
name|LONG
name|YPelsPerMeter
decl_stmt|;
comment|/* Height of image in pixels per meter */
DECL|member|ClrUsed
name|DWORD
name|ClrUsed
decl_stmt|;
comment|/* Number of colors used */
DECL|member|ClrImportant
name|DWORD
name|ClrImportant
decl_stmt|;
comment|/* Number of important colors */
if|#
directive|if
name|DOCUMENTATION_ONLY_ILLEGAL_C
DECL|member|Bitmap
name|RGBQUAD
name|Bitmap
index|[]
decl_stmt|;
comment|/* Bitmap data */
endif|#
directive|endif
DECL|typedef|DIBBITBLTRECORD
block|}
name|DIBBITBLTRECORD
typedef|;
end_typedef

begin_typedef
DECL|struct|_EnhancedMetaRecord
typedef|typedef
struct|struct
name|_EnhancedMetaRecord
block|{
DECL|member|Function
name|DWORD
name|Function
decl_stmt|;
comment|/* Function number (defined in WINGDI.H) */
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Total size of the record in WORDs */
if|#
directive|if
name|DOCUMENTATION_ONLY_ILLEGAL_C
DECL|member|Parameters
name|DWORD
name|Parameters
index|[]
decl_stmt|;
comment|/* Parameter values passed to GDI function */
endif|#
directive|endif
DECL|typedef|EMFRECORD
block|}
name|EMFRECORD
typedef|;
end_typedef

begin_define
DECL|macro|EMR_ABORTPATH
define|#
directive|define
name|EMR_ABORTPATH
value|68
end_define

begin_define
DECL|macro|EMR_POLYLINE
define|#
directive|define
name|EMR_POLYLINE
value|4
end_define

begin_define
DECL|macro|EMR_ANGLEARC
define|#
directive|define
name|EMR_ANGLEARC
value|41
end_define

begin_define
DECL|macro|EMR_POLYLINE16
define|#
directive|define
name|EMR_POLYLINE16
value|87
end_define

begin_define
DECL|macro|EMR_ARC
define|#
directive|define
name|EMR_ARC
value|45
end_define

begin_define
DECL|macro|EMR_POLYLINETO
define|#
directive|define
name|EMR_POLYLINETO
value|6
end_define

begin_define
DECL|macro|EMR_ARCTO
define|#
directive|define
name|EMR_ARCTO
value|55
end_define

begin_define
DECL|macro|EMR_POLYLINETO16
define|#
directive|define
name|EMR_POLYLINETO16
value|89
end_define

begin_define
DECL|macro|EMR_BEGINPATH
define|#
directive|define
name|EMR_BEGINPATH
value|59
end_define

begin_define
DECL|macro|EMR_POLYPOLYGON
define|#
directive|define
name|EMR_POLYPOLYGON
value|8
end_define

begin_define
DECL|macro|EMR_BITBLT
define|#
directive|define
name|EMR_BITBLT
value|76
end_define

begin_define
DECL|macro|EMR_POLYPOLYGON16
define|#
directive|define
name|EMR_POLYPOLYGON16
value|91
end_define

begin_define
DECL|macro|EMR_CHORD
define|#
directive|define
name|EMR_CHORD
value|46
end_define

begin_define
DECL|macro|EMR_POLYPOLYLINE
define|#
directive|define
name|EMR_POLYPOLYLINE
value|7
end_define

begin_define
DECL|macro|EMR_CLOSEFIGURE
define|#
directive|define
name|EMR_CLOSEFIGURE
value|61
end_define

begin_define
DECL|macro|EMR_POLYPOLYLINE16
define|#
directive|define
name|EMR_POLYPOLYLINE16
value|90
end_define

begin_define
DECL|macro|EMR_CREATEBRUSHINDIRECT
define|#
directive|define
name|EMR_CREATEBRUSHINDIRECT
value|39
end_define

begin_define
DECL|macro|EMR_POLYTEXTOUTA
define|#
directive|define
name|EMR_POLYTEXTOUTA
value|96
end_define

begin_define
DECL|macro|EMR_CREATEDIBPATTERNBRUSHPT
define|#
directive|define
name|EMR_CREATEDIBPATTERNBRUSHPT
value|94
end_define

begin_define
DECL|macro|EMR_POLYTEXTOUTW
define|#
directive|define
name|EMR_POLYTEXTOUTW
value|97
end_define

begin_define
DECL|macro|EMR_CREATEMONOBRUSH
define|#
directive|define
name|EMR_CREATEMONOBRUSH
value|93
end_define

begin_define
DECL|macro|EMR_REALIZEPALETTE
define|#
directive|define
name|EMR_REALIZEPALETTE
value|52
end_define

begin_define
DECL|macro|EMR_CREATEPALETTE
define|#
directive|define
name|EMR_CREATEPALETTE
value|49
end_define

begin_define
DECL|macro|EMR_RECTANGLE
define|#
directive|define
name|EMR_RECTANGLE
value|43
end_define

begin_define
DECL|macro|EMR_CREATEPEN
define|#
directive|define
name|EMR_CREATEPEN
value|38
end_define

begin_define
DECL|macro|EMR_RESIZEPALETTE
define|#
directive|define
name|EMR_RESIZEPALETTE
value|51
end_define

begin_define
DECL|macro|EMR_DELETEOBJECT
define|#
directive|define
name|EMR_DELETEOBJECT
value|40
end_define

begin_define
DECL|macro|EMR_RESTOREDC
define|#
directive|define
name|EMR_RESTOREDC
value|34
end_define

begin_define
DECL|macro|EMR_ELLIPSE
define|#
directive|define
name|EMR_ELLIPSE
value|42
end_define

begin_define
DECL|macro|EMR_ROUNDRECT
define|#
directive|define
name|EMR_ROUNDRECT
value|44
end_define

begin_define
DECL|macro|EMR_ENDPATH
define|#
directive|define
name|EMR_ENDPATH
value|60
end_define

begin_define
DECL|macro|EMR_SAVEDC
define|#
directive|define
name|EMR_SAVEDC
value|33
end_define

begin_define
DECL|macro|EMR_EOF
define|#
directive|define
name|EMR_EOF
value|14
end_define

begin_define
DECL|macro|EMR_SCALEVIEWPORTEXTEX
define|#
directive|define
name|EMR_SCALEVIEWPORTEXTEX
value|31
end_define

begin_define
DECL|macro|EMR_EXCLUDECLIPRECT
define|#
directive|define
name|EMR_EXCLUDECLIPRECT
value|29
end_define

begin_define
DECL|macro|EMR_SCALEWINDOWEXTEX
define|#
directive|define
name|EMR_SCALEWINDOWEXTEX
value|32
end_define

begin_define
DECL|macro|EMR_EXTCREATEFONTINDIRECTW
define|#
directive|define
name|EMR_EXTCREATEFONTINDIRECTW
value|82
end_define

begin_define
DECL|macro|EMR_SELECTCLIPPATH
define|#
directive|define
name|EMR_SELECTCLIPPATH
value|67
end_define

begin_define
DECL|macro|EMR_EXTCREATEPEN
define|#
directive|define
name|EMR_EXTCREATEPEN
value|95
end_define

begin_define
DECL|macro|EMR_SELECTOBJECT
define|#
directive|define
name|EMR_SELECTOBJECT
value|37
end_define

begin_define
DECL|macro|EMR_EXTFLOODFILL
define|#
directive|define
name|EMR_EXTFLOODFILL
value|53
end_define

begin_define
DECL|macro|EMR_SELECTPALETTE
define|#
directive|define
name|EMR_SELECTPALETTE
value|48
end_define

begin_define
DECL|macro|EMR_EXTSELECTCLIPRGN
define|#
directive|define
name|EMR_EXTSELECTCLIPRGN
value|75
end_define

begin_define
DECL|macro|EMR_SETARCDIRECTION
define|#
directive|define
name|EMR_SETARCDIRECTION
value|57
end_define

begin_define
DECL|macro|EMR_EXTTEXTOUTA
define|#
directive|define
name|EMR_EXTTEXTOUTA
value|83
end_define

begin_define
DECL|macro|EMR_SETBKCOLOR
define|#
directive|define
name|EMR_SETBKCOLOR
value|25
end_define

begin_define
DECL|macro|EMR_EXTTEXTOUTW
define|#
directive|define
name|EMR_EXTTEXTOUTW
value|84
end_define

begin_define
DECL|macro|EMR_SETBKMODE
define|#
directive|define
name|EMR_SETBKMODE
value|18
end_define

begin_define
DECL|macro|EMR_FILLPATH
define|#
directive|define
name|EMR_FILLPATH
value|62
end_define

begin_define
DECL|macro|EMR_SETBRUSHORGEX
define|#
directive|define
name|EMR_SETBRUSHORGEX
value|13
end_define

begin_define
DECL|macro|EMR_FILLRGN
define|#
directive|define
name|EMR_FILLRGN
value|71
end_define

begin_define
DECL|macro|EMR_SETCOLORADJUSTMENT
define|#
directive|define
name|EMR_SETCOLORADJUSTMENT
value|23
end_define

begin_define
DECL|macro|EMR_FLATTENPATH
define|#
directive|define
name|EMR_FLATTENPATH
value|65
end_define

begin_define
DECL|macro|EMR_SETDIBITSTODEVICE
define|#
directive|define
name|EMR_SETDIBITSTODEVICE
value|80
end_define

begin_define
DECL|macro|EMR_FRAMERGN
define|#
directive|define
name|EMR_FRAMERGN
value|72
end_define

begin_define
DECL|macro|EMR_SETMAPMODE
define|#
directive|define
name|EMR_SETMAPMODE
value|17
end_define

begin_define
DECL|macro|EMR_GDICOMMENT
define|#
directive|define
name|EMR_GDICOMMENT
value|70
end_define

begin_define
DECL|macro|EMR_SETMAPPERFLAGS
define|#
directive|define
name|EMR_SETMAPPERFLAGS
value|16
end_define

begin_define
DECL|macro|EMR_HEADER
define|#
directive|define
name|EMR_HEADER
value|1
end_define

begin_define
DECL|macro|EMR_SETMETARGN
define|#
directive|define
name|EMR_SETMETARGN
value|28
end_define

begin_define
DECL|macro|EMR_INTERSECTCLIPRECT
define|#
directive|define
name|EMR_INTERSECTCLIPRECT
value|30
end_define

begin_define
DECL|macro|EMR_SETMITERLIMIT
define|#
directive|define
name|EMR_SETMITERLIMIT
value|58
end_define

begin_define
DECL|macro|EMR_INVERTRGN
define|#
directive|define
name|EMR_INVERTRGN
value|73
end_define

begin_define
DECL|macro|EMR_SETPALETTEENTRIES
define|#
directive|define
name|EMR_SETPALETTEENTRIES
value|50
end_define

begin_define
DECL|macro|EMR_LINETO
define|#
directive|define
name|EMR_LINETO
value|54
end_define

begin_define
DECL|macro|EMR_SETPIXELV
define|#
directive|define
name|EMR_SETPIXELV
value|15
end_define

begin_define
DECL|macro|EMR_MASKBLT
define|#
directive|define
name|EMR_MASKBLT
value|78
end_define

begin_define
DECL|macro|EMR_SETPOLYFILLMODE
define|#
directive|define
name|EMR_SETPOLYFILLMODE
value|19
end_define

begin_define
DECL|macro|EMR_MODIFYWORLDTRANSFORM
define|#
directive|define
name|EMR_MODIFYWORLDTRANSFORM
value|36
end_define

begin_define
DECL|macro|EMR_SETROP2
define|#
directive|define
name|EMR_SETROP2
value|20
end_define

begin_define
DECL|macro|EMR_MOVETOEX
define|#
directive|define
name|EMR_MOVETOEX
value|27
end_define

begin_define
DECL|macro|EMR_SETSTRETCHBLTMODE
define|#
directive|define
name|EMR_SETSTRETCHBLTMODE
value|21
end_define

begin_define
DECL|macro|EMR_OFFSETCLIPRGN
define|#
directive|define
name|EMR_OFFSETCLIPRGN
value|26
end_define

begin_define
DECL|macro|EMR_SETTEXTALIGN
define|#
directive|define
name|EMR_SETTEXTALIGN
value|22
end_define

begin_define
DECL|macro|EMR_PAINTRGN
define|#
directive|define
name|EMR_PAINTRGN
value|74
end_define

begin_define
DECL|macro|EMR_SETTEXTCOLOR
define|#
directive|define
name|EMR_SETTEXTCOLOR
value|24
end_define

begin_define
DECL|macro|EMR_PIE
define|#
directive|define
name|EMR_PIE
value|47
end_define

begin_define
DECL|macro|EMR_SETVIEWPORTEXTEX
define|#
directive|define
name|EMR_SETVIEWPORTEXTEX
value|11
end_define

begin_define
DECL|macro|EMR_PLGBLT
define|#
directive|define
name|EMR_PLGBLT
value|79
end_define

begin_define
DECL|macro|EMR_SETVIEWPORTORGEX
define|#
directive|define
name|EMR_SETVIEWPORTORGEX
value|12
end_define

begin_define
DECL|macro|EMR_POLYBEZIER
define|#
directive|define
name|EMR_POLYBEZIER
value|2
end_define

begin_define
DECL|macro|EMR_SETWINDOWEXTEX
define|#
directive|define
name|EMR_SETWINDOWEXTEX
value|9
end_define

begin_define
DECL|macro|EMR_POLYBEZIER16
define|#
directive|define
name|EMR_POLYBEZIER16
value|85
end_define

begin_define
DECL|macro|EMR_SETWINDOWORGEX
define|#
directive|define
name|EMR_SETWINDOWORGEX
value|10
end_define

begin_define
DECL|macro|EMR_POLYBEZIERTO
define|#
directive|define
name|EMR_POLYBEZIERTO
value|5
end_define

begin_define
DECL|macro|EMR_SETWORLDTRANSFORM
define|#
directive|define
name|EMR_SETWORLDTRANSFORM
value|35
end_define

begin_define
DECL|macro|EMR_POLYBEZIERTO16
define|#
directive|define
name|EMR_POLYBEZIERTO16
value|88
end_define

begin_define
DECL|macro|EMR_STRETCHBLT
define|#
directive|define
name|EMR_STRETCHBLT
value|77
end_define

begin_define
DECL|macro|EMR_POLYDRAW
define|#
directive|define
name|EMR_POLYDRAW
value|56
end_define

begin_define
DECL|macro|EMR_STRETCHDIBITS
define|#
directive|define
name|EMR_STRETCHDIBITS
value|81
end_define

begin_define
DECL|macro|EMR_POLYDRAW16
define|#
directive|define
name|EMR_POLYDRAW16
value|92
end_define

begin_define
DECL|macro|EMR_STROKEANDFILLPATH
define|#
directive|define
name|EMR_STROKEANDFILLPATH
value|63
end_define

begin_define
DECL|macro|EMR_POLYGON
define|#
directive|define
name|EMR_POLYGON
value|3
end_define

begin_define
DECL|macro|EMR_STROKEPATH
define|#
directive|define
name|EMR_STROKEPATH
value|64
end_define

begin_define
DECL|macro|EMR_POLYGON16
define|#
directive|define
name|EMR_POLYGON16
value|86
end_define

begin_define
DECL|macro|EMR_WIDENPATH
define|#
directive|define
name|EMR_WIDENPATH
value|66
end_define

begin_typedef
DECL|struct|_PaletteEntry
typedef|typedef
struct|struct
name|_PaletteEntry
block|{
DECL|member|Red
name|BYTE
name|Red
decl_stmt|;
comment|/* Red component value */
DECL|member|Green
name|BYTE
name|Green
decl_stmt|;
comment|/* Green component value */
DECL|member|Blue
name|BYTE
name|Blue
decl_stmt|;
comment|/* Blue component value */
DECL|member|Flags
name|BYTE
name|Flags
decl_stmt|;
comment|/* Flag values */
DECL|typedef|PALENT
block|}
name|PALENT
typedef|;
end_typedef

begin_typedef
DECL|struct|_EndOfRecord
typedef|typedef
struct|struct
name|_EndOfRecord
block|{
DECL|member|Function
name|DWORD
name|Function
decl_stmt|;
comment|/* End Of Record ID (14) */
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Total size of the record in WORDs */
DECL|member|NumPalEntries
name|DWORD
name|NumPalEntries
decl_stmt|;
comment|/* Number of color palette entries */
DECL|member|OffPalEntries
name|DWORD
name|OffPalEntries
decl_stmt|;
comment|/* Offset of color palette entries */
if|#
directive|if
name|DOCUMENTATION_ONLY_ILLEGAL_C
DECL|member|Palette
name|PALENT
name|Palette
index|[]
decl_stmt|;
comment|/* The color palette data */
DECL|member|OffToEOF
name|DWORD
name|OffToEOF
decl_stmt|;
comment|/* Offset to beginning of this record */
endif|#
directive|endif
DECL|typedef|ENDOFRECORD
block|}
name|ENDOFRECORD
typedef|;
end_typedef

begin_typedef
DECL|struct|_GdiCommentRecord
typedef|typedef
struct|struct
name|_GdiCommentRecord
block|{
DECL|member|Function
name|DWORD
name|Function
decl_stmt|;
comment|/* GDI Comment ID (70) */
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Total size of the record in WORDs */
DECL|member|SizeOfData
name|DWORD
name|SizeOfData
decl_stmt|;
comment|/* Size of comment data in bytes */
if|#
directive|if
name|DOCUMENTATION_ONLY_ILLEGAL_C
DECL|member|Data
name|BYTE
name|Data
index|[]
decl_stmt|;
comment|/* Comment data */
endif|#
directive|endif
DECL|typedef|GDICOMMENTRECORD
block|}
name|GDICOMMENTRECORD
typedef|;
end_typedef

begin_typedef
DECL|struct|_GdiCommentMetafile
typedef|typedef
struct|struct
name|_GdiCommentMetafile
block|{
DECL|member|Identifier
name|DWORD
name|Identifier
decl_stmt|;
comment|/* Comment ID (0x43494447) */
DECL|member|Comment
name|DWORD
name|Comment
decl_stmt|;
comment|/* Metafile ID (0x80000001) */
DECL|member|Version
name|DWORD
name|Version
decl_stmt|;
comment|/* Version of the metafile */
DECL|member|Checksum
name|DWORD
name|Checksum
decl_stmt|;
comment|/* Checksum value of the metafile */
DECL|member|Flags
name|DWORD
name|Flags
decl_stmt|;
comment|/* Flags (always 0) */
DECL|member|Size
name|DWORD
name|Size
decl_stmt|;
comment|/* Size of the metafile data in bytes */
DECL|typedef|GDICOMMENTMETAFILE
block|}
name|GDICOMMENTMETAFILE
typedef|;
end_typedef

begin_typedef
DECL|struct|_GdiCommentBeginGroup
typedef|typedef
struct|struct
name|_GdiCommentBeginGroup
block|{
DECL|member|Identifier
name|DWORD
name|Identifier
decl_stmt|;
comment|/* Comment ID (0x43494447) */
DECL|member|Comment
name|DWORD
name|Comment
decl_stmt|;
comment|/* BeginGroup ID (0x00000002) */
DECL|member|BoundsLeft
name|LONG
name|BoundsLeft
decl_stmt|;
comment|/* Left side of bounding rectangle */
DECL|member|BoundsRight
name|LONG
name|BoundsRight
decl_stmt|;
comment|/* Right side of bounding rectangle */
DECL|member|BoundsTop
name|LONG
name|BoundsTop
decl_stmt|;
comment|/* Top side of bounding rectangle */
DECL|member|BoundsBottom
name|LONG
name|BoundsBottom
decl_stmt|;
comment|/* Bottom side of bounding rectangle */
DECL|member|SizeOfDescrip
name|DWORD
name|SizeOfDescrip
decl_stmt|;
comment|/* Number of characters in the description */
DECL|typedef|GDICOMMENTBEGINGROUP
block|}
name|GDICOMMENTBEGINGROUP
typedef|;
end_typedef

begin_typedef
DECL|struct|_GdiCommentEndGroup
typedef|typedef
struct|struct
name|_GdiCommentEndGroup
block|{
DECL|member|Identifier
name|DWORD
name|Identifier
decl_stmt|;
comment|/* Comment ID (0x43494447) */
DECL|member|Comment
name|DWORD
name|Comment
decl_stmt|;
comment|/* EndGroup ID (0x00000003) */
DECL|typedef|GDICOMMENTENDGROUP
block|}
name|GDICOMMENTENDGROUP
typedef|;
end_typedef

begin_typedef
DECL|struct|_EmrFormat
typedef|typedef
struct|struct
name|_EmrFormat
block|{
DECL|member|Signature
name|DWORD
name|Signature
decl_stmt|;
comment|/* Format signature */
DECL|member|Version
name|DWORD
name|Version
decl_stmt|;
comment|/* Format version number */
DECL|member|Data
name|DWORD
name|Data
decl_stmt|;
comment|/* Size of data in bytes */
DECL|member|OffsetToData
name|DWORD
name|OffsetToData
decl_stmt|;
comment|/* Offset to data */
DECL|typedef|EMRFORMAT
block|}
name|EMRFORMAT
typedef|;
end_typedef

begin_typedef
DECL|struct|_GdiCommentMultiFormats
typedef|typedef
struct|struct
name|_GdiCommentMultiFormats
block|{
DECL|member|Identifier
name|DWORD
name|Identifier
decl_stmt|;
comment|/* Comment ID (0x43494447) */
DECL|member|Comment
name|DWORD
name|Comment
decl_stmt|;
comment|/* Multiformats ID (0x40000004) */
DECL|member|BoundsLeft
name|LONG
name|BoundsLeft
decl_stmt|;
comment|/* Left side of bounding rectangle */
DECL|member|BoundsRight
name|LONG
name|BoundsRight
decl_stmt|;
comment|/* Right side of bounding rectangle */
DECL|member|BoundsTop
name|LONG
name|BoundsTop
decl_stmt|;
comment|/* Top side of bounding rectangle */
DECL|member|BoundsBottom
name|LONG
name|BoundsBottom
decl_stmt|;
comment|/* Bottom side of bounding rectangle */
DECL|member|NumFormats
name|DWORD
name|NumFormats
decl_stmt|;
comment|/* Number of formats in comment */
if|#
directive|if
name|DOCUMENTATION_ONLY_ILLEGAL_C
DECL|member|Data
name|EMRFORMAT
name|Data
index|[]
decl_stmt|;
comment|/* Array of comment data */
endif|#
directive|endif
DECL|typedef|GDICOMMENTMULTIFORMATS
block|}
name|GDICOMMENTMULTIFORMATS
typedef|;
end_typedef

begin_comment
comment|/* Binary raster ops */
end_comment

begin_define
DECL|macro|R2_BLACK
define|#
directive|define
name|R2_BLACK
value|1
end_define

begin_define
DECL|macro|R2_NOTMERGEPEN
define|#
directive|define
name|R2_NOTMERGEPEN
value|2
end_define

begin_define
DECL|macro|R2_MASKNOTPEN
define|#
directive|define
name|R2_MASKNOTPEN
value|3
end_define

begin_define
DECL|macro|R2_NOTCOPYPEN
define|#
directive|define
name|R2_NOTCOPYPEN
value|4
end_define

begin_define
DECL|macro|R2_MASKPENNOT
define|#
directive|define
name|R2_MASKPENNOT
value|5
end_define

begin_define
DECL|macro|R2_NOT
define|#
directive|define
name|R2_NOT
value|6
end_define

begin_define
DECL|macro|R2_XORPEN
define|#
directive|define
name|R2_XORPEN
value|7
end_define

begin_define
DECL|macro|R2_NOTMASKPEN
define|#
directive|define
name|R2_NOTMASKPEN
value|8
end_define

begin_define
DECL|macro|R2_MASKPEN
define|#
directive|define
name|R2_MASKPEN
value|9
end_define

begin_define
DECL|macro|R2_NOTXORPEN
define|#
directive|define
name|R2_NOTXORPEN
value|10
end_define

begin_define
DECL|macro|R2_NOP
define|#
directive|define
name|R2_NOP
value|11
end_define

begin_define
DECL|macro|R2_MERGENOTPEN
define|#
directive|define
name|R2_MERGENOTPEN
value|12
end_define

begin_define
DECL|macro|R2_COPYPEN
define|#
directive|define
name|R2_COPYPEN
value|13
end_define

begin_define
DECL|macro|R2_MERGEPENNOT
define|#
directive|define
name|R2_MERGEPENNOT
value|14
end_define

begin_define
DECL|macro|R2_MERGEPEN
define|#
directive|define
name|R2_MERGEPEN
value|15
end_define

begin_define
DECL|macro|R2_WHITE
define|#
directive|define
name|R2_WHITE
value|16
end_define

begin_comment
comment|/* Background mix modes */
end_comment

begin_define
DECL|macro|TRANSPARENT
define|#
directive|define
name|TRANSPARENT
value|1
end_define

begin_define
DECL|macro|OPAQUE
define|#
directive|define
name|OPAQUE
value|2
end_define

begin_comment
comment|/* Brush styles */
end_comment

begin_define
DECL|macro|BS_SOLID
define|#
directive|define
name|BS_SOLID
value|0
end_define

begin_define
DECL|macro|BS_NULL
define|#
directive|define
name|BS_NULL
value|1
end_define

begin_define
DECL|macro|BS_HATCHED
define|#
directive|define
name|BS_HATCHED
value|2
end_define

begin_define
DECL|macro|BS_PATTERN
define|#
directive|define
name|BS_PATTERN
value|3
end_define

begin_define
DECL|macro|BS_DIBPATTERN
define|#
directive|define
name|BS_DIBPATTERN
value|5
end_define

begin_define
DECL|macro|BS_DIBPATTERNPT
define|#
directive|define
name|BS_DIBPATTERNPT
value|6
end_define

begin_define
DECL|macro|BS_PATTERN8X8
define|#
directive|define
name|BS_PATTERN8X8
value|7
end_define

begin_define
DECL|macro|BS_DIBPATTERN8X8
define|#
directive|define
name|BS_DIBPATTERN8X8
value|8
end_define

begin_define
DECL|macro|BS_MONOPATTERN
define|#
directive|define
name|BS_MONOPATTERN
value|9
end_define

begin_comment
comment|/* Pen styles */
end_comment

begin_define
DECL|macro|PS_SOLID
define|#
directive|define
name|PS_SOLID
value|0
end_define

begin_define
DECL|macro|PS_DASH
define|#
directive|define
name|PS_DASH
value|1
end_define

begin_define
DECL|macro|PS_DOT
define|#
directive|define
name|PS_DOT
value|2
end_define

begin_define
DECL|macro|PS_DASHDOT
define|#
directive|define
name|PS_DASHDOT
value|3
end_define

begin_define
DECL|macro|PS_DASHDOTDOT
define|#
directive|define
name|PS_DASHDOTDOT
value|4
end_define

begin_define
DECL|macro|PS_NULL
define|#
directive|define
name|PS_NULL
value|5
end_define

begin_define
DECL|macro|PS_INSIDEFRAME
define|#
directive|define
name|PS_INSIDEFRAME
value|6
end_define

begin_comment
comment|/* Polygon fill modes */
end_comment

begin_define
DECL|macro|ALTERNATE
define|#
directive|define
name|ALTERNATE
value|1
end_define

begin_define
DECL|macro|WINDING
define|#
directive|define
name|WINDING
value|2
end_define

begin_comment
comment|/* Modes for SetMapMode */
end_comment

begin_define
DECL|macro|MM_TEXT
define|#
directive|define
name|MM_TEXT
value|1
end_define

begin_define
DECL|macro|MM_LOMETRIC
define|#
directive|define
name|MM_LOMETRIC
value|2
end_define

begin_define
DECL|macro|MM_HIMETRIC
define|#
directive|define
name|MM_HIMETRIC
value|3
end_define

begin_define
DECL|macro|MM_LOENGLISH
define|#
directive|define
name|MM_LOENGLISH
value|4
end_define

begin_define
DECL|macro|MM_HIENGLISH
define|#
directive|define
name|MM_HIENGLISH
value|5
end_define

begin_define
DECL|macro|MM_TWIPS
define|#
directive|define
name|MM_TWIPS
value|6
end_define

begin_define
DECL|macro|MM_ISOTROPIC
define|#
directive|define
name|MM_ISOTROPIC
value|7
end_define

begin_define
DECL|macro|MM_ANISOTROPIC
define|#
directive|define
name|MM_ANISOTROPIC
value|8
end_define

begin_define
DECL|macro|ReadOK (file,buffer,len)
define|#
directive|define
name|ReadOK
parameter_list|(
name|file
parameter_list|,
name|buffer
parameter_list|,
name|len
parameter_list|)
value|(fread(buffer, len, 1, file) != 0)
end_define

begin_define
DECL|macro|NPARMWORDS
define|#
directive|define
name|NPARMWORDS
value|16
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|G_BYTE_ORDER
end_ifndef

begin_comment
comment|/* Development glib has byte sex stuff, 				 * but if we're on 1.0, use something else 				 */
end_comment

begin_define
DECL|macro|G_LITTLE_ENDIAN
define|#
directive|define
name|G_LITTLE_ENDIAN
value|1234
end_define

begin_define
DECL|macro|G_BIG_ENDIAN
define|#
directive|define
name|G_BIG_ENDIAN
value|4321
end_define

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__i386__
argument_list|)
end_if

begin_define
DECL|macro|G_BYTE_ORDER
define|#
directive|define
name|G_BYTE_ORDER
value|G_LITTLE_ENDIAN
end_define

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|__hppa
argument_list|)
operator|||
name|defined
argument_list|(
name|__sparc
argument_list|)
end_elif

begin_define
DECL|macro|G_BYTE_ORDER
define|#
directive|define
name|G_BYTE_ORDER
value|G_BIG_ENDIAN
end_define

begin_else
else|#
directive|else
end_else

begin_error
error|#
directive|error
error|set byte order by hand by adding your machine above
end_error

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* This is straight from the newest glib.h */
end_comment

begin_comment
comment|/* Basic bit swapping functions  */
end_comment

begin_define
DECL|macro|GUINT16_SWAP_LE_BE_CONSTANT (val)
define|#
directive|define
name|GUINT16_SWAP_LE_BE_CONSTANT
parameter_list|(
name|val
parameter_list|)
value|((guint16) ( \     (((guint16) (val)& (guint16) 0x00ffU)<< 8) | \     (((guint16) (val)& (guint16) 0xff00U)>> 8)))
end_define

begin_define
DECL|macro|GUINT32_SWAP_LE_BE_CONSTANT (val)
define|#
directive|define
name|GUINT32_SWAP_LE_BE_CONSTANT
parameter_list|(
name|val
parameter_list|)
value|((guint32) ( \     (((guint32) (val)& (guint32) 0x000000ffU)<< 24) | \     (((guint32) (val)& (guint32) 0x0000ff00U)<<  8) | \     (((guint32) (val)& (guint32) 0x00ff0000U)>>  8) | \     (((guint32) (val)& (guint32) 0xff000000U)>> 24)))
end_define

begin_comment
comment|/* Intel specific stuff for speed  */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|__i386__
argument_list|)
operator|&&
operator|(
name|defined
name|__GNUC__
operator|)
end_if

begin_define
DECL|macro|GUINT16_SWAP_LE_BE_X86 (val)
define|#
directive|define
name|GUINT16_SWAP_LE_BE_X86
parameter_list|(
name|val
parameter_list|)
define|\
value|(__extension__						\       ({ register guint16 __v;					\ 	 if (__builtin_constant_p (val))			\ 	   __v = GUINT16_SWAP_LE_BE_CONSTANT (val);		\ 	 else							\ 	   __asm__ __volatile__ ("rorw $8, %w0"			\ 				 : "=r" (__v)			\ 				 : "0" ((guint16) (val))	\ 				 : "cc");			\ 	__v; }))
end_define

begin_define
DECL|macro|GUINT16_SWAP_LE_BE (val)
define|#
directive|define
name|GUINT16_SWAP_LE_BE
parameter_list|(
name|val
parameter_list|)
define|\
value|((guint16) GUINT16_SWAP_LE_BE_X86 ((guint16) (val)))
end_define

begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|__i486__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|__i586__
argument_list|)
expr|\
operator|&&
operator|!
name|defined
argument_list|(
name|__pentium__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|__pentiumpro__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|__i686__
argument_list|)
end_if

begin_define
DECL|macro|GUINT32_SWAP_LE_BE_X86 (val)
define|#
directive|define
name|GUINT32_SWAP_LE_BE_X86
parameter_list|(
name|val
parameter_list|)
define|\
value|(__extension__						\          ({ register guint32 __v;				\ 	    if (__builtin_constant_p (val))			\ 	      __v = GUINT32_SWAP_LE_BE_CONSTANT (val);		\ 	  else							\ 	    __asm__ __volatile__ ("rorw $8, %w0\n\t"		\ 				  "rorl $16, %0\n\t"		\ 				  "rorw $8, %w0"		\ 				  : "=r" (__v)			\ 				  : "0" ((guint32) (val))	\ 				  : "cc");			\ 	__v; }))
end_define

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* 486 and higher has bswap */
end_comment

begin_define
DECL|macro|GUINT32_SWAP_LE_BE_X86 (val)
define|#
directive|define
name|GUINT32_SWAP_LE_BE_X86
parameter_list|(
name|val
parameter_list|)
define|\
value|(__extension__						\          ({ register guint32 __v;				\ 	    if (__builtin_constant_p (val))			\ 	      __v = GUINT32_SWAP_LE_BE_CONSTANT (val);		\ 	  else							\ 	    __asm__ __volatile__ ("bswap %0"			\ 				  : "=r" (__v)			\ 				  : "0" ((guint32) (val)));	\ 	__v; }))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* processor specific 32-bit stuff */
end_comment

begin_define
DECL|macro|GUINT32_SWAP_LE_BE (val)
define|#
directive|define
name|GUINT32_SWAP_LE_BE
parameter_list|(
name|val
parameter_list|)
define|\
value|((guint32) GUINT32_SWAP_LE_BE_X86 ((guint32) (val)))
end_define

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* !__i386__ */
end_comment

begin_define
DECL|macro|GUINT16_SWAP_LE_BE (val)
define|#
directive|define
name|GUINT16_SWAP_LE_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT16_SWAP_LE_BE_CONSTANT (val))
end_define

begin_define
DECL|macro|GUINT32_SWAP_LE_BE (val)
define|#
directive|define
name|GUINT32_SWAP_LE_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT32_SWAP_LE_BE_CONSTANT (val))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* __i386__ */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_GINT64
end_ifdef

begin_define
DECL|macro|GUINT64_SWAP_LE_BE (val)
define|#
directive|define
name|GUINT64_SWAP_LE_BE
parameter_list|(
name|val
parameter_list|)
value|((guint64) ( \     (((guint64) (val)& (guint64) 0x00000000000000ffU)<< 56) | \     (((guint64) (val)& (guint64) 0x000000000000ff00U)<< 40) | \     (((guint64) (val)& (guint64) 0x0000000000ff0000U)<< 24) | \     (((guint64) (val)& (guint64) 0x00000000ff000000U)<<  8) | \     (((guint64) (val)& (guint64) 0x000000ff00000000U)>>  8) | \     (((guint64) (val)& (guint64) 0x0000ff0000000000U)>> 24) | \     (((guint64) (val)& (guint64) 0x00ff000000000000U)>> 40) | \     (((guint64) (val)& (guint64) 0xff00000000000000U)>> 56)))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|GUINT16_SWAP_LE_PDP (val)
define|#
directive|define
name|GUINT16_SWAP_LE_PDP
parameter_list|(
name|val
parameter_list|)
value|((guint16) (val))
end_define

begin_define
DECL|macro|GUINT16_SWAP_BE_PDP (val)
define|#
directive|define
name|GUINT16_SWAP_BE_PDP
parameter_list|(
name|val
parameter_list|)
value|(GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT32_SWAP_LE_PDP (val)
define|#
directive|define
name|GUINT32_SWAP_LE_PDP
parameter_list|(
name|val
parameter_list|)
value|((guint32) ( \     (((guint32) (val)& (guint32) 0x0000ffffU)<< 16) | \     (((guint32) (val)& (guint32) 0xffff0000U)>> 16)))
end_define

begin_define
DECL|macro|GUINT32_SWAP_BE_PDP (val)
define|#
directive|define
name|GUINT32_SWAP_BE_PDP
parameter_list|(
name|val
parameter_list|)
value|((guint32) ( \     (((guint32) (val)& (guint32) 0x00ff00ffU)<< 8) | \     (((guint32) (val)& (guint32) 0xff00ff00U)>> 8)))
end_define

begin_if
if|#
directive|if
name|G_BYTE_ORDER
operator|==
name|G_LITTLE_ENDIAN
end_if

begin_define
DECL|macro|GINT16_TO_LE (val)
define|#
directive|define
name|GINT16_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint16) (val))
end_define

begin_define
DECL|macro|GUINT16_TO_LE (val)
define|#
directive|define
name|GUINT16_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((guint16) (val))
end_define

begin_define
DECL|macro|GINT16_TO_BE (val)
define|#
directive|define
name|GINT16_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint16) GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT16_TO_BE (val)
define|#
directive|define
name|GUINT16_TO_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT16_FROM_LE (val)
define|#
directive|define
name|GINT16_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint16) (val))
end_define

begin_define
DECL|macro|GUINT16_FROM_LE (val)
define|#
directive|define
name|GUINT16_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((guint16) (val))
end_define

begin_define
DECL|macro|GINT16_FROM_BE (val)
define|#
directive|define
name|GINT16_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint16) GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT16_FROM_BE (val)
define|#
directive|define
name|GUINT16_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT32_TO_LE (val)
define|#
directive|define
name|GINT32_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint32) (val))
end_define

begin_define
DECL|macro|GUINT32_TO_LE (val)
define|#
directive|define
name|GUINT32_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((guint32) (val))
end_define

begin_define
DECL|macro|GINT32_TO_BE (val)
define|#
directive|define
name|GINT32_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint32) GUINT32_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT32_TO_BE (val)
define|#
directive|define
name|GUINT32_TO_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT32_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT32_FROM_LE (val)
define|#
directive|define
name|GINT32_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint32) (val))
end_define

begin_define
DECL|macro|GUINT32_FROM_LE (val)
define|#
directive|define
name|GUINT32_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((guint32) (val))
end_define

begin_define
DECL|macro|GINT32_FROM_BE (val)
define|#
directive|define
name|GINT32_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint32) GUINT32_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT32_FROM_BE (val)
define|#
directive|define
name|GUINT32_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT32_SWAP_LE_BE (val))
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_GINT64
end_ifdef

begin_define
DECL|macro|GINT64_TO_LE (val)
define|#
directive|define
name|GINT64_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint64) (val))
end_define

begin_define
DECL|macro|GUINT64_TO_LE (val)
define|#
directive|define
name|GUINT64_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((guint64) (val))
end_define

begin_define
DECL|macro|GINT64_TO_BE (val)
define|#
directive|define
name|GINT64_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint64) GUINT64_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT64_TO_BE (val)
define|#
directive|define
name|GUINT64_TO_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT64_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT64_FROM_LE (val)
define|#
directive|define
name|GINT64_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint64) (val))
end_define

begin_define
DECL|macro|GUINT64_FROM_LE (val)
define|#
directive|define
name|GUINT64_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((guint64) (val))
end_define

begin_define
DECL|macro|GINT64_FROM_BE (val)
define|#
directive|define
name|GINT64_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint64) GUINT64_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT64_FROM_BE (val)
define|#
directive|define
name|GUINT64_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|(GUINT64_SWAP_LE_BE (val))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_elif
elif|#
directive|elif
name|G_BYTE_ORDER
operator|==
name|G_BIG_ENDIAN
end_elif

begin_define
DECL|macro|GINT16_TO_BE (val)
define|#
directive|define
name|GINT16_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint16) (val))
end_define

begin_define
DECL|macro|GUINT16_TO_BE (val)
define|#
directive|define
name|GUINT16_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((guint16) (val))
end_define

begin_define
DECL|macro|GINT16_TO_LE (val)
define|#
directive|define
name|GINT16_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint16) GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT16_TO_LE (val)
define|#
directive|define
name|GUINT16_TO_LE
parameter_list|(
name|val
parameter_list|)
value|(GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT16_FROM_BE (val)
define|#
directive|define
name|GINT16_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint16) (val))
end_define

begin_define
DECL|macro|GUINT16_FROM_BE (val)
define|#
directive|define
name|GUINT16_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((guint16) (val))
end_define

begin_define
DECL|macro|GINT16_FROM_LE (val)
define|#
directive|define
name|GINT16_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint16) GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT16_FROM_LE (val)
define|#
directive|define
name|GUINT16_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|(GUINT16_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT32_TO_BE (val)
define|#
directive|define
name|GINT32_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint32) (val))
end_define

begin_define
DECL|macro|GUINT32_TO_BE (val)
define|#
directive|define
name|GUINT32_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((guint32) (val))
end_define

begin_define
DECL|macro|GINT32_TO_LE (val)
define|#
directive|define
name|GINT32_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint32) GUINT32_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT32_TO_LE (val)
define|#
directive|define
name|GUINT32_TO_LE
parameter_list|(
name|val
parameter_list|)
value|(GUINT32_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT32_FROM_BE (val)
define|#
directive|define
name|GINT32_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint32) (val))
end_define

begin_define
DECL|macro|GUINT32_FROM_BE (val)
define|#
directive|define
name|GUINT32_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((guint32) (val))
end_define

begin_define
DECL|macro|GINT32_FROM_LE (val)
define|#
directive|define
name|GINT32_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint32) GUINT32_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT32_FROM_LE (val)
define|#
directive|define
name|GUINT32_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|(GUINT32_SWAP_LE_BE (val))
end_define

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_GINT64
end_ifdef

begin_define
DECL|macro|GINT64_TO_BE (val)
define|#
directive|define
name|GINT64_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint64) (val))
end_define

begin_define
DECL|macro|GUINT64_TO_BE (val)
define|#
directive|define
name|GUINT64_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((guint64) (val))
end_define

begin_define
DECL|macro|GINT64_TO_LE (val)
define|#
directive|define
name|GINT64_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint64) GUINT64_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT64_TO_LE (val)
define|#
directive|define
name|GUINT64_TO_LE
parameter_list|(
name|val
parameter_list|)
value|(GUINT64_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GINT64_FROM_BE (val)
define|#
directive|define
name|GINT64_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint64) (val))
end_define

begin_define
DECL|macro|GUINT64_FROM_BE (val)
define|#
directive|define
name|GUINT64_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((guint64) (val))
end_define

begin_define
DECL|macro|GINT64_FROM_LE (val)
define|#
directive|define
name|GINT64_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint64) GUINT64_SWAP_LE_BE (val))
end_define

begin_define
DECL|macro|GUINT64_FROM_LE (val)
define|#
directive|define
name|GUINT64_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|(GUINT64_SWAP_LE_BE (val))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* PDP stuff not implemented */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SIZEOF_LONG
operator|==
literal|8
operator|)
end_if

begin_define
DECL|macro|GLONG_TO_LE (val)
define|#
directive|define
name|GLONG_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT64_TO_LE (val))
end_define

begin_define
DECL|macro|GULONG_TO_LE (val)
define|#
directive|define
name|GULONG_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT64_TO_LE (val))
end_define

begin_define
DECL|macro|GLONG_TO_BE (val)
define|#
directive|define
name|GLONG_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT64_TO_BE (val))
end_define

begin_define
DECL|macro|GULONG_TO_BE (val)
define|#
directive|define
name|GULONG_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT64_TO_BE (val))
end_define

begin_define
DECL|macro|GLONG_FROM_LE (val)
define|#
directive|define
name|GLONG_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT64_FROM_LE (val))
end_define

begin_define
DECL|macro|GULONG_FROM_LE (val)
define|#
directive|define
name|GULONG_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT64_FROM_LE (val))
end_define

begin_define
DECL|macro|GLONG_FROM_BE (val)
define|#
directive|define
name|GLONG_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT64_FROM_BE (val))
end_define

begin_define
DECL|macro|GULONG_FROM_BE (val)
define|#
directive|define
name|GULONG_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT64_FROM_BE (val))
end_define

begin_elif
elif|#
directive|elif
operator|(
name|SIZEOF_LONG
operator|==
literal|4
operator|)
end_elif

begin_define
DECL|macro|GLONG_TO_LE (val)
define|#
directive|define
name|GLONG_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT32_TO_LE (val))
end_define

begin_define
DECL|macro|GULONG_TO_LE (val)
define|#
directive|define
name|GULONG_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT32_TO_LE (val))
end_define

begin_define
DECL|macro|GLONG_TO_BE (val)
define|#
directive|define
name|GLONG_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT32_TO_BE (val))
end_define

begin_define
DECL|macro|GULONG_TO_BE (val)
define|#
directive|define
name|GULONG_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT32_TO_BE (val))
end_define

begin_define
DECL|macro|GLONG_FROM_LE (val)
define|#
directive|define
name|GLONG_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT32_FROM_LE (val))
end_define

begin_define
DECL|macro|GULONG_FROM_LE (val)
define|#
directive|define
name|GULONG_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT32_FROM_LE (val))
end_define

begin_define
DECL|macro|GLONG_FROM_BE (val)
define|#
directive|define
name|GLONG_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((glong) GINT32_FROM_BE (val))
end_define

begin_define
DECL|macro|GULONG_FROM_BE (val)
define|#
directive|define
name|GULONG_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gulong) GUINT32_FROM_BE (val))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_if
if|#
directive|if
operator|(
name|SIZEOF_INT
operator|==
literal|8
operator|)
end_if

begin_define
DECL|macro|GINT_TO_LE (val)
define|#
directive|define
name|GINT_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT64_TO_LE (val))
end_define

begin_define
DECL|macro|GUINT_TO_LE (val)
define|#
directive|define
name|GUINT_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT64_TO_LE (val))
end_define

begin_define
DECL|macro|GINT_TO_BE (val)
define|#
directive|define
name|GINT_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT64_TO_BE (val))
end_define

begin_define
DECL|macro|GUINT_TO_BE (val)
define|#
directive|define
name|GUINT_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT64_TO_BE (val))
end_define

begin_define
DECL|macro|GINT_FROM_LE (val)
define|#
directive|define
name|GINT_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT64_FROM_LE (val))
end_define

begin_define
DECL|macro|GUINT_FROM_LE (val)
define|#
directive|define
name|GUINT_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT64_FROM_LE (val))
end_define

begin_define
DECL|macro|GINT_FROM_BE (val)
define|#
directive|define
name|GINT_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT64_FROM_BE (val))
end_define

begin_define
DECL|macro|GUINT_FROM_BE (val)
define|#
directive|define
name|GUINT_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT64_FROM_BE (val))
end_define

begin_elif
elif|#
directive|elif
operator|(
name|SIZEOF_INT
operator|==
literal|4
operator|)
end_elif

begin_define
DECL|macro|GINT_TO_LE (val)
define|#
directive|define
name|GINT_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT32_TO_LE (val))
end_define

begin_define
DECL|macro|GUINT_TO_LE (val)
define|#
directive|define
name|GUINT_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT32_TO_LE (val))
end_define

begin_define
DECL|macro|GINT_TO_BE (val)
define|#
directive|define
name|GINT_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT32_TO_BE (val))
end_define

begin_define
DECL|macro|GUINT_TO_BE (val)
define|#
directive|define
name|GUINT_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT32_TO_BE (val))
end_define

begin_define
DECL|macro|GINT_FROM_LE (val)
define|#
directive|define
name|GINT_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT32_FROM_LE (val))
end_define

begin_define
DECL|macro|GUINT_FROM_LE (val)
define|#
directive|define
name|GUINT_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT32_FROM_LE (val))
end_define

begin_define
DECL|macro|GINT_FROM_BE (val)
define|#
directive|define
name|GINT_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT32_FROM_BE (val))
end_define

begin_define
DECL|macro|GUINT_FROM_BE (val)
define|#
directive|define
name|GUINT_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT32_FROM_BE (val))
end_define

begin_elif
elif|#
directive|elif
operator|(
name|SIZEOF_INT
operator|==
literal|2
operator|)
end_elif

begin_define
DECL|macro|GINT_TO_LE (val)
define|#
directive|define
name|GINT_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT16_TO_LE (val))
end_define

begin_define
DECL|macro|GUINT_TO_LE (val)
define|#
directive|define
name|GUINT_TO_LE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT16_TO_LE (val))
end_define

begin_define
DECL|macro|GINT_TO_BE (val)
define|#
directive|define
name|GINT_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT16_TO_BE (val))
end_define

begin_define
DECL|macro|GUINT_TO_BE (val)
define|#
directive|define
name|GUINT_TO_BE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT16_TO_BE (val))
end_define

begin_define
DECL|macro|GINT_FROM_LE (val)
define|#
directive|define
name|GINT_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT16_FROM_LE (val))
end_define

begin_define
DECL|macro|GUINT_FROM_LE (val)
define|#
directive|define
name|GUINT_FROM_LE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT16_FROM_LE (val))
end_define

begin_define
DECL|macro|GINT_FROM_BE (val)
define|#
directive|define
name|GINT_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((gint) GINT16_FROM_BE (val))
end_define

begin_define
DECL|macro|GUINT_FROM_BE (val)
define|#
directive|define
name|GUINT_FROM_BE
parameter_list|(
name|val
parameter_list|)
value|((guint) GUINT16_FROM_BE (val))
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_endif
endif|#
directive|endif
end_endif

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650108
block|{
DECL|member|scale
name|double
name|scale
decl_stmt|;
DECL|typedef|WMFLoadVals
block|}
name|WMFLoadVals
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|load_vals
specifier|static
name|WMFLoadVals
name|load_vals
init|=
block|{
literal|1.0
comment|/* scale */
block|}
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650208
block|{
DECL|member|run
name|gint
name|run
decl_stmt|;
DECL|typedef|WMFLoadInterface
block|}
name|WMFLoadInterface
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|load_interface
specifier|static
name|WMFLoadInterface
name|load_interface
init|=
block|{
name|FALSE
block|}
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650308
block|{
DECL|member|dialog
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
DECL|member|scale
name|GtkAdjustment
modifier|*
name|scale
decl_stmt|;
DECL|typedef|LoadDialogVals
block|}
name|LoadDialogVals
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2b5cae650403
block|{
DECL|enumerator|OBJ_BITMAP
name|OBJ_BITMAP
block|,
DECL|enumerator|OBJ_BRUSH
name|OBJ_BRUSH
block|,
DECL|enumerator|OBJ_PATTERNBRUSH
name|OBJ_PATTERNBRUSH
block|,
DECL|enumerator|OBJ_FONT
name|OBJ_FONT
block|,
DECL|enumerator|OBJ_PEN
name|OBJ_PEN
block|,
DECL|enumerator|OBJ_REGION
name|OBJ_REGION
block|,
DECL|enumerator|OBJ_PALETTE
name|OBJ_PALETTE
DECL|typedef|ObjectType
block|}
name|ObjectType
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650508
block|{
DECL|member|dummy
name|int
name|dummy
decl_stmt|;
DECL|typedef|BitmapObject
block|}
name|BitmapObject
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650608
block|{
DECL|member|color
name|GdkColor
name|color
decl_stmt|;
DECL|member|invisible
name|gboolean
name|invisible
decl_stmt|;
DECL|member|style
name|guint
name|style
decl_stmt|;
DECL|member|hatch
name|glong
name|hatch
decl_stmt|;
DECL|typedef|BrushObject
block|}
name|BrushObject
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650708
block|{
DECL|member|dummy
name|int
name|dummy
decl_stmt|;
DECL|typedef|PatternBrushObject
block|}
name|PatternBrushObject
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650808
block|{
DECL|member|color
name|GdkColor
name|color
decl_stmt|;
DECL|member|invisible
name|gboolean
name|invisible
decl_stmt|;
DECL|member|width
name|gushort
name|width
decl_stmt|;
DECL|member|style
name|GdkLineStyle
name|style
decl_stmt|;
DECL|typedef|PenObject
block|}
name|PenObject
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650908
block|{
DECL|member|font
name|GdkFont
modifier|*
name|font
decl_stmt|;
DECL|typedef|FontObject
block|}
name|FontObject
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650a08
block|{
DECL|member|dummy
name|int
name|dummy
decl_stmt|;
DECL|typedef|PaletteObject
block|}
name|PaletteObject
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650b08
block|{
DECL|member|type
name|ObjectType
name|type
decl_stmt|;
union|union
DECL|union|__anon2b5cae650c0a
block|{
DECL|member|bitmap
name|BitmapObject
name|bitmap
decl_stmt|;
DECL|member|brush
name|BrushObject
name|brush
decl_stmt|;
DECL|member|pbrush
name|PatternBrushObject
name|pbrush
decl_stmt|;
DECL|member|pen
name|PenObject
name|pen
decl_stmt|;
DECL|member|font
name|FontObject
name|font
decl_stmt|;
DECL|member|palette
name|PaletteObject
name|palette
decl_stmt|;
DECL|member|u
block|}
name|u
union|;
DECL|typedef|Object
block|}
name|Object
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650d08
block|{
DECL|member|gc
name|GdkGC
modifier|*
name|gc
decl_stmt|;
DECL|member|bg
name|GdkColor
name|bg
decl_stmt|;
DECL|member|brush
name|BrushObject
modifier|*
name|brush
decl_stmt|;
DECL|member|pen
name|PenObject
modifier|*
name|pen
decl_stmt|;
DECL|member|font
name|FontObject
modifier|*
name|font
decl_stmt|;
DECL|member|textColor
name|GdkColor
name|textColor
decl_stmt|;
DECL|member|tag
name|gint
name|tag
decl_stmt|;
DECL|typedef|DC
block|}
name|DC
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|saved_dc_tag
specifier|static
name|gint
name|saved_dc_tag
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650e08
block|{
DECL|member|pixmap
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
DECL|member|dc
name|DC
name|dc
decl_stmt|;
DECL|member|dc_stack
name|GSList
modifier|*
name|dc_stack
decl_stmt|;
DECL|member|colormap
name|GdkColormap
modifier|*
name|colormap
decl_stmt|;
DECL|member|width
DECL|member|height
name|guint
name|width
decl_stmt|,
name|height
decl_stmt|;
DECL|member|scalex
DECL|member|scaley
name|double
name|scalex
decl_stmt|,
name|scaley
decl_stmt|;
DECL|member|curx
DECL|member|cury
name|double
name|curx
decl_stmt|,
name|cury
decl_stmt|;
DECL|typedef|Canvas
block|}
name|Canvas
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2b5cae650f08
block|{
DECL|member|valid
name|gboolean
name|valid
decl_stmt|;
DECL|member|org_x
DECL|member|org_y
name|gint
name|org_x
decl_stmt|,
name|org_y
decl_stmt|;
DECL|member|ext_x
DECL|member|ext_y
name|gint
name|ext_x
decl_stmt|,
name|ext_y
decl_stmt|;
DECL|typedef|OrgAndExt
block|}
name|OrgAndExt
typedef|;
end_typedef

begin_function_decl
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint32
name|load_image
parameter_list|(
name|gchar
modifier|*
name|filename
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|readparams
parameter_list|(
name|DWORD
name|size
parameter_list|,
name|guint
name|nparams
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|,
name|WORD
modifier|*
name|params
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|sync_record
parameter_list|(
name|DWORD
name|size
parameter_list|,
name|guint
name|nparams
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
comment|/* init_proc  */
name|NULL
block|,
comment|/* quit_proc  */
name|query
block|,
comment|/* query_proc */
name|run
block|,
comment|/* run_proc   */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|l_run_mode
specifier|static
name|GimpRunModeType
name|l_run_mode
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pixs_per_in
specifier|static
name|int
name|pixs_per_in
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|load_ok_callback (GtkWidget * widget,gpointer data)
name|load_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|LoadDialogVals
modifier|*
name|vals
init|=
operator|(
name|LoadDialogVals
operator|*
operator|)
name|data
decl_stmt|;
comment|/* Read scale */
name|load_vals
operator|.
name|scale
operator|=
name|pow
argument_list|(
literal|2.0
argument_list|,
name|vals
operator|->
name|scale
operator|->
name|value
argument_list|)
expr_stmt|;
name|load_interface
operator|.
name|run
operator|=
name|TRUE
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|vals
operator|->
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|load_dialog (gchar * file_name)
name|load_dialog
parameter_list|(
name|gchar
modifier|*
name|file_name
parameter_list|)
block|{
name|LoadDialogVals
modifier|*
name|vals
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|slider
decl_stmt|;
name|gimp_ui_init
argument_list|(
literal|"wmf"
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|vals
operator|=
name|g_new
argument_list|(
name|LoadDialogVals
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vals
operator|->
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Load Windows Metafile"
argument_list|)
argument_list|,
literal|"wmf"
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"filters/wmf.html"
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"OK"
argument_list|)
argument_list|,
name|load_ok_callback
argument_list|,
name|vals
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
name|gtk_widget_destroy
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vals
operator|->
name|dialog
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_main_quit
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Rendering */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Rendering %s"
argument_list|)
argument_list|,
name|file_name
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|vals
operator|->
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
comment|/* Scale label */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Scale (log 2):"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* Scale slider */
name|vals
operator|->
name|scale
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
operator|-
literal|2.0
argument_list|,
literal|2.0
argument_list|,
literal|0.2
argument_list|,
literal|0.2
argument_list|,
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|vals
operator|->
name|scale
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vals
operator|->
name|dialog
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
name|g_free
argument_list|(
name|vals
argument_list|)
expr_stmt|;
return|return
name|load_interface
operator|.
name|run
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|check_load_vals (void)
name|check_load_vals
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|load_vals
operator|.
name|scale
operator|<
literal|0.01
condition|)
name|load_vals
operator|.
name|scale
operator|=
literal|0.01
expr_stmt|;
elseif|else
if|if
condition|(
name|load_vals
operator|.
name|scale
operator|>
literal|100.
condition|)
name|load_vals
operator|.
name|scale
operator|=
literal|100.
expr_stmt|;
block|}
end_function

begin_macro
DECL|function|MAIN ()
name|MAIN
argument_list|()
end_macro

begin_function
specifier|static
name|void
name|query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GimpParamDef
name|load_args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run_mode"
block|,
literal|"Interactive, non-interactive"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to load"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"raw_filename"
block|,
literal|"The name entered"
block|}
block|}
decl_stmt|;
specifier|static
name|gint
name|nload_args
init|=
sizeof|sizeof
argument_list|(
name|load_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|load_args
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
specifier|static
name|GimpParamDef
name|load_return_vals
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Output image"
block|}
block|}
decl_stmt|;
specifier|static
name|gint
name|nload_return_vals
init|=
operator|(
sizeof|sizeof
argument_list|(
name|load_return_vals
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|load_return_vals
index|[
literal|0
index|]
argument_list|)
operator|)
decl_stmt|;
specifier|static
name|GimpParamDef
name|load_setargs_args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"scale"
block|,
literal|"Scale in which to load image"
block|}
block|}
decl_stmt|;
specifier|static
name|gint
name|nload_setargs_args
init|=
operator|(
sizeof|sizeof
argument_list|(
name|load_setargs_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|load_setargs_args
index|[
literal|0
index|]
argument_list|)
operator|)
decl_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"file_wmf_load"
argument_list|,
literal|"loads files of the Windows(tm) metafile file format"
argument_list|,
literal|"FIXME: write help for file_wmf_load"
argument_list|,
literal|"Tor Lillqvist<tml@iki.fi>"
argument_list|,
literal|"Tor Lillqvist"
argument_list|,
literal|"1998"
argument_list|,
literal|"<Load>/WMF"
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|nload_args
argument_list|,
name|nload_return_vals
argument_list|,
name|load_args
argument_list|,
name|load_return_vals
argument_list|)
expr_stmt|;
name|gimp_install_procedure
argument_list|(
literal|"file_wmf_load_setargs"
argument_list|,
literal|"set additional parameters for the procedure file_wmf_load"
argument_list|,
literal|"set additional parameters for the procedure file_wmf_load"
argument_list|,
literal|"Tor Lillqvist<tml@iki.fi>"
argument_list|,
literal|"Tor Lillqvist"
argument_list|,
literal|"1998"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|nload_setargs_args
argument_list|,
literal|0
argument_list|,
name|load_setargs_args
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_register_magic_load_handler
argument_list|(
literal|"file_wmf_load"
argument_list|,
literal|"wmf,apm"
argument_list|,
literal|""
argument_list|,
literal|"0,string,\\327\\315\\306\\232"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|run (gchar * name,gint nparams,GimpParam * param,gint * nreturn_vals,GimpParam ** return_vals)
name|run
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|nparams
parameter_list|,
name|GimpParam
modifier|*
name|param
parameter_list|,
name|gint
modifier|*
name|nreturn_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
specifier|static
name|GimpParam
name|values
index|[
literal|2
index|]
decl_stmt|;
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
name|gint32
name|image_ID
decl_stmt|;
name|l_run_mode
operator|=
name|param
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|values
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"file_wmf_load"
argument_list|)
operator|==
literal|0
condition|)
block|{
switch|switch
condition|(
name|l_run_mode
condition|)
block|{
case|case
name|GIMP_RUN_INTERACTIVE
case|:
name|INIT_I18N_UI
argument_list|()
expr_stmt|;
name|gimp_get_data
argument_list|(
literal|"file_wmf_load"
argument_list|,
operator|&
name|load_vals
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|load_dialog
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|)
condition|)
name|status
operator|=
name|GIMP_PDB_CANCEL
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_NONINTERACTIVE
case|:
name|INIT_I18N
argument_list|()
expr_stmt|;
name|gimp_get_data
argument_list|(
literal|"file_wmf_load"
argument_list|,
operator|&
name|load_vals
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_WITH_LAST_VALS
case|:
name|INIT_I18N
argument_list|()
expr_stmt|;
name|gimp_get_data
argument_list|(
literal|"file_wmf_load"
argument_list|,
operator|&
name|load_vals
argument_list|)
expr_stmt|;
default|default:
break|break;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
condition|)
block|{
name|check_load_vals
argument_list|()
expr_stmt|;
name|image_ID
operator|=
name|load_image
argument_list|(
name|param
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_string
argument_list|)
expr_stmt|;
if|if
condition|(
name|image_ID
operator|!=
operator|-
literal|1
condition|)
block|{
name|gimp_set_data
argument_list|(
literal|"file_wmf_load"
argument_list|,
operator|&
name|load_vals
argument_list|,
sizeof|sizeof
argument_list|(
name|load_vals
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|nreturn_vals
operator|=
literal|2
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_IMAGE
expr_stmt|;
name|values
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
operator|=
name|image_ID
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
name|values
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|Object
modifier|*
DECL|function|new_object (ObjectType type,Object ** objects,const int nobjects)
name|new_object
parameter_list|(
name|ObjectType
name|type
parameter_list|,
name|Object
modifier|*
modifier|*
name|objects
parameter_list|,
specifier|const
name|int
name|nobjects
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|Object
modifier|*
name|result
init|=
name|NULL
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nobjects
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|objects
index|[
name|i
index|]
operator|==
name|NULL
condition|)
block|{
name|objects
index|[
name|i
index|]
operator|=
name|result
operator|=
name|g_new
argument_list|(
name|Object
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|result
operator|->
name|type
operator|=
name|type
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|i
operator|==
name|nobjects
condition|)
name|g_message
argument_list|(
literal|"WMF: Creating too many objects"
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
specifier|static
name|Canvas
modifier|*
DECL|function|make_canvas (OrgAndExt * window,OrgAndExt * viewport,gboolean have_bbox,GdkRectangle * bbox,guint units_per_in)
name|make_canvas
parameter_list|(
name|OrgAndExt
modifier|*
name|window
parameter_list|,
name|OrgAndExt
modifier|*
name|viewport
parameter_list|,
name|gboolean
name|have_bbox
parameter_list|,
name|GdkRectangle
modifier|*
name|bbox
parameter_list|,
name|guint
name|units_per_in
parameter_list|)
block|{
name|Canvas
modifier|*
name|canvas
init|=
name|g_new
argument_list|(
name|Canvas
argument_list|,
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|window
operator|->
name|valid
condition|)
block|{
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"make_canvas: !window->valid\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|have_bbox
condition|)
block|{
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"make_canvas: have_bbox\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|window
operator|->
name|org_x
operator|=
name|bbox
operator|->
name|x
expr_stmt|;
name|window
operator|->
name|ext_x
operator|=
name|bbox
operator|->
name|width
expr_stmt|;
name|window
operator|->
name|org_y
operator|=
name|bbox
operator|->
name|y
expr_stmt|;
name|window
operator|->
name|ext_y
operator|=
name|bbox
operator|->
name|height
expr_stmt|;
block|}
else|else
block|{
name|window
operator|->
name|org_x
operator|=
name|window
operator|->
name|org_y
operator|=
literal|0
expr_stmt|;
comment|/* Just pick a size. */
name|window
operator|->
name|ext_x
operator|=
name|units_per_in
operator|*
literal|4
expr_stmt|;
name|window
operator|->
name|ext_y
operator|=
name|units_per_in
operator|*
literal|3
expr_stmt|;
block|}
name|window
operator|->
name|valid
operator|=
name|TRUE
expr_stmt|;
block|}
name|canvas
operator|->
name|scalex
operator|=
name|canvas
operator|->
name|scaley
operator|=
name|load_vals
operator|.
name|scale
expr_stmt|;
if|if
condition|(
operator|!
name|viewport
operator|->
name|valid
condition|)
block|{
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"make_canvas: !viewport->valid\n"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|viewport
operator|->
name|org_x
operator|=
name|viewport
operator|->
name|org_y
operator|=
literal|0
expr_stmt|;
name|viewport
operator|->
name|ext_x
operator|=
name|canvas
operator|->
name|scalex
operator|*
name|fabs
argument_list|(
name|window
operator|->
name|ext_x
argument_list|)
operator|/
name|units_per_in
operator|*
name|pixs_per_in
expr_stmt|;
name|viewport
operator|->
name|ext_y
operator|=
name|canvas
operator|->
name|scaley
operator|*
name|fabs
argument_list|(
name|window
operator|->
name|ext_y
argument_list|)
operator|/
name|units_per_in
operator|*
name|pixs_per_in
expr_stmt|;
name|viewport
operator|->
name|valid
operator|=
name|TRUE
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"make_canvas: w: (%d,%d)--(%d,%d), vp: (%d,%d)--(%d,%d)\n"
argument_list|,
name|window
operator|->
name|org_x
argument_list|,
name|window
operator|->
name|org_y
argument_list|,
name|window
operator|->
name|org_x
operator|+
name|window
operator|->
name|ext_x
argument_list|,
name|window
operator|->
name|org_y
operator|+
name|window
operator|->
name|ext_y
argument_list|,
name|viewport
operator|->
name|org_x
argument_list|,
name|viewport
operator|->
name|org_y
argument_list|,
name|viewport
operator|->
name|org_x
operator|+
name|viewport
operator|->
name|ext_x
argument_list|,
name|viewport
operator|->
name|org_y
operator|+
name|viewport
operator|->
name|ext_y
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|canvas
operator|->
name|colormap
operator|=
name|gdk_colormap_get_system
argument_list|()
expr_stmt|;
name|canvas
operator|->
name|width
operator|=
name|viewport
operator|->
name|ext_x
expr_stmt|;
name|canvas
operator|->
name|height
operator|=
name|viewport
operator|->
name|ext_y
expr_stmt|;
name|canvas
operator|->
name|pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|NULL
argument_list|,
name|viewport
operator|->
name|ext_x
argument_list|,
name|viewport
operator|->
name|ext_y
argument_list|,
name|gdk_visual_get_system
argument_list|()
operator|->
name|depth
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|gc
operator|=
name|gdk_gc_new
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|bg
operator|.
name|red
operator|=
name|canvas
operator|->
name|dc
operator|.
name|bg
operator|.
name|green
operator|=
name|canvas
operator|->
name|dc
operator|.
name|bg
operator|.
name|blue
operator|=
literal|0xFFFF
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|bg
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|=
name|g_new
argument_list|(
name|BrushObject
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|invisible
operator|=
name|FALSE
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
operator|.
name|red
operator|=
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
operator|.
name|green
operator|=
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
operator|.
name|blue
operator|=
literal|0xFFFF
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|=
name|g_new
argument_list|(
name|PenObject
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|invisible
operator|=
name|FALSE
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
operator|.
name|red
operator|=
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
operator|.
name|green
operator|=
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|font
operator|=
name|g_new
argument_list|(
name|FontObject
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|font
operator|->
name|font
operator|=
name|gdk_font_load
argument_list|(
literal|"-adobe-helvetica-medium-r-normal--*-120-*-*-*-*-*-*"
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|textColor
operator|.
name|red
operator|=
name|canvas
operator|->
name|dc
operator|.
name|textColor
operator|.
name|green
operator|=
name|canvas
operator|->
name|dc
operator|.
name|textColor
operator|.
name|blue
operator|=
literal|0
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|textColor
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc_stack
operator|=
name|g_slist_alloc
argument_list|()
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|viewport
operator|->
name|ext_x
argument_list|,
name|viewport
operator|->
name|ext_y
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|curx
operator|=
name|canvas
operator|->
name|cury
operator|=
literal|0.0
expr_stmt|;
return|return
name|canvas
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|set_color (WORD * params,GdkColor * color)
name|set_color
parameter_list|(
name|WORD
modifier|*
name|params
parameter_list|,
name|GdkColor
modifier|*
name|color
parameter_list|)
block|{
name|color
operator|->
name|red
operator|=
operator|(
operator|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
operator|&
literal|0x00FF
operator|)
operator|*
literal|65535
operator|)
operator|/
literal|255
expr_stmt|;
name|color
operator|->
name|green
operator|=
operator|(
operator|(
operator|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
operator|&
literal|0xFF00
operator|)
operator|>>
literal|8
operator|)
operator|*
literal|65535
operator|)
operator|/
literal|255
expr_stmt|;
name|color
operator|->
name|blue
operator|=
operator|(
operator|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
operator|&
literal|0x00FF
operator|)
operator|*
literal|65535
operator|)
operator|/
literal|255
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint32
DECL|function|load_image (char * filename)
name|load_image
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|FILE
modifier|*
name|fp
decl_stmt|;
name|char
modifier|*
name|name_buf
decl_stmt|;
name|guchar
name|buffer
index|[
literal|100
index|]
decl_stmt|;
name|gboolean
name|warned_unhandled
init|=
name|FALSE
decl_stmt|;
name|gboolean
name|warned_opaque
init|=
name|FALSE
decl_stmt|;
name|gboolean
name|warned_orientation
init|=
name|FALSE
decl_stmt|;
name|WMFHEAD
name|wmf_head
decl_stmt|;
name|PLACEABLEMETAHEADER
name|apm_head
decl_stmt|;
name|WMFRECORD
name|record
decl_stmt|;
name|WORD
name|params
index|[
name|NPARMWORDS
index|]
decl_stmt|;
name|Object
modifier|*
modifier|*
name|objects
decl_stmt|,
modifier|*
name|objp
init|=
name|NULL
decl_stmt|;
name|guint
name|nobjects
decl_stmt|;
name|guint
name|units_per_in
decl_stmt|;
name|guint
name|i
decl_stmt|,
name|j
decl_stmt|,
name|jj
decl_stmt|,
name|k
decl_stmt|;
name|gint
name|ix
decl_stmt|;
name|guchar
modifier|*
name|string
decl_stmt|;
name|guint
name|record_counter
init|=
literal|0
decl_stmt|;
name|GdkRectangle
name|bbox
decl_stmt|;
name|gboolean
name|have_bbox
init|=
name|FALSE
decl_stmt|;
name|OrgAndExt
name|window
decl_stmt|,
name|viewport
decl_stmt|;
DECL|macro|XSCALE (value)
define|#
directive|define
name|XSCALE
parameter_list|(
name|value
parameter_list|)
value|((value) * (double) viewport.ext_x / window.ext_x)
DECL|macro|YSCALE (value)
define|#
directive|define
name|YSCALE
parameter_list|(
name|value
parameter_list|)
value|((value) * (double) viewport.ext_y / window.ext_y)
DECL|macro|XMAPPAR (param)
define|#
directive|define
name|XMAPPAR
parameter_list|(
name|param
parameter_list|)
value|(XSCALE (GINT16_FROM_LE (param) - window.org_x) + viewport.org_x)
DECL|macro|YMAPPAR (param)
define|#
directive|define
name|YMAPPAR
parameter_list|(
name|param
parameter_list|)
value|(YSCALE (GINT16_FROM_LE (param) - window.org_y) + viewport.org_y)
DECL|macro|XMAPPARPLUS1 (param)
define|#
directive|define
name|XMAPPARPLUS1
parameter_list|(
name|param
parameter_list|)
value|(XSCALE ((GINT16_FROM_LE (param) + 1) - window.org_x) + viewport.org_x)
DECL|macro|YMAPPARPLUS1 (param)
define|#
directive|define
name|YMAPPARPLUS1
parameter_list|(
name|param
parameter_list|)
value|(YSCALE ((GINT16_FROM_LE (param) + 1) - window.org_y) + viewport.org_y)
DECL|macro|XIMAPPAR (param)
define|#
directive|define
name|XIMAPPAR
parameter_list|(
name|param
parameter_list|)
value|((gint) XMAPPAR (param))
DECL|macro|YIMAPPAR (param)
define|#
directive|define
name|YIMAPPAR
parameter_list|(
name|param
parameter_list|)
value|((gint) YMAPPAR (param))
DECL|macro|XIMAPPARPLUS1 (param)
define|#
directive|define
name|XIMAPPARPLUS1
parameter_list|(
name|param
parameter_list|)
value|((gint) XMAPPARPLUS1 (param))
DECL|macro|YIMAPPARPLUS1 (param)
define|#
directive|define
name|YIMAPPARPLUS1
parameter_list|(
name|param
parameter_list|)
value|((gint) YMAPPARPLUS1 (param))
name|Canvas
modifier|*
name|canvas
init|=
name|NULL
decl_stmt|;
name|GdkGCValues
name|gc_values
decl_stmt|;
name|DC
modifier|*
name|dc
decl_stmt|;
name|GdkVisual
modifier|*
name|visual
decl_stmt|;
name|GdkPoint
modifier|*
name|points
decl_stmt|;
name|double
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guint
name|npoints
decl_stmt|;
name|guint
name|npolys
decl_stmt|;
name|guint
modifier|*
name|nppoints
decl_stmt|;
name|GdkImage
modifier|*
name|image
decl_stmt|;
name|guint
name|options
decl_stmt|;
name|GimpPixelRgn
name|pixel_rgn
decl_stmt|;
name|gint32
name|image_ID
init|=
operator|-
literal|1
decl_stmt|;
name|gint32
name|layer_ID
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|guchar
modifier|*
name|pixelp
decl_stmt|;
name|gulong
name|pixel
decl_stmt|;
name|guint
name|start
decl_stmt|,
name|end
decl_stmt|,
name|scanlines
decl_stmt|;
name|guchar
modifier|*
name|buf
decl_stmt|,
modifier|*
name|bufp
decl_stmt|;
name|GdkColor
modifier|*
name|colors
decl_stmt|;
name|guchar
modifier|*
name|rtbl
decl_stmt|,
modifier|*
name|gtbl
decl_stmt|,
modifier|*
name|btbl
decl_stmt|;
name|guint
name|rmask
decl_stmt|,
name|gmask
decl_stmt|,
name|bmask
decl_stmt|,
name|rshift
decl_stmt|,
name|gshift
decl_stmt|,
name|bshift
decl_stmt|;
name|int
name|argc
decl_stmt|;
name|char
modifier|*
modifier|*
name|argv
decl_stmt|;
name|argc
operator|=
literal|1
expr_stmt|;
name|argv
operator|=
name|g_new
argument_list|(
name|char
operator|*
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|argv
index|[
literal|0
index|]
operator|=
name|g_strdup
argument_list|(
literal|"wmf"
argument_list|)
expr_stmt|;
name|gdk_init
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"rb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: can't open \"%s\""
argument_list|,
name|filename
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|name_buf
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Interpreting %s:"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|gimp_progress_init
argument_list|(
name|name_buf
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name_buf
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ReadOK
argument_list|(
name|fp
argument_list|,
name|buffer
argument_list|,
name|SIZE_WMFHEAD
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Failed to read metafile header"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|g_memmove
argument_list|(
operator|&
name|apm_head
operator|.
name|Key
argument_list|,
name|buffer
argument_list|,
literal|4
argument_list|)
expr_stmt|;
if|if
condition|(
name|GUINT32_FROM_LE
argument_list|(
name|apm_head
operator|.
name|Key
argument_list|)
operator|==
literal|0x9ac6cdd7
condition|)
block|{
if|if
condition|(
operator|!
name|ReadOK
argument_list|(
name|fp
argument_list|,
name|buffer
operator|+
name|SIZE_WMFHEAD
argument_list|,
name|SIZE_PLACEABLEMETAHEADER
operator|-
name|SIZE_WMFHEAD
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Failed to read placeable metafile header"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|g_memmove
argument_list|(
operator|&
name|apm_head
operator|.
name|Left
argument_list|,
name|buffer
operator|+
literal|6
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|g_memmove
argument_list|(
operator|&
name|apm_head
operator|.
name|Top
argument_list|,
name|buffer
operator|+
literal|8
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|g_memmove
argument_list|(
operator|&
name|apm_head
operator|.
name|Right
argument_list|,
name|buffer
operator|+
literal|10
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|g_memmove
argument_list|(
operator|&
name|apm_head
operator|.
name|Bottom
argument_list|,
name|buffer
operator|+
literal|12
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|g_memmove
argument_list|(
operator|&
name|apm_head
operator|.
name|Inch
argument_list|,
name|buffer
operator|+
literal|14
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|bbox
operator|.
name|x
operator|=
name|GINT16_FROM_LE
argument_list|(
name|apm_head
operator|.
name|Left
argument_list|)
expr_stmt|;
name|bbox
operator|.
name|y
operator|=
name|GINT16_FROM_LE
argument_list|(
name|apm_head
operator|.
name|Top
argument_list|)
expr_stmt|;
name|bbox
operator|.
name|width
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|apm_head
operator|.
name|Right
argument_list|)
operator|-
name|bbox
operator|.
name|x
expr_stmt|;
name|bbox
operator|.
name|height
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|apm_head
operator|.
name|Bottom
argument_list|)
operator|-
name|bbox
operator|.
name|y
expr_stmt|;
name|have_bbox
operator|=
name|TRUE
expr_stmt|;
name|units_per_in
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|apm_head
operator|.
name|Inch
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"placeable metafile header: (%d,%d)--(%d,%d), bbox: %dx%d@+%d+%d\n"
argument_list|,
name|apm_head
operator|.
name|Left
argument_list|,
name|apm_head
operator|.
name|Top
argument_list|,
name|apm_head
operator|.
name|Right
argument_list|,
name|apm_head
operator|.
name|Bottom
argument_list|,
name|bbox
operator|.
name|width
argument_list|,
name|bbox
operator|.
name|height
argument_list|,
name|bbox
operator|.
name|x
argument_list|,
name|bbox
operator|.
name|y
argument_list|)
expr_stmt|;
name|g_print
argument_list|(
literal|"units_per_in: %d\n"
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|ReadOK
argument_list|(
name|fp
argument_list|,
name|buffer
argument_list|,
name|SIZE_WMFHEAD
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Failed to read metafile header"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
else|else
block|{
name|units_per_in
operator|=
literal|1440
expr_stmt|;
block|}
name|viewport
operator|.
name|org_x
operator|=
name|viewport
operator|.
name|org_y
operator|=
literal|0
expr_stmt|;
name|viewport
operator|.
name|valid
operator|=
name|FALSE
expr_stmt|;
name|window
operator|.
name|org_x
operator|=
name|window
operator|.
name|org_y
operator|=
literal|0
expr_stmt|;
name|window
operator|.
name|valid
operator|=
name|FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_FEATURES_1_1_2
name|pixs_per_in
operator|=
call|(
name|int
call|)
argument_list|(
literal|25.4
operator|*
name|gdk_screen_width
argument_list|()
operator|/
name|gdk_screen_width_mm
argument_list|()
argument_list|)
expr_stmt|;
else|#
directive|else
name|pixs_per_in
operator|=
literal|72
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"pixs_per_in: %d\n"
argument_list|,
name|pixs_per_in
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|g_memmove
argument_list|(
operator|&
name|wmf_head
operator|.
name|Version
argument_list|,
name|buffer
operator|+
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|g_memmove
argument_list|(
operator|&
name|wmf_head
operator|.
name|FileSize
argument_list|,
name|buffer
operator|+
literal|6
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|g_memmove
argument_list|(
operator|&
name|wmf_head
operator|.
name|NumOfObjects
argument_list|,
name|buffer
operator|+
literal|10
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
name|GUINT16_FROM_LE
argument_list|(
name|wmf_head
operator|.
name|Version
argument_list|)
operator|!=
literal|0x0300
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Metafile has wrong version, got %#x, expected 0x300"
argument_list|,
name|GUINT16_FROM_LE
argument_list|(
name|wmf_head
operator|.
name|Version
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|nobjects
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|wmf_head
operator|.
name|NumOfObjects
argument_list|)
expr_stmt|;
name|objects
operator|=
name|g_new
argument_list|(
name|Object
operator|*
argument_list|,
name|nobjects
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nobjects
condition|;
name|i
operator|++
control|)
name|objects
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
literal|1
condition|)
block|{
if|if
condition|(
operator|!
name|ReadOK
argument_list|(
name|fp
argument_list|,
name|buffer
argument_list|,
name|SIZE_WMFRECORD
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Failed to read metafile record"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|g_memmove
argument_list|(
operator|&
name|record
operator|.
name|Size
argument_list|,
name|buffer
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|g_memmove
argument_list|(
operator|&
name|record
operator|.
name|Function
argument_list|,
name|buffer
operator|+
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|record_counter
operator|++
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"%#x %d\n"
argument_list|,
name|GUINT16_FROM_LE
argument_list|(
name|record
operator|.
name|Function
argument_list|)
argument_list|,
name|GUINT32_FROM_LE
argument_list|(
name|record
operator|.
name|Size
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
switch|switch
condition|(
name|GUINT16_FROM_LE
argument_list|(
name|record
operator|.
name|Function
argument_list|)
condition|)
block|{
case|case
name|SetWindowOrg
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|window
operator|.
name|org_y
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|window
operator|.
name|org_x
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetViewportOrg
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|viewport
operator|.
name|org_y
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|viewport
operator|.
name|org_x
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetWindowExt
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|window
operator|.
name|ext_y
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|window
operator|.
name|ext_x
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|window
operator|.
name|valid
operator|=
name|TRUE
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetViewportExt
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|viewport
operator|.
name|ext_y
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|viewport
operator|.
name|ext_x
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|viewport
operator|.
name|valid
operator|=
name|TRUE
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|IntersectClipRect
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SaveDC
case|:
name|dc
operator|=
name|g_new
argument_list|(
name|DC
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
operator|*
name|dc
operator|=
name|canvas
operator|->
name|dc
expr_stmt|;
name|dc
operator|->
name|gc
operator|=
name|gdk_gc_new
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|)
expr_stmt|;
name|dc
operator|->
name|tag
operator|=
name|saved_dc_tag
operator|++
expr_stmt|;
name|gdk_gc_copy
argument_list|(
name|dc
operator|->
name|gc
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|)
expr_stmt|;
name|gdk_font_ref
argument_list|(
name|dc
operator|->
name|font
operator|->
name|font
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc_stack
operator|=
name|g_slist_prepend
argument_list|(
name|canvas
operator|->
name|dc_stack
argument_list|,
name|dc
argument_list|)
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|0
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|RestoreDC
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|ix
operator|=
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|ix
operator|>=
literal|0
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: RestoreDC with positive argument (%d)?"
argument_list|,
name|ix
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
name|ix
operator|++
operator|<
literal|0
condition|)
block|{
if|if
condition|(
name|canvas
operator|->
name|dc_stack
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: DC stack underflow"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gdk_gc_unref
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|)
expr_stmt|;
name|gdk_font_unref
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|font
operator|->
name|font
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|=
operator|*
operator|(
operator|(
name|DC
operator|*
operator|)
name|canvas
operator|->
name|dc_stack
operator|->
name|data
operator|)
expr_stmt|;
name|canvas
operator|->
name|dc_stack
operator|=
name|g_slist_next
argument_list|(
name|canvas
operator|->
name|dc_stack
argument_list|)
expr_stmt|;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetBkColor
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|set_color
argument_list|(
name|params
operator|+
literal|0
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|bg
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"SetBkColor: %d %d %d\n"
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|bg
operator|.
name|red
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|bg
operator|.
name|green
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|bg
operator|.
name|blue
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|bg
argument_list|)
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Couldn't allocate color"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"...allocated color %#.06lx\n"
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|bg
operator|.
name|pixel
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetBkMode
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
switch|switch
condition|(
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
case|case
name|TRANSPARENT
case|:
break|break;
case|case
name|OPAQUE
case|:
if|if
condition|(
operator|!
name|warned_opaque
condition|)
block|{
name|g_message
argument_list|(
literal|"The WMF file contains SetBkMode (OPAQUE).\n"
literal|"This is not supported, sorry. The resulting\n"
literal|"image might not look quite right."
argument_list|)
expr_stmt|;
name|warned_opaque
operator|=
name|TRUE
expr_stmt|;
block|}
break|break;
default|default:
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Invalid case %d at line %d"
argument_list|,
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
break|break;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetTextColor
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|set_color
argument_list|(
name|params
operator|+
literal|0
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|textColor
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"SetTextColor: %d %d %d\n"
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|textColor
operator|.
name|red
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|textColor
operator|.
name|green
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|textColor
operator|.
name|blue
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|textColor
argument_list|)
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Couldn't allocate color"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"...allocated color %#.06lx\n"
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|textColor
operator|.
name|pixel
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetTextAlign
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetROP2
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
case|case
name|R2_COPYPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_COPY
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_NOT
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_INVERT
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_XORPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_XOR
argument_list|)
expr_stmt|;
break|break;
ifdef|#
directive|ifdef
name|GDK_CLEAR
comment|/* Other ROPs not in gdk 1.0 */
case|case
name|R2_BLACK
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_CLEAR
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_MASKPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_AND
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_MASKPENNOT
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_AND_REVERSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_MASKNOTPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_AND_INVERT
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_NOP
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_NOOP
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_MERGEPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_OR
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_NOTXORPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_EQUIV
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_MERGEPENNOT
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_OR_REVERSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_NOTCOPYPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_COPY_INVERT
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_MERGENOTPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_OR_INVERT
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_NOTMASKPEN
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_NAND
argument_list|)
expr_stmt|;
break|break;
case|case
name|R2_WHITE
case|:
name|gdk_gc_set_function
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|GDK_SET
argument_list|)
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"Invalid ROP2"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetStretchBltMode
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetPolyFillMode
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
comment|/* GDK has no way to set the fill rule of a GdkGC! */
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetMapMode
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
switch|switch
condition|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
case|case
name|MM_ANISOTROPIC
case|:
case|case
name|MM_ISOTROPIC
case|:
break|break;
case|case
name|MM_HIENGLISH
case|:
name|units_per_in
operator|=
literal|1000
expr_stmt|;
goto|goto
name|set_window_and_viewport
goto|;
case|case
name|MM_HIMETRIC
case|:
name|units_per_in
operator|=
literal|2540
expr_stmt|;
goto|goto
name|set_window_and_viewport
goto|;
case|case
name|MM_LOENGLISH
case|:
name|units_per_in
operator|=
literal|100
expr_stmt|;
goto|goto
name|set_window_and_viewport
goto|;
case|case
name|MM_LOMETRIC
case|:
name|units_per_in
operator|=
literal|254
expr_stmt|;
goto|goto
name|set_window_and_viewport
goto|;
case|case
name|MM_TEXT
case|:
name|units_per_in
operator|=
name|pixs_per_in
expr_stmt|;
goto|goto
name|set_window_and_viewport
goto|;
case|case
name|MM_TWIPS
case|:
name|units_per_in
operator|=
literal|1440
expr_stmt|;
name|set_window_and_viewport
label|:
name|window
operator|.
name|valid
operator|=
name|TRUE
expr_stmt|;
name|viewport
operator|.
name|valid
operator|=
name|TRUE
expr_stmt|;
name|window
operator|.
name|org_x
operator|=
name|window
operator|.
name|org_y
operator|=
name|viewport
operator|.
name|org_x
operator|=
name|viewport
operator|.
name|org_y
operator|=
literal|0
expr_stmt|;
name|window
operator|.
name|ext_x
operator|=
name|units_per_in
operator|*
literal|4
expr_stmt|;
name|window
operator|.
name|ext_y
operator|=
name|units_per_in
operator|*
literal|3
expr_stmt|;
name|viewport
operator|.
name|ext_x
operator|=
name|load_vals
operator|.
name|scale
operator|*
name|fabs
argument_list|(
name|window
operator|.
name|ext_x
argument_list|)
operator|/
name|units_per_in
operator|*
name|pixs_per_in
expr_stmt|;
name|viewport
operator|.
name|ext_y
operator|=
name|load_vals
operator|.
name|scale
operator|*
name|fabs
argument_list|(
name|window
operator|.
name|ext_y
argument_list|)
operator|/
name|units_per_in
operator|*
name|pixs_per_in
expr_stmt|;
break|break;
default|default:
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Invalid case %d at line %d"
argument_list|,
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SetRelabs
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CreatePenIndirect
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|5
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|(
name|objp
operator|=
name|new_object
argument_list|(
name|OBJ_PEN
argument_list|,
name|objects
argument_list|,
name|nobjects
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|invisible
operator|=
name|FALSE
expr_stmt|;
switch|switch
condition|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
condition|)
block|{
case|case
name|PS_SOLID
case|:
case|case
name|PS_INSIDEFRAME
case|:
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|style
operator|=
name|GDK_LINE_SOLID
expr_stmt|;
break|break;
case|case
name|PS_DASH
case|:
case|case
name|PS_DOT
case|:
case|case
name|PS_DASHDOT
case|:
case|case
name|PS_DASHDOTDOT
case|:
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|style
operator|=
name|GDK_LINE_ON_OFF_DASH
expr_stmt|;
break|break;
case|case
name|PS_NULL
case|:
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|style
operator|=
name|GDK_LINE_SOLID
expr_stmt|;
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|invisible
operator|=
name|TRUE
expr_stmt|;
break|break;
default|default:
name|g_message
argument_list|(
literal|"WMF: Unrecognized pen style %#x"
argument_list|,
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|width
operator|=
operator|(
name|int
operator|)
name|XSCALE
argument_list|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
operator|+
operator|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
operator|<<
literal|16
operator|)
argument_list|)
expr_stmt|;
name|set_color
argument_list|(
name|params
operator|+
literal|3
argument_list|,
operator|&
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|color
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"CreatePenIndirect: %#x width %d%s %s color: %d %d %d\n"
argument_list|,
name|objp
argument_list|,
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|width
argument_list|,
operator|(
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|invisible
condition|?
literal|" invisible"
else|:
literal|""
operator|)
argument_list|,
operator|(
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|style
operator|==
name|GDK_LINE_SOLID
condition|?
literal|"solid"
else|:
operator|(
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|style
operator|==
name|GDK_LINE_ON_OFF_DASH
condition|?
literal|"on-off-dash"
else|:
operator|(
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|style
operator|==
name|GDK_LINE_DOUBLE_DASH
condition|?
literal|"double-dash"
else|:
literal|"???"
operator|)
operator|)
operator|)
argument_list|,
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|color
operator|.
name|red
argument_list|,
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|color
operator|.
name|green
argument_list|,
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|color
operator|.
name|blue
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|color
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Couldn't allocate color"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"...allocated color %#.06lx\n"
argument_list|,
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|color
operator|.
name|pixel
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* CreatePenIndirect records sometimes have junk padding? */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|5
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CreateBrushIndirect
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|(
name|objp
operator|=
name|new_object
argument_list|(
name|OBJ_BRUSH
argument_list|,
name|objects
argument_list|,
name|nobjects
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|style
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|invisible
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|style
operator|==
name|BS_NULL
condition|)
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|invisible
operator|=
name|TRUE
expr_stmt|;
name|set_color
argument_list|(
name|params
operator|+
literal|1
argument_list|,
operator|&
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|color
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"CreateBrushIndirect: %#x%s color: %d %d %d\n"
argument_list|,
name|objp
argument_list|,
operator|(
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|invisible
condition|?
literal|" invisible"
else|:
literal|""
operator|)
argument_list|,
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|color
operator|.
name|red
argument_list|,
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|color
operator|.
name|green
argument_list|,
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|color
operator|.
name|blue
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gdk_color_alloc
argument_list|(
name|canvas
operator|->
name|colormap
argument_list|,
operator|&
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|color
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Couldn't allocate color"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"...allocated color %#.06lx\n"
argument_list|,
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|color
operator|.
name|pixel
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|objp
operator|->
name|u
operator|.
name|brush
operator|.
name|hatch
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DibCreatePatternBrush
case|:
if|if
condition|(
operator|(
name|objp
operator|=
name|new_object
argument_list|(
name|OBJ_PATTERNBRUSH
argument_list|,
name|objects
argument_list|,
name|nobjects
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"DibCreatePatternBrush: %#x\n"
argument_list|,
name|objp
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Ignored for now */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|0
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CreatePalette
case|:
if|if
condition|(
operator|(
name|objp
operator|=
name|new_object
argument_list|(
name|OBJ_PALETTE
argument_list|,
name|objects
argument_list|,
name|nobjects
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"CreatePalette: %#x\n"
argument_list|,
name|objp
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|0
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|CreateFontIndirect
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|9
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
operator|(
name|objp
operator|=
name|new_object
argument_list|(
name|OBJ_FONT
argument_list|,
name|objects
argument_list|,
name|nobjects
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
block|{
name|gint
name|height
decl_stmt|,
name|orientation
decl_stmt|,
name|weight
decl_stmt|,
name|italic
decl_stmt|,
name|pitch_family
decl_stmt|;
name|char
modifier|*
name|pitch
decl_stmt|,
modifier|*
name|slant
decl_stmt|,
modifier|*
name|fontname
decl_stmt|,
modifier|*
name|name
decl_stmt|,
modifier|*
name|name2
decl_stmt|;
name|height
operator|=
name|ABS
argument_list|(
name|GINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|height
operator|==
literal|0
condition|)
name|height
operator|=
literal|12
expr_stmt|;
comment|/* Orientation ignored for now. GDK doesn't support 	     * tilted text anyway. We could of course rotate it by hand. 	     */
name|orientation
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|orientation
operator|!=
literal|0
operator|&&
operator|!
name|warned_orientation
condition|)
block|{
name|g_message
argument_list|(
literal|"The WMF file contains non-horizontal fonts.\n"
literal|"This is not supported, sorry. The resulting\n"
literal|"image will not look quite right."
argument_list|)
expr_stmt|;
name|warned_orientation
operator|=
name|TRUE
expr_stmt|;
block|}
name|weight
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|italic
operator|=
operator|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|5
index|]
argument_list|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
if|#
directive|if
literal|0
block|pitch_family = ((GUINT16_FROM_LE (params[8])>> 8)& 0xFF);
else|#
directive|else
name|pitch_family
operator|=
operator|(
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|8
index|]
argument_list|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|(
name|pitch_family
operator|&
literal|0x03
operator|)
operator|==
literal|1
condition|)
name|pitch
operator|=
literal|"m"
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|pitch_family
operator|&
literal|0x03
operator|)
operator|==
literal|2
condition|)
name|pitch
operator|=
literal|"p"
expr_stmt|;
else|else
name|pitch
operator|=
literal|"*"
expr_stmt|;
if|if
condition|(
name|italic
condition|)
block|{
if|if
condition|(
operator|(
name|pitch_family
operator|&
literal|0x3
operator|)
operator|==
literal|1
condition|)
name|slant
operator|=
literal|"o"
expr_stmt|;
else|else
name|slant
operator|=
literal|"i"
expr_stmt|;
block|}
else|else
name|slant
operator|=
literal|"r"
expr_stmt|;
name|k
operator|=
name|GUINT32_FROM_LE
argument_list|(
name|record
operator|.
name|Size
argument_list|)
operator|-
literal|9
operator|-
name|WORDSIZE_WMFRECORD
expr_stmt|;
name|name
operator|=
name|g_malloc
argument_list|(
name|k
operator|*
literal|2
operator|+
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|k
operator|*
literal|2
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|name
index|[
name|i
index|]
operator|=
operator|(
name|params
index|[
literal|0
index|]
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
else|else
name|name
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|params
index|[
literal|0
index|]
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
name|name
index|[
name|k
operator|*
literal|2
index|]
operator|=
literal|'\0'
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"CreateFontIndirect: %#x %s\n"
argument_list|,
name|objp
argument_list|,
name|name
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* Very rough mapping from typical Windows fonts to 	     * typical X11 fonts. If you run GIMP on Win32, 	     * they will be mapped back to typical Windows 	     * fonts, sigh... 	     */
name|g_strdown
argument_list|(
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"system"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|name
argument_list|,
literal|"fixedsys"
argument_list|)
operator|==
literal|0
condition|)
name|name2
operator|=
literal|"courier"
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|name
argument_list|,
literal|"arial"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
name|name2
operator|=
literal|"helvetica"
expr_stmt|;
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|name
argument_list|,
literal|"courier"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
name|name2
operator|=
literal|"courier"
expr_stmt|;
else|else
name|name2
operator|=
name|name
expr_stmt|;
name|fontname
operator|=
name|g_strdup_printf
argument_list|(
literal|"-*-%s-%s-%s-%s-*-%d-*-*-*-%s-*-*-*"
argument_list|,
name|name2
argument_list|,
operator|(
name|weight
operator|>=
literal|700
condition|?
literal|"bold"
else|:
operator|(
name|weight
operator|>=
literal|400
condition|?
literal|"medium"
else|:
literal|"*"
operator|)
operator|)
argument_list|,
name|slant
argument_list|,
literal|"*"
argument_list|,
operator|(
name|int
operator|)
name|YSCALE
argument_list|(
name|height
argument_list|)
argument_list|,
name|pitch
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"...XLFD font: %s\n"
argument_list|,
name|fontname
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|objp
operator|->
name|u
operator|.
name|font
operator|.
name|font
operator|=
name|gdk_font_load
argument_list|(
name|fontname
argument_list|)
expr_stmt|;
if|if
condition|(
name|objp
operator|->
name|u
operator|.
name|font
operator|.
name|font
operator|==
name|NULL
condition|)
block|{
name|g_free
argument_list|(
name|fontname
argument_list|)
expr_stmt|;
name|fontname
operator|=
name|g_strdup_printf
argument_list|(
literal|"-*-%s-%s-%s-%s-*-%d-*-*-*-%s-*-*-*"
argument_list|,
literal|"*"
argument_list|,
operator|(
name|weight
operator|>=
literal|700
condition|?
literal|"bold"
else|:
operator|(
name|weight
operator|>=
literal|400
condition|?
literal|"medium"
else|:
literal|"*"
operator|)
operator|)
argument_list|,
literal|"*"
argument_list|,
literal|"*"
argument_list|,
operator|(
name|int
operator|)
name|YSCALE
argument_list|(
name|height
argument_list|)
argument_list|,
literal|"*"
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"...another XLFD font: %s\n"
argument_list|,
name|fontname
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|objp
operator|->
name|u
operator|.
name|font
operator|.
name|font
operator|=
name|gdk_font_load
argument_list|(
name|fontname
argument_list|)
expr_stmt|;
if|if
condition|(
name|objp
operator|->
name|u
operator|.
name|font
operator|.
name|font
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Cannot load suitable font, not even %s"
argument_list|,
name|fontname
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|fontname
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SelectObject
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|k
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|k
operator|>=
name|nobjects
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Selecting out of bounds object index"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|objp
operator|=
name|objects
index|[
name|k
index|]
expr_stmt|;
if|if
condition|(
name|objp
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Selecting NULL object"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"SelectObject: %#x %s\n"
argument_list|,
name|objp
argument_list|,
operator|(
name|objp
operator|->
name|type
operator|==
name|OBJ_BRUSH
condition|?
literal|"brush"
else|:
operator|(
name|objp
operator|->
name|type
operator|==
name|OBJ_PEN
condition|?
literal|"pen"
else|:
operator|(
name|objp
operator|->
name|type
operator|==
name|OBJ_PATTERNBRUSH
condition|?
literal|"patternbrush"
else|:
operator|(
name|objp
operator|->
name|type
operator|==
name|OBJ_FONT
condition|?
literal|"font"
else|:
literal|"???"
operator|)
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
switch|switch
condition|(
name|objp
operator|->
name|type
condition|)
block|{
case|case
name|OBJ_BRUSH
case|:
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|=
operator|&
name|objp
operator|->
name|u
operator|.
name|brush
expr_stmt|;
break|break;
case|case
name|OBJ_PEN
case|:
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|=
operator|&
name|objp
operator|->
name|u
operator|.
name|pen
expr_stmt|;
name|gdk_gc_get_values
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|gc_values
argument_list|)
expr_stmt|;
name|gdk_gc_set_line_attributes
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|width
argument_list|,
name|objp
operator|->
name|u
operator|.
name|pen
operator|.
name|style
argument_list|,
name|gc_values
operator|.
name|cap_style
argument_list|,
name|gc_values
operator|.
name|join_style
argument_list|)
expr_stmt|;
break|break;
case|case
name|OBJ_PATTERNBRUSH
case|:
comment|/* XXX */
break|break;
case|case
name|OBJ_FONT
case|:
name|gdk_font_unref
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|font
operator|->
name|font
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|dc
operator|.
name|font
operator|=
operator|&
name|objp
operator|->
name|u
operator|.
name|font
expr_stmt|;
name|gdk_font_ref
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|font
operator|->
name|font
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Unhandled case %d at line %d"
argument_list|,
name|objp
operator|->
name|type
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|SelectPalette
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|k
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|k
operator|>=
name|nobjects
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Selecting out of bounds palette index"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|objp
operator|=
name|objects
index|[
name|k
index|]
expr_stmt|;
if|if
condition|(
name|objp
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Selecting NULL palette"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|objp
operator|->
name|type
operator|!=
name|OBJ_PALETTE
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: SelectPalette selects non-palette"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|RealizePalette
case|:
comment|/* XXX */
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|0
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|DeleteObject
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|k
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|k
operator|>=
name|nobjects
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Deleting out of bounds object index"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|objp
operator|=
name|objects
index|[
name|k
index|]
expr_stmt|;
if|if
condition|(
name|objp
operator|==
name|NULL
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Deleting already deleted object"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
if|if
condition|(
name|objp
operator|->
name|type
operator|==
name|OBJ_FONT
condition|)
name|gdk_font_unref
argument_list|(
name|objp
operator|->
name|u
operator|.
name|font
operator|.
name|font
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|objp
argument_list|)
expr_stmt|;
name|objects
index|[
name|k
index|]
operator|=
name|NULL
expr_stmt|;
break|break;
case|case
name|MoveTo
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|curx
operator|=
name|XMAPPAR
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|cury
operator|=
name|YMAPPAR
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|LineTo
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|x
operator|=
name|XMAPPAR
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|y
operator|=
name|YMAPPAR
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG
name|g_print
argument_list|(
literal|"LineTo: (%d,%d)--(%d,%d)\n"
argument_list|,
operator|(
name|gint
operator|)
name|canvas
operator|->
name|curx
argument_list|,
operator|(
name|gint
operator|)
name|canvas
operator|->
name|cury
argument_list|,
operator|(
name|gint
operator|)
name|x
argument_list|,
operator|(
name|gint
operator|)
name|y
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|(
name|gint
operator|)
name|canvas
operator|->
name|curx
argument_list|,
operator|(
name|gint
operator|)
name|canvas
operator|->
name|cury
argument_list|,
operator|(
name|gint
operator|)
name|x
argument_list|,
operator|(
name|gint
operator|)
name|y
argument_list|)
expr_stmt|;
name|canvas
operator|->
name|curx
operator|=
name|x
expr_stmt|;
name|canvas
operator|->
name|cury
operator|=
name|y
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|Polyline
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|npoints
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|points
operator|=
name|g_new
argument_list|(
name|GdkPoint
argument_list|,
name|npoints
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|npoints
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|points
index|[
name|i
index|]
operator|.
name|x
operator|=
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|points
index|[
name|i
index|]
operator|.
name|y
operator|=
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_lines
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|points
argument_list|,
name|npoints
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|points
argument_list|)
expr_stmt|;
break|break;
case|case
name|Rectangle
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|TRUE
argument_list|,
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|XIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
operator|-
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
operator|-
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|FALSE
argument_list|,
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|XIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
operator|-
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
operator|-
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|Ellipse
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_arc
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|TRUE
argument_list|,
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|XIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
operator|-
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
operator|-
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|360
operator|*
literal|64
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_arc
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|FALSE
argument_list|,
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|XIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
operator|-
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
argument_list|,
name|YIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
operator|-
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|360
operator|*
literal|64
argument_list|)
expr_stmt|;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|Polygon
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|npoints
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|points
operator|=
name|g_new
argument_list|(
name|GdkPoint
argument_list|,
name|npoints
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|npoints
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|points
index|[
name|i
index|]
operator|.
name|x
operator|=
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|points
index|[
name|i
index|]
operator|.
name|y
operator|=
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_polygon
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|TRUE
argument_list|,
name|points
argument_list|,
name|npoints
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_polygon
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|FALSE
argument_list|,
name|points
argument_list|,
name|npoints
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|points
argument_list|)
expr_stmt|;
break|break;
case|case
name|PolyPolygon
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|canvas
operator|==
name|NULL
condition|)
name|canvas
operator|=
name|make_canvas
argument_list|(
operator|&
name|window
argument_list|,
operator|&
name|viewport
argument_list|,
name|have_bbox
argument_list|,
operator|&
name|bbox
argument_list|,
name|units_per_in
argument_list|)
expr_stmt|;
comment|/* Number of polygons */
name|npolys
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|nppoints
operator|=
name|g_new
argument_list|(
name|guint
argument_list|,
name|npolys
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|npolys
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|nppoints
index|[
name|i
index|]
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|npolys
condition|;
name|i
operator|++
control|)
block|{
name|points
operator|=
name|g_new
argument_list|(
name|GdkPoint
argument_list|,
name|nppoints
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|nppoints
index|[
name|i
index|]
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|points
index|[
name|j
index|]
operator|.
name|x
operator|=
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|points
index|[
name|j
index|]
operator|.
name|y
operator|=
name|YIMAPPAR
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|brush
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_polygon
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|TRUE
argument_list|,
name|points
argument_list|,
name|nppoints
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|invisible
condition|)
block|{
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|pen
operator|->
name|color
argument_list|)
expr_stmt|;
name|gdk_draw_polygon
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|TRUE
argument_list|,
name|points
argument_list|,
name|nppoints
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|points
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|nppoints
argument_list|)
expr_stmt|;
break|break;
case|case
name|TextOut
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|k
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|string
operator|=
name|g_malloc
argument_list|(
name|k
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|k
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|j
operator|++
expr_stmt|;
name|string
index|[
name|i
index|]
operator|=
operator|(
name|params
index|[
literal|0
index|]
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
else|else
name|string
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|params
index|[
literal|0
index|]
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|x
operator|=
name|XMAPPAR
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|y
operator|=
name|YMAPPAR
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|textColor
argument_list|)
expr_stmt|;
name|gdk_draw_text
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|font
operator|->
name|font
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|(
name|gint
operator|)
name|x
argument_list|,
operator|(
name|gint
operator|)
name|y
argument_list|,
name|string
argument_list|,
name|k
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|string
argument_list|)
expr_stmt|;
break|break;
case|case
name|ExtTextOut
case|:
if|if
condition|(
operator|!
name|readparams
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
comment|/* Count extra words read */
name|j
operator|=
literal|4
expr_stmt|;
name|x
operator|=
name|XMAPPAR
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|y
operator|=
name|YMAPPAR
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
comment|/* String length */
name|k
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|options
operator|=
name|GUINT16_FROM_LE
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
comment|/* Clipping or opaquing? */
if|if
condition|(
operator|(
name|options
operator|&
literal|0x04
operator|)
operator|||
operator|(
name|options
operator|&
literal|0x02
operator|)
condition|)
block|{
name|GdkRectangle
name|r
decl_stmt|;
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|4
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|j
operator|+=
literal|4
expr_stmt|;
name|r
operator|.
name|x
operator|=
name|XIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|r
operator|.
name|y
operator|=
name|YIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|r
operator|.
name|width
operator|=
name|XIMAPPAR
argument_list|(
name|params
index|[
literal|2
index|]
argument_list|)
operator|-
name|r
operator|.
name|x
expr_stmt|;
name|r
operator|.
name|height
operator|=
name|YIMAPPARPLUS1
argument_list|(
name|params
index|[
literal|3
index|]
argument_list|)
operator|-
name|r
operator|.
name|y
expr_stmt|;
if|if
condition|(
name|options
operator|&
literal|0x04
condition|)
name|gdk_gc_set_clip_rectangle
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|r
argument_list|)
expr_stmt|;
block|}
name|string
operator|=
name|g_malloc
argument_list|(
name|k
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|k
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|i
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|readparams
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|fp
argument_list|,
name|params
argument_list|)
condition|)
return|return
operator|-
literal|1
return|;
name|j
operator|++
expr_stmt|;
name|string
index|[
name|i
index|]
operator|=
operator|(
name|params
index|[
literal|0
index|]
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
else|else
name|string
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|params
index|[
literal|0
index|]
operator|>>
literal|8
operator|)
operator|&
literal|0xFF
operator|)
expr_stmt|;
block|}
name|gdk_gc_set_foreground
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|&
name|canvas
operator|->
name|dc
operator|.
name|textColor
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|/* ExtTextOut records can have an optional list of distances 	   * between characters. But as we don't have the exact same font 	   * metrics anyway, we ignore it. 	   */
block|if (j< GUINT16_FROM_LE (record.Size)) 	    for (i = 0; i< k; i++) 	      { 		gdk_draw_text (canvas->pixmap, canvas->dc.font->font, 			       canvas->dc.gc, (gint) x, (gint) y, 			       string + i, 1); 		if (j< GUINT16_FROM_LE (record.Size)) 		  { 		    if (!readparams (0, 1, fp, params)) 		      return -1; 		    j++; 		  } 		x += XSCALE (GINT16_FROM_LE (params[0])); 	      } 	  else
endif|#
directive|endif
name|gdk_draw_text
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|font
operator|->
name|font
argument_list|,
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
operator|(
name|gint
operator|)
name|x
argument_list|,
operator|(
name|gint
operator|)
name|y
operator|+
name|canvas
operator|->
name|dc
operator|.
name|font
operator|->
name|font
operator|->
name|ascent
argument_list|,
name|string
argument_list|,
name|k
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|options
operator|&
literal|0x04
condition|)
name|gdk_gc_set_clip_rectangle
argument_list|(
name|canvas
operator|->
name|dc
operator|.
name|gc
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
name|j
argument_list|,
name|fp
argument_list|)
expr_stmt|;
break|break;
case|case
name|EndOfFile
case|:
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|gimp_progress_update
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|canvas
operator|->
name|height
operator|>=
literal|100
condition|)
name|gimp_progress_init
argument_list|(
name|_
argument_list|(
literal|"Transferring image"
argument_list|)
argument_list|)
expr_stmt|;
name|image_ID
operator|=
name|gimp_image_new
argument_list|(
name|canvas
operator|->
name|width
argument_list|,
name|canvas
operator|->
name|height
argument_list|,
name|GIMP_RGB
argument_list|)
expr_stmt|;
name|gimp_image_set_filename
argument_list|(
name|image_ID
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|layer_ID
operator|=
name|gimp_layer_new
argument_list|(
name|image_ID
argument_list|,
name|_
argument_list|(
literal|"Background"
argument_list|)
argument_list|,
name|canvas
operator|->
name|width
argument_list|,
name|canvas
operator|->
name|height
argument_list|,
name|GIMP_RGB_IMAGE
argument_list|,
literal|100
argument_list|,
name|GIMP_NORMAL_MODE
argument_list|)
expr_stmt|;
name|gimp_image_add_layer
argument_list|(
name|image_ID
argument_list|,
name|layer_ID
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|layer_ID
argument_list|)
expr_stmt|;
name|image
operator|=
name|gdk_image_get
argument_list|(
name|canvas
operator|->
name|pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|canvas
operator|->
name|width
argument_list|,
name|canvas
operator|->
name|height
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|pixel_rgn
argument_list|,
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|drawable
operator|->
name|width
argument_list|,
name|drawable
operator|->
name|height
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|pixel_rgn
operator|.
name|bpp
operator|!=
literal|3
condition|)
name|abort
argument_list|()
expr_stmt|;
name|visual
operator|=
name|gdk_visual_get_system
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|visual
operator|->
name|type
condition|)
block|{
case|case
name|GDK_VISUAL_PSEUDO_COLOR
case|:
name|buf
operator|=
name|g_malloc
argument_list|(
name|gimp_tile_height
argument_list|()
operator|*
name|canvas
operator|->
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
name|colors
operator|=
name|canvas
operator|->
name|colormap
operator|->
name|colors
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|canvas
operator|->
name|height
condition|;
control|)
block|{
name|start
operator|=
name|j
expr_stmt|;
name|end
operator|=
name|MIN
argument_list|(
name|j
operator|+
name|gimp_tile_height
argument_list|()
argument_list|,
name|canvas
operator|->
name|height
argument_list|)
expr_stmt|;
name|scanlines
operator|=
name|end
operator|-
name|start
expr_stmt|;
name|bufp
operator|=
name|buf
expr_stmt|;
for|for
control|(
name|jj
operator|=
literal|0
init|;
name|jj
operator|<
name|scanlines
condition|;
name|jj
operator|++
control|)
block|{
name|pixelp
operator|=
operator|(
operator|(
name|guchar
operator|*
operator|)
name|image
operator|->
name|mem
operator|)
operator|+
operator|(
name|j
operator|+
name|jj
operator|)
operator|*
name|image
operator|->
name|bpl
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|canvas
operator|->
name|width
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|bufp
operator|++
operator|=
name|colors
index|[
operator|*
name|pixelp
index|]
operator|.
name|red
operator|>>
literal|8
expr_stmt|;
operator|*
name|bufp
operator|++
operator|=
name|colors
index|[
operator|*
name|pixelp
index|]
operator|.
name|green
operator|>>
literal|8
expr_stmt|;
operator|*
name|bufp
operator|++
operator|=
name|colors
index|[
operator|*
name|pixelp
index|]
operator|.
name|blue
operator|>>
literal|8
expr_stmt|;
name|pixelp
operator|++
expr_stmt|;
block|}
block|}
name|gimp_pixel_rgn_set_rect
argument_list|(
operator|&
name|pixel_rgn
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|j
argument_list|,
name|canvas
operator|->
name|width
argument_list|,
name|scanlines
argument_list|)
expr_stmt|;
if|if
condition|(
name|canvas
operator|->
name|height
operator|>=
literal|100
condition|)
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|j
operator|/
name|canvas
operator|->
name|height
argument_list|)
expr_stmt|;
name|j
operator|+=
name|scanlines
expr_stmt|;
block|}
if|if
condition|(
name|canvas
operator|->
name|height
operator|>=
literal|100
condition|)
name|gimp_progress_update
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_VISUAL_TRUE_COLOR
case|:
name|buf
operator|=
name|g_malloc
argument_list|(
name|gimp_tile_height
argument_list|()
operator|*
name|canvas
operator|->
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
comment|/* Set up mappings from subfield ranges to full 0..255 range */
name|k
operator|=
literal|1
operator|<<
name|visual
operator|->
name|red_prec
expr_stmt|;
name|rtbl
operator|=
name|g_malloc
argument_list|(
name|k
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|k
condition|;
name|i
operator|++
control|)
name|rtbl
index|[
name|i
index|]
operator|=
operator|(
name|i
operator|*
literal|255
operator|)
operator|/
operator|(
name|k
operator|-
literal|1
operator|)
expr_stmt|;
name|k
operator|=
literal|1
operator|<<
name|visual
operator|->
name|green_prec
expr_stmt|;
name|gtbl
operator|=
name|g_malloc
argument_list|(
name|k
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|k
condition|;
name|i
operator|++
control|)
name|gtbl
index|[
name|i
index|]
operator|=
operator|(
name|i
operator|*
literal|255
operator|)
operator|/
operator|(
name|k
operator|-
literal|1
operator|)
expr_stmt|;
name|k
operator|=
literal|1
operator|<<
name|visual
operator|->
name|blue_prec
expr_stmt|;
name|btbl
operator|=
name|g_malloc
argument_list|(
name|k
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|k
condition|;
name|i
operator|++
control|)
name|btbl
index|[
name|i
index|]
operator|=
operator|(
name|i
operator|*
literal|255
operator|)
operator|/
operator|(
name|k
operator|-
literal|1
operator|)
expr_stmt|;
if|#
directive|if
literal|0
block|g_print ("R: %.08x, %d, %d\n", visual->red_mask, visual->red_shift, visual->red_prec); 	      g_print ("G: %.08x, %d, %d\n", visual->green_mask, visual->green_shift, visual->green_prec); 	      g_print ("B: %.08x, %d, %d\n", visual->blue_mask, visual->blue_shift, visual->blue_prec); 	      g_print ("byte order: %s\n", (visual->byte_order == GDK_LSB_FIRST ? "LSB_FIRST" : (visual->byte_order == GDK_MSB_FIRST ? "MSB_FIRST" : "???")));
endif|#
directive|endif
name|rmask
operator|=
name|visual
operator|->
name|red_mask
expr_stmt|;
name|gmask
operator|=
name|visual
operator|->
name|green_mask
expr_stmt|;
name|bmask
operator|=
name|visual
operator|->
name|blue_mask
expr_stmt|;
name|rshift
operator|=
name|visual
operator|->
name|red_shift
expr_stmt|;
name|gshift
operator|=
name|visual
operator|->
name|green_shift
expr_stmt|;
name|bshift
operator|=
name|visual
operator|->
name|blue_shift
expr_stmt|;
if|if
condition|(
operator|(
name|image
operator|->
name|depth
operator|>
literal|8
operator|&&
name|image
operator|->
name|bpp
operator|==
literal|1
operator|)
operator|||
name|image
operator|->
name|bpp
operator|>
literal|4
condition|)
block|{
comment|/* Workaround for bugs in GDK */
if|if
condition|(
name|image
operator|->
name|bpp
operator|>
literal|4
condition|)
comment|/* GDK has set image->bpp to bits-per-pixel, 		     * correct it to bytes-per-pixel. 		     */
name|image
operator|->
name|bpp
operator|=
operator|(
name|image
operator|->
name|bpp
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
elseif|else
if|if
condition|(
name|image
operator|->
name|depth
operator|>
literal|24
condition|)
name|image
operator|->
name|bpp
operator|=
literal|4
expr_stmt|;
elseif|else
if|if
condition|(
name|image
operator|->
name|depth
operator|>
literal|16
condition|)
name|image
operator|->
name|bpp
operator|=
literal|3
expr_stmt|;
else|else
name|image
operator|->
name|bpp
operator|=
literal|2
expr_stmt|;
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|canvas
operator|->
name|height
condition|;
control|)
block|{
name|start
operator|=
name|j
expr_stmt|;
name|end
operator|=
name|MIN
argument_list|(
name|j
operator|+
name|gimp_tile_height
argument_list|()
argument_list|,
name|canvas
operator|->
name|height
argument_list|)
expr_stmt|;
name|scanlines
operator|=
name|end
operator|-
name|start
expr_stmt|;
name|bufp
operator|=
name|buf
expr_stmt|;
for|for
control|(
name|jj
operator|=
literal|0
init|;
name|jj
operator|<
name|scanlines
condition|;
name|jj
operator|++
control|)
block|{
name|pixelp
operator|=
operator|(
operator|(
name|guchar
operator|*
operator|)
name|image
operator|->
name|mem
operator|)
operator|+
operator|(
name|j
operator|+
name|jj
operator|)
operator|*
name|image
operator|->
name|bpl
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|canvas
operator|->
name|width
condition|;
name|i
operator|++
control|)
block|{
name|pixel
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|visual
operator|->
name|byte_order
operator|==
name|GDK_LSB_FIRST
condition|)
if|#
directive|if
literal|1
block|{
name|k
operator|=
name|image
operator|->
name|bpp
operator|-
literal|1
expr_stmt|;
switch|switch
condition|(
name|k
condition|)
block|{
case|case
literal|3
case|:
name|pixel
operator||=
operator|(
name|pixelp
index|[
literal|3
index|]
operator|<<
literal|24
operator|)
expr_stmt|;
comment|/* Fallthrough on purpose */
case|case
literal|2
case|:
name|pixel
operator||=
operator|(
name|pixelp
index|[
literal|2
index|]
operator|<<
literal|16
operator|)
expr_stmt|;
comment|/* ditto */
case|case
literal|1
case|:
name|pixel
operator||=
operator|(
name|pixelp
index|[
literal|1
index|]
operator|<<
literal|8
operator|)
expr_stmt|;
comment|/* ditto */
case|case
literal|0
case|:
name|pixel
operator||=
operator|(
name|pixelp
index|[
literal|0
index|]
operator|)
expr_stmt|;
block|}
block|}
else|#
directive|else
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|image
operator|->
name|bpp
condition|;
name|k
operator|++
control|)
name|pixel
operator||=
operator|(
name|pixelp
index|[
name|k
index|]
operator|<<
operator|(
name|k
operator|*
literal|8
operator|)
operator|)
expr_stmt|;
endif|#
directive|endif
else|else
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|image
operator|->
name|bpp
condition|;
name|k
operator|++
control|)
name|pixel
operator||=
operator|(
name|pixelp
index|[
name|image
operator|->
name|bpp
operator|-
name|k
operator|-
literal|1
index|]
operator|<<
operator|(
name|k
operator|*
literal|8
operator|)
operator|)
expr_stmt|;
operator|*
name|bufp
operator|++
operator|=
name|rtbl
index|[
operator|(
name|pixel
operator|&
name|rmask
operator|)
operator|>>
name|rshift
index|]
expr_stmt|;
operator|*
name|bufp
operator|++
operator|=
name|gtbl
index|[
operator|(
name|pixel
operator|&
name|gmask
operator|)
operator|>>
name|gshift
index|]
expr_stmt|;
operator|*
name|bufp
operator|++
operator|=
name|btbl
index|[
operator|(
name|pixel
operator|&
name|bmask
operator|)
operator|>>
name|bshift
index|]
expr_stmt|;
name|pixelp
operator|+=
name|image
operator|->
name|bpp
expr_stmt|;
block|}
block|}
name|gimp_pixel_rgn_set_rect
argument_list|(
operator|&
name|pixel_rgn
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|j
argument_list|,
name|canvas
operator|->
name|width
argument_list|,
name|scanlines
argument_list|)
expr_stmt|;
if|if
condition|(
name|canvas
operator|->
name|height
operator|>=
literal|100
condition|)
name|gimp_progress_update
argument_list|(
operator|(
name|double
operator|)
name|j
operator|/
name|canvas
operator|->
name|height
argument_list|)
expr_stmt|;
name|j
operator|+=
name|scanlines
expr_stmt|;
block|}
if|if
condition|(
name|canvas
operator|->
name|height
operator|>=
literal|100
condition|)
name|gimp_progress_update
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|buf
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|rtbl
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gtbl
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|btbl
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_message
argument_list|(
literal|"Unsupported image visual"
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|gimp_drawable_flush
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
return|return
name|image_ID
return|;
default|default:
if|if
condition|(
operator|!
name|warned_unhandled
condition|)
block|{
name|g_message
argument_list|(
literal|"WMF: Unhandled operation %#x. Check the web page\n"
literal|"http://www.iki.fi/tml/gimp/wmf/ for a possible new\n"
literal|"version of the wmf plug-in. (This is version %s).\n"
literal|"If you already have the latest version, please send\n"
literal|"the WMF file you tried to load to the wmf plug-in\n"
literal|"author, Tor Lillqvist<tml@iki.fi>, and he might\n"
literal|"try to add the missing feature. No promise that\n"
literal|"he has any interest any longer, of course."
argument_list|,
name|GUINT16_FROM_LE
argument_list|(
name|record
operator|.
name|Function
argument_list|)
argument_list|,
name|VERSION
argument_list|)
expr_stmt|;
name|warned_unhandled
operator|=
name|TRUE
expr_stmt|;
block|}
name|sync_record
argument_list|(
name|record
operator|.
name|Size
argument_list|,
literal|0
argument_list|,
name|fp
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|record_counter
operator|%
literal|10
operator|==
literal|0
condition|)
name|gimp_progress_update
argument_list|(
operator|(
operator|(
name|double
operator|)
name|ftell
argument_list|(
name|fp
argument_list|)
operator|/
literal|2
operator|)
operator|/
name|GUINT32_FROM_LE
argument_list|(
name|wmf_head
operator|.
name|FileSize
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/*NOTREACHED*/
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
name|image_ID
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|readparams (DWORD size,guint nparams,FILE * fp,WORD * params)
name|readparams
parameter_list|(
name|DWORD
name|size
parameter_list|,
name|guint
name|nparams
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|,
name|WORD
modifier|*
name|params
parameter_list|)
block|{
name|gulong
name|nwords
decl_stmt|;
if|if
condition|(
name|size
operator|!=
literal|0
condition|)
block|{
name|nwords
operator|=
name|GUINT32_FROM_LE
argument_list|(
name|size
argument_list|)
operator|-
name|WORDSIZE_WMFRECORD
expr_stmt|;
if|if
condition|(
name|nwords
operator|<
name|nparams
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: too small record?"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
if|if
condition|(
name|nparams
operator|>
name|NPARMWORDS
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: too large record?"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
if|if
condition|(
name|nparams
operator|>
literal|0
operator|&&
operator|!
name|ReadOK
argument_list|(
name|fp
argument_list|,
name|params
argument_list|,
name|nparams
operator|*
sizeof|sizeof
argument_list|(
name|WORD
argument_list|)
argument_list|)
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
name|g_message
argument_list|(
literal|"WMF: Read failed"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|sync_record (DWORD size,guint nparams,FILE * fp)
name|sync_record
parameter_list|(
name|DWORD
name|size
parameter_list|,
name|guint
name|nparams
parameter_list|,
name|FILE
modifier|*
name|fp
parameter_list|)
block|{
name|gulong
name|nwords
decl_stmt|;
name|nwords
operator|=
name|GUINT32_FROM_LE
argument_list|(
name|size
argument_list|)
operator|-
name|WORDSIZE_WMFRECORD
expr_stmt|;
if|if
condition|(
name|nwords
operator|>
name|nparams
condition|)
name|fseek
argument_list|(
name|fp
argument_list|,
operator|(
name|nwords
operator|-
name|nparams
operator|)
operator|*
literal|2
argument_list|,
name|SEEK_CUR
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

