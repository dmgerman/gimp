begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/*============================================================================*    Paper Tile 1.0  -- A GIMP PLUG-IN    Copyright (C) 1997-1999 Hirotsuna Mizuno<s1041150@u-aizu.ac.jp>    This program  is  free software:  you can redistribute it  and/or  modify it   under the terms of the GNU Public License as published  by the Free Software   Foundation;  either version 3 of the License,  or (at your option) any later   version.    This program is distributed in the hope that it will be useful,  but WITHOUT   ANY WARRANTY;  without  even  the  implied  warranty  of MERCHANTABILITY  or   FITNESS  FOR  A PARTICULAR PURPOSE.  See the GNU General Public License  for   more details.    You should have received a copy of the GNU General Public License along with   this program; if not, see<http://www.gnu.org/licenses/>.   *===========================================================================*/
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimp.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpui.h>
end_include

begin_include
include|#
directive|include
file|"libgimp/stdplugins-intl.h"
end_include

begin_comment
comment|/*===========================================================================*/
end_comment

begin_comment
comment|/* DEFINES                                                                   */
end_comment

begin_comment
comment|/*===========================================================================*/
end_comment

begin_define
DECL|macro|PLUG_IN_PROC
define|#
directive|define
name|PLUG_IN_PROC
value|"plug-in-papertile"
end_define

begin_define
DECL|macro|PLUG_IN_BINARY
define|#
directive|define
name|PLUG_IN_BINARY
value|"tile-paper"
end_define

begin_comment
comment|/*===========================================================================*/
end_comment

begin_comment
comment|/* TYPES                                                                     */
end_comment

begin_comment
comment|/*===========================================================================*/
end_comment

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2c12ea040103
block|{
DECL|enumerator|BACKGROUND_TYPE_TRANSPARENT
name|BACKGROUND_TYPE_TRANSPARENT
block|,
DECL|enumerator|BACKGROUND_TYPE_INVERTED
name|BACKGROUND_TYPE_INVERTED
block|,
DECL|enumerator|BACKGROUND_TYPE_IMAGE
name|BACKGROUND_TYPE_IMAGE
block|,
DECL|enumerator|BACKGROUND_TYPE_FOREGROUND
name|BACKGROUND_TYPE_FOREGROUND
block|,
DECL|enumerator|BACKGROUND_TYPE_BACKGROUND
name|BACKGROUND_TYPE_BACKGROUND
block|,
DECL|enumerator|BACKGROUND_TYPE_COLOR
name|BACKGROUND_TYPE_COLOR
DECL|typedef|BackgroundType
block|}
name|BackgroundType
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2c12ea040203
block|{
DECL|enumerator|FRACTIONAL_TYPE_BACKGROUND
name|FRACTIONAL_TYPE_BACKGROUND
block|,
comment|/* AS BACKGROUND */
DECL|enumerator|FRACTIONAL_TYPE_IGNORE
name|FRACTIONAL_TYPE_IGNORE
block|,
comment|/* NOT OPERATED  */
DECL|enumerator|FRACTIONAL_TYPE_FORCE
name|FRACTIONAL_TYPE_FORCE
comment|/* FORCE DIVISION */
DECL|typedef|FractionalType
block|}
name|FractionalType
typedef|;
end_typedef

begin_typedef
DECL|typedef|PluginParams
typedef|typedef
name|struct
name|_PluginParams
name|PluginParams
typedef|;
end_typedef

begin_struct
DECL|struct|_PluginParams
struct|struct
name|_PluginParams
block|{
DECL|member|tile_width
name|gint32
name|tile_width
decl_stmt|;
DECL|member|tile_height
name|gint32
name|tile_height
decl_stmt|;
DECL|member|division_x
name|gint32
name|division_x
decl_stmt|;
DECL|member|division_y
name|gint32
name|division_y
decl_stmt|;
DECL|member|move_max_rate
name|gdouble
name|move_max_rate
decl_stmt|;
DECL|member|fractional_type
name|FractionalType
name|fractional_type
decl_stmt|;
DECL|member|centering
name|gboolean
name|centering
decl_stmt|;
DECL|member|wrap_around
name|gboolean
name|wrap_around
decl_stmt|;
DECL|member|background_type
name|BackgroundType
name|background_type
decl_stmt|;
DECL|member|background_color
name|GimpRGB
name|background_color
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*===========================================================================*/
end_comment

begin_comment
comment|/* VARIABLES                                                                 */
end_comment

begin_comment
comment|/*===========================================================================*/
end_comment

begin_struct
specifier|static
struct|struct
DECL|struct|__anon2c12ea040308
block|{
DECL|member|params
name|PluginParams
name|params
decl_stmt|;
DECL|member|image
name|gint32
name|image
decl_stmt|;
DECL|member|drawable
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
DECL|member|drawable_has_alpha
name|gboolean
name|drawable_has_alpha
decl_stmt|;
struct|struct
DECL|struct|__anon2c12ea040408
block|{
DECL|member|x0
name|gint
name|x0
decl_stmt|;
DECL|member|y0
name|gint
name|y0
decl_stmt|;
DECL|member|x1
name|gint
name|x1
decl_stmt|;
DECL|member|y1
name|gint
name|y1
decl_stmt|;
DECL|member|width
name|gint
name|width
decl_stmt|;
DECL|member|height
name|gint
name|height
decl_stmt|;
DECL|member|selection
block|}
name|selection
struct|;
DECL|member|run_mode
name|GimpRunMode
name|run_mode
decl_stmt|;
DECL|member|run
name|gboolean
name|run
decl_stmt|;
DECL|variable|p
block|}
name|p
init|=
block|{
block|{
literal|1
block|,
comment|/* tile_width            */
literal|1
block|,
comment|/* tile_height           */
literal|16
block|,
comment|/* division_x            */
literal|16
block|,
comment|/* division_y            */
literal|25.0
block|,
comment|/* move_max_rate         */
name|FRACTIONAL_TYPE_BACKGROUND
block|,
comment|/* fractional_type       */
name|TRUE
block|,
comment|/* centering             */
name|FALSE
block|,
comment|/* wrap_around           */
name|BACKGROUND_TYPE_INVERTED
block|,
comment|/* background_type       */
block|{
literal|0.0
block|,
literal|0.0
block|,
literal|1.0
block|,
literal|1.0
block|}
comment|/* background_color      */
block|}
block|,
literal|0
block|,
comment|/* image                 */
name|NULL
block|,
comment|/* drawable              */
name|FALSE
block|,
comment|/* drawable_has_alpha    */
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
comment|/* selection             */
name|GIMP_RUN_INTERACTIVE
block|,
comment|/* run_mode              */
name|FALSE
comment|/* run                   */
block|}
struct|;
end_struct

begin_comment
comment|/*---------------------------------------------------------------------------*/
end_comment

begin_function
specifier|static
name|void
DECL|function|params_save_to_gimp (void)
name|params_save_to_gimp
parameter_list|(
name|void
parameter_list|)
block|{
name|gimp_set_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|p
operator|.
name|params
argument_list|,
sizeof|sizeof
name|p
operator|.
name|params
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|params_load_from_gimp (void)
name|params_load_from_gimp
parameter_list|(
name|void
parameter_list|)
block|{
name|gimp_get_data
argument_list|(
name|PLUG_IN_PROC
argument_list|,
operator|&
name|p
operator|.
name|params
argument_list|)
expr_stmt|;
if|if
condition|(
literal|0
operator|<
name|p
operator|.
name|params
operator|.
name|division_x
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|tile_width
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
operator|/
name|p
operator|.
name|params
operator|.
name|division_x
expr_stmt|;
if|if
condition|(
literal|0
operator|<
name|p
operator|.
name|params
operator|.
name|tile_width
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|division_y
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
operator|/
name|p
operator|.
name|params
operator|.
name|tile_height
expr_stmt|;
block|}
block|}
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|tile_width
operator|<=
literal|0
operator|||
name|p
operator|.
name|params
operator|.
name|tile_height
operator|<=
literal|0
operator|||
name|p
operator|.
name|params
operator|.
name|division_x
operator|<=
literal|0
operator|||
name|p
operator|.
name|params
operator|.
name|division_y
operator|<=
literal|0
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|tile_width
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|tile_height
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|division_x
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
operator|/
name|p
operator|.
name|params
operator|.
name|tile_width
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|division_y
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
operator|/
name|p
operator|.
name|params
operator|.
name|tile_height
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|p
operator|.
name|drawable_has_alpha
condition|)
block|{
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|background_type
operator|==
name|BACKGROUND_TYPE_TRANSPARENT
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|background_type
operator|=
name|BACKGROUND_TYPE_INVERTED
expr_stmt|;
block|}
name|gimp_rgb_set_alpha
argument_list|(
operator|&
name|p
operator|.
name|params
operator|.
name|background_color
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*===========================================================================*/
end_comment

begin_comment
comment|/* GUI                                                                       */
end_comment

begin_comment
comment|/*===========================================================================*/
end_comment

begin_struct
specifier|static
struct|struct
DECL|struct|__anon2c12ea040508
block|{
DECL|member|tile_width_adj
name|GtkObject
modifier|*
name|tile_width_adj
decl_stmt|;
DECL|member|tile_height_adj
name|GtkObject
modifier|*
name|tile_height_adj
decl_stmt|;
DECL|member|division_x_adj
name|GtkObject
modifier|*
name|division_x_adj
decl_stmt|;
DECL|member|division_y_adj
name|GtkObject
modifier|*
name|division_y_adj
decl_stmt|;
DECL|variable|w
block|}
name|w
struct|;
end_struct

begin_function
specifier|static
name|void
DECL|function|tile_width_adj_changed (GtkAdjustment * adj)
name|tile_width_adj_changed
parameter_list|(
name|GtkAdjustment
modifier|*
name|adj
parameter_list|)
block|{
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|tile_width
operator|!=
operator|(
name|gint
operator|)
name|adj
operator|->
name|value
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|tile_width
operator|=
name|adj
operator|->
name|value
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|division_x
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
operator|/
name|p
operator|.
name|params
operator|.
name|tile_width
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|w
operator|.
name|division_x_adj
argument_list|)
argument_list|,
name|p
operator|.
name|params
operator|.
name|division_x
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|tile_height_adj_changed (GtkAdjustment * adj)
name|tile_height_adj_changed
parameter_list|(
name|GtkAdjustment
modifier|*
name|adj
parameter_list|)
block|{
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|tile_height
operator|!=
operator|(
name|gint
operator|)
name|adj
operator|->
name|value
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|tile_height
operator|=
name|adj
operator|->
name|value
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|division_y
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
operator|/
name|p
operator|.
name|params
operator|.
name|tile_height
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|w
operator|.
name|division_y_adj
argument_list|)
argument_list|,
name|p
operator|.
name|params
operator|.
name|division_y
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|division_x_adj_changed (GtkAdjustment * adj)
name|division_x_adj_changed
parameter_list|(
name|GtkAdjustment
modifier|*
name|adj
parameter_list|)
block|{
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|division_x
operator|!=
operator|(
name|gint
operator|)
name|adj
operator|->
name|value
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|division_x
operator|=
name|adj
operator|->
name|value
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|tile_width
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
operator|/
name|p
operator|.
name|params
operator|.
name|division_x
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|w
operator|.
name|tile_width_adj
argument_list|)
argument_list|,
name|p
operator|.
name|params
operator|.
name|tile_width
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|division_y_adj_changed (GtkAdjustment * adj)
name|division_y_adj_changed
parameter_list|(
name|GtkAdjustment
modifier|*
name|adj
parameter_list|)
block|{
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|division_y
operator|!=
operator|(
name|gint
operator|)
name|adj
operator|->
name|value
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|division_y
operator|=
name|adj
operator|->
name|value
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|tile_height
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
operator|/
name|p
operator|.
name|params
operator|.
name|division_y
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|w
operator|.
name|tile_height_adj
argument_list|)
argument_list|,
name|p
operator|.
name|params
operator|.
name|tile_height
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|open_dialog (void)
name|open_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|main_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkObject
modifier|*
name|adjustment
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|color_button
decl_stmt|;
name|gimp_ui_init
argument_list|(
name|PLUG_IN_BINARY
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Paper Tile"
argument_list|)
argument_list|,
name|PLUG_IN_BINARY
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|PLUG_IN_PROC
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_dialog_set_alternative_button_order
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gimp_window_set_transient
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|main_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|gtk_dialog_get_content_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|main_hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_hbox
argument_list|)
expr_stmt|;
comment|/* Left */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Division"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|w
operator|.
name|division_x_adj
argument_list|,
name|p
operator|.
name|params
operator|.
name|division_x
argument_list|,
literal|1.0
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"_X:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|w
operator|.
name|division_x_adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|division_x_adj_changed
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|w
operator|.
name|division_y_adj
argument_list|,
name|p
operator|.
name|params
operator|.
name|division_y
argument_list|,
literal|1.0
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"_Y:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|w
operator|.
name|division_y_adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|division_y_adj_changed
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|w
operator|.
name|tile_width_adj
argument_list|,
name|p
operator|.
name|params
operator|.
name|tile_width
argument_list|,
literal|1.0
argument_list|,
name|MAX
argument_list|(
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|height
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|_
argument_list|(
literal|"_Width:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|w
operator|.
name|tile_width_adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|tile_width_adj_changed
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|w
operator|.
name|tile_height_adj
argument_list|,
name|p
operator|.
name|params
operator|.
name|tile_height
argument_list|,
literal|1.0
argument_list|,
name|MAX
argument_list|(
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|height
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|5.0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|,
name|_
argument_list|(
literal|"_Height:"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|w
operator|.
name|tile_height_adj
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|tile_height_adj_changed
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"Fractional Pixels"
argument_list|)
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_radio_button_update
argument_list|)
argument_list|,
operator|&
name|p
operator|.
name|params
operator|.
name|fractional_type
argument_list|,
name|p
operator|.
name|params
operator|.
name|fractional_type
argument_list|,
name|_
argument_list|(
literal|"_Background"
argument_list|)
argument_list|,
name|FRACTIONAL_TYPE_BACKGROUND
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"_Ignore"
argument_list|)
argument_list|,
name|FRACTIONAL_TYPE_IGNORE
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"_Force"
argument_list|)
argument_list|,
name|FRACTIONAL_TYPE_FORCE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"C_entering"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|p
operator|.
name|params
operator|.
name|centering
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|p
operator|.
name|params
operator|.
name|centering
argument_list|)
expr_stmt|;
comment|/* Right */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Movement"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_spin_button_new
argument_list|(
operator|&
name|adjustment
argument_list|,
name|p
operator|.
name|params
operator|.
name|move_max_rate
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_table_attach_aligned
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"_Max (%):"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|p
operator|.
name|params
operator|.
name|move_max_rate
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_mnemonic
argument_list|(
name|_
argument_list|(
literal|"_Wrap around"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|p
operator|.
name|params
operator|.
name|wrap_around
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_update
argument_list|)
argument_list|,
operator|&
name|p
operator|.
name|params
operator|.
name|wrap_around
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"Background Type"
argument_list|)
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_radio_button_update
argument_list|)
argument_list|,
operator|&
name|p
operator|.
name|params
operator|.
name|background_type
argument_list|,
name|p
operator|.
name|params
operator|.
name|background_type
argument_list|,
name|_
argument_list|(
literal|"_Transparent"
argument_list|)
argument_list|,
name|BACKGROUND_TYPE_TRANSPARENT
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"I_nverted image"
argument_list|)
argument_list|,
name|BACKGROUND_TYPE_INVERTED
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Im_age"
argument_list|)
argument_list|,
name|BACKGROUND_TYPE_IMAGE
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Fo_reground color"
argument_list|)
argument_list|,
name|BACKGROUND_TYPE_FOREGROUND
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Bac_kground color"
argument_list|)
argument_list|,
name|BACKGROUND_TYPE_BACKGROUND
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"S_elect here:"
argument_list|)
argument_list|,
name|BACKGROUND_TYPE_COLOR
argument_list|,
operator|&
name|button
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|color_button
operator|=
name|gimp_color_button_new
argument_list|(
name|_
argument_list|(
literal|"Background Color"
argument_list|)
argument_list|,
literal|100
argument_list|,
literal|16
argument_list|,
operator|&
name|p
operator|.
name|params
operator|.
name|background_color
argument_list|,
name|p
operator|.
name|drawable_has_alpha
condition|?
name|GIMP_COLOR_AREA_SMALL_CHECKS
else|:
name|GIMP_COLOR_AREA_FLAT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gtk_bin_get_child
argument_list|(
name|GTK_BIN
argument_list|(
name|frame
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|color_button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|color_button
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|color_button
argument_list|,
name|p
operator|.
name|params
operator|.
name|background_type
operator|==
name|BACKGROUND_TYPE_COLOR
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"set_sensitive"
argument_list|,
name|color_button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|color_button
argument_list|,
literal|"color-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_color_button_get_color
argument_list|)
argument_list|,
operator|&
name|p
operator|.
name|params
operator|.
name|background_color
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|p
operator|.
name|run
operator|=
operator|(
name|gimp_dialog_run
argument_list|(
name|GIMP_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|)
operator|==
name|GTK_RESPONSE_OK
operator|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*===========================================================================*/
end_comment

begin_comment
comment|/* PLUGIN CORE                                                               */
end_comment

begin_comment
comment|/*===========================================================================*/
end_comment

begin_typedef
DECL|struct|_Tile
typedef|typedef
struct|struct
name|_Tile
block|{
DECL|member|x
name|guint
name|x
decl_stmt|;
DECL|member|y
name|guint
name|y
decl_stmt|;
DECL|member|z
name|gint
name|z
decl_stmt|;
DECL|member|width
name|guint
name|width
decl_stmt|;
DECL|member|height
name|guint
name|height
decl_stmt|;
DECL|member|move_x
name|gint
name|move_x
decl_stmt|;
DECL|member|move_y
name|gint
name|move_y
decl_stmt|;
DECL|typedef|Tile
block|}
name|Tile
typedef|;
end_typedef

begin_function
specifier|static
name|gint
DECL|function|tile_compare (const void * x,const void * y)
name|tile_compare
parameter_list|(
specifier|const
name|void
modifier|*
name|x
parameter_list|,
specifier|const
name|void
modifier|*
name|y
parameter_list|)
block|{
return|return
operator|(
operator|(
name|Tile
operator|*
operator|)
name|x
operator|)
operator|->
name|z
operator|-
operator|(
operator|(
name|Tile
operator|*
operator|)
name|y
operator|)
operator|->
name|z
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gdouble
DECL|function|drand (void)
name|drand
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|g_random_double_range
argument_list|(
operator|-
literal|1
argument_list|,
literal|1
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
DECL|function|random_move (gint * x,gint * y,gint max)
name|random_move
parameter_list|(
name|gint
modifier|*
name|x
parameter_list|,
name|gint
modifier|*
name|y
parameter_list|,
name|gint
name|max
parameter_list|)
block|{
name|gdouble
name|angle
init|=
name|drand
argument_list|()
operator|*
name|G_PI
decl_stmt|;
name|gdouble
name|radius
init|=
name|drand
argument_list|()
operator|*
operator|(
name|gdouble
operator|)
name|max
decl_stmt|;
operator|*
name|x
operator|=
call|(
name|gint
call|)
argument_list|(
name|radius
operator|*
name|cos
argument_list|(
name|angle
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|y
operator|=
call|(
name|gint
call|)
argument_list|(
name|radius
operator|*
name|sin
argument_list|(
name|angle
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|overlap_RGB (guchar * base,const guchar * top)
name|overlap_RGB
parameter_list|(
name|guchar
modifier|*
name|base
parameter_list|,
specifier|const
name|guchar
modifier|*
name|top
parameter_list|)
block|{
name|base
index|[
literal|0
index|]
operator|=
name|top
index|[
literal|0
index|]
expr_stmt|;
name|base
index|[
literal|1
index|]
operator|=
name|top
index|[
literal|1
index|]
expr_stmt|;
name|base
index|[
literal|2
index|]
operator|=
name|top
index|[
literal|2
index|]
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|overlap_RGBA (guchar * base,const guchar * top)
name|overlap_RGBA
parameter_list|(
name|guchar
modifier|*
name|base
parameter_list|,
specifier|const
name|guchar
modifier|*
name|top
parameter_list|)
block|{
name|gdouble
name|R1
init|=
operator|(
name|gdouble
operator|)
name|base
index|[
literal|0
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|G1
init|=
operator|(
name|gdouble
operator|)
name|base
index|[
literal|1
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|B1
init|=
operator|(
name|gdouble
operator|)
name|base
index|[
literal|2
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|A1
init|=
operator|(
name|gdouble
operator|)
name|base
index|[
literal|3
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|R2
init|=
operator|(
name|gdouble
operator|)
name|top
index|[
literal|0
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|G2
init|=
operator|(
name|gdouble
operator|)
name|top
index|[
literal|1
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|B2
init|=
operator|(
name|gdouble
operator|)
name|top
index|[
literal|2
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|A2
init|=
operator|(
name|gdouble
operator|)
name|top
index|[
literal|3
index|]
operator|/
literal|255.0
decl_stmt|;
name|gdouble
name|A3
init|=
name|A2
operator|+
name|A1
operator|*
operator|(
literal|1.0
operator|-
name|A2
operator|)
decl_stmt|;
if|if
condition|(
literal|0.0
operator|<
name|A3
condition|)
block|{
name|gdouble
name|R3
init|=
operator|(
name|R1
operator|*
name|A1
operator|*
operator|(
literal|1.0
operator|-
name|A2
operator|)
operator|+
name|R2
operator|*
name|A2
operator|)
operator|/
name|A3
decl_stmt|;
name|gdouble
name|G3
init|=
operator|(
name|G1
operator|*
name|A1
operator|*
operator|(
literal|1.0
operator|-
name|A2
operator|)
operator|+
name|G2
operator|*
name|A2
operator|)
operator|/
name|A3
decl_stmt|;
name|gdouble
name|B3
init|=
operator|(
name|B1
operator|*
name|A1
operator|*
operator|(
literal|1.0
operator|-
name|A2
operator|)
operator|+
name|B2
operator|*
name|A2
operator|)
operator|/
name|A3
decl_stmt|;
name|R3
operator|=
name|CLAMP
argument_list|(
name|R3
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|G3
operator|=
name|CLAMP
argument_list|(
name|G3
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|B3
operator|=
name|CLAMP
argument_list|(
name|B3
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|base
index|[
literal|0
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|R3
operator|*
literal|255.0
argument_list|)
expr_stmt|;
name|base
index|[
literal|1
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|G3
operator|*
literal|255.0
argument_list|)
expr_stmt|;
name|base
index|[
literal|2
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|B3
operator|*
literal|255.0
argument_list|)
expr_stmt|;
name|base
index|[
literal|3
index|]
operator|=
call|(
name|guchar
call|)
argument_list|(
name|A3
operator|*
literal|255.0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|base
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|base
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|base
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|base
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
DECL|function|filter (void)
name|filter
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|void
function_decl|(
modifier|*
name|overlap
function_decl|)
parameter_list|(
name|guchar
modifier|*
parameter_list|,
specifier|const
name|guchar
modifier|*
parameter_list|)
function_decl|;
name|GimpPixelRgn
name|src
decl_stmt|;
name|GimpPixelRgn
name|dst
decl_stmt|;
name|GimpRGB
name|color
decl_stmt|;
name|guchar
name|pixel
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|division_x
decl_stmt|;
name|gint
name|division_y
decl_stmt|;
name|gint
name|offset_x
decl_stmt|;
name|gint
name|offset_y
decl_stmt|;
name|Tile
modifier|*
name|tiles
decl_stmt|;
name|gint
name|numof_tiles
decl_stmt|;
name|Tile
modifier|*
name|t
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|x
decl_stmt|;
name|gint
name|y
decl_stmt|;
name|gint
name|move_max_pixels
decl_stmt|;
name|gint
name|clear_x0
decl_stmt|;
name|gint
name|clear_y0
decl_stmt|;
name|gint
name|clear_x1
decl_stmt|;
name|gint
name|clear_y1
decl_stmt|;
name|gint
name|clear_width
decl_stmt|;
name|gint
name|clear_height
decl_stmt|;
name|guchar
modifier|*
name|pixels
decl_stmt|;
name|guchar
modifier|*
name|buffer
decl_stmt|;
name|gint
name|dindex
decl_stmt|;
name|gint
name|sindex
decl_stmt|;
name|gint
name|px
decl_stmt|,
name|py
decl_stmt|;
name|GRand
modifier|*
name|gr
decl_stmt|;
name|gr
operator|=
name|g_rand_new
argument_list|()
expr_stmt|;
comment|/* INITIALIZE */
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|src
argument_list|,
name|p
operator|.
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|height
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_init
argument_list|(
operator|&
name|dst
argument_list|,
name|p
operator|.
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|height
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixels
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|p
operator|.
name|drawable
operator|->
name|height
argument_list|)
expr_stmt|;
name|buffer
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
name|p
operator|.
name|params
operator|.
name|tile_width
operator|*
name|p
operator|.
name|params
operator|.
name|tile_height
argument_list|)
expr_stmt|;
name|overlap
operator|=
name|p
operator|.
name|drawable_has_alpha
condition|?
name|overlap_RGBA
else|:
name|overlap_RGB
expr_stmt|;
name|gimp_progress_init
argument_list|(
name|_
argument_list|(
literal|"Paper Tile"
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_drawable_mask_bounds
argument_list|(
name|p
operator|.
name|drawable
operator|->
name|drawable_id
argument_list|,
operator|&
name|p
operator|.
name|selection
operator|.
name|x0
argument_list|,
operator|&
name|p
operator|.
name|selection
operator|.
name|y0
argument_list|,
operator|&
name|p
operator|.
name|selection
operator|.
name|x1
argument_list|,
operator|&
name|p
operator|.
name|selection
operator|.
name|y1
argument_list|)
expr_stmt|;
name|p
operator|.
name|selection
operator|.
name|width
operator|=
name|p
operator|.
name|selection
operator|.
name|x1
operator|-
name|p
operator|.
name|selection
operator|.
name|x0
expr_stmt|;
name|p
operator|.
name|selection
operator|.
name|height
operator|=
name|p
operator|.
name|selection
operator|.
name|y1
operator|-
name|p
operator|.
name|selection
operator|.
name|y0
expr_stmt|;
name|gimp_tile_cache_ntiles
argument_list|(
literal|2
operator|*
operator|(
name|p
operator|.
name|selection
operator|.
name|width
operator|/
name|gimp_tile_width
argument_list|()
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
comment|/* TILES */
name|division_x
operator|=
name|p
operator|.
name|params
operator|.
name|division_x
expr_stmt|;
name|division_y
operator|=
name|p
operator|.
name|params
operator|.
name|division_y
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|fractional_type
operator|==
name|FRACTIONAL_TYPE_FORCE
condition|)
block|{
if|if
condition|(
literal|0
operator|<
name|p
operator|.
name|drawable
operator|->
name|width
operator|%
name|p
operator|.
name|params
operator|.
name|tile_width
condition|)
name|division_x
operator|++
expr_stmt|;
if|if
condition|(
literal|0
operator|<
name|p
operator|.
name|drawable
operator|->
name|height
operator|%
name|p
operator|.
name|params
operator|.
name|tile_height
condition|)
name|division_y
operator|++
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|centering
condition|)
block|{
if|if
condition|(
literal|1
operator|<
name|p
operator|.
name|drawable
operator|->
name|width
operator|%
name|p
operator|.
name|params
operator|.
name|tile_width
condition|)
block|{
name|division_x
operator|++
expr_stmt|;
name|offset_x
operator|=
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|%
name|p
operator|.
name|params
operator|.
name|tile_width
operator|)
operator|/
literal|2
operator|-
name|p
operator|.
name|params
operator|.
name|tile_width
expr_stmt|;
block|}
else|else
block|{
name|offset_x
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
literal|1
operator|<
name|p
operator|.
name|drawable
operator|->
name|height
operator|%
name|p
operator|.
name|params
operator|.
name|tile_height
condition|)
block|{
name|division_y
operator|++
expr_stmt|;
name|offset_y
operator|=
operator|(
name|p
operator|.
name|drawable
operator|->
name|height
operator|%
name|p
operator|.
name|params
operator|.
name|tile_height
operator|)
operator|/
literal|2
operator|-
name|p
operator|.
name|params
operator|.
name|tile_height
expr_stmt|;
block|}
else|else
block|{
name|offset_y
operator|=
literal|0
expr_stmt|;
block|}
block|}
else|else
block|{
name|offset_x
operator|=
literal|0
expr_stmt|;
name|offset_y
operator|=
literal|0
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|centering
condition|)
block|{
name|offset_x
operator|=
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|%
name|p
operator|.
name|params
operator|.
name|tile_width
operator|)
operator|/
literal|2
expr_stmt|;
name|offset_y
operator|=
operator|(
name|p
operator|.
name|drawable
operator|->
name|height
operator|%
name|p
operator|.
name|params
operator|.
name|tile_height
operator|)
operator|/
literal|2
expr_stmt|;
block|}
else|else
block|{
name|offset_x
operator|=
literal|0
expr_stmt|;
name|offset_y
operator|=
literal|0
expr_stmt|;
block|}
block|}
name|move_max_pixels
operator|=
name|p
operator|.
name|params
operator|.
name|move_max_rate
operator|*
name|p
operator|.
name|params
operator|.
name|tile_width
operator|/
literal|100.0
expr_stmt|;
name|numof_tiles
operator|=
name|division_x
operator|*
name|division_y
expr_stmt|;
name|t
operator|=
name|tiles
operator|=
name|g_new
argument_list|(
name|Tile
argument_list|,
name|numof_tiles
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|division_y
condition|;
name|y
operator|++
control|)
block|{
name|gint
name|srcy
init|=
name|offset_y
operator|+
name|p
operator|.
name|params
operator|.
name|tile_height
operator|*
name|y
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|division_x
condition|;
name|x
operator|++
operator|,
name|t
operator|++
control|)
block|{
name|gint
name|srcx
init|=
name|offset_x
operator|+
name|p
operator|.
name|params
operator|.
name|tile_width
operator|*
name|x
decl_stmt|;
if|if
condition|(
name|srcx
operator|<
literal|0
condition|)
block|{
name|t
operator|->
name|x
operator|=
literal|0
expr_stmt|;
name|t
operator|->
name|width
operator|=
name|srcx
operator|+
name|p
operator|.
name|params
operator|.
name|tile_width
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|srcx
operator|+
name|p
operator|.
name|params
operator|.
name|tile_width
operator|<
name|p
operator|.
name|drawable
operator|->
name|width
condition|)
block|{
name|t
operator|->
name|x
operator|=
name|srcx
expr_stmt|;
name|t
operator|->
name|width
operator|=
name|p
operator|.
name|params
operator|.
name|tile_width
expr_stmt|;
block|}
else|else
block|{
name|t
operator|->
name|x
operator|=
name|srcx
expr_stmt|;
name|t
operator|->
name|width
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
operator|-
name|srcx
expr_stmt|;
block|}
if|if
condition|(
name|srcy
operator|<
literal|0
condition|)
block|{
name|t
operator|->
name|y
operator|=
literal|0
expr_stmt|;
name|t
operator|->
name|height
operator|=
name|srcy
operator|+
name|p
operator|.
name|params
operator|.
name|tile_height
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|srcy
operator|+
name|p
operator|.
name|params
operator|.
name|tile_height
operator|<
name|p
operator|.
name|drawable
operator|->
name|height
condition|)
block|{
name|t
operator|->
name|y
operator|=
name|srcy
expr_stmt|;
name|t
operator|->
name|height
operator|=
name|p
operator|.
name|params
operator|.
name|tile_height
expr_stmt|;
block|}
else|else
block|{
name|t
operator|->
name|y
operator|=
name|srcy
expr_stmt|;
name|t
operator|->
name|height
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
operator|-
name|srcy
expr_stmt|;
block|}
name|t
operator|->
name|z
operator|=
name|g_rand_int
argument_list|(
name|gr
argument_list|)
expr_stmt|;
name|random_move
argument_list|(
operator|&
name|t
operator|->
name|move_x
argument_list|,
operator|&
name|t
operator|->
name|move_y
argument_list|,
name|move_max_pixels
argument_list|)
expr_stmt|;
block|}
block|}
name|qsort
argument_list|(
name|tiles
argument_list|,
name|numof_tiles
argument_list|,
sizeof|sizeof
expr|*
name|tiles
argument_list|,
name|tile_compare
argument_list|)
expr_stmt|;
name|gimp_pixel_rgn_get_rect
argument_list|(
operator|&
name|src
argument_list|,
name|pixels
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|fractional_type
operator|==
name|FRACTIONAL_TYPE_IGNORE
condition|)
block|{
name|clear_x0
operator|=
name|offset_x
expr_stmt|;
name|clear_y0
operator|=
name|offset_y
expr_stmt|;
name|clear_width
operator|=
name|p
operator|.
name|params
operator|.
name|tile_width
operator|*
name|division_x
expr_stmt|;
name|clear_height
operator|=
name|p
operator|.
name|params
operator|.
name|tile_height
operator|*
name|division_y
expr_stmt|;
block|}
else|else
block|{
name|clear_x0
operator|=
literal|0
expr_stmt|;
name|clear_y0
operator|=
literal|0
expr_stmt|;
name|clear_width
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
expr_stmt|;
name|clear_height
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
expr_stmt|;
block|}
name|clear_x1
operator|=
name|clear_x0
operator|+
name|clear_width
expr_stmt|;
name|clear_y1
operator|=
name|clear_y0
operator|+
name|clear_height
expr_stmt|;
switch|switch
condition|(
name|p
operator|.
name|params
operator|.
name|background_type
condition|)
block|{
case|case
name|BACKGROUND_TYPE_TRANSPARENT
case|:
for|for
control|(
name|y
operator|=
name|clear_y0
init|;
name|y
operator|<
name|clear_y1
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
name|clear_x0
init|;
name|x
operator|<
name|clear_x1
condition|;
name|x
operator|++
control|)
block|{
name|dindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|y
operator|+
name|x
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p
operator|.
name|drawable
operator|->
name|bpp
condition|;
name|i
operator|++
control|)
block|{
name|pixels
index|[
name|dindex
operator|+
name|i
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|BACKGROUND_TYPE_INVERTED
case|:
for|for
control|(
name|y
operator|=
name|clear_y0
init|;
name|y
operator|<
name|clear_y1
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
name|clear_x0
init|;
name|x
operator|<
name|clear_x1
condition|;
name|x
operator|++
control|)
block|{
name|dindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|y
operator|+
name|x
operator|)
expr_stmt|;
name|pixels
index|[
name|dindex
operator|+
literal|0
index|]
operator|=
literal|255
operator|-
name|pixels
index|[
name|dindex
operator|+
literal|0
index|]
expr_stmt|;
name|pixels
index|[
name|dindex
operator|+
literal|1
index|]
operator|=
literal|255
operator|-
name|pixels
index|[
name|dindex
operator|+
literal|1
index|]
expr_stmt|;
name|pixels
index|[
name|dindex
operator|+
literal|2
index|]
operator|=
literal|255
operator|-
name|pixels
index|[
name|dindex
operator|+
literal|2
index|]
expr_stmt|;
block|}
block|}
break|break;
case|case
name|BACKGROUND_TYPE_IMAGE
case|:
break|break;
case|case
name|BACKGROUND_TYPE_FOREGROUND
case|:
name|gimp_context_get_foreground
argument_list|(
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_rgb_get_uchar
argument_list|(
operator|&
name|color
argument_list|,
operator|&
name|pixel
index|[
literal|0
index|]
argument_list|,
operator|&
name|pixel
index|[
literal|1
index|]
argument_list|,
operator|&
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
for|for
control|(
name|y
operator|=
name|clear_y0
init|;
name|y
operator|<
name|clear_y1
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
name|clear_x0
init|;
name|x
operator|<
name|clear_x1
condition|;
name|x
operator|++
control|)
block|{
name|dindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|y
operator|+
name|x
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p
operator|.
name|drawable
operator|->
name|bpp
condition|;
name|i
operator|++
control|)
block|{
name|pixels
index|[
name|dindex
operator|+
name|i
index|]
operator|=
name|pixel
index|[
name|i
index|]
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|BACKGROUND_TYPE_BACKGROUND
case|:
name|gimp_context_get_background
argument_list|(
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_rgb_get_uchar
argument_list|(
operator|&
name|color
argument_list|,
operator|&
name|pixel
index|[
literal|0
index|]
argument_list|,
operator|&
name|pixel
index|[
literal|1
index|]
argument_list|,
operator|&
name|pixel
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
for|for
control|(
name|y
operator|=
name|clear_y0
init|;
name|y
operator|<
name|clear_y1
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
name|clear_x0
init|;
name|x
operator|<
name|clear_x1
condition|;
name|x
operator|++
control|)
block|{
name|dindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|y
operator|+
name|x
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p
operator|.
name|drawable
operator|->
name|bpp
condition|;
name|i
operator|++
control|)
block|{
name|pixels
index|[
name|dindex
operator|+
name|i
index|]
operator|=
name|pixel
index|[
name|i
index|]
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|BACKGROUND_TYPE_COLOR
case|:
name|gimp_rgba_get_uchar
argument_list|(
operator|&
name|p
operator|.
name|params
operator|.
name|background_color
argument_list|,
name|pixel
argument_list|,
name|pixel
operator|+
literal|1
argument_list|,
name|pixel
operator|+
literal|2
argument_list|,
name|pixel
operator|+
literal|3
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
name|clear_y0
init|;
name|y
operator|<
name|clear_y1
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
name|clear_x0
init|;
name|x
operator|<
name|clear_x1
condition|;
name|x
operator|++
control|)
block|{
name|dindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|y
operator|+
name|x
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|p
operator|.
name|drawable
operator|->
name|bpp
condition|;
name|i
operator|++
control|)
block|{
name|pixels
index|[
name|dindex
operator|+
name|i
index|]
operator|=
name|pixel
index|[
name|i
index|]
expr_stmt|;
block|}
block|}
block|}
break|break;
block|}
comment|/* DRAW */
for|for
control|(
name|t
operator|=
name|tiles
operator|,
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|numof_tiles
condition|;
name|i
operator|++
operator|,
name|t
operator|++
control|)
block|{
name|gint
name|x0
init|=
name|t
operator|->
name|x
operator|+
name|t
operator|->
name|move_x
decl_stmt|;
name|gint
name|y0
init|=
name|t
operator|->
name|y
operator|+
name|t
operator|->
name|move_y
decl_stmt|;
name|gimp_pixel_rgn_get_rect
argument_list|(
operator|&
name|src
argument_list|,
name|buffer
argument_list|,
name|t
operator|->
name|x
argument_list|,
name|t
operator|->
name|y
argument_list|,
name|t
operator|->
name|width
argument_list|,
name|t
operator|->
name|height
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|t
operator|->
name|height
condition|;
name|y
operator|++
control|)
block|{
name|py
operator|=
name|y0
operator|+
name|y
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|t
operator|->
name|width
condition|;
name|x
operator|++
control|)
block|{
name|px
operator|=
name|x0
operator|+
name|x
expr_stmt|;
name|sindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|t
operator|->
name|width
operator|*
name|y
operator|+
name|x
operator|)
expr_stmt|;
if|if
condition|(
literal|0
operator|<=
name|px
operator|&&
name|px
operator|<
name|p
operator|.
name|drawable
operator|->
name|width
operator|&&
literal|0
operator|<=
name|py
operator|&&
name|py
operator|<
name|p
operator|.
name|drawable
operator|->
name|height
condition|)
block|{
name|dindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|py
operator|+
name|px
operator|)
expr_stmt|;
name|overlap
argument_list|(
operator|&
name|pixels
index|[
name|dindex
index|]
argument_list|,
operator|&
name|buffer
index|[
name|sindex
index|]
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|p
operator|.
name|params
operator|.
name|wrap_around
condition|)
block|{
name|px
operator|=
operator|(
name|px
operator|+
name|p
operator|.
name|drawable
operator|->
name|width
operator|)
operator|%
name|p
operator|.
name|drawable
operator|->
name|width
expr_stmt|;
name|py
operator|=
operator|(
name|py
operator|+
name|p
operator|.
name|drawable
operator|->
name|height
operator|)
operator|%
name|p
operator|.
name|drawable
operator|->
name|height
expr_stmt|;
name|dindex
operator|=
name|p
operator|.
name|drawable
operator|->
name|bpp
operator|*
operator|(
name|p
operator|.
name|drawable
operator|->
name|width
operator|*
name|py
operator|+
name|px
operator|)
expr_stmt|;
name|overlap
argument_list|(
operator|&
name|pixels
index|[
name|dindex
index|]
argument_list|,
operator|&
name|buffer
index|[
name|sindex
index|]
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|gimp_progress_update
argument_list|(
operator|(
name|gdouble
operator|)
name|i
operator|/
operator|(
name|gdouble
operator|)
name|numof_tiles
argument_list|)
expr_stmt|;
block|}
name|gimp_pixel_rgn_set_rect
argument_list|(
operator|&
name|dst
argument_list|,
name|pixels
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|width
argument_list|,
name|p
operator|.
name|drawable
operator|->
name|height
argument_list|)
expr_stmt|;
name|gimp_drawable_flush
argument_list|(
name|p
operator|.
name|drawable
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|p
operator|.
name|drawable
operator|->
name|drawable_id
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|p
operator|.
name|drawable
operator|->
name|drawable_id
argument_list|,
name|p
operator|.
name|selection
operator|.
name|x0
argument_list|,
name|p
operator|.
name|selection
operator|.
name|y0
argument_list|,
name|p
operator|.
name|selection
operator|.
name|width
argument_list|,
name|p
operator|.
name|selection
operator|.
name|height
argument_list|)
expr_stmt|;
name|g_rand_free
argument_list|(
name|gr
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|buffer
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pixels
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tiles
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*============================================================================*/
end_comment

begin_comment
comment|/* PLUGIN INTERFACES                                                          */
end_comment

begin_comment
comment|/*============================================================================*/
end_comment

begin_function
specifier|static
name|void
DECL|function|plugin_query (void)
name|plugin_query
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
specifier|const
name|GimpParamDef
name|args
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode { RUN-INTERACTIVE (0), RUN-NONINTERACTIVE (1) }"
block|}
block|,
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Input image"
block|}
block|,
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Input drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"tile-size"
block|,
literal|"Tile size (pixels)"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"move-max"
block|,
literal|"Max move rate (%)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"fractional-type"
block|,
literal|"0:Background 1:Ignore 2:Force"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"wrap-around"
block|,
literal|"Wrap around (bool)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"centering"
block|,
literal|"Centering (bool)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"background-type"
block|,
literal|"0:Transparent 1:Inverted 2:Image? 3:FG 4:BG 5:Color"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"background-color"
block|,
literal|"Background color (for bg-type 5)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"background-alpha"
block|,
literal|"Opacity (for bg-type 5)"
block|}
block|}
decl_stmt|;
name|gimp_install_procedure
argument_list|(
name|PLUG_IN_PROC
argument_list|,
name|N_
argument_list|(
literal|"Cut image into paper tiles, and slide them"
argument_list|)
argument_list|,
literal|"This plug-in cuts an image into paper tiles and "
literal|"slides each paper tile."
argument_list|,
literal|"Hirotsuna Mizuno<s1041150@u-aizu.ac.jp>"
argument_list|,
literal|"Copyright (c)1997-1999 Hirotsuna Mizuno"
argument_list|,
name|_
argument_list|(
literal|"September 31, 1999"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"_Paper Tile..."
argument_list|)
argument_list|,
literal|"RGB*"
argument_list|,
name|GIMP_PLUGIN
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|args
argument_list|)
argument_list|,
literal|0
argument_list|,
name|args
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_plugin_menu_register
argument_list|(
name|PLUG_IN_PROC
argument_list|,
literal|"<Image>/Filters/Map"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|plugin_run (const gchar * name,gint numof_params,const GimpParam * params,gint * numof_return_vals,GimpParam ** return_vals)
name|plugin_run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|name
parameter_list|,
name|gint
name|numof_params
parameter_list|,
specifier|const
name|GimpParam
modifier|*
name|params
parameter_list|,
name|gint
modifier|*
name|numof_return_vals
parameter_list|,
name|GimpParam
modifier|*
modifier|*
name|return_vals
parameter_list|)
block|{
name|GimpPDBStatusType
name|status
init|=
name|GIMP_PDB_SUCCESS
decl_stmt|;
name|INIT_I18N
argument_list|()
expr_stmt|;
name|p
operator|.
name|run
operator|=
name|FALSE
expr_stmt|;
name|p
operator|.
name|run_mode
operator|=
name|params
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|p
operator|.
name|image
operator|=
name|params
index|[
literal|1
index|]
operator|.
name|data
operator|.
name|d_image
expr_stmt|;
name|p
operator|.
name|drawable
operator|=
name|gimp_drawable_get
argument_list|(
name|params
index|[
literal|2
index|]
operator|.
name|data
operator|.
name|d_drawable
argument_list|)
expr_stmt|;
name|p
operator|.
name|drawable_has_alpha
operator|=
name|gimp_drawable_has_alpha
argument_list|(
name|p
operator|.
name|drawable
operator|->
name|drawable_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_drawable_is_rgb
argument_list|(
name|p
operator|.
name|drawable
operator|->
name|drawable_id
argument_list|)
condition|)
block|{
switch|switch
condition|(
name|p
operator|.
name|run_mode
condition|)
block|{
case|case
name|GIMP_RUN_INTERACTIVE
case|:
name|params_load_from_gimp
argument_list|()
expr_stmt|;
name|open_dialog
argument_list|()
expr_stmt|;
break|break;
case|case
name|GIMP_RUN_NONINTERACTIVE
case|:
if|if
condition|(
name|numof_params
operator|==
literal|11
condition|)
block|{
name|p
operator|.
name|params
operator|.
name|tile_width
operator|=
name|params
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|tile_height
operator|=
name|params
index|[
literal|3
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|division_x
operator|=
name|p
operator|.
name|drawable
operator|->
name|width
operator|/
name|p
operator|.
name|params
operator|.
name|tile_width
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|division_y
operator|=
name|p
operator|.
name|drawable
operator|->
name|height
operator|/
name|p
operator|.
name|params
operator|.
name|tile_height
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|move_max_rate
operator|=
name|params
index|[
literal|4
index|]
operator|.
name|data
operator|.
name|d_float
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|fractional_type
operator|=
operator|(
name|FractionalType
operator|)
name|params
index|[
literal|5
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|wrap_around
operator|=
name|params
index|[
literal|6
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|centering
operator|=
name|params
index|[
literal|7
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|background_type
operator|=
operator|(
name|BackgroundType
operator|)
name|params
index|[
literal|8
index|]
operator|.
name|data
operator|.
name|d_int32
expr_stmt|;
name|p
operator|.
name|params
operator|.
name|background_color
operator|=
name|params
index|[
literal|9
index|]
operator|.
name|data
operator|.
name|d_color
expr_stmt|;
comment|/*  FIXME:  this used to be the alpha value                                           params[10].data.d_int32                */
name|p
operator|.
name|run
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_CALLING_ERROR
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_RUN_WITH_LAST_VALS
case|:
name|params_load_from_gimp
argument_list|()
expr_stmt|;
name|p
operator|.
name|run
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
block|}
else|else
block|{
name|status
operator|=
name|GIMP_PDB_EXECUTION_ERROR
expr_stmt|;
block|}
if|if
condition|(
name|status
operator|==
name|GIMP_PDB_SUCCESS
operator|&&
name|p
operator|.
name|run
condition|)
block|{
name|params_save_to_gimp
argument_list|()
expr_stmt|;
name|filter
argument_list|()
expr_stmt|;
if|if
condition|(
name|p
operator|.
name|run_mode
operator|!=
name|GIMP_RUN_NONINTERACTIVE
condition|)
name|gimp_displays_flush
argument_list|()
expr_stmt|;
block|}
name|gimp_drawable_detach
argument_list|(
name|p
operator|.
name|drawable
argument_list|)
expr_stmt|;
block|{
specifier|static
name|GimpParam
name|return_value
index|[
literal|1
index|]
decl_stmt|;
name|return_value
index|[
literal|0
index|]
operator|.
name|type
operator|=
name|GIMP_PDB_STATUS
expr_stmt|;
name|return_value
index|[
literal|0
index|]
operator|.
name|data
operator|.
name|d_status
operator|=
name|status
expr_stmt|;
operator|*
name|numof_return_vals
operator|=
literal|1
expr_stmt|;
operator|*
name|return_vals
operator|=
name|return_value
expr_stmt|;
block|}
block|}
end_function

begin_decl_stmt
DECL|variable|PLUG_IN_INFO
specifier|const
name|GimpPlugInInfo
name|PLUG_IN_INFO
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|plugin_query
block|,
name|plugin_run
block|}
decl_stmt|;
end_decl_stmt

begin_macro
name|MAIN
argument_list|()
end_macro

end_unit

