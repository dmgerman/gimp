2007-11-02  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimphistogramview.[ch]: added API to set the
	selected point.

	* app/tools/gimpcurvestool.c: use it.

2007-11-02  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpcurve.[ch]: added API to modify free-form curves
	and properties to listen to curve changes.

	* app/widgets/gimphistogramview.[ch]: added everything that's
	needed for rendering a curve with all its color and cursor
	indicators on top of a histogram. This code will move to a
	subclass soon.

	* app/tools/gimpcurvestool.[ch]: removed all curve rendering here.
	Also removed all explicit updating by connecting to curve signals
	and updating in the callback.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcairo-utils.[ch]: added utility function to create
	a Cairo surface from a GdkPixbuf.

	* app/widgets/gimpviewrenderer.c (gimp_view_renderer_create_pattern):
	use it from here.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* core/gimplist.h: formatting.

2007-11-02  Michael Natterer  <mitch@gimp.org>

	* app/core/Makefile.am
	* app/core/core-types.h
	* app/core/gimpcurve-save.[ch]
	* app/core/gimpcurve-load.[ch]
	* app/core/gimpcurve.[ch]: new GimpData subclass which keeps a
	curve as known from the curves tool. Pretty much unfinished, but
	can do everything that used to be done by base/curves.c and more.

	* app/base/curves.[ch]: stripped down to plain arrays of
	uchar (the actual curve) and the LUT setup function. All the rest
	is done by GimpCurve now.

	* app/tools/gimpcurvestool.[ch]: use an array of GimpCurves
	instead of the old Curves cruft. Use Curves only for the last step
	of creating the LUT. Pretty much unfinished migration here too.

	* tools/pdbgen/pdb/color.pdb: use a GimpCurve here too.

	* app/pdb/color_cmds.c: regenerated.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcairo-utils.c (gimp_cairo_set_source_color):
	also use the color's alpha channel. Added gtk-doc documentation.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* app/widgets/Makefile.am
	* app/widgets/gimpcairo-utils.[ch]: new files holding Cairo
	utility functions.

	* app/widgets/gimpviewrenderer.[ch]: ported partly to Cairo drawing.

	* app/widgets/gimpcomponenteditor.c
	* app/widgets/gimpcontainercombobox.c
	* app/widgets/gimpcontainertreeview.c
	* app/widgets/gimplayertreeview.c
	* app/widgets/gimpview.c: removed calls to
	gimp_view_renderer_unrealize() which are not needed anymore
	because we don't allocate a GC in the renderer any longer.

	* app/widgets/gimpcellrendererdashes.c: removed a redundant cast.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpviewrenderer.c (gimp_view_renderer_draw):
	removed code that draws a diagonal line across a renderer without
	context. Emit a warning instead; this shouldn't happen any longer.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpdasheditor.c (gimp_dash_editor_expose): draw
	using Cairo.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcellrendererdashes.c
	(gimp_cell_renderer_dashes_render): draw using Cairo.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/scripts/Makefile.am (scripts):
	* plug-ins/script-fu/scripts/hsv-graph.scm: removed this script.
	Fixes bug #491311.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpscrolledpreview.c: changed move cursor to
	GDK_HAND1 and switch to GDK_FLEUR while the mouse button is down.

2007-11-01  Tor Lillqvist  <tml@novell.com>

	* app/base/base-utils.c
	* app/base/base-utils.h: New files, with just one function so far,
	get_number_of_processors(). Include implementation also for Win32.

	* app/base/Makefile.am (libappbase_a_SOURCES): Add new files.

	* app/config/gimpbaseconfig.c (gimp_base_config_class_init): Use
	get_number_of_processors().

2007-11-01  Manish Singh  <yosh@gimp.org>

	* app/core/gimpcontainer-filter.c
	* app/pdb/gimppdb-query.c
	* app/plug-in/gimppluginmanager-query.c: replace usage of POSIX
	regex API with GRegex.

	* configure.in: remove check for regex support in glibc.

	* app/Makefile.am
	* plug-ins/script-fu/Makefile.am: remove REGEXREPL references.

	* tools/pdbgen/app.pl: remove code that references HAVE_GLIBC_REGEX.

	* regexrepl/*
	* makefile.msc
	* Makefile.am: remove regexrepl directory.

2007-10-31  Sven Neumann  <sven@gimp.org>

	* app/core/gimp-user-install.c: improved detection of old gimp
	user directories and handle migration from 2.4.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpparamspecs.[ch] (GimpParamSpecString): remove
	member "null_ok" and use GParamSpecString's "ensure_non_null"
	instead.

2007-10-31  Tor Lillqvist  <tml@novell.com>

	* README.win32: Remove. This kind of information belongs in the
	wiki.
	* Makefile.am (EXTRA_DIST): Drop from here, too.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* libgimpbase/Makefile.am
	* libgimpbase/xdg-user-dir.[ch]: removed.

	* libgimpbase/gimpbaseenums.[ch]: deprecate enum GimpUserDirectory.

	* libgimpbase/gimpenv.[ch]: deprecate gimp_user_directory() and make
	the implementation call g_get_user_special_dir().

	* libgimp/Makefile.am: #undef GIMP_DISABLE_DEPRECATED in gimpenums.c

	* app/widgets/gimpfiledialog.c: use g_get_user_special_dir() instead.

	* plug-ins/pygimp/gimpmodule.c: #undef GIMP_DISABLE_DEPRECATED.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* configure.in
	* app/Makefile.am
	* tools/Makefile.am: bump some more hardcoded 2.4 to 2.5

2007-10-31  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-close.c
	(gimp_display_shell_close_dialog): use g_timeout_source_new_seconds().

2007-10-31  Sven Neumann  <sven@gimp.org>

	* INSTALL
	* README
	* NEWS: updated for 2.5.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* configure.in: depend on glib 2.14.1

	* app/tools/gimpdrawtool.c
	* app/vectors/gimpvectors-import.c: use g_slice_dup() instead of
	g_slice_new() and memcpy().

2007-10-31  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/retinex.c: use a combo-box instead of radio
	buttons (bug #484838).

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* app/tools/gimprectangletool.c: some general indentation, spacing
	and coding style convention paranoia cleanups.

	(gimp_rectangle_tool_get_constraints): set all return values also
	when bailing out early to avoid valgrind warnings about
	uninitialized memory.

2007-10-31  Sven Neumann  <sven@gimp.org>

	* configure.in: check for the XFIXES extension.

	* plug-ins/common/plugin-defs.pl
	* plug-ins/common/Makefile.am: use XFIXES_CFLAGS for compiling the
	screenshot plug-in.

	* plug-ins/common/screenshot.c: optionally add the mouse cursor
	image on an extra layer. Work in progress... (bug #490779).

2007-10-31  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version to 2.5.0.

	Created branch gimp-2-4 for bug-fixes in the stable 2.4 series.
	
2007-10-31  Sven Neumann  <sven@gimp.org>

	* Made 2.4.1 release.

2007-10-30  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-render.c (box_filter): shift only
	by 4 bits instead of 8. Should still keep us from overflowing 32
	bit integers but reduces the rounding error and seems to really
	fix bug #491503.

2007-10-30  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangleselecttool.c
	(gimp_rect_select_tool_round_corners_notify): Update the selection
	when Rounded corners is toggled or the radius is changed as
	discussed in bug #418284.

2007-10-30  Michael Natterer  <mitch@gimp.org>

	* modules/cdisplay_lcms.c: applied patch from Sven Neumann and
	Marianne Gagnon which adds support for getting the system monitor
	profile on OS/X. Fixes bug #488170.

2007-10-30  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-handlers.c: reverted change that
	was made for bug #490785.

2007-10-30  Sven Neumann  <sven@gimp.org>

	Fix drawing of straight lines using the Shift key and a tablet
	(bug #164240):

	* app/tools/gimppainttool.c (gimp_paint_tool_button_press): set
	use_pressure to FALSE when drawing a straight line.

	* app/paint/gimppaintbrush.c (_gimp_paintbrush_motion): respect
	the use_pressure flag.

2007-10-30  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-render.c (box_filter): reduce
	rounding errors. Fixes bug #491503.

	* app/base/tile-pyramid.c (tile_pyramid_write_quarter): reduce
	rounding errors.

2007-10-29  Sven Neumann  <sven@gimp.org>

	* libgimpcolor/gimpadaptivesupersample.c
	(gimp_adaptive_supersample_area): return with a warning if called
	with NULL render_func or put_pixel_func.

2007-10-29  Sven Neumann  <sven@gimp.org>

	Fix bug #491272 (no cursor drawn for small brush sizes):

	* app/tools/gimpbrushtool.[ch]
	(gimp_brush_tool_draw_brush): don't draw the brush outline if it
	becomes too small. Instead draw a small cross, but only if
	"draw_fallback" was passed as TRUE.
	(gimp_brush_tool_draw_brush): pass TRUE for "draw_fallback" if
	cursor drawing is disabled for the paint tools.

	* app/tools/gimpsourcetool.c (gimp_source_tool_draw): pass FALSE
	for "draw_fallback".

	* app/tools/gimpdrawtool.c (gimp_draw_tool_draw_cross_by_anchor):
	draw a symmetric cross for odd handle sizes.

2007-10-29  Sven Neumann  <sven@gimp.org>

	* app/tools/gimprectangletool.c (gimp_rectangle_tool_coord_on_handle):
	initialize variables to suppress a compiler warning.

2007-10-28  Sven Neumann  <sven@gimp.org>

	* app/pdb/gimppdb.c (gimp_pdb_execute_procedure_by_name): also
	call va_end() in the error cases.

2007-10-28  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpcolorscales.c (gimp_color_scales_set_channel):
	fixed range check.

2007-10-28  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpscrolledpreview.c
	(gimp_scrolled_preview_nav_button_press): use small-checks for the
	navigation popup and inherit the check-type from the preview.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpwidgets-utils.c (gimp_text_buffer_load): close
	the file handle.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* libgimpbase/gimpmemsize.c (string_to_memsize): don't just crash
	right away if the impossible happens.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* app/dialogs/preferences-dialog.c (prefs_resolution_source_callback):
	g_object_get_data() should always return a size-entry here. Return
	with a warning if it doesn't.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* libgimpconfig/gimpscanner.c (gimp_scanner_parse_color):
	initialize GimpRGB, just to be sure.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-handlers.c: removed code that syncs
	the padding color with the default values set in the preferences.
	Fixes bug #490785.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/pnm.c (pnm_load_ascii): fixed handling of
	truncated ascii files. Fixes bug #490827.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/pnm.c: formatting.
	(pnm_load_ascii): 

2007-10-27  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/mkgen.pl: set the svn:ignore property instead of
	writing a .cvsignore file.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* libgimpconfig/gimpcolorconfig.h (struct _GimpColorConfig):
	declared the fields as public so that they show up in the API
	documentation.

2007-10-27  Hans Breuer  <hans@breuer.org>

	* app/base/makefile.msc app/file/makefile.msc app/gimpcore.def
	  app/gui/makefile.msc app/plug-in/makefile.msc
	  libgimpwidgets/makefile.msc : updated msvc build
	* config.h.win32 : add ENABLE_TOOLBOX_MENU, it should only
	vanish on Mac OSX (Quartz build)

2007-10-27  Tor Lillqvist  <tml@novell.com>

	* libgimpbase/gimpenv.c (gimp_toplevel_directory): Drop the Win9x
	code path here, too.

	* libgimpbase/gimpenv.c (gimp_locale_directory): On Windows return
	the pathname in system codepage and not UTF-8.

2007-10-26  Sven Neumann  <sven@gimp.org>

	* app/text/gimptext.c: increased default font size to 24.

2007-10-26  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c (struct GimpRectangleToolPrivate):
	Renamed handle_[wh] to corner_handle_[wh] since that are the
	appropriate names.

2007-10-26  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c (gimp_rectangle_tool_oper_update):
	Use new helper functions to decide if the cursor is on a
	handle (or outside of the rectangle + handle bounds) to ease the
	introduction of having handles on the outside of the pending
	rectangle.
	(gimp_rectangle_tool_coord_outside)
	(gimp_rectangle_tool_coord_on_handle): New helper functions.

2007-10-26  Sven Neumann  <sven@gimp.org>

	* app/pdb/gimpprocedure.c (gimp_procedure_validate_args): don't pass
	NULL strings to gimp_message(). Fixes bug #490617.

2007-10-26  Sven Neumann  <sven@gimp.org>

	Reenabled update of the histogram while doing color corrections
	(bug #490182):

	* app/core/gimpviewable.[ch]: added new methods preview_freeze()
	and preview_thaw().

	* app/core/gimpimagemap.c
	(gimp_image_map_new): freeze the drawable preview.
	(gimp_image_map_dispose): thaw the  drawable preview.
	(gimp_image_map_do): update the drawable, not the image.

	* app/tools/gimpimagemaptool.c (gimp_image_map_tool_response): no
	need to invalidate the drawable preview any longer.

2007-10-26  Michael Natterer  <mitch@gimp.org>

	* app/xcf/xcf-load.c (xcf_load_image_props): never allocate
	image->cmap smaller than GIMP_IMAGE_COLORMAP_SIZE. Fixes bug #490048.

2007-10-26  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimphistogrameditor.c
	(gimp_histogram_editor_layer_changed): connect to
	GimpDrawable::update instead of GimpViewable::invalidate-preview.

2007-10-25  Kevin Cozens  <kcozens@cvs.gnome.org>

	* plug-ins/script-fu/tinyscheme/scheme-private.h
	* plug-ins/script-fu/tinyscheme/scheme.c:
	Allow a maximum of two calls to backchar() needed by the "case '.'"
	part of the switch statement in token(). Fixes bug #490198.

2007-10-25  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: Aligned static function
	prototypes.

2007-10-25  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: Tiny cosmetic change on the
	ClampedSide enum definition.

2007-10-25  Sven Neumann  <sven@gimp.org>

	* tools/Makefile.am
	* tools/gimp-remote.[ch]
	* tools/gimp-remote-x11.c: split gimp-remote into common and X11
	specific code.

2007-10-25  Michael Natterer  <mitch@gimp.org>

	* configure.in: made all tests consistently use
	'test "x$foo" = xbar' instead of 5 variants of which some were
	broken. Spotted by Peter Breitenlohner, fixes bug #490068.

2007-10-25  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version to 2.4.1 (interface age 1).

2007-10-25  Sven Neumann  <sven@gimp.org>

	* app/plug-in/gimpplugin-message.c (gimp_plug_in_handle_proc_install):
	set the procedure name before parsing the image types.
	Fixes bug #490055.

2007-10-25  Sven Neumann  <sven@gimp.org>

	* app/display/gimpcanvas.c (gimp_canvas_gc_new): use INVERT
	instead of XOR if the xor-color is configured as white.

2007-10-24  Manish Singh  <yosh@gimp.org>

	* plug-ins/common/compose.c
	* plug-ins/common/decompose.c: generate PDB docs from the same
	source as the UI.

2007-10-24  Kevin Cozens  <kcozens@cvs.gnome.org>

	* Makefile.am: Applied patch from Stanislav Brabec which adds
	NEWS.pre-2-4, ChangeLog.pre-2-2 and ChangeLog.pre-2-4 to EXTRA_DIST.
	Fixes bug #489813.

2007-10-24  Simon Budig  <simon@gimp.org>

        * app/display/gimpdisplayshell.h: change the PROJ_ROUND macro
	to do proper rounding. Seems to work well.

2007-10-24  Sven Neumann  <sven@gimp.org>
            Michael Natterer  <mitch@gimp.org>

	* Made 2.4.0 release.
