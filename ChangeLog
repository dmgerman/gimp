2007-12-07  Sven Neumann  <sven@gimp.org>

	* plug-ins/pygimp/pygimp-colors.c
	* plug-ins/pygimp/gimpcolormodule.c: removed calls to PyMem_Free().

2007-12-07  Sven Neumann  <sven@gimp.org>

	* libgimpcolor/test-color-parser.c: removed unused import.

2007-12-07  Michael Natterer  <mitch@gimp.org>

	* app/display/gimpdisplayshell-callbacks.c
	(gimp_display_shell_tool_events): if a device change happens, make
	sure we update the new active tool's focus display and modifier
	state. Fixes most of bug #493176.

2007-12-07  Michael Natterer  <mitch@gimp.org>

	* app/gimp-log.[ch]: renamed log domain TOOLS to TOOL_EVENTS and
	added domain TOOL_FOCUS.

	* app/display/gimpdisplayshell-callbacks.c: s/TOOLS/TOOL_EVENTS/

	* app/tools/gimptool.c: port focus debug output to GIMP_LOG().

2007-12-07  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpselection.[ch]: added GErrors to
	gimp_selection_extract() and gimp_selection_float().

	* app/core/gimp-edit.c
	* app/tools/gimpeditselectiontool.c
	* app/actions/select-commands.c: handle the returned error.

	* app/core/gimpdrawable-transform.c: pass NULL errors since this
	file knows what it does and won't get errors.

	* tools/pdbgen/pdb/selection.pdb: pass the error.

	* app/pdb/selection_cmds.c: regenerated.

2007-12-07  Sven Neumann  <sven@gimp.org>

	* plug-ins/pygimp/gimpui.py (ColorSelector.__init__): accept a
	string and parse it using gimpcolor.rgb_parse_css().

	* plug-ins/pygimp/plug-ins/sphere.py: show off the new feature.

2007-12-07  Sven Neumann  <sven@gimp.org>

	* plug-ins/pygimp/plug-ins/foggify.py: push/pop a context instead
	of manually restoring the background color.

2007-12-07  Sven Neumann  <sven@gimp.org>

	* app/batch.c (batch_run): only show the message about using the
	default batch interpreter when running in verbose mode.

2007-12-06  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c
	(gimp_rectangle_tool_set_property): Also update the integer
	representation of the rect when the GObject properties has been
	set.

2007-12-06  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpimage-merge.[ch]
	* app/core/gimpimage-convert.[ch]: added GError parameters.

	* app/dialogs/convert-dialog.c
	* app/actions/image-commands.c
	* app/actions/vectors-commands.c: handle the returned error.

	* tools/pdbgen/pdb/convert.pdb: pass the error.

	* app/pdb/convert_cmds.c: regenerated.

2007-12-06  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpdrawable-bucket-fill.[ch]: add GError parameter.

	* app/tools/gimpbucketfilltool.c: handle the returned error.

	* tools/pdbgen/pdb/edit.pdb: pass the error.

	* app/pdb/edit_cmds.c: regenerated.

2007-12-06  Michael Natterer  <mitch@gimp.org>

	* app/paint/gimppaintcore-stroke.[ch]: added GError arguments and
	fixed all functions to abort when the first call to
	gimp_paint_core_start() fails (it won't succeed either for the
	next path or whatever segemts).

	* app/core/gimpitem.[ch]: added GError to gimp_item_stroke()

	* app/core/gimpselection.c
	* app/core/gimpchannel.c
	* app/vectors/gimpvectors.c: don't gimp_message() in
	GimpItem::stroke() but set the error.

	* app/dialogs/stroke-dialog.c
	* app/actions/vectors-commands.c
	* app/actions/select-commands.c: handle the returned errors.

	* tools/pdbgen/pdb/edit.pdb
	* tools/pdbgen/pdb/paths.pdb
	* tools/pdbgen/pdb/paint_tools.pdb: pass the error to the stroke
	functions.

	* app/pdb/paint_tools_cmds.c
	* app/pdb/edit_cmds.c
	* app/pdb/paths_cmds.c: regenerated.

2007-12-06  Michael Natterer  <mitch@gimp.org>

	Move some gimp_message() calls where they belong:

	* app/core/gimplayer-floating-sel.[ch]: removed unreachable
	gimp_message() in floating_sel_anchor() and added GError parameter
	to floating_sel_to_layer().

	* app/core/gimplayer.c
	* app/core/gimpimage-quick-mask.c
	* app/actions/layers-commands.c: pass NULL or an error as
	appropriate and show the error message.

	* tools/pdbgen/pdb/floating_sel.pdb: set the error when the passed
	layer was no floating selection.

	* app/pdb/floating_sel_cmds.c: regenerated.

2007-12-05  Martin Nordholts  <martinn@svn.gnome.org>

	* app/actions/tool-options-commands.c
	(tool_options_save_to_cmd_callback)
	(tool_options_restore_from_cmd_callback): Only care about
	GIMP_CONFIG_PARAM_SERIALIZE properties, fixes bug #498948.

2007-12-05  Michael Natterer  <mitch@gimp.org>

	* tools/pdbgen/pdb/fileops.pdb: pass the error also to
	file_utils_filename_to_uri().

	* app/pdb/fileops_cmds.c: regenerated.

2007-12-05  Sven Neumann  <sven@gimp.org>

	* modules/gimpinputdevicestore-dx.c
	* modules/gimpinputdevicestore-hal.c: the code for !HAVE_LIBHAL
	ended up in the wrong file.

2007-12-05  Michael Natterer  <mitch@gimp.org>

	* tools/pdbgen/pdb/image.pdb (set_resolution): set the error
	instead of using gimp_message().

	* app/pdb/image_cmds.c: regenerated.

2007-12-05  Michael Natterer  <mitch@gimp.org>

	* app/pdb/gimppdb-query.[ch]: added GError arguments and reduce
	number of labels: to one by simply checking if the regex exists
	before unreffing it.

	* tools/pdbgen/pdb/procedural_db.pdb: pass the error to the query
	functions.

	* app/pdb/procedural_db_cmds.c: regenerated.

2007-12-05  Michael Natterer  <mitch@gimp.org>

	* configure.in: disable deprecated API also for the current
	develoment versions of glib, pango and gtk+, so we can fix new
	deprecations as soon as they pop up.

2007-12-04  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* tools/pdbgen/pdb/image.pdb: pass "error" instead of NULL.
	* app/pdb/image_cmds.c: regenerated.

2007-12-04  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* tools/pdbgen/pdb/gradient.pdb
	* tools/pdbgen/pdb/palette.pdb
	* tools/pdbgen/pdb/brush.pdb: use the new error arg instead
	of creating a GError and handling it internally.

	* app/pdb/palette_cmds.c
	* app/pdb/gradient_cmds.c
	* app/pdb/brush_cmds.c: regenerated.

2007-12-04  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpdrawable.[ch]: added new API
	gimp_drawable_estimate_memsize() and virtual function
	GimpDrawable::estimate_memsize() which estimate the memsize of a
	drawable after scaling/resizing.

	* app/core/gimplayer.c: implement the virtual function and take
	the layer mask into account.

	* app/core/gimpimage-item-list.[ch] (gimp_image_item_list_get_list):
	added const qualifiers.

	* app/core/gimpimage-scale.c (gimp_image_scale_check): use the new
	function to correctly estimate the new size instead of scaling the
	drawables' memsizes including all constant parts. Fixes bug #329468.

	* app/gimp-log.[ch]: added IMAGE_SCALE log domain.

	* app/core/gimpimage-scale.c: use it here for debugging output.

2007-12-04  Sven Neumann  <sven@gimp.org>

	* modules/Makefile.am
	* modules/gimpinputdevicestore.c: split into two new files:

	* modules/gimpinputdevicestore-dx.c: DirectX Input implementation
	* modules/gimpinputdevicestore-hal.c: HAL implementation

2007-12-03  Michael Natterer  <mitch@gimp.org>

	* tools/pdbgen/pdb/fileops.pdb: pass the new error down to all
	file functions which take GError arguments.

	* app/pdb/fileops_cmds.c: regenerated.

2007-12-02  Manish Singh  <yosh@gimp.org>

	* app/dialogs/about-dialog.c (about_dialog_load_url): pass NULL
	GError arg to gimp_pdb_execute_procedure_by_name.

	* app/xcf/xcf.c
	* app/xcf/xcf-load.[ch]
	* app/xcf/xcf-save.[ch]: throw GErrors from load/save invokers instead
	of gimp_messages.

2007-12-02  Sven Neumann  <sven@gimp.org>

	* tools/pdbgen/app.pl: use GError for error reporting in PDB
	invoker methods.

	* tools/pdbgen/pdb/vectors.pdb: use the GError for the procedures
	introduced for bug #497159.

	* tools/pdbgen/pdb/fileops.pdb: use the GError from file-load and
	file-save procedures.

	* app/pdb/*_cmds.c: regenerated.

	* app/pdb/Makefile.am

	* app/pdb/gimppdberror.[ch]: new file introducing the
	GIMP_PDB_ERROR domain.

	* app/actions/plug-in-commands.c
	* app/actions/vectors-commands.c
	* app/batch.c
	* app/core/gimpimagefile.c
	* app/core/gimppdbprogress.c
	* app/file/file-open.[ch]
	* app/file/file-save.c
	* app/plug-in/gimpplugin-message.c
	* app/plug-in/gimppluginmanager-restore.c
	* app/plug-in/gimppluginprocedure.c
	* app/plug-in/gimptemporaryprocedure.c
	* app/plug-in/plug-in-icc-profile.c
	* app/widgets/gimpbrushselect.c
	* app/widgets/gimpfontselect.c
	* app/widgets/gimpgradientselect.c
	* app/widgets/gimphelp.c
	* app/widgets/gimppaletteselect.c
	* app/widgets/gimppatternselect.c
	* app/widgets/gimppdbdialog.[ch]: changed accordingly.

2007-12-02  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/tiff-load.c (load_image): removed pointless and
	untranslated warning.

2007-12-02  Sven Neumann  <sven@gimp.org>

	* plug-ins/jpeg/jpeg-load.c (jpeg_load_resolution): only set the
	resolution if X_density and Y_density are not zero. Otherwise the
	default resolution would be used anyway and the user sees an
	annoying and confusion warning.

2007-12-01  Sven Neumann  <sven@gimp.org>

	* app/core/gimpviewable.h: changed GIMP_VIEWABLE_PRIORITY_IDLE to
	G_PRIORITY_LOW. The reason for the very low priority was to keep
	it lower than the projection idle renderer.

2007-12-01  Martin Nordholts  <martinn@svn.gnome.org>

	* docs/Makefile.am: Applied patch from Jesper de Jong that removes
	an errant leading space in a command. Fixes bug #500826.

2007-11-30  Sven Neumann  <sven@gimp.org>

	* app/core/gimpprojection.c (gimp_projection_idle_render_init):
	raised the idle renderer priority even higher (bug #499150).

2007-11-30  Sven Neumann  <sven@gimp.org>

	* app/base/tile-manager.c (tile_manager_invalidate_area): if no
	tiles have been allocated, there's no need to invalidate any.
	Should fix bug #500178.

2007-11-29  Sven Neumann  <sven@gimp.org>

	* app/core/gimpprojection.c (gimp_projection_idle_render_init):
	raise the priority of the idle renderer to G_PRIORITY_DEFAULT_IDLE.
	Should fix bug #499150.

2007-11-29  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* plug-ins/Lighting/lighting_ui.c: make sure to update bumpmap
	when combo is changed.  Addresses bug #500317.

2007-11-28  Sven Neumann  <sven@gimp.org>

	* app/actions/drawable-commands.c (drawable_flip_cmd_callback):
	fixed orientation type used for linked items (bug #499161).

	* app/core/gimpdrawable-transform.c
	(gimp_drawable_transform_tiles_flip): fixed typo in if condition
	and added more sanity checks.

2007-11-27  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* app/tools/gimprectangletool.c: initialize vars to quiet
	stupid compile warnings.
	
2007-11-26  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpwidgets-utils.c (gimp_widget_accel_changed):
	escape text before using it in Pango text markup.

2007-11-26  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/wmf.c	(load_image): improved error reporting.

2007-11-26  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/wmf.c: avoid filename encoding problems by not
	using wmf_file_open() but mapping the file into memory with
	GMappedFile. Fixes bug #499329.

2007-11-26  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpblobeditor.c (gimp_blob_editor_draw_blob):
	corrected rendering of the blob (bug #499281).

2007-11-24  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangleoptions.c
	(gimp_rectangle_options_iface_base_init): Fix indentation.

2007-11-24  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.[ch]: Renamed RECT_* identifiers of
	the GimpRectangleFunction enum to GIMP_RECTANGLE_TOOL_*.

	* app/tools/gimprectangleselecttool.c: Use the new names.

2007-11-24  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.[ch]: Ported the internal
	representation of the rectangle to gdouble:s instead of
	gint:s. This solves problems like not being able to swap portrait
	for landscape on very small rectangles and bug #442027, as well as
	provides a nice base to solve other similar problems when they are
	discovered. It is possible to choose what precision the
	GimpRectangleTool:s will appear to have externally through a new
	GimpRectanglePrecision enum and property, but the gdouble mode
	still requires some work in order to be useful. Internally the
	rectangle always is represented using gdouble:s of course. In the
	processes quite some refactoring has taken place, mostly
	restructuring code and splitting larger functions into smaller
	more managable ones.
	(gimp_rectangle_tool_rect_rubber_banding_func)
	(gimp_rectangle_tool_setup_snap_offsets)
	(gimp_rectangle_tool_apply_fixed_rule)
	(gimp_rectangle_tool_update_int_rect)
	(gimp_rectangle_tool_get_public_rect): New helper functions.

	* app/tools/tools-enums.h: Added GimpRectanglePrecision.

2007-11-23  Sven Neumann  <sven@gimp.org>

	* plug-ins/flame/rect.c: reduced progress updates based on a patch
	from Tobias Jakobs (bug #499255). Untabified.

2007-11-23  Sven Neumann  <sven@gimp.org>

	* tools/pdbgen/pdb/procedural_db.pdb: removed outdated information
	from comment.

	* app/pdb/procedural_db_cmds.c
	* libgimp/gimpproceduraldb_pdb.c: regenerated.

2007-11-22  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpcolorbar.[ch]: derive from GtkEventBox instead
	of GtkMisc, but use an input-only window.

	* app/tools/gimplevelstool.c: redirect the events of the color
	bars to the handle bars. The histogram dialog has this change
	already. Functionality should be 100% restored now.

2007-11-22  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimphelpui.[ch]: use
	gtk_widget_set_tooltip_text() from gimp_help_set_help() and added
	gimp_help_set_help_data_with_markup() for the cases where markup
	is needed.

	* libgimpwidgets/gimpwidgets.def: updated.

	* app/tools/gimpselectionoptions.c
	* app/widgets/gimpeditor.c
	* app/widgets/gimpwidgets-utils.c: use the new function where markup
	in tooltips is being used.

	* app/widgets/gimptoolbox-color-area.c: no need to escape the
	ampersand any longer.

2007-11-22  Jakub Steiner <jimmac@ximian.com>

	* data/images/gimp-splash.png: New unstable splash
	* data/images/gimp-splash-2.4.png: looks like we keep stable
	splashes around

2007-11-22  Michael Natterer  <mitch@gimp.org>

	* app/tools/gimplevelstool.[ch]: use a GimpHandleBar also for the
	input frame, added a second adjustment for gamma and map between
	the linear and logarithmic gamma values in the adjustment
	callbacks, get rid of one GtkFrame just as in the histogram
	dialog. Still not finished since mouse events on the color bars
	are currently not handled.

2007-11-21  Sven Neumann  <sven@gimp.org>

	* app/config/gimpguiconfig.c: use "open %s" as the default
	web-browser command on Mac OS X.

2007-11-21  Sven Neumann  <sven@gimp.org>

	* HACKING
	* autogen.sh: dropped support for automake 1.8 and require
	automake >= 1.9.6. Require libtool 1.5 for all platforms.

2007-11-20  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpcontainercombobox.c: set the combo insensitive
	when it has no items. Fixes bug #498511.

2007-11-20  Michael Natterer  <mitch@gimp.org>

	* app/tools/gimplevelstool.[ch]: use a GimpHandleBar widget for
	the output sliders. Removes a bunch of code already, more to
	come...

2007-11-20  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/scripts/t-o-p-logo.scm: applied patch from
	Ulf-D. Ehlert that fixes the background color used in the Particle
	Trace filter (bug #498282).

2007-11-20  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcolorbar.c (gimp_color_bar_expose): added const
	qualifiers.

2007-11-20  Michael Natterer  <mitch@gimp.org>

	* app/widgets/widgets-types.h
	* app/widgets/Makefile.am
	* app/widgets/gimphandlebar.[ch]: new widget implementing the slider
	bar known from histogram and levels.

	* app/widgets/gimphistogrambox.[ch]: use the new widget. General
	cleanup and UI streamlining.

2007-11-20  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpcolorbar.c
	* app/widgets/gimphistogramview.c: cosmetic.

2007-11-19  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcurveview.[ch]: draw a base-line with the grid.
	Not sure if this should stay enabled for the Curves tool...

2007-11-19  Tor Lillqvist  <tml@novell.com>

	* libgimpwidgets/gimpcolorscale.c (gimp_color_scale_render_stipple):
	Don't write past end of buffer (bug #399484).

2007-11-18  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangleselecttool.c: Cosmitics. More strictly
	align static function prototypes and consistently use the name
	rect_sel_tool for pointers to GimpRectSelectTool.

2007-11-18  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* libgimp/gimp.def: forgot in previous commit

2007-11-18  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* tools/pdbgen/pdb/vectors.pdb:  add code for
	vectors-export-to-file and vectors-export-to-string, as
	requested in bug #497159.

	* app/pdb/vectors_cmds.c
	* app/pdb/internal_procs.c
	* libgimp/gimpvectors_pdb.c
	* libgimp/gimpvectors_pdb.h: rebuilt accordingly.

2007-11-18  Sven Neumann  <sven@gimp.org>

	* gimptool-2.0.in: removed.

	* configure.in: removed leftover references to the gimptool script.

2007-11-18  Michael Natterer  <mitch@gimp.org>

	* app/gimp-log.[ch]: add SAVE_DIALOG log domain.

	* app/dialogs/file-save-dialog: port debug output to GIMP_LOG().

2007-11-18  Michael Natterer  <mitch@gimp.org>

	* app/gimp-log.[ch]: add DIALOG_FACTORY log domain.

	* app/widgets/gimpdialogfactory.c: port debug output to GIMP_LOG().

2007-11-18  Michael Natterer  <mitch@gimp.org>

	* app/gimp-log.[ch]: changed to work with different
	compiler-specific ways of doing macro varargs. Also cope with no
	macro vararg support at all. Pointed out by Hans Breuer.

2007-11-18  Michael Natterer  <mitch@gimp.org>

	* app/display/gimpdisplayshell-callbacks.c
	(gimp_display_shell_canvas_tool_events): improve debug output.

2007-11-17  Sven Neumann  <sven@gimp.org>

	* app/base/base-utils.c (get_physical_memory_size): added a cast
	to avoid an integer overflow on 32bit machines.

2007-11-17  Sven Neumann  <sven@gimp.org>

	* tools/gimptool.c: minor cleanup, hopefully not breaking anything.

2007-11-17  Sven Neumann  <sven@gimp.org>

	* app/base/base-utils.[ch]: changed to get_physical_memory_size()
	and added an implementation for POSIX.2 platforms.

2007-11-17  Tor Lillqvist  <tml@novell.com>

	* tools/gimptool.c: Ignore --msvc-syntax unless on Windows. Put
	some Windows-only stuff inside ifdef.

2007-11-16  Tor Lillqvist  <tml@novell.com>

	Use the gimptool program on Unix, too, instead of the gimptool
	script.

	* configure.in
	* Makefile.am: Drop gimptool script and gimptool-win32.c(.in)

	* tools/gimptool.c
	* tools/Makefile.am: Move gimptool-win32.c.in here and call it
	just gimptool.c. Build and install on all platforms.

	* tools/gimptool.c: Change accordingly.

	* doc/gimptool.1.in: Document the --msvc-syntax option.
	
2007-11-16  Michael Natterer  <mitch@gimp.org>

	* app/gimp-log.[ch]: add HELP log domain.

	* app/widgets/gimphelp.c: port debug output to GIMP_LOG() and
	improve it.

2007-11-16  Tor Lillqvist  <tml@novell.com>

	* app/base/base-utils.c
	* app/base/base-utils.h (get_physical_memory_size_megabytes): New
	function that Sven asked for. Somebody please fill in Unix
	implementation(s). Feel free to change the name, change to return
	as bytes in a gint64, etc.

2007-11-16  Michael Natterer  <mitch@gimp.org>

	* app/base/temp-buf.c
	* app/base/tile-manager.c
	* app/core/gimpobject.c: accept NULL in all get_memsize() functions.

	* app/core/gimp-utils.[ch]: ditto. Added gimp_string_get_memsize().

	* app/core/gimp.c
	* app/core/gimpbrush.c
	* app/core/gimpbuffer.c
	* app/core/gimpcontainer.c
	* app/core/gimpcontext.c
	* app/core/gimpdata.c
	* app/core/gimpdrawable.c
	* app/core/gimpdrawablemodundo.c
	* app/core/gimpdrawableundo.c
	* app/core/gimpimage.c
	* app/core/gimpitempropundo.c
	* app/core/gimplayer.c
	* app/core/gimpmaskundo.c
	* app/core/gimppalette.c
	* app/core/gimpparasitelist.c
	* app/core/gimppattern.c
	* app/core/gimppreviewcache.c
	* app/core/gimpundo.c
	* app/core/gimpundostack.c
	* app/core/gimpviewable.c
	* app/pdb/gimpprocedure.c
	* app/plug-in/gimpplugindef.c
	* app/plug-in/gimppluginmanager.c
	* app/plug-in/gimppluginprocedure.c
	* app/text/gimptext.c
	* app/text/gimptextlayer.c
	* app/text/gimptextundo.c
	* app/vectors/gimpvectorsmodundo.c: simplify
	GimpObject::get_memsize() implementations accordingly.

	* app/core/gimpimageundo.c: ditto. Always keep around colormaps in
	chunks of GIMP_IMAGE_COLORMAP_SIZE to be coonsistent with the
	other colormap handling code.

2007-11-16  Sven Neumann  <sven@gimp.org>

	* app/base/lut-funcs.c (equalize_lut_setup): make sure we don't
	get stuck in a loop if all pixels are transparent (bug #497291).

2007-11-16  Sven Neumann  <sven@gimp.org>

	* libgimpconfig/gimpcolorconfig.c: changed default value for using
	the system monitor profile. Many users seem to have broken monitor
	profiles and it's hard to figure out how to fix this (bug #496890).

2007-11-15  Sven Neumann  <sven@gimp.org>

	* app/tools/gimpselectionoptions.c (gimp_selection_options_gui):
	plugged a memory leak.

	* libgimpwidgets/gimpintstore.c (gimp_int_store_add_empty):
	initialize the iter to avoid using uninitialized memory.

2007-11-15  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/screenshot.c: don't call gimp_edit_clear() if
	the selection mask is empty after selecting the window shape and
	inverting that selection. Fixes bug #493182.

2007-11-15  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/tiff-save.c (save_image): fixed bug in colormap
	handling (bug #497103).

2007-11-15  Michael Natterer  <mitch@gimp.org>

	* app/display/gimpdisplayshell-dnd.c
	* app/widgets/gimpdnd-xds.c
	* app/widgets/gimpselectiondata.c: use GIMP_LOG(DND) here too.

2007-11-15  Michael Natterer  <mitch@gimp.org>

	* app/gimp-log.[ch]: add DND log domain.

	* app/widgets/gimpdnd.c: use GIMP_LOG().

2007-11-15  Sven Neumann  <sven@gimp.org>

	* app/core/gimpcurve-save.c: added sanity checks.

2007-11-15  Michael Natterer  <mitch@gimp.org>

	* app/Makefile.am
	* app/gimp-log.[ch]: new files implementing a log facility which
	can be enabled using the GIMP_LOG environment variable.

	* app/main.c: initialize it.

	* app/display/gimpdisplayshell-callbacks.c: use it instead of
	private debugging macros that need to be enabled at compile time.

2007-11-15  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpviewable.[ch]: add read-only property "frozen" and
	new API gimp_viewable_preview_is_fozen(). Emit property notifications.

	* app/widgets/gimphistogramview.[ch]: add API to show a second
	histogram in the background. Remove member "light_histogram" from
	the GimpHistogramViewClass struct.

	* app/widgets/gimpcurveview.c: don't set "light_histogram".

	* app/tools/gimpcurvestool.c: set the background histogram instead.

	* app/widgets/gimphistogrameditor.[ch]: connect to "notify::frozen"
	of the drawable and show its histogram at the freezing point in
	the background. This way the original histogram is visible while
	we are doing color corrections.

2007-11-14  Michael Natterer  <mitch@gimp.org>

	* app/display/gimpcanvas.c
	* app/widgets/gimpcurveview.c: free the cached PangoLayouts in
	GtkWidget::style_set().

	* app/widgets/gimppaletteview.c: draw the focus rectangle in
	hardcoded black/white since we also hardcode the grid color to
	black.

	* app/display/gimpstatusbar.c
	* app/widgets/gimpdockable.c: small cleanups while reviewing
	layout code.

2007-11-14  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpcolorframe.[ch]: replaced the number label with
	a big Cairo-drawn number below the color value labels.

2007-11-14  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimppaletteview.[ch]: port to Cairo drawing.

2007-11-13  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: Avoid GimpRectangleTool internals
	to make use of its own public interface by making
	gimp_rectangle_tool_get_other_side() work on pointers to members
	instead of GObject property names.
	(gimp_rectangle_tool_set_other_side_coord)
	(gimp_rectangle_tool_get_other_side_coord): Use
	gimp_rectangle_tool_get_other_side() in the new way.

2007-11-13  Martin Nordholts  <martinn@svn.gnome.org>

	Fixed warnings about negative rectangle widths/heights when
	toggling 'Fixed center' while rubber banding a rectangle.

	* app/tools/gimprectangletool.c
	(gimp_rectangle_tool_set_other_side_coord): Finnishing off with a
	call to gimp_rectangle_tool_check_function() as changing the
	coordinates of the opposite side might swap the orientation of the
	rectangle.

2007-11-13  Sven Neumann  <sven@gimp.org>

	* app/core/gimpimage-merge.c (gimp_image_merge_layers): when we
	encounter an unsupported merge operation (merging an opaque
	indexed layer onto an indexed layer with alpha channel), then add
	an alpha channel and try again. Fixes bug #496437.

2007-11-13  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpviewrenderer.c (gimp_view_renderer_draw): use
	cairo_save()/cairo_restore() around calling the virtual function
	instead of restoring the clipping area manually.

2007-11-13  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpviewrenderervectors.c
	(gimp_view_renderer_vectors_draw): naive port to Cairo. Somebody
	should check if this isn't better done with proper curve_to()
	drawing using the original vectors data instead of interpolation.

	* app/widgets/gimpviewrenderer.c (gimp_view_renderer_draw): reset
	clipping before drawing the border because a subclass' draw()
	might have done additional clipping.

2007-11-13  Tor Lillqvist  <tml@novell.com>

	* gimptool-win32.c.in: Some cleanups, more coming.

2007-11-13  Sven Neumann  <sven@gimp.org>

	Fix for bug #494049 (painting doesn't update the histogram):

	* app/paint/gimppaintcore.c: freeze the drawable preview while we
	are painting. Update the drawable instead of the image.

	* app/widgets/gimphistogrameditor.c: use a short timeout instead
	of an idle handler to update the histogram.

2007-11-13  Tor Lillqvist  <tml@novell.com>

	* gimp-zip.in: Drop the timestamp from the zip file names. Add the
	.pc files to the developer package.

2007-11-13  Michael Natterer  <mitch@gimp.org>

	Enable brush scaling for smudge (but only before, not while
	painting). Fixes bug #471348.

	* app/paint/gimpbrushcore.[ch] (struct GimpBrushCoreClass): rename
	member "use_scale" to "handles_scaling_brush".

	(gimp_brush_core_calc_brush_scale): apply pressure scale only if
	both "handles_scaling_brush" and "use_pressure" are TRUE, and
	apply the scaling from the options unconditionally.

	(gimp_brush_core_get_paint_area): don't re-fetch core->scale if
	"handles_scaling_brush" is FALSE to keep the brush from scaling
	*while* painting.

	(gimp_brush_core_create_bound_segs): use the brush scale from the
	options unconditionally since that's always used now.

	* app/paint/gimpsmudge.c (gimp_smudge_brush_coords): use
	gimp_brush_scale_size() to figure the accum_buffer's size instead
	of using the brush mask's size directly.

	* app/tools/gimppaintoptions-gui.c (gimp_paint_options_gui): show
	the brush scale controls for all brush tools.
	
2007-11-12  Sven Neumann  <sven@gimp.org>

	* app/core/gimp-utils.c (gimp_get_default_unit): return
	GIMP_UNIT_MM in case that we can't query the locale.

	* plug-ins/common/postscript.c: use gboolean for boolean variables.

2007-11-12  Sven Neumann  <sven@gimp.org>

	* app/core/gimpimage-merge.c (gimp_image_merge_layers): corrected
	the size of the pixel region passed to color_region() in case of
	an indexed image. Fixes bug #495990.

2007-11-12  Michael Natterer  <mitch@gimp.org>

	* app/display/gimpdisplayshell-callbacks.c
	(gimp_display_shell_ruler_button_press): don't let
	GimpImageMapTools move sample points. They fail badly and leave
	the display in a paused state.

2007-11-12  Michael Natterer  <mitch@gimp.org>

	* app/sanity.c: added Pango version sanity check.

2007-11-12  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/tiff-load.c (run): properly handle a failure of
	TIFFFdOpen() instead of crashing on TIFF files we can't handle.

2007-11-12  Michael Natterer  <mitch@gimp.org>

	* app/display/gimpdisplayshell.c (gimp_display_shell_new): don't
	crash if gimp_display_shell_filter_new() returns NULL.
	Fixes bug #495863.

2007-11-11  Kevin Cozens  <kcozens@cvs.gnome.org>

	* plug-ins/script-fu/scripts/script-fu-compat.init: Return a list
	from cons-array when type is 'string.

2007-11-11  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.[ch]: Removed
	gimp_rectangle_tool_get_press_coords() as it doesn't make sense
	for a rectangle tool interface to provide this functionality.
	Clients should take care of that themselves. Also adjusted
	internal code accordingly.

	* app/tools/gimprectangleselecttool.c: Remember the pressed
	coordinates on _button_press instead of asking GimpRectangleTool
	about it.

2007-11-11  Michael Natterer  <mitch@gimp.org>

	* configure.in: depend on pango 1.18

	* app/text/gimpfontlist.c (gimp_font_list_add_font): remove
	workaround for old pango appending "Non-Rotated" to font names.

2007-11-11  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangleselecttool.[ch]: Don't expose private
	instance members, use g_type_class_add_private() instead.

2007-11-11  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c
	(gimp_rectangle_tool_update_with_coord): Updated comments to
	reflect current behaviour.

2007-11-11  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: Lessen code bloat by removing
	code that manages center-[xy] properies of GimpRectangleOptions.
	Instead use x1, y1 and x2, y2 when working with the rectangle
	center.

	* app/tools/gimprectangleoptions.[ch]: Removed "center-x" and
	"center-y" properties.

2007-11-10  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimppageselector.c: formatting.

2007-11-10  Sven Neumann  <sven@gimp.org>

	* app/actions/view-actions.c (view_zoom_explicit_actions): fixed
	incorrect tooltip (bug #495564).

	* app/dialogs/preferences-dialog.c (prefs_display_options_frame_add):
	adapt to the changed return value of gimp_prop_enum_combo_box_new().

2007-11-10  Michael Natterer  <mitch@gimp.org>

	* libgimpwidgets/gimppropwidgets.c
	(gimp_prop_file_chooser_button_*): remove all sorts of workarounds
	for bugs of GtkFileChooserButton in GTK+ versions prior to 2.12.

2007-11-10  Michael Natterer  <mitch@gimp.org>

	* libgimpwidgets/gimppropwidgets.c: remove event boxes that were
	only there for the old tooltips.

	* modules/cdisplay_lcms.c: ditto. Also remove some code that was
	only needed because of the event box hack.

2007-11-10  Michael Natterer  <mitch@gimp.org>

	* app/tools/gimpairbrushtool.c (gimp_airbrush_tool_init)
	* app/tools/gimppenciltool.c (gimp_pencil_tool_init): don't enable
	color picking, it already gets enabled by the parent class.

2007-11-10  Sven Neumann  <sven@gimp.org>

	* plug-ins/helpbrowser/dialog.c (browser_dialog_make_index_foreach):
	deal gracefully with NULL titles.

2007-11-09  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcurveview.c (gimp_curve_view_expose): align the
	overlay with the pixel grid.

2007-11-09  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcurveview.c: draw the selected point filled and
	outlines for the unselected points.

2007-11-09  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcurveview.c (gimp_curve_view_expose): draw the
	center grid lines slightly stronger than the other grid lines.

2007-11-09  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcurveview.c (gimp_curve_view_expose): draw the
	cursor position using a translucent overlay.

2007-11-09  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcurveview.[ch]: added construct-only properties
	to control the number of grid rows and columns. Increased the
	default values to 8.

2007-11-09  Michael Natterer  <mitch@gimp.org>

	* libgimpwidgets/gimphelpui.[ch]: use the new tooltip API instead
	of the old deprecated one. Removed _gimp_help_init(). Remember
	whether tooltips are enabled or not in a local variable that can
	only be altered at startup time and not after. The API now expects
	markup instead of plain text which might cause warnings and
	perhaps needs to be changed.

	* libgimpwidgets/gimpwidgets-private.c: don't call _gimp_help_init().

	* app/config/gimpguiconfig.c: made show-tooltips a
	GIMP_CONFIG_PARAM_RESTART property.

	* app/widgets/gimptoolbox-color-area.c: don't add the tooltip here...

	* app/widgets/gimptoolbox.c: ...but here (as for all other
	indicators). Also escape '&' properly because we now use markup.

	* app/tools/gimpselectionoptions.c
	* app/widgets/gimpeditor.c
	* app/widgets/gimpwidgets-utils.c: print modifiers and
	shortcuts in bold instead of in ().

	* app/widgets/gimpcontainertreeview.c: show tooltips on rows if
	gimp_viewable_get_description() returns a tip.

	* app/dialogs/preferences-dialog.c
	* plug-ins/jpeg/jpeg-save.c
	* plug-ins/MapObject/mapobject_ui.c
	* plug-ins/Lighting/lighting_ui.c
	* plug-ins/common/animationplay.c
	* plug-ins/common/warp.c: no need to add event boxes just to have
	tooltips, the new ones work on all widgets.

2007-11-08  Sven Neumann  <sven@gimp.org>

	* app/display/gimpstatusbar.c (gimp_statusbar_vprintf): also cut
	the message at a '\r' character. Fixes the remaining aspect of
	bug #492718.

2007-11-08  Michael Natterer  <mitch@gimp.org>

	* libgimp/gimpenums.c.tail: replaced by generated version.

2007-11-08  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell.c (gimp_display_shell_show_tooltip):
	don't directly pass a message to gimp_statusbar_push(), it expects
	a format string and printf-like varargs. Fixes the crash reported
	in bug #492718.

2007-11-08  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpimage.c (gimp_image_clean_all): pass GIMP_DIRTY_ALL
	to the "clean" signal instead of uninitialized memory.

2007-11-06  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c
	(gimp_rectangle_tool_update_handle_sizes): don't use any dead
	areas in narrow-mode, and enter narrow-mode earlier.

	* app/tools/gimpdrawtool.c (gimp_draw_tool_draw_corner): adjusted
	to always draw side handles in narrow mode without dead areas.

2007-11-06  Michael Natterer  <mitch@gimp.org>

	* configure.in: remove check for putenv().

	* app/composite/gimp-composite-3dnow-test.c
	* app/composite/gimp-composite-altivec-test.c
	* app/composite/gimp-composite-mmx-test.c
	* app/composite/gimp-composite-sse-test.c
	* app/composite/gimp-composite-sse2-test.c
	* app/composite/gimp-composite-vis-test.c
	* libgimp/gimpui.c
	* plug-ins/uri/uri-backend-wget.c
	* tools/gimp-remote-x11.c: use g_setenv() instead of putenv().

2007-11-06  Sven Neumann  <sven@gimp.org>

	* tools/pdbgen/pdb/plug_in.pdb: improved documentation for
	gimp-plugin-menu-register.

	* app/pdb/plug_in_cmds.c
	* libgimp/gimpplugin_pdb.c: regenerated.

2007-11-06  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpblobeditor.c: ported to Cairo drawing.

2007-11-05  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpcurveview.c (gimp_curve_view_expose): translate
	by 0.5,0.5 instead of adding 0.5 to all coordinates (we always
	want to draw on pixel centers here). Some cleanup.

2007-11-05  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c (gimp_rectangle_tool_motion): Bail
	out early if the rectangle function is RECT_DEAD. This prevents
	flickering.

2007-11-05  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: also don't show the shell
	highlight when a rectangle is being moved. Achieved through
	slightly modifying code logic and renaming variables and functions
	a bit.

2007-11-05  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpgradienteditor.[ch]: use Cairo to draw the controls.

2007-11-05  Sven Neumann  <sven@gimp.org>

	* configure.in: don't bail out if the XFixes extension is not
	available.

2007-11-05  Sven Neumann  <sven@gimp.org>

	* tools/pdbgen/pdb/image.pdb: create a libgimp C wrapper for
	gimp-image-get-vectors-by-tattoo; this function was accidentally
	forgotten in the 2.4 libgimp API.

	* app/pdb/image_cmds.c
	* libgimp/gimpimage_pdb.[ch]: regenerated.

2007-11-05  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcairo-utils.h: introduced macros to set a single
	pixel in a Cairo surface without having to worry about endianness.

	* app/widgets/gimpcairo-utils.c
	* app/widgets/gimpviewrenderer.c
	* app/widgets/gimpviewrenderergradient.c
	* app/widgets/gimpviewrendererpalette.c: use the new macros.

2007-11-05  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpcurveview.c (gimp_curve_view_expose): port to
	Cairo.

2007-11-05  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpcurve.[ch]: don't recalculate the curve if the data
	object is frozen. Recalculate on thaw instead. Made
	gimp_curve_calculate() private and emit some GimpData::dirty
	signals where appropriate.

	* app/tools/gimpcurvestool.c
	* app/widgets/gimpcurveview.c
	* tools/pdbgen/pdb/color.pdb: changed accodingly (connect to "dirty"
	instead of "notify" and added some freeze/thaw where approproate).

	* app/pdb/color_cmds.c: regenerated.

2007-11-05  Sven Neumann  <sven@gimp.org>

	* app/core/gimpimagemap.c (gimp_image_map_clear): update the
	drawable, not the image. This change was missing in the fix for
	bug #490182. Fixes bug #493639.

2007-11-05  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpcurveview.[ch]: added event handling and
	completely edit the curve here.

	* app/tools/gimpcurvestool.[ch]: remove all event handling and
	curve editing code and only listen to curve signals.

2007-11-04  Martin Nordholts  <martinn@svn.gnome.org>

	Do not do shell darkening while GimpRectangleTool rectangles are
	being rubber-banded.

	* app/tools/gimprectangletool.c
	(gimp_rectangle_tool_button_press)
	(gimp_rectangle_tool_button_release): Maintain a variable keeping
	track of if the rectangle is being rubber banded or not.
	(gimp_rectangle_tool_update_highlight): Do not set a shell
	highligt if the rectangle is being rubber-banded.
	(gimp_rectangle_tool_rubber_banding_func): New helper function.

2007-11-04  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpviewrendererbrush.c: implement
	GimpViewRenderer::draw and draw the overlays with Cairo.

	* app/widgets/gimpviewrenderer.[ch]
	* app/widgets/gimpviewrenderervectors.c: minor cleanups.

2007-11-04  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpviewrenderer.[ch]: replaced the RGB buffer with
	a Cairo surface.

	* app/widgets/gimpviewrendererbuffer.c
	* app/widgets/gimpviewrendererbrush.c
	* app/widgets/gimpviewrendererdrawable.c
	* app/widgets/gimpviewrenderergradient.c
	* app/widgets/gimpviewrendererimage.c
	* app/widgets/gimpviewrendererpalette.c
	* app/widgets/gimpviewrenderervectors.c: changed accordingly. There
	are some loose ends here that will be fixed over the next days.

	* app/widgets/gimprender.c: removed gimp_render_temp_buf; it is
	not any longer needed.

	* app/core/gimpgradient.c (gimp_gradient_get_preview_size)
	* app/core/gimppalette.c (gimp_palette_get_preview_size): return
	an odd preview height to make the border align with the pixel grid.

2007-11-04  Sven Neumann  <sven@gimp.org>

	* app/tools/gimplevelstool.c (levels_input_area_event): minor cleanup.

2007-11-04  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: Consistently use the name
	`rect_tool' instead of `rectangle' or `rectangle_tool' for
	pointers to GimpRectangleTool.

2007-11-04  Martin Nordholts  <martinn@svn.gnome.org>

	Put GimpRectangleTool handles on the outside of the rectangle when
	it has a small width or height. Some polishing left to do but the
	base functionality works nicely.

	* app/tools/gimpdrawtool.[ch] (gimp_draw_tool_draw_corner): Add a
	put_outside boolean parameter that if true draws the handles on
	the outside of the rectangle.

	* app/tools/gimprectangletool.c
	(gimp_rectangle_tool_update_handle_sizes)
	(gimp_rectangle_tool_coord_on_handle)
	(gimp_rectangle_tool_draw): Take into account if the rectangle is
	in narrow-mode or not.

2007-11-04  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpgradienteditor.c
	* app/widgets/gimpnavigationview.c: use
	gdk_event_request_motions() to handle motion hint events.

2007-11-04  Michael Natterer  <mitch@gimp.org>

	* app/widgets/Makefile.am
	* app/widgets/widgets-types.h
	* app/widgets/gimpcurveview.[ch]: new GimpHistogramView subclass
	which does all the curve stuff.

	* app/widgets/gimphistorgramview.[ch]: removed all curve code again.

	* app/tools/gimpcurvestool.c: changed accordingly.

2007-11-04  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpcolorselect.c
	* libgimpwidgets/gimpscrolledpreview.c: use
	gdk_event_request_motions() to handle motion hint events.

2007-11-04  Sven Neumann  <sven@gimp.org>

	* INSTALL
	* configure.in: bumped required version of GTK+ to 2.12.0.

	* app/sanity.c (sanity_check_glib)
	* app/gui/gui.c (gui_sanity_check): updated sanity checks. 

2007-11-02  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimphistogramview.[ch]: added API to set the
	selected point.

	* app/tools/gimpcurvestool.c: use it.

2007-11-02  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpcurve.[ch]: added API to modify free-form curves
	and properties to listen to curve changes.

	* app/widgets/gimphistogramview.[ch]: added everything that's
	needed for rendering a curve with all its color and cursor
	indicators on top of a histogram. This code will move to a
	subclass soon.

	* app/tools/gimpcurvestool.[ch]: removed all curve rendering here.
	Also removed all explicit updating by connecting to curve signals
	and updating in the callback.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcairo-utils.[ch]: added utility function to create
	a Cairo surface from a GdkPixbuf.

	* app/widgets/gimpviewrenderer.c (gimp_view_renderer_create_pattern):
	use it from here.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* core/gimplist.h: formatting.

2007-11-02  Michael Natterer  <mitch@gimp.org>

	* app/core/Makefile.am
	* app/core/core-types.h
	* app/core/gimpcurve-save.[ch]
	* app/core/gimpcurve-load.[ch]
	* app/core/gimpcurve.[ch]: new GimpData subclass which keeps a
	curve as known from the curves tool. Pretty much unfinished, but
	can do everything that used to be done by base/curves.c and more.

	* app/base/curves.[ch]: stripped down to plain arrays of
	uchar (the actual curve) and the LUT setup function. All the rest
	is done by GimpCurve now.

	* app/tools/gimpcurvestool.[ch]: use an array of GimpCurves
	instead of the old Curves cruft. Use Curves only for the last step
	of creating the LUT. Pretty much unfinished migration here too.

	* tools/pdbgen/pdb/color.pdb: use a GimpCurve here too.

	* app/pdb/color_cmds.c: regenerated.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcairo-utils.c (gimp_cairo_set_source_color):
	also use the color's alpha channel. Added gtk-doc documentation.

2007-11-02  Sven Neumann  <sven@gimp.org>

	* app/widgets/Makefile.am
	* app/widgets/gimpcairo-utils.[ch]: new files holding Cairo
	utility functions.

	* app/widgets/gimpviewrenderer.[ch]: ported partly to Cairo drawing.

	* app/widgets/gimpcomponenteditor.c
	* app/widgets/gimpcontainercombobox.c
	* app/widgets/gimpcontainertreeview.c
	* app/widgets/gimplayertreeview.c
	* app/widgets/gimpview.c: removed calls to
	gimp_view_renderer_unrealize() which are not needed anymore
	because we don't allocate a GC in the renderer any longer.

	* app/widgets/gimpcellrendererdashes.c: removed a redundant cast.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpviewrenderer.c (gimp_view_renderer_draw):
	removed code that draws a diagonal line across a renderer without
	context. Emit a warning instead; this shouldn't happen any longer.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpdasheditor.c (gimp_dash_editor_expose): draw
	using Cairo.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcellrendererdashes.c
	(gimp_cell_renderer_dashes_render): draw using Cairo.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/scripts/Makefile.am (scripts):
	* plug-ins/script-fu/scripts/hsv-graph.scm: removed this script.
	Fixes bug #491311.

2007-11-01  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpscrolledpreview.c: changed move cursor to
	GDK_HAND1 and switch to GDK_FLEUR while the mouse button is down.

2007-11-01  Tor Lillqvist  <tml@novell.com>

	* app/base/base-utils.c
	* app/base/base-utils.h: New files, with just one function so far,
	get_number_of_processors(). Include implementation also for Win32.

	* app/base/Makefile.am (libappbase_a_SOURCES): Add new files.

	* app/config/gimpbaseconfig.c (gimp_base_config_class_init): Use
	get_number_of_processors().

2007-11-01  Manish Singh  <yosh@gimp.org>

	* app/core/gimpcontainer-filter.c
	* app/pdb/gimppdb-query.c
	* app/plug-in/gimppluginmanager-query.c: replace usage of POSIX
	regex API with GRegex.

	* configure.in: remove check for regex support in glibc.

	* app/Makefile.am
	* plug-ins/script-fu/Makefile.am: remove REGEXREPL references.

	* tools/pdbgen/app.pl: remove code that references HAVE_GLIBC_REGEX.

	* regexrepl/*
	* makefile.msc
	* Makefile.am: remove regexrepl directory.

2007-10-31  Sven Neumann  <sven@gimp.org>

	* app/core/gimp-user-install.c: improved detection of old gimp
	user directories and handle migration from 2.4.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpparamspecs.[ch] (GimpParamSpecString): remove
	member "null_ok" and use GParamSpecString's "ensure_non_null"
	instead.

2007-10-31  Tor Lillqvist  <tml@novell.com>

	* README.win32: Remove. This kind of information belongs in the
	wiki.
	* Makefile.am (EXTRA_DIST): Drop from here, too.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* libgimpbase/Makefile.am
	* libgimpbase/xdg-user-dir.[ch]: removed.

	* libgimpbase/gimpbaseenums.[ch]: deprecate enum GimpUserDirectory.

	* libgimpbase/gimpenv.[ch]: deprecate gimp_user_directory() and make
	the implementation call g_get_user_special_dir().

	* libgimp/Makefile.am: #undef GIMP_DISABLE_DEPRECATED in gimpenums.c

	* app/widgets/gimpfiledialog.c: use g_get_user_special_dir() instead.

	* plug-ins/pygimp/gimpmodule.c: #undef GIMP_DISABLE_DEPRECATED.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* configure.in
	* app/Makefile.am
	* tools/Makefile.am: bump some more hardcoded 2.4 to 2.5

2007-10-31  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-close.c
	(gimp_display_shell_close_dialog): use g_timeout_source_new_seconds().

2007-10-31  Sven Neumann  <sven@gimp.org>

	* INSTALL
	* README
	* NEWS: updated for 2.5.

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* configure.in: depend on glib 2.14.1

	* app/tools/gimpdrawtool.c
	* app/vectors/gimpvectors-import.c: use g_slice_dup() instead of
	g_slice_new() and memcpy().

2007-10-31  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/retinex.c: use a combo-box instead of radio
	buttons (bug #484838).

2007-10-31  Michael Natterer  <mitch@gimp.org>

	* app/tools/gimprectangletool.c: some general indentation, spacing
	and coding style convention paranoia cleanups.

	(gimp_rectangle_tool_get_constraints): set all return values also
	when bailing out early to avoid valgrind warnings about
	uninitialized memory.

2007-10-31  Sven Neumann  <sven@gimp.org>

	* configure.in: check for the XFIXES extension.

	* plug-ins/common/plugin-defs.pl
	* plug-ins/common/Makefile.am: use XFIXES_CFLAGS for compiling the
	screenshot plug-in.

	* plug-ins/common/screenshot.c: optionally add the mouse cursor
	image on an extra layer. Work in progress... (bug #490779).

2007-10-31  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version to 2.5.0.

	Created branch gimp-2-4 for bug-fixes in the stable 2.4 series.
	
2007-10-31  Sven Neumann  <sven@gimp.org>

	* Made 2.4.1 release.

2007-10-30  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-render.c (box_filter): shift only
	by 4 bits instead of 8. Should still keep us from overflowing 32
	bit integers but reduces the rounding error and seems to really
	fix bug #491503.

2007-10-30  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangleselecttool.c
	(gimp_rect_select_tool_round_corners_notify): Update the selection
	when Rounded corners is toggled or the radius is changed as
	discussed in bug #418284.

2007-10-30  Michael Natterer  <mitch@gimp.org>

	* modules/cdisplay_lcms.c: applied patch from Sven Neumann and
	Marianne Gagnon which adds support for getting the system monitor
	profile on OS/X. Fixes bug #488170.

2007-10-30  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-handlers.c: reverted change that
	was made for bug #490785.

2007-10-30  Sven Neumann  <sven@gimp.org>

	Fix drawing of straight lines using the Shift key and a tablet
	(bug #164240):

	* app/tools/gimppainttool.c (gimp_paint_tool_button_press): set
	use_pressure to FALSE when drawing a straight line.

	* app/paint/gimppaintbrush.c (_gimp_paintbrush_motion): respect
	the use_pressure flag.

2007-10-30  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-render.c (box_filter): reduce
	rounding errors. Fixes bug #491503.

	* app/base/tile-pyramid.c (tile_pyramid_write_quarter): reduce
	rounding errors.

2007-10-29  Sven Neumann  <sven@gimp.org>

	* libgimpcolor/gimpadaptivesupersample.c
	(gimp_adaptive_supersample_area): return with a warning if called
	with NULL render_func or put_pixel_func.

2007-10-29  Sven Neumann  <sven@gimp.org>

	Fix bug #491272 (no cursor drawn for small brush sizes):

	* app/tools/gimpbrushtool.[ch]
	(gimp_brush_tool_draw_brush): don't draw the brush outline if it
	becomes too small. Instead draw a small cross, but only if
	"draw_fallback" was passed as TRUE.
	(gimp_brush_tool_draw_brush): pass TRUE for "draw_fallback" if
	cursor drawing is disabled for the paint tools.

	* app/tools/gimpsourcetool.c (gimp_source_tool_draw): pass FALSE
	for "draw_fallback".

	* app/tools/gimpdrawtool.c (gimp_draw_tool_draw_cross_by_anchor):
	draw a symmetric cross for odd handle sizes.

2007-10-29  Sven Neumann  <sven@gimp.org>

	* app/tools/gimprectangletool.c (gimp_rectangle_tool_coord_on_handle):
	initialize variables to suppress a compiler warning.

2007-10-28  Sven Neumann  <sven@gimp.org>

	* app/pdb/gimppdb.c (gimp_pdb_execute_procedure_by_name): also
	call va_end() in the error cases.

2007-10-28  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpcolorscales.c (gimp_color_scales_set_channel):
	fixed range check.

2007-10-28  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpscrolledpreview.c
	(gimp_scrolled_preview_nav_button_press): use small-checks for the
	navigation popup and inherit the check-type from the preview.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpwidgets-utils.c (gimp_text_buffer_load): close
	the file handle.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* libgimpbase/gimpmemsize.c (string_to_memsize): don't just crash
	right away if the impossible happens.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* app/dialogs/preferences-dialog.c (prefs_resolution_source_callback):
	g_object_get_data() should always return a size-entry here. Return
	with a warning if it doesn't.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* libgimpconfig/gimpscanner.c (gimp_scanner_parse_color):
	initialize GimpRGB, just to be sure.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-handlers.c: removed code that syncs
	the padding color with the default values set in the preferences.
	Fixes bug #490785.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/pnm.c (pnm_load_ascii): fixed handling of
	truncated ascii files. Fixes bug #490827.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/pnm.c: formatting.
	(pnm_load_ascii): 

2007-10-27  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/mkgen.pl: set the svn:ignore property instead of
	writing a .cvsignore file.

2007-10-27  Sven Neumann  <sven@gimp.org>

	* libgimpconfig/gimpcolorconfig.h (struct _GimpColorConfig):
	declared the fields as public so that they show up in the API
	documentation.

2007-10-27  Hans Breuer  <hans@breuer.org>

	* app/base/makefile.msc app/file/makefile.msc app/gimpcore.def
	  app/gui/makefile.msc app/plug-in/makefile.msc
	  libgimpwidgets/makefile.msc : updated msvc build
	* config.h.win32 : add ENABLE_TOOLBOX_MENU, it should only
	vanish on Mac OSX (Quartz build)

2007-10-27  Tor Lillqvist  <tml@novell.com>

	* libgimpbase/gimpenv.c (gimp_toplevel_directory): Drop the Win9x
	code path here, too.

	* libgimpbase/gimpenv.c (gimp_locale_directory): On Windows return
	the pathname in system codepage and not UTF-8.

2007-10-26  Sven Neumann  <sven@gimp.org>

	* app/text/gimptext.c: increased default font size to 24.

2007-10-26  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c (struct GimpRectangleToolPrivate):
	Renamed handle_[wh] to corner_handle_[wh] since that are the
	appropriate names.

2007-10-26  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c (gimp_rectangle_tool_oper_update):
	Use new helper functions to decide if the cursor is on a
	handle (or outside of the rectangle + handle bounds) to ease the
	introduction of having handles on the outside of the pending
	rectangle.
	(gimp_rectangle_tool_coord_outside)
	(gimp_rectangle_tool_coord_on_handle): New helper functions.

2007-10-26  Sven Neumann  <sven@gimp.org>

	* app/pdb/gimpprocedure.c (gimp_procedure_validate_args): don't pass
	NULL strings to gimp_message(). Fixes bug #490617.

2007-10-26  Sven Neumann  <sven@gimp.org>

	Reenabled update of the histogram while doing color corrections
	(bug #490182):

	* app/core/gimpviewable.[ch]: added new methods preview_freeze()
	and preview_thaw().

	* app/core/gimpimagemap.c
	(gimp_image_map_new): freeze the drawable preview.
	(gimp_image_map_dispose): thaw the  drawable preview.
	(gimp_image_map_do): update the drawable, not the image.

	* app/tools/gimpimagemaptool.c (gimp_image_map_tool_response): no
	need to invalidate the drawable preview any longer.

2007-10-26  Michael Natterer  <mitch@gimp.org>

	* app/xcf/xcf-load.c (xcf_load_image_props): never allocate
	image->cmap smaller than GIMP_IMAGE_COLORMAP_SIZE. Fixes bug #490048.

2007-10-26  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimphistogrameditor.c
	(gimp_histogram_editor_layer_changed): connect to
	GimpDrawable::update instead of GimpViewable::invalidate-preview.

2007-10-25  Kevin Cozens  <kcozens@cvs.gnome.org>

	* plug-ins/script-fu/tinyscheme/scheme-private.h
	* plug-ins/script-fu/tinyscheme/scheme.c:
	Allow a maximum of two calls to backchar() needed by the "case '.'"
	part of the switch statement in token(). Fixes bug #490198.

2007-10-25  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: Aligned static function
	prototypes.

2007-10-25  Martin Nordholts  <martinn@svn.gnome.org>

	* app/tools/gimprectangletool.c: Tiny cosmetic change on the
	ClampedSide enum definition.

2007-10-25  Sven Neumann  <sven@gimp.org>

	* tools/Makefile.am
	* tools/gimp-remote.[ch]
	* tools/gimp-remote-x11.c: split gimp-remote into common and X11
	specific code.

2007-10-25  Michael Natterer  <mitch@gimp.org>

	* configure.in: made all tests consistently use
	'test "x$foo" = xbar' instead of 5 variants of which some were
	broken. Spotted by Peter Breitenlohner, fixes bug #490068.

2007-10-25  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version to 2.4.1 (interface age 1).

2007-10-25  Sven Neumann  <sven@gimp.org>

	* app/plug-in/gimpplugin-message.c (gimp_plug_in_handle_proc_install):
	set the procedure name before parsing the image types.
	Fixes bug #490055.

2007-10-25  Sven Neumann  <sven@gimp.org>

	* app/display/gimpcanvas.c (gimp_canvas_gc_new): use INVERT
	instead of XOR if the xor-color is configured as white.

2007-10-24  Manish Singh  <yosh@gimp.org>

	* plug-ins/common/compose.c
	* plug-ins/common/decompose.c: generate PDB docs from the same
	source as the UI.

2007-10-24  Kevin Cozens  <kcozens@cvs.gnome.org>

	* Makefile.am: Applied patch from Stanislav Brabec which adds
	NEWS.pre-2-4, ChangeLog.pre-2-2 and ChangeLog.pre-2-4 to EXTRA_DIST.
	Fixes bug #489813.

2007-10-24  Simon Budig  <simon@gimp.org>

        * app/display/gimpdisplayshell.h: change the PROJ_ROUND macro
	to do proper rounding. Seems to work well.

2007-10-24  Sven Neumann  <sven@gimp.org>
            Michael Natterer  <mitch@gimp.org>

	* Made 2.4.0 release.
