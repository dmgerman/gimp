begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpconfig/gimpconfig.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmodule/gimpmodule.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets-private.h"
end_include

begin_include
include|#
directive|include
file|"shadow.h"
end_include

begin_include
include|#
directive|include
file|"units.h"
end_include

begin_include
include|#
directive|include
file|"widgets.h"
end_include

begin_function
specifier|static
name|GdkPixbuf
modifier|*
DECL|function|add_border_to_shot (GdkPixbuf * pixbuf)
name|add_border_to_shot
parameter_list|(
name|GdkPixbuf
modifier|*
name|pixbuf
parameter_list|)
block|{
name|GdkPixbuf
modifier|*
name|retval
decl_stmt|;
name|retval
operator|=
name|gdk_pixbuf_new
argument_list|(
name|GDK_COLORSPACE_RGB
argument_list|,
name|TRUE
argument_list|,
literal|8
argument_list|,
name|gdk_pixbuf_get_width
argument_list|(
name|pixbuf
argument_list|)
operator|+
literal|2
argument_list|,
name|gdk_pixbuf_get_height
argument_list|(
name|pixbuf
argument_list|)
operator|+
literal|2
argument_list|)
expr_stmt|;
comment|/* Fill with solid black */
name|gdk_pixbuf_fill
argument_list|(
name|retval
argument_list|,
literal|0x000000FF
argument_list|)
expr_stmt|;
name|gdk_pixbuf_copy_area
argument_list|(
name|pixbuf
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|gdk_pixbuf_get_width
argument_list|(
name|pixbuf
argument_list|)
argument_list|,
name|gdk_pixbuf_get_height
argument_list|(
name|pixbuf
argument_list|)
argument_list|,
name|retval
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
name|retval
return|;
block|}
end_function

begin_function
specifier|static
name|GdkPixbuf
modifier|*
DECL|function|take_window_shot (GtkWidget * widget)
name|take_window_shot
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GtkAllocation
name|allocation
decl_stmt|;
name|cairo_surface_t
modifier|*
name|surface
decl_stmt|;
name|cairo_t
modifier|*
name|cr
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|allocation
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|allocation
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|gtk_widget_get_preferred_width
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|,
operator|&
name|allocation
operator|.
name|width
argument_list|)
expr_stmt|;
name|gtk_widget_get_preferred_height
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|,
operator|&
name|allocation
operator|.
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_size_allocate
argument_list|(
name|widget
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|widget
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|surface
operator|=
name|cairo_image_surface_create
argument_list|(
name|CAIRO_FORMAT_ARGB32
argument_list|,
name|allocation
operator|.
name|width
argument_list|,
name|allocation
operator|.
name|height
argument_list|)
expr_stmt|;
name|cr
operator|=
name|cairo_create
argument_list|(
name|surface
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|widget
argument_list|,
name|cr
argument_list|)
expr_stmt|;
name|cairo_destroy
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_get_from_surface
argument_list|(
name|surface
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|allocation
operator|.
name|width
argument_list|,
name|allocation
operator|.
name|height
argument_list|)
expr_stmt|;
name|cairo_surface_destroy
argument_list|(
name|surface
argument_list|)
expr_stmt|;
if|if
condition|(
name|GTK_IS_OFFSCREEN_WINDOW
argument_list|(
name|widget
argument_list|)
condition|)
block|{
name|GdkPixbuf
modifier|*
name|tmp
decl_stmt|;
name|tmp
operator|=
name|add_border_to_shot
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|create_shadowed_pixbuf
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
return|return
name|pixbuf
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|shooter_get_foreground (GimpRGB * color)
name|shooter_get_foreground
parameter_list|(
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|color
operator|->
name|r
operator|=
name|color
operator|->
name|g
operator|=
name|color
operator|->
name|b
operator|=
literal|0.0
expr_stmt|;
name|color
operator|->
name|a
operator|=
literal|1.0
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|shooter_get_background (GimpRGB * color)
name|shooter_get_background
parameter_list|(
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|color
operator|->
name|r
operator|=
name|color
operator|->
name|g
operator|=
name|color
operator|->
name|b
operator|=
literal|1.0
expr_stmt|;
name|color
operator|->
name|a
operator|=
literal|1.0
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|shooter_standard_help (const gchar * help_id,gpointer help_data)
name|shooter_standard_help
parameter_list|(
specifier|const
name|gchar
modifier|*
name|help_id
parameter_list|,
name|gpointer
name|help_data
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
DECL|function|shooter_ensure_modules (void)
name|shooter_ensure_modules
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GimpModuleDB
modifier|*
name|module_db
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|module_db
condition|)
block|{
name|gchar
modifier|*
name|config
init|=
name|gimp_config_build_plug_in_path
argument_list|(
literal|"modules"
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|path
init|=
name|gimp_config_path_expand
argument_list|(
name|config
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|module_db
operator|=
name|gimp_module_db_new
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_module_db_load
argument_list|(
name|module_db
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|config
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|int
DECL|function|main (int argc,char ** argv)
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|GList
modifier|*
name|toplevels
decl_stmt|;
name|GList
modifier|*
name|node
decl_stmt|;
name|g_set_application_name
argument_list|(
literal|"GIMP documentation shooter"
argument_list|)
expr_stmt|;
comment|/* If there's no DISPLAY, we silently error out.    * We don't want to break headless builds.    */
if|if
condition|(
operator|!
name|gtk_init_check
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|)
condition|)
return|return
name|EXIT_SUCCESS
return|;
name|units_init
argument_list|()
expr_stmt|;
name|gimp_widgets_init
argument_list|(
name|shooter_standard_help
argument_list|,
name|shooter_get_foreground
argument_list|,
name|shooter_get_background
argument_list|,
name|shooter_ensure_modules
argument_list|)
expr_stmt|;
name|toplevels
operator|=
name|get_all_widgets
argument_list|()
expr_stmt|;
for|for
control|(
name|node
operator|=
name|toplevels
init|;
name|node
condition|;
name|node
operator|=
name|g_list_next
argument_list|(
name|node
argument_list|)
control|)
block|{
name|WidgetInfo
modifier|*
name|info
init|=
name|node
operator|->
name|data
decl_stmt|;
name|GdkPixbuf
modifier|*
name|screenshot
init|=
name|NULL
decl_stmt|;
name|gtk_widget_show
argument_list|(
name|info
operator|->
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|info
operator|->
name|widget
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
name|screenshot
operator|=
name|take_window_shot
argument_list|(
name|info
operator|->
name|widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|screenshot
condition|)
block|{
name|gchar
modifier|*
name|filename
decl_stmt|;
name|filename
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s.png"
argument_list|,
name|info
operator|->
name|name
argument_list|)
expr_stmt|;
name|gdk_pixbuf_save
argument_list|(
name|screenshot
argument_list|,
name|filename
argument_list|,
literal|"png"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|screenshot
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_hide
argument_list|(
name|info
operator|->
name|widget
argument_list|)
expr_stmt|;
block|}
return|return
name|EXIT_SUCCESS
return|;
block|}
end_function

end_unit

