begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"gcg.h"
end_include

begin_decl_stmt
DECL|variable|package_hash
specifier|static
name|GHashTable
modifier|*
name|package_hash
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|def_list
specifier|static
name|GSList
modifier|*
name|def_list
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
DECL|function|init_db (void)
name|void
name|init_db
parameter_list|(
name|void
parameter_list|)
block|{
name|package_hash
operator|=
name|g_hash_table_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|get_type (Package * pkg,Id name)
name|PrimType
modifier|*
name|get_type
parameter_list|(
name|Package
modifier|*
name|pkg
parameter_list|,
name|Id
name|name
parameter_list|)
block|{
if|if
condition|(
name|pkg
condition|)
return|return
name|g_hash_table_lookup
argument_list|(
name|pkg
operator|->
name|type_hash
argument_list|,
name|name
argument_list|)
return|;
else|else
return|return
name|NULL
return|;
block|}
end_function

begin_function
DECL|function|put_type (PrimType * t)
name|void
name|put_type
parameter_list|(
name|PrimType
modifier|*
name|t
parameter_list|)
block|{
if|if
condition|(
name|t
operator|->
name|module
operator|&&
name|t
operator|->
name|module
operator|->
name|package
condition|)
name|g_hash_table_insert
argument_list|(
name|t
operator|->
name|module
operator|->
name|package
operator|->
name|type_hash
argument_list|,
operator|(
name|gpointer
operator|)
name|t
operator|->
name|name
argument_list|,
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|put_def (Def * d)
name|void
name|put_def
parameter_list|(
name|Def
modifier|*
name|d
parameter_list|)
block|{
name|def_list
operator|=
name|g_slist_append
argument_list|(
name|def_list
argument_list|,
name|d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|get_pkg (Id pkgname)
name|Package
modifier|*
name|get_pkg
parameter_list|(
name|Id
name|pkgname
parameter_list|)
block|{
return|return
name|g_hash_table_lookup
argument_list|(
name|package_hash
argument_list|,
name|pkgname
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|put_pkg (Package * pkg)
name|void
name|put_pkg
parameter_list|(
name|Package
modifier|*
name|pkg
parameter_list|)
block|{
name|g_hash_table_insert
argument_list|(
name|package_hash
argument_list|,
operator|(
name|gpointer
operator|)
name|pkg
operator|->
name|name
argument_list|,
name|pkg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|get_mod (Package * pkg,Id modname)
name|Module
modifier|*
name|get_mod
parameter_list|(
name|Package
modifier|*
name|pkg
parameter_list|,
name|Id
name|modname
parameter_list|)
block|{
if|if
condition|(
name|pkg
condition|)
return|return
name|g_hash_table_lookup
argument_list|(
name|pkg
operator|->
name|mod_hash
argument_list|,
name|modname
argument_list|)
return|;
else|else
return|return
name|NULL
return|;
block|}
end_function

begin_function
DECL|function|put_mod (Module * m)
name|void
name|put_mod
parameter_list|(
name|Module
modifier|*
name|m
parameter_list|)
block|{
if|if
condition|(
name|m
operator|->
name|package
operator|&&
name|m
operator|->
name|name
condition|)
name|g_hash_table_insert
argument_list|(
name|m
operator|->
name|package
operator|->
name|mod_hash
argument_list|,
operator|(
name|gpointer
operator|)
name|m
operator|->
name|name
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|foreach_def (DefFunc f,gpointer user_data)
name|void
name|foreach_def
parameter_list|(
name|DefFunc
name|f
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GSList
modifier|*
name|l
init|=
name|def_list
decl_stmt|;
while|while
condition|(
name|l
condition|)
block|{
name|f
argument_list|(
name|l
operator|->
name|data
argument_list|,
name|user_data
argument_list|)
expr_stmt|;
name|l
operator|=
name|l
operator|->
name|next
expr_stmt|;
block|}
block|}
end_function

end_unit

