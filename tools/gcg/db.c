begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"gcg.h"
end_include

begin_decl_stmt
DECL|variable|module_hash
specifier|static
name|GHashTable
modifier|*
name|module_hash
decl_stmt|;
end_decl_stmt

begin_function
DECL|function|init_db (void)
name|void
name|init_db
parameter_list|(
name|void
parameter_list|)
block|{
name|module_hash
operator|=
name|g_hash_table_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|get_type (Id modname,Id name)
name|PrimType
modifier|*
name|get_type
parameter_list|(
name|Id
name|modname
parameter_list|,
name|Id
name|name
parameter_list|)
block|{
name|Module
modifier|*
name|m
init|=
name|get_mod
argument_list|(
name|modname
argument_list|)
decl_stmt|;
name|PrimType
modifier|*
name|p
init|=
name|g_hash_table_lookup
argument_list|(
name|m
operator|->
name|decl_hash
argument_list|,
name|name
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|p
condition|)
block|{
name|p
operator|=
name|g_new
argument_list|(
name|PrimType
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|p
operator|->
name|module
operator|=
name|m
expr_stmt|;
name|p
operator|->
name|name
operator|=
name|name
expr_stmt|;
name|p
operator|->
name|kind
operator|=
name|TYPE_INVALID
expr_stmt|;
name|p
operator|->
name|decl_header
operator|=
name|NULL
expr_stmt|;
name|p
operator|->
name|def_header
operator|=
name|NULL
expr_stmt|;
name|p
operator|->
name|definition
operator|=
name|NULL
expr_stmt|;
name|g_hash_table_insert
argument_list|(
name|m
operator|->
name|decl_hash
argument_list|,
name|name
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
return|return
name|p
return|;
block|}
end_function

begin_function
DECL|function|put_def (Def * d)
name|void
name|put_def
parameter_list|(
name|Def
modifier|*
name|d
parameter_list|)
block|{
name|PrimType
modifier|*
name|t
init|=
name|d
operator|->
name|type
decl_stmt|;
name|g_assert
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|t
operator|->
name|definition
operator|=
name|d
expr_stmt|;
block|}
end_function

begin_function
DECL|function|get_def (Id modname,Id type)
name|Def
modifier|*
name|get_def
parameter_list|(
name|Id
name|modname
parameter_list|,
name|Id
name|type
parameter_list|)
block|{
name|PrimType
modifier|*
name|t
init|=
name|get_type
argument_list|(
name|modname
argument_list|,
name|type
argument_list|)
decl_stmt|;
name|g_assert
argument_list|(
name|t
argument_list|)
expr_stmt|;
return|return
name|t
operator|->
name|definition
return|;
block|}
end_function

begin_function
DECL|function|get_mod (Id modname)
name|Module
modifier|*
name|get_mod
parameter_list|(
name|Id
name|modname
parameter_list|)
block|{
name|Module
modifier|*
name|m
init|=
name|g_hash_table_lookup
argument_list|(
name|module_hash
argument_list|,
name|modname
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|m
condition|)
block|{
name|m
operator|=
name|g_new
argument_list|(
name|Module
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|m
operator|->
name|name
operator|=
name|modname
expr_stmt|;
name|m
operator|->
name|decl_hash
operator|=
name|g_hash_table_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|m
operator|->
name|common_header
operator|=
name|NULL
expr_stmt|;
name|g_hash_table_insert
argument_list|(
name|module_hash
argument_list|,
name|modname
argument_list|,
name|m
argument_list|)
expr_stmt|;
block|}
return|return
name|m
return|;
block|}
end_function

begin_typedef
DECL|struct|__anon279cbaeb0108
typedef|typedef
struct|struct
block|{
DECL|member|f
name|DefFunc
name|f
decl_stmt|;
DECL|member|user_data
name|gpointer
name|user_data
decl_stmt|;
DECL|typedef|DFEdata
block|}
name|DFEdata
typedef|;
end_typedef

begin_function
DECL|function|dfe_bar (gpointer key,gpointer p,gpointer foo)
name|void
name|dfe_bar
parameter_list|(
name|gpointer
name|key
parameter_list|,
name|gpointer
name|p
parameter_list|,
name|gpointer
name|foo
parameter_list|)
block|{
name|PrimType
modifier|*
name|t
init|=
name|p
decl_stmt|;
name|DFEdata
modifier|*
name|d
init|=
name|foo
decl_stmt|;
if|if
condition|(
name|t
operator|->
name|definition
condition|)
call|(
name|d
operator|->
name|f
call|)
argument_list|(
name|t
operator|->
name|definition
argument_list|,
name|d
operator|->
name|user_data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|dfe_foo (gpointer key,gpointer p,gpointer dfed)
name|void
name|dfe_foo
parameter_list|(
name|gpointer
name|key
parameter_list|,
name|gpointer
name|p
parameter_list|,
name|gpointer
name|dfed
parameter_list|)
block|{
name|Module
modifier|*
name|m
init|=
name|p
decl_stmt|;
name|g_hash_table_foreach
argument_list|(
name|m
operator|->
name|decl_hash
argument_list|,
name|dfe_bar
argument_list|,
name|dfed
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|foreach_def (DefFunc f,gpointer user_data)
name|void
name|foreach_def
parameter_list|(
name|DefFunc
name|f
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|DFEdata
name|d
init|=
block|{
name|f
block|,
name|user_data
block|}
decl_stmt|;
name|g_hash_table_foreach
argument_list|(
name|module_hash
argument_list|,
name|dfe_foo
argument_list|,
operator|&
name|d
argument_list|)
expr_stmt|;
block|}
end_function

begin_empty_stmt
empty_stmt|;
end_empty_stmt

end_unit

