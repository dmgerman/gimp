begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"gcg.h"
end_include

begin_include
include|#
directive|include
file|"output.h"
end_include

begin_include
include|#
directive|include
file|"marshall.h"
end_include

begin_struct
DECL|struct|_SignalType
struct|struct
name|_SignalType
block|{
DECL|member|package
name|Id
name|package
decl_stmt|;
DECL|member|rettype
name|GtkType
name|rettype
decl_stmt|;
DECL|member|argtypes
name|GSList
modifier|*
name|argtypes
decl_stmt|;
block|}
struct|;
end_struct

begin_function
DECL|function|sig_type (Method * m)
name|SignalType
modifier|*
name|sig_type
parameter_list|(
name|Method
modifier|*
name|m
parameter_list|)
block|{
name|SignalType
modifier|*
name|t
init|=
name|g_new
argument_list|(
name|SignalType
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|GSList
modifier|*
name|p
init|=
name|m
operator|->
name|params
decl_stmt|,
modifier|*
name|a
init|=
name|NULL
decl_stmt|;
name|t
operator|->
name|package
operator|=
name|DEF
argument_list|(
name|MEMBER
argument_list|(
name|m
argument_list|)
operator|->
name|my_class
argument_list|)
operator|->
name|type
operator|->
name|module
operator|->
name|name
expr_stmt|;
name|t
operator|->
name|rettype
operator|=
name|marshalling_type
argument_list|(
operator|&
name|m
operator|->
name|ret_type
argument_list|)
expr_stmt|;
while|while
condition|(
name|p
condition|)
block|{
name|Param
modifier|*
name|param
init|=
name|p
operator|->
name|data
decl_stmt|;
name|GtkType
modifier|*
name|t
init|=
name|g_new
argument_list|(
name|GtkType
argument_list|,
literal|1
argument_list|)
decl_stmt|;
operator|*
name|t
operator|=
name|marshalling_type
argument_list|(
operator|&
name|param
operator|->
name|type
argument_list|)
expr_stmt|;
name|a
operator|=
name|g_slist_prepend
argument_list|(
name|a
argument_list|,
name|t
argument_list|)
expr_stmt|;
name|p
operator|=
name|p
operator|->
name|next
expr_stmt|;
block|}
name|a
operator|=
name|g_slist_reverse
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|t
operator|->
name|argtypes
operator|=
name|a
expr_stmt|;
return|return
name|t
return|;
block|}
end_function

begin_function
DECL|function|sig_type_free (SignalType * t)
name|void
name|sig_type_free
parameter_list|(
name|SignalType
modifier|*
name|t
parameter_list|)
block|{
name|GSList
modifier|*
name|l
init|=
name|t
operator|->
name|argtypes
decl_stmt|;
while|while
condition|(
name|l
condition|)
block|{
name|g_free
argument_list|(
name|l
operator|->
name|data
argument_list|)
expr_stmt|;
name|l
operator|=
name|l
operator|->
name|next
expr_stmt|;
block|}
name|g_slist_free
argument_list|(
name|t
operator|->
name|argtypes
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
DECL|function|p_gtype_name (GtkType t,gboolean abbr)
name|PNode
modifier|*
name|p_gtype_name
parameter_list|(
name|GtkType
name|t
parameter_list|,
name|gboolean
name|abbr
parameter_list|)
block|{
DECL|struct|GTypeName
specifier|static
specifier|const
struct|struct
name|GTypeName
block|{
DECL|member|type
name|GtkType
name|type
decl_stmt|;
DECL|member|name
name|Id
name|name
decl_stmt|;
DECL|member|aname
name|Id
name|aname
decl_stmt|;
block|}
name|names
index|[]
init|=
block|{
block|{
name|GTK_TYPE_POINTER
block|,
literal|"POINTER"
block|,
literal|"P"
block|}
block|,
block|{
name|GTK_TYPE_INT
block|,
literal|"INT"
block|,
literal|"I"
block|}
block|,
block|{
name|GTK_TYPE_DOUBLE
block|,
literal|"DOUBLE"
block|,
literal|"D"
block|}
block|,
block|{
name|GTK_TYPE_LONG
block|,
literal|"LONG"
block|,
literal|"L"
block|}
block|,
block|{
name|GTK_TYPE_CHAR
block|,
literal|"CHAR"
block|,
literal|"C"
block|}
block|,
block|{
name|GTK_TYPE_NONE
block|,
literal|"NONE"
block|,
literal|"0"
block|}
block|, 	}
struct|;
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
sizeof|sizeof
argument_list|(
name|names
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|names
index|[
literal|0
index|]
argument_list|)
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|names
index|[
name|i
index|]
operator|.
name|type
operator|==
name|t
condition|)
if|if
condition|(
name|abbr
condition|)
return|return
name|p_str
argument_list|(
name|names
index|[
name|i
index|]
operator|.
name|aname
argument_list|)
return|;
else|else
return|return
name|p_str
argument_list|(
name|names
index|[
name|i
index|]
operator|.
name|name
argument_list|)
return|;
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
DECL|function|p_gtabbr (gpointer p)
name|PNode
modifier|*
name|p_gtabbr
parameter_list|(
name|gpointer
name|p
parameter_list|)
block|{
name|GtkType
modifier|*
name|t
init|=
name|p
decl_stmt|;
return|return
name|p_gtype_name
argument_list|(
operator|*
name|t
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|marshalling_type (Type * t)
name|GtkType
name|marshalling_type
parameter_list|(
name|Type
modifier|*
name|t
parameter_list|)
block|{
name|g_assert
argument_list|(
name|t
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|t
operator|->
name|prim
condition|)
return|return
name|GTK_TYPE_NONE
return|;
name|g_assert
argument_list|(
name|t
operator|->
name|prim
operator|->
name|kind
operator|!=
name|GTK_TYPE_INVALID
argument_list|)
expr_stmt|;
if|if
condition|(
name|t
operator|->
name|indirection
condition|)
return|return
name|GTK_TYPE_POINTER
return|;
switch|switch
condition|(
name|t
operator|->
name|prim
operator|->
name|kind
condition|)
block|{
case|case
name|GTK_TYPE_UINT
case|:
case|case
name|GTK_TYPE_BOOL
case|:
case|case
name|GTK_TYPE_FLAGS
case|:
case|case
name|GTK_TYPE_ENUM
case|:
return|return
name|GTK_TYPE_INT
return|;
case|case
name|GTK_TYPE_STRING
case|:
return|return
name|GTK_TYPE_POINTER
return|;
case|case
name|GTK_TYPE_UCHAR
case|:
return|return
name|GTK_TYPE_CHAR
return|;
case|case
name|GTK_TYPE_ULONG
case|:
return|return
name|GTK_TYPE_LONG
return|;
default|default:
return|return
name|t
operator|->
name|prim
operator|->
name|kind
return|;
block|}
block|}
end_function

begin_function
DECL|function|p_signal_func_name (SignalType * t,PNode * basename)
name|PNode
modifier|*
name|p_signal_func_name
parameter_list|(
name|SignalType
modifier|*
name|t
parameter_list|,
name|PNode
modifier|*
name|basename
parameter_list|)
block|{
return|return
name|p_fmt
argument_list|(
literal|"_~_~_~_~"
argument_list|,
name|p_c_ident
argument_list|(
name|t
operator|->
name|package
argument_list|)
argument_list|,
name|basename
argument_list|,
name|p_gtype_name
argument_list|(
name|t
operator|->
name|rettype
argument_list|,
name|TRUE
argument_list|)
argument_list|,
name|p_for
argument_list|(
name|t
operator|->
name|argtypes
argument_list|,
name|p_gtabbr
argument_list|,
name|p_nil
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|p_signal_marshaller_name (SignalType * t)
name|PNode
modifier|*
name|p_signal_marshaller_name
parameter_list|(
name|SignalType
modifier|*
name|t
parameter_list|)
block|{
return|return
name|p_signal_func_name
argument_list|(
name|t
argument_list|,
name|p_str
argument_list|(
literal|"marshall"
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|p_signal_demarshaller_name (SignalType * t)
name|PNode
modifier|*
name|p_signal_demarshaller_name
parameter_list|(
name|SignalType
modifier|*
name|t
parameter_list|)
block|{
return|return
name|p_signal_func_name
argument_list|(
name|t
argument_list|,
name|p_str
argument_list|(
literal|"demarshall"
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|p_handler_type (SignalType * t)
name|PNode
modifier|*
name|p_handler_type
parameter_list|(
name|SignalType
modifier|*
name|t
parameter_list|)
block|{
return|return
name|p_fmt
argument_list|(
literal|"_~Handler_~_~"
argument_list|,
name|p_str
argument_list|(
name|t
operator|->
name|package
argument_list|)
argument_list|,
name|p_gtype_name
argument_list|(
name|t
operator|->
name|rettype
argument_list|,
name|TRUE
argument_list|)
argument_list|,
name|p_for
argument_list|(
name|t
operator|->
name|argtypes
argument_list|,
name|p_gtabbr
argument_list|,
name|p_nil
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_typedef
DECL|struct|__anon27490af30108
typedef|typedef
struct|struct
block|{
DECL|member|args
name|PNode
modifier|*
name|args
decl_stmt|;
DECL|member|idx
name|gint
name|idx
decl_stmt|;
DECL|typedef|ArgMarshData
block|}
name|ArgMarshData
typedef|;
end_typedef

begin_function
DECL|function|p_arg_marsh (gpointer p,gpointer d)
name|PNode
modifier|*
name|p_arg_marsh
parameter_list|(
name|gpointer
name|p
parameter_list|,
name|gpointer
name|d
parameter_list|)
block|{
name|GtkType
modifier|*
name|t
init|=
name|p
decl_stmt|;
name|ArgMarshData
modifier|*
name|data
init|=
name|d
decl_stmt|;
return|return
name|p_fmt
argument_list|(
literal|"\t\tGTK_VALUE_~(~[~]),\n"
argument_list|,
name|p_gtype_name
argument_list|(
operator|*
name|t
argument_list|,
name|FALSE
argument_list|)
argument_list|,
name|data
operator|->
name|args
argument_list|,
name|p_fmt
argument_list|(
literal|"%d"
argument_list|,
name|data
operator|->
name|idx
operator|++
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
DECL|function|p_demarshaller (SignalType * t)
name|PNode
modifier|*
name|p_demarshaller
parameter_list|(
name|SignalType
modifier|*
name|t
parameter_list|)
block|{
name|gint
name|idx
init|=
literal|0
decl_stmt|;
return|return
name|p_lst
argument_list|(
operator|(
name|t
operator|->
name|rettype
operator|==
name|GTK_TYPE_NONE
operator|)
condition|?
name|p_fmt
argument_list|(
literal|"\t*(GTK_RETLOC_~(args[~])) =\n"
argument_list|,
name|p_gtype_name
argument_list|(
name|t
operator|->
name|rettype
argument_list|,
name|FALSE
argument_list|)
argument_list|,
name|p_prf
argument_list|(
literal|"%d"
argument_list|,
name|g_slist_length
argument_list|(
name|t
operator|->
name|argtypes
argument_list|)
argument_list|)
argument_list|)
else|:
name|p_nil
argument_list|,
name|p_fmt
argument_list|(
literal|"\t~(object,\n"
literal|"~"
literal|"\tuser_data);\n"
argument_list|,
name|p_cast
argument_list|(
name|p_handler_type
argument_list|(
name|t
argument_list|)
argument_list|,
name|p_str
argument_list|(
literal|"func"
argument_list|)
argument_list|)
argument_list|,
name|p_for
argument_list|(
name|t
operator|->
name|argtypes
argument_list|,
name|p_arg_marsh
argument_list|,
operator|&
name|idx
argument_list|)
argument_list|)
argument_list|,
name|p_nil
argument_list|)
return|;
block|}
end_function

end_unit

