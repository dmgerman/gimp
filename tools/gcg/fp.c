begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"output.h"
end_include

begin_function
DECL|function|fparams (const gchar * fmt,...)
name|FunParams
modifier|*
name|fparams
parameter_list|(
specifier|const
name|gchar
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
block|{
name|FunParams
modifier|*
name|first
decl_stmt|;
name|FunParams
modifier|*
modifier|*
name|last
init|=
operator|&
name|first
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|fmt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|fmt
index|[
name|i
index|]
condition|;
name|i
operator|++
control|)
switch|switch
condition|(
name|fmt
index|[
name|i
index|]
condition|)
block|{
name|FunParams
modifier|*
name|f
decl_stmt|;
name|GSList
modifier|*
name|l
decl_stmt|;
case|case
literal|'p'
case|:
name|l
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|GSList
operator|*
argument_list|)
expr_stmt|;
while|while
condition|(
name|l
condition|)
block|{
name|Param
modifier|*
name|p
init|=
name|l
operator|->
name|data
decl_stmt|;
name|f
operator|=
name|g_new
argument_list|(
name|FunParams
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|f
operator|->
name|type
operator|=
name|p
operator|->
name|type
expr_stmt|;
name|f
operator|->
name|name
operator|=
name|p_c_ident
argument_list|(
name|p
operator|->
name|name
argument_list|)
expr_stmt|;
name|f
operator|->
name|doc
operator|=
name|p_nil
expr_stmt|;
operator|*
name|last
operator|=
name|f
expr_stmt|;
name|last
operator|=
operator|&
name|f
operator|->
name|next
expr_stmt|;
name|l
operator|=
name|l
operator|->
name|next
expr_stmt|;
block|}
break|break;
case|case
literal|'t'
case|:
name|f
operator|=
name|g_new
argument_list|(
name|FunParams
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|f
operator|->
name|type
operator|=
operator|*
name|va_arg
argument_list|(
name|args
argument_list|,
name|Type
operator|*
argument_list|)
expr_stmt|;
name|f
operator|->
name|name
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|PNode
operator|*
argument_list|)
expr_stmt|;
name|p_ref
argument_list|(
name|f
operator|->
name|name
argument_list|)
expr_stmt|;
name|f
operator|->
name|doc
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|PNode
operator|*
argument_list|)
expr_stmt|;
name|p_ref
argument_list|(
name|f
operator|->
name|doc
argument_list|)
expr_stmt|;
operator|*
name|last
operator|=
name|f
expr_stmt|;
name|last
operator|=
operator|&
name|f
operator|->
name|next
expr_stmt|;
break|break;
case|case
literal|'s'
case|:
name|f
operator|=
name|g_new
argument_list|(
name|FunParams
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|f
operator|->
name|type
operator|.
name|prim
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|PrimType
operator|*
argument_list|)
expr_stmt|;
name|f
operator|->
name|type
operator|.
name|indirection
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|gint
argument_list|)
expr_stmt|;
name|f
operator|->
name|type
operator|.
name|notnull
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|gboolean
argument_list|)
expr_stmt|;
name|f
operator|->
name|name
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|PNode
operator|*
argument_list|)
expr_stmt|;
name|p_ref
argument_list|(
name|f
operator|->
name|name
argument_list|)
expr_stmt|;
name|f
operator|->
name|doc
operator|=
name|va_arg
argument_list|(
name|args
argument_list|,
name|PNode
operator|*
argument_list|)
expr_stmt|;
name|p_ref
argument_list|(
name|f
operator|->
name|doc
argument_list|)
expr_stmt|;
operator|*
name|last
operator|=
name|f
expr_stmt|;
name|last
operator|=
operator|&
name|f
operator|->
name|next
expr_stmt|;
break|break;
block|}
operator|*
name|last
operator|=
name|NULL
expr_stmt|;
return|return
name|first
return|;
block|}
end_function

begin_function
DECL|function|fparams_free (FunParams * f)
name|void
name|fparams_free
parameter_list|(
name|FunParams
modifier|*
name|f
parameter_list|)
block|{
while|while
condition|(
name|f
condition|)
block|{
name|FunParams
modifier|*
name|n
init|=
name|f
operator|->
name|next
decl_stmt|;
name|p_unref
argument_list|(
name|f
operator|->
name|name
argument_list|)
expr_stmt|;
name|p_unref
argument_list|(
name|f
operator|->
name|doc
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|f
argument_list|)
expr_stmt|;
name|f
operator|=
name|n
expr_stmt|;
block|}
block|}
end_function

end_unit

