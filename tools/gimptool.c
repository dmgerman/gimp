begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* gimptool in C  * Copyright (C) 2001-2007 Tor Lillqvist  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_comment
comment|/*  * Gimptool rewritten in C, originally for Win32, where end-users who  * might want to build and install a plug-in from source don't  * necessarily have any Bourne-compatible shell to run the gimptool  * script in. Later fixed up to replace the gimptool script on all  * platforms.  *  * Yes, this program leaks dynamically allocated strings without  * hesitation. So what, it runs only for a minimal time.  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<glib-object.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_include
include|#
directive|include
file|"libgimpbase/gimpwin32-io.h"
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_decl_stmt
DECL|variable|silent
specifier|static
name|gboolean
name|silent
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|dry_run
specifier|static
name|gboolean
name|dry_run
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|prefix
specifier|static
name|gchar
modifier|*
name|prefix
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|exec_prefix
specifier|static
specifier|const
name|gchar
modifier|*
name|exec_prefix
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|msvc_syntax
specifier|static
name|gboolean
name|msvc_syntax
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|env_cc
specifier|static
specifier|const
name|gchar
modifier|*
name|env_cc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|env_cflags
specifier|static
specifier|const
name|gchar
modifier|*
name|env_cflags
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|env_ldflags
specifier|static
specifier|const
name|gchar
modifier|*
name|env_ldflags
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|env_libs
specifier|static
specifier|const
name|gchar
modifier|*
name|env_libs
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_define
DECL|macro|EXEEXT
define|#
directive|define
name|EXEEXT
value|".exe"
end_define

begin_else
else|#
directive|else
end_else

begin_define
DECL|macro|EXEEXT
define|#
directive|define
name|EXEEXT
value|""
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_define
DECL|macro|COPY
define|#
directive|define
name|COPY
value|win32_command ("copy")
end_define

begin_define
DECL|macro|REMOVE
define|#
directive|define
name|REMOVE
value|win32_command ("del")
end_define

begin_else
else|#
directive|else
end_else

begin_define
DECL|macro|COPY
define|#
directive|define
name|COPY
value|"cp"
end_define

begin_define
DECL|macro|REMOVE
define|#
directive|define
name|REMOVE
value|"rm -f"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_struct
DECL|struct|__anon2a2a9ced0108
specifier|static
struct|struct
block|{
DECL|member|option
specifier|const
name|gchar
modifier|*
name|option
decl_stmt|;
DECL|member|value
specifier|const
name|gchar
modifier|*
name|value
decl_stmt|;
DECL|variable|dirs
block|}
name|dirs
index|[]
init|=
block|{
block|{
literal|"prefix"
block|,
name|PREFIX
block|}
block|,
block|{
literal|"exec-prefix"
block|,
name|EXEC_PREFIX
block|}
block|,
block|{
literal|"bindir"
block|,
name|BINDIR
block|}
block|,
block|{
literal|"sbindir"
block|,
name|SBINDIR
block|}
block|,
block|{
literal|"libexecdir"
block|,
name|LIBEXECDIR
block|}
block|,
block|{
literal|"datadir"
block|,
name|DATADIR
block|}
block|,
block|{
literal|"datarootdir"
block|,
name|DATAROOTDIR
block|}
block|,
block|{
literal|"sysconfdir"
block|,
name|SYSCONFDIR
block|}
block|,
block|{
literal|"sharedstatedir"
block|,
name|SHAREDSTATEDIR
block|}
block|,
block|{
literal|"localstatedir"
block|,
name|LOCALSTATEDIR
block|}
block|,
block|{
literal|"libdir"
block|,
name|LIBDIR
block|}
block|,
block|{
literal|"infodir"
block|,
name|INFODIR
block|}
block|,
block|{
literal|"mandir"
block|,
name|MANDIR
block|}
block|,
if|#
directive|if
literal|0
comment|/* For --includedir we want the includedir of the developer package,    * not an includedir under the runtime installation prefix.    */
block|{ "includedir",     INCLUDEDIR     },
endif|#
directive|endif
block|{
literal|"gimpplugindir"
block|,
name|GIMPPLUGINDIR
block|}
block|,
block|{
literal|"gimpdatadir"
block|,
name|GIMPDATADIR
block|}
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|void
name|usage
argument_list|(
name|int
name|exit_status
argument_list|)
name|G_GNUC_NORETURN
decl_stmt|;
end_decl_stmt

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|win32_command (const gchar * command)
name|win32_command
parameter_list|(
specifier|const
name|gchar
modifier|*
name|command
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|comspec
init|=
name|getenv
argument_list|(
literal|"COMSPEC"
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|comspec
condition|)
name|comspec
operator|=
literal|"cmd.exe"
expr_stmt|;
return|return
name|g_strdup_printf
argument_list|(
literal|"%s /c %s"
argument_list|,
name|comspec
argument_list|,
name|command
argument_list|)
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|gboolean
DECL|function|starts_with_dir (const gchar * string,const gchar * test)
name|starts_with_dir
parameter_list|(
specifier|const
name|gchar
modifier|*
name|string
parameter_list|,
specifier|const
name|gchar
modifier|*
name|test
parameter_list|)
block|{
return|return
name|g_str_has_prefix
argument_list|(
name|string
argument_list|,
name|g_strconcat
argument_list|(
name|test
argument_list|,
literal|"/"
argument_list|,
name|NULL
argument_list|)
argument_list|)
operator|||
name|strcmp
argument_list|(
name|string
argument_list|,
name|test
argument_list|)
operator|==
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|one_line_output (const gchar * program,const gchar * args)
name|one_line_output
parameter_list|(
specifier|const
name|gchar
modifier|*
name|program
parameter_list|,
specifier|const
name|gchar
modifier|*
name|args
parameter_list|)
block|{
name|gchar
modifier|*
name|command
init|=
name|g_strconcat
argument_list|(
name|program
argument_list|,
literal|" "
argument_list|,
name|args
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|FILE
modifier|*
name|pipe
init|=
name|popen
argument_list|(
name|command
argument_list|,
literal|"r"
argument_list|)
decl_stmt|;
name|gchar
name|line
index|[
literal|1000
index|]
decl_stmt|;
if|if
condition|(
name|pipe
operator|==
name|NULL
condition|)
block|{
name|g_printerr
argument_list|(
literal|"Cannot run '%s'\n"
argument_list|,
name|command
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|fgets
argument_list|(
name|line
argument_list|,
sizeof|sizeof
argument_list|(
name|line
argument_list|)
argument_list|,
name|pipe
argument_list|)
operator|==
name|NULL
condition|)
name|line
index|[
literal|0
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|line
argument_list|)
operator|>
literal|0
operator|&&
name|line
index|[
name|strlen
argument_list|(
name|line
argument_list|)
operator|-
literal|1
index|]
operator|==
literal|'\n'
condition|)
name|line
index|[
name|strlen
argument_list|(
name|line
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|line
argument_list|)
operator|>
literal|0
operator|&&
name|line
index|[
name|strlen
argument_list|(
name|line
argument_list|)
operator|-
literal|1
index|]
operator|==
literal|'\r'
condition|)
name|line
index|[
name|strlen
argument_list|(
name|line
argument_list|)
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|pclose
argument_list|(
name|pipe
argument_list|)
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|line
argument_list|)
operator|==
literal|0
condition|)
block|{
name|g_printerr
argument_list|(
literal|"No output from '%s'\n"
argument_list|,
name|command
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
return|return
name|g_strdup
argument_list|(
name|line
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|pkg_config (const gchar * args)
name|pkg_config
parameter_list|(
specifier|const
name|gchar
modifier|*
name|args
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
if|if
condition|(
name|msvc_syntax
condition|)
return|return
name|one_line_output
argument_list|(
literal|"pkg-config --msvc-syntax"
argument_list|,
name|args
argument_list|)
return|;
endif|#
directive|endif
return|return
name|one_line_output
argument_list|(
literal|"pkg-config"
argument_list|,
name|args
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|gchar
modifier|*
DECL|function|get_runtime_prefix (gchar slash)
name|get_runtime_prefix
parameter_list|(
name|gchar
name|slash
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
comment|/* Don't use the developer package prefix, but deduce the    * installation-time prefix from where gimp-x.y.exe can be found.    */
name|gchar
modifier|*
name|path
decl_stmt|;
name|gchar
modifier|*
name|p
decl_stmt|,
modifier|*
name|r
decl_stmt|;
name|path
operator|=
name|g_find_program_in_path
argument_list|(
literal|"gimp-"
name|GIMP_APP_VERSION
literal|".exe"
argument_list|)
expr_stmt|;
if|if
condition|(
name|path
operator|==
name|NULL
condition|)
name|path
operator|=
name|g_find_program_in_path
argument_list|(
literal|"gimp.exe"
argument_list|)
expr_stmt|;
if|if
condition|(
name|path
operator|!=
name|NULL
condition|)
block|{
name|r
operator|=
name|strrchr
argument_list|(
name|path
argument_list|,
name|G_DIR_SEPARATOR
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|!=
name|NULL
condition|)
block|{
operator|*
name|r
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|strlen
argument_list|(
name|path
argument_list|)
operator|>=
literal|4
operator|&&
name|g_ascii_strcasecmp
argument_list|(
name|r
operator|-
literal|4
argument_list|,
name|G_DIR_SEPARATOR_S
literal|"bin"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|r
index|[
operator|-
literal|4
index|]
operator|=
literal|'\0'
expr_stmt|;
name|prefix
operator|=
name|path
expr_stmt|;
if|if
condition|(
name|slash
operator|==
literal|'/'
condition|)
block|{
comment|/* Use forward slashes, less quoting trouble in Makefiles */
while|while
condition|(
operator|(
name|p
operator|=
name|strchr
argument_list|(
name|prefix
argument_list|,
literal|'\\'
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
operator|*
name|p
operator|=
literal|'/'
expr_stmt|;
block|}
return|return
name|prefix
return|;
block|}
block|}
block|}
name|g_printerr
argument_list|(
literal|"Cannot determine GIMP "
name|GIMP_APP_VERSION
literal|" installation location\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* On Unix assume the executable package is in the same prefix as the developer stuff */
return|return
name|pkg_config
argument_list|(
literal|"--variable=prefix gimp-2.0"
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
specifier|const
name|gchar
modifier|*
DECL|function|get_exec_prefix (gchar slash)
name|get_exec_prefix
parameter_list|(
name|gchar
name|slash
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
if|if
condition|(
name|exec_prefix
operator|!=
name|NULL
condition|)
return|return
name|exec_prefix
return|;
comment|/* On Win32, exec_prefix is always same as prefix. Or is it? Maybe not,    * but at least in tml's prebuilt stuff it is. If somebody else does    * it another way, feel free to hack this.    */
return|return
operator|(
name|exec_prefix
operator|=
name|get_runtime_prefix
argument_list|(
name|slash
argument_list|)
operator|)
return|;
else|#
directive|else
return|return
name|EXEC_PREFIX
return|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
specifier|const
name|gchar
modifier|*
DECL|function|expand_and_munge (const gchar * value)
name|expand_and_munge
parameter_list|(
specifier|const
name|gchar
modifier|*
name|value
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|retval
decl_stmt|;
if|if
condition|(
name|starts_with_dir
argument_list|(
name|value
argument_list|,
literal|"${prefix}"
argument_list|)
condition|)
name|retval
operator|=
name|g_strconcat
argument_list|(
name|PREFIX
argument_list|,
name|value
operator|+
name|strlen
argument_list|(
literal|"${prefix}"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|starts_with_dir
argument_list|(
name|value
argument_list|,
literal|"${exec_prefix}"
argument_list|)
condition|)
name|retval
operator|=
name|g_strconcat
argument_list|(
name|EXEC_PREFIX
argument_list|,
name|value
operator|+
name|strlen
argument_list|(
literal|"${exec_prefix}"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
else|else
name|retval
operator|=
name|g_strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|starts_with_dir
argument_list|(
name|retval
argument_list|,
name|EXEC_PREFIX
argument_list|)
condition|)
name|retval
operator|=
name|g_strconcat
argument_list|(
name|get_exec_prefix
argument_list|(
literal|'/'
argument_list|)
argument_list|,
name|retval
operator|+
name|strlen
argument_list|(
name|EXEC_PREFIX
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|starts_with_dir
argument_list|(
name|retval
argument_list|,
name|PREFIX
argument_list|)
condition|)
name|retval
operator|=
name|g_strconcat
argument_list|(
name|get_runtime_prefix
argument_list|(
literal|'/'
argument_list|)
argument_list|,
name|retval
operator|+
name|strlen
argument_list|(
name|PREFIX
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|retval
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|find_out_env_flags (void)
name|find_out_env_flags
parameter_list|(
name|void
parameter_list|)
block|{
name|gchar
modifier|*
name|p
decl_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|getenv
argument_list|(
literal|"CC"
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
name|env_cc
operator|=
name|p
expr_stmt|;
elseif|else
if|if
condition|(
name|msvc_syntax
condition|)
name|env_cc
operator|=
literal|"cl -MD"
expr_stmt|;
else|else
name|env_cc
operator|=
name|CC
expr_stmt|;
if|if
condition|(
name|g_ascii_strncasecmp
argument_list|(
name|env_cc
argument_list|,
literal|"cl"
argument_list|,
literal|2
argument_list|)
operator|==
literal|0
condition|)
name|msvc_syntax
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|getenv
argument_list|(
literal|"CFLAGS"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|env_cflags
operator|=
name|p
expr_stmt|;
else|else
name|env_cflags
operator|=
literal|""
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|getenv
argument_list|(
literal|"LDFLAGS"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
name|env_ldflags
operator|=
name|p
expr_stmt|;
else|else
name|env_ldflags
operator|=
literal|""
expr_stmt|;
if|if
condition|(
operator|(
name|p
operator|=
name|getenv
argument_list|(
literal|"LIBS"
argument_list|)
operator|)
operator|!=
name|NULL
operator|&&
operator|*
name|p
operator|!=
literal|'\0'
condition|)
name|env_libs
operator|=
name|p
expr_stmt|;
else|else
name|env_libs
operator|=
literal|""
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|usage (int exit_status)
name|usage
parameter_list|(
name|int
name|exit_status
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"\ Usage: gimptool-2.0 [OPTION]...\n\ \n\ General options:\n\   --help                  print this message\n\   --quiet, --silent       don't echo build commands\n\   --version               print the version of GIMP associated with this script\n\   -n, --just-print, --dry-run, --recon\n\                           don't actually run any commands; just print them\n\ Developer options:\n\   --cflags                print the compiler flags that are necessary to\n\                           compile a plug-in\n\   --libs                  print the linker flags that are necessary to link a\n\                           plug-in\n\   --prefix=PREFIX         use PREFIX instead of the installation prefix that\n\                           GIMP was built when computing the output for --cflags\n\                           and --libs\n\   --exec-prefix=PREFIX    use PREFIX instead of the installation exec prefix\n\                           that GIMP was built when computing the output for\n\                           --cflags and --libs\n\   --msvc-syntax           print flags in MSVC syntax\n\ \n\ Installation directory options:\n\   --prefix --exec-prefix --bindir --sbindir --libexecdir --datadir --sysconfdir\n\   --sharedstatedir --localstatedir --libdir --infodir --mandir --includedir\n\   --gimpplugindir --gimpdatadir\n\ \n\ The --cflags and --libs options can be appended with -noui to get appropriate\n\ settings for plug-ins which do not use GTK+.\n\ \n\ User options:\n\   --build plug-in.c               build a plug-in from a source file\n\   --install plug-in.c             same as --build, but installs the built\n\                                   plug-in as well\n\   --install-bin plug-in           install a compiled plug-in\n\   --install-script script.scm     install a script-fu script\n\ \n\   --uninstall-bin plug-in         remove a plug-in again\n\   --uninstall-script plug-in      remove a script-fu script\n\ \n\ The --install and --uninstall options have \"admin\" counterparts (with\n\ prefix --install-admin instead of --install) that can be used instead to\n\ install/uninstall a plug-in or script in the machine directory instead of a\n\ user directory.\n\ \n\ For plug-ins which do not use GTK+, the --build and --install options can be\n\ appended with -noui for appropriate settings. For plug-ins that use GTK+ but\n\ not libgimpui, append -nogimpui.\n"
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|exit_status
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_includedir (void)
name|get_includedir
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|pkg_config
argument_list|(
literal|"--variable=includedir gimp-2.0"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_includedir (void)
name|do_includedir
parameter_list|(
name|void
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|get_includedir
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_cflags (void)
name|get_cflags
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|pkg_config
argument_list|(
literal|"--cflags gimpui-2.0"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_cflags (void)
name|do_cflags
parameter_list|(
name|void
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|get_cflags
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_cflags_noui (void)
name|get_cflags_noui
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|pkg_config
argument_list|(
literal|"--cflags gimp-2.0"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_cflags_noui (void)
name|do_cflags_noui
parameter_list|(
name|void
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|get_cflags_noui
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_cflags_nogimpui (void)
name|get_cflags_nogimpui
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|pkg_config
argument_list|(
literal|"--cflags gimp-2.0 gtk+-2.0"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_cflags_nogimpui (void)
name|do_cflags_nogimpui
parameter_list|(
name|void
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|get_cflags_nogimpui
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_libs (void)
name|get_libs
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|pkg_config
argument_list|(
literal|"--libs gimpui-2.0"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_libs (void)
name|do_libs
parameter_list|(
name|void
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|get_libs
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_libs_noui (void)
name|get_libs_noui
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|pkg_config
argument_list|(
literal|"--libs gimp-2.0"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_libs_noui (void)
name|do_libs_noui
parameter_list|(
name|void
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|get_libs_noui
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_libs_nogimpui (void)
name|get_libs_nogimpui
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|pkg_config
argument_list|(
literal|"--libs gimp-2.0 gtk+-2.0"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_libs_nogimpui (void)
name|do_libs_nogimpui
parameter_list|(
name|void
parameter_list|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|get_libs_nogimpui
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|maybe_run (gchar * cmd)
name|maybe_run
parameter_list|(
name|gchar
modifier|*
name|cmd
parameter_list|)
block|{
if|if
condition|(
operator|!
name|silent
condition|)
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|cmd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|dry_run
condition|)
name|system
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_build_2 (const gchar * cflags,const gchar * libs,const gchar * install_dir,const gchar * what)
name|do_build_2
parameter_list|(
specifier|const
name|gchar
modifier|*
name|cflags
parameter_list|,
specifier|const
name|gchar
modifier|*
name|libs
parameter_list|,
specifier|const
name|gchar
modifier|*
name|install_dir
parameter_list|,
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|gchar
modifier|*
name|cmd
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|dest_dir
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|output_flag
decl_stmt|;
name|gchar
modifier|*
name|dest_exe
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|here_comes_linker_flags
init|=
literal|""
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|windows_subsystem_flag
init|=
literal|""
decl_stmt|;
name|gchar
modifier|*
name|p
decl_stmt|,
modifier|*
name|q
decl_stmt|;
if|if
condition|(
name|install_dir
operator|!=
name|NULL
condition|)
name|dest_dir
operator|=
name|g_strconcat
argument_list|(
name|install_dir
argument_list|,
literal|"/"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
else|else
name|dest_dir
operator|=
literal|""
expr_stmt|;
name|dest_exe
operator|=
name|g_strdup
argument_list|(
name|what
argument_list|)
expr_stmt|;
name|p
operator|=
name|strrchr
argument_list|(
name|dest_exe
argument_list|,
literal|'.'
argument_list|)
expr_stmt|;
if|if
condition|(
name|p
operator|==
name|NULL
operator|||
operator|!
operator|(
name|strcmp
argument_list|(
name|p
argument_list|,
literal|".c"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|p
argument_list|,
literal|".cc"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|p
argument_list|,
literal|".cpp"
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|g_printerr
argument_list|(
literal|"plug-in source %s is not a C or C++ file?\n"
argument_list|,
name|what
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
operator|*
name|p
operator|=
literal|'\0'
expr_stmt|;
name|q
operator|=
name|strrchr
argument_list|(
name|dest_exe
argument_list|,
name|G_DIR_SEPARATOR
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|G_OS_WIN32
block|{
name|gchar
modifier|*
name|r
init|=
name|strrchr
argument_list|(
name|dest_exe
argument_list|,
literal|'/'
argument_list|)
decl_stmt|;
if|if
condition|(
name|r
operator|!=
name|NULL
operator|&&
operator|(
name|q
operator|==
name|NULL
operator|||
name|r
operator|>
name|q
operator|)
condition|)
name|q
operator|=
name|r
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|q
operator|==
name|NULL
condition|)
name|q
operator|=
name|dest_exe
expr_stmt|;
else|else
name|q
operator|++
expr_stmt|;
name|dest_exe
operator|=
name|g_strconcat
argument_list|(
name|q
argument_list|,
name|EXEEXT
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|msvc_syntax
condition|)
block|{
name|output_flag
operator|=
literal|"-Fe"
expr_stmt|;
name|here_comes_linker_flags
operator|=
literal|" -link"
expr_stmt|;
name|windows_subsystem_flag
operator|=
literal|" -subsystem:windows"
expr_stmt|;
block|}
else|else
block|{
name|output_flag
operator|=
literal|"-o "
expr_stmt|;
ifdef|#
directive|ifdef
name|G_OS_WIN32
name|windows_subsystem_flag
operator|=
literal|" -mwindows"
expr_stmt|;
endif|#
directive|endif
block|}
name|cmd
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s %s %s %s%s%s %s%s %s%s %s %s"
argument_list|,
name|env_cc
argument_list|,
name|env_cflags
argument_list|,
name|cflags
argument_list|,
name|output_flag
argument_list|,
name|dest_dir
argument_list|,
name|dest_exe
argument_list|,
name|what
argument_list|,
name|here_comes_linker_flags
argument_list|,
name|env_ldflags
argument_list|,
name|windows_subsystem_flag
argument_list|,
name|libs
argument_list|,
name|env_libs
argument_list|)
expr_stmt|;
name|maybe_run
argument_list|(
name|cmd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_build (const gchar * what)
name|do_build
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build_2
argument_list|(
name|get_cflags
argument_list|()
argument_list|,
name|get_libs
argument_list|()
argument_list|,
name|NULL
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_build_noui (const gchar * what)
name|do_build_noui
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build_2
argument_list|(
name|get_cflags_noui
argument_list|()
argument_list|,
name|get_libs_noui
argument_list|()
argument_list|,
name|NULL
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_build_nogimpui (const gchar * what)
name|do_build_nogimpui
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build
argument_list|(
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_user_plugin_dir (gboolean forward_slashes)
name|get_user_plugin_dir
parameter_list|(
name|gboolean
name|forward_slashes
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
comment|/* In the --install-bin and --uninstall modes we want    * to use backward slashes on Win32, because we invoke    * the COPY and DEL commands directly with system().    */
specifier|const
name|gchar
name|slash
init|=
name|forward_slashes
condition|?
literal|'/'
else|:
literal|'\\'
decl_stmt|;
else|#
directive|else
specifier|const
name|gchar
name|slash
init|=
literal|'/'
decl_stmt|;
endif|#
directive|endif
return|return
name|g_strdup_printf
argument_list|(
literal|"%s%c"
name|GIMPDIR
literal|"%cplug-ins"
argument_list|,
name|g_get_home_dir
argument_list|()
argument_list|,
name|slash
argument_list|,
name|slash
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install (const gchar * what)
name|do_install
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build_2
argument_list|(
name|get_cflags
argument_list|()
argument_list|,
name|get_libs
argument_list|()
argument_list|,
name|get_user_plugin_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_noui (const gchar * what)
name|do_install_noui
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build_2
argument_list|(
name|get_cflags_noui
argument_list|()
argument_list|,
name|get_libs_noui
argument_list|()
argument_list|,
name|get_user_plugin_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_nogimpui (const gchar * what)
name|do_install_nogimpui
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_install
argument_list|(
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_sys_plugin_dir (gboolean forward_slashes)
name|get_sys_plugin_dir
parameter_list|(
name|gboolean
name|forward_slashes
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
specifier|const
name|gchar
name|slash
init|=
name|forward_slashes
condition|?
literal|'/'
else|:
literal|'\\'
decl_stmt|;
else|#
directive|else
specifier|const
name|gchar
name|slash
init|=
literal|'/'
decl_stmt|;
endif|#
directive|endif
return|return
name|g_strdup_printf
argument_list|(
literal|"%s%clib%cgimp%c"
name|GIMP_PLUGIN_VERSION
literal|"%cplug-ins"
argument_list|,
name|get_runtime_prefix
argument_list|(
name|slash
argument_list|)
argument_list|,
name|slash
argument_list|,
name|slash
argument_list|,
name|slash
argument_list|,
name|slash
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_admin (const gchar * what)
name|do_install_admin
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build_2
argument_list|(
name|get_cflags
argument_list|()
argument_list|,
name|get_libs
argument_list|()
argument_list|,
name|get_sys_plugin_dir
argument_list|(
name|TRUE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_admin_noui (const gchar * what)
name|do_install_admin_noui
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build_2
argument_list|(
name|get_cflags_noui
argument_list|()
argument_list|,
name|get_libs_noui
argument_list|()
argument_list|,
name|get_sys_plugin_dir
argument_list|(
name|TRUE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_admin_nogimpui (const gchar * what)
name|do_install_admin_nogimpui
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_build_2
argument_list|(
name|get_cflags
argument_list|()
argument_list|,
name|get_libs
argument_list|()
argument_list|,
name|get_sys_plugin_dir
argument_list|(
name|TRUE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_bin_2 (const gchar * dir,const gchar * what)
name|do_install_bin_2
parameter_list|(
specifier|const
name|gchar
modifier|*
name|dir
parameter_list|,
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|g_mkdir_with_parents
argument_list|(
name|dir
argument_list|,
name|S_IRUSR
operator||
name|S_IXUSR
operator||
name|S_IWUSR
operator||
name|S_IRGRP
operator||
name|S_IXGRP
operator||
name|S_IROTH
operator||
name|S_IXOTH
argument_list|)
expr_stmt|;
name|maybe_run
argument_list|(
name|g_strconcat
argument_list|(
name|COPY
argument_list|,
literal|" "
argument_list|,
name|what
argument_list|,
literal|" "
argument_list|,
name|dir
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_bin (const gchar * what)
name|do_install_bin
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_install_bin_2
argument_list|(
name|get_user_plugin_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_admin_bin (const gchar * what)
name|do_install_admin_bin
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_install_bin_2
argument_list|(
name|get_sys_plugin_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_uninstall (const gchar * dir,const gchar * what)
name|do_uninstall
parameter_list|(
specifier|const
name|gchar
modifier|*
name|dir
parameter_list|,
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|maybe_run
argument_list|(
name|g_strconcat
argument_list|(
name|REMOVE
argument_list|,
literal|" "
argument_list|,
name|dir
argument_list|,
name|G_DIR_SEPARATOR_S
argument_list|,
name|what
argument_list|,
name|NULL
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|gchar
modifier|*
DECL|function|maybe_append_exe (const gchar * what)
name|maybe_append_exe
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
name|gchar
modifier|*
name|p
init|=
name|strrchr
argument_list|(
name|what
argument_list|,
literal|'.'
argument_list|)
decl_stmt|;
if|if
condition|(
name|p
operator|==
name|NULL
operator|||
name|g_ascii_strcasecmp
argument_list|(
name|p
argument_list|,
literal|".exe"
argument_list|)
operator|!=
literal|0
condition|)
return|return
name|g_strconcat
argument_list|(
name|what
argument_list|,
literal|".exe"
argument_list|,
name|NULL
argument_list|)
return|;
endif|#
directive|endif
return|return
name|what
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_uninstall_bin (const gchar * what)
name|do_uninstall_bin
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_uninstall
argument_list|(
name|get_user_plugin_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|maybe_append_exe
argument_list|(
name|what
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_uninstall_admin_bin (const gchar * what)
name|do_uninstall_admin_bin
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_uninstall
argument_list|(
name|get_sys_plugin_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|maybe_append_exe
argument_list|(
name|what
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_user_script_dir (gboolean forward_slashes)
name|get_user_script_dir
parameter_list|(
name|gboolean
name|forward_slashes
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
specifier|const
name|gchar
name|slash
init|=
name|forward_slashes
condition|?
literal|'/'
else|:
literal|'\\'
decl_stmt|;
else|#
directive|else
specifier|const
name|gchar
name|slash
init|=
literal|'/'
decl_stmt|;
endif|#
directive|endif
return|return
name|g_strdup_printf
argument_list|(
literal|"%s%c"
name|GIMPDIR
literal|"%cscripts"
argument_list|,
name|g_get_home_dir
argument_list|()
argument_list|,
name|slash
argument_list|,
name|slash
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_script (const gchar * what)
name|do_install_script
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_install_bin_2
argument_list|(
name|get_user_script_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|get_sys_script_dir (gboolean forward_slashes)
name|get_sys_script_dir
parameter_list|(
name|gboolean
name|forward_slashes
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
specifier|const
name|gchar
name|slash
init|=
name|forward_slashes
condition|?
literal|'/'
else|:
literal|'\\'
decl_stmt|;
else|#
directive|else
specifier|const
name|gchar
name|slash
init|=
literal|'/'
decl_stmt|;
endif|#
directive|endif
return|return
name|g_strdup_printf
argument_list|(
literal|"%s%cshare%cgimp%c%d.%d%cscripts"
argument_list|,
name|get_runtime_prefix
argument_list|(
name|slash
argument_list|)
argument_list|,
name|slash
argument_list|,
name|slash
argument_list|,
name|slash
argument_list|,
name|GIMP_MAJOR_VERSION
argument_list|,
name|GIMP_MINOR_VERSION
argument_list|,
name|slash
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_install_admin_script (const gchar * what)
name|do_install_admin_script
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_install_bin_2
argument_list|(
name|get_sys_script_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_uninstall_script (const gchar * what)
name|do_uninstall_script
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_uninstall
argument_list|(
name|get_user_script_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_uninstall_admin_script (const gchar * what)
name|do_uninstall_admin_script
parameter_list|(
specifier|const
name|gchar
modifier|*
name|what
parameter_list|)
block|{
name|do_uninstall
argument_list|(
name|get_sys_script_dir
argument_list|(
name|FALSE
argument_list|)
argument_list|,
name|what
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|int
DECL|function|main (int argc,char ** argv)
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|gint
name|argi
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
name|argc
operator|==
literal|1
condition|)
name|usage
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
comment|/* First scan for flags that affect our behaviour globally, but    * are still allowed late on the command line.    */
name|argi
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|++
name|argi
operator|<
name|argc
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"-n"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--just-print"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--dry-run"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--recon"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|dry_run
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--help"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|usage
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|g_str_has_prefix
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--prefix="
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|argv
index|[
name|argi
index|]
operator|+
name|strlen
argument_list|(
literal|"--prefix="
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|g_str_has_prefix
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--exec-prefix="
argument_list|)
condition|)
block|{
name|exec_prefix
operator|=
name|argv
index|[
name|argi
index|]
operator|+
name|strlen
argument_list|(
literal|"--exec_prefix="
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--msvc-syntax"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|msvc_syntax
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
ifndef|#
directive|ifndef
name|G_OS_WIN32
if|if
condition|(
name|msvc_syntax
condition|)
block|{
name|g_printerr
argument_list|(
literal|"Ignoring --msvc-syntax\n"
argument_list|)
expr_stmt|;
name|msvc_syntax
operator|=
name|FALSE
expr_stmt|;
block|}
endif|#
directive|endif
name|find_out_env_flags
argument_list|()
expr_stmt|;
comment|/* Second pass, actually do something. */
name|argi
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|++
name|argi
operator|<
name|argc
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|dirs
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
name|g_strconcat
argument_list|(
literal|"--"
argument_list|,
name|dirs
index|[
name|i
index|]
operator|.
name|option
argument_list|,
name|NULL
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
break|break;
block|}
if|if
condition|(
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|dirs
argument_list|)
condition|)
block|{
name|g_print
argument_list|(
literal|"%s\n"
argument_list|,
name|expand_and_munge
argument_list|(
name|dirs
index|[
name|i
index|]
operator|.
name|value
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--quiet"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--silent"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|silent
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--version"
argument_list|)
operator|==
literal|0
condition|)
block|{
name|g_print
argument_list|(
literal|"%d.%d.%d\n"
argument_list|,
name|GIMP_MAJOR_VERSION
argument_list|,
name|GIMP_MINOR_VERSION
argument_list|,
name|GIMP_MICRO_VERSION
argument_list|)
expr_stmt|;
name|exit
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"-n"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--just-print"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--dry-run"
argument_list|)
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--recon"
argument_list|)
operator|==
literal|0
condition|)
empty_stmt|;
comment|/* Already handled */
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--includedir"
argument_list|)
operator|==
literal|0
condition|)
name|do_includedir
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--cflags"
argument_list|)
operator|==
literal|0
condition|)
name|do_cflags
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--cflags-noui"
argument_list|)
operator|==
literal|0
condition|)
name|do_cflags_noui
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--cflags-nogimpui"
argument_list|)
operator|==
literal|0
condition|)
name|do_cflags_nogimpui
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--libs"
argument_list|)
operator|==
literal|0
condition|)
name|do_libs
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--libs-noui"
argument_list|)
operator|==
literal|0
condition|)
name|do_libs_noui
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--libs-nogimpui"
argument_list|)
operator|==
literal|0
condition|)
name|do_libs_nogimpui
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|g_str_has_prefix
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--prefix="
argument_list|)
condition|)
empty_stmt|;
elseif|else
if|if
condition|(
name|g_str_has_prefix
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--exec-prefix="
argument_list|)
condition|)
empty_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--msvc-syntax"
argument_list|)
operator|==
literal|0
condition|)
empty_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--build"
argument_list|)
operator|==
literal|0
condition|)
name|do_build
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--build-noui"
argument_list|)
operator|==
literal|0
condition|)
name|do_build_noui
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--build-nogimpui"
argument_list|)
operator|==
literal|0
condition|)
name|do_build_nogimpui
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install"
argument_list|)
operator|==
literal|0
condition|)
name|do_install
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-noui"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_noui
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-nogimpui"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_nogimpui
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-admin"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_admin
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-admin-noui"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_admin_noui
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-admin-nogimpui"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_admin_nogimpui
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-bin"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_bin
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-admin-bin"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_admin_bin
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--uninstall-bin"
argument_list|)
operator|==
literal|0
condition|)
name|do_uninstall_bin
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--uninstall-admin-bin"
argument_list|)
operator|==
literal|0
condition|)
name|do_uninstall_admin_bin
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-script"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_script
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--install-admin-script"
argument_list|)
operator|==
literal|0
condition|)
name|do_install_admin_script
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--uninstall-script"
argument_list|)
operator|==
literal|0
condition|)
name|do_uninstall_script
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|argv
index|[
name|argi
index|]
argument_list|,
literal|"--uninstall-admin-script"
argument_list|)
operator|==
literal|0
condition|)
name|do_uninstall_admin_script
argument_list|(
name|argv
index|[
operator|++
name|argi
index|]
argument_list|)
expr_stmt|;
else|else
block|{
name|g_printerr
argument_list|(
literal|"Unrecognized switch %s\n"
argument_list|,
name|argv
index|[
name|argi
index|]
argument_list|)
expr_stmt|;
name|usage
argument_list|(
name|EXIT_FAILURE
argument_list|)
expr_stmt|;
block|}
block|}
name|exit
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Local Variables:  * mode: c  * End:  */
end_comment

end_unit

