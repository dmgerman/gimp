begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpcolor/gimpcolor.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"display-types.h"
end_include

begin_include
include|#
directive|include
file|"tools/tools-types.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_warning
warning|#
directive|warning
warning|FIXME #include "gui/gui-types.h"
end_warning

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"gui/gui-types.h"
end_include

begin_include
include|#
directive|include
file|"config/gimpdisplayconfig.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpbuffer.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpcontext.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpgrid.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-snap.h"
end_include

begin_include
include|#
directive|include
file|"core/gimplayer.h"
end_include

begin_include
include|#
directive|include
file|"core/gimplayermask.h"
end_include

begin_include
include|#
directive|include
file|"core/gimplist.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpmarshal.h"
end_include

begin_include
include|#
directive|include
file|"core/gimppattern.h"
end_include

begin_include
include|#
directive|include
file|"file/file-utils.h"
end_include

begin_include
include|#
directive|include
file|"vectors/gimpvectors.h"
end_include

begin_include
include|#
directive|include
file|"vectors/gimpstroke.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpcolorpanel.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpdnd.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimphelp-ids.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpitemfactory.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpmenufactory.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpwidgets-utils.h"
end_include

begin_include
include|#
directive|include
file|"gui/info-window.h"
end_include

begin_include
include|#
directive|include
file|"tools/tool_manager.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-appearance.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-callbacks.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-cursor.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-dnd.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-filter.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-handlers.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-render.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-scale.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-selection.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-title.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-transform.h"
end_include

begin_include
include|#
directive|include
file|"gimpstatusbar.h"
end_include

begin_include
include|#
directive|include
file|"gimp-intl.h"
end_include

begin_enum
enum|enum
DECL|enum|__anon28e91e520103
block|{
DECL|enumerator|SCALED
name|SCALED
block|,
DECL|enumerator|SCROLLED
name|SCROLLED
block|,
DECL|enumerator|RECONNECT
name|RECONNECT
block|,
DECL|enumerator|LAST_SIGNAL
name|LAST_SIGNAL
block|}
enum|;
end_enum

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_class_init
parameter_list|(
name|GimpDisplayShellClass
modifier|*
name|klass
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_init
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_destroy
parameter_list|(
name|GtkObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_realize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_display_shell_delete_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventAny
modifier|*
name|aevent
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_real_scaled
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_close_warning_dialog
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|GimpImage
modifier|*
name|gimage
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_close_warning_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|close
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|display_shell_signals
specifier|static
name|guint
name|display_shell_signals
index|[
name|LAST_SIGNAL
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|parent_class
specifier|static
name|GtkWindowClass
modifier|*
name|parent_class
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
name|GType
DECL|function|gimp_display_shell_get_type (void)
name|gimp_display_shell_get_type
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GType
name|shell_type
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|shell_type
condition|)
block|{
specifier|static
specifier|const
name|GTypeInfo
name|shell_info
init|=
block|{
sizeof|sizeof
argument_list|(
name|GimpDisplayShellClass
argument_list|)
block|,
operator|(
name|GBaseInitFunc
operator|)
name|NULL
block|,
operator|(
name|GBaseFinalizeFunc
operator|)
name|NULL
block|,
operator|(
name|GClassInitFunc
operator|)
name|gimp_display_shell_class_init
block|,
name|NULL
block|,
comment|/* class_finalize */
name|NULL
block|,
comment|/* class_data     */
sizeof|sizeof
argument_list|(
name|GimpDisplayShell
argument_list|)
block|,
literal|0
block|,
comment|/* n_preallocs    */
operator|(
name|GInstanceInitFunc
operator|)
name|gimp_display_shell_init
block|,       }
decl_stmt|;
name|shell_type
operator|=
name|g_type_register_static
argument_list|(
name|GTK_TYPE_WINDOW
argument_list|,
literal|"GimpDisplayShell"
argument_list|,
operator|&
name|shell_info
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
return|return
name|shell_type
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_class_init (GimpDisplayShellClass * klass)
name|gimp_display_shell_class_init
parameter_list|(
name|GimpDisplayShellClass
modifier|*
name|klass
parameter_list|)
block|{
name|GtkObjectClass
modifier|*
name|object_class
decl_stmt|;
name|GtkWidgetClass
modifier|*
name|widget_class
decl_stmt|;
name|object_class
operator|=
name|GTK_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
expr_stmt|;
name|widget_class
operator|=
name|GTK_WIDGET_CLASS
argument_list|(
name|klass
argument_list|)
expr_stmt|;
name|parent_class
operator|=
name|g_type_class_peek_parent
argument_list|(
name|klass
argument_list|)
expr_stmt|;
name|display_shell_signals
index|[
name|SCALED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"scaled"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpDisplayShellClass
argument_list|,
name|scaled
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|display_shell_signals
index|[
name|SCROLLED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"scrolled"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpDisplayShellClass
argument_list|,
name|scrolled
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|display_shell_signals
index|[
name|RECONNECT
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"reconnect"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpDisplayShellClass
argument_list|,
name|reconnect
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|object_class
operator|->
name|destroy
operator|=
name|gimp_display_shell_destroy
expr_stmt|;
name|widget_class
operator|->
name|realize
operator|=
name|gimp_display_shell_realize
expr_stmt|;
name|widget_class
operator|->
name|delete_event
operator|=
name|gimp_display_shell_delete_event
expr_stmt|;
name|widget_class
operator|->
name|popup_menu
operator|=
name|gimp_display_shell_popup_menu
expr_stmt|;
name|klass
operator|->
name|scaled
operator|=
name|gimp_display_shell_real_scaled
expr_stmt|;
name|klass
operator|->
name|scrolled
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|reconnect
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_init (GimpDisplayShell * shell)
name|gimp_display_shell_init
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|shell
operator|->
name|gdisp
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|menubar_factory
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|popup_factory
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|qmask_factory
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|scale
operator|=
literal|0x101
expr_stmt|;
name|shell
operator|->
name|other_scale
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|dot_for_dot
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|offset_x
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|offset_y
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|disp_width
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|disp_height
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|disp_xoffset
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|disp_yoffset
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|proximity
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|snap_to_guides
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|snap_to_grid
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|select
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|hsbdata
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|vsbdata
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|canvas
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|hsb
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|vsb
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|qmask
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|hrule
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|vrule
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|origin
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|statusbar
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|render_buf
operator|=
name|g_malloc
argument_list|(
name|GIMP_DISPLAY_SHELL_RENDER_BUF_WIDTH
operator|*
name|GIMP_DISPLAY_SHELL_RENDER_BUF_HEIGHT
operator|*
literal|3
argument_list|)
expr_stmt|;
name|shell
operator|->
name|render_gc
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|icon_size
operator|=
literal|32
expr_stmt|;
name|shell
operator|->
name|icon_idle_id
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|current_cursor
operator|=
operator|(
name|GdkCursorType
operator|)
operator|-
literal|1
expr_stmt|;
name|shell
operator|->
name|tool_cursor
operator|=
name|GIMP_TOOL_CURSOR_NONE
expr_stmt|;
name|shell
operator|->
name|cursor_modifier
operator|=
name|GIMP_CURSOR_MODIFIER_NONE
expr_stmt|;
name|shell
operator|->
name|override_cursor
operator|=
operator|(
name|GdkCursorType
operator|)
operator|-
literal|1
expr_stmt|;
name|shell
operator|->
name|using_override_cursor
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|draw_cursor
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|have_cursor
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|cursor_x
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|cursor_y
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|padding_button
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|nav_ebox
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|warning_dialog
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|info_dialog
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|scale_dialog
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|nav_popup
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|grid_dialog
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|filters
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|filters_dialog
operator|=
name|NULL
expr_stmt|;
name|shell
operator|->
name|space_pressed
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|space_release_pending
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|window_state
operator|=
literal|0
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|selection
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|active_layer
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|guides
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|grid
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|menubar
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|rulers
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|scrollbars
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|statusbar
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|padding_mode
operator|=
name|GIMP_DISPLAY_PADDING_MODE_DEFAULT
expr_stmt|;
name|gimp_rgba_set
argument_list|(
operator|&
name|shell
operator|->
name|appearance
operator|.
name|padding_color
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|padding_mode_set
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|selection
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|active_layer
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|guides
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|grid
operator|=
name|TRUE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|menubar
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|rulers
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|scrollbars
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|statusbar
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|padding_mode
operator|=
name|GIMP_DISPLAY_PADDING_MODE_CUSTOM
expr_stmt|;
name|gimp_rgba_set
argument_list|(
operator|&
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|padding_color
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|padding_mode_set
operator|=
name|FALSE
expr_stmt|;
name|shell
operator|->
name|paused_count
operator|=
literal|0
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
literal|"image_window"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_resizable
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
operator|(
name|GDK_POINTER_MOTION_MASK
operator||
name|GDK_POINTER_MOTION_HINT_MASK
operator||
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_KEY_PRESS_MASK
operator||
name|GDK_KEY_RELEASE_MASK
operator|)
argument_list|)
expr_stmt|;
comment|/*  active display callback  */
name|g_signal_connect
argument_list|(
name|shell
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
argument_list|,
literal|"button_release_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
argument_list|,
literal|"key_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
argument_list|,
literal|"window_state_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
comment|/*  dnd stuff  */
name|gimp_dnd_viewable_dest_add
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GIMP_TYPE_LAYER
argument_list|,
name|gimp_display_shell_drop_drawable
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_dnd_viewable_dest_add
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GIMP_TYPE_LAYER_MASK
argument_list|,
name|gimp_display_shell_drop_drawable
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_dnd_viewable_dest_add
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GIMP_TYPE_CHANNEL
argument_list|,
name|gimp_display_shell_drop_drawable
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_dnd_viewable_dest_add
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GIMP_TYPE_VECTORS
argument_list|,
name|gimp_display_shell_drop_vectors
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_dnd_viewable_dest_add
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GIMP_TYPE_PATTERN
argument_list|,
name|gimp_display_shell_drop_pattern
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_dnd_viewable_dest_add
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GIMP_TYPE_BUFFER
argument_list|,
name|gimp_display_shell_drop_buffer
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_dnd_color_dest_add
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|gimp_display_shell_drop_color
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_help_connect
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|GIMP_HELP_IMAGE_WINDOW
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_destroy (GtkObject * object)
name|gimp_display_shell_destroy
parameter_list|(
name|GtkObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpDisplayShell
modifier|*
name|shell
decl_stmt|;
name|shell
operator|=
name|GIMP_DISPLAY_SHELL
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|gdisp
condition|)
block|{
name|gimp_display_shell_disconnect
argument_list|(
name|shell
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|menubar_factory
condition|)
block|{
name|g_object_unref
argument_list|(
name|shell
operator|->
name|menubar_factory
argument_list|)
expr_stmt|;
name|shell
operator|->
name|menubar_factory
operator|=
name|NULL
expr_stmt|;
block|}
name|shell
operator|->
name|popup_factory
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|qmask_factory
condition|)
block|{
name|g_object_unref
argument_list|(
name|shell
operator|->
name|qmask_factory
argument_list|)
expr_stmt|;
name|shell
operator|->
name|qmask_factory
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|select
condition|)
block|{
name|gimp_display_shell_selection_free
argument_list|(
name|shell
operator|->
name|select
argument_list|)
expr_stmt|;
name|shell
operator|->
name|select
operator|=
name|NULL
expr_stmt|;
block|}
name|gimp_display_shell_filter_detach_all
argument_list|(
name|shell
argument_list|)
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|render_buf
condition|)
block|{
name|g_free
argument_list|(
name|shell
operator|->
name|render_buf
argument_list|)
expr_stmt|;
name|shell
operator|->
name|render_buf
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|render_gc
condition|)
block|{
name|g_object_unref
argument_list|(
name|shell
operator|->
name|render_gc
argument_list|)
expr_stmt|;
name|shell
operator|->
name|render_gc
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|title_idle_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|shell
operator|->
name|title_idle_id
argument_list|)
expr_stmt|;
name|shell
operator|->
name|title_idle_id
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|info_dialog
condition|)
block|{
name|info_window_free
argument_list|(
name|shell
operator|->
name|info_dialog
argument_list|)
expr_stmt|;
name|shell
operator|->
name|info_dialog
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|nav_popup
condition|)
block|{
name|gtk_widget_destroy
argument_list|(
name|shell
operator|->
name|nav_popup
argument_list|)
expr_stmt|;
name|shell
operator|->
name|nav_popup
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|grid_dialog
condition|)
block|{
name|gtk_widget_destroy
argument_list|(
name|shell
operator|->
name|grid_dialog
argument_list|)
expr_stmt|;
name|shell
operator|->
name|grid_dialog
operator|=
name|NULL
expr_stmt|;
block|}
name|shell
operator|->
name|gdisp
operator|=
name|NULL
expr_stmt|;
name|GTK_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|destroy
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_realize (GtkWidget * widget)
name|gimp_display_shell_realize
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpDisplayShell
modifier|*
name|shell
decl_stmt|;
name|GimpDisplayConfig
modifier|*
name|config
decl_stmt|;
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|realize
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|shell
operator|=
name|GIMP_DISPLAY_SHELL
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|config
operator|=
name|GIMP_DISPLAY_CONFIG
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|gimp
operator|->
name|config
argument_list|)
expr_stmt|;
comment|/*  We set the monitor resolution in the realize method so that    *  it is changed when the display shell is migrated to another screen.    */
if|if
condition|(
name|GIMP_DISPLAY_CONFIG
argument_list|(
name|config
argument_list|)
operator|->
name|monitor_res_from_gdk
condition|)
block|{
name|gimp_get_screen_resolution
argument_list|(
name|gtk_widget_get_screen
argument_list|(
name|widget
argument_list|)
argument_list|,
operator|&
name|shell
operator|->
name|monitor_xres
argument_list|,
operator|&
name|shell
operator|->
name|monitor_yres
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|shell
operator|->
name|monitor_xres
operator|=
name|GIMP_DISPLAY_CONFIG
argument_list|(
name|config
argument_list|)
operator|->
name|monitor_xres
expr_stmt|;
name|shell
operator|->
name|monitor_yres
operator|=
name|GIMP_DISPLAY_CONFIG
argument_list|(
name|config
argument_list|)
operator|->
name|monitor_yres
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_display_shell_delete_event (GtkWidget * widget,GdkEventAny * aevent)
name|gimp_display_shell_delete_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventAny
modifier|*
name|aevent
parameter_list|)
block|{
name|GimpDisplayShell
modifier|*
name|shell
decl_stmt|;
name|shell
operator|=
name|GIMP_DISPLAY_SHELL
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gimp_display_shell_close
argument_list|(
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_real_scaled (GimpDisplayShell * shell)
name|gimp_display_shell_real_scaled
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|GimpContext
modifier|*
name|user_context
decl_stmt|;
name|gimp_display_shell_update_title
argument_list|(
name|shell
argument_list|)
expr_stmt|;
comment|/* update the<Image>/View/Zoom menu */
name|gimp_item_factory_update
argument_list|(
name|shell
operator|->
name|menubar_factory
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|user_context
operator|=
name|gimp_get_user_context
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|gimp
argument_list|)
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|gdisp
operator|==
name|gimp_context_get_display
argument_list|(
name|user_context
argument_list|)
condition|)
name|gimp_item_factory_update
argument_list|(
name|shell
operator|->
name|popup_factory
argument_list|,
name|shell
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_display_shell_new (GimpDisplay * gdisp,guint scale,GimpMenuFactory * menu_factory,GimpItemFactory * popup_factory)
name|gimp_display_shell_new
parameter_list|(
name|GimpDisplay
modifier|*
name|gdisp
parameter_list|,
name|guint
name|scale
parameter_list|,
name|GimpMenuFactory
modifier|*
name|menu_factory
parameter_list|,
name|GimpItemFactory
modifier|*
name|popup_factory
parameter_list|)
block|{
name|GimpDisplayShell
modifier|*
name|shell
decl_stmt|;
name|GimpDisplayConfig
modifier|*
name|config
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|disp_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|upper_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|right_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|lower_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|inner_table
decl_stmt|;
name|GtkWidget
modifier|*
name|arrow
decl_stmt|;
name|GtkWidget
modifier|*
name|image
decl_stmt|;
name|GtkWidget
modifier|*
name|menubar
decl_stmt|;
name|GdkScreen
modifier|*
name|screen
decl_stmt|;
name|gint
name|image_width
decl_stmt|,
name|image_height
decl_stmt|;
name|gint
name|n_width
decl_stmt|,
name|n_height
decl_stmt|;
name|gint
name|s_width
decl_stmt|,
name|s_height
decl_stmt|;
name|gint
name|scalesrc
decl_stmt|,
name|scaledest
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DISPLAY
argument_list|(
name|gdisp
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_MENU_FACTORY
argument_list|(
name|menu_factory
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_ITEM_FACTORY
argument_list|(
name|popup_factory
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  the toplevel shell */
name|shell
operator|=
name|g_object_new
argument_list|(
name|GIMP_TYPE_DISPLAY_SHELL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|shell
operator|->
name|gdisp
operator|=
name|gdisp
expr_stmt|;
name|shell
operator|->
name|scale
operator|=
name|scale
expr_stmt|;
name|image_width
operator|=
name|gdisp
operator|->
name|gimage
operator|->
name|width
expr_stmt|;
name|image_height
operator|=
name|gdisp
operator|->
name|gimage
operator|->
name|height
expr_stmt|;
name|config
operator|=
name|GIMP_DISPLAY_CONFIG
argument_list|(
name|gdisp
operator|->
name|gimage
operator|->
name|gimp
operator|->
name|config
argument_list|)
expr_stmt|;
name|shell
operator|->
name|dot_for_dot
operator|=
name|config
operator|->
name|default_dot_for_dot
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|menubar
operator|=
name|config
operator|->
name|show_menubar
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|rulers
operator|=
name|config
operator|->
name|show_rulers
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|scrollbars
operator|=
name|config
operator|->
name|show_scrollbars
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|statusbar
operator|=
name|config
operator|->
name|show_statusbar
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|padding_mode
operator|=
name|config
operator|->
name|canvas_padding_mode
expr_stmt|;
name|shell
operator|->
name|appearance
operator|.
name|padding_color
operator|=
name|config
operator|->
name|canvas_padding_color
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|menubar
operator|=
name|config
operator|->
name|fs_show_menubar
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|rulers
operator|=
name|config
operator|->
name|fs_show_rulers
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|scrollbars
operator|=
name|config
operator|->
name|fs_show_scrollbars
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|statusbar
operator|=
name|config
operator|->
name|fs_show_statusbar
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|padding_mode
operator|=
name|config
operator|->
name|fs_canvas_padding_mode
expr_stmt|;
name|shell
operator|->
name|fullscreen_appearance
operator|.
name|padding_color
operator|=
name|config
operator|->
name|fs_canvas_padding_color
expr_stmt|;
comment|/* adjust the initial scale -- so that window fits on screen the 75%    * value is the same as in gimp_display_shell_shrink_wrap. It    * probably should be a user-configurable option.    */
name|screen
operator|=
name|gtk_widget_get_screen
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|s_width
operator|=
name|gdk_screen_get_width
argument_list|(
name|screen
argument_list|)
operator|*
literal|0.75
expr_stmt|;
name|s_height
operator|=
name|gdk_screen_get_height
argument_list|(
name|screen
argument_list|)
operator|*
literal|0.75
expr_stmt|;
name|scalesrc
operator|=
name|SCALESRC
argument_list|(
name|shell
argument_list|)
expr_stmt|;
name|scaledest
operator|=
name|SCALEDEST
argument_list|(
name|shell
argument_list|)
expr_stmt|;
name|n_width
operator|=
name|SCALEX
argument_list|(
name|shell
argument_list|,
name|image_width
argument_list|)
expr_stmt|;
name|n_height
operator|=
name|SCALEX
argument_list|(
name|shell
argument_list|,
name|image_height
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|->
name|initial_zoom_to_fit
condition|)
block|{
comment|/*  Limit to the size of the screen...  */
while|while
condition|(
name|n_width
operator|>
name|s_width
operator|||
name|n_height
operator|>
name|s_height
condition|)
block|{
if|if
condition|(
name|scaledest
operator|>
literal|1
condition|)
name|scaledest
operator|--
expr_stmt|;
elseif|else
if|if
condition|(
name|scalesrc
operator|<
literal|0xFF
condition|)
name|scalesrc
operator|++
expr_stmt|;
name|n_width
operator|=
operator|(
name|image_width
operator|*
operator|(
name|scaledest
operator|*
name|SCREEN_XRES
argument_list|(
name|shell
argument_list|)
operator|)
operator|/
operator|(
name|scalesrc
operator|*
name|gdisp
operator|->
name|gimage
operator|->
name|xresolution
operator|)
operator|)
expr_stmt|;
name|n_height
operator|=
operator|(
name|image_height
operator|*
operator|(
name|scaledest
operator|*
name|SCREEN_XRES
argument_list|(
name|shell
argument_list|)
operator|)
operator|/
operator|(
name|scalesrc
operator|*
name|gdisp
operator|->
name|gimage
operator|->
name|xresolution
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|scaledest
operator|==
literal|1
operator|&&
name|scalesrc
operator|==
literal|0xFF
condition|)
break|break;
block|}
block|}
else|else
block|{
comment|/* Set up size like above, but do not zoom to fit. 	 Useful when working on large images. */
if|if
condition|(
name|n_width
operator|>
name|s_width
condition|)
name|n_width
operator|=
name|s_width
expr_stmt|;
if|if
condition|(
name|n_height
operator|>
name|s_height
condition|)
name|n_height
operator|=
name|s_height
expr_stmt|;
block|}
name|shell
operator|->
name|scale
operator|=
operator|(
name|scaledest
operator|<<
literal|8
operator|)
operator|+
name|scalesrc
expr_stmt|;
name|shell
operator|->
name|menubar_factory
operator|=
name|gimp_menu_factory_menu_new
argument_list|(
name|menu_factory
argument_list|,
literal|"<Image>"
argument_list|,
name|GTK_TYPE_MENU_BAR
argument_list|,
name|gdisp
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|shell
operator|->
name|popup_factory
operator|=
name|popup_factory
expr_stmt|;
name|shell
operator|->
name|qmask_factory
operator|=
name|gimp_menu_factory_menu_new
argument_list|(
name|menu_factory
argument_list|,
literal|"<QMask>"
argument_list|,
name|GTK_TYPE_MENU
argument_list|,
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  The accelerator table for images  */
name|gtk_window_add_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
name|GTK_ITEM_FACTORY
argument_list|(
name|shell
operator|->
name|menubar_factory
argument_list|)
operator|->
name|accel_group
argument_list|)
expr_stmt|;
comment|/*  GtkTable widgets are not able to shrink a row/column correctly if    *  widgets are attached with GTK_EXPAND even if those widgets have    *  other rows/columns in their rowspan/colspan where they could    *  nicely expand without disturbing the row/column which is supposed    *  to shrink. --Mitch    *    *  Changed the packing to use hboxes and vboxes which behave nicer:    *    *  main_vbox    *     |    *     +-- menubar    *     |    *     +-- disp_vbox    *     |      |    *     |      +-- upper_hbox    *     |      |      |    *     |      |      +-- inner_table    *     |      |      |      |    *     |      |      |      +-- origin    *     |      |      |      +-- hruler    *     |      |      |      +-- vruler    *     |      |      |      +-- canvas    *     |      |      |    *     |      |      +-- right_vbox    *     |      |             |    *     |      |             +-- padding_button    *     |      |             +-- vscrollbar    *     |      |    *     |      +-- lower_hbox    *     |             |    *     |             +-- qmask    *     |             +-- hscrollbar    *     |             +-- navbutton    *     |    *     +-- statusbar    */
comment|/*  first, set up the container hierarchy  *********************************/
comment|/*  the vbox containing all widgets  */
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|shell
argument_list|)
argument_list|,
name|main_vbox
argument_list|)
expr_stmt|;
name|menubar
operator|=
name|GTK_ITEM_FACTORY
argument_list|(
name|shell
operator|->
name|menubar_factory
argument_list|)
operator|->
name|widget
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|menubar
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|appearance
operator|.
name|menubar
condition|)
name|gtk_widget_show
argument_list|(
name|menubar
argument_list|)
expr_stmt|;
comment|/*  active display callback  */
name|g_signal_connect
argument_list|(
name|menubar
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|menubar
argument_list|,
literal|"button_release_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|menubar
argument_list|,
literal|"key_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
comment|/*  another vbox for everything except the statusbar  */
name|disp_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|disp_vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|disp_vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|disp_vbox
argument_list|)
expr_stmt|;
comment|/*  a hbox for the inner_table and the vertical scrollbar  */
name|upper_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|disp_vbox
argument_list|)
argument_list|,
name|upper_hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|upper_hbox
argument_list|)
expr_stmt|;
comment|/*  the table containing origin, rulers and the canvas  */
name|inner_table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|inner_table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|inner_table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|upper_hbox
argument_list|)
argument_list|,
name|inner_table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|inner_table
argument_list|)
expr_stmt|;
comment|/*  the vbox containing the color button and the vertical scrollbar  */
name|right_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|upper_hbox
argument_list|)
argument_list|,
name|right_vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|right_vbox
argument_list|)
expr_stmt|;
comment|/*  the hbox containing qmask button, vertical scrollbar and nav button  */
name|lower_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|disp_vbox
argument_list|)
argument_list|,
name|lower_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|lower_hbox
argument_list|)
expr_stmt|;
comment|/*  create the scrollbars  *************************************************/
comment|/*  the horizontal scrollbar  */
name|shell
operator|->
name|hsbdata
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gtk_adjustment_new
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|image_width
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|image_width
argument_list|)
argument_list|)
expr_stmt|;
name|shell
operator|->
name|hsb
operator|=
name|gtk_hscrollbar_new
argument_list|(
name|shell
operator|->
name|hsbdata
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|shell
operator|->
name|hsb
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
comment|/*  the vertical scrollbar  */
name|shell
operator|->
name|vsbdata
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gtk_adjustment_new
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|image_height
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|image_height
argument_list|)
argument_list|)
expr_stmt|;
name|shell
operator|->
name|vsb
operator|=
name|gtk_vscrollbar_new
argument_list|(
name|shell
operator|->
name|vsbdata
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|shell
operator|->
name|vsb
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
comment|/*  create the contents of the inner_table  ********************************/
comment|/*  the menu popup button  */
name|shell
operator|->
name|origin
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|shell
operator|->
name|origin
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
operator|->
name|origin
argument_list|)
argument_list|,
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|origin
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_origin_button_press
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|shell
operator|->
name|origin
argument_list|,
name|NULL
argument_list|,
literal|"#origin_button"
argument_list|)
expr_stmt|;
name|arrow
operator|=
name|gtk_arrow_new
argument_list|(
name|GTK_ARROW_RIGHT
argument_list|,
name|GTK_SHADOW_OUT
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|shell
operator|->
name|origin
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|shell
operator|->
name|origin
argument_list|)
argument_list|,
name|arrow
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|arrow
argument_list|)
expr_stmt|;
comment|/* EEK */
name|shell
operator|->
name|canvas
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
comment|/*  the horizontal ruler  */
name|shell
operator|->
name|hrule
operator|=
name|gtk_hruler_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
operator|->
name|hrule
argument_list|)
argument_list|,
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"motion_notify_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|GTK_WIDGET_GET_CLASS
argument_list|(
name|shell
operator|->
name|hrule
argument_list|)
operator|->
name|motion_notify_event
argument_list|)
argument_list|,
name|shell
operator|->
name|hrule
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|hrule
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_hruler_button_press
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|shell
operator|->
name|hrule
argument_list|,
name|NULL
argument_list|,
literal|"#ruler"
argument_list|)
expr_stmt|;
comment|/*  the vertical ruler  */
name|shell
operator|->
name|vrule
operator|=
name|gtk_vruler_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
operator|->
name|vrule
argument_list|)
argument_list|,
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"motion_notify_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|GTK_WIDGET_GET_CLASS
argument_list|(
name|shell
operator|->
name|vrule
argument_list|)
operator|->
name|motion_notify_event
argument_list|)
argument_list|,
name|shell
operator|->
name|vrule
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|vrule
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_vruler_button_press
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|shell
operator|->
name|vrule
argument_list|,
name|NULL
argument_list|,
literal|"#ruler"
argument_list|)
expr_stmt|;
comment|/*  the canvas  */
name|gtk_widget_set_name
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"gimp-canvas"
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
name|n_width
argument_list|,
name|n_height
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
name|GIMP_DISPLAY_SHELL_CANVAS_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_widget_set_extension_events
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
name|GDK_EXTENSION_EVENTS_ALL
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"realize"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_canvas_realize
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
comment|/*  set the active display before doing any other canvas event processing  */
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"expose_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_canvas_expose
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"configure_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_canvas_configure
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
literal|"event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_canvas_tool_events
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
comment|/*  create the contents of the right_vbox  *********************************/
name|shell
operator|->
name|padding_button
operator|=
name|gimp_color_panel_new
argument_list|(
name|_
argument_list|(
literal|"Set Canvas Padding Color"
argument_list|)
argument_list|,
operator|&
name|shell
operator|->
name|appearance
operator|.
name|padding_color
argument_list|,
name|GIMP_COLOR_AREA_FLAT
argument_list|,
literal|15
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|shell
operator|->
name|padding_button
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|gimp_color_panel_set_context
argument_list|(
name|GIMP_COLOR_PANEL
argument_list|(
name|shell
operator|->
name|padding_button
argument_list|)
argument_list|,
name|gimp_get_user_context
argument_list|(
name|gdisp
operator|->
name|gimage
operator|->
name|gimp
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|shell
operator|->
name|padding_button
argument_list|,
name|_
argument_list|(
literal|"Set canvas padding color"
argument_list|)
argument_list|,
literal|"#padding_button"
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|padding_button
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_color_button_press
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|padding_button
argument_list|,
literal|"color_changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_color_button_changed
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
block|{
specifier|static
name|GtkItemFactoryEntry
name|menu_items
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"/From Theme"
argument_list|)
block|,
name|NULL
block|,
name|gimp_display_shell_color_button_menu_callback
block|,
name|GIMP_DISPLAY_PADDING_MODE_DEFAULT
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Light Check Color"
argument_list|)
block|,
name|NULL
block|,
name|gimp_display_shell_color_button_menu_callback
block|,
name|GIMP_DISPLAY_PADDING_MODE_LIGHT_CHECK
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dark Check Color"
argument_list|)
block|,
name|NULL
block|,
name|gimp_display_shell_color_button_menu_callback
block|,
name|GIMP_DISPLAY_PADDING_MODE_DARK_CHECK
block|,
name|NULL
block|}
block|,
block|{
literal|"/---"
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select Custom Color..."
argument_list|)
block|,
name|NULL
block|,
name|gimp_display_shell_color_button_menu_callback
block|,
name|GIMP_DISPLAY_PADDING_MODE_CUSTOM
block|,
literal|"<StockItem>"
block|,
name|GTK_STOCK_SELECT_COLOR
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/As in Preferences"
argument_list|)
block|,
name|NULL
block|,
name|gimp_display_shell_color_button_menu_callback
block|,
literal|0xffff
block|,
literal|"<StockItem>"
block|,
name|GIMP_STOCK_RESET
block|}
block|}
decl_stmt|;
name|gtk_item_factory_create_items
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|shell
operator|->
name|padding_button
argument_list|)
operator|->
name|item_factory
argument_list|,
name|G_N_ELEMENTS
argument_list|(
name|menu_items
argument_list|)
argument_list|,
name|menu_items
argument_list|,
name|shell
argument_list|)
expr_stmt|;
block|}
comment|/*  create the contents of the lower_hbox  *********************************/
comment|/*  the qmask button  */
name|shell
operator|->
name|qmask
operator|=
name|gtk_check_button_new
argument_list|()
expr_stmt|;
name|gtk_toggle_button_set_mode
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|shell
operator|->
name|qmask
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
operator|->
name|qmask
argument_list|)
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|shell
operator|->
name|qmask
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|GIMP_STOCK_QMASK_OFF
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|shell
operator|->
name|qmask
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|shell
operator|->
name|qmask
argument_list|,
name|_
argument_list|(
literal|"Toggle QuickMask"
argument_list|)
argument_list|,
literal|"#qmask_button"
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|qmask
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_qmask_toggled
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|qmask
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_qmask_button_press
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
comment|/*  the navigation window button  */
name|shell
operator|->
name|nav_ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|GIMP_STOCK_NAVIGATION
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|shell
operator|->
name|nav_ebox
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|shell
operator|->
name|nav_ebox
argument_list|,
literal|"button_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_display_shell_nav_button_press
argument_list|)
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|shell
operator|->
name|nav_ebox
argument_list|,
name|NULL
argument_list|,
literal|"#nav_window_button"
argument_list|)
expr_stmt|;
comment|/*  create the contents of the status area *********************************/
comment|/*  the statusbar  */
name|shell
operator|->
name|statusbar
operator|=
name|gimp_statusbar_new
argument_list|(
name|shell
argument_list|)
expr_stmt|;
name|gtk_statusbar_set_has_resize_grip
argument_list|(
name|GTK_STATUSBAR
argument_list|(
name|shell
operator|->
name|statusbar
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|shell
operator|->
name|statusbar
argument_list|,
name|NULL
argument_list|,
literal|"#status_area"
argument_list|)
expr_stmt|;
comment|/*  pack all the widgets  **************************************************/
comment|/*  fill the inner_table  */
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|inner_table
argument_list|)
argument_list|,
name|shell
operator|->
name|origin
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|inner_table
argument_list|)
argument_list|,
name|shell
operator|->
name|hrule
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|inner_table
argument_list|)
argument_list|,
name|shell
operator|->
name|vrule
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|inner_table
argument_list|)
argument_list|,
name|shell
operator|->
name|canvas
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  fill the right_vbox  */
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|right_vbox
argument_list|)
argument_list|,
name|shell
operator|->
name|padding_button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|right_vbox
argument_list|)
argument_list|,
name|shell
operator|->
name|vsb
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  fill the lower_hbox  */
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|lower_hbox
argument_list|)
argument_list|,
name|shell
operator|->
name|qmask
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|lower_hbox
argument_list|)
argument_list|,
name|shell
operator|->
name|hsb
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|lower_hbox
argument_list|)
argument_list|,
name|shell
operator|->
name|nav_ebox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|shell
operator|->
name|statusbar
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  show everything  *******************************************************/
if|if
condition|(
name|shell
operator|->
name|appearance
operator|.
name|rulers
condition|)
block|{
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|origin
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|hrule
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|vrule
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|canvas
argument_list|)
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|appearance
operator|.
name|scrollbars
condition|)
block|{
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|vsb
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|hsb
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|padding_button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|qmask
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|nav_ebox
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|shell
operator|->
name|appearance
operator|.
name|statusbar
condition|)
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|statusbar
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
name|gimp_display_shell_connect
argument_list|(
name|shell
argument_list|)
expr_stmt|;
return|return
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_close (GimpDisplayShell * shell,gboolean kill_it)
name|gimp_display_shell_close
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|gboolean
name|kill_it
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|gimage
operator|=
name|shell
operator|->
name|gdisp
operator|->
name|gimage
expr_stmt|;
comment|/*  FIXME: gimp_busy HACK not really appropriate here because we only    *  want to prevent the busy image and display to be closed.  --Mitch    */
if|if
condition|(
name|gimage
operator|->
name|gimp
operator|->
name|busy
condition|)
return|return;
comment|/*  If the image has been modified, give the user a chance to save    *  it before nuking it--this only applies if its the last view    *  to an image canvas.  (a gimage with disp_count = 1)    */
if|if
condition|(
operator|!
name|kill_it
operator|&&
name|gimage
operator|->
name|disp_count
operator|==
literal|1
operator|&&
name|gimage
operator|->
name|dirty
operator|&&
name|GIMP_DISPLAY_CONFIG
argument_list|(
name|gimage
operator|->
name|gimp
operator|->
name|config
argument_list|)
operator|->
name|confirm_on_close
condition|)
block|{
name|gimp_display_shell_close_warning_dialog
argument_list|(
name|shell
argument_list|,
name|gimage
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_display_delete
argument_list|(
name|shell
operator|->
name|gdisp
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_reconnect (GimpDisplayShell * shell)
name|gimp_display_shell_reconnect
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY
argument_list|(
name|shell
operator|->
name|gdisp
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_display_shell_connect
argument_list|(
name|shell
argument_list|)
expr_stmt|;
name|gimp_statusbar_resize_cursor
argument_list|(
name|GIMP_STATUSBAR
argument_list|(
name|shell
operator|->
name|statusbar
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_display_shell_scale_setup
argument_list|(
name|shell
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|shell
argument_list|,
name|display_shell_signals
index|[
name|RECONNECT
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_scaled (GimpDisplayShell * shell)
name|gimp_display_shell_scaled
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|shell
argument_list|,
name|display_shell_signals
index|[
name|SCALED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_scrolled (GimpDisplayShell * shell)
name|gimp_display_shell_scrolled
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|shell
argument_list|,
name|display_shell_signals
index|[
name|SCROLLED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_snap_coords (GimpDisplayShell * shell,GimpCoords * coords,GimpCoords * snapped_coords,gint snap_offset_x,gint snap_offset_y,gint snap_width,gint snap_height)
name|gimp_display_shell_snap_coords
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|GimpCoords
modifier|*
name|snapped_coords
parameter_list|,
name|gint
name|snap_offset_x
parameter_list|,
name|gint
name|snap_offset_y
parameter_list|,
name|gint
name|snap_width
parameter_list|,
name|gint
name|snap_height
parameter_list|)
block|{
name|gboolean
name|snap_to_guides
init|=
name|FALSE
decl_stmt|;
name|gboolean
name|snap_to_grid
init|=
name|FALSE
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|coords
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|snapped_coords
operator|!=
name|NULL
argument_list|)
expr_stmt|;
operator|*
name|snapped_coords
operator|=
operator|*
name|coords
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|snap_to_guides
operator|&&
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|guides
condition|)
block|{
name|snap_to_guides
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|gimp_display_shell_get_snap_to_grid
argument_list|(
name|shell
argument_list|)
operator|&&
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|grid
condition|)
block|{
name|snap_to_grid
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|snap_to_guides
operator|||
name|snap_to_grid
condition|)
block|{
name|gboolean
name|snapped
decl_stmt|;
name|gint
name|tx
decl_stmt|,
name|ty
decl_stmt|;
if|if
condition|(
name|snap_width
operator|>
literal|0
operator|&&
name|snap_height
operator|>
literal|0
condition|)
block|{
name|snapped
operator|=
name|gimp_image_snap_rectangle
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|,
name|coords
operator|->
name|x
operator|+
name|snap_offset_x
argument_list|,
name|coords
operator|->
name|y
operator|+
name|snap_offset_y
argument_list|,
name|coords
operator|->
name|x
operator|+
name|snap_offset_x
operator|+
name|snap_width
argument_list|,
name|coords
operator|->
name|y
operator|+
name|snap_offset_y
operator|+
name|snap_height
argument_list|,
operator|&
name|tx
argument_list|,
operator|&
name|ty
argument_list|,
name|snap_to_guides
argument_list|,
name|snap_to_grid
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|snapped
operator|=
name|gimp_image_snap_point
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|,
name|coords
operator|->
name|x
operator|+
name|snap_offset_x
argument_list|,
name|coords
operator|->
name|y
operator|+
name|snap_offset_y
argument_list|,
operator|&
name|tx
argument_list|,
operator|&
name|ty
argument_list|,
name|snap_to_guides
argument_list|,
name|snap_to_grid
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|snapped
condition|)
block|{
name|snapped_coords
operator|->
name|x
operator|=
name|tx
operator|-
name|snap_offset_x
expr_stmt|;
name|snapped_coords
operator|->
name|y
operator|=
name|ty
operator|-
name|snap_offset_y
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_display_shell_mask_bounds (GimpDisplayShell * shell,gint * x1,gint * y1,gint * x2,gint * y2)
name|gimp_display_shell_mask_bounds
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|gint
modifier|*
name|x1
parameter_list|,
name|gint
modifier|*
name|y1
parameter_list|,
name|gint
modifier|*
name|x2
parameter_list|,
name|gint
modifier|*
name|y2
parameter_list|)
block|{
name|GimpLayer
modifier|*
name|layer
decl_stmt|;
name|gint
name|off_x
decl_stmt|;
name|gint
name|off_y
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|x1
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|y1
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|x2
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|y2
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  If there is a floating selection, handle things differently  */
if|if
condition|(
operator|(
name|layer
operator|=
name|gimp_image_floating_sel
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|gimp_item_offsets
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|,
operator|&
name|off_x
argument_list|,
operator|&
name|off_y
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_channel_bounds
argument_list|(
name|gimp_image_get_mask
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|)
condition|)
block|{
operator|*
name|x1
operator|=
name|off_x
expr_stmt|;
operator|*
name|y1
operator|=
name|off_y
expr_stmt|;
operator|*
name|x2
operator|=
name|off_x
operator|+
name|gimp_item_width
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
operator|*
name|y2
operator|=
name|off_y
operator|+
name|gimp_item_height
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
operator|*
name|x1
operator|=
name|MIN
argument_list|(
name|off_x
argument_list|,
operator|*
name|x1
argument_list|)
expr_stmt|;
operator|*
name|y1
operator|=
name|MIN
argument_list|(
name|off_y
argument_list|,
operator|*
name|y1
argument_list|)
expr_stmt|;
operator|*
name|x2
operator|=
name|MAX
argument_list|(
name|off_x
operator|+
name|gimp_item_width
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
operator|*
name|x2
argument_list|)
expr_stmt|;
operator|*
name|y2
operator|=
name|MAX
argument_list|(
name|off_y
operator|+
name|gimp_item_height
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
operator|*
name|y2
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|gimp_channel_bounds
argument_list|(
name|gimp_image_get_mask
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|)
condition|)
block|{
return|return
name|FALSE
return|;
block|}
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
operator|*
name|x1
argument_list|,
operator|*
name|y1
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
operator|*
name|x2
argument_list|,
operator|*
name|y2
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  Make sure the extents are within bounds  */
operator|*
name|x1
operator|=
name|CLAMP
argument_list|(
operator|*
name|x1
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_width
argument_list|)
expr_stmt|;
operator|*
name|y1
operator|=
name|CLAMP
argument_list|(
operator|*
name|y1
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_height
argument_list|)
expr_stmt|;
operator|*
name|x2
operator|=
name|CLAMP
argument_list|(
operator|*
name|x2
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_width
argument_list|)
expr_stmt|;
operator|*
name|y2
operator|=
name|CLAMP
argument_list|(
operator|*
name|y2
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_height
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_expose_area (GimpDisplayShell * shell,gint x,gint y,gint w,gint h)
name|gimp_display_shell_expose_area
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|w
parameter_list|,
name|gint
name|h
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw_area
argument_list|(
name|shell
operator|->
name|canvas
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_expose_guide (GimpDisplayShell * shell,GimpGuide * guide)
name|gimp_display_shell_expose_guide
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|GimpGuide
modifier|*
name|guide
parameter_list|)
block|{
name|gint
name|x
decl_stmt|;
name|gint
name|y
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|guide
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|guide
operator|->
name|position
operator|<
literal|0
condition|)
return|return;
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
name|guide
operator|->
name|position
argument_list|,
name|guide
operator|->
name|position
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|guide
operator|->
name|orientation
condition|)
block|{
case|case
name|GIMP_ORIENTATION_HORIZONTAL
case|:
name|gimp_display_shell_expose_area
argument_list|(
name|shell
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|shell
operator|->
name|disp_width
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_ORIENTATION_VERTICAL
case|:
name|gimp_display_shell_expose_area
argument_list|(
name|shell
argument_list|,
name|x
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|shell
operator|->
name|disp_height
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_expose_full (GimpDisplayShell * shell)
name|gimp_display_shell_expose_full
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|shell
operator|->
name|canvas
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_flush (GimpDisplayShell * shell)
name|gimp_display_shell_flush
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_display_shell_update_title
argument_list|(
name|shell
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_pause (GimpDisplayShell * shell)
name|gimp_display_shell_pause
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|shell
operator|->
name|paused_count
operator|++
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|paused_count
operator|==
literal|1
condition|)
block|{
comment|/*  pause the currently active tool  */
name|tool_manager_control_active
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|gimp
argument_list|,
name|PAUSE
argument_list|,
name|shell
operator|->
name|gdisp
argument_list|)
expr_stmt|;
name|gimp_display_shell_draw_vectors
argument_list|(
name|shell
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_resume (GimpDisplayShell * shell)
name|gimp_display_shell_resume
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|shell
operator|->
name|paused_count
operator|>
literal|0
argument_list|)
expr_stmt|;
name|shell
operator|->
name|paused_count
operator|--
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|paused_count
operator|==
literal|0
condition|)
block|{
name|gimp_display_shell_draw_vectors
argument_list|(
name|shell
argument_list|)
expr_stmt|;
comment|/* start the currently active tool */
name|tool_manager_control_active
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|gimp
argument_list|,
name|RESUME
argument_list|,
name|shell
operator|->
name|gdisp
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_update_icon (GimpDisplayShell * shell)
name|gimp_display_shell_update_icon
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
name|gdouble
name|factor
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|factor
operator|=
operator|(
operator|(
name|gdouble
operator|)
name|gimp_image_get_height
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
operator|/
operator|(
name|gdouble
operator|)
name|gimp_image_get_width
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
operator|)
expr_stmt|;
if|if
condition|(
name|factor
operator|>=
literal|1
condition|)
block|{
name|height
operator|=
name|MAX
argument_list|(
name|shell
operator|->
name|icon_size
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|width
operator|=
name|MAX
argument_list|(
operator|(
operator|(
name|gdouble
operator|)
name|shell
operator|->
name|icon_size
operator|)
operator|/
name|factor
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|height
operator|=
name|MAX
argument_list|(
operator|(
operator|(
name|gdouble
operator|)
name|shell
operator|->
name|icon_size
operator|)
operator|*
name|factor
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|width
operator|=
name|MAX
argument_list|(
name|shell
operator|->
name|icon_size
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
name|pixbuf
operator|=
name|gimp_viewable_get_new_preview_pixbuf
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gtk_window_set_icon
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
name|pixbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|pixbuf
condition|)
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_draw_guide (GimpDisplayShell * shell,GimpGuide * guide,gboolean active)
name|gimp_display_shell_draw_guide
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|GimpGuide
modifier|*
name|guide
parameter_list|,
name|gboolean
name|active
parameter_list|)
block|{
specifier|static
name|GdkGC
modifier|*
name|normal_hgc
init|=
name|NULL
decl_stmt|;
specifier|static
name|GdkGC
modifier|*
name|active_hgc
init|=
name|NULL
decl_stmt|;
specifier|static
name|GdkGC
modifier|*
name|normal_vgc
init|=
name|NULL
decl_stmt|;
specifier|static
name|GdkGC
modifier|*
name|active_vgc
init|=
name|NULL
decl_stmt|;
specifier|static
name|gboolean
name|initialized
init|=
name|FALSE
decl_stmt|;
name|gint
name|x1
decl_stmt|,
name|x2
decl_stmt|;
name|gint
name|y1
decl_stmt|,
name|y2
decl_stmt|;
name|gint
name|w
decl_stmt|,
name|h
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|guide
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|guide
operator|->
name|position
operator|<
literal|0
condition|)
return|return;
if|if
condition|(
operator|!
name|initialized
condition|)
block|{
name|GdkGCValues
name|values
decl_stmt|;
name|GdkColor
name|fg
decl_stmt|;
name|GdkColor
name|bg
decl_stmt|;
specifier|const
name|guchar
name|stipple
index|[]
init|=
block|{
literal|0xF0
block|,
comment|/*  ####----  */
literal|0xE1
block|,
comment|/*  ###----#  */
literal|0xC3
block|,
comment|/*  ##----##  */
literal|0x87
block|,
comment|/*  #----###  */
literal|0x0F
block|,
comment|/*  ----####  */
literal|0x1E
block|,
comment|/*  ---####-  */
literal|0x3C
block|,
comment|/*  --####--  */
literal|0x78
block|,
comment|/*  -####---  */
block|}
decl_stmt|;
name|initialized
operator|=
name|TRUE
expr_stmt|;
block|{
name|fg
operator|.
name|red
operator|=
literal|0x0
expr_stmt|;
name|fg
operator|.
name|green
operator|=
literal|0x0
expr_stmt|;
name|fg
operator|.
name|blue
operator|=
literal|0x0
expr_stmt|;
name|bg
operator|.
name|red
operator|=
literal|0x0
expr_stmt|;
name|bg
operator|.
name|green
operator|=
literal|0x7f7f
expr_stmt|;
name|bg
operator|.
name|blue
operator|=
literal|0xffff
expr_stmt|;
name|values
operator|.
name|fill
operator|=
name|GDK_OPAQUE_STIPPLED
expr_stmt|;
name|values
operator|.
name|stipple
operator|=
name|gdk_bitmap_create_from_data
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|(
specifier|const
name|gchar
operator|*
operator|)
name|stipple
argument_list|,
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|normal_hgc
operator|=
name|gdk_gc_new_with_values
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|&
name|values
argument_list|,
name|GDK_GC_FILL
operator||
name|GDK_GC_STIPPLE
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_fg_color
argument_list|(
name|normal_hgc
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_bg_color
argument_list|(
name|normal_hgc
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
name|values
operator|.
name|fill
operator|=
name|GDK_OPAQUE_STIPPLED
expr_stmt|;
name|values
operator|.
name|stipple
operator|=
name|gdk_bitmap_create_from_data
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|(
specifier|const
name|gchar
operator|*
operator|)
name|stipple
argument_list|,
literal|1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|normal_vgc
operator|=
name|gdk_gc_new_with_values
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|&
name|values
argument_list|,
name|GDK_GC_FILL
operator||
name|GDK_GC_STIPPLE
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_fg_color
argument_list|(
name|normal_vgc
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_bg_color
argument_list|(
name|normal_vgc
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
block|}
block|{
name|fg
operator|.
name|red
operator|=
literal|0x0
expr_stmt|;
name|fg
operator|.
name|green
operator|=
literal|0x0
expr_stmt|;
name|fg
operator|.
name|blue
operator|=
literal|0x0
expr_stmt|;
name|bg
operator|.
name|red
operator|=
literal|0xffff
expr_stmt|;
name|bg
operator|.
name|green
operator|=
literal|0x0
expr_stmt|;
name|bg
operator|.
name|blue
operator|=
literal|0x0
expr_stmt|;
name|values
operator|.
name|fill
operator|=
name|GDK_OPAQUE_STIPPLED
expr_stmt|;
name|values
operator|.
name|stipple
operator|=
name|gdk_bitmap_create_from_data
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|(
specifier|const
name|gchar
operator|*
operator|)
name|stipple
argument_list|,
literal|8
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|active_hgc
operator|=
name|gdk_gc_new_with_values
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|&
name|values
argument_list|,
name|GDK_GC_FILL
operator||
name|GDK_GC_STIPPLE
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_fg_color
argument_list|(
name|active_hgc
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_bg_color
argument_list|(
name|active_hgc
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
name|values
operator|.
name|fill
operator|=
name|GDK_OPAQUE_STIPPLED
expr_stmt|;
name|values
operator|.
name|stipple
operator|=
name|gdk_bitmap_create_from_data
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|(
specifier|const
name|gchar
operator|*
operator|)
name|stipple
argument_list|,
literal|1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|active_vgc
operator|=
name|gdk_gc_new_with_values
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|&
name|values
argument_list|,
name|GDK_GC_FILL
operator||
name|GDK_GC_STIPPLE
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_fg_color
argument_list|(
name|active_vgc
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_bg_color
argument_list|(
name|active_vgc
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
block|}
block|}
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|width
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|height
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gdk_drawable_get_size
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|&
name|w
argument_list|,
operator|&
name|h
argument_list|)
expr_stmt|;
if|if
condition|(
name|x1
operator|<
literal|0
condition|)
name|x1
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|y1
operator|<
literal|0
condition|)
name|y1
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|x2
operator|>
name|w
condition|)
name|x2
operator|=
name|w
expr_stmt|;
if|if
condition|(
name|y2
operator|>
name|h
condition|)
name|y2
operator|=
name|h
expr_stmt|;
if|if
condition|(
name|guide
operator|->
name|orientation
operator|==
name|GIMP_ORIENTATION_HORIZONTAL
condition|)
block|{
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
literal|0
argument_list|,
name|guide
operator|->
name|position
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|active
condition|)
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|active_hgc
argument_list|,
name|x1
argument_list|,
name|y
argument_list|,
name|x2
argument_list|,
name|y
argument_list|)
expr_stmt|;
else|else
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|normal_hgc
argument_list|,
name|x1
argument_list|,
name|y
argument_list|,
name|x2
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|guide
operator|->
name|orientation
operator|==
name|GIMP_ORIENTATION_VERTICAL
condition|)
block|{
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
name|guide
operator|->
name|position
argument_list|,
literal|0
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|active
condition|)
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|active_vgc
argument_list|,
name|x
argument_list|,
name|y1
argument_list|,
name|x
argument_list|,
name|y2
argument_list|)
expr_stmt|;
else|else
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|normal_vgc
argument_list|,
name|x
argument_list|,
name|y1
argument_list|,
name|x
argument_list|,
name|y2
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_draw_guides (GimpDisplayShell * shell)
name|gimp_display_shell_draw_guides
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_display_shell_get_show_guides
argument_list|(
name|shell
argument_list|)
condition|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
for|for
control|(
name|list
operator|=
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|guides
init|;
name|list
condition|;
name|list
operator|=
name|list
operator|->
name|next
control|)
block|{
name|gimp_display_shell_draw_guide
argument_list|(
name|shell
argument_list|,
operator|(
name|GimpGuide
operator|*
operator|)
name|list
operator|->
name|data
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_draw_grid (GimpDisplayShell * shell)
name|gimp_display_shell_draw_grid
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|GdkGC
modifier|*
name|gc
decl_stmt|;
name|GdkGCValues
name|values
decl_stmt|;
name|GdkColor
name|fg
decl_stmt|,
name|bg
decl_stmt|;
name|GimpGrid
modifier|*
name|grid
decl_stmt|;
name|gint
name|x1
decl_stmt|,
name|x2
decl_stmt|;
name|gint
name|y1
decl_stmt|,
name|y2
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gint
name|x_real
decl_stmt|,
name|y_real
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
specifier|const
name|gint
name|length
init|=
literal|2
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|grid
operator|=
name|GIMP_GRID
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|grid
argument_list|)
expr_stmt|;
if|if
condition|(
name|grid
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|gimp_display_shell_get_show_grid
argument_list|(
name|shell
argument_list|)
condition|)
block|{
switch|switch
condition|(
name|grid
operator|->
name|type
condition|)
block|{
case|case
name|GIMP_GRID_TYPE_ON_OFF_DASH
case|:
name|values
operator|.
name|line_style
operator|=
name|GDK_LINE_ON_OFF_DASH
expr_stmt|;
break|break;
case|case
name|GIMP_GRID_TYPE_DOUBLE_DASH
case|:
name|values
operator|.
name|line_style
operator|=
name|GDK_LINE_DOUBLE_DASH
expr_stmt|;
break|break;
case|case
name|GIMP_GRID_TYPE_DOTS
case|:
case|case
name|GIMP_GRID_TYPE_INTERSECTIONS
case|:
case|case
name|GIMP_GRID_TYPE_SOLID
case|:
name|values
operator|.
name|line_style
operator|=
name|GDK_LINE_SOLID
expr_stmt|;
break|break;
block|}
name|values
operator|.
name|join_style
operator|=
name|GDK_JOIN_MITER
expr_stmt|;
comment|/* FIXME: This GC should be part of the display and should          be changed only when one of the relevant grid properties          changes (on notify)        */
name|gc
operator|=
name|gdk_gc_new_with_values
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
operator|&
name|values
argument_list|,
name|GDK_GC_LINE_STYLE
operator||
name|GDK_GC_JOIN_STYLE
argument_list|)
expr_stmt|;
name|gimp_rgb_get_gdk_color
argument_list|(
operator|&
name|grid
operator|->
name|fgcolor
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gimp_rgb_get_gdk_color
argument_list|(
operator|&
name|grid
operator|->
name|bgcolor
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_fg_color
argument_list|(
name|gc
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_rgb_bg_color
argument_list|(
name|gc
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|width
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|height
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|width
operator|=
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|height
expr_stmt|;
switch|switch
condition|(
name|grid
operator|->
name|type
condition|)
block|{
case|case
name|GIMP_GRID_TYPE_DOTS
case|:
for|for
control|(
name|x
operator|=
name|grid
operator|->
name|xoffset
init|;
name|x
operator|<=
name|width
condition|;
name|x
operator|+=
name|grid
operator|->
name|xspacing
control|)
block|{
for|for
control|(
name|y
operator|=
name|grid
operator|->
name|yoffset
init|;
name|y
operator|<=
name|height
condition|;
name|y
operator|+=
name|grid
operator|->
name|yspacing
control|)
block|{
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|x_real
argument_list|,
operator|&
name|y_real
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|x_real
operator|>=
name|x1
operator|&&
name|x_real
operator|<
name|x2
operator|&&
name|y_real
operator|>=
name|y1
operator|&&
name|y_real
operator|<
name|y2
condition|)
block|{
name|gdk_draw_point
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|gc
argument_list|,
name|x_real
argument_list|,
name|y_real
argument_list|)
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|GIMP_GRID_TYPE_INTERSECTIONS
case|:
for|for
control|(
name|x
operator|=
name|grid
operator|->
name|xoffset
init|;
name|x
operator|<=
name|width
condition|;
name|x
operator|+=
name|grid
operator|->
name|xspacing
control|)
block|{
for|for
control|(
name|y
operator|=
name|grid
operator|->
name|yoffset
init|;
name|y
operator|<=
name|height
condition|;
name|y
operator|+=
name|grid
operator|->
name|yspacing
control|)
block|{
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|x_real
argument_list|,
operator|&
name|y_real
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|x_real
operator|>=
name|x1
operator|&&
name|x_real
operator|<
name|x2
condition|)
block|{
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|gc
argument_list|,
name|x_real
argument_list|,
name|CLAMP
argument_list|(
name|y_real
operator|-
name|length
argument_list|,
name|y1
argument_list|,
name|y2
operator|-
literal|1
argument_list|)
argument_list|,
name|x_real
argument_list|,
name|CLAMP
argument_list|(
name|y_real
operator|+
name|length
argument_list|,
name|y1
argument_list|,
name|y2
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|y_real
operator|>=
name|y1
operator|&&
name|y_real
operator|<
name|y2
condition|)
block|{
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|gc
argument_list|,
name|CLAMP
argument_list|(
name|x_real
operator|-
name|length
argument_list|,
name|x1
argument_list|,
name|x2
operator|-
literal|1
argument_list|)
argument_list|,
name|y_real
argument_list|,
name|CLAMP
argument_list|(
name|x_real
operator|+
name|length
argument_list|,
name|x1
argument_list|,
name|x2
operator|-
literal|1
argument_list|)
argument_list|,
name|y_real
argument_list|)
expr_stmt|;
block|}
block|}
block|}
break|break;
case|case
name|GIMP_GRID_TYPE_ON_OFF_DASH
case|:
case|case
name|GIMP_GRID_TYPE_DOUBLE_DASH
case|:
case|case
name|GIMP_GRID_TYPE_SOLID
case|:
for|for
control|(
name|x
operator|=
name|grid
operator|->
name|xoffset
init|;
name|x
operator|<
name|width
condition|;
name|x
operator|+=
name|grid
operator|->
name|xspacing
control|)
block|{
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
name|x
argument_list|,
literal|0
argument_list|,
operator|&
name|x_real
argument_list|,
operator|&
name|y_real
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|x_real
operator|>
name|x1
condition|)
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|gc
argument_list|,
name|x_real
argument_list|,
name|y1
argument_list|,
name|x_real
argument_list|,
name|y2
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|y
operator|=
name|grid
operator|->
name|yoffset
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|+=
name|grid
operator|->
name|yspacing
control|)
block|{
name|gimp_display_shell_transform_xy
argument_list|(
name|shell
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
operator|&
name|x_real
argument_list|,
operator|&
name|y_real
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|y_real
operator|>
name|y1
condition|)
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|gc
argument_list|,
name|x1
argument_list|,
name|y_real
argument_list|,
name|x2
operator|-
literal|1
argument_list|,
name|y_real
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
name|g_object_unref
argument_list|(
name|gc
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_draw_vector (GimpDisplayShell * shell,GimpVectors * vectors)
name|gimp_display_shell_draw_vector
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|GimpVectors
modifier|*
name|vectors
parameter_list|)
block|{
specifier|static
name|GdkGC
modifier|*
name|xor_gc
init|=
name|NULL
decl_stmt|;
name|GimpStroke
modifier|*
name|stroke
init|=
name|NULL
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_VECTORS
argument_list|(
name|vectors
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|xor_gc
condition|)
block|{
name|GdkColor
name|fg
decl_stmt|;
name|GdkColor
name|bg
decl_stmt|;
name|xor_gc
operator|=
name|gdk_gc_new
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|xor_gc
argument_list|,
name|GDK_INVERT
argument_list|)
expr_stmt|;
name|fg
operator|.
name|pixel
operator|=
literal|0xFFFFFFFF
expr_stmt|;
name|bg
operator|.
name|pixel
operator|=
literal|0x00000000
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|xor_gc
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_background
argument_list|(
name|xor_gc
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
name|gdk_gc_set_line_attributes
argument_list|(
name|xor_gc
argument_list|,
literal|0
argument_list|,
name|GDK_LINE_SOLID
argument_list|,
name|GDK_CAP_NOT_LAST
argument_list|,
name|GDK_JOIN_MITER
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
operator|(
name|stroke
operator|=
name|gimp_vectors_stroke_get_next
argument_list|(
name|vectors
argument_list|,
name|stroke
argument_list|)
operator|)
condition|)
block|{
name|GArray
modifier|*
name|coords
decl_stmt|;
name|gboolean
name|closed
decl_stmt|;
name|coords
operator|=
name|gimp_stroke_interpolate
argument_list|(
name|stroke
argument_list|,
literal|1.0
argument_list|,
operator|&
name|closed
argument_list|)
expr_stmt|;
if|if
condition|(
name|coords
operator|->
name|len
condition|)
block|{
name|GimpCoords
modifier|*
name|coord
decl_stmt|;
name|GdkPoint
modifier|*
name|gdk_coords
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gdouble
name|sx
decl_stmt|,
name|sy
decl_stmt|;
name|gdk_coords
operator|=
name|g_new
argument_list|(
name|GdkPoint
argument_list|,
name|coords
operator|->
name|len
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|coords
operator|->
name|len
condition|;
name|i
operator|++
control|)
block|{
name|coord
operator|=
operator|&
name|g_array_index
argument_list|(
name|coords
argument_list|,
name|GimpCoords
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy_f
argument_list|(
name|shell
argument_list|,
name|coord
operator|->
name|x
argument_list|,
name|coord
operator|->
name|y
argument_list|,
operator|&
name|sx
argument_list|,
operator|&
name|sy
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gdk_coords
index|[
name|i
index|]
operator|.
name|x
operator|=
name|ROUND
argument_list|(
name|sx
argument_list|)
expr_stmt|;
name|gdk_coords
index|[
name|i
index|]
operator|.
name|y
operator|=
name|ROUND
argument_list|(
name|sy
argument_list|)
expr_stmt|;
block|}
name|gdk_draw_lines
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|xor_gc
argument_list|,
name|gdk_coords
argument_list|,
name|coords
operator|->
name|len
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gdk_coords
argument_list|)
expr_stmt|;
block|}
name|g_array_free
argument_list|(
name|coords
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_draw_vectors (GimpDisplayShell * shell)
name|gimp_display_shell_draw_vectors
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|TRUE
comment|/* gimp_display_shell_get_show_vectors (shell) */
condition|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
for|for
control|(
name|list
operator|=
name|GIMP_LIST
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|vectors
argument_list|)
operator|->
name|list
init|;
name|list
condition|;
name|list
operator|=
name|list
operator|->
name|next
control|)
block|{
name|GimpVectors
modifier|*
name|vectors
init|=
name|list
operator|->
name|data
decl_stmt|;
if|if
condition|(
name|gimp_item_get_visible
argument_list|(
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|)
condition|)
name|gimp_display_shell_draw_vector
argument_list|(
name|shell
argument_list|,
name|vectors
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_draw_area (GimpDisplayShell * shell,gint x,gint y,gint w,gint h)
name|gimp_display_shell_draw_area
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|w
parameter_list|,
name|gint
name|h
parameter_list|)
block|{
name|gint
name|sx
decl_stmt|,
name|sy
decl_stmt|;
name|gint
name|x1
decl_stmt|,
name|y1
decl_stmt|;
name|gint
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|gint
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|sx
operator|=
name|SCALEX
argument_list|(
name|shell
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|width
argument_list|)
expr_stmt|;
name|sy
operator|=
name|SCALEY
argument_list|(
name|shell
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|height
argument_list|)
expr_stmt|;
comment|/*  Bounds checks  */
name|x1
operator|=
name|CLAMP
argument_list|(
name|x
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_width
argument_list|)
expr_stmt|;
name|y1
operator|=
name|CLAMP
argument_list|(
name|y
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_height
argument_list|)
expr_stmt|;
name|x2
operator|=
name|CLAMP
argument_list|(
name|x
operator|+
name|w
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_width
argument_list|)
expr_stmt|;
name|y2
operator|=
name|CLAMP
argument_list|(
name|y
operator|+
name|h
argument_list|,
literal|0
argument_list|,
name|shell
operator|->
name|disp_height
argument_list|)
expr_stmt|;
name|x1
operator|=
name|MAX
argument_list|(
name|x1
argument_list|,
name|shell
operator|->
name|disp_xoffset
argument_list|)
expr_stmt|;
name|y1
operator|=
name|MAX
argument_list|(
name|y1
argument_list|,
name|shell
operator|->
name|disp_yoffset
argument_list|)
expr_stmt|;
name|x2
operator|=
name|MIN
argument_list|(
name|x2
argument_list|,
name|shell
operator|->
name|disp_xoffset
operator|+
name|sx
argument_list|)
expr_stmt|;
name|y2
operator|=
name|MIN
argument_list|(
name|y2
argument_list|,
name|shell
operator|->
name|disp_yoffset
operator|+
name|sy
argument_list|)
expr_stmt|;
comment|/*  display the image in RENDER_BUF_WIDTH x RENDER_BUF_HEIGHT sized chunks */
for|for
control|(
name|i
operator|=
name|y1
init|;
name|i
operator|<
name|y2
condition|;
name|i
operator|+=
name|GIMP_DISPLAY_SHELL_RENDER_BUF_HEIGHT
control|)
block|{
for|for
control|(
name|j
operator|=
name|x1
init|;
name|j
operator|<
name|x2
condition|;
name|j
operator|+=
name|GIMP_DISPLAY_SHELL_RENDER_BUF_WIDTH
control|)
block|{
name|dx
operator|=
name|MIN
argument_list|(
name|x2
operator|-
name|j
argument_list|,
name|GIMP_DISPLAY_SHELL_RENDER_BUF_WIDTH
argument_list|)
expr_stmt|;
name|dy
operator|=
name|MIN
argument_list|(
name|y2
operator|-
name|i
argument_list|,
name|GIMP_DISPLAY_SHELL_RENDER_BUF_HEIGHT
argument_list|)
expr_stmt|;
name|gimp_display_shell_render
argument_list|(
name|shell
argument_list|,
name|j
operator|-
name|shell
operator|->
name|disp_xoffset
argument_list|,
name|i
operator|-
name|shell
operator|->
name|disp_yoffset
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|STRESS_TEST
comment|/* Invalidate the projection just after we render it! */
name|gimp_image_invalidate_without_render
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|,
name|j
operator|-
name|shell
operator|->
name|disp_xoffset
argument_list|,
name|i
operator|-
name|shell
operator|->
name|disp_yoffset
argument_list|,
name|dx
argument_list|,
name|dy
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_draw_cursor (GimpDisplayShell * shell)
name|gimp_display_shell_draw_cursor
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|x
operator|=
name|shell
operator|->
name|cursor_x
expr_stmt|;
name|y
operator|=
name|shell
operator|->
name|cursor_y
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|shell
operator|->
name|canvas
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|x
operator|-
literal|7
argument_list|,
name|y
operator|-
literal|1
argument_list|,
name|x
operator|+
literal|7
argument_list|,
name|y
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|shell
operator|->
name|canvas
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|x
operator|-
literal|7
argument_list|,
name|y
argument_list|,
name|x
operator|+
literal|7
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|shell
operator|->
name|canvas
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|x
operator|-
literal|7
argument_list|,
name|y
operator|+
literal|1
argument_list|,
name|x
operator|+
literal|7
argument_list|,
name|y
operator|+
literal|1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|shell
operator|->
name|canvas
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|x
operator|-
literal|1
argument_list|,
name|y
operator|-
literal|7
argument_list|,
name|x
operator|-
literal|1
argument_list|,
name|y
operator|+
literal|7
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|shell
operator|->
name|canvas
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|x
argument_list|,
name|y
operator|-
literal|7
argument_list|,
name|x
argument_list|,
name|y
operator|+
literal|7
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|shell
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|shell
operator|->
name|canvas
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|y
operator|-
literal|7
argument_list|,
name|x
operator|+
literal|1
argument_list|,
name|y
operator|+
literal|7
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_shrink_wrap (GimpDisplayShell * shell)
name|gimp_display_shell_shrink_wrap
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|GdkScreen
modifier|*
name|screen
decl_stmt|;
name|gint
name|disp_width
decl_stmt|,
name|disp_height
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
name|gint
name|shell_width
decl_stmt|,
name|shell_height
decl_stmt|;
name|gint
name|max_auto_width
decl_stmt|,
name|max_auto_height
decl_stmt|;
name|gint
name|border_x
decl_stmt|,
name|border_y
decl_stmt|;
name|gint
name|s_width
decl_stmt|,
name|s_height
decl_stmt|;
name|gboolean
name|resize
init|=
name|FALSE
decl_stmt|;
name|screen
operator|=
name|gtk_widget_get_screen
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
name|s_width
operator|=
name|gdk_screen_get_width
argument_list|(
name|screen
argument_list|)
expr_stmt|;
name|s_height
operator|=
name|gdk_screen_get_height
argument_list|(
name|screen
argument_list|)
expr_stmt|;
name|width
operator|=
name|SCALEX
argument_list|(
name|shell
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|width
argument_list|)
expr_stmt|;
name|height
operator|=
name|SCALEY
argument_list|(
name|shell
argument_list|,
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|height
argument_list|)
expr_stmt|;
name|disp_width
operator|=
name|shell
operator|->
name|disp_width
expr_stmt|;
name|disp_height
operator|=
name|shell
operator|->
name|disp_height
expr_stmt|;
name|shell_width
operator|=
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
operator|->
name|allocation
operator|.
name|width
expr_stmt|;
name|shell_height
operator|=
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
operator|->
name|allocation
operator|.
name|height
expr_stmt|;
name|border_x
operator|=
name|shell_width
operator|-
name|disp_width
expr_stmt|;
name|border_y
operator|=
name|shell_height
operator|-
name|disp_height
expr_stmt|;
name|max_auto_width
operator|=
operator|(
name|s_width
operator|-
name|border_x
operator|)
operator|*
literal|0.75
expr_stmt|;
name|max_auto_height
operator|=
operator|(
name|s_height
operator|-
name|border_y
operator|)
operator|*
literal|0.75
expr_stmt|;
comment|/* If one of the display dimensions has changed and one of the    * dimensions fits inside the screen    */
if|if
condition|(
operator|(
operator|(
name|width
operator|+
name|border_x
operator|)
operator|<
name|s_width
operator|||
operator|(
name|height
operator|+
name|border_y
operator|)
operator|<
name|s_height
operator|)
operator|&&
operator|(
name|width
operator|!=
name|disp_width
operator|||
name|height
operator|!=
name|disp_height
operator|)
condition|)
block|{
name|width
operator|=
operator|(
operator|(
name|width
operator|+
name|border_x
operator|)
operator|<
name|s_width
operator|)
condition|?
name|width
else|:
name|max_auto_width
expr_stmt|;
name|height
operator|=
operator|(
operator|(
name|height
operator|+
name|border_y
operator|)
operator|<
name|s_height
operator|)
condition|?
name|height
else|:
name|max_auto_height
expr_stmt|;
name|resize
operator|=
name|TRUE
expr_stmt|;
block|}
comment|/*  If the projected dimension is greater than current, but less than    *  3/4 of the screen size, expand automagically    */
elseif|else
if|if
condition|(
operator|(
name|width
operator|>
name|disp_width
operator|||
name|height
operator|>
name|disp_height
operator|)
operator|&&
operator|(
name|disp_width
operator|<
name|max_auto_width
operator|||
name|disp_height
operator|<
name|max_auto_height
operator|)
condition|)
block|{
name|width
operator|=
name|MIN
argument_list|(
name|max_auto_width
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|height
operator|=
name|MIN
argument_list|(
name|max_auto_height
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|resize
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|resize
condition|)
block|{
if|if
condition|(
name|width
operator|<
name|shell
operator|->
name|statusbar
operator|->
name|requisition
operator|.
name|width
condition|)
name|width
operator|=
name|shell
operator|->
name|statusbar
operator|->
name|requisition
operator|.
name|width
expr_stmt|;
name|gtk_window_resize
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
argument_list|)
argument_list|,
name|width
operator|+
name|border_x
argument_list|,
name|height
operator|+
name|border_y
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_display_shell_selection_visibility (GimpDisplayShell * shell,GimpSelectionControl control)
name|gimp_display_shell_selection_visibility
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|GimpSelectionControl
name|control
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|shell
operator|->
name|select
condition|)
block|{
switch|switch
condition|(
name|control
condition|)
block|{
case|case
name|GIMP_SELECTION_OFF
case|:
name|gimp_display_shell_selection_invis
argument_list|(
name|shell
operator|->
name|select
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_SELECTION_LAYER_OFF
case|:
name|gimp_display_shell_selection_layer_invis
argument_list|(
name|shell
operator|->
name|select
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_SELECTION_ON
case|:
name|gimp_display_shell_selection_start
argument_list|(
name|shell
operator|->
name|select
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_SELECTION_PAUSE
case|:
name|gimp_display_shell_selection_pause
argument_list|(
name|shell
operator|->
name|select
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_SELECTION_RESUME
case|:
name|gimp_display_shell_selection_resume
argument_list|(
name|shell
operator|->
name|select
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  private functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_close_warning_dialog (GimpDisplayShell * shell,GimpImage * gimage)
name|gimp_display_shell_close_warning_dialog
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|,
name|GimpImage
modifier|*
name|gimage
parameter_list|)
block|{
name|gchar
modifier|*
name|name
decl_stmt|;
name|gchar
modifier|*
name|title
decl_stmt|;
name|gchar
modifier|*
name|warning
decl_stmt|;
if|if
condition|(
name|shell
operator|->
name|warning_dialog
condition|)
block|{
name|gtk_window_present
argument_list|(
name|GTK_WINDOW
argument_list|(
name|shell
operator|->
name|warning_dialog
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|name
operator|=
name|file_utils_uri_to_utf8_basename
argument_list|(
name|gimp_image_get_uri
argument_list|(
name|gimage
argument_list|)
argument_list|)
expr_stmt|;
name|title
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Close %s?"
argument_list|)
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|warning
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Changes were made to %s.\n"
literal|"Close anyway?"
argument_list|)
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
block|shell->warning_dialog = gtk_message_dialog_new (shell->window, 						  0, 						  GTK_MESSAGE_QUESTION,);
endif|#
directive|endif
name|shell
operator|->
name|warning_dialog
operator|=
name|gimp_query_boolean_box
argument_list|(
name|title
argument_list|,
name|gimp_standard_help_func
argument_list|,
name|GIMP_HELP_FILE_CLOSE_CONFIRM
argument_list|,
name|GIMP_STOCK_QUESTION
argument_list|,
name|warning
argument_list|,
name|GTK_STOCK_CLOSE
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_display_shell_close_warning_callback
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|warning
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|shell
operator|->
name|warning_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_close_warning_callback (GtkWidget * widget,gboolean close,gpointer data)
name|gimp_display_shell_close_warning_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|close
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpDisplayShell
modifier|*
name|shell
decl_stmt|;
name|shell
operator|=
name|GIMP_DISPLAY_SHELL
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|shell
operator|->
name|warning_dialog
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|close
condition|)
name|gimp_display_delete
argument_list|(
name|shell
operator|->
name|gdisp
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

