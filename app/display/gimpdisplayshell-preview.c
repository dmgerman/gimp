begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"display-types.h"
end_include

begin_include
include|#
directive|include
file|"tools/tools-types.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdrawable.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpchannel.h"
end_include

begin_include
include|#
directive|include
file|"base/tile-manager.h"
end_include

begin_include
include|#
directive|include
file|"tools/gimptransformtool.h"
end_include

begin_include
include|#
directive|include
file|"tools/tool_manager.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-appearance.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-preview.h"
end_include

begin_include
include|#
directive|include
file|"gimpdisplayshell-transform.h"
end_include

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_draw_quad
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GimpChannel
modifier|*
name|mask
parameter_list|,
name|gint
name|mask_offx
parameter_list|,
name|gint
name|mask_offy
parameter_list|,
name|gint
modifier|*
name|x
parameter_list|,
name|gint
modifier|*
name|y
parameter_list|,
name|gfloat
modifier|*
name|u
parameter_list|,
name|gfloat
modifier|*
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_draw_tri
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GimpChannel
modifier|*
name|mask
parameter_list|,
name|gint
name|mask_offx
parameter_list|,
name|gint
name|mask_offy
parameter_list|,
name|gint
modifier|*
name|x
parameter_list|,
name|gint
modifier|*
name|y
parameter_list|,
name|gfloat
modifier|*
name|u
parameter_list|,
name|gfloat
modifier|*
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_draw_tri_row
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GdkPixbuf
modifier|*
name|row
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gfloat
name|u1
parameter_list|,
name|gfloat
name|v1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gfloat
name|u2
parameter_list|,
name|gfloat
name|v2
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_draw_tri_row_mask
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GdkPixbuf
modifier|*
name|row
parameter_list|,
name|GimpChannel
modifier|*
name|mask
parameter_list|,
name|gint
name|mask_offx
parameter_list|,
name|gint
name|mask_offy
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gfloat
name|u1
parameter_list|,
name|gfloat
name|v1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gfloat
name|u2
parameter_list|,
name|gfloat
name|v2
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_display_shell_trace_tri_edge
parameter_list|(
name|gint
modifier|*
name|dest
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gint
name|y1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gint
name|y2
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  public functions  */
end_comment

begin_function
name|void
DECL|function|gimp_display_shell_preview_transform (GimpDisplayShell * shell)
name|gimp_display_shell_preview_transform
parameter_list|(
name|GimpDisplayShell
modifier|*
name|shell
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DISPLAY_SHELL
argument_list|(
name|shell
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_display_shell_get_show_transform
argument_list|(
name|shell
argument_list|)
condition|)
block|{
name|GimpTool
modifier|*
name|tool
decl_stmt|;
name|GimpTransformTool
modifier|*
name|tr_tool
decl_stmt|;
name|gdouble
name|z1
decl_stmt|,
name|z2
decl_stmt|,
name|z3
decl_stmt|,
name|z4
decl_stmt|;
name|tool
operator|=
name|tool_manager_get_active
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
operator|->
name|gimp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GIMP_IS_TRANSFORM_TOOL
argument_list|(
name|tool
argument_list|)
operator|||
operator|!
name|GIMP_IS_DRAWABLE
argument_list|(
name|tool
operator|->
name|drawable
argument_list|)
condition|)
return|return;
name|tr_tool
operator|=
name|GIMP_TRANSFORM_TOOL
argument_list|(
name|tool
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|tr_tool
operator|->
name|use_grid
condition|)
return|return;
name|z1
operator|=
operator|(
operator|(
name|tr_tool
operator|->
name|tx2
operator|-
name|tr_tool
operator|->
name|tx1
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty4
operator|-
name|tr_tool
operator|->
name|ty1
operator|)
operator|-
operator|(
name|tr_tool
operator|->
name|tx4
operator|-
name|tr_tool
operator|->
name|tx1
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty2
operator|-
name|tr_tool
operator|->
name|ty1
operator|)
operator|)
expr_stmt|;
name|z2
operator|=
operator|(
operator|(
name|tr_tool
operator|->
name|tx4
operator|-
name|tr_tool
operator|->
name|tx1
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty3
operator|-
name|tr_tool
operator|->
name|ty1
operator|)
operator|-
operator|(
name|tr_tool
operator|->
name|tx3
operator|-
name|tr_tool
operator|->
name|tx1
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty4
operator|-
name|tr_tool
operator|->
name|ty1
operator|)
operator|)
expr_stmt|;
name|z3
operator|=
operator|(
operator|(
name|tr_tool
operator|->
name|tx4
operator|-
name|tr_tool
operator|->
name|tx2
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty3
operator|-
name|tr_tool
operator|->
name|ty2
operator|)
operator|-
operator|(
name|tr_tool
operator|->
name|tx3
operator|-
name|tr_tool
operator|->
name|tx2
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty4
operator|-
name|tr_tool
operator|->
name|ty2
operator|)
operator|)
expr_stmt|;
name|z4
operator|=
operator|(
operator|(
name|tr_tool
operator|->
name|tx3
operator|-
name|tr_tool
operator|->
name|tx2
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty1
operator|-
name|tr_tool
operator|->
name|ty2
operator|)
operator|-
operator|(
name|tr_tool
operator|->
name|tx1
operator|-
name|tr_tool
operator|->
name|tx2
operator|)
operator|*
operator|(
name|tr_tool
operator|->
name|ty3
operator|-
name|tr_tool
operator|->
name|ty2
operator|)
operator|)
expr_stmt|;
comment|/* only draw convex polygons */
if|if
condition|(
operator|(
name|z1
operator|*
name|z2
operator|>
literal|0
operator|)
operator|&&
operator|(
name|z3
operator|*
name|z4
operator|>
literal|0
operator|)
condition|)
block|{
name|gdouble
name|dx
index|[
literal|4
index|]
decl_stmt|,
name|dy
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|x
index|[
literal|4
index|]
decl_stmt|,
name|y
index|[
literal|4
index|]
decl_stmt|;
name|gfloat
name|u
index|[
literal|4
index|]
decl_stmt|,
name|v
index|[
literal|4
index|]
decl_stmt|;
name|GimpChannel
modifier|*
name|mask
decl_stmt|;
name|gint
name|mask_x1
decl_stmt|,
name|mask_y1
decl_stmt|;
name|gint
name|mask_x2
decl_stmt|,
name|mask_y2
decl_stmt|;
name|gint
name|mask_offx
decl_stmt|,
name|mask_offy
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gimp_display_shell_transform_xy_f
argument_list|(
name|shell
argument_list|,
name|tr_tool
operator|->
name|tx1
argument_list|,
name|tr_tool
operator|->
name|ty1
argument_list|,
name|dx
operator|+
literal|0
argument_list|,
name|dy
operator|+
literal|0
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy_f
argument_list|(
name|shell
argument_list|,
name|tr_tool
operator|->
name|tx2
argument_list|,
name|tr_tool
operator|->
name|ty2
argument_list|,
name|dx
operator|+
literal|1
argument_list|,
name|dy
operator|+
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy_f
argument_list|(
name|shell
argument_list|,
name|tr_tool
operator|->
name|tx3
argument_list|,
name|tr_tool
operator|->
name|ty3
argument_list|,
name|dx
operator|+
literal|2
argument_list|,
name|dy
operator|+
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_display_shell_transform_xy_f
argument_list|(
name|shell
argument_list|,
name|tr_tool
operator|->
name|tx4
argument_list|,
name|tr_tool
operator|->
name|ty4
argument_list|,
name|dx
operator|+
literal|3
argument_list|,
name|dy
operator|+
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|x
index|[
name|i
index|]
operator|=
operator|(
name|gint
operator|)
name|dx
index|[
name|i
index|]
expr_stmt|;
name|y
index|[
name|i
index|]
operator|=
operator|(
name|gint
operator|)
name|dy
index|[
name|i
index|]
expr_stmt|;
block|}
name|mask
operator|=
name|NULL
expr_stmt|;
name|mask_offx
operator|=
name|mask_offy
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|gimp_drawable_mask_bounds
argument_list|(
name|tool
operator|->
name|drawable
argument_list|,
operator|&
name|mask_x1
argument_list|,
operator|&
name|mask_y1
argument_list|,
operator|&
name|mask_x2
argument_list|,
operator|&
name|mask_y2
argument_list|)
condition|)
block|{
name|mask
operator|=
name|gimp_image_get_mask
argument_list|(
name|shell
operator|->
name|gdisp
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|gimp_item_offsets
argument_list|(
name|GIMP_ITEM
argument_list|(
name|tool
operator|->
name|drawable
argument_list|)
argument_list|,
operator|&
name|mask_offx
argument_list|,
operator|&
name|mask_offy
argument_list|)
expr_stmt|;
block|}
name|u
index|[
literal|0
index|]
operator|=
name|mask_x1
expr_stmt|;
name|v
index|[
literal|0
index|]
operator|=
name|mask_y1
expr_stmt|;
name|u
index|[
literal|1
index|]
operator|=
name|mask_x2
expr_stmt|;
name|v
index|[
literal|1
index|]
operator|=
name|mask_y1
expr_stmt|;
name|u
index|[
literal|2
index|]
operator|=
name|mask_x1
expr_stmt|;
name|v
index|[
literal|2
index|]
operator|=
name|mask_y2
expr_stmt|;
name|u
index|[
literal|3
index|]
operator|=
name|mask_x2
expr_stmt|;
name|v
index|[
literal|3
index|]
operator|=
name|mask_y2
expr_stmt|;
name|gimp_display_shell_draw_quad
argument_list|(
name|tool
operator|->
name|drawable
argument_list|,
name|GDK_DRAWABLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
operator|->
name|canvas
argument_list|)
operator|->
name|window
argument_list|)
argument_list|,
name|mask
argument_list|,
name|mask_offx
argument_list|,
name|mask_offy
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|u
argument_list|,
name|v
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  private functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_draw_quad (GimpDrawable * texture,GdkDrawable * dest,GimpChannel * mask,gint mask_offx,gint mask_offy,gint * x,gint * y,gfloat * u,gfloat * v)
name|gimp_display_shell_draw_quad
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GimpChannel
modifier|*
name|mask
parameter_list|,
name|gint
name|mask_offx
parameter_list|,
name|gint
name|mask_offy
parameter_list|,
name|gint
modifier|*
name|x
parameter_list|,
name|gint
modifier|*
name|y
parameter_list|,
name|gfloat
modifier|*
name|u
parameter_list|,
name|gfloat
modifier|*
name|v
parameter_list|)
block|{
name|gint
name|x2
index|[
literal|3
index|]
decl_stmt|,
name|y2
index|[
literal|3
index|]
decl_stmt|;
name|gfloat
name|u2
index|[
literal|3
index|]
decl_stmt|,
name|v2
index|[
literal|3
index|]
decl_stmt|;
name|x2
index|[
literal|0
index|]
operator|=
name|x
index|[
literal|3
index|]
expr_stmt|;
name|y2
index|[
literal|0
index|]
operator|=
name|y
index|[
literal|3
index|]
expr_stmt|;
name|u2
index|[
literal|0
index|]
operator|=
name|u
index|[
literal|3
index|]
expr_stmt|;
name|v2
index|[
literal|0
index|]
operator|=
name|v
index|[
literal|3
index|]
expr_stmt|;
name|x2
index|[
literal|1
index|]
operator|=
name|x
index|[
literal|2
index|]
expr_stmt|;
name|y2
index|[
literal|1
index|]
operator|=
name|y
index|[
literal|2
index|]
expr_stmt|;
name|u2
index|[
literal|1
index|]
operator|=
name|u
index|[
literal|2
index|]
expr_stmt|;
name|v2
index|[
literal|1
index|]
operator|=
name|v
index|[
literal|2
index|]
expr_stmt|;
name|x2
index|[
literal|2
index|]
operator|=
name|x
index|[
literal|1
index|]
expr_stmt|;
name|y2
index|[
literal|2
index|]
operator|=
name|y
index|[
literal|1
index|]
expr_stmt|;
name|u2
index|[
literal|2
index|]
operator|=
name|u
index|[
literal|1
index|]
expr_stmt|;
name|v2
index|[
literal|2
index|]
operator|=
name|v
index|[
literal|1
index|]
expr_stmt|;
name|gimp_display_shell_draw_tri
argument_list|(
name|texture
argument_list|,
name|dest
argument_list|,
name|mask
argument_list|,
name|mask_offx
argument_list|,
name|mask_offy
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|u
argument_list|,
name|v
argument_list|)
expr_stmt|;
name|gimp_display_shell_draw_tri
argument_list|(
name|texture
argument_list|,
name|dest
argument_list|,
name|mask
argument_list|,
name|mask_offx
argument_list|,
name|mask_offy
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|,
name|u2
argument_list|,
name|v2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_draw_tri (GimpDrawable * texture,GdkDrawable * dest,GimpChannel * mask,gint mask_offx,gint mask_offy,gint * x,gint * y,gfloat * u,gfloat * v)
name|gimp_display_shell_draw_tri
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GimpChannel
modifier|*
name|mask
parameter_list|,
name|gint
name|mask_offx
parameter_list|,
name|gint
name|mask_offy
parameter_list|,
name|gint
modifier|*
name|x
parameter_list|,
name|gint
modifier|*
name|y
parameter_list|,
name|gfloat
modifier|*
name|u
parameter_list|,
comment|/* texture coords */
name|gfloat
modifier|*
name|v
parameter_list|)
comment|/* 0.0 ... tex width, height */
block|{
name|GdkPixbuf
modifier|*
name|row
decl_stmt|;
name|gint
name|dwidth
decl_stmt|,
name|dheight
decl_stmt|;
comment|/* clip boundary */
name|gint
name|j
decl_stmt|,
name|k
decl_stmt|;
name|gint
name|ry
decl_stmt|;
name|gint
modifier|*
name|l_edge
decl_stmt|,
modifier|*
name|r_edge
decl_stmt|;
comment|/* arrays holding x-coords of edge pixels */
name|gint
modifier|*
name|left
decl_stmt|,
modifier|*
name|right
decl_stmt|;
name|gfloat
name|dul
decl_stmt|,
name|dvl
decl_stmt|,
name|dur
decl_stmt|,
name|dvr
decl_stmt|;
comment|/* left and right texture coord deltas */
name|gfloat
name|u_l
decl_stmt|,
name|v_l
decl_stmt|,
name|u_r
decl_stmt|,
name|v_r
decl_stmt|;
comment|/* left and right texture coord pairs */
if|if
condition|(
operator|!
name|GIMP_IS_DRAWABLE
argument_list|(
name|texture
argument_list|)
operator|||
operator|!
name|GDK_IS_DRAWABLE
argument_list|(
name|dest
argument_list|)
condition|)
return|return;
name|g_return_if_fail
argument_list|(
name|x
operator|!=
name|NULL
operator|&&
name|y
operator|!=
name|NULL
operator|&&
name|u
operator|!=
name|NULL
operator|&&
name|v
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|left
operator|=
name|right
operator|=
name|NULL
expr_stmt|;
name|dul
operator|=
name|dvl
operator|=
name|dur
operator|=
name|dvr
operator|=
literal|0
expr_stmt|;
name|u_l
operator|=
name|v_l
operator|=
name|u_r
operator|=
name|v_r
operator|=
literal|0
expr_stmt|;
name|gdk_drawable_get_size
argument_list|(
name|dest
argument_list|,
operator|&
name|dwidth
argument_list|,
operator|&
name|dheight
argument_list|)
expr_stmt|;
name|row
operator|=
name|gdk_pixbuf_new
argument_list|(
name|GDK_COLORSPACE_RGB
argument_list|,
name|mask
condition|?
name|TRUE
else|:
name|gimp_drawable_has_alpha
argument_list|(
name|texture
argument_list|)
argument_list|,
literal|8
argument_list|,
name|dwidth
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|row
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* sort vertices in order of y-coordinate */
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
name|j
operator|++
control|)
for|for
control|(
name|k
operator|=
name|j
operator|+
literal|1
init|;
name|k
operator|<
literal|3
condition|;
name|k
operator|++
control|)
if|if
condition|(
name|y
index|[
name|k
index|]
operator|<
name|y
index|[
name|j
index|]
condition|)
block|{
name|gint
name|tmp
decl_stmt|;
name|gfloat
name|ftmp
decl_stmt|;
name|tmp
operator|=
name|y
index|[
name|k
index|]
expr_stmt|;
name|y
index|[
name|k
index|]
operator|=
name|y
index|[
name|j
index|]
expr_stmt|;
name|y
index|[
name|j
index|]
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|=
name|x
index|[
name|k
index|]
expr_stmt|;
name|x
index|[
name|k
index|]
operator|=
name|x
index|[
name|j
index|]
expr_stmt|;
name|x
index|[
name|j
index|]
operator|=
name|tmp
expr_stmt|;
name|ftmp
operator|=
name|u
index|[
name|k
index|]
expr_stmt|;
name|u
index|[
name|k
index|]
operator|=
name|u
index|[
name|j
index|]
expr_stmt|;
name|u
index|[
name|j
index|]
operator|=
name|ftmp
expr_stmt|;
name|ftmp
operator|=
name|v
index|[
name|k
index|]
expr_stmt|;
name|v
index|[
name|k
index|]
operator|=
name|v
index|[
name|j
index|]
expr_stmt|;
name|v
index|[
name|j
index|]
operator|=
name|ftmp
expr_stmt|;
block|}
if|if
condition|(
name|y
index|[
literal|2
index|]
operator|==
name|y
index|[
literal|0
index|]
condition|)
return|return;
name|l_edge
operator|=
name|g_malloc
argument_list|(
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|0
index|]
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|gint
argument_list|)
argument_list|)
expr_stmt|;
name|r_edge
operator|=
name|g_malloc
argument_list|(
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|0
index|]
operator|)
operator|*
sizeof|sizeof
argument_list|(
name|gint
argument_list|)
argument_list|)
expr_stmt|;
comment|/* draw the triangle */
name|gimp_display_shell_trace_tri_edge
argument_list|(
name|l_edge
argument_list|,
name|x
index|[
literal|0
index|]
argument_list|,
name|y
index|[
literal|0
index|]
argument_list|,
name|x
index|[
literal|2
index|]
argument_list|,
name|y
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|left
operator|=
name|l_edge
expr_stmt|;
name|dul
operator|=
operator|(
name|u
index|[
literal|2
index|]
operator|-
name|u
index|[
literal|0
index|]
operator|)
operator|/
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|0
index|]
operator|)
expr_stmt|;
name|dvl
operator|=
operator|(
name|v
index|[
literal|2
index|]
operator|-
name|v
index|[
literal|0
index|]
operator|)
operator|/
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|0
index|]
operator|)
expr_stmt|;
name|u_l
operator|=
name|u
index|[
literal|0
index|]
expr_stmt|;
name|v_l
operator|=
name|v
index|[
literal|0
index|]
expr_stmt|;
if|if
condition|(
name|y
index|[
literal|0
index|]
operator|!=
name|y
index|[
literal|1
index|]
condition|)
block|{
name|gimp_display_shell_trace_tri_edge
argument_list|(
name|r_edge
argument_list|,
name|x
index|[
literal|0
index|]
argument_list|,
name|y
index|[
literal|0
index|]
argument_list|,
name|x
index|[
literal|1
index|]
argument_list|,
name|y
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|right
operator|=
name|r_edge
expr_stmt|;
name|dur
operator|=
operator|(
name|u
index|[
literal|1
index|]
operator|-
name|u
index|[
literal|0
index|]
operator|)
operator|/
operator|(
name|y
index|[
literal|1
index|]
operator|-
name|y
index|[
literal|0
index|]
operator|)
expr_stmt|;
name|dvr
operator|=
operator|(
name|v
index|[
literal|1
index|]
operator|-
name|v
index|[
literal|0
index|]
operator|)
operator|/
operator|(
name|y
index|[
literal|1
index|]
operator|-
name|y
index|[
literal|0
index|]
operator|)
expr_stmt|;
name|u_r
operator|=
name|u
index|[
literal|0
index|]
expr_stmt|;
name|v_r
operator|=
name|v
index|[
literal|0
index|]
expr_stmt|;
for|for
control|(
name|ry
operator|=
name|y
index|[
literal|0
index|]
init|;
name|ry
operator|<
name|y
index|[
literal|1
index|]
condition|;
name|ry
operator|++
control|)
block|{
if|if
condition|(
name|ry
operator|>=
literal|0
operator|&&
name|ry
operator|<
name|dheight
condition|)
block|{
if|if
condition|(
name|mask
condition|)
name|gimp_display_shell_draw_tri_row_mask
argument_list|(
name|texture
argument_list|,
name|dest
argument_list|,
name|row
argument_list|,
name|mask
argument_list|,
name|mask_offx
argument_list|,
name|mask_offy
argument_list|,
operator|*
name|left
argument_list|,
name|u_l
argument_list|,
name|v_l
argument_list|,
operator|*
name|right
argument_list|,
name|u_r
argument_list|,
name|v_r
argument_list|,
name|ry
argument_list|)
expr_stmt|;
else|else
name|gimp_display_shell_draw_tri_row
argument_list|(
name|texture
argument_list|,
name|dest
argument_list|,
name|row
argument_list|,
operator|*
name|left
argument_list|,
name|u_l
argument_list|,
name|v_l
argument_list|,
operator|*
name|right
argument_list|,
name|u_r
argument_list|,
name|v_r
argument_list|,
name|ry
argument_list|)
expr_stmt|;
block|}
name|left
operator|++
expr_stmt|;
name|right
operator|++
expr_stmt|;
name|u_l
operator|+=
name|dul
expr_stmt|;
name|v_l
operator|+=
name|dvl
expr_stmt|;
name|u_r
operator|+=
name|dur
expr_stmt|;
name|v_r
operator|+=
name|dvr
expr_stmt|;
block|}
block|}
if|if
condition|(
name|y
index|[
literal|1
index|]
operator|!=
name|y
index|[
literal|2
index|]
condition|)
block|{
name|gimp_display_shell_trace_tri_edge
argument_list|(
name|r_edge
argument_list|,
name|x
index|[
literal|1
index|]
argument_list|,
name|y
index|[
literal|1
index|]
argument_list|,
name|x
index|[
literal|2
index|]
argument_list|,
name|y
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|right
operator|=
name|r_edge
expr_stmt|;
name|dur
operator|=
operator|(
name|u
index|[
literal|2
index|]
operator|-
name|u
index|[
literal|1
index|]
operator|)
operator|/
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|1
index|]
operator|)
expr_stmt|;
name|dvr
operator|=
operator|(
name|v
index|[
literal|2
index|]
operator|-
name|v
index|[
literal|1
index|]
operator|)
operator|/
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|1
index|]
operator|)
expr_stmt|;
name|u_r
operator|=
name|u
index|[
literal|1
index|]
expr_stmt|;
name|v_r
operator|=
name|v
index|[
literal|1
index|]
expr_stmt|;
for|for
control|(
name|ry
operator|=
name|y
index|[
literal|1
index|]
init|;
name|ry
operator|<
name|y
index|[
literal|2
index|]
condition|;
name|ry
operator|++
control|)
block|{
if|if
condition|(
name|ry
operator|>=
literal|0
operator|&&
name|ry
operator|<
name|dheight
condition|)
block|{
if|if
condition|(
name|mask
condition|)
name|gimp_display_shell_draw_tri_row_mask
argument_list|(
name|texture
argument_list|,
name|dest
argument_list|,
name|row
argument_list|,
name|mask
argument_list|,
name|mask_offx
argument_list|,
name|mask_offy
argument_list|,
operator|*
name|left
argument_list|,
name|u_l
argument_list|,
name|v_l
argument_list|,
operator|*
name|right
argument_list|,
name|u_r
argument_list|,
name|v_r
argument_list|,
name|ry
argument_list|)
expr_stmt|;
else|else
name|gimp_display_shell_draw_tri_row
argument_list|(
name|texture
argument_list|,
name|dest
argument_list|,
name|row
argument_list|,
operator|*
name|left
argument_list|,
name|u_l
argument_list|,
name|v_l
argument_list|,
operator|*
name|right
argument_list|,
name|u_r
argument_list|,
name|v_r
argument_list|,
name|ry
argument_list|)
expr_stmt|;
block|}
name|left
operator|++
expr_stmt|;
name|right
operator|++
expr_stmt|;
name|u_l
operator|+=
name|dul
expr_stmt|;
name|v_l
operator|+=
name|dvl
expr_stmt|;
name|u_r
operator|+=
name|dur
expr_stmt|;
name|v_r
operator|+=
name|dvr
expr_stmt|;
block|}
block|}
name|g_object_unref
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|l_edge
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|r_edge
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_draw_tri_row (GimpDrawable * texture,GdkDrawable * dest,GdkPixbuf * row,gint x1,gfloat u1,gfloat v1,gint x2,gfloat u2,gfloat v2,gint y)
name|gimp_display_shell_draw_tri_row
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GdkPixbuf
modifier|*
name|row
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gfloat
name|u1
parameter_list|,
name|gfloat
name|v1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gfloat
name|u2
parameter_list|,
name|gfloat
name|v2
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|TileManager
modifier|*
name|tiles
decl_stmt|;
name|guchar
modifier|*
name|pptr
decl_stmt|;
name|guchar
name|bytes
decl_stmt|;
name|gfloat
name|u
decl_stmt|,
name|v
decl_stmt|;
name|gfloat
name|du
decl_stmt|,
name|dv
decl_stmt|;
name|gint
name|dx
decl_stmt|;
name|guchar
name|pixel
index|[
literal|4
index|]
decl_stmt|;
name|guchar
modifier|*
name|cmap
decl_stmt|;
name|gint
name|offset
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|x2
operator|-
name|x1
operator|)
condition|)
return|return;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DRAWABLE
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GDK_IS_DRAWABLE
argument_list|(
name|dest
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GDK_IS_PIXBUF
argument_list|(
name|row
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gdk_pixbuf_get_bits_per_sample
argument_list|(
name|row
argument_list|)
operator|==
literal|8
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gdk_pixbuf_get_colorspace
argument_list|(
name|row
argument_list|)
operator|==
name|GDK_COLORSPACE_RGB
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gdk_pixbuf_get_has_alpha
argument_list|(
name|row
argument_list|)
operator|==
name|gimp_drawable_has_alpha
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|bytes
operator|=
name|gdk_pixbuf_get_n_channels
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|pptr
operator|=
name|gdk_pixbuf_get_pixels
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|tiles
operator|=
name|gimp_drawable_data
argument_list|(
name|texture
argument_list|)
expr_stmt|;
if|if
condition|(
name|x1
operator|>
name|x2
condition|)
block|{
name|gint
name|tmp
decl_stmt|;
name|gfloat
name|ftmp
decl_stmt|;
name|tmp
operator|=
name|x2
expr_stmt|;
name|x2
operator|=
name|x1
expr_stmt|;
name|x1
operator|=
name|tmp
expr_stmt|;
name|ftmp
operator|=
name|u2
expr_stmt|;
name|u2
operator|=
name|u1
expr_stmt|;
name|u1
operator|=
name|ftmp
expr_stmt|;
name|ftmp
operator|=
name|v2
expr_stmt|;
name|v2
operator|=
name|v1
expr_stmt|;
name|v1
operator|=
name|ftmp
expr_stmt|;
block|}
name|u
operator|=
name|u1
expr_stmt|;
name|v
operator|=
name|v1
expr_stmt|;
name|du
operator|=
operator|(
name|u2
operator|-
name|u1
operator|)
operator|/
operator|(
name|x2
operator|-
name|x1
operator|)
expr_stmt|;
name|dv
operator|=
operator|(
name|v2
operator|-
name|v1
operator|)
operator|/
operator|(
name|x2
operator|-
name|x1
operator|)
expr_stmt|;
comment|/* don't calculate unseen pixels */
if|if
condition|(
name|x1
operator|<
literal|0
condition|)
block|{
name|u
operator|+=
name|du
operator|*
operator|(
literal|0
operator|-
name|x1
operator|)
expr_stmt|;
name|v
operator|+=
name|dv
operator|*
operator|(
literal|0
operator|-
name|x1
operator|)
expr_stmt|;
name|x1
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|x1
operator|>
name|gdk_pixbuf_get_width
argument_list|(
name|row
argument_list|)
condition|)
return|return;
if|if
condition|(
name|x2
operator|<
literal|0
condition|)
return|return;
elseif|else
if|if
condition|(
name|x2
operator|>
name|gdk_pixbuf_get_width
argument_list|(
name|row
argument_list|)
condition|)
name|x2
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|dx
operator|=
name|x2
operator|-
name|x1
expr_stmt|;
switch|switch
condition|(
name|gimp_drawable_type
argument_list|(
name|texture
argument_list|)
condition|)
block|{
case|case
name|GIMP_INDEXED_IMAGE
case|:
name|cmap
operator|=
name|gimp_drawable_cmap
argument_list|(
name|texture
argument_list|)
expr_stmt|;
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|offset
operator|=
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|1
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|2
index|]
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_INDEXEDA_IMAGE
case|:
name|cmap
operator|=
name|gimp_drawable_cmap
argument_list|(
name|texture
argument_list|)
expr_stmt|;
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|offset
operator|=
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|1
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|2
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|1
index|]
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_GRAY_IMAGE
case|:
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_GRAYA_IMAGE
case|:
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|1
index|]
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_RGB_IMAGE
case|:
case|case
name|GIMP_RGBA_IMAGE
case|:
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pptr
argument_list|)
expr_stmt|;
name|pptr
operator|+=
name|bytes
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
default|default:
return|return;
block|}
name|gdk_draw_pixbuf
argument_list|(
name|dest
argument_list|,
name|NULL
argument_list|,
name|row
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|x1
argument_list|,
name|y
argument_list|,
name|x2
operator|-
name|x1
argument_list|,
literal|1
argument_list|,
name|GDK_RGB_DITHER_NONE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_draw_tri_row_mask (GimpDrawable * texture,GdkDrawable * dest,GdkPixbuf * row,GimpChannel * mask,gint mask_offx,gint mask_offy,gint x1,gfloat u1,gfloat v1,gint x2,gfloat u2,gfloat v2,gint y)
name|gimp_display_shell_draw_tri_row_mask
parameter_list|(
name|GimpDrawable
modifier|*
name|texture
parameter_list|,
name|GdkDrawable
modifier|*
name|dest
parameter_list|,
name|GdkPixbuf
modifier|*
name|row
parameter_list|,
name|GimpChannel
modifier|*
name|mask
parameter_list|,
name|gint
name|mask_offx
parameter_list|,
name|gint
name|mask_offy
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gfloat
name|u1
parameter_list|,
name|gfloat
name|v1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gfloat
name|u2
parameter_list|,
name|gfloat
name|v2
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|TileManager
modifier|*
name|tiles
decl_stmt|,
modifier|*
name|masktiles
decl_stmt|;
name|guchar
modifier|*
name|pptr
decl_stmt|;
name|guchar
name|bytes
decl_stmt|,
name|alpha
decl_stmt|;
name|gfloat
name|u
decl_stmt|,
name|v
decl_stmt|;
name|gfloat
name|mu
decl_stmt|,
name|mv
decl_stmt|;
name|gfloat
name|du
decl_stmt|,
name|dv
decl_stmt|;
name|gint
name|dx
decl_stmt|;
name|guchar
name|pixel
index|[
literal|4
index|]
decl_stmt|,
name|maskval
decl_stmt|;
name|guchar
modifier|*
name|cmap
decl_stmt|;
name|gint
name|offset
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|x2
operator|-
name|x1
operator|)
condition|)
return|return;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DRAWABLE
argument_list|(
name|texture
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_CHANNEL
argument_list|(
name|mask
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GDK_IS_DRAWABLE
argument_list|(
name|dest
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GDK_IS_PIXBUF
argument_list|(
name|row
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gdk_pixbuf_get_bits_per_sample
argument_list|(
name|row
argument_list|)
operator|==
literal|8
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gdk_pixbuf_get_colorspace
argument_list|(
name|row
argument_list|)
operator|==
name|GDK_COLORSPACE_RGB
argument_list|)
expr_stmt|;
name|bytes
operator|=
name|gdk_pixbuf_get_n_channels
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|alpha
operator|=
name|bytes
operator|-
literal|1
expr_stmt|;
name|pptr
operator|=
name|gdk_pixbuf_get_pixels
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|tiles
operator|=
name|gimp_drawable_data
argument_list|(
name|texture
argument_list|)
expr_stmt|;
name|masktiles
operator|=
name|gimp_drawable_data
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|mask
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|x1
operator|>
name|x2
condition|)
block|{
name|gint
name|tmp
decl_stmt|;
name|gfloat
name|ftmp
decl_stmt|;
name|tmp
operator|=
name|x2
expr_stmt|;
name|x2
operator|=
name|x1
expr_stmt|;
name|x1
operator|=
name|tmp
expr_stmt|;
name|ftmp
operator|=
name|u2
expr_stmt|;
name|u2
operator|=
name|u1
expr_stmt|;
name|u1
operator|=
name|ftmp
expr_stmt|;
name|ftmp
operator|=
name|v2
expr_stmt|;
name|v2
operator|=
name|v1
expr_stmt|;
name|v1
operator|=
name|ftmp
expr_stmt|;
block|}
name|u
operator|=
name|u1
expr_stmt|;
name|v
operator|=
name|v1
expr_stmt|;
name|du
operator|=
operator|(
name|u2
operator|-
name|u1
operator|)
operator|/
operator|(
name|x2
operator|-
name|x1
operator|)
expr_stmt|;
name|dv
operator|=
operator|(
name|v2
operator|-
name|v1
operator|)
operator|/
operator|(
name|x2
operator|-
name|x1
operator|)
expr_stmt|;
comment|/* don't calculate unseen pixels */
if|if
condition|(
name|x1
operator|<
literal|0
condition|)
block|{
name|u
operator|+=
name|du
operator|*
operator|(
literal|0
operator|-
name|x1
operator|)
expr_stmt|;
name|v
operator|+=
name|dv
operator|*
operator|(
literal|0
operator|-
name|x1
operator|)
expr_stmt|;
name|x1
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|x1
operator|>
name|gdk_pixbuf_get_width
argument_list|(
name|row
argument_list|)
condition|)
return|return;
if|if
condition|(
name|x2
operator|<
literal|0
condition|)
return|return;
elseif|else
if|if
condition|(
name|x2
operator|>
name|gdk_pixbuf_get_width
argument_list|(
name|row
argument_list|)
condition|)
name|x2
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|row
argument_list|)
expr_stmt|;
name|mu
operator|=
name|u
operator|+
name|mask_offx
expr_stmt|;
name|mv
operator|=
name|v
operator|+
name|mask_offy
expr_stmt|;
name|dx
operator|=
name|x2
operator|-
name|x1
expr_stmt|;
switch|switch
condition|(
name|gimp_drawable_type
argument_list|(
name|texture
argument_list|)
condition|)
block|{
case|case
name|GIMP_INDEXED_IMAGE
case|:
name|cmap
operator|=
name|gimp_drawable_cmap
argument_list|(
name|texture
argument_list|)
expr_stmt|;
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|masktiles
argument_list|,
operator|(
name|gint
operator|)
name|mu
argument_list|,
operator|(
name|gint
operator|)
name|mv
argument_list|,
name|pptr
operator|+
name|alpha
argument_list|)
expr_stmt|;
name|offset
operator|=
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|1
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|2
index|]
expr_stmt|;
name|pptr
operator|++
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
name|mu
operator|+=
name|du
expr_stmt|;
name|mv
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_INDEXEDA_IMAGE
case|:
name|cmap
operator|=
name|gimp_drawable_cmap
argument_list|(
name|texture
argument_list|)
expr_stmt|;
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|masktiles
argument_list|,
operator|(
name|gint
operator|)
name|mu
argument_list|,
operator|(
name|gint
operator|)
name|mv
argument_list|,
operator|&
name|maskval
argument_list|)
expr_stmt|;
name|offset
operator|=
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
operator|+
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|1
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|cmap
index|[
name|offset
operator|+
literal|2
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
operator|(
operator|(
name|gint
operator|)
name|maskval
operator|*
name|pixel
index|[
literal|1
index|]
operator|)
operator|>>
literal|8
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
name|mu
operator|+=
name|du
expr_stmt|;
name|mv
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_GRAY_IMAGE
case|:
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|masktiles
argument_list|,
operator|(
name|gint
operator|)
name|mu
argument_list|,
operator|(
name|gint
operator|)
name|mv
argument_list|,
name|pptr
operator|+
name|alpha
argument_list|)
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
name|pptr
operator|++
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
name|mu
operator|+=
name|du
expr_stmt|;
name|mv
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_GRAYA_IMAGE
case|:
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|masktiles
argument_list|,
operator|(
name|gint
operator|)
name|mu
argument_list|,
operator|(
name|gint
operator|)
name|mv
argument_list|,
operator|&
name|maskval
argument_list|)
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
name|pixel
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|pptr
operator|++
operator|=
operator|(
operator|(
name|gint
operator|)
name|maskval
operator|*
name|pixel
index|[
literal|1
index|]
operator|)
operator|>>
literal|8
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
name|mu
operator|+=
name|du
expr_stmt|;
name|mv
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_RGB_IMAGE
case|:
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pptr
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|masktiles
argument_list|,
operator|(
name|gint
operator|)
name|mu
argument_list|,
operator|(
name|gint
operator|)
name|mv
argument_list|,
name|pptr
operator|+
name|alpha
argument_list|)
expr_stmt|;
name|pptr
operator|+=
name|bytes
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
name|mu
operator|+=
name|du
expr_stmt|;
name|mv
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
case|case
name|GIMP_RGBA_IMAGE
case|:
while|while
condition|(
name|dx
operator|--
condition|)
block|{
name|read_pixel_data_1
argument_list|(
name|tiles
argument_list|,
operator|(
name|gint
operator|)
name|u
argument_list|,
operator|(
name|gint
operator|)
name|v
argument_list|,
name|pptr
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|masktiles
argument_list|,
operator|(
name|gint
operator|)
name|mu
argument_list|,
operator|(
name|gint
operator|)
name|mv
argument_list|,
operator|&
name|maskval
argument_list|)
expr_stmt|;
name|pptr
index|[
name|alpha
index|]
operator|=
operator|(
operator|(
name|gint
operator|)
name|maskval
operator|*
name|pptr
index|[
name|alpha
index|]
operator|)
operator|>>
literal|8
expr_stmt|;
name|pptr
operator|+=
name|bytes
expr_stmt|;
name|u
operator|+=
name|du
expr_stmt|;
name|v
operator|+=
name|dv
expr_stmt|;
name|mu
operator|+=
name|du
expr_stmt|;
name|mv
operator|+=
name|dv
expr_stmt|;
block|}
break|break;
default|default:
return|return;
block|}
name|gdk_draw_pixbuf
argument_list|(
name|dest
argument_list|,
name|NULL
argument_list|,
name|row
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|x1
argument_list|,
name|y
argument_list|,
name|x2
operator|-
name|x1
argument_list|,
literal|1
argument_list|,
name|GDK_RGB_DITHER_NONE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_display_shell_trace_tri_edge (gint * dest,gint x1,gint y1,gint x2,gint y2)
name|gimp_display_shell_trace_tri_edge
parameter_list|(
name|gint
modifier|*
name|dest
parameter_list|,
name|gint
name|x1
parameter_list|,
name|gint
name|y1
parameter_list|,
name|gint
name|x2
parameter_list|,
name|gint
name|y2
parameter_list|)
block|{
specifier|const
name|gint
name|dy
init|=
name|y2
operator|-
name|y1
decl_stmt|;
name|gint
name|dx
decl_stmt|;
name|gchar
name|xdir
decl_stmt|;
name|gint
name|errorterm
decl_stmt|;
name|gint
name|b
decl_stmt|;
name|gint
modifier|*
name|dptr
decl_stmt|;
if|if
condition|(
name|dy
operator|==
literal|0
condition|)
return|return;
name|g_return_if_fail
argument_list|(
name|dest
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|b
operator|=
literal|0
expr_stmt|;
name|errorterm
operator|=
literal|0
expr_stmt|;
name|dptr
operator|=
name|dest
expr_stmt|;
if|if
condition|(
name|x2
operator|<
name|x1
condition|)
block|{
name|dx
operator|=
name|x1
operator|-
name|x2
expr_stmt|;
name|xdir
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|dx
operator|=
name|x2
operator|-
name|x1
expr_stmt|;
name|xdir
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|dx
operator|>=
name|dy
condition|)
block|{
name|b
operator|=
name|dy
expr_stmt|;
while|while
condition|(
name|b
operator|--
condition|)
block|{
operator|*
name|dptr
operator|=
name|x1
expr_stmt|;
name|errorterm
operator|+=
name|dx
expr_stmt|;
while|while
condition|(
name|errorterm
operator|>
name|dy
condition|)
block|{
name|x1
operator|+=
name|xdir
expr_stmt|;
name|errorterm
operator|-=
name|dy
expr_stmt|;
block|}
name|dptr
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|dy
operator|>=
name|dx
condition|)
block|{
name|b
operator|=
name|dy
expr_stmt|;
while|while
condition|(
name|b
operator|--
condition|)
block|{
operator|*
name|dptr
operator|=
name|x1
expr_stmt|;
name|errorterm
operator|+=
name|dx
expr_stmt|;
if|if
condition|(
name|errorterm
operator|>
name|dy
condition|)
block|{
name|x1
operator|+=
name|xdir
expr_stmt|;
name|errorterm
operator|-=
name|dy
expr_stmt|;
block|}
name|dptr
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|dx
operator|==
literal|0
condition|)
block|{
name|b
operator|=
name|dy
expr_stmt|;
while|while
condition|(
name|b
operator|--
condition|)
block|{
operator|*
name|dptr
operator|=
name|x1
expr_stmt|;
name|dptr
operator|++
expr_stmt|;
block|}
block|}
else|else
comment|/* dy == dx */
block|{
name|b
operator|=
name|dy
expr_stmt|;
while|while
condition|(
name|b
operator|--
condition|)
block|{
operator|*
name|dptr
operator|=
name|x1
expr_stmt|;
name|x1
operator|+=
name|xdir
expr_stmt|;
name|dptr
operator|++
expr_stmt|;
block|}
block|}
block|}
end_function

end_unit

