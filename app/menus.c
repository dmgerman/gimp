begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"colormaps.h"
end_include

begin_include
include|#
directive|include
file|"commands.h"
end_include

begin_include
include|#
directive|include
file|"fileops.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"menus.h"
end_include

begin_include
include|#
directive|include
file|"paint_funcs.h"
end_include

begin_include
include|#
directive|include
file|"procedural_db.h"
end_include

begin_include
include|#
directive|include
file|"scale.h"
end_include

begin_include
include|#
directive|include
file|"tools.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"docindex.h"
end_include

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_define
DECL|macro|MRU_MENU_ENTRY_SIZE
define|#
directive|define
name|MRU_MENU_ENTRY_SIZE
value|(strlen (_("/File/MRU00 ")) + 1)
end_define

begin_define
DECL|macro|MRU_MENU_ACCEL_SIZE
define|#
directive|define
name|MRU_MENU_ACCEL_SIZE
value|sizeof ("<control>0")
end_define

begin_decl_stmt
DECL|variable|dummyMRU
specifier|static
name|char
modifier|*
name|dummyMRU
init|=
name|N_
argument_list|(
literal|"/File/MRU00 "
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|void
name|menus_init
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkItemFactoryEntry
modifier|*
name|translate_entries
parameter_list|(
specifier|const
name|GtkItemFactoryEntry
modifier|*
parameter_list|,
name|gint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|free_translated_entries
parameter_list|(
name|GtkItemFactoryEntry
modifier|*
parameter_list|,
name|gint
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|last_opened_raw_filenames
specifier|static
name|GSList
modifier|*
name|last_opened_raw_filenames
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|toolbox_entries
specifier|static
specifier|const
name|GtkItemFactoryEntry
name|toolbox_entries
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"/File/New"
argument_list|)
block|,
literal|"<control>N"
block|,
name|file_new_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Open"
argument_list|)
block|,
literal|"<control>O"
block|,
name|file_open_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/About..."
argument_list|)
block|,
name|NULL
block|,
name|about_dialog_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Preferences..."
argument_list|)
block|,
name|NULL
block|,
name|file_pref_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Tip of the day"
argument_list|)
block|,
name|NULL
block|,
name|tips_dialog_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Brushes..."
argument_list|)
block|,
literal|"<control><shift>B"
block|,
name|dialogs_brushes_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Patterns..."
argument_list|)
block|,
literal|"<control><shift>P"
block|,
name|dialogs_patterns_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Palette..."
argument_list|)
block|,
literal|"<control>P"
block|,
name|dialogs_palette_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Gradient..."
argument_list|)
block|,
literal|"<control>G"
block|,
name|dialogs_gradient_editor_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Layers& Channels..."
argument_list|)
block|,
literal|"<control>L"
block|,
name|dialogs_lc_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Tool Options..."
argument_list|)
block|,
literal|"<control><shift>T"
block|,
name|dialogs_tools_options_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Input Devices..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_input_devices_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Device Status..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_device_status_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Document Index..."
argument_list|)
block|,
name|NULL
block|,
name|raise_idea_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Error Console..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_error_console_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Dialogs/Module Browser..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_module_browser_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|n_toolbox_entries
specifier|static
name|guint
name|n_toolbox_entries
init|=
sizeof|sizeof
argument_list|(
name|toolbox_entries
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|toolbox_entries
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|toolbox_factory
specifier|static
name|GtkItemFactory
modifier|*
name|toolbox_factory
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_menu_separator
specifier|static
specifier|const
name|GtkItemFactoryEntry
name|file_menu_separator
init|=
block|{
name|N_
argument_list|(
literal|"/File/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|toolbox_end
specifier|static
specifier|const
name|GtkItemFactoryEntry
name|toolbox_end
init|=
block|{
name|N_
argument_list|(
literal|"/File/Quit"
argument_list|)
block|,
literal|"<control>Q"
block|,
name|file_quit_cmd_callback
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|image_entries
specifier|static
specifier|const
name|GtkItemFactoryEntry
name|image_entries
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"/File/New"
argument_list|)
block|,
literal|"<control>N"
block|,
name|file_new_cmd_callback
block|,
literal|1
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Open"
argument_list|)
block|,
literal|"<control>O"
block|,
name|file_open_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Save"
argument_list|)
block|,
literal|"<control>S"
block|,
name|file_save_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Save as"
argument_list|)
block|,
name|NULL
block|,
name|file_save_as_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Revert"
argument_list|)
block|,
name|NULL
block|,
name|file_revert_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Preferences..."
argument_list|)
block|,
name|NULL
block|,
name|file_pref_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Close"
argument_list|)
block|,
literal|"<control>W"
block|,
name|file_close_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/Quit"
argument_list|)
block|,
literal|"<control>Q"
block|,
name|file_quit_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/File/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Cut"
argument_list|)
block|,
literal|"<control>X"
block|,
name|edit_cut_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Copy"
argument_list|)
block|,
literal|"<control>C"
block|,
name|edit_copy_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Paste"
argument_list|)
block|,
literal|"<control>V"
block|,
name|edit_paste_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Paste Into"
argument_list|)
block|,
name|NULL
block|,
name|edit_paste_into_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Clear"
argument_list|)
block|,
literal|"<control>K"
block|,
name|edit_clear_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Fill"
argument_list|)
block|,
literal|"<control>period"
block|,
name|edit_fill_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Stroke"
argument_list|)
block|,
name|NULL
block|,
name|edit_stroke_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Undo"
argument_list|)
block|,
literal|"<control>Z"
block|,
name|edit_undo_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Redo"
argument_list|)
block|,
literal|"<control>R"
block|,
name|edit_redo_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Cut Named"
argument_list|)
block|,
literal|"<control><shift>X"
block|,
name|edit_named_cut_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Copy Named"
argument_list|)
block|,
literal|"<control><shift>C"
block|,
name|edit_named_copy_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/Paste Named"
argument_list|)
block|,
literal|"<control><shift>V"
block|,
name|edit_named_paste_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Edit/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Toggle"
argument_list|)
block|,
literal|"<control>T"
block|,
name|select_toggle_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Invert"
argument_list|)
block|,
literal|"<control>I"
block|,
name|select_invert_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/All"
argument_list|)
block|,
literal|"<control>A"
block|,
name|select_all_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/None"
argument_list|)
block|,
literal|"<control><shift>A"
block|,
name|select_none_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Float"
argument_list|)
block|,
literal|"<control><shift>L"
block|,
name|select_float_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Sharpen"
argument_list|)
block|,
literal|"<control><shift>H"
block|,
name|select_sharpen_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Border"
argument_list|)
block|,
literal|"<control><shift>B"
block|,
name|select_border_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Feather"
argument_list|)
block|,
literal|"<control><shift>F"
block|,
name|select_feather_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Grow"
argument_list|)
block|,
name|NULL
block|,
name|select_grow_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Shrink"
argument_list|)
block|,
name|NULL
block|,
name|select_shrink_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Select/Save To Channel"
argument_list|)
block|,
name|NULL
block|,
name|select_save_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom In"
argument_list|)
block|,
literal|"equal"
block|,
name|view_zoomin_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom Out"
argument_list|)
block|,
literal|"minus"
block|,
name|view_zoomout_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/16:1"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_16_1_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/8:1"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_8_1_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/4:1"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_4_1_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/2:1"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_2_1_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/1:1"
argument_list|)
block|,
literal|"1"
block|,
name|view_zoom_1_1_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/1:2"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_1_2_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/1:4"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_1_4_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/1:8"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_1_8_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Zoom/1:16"
argument_list|)
block|,
name|NULL
block|,
name|view_zoom_1_16_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Dot for dot"
argument_list|)
block|,
name|NULL
block|,
name|view_dot_for_dot_callback
block|,
literal|0
block|,
literal|"<ToggleItem>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Window Info..."
argument_list|)
block|,
literal|"<control><shift>I"
block|,
name|view_window_info_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Toggle Rulers"
argument_list|)
block|,
literal|"<control><shift>R"
block|,
name|view_toggle_rulers_cmd_callback
block|,
literal|0
block|,
literal|"<ToggleItem>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Toggle Statusbar"
argument_list|)
block|,
literal|"<control><shift>S"
block|,
name|view_toggle_statusbar_cmd_callback
block|,
literal|0
block|,
literal|"<ToggleItem>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Toggle Guides"
argument_list|)
block|,
literal|"<control><shift>T"
block|,
name|view_toggle_guides_cmd_callback
block|,
literal|0
block|,
literal|"<ToggleItem>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Snap To Guides"
argument_list|)
block|,
name|NULL
block|,
name|view_snap_to_guides_cmd_callback
block|,
literal|0
block|,
literal|"<ToggleItem>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/New View"
argument_list|)
block|,
name|NULL
block|,
name|view_new_view_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/View/Shrink Wrap"
argument_list|)
block|,
literal|"<control>E"
block|,
name|view_shrink_wrap_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Colors/Equalize"
argument_list|)
block|,
name|NULL
block|,
name|image_equalize_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Colors/Invert"
argument_list|)
block|,
name|NULL
block|,
name|image_invert_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Colors/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Colors/Desaturate"
argument_list|)
block|,
name|NULL
block|,
name|image_desaturate_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Channel Ops/Duplicate"
argument_list|)
block|,
literal|"<control>D"
block|,
name|channel_ops_duplicate_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Channel Ops/Offset"
argument_list|)
block|,
literal|"<control><shift>O"
block|,
name|channel_ops_offset_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Alpha/Add Alpha Channel"
argument_list|)
block|,
name|NULL
block|,
name|layers_add_alpha_channel_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/RGB"
argument_list|)
block|,
name|NULL
block|,
name|image_convert_rgb_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Grayscale"
argument_list|)
block|,
name|NULL
block|,
name|image_convert_grayscale_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Indexed"
argument_list|)
block|,
name|NULL
block|,
name|image_convert_indexed_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Resize"
argument_list|)
block|,
name|NULL
block|,
name|image_resize_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/Scale"
argument_list|)
block|,
name|NULL
block|,
name|image_scale_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Image/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Layers& Channels..."
argument_list|)
block|,
literal|"<control>L"
block|,
name|dialogs_lc_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Raise Layer"
argument_list|)
block|,
literal|"<control>F"
block|,
name|layers_raise_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Lower Layer"
argument_list|)
block|,
literal|"<control>B"
block|,
name|layers_lower_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Anchor Layer"
argument_list|)
block|,
literal|"<control>H"
block|,
name|layers_anchor_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Merge Visible Layers"
argument_list|)
block|,
literal|"<control>M"
block|,
name|layers_merge_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Flatten Image"
argument_list|)
block|,
name|NULL
block|,
name|layers_flatten_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Alpha To Selection"
argument_list|)
block|,
name|NULL
block|,
name|layers_alpha_select_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Mask To Selection"
argument_list|)
block|,
name|NULL
block|,
name|layers_mask_select_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Layers/Add Alpha Channel"
argument_list|)
block|,
name|NULL
block|,
name|layers_add_alpha_channel_cmd_callback
block|,
literal|0
block|}
block|,
comment|/* these are built on the fly */
comment|/*   { N_("/Tools/Ellipse Select"), "E", tools_select_cmd_callback, ELLIPSE_SELECT },   { N_("/Tools/Free Select"), "F", tools_select_cmd_callback, FREE_SELECT },   { N_("/Tools/Fuzzy Select"), "Z", tools_select_cmd_callback, FUZZY_SELECT },   { N_("/Tools/Bezier Select"), "B", tools_select_cmd_callback, BEZIER_SELECT },   { N_("/Tools/Intelligent Scissors"), "I", tools_select_cmd_callback, ISCISSORS },   { N_("/Tools/Move"), "M", tools_select_cmd_callback, MOVE },   { N_("/Tools/Magnify"), "<shift>M", tools_select_cmd_callback, MAGNIFY },   { N_("/Tools/Crop"), "<shift>C", tools_select_cmd_callback, CROP },   { N_("/Tools/Transform"), "<shift>T", tools_select_cmd_callback, ROTATE },   { N_("/Tools/Flip"), "<shift>F", tools_select_cmd_callback, FLIP_HORZ },   { N_("/Tools/Text"), "T", tools_select_cmd_callback, TEXT },   { N_("/Tools/Color Picker"), "O", tools_select_cmd_callback, COLOR_PICKER },   { N_("/Tools/Bucket Fill"), "<shift>B", tools_select_cmd_callback, BUCKET_FILL },   { N_("/Tools/Blend"), "L", tools_select_cmd_callback, BLEND },   { N_("/Tools/Paintbrush"), "P", tools_select_cmd_callback, PAINTBRUSH },   { N_("/Tools/Pencil"), "<shift>P", tools_select_cmd_callback, PENCIL },   { N_("/Tools/Eraser"), "<shift>E", tools_select_cmd_callback, ERASER },   { N_("/Tools/Airbrush"), "A", tools_select_cmd_callback, AIRBRUSH },   { N_("/Tools/Clone"), "C", tools_select_cmd_callback, CLONE },   { N_("/Tools/Convolve"), "V", tools_select_cmd_callback, CONVOLVE },   { N_("/Tools/Ink"), "K", tools_select_cmd_callback, INK },   { N_("/Tools/Default Colors"), "D", tools_default_colors_cmd_callback, 0 },   { N_("/Tools/Toolbox"), NULL, toolbox_raise_callback, 0 },   { N_("/Tools/---"), NULL, NULL, 0, "<Separator>" },     { N_("/Tools/Default Colors"), "D", tools_default_colors_cmd_callback, 0 },   { N_("/Tools/Swap Colors"), "X", tools_swap_colors_cmd_callback, 0 }, */
block|{
name|N_
argument_list|(
literal|"/Tools/Toolbox"
argument_list|)
block|,
name|NULL
block|,
name|toolbox_raise_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Tools/Default Colors"
argument_list|)
block|,
literal|"D"
block|,
name|tools_default_colors_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Tools/Swap Colors"
argument_list|)
block|,
literal|"X"
block|,
name|tools_swap_colors_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Tools/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Filters/Repeat last"
argument_list|)
block|,
literal|"<alt>F"
block|,
name|filters_repeat_cmd_callback
block|,
literal|0x0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Filters/Re-show last"
argument_list|)
block|,
literal|"<alt><shift>F"
block|,
name|filters_repeat_cmd_callback
block|,
literal|0x1
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Filters/---"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Script-Fu/"
argument_list|)
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Brushes..."
argument_list|)
block|,
literal|"<control><shift>B"
block|,
name|dialogs_brushes_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Patterns..."
argument_list|)
block|,
literal|"<control><shift>P"
block|,
name|dialogs_patterns_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Palette..."
argument_list|)
block|,
literal|"<control>P"
block|,
name|dialogs_palette_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Gradient..."
argument_list|)
block|,
literal|"<control>G"
block|,
name|dialogs_gradient_editor_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Layers& Channels..."
argument_list|)
block|,
literal|"<control>L"
block|,
name|dialogs_lc_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Indexed Palette..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_indexed_palette_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Tool Options..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_tools_options_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Input Devices..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_input_devices_cmd_callback
block|,
literal|0
block|}
block|,
block|{
name|N_
argument_list|(
literal|"/Dialogs/Device Status..."
argument_list|)
block|,
name|NULL
block|,
name|dialogs_device_status_cmd_callback
block|,
literal|0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|n_image_entries
specifier|static
name|guint
name|n_image_entries
init|=
sizeof|sizeof
argument_list|(
name|image_entries
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|image_entries
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|image_factory
specifier|static
name|GtkItemFactory
modifier|*
name|image_factory
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|load_entries
specifier|static
specifier|const
name|GtkItemFactoryEntry
name|load_entries
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"/Automatic"
argument_list|)
block|,
name|NULL
block|,
name|file_load_by_extension_callback
block|,
literal|0
block|}
block|,
block|{
literal|"/---"
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|n_load_entries
specifier|static
name|guint
name|n_load_entries
init|=
sizeof|sizeof
argument_list|(
name|load_entries
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|load_entries
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|load_factory
specifier|static
name|GtkItemFactory
modifier|*
name|load_factory
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|save_entries
specifier|static
specifier|const
name|GtkItemFactoryEntry
name|save_entries
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"/By extension"
argument_list|)
block|,
name|NULL
block|,
name|file_save_by_extension_callback
block|,
literal|0
block|}
block|,
block|{
literal|"/---"
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|,
literal|"<Separator>"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|n_save_entries
specifier|static
name|guint
name|n_save_entries
init|=
sizeof|sizeof
argument_list|(
name|save_entries
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|save_entries
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|save_factory
specifier|static
name|GtkItemFactory
modifier|*
name|save_factory
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|initialize
specifier|static
name|int
name|initialize
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|extern
name|int
name|num_tools
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|menus_get_toolbox_menubar (GtkWidget ** menubar,GtkAccelGroup ** accel_group)
name|menus_get_toolbox_menubar
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|menubar
parameter_list|,
name|GtkAccelGroup
modifier|*
modifier|*
name|accel_group
parameter_list|)
block|{
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
if|if
condition|(
name|menubar
condition|)
operator|*
name|menubar
operator|=
name|toolbox_factory
operator|->
name|widget
expr_stmt|;
if|if
condition|(
name|accel_group
condition|)
operator|*
name|accel_group
operator|=
name|toolbox_factory
operator|->
name|accel_group
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_get_image_menu (GtkWidget ** menu,GtkAccelGroup ** accel_group)
name|menus_get_image_menu
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|menu
parameter_list|,
name|GtkAccelGroup
modifier|*
modifier|*
name|accel_group
parameter_list|)
block|{
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
if|if
condition|(
name|menu
condition|)
operator|*
name|menu
operator|=
name|image_factory
operator|->
name|widget
expr_stmt|;
if|if
condition|(
name|accel_group
condition|)
operator|*
name|accel_group
operator|=
name|image_factory
operator|->
name|accel_group
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_get_load_menu (GtkWidget ** menu,GtkAccelGroup ** accel_group)
name|menus_get_load_menu
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|menu
parameter_list|,
name|GtkAccelGroup
modifier|*
modifier|*
name|accel_group
parameter_list|)
block|{
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
if|if
condition|(
name|menu
condition|)
operator|*
name|menu
operator|=
name|load_factory
operator|->
name|widget
expr_stmt|;
if|if
condition|(
name|accel_group
condition|)
operator|*
name|accel_group
operator|=
name|load_factory
operator|->
name|accel_group
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_get_save_menu (GtkWidget ** menu,GtkAccelGroup ** accel_group)
name|menus_get_save_menu
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|menu
parameter_list|,
name|GtkAccelGroup
modifier|*
modifier|*
name|accel_group
parameter_list|)
block|{
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
if|if
condition|(
name|menu
condition|)
operator|*
name|menu
operator|=
name|save_factory
operator|->
name|widget
expr_stmt|;
if|if
condition|(
name|accel_group
condition|)
operator|*
name|accel_group
operator|=
name|save_factory
operator|->
name|accel_group
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_create (GtkMenuEntry * entries,int nmenu_entries)
name|menus_create
parameter_list|(
name|GtkMenuEntry
modifier|*
name|entries
parameter_list|,
name|int
name|nmenu_entries
parameter_list|)
block|{
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
name|gtk_item_factory_create_menu_entries
argument_list|(
name|nmenu_entries
argument_list|,
name|entries
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_tools_create (ToolInfo * tool_info)
name|menus_tools_create
parameter_list|(
name|ToolInfo
modifier|*
name|tool_info
parameter_list|)
block|{
name|GtkItemFactoryEntry
name|entry
decl_stmt|;
name|entry
operator|.
name|path
operator|=
name|gettext
argument_list|(
name|tool_info
operator|->
name|menu_path
argument_list|)
expr_stmt|;
name|entry
operator|.
name|accelerator
operator|=
name|tool_info
operator|->
name|menu_accel
expr_stmt|;
name|entry
operator|.
name|callback
operator|=
name|tools_select_cmd_callback
expr_stmt|;
name|entry
operator|.
name|callback_action
operator|=
name|tool_info
operator|->
name|tool_id
expr_stmt|;
name|entry
operator|.
name|item_type
operator|=
name|NULL
expr_stmt|;
name|gtk_item_factory_create_item
argument_list|(
name|image_factory
argument_list|,
operator|&
name|entry
argument_list|,
operator|(
name|gpointer
operator|)
name|tool_info
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_set_sensitive (char * path,int sensitive)
name|menus_set_sensitive
parameter_list|(
name|char
modifier|*
name|path
parameter_list|,
name|int
name|sensitive
parameter_list|)
block|{
name|GtkItemFactory
modifier|*
name|ifactory
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
name|ifactory
operator|=
name|gtk_item_factory_from_path
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
name|ifactory
condition|)
block|{
name|widget
operator|=
name|gtk_item_factory_get_widget
argument_list|(
name|ifactory
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|ifactory
operator|||
operator|!
name|widget
condition|)
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Unable to set sensitivity for menu which doesn't exist:\n%s"
argument_list|)
argument_list|,
name|path
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_set_state (char * path,int state)
name|menus_set_state
parameter_list|(
name|char
modifier|*
name|path
parameter_list|,
name|int
name|state
parameter_list|)
block|{
name|GtkItemFactory
modifier|*
name|ifactory
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
name|ifactory
operator|=
name|gtk_item_factory_from_path
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
name|ifactory
condition|)
block|{
name|widget
operator|=
name|gtk_item_factory_get_widget
argument_list|(
name|ifactory
argument_list|,
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
operator|&&
name|GTK_IS_CHECK_MENU_ITEM
argument_list|(
name|widget
argument_list|)
condition|)
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|widget
argument_list|)
argument_list|,
name|state
argument_list|)
expr_stmt|;
else|else
name|widget
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|ifactory
operator|||
operator|!
name|widget
condition|)
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Unable to set state for menu which doesn't exist:\n%s\n"
argument_list|)
argument_list|,
name|path
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_destroy (char * path)
name|menus_destroy
parameter_list|(
name|char
modifier|*
name|path
parameter_list|)
block|{
if|if
condition|(
name|initialize
condition|)
name|menus_init
argument_list|()
expr_stmt|;
name|gtk_item_factories_path_delete
argument_list|(
name|NULL
argument_list|,
name|path
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_quit ()
name|menus_quit
parameter_list|()
block|{
name|gchar
modifier|*
name|filename
decl_stmt|;
name|filename
operator|=
name|g_strconcat
argument_list|(
name|gimp_directory
argument_list|()
argument_list|,
literal|"/menurc"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_item_factory_dump_rc
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|initialize
condition|)
block|{
name|gtk_object_unref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toolbox_factory
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_unref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|image_factory
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_unref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|load_factory
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_unref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|save_factory
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|menus_last_opened_cmd_callback (GtkWidget * widget,gpointer callback_data,guint num)
name|menus_last_opened_cmd_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|callback_data
parameter_list|,
name|guint
name|num
parameter_list|)
block|{
name|gchar
modifier|*
name|filename
decl_stmt|,
modifier|*
name|raw_filename
decl_stmt|;
name|raw_filename
operator|=
operator|(
operator|(
name|GString
operator|*
operator|)
name|g_slist_nth_data
argument_list|(
name|last_opened_raw_filenames
argument_list|,
name|num
argument_list|)
operator|)
operator|->
name|str
expr_stmt|;
name|filename
operator|=
name|prune_filename
argument_list|(
name|raw_filename
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file_open
argument_list|(
name|raw_filename
argument_list|,
name|filename
argument_list|)
condition|)
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Error opening file: %s\n"
argument_list|)
argument_list|,
name|raw_filename
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_last_opened_update_labels ()
name|menus_last_opened_update_labels
parameter_list|()
block|{
name|GSList
modifier|*
name|filename_slist
decl_stmt|;
name|GString
modifier|*
name|entry_filename
decl_stmt|,
modifier|*
name|path
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|guint
name|num_entries
decl_stmt|;
name|entry_filename
operator|=
name|g_string_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|path
operator|=
name|g_string_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|filename_slist
operator|=
name|last_opened_raw_filenames
expr_stmt|;
name|num_entries
operator|=
name|g_slist_length
argument_list|(
name|last_opened_raw_filenames
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<=
name|num_entries
condition|;
name|i
operator|++
control|)
block|{
name|g_string_sprintf
argument_list|(
name|entry_filename
argument_list|,
literal|"%d. %s"
argument_list|,
name|i
argument_list|,
name|prune_filename
argument_list|(
operator|(
operator|(
name|GString
operator|*
operator|)
name|filename_slist
operator|->
name|data
operator|)
operator|->
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|g_string_sprintf
argument_list|(
name|path
argument_list|,
name|_
argument_list|(
literal|"/File/MRU%02d"
argument_list|)
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|widget
operator|=
name|gtk_item_factory_get_widget
argument_list|(
name|toolbox_factory
argument_list|,
name|path
operator|->
name|str
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|GTK_BIN
argument_list|(
name|widget
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
name|entry_filename
operator|->
name|str
argument_list|)
expr_stmt|;
name|filename_slist
operator|=
name|filename_slist
operator|->
name|next
expr_stmt|;
block|}
name|g_string_free
argument_list|(
name|entry_filename
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_string_free
argument_list|(
name|path
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_last_opened_add (gchar * filename)
name|menus_last_opened_add
parameter_list|(
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
name|GString
modifier|*
name|raw_filename
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
name|guint
name|num_entries
decl_stmt|;
name|num_entries
operator|=
name|g_slist_length
argument_list|(
name|last_opened_raw_filenames
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_entries
operator|==
name|last_opened_size
condition|)
block|{
name|g_slist_remove_link
argument_list|(
name|last_opened_raw_filenames
argument_list|,
name|g_slist_last
argument_list|(
name|last_opened_raw_filenames
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|raw_filename
operator|=
name|g_string_new
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|last_opened_raw_filenames
operator|=
name|g_slist_prepend
argument_list|(
name|last_opened_raw_filenames
argument_list|,
name|raw_filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_entries
operator|==
literal|0
condition|)
block|{
name|widget
operator|=
name|gtk_item_factory_get_widget
argument_list|(
name|toolbox_factory
argument_list|,
name|gettext
argument_list|(
name|file_menu_separator
operator|.
name|path
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
name|menus_last_opened_update_labels
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_init_mru (void)
name|menus_init_mru
parameter_list|(
name|void
parameter_list|)
block|{
name|gchar
modifier|*
name|paths
decl_stmt|,
modifier|*
name|accelerators
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|GtkItemFactoryEntry
modifier|*
name|last_opened_entries
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
name|last_opened_entries
operator|=
name|g_new
argument_list|(
name|GtkItemFactoryEntry
argument_list|,
name|last_opened_size
argument_list|)
expr_stmt|;
name|paths
operator|=
name|g_new
argument_list|(
name|gchar
argument_list|,
name|last_opened_size
operator|*
name|MRU_MENU_ENTRY_SIZE
argument_list|)
expr_stmt|;
name|accelerators
operator|=
name|g_new
argument_list|(
name|gchar
argument_list|,
literal|9
operator|*
name|MRU_MENU_ACCEL_SIZE
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|last_opened_size
condition|;
name|i
operator|++
control|)
block|{
name|gchar
modifier|*
name|path
decl_stmt|,
modifier|*
name|accelerator
decl_stmt|;
name|path
operator|=
operator|&
name|paths
index|[
name|i
operator|*
name|MRU_MENU_ENTRY_SIZE
index|]
expr_stmt|;
if|if
condition|(
name|i
operator|<
literal|9
condition|)
name|accelerator
operator|=
operator|&
name|accelerators
index|[
name|i
operator|*
name|MRU_MENU_ACCEL_SIZE
index|]
expr_stmt|;
else|else
name|accelerator
operator|=
name|NULL
expr_stmt|;
name|last_opened_entries
index|[
name|i
index|]
operator|.
name|path
operator|=
name|path
expr_stmt|;
name|last_opened_entries
index|[
name|i
index|]
operator|.
name|accelerator
operator|=
name|accelerator
expr_stmt|;
name|last_opened_entries
index|[
name|i
index|]
operator|.
name|callback
operator|=
operator|(
name|GtkItemFactoryCallback
operator|)
name|menus_last_opened_cmd_callback
expr_stmt|;
name|last_opened_entries
index|[
name|i
index|]
operator|.
name|callback_action
operator|=
name|i
expr_stmt|;
name|last_opened_entries
index|[
name|i
index|]
operator|.
name|item_type
operator|=
name|NULL
expr_stmt|;
name|g_snprintf
argument_list|(
name|path
argument_list|,
name|MRU_MENU_ENTRY_SIZE
argument_list|,
name|_
argument_list|(
literal|"/File/MRU%02d"
argument_list|)
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|accelerator
operator|!=
name|NULL
condition|)
name|g_snprintf
argument_list|(
name|accelerator
argument_list|,
name|MRU_MENU_ACCEL_SIZE
argument_list|,
literal|"<control>%d"
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
name|gtk_item_factory_create_items_ac
argument_list|(
name|toolbox_factory
argument_list|,
name|last_opened_size
argument_list|,
name|last_opened_entries
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|last_opened_size
condition|;
name|i
operator|++
control|)
block|{
name|widget
operator|=
name|gtk_item_factory_get_widget
argument_list|(
name|toolbox_factory
argument_list|,
name|last_opened_entries
index|[
name|i
index|]
operator|.
name|path
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
name|widget
operator|=
name|gtk_item_factory_get_widget
argument_list|(
name|toolbox_factory
argument_list|,
name|gettext
argument_list|(
name|file_menu_separator
operator|.
name|path
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|paths
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|accelerators
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|last_opened_entries
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|menus_init_toolbox ()
name|menus_init_toolbox
parameter_list|()
block|{
name|GtkItemFactoryEntry
modifier|*
name|translated_entries
decl_stmt|;
name|toolbox_factory
operator|=
name|gtk_item_factory_new
argument_list|(
name|GTK_TYPE_MENU_BAR
argument_list|,
literal|"<Toolbox>"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|translated_entries
operator|=
name|translate_entries
argument_list|(
name|toolbox_entries
argument_list|,
name|n_toolbox_entries
argument_list|)
expr_stmt|;
name|gtk_item_factory_create_items_ac
argument_list|(
name|toolbox_factory
argument_list|,
name|n_toolbox_entries
argument_list|,
name|translated_entries
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|free_translated_entries
argument_list|(
name|translated_entries
argument_list|,
name|n_toolbox_entries
argument_list|)
expr_stmt|;
name|menus_init_mru
argument_list|()
expr_stmt|;
name|translated_entries
operator|=
name|translate_entries
argument_list|(
operator|&
name|file_menu_separator
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_item_factory_create_item
argument_list|(
name|toolbox_factory
argument_list|,
name|translated_entries
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|free_translated_entries
argument_list|(
name|translated_entries
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|translated_entries
operator|=
name|translate_entries
argument_list|(
operator|&
name|toolbox_end
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_item_factory_create_item
argument_list|(
name|toolbox_factory
argument_list|,
name|translated_entries
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|free_translated_entries
argument_list|(
name|translated_entries
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GtkItemFactoryEntry
modifier|*
DECL|function|translate_entries (const GtkItemFactoryEntry * entries,gint n)
name|translate_entries
parameter_list|(
specifier|const
name|GtkItemFactoryEntry
modifier|*
name|entries
parameter_list|,
name|gint
name|n
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|GtkItemFactoryEntry
modifier|*
name|ret
decl_stmt|;
name|ret
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|GtkItemFactoryEntry
argument_list|)
operator|*
name|n
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
block|{
comment|/* Translation. Note the explicit use of gettext(). */
name|ret
index|[
name|i
index|]
operator|.
name|path
operator|=
name|g_strdup
argument_list|(
name|gettext
argument_list|(
name|entries
index|[
name|i
index|]
operator|.
name|path
argument_list|)
argument_list|)
expr_stmt|;
comment|/* accelerator and item_type are not duped, only referenced */
name|ret
index|[
name|i
index|]
operator|.
name|accelerator
operator|=
name|entries
index|[
name|i
index|]
operator|.
name|accelerator
expr_stmt|;
name|ret
index|[
name|i
index|]
operator|.
name|callback
operator|=
name|entries
index|[
name|i
index|]
operator|.
name|callback
expr_stmt|;
name|ret
index|[
name|i
index|]
operator|.
name|callback_action
operator|=
name|entries
index|[
name|i
index|]
operator|.
name|callback_action
expr_stmt|;
name|ret
index|[
name|i
index|]
operator|.
name|item_type
operator|=
name|entries
index|[
name|i
index|]
operator|.
name|item_type
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|free_translated_entries (GtkItemFactoryEntry * entries,gint n)
name|free_translated_entries
parameter_list|(
name|GtkItemFactoryEntry
modifier|*
name|entries
parameter_list|,
name|gint
name|n
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
name|g_free
argument_list|(
name|entries
index|[
name|i
index|]
operator|.
name|path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|entries
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|menus_init ()
name|menus_init
parameter_list|()
block|{
name|int
name|i
decl_stmt|;
name|GtkItemFactoryEntry
modifier|*
name|translated_entries
decl_stmt|;
if|if
condition|(
name|initialize
condition|)
block|{
name|gchar
modifier|*
name|filename
decl_stmt|;
name|initialize
operator|=
name|FALSE
expr_stmt|;
name|menus_init_toolbox
argument_list|()
expr_stmt|;
name|image_factory
operator|=
name|gtk_item_factory_new
argument_list|(
name|GTK_TYPE_MENU
argument_list|,
literal|"<Image>"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|translated_entries
operator|=
name|translate_entries
argument_list|(
name|image_entries
argument_list|,
name|n_image_entries
argument_list|)
expr_stmt|;
name|gtk_item_factory_create_items_ac
argument_list|(
name|image_factory
argument_list|,
name|n_image_entries
argument_list|,
name|translated_entries
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|free_translated_entries
argument_list|(
name|translated_entries
argument_list|,
name|n_image_entries
argument_list|)
expr_stmt|;
name|load_factory
operator|=
name|gtk_item_factory_new
argument_list|(
name|GTK_TYPE_MENU
argument_list|,
literal|"<Load>"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|translated_entries
operator|=
name|translate_entries
argument_list|(
name|load_entries
argument_list|,
name|n_load_entries
argument_list|)
expr_stmt|;
name|gtk_item_factory_create_items_ac
argument_list|(
name|load_factory
argument_list|,
name|n_load_entries
argument_list|,
name|translated_entries
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|free_translated_entries
argument_list|(
name|translated_entries
argument_list|,
name|n_load_entries
argument_list|)
expr_stmt|;
name|save_factory
operator|=
name|gtk_item_factory_new
argument_list|(
name|GTK_TYPE_MENU
argument_list|,
literal|"<Save>"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|translated_entries
operator|=
name|translate_entries
argument_list|(
name|load_entries
argument_list|,
name|n_save_entries
argument_list|)
expr_stmt|;
name|gtk_item_factory_create_items_ac
argument_list|(
name|save_factory
argument_list|,
name|n_save_entries
argument_list|,
name|translated_entries
argument_list|,
name|NULL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|free_translated_entries
argument_list|(
name|translated_entries
argument_list|,
name|n_save_entries
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_tools
condition|;
name|i
operator|++
control|)
block|{
comment|/* FIXME this need to use access functions to check a flag */
if|if
condition|(
name|tool_info
index|[
name|i
index|]
operator|.
name|menu_path
condition|)
name|menus_tools_create
argument_list|(
name|tool_info
operator|+
name|i
argument_list|)
expr_stmt|;
block|}
name|filename
operator|=
name|g_strconcat
argument_list|(
name|gimp_directory
argument_list|()
argument_list|,
literal|"/menurc"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_item_factory_parse_rc
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

