begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1999 Andy Thomas alt@picnic.demon.co.uk  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  * Some of this code is based on the layers_dialog box code.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"gdk/gdkkeysyms.h"
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"draw_core.h"
end_include

begin_include
include|#
directive|include
file|"actionarea.h"
end_include

begin_include
include|#
directive|include
file|"buildmenu.h"
end_include

begin_include
include|#
directive|include
file|"colormaps.h"
end_include

begin_include
include|#
directive|include
file|"drawable.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"floating_sel.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimage.h"
end_include

begin_include
include|#
directive|include
file|"gimage_mask.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"gimpset.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"image_render.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"layers_dialog.h"
end_include

begin_include
include|#
directive|include
file|"layers_dialogP.h"
end_include

begin_include
include|#
directive|include
file|"ops_buttons.h"
end_include

begin_include
include|#
directive|include
file|"paint_funcs.h"
end_include

begin_include
include|#
directive|include
file|"bezier_select.h"
end_include

begin_include
include|#
directive|include
file|"bezier_selectP.h"
end_include

begin_include
include|#
directive|include
file|"pathsP.h"
end_include

begin_include
include|#
directive|include
file|"paths_dialog.h"
end_include

begin_include
include|#
directive|include
file|"resize.h"
end_include

begin_include
include|#
directive|include
file|"session.h"
end_include

begin_include
include|#
directive|include
file|"undo.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_include
include|#
directive|include
file|"tools/new.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/duplicate.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/delete.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/pennorm.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/penadd.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/pendel.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/penedit.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/penstroke.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/ptoselection.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/path.xbm"
end_include

begin_define
DECL|macro|PREVIEW_EVENT_MASK
define|#
directive|define
name|PREVIEW_EVENT_MASK
value|GDK_EXPOSURE_MASK | GDK_BUTTON_PRESS_MASK | GDK_ENTER_NOTIFY_MASK
end_define

begin_define
DECL|macro|PATHS_LIST_WIDTH
define|#
directive|define
name|PATHS_LIST_WIDTH
value|200
end_define

begin_define
DECL|macro|PATHS_LIST_HEIGHT
define|#
directive|define
name|PATHS_LIST_HEIGHT
value|150
end_define

begin_typedef
DECL|struct|__anon2a9a46060108
typedef|typedef
struct|struct
block|{
DECL|member|paths_list
name|GtkWidget
modifier|*
name|paths_list
decl_stmt|;
DECL|member|vbox
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
DECL|member|ops_menu
name|GtkWidget
modifier|*
name|ops_menu
decl_stmt|;
DECL|member|accel_group
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
DECL|member|ratio
name|double
name|ratio
decl_stmt|;
DECL|member|image_width
DECL|member|image_height
name|int
name|image_width
decl_stmt|,
name|image_height
decl_stmt|;
DECL|member|gimage_width
DECL|member|gimage_height
name|int
name|gimage_width
decl_stmt|,
name|gimage_height
decl_stmt|;
comment|/*  state information  */
DECL|member|selsigid
name|gint
name|selsigid
decl_stmt|;
DECL|member|gimage
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
DECL|member|gc
name|GdkGC
modifier|*
name|gc
decl_stmt|;
DECL|member|black
name|GdkColor
name|black
decl_stmt|;
DECL|member|white
name|GdkColor
name|white
decl_stmt|;
DECL|member|selected_row_num
name|gint
name|selected_row_num
decl_stmt|;
DECL|member|been_selected
name|gboolean
name|been_selected
decl_stmt|;
DECL|member|current_path_list
name|PATHIMAGELISTP
name|current_path_list
decl_stmt|;
DECL|typedef|PATHSLIST
DECL|typedef|PATHSLISTP
block|}
name|PATHSLIST
operator|,
typedef|*
name|PATHSLISTP
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|paths_dialog
specifier|static
name|PATHSLISTP
name|paths_dialog
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_typedef
DECL|struct|__anon2a9a46060208
typedef|typedef
struct|struct
block|{
DECL|member|paths_pixmap
name|GdkPixmap
modifier|*
name|paths_pixmap
decl_stmt|;
DECL|member|text
name|GString
modifier|*
name|text
decl_stmt|;
DECL|member|bzp
name|BZPATHP
name|bzp
decl_stmt|;
DECL|typedef|PATHWIDGET
DECL|typedef|PATHWIDGETP
block|}
name|PATHWIDGET
operator|,
typedef|*
name|PATHWIDGETP
typedef|;
end_typedef

begin_function_decl
specifier|static
name|gint
name|path_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_realized
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_select_row
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_unselect_row
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|paths_list_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_new_path_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_delete_path_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_unmap_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_dup_path_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_stroke_path_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_path_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_destroy_cb
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_update_paths
parameter_list|(
name|gpointer
name|data
parameter_list|,
name|gint
name|row
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GSList
modifier|*
name|bzpoints_copy
parameter_list|(
name|GSList
modifier|*
name|list
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|bzpoints_free
parameter_list|(
name|GSList
modifier|*
name|list
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_update_preview
parameter_list|(
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_preview_extents
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_new_point_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_add_point_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_delete_point_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paths_dialog_edit_point_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_define
DECL|macro|NEW_PATH_BUTTON
define|#
directive|define
name|NEW_PATH_BUTTON
value|1
end_define

begin_define
DECL|macro|DUP_PATH_BUTTON
define|#
directive|define
name|DUP_PATH_BUTTON
value|2
end_define

begin_define
DECL|macro|PATH_TO_SEL_BUTTON
define|#
directive|define
name|PATH_TO_SEL_BUTTON
value|3
end_define

begin_define
DECL|macro|STROKE_PATH_BUTTON
define|#
directive|define
name|STROKE_PATH_BUTTON
value|4
end_define

begin_define
DECL|macro|DEL_PATH_BUTTON
define|#
directive|define
name|DEL_PATH_BUTTON
value|5
end_define

begin_decl_stmt
DECL|variable|paths_ops
specifier|static
name|MenuItem
name|paths_ops
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"New Path"
argument_list|)
block|,
literal|'N'
block|,
name|GDK_CONTROL_MASK
block|,
name|paths_dialog_new_path_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Duplicate Path"
argument_list|)
block|,
literal|'C'
block|,
name|GDK_CONTROL_MASK
block|,
name|paths_dialog_dup_path_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Path to Selection"
argument_list|)
block|,
literal|'S'
block|,
name|GDK_CONTROL_MASK
block|,
name|paths_dialog_path_to_sel_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Stroke Path"
argument_list|)
block|,
literal|'T'
block|,
name|GDK_CONTROL_MASK
block|,
name|paths_dialog_stroke_path_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Delete Path"
argument_list|)
block|,
literal|'D'
block|,
name|GDK_CONTROL_MASK
block|,
name|paths_dialog_delete_path_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|paths_ops_buttons
specifier|static
name|OpsButton
name|paths_ops_buttons
index|[]
init|=
block|{
block|{
name|new_xpm
block|,
name|paths_dialog_new_path_callback
block|,
name|N_
argument_list|(
literal|"New Path"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|duplicate_xpm
block|,
name|paths_dialog_dup_path_callback
block|,
name|N_
argument_list|(
literal|"Duplicate Path"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|ptoselection_xpm
block|,
name|paths_dialog_path_to_sel_callback
block|,
name|N_
argument_list|(
literal|"Path to Selection"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|penstroke_xpm
block|,
name|paths_dialog_stroke_path_callback
block|,
name|N_
argument_list|(
literal|"Stroke Path"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|delete_xpm
block|,
name|paths_dialog_delete_path_callback
block|,
name|N_
argument_list|(
literal|"Delete Path"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|POINT_NEW_BUTTON
define|#
directive|define
name|POINT_NEW_BUTTON
value|1
end_define

begin_define
DECL|macro|POINT_ADD_BUTTON
define|#
directive|define
name|POINT_ADD_BUTTON
value|2
end_define

begin_define
DECL|macro|POINT_DEL_BUTTON
define|#
directive|define
name|POINT_DEL_BUTTON
value|3
end_define

begin_define
DECL|macro|POINT_EDIT_BUTTON
define|#
directive|define
name|POINT_EDIT_BUTTON
value|4
end_define

begin_decl_stmt
DECL|variable|point_ops_buttons
specifier|static
name|OpsButton
name|point_ops_buttons
index|[]
init|=
block|{
block|{
name|pennorm_xpm
block|,
name|paths_dialog_new_point_callback
block|,
name|N_
argument_list|(
literal|"New Point"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|penadd_xpm
block|,
name|paths_dialog_add_point_callback
block|,
name|N_
argument_list|(
literal|"Add Point"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|pendel_xpm
block|,
name|paths_dialog_delete_point_callback
block|,
name|N_
argument_list|(
literal|"Delete Point"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|penedit_xpm
block|,
name|paths_dialog_edit_point_callback
block|,
name|N_
argument_list|(
literal|"Edit Point"
argument_list|)
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|paths_ops_button_set_sensitive (gint but,gboolean sensitive)
name|paths_ops_button_set_sensitive
parameter_list|(
name|gint
name|but
parameter_list|,
name|gboolean
name|sensitive
parameter_list|)
block|{
switch|switch
condition|(
name|but
condition|)
block|{
case|case
name|NEW_PATH_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops
index|[
literal|0
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops_buttons
index|[
literal|0
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
case|case
name|DUP_PATH_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops
index|[
literal|1
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops_buttons
index|[
literal|1
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
case|case
name|PATH_TO_SEL_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops
index|[
literal|2
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops_buttons
index|[
literal|2
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
case|case
name|STROKE_PATH_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops
index|[
literal|3
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops_buttons
index|[
literal|3
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
case|case
name|DEL_PATH_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops
index|[
literal|4
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|paths_ops_buttons
index|[
literal|4
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
name|_
argument_list|(
literal|"paths_ops_button_set_sensitive:: invalid button specified"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|point_ops_button_set_sensitive (gint but,gboolean sensitive)
name|point_ops_button_set_sensitive
parameter_list|(
name|gint
name|but
parameter_list|,
name|gboolean
name|sensitive
parameter_list|)
block|{
switch|switch
condition|(
name|but
condition|)
block|{
case|case
name|POINT_NEW_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|point_ops_buttons
index|[
literal|0
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
case|case
name|POINT_ADD_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|point_ops_buttons
index|[
literal|1
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
case|case
name|POINT_DEL_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|point_ops_buttons
index|[
literal|2
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
case|case
name|POINT_EDIT_BUTTON
case|:
name|gtk_widget_set_sensitive
argument_list|(
name|point_ops_buttons
index|[
literal|3
index|]
operator|.
name|widget
argument_list|,
name|sensitive
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
name|_
argument_list|(
literal|"point_ops_button_set_sensitive:: invalid button specified"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_list_destroy (GtkWidget * w)
name|paths_list_destroy
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|)
block|{
name|paths_dialog
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
DECL|function|paths_dialog_create ()
name|GtkWidget
modifier|*
name|paths_dialog_create
parameter_list|()
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|paths_list
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
name|GtkWidget
modifier|*
name|button_box
decl_stmt|;
if|if
condition|(
operator|!
name|paths_dialog
condition|)
block|{
name|paths_dialog
operator|=
name|g_new0
argument_list|(
name|PATHSLIST
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*  The paths box  */
name|paths_dialog
operator|->
name|vbox
operator|=
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* The point operations */
name|button_box
operator|=
name|ops_button_box_new
argument_list|(
name|lc_shell
argument_list|,
name|tool_tips
argument_list|,
name|point_ops_buttons
argument_list|,
name|OPS_BUTTON_RADIO
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button_box
argument_list|)
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button_box
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button_box
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|scrolled_win
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_ALWAYS
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|paths_list
operator|=
name|paths_list
operator|=
name|gtk_clist_new
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|paths_list_destroy
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*       gtk_clist_set_column_title(GTK_CLIST(paths_list), 0, "col1"); */
comment|/*       gtk_clist_column_titles_show(GTK_CLIST(paths_list)); */
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|paths_list
argument_list|)
expr_stmt|;
name|gtk_clist_set_selection_mode
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_list
argument_list|)
argument_list|,
name|GTK_SELECTION_BROWSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|paths_list
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|paths_list_events
argument_list|,
name|paths_dialog
argument_list|)
expr_stmt|;
name|gtk_container_set_focus_vadjustment
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|paths_list
argument_list|)
argument_list|,
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
operator|->
name|vscrollbar
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|selsigid
operator|=
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|paths_list
argument_list|)
argument_list|,
literal|"select_row"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|paths_select_row
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|paths_list
argument_list|)
argument_list|,
literal|"unselect_row"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|paths_unselect_row
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|paths_list
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"realize"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|paths_dialog_realized
argument_list|,
operator|(
name|gpointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* The ops buttons */
name|button_box
operator|=
name|ops_button_box_new
argument_list|(
name|lc_shell
argument_list|,
name|tool_tips
argument_list|,
name|paths_ops_buttons
argument_list|,
name|OPS_BUTTON_NORMAL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button_box
argument_list|)
expr_stmt|;
comment|/*  Set up signals for map/unmap for the accelerators  */
name|paths_dialog
operator|->
name|accel_group
operator|=
name|gtk_accel_group_new
argument_list|()
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|paths_dialog_map_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|"unmap"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|paths_dialog_unmap_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|ops_menu
operator|=
name|build_menu
argument_list|(
name|paths_ops
argument_list|,
name|paths_dialog
operator|->
name|accel_group
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|DUP_PATH_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|DEL_PATH_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|STROKE_PATH_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_ADD_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_DEL_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_NEW_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_EDIT_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|PATH_TO_SEL_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
return|return
name|paths_dialog
operator|->
name|vbox
return|;
block|}
end_function

begin_function
DECL|function|paths_dialog_realized (GtkWidget * widget)
specifier|static
name|void
name|paths_dialog_realized
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GdkColormap
modifier|*
name|colormap
decl_stmt|;
name|gchar
name|dash_list
index|[
literal|2
index|]
init|=
block|{
literal|3
block|,
literal|3
block|}
decl_stmt|;
name|paths_dialog
operator|->
name|gc
operator|=
name|gdk_gc_new
argument_list|(
name|widget
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_gc_set_dashes
argument_list|(
name|paths_dialog
operator|->
name|gc
argument_list|,
literal|2
argument_list|,
name|dash_list
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|colormap
operator|=
name|gtk_widget_get_colormap
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"black"
argument_list|,
operator|&
name|paths_dialog
operator|->
name|black
argument_list|)
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|colormap
argument_list|,
operator|&
name|paths_dialog
operator|->
name|black
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"white"
argument_list|,
operator|&
name|paths_dialog
operator|->
name|white
argument_list|)
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|colormap
argument_list|,
operator|&
name|paths_dialog
operator|->
name|white
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Clears out row when list element is deleted/destroyed */
end_comment

begin_function
specifier|static
name|void
DECL|function|clear_pathwidget (gpointer data)
name|clear_pathwidget
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|PATHWIDGETP
name|pwidget
init|=
name|data
decl_stmt|;
if|if
condition|(
name|pwidget
condition|)
block|{
name|g_free
argument_list|(
name|pwidget
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|bzpoint_free (gpointer data,gpointer user_data)
name|bzpoint_free
parameter_list|(
name|gpointer
name|data
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|BZPOINTP
name|bzpoint
init|=
name|data
decl_stmt|;
name|g_free
argument_list|(
name|bzpoint
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|bzpath_free (gpointer data,gpointer user_data)
name|bzpath_free
parameter_list|(
name|gpointer
name|data
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|BZPATHP
name|bzp
init|=
name|data
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|bzp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_string_free
argument_list|(
name|bzp
operator|->
name|name
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|bzpoints_free
argument_list|(
name|bzp
operator|->
name|bezier_details
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|bzp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|BZPATHP
DECL|function|bzpath_dialog_new (gint name_seed,gpointer udata)
name|bzpath_dialog_new
parameter_list|(
name|gint
name|name_seed
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|BZPATHP
name|bzp
init|=
name|g_new0
argument_list|(
name|BZPATH
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|GString
modifier|*
name|s
init|=
name|g_string_new
argument_list|(
name|NULL
argument_list|)
decl_stmt|;
name|g_string_sprintf
argument_list|(
name|s
argument_list|,
literal|"path %d"
argument_list|,
name|name_seed
argument_list|)
expr_stmt|;
name|bzp
operator|->
name|name
operator|=
name|s
expr_stmt|;
name|bzp
operator|->
name|bezier_details
operator|=
operator|(
name|GSList
operator|*
operator|)
name|udata
expr_stmt|;
comment|/* If called via button/menu this will be NULL */
return|return
name|bzp
return|;
block|}
end_function

begin_function
specifier|static
name|BZPATHP
DECL|function|bzpath_copy (BZPATHP bzp)
name|bzpath_copy
parameter_list|(
name|BZPATHP
name|bzp
parameter_list|)
block|{
name|BZPATHP
name|bzp_copy
init|=
name|g_new0
argument_list|(
name|BZPATH
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|GString
modifier|*
name|s
init|=
name|g_string_new
argument_list|(
name|NULL
argument_list|)
decl_stmt|;
name|g_string_sprintf
argument_list|(
name|s
argument_list|,
literal|"%s copy"
argument_list|,
name|bzp
operator|->
name|name
operator|->
name|str
argument_list|)
expr_stmt|;
name|bzp_copy
operator|->
name|name
operator|=
name|s
expr_stmt|;
name|bzp_copy
operator|->
name|closed
operator|=
name|bzp
operator|->
name|closed
expr_stmt|;
name|bzp_copy
operator|->
name|state
operator|=
name|bzp
operator|->
name|state
expr_stmt|;
name|bzp_copy
operator|->
name|bezier_details
operator|=
name|bzpoints_copy
argument_list|(
name|bzp
operator|->
name|bezier_details
argument_list|)
expr_stmt|;
return|return
name|bzp_copy
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|bzpath_close (BZPATHP bzp)
name|bzpath_close
parameter_list|(
name|BZPATHP
name|bzp
parameter_list|)
block|{
name|BZPOINTP
name|pdata
decl_stmt|;
name|BZPOINTP
name|bzpoint
decl_stmt|;
comment|/* bzpaths are only really closed when converted to the BezierSelect ones */
name|bzp
operator|->
name|closed
operator|=
literal|1
expr_stmt|;
comment|/* first point */
name|pdata
operator|=
operator|(
name|BZPOINTP
operator|)
name|bzp
operator|->
name|bezier_details
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|g_slist_length
argument_list|(
name|bzp
operator|->
name|bezier_details
argument_list|)
operator|<
literal|5
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|bzpoint
operator|=
name|g_new0
argument_list|(
name|BZPOINT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|bzpoint
operator|->
name|type
operator|=
operator|(
name|i
operator|&
literal|1
operator|)
condition|?
name|BEZIER_ANCHOR
else|:
name|BEZIER_CONTROL
expr_stmt|;
name|bzpoint
operator|->
name|x
operator|=
name|pdata
operator|->
name|x
operator|+
name|i
expr_stmt|;
name|bzpoint
operator|->
name|y
operator|=
name|pdata
operator|->
name|y
operator|+
name|i
expr_stmt|;
name|bzp
operator|->
name|bezier_details
operator|=
name|g_slist_append
argument_list|(
name|bzp
operator|->
name|bezier_details
argument_list|,
name|bzpoint
argument_list|)
expr_stmt|;
block|}
block|}
name|bzpoint
operator|=
name|g_new0
argument_list|(
name|BZPOINT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pdata
operator|=
operator|(
name|BZPOINTP
operator|)
name|bzp
operator|->
name|bezier_details
operator|->
name|data
expr_stmt|;
name|bzpoint
operator|->
name|type
operator|=
name|BEZIER_CONTROL
expr_stmt|;
name|bzpoint
operator|->
name|x
operator|=
name|pdata
operator|->
name|x
expr_stmt|;
name|bzpoint
operator|->
name|y
operator|=
name|pdata
operator|->
name|y
expr_stmt|;
name|bzp
operator|->
name|bezier_details
operator|=
name|g_slist_append
argument_list|(
name|bzp
operator|->
name|bezier_details
argument_list|,
name|bzpoint
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|beziersel_free (BezierSelect * bezier_sel)
name|beziersel_free
parameter_list|(
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|)
block|{
name|bezier_select_reset
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|BezierSelect
modifier|*
DECL|function|bzpath_to_beziersel (BZPATHP bzp)
name|bzpath_to_beziersel
parameter_list|(
name|BZPATHP
name|bzp
parameter_list|)
block|{
name|BezierSelect
modifier|*
name|bezier_sel
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
if|if
condition|(
operator|!
name|bzp
condition|)
block|{
name|g_warning
argument_list|(
literal|"bzpath_to_beziersel:: NULL bzp"
argument_list|)
expr_stmt|;
block|}
name|list
operator|=
name|bzp
operator|->
name|bezier_details
expr_stmt|;
name|bezier_sel
operator|=
name|g_new0
argument_list|(
name|BezierSelect
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|bezier_sel
operator|->
name|num_points
operator|=
literal|0
expr_stmt|;
name|bezier_sel
operator|->
name|mask
operator|=
name|NULL
expr_stmt|;
name|bezier_sel
operator|->
name|core
operator|=
name|NULL
expr_stmt|;
comment|/* not required will be reset in bezier code */
name|bezier_select_reset
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
name|bezier_sel
operator|->
name|closed
operator|=
name|bzp
operator|->
name|closed
expr_stmt|;
comment|/*   bezier_sel->state = BEZIER_ADD; */
name|bezier_sel
operator|->
name|state
operator|=
name|bzp
operator|->
name|state
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|BZPOINTP
name|pdata
decl_stmt|;
name|pdata
operator|=
operator|(
name|BZPOINTP
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|bezier_add_point
argument_list|(
name|bezier_sel
argument_list|,
name|pdata
operator|->
name|type
argument_list|,
name|pdata
operator|->
name|x
argument_list|,
name|pdata
operator|->
name|y
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|bezier_sel
operator|->
name|closed
condition|)
block|{
name|bezier_sel
operator|->
name|last_point
operator|->
name|next
operator|=
name|bezier_sel
operator|->
name|points
expr_stmt|;
name|bezier_sel
operator|->
name|points
operator|->
name|prev
operator|=
name|bezier_sel
operator|->
name|last_point
expr_stmt|;
name|bezier_sel
operator|->
name|cur_anchor
operator|=
name|bezier_sel
operator|->
name|points
expr_stmt|;
name|bezier_sel
operator|->
name|cur_control
operator|=
name|bezier_sel
operator|->
name|points
operator|->
name|next
expr_stmt|;
block|}
return|return
name|bezier_sel
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|pathimagelist_free (PATHIMAGELISTP iml)
name|pathimagelist_free
parameter_list|(
name|PATHIMAGELISTP
name|iml
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|iml
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|iml
operator|->
name|bz_paths
condition|)
block|{
name|g_slist_foreach
argument_list|(
name|iml
operator|->
name|bz_paths
argument_list|,
name|bzpath_free
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|iml
operator|->
name|bz_paths
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|iml
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|bz_change_name_row_to (gint row,gchar * text)
name|bz_change_name_row_to
parameter_list|(
name|gint
name|row
parameter_list|,
name|gchar
modifier|*
name|text
parameter_list|)
block|{
name|PATHWIDGETP
name|pwidget
decl_stmt|;
name|pwidget
operator|=
operator|(
name|PATHWIDGETP
operator|)
name|gtk_clist_get_row_data
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pwidget
condition|)
return|return;
name|g_string_free
argument_list|(
name|pwidget
operator|->
name|bzp
operator|->
name|name
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pwidget
operator|->
name|bzp
operator|->
name|name
operator|=
name|g_string_new
argument_list|(
name|text
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_set_dash_line (GdkGC * gc,gboolean state)
name|paths_set_dash_line
parameter_list|(
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|gboolean
name|state
parameter_list|)
block|{
if|if
condition|(
name|state
condition|)
block|{
name|gdk_gc_set_line_attributes
argument_list|(
name|gc
argument_list|,
literal|0
argument_list|,
name|GDK_LINE_ON_OFF_DASH
argument_list|,
name|GDK_CAP_BUTT
argument_list|,
name|GDK_JOIN_ROUND
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gdk_gc_set_line_attributes
argument_list|(
name|gc
argument_list|,
literal|0
argument_list|,
name|GDK_LINE_SOLID
argument_list|,
name|GDK_CAP_BUTT
argument_list|,
name|GDK_JOIN_ROUND
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|clear_pixmap_preview (PATHWIDGETP pwidget)
name|clear_pixmap_preview
parameter_list|(
name|PATHWIDGETP
name|pwidget
parameter_list|)
block|{
name|gchar
modifier|*
name|rgb_buf
decl_stmt|;
name|rgb_buf
operator|=
name|g_new0
argument_list|(
name|gchar
argument_list|,
operator|(
name|paths_dialog
operator|->
name|image_width
operator|+
literal|4
operator|)
operator|*
operator|(
name|paths_dialog
operator|->
name|image_height
operator|+
literal|4
operator|)
operator|*
literal|3
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|rgb_buf
argument_list|,
literal|0xFF
argument_list|,
operator|(
name|paths_dialog
operator|->
name|image_width
operator|+
literal|4
operator|)
operator|*
operator|(
name|paths_dialog
operator|->
name|image_height
operator|+
literal|4
operator|)
operator|*
literal|3
argument_list|)
expr_stmt|;
name|gdk_draw_rgb_image
argument_list|(
name|pwidget
operator|->
name|paths_pixmap
argument_list|,
name|paths_dialog
operator|->
name|gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|paths_dialog
operator|->
name|image_width
operator|+
literal|4
argument_list|,
name|paths_dialog
operator|->
name|image_height
operator|+
literal|4
argument_list|,
name|GDK_RGB_DITHER_NORMAL
argument_list|,
name|rgb_buf
argument_list|,
operator|(
name|paths_dialog
operator|->
name|image_width
operator|+
literal|4
operator|)
operator|*
literal|3
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|paths_dialog
operator|->
name|gc
argument_list|,
operator|&
name|paths_dialog
operator|->
name|black
argument_list|)
expr_stmt|;
name|paths_set_dash_line
argument_list|(
name|paths_dialog
operator|->
name|gc
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|pwidget
operator|->
name|paths_pixmap
argument_list|,
name|paths_dialog
operator|->
name|gc
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|paths_dialog
operator|->
name|image_width
operator|+
literal|3
argument_list|,
name|paths_dialog
operator|->
name|image_height
operator|+
literal|3
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|pwidget
operator|->
name|paths_pixmap
argument_list|,
name|paths_dialog
operator|->
name|gc
argument_list|,
name|FALSE
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
name|paths_dialog
operator|->
name|image_width
operator|+
literal|1
argument_list|,
name|paths_dialog
operator|->
name|image_height
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* insrow == -1 -> append else insert at insrow */
end_comment

begin_function
DECL|function|paths_add_path (BZPATHP bzp,gint insrow)
name|void
name|paths_add_path
parameter_list|(
name|BZPATHP
name|bzp
parameter_list|,
name|gint
name|insrow
parameter_list|)
block|{
comment|/* Create a new entry in the list */
name|PATHWIDGETP
name|pwidget
decl_stmt|;
name|gint
name|row
decl_stmt|;
name|gchar
modifier|*
name|row_data
index|[
literal|1
index|]
decl_stmt|;
name|pwidget
operator|=
name|g_new0
argument_list|(
name|PATHWIDGET
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GTK_WIDGET_REALIZED
argument_list|(
name|paths_dialog
operator|->
name|vbox
argument_list|)
condition|)
name|gtk_widget_realize
argument_list|(
name|paths_dialog
operator|->
name|vbox
argument_list|)
expr_stmt|;
name|paths_dialog_preview_extents
argument_list|()
expr_stmt|;
if|if
condition|(
name|preview_size
condition|)
block|{
comment|/* Need to add this to the list */
name|pwidget
operator|->
name|paths_pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|paths_dialog
operator|->
name|vbox
operator|->
name|window
argument_list|,
name|paths_dialog
operator|->
name|image_width
operator|+
literal|4
argument_list|,
name|paths_dialog
operator|->
name|image_height
operator|+
literal|4
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|clear_pixmap_preview
argument_list|(
name|pwidget
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|pwidget
operator|->
name|paths_pixmap
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|paths_dialog
operator|->
name|vbox
operator|->
name|window
argument_list|,
name|path_bits
argument_list|,
name|paths_dialog
operator|->
name|image_width
argument_list|,
name|paths_dialog
operator|->
name|image_height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|paths_dialog
operator|->
name|vbox
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|,
operator|&
name|paths_dialog
operator|->
name|vbox
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|)
expr_stmt|;
block|}
name|gtk_clist_set_row_height
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|image_height
operator|+
literal|6
argument_list|)
expr_stmt|;
name|row_data
index|[
literal|0
index|]
operator|=
literal|""
expr_stmt|;
if|if
condition|(
name|insrow
operator|==
operator|-
literal|1
condition|)
name|row
operator|=
name|gtk_clist_append
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row_data
argument_list|)
expr_stmt|;
else|else
name|row
operator|=
name|gtk_clist_insert
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|insrow
argument_list|,
name|row_data
argument_list|)
expr_stmt|;
name|gtk_clist_set_pixtext
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row
argument_list|,
literal|0
argument_list|,
name|bzp
operator|->
name|name
operator|->
name|str
argument_list|,
literal|2
argument_list|,
name|pwidget
operator|->
name|paths_pixmap
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_clist_set_row_data_full
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row
argument_list|,
operator|(
name|gpointer
operator|)
name|pwidget
argument_list|,
name|clear_pathwidget
argument_list|)
expr_stmt|;
name|gtk_signal_handler_block
argument_list|(
name|GTK_OBJECT
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|selsigid
argument_list|)
expr_stmt|;
name|gtk_clist_select_row
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock
argument_list|(
name|GTK_OBJECT
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|selsigid
argument_list|)
expr_stmt|;
name|pwidget
operator|->
name|bzp
operator|=
name|bzp
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_preview_extents ()
name|paths_dialog_preview_extents
parameter_list|()
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
if|if
condition|(
operator|!
name|paths_dialog
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|paths_dialog
operator|->
name|gimage
operator|)
condition|)
return|return;
name|gimage
operator|=
name|paths_dialog
operator|->
name|gimage
expr_stmt|;
name|paths_dialog
operator|->
name|gimage_width
operator|=
name|gimage
operator|->
name|width
expr_stmt|;
name|paths_dialog
operator|->
name|gimage_height
operator|=
name|gimage
operator|->
name|height
expr_stmt|;
comment|/*  Get the image width and height variables, based on the gimage  */
if|if
condition|(
name|gimage
operator|->
name|width
operator|>
name|gimage
operator|->
name|height
condition|)
name|paths_dialog
operator|->
name|ratio
operator|=
operator|(
name|double
operator|)
name|preview_size
operator|/
operator|(
name|double
operator|)
name|gimage
operator|->
name|width
expr_stmt|;
else|else
name|paths_dialog
operator|->
name|ratio
operator|=
operator|(
name|double
operator|)
name|preview_size
operator|/
operator|(
name|double
operator|)
name|gimage
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|preview_size
condition|)
block|{
name|paths_dialog
operator|->
name|image_width
operator|=
call|(
name|int
call|)
argument_list|(
name|paths_dialog
operator|->
name|ratio
operator|*
name|gimage
operator|->
name|width
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|image_height
operator|=
call|(
name|int
call|)
argument_list|(
name|paths_dialog
operator|->
name|ratio
operator|*
name|gimage
operator|->
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|paths_dialog
operator|->
name|image_width
operator|<
literal|1
condition|)
name|paths_dialog
operator|->
name|image_width
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|paths_dialog
operator|->
name|image_height
operator|<
literal|1
condition|)
name|paths_dialog
operator|->
name|image_height
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|paths_dialog
operator|->
name|image_width
operator|=
name|path_width
expr_stmt|;
name|paths_dialog
operator|->
name|image_height
operator|=
name|path_height
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|path_widget_preview_events (GtkWidget * widget,GdkEvent * event)
name|path_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
comment|/*  Control-button press disables the application of the mask  */
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
break|break;
case|case
name|GDK_EXPOSE
case|:
if|if
condition|(
name|preview_size
condition|)
block|{
comment|/* 	  layer_widget_preview_redraw (layer_widget, preview_type); */
comment|/* 	  gdk_draw_pixmap (widget->window, */
comment|/* 			   widget->style->black_gc, */
comment|/* 			   *pixmap, */
comment|/* 			   0, 0, 2, 2, */
comment|/* 			   layersD->image_width, */
comment|/* 			   layersD->image_height); */
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_select_row (GtkWidget * widget,gint row,gint column,GdkEventButton * event,gpointer data)
name|paths_select_row
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|PATHWIDGETP
name|pwidget
decl_stmt|;
name|BZPATHP
name|bzp
decl_stmt|;
name|BezierSelect
modifier|*
name|bsel
decl_stmt|;
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|pwidget
operator|=
operator|(
name|PATHWIDGETP
operator|)
name|gtk_clist_get_row_data
argument_list|(
name|GTK_CLIST
argument_list|(
name|widget
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pwidget
operator|||
operator|(
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
operator|==
name|row
operator|&&
name|paths_dialog
operator|->
name|been_selected
operator|==
name|TRUE
operator|)
condition|)
return|return;
name|paths_dialog
operator|->
name|selected_row_num
operator|=
name|row
expr_stmt|;
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
operator|=
name|row
expr_stmt|;
name|paths_dialog
operator|->
name|been_selected
operator|=
name|TRUE
expr_stmt|;
name|bzp
operator|=
operator|(
name|BZPATHP
operator|)
name|g_slist_nth_data
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|bz_paths
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|bzp
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|bsel
operator|=
name|bzpath_to_beziersel
argument_list|(
name|bzp
argument_list|)
expr_stmt|;
name|gdisp
operator|=
name|gdisplays_check_valid
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|gdisp
argument_list|,
name|paths_dialog
operator|->
name|gimage
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gdisp
condition|)
block|{
name|g_warning
argument_list|(
literal|"Lost image which bezier curve belonged to"
argument_list|)
expr_stmt|;
return|return;
block|}
name|bezier_paste_bezierselect_to_current
argument_list|(
name|gdisp
argument_list|,
name|bsel
argument_list|)
expr_stmt|;
name|paths_update_preview
argument_list|(
name|bsel
argument_list|)
expr_stmt|;
name|beziersel_free
argument_list|(
name|bsel
argument_list|)
expr_stmt|;
comment|/* Draw white as the border */
comment|/*  gdk_gc_set_foreground(paths_dialog->gc,&paths_dialog->black); */
comment|/*   gdk_draw_rectangle(pwidget->paths_pixmap,  */
comment|/* 		     paths_dialog->gc, FALSE, 0, 0,  */
comment|/* 		     paths_dialog->image_width+3, */
comment|/* 		     paths_dialog->image_height+3); */
comment|/*   gdk_draw_rectangle(pwidget->paths_pixmap,  */
comment|/* 		     paths_dialog->gc, FALSE, 1, 1,  */
comment|/* 		     paths_dialog->image_width+1, */
comment|/* 		     paths_dialog->image_height+1); */
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_unselect_row (GtkWidget * widget,gint row,gint column,GdkEventButton * event,gpointer data)
name|paths_unselect_row
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|PATHWIDGETP
name|pwidget
decl_stmt|;
name|pwidget
operator|=
operator|(
name|PATHWIDGETP
operator|)
name|gtk_clist_get_row_data
argument_list|(
name|GTK_CLIST
argument_list|(
name|widget
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pwidget
condition|)
return|return;
comment|/*   gdk_gc_set_foreground(paths_dialog->gc,&paths_dialog->white); */
comment|/*   gdk_draw_rectangle(pwidget->paths_pixmap,  */
comment|/* 		     paths_dialog->gc, FALSE, 0, 0,  */
comment|/* 		     paths_dialog->image_width+3, */
comment|/* 		     paths_dialog->image_height+3); */
comment|/*   gdk_draw_rectangle(pwidget->paths_pixmap,  */
comment|/* 		     paths_dialog->gc, FALSE, 1, 1,  */
comment|/* 		     paths_dialog->image_width+1, */
comment|/* 		     paths_dialog->image_height+1); */
block|}
end_function

begin_function
name|void
DECL|function|paths_dialog_update (GimpImage * gimage)
name|paths_dialog_update
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|)
block|{
name|PATHIMAGELISTP
name|new_path_list
decl_stmt|;
name|GSList
modifier|*
name|plist
decl_stmt|;
name|gint
name|loop
decl_stmt|;
name|gint
name|tmprow
decl_stmt|;
if|if
condition|(
operator|!
name|paths_dialog
operator|||
operator|!
name|gimage
condition|)
return|return;
comment|/* The last pointer comparison forces update if something has changed    * under our feet.    */
if|if
condition|(
name|paths_dialog
operator|->
name|gimage
operator|==
name|gimage
operator|&&
name|paths_dialog
operator|->
name|current_path_list
operator|==
operator|(
name|PATHIMAGELISTP
operator|)
name|gimp_image_get_paths
argument_list|(
name|gimage
argument_list|)
condition|)
return|return;
name|paths_dialog
operator|->
name|gimage
operator|=
name|gimage
expr_stmt|;
name|paths_dialog_preview_extents
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|GTK_WIDGET_REALIZED
argument_list|(
name|paths_dialog
operator|->
name|vbox
argument_list|)
condition|)
name|gtk_widget_realize
argument_list|(
name|paths_dialog
operator|->
name|vbox
argument_list|)
expr_stmt|;
comment|/* ALT removed& replaced return;*/
comment|/* clear clist out */
name|gtk_clist_freeze
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_clear
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_thaw
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Find bz list */
name|new_path_list
operator|=
operator|(
name|PATHIMAGELISTP
operator|)
name|gimp_image_get_paths
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|current_path_list
operator|=
name|new_path_list
expr_stmt|;
name|paths_dialog
operator|->
name|been_selected
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|!
name|new_path_list
condition|)
block|{
comment|/* No list assoc with this image */
name|paths_ops_button_set_sensitive
argument_list|(
name|DUP_PATH_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|DEL_PATH_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|STROKE_PATH_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_ADD_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_DEL_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_NEW_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_EDIT_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|PATH_TO_SEL_BUTTON
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return;
block|}
else|else
block|{
name|paths_ops_button_set_sensitive
argument_list|(
name|DUP_PATH_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|DEL_PATH_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|STROKE_PATH_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_ADD_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_DEL_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_NEW_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_EDIT_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|PATH_TO_SEL_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/* update the clist to reflect this images bz list */
comment|/* go around the image list populating the clist */
if|if
condition|(
name|gimage
operator|!=
name|new_path_list
operator|->
name|gimage
condition|)
block|{
name|g_warning
argument_list|(
name|_
argument_list|(
literal|"paths list: internal list error"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|plist
operator|=
name|new_path_list
operator|->
name|bz_paths
expr_stmt|;
name|loop
operator|=
literal|0
expr_stmt|;
name|tmprow
operator|=
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
expr_stmt|;
while|while
condition|(
name|plist
condition|)
block|{
name|paths_update_paths
argument_list|(
name|plist
operator|->
name|data
argument_list|,
name|loop
argument_list|)
expr_stmt|;
name|loop
operator|++
expr_stmt|;
name|plist
operator|=
name|g_slist_next
argument_list|(
name|plist
argument_list|)
expr_stmt|;
block|}
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
operator|=
name|tmprow
expr_stmt|;
name|paths_dialog
operator|->
name|selected_row_num
operator|=
name|tmprow
expr_stmt|;
comment|/*   g_slist_foreach(plist,paths_update_paths,NULL); */
comment|/* select last one */
name|gtk_signal_handler_block
argument_list|(
name|GTK_OBJECT
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|selsigid
argument_list|)
expr_stmt|;
name|gtk_clist_select_row
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_handler_unblock
argument_list|(
name|GTK_OBJECT
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|selsigid
argument_list|)
expr_stmt|;
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
argument_list|,
literal|0
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_update_paths (gpointer data,gint row)
name|paths_update_paths
parameter_list|(
name|gpointer
name|data
parameter_list|,
name|gint
name|row
parameter_list|)
block|{
name|BZPATHP
name|bzp
decl_stmt|;
name|BezierSelect
modifier|*
name|bezier_sel
decl_stmt|;
name|paths_add_path
argument_list|(
operator|(
name|bzp
operator|=
operator|(
name|BZPATHP
operator|)
name|data
operator|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/* Now fudge the drawing....*/
name|bezier_sel
operator|=
name|bzpath_to_beziersel
argument_list|(
name|bzp
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
operator|=
name|row
expr_stmt|;
name|paths_update_preview
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
name|beziersel_free
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_rename_paths_callback (GtkWidget * widget,gpointer call_data,gpointer client_data)
name|do_rename_paths_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|call_data
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gchar
modifier|*
name|text
decl_stmt|;
name|GdkBitmap
modifier|*
name|mask
decl_stmt|;
name|guint8
name|spacing
decl_stmt|;
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|GTK_CLIST
argument_list|(
name|call_data
argument_list|)
operator|->
name|selection
operator|)
condition|)
return|return;
name|text
operator|=
name|g_strdup
argument_list|(
name|client_data
argument_list|)
expr_stmt|;
name|gtk_clist_get_pixtext
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|selected_row_num
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
operator|&
name|spacing
argument_list|,
operator|&
name|pixmap
argument_list|,
operator|&
name|mask
argument_list|)
expr_stmt|;
name|gtk_clist_set_pixtext
argument_list|(
name|GTK_CLIST
argument_list|(
name|call_data
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|selected_row_num
argument_list|,
literal|0
argument_list|,
name|text
argument_list|,
name|spacing
argument_list|,
name|pixmap
argument_list|,
name|mask
argument_list|)
expr_stmt|;
name|bz_change_name_row_to
argument_list|(
name|paths_dialog
operator|->
name|selected_row_num
argument_list|,
name|text
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_edit_path_query (GtkWidget * widget)
name|paths_dialog_edit_path_query
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|gchar
modifier|*
name|text
decl_stmt|;
name|gint
name|ret
decl_stmt|;
name|GdkBitmap
modifier|*
name|mask
decl_stmt|;
comment|/* Get the current name */
name|ret
operator|=
name|gtk_clist_get_pixtext
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|selected_row_num
argument_list|,
literal|0
argument_list|,
operator|&
name|text
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|mask
argument_list|)
expr_stmt|;
name|query_string_box
argument_list|(
name|N_
argument_list|(
literal|"Rename path"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"Enter a new name for the path"
argument_list|)
argument_list|,
name|text
argument_list|,
name|NULL
argument_list|,
name|do_rename_paths_callback
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|paths_list_events (GtkWidget * widget,GdkEvent * event)
name|paths_list_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventKey
modifier|*
name|kevent
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
specifier|static
name|gint
name|last_row
init|=
operator|-
literal|1
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
operator|!
name|gtk_clist_get_selection_info
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|bevent
operator|->
name|x
argument_list|,
name|bevent
operator|->
name|y
argument_list|,
operator|&
name|last_row
argument_list|,
name|NULL
argument_list|)
condition|)
name|last_row
operator|=
operator|-
literal|1
expr_stmt|;
else|else
block|{
if|if
condition|(
name|paths_dialog
operator|->
name|selected_row_num
operator|!=
name|last_row
condition|)
name|last_row
operator|=
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
operator|||
name|bevent
operator|->
name|button
operator|==
literal|2
condition|)
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|paths_dialog
operator|->
name|ops_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|bevent
operator|->
name|button
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_2BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|last_row
operator|!=
operator|-
literal|1
operator|&&
name|gtk_clist_get_selection_info
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|bevent
operator|->
name|x
argument_list|,
name|bevent
operator|->
name|y
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
condition|)
block|{
name|paths_dialog_edit_path_query
argument_list|(
name|widget
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
else|else
return|return
name|FALSE
return|;
case|case
name|GDK_KEY_PRESS
case|:
name|kevent
operator|=
operator|(
name|GdkEventKey
operator|*
operator|)
name|event
expr_stmt|;
switch|switch
condition|(
name|kevent
operator|->
name|keyval
condition|)
block|{
case|case
name|GDK_Up
case|:
name|printf
argument_list|(
literal|"up arrow\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_Down
case|:
name|printf
argument_list|(
literal|"down arrow\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|PATHIMAGELISTP
DECL|function|bzpath_add_to_current (PATHIMAGELISTP pip,BZPATHP bzp,GimpImage * gimage,gint pos)
name|bzpath_add_to_current
parameter_list|(
name|PATHIMAGELISTP
name|pip
parameter_list|,
name|BZPATHP
name|bzp
parameter_list|,
name|GimpImage
modifier|*
name|gimage
parameter_list|,
name|gint
name|pos
parameter_list|)
block|{
comment|/* add bzp to current list */
if|if
condition|(
operator|!
name|pip
condition|)
block|{
comment|/* This image does not have a list */
name|pip
operator|=
name|pathsList_new
argument_list|(
name|gimage
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* add to gimage */
name|gimp_image_set_paths
argument_list|(
name|gimage
argument_list|,
name|pip
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pos
operator|<
literal|0
condition|)
name|pip
operator|->
name|bz_paths
operator|=
name|g_slist_append
argument_list|(
name|pip
operator|->
name|bz_paths
argument_list|,
name|bzp
argument_list|)
expr_stmt|;
else|else
name|pip
operator|->
name|bz_paths
operator|=
name|g_slist_insert
argument_list|(
name|pip
operator|->
name|bz_paths
argument_list|,
name|bzp
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
name|pip
return|;
block|}
end_function

begin_function
specifier|static
name|BZPATHP
DECL|function|paths_dialog_new_path (PATHIMAGELISTP * plp,gpointer points,GimpImage * gimage,gint pos)
name|paths_dialog_new_path
parameter_list|(
name|PATHIMAGELISTP
modifier|*
name|plp
parameter_list|,
name|gpointer
name|points
parameter_list|,
name|GimpImage
modifier|*
name|gimage
parameter_list|,
name|gint
name|pos
parameter_list|)
block|{
specifier|static
name|gint
name|nseed
init|=
literal|0
decl_stmt|;
name|BZPATHP
name|bzp
init|=
name|bzpath_dialog_new
argument_list|(
name|nseed
operator|++
argument_list|,
name|points
argument_list|)
decl_stmt|;
operator|*
name|plp
operator|=
name|bzpath_add_to_current
argument_list|(
operator|*
name|plp
argument_list|,
name|bzp
argument_list|,
name|gimage
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|(
name|bzp
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_new_path_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_new_path_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|BZPATHP
name|bzp
init|=
name|paths_dialog_new_path
argument_list|(
operator|&
name|paths_dialog
operator|->
name|current_path_list
argument_list|,
name|NULL
argument_list|,
name|paths_dialog
operator|->
name|gimage
argument_list|,
name|paths_dialog
operator|->
name|selected_row_num
argument_list|)
decl_stmt|;
name|paths_add_path
argument_list|(
name|bzp
argument_list|,
name|paths_dialog
operator|->
name|selected_row_num
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_delete_path_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_delete_path_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|BZPATHP
name|bzp
decl_stmt|;
name|PATHIMAGELISTP
name|plp
decl_stmt|;
name|gboolean
name|new_sz
decl_stmt|;
name|gint
name|row
init|=
name|paths_dialog
operator|->
name|selected_row_num
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Get current selection... ignore if none */
if|if
condition|(
name|paths_dialog
operator|->
name|selected_row_num
operator|<
literal|0
condition|)
return|return;
comment|/* Get bzpath structure& delete its content */
name|plp
operator|=
name|paths_dialog
operator|->
name|current_path_list
expr_stmt|;
name|bzp
operator|=
operator|(
name|BZPATHP
operator|)
name|g_slist_nth_data
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|,
name|row
argument_list|)
expr_stmt|;
comment|/* Remove from list */
name|plp
operator|->
name|bz_paths
operator|=
name|g_slist_remove
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|,
name|bzp
argument_list|)
expr_stmt|;
name|new_sz
operator|=
operator|(
name|g_slist_length
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|)
operator|>
literal|0
operator|)
expr_stmt|;
name|bzpath_free
argument_list|(
name|bzp
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* If now empty free everything up */
if|if
condition|(
operator|!
name|plp
operator|->
name|bz_paths
operator|||
name|g_slist_length
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|)
operator|==
literal|0
condition|)
block|{
name|gtk_signal_disconnect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|plp
operator|->
name|gimage
argument_list|)
argument_list|,
name|plp
operator|->
name|sig_id
argument_list|)
expr_stmt|;
name|gimp_image_set_paths
argument_list|(
name|plp
operator|->
name|gimage
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|pathimagelist_free
argument_list|(
name|plp
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|current_path_list
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* Do this last since it might cause a new row to become selected */
comment|/* Remove from the clist ... */
name|gtk_clist_remove
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|DUP_PATH_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|DEL_PATH_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|STROKE_PATH_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_ADD_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_DEL_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_NEW_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_EDIT_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|PATH_TO_SEL_BUTTON
argument_list|,
name|new_sz
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_dup_path_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_dup_path_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|BZPATHP
name|bzp
decl_stmt|;
name|PATHIMAGELISTP
name|plp
decl_stmt|;
name|BezierSelect
modifier|*
name|bezier_sel
decl_stmt|;
name|gint
name|row
init|=
name|paths_dialog
operator|->
name|selected_row_num
decl_stmt|;
name|gint
name|tmprow
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Get current selection... ignore if none */
if|if
condition|(
name|paths_dialog
operator|->
name|selected_row_num
operator|<
literal|0
condition|)
return|return;
comment|/* Get bzpath structure  */
name|plp
operator|=
name|paths_dialog
operator|->
name|current_path_list
expr_stmt|;
name|bzp
operator|=
operator|(
name|BZPATHP
operator|)
name|g_slist_nth_data
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|,
name|row
argument_list|)
expr_stmt|;
comment|/* Insert at the current position */
name|bzp
operator|=
name|bzpath_copy
argument_list|(
name|bzp
argument_list|)
expr_stmt|;
name|plp
operator|->
name|bz_paths
operator|=
name|g_slist_insert
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|,
name|bzp
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|paths_add_path
argument_list|(
name|bzp
argument_list|,
name|row
argument_list|)
expr_stmt|;
comment|/* Now fudge the drawing....*/
name|bezier_sel
operator|=
name|bzpath_to_beziersel
argument_list|(
name|bzp
argument_list|)
expr_stmt|;
name|tmprow
operator|=
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
expr_stmt|;
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
operator|=
name|row
expr_stmt|;
name|paths_update_preview
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
name|beziersel_free
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
operator|=
name|tmprow
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_path_to_sel_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_path_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|BZPATHP
name|bzp
decl_stmt|;
name|PATHIMAGELISTP
name|plp
decl_stmt|;
name|BezierSelect
modifier|*
name|bezier_sel
decl_stmt|;
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|gint
name|row
init|=
name|paths_dialog
operator|->
name|selected_row_num
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Get current selection... ignore if none */
if|if
condition|(
name|paths_dialog
operator|->
name|selected_row_num
operator|<
literal|0
condition|)
return|return;
comment|/* Get bzpath structure  */
name|plp
operator|=
name|paths_dialog
operator|->
name|current_path_list
expr_stmt|;
name|bzp
operator|=
operator|(
name|BZPATHP
operator|)
name|g_slist_nth_data
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|,
name|row
argument_list|)
expr_stmt|;
comment|/* Now do the stroke....*/
name|gdisp
operator|=
name|gdisplays_check_valid
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|gdisp
argument_list|,
name|paths_dialog
operator|->
name|gimage
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bzp
operator|->
name|closed
condition|)
block|{
name|BZPATHP
name|bzpcopy
init|=
name|bzpath_copy
argument_list|(
name|bzp
argument_list|)
decl_stmt|;
comment|/* Close it */
name|bzpath_close
argument_list|(
name|bzpcopy
argument_list|)
expr_stmt|;
name|bezier_sel
operator|=
name|bzpath_to_beziersel
argument_list|(
name|bzpcopy
argument_list|)
expr_stmt|;
name|bzpath_free
argument_list|(
name|bzpcopy
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|bezier_to_selection
argument_list|(
name|bezier_sel
argument_list|,
name|gdisp
argument_list|)
expr_stmt|;
name|beziersel_free
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|bezier_sel
operator|=
name|bzpath_to_beziersel
argument_list|(
name|bzp
argument_list|)
expr_stmt|;
name|bezier_to_selection
argument_list|(
name|bezier_sel
argument_list|,
name|gdisp
argument_list|)
expr_stmt|;
name|beziersel_free
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_stroke_path_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_stroke_path_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|BZPATHP
name|bzp
decl_stmt|;
name|PATHIMAGELISTP
name|plp
decl_stmt|;
name|BezierSelect
modifier|*
name|bezier_sel
decl_stmt|;
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|gint
name|row
init|=
name|paths_dialog
operator|->
name|selected_row_num
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* Get current selection... ignore if none */
if|if
condition|(
name|paths_dialog
operator|->
name|selected_row_num
operator|<
literal|0
condition|)
return|return;
comment|/* Get bzpath structure  */
name|plp
operator|=
name|paths_dialog
operator|->
name|current_path_list
expr_stmt|;
name|bzp
operator|=
operator|(
name|BZPATHP
operator|)
name|g_slist_nth_data
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|,
name|row
argument_list|)
expr_stmt|;
comment|/* Now do the stroke....*/
name|gdisp
operator|=
name|gdisplays_check_valid
argument_list|(
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|gdisp
argument_list|,
name|paths_dialog
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|bezier_sel
operator|=
name|bzpath_to_beziersel
argument_list|(
name|bzp
argument_list|)
expr_stmt|;
name|bezier_stroke
argument_list|(
name|bezier_sel
argument_list|,
name|gdisp
argument_list|,
name|SUBDIVIDE
argument_list|,
operator|!
name|bzp
operator|->
name|closed
argument_list|)
expr_stmt|;
name|beziersel_free
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_map_callback (GtkWidget * w,gpointer client_data)
name|paths_dialog_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|paths_dialog
condition|)
return|return;
name|gtk_window_add_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|accel_group
argument_list|)
expr_stmt|;
name|paths_dialog_preview_extents
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_unmap_callback (GtkWidget * w,gpointer client_data)
name|paths_dialog_unmap_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|paths_dialog
condition|)
return|return;
name|gtk_window_remove_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
argument_list|,
name|paths_dialog
operator|->
name|accel_group
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_destroy_cb (GimpImage * gimage)
name|paths_dialog_destroy_cb
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|)
block|{
name|PATHIMAGELISTP
name|new_path_list
decl_stmt|;
if|if
condition|(
operator|!
name|paths_dialog
condition|)
return|return;
if|if
condition|(
name|paths_dialog
operator|->
name|current_path_list
operator|&&
name|gimage
operator|==
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|gimage
condition|)
block|{
comment|/* showing could be last so remove here.. might get  	 done again if not the last one       */
name|paths_dialog
operator|->
name|current_path_list
operator|=
name|NULL
expr_stmt|;
name|paths_dialog
operator|->
name|been_selected
operator|=
name|FALSE
expr_stmt|;
name|gtk_clist_freeze
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_clear
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_thaw
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* Find bz list */
name|new_path_list
operator|=
operator|(
name|PATHIMAGELISTP
operator|)
name|gimp_image_get_paths
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|new_path_list
condition|)
return|return;
comment|/* Already removed - signal handler jsut left in the air */
name|pathimagelist_free
argument_list|(
name|new_path_list
argument_list|)
expr_stmt|;
name|gimp_image_set_paths
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Functions used from the bezier code .. tie in with this code */
end_comment

begin_function
specifier|static
name|void
DECL|function|bzpoints_free (GSList * list)
name|bzpoints_free
parameter_list|(
name|GSList
modifier|*
name|list
parameter_list|)
block|{
if|if
condition|(
operator|!
name|list
condition|)
return|return;
name|g_slist_foreach
argument_list|(
name|list
argument_list|,
name|bzpoint_free
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GSList
modifier|*
DECL|function|bzpoints_create (BezierSelect * sel)
name|bzpoints_create
parameter_list|(
name|BezierSelect
modifier|*
name|sel
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|GSList
modifier|*
name|list
init|=
name|NULL
decl_stmt|;
name|BZPOINTP
name|bzpoint
decl_stmt|;
name|BezierPoint
modifier|*
name|pts
init|=
operator|(
name|BezierPoint
operator|*
operator|)
name|sel
operator|->
name|points
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|sel
operator|->
name|num_points
condition|;
name|i
operator|++
control|)
block|{
name|bzpoint
operator|=
name|bzpoint_new
argument_list|(
name|pts
operator|->
name|type
argument_list|,
name|pts
operator|->
name|x
argument_list|,
name|pts
operator|->
name|y
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_slist_append
argument_list|(
name|list
argument_list|,
name|bzpoint
argument_list|)
expr_stmt|;
name|pts
operator|=
name|pts
operator|->
name|next
expr_stmt|;
block|}
return|return
operator|(
name|list
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|GSList
modifier|*
DECL|function|bzpoints_copy (GSList * list)
name|bzpoints_copy
parameter_list|(
name|GSList
modifier|*
name|list
parameter_list|)
block|{
name|GSList
modifier|*
name|slcopy
init|=
name|NULL
decl_stmt|;
name|BZPOINTP
name|pdata
decl_stmt|;
name|BZPOINTP
name|bzpoint
decl_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|bzpoint
operator|=
name|g_new0
argument_list|(
name|BZPOINT
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pdata
operator|=
operator|(
name|BZPOINTP
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|bzpoint
operator|->
name|type
operator|=
name|pdata
operator|->
name|type
expr_stmt|;
name|bzpoint
operator|->
name|x
operator|=
name|pdata
operator|->
name|x
expr_stmt|;
name|bzpoint
operator|->
name|y
operator|=
name|pdata
operator|->
name|y
expr_stmt|;
name|slcopy
operator|=
name|g_slist_append
argument_list|(
name|slcopy
argument_list|,
name|bzpoint
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
return|return
name|slcopy
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_update_bzpath (PATHIMAGELISTP plp,BezierSelect * bezier_sel)
name|paths_update_bzpath
parameter_list|(
name|PATHIMAGELISTP
name|plp
parameter_list|,
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|)
block|{
name|BZPATHP
name|bzp
decl_stmt|;
name|bzp
operator|=
operator|(
name|BZPATHP
operator|)
name|g_slist_nth_data
argument_list|(
name|plp
operator|->
name|bz_paths
argument_list|,
name|plp
operator|->
name|last_selected_row
argument_list|)
expr_stmt|;
if|if
condition|(
name|bzp
operator|->
name|bezier_details
condition|)
name|bzpoints_free
argument_list|(
name|bzp
operator|->
name|bezier_details
argument_list|)
expr_stmt|;
name|bzp
operator|->
name|bezier_details
operator|=
name|bzpoints_create
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
name|bzp
operator|->
name|closed
operator|=
name|bezier_sel
operator|->
name|closed
expr_stmt|;
name|bzp
operator|->
name|state
operator|=
name|bezier_sel
operator|->
name|state
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|paths_replaced_current (PATHIMAGELISTP plp,BezierSelect * bezier_sel)
name|paths_replaced_current
parameter_list|(
name|PATHIMAGELISTP
name|plp
parameter_list|,
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|)
block|{
comment|/* Is there a currently selected path in this image? */
if|if
condition|(
name|paths_dialog
operator|&&
name|plp
operator|&&
name|plp
operator|->
name|last_selected_row
operator|>=
literal|0
condition|)
block|{
name|paths_update_bzpath
argument_list|(
name|plp
argument_list|,
name|bezier_sel
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_draw_segment_points (BezierSelect * bezier_sel,GdkPoint * pnt,int npoints)
name|paths_draw_segment_points
parameter_list|(
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|,
name|GdkPoint
modifier|*
name|pnt
parameter_list|,
name|int
name|npoints
parameter_list|)
block|{
comment|/*     * hopefully the image points are already in image space co-ords.    * so just scale by ratio factor and draw 'em    */
name|gint
name|loop
decl_stmt|;
name|gint
name|pcount
init|=
literal|0
decl_stmt|;
name|GdkPoint
modifier|*
name|copy_pnt
init|=
name|g_new
argument_list|(
name|GdkPoint
argument_list|,
name|npoints
argument_list|)
decl_stmt|;
name|GdkPoint
modifier|*
name|cur_pnt
init|=
name|copy_pnt
decl_stmt|;
name|GdkPoint
modifier|*
name|last_pnt
init|=
name|NULL
decl_stmt|;
name|PATHWIDGETP
name|pwidget
decl_stmt|;
name|gint
name|row
decl_stmt|;
comment|/* we could remove duplicate points here */
for|for
control|(
name|loop
operator|=
literal|0
init|;
name|loop
operator|<
name|npoints
condition|;
name|loop
operator|++
control|)
block|{
comment|/* The "2" is because we have a boarder */
name|cur_pnt
operator|->
name|x
operator|=
literal|2
operator|+
call|(
name|int
call|)
argument_list|(
name|paths_dialog
operator|->
name|ratio
operator|*
name|pnt
operator|->
name|x
argument_list|)
expr_stmt|;
name|cur_pnt
operator|->
name|y
operator|=
literal|2
operator|+
call|(
name|int
call|)
argument_list|(
name|paths_dialog
operator|->
name|ratio
operator|*
name|pnt
operator|->
name|y
argument_list|)
expr_stmt|;
name|pnt
operator|++
expr_stmt|;
if|if
condition|(
name|last_pnt
operator|&&
name|last_pnt
operator|->
name|x
operator|==
name|cur_pnt
operator|->
name|x
operator|&&
name|last_pnt
operator|->
name|y
operator|==
name|cur_pnt
operator|->
name|y
condition|)
block|{
comment|/* same as last ... don't need this one */
continue|continue;
block|}
comment|/*       printf("converting %d [%d,%d] => [%d,%d]\n", */
comment|/* 	     pcount,(int)pnt->x,(int)pnt->y,(int)cur_pnt->x,(int)cur_pnt->y); */
name|last_pnt
operator|=
name|cur_pnt
expr_stmt|;
name|pcount
operator|++
expr_stmt|;
name|cur_pnt
operator|++
expr_stmt|;
block|}
name|row
operator|=
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
expr_stmt|;
name|pwidget
operator|=
operator|(
name|PATHWIDGETP
operator|)
name|gtk_clist_get_row_data
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
if|if
condition|(
name|pcount
operator|==
literal|0
condition|)
return|return;
name|g_return_if_fail
argument_list|(
name|pwidget
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|paths_set_dash_line
argument_list|(
name|paths_dialog
operator|->
name|gc
argument_list|,
operator|!
name|bezier_sel
operator|->
name|closed
argument_list|)
expr_stmt|;
name|gdk_draw_lines
argument_list|(
name|pwidget
operator|->
name|paths_pixmap
argument_list|,
name|paths_dialog
operator|->
name|gc
argument_list|,
name|copy_pnt
argument_list|,
name|pcount
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|copy_pnt
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_update_preview (BezierSelect * bezier_sel)
name|paths_update_preview
parameter_list|(
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|)
block|{
name|gint
name|row
decl_stmt|;
if|if
condition|(
name|paths_dialog
operator|&&
name|paths_dialog
operator|->
name|current_path_list
operator|&&
operator|(
name|row
operator|=
name|paths_dialog
operator|->
name|current_path_list
operator|->
name|last_selected_row
operator|)
operator|>=
literal|0
operator|&&
name|preview_size
condition|)
block|{
name|PATHWIDGETP
name|pwidget
decl_stmt|;
name|pwidget
operator|=
operator|(
name|PATHWIDGETP
operator|)
name|gtk_clist_get_row_data
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
comment|/* Clear pixmap */
name|clear_pixmap_preview
argument_list|(
name|pwidget
argument_list|)
expr_stmt|;
comment|/* update .. */
name|bezier_draw_curve
argument_list|(
name|bezier_sel
argument_list|,
name|paths_draw_segment_points
argument_list|,
name|IMAGE_COORDS
argument_list|)
expr_stmt|;
comment|/* update the pixmap */
name|gtk_clist_set_pixtext
argument_list|(
name|GTK_CLIST
argument_list|(
name|paths_dialog
operator|->
name|paths_list
argument_list|)
argument_list|,
name|row
argument_list|,
literal|0
argument_list|,
name|pwidget
operator|->
name|bzp
operator|->
name|name
operator|->
name|str
argument_list|,
literal|2
argument_list|,
name|pwidget
operator|->
name|paths_pixmap
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_new_point_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_new_point_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|bezier_select_mode
argument_list|(
name|EXTEND_NEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_add_point_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_add_point_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|bezier_select_mode
argument_list|(
name|EXTEND_ADD
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_delete_point_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_delete_point_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|bezier_select_mode
argument_list|(
name|EXTEND_REMOVE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paths_dialog_edit_point_callback (GtkWidget * widget,gpointer udata)
name|paths_dialog_edit_point_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|udata
parameter_list|)
block|{
name|bezier_select_mode
argument_list|(
name|EXTEND_EDIT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|paths_first_button_press (BezierSelect * bezier_sel,GDisplay * gdisp)
name|paths_first_button_press
parameter_list|(
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|,
name|GDisplay
modifier|*
name|gdisp
parameter_list|)
block|{
comment|/* First time a button is pressed in this display */
comment|/* We have two choices here       Either:-      1) We already have a paths item in the list.          => In this case the new one replaces the current entry. We 	need a callback into the bezier code to free things up.      2) We don't have an entry.          => Create a new one and add this curve.       In either case we need to update the preview widget..       All this of course depends on the fact that gdisp is the same      as before.    */
name|BZPATHP
name|bzp
decl_stmt|;
name|PATHIMAGELISTP
name|plp
decl_stmt|;
if|if
condition|(
operator|!
name|paths_dialog
condition|)
return|return;
name|paths_dialog
operator|->
name|been_selected
operator|=
name|FALSE
expr_stmt|;
comment|/* Button not pressed in this image...    * find which one it was pressed in if any.    */
name|plp
operator|=
operator|(
name|PATHIMAGELISTP
operator|)
name|gimp_image_get_paths
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
expr_stmt|;
comment|/* Since beziers are part of the save format.. make the image dirty */
comment|/*   gimp_image_dirty(gdisp->gimage); */
if|if
condition|(
operator|!
name|paths_replaced_current
argument_list|(
name|plp
argument_list|,
name|bezier_sel
argument_list|)
condition|)
block|{
name|bzp
operator|=
name|paths_dialog_new_path
argument_list|(
operator|&
name|plp
argument_list|,
name|bzpoints_create
argument_list|(
name|bezier_sel
argument_list|)
argument_list|,
name|gdisp
operator|->
name|gimage
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|bzp
operator|->
name|closed
operator|=
name|bezier_sel
operator|->
name|closed
expr_stmt|;
name|bzp
operator|->
name|state
operator|=
name|bezier_sel
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|paths_dialog
operator|->
name|gimage
operator|==
name|gdisp
operator|->
name|gimage
condition|)
block|{
name|paths_dialog
operator|->
name|current_path_list
operator|=
name|plp
expr_stmt|;
name|paths_add_path
argument_list|(
name|bzp
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|paths_newpoint_current (BezierSelect * bezier_sel,GDisplay * gdisp)
name|paths_newpoint_current
parameter_list|(
name|BezierSelect
modifier|*
name|bezier_sel
parameter_list|,
name|GDisplay
modifier|*
name|gdisp
parameter_list|)
block|{
comment|/* Check if currently showing the paths we are updating */
if|if
condition|(
name|paths_dialog
operator|&&
name|gdisp
operator|->
name|gimage
operator|==
name|paths_dialog
operator|->
name|gimage
condition|)
block|{
comment|/* Enable the buttons!*/
name|paths_ops_button_set_sensitive
argument_list|(
name|DUP_PATH_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|DEL_PATH_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paths_ops_button_set_sensitive
argument_list|(
name|STROKE_PATH_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_NEW_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_DEL_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_ADD_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|POINT_EDIT_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|point_ops_button_set_sensitive
argument_list|(
name|PATH_TO_SEL_BUTTON
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|paths_update_preview
argument_list|(
name|bezier_sel
argument_list|)
expr_stmt|;
block|}
name|paths_first_button_press
argument_list|(
name|bezier_sel
argument_list|,
name|gdisp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|paths_new_bezier_select_tool ()
name|paths_new_bezier_select_tool
parameter_list|()
block|{
if|if
condition|(
name|paths_dialog
condition|)
name|paths_dialog
operator|->
name|been_selected
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_comment
comment|/**************************************************************/
end_comment

begin_comment
comment|/* Code to serialise the bezier curves.  * The curves will be saved out in XCF property format.  * The "save as XCF format" will prompt to save the curves away.  *  * Note the save should really used PDB function to get the  * curves etc. But I have yet to do those 8-)  */
end_comment

begin_comment
comment|/**************************************************************/
end_comment

begin_function
name|BZPOINTP
DECL|function|bzpoint_new (gint type,gint x,gint y)
name|bzpoint_new
parameter_list|(
name|gint
name|type
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|BZPOINTP
name|bzpoint
init|=
name|g_new0
argument_list|(
name|BZPOINT
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|bzpoint
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|bzpoint
operator|->
name|x
operator|=
name|x
expr_stmt|;
name|bzpoint
operator|->
name|y
operator|=
name|y
expr_stmt|;
return|return
operator|(
name|bzpoint
operator|)
return|;
block|}
end_function

begin_function
name|BZPATHP
DECL|function|bzpath_new (GSList * bezier_details,gint closed,gint state,gint locked,gchar * name)
name|bzpath_new
parameter_list|(
name|GSList
modifier|*
name|bezier_details
parameter_list|,
name|gint
name|closed
parameter_list|,
name|gint
name|state
parameter_list|,
name|gint
name|locked
parameter_list|,
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|BZPATHP
name|bzpath
init|=
name|g_new0
argument_list|(
name|BZPATH
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|bzpath
operator|->
name|bezier_details
operator|=
name|bezier_details
expr_stmt|;
name|bzpath
operator|->
name|closed
operator|=
name|closed
expr_stmt|;
name|bzpath
operator|->
name|state
operator|=
name|state
expr_stmt|;
name|bzpath
operator|->
name|locked
operator|=
name|locked
expr_stmt|;
name|bzpath
operator|->
name|name
operator|=
name|g_string_new
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|bzpath
return|;
block|}
end_function

begin_function
name|PathsList
modifier|*
DECL|function|pathsList_new (GimpImage * gimage,gint last_selected_row,GSList * bz_paths)
name|pathsList_new
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|,
name|gint
name|last_selected_row
parameter_list|,
name|GSList
modifier|*
name|bz_paths
parameter_list|)
block|{
name|PATHIMAGELISTP
name|pip
init|=
name|g_new0
argument_list|(
name|PATHIMAGELIST
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|pip
operator|->
name|gimage
operator|=
name|gimage
expr_stmt|;
name|pip
operator|->
name|last_selected_row
operator|=
name|last_selected_row
expr_stmt|;
comment|/* add connector to image delete/destroy */
name|pip
operator|->
name|sig_id
operator|=
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gimage
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|paths_dialog_destroy_cb
argument_list|)
argument_list|,
name|pip
argument_list|)
expr_stmt|;
name|pip
operator|->
name|bz_paths
operator|=
name|bz_paths
expr_stmt|;
return|return
operator|(
name|PathsList
operator|*
operator|)
name|pip
return|;
block|}
end_function

end_unit

