begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * Gradient editor module copyight (C) 1996-1997 Federico Mena Quintero  * federico@nuclecu.unam.mx  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURIGHTE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* Special thanks to:  *  * Luis Albarran (luis4@mindspring.com) - Nice UI suggestions  *  * Miguel de Icaza (miguel@nuclecu.unam.mx) - Pop-up menu suggestion  *  * Marcelo Malheiros (malheiro@dca.fee.unicamp.br) - many, many  * suggestions, nice gradient files  *  * Adam Moss (adam@uunet.pipex.com) - idea for the hint bar  *  * Everyone on #gimp - many suggestions  */
end_comment

begin_comment
comment|/* TODO:  *  * - Fix memory leaks: grad_free_gradient_editor() and any others  * which I may have missed.  *  * - Add all of Marcelo's neat suggestions:  *   - Hue rotate, saturation, brightness, contrast.  *  * - Better handling of bogus gradient files and inconsistent  *   segments.  Do not loop indefinitely in seg_get_segment_at() if  *   there is a missing segment between two others.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpcolor/gimpcolor.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpenv.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimplimits.h"
end_include

begin_include
include|#
directive|include
file|"core/core-types.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpcontainer.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpcontext.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdatafactory.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpgradient.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpdnd.h"
end_include

begin_include
include|#
directive|include
file|"color-notebook.h"
end_include

begin_include
include|#
directive|include
file|"gradient-editor.h"
end_include

begin_include
include|#
directive|include
file|"context_manager.h"
end_include

begin_include
include|#
directive|include
file|"cursorutil.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_include
include|#
directive|include
file|"pixmaps/zoom_in.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/zoom_out.xpm"
end_include

begin_define
DECL|macro|EPSILON
define|#
directive|define
name|EPSILON
value|1e-10
end_define

begin_define
DECL|macro|GRAD_SCROLLBAR_STEP_SIZE
define|#
directive|define
name|GRAD_SCROLLBAR_STEP_SIZE
value|0.05
end_define

begin_define
DECL|macro|GRAD_SCROLLBAR_PAGE_SIZE
define|#
directive|define
name|GRAD_SCROLLBAR_PAGE_SIZE
value|0.75
end_define

begin_define
DECL|macro|GRAD_PREVIEW_WIDTH
define|#
directive|define
name|GRAD_PREVIEW_WIDTH
value|600
end_define

begin_define
DECL|macro|GRAD_PREVIEW_HEIGHT
define|#
directive|define
name|GRAD_PREVIEW_HEIGHT
value|64
end_define

begin_define
DECL|macro|GRAD_CONTROL_HEIGHT
define|#
directive|define
name|GRAD_CONTROL_HEIGHT
value|10
end_define

begin_define
DECL|macro|GRAD_COLOR_BOX_WIDTH
define|#
directive|define
name|GRAD_COLOR_BOX_WIDTH
value|24
end_define

begin_define
DECL|macro|GRAD_COLOR_BOX_HEIGHT
define|#
directive|define
name|GRAD_COLOR_BOX_HEIGHT
value|16
end_define

begin_define
DECL|macro|GRAD_NUM_COLORS
define|#
directive|define
name|GRAD_NUM_COLORS
value|10
end_define

begin_define
DECL|macro|GRAD_MOVE_TIME
define|#
directive|define
name|GRAD_MOVE_TIME
value|150
end_define

begin_comment
DECL|macro|GRAD_MOVE_TIME
comment|/* ms between mouse click and detection of movement in gradient control */
end_comment

begin_define
DECL|macro|GRAD_PREVIEW_EVENT_MASK
define|#
directive|define
name|GRAD_PREVIEW_EVENT_MASK
value|(GDK_EXPOSURE_MASK            | \                                  GDK_LEAVE_NOTIFY_MASK        | \ 				 GDK_POINTER_MOTION_MASK      | \                                  GDK_POINTER_MOTION_HINT_MASK | \ 				 GDK_BUTTON_PRESS_MASK        | \                                  GDK_BUTTON_RELEASE_MASK)
end_define

begin_define
DECL|macro|GRAD_CONTROL_EVENT_MASK
define|#
directive|define
name|GRAD_CONTROL_EVENT_MASK
value|(GDK_EXPOSURE_MASK            | \ 				 GDK_LEAVE_NOTIFY_MASK        | \ 				 GDK_POINTER_MOTION_MASK      | \ 				 GDK_POINTER_MOTION_HINT_MASK | \ 				 GDK_BUTTON_PRESS_MASK        | \ 				 GDK_BUTTON_RELEASE_MASK      | \ 				 GDK_BUTTON1_MOTION_MASK)
end_define

begin_enum
enum|enum
DECL|enum|__anon2b7475a20103
block|{
DECL|enumerator|GRAD_UPDATE_GRADIENT
name|GRAD_UPDATE_GRADIENT
init|=
literal|1
operator|<<
literal|0
block|,
DECL|enumerator|GRAD_UPDATE_PREVIEW
name|GRAD_UPDATE_PREVIEW
init|=
literal|1
operator|<<
literal|1
block|,
DECL|enumerator|GRAD_UPDATE_CONTROL
name|GRAD_UPDATE_CONTROL
init|=
literal|1
operator|<<
literal|2
block|,
DECL|enumerator|GRAD_RESET_CONTROL
name|GRAD_RESET_CONTROL
init|=
literal|1
operator|<<
literal|3
block|}
enum|;
end_enum

begin_comment
comment|/* Gradient editor type */
end_comment

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2b7475a20203
block|{
DECL|enumerator|GRAD_DRAG_NONE
name|GRAD_DRAG_NONE
init|=
literal|0
block|,
DECL|enumerator|GRAD_DRAG_LEFT
name|GRAD_DRAG_LEFT
block|,
DECL|enumerator|GRAD_DRAG_MIDDLE
name|GRAD_DRAG_MIDDLE
block|,
DECL|enumerator|GRAD_DRAG_ALL
name|GRAD_DRAG_ALL
DECL|typedef|control_drag_mode_t
block|}
name|control_drag_mode_t
typedef|;
end_typedef

begin_struct
DECL|struct|_GradientEditor
struct|struct
name|_GradientEditor
block|{
DECL|member|shell
name|GtkWidget
modifier|*
name|shell
decl_stmt|;
DECL|member|name
name|GtkWidget
modifier|*
name|name
decl_stmt|;
DECL|member|hint_label
name|GtkWidget
modifier|*
name|hint_label
decl_stmt|;
DECL|member|scrollbar
name|GtkWidget
modifier|*
name|scrollbar
decl_stmt|;
DECL|member|preview
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
DECL|member|control
name|GtkWidget
modifier|*
name|control
decl_stmt|;
DECL|member|context
name|GimpContext
modifier|*
name|context
decl_stmt|;
comment|/*  Zoom and scrollbar  */
DECL|member|zoom_factor
name|guint
name|zoom_factor
decl_stmt|;
DECL|member|scroll_data
name|GtkObject
modifier|*
name|scroll_data
decl_stmt|;
comment|/*  Instant update  */
DECL|member|instant_update
name|gboolean
name|instant_update
decl_stmt|;
comment|/*  Gradient preview  */
DECL|member|preview_rows
name|guchar
modifier|*
name|preview_rows
index|[
literal|2
index|]
decl_stmt|;
comment|/* For caching redraw info */
DECL|member|preview_last_x
name|gint
name|preview_last_x
decl_stmt|;
DECL|member|preview_button_down
name|gboolean
name|preview_button_down
decl_stmt|;
comment|/*  Gradient control  */
DECL|member|control_pixmap
name|GdkPixmap
modifier|*
name|control_pixmap
decl_stmt|;
DECL|member|control_drag_segment
name|GimpGradientSegment
modifier|*
name|control_drag_segment
decl_stmt|;
comment|/* Segment which is being dragged */
DECL|member|control_sel_l
name|GimpGradientSegment
modifier|*
name|control_sel_l
decl_stmt|;
comment|/* Left segment of selection */
DECL|member|control_sel_r
name|GimpGradientSegment
modifier|*
name|control_sel_r
decl_stmt|;
comment|/* Right segment of selection */
DECL|member|control_drag_mode
name|control_drag_mode_t
name|control_drag_mode
decl_stmt|;
comment|/* What is being dragged? */
DECL|member|control_click_time
name|guint32
name|control_click_time
decl_stmt|;
comment|/* Time when mouse was pressed */
DECL|member|control_compress
name|gboolean
name|control_compress
decl_stmt|;
comment|/* Compressing/expanding handles */
DECL|member|control_last_x
name|gint
name|control_last_x
decl_stmt|;
comment|/* Last mouse position when dragging */
DECL|member|control_last_gx
name|gdouble
name|control_last_gx
decl_stmt|;
comment|/* Last position (wrt gradient) when dragging */
DECL|member|control_orig_pos
name|gdouble
name|control_orig_pos
decl_stmt|;
comment|/* Original click position when dragging */
DECL|member|control_main_popup
name|GtkWidget
modifier|*
name|control_main_popup
decl_stmt|;
comment|/* Popup menu */
DECL|member|control_blending_label
name|GtkWidget
modifier|*
name|control_blending_label
decl_stmt|;
comment|/* Blending function label */
DECL|member|control_coloring_label
name|GtkWidget
modifier|*
name|control_coloring_label
decl_stmt|;
comment|/* Coloring type label */
DECL|member|control_split_m_label
name|GtkWidget
modifier|*
name|control_split_m_label
decl_stmt|;
comment|/* Split at midpoint label */
DECL|member|control_split_u_label
name|GtkWidget
modifier|*
name|control_split_u_label
decl_stmt|;
comment|/* Split uniformly label */
DECL|member|control_delete_menu_item
name|GtkWidget
modifier|*
name|control_delete_menu_item
decl_stmt|;
comment|/* Delete menu item */
DECL|member|control_delete_label
name|GtkWidget
modifier|*
name|control_delete_label
decl_stmt|;
comment|/* Delete label */
DECL|member|control_recenter_label
name|GtkWidget
modifier|*
name|control_recenter_label
decl_stmt|;
comment|/* Re-center label */
DECL|member|control_redistribute_label
name|GtkWidget
modifier|*
name|control_redistribute_label
decl_stmt|;
comment|/* Re-distribute label */
DECL|member|control_flip_label
name|GtkWidget
modifier|*
name|control_flip_label
decl_stmt|;
comment|/* Flip label */
DECL|member|control_replicate_label
name|GtkWidget
modifier|*
name|control_replicate_label
decl_stmt|;
comment|/* Replicate label */
DECL|member|control_blend_colors_menu_item
name|GtkWidget
modifier|*
name|control_blend_colors_menu_item
decl_stmt|;
comment|/* Blend colors menu item */
DECL|member|control_blend_opacity_menu_item
name|GtkWidget
modifier|*
name|control_blend_opacity_menu_item
decl_stmt|;
comment|/* Blend opacity menu item */
DECL|member|control_left_load_popup
name|GtkWidget
modifier|*
name|control_left_load_popup
decl_stmt|;
comment|/* Left endpoint load menu */
DECL|member|control_left_save_popup
name|GtkWidget
modifier|*
name|control_left_save_popup
decl_stmt|;
comment|/* Left endpoint save menu */
DECL|member|control_right_load_popup
name|GtkWidget
modifier|*
name|control_right_load_popup
decl_stmt|;
comment|/* Right endpoint load menu */
DECL|member|control_right_save_popup
name|GtkWidget
modifier|*
name|control_right_save_popup
decl_stmt|;
comment|/* Right endpoint save menu */
DECL|member|control_blending_popup
name|GtkWidget
modifier|*
name|control_blending_popup
decl_stmt|;
comment|/* Blending function menu */
DECL|member|control_coloring_popup
name|GtkWidget
modifier|*
name|control_coloring_popup
decl_stmt|;
comment|/* Coloring type menu */
DECL|member|control_sel_ops_popup
name|GtkWidget
modifier|*
name|control_sel_ops_popup
decl_stmt|;
comment|/* Selection ops menu */
DECL|member|accel_group
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
comment|/*  Blending and coloring menus  */
DECL|member|control_blending_items
name|GtkWidget
modifier|*
name|control_blending_items
index|[
literal|5
operator|+
literal|1
index|]
decl_stmt|;
comment|/* Add 1 for the "Varies" item */
DECL|member|control_coloring_items
name|GtkWidget
modifier|*
name|control_coloring_items
index|[
literal|3
operator|+
literal|1
index|]
decl_stmt|;
comment|/*  Split uniformly dialog  */
DECL|member|split_parts
name|gint
name|split_parts
decl_stmt|;
comment|/*  Replicate dialog  */
DECL|member|replicate_times
name|gint
name|replicate_times
decl_stmt|;
comment|/*  Saved colors  */
DECL|member|saved_colors
name|GimpRGB
name|saved_colors
index|[
name|GRAD_NUM_COLORS
index|]
decl_stmt|;
DECL|member|left_load_color_boxes
name|GtkWidget
modifier|*
name|left_load_color_boxes
index|[
name|GRAD_NUM_COLORS
operator|+
literal|3
index|]
decl_stmt|;
DECL|member|left_load_labels
name|GtkWidget
modifier|*
name|left_load_labels
index|[
name|GRAD_NUM_COLORS
operator|+
literal|3
index|]
decl_stmt|;
DECL|member|left_save_color_boxes
name|GtkWidget
modifier|*
name|left_save_color_boxes
index|[
name|GRAD_NUM_COLORS
index|]
decl_stmt|;
DECL|member|left_save_labels
name|GtkWidget
modifier|*
name|left_save_labels
index|[
name|GRAD_NUM_COLORS
index|]
decl_stmt|;
DECL|member|right_load_color_boxes
name|GtkWidget
modifier|*
name|right_load_color_boxes
index|[
name|GRAD_NUM_COLORS
operator|+
literal|3
index|]
decl_stmt|;
DECL|member|right_load_labels
name|GtkWidget
modifier|*
name|right_load_labels
index|[
name|GRAD_NUM_COLORS
operator|+
literal|3
index|]
decl_stmt|;
DECL|member|right_save_color_boxes
name|GtkWidget
modifier|*
name|right_save_color_boxes
index|[
name|GRAD_NUM_COLORS
index|]
decl_stmt|;
DECL|member|right_save_labels
name|GtkWidget
modifier|*
name|right_save_labels
index|[
name|GRAD_NUM_COLORS
index|]
decl_stmt|;
comment|/*  Color dialogs  */
DECL|member|left_color_preview
name|GtkWidget
modifier|*
name|left_color_preview
decl_stmt|;
DECL|member|left_saved_segments
name|GimpGradientSegment
modifier|*
name|left_saved_segments
decl_stmt|;
DECL|member|left_saved_dirty
name|gboolean
name|left_saved_dirty
decl_stmt|;
DECL|member|right_color_preview
name|GtkWidget
modifier|*
name|right_color_preview
decl_stmt|;
DECL|member|right_saved_segments
name|GimpGradientSegment
modifier|*
name|right_saved_segments
decl_stmt|;
DECL|member|right_saved_dirty
name|gboolean
name|right_saved_dirty
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/***** Local functions *****/
end_comment

begin_function_decl
specifier|static
name|void
name|gradient_editor_name_activate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_editor_name_focus_out
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_editor_drop_gradient
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpViewable
modifier|*
name|viewable
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_editor_gradient_changed
parameter_list|(
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Gradient editor functions */
end_comment

begin_function_decl
specifier|static
name|void
name|ed_update_editor
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_set_hint
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gchar
modifier|*
name|str
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_initialize_saved_colors
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Main dialog button callbacks& functions */
end_comment

begin_function_decl
specifier|static
name|void
name|ed_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_do_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_cancel_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|ed_delete_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Zoom, scrollbar& instant update callbacks */
end_comment

begin_function_decl
specifier|static
name|void
name|ed_scrollbar_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_zoom_all_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_zoom_out_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_zoom_in_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_instant_update_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Gradient preview functions */
end_comment

begin_function_decl
specifier|static
name|gint
name|preview_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|preview_set_hint
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|preview_set_foreground
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|preview_set_background
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|preview_update
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gboolean
name|recalculate
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|preview_fill_image
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|gdouble
name|left
parameter_list|,
name|gdouble
name|right
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Gradient control functions */
end_comment

begin_function_decl
specifier|static
name|gint
name|control_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_do_hint
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_button_press
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|button
parameter_list|,
name|guint
name|state
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|control_point_in_handle
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|GimpGradientSegment
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_select_single_segment
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|seg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_extend_selection
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|seg
parameter_list|,
name|gdouble
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_motion
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|gint
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_compress_left
parameter_list|(
name|GimpGradientSegment
modifier|*
name|range_l
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_r
parameter_list|,
name|GimpGradientSegment
modifier|*
name|drag_seg
parameter_list|,
name|gdouble
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_compress_range
parameter_list|(
name|GimpGradientSegment
modifier|*
name|range_l
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_r
parameter_list|,
name|gdouble
name|new_l
parameter_list|,
name|gdouble
name|new_r
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|control_move
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_l
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_r
parameter_list|,
name|gdouble
name|delta
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Control update/redraw functions */
end_comment

begin_function_decl
specifier|static
name|void
name|control_update
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|gboolean
name|recalculate
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|gdouble
name|left
parameter_list|,
name|gdouble
name|right
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw_normal_handle
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|gdouble
name|pos
parameter_list|,
name|gint
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw_middle_handle
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|gdouble
name|pos
parameter_list|,
name|gint
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|GdkGC
modifier|*
name|border_gc
parameter_list|,
name|GdkGC
modifier|*
name|fill_gc
parameter_list|,
name|gint
name|xpos
parameter_list|,
name|gint
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|control_calc_p_pos
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gdouble
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gdouble
name|control_calc_g_pos
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Control popup functions */
end_comment

begin_function_decl
specifier|static
name|void
name|cpopup_create_main_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_do_popup
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_color_item
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_box
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_menu_item_with_label
parameter_list|(
name|gchar
modifier|*
name|str
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_adjust_menus
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_adjust_blending_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_adjust_coloring_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_check_selection_params
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
modifier|*
name|equal_blending
parameter_list|,
name|gint
modifier|*
name|equal_coloring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_render_color_box
parameter_list|(
name|GtkPreview
modifier|*
name|preview
parameter_list|,
name|GimpRGB
modifier|*
name|color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_load_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|gchar
modifier|*
name|label1
parameter_list|,
name|gchar
modifier|*
name|label2
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|,
name|gchar
name|accel_key_0
parameter_list|,
name|guint8
name|accel_mods_0
parameter_list|,
name|gchar
name|accel_key_1
parameter_list|,
name|guint8
name|accel_mods_1
parameter_list|,
name|gchar
name|accel_key_2
parameter_list|,
name|guint8
name|accel_mods_2
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_save_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_update_saved_color
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|n
parameter_list|,
name|GimpRGB
modifier|*
name|color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_load_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_save_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_load_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_save_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpGradientSegment
modifier|*
name|cpopup_save_selection
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replace_selection
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|replace_seg
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* ----- */
end_comment

begin_function_decl
specifier|static
name|void
name|cpopup_set_left_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_set_right_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_left_color_changed
parameter_list|(
name|ColorNotebook
modifier|*
name|cnb
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|,
name|ColorNotebookState
name|state
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_right_color_changed
parameter_list|(
name|ColorNotebook
modifier|*
name|cnb
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|,
name|ColorNotebookState
name|state
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* ----- */
end_comment

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_blending_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_blending_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_coloring_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_coloring_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* ----- */
end_comment

begin_function_decl
specifier|static
name|void
name|cpopup_split_midpoint_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_midpoint
parameter_list|(
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GimpGradientSegment
modifier|*
name|lseg
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newl
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_split_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform
parameter_list|(
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GimpGradientSegment
modifier|*
name|lseg
parameter_list|,
name|gint
name|parts
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newl
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_recenter_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_redistribute_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Control popup -> Selection operations functions */
end_comment

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_sel_ops_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_flip_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replicate_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_do_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replicate_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_blend_colors
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_blend_opacity
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Blend function */
end_comment

begin_function_decl
specifier|static
name|void
name|cpopup_blend_endpoints
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpRGB
modifier|*
name|left
parameter_list|,
name|GimpRGB
modifier|*
name|right
parameter_list|,
name|gint
name|blend_colors
parameter_list|,
name|gint
name|blend_opacity
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Segment functions */
end_comment

begin_function_decl
specifier|static
name|void
name|seg_get_closest_handle
parameter_list|(
name|GimpGradient
modifier|*
name|grad
parameter_list|,
name|gdouble
name|pos
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
modifier|*
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/***** Public gradient editor functions *****/
end_comment

begin_function
name|GradientEditor
modifier|*
DECL|function|gradient_editor_new (void)
name|gradient_editor_new
parameter_list|(
name|void
parameter_list|)
block|{
name|GradientEditor
modifier|*
name|gradient_editor
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox2
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gradient_editor
operator|=
name|g_new
argument_list|(
name|GradientEditor
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|context
operator|=
name|gimp_context_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
argument_list|,
literal|"gradient_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gradient_editor_gradient_changed
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/* Shell and main vbox */
name|gradient_editor
operator|->
name|shell
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Gradient Editor"
argument_list|)
argument_list|,
literal|"gradient_editor"
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"dialogs/gradient_editor/gradient_editor.html"
argument_list|,
name|GTK_WIN_POS_NONE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|"_delete_event_"
argument_list|,
name|ed_close_callback
argument_list|,
name|gradient_editor
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|main_vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Gradient's name */
name|gradient_editor
operator|->
name|name
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|name
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|name
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|name
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gradient_editor_name_activate
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|name
argument_list|)
argument_list|,
literal|"focus_out_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gradient_editor_name_focus_out
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/* Frame for gradient preview and gradient control */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox2
argument_list|)
expr_stmt|;
comment|/* Gradient preview */
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|preview_last_x
operator|=
literal|0
expr_stmt|;
name|gradient_editor
operator|->
name|preview_button_down
operator|=
name|FALSE
expr_stmt|;
name|gradient_editor
operator|->
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_set_dither
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|GDK_RGB_DITHER_MAX
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|GRAD_PREVIEW_WIDTH
argument_list|,
name|GRAD_PREVIEW_HEIGHT
argument_list|)
expr_stmt|;
comment|/*  Enable auto-resizing of the preview but ensure a minimal size  */
name|gtk_widget_set_usize
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|,
name|GRAD_PREVIEW_WIDTH
argument_list|,
name|GRAD_PREVIEW_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_preview_set_expand
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|,
name|GRAD_PREVIEW_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
argument_list|,
literal|"event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|preview_events
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gimp_gtk_drag_dest_set_by_type
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|,
name|GTK_DEST_DEFAULT_ALL
argument_list|,
name|GIMP_TYPE_GRADIENT
argument_list|,
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gimp_dnd_viewable_dest_set
argument_list|(
name|GTK_WIDGET
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|GIMP_TYPE_GRADIENT
argument_list|,
name|gradient_editor_drop_gradient
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox2
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|preview
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
expr_stmt|;
comment|/* Gradient control */
name|gradient_editor
operator|->
name|control_pixmap
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_drag_segment
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_NONE
expr_stmt|;
name|gradient_editor
operator|->
name|control_click_time
operator|=
literal|0
expr_stmt|;
name|gradient_editor
operator|->
name|control_compress
operator|=
name|FALSE
expr_stmt|;
name|gradient_editor
operator|->
name|control_last_x
operator|=
literal|0
expr_stmt|;
name|gradient_editor
operator|->
name|control_last_gx
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|control_orig_pos
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|control_main_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_blending_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_coloring_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_split_m_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_split_u_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_delete_menu_item
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_delete_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_recenter_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_redistribute_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_flip_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_replicate_label
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_blend_colors_menu_item
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_blend_opacity_menu_item
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_left_load_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_left_save_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_right_load_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_right_save_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_blending_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_coloring_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_ops_popup
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|accel_group
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
literal|0
index|]
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
literal|0
index|]
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|control
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|)
argument_list|,
name|GRAD_PREVIEW_WIDTH
argument_list|,
name|GRAD_CONTROL_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|,
name|GRAD_CONTROL_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|)
argument_list|,
literal|"event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|control_events
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox2
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|)
expr_stmt|;
comment|/*  Scrollbar  */
name|gradient_editor
operator|->
name|zoom_factor
operator|=
literal|1
expr_stmt|;
name|gradient_editor
operator|->
name|scroll_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
argument_list|,
literal|1.0
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_scrollbar_update
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|,
literal|"changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_scrollbar_update
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|scrollbar
operator|=
name|gtk_hscrollbar_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|gradient_editor
operator|->
name|scrollbar
argument_list|)
argument_list|,
name|GTK_UPDATE_CONTINUOUS
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|scrollbar
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|scrollbar
argument_list|)
expr_stmt|;
comment|/*  Horizontal box for name, zoom controls and instant update toggle  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/* Save as POV-Ray button */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Save as POV-Ray"
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|NULL
argument_list|,
literal|"dialogs/gradient_editor/save_as_povray.html"
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|button
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_RECEIVES_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_save_pov_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/*  + and - buttons  */
name|gtk_widget_realize
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_pixmap_button_new
argument_list|(
name|zoom_out_xpm
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_RECEIVES_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_zoom_out_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_pixmap_button_new
argument_list|(
name|zoom_in_xpm
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_RECEIVES_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_zoom_in_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/*  Zoom all button */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Zoom all"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|button
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_RECEIVES_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_zoom_all_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/* Instant update toggle */
name|gradient_editor
operator|->
name|instant_update
operator|=
name|TRUE
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Instant update"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_instant_update_update
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/* Hint bar */
name|hbox
operator|=
name|GTK_DIALOG
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
operator|->
name|action_area
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_set_homogeneous
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|hint_label
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|gradient_editor
operator|->
name|hint_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|hint_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|hint_label
argument_list|)
expr_stmt|;
comment|/* Initialize other data */
name|gradient_editor
operator|->
name|left_color_preview
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|left_saved_segments
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|left_saved_dirty
operator|=
name|FALSE
expr_stmt|;
name|gradient_editor
operator|->
name|right_color_preview
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|right_saved_segments
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|right_saved_dirty
operator|=
name|FALSE
expr_stmt|;
name|ed_initialize_saved_colors
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|cpopup_create_main_menu
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_container_num_children
argument_list|(
name|global_gradient_factory
operator|->
name|container
argument_list|)
condition|)
block|{
name|gimp_context_set_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|,
name|GIMP_GRADIENT
argument_list|(
name|gimp_container_get_child_by_index
argument_list|(
name|global_gradient_factory
operator|->
name|container
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gradient
operator|=
name|GIMP_GRADIENT
argument_list|(
name|gimp_gradient_new
argument_list|(
name|_
argument_list|(
literal|"Default"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_container_add
argument_list|(
name|global_gradient_factory
operator|->
name|container
argument_list|,
name|GIMP_OBJECT
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
return|return
name|gradient_editor
return|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_editor_set_gradient (GradientEditor * gradient_editor,GimpGradient * gradient)
name|gradient_editor_set_gradient
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|gradient_editor
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_container_have
argument_list|(
name|global_gradient_factory
operator|->
name|container
argument_list|,
name|GIMP_OBJECT
argument_list|(
name|gradient
argument_list|)
argument_list|)
condition|)
block|{
name|gimp_context_set_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|,
name|gradient
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|GTK_WIDGET_VISIBLE
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
condition|)
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
else|else
name|gdk_window_raise
argument_list|(
name|gradient_editor
operator|->
name|shell
operator|->
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gradient_editor_free (GradientEditor * gradient_editor)
name|gradient_editor_free
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|gradient_editor
operator|!=
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  private functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gradient_editor_name_activate (GtkWidget * widget,GradientEditor * gradient_editor)
name|gradient_editor_name_activate
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gchar
modifier|*
name|entry_text
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|entry_text
operator|=
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_object_set_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|gradient
argument_list|)
argument_list|,
name|entry_text
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_editor_name_focus_out (GtkWidget * widget,GdkEvent * event,GradientEditor * gradient_editor)
name|gradient_editor_name_focus_out
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gradient_editor_name_activate
argument_list|(
name|widget
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_editor_drop_gradient (GtkWidget * widget,GimpViewable * viewable,gpointer data)
name|gradient_editor_drop_gradient
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpViewable
modifier|*
name|viewable
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GradientEditor
modifier|*
name|gradient_editor
decl_stmt|;
name|gradient_editor
operator|=
operator|(
name|GradientEditor
operator|*
operator|)
name|data
expr_stmt|;
name|gradient_editor_set_gradient
argument_list|(
name|gradient_editor
argument_list|,
name|GIMP_GRADIENT
argument_list|(
name|viewable
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_editor_gradient_changed (GimpContext * context,GimpGradient * gradient,GradientEditor * gradient_editor)
name|gradient_editor_gradient_changed
parameter_list|(
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|gradient_editor
operator|->
name|name
argument_list|)
argument_list|,
name|gimp_object_get_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|gradient
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_RESET_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_update_editor (GradientEditor * gradient_editor,gint flags)
name|ed_update_editor
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|flags
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|GRAD_UPDATE_GRADIENT
condition|)
block|{
name|preview_update
argument_list|(
name|gradient_editor
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|flags
operator|&
name|GRAD_UPDATE_PREVIEW
condition|)
name|preview_update
argument_list|(
name|gradient_editor
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|GRAD_UPDATE_CONTROL
condition|)
name|control_update
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|GRAD_RESET_CONTROL
condition|)
name|control_update
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_set_hint (GradientEditor * gradient_editor,gchar * str)
name|ed_set_hint
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gchar
modifier|*
name|str
parameter_list|)
block|{
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|hint_label
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_initialize_saved_colors (GradientEditor * gradient_editor)
name|ed_initialize_saved_colors
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|GRAD_NUM_COLORS
operator|+
literal|3
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|gradient_editor
operator|->
name|left_load_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|left_load_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|right_load_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|right_load_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRAD_NUM_COLORS
condition|;
name|i
operator|++
control|)
block|{
name|gradient_editor
operator|->
name|left_save_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|left_save_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|right_save_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|gradient_editor
operator|->
name|right_save_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
block|}
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Black */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|r
operator|=
literal|0.5
expr_stmt|;
comment|/* 50% Gray */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|g
operator|=
literal|0.5
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|b
operator|=
literal|0.5
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* White */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Clear */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|a
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* Red */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* Yellow */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Green */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Cyan */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Blue */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* Magenta */
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Main gradient editor dialog callbacks *****/
end_comment

begin_comment
comment|/***** The "save as pov" dialog functions *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_save_pov_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GtkWidget
modifier|*
name|window
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gradient
condition|)
return|return;
name|window
operator|=
name|gtk_file_selection_new
argument_list|(
name|_
argument_list|(
literal|"Save as POV-Ray"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"save_gradient"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|window
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|window
argument_list|)
operator|->
name|button_area
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|window
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_do_save_pov_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|window
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_cancel_save_pov_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|window
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_delete_save_pov_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/*  Connect the "F1" help key  */
name|gimp_help_connect_help_accel
argument_list|(
name|window
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"dialogs/gradient_editor/save_as_povray.html"
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_do_save_pov_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_do_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|FILE
modifier|*
name|file
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gradient
condition|)
return|return;
name|filename
operator|=
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|file
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"wb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
block|{
name|g_message
argument_list|(
literal|"Could not open \"%s\""
argument_list|,
name|filename
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"/* color_map file created by the GIMP */\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"/* http://www.gimp.org/               */\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"color_map {\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|seg
operator|=
name|gradient
operator|->
name|segments
init|;
name|seg
condition|;
name|seg
operator|=
name|seg
operator|->
name|next
control|)
block|{
comment|/* Left */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\t[%f color rgbt<%f, %f, %f, %f>]\n"
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|seg
operator|->
name|left_color
operator|.
name|r
argument_list|,
name|seg
operator|->
name|left_color
operator|.
name|g
argument_list|,
name|seg
operator|->
name|left_color
operator|.
name|b
argument_list|,
literal|1.0
operator|-
name|seg
operator|->
name|left_color
operator|.
name|a
argument_list|)
expr_stmt|;
comment|/* Middle */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\t[%f color rgbt<%f, %f, %f, %f>]\n"
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
operator|(
name|seg
operator|->
name|left_color
operator|.
name|r
operator|+
name|seg
operator|->
name|right_color
operator|.
name|r
operator|)
operator|/
literal|2.0
argument_list|,
operator|(
name|seg
operator|->
name|left_color
operator|.
name|g
operator|+
name|seg
operator|->
name|right_color
operator|.
name|g
operator|)
operator|/
literal|2.0
argument_list|,
operator|(
name|seg
operator|->
name|left_color
operator|.
name|b
operator|+
name|seg
operator|->
name|right_color
operator|.
name|b
operator|)
operator|/
literal|2.0
argument_list|,
literal|1.0
operator|-
operator|(
name|seg
operator|->
name|left_color
operator|.
name|a
operator|+
name|seg
operator|->
name|right_color
operator|.
name|a
operator|)
operator|/
literal|2.0
argument_list|)
expr_stmt|;
comment|/* Right */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\t[%f color rgbt<%f, %f, %f, %f>]\n"
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|seg
operator|->
name|right_color
operator|.
name|r
argument_list|,
name|seg
operator|->
name|right_color
operator|.
name|g
argument_list|,
name|seg
operator|->
name|right_color
operator|.
name|b
argument_list|,
literal|1.0
operator|-
name|seg
operator|->
name|right_color
operator|.
name|a
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"} /* color_map */\n"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|file
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_cancel_save_pov_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_cancel_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|ed_delete_save_pov_callback (GtkWidget * widget,GdkEvent * event,GradientEditor * gradient_editor)
name|ed_delete_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|ed_cancel_save_pov_callback
argument_list|(
name|widget
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/***** The main dialog action area button callbacks *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_close_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Zoom, scrollbar& instant update callbacks *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_scrollbar_update (GtkAdjustment * adjustment,GradientEditor * gradient_editor)
name|ed_scrollbar_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gchar
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Zoom factor: %d:1    Displaying [%0.6f, %0.6f]"
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|zoom_factor
argument_list|,
name|adjustment
operator|->
name|value
argument_list|,
name|adjustment
operator|->
name|value
operator|+
name|adjustment
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_zoom_all_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_zoom_all_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|zoom_factor
operator|=
literal|1
expr_stmt|;
name|adjustment
operator|->
name|value
operator|=
literal|0.0
expr_stmt|;
name|adjustment
operator|->
name|page_size
operator|=
literal|1.0
expr_stmt|;
name|adjustment
operator|->
name|step_increment
operator|=
literal|1.0
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
expr_stmt|;
name|adjustment
operator|->
name|page_increment
operator|=
literal|1.0
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
expr_stmt|;
name|gtk_adjustment_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_zoom_out_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_zoom_out_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|gdouble
name|old_value
decl_stmt|;
name|gdouble
name|value
decl_stmt|;
name|gdouble
name|old_page_size
decl_stmt|;
name|gdouble
name|page_size
decl_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|zoom_factor
operator|<=
literal|1
condition|)
return|return;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|old_value
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
name|old_page_size
operator|=
name|adjustment
operator|->
name|page_size
expr_stmt|;
name|gradient_editor
operator|->
name|zoom_factor
operator|--
expr_stmt|;
name|page_size
operator|=
literal|1.0
operator|/
name|gradient_editor
operator|->
name|zoom_factor
expr_stmt|;
name|value
operator|=
name|old_value
operator|-
operator|(
name|page_size
operator|-
name|old_page_size
operator|)
operator|/
literal|2.0
expr_stmt|;
if|if
condition|(
name|value
operator|<
literal|0.0
condition|)
name|value
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|value
operator|+
name|page_size
operator|)
operator|>
literal|1.0
condition|)
name|value
operator|=
literal|1.0
operator|-
name|page_size
expr_stmt|;
name|adjustment
operator|->
name|value
operator|=
name|value
expr_stmt|;
name|adjustment
operator|->
name|page_size
operator|=
name|page_size
expr_stmt|;
name|adjustment
operator|->
name|step_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
expr_stmt|;
name|adjustment
operator|->
name|page_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
expr_stmt|;
name|gtk_adjustment_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_zoom_in_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_zoom_in_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|gdouble
name|old_value
decl_stmt|;
name|gdouble
name|old_page_size
decl_stmt|;
name|gdouble
name|page_size
decl_stmt|;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|old_value
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
name|old_page_size
operator|=
name|adjustment
operator|->
name|page_size
expr_stmt|;
name|gradient_editor
operator|->
name|zoom_factor
operator|++
expr_stmt|;
name|page_size
operator|=
literal|1.0
operator|/
name|gradient_editor
operator|->
name|zoom_factor
expr_stmt|;
name|adjustment
operator|->
name|value
operator|=
name|old_value
operator|+
operator|(
name|old_page_size
operator|-
name|page_size
operator|)
operator|/
literal|2.0
expr_stmt|;
name|adjustment
operator|->
name|page_size
operator|=
name|page_size
expr_stmt|;
name|adjustment
operator|->
name|step_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
expr_stmt|;
name|adjustment
operator|->
name|page_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
expr_stmt|;
name|gtk_adjustment_changed
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|ed_instant_update_update (GtkWidget * widget,GradientEditor * gradient_editor)
name|ed_instant_update_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|gradient_editor
operator|->
name|instant_update
operator|=
name|TRUE
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|gradient_editor
operator|->
name|scrollbar
argument_list|)
argument_list|,
name|GTK_UPDATE_CONTINUOUS
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gradient_editor
operator|->
name|instant_update
operator|=
name|FALSE
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|gradient_editor
operator|->
name|scrollbar
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/***** Gradient preview functions *****/
end_comment

begin_function
specifier|static
name|gint
DECL|function|preview_events (GtkWidget * widget,GdkEvent * event,GradientEditor * gradient_editor)
name|preview_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|GdkEventMotion
modifier|*
name|mevent
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|preview_update
argument_list|(
name|gradient_editor
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_LEAVE_NOTIFY
case|:
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_MOTION_NOTIFY
case|:
name|gtk_widget_get_pointer
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|mevent
operator|=
operator|(
name|GdkEventMotion
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|x
operator|!=
name|gradient_editor
operator|->
name|preview_last_x
condition|)
block|{
name|gradient_editor
operator|->
name|preview_last_x
operator|=
name|x
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|preview_button_down
condition|)
block|{
if|if
condition|(
name|mevent
operator|->
name|state
operator|&
name|GDK_CONTROL_MASK
condition|)
name|preview_set_background
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
else|else
name|preview_set_foreground
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|preview_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
name|gtk_widget_get_pointer
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
switch|switch
condition|(
name|bevent
operator|->
name|button
condition|)
block|{
case|case
literal|1
case|:
name|gradient_editor
operator|->
name|preview_last_x
operator|=
name|x
expr_stmt|;
name|gradient_editor
operator|->
name|preview_button_down
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_CONTROL_MASK
condition|)
name|preview_set_background
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
else|else
name|preview_set_foreground
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|cpopup_do_popup
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
break|break;
comment|/*  wheelmouse support  */
case|case
literal|4
case|:
block|{
name|GtkAdjustment
modifier|*
name|adj
init|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
decl_stmt|;
name|gfloat
name|new_value
init|=
name|adj
operator|->
name|value
operator|-
name|adj
operator|->
name|page_increment
operator|/
literal|2
decl_stmt|;
name|new_value
operator|=
name|CLAMP
argument_list|(
name|new_value
argument_list|,
name|adj
operator|->
name|lower
argument_list|,
name|adj
operator|->
name|upper
operator|-
name|adj
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adj
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|5
case|:
block|{
name|GtkAdjustment
modifier|*
name|adj
init|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
decl_stmt|;
name|gfloat
name|new_value
init|=
name|adj
operator|->
name|value
operator|+
name|adj
operator|->
name|page_increment
operator|/
literal|2
decl_stmt|;
name|new_value
operator|=
name|CLAMP
argument_list|(
name|new_value
argument_list|,
name|adj
operator|->
name|lower
argument_list|,
name|adj
operator|->
name|upper
operator|-
name|adj
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adj
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
if|if
condition|(
name|gradient_editor
operator|->
name|preview_button_down
condition|)
block|{
name|gtk_widget_get_pointer
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
name|gradient_editor
operator|->
name|preview_last_x
operator|=
name|x
expr_stmt|;
name|gradient_editor
operator|->
name|preview_button_down
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_CONTROL_MASK
condition|)
name|preview_set_background
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
else|else
name|preview_set_foreground
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
break|break;
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_set_hint (GradientEditor * gradient_editor,gint x)
name|preview_set_hint
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|)
block|{
name|gdouble
name|xpos
decl_stmt|;
name|GimpRGB
name|rgb
decl_stmt|;
name|GimpHSV
name|hsv
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|xpos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|gimp_gradient_get_color_at
argument_list|(
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
argument_list|,
name|xpos
argument_list|,
operator|&
name|rgb
argument_list|)
expr_stmt|;
name|gimp_rgb_to_hsv
argument_list|(
operator|&
name|rgb
argument_list|,
operator|&
name|hsv
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Position: %0.6f    "
literal|"RGB (%0.3f, %0.3f, %0.3f)    "
literal|"HSV (%0.3f, %0.3f, %0.3f)    "
literal|"Opacity: %0.3f"
argument_list|)
argument_list|,
name|xpos
argument_list|,
name|rgb
operator|.
name|r
argument_list|,
name|rgb
operator|.
name|g
argument_list|,
name|rgb
operator|.
name|b
argument_list|,
name|hsv
operator|.
name|h
operator|*
literal|360.0
argument_list|,
name|hsv
operator|.
name|s
argument_list|,
name|hsv
operator|.
name|v
argument_list|,
name|rgb
operator|.
name|a
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_set_foreground (GradientEditor * gradient_editor,gint x)
name|preview_set_foreground
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|)
block|{
name|GimpRGB
name|color
decl_stmt|;
name|gdouble
name|xpos
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|xpos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|gimp_gradient_get_color_at
argument_list|(
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
argument_list|,
name|xpos
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_context_set_foreground
argument_list|(
name|gimp_context_get_user
argument_list|()
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Foreground color set to RGB (%d, %d, %d)<-> "
literal|"(%0.3f, %0.3f, %0.3f)"
argument_list|)
argument_list|,
call|(
name|gint
call|)
argument_list|(
name|color
operator|.
name|r
operator|*
literal|255.0
argument_list|)
argument_list|,
call|(
name|gint
call|)
argument_list|(
name|color
operator|.
name|g
operator|*
literal|255.0
argument_list|)
argument_list|,
call|(
name|gint
call|)
argument_list|(
name|color
operator|.
name|b
operator|*
literal|255.0
argument_list|)
argument_list|,
name|color
operator|.
name|r
argument_list|,
name|color
operator|.
name|g
argument_list|,
name|color
operator|.
name|b
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_set_background (GradientEditor * gradient_editor,gint x)
name|preview_set_background
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|)
block|{
name|GimpRGB
name|color
decl_stmt|;
name|gdouble
name|xpos
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|xpos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|gimp_gradient_get_color_at
argument_list|(
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
argument_list|,
name|xpos
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_context_set_background
argument_list|(
name|gimp_context_get_user
argument_list|()
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Background color to RGB (%d, %d, %d)<-> "
literal|"(%0.3f, %0.3f, %0.3f)"
argument_list|)
argument_list|,
call|(
name|gint
call|)
argument_list|(
name|color
operator|.
name|r
operator|*
literal|255.0
argument_list|)
argument_list|,
call|(
name|gint
call|)
argument_list|(
name|color
operator|.
name|g
operator|*
literal|255.0
argument_list|)
argument_list|,
call|(
name|gint
call|)
argument_list|(
name|color
operator|.
name|b
operator|*
literal|255.0
argument_list|)
argument_list|,
name|color
operator|.
name|r
argument_list|,
name|color
operator|.
name|g
argument_list|,
name|color
operator|.
name|b
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|preview_update (GradientEditor * gradient_editor,gboolean recalculate)
name|preview_update
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gboolean
name|recalculate
parameter_list|)
block|{
name|glong
name|rowsiz
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|guint16
name|width
decl_stmt|;
name|guint16
name|height
decl_stmt|;
specifier|static
name|guint16
name|last_width
init|=
literal|0
decl_stmt|;
specifier|static
name|guint16
name|last_height
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|GTK_WIDGET_DRAWABLE
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
condition|)
return|return;
comment|/*  See whether we have to re-create the preview widget    *  (note that the preview automatically follows the size of it's container)    */
name|width
operator|=
name|gradient_editor
operator|->
name|preview
operator|->
name|allocation
operator|.
name|width
expr_stmt|;
name|height
operator|=
name|gradient_editor
operator|->
name|preview
operator|->
name|allocation
operator|.
name|height
expr_stmt|;
if|if
condition|(
operator|!
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
operator|||
operator|!
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
operator|||
operator|(
name|width
operator|!=
name|last_width
operator|)
operator|||
operator|(
name|height
operator|!=
name|last_height
operator|)
condition|)
block|{
if|if
condition|(
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
condition|)
name|g_free
argument_list|(
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
condition|)
name|g_free
argument_list|(
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|rowsiz
operator|=
name|width
operator|*
literal|3
operator|*
sizeof|sizeof
argument_list|(
name|guchar
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
operator|=
name|g_malloc
argument_list|(
name|rowsiz
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
operator|=
name|g_malloc
argument_list|(
name|rowsiz
argument_list|)
expr_stmt|;
name|recalculate
operator|=
name|TRUE
expr_stmt|;
comment|/* Force recalculation */
block|}
name|last_width
operator|=
name|width
expr_stmt|;
name|last_height
operator|=
name|height
expr_stmt|;
comment|/* Have to redraw? */
if|if
condition|(
name|recalculate
condition|)
block|{
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|preview_fill_image
argument_list|(
name|gradient_editor
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|adjustment
operator|->
name|value
argument_list|,
name|adjustment
operator|->
name|value
operator|+
name|adjustment
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|preview_fill_image (GradientEditor * gradient_editor,gint width,gint height,gdouble left,gdouble right)
name|preview_fill_image
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|gdouble
name|left
parameter_list|,
name|gdouble
name|right
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|guchar
modifier|*
name|p0
decl_stmt|,
modifier|*
name|p1
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gdouble
name|dx
decl_stmt|,
name|cur_x
decl_stmt|;
name|GimpRGB
name|color
decl_stmt|;
name|gdouble
name|c0
decl_stmt|,
name|c1
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|dx
operator|=
operator|(
name|right
operator|-
name|left
operator|)
operator|/
operator|(
name|width
operator|-
literal|1
operator|)
expr_stmt|;
name|cur_x
operator|=
name|left
expr_stmt|;
name|p0
operator|=
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
expr_stmt|;
name|p1
operator|=
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
expr_stmt|;
comment|/* Create lines to fill the image */
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|width
condition|;
name|x
operator|++
control|)
block|{
name|gimp_gradient_get_color_at
argument_list|(
name|gradient
argument_list|,
name|cur_x
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|/
name|GIMP_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
block|{
name|c0
operator|=
name|GIMP_CHECK_LIGHT
expr_stmt|;
name|c1
operator|=
name|GIMP_CHECK_DARK
expr_stmt|;
block|}
else|else
block|{
name|c0
operator|=
name|GIMP_CHECK_DARK
expr_stmt|;
name|c1
operator|=
name|GIMP_CHECK_LIGHT
expr_stmt|;
block|}
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|color
operator|.
name|r
operator|-
name|c0
operator|)
operator|*
name|color
operator|.
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|color
operator|.
name|g
operator|-
name|c0
operator|)
operator|*
name|color
operator|.
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|color
operator|.
name|b
operator|-
name|c0
operator|)
operator|*
name|color
operator|.
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|color
operator|.
name|r
operator|-
name|c1
operator|)
operator|*
name|color
operator|.
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|color
operator|.
name|g
operator|-
name|c1
operator|)
operator|*
name|color
operator|.
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|color
operator|.
name|b
operator|-
name|c1
operator|)
operator|*
name|color
operator|.
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|cur_x
operator|+=
name|dx
expr_stmt|;
block|}
comment|/* Fill image */
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|y
operator|/
name|GIMP_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|width
argument_list|)
expr_stmt|;
else|else
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|width
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/***** Gradient control functions *****/
end_comment

begin_comment
comment|/* *** WARNING *** WARNING *** WARNING ***  *  * All the event-handling code for the gradient control widget is  * extremely hairy.  You are not expected to understand it.  If you  * find bugs, mail me unless you are very brave and you want to fix  * them yourself ;-)  */
end_comment

begin_function
specifier|static
name|gint
DECL|function|control_events (GtkWidget * widget,GdkEvent * event,GradientEditor * gradient_editor)
name|control_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guint32
name|time
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|control_update
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_LEAVE_NOTIFY
case|:
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
if|if
condition|(
name|gradient_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_NONE
condition|)
block|{
name|gtk_widget_get_pointer
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
name|gradient_editor
operator|->
name|control_last_x
operator|=
name|x
expr_stmt|;
name|gradient_editor
operator|->
name|control_click_time
operator|=
name|bevent
operator|->
name|time
expr_stmt|;
name|control_button_press
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|bevent
operator|->
name|button
argument_list|,
name|bevent
operator|->
name|state
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|control_drag_mode
operator|!=
name|GRAD_DRAG_NONE
condition|)
name|gtk_grab_add
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|control_drag_mode
operator|!=
name|GRAD_DRAG_NONE
condition|)
block|{
name|gtk_grab_remove
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_get_pointer
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|time
operator|=
operator|(
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
operator|)
operator|->
name|time
expr_stmt|;
if|if
condition|(
operator|(
name|time
operator|-
name|gradient_editor
operator|->
name|control_click_time
operator|)
operator|>=
name|GRAD_MOVE_TIME
condition|)
block|{
if|if
condition|(
operator|!
name|gradient_editor
operator|->
name|instant_update
condition|)
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
comment|/* Possible move */
block|}
elseif|else
if|if
condition|(
operator|(
name|gradient_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_MIDDLE
operator|)
operator|||
operator|(
name|gradient_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_ALL
operator|)
condition|)
block|{
name|seg
operator|=
name|gradient_editor
operator|->
name|control_drag_segment
expr_stmt|;
if|if
condition|(
operator|(
name|gradient_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_ALL
operator|)
operator|&&
name|gradient_editor
operator|->
name|control_compress
condition|)
name|control_extend_selection
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|,
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|control_select_single_segment
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
name|gradient_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_NONE
expr_stmt|;
name|gradient_editor
operator|->
name|control_compress
operator|=
name|FALSE
expr_stmt|;
name|control_do_hint
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GDK_MOTION_NOTIFY
case|:
name|gtk_widget_get_pointer
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|!=
name|gradient_editor
operator|->
name|control_last_x
condition|)
block|{
name|gradient_editor
operator|->
name|control_last_x
operator|=
name|x
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|control_drag_mode
operator|!=
name|GRAD_DRAG_NONE
condition|)
block|{
name|time
operator|=
operator|(
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
operator|)
operator|->
name|time
expr_stmt|;
if|if
condition|(
operator|(
name|time
operator|-
name|gradient_editor
operator|->
name|control_click_time
operator|)
operator|>=
name|GRAD_MOVE_TIME
condition|)
name|control_motion
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
name|control_do_hint
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_do_hint (GradientEditor * gradient_editor,gint x,gint y)
name|control_do_hint
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|control_drag_mode_t
name|handle
decl_stmt|;
name|gboolean
name|in_handle
decl_stmt|;
name|double
name|pos
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|pos
operator|<
literal|0.0
operator|)
operator|||
operator|(
name|pos
operator|>
literal|1.0
operator|)
condition|)
return|return;
name|seg_get_closest_handle
argument_list|(
name|gradient
argument_list|,
name|pos
argument_list|,
operator|&
name|seg
argument_list|,
operator|&
name|handle
argument_list|)
expr_stmt|;
name|in_handle
operator|=
name|control_point_in_handle
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|seg
argument_list|,
name|handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|in_handle
condition|)
block|{
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|seg
operator|->
name|prev
operator|!=
name|NULL
condition|)
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|_
argument_list|(
literal|"Drag: move    Shift+drag: move& compress"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|_
argument_list|(
literal|"Click: select    Shift+click: extend selection"
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|_
argument_list|(
literal|"Click: select    Shift+click: extend selection"
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|_
argument_list|(
literal|"Click: select    Shift+click: extend selection    "
literal|"Drag: move"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"in_handle is true yet we got handle type %d"
argument_list|,
operator|(
name|int
operator|)
name|handle
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
else|else
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|_
argument_list|(
literal|"Click: select    Shift+click: extend selection    "
literal|"Drag: move    Shift+drag: move& compress"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_button_press (GradientEditor * gradient_editor,gint x,gint y,guint button,guint state)
name|control_button_press
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|button
parameter_list|,
name|guint
name|state
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|control_drag_mode_t
name|handle
decl_stmt|;
name|double
name|xpos
decl_stmt|;
name|gboolean
name|in_handle
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|button
condition|)
block|{
case|case
literal|1
case|:
break|break;
case|case
literal|3
case|:
name|cpopup_do_popup
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
return|return;
comment|/*  wheelmouse support  */
case|case
literal|4
case|:
block|{
name|GtkAdjustment
modifier|*
name|adj
init|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
decl_stmt|;
name|gfloat
name|new_value
init|=
name|adj
operator|->
name|value
operator|-
name|adj
operator|->
name|page_increment
operator|/
literal|2
decl_stmt|;
name|new_value
operator|=
name|CLAMP
argument_list|(
name|new_value
argument_list|,
name|adj
operator|->
name|lower
argument_list|,
name|adj
operator|->
name|upper
operator|-
name|adj
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adj
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
block|}
return|return;
case|case
literal|5
case|:
block|{
name|GtkAdjustment
modifier|*
name|adj
init|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
decl_stmt|;
name|gfloat
name|new_value
init|=
name|adj
operator|->
name|value
operator|+
name|adj
operator|->
name|page_increment
operator|/
literal|2
decl_stmt|;
name|new_value
operator|=
name|CLAMP
argument_list|(
name|new_value
argument_list|,
name|adj
operator|->
name|lower
argument_list|,
name|adj
operator|->
name|upper
operator|-
name|adj
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adj
argument_list|,
name|new_value
argument_list|)
expr_stmt|;
block|}
return|return;
default|default:
return|return;
block|}
comment|/* Find the closest handle */
name|xpos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|seg_get_closest_handle
argument_list|(
name|gradient
argument_list|,
name|xpos
argument_list|,
operator|&
name|seg
argument_list|,
operator|&
name|handle
argument_list|)
expr_stmt|;
name|in_handle
operator|=
name|control_point_in_handle
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|seg
argument_list|,
name|handle
argument_list|)
expr_stmt|;
comment|/* Now see what we have */
if|if
condition|(
name|in_handle
condition|)
block|{
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
operator|!=
name|NULL
condition|)
block|{
comment|/* Left handle of some segment */
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
if|if
condition|(
name|seg
operator|->
name|prev
operator|!=
name|NULL
condition|)
block|{
name|gradient_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
name|gradient_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
name|gradient_editor
operator|->
name|control_compress
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|control_extend_selection
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|seg
operator|->
name|prev
operator|!=
name|NULL
condition|)
block|{
name|gradient_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
name|gradient_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
block|}
else|else
block|{
name|control_select_single_segment
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
else|else
comment|/* seg == NULL */
block|{
comment|/* Right handle of last segment */
name|seg
operator|=
name|gimp_gradient_segment_get_last
argument_list|(
name|gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
name|control_extend_selection
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|control_select_single_segment
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
return|return;
block|}
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
name|control_extend_selection
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gradient_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_MIDDLE
expr_stmt|;
name|gradient_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
block|}
return|return;
default|default:
name|g_warning
argument_list|(
literal|"in_handle is true yet we got handle type %d"
argument_list|,
operator|(
name|int
operator|)
name|handle
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
else|else
comment|/* !in_handle */
block|{
name|seg
operator|=
name|gimp_gradient_get_segment_at
argument_list|(
name|gradient
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_ALL
expr_stmt|;
name|gradient_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
name|gradient_editor
operator|->
name|control_last_gx
operator|=
name|xpos
expr_stmt|;
name|gradient_editor
operator|->
name|control_orig_pos
operator|=
name|xpos
expr_stmt|;
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
name|gradient_editor
operator|->
name|control_compress
operator|=
name|TRUE
expr_stmt|;
return|return;
block|}
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|control_point_in_handle (GradientEditor * gradient_editor,GimpGradient * gradient,gint x,gint y,GimpGradientSegment * seg,control_drag_mode_t handle)
name|control_point_in_handle
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|GimpGradientSegment
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
name|handle
parameter_list|)
block|{
name|gint
name|handle_pos
decl_stmt|;
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
condition|)
block|{
name|handle_pos
operator|=
name|control_calc_p_pos
argument_list|(
name|gradient_editor
argument_list|,
name|seg
operator|->
name|left
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|seg
operator|=
name|gimp_gradient_segment_get_last
argument_list|(
name|gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
name|handle_pos
operator|=
name|control_calc_p_pos
argument_list|(
name|gradient_editor
argument_list|,
name|seg
operator|->
name|right
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|handle_pos
operator|=
name|control_calc_p_pos
argument_list|(
name|gradient_editor
argument_list|,
name|seg
operator|->
name|middle
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"can not handle drag mode %d"
argument_list|,
operator|(
name|gint
operator|)
name|handle
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
name|y
operator|/=
literal|2
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|>=
operator|(
name|handle_pos
operator|-
name|y
operator|)
operator|)
operator|&&
operator|(
name|x
operator|<=
operator|(
name|handle_pos
operator|+
name|y
operator|)
operator|)
condition|)
return|return
name|TRUE
return|;
else|else
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_select_single_segment (GradientEditor * gradient_editor,GimpGradientSegment * seg)
name|control_select_single_segment
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|seg
parameter_list|)
block|{
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|seg
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_extend_selection (GradientEditor * gradient_editor,GimpGradientSegment * seg,gdouble pos)
name|control_extend_selection
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|seg
parameter_list|,
name|gdouble
name|pos
parameter_list|)
block|{
if|if
condition|(
name|fabs
argument_list|(
name|pos
operator|-
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
argument_list|)
operator|<
name|fabs
argument_list|(
name|pos
operator|-
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
argument_list|)
condition|)
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|seg
expr_stmt|;
else|else
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_motion (GradientEditor * gradient_editor,GimpGradient * gradient,gint x)
name|control_motion
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|gint
name|x
parameter_list|)
block|{
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gdouble
name|pos
decl_stmt|;
name|gdouble
name|delta
decl_stmt|;
name|gchar
modifier|*
name|str
init|=
name|NULL
decl_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_drag_segment
expr_stmt|;
switch|switch
condition|(
name|gradient_editor
operator|->
name|control_drag_mode
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gradient_editor
operator|->
name|control_compress
condition|)
name|seg
operator|->
name|prev
operator|->
name|right
operator|=
name|seg
operator|->
name|left
operator|=
name|CLAMP
argument_list|(
name|pos
argument_list|,
name|seg
operator|->
name|prev
operator|->
name|middle
operator|+
name|EPSILON
argument_list|,
name|seg
operator|->
name|middle
operator|-
name|EPSILON
argument_list|)
expr_stmt|;
else|else
name|control_compress_left
argument_list|(
name|gradient_editor
operator|->
name|control_sel_l
argument_list|,
name|gradient_editor
operator|->
name|control_sel_r
argument_list|,
name|seg
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Handle position: %0.6f"
argument_list|)
argument_list|,
name|seg
operator|->
name|left
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|CLAMP
argument_list|(
name|pos
argument_list|,
name|seg
operator|->
name|left
operator|+
name|EPSILON
argument_list|,
name|seg
operator|->
name|right
operator|-
name|EPSILON
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Handle position: %0.6f"
argument_list|)
argument_list|,
name|seg
operator|->
name|middle
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_DRAG_ALL
case|:
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|delta
operator|=
name|pos
operator|-
name|gradient_editor
operator|->
name|control_last_gx
expr_stmt|;
if|if
condition|(
operator|(
name|seg
operator|->
name|left
operator|>=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
operator|)
operator|&&
operator|(
name|seg
operator|->
name|right
operator|<=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|)
condition|)
name|delta
operator|=
name|control_move
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|control_sel_l
argument_list|,
name|gradient_editor
operator|->
name|control_sel_r
argument_list|,
name|delta
argument_list|)
expr_stmt|;
else|else
name|delta
operator|=
name|control_move
argument_list|(
name|gradient_editor
argument_list|,
name|seg
argument_list|,
name|seg
argument_list|,
name|delta
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_last_gx
operator|+=
name|delta
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Distance: %0.6f"
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_last_gx
operator|-
name|gradient_editor
operator|->
name|control_orig_pos
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|gradient_editor
argument_list|,
name|str
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gimp_fatal_error
argument_list|(
literal|"Attempt to move bogus handle %d"
argument_list|,
operator|(
name|gint
operator|)
name|gradient_editor
operator|->
name|control_drag_mode
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|str
condition|)
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|instant_update
condition|)
block|{
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_compress_left (GimpGradientSegment * range_l,GimpGradientSegment * range_r,GimpGradientSegment * drag_seg,gdouble pos)
name|control_compress_left
parameter_list|(
name|GimpGradientSegment
modifier|*
name|range_l
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_r
parameter_list|,
name|GimpGradientSegment
modifier|*
name|drag_seg
parameter_list|,
name|gdouble
name|pos
parameter_list|)
block|{
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gdouble
name|lbound
decl_stmt|,
name|rbound
decl_stmt|;
name|gint
name|k
decl_stmt|;
comment|/* Check what we have to compress */
if|if
condition|(
operator|!
operator|(
operator|(
name|drag_seg
operator|->
name|left
operator|>=
name|range_l
operator|->
name|left
operator|)
operator|&&
operator|(
operator|(
name|drag_seg
operator|->
name|right
operator|<=
name|range_r
operator|->
name|right
operator|)
operator|||
operator|(
name|drag_seg
operator|==
name|range_r
operator|->
name|next
operator|)
operator|)
operator|)
condition|)
block|{
comment|/* We are compressing a segment outside the selection */
name|range_l
operator|=
name|range_r
operator|=
name|drag_seg
expr_stmt|;
block|}
comment|/* Calculate left bound for dragged hadle */
if|if
condition|(
name|drag_seg
operator|==
name|range_l
condition|)
name|lbound
operator|=
name|range_l
operator|->
name|prev
operator|->
name|left
operator|+
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
block|{
comment|/* Count number of segments to the left of the dragged handle */
name|seg
operator|=
name|drag_seg
expr_stmt|;
name|k
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|seg
operator|!=
name|range_l
condition|)
block|{
name|k
operator|++
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|prev
expr_stmt|;
block|}
comment|/* 2*k handles have to fit */
name|lbound
operator|=
name|range_l
operator|->
name|left
operator|+
literal|2.0
operator|*
name|k
operator|*
name|EPSILON
expr_stmt|;
block|}
comment|/* Calculate right bound for dragged handle */
if|if
condition|(
name|drag_seg
operator|==
name|range_r
operator|->
name|next
condition|)
name|rbound
operator|=
name|range_r
operator|->
name|next
operator|->
name|right
operator|-
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
block|{
comment|/* Count number of segments to the right of the dragged handle */
name|seg
operator|=
name|drag_seg
expr_stmt|;
name|k
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|seg
operator|!=
name|range_r
condition|)
block|{
name|k
operator|++
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* 2*k handles have to fit */
name|rbound
operator|=
name|range_r
operator|->
name|right
operator|-
literal|2.0
operator|*
name|k
operator|*
name|EPSILON
expr_stmt|;
block|}
comment|/* Calculate position */
name|pos
operator|=
name|CLAMP
argument_list|(
name|pos
argument_list|,
name|lbound
argument_list|,
name|rbound
argument_list|)
expr_stmt|;
comment|/* Compress segments to the left of the handle */
if|if
condition|(
name|drag_seg
operator|==
name|range_l
condition|)
name|control_compress_range
argument_list|(
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
operator|->
name|left
argument_list|,
name|pos
argument_list|)
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|range_l
argument_list|,
name|drag_seg
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|left
argument_list|,
name|pos
argument_list|)
expr_stmt|;
comment|/* Compress segments to the right of the handle */
if|if
condition|(
name|drag_seg
operator|!=
name|range_r
operator|->
name|next
condition|)
name|control_compress_range
argument_list|(
name|drag_seg
argument_list|,
name|range_r
argument_list|,
name|pos
argument_list|,
name|range_r
operator|->
name|right
argument_list|)
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|drag_seg
argument_list|,
name|drag_seg
argument_list|,
name|pos
argument_list|,
name|drag_seg
operator|->
name|right
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_compress_range (GimpGradientSegment * range_l,GimpGradientSegment * range_r,gdouble new_l,gdouble new_r)
name|control_compress_range
parameter_list|(
name|GimpGradientSegment
modifier|*
name|range_l
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_r
parameter_list|,
name|gdouble
name|new_l
parameter_list|,
name|gdouble
name|new_r
parameter_list|)
block|{
name|gdouble
name|orig_l
decl_stmt|,
name|orig_r
decl_stmt|;
name|gdouble
name|scale
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|orig_l
operator|=
name|range_l
operator|->
name|left
expr_stmt|;
name|orig_r
operator|=
name|range_r
operator|->
name|right
expr_stmt|;
name|scale
operator|=
operator|(
name|new_r
operator|-
name|new_l
operator|)
operator|/
operator|(
name|orig_r
operator|-
name|orig_l
operator|)
expr_stmt|;
name|seg
operator|=
name|range_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|left
operator|=
name|new_l
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|orig_l
operator|)
operator|*
name|scale
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|new_l
operator|+
operator|(
name|seg
operator|->
name|middle
operator|-
name|orig_l
operator|)
operator|*
name|scale
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|new_l
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|orig_l
operator|)
operator|*
name|scale
expr_stmt|;
comment|/* Next */
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|range_r
condition|)
do|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|gdouble
DECL|function|control_move (GradientEditor * gradient_editor,GimpGradientSegment * range_l,GimpGradientSegment * range_r,gdouble delta)
name|control_move
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_l
parameter_list|,
name|GimpGradientSegment
modifier|*
name|range_r
parameter_list|,
name|gdouble
name|delta
parameter_list|)
block|{
name|gdouble
name|lbound
decl_stmt|,
name|rbound
decl_stmt|;
name|gint
name|is_first
decl_stmt|,
name|is_last
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
comment|/* First or last segments in gradient? */
name|is_first
operator|=
operator|(
name|range_l
operator|->
name|prev
operator|==
name|NULL
operator|)
expr_stmt|;
name|is_last
operator|=
operator|(
name|range_r
operator|->
name|next
operator|==
name|NULL
operator|)
expr_stmt|;
comment|/* Calculate drag bounds */
if|if
condition|(
operator|!
name|gradient_editor
operator|->
name|control_compress
condition|)
block|{
if|if
condition|(
operator|!
name|is_first
condition|)
name|lbound
operator|=
name|range_l
operator|->
name|prev
operator|->
name|middle
operator|+
name|EPSILON
expr_stmt|;
else|else
name|lbound
operator|=
name|range_l
operator|->
name|left
operator|+
name|EPSILON
expr_stmt|;
if|if
condition|(
operator|!
name|is_last
condition|)
name|rbound
operator|=
name|range_r
operator|->
name|next
operator|->
name|middle
operator|-
name|EPSILON
expr_stmt|;
else|else
name|rbound
operator|=
name|range_r
operator|->
name|right
operator|-
name|EPSILON
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|is_first
condition|)
name|lbound
operator|=
name|range_l
operator|->
name|prev
operator|->
name|left
operator|+
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
name|lbound
operator|=
name|range_l
operator|->
name|left
operator|+
name|EPSILON
expr_stmt|;
if|if
condition|(
operator|!
name|is_last
condition|)
name|rbound
operator|=
name|range_r
operator|->
name|next
operator|->
name|right
operator|-
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
name|rbound
operator|=
name|range_r
operator|->
name|right
operator|-
name|EPSILON
expr_stmt|;
block|}
comment|/* Fix the delta if necessary */
if|if
condition|(
name|delta
operator|<
literal|0.0
condition|)
block|{
if|if
condition|(
operator|!
name|is_first
condition|)
block|{
if|if
condition|(
name|range_l
operator|->
name|left
operator|+
name|delta
operator|<
name|lbound
condition|)
name|delta
operator|=
name|lbound
operator|-
name|range_l
operator|->
name|left
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|range_l
operator|->
name|middle
operator|+
name|delta
operator|<
name|lbound
condition|)
name|delta
operator|=
name|lbound
operator|-
name|range_l
operator|->
name|middle
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|is_last
condition|)
block|{
if|if
condition|(
name|range_r
operator|->
name|right
operator|+
name|delta
operator|>
name|rbound
condition|)
name|delta
operator|=
name|rbound
operator|-
name|range_r
operator|->
name|right
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|range_r
operator|->
name|middle
operator|+
name|delta
operator|>
name|rbound
condition|)
name|delta
operator|=
name|rbound
operator|-
name|range_r
operator|->
name|middle
expr_stmt|;
block|}
comment|/* Move all the segments inside the range */
name|seg
operator|=
name|range_l
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|!
operator|(
operator|(
name|seg
operator|==
name|range_l
operator|)
operator|&&
name|is_first
operator|)
condition|)
name|seg
operator|->
name|left
operator|+=
name|delta
expr_stmt|;
name|seg
operator|->
name|middle
operator|+=
name|delta
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|(
name|seg
operator|==
name|range_r
operator|)
operator|&&
name|is_last
operator|)
condition|)
name|seg
operator|->
name|right
operator|+=
name|delta
expr_stmt|;
comment|/* Next */
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|range_r
condition|)
do|;
comment|/* Fix the segments that surround the range */
if|if
condition|(
operator|!
name|is_first
condition|)
block|{
if|if
condition|(
operator|!
name|gradient_editor
operator|->
name|control_compress
condition|)
name|range_l
operator|->
name|prev
operator|->
name|right
operator|=
name|range_l
operator|->
name|left
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
operator|->
name|left
argument_list|,
name|range_l
operator|->
name|left
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|is_last
condition|)
block|{
if|if
condition|(
operator|!
name|gradient_editor
operator|->
name|control_compress
condition|)
name|range_r
operator|->
name|next
operator|->
name|left
operator|=
name|range_r
operator|->
name|right
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|range_r
operator|->
name|next
argument_list|,
name|range_r
operator|->
name|next
argument_list|,
name|range_r
operator|->
name|right
argument_list|,
name|range_r
operator|->
name|next
operator|->
name|right
argument_list|)
expr_stmt|;
block|}
return|return
name|delta
return|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_update (GradientEditor * gradient_editor,GimpGradient * gradient,gboolean recalculate)
name|control_update
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|gboolean
name|recalculate
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|gint
name|cwidth
decl_stmt|,
name|cheight
decl_stmt|;
name|gint
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
if|if
condition|(
operator|!
name|GTK_WIDGET_DRAWABLE
argument_list|(
name|gradient_editor
operator|->
name|control
argument_list|)
condition|)
return|return;
comment|/*  See whether we have to re-create the control pixmap    *  depending on the preview's width    */
name|cwidth
operator|=
name|gradient_editor
operator|->
name|preview
operator|->
name|allocation
operator|.
name|width
expr_stmt|;
name|cheight
operator|=
name|GRAD_CONTROL_HEIGHT
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|control_pixmap
condition|)
name|gdk_window_get_size
argument_list|(
name|gradient_editor
operator|->
name|control_pixmap
argument_list|,
operator|&
name|pwidth
argument_list|,
operator|&
name|pheight
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gradient_editor
operator|->
name|control_pixmap
operator|||
operator|(
name|cwidth
operator|!=
name|pwidth
operator|)
operator|||
operator|(
name|cheight
operator|!=
name|pheight
operator|)
condition|)
block|{
if|if
condition|(
name|gradient_editor
operator|->
name|control_pixmap
condition|)
name|gdk_pixmap_unref
argument_list|(
name|gradient_editor
operator|->
name|control_pixmap
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|gradient_editor
operator|->
name|control
operator|->
name|window
argument_list|,
name|cwidth
argument_list|,
name|cheight
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|recalculate
operator|=
name|TRUE
expr_stmt|;
block|}
comment|/* Avaoid segfault on first invocation */
if|if
condition|(
name|cwidth
operator|<
name|GRAD_PREVIEW_WIDTH
condition|)
return|return;
comment|/* Have to reset the selection? */
if|if
condition|(
name|recalculate
condition|)
name|control_select_single_segment
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
comment|/* Redraw pixmap */
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|control_draw
argument_list|(
name|gradient_editor
argument_list|,
name|gradient
argument_list|,
name|gradient_editor
operator|->
name|control_pixmap
argument_list|,
name|cwidth
argument_list|,
name|cheight
argument_list|,
name|adjustment
operator|->
name|value
argument_list|,
name|adjustment
operator|->
name|value
operator|+
name|adjustment
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|gradient_editor
operator|->
name|control
operator|->
name|window
argument_list|,
name|gradient_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|gradient_editor
operator|->
name|control_pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|cwidth
argument_list|,
name|cheight
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_draw (GradientEditor * gradient_editor,GimpGradient * gradient,GdkPixmap * pixmap,gint width,gint height,gdouble left,gdouble right)
name|control_draw
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|gdouble
name|left
parameter_list|,
name|gdouble
name|right
parameter_list|)
block|{
name|gint
name|sel_l
decl_stmt|,
name|sel_r
decl_stmt|;
name|gdouble
name|g_pos
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|control_drag_mode_t
name|handle
decl_stmt|;
comment|/* Clear the pixmap */
name|gdk_draw_rectangle
argument_list|(
name|pixmap
argument_list|,
name|gradient_editor
operator|->
name|control
operator|->
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Draw selection */
name|sel_l
operator|=
name|control_calc_p_pos
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
argument_list|)
expr_stmt|;
name|sel_r
operator|=
name|control_calc_p_pos
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|pixmap
argument_list|,
name|gradient_editor
operator|->
name|control
operator|->
name|style
operator|->
name|dark_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|TRUE
argument_list|,
name|sel_l
argument_list|,
literal|0
argument_list|,
name|sel_r
operator|-
name|sel_l
operator|+
literal|1
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Draw handles */
name|seg
operator|=
name|gradient
operator|->
name|segments
expr_stmt|;
while|while
condition|(
name|seg
condition|)
block|{
name|control_draw_normal_handle
argument_list|(
name|gradient_editor
argument_list|,
name|pixmap
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|control_draw_middle_handle
argument_list|(
name|gradient_editor
argument_list|,
name|pixmap
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Draw right handle only if this is the last segment */
if|if
condition|(
name|seg
operator|->
name|next
operator|==
name|NULL
condition|)
name|control_draw_normal_handle
argument_list|(
name|gradient_editor
argument_list|,
name|pixmap
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Next! */
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* Draw the handle which is closest to the mouse position */
name|g_pos
operator|=
name|control_calc_g_pos
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|control_last_x
argument_list|)
expr_stmt|;
name|seg_get_closest_handle
argument_list|(
name|gradient
argument_list|,
name|CLAMP
argument_list|(
name|g_pos
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
argument_list|,
operator|&
name|seg
argument_list|,
operator|&
name|handle
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
condition|)
block|{
name|control_draw_normal_handle
argument_list|(
name|gradient_editor
argument_list|,
name|pixmap
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|seg
operator|=
name|gimp_gradient_segment_get_last
argument_list|(
name|gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
name|control_draw_normal_handle
argument_list|(
name|gradient_editor
argument_list|,
name|pixmap
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|control_draw_middle_handle
argument_list|(
name|gradient_editor
argument_list|,
name|pixmap
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
name|height
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_draw_normal_handle (GradientEditor * gradient_editor,GdkPixmap * pixmap,gdouble pos,gint height)
name|control_draw_normal_handle
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|gdouble
name|pos
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|control_draw_handle
argument_list|(
name|pixmap
argument_list|,
name|gradient_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|gradient_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|control_calc_p_pos
argument_list|(
name|gradient_editor
argument_list|,
name|pos
argument_list|)
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_draw_middle_handle (GradientEditor * gradient_editor,GdkPixmap * pixmap,gdouble pos,gint height)
name|control_draw_middle_handle
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|gdouble
name|pos
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|control_draw_handle
argument_list|(
name|pixmap
argument_list|,
name|gradient_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|gradient_editor
operator|->
name|control
operator|->
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_PRELIGHT
index|]
argument_list|,
name|control_calc_p_pos
argument_list|(
name|gradient_editor
argument_list|,
name|pos
argument_list|)
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|control_draw_handle (GdkPixmap * pixmap,GdkGC * border_gc,GdkGC * fill_gc,gint xpos,gint height)
name|control_draw_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|GdkGC
modifier|*
name|border_gc
parameter_list|,
name|GdkGC
modifier|*
name|fill_gc
parameter_list|,
name|gint
name|xpos
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|gint
name|y
decl_stmt|;
name|gint
name|left
decl_stmt|,
name|right
decl_stmt|,
name|bottom
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|fill_gc
argument_list|,
name|xpos
operator|-
name|y
operator|/
literal|2
argument_list|,
name|y
argument_list|,
name|xpos
operator|+
name|y
operator|/
literal|2
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|bottom
operator|=
name|height
operator|-
literal|1
expr_stmt|;
name|left
operator|=
name|xpos
operator|-
name|bottom
operator|/
literal|2
expr_stmt|;
name|right
operator|=
name|xpos
operator|+
name|bottom
operator|/
literal|2
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|border_gc
argument_list|,
name|xpos
argument_list|,
literal|0
argument_list|,
name|left
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|border_gc
argument_list|,
name|xpos
argument_list|,
literal|0
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|border_gc
argument_list|,
name|left
argument_list|,
name|bottom
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|gint
DECL|function|control_calc_p_pos (GradientEditor * gradient_editor,gdouble pos)
name|control_calc_p_pos
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gdouble
name|pos
parameter_list|)
block|{
name|gint
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
comment|/* Calculate the position (in widget's coordinates) of the    * requested point from the gradient.  Rounding is done to    * minimize mismatches between the rendered gradient preview    * and the gradient control's handles.    */
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|gdk_window_get_size
argument_list|(
name|gradient_editor
operator|->
name|control_pixmap
argument_list|,
operator|&
name|pwidth
argument_list|,
operator|&
name|pheight
argument_list|)
expr_stmt|;
return|return
name|RINT
argument_list|(
operator|(
name|pwidth
operator|-
literal|1
operator|)
operator|*
operator|(
name|pos
operator|-
name|adjustment
operator|->
name|value
operator|)
operator|/
name|adjustment
operator|->
name|page_size
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gdouble
DECL|function|control_calc_g_pos (GradientEditor * gradient_editor,gint pos)
name|control_calc_g_pos
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|pos
parameter_list|)
block|{
name|gint
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
comment|/* Calculate the gradient position that corresponds to widget's coordinates */
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gradient_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|gdk_window_get_size
argument_list|(
name|gradient_editor
operator|->
name|control_pixmap
argument_list|,
operator|&
name|pwidth
argument_list|,
operator|&
name|pheight
argument_list|)
expr_stmt|;
return|return
name|adjustment
operator|->
name|page_size
operator|*
name|pos
operator|/
operator|(
name|pwidth
operator|-
literal|1
operator|)
operator|+
name|adjustment
operator|->
name|value
return|;
block|}
end_function

begin_comment
comment|/***** Control popup functions *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_create_main_menu (GradientEditor * gradient_editor)
name|cpopup_create_main_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|accel_group
operator|=
name|gtk_accel_group_new
argument_list|()
expr_stmt|;
name|gradient_editor
operator|->
name|accel_group
operator|=
name|accel_group
expr_stmt|;
name|gtk_menu_set_accel_group
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
name|gtk_window_add_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
comment|/* Left endpoint */
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|gradient_editor
operator|->
name|left_color_preview
argument_list|,
operator|&
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Left endpoint's color"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_set_left_color_callback
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Load from"
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_left_load_popup
operator|=
name|cpopup_create_load_menu
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|left_load_color_boxes
argument_list|,
name|gradient_editor
operator|->
name|left_load_labels
argument_list|,
name|_
argument_list|(
literal|"Left neighbor's right endpoint"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Right endpoint"
argument_list|)
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_load_left_callback
argument_list|)
argument_list|,
literal|'L'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
literal|'L'
argument_list|,
name|GDK_MOD1_MASK
argument_list|,
literal|'F'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_left_load_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Save to"
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_left_save_popup
operator|=
name|cpopup_create_save_menu
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|left_save_color_boxes
argument_list|,
name|gradient_editor
operator|->
name|left_save_labels
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_save_left_callback
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_left_save_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Right endpoint */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|gradient_editor
operator|->
name|right_color_preview
argument_list|,
operator|&
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Right endpoint's color"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_set_right_color_callback
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'R'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Load from"
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_right_load_popup
operator|=
name|cpopup_create_load_menu
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|right_load_color_boxes
argument_list|,
name|gradient_editor
operator|->
name|right_load_labels
argument_list|,
name|_
argument_list|(
literal|"Right neighbor's left endpoint"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Left endpoint"
argument_list|)
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_load_right_callback
argument_list|)
argument_list|,
literal|'R'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
literal|'R'
argument_list|,
name|GDK_MOD1_MASK
argument_list|,
literal|'F'
argument_list|,
name|GDK_MOD1_MASK
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_right_load_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Save to"
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_right_save_popup
operator|=
name|cpopup_create_save_menu
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|right_save_color_boxes
argument_list|,
name|gradient_editor
operator|->
name|right_save_labels
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_save_right_callback
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_right_save_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Blending function */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_blending_label
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_blending_popup
operator|=
name|cpopup_create_blending_menu
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_blending_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Coloring type */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_coloring_label
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_coloring_popup
operator|=
name|cpopup_create_coloring_menu
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_coloring_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Operations */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Split at midpoint */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_split_m_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_split_midpoint_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'S'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Split uniformly */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_split_u_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_split_uniform_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'U'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Delete */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_delete_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_delete_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_delete_menu_item
operator|=
name|menuitem
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Recenter */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_recenter_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_recenter_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Redistribute */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_redistribute_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_redistribute_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'C'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Selection ops */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Selection operations"
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_ops_popup
operator|=
name|cpopup_create_sel_ops_menu
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|gradient_editor
operator|->
name|control_sel_ops_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Done */
name|gradient_editor
operator|->
name|control_main_popup
operator|=
name|menu
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_do_popup (GradientEditor * gradient_editor)
name|cpopup_do_popup
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|cpopup_adjust_menus
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|gradient_editor
operator|->
name|control_main_popup
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Create a single menu item *****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_color_item (GtkWidget ** color_box,GtkWidget ** label)
name|cpopup_create_color_item
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_box
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|wcolor_box
decl_stmt|;
name|GtkWidget
modifier|*
name|wlabel
decl_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|wcolor_box
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_set_dither
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|wcolor_box
argument_list|)
argument_list|,
name|GDK_RGB_DITHER_MAX
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|wcolor_box
argument_list|)
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|,
name|GRAD_COLOR_BOX_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|wcolor_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|wcolor_box
argument_list|)
expr_stmt|;
if|if
condition|(
name|color_box
condition|)
operator|*
name|color_box
operator|=
name|wcolor_box
expr_stmt|;
name|wlabel
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|wlabel
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|wlabel
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|wlabel
argument_list|)
expr_stmt|;
if|if
condition|(
name|label
condition|)
operator|*
name|label
operator|=
name|wlabel
expr_stmt|;
return|return
name|menuitem
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_menu_item_with_label (gchar * str,GtkWidget ** label)
name|cpopup_create_menu_item_with_label
parameter_list|(
name|gchar
modifier|*
name|str
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkWidget
modifier|*
name|accel_label
decl_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|accel_label
operator|=
name|gtk_accel_label_new
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|accel_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|accel_label
argument_list|)
expr_stmt|;
name|gtk_accel_label_set_accel_widget
argument_list|(
name|GTK_ACCEL_LABEL
argument_list|(
name|accel_label
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|accel_label
argument_list|)
expr_stmt|;
if|if
condition|(
name|label
condition|)
operator|*
name|label
operator|=
name|accel_label
expr_stmt|;
return|return
name|menuitem
return|;
block|}
end_function

begin_comment
comment|/***** Update all menus *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_adjust_menus (GradientEditor * gradient_editor)
name|cpopup_adjust_menus
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|GimpRGB
name|fg
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
comment|/* Render main menu color boxes */
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|left_color_preview
argument_list|)
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|right_color_preview
argument_list|)
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|)
expr_stmt|;
comment|/* Render load color from endpoint color boxes */
if|if
condition|(
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
else|else
name|seg
operator|=
name|gimp_gradient_segment_get_last
argument_list|(
name|gradient_editor
operator|->
name|control_sel_l
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|left_load_color_boxes
index|[
literal|0
index|]
argument_list|)
argument_list|,
operator|&
name|seg
operator|->
name|right_color
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|left_load_color_boxes
index|[
literal|1
index|]
argument_list|)
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
else|else
name|seg
operator|=
name|gradient
operator|->
name|segments
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|right_load_color_boxes
index|[
literal|0
index|]
argument_list|)
argument_list|,
operator|&
name|seg
operator|->
name|left_color
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|right_load_color_boxes
index|[
literal|1
index|]
argument_list|)
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|)
expr_stmt|;
comment|/* Render Foreground color boxes */
name|gimp_context_get_foreground
argument_list|(
name|gimp_context_get_user
argument_list|()
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|left_load_color_boxes
index|[
literal|2
index|]
argument_list|)
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|right_load_color_boxes
index|[
literal|2
index|]
argument_list|)
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
comment|/* Render saved color boxes */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRAD_NUM_COLORS
condition|;
name|i
operator|++
control|)
name|cpopup_update_saved_color
argument_list|(
name|gradient_editor
argument_list|,
name|i
argument_list|,
operator|&
name|gradient_editor
operator|->
name|saved_colors
index|[
name|i
index|]
argument_list|)
expr_stmt|;
comment|/* Adjust labels */
if|if
condition|(
name|gradient_editor
operator|->
name|control_sel_l
operator|==
name|gradient_editor
operator|->
name|control_sel_r
condition|)
block|{
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_blending_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Blending function for segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Coloring type for segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_split_m_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segment at midpoint"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_split_u_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segment uniformly"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_delete_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Delete segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_recenter_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-center segment's midpoint"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_redistribute_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-distribute handles in segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_flip_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Flip segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_replicate_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Replicate segment"
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_blending_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Blending function for selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Coloring type for selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_split_m_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segments at midpoints"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_split_u_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segments uniformly"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_delete_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Delete selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_recenter_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-center midpoints in selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_redistribute_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-distribute handles in selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_flip_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Flip selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|control_replicate_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Replicate selection"
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* Adjust blending and coloring menus */
name|cpopup_adjust_blending_menu
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|cpopup_adjust_coloring_menu
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/* Can invoke delete? */
if|if
condition|(
operator|(
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
operator|==
name|NULL
operator|)
operator|&&
operator|(
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|==
name|NULL
operator|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_delete_menu_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_delete_menu_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Can invoke blend colors / opacity? */
if|if
condition|(
name|gradient_editor
operator|->
name|control_sel_l
operator|==
name|gradient_editor
operator|->
name|control_sel_r
condition|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_blend_colors_menu_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_blend_opacity_menu_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_blend_colors_menu_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_blend_opacity_menu_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_adjust_blending_menu (GradientEditor * gradient_editor)
name|cpopup_adjust_blending_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gint
name|equal
decl_stmt|;
name|glong
name|i
decl_stmt|,
name|num_items
decl_stmt|;
name|gint
name|type
decl_stmt|;
name|cpopup_check_selection_params
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|equal
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Block activate signals */
name|num_items
operator|=
operator|(
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
literal|0
index|]
argument_list|)
operator|)
expr_stmt|;
name|type
operator|=
operator|(
name|int
operator|)
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|type
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_block_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/* Set state */
if|if
condition|(
name|equal
condition|)
block|{
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|type
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/* Unblock signals */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_unblock_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_adjust_coloring_menu (GradientEditor * gradient_editor)
name|cpopup_adjust_coloring_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gint
name|equal
decl_stmt|;
name|glong
name|i
decl_stmt|,
name|num_items
decl_stmt|;
name|gint
name|coloring
decl_stmt|;
name|cpopup_check_selection_params
argument_list|(
name|gradient_editor
argument_list|,
name|NULL
argument_list|,
operator|&
name|equal
argument_list|)
expr_stmt|;
comment|/* Block activate signals */
name|num_items
operator|=
operator|(
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
literal|0
index|]
argument_list|)
operator|)
expr_stmt|;
name|coloring
operator|=
operator|(
name|int
operator|)
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|color
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_block_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/* Set state */
if|if
condition|(
name|equal
condition|)
block|{
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|coloring
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_widget_show
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/* Unblock signals */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_unblock_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_check_selection_params (GradientEditor * gradient_editor,gint * equal_blending,gint * equal_coloring)
name|cpopup_check_selection_params
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
modifier|*
name|equal_blending
parameter_list|,
name|gint
modifier|*
name|equal_coloring
parameter_list|)
block|{
name|GimpGradientSegmentType
name|type
decl_stmt|;
name|GimpGradientSegmentColor
name|color
decl_stmt|;
name|gint
name|etype
decl_stmt|,
name|ecolor
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|type
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|type
expr_stmt|;
name|color
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|color
expr_stmt|;
name|etype
operator|=
literal|1
expr_stmt|;
name|ecolor
operator|=
literal|1
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|etype
operator|=
name|etype
operator|&&
operator|(
name|seg
operator|->
name|type
operator|==
name|type
operator|)
expr_stmt|;
name|ecolor
operator|=
name|ecolor
operator|&&
operator|(
name|seg
operator|->
name|color
operator|==
name|color
operator|)
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
if|if
condition|(
name|equal_blending
condition|)
operator|*
name|equal_blending
operator|=
name|etype
expr_stmt|;
if|if
condition|(
name|equal_coloring
condition|)
operator|*
name|equal_coloring
operator|=
name|ecolor
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_render_color_box (GtkPreview * preview,GimpRGB * color)
name|cpopup_render_color_box
parameter_list|(
name|GtkPreview
modifier|*
name|preview
parameter_list|,
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|guchar
name|rows
index|[
literal|3
index|]
index|[
name|GRAD_COLOR_BOX_WIDTH
operator|*
literal|3
index|]
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gint
name|r0
decl_stmt|,
name|g0
decl_stmt|,
name|b0
decl_stmt|;
name|gint
name|r1
decl_stmt|,
name|g1
decl_stmt|,
name|b1
decl_stmt|;
name|guchar
modifier|*
name|p0
decl_stmt|,
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
comment|/* Fill rows */
name|r0
operator|=
operator|(
name|GIMP_CHECK_DARK
operator|+
operator|(
name|color
operator|->
name|r
operator|-
name|GIMP_CHECK_DARK
operator|)
operator|*
name|color
operator|->
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|r1
operator|=
operator|(
name|GIMP_CHECK_LIGHT
operator|+
operator|(
name|color
operator|->
name|r
operator|-
name|GIMP_CHECK_LIGHT
operator|)
operator|*
name|color
operator|->
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|g0
operator|=
operator|(
name|GIMP_CHECK_DARK
operator|+
operator|(
name|color
operator|->
name|g
operator|-
name|GIMP_CHECK_DARK
operator|)
operator|*
name|color
operator|->
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|g1
operator|=
operator|(
name|GIMP_CHECK_LIGHT
operator|+
operator|(
name|color
operator|->
name|g
operator|-
name|GIMP_CHECK_LIGHT
operator|)
operator|*
name|color
operator|->
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|b0
operator|=
operator|(
name|GIMP_CHECK_DARK
operator|+
operator|(
name|color
operator|->
name|b
operator|-
name|GIMP_CHECK_DARK
operator|)
operator|*
name|color
operator|->
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|b1
operator|=
operator|(
name|GIMP_CHECK_LIGHT
operator|+
operator|(
name|color
operator|->
name|b
operator|-
name|GIMP_CHECK_LIGHT
operator|)
operator|*
name|color
operator|->
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|p0
operator|=
name|rows
index|[
literal|0
index|]
expr_stmt|;
name|p1
operator|=
name|rows
index|[
literal|1
index|]
expr_stmt|;
name|p2
operator|=
name|rows
index|[
literal|2
index|]
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|GRAD_COLOR_BOX_WIDTH
condition|;
name|x
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|x
operator|==
literal|0
operator|)
operator|||
operator|(
name|x
operator|==
operator|(
name|GRAD_COLOR_BOX_WIDTH
operator|-
literal|1
operator|)
operator|)
condition|)
block|{
operator|*
name|p0
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|x
operator|/
name|GIMP_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
block|{
operator|*
name|p0
operator|++
operator|=
name|r1
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|g1
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|b1
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|r0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|g0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|b0
expr_stmt|;
block|}
else|else
block|{
operator|*
name|p0
operator|++
operator|=
name|r0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|g0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|b0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|r1
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|g1
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|b1
expr_stmt|;
block|}
operator|*
name|p2
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p2
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p2
operator|++
operator|=
literal|0
expr_stmt|;
block|}
comment|/* Fill preview */
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|1
init|;
name|y
operator|<
operator|(
name|GRAD_COLOR_BOX_HEIGHT
operator|-
literal|1
operator|)
condition|;
name|y
operator|++
control|)
if|if
condition|(
operator|(
name|y
operator|/
name|GIMP_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
else|else
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Creale load& save menus *****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_load_menu (GradientEditor * gradient_editor,GtkWidget ** color_boxes,GtkWidget ** labels,gchar * label1,gchar * label2,GtkSignalFunc callback,gchar accel_key_0,guint8 accel_mods_0,gchar accel_key_1,guint8 accel_mods_1,gchar accel_key_2,guint8 accel_mods_2)
name|cpopup_create_load_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|gchar
modifier|*
name|label1
parameter_list|,
name|gchar
modifier|*
name|label2
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|,
name|gchar
name|accel_key_0
parameter_list|,
name|guint8
name|accel_mods_0
parameter_list|,
name|gchar
name|accel_key_1
parameter_list|,
name|guint8
name|accel_mods_1
parameter_list|,
name|gchar
name|accel_key_2
parameter_list|,
name|guint8
name|accel_mods_2
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|accel_group
operator|=
name|gradient_editor
operator|->
name|accel_group
expr_stmt|;
name|gtk_menu_set_accel_group
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
comment|/* Create items */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|GRAD_NUM_COLORS
operator|+
literal|3
operator|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
literal|3
condition|)
block|{
comment|/* Insert separator between "to fetch" and "saved" colors */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
block|}
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|color_boxes
index|[
name|i
index|]
argument_list|,
operator|&
name|labels
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|callback
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
name|accel_key_0
argument_list|,
name|accel_mods_0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
name|accel_key_1
argument_list|,
name|accel_mods_1
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
name|accel_key_2
argument_list|,
name|accel_mods_2
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
comment|/* Set labels */
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|labels
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|label1
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|labels
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|label2
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|labels
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"FG color"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_save_menu (GradientEditor * gradient_editor,GtkWidget ** color_boxes,GtkWidget ** labels,GtkSignalFunc callback)
name|cpopup_create_save_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRAD_NUM_COLORS
condition|;
name|i
operator|++
control|)
block|{
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|color_boxes
index|[
name|i
index|]
argument_list|,
operator|&
name|labels
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|callback
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
block|}
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_update_saved_color (GradientEditor * gradient_editor,gint n,GimpRGB * color)
name|cpopup_update_saved_color
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|gint
name|n
parameter_list|,
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|gchar
modifier|*
name|str
decl_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|left_load_color_boxes
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|left_save_color_boxes
index|[
name|n
index|]
argument_list|)
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|right_load_color_boxes
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|gradient_editor
operator|->
name|right_save_color_boxes
index|[
name|n
index|]
argument_list|)
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"RGBA (%0.3f, %0.3f, %0.3f, %0.3f)"
argument_list|)
argument_list|,
name|color
operator|->
name|r
argument_list|,
name|color
operator|->
name|g
argument_list|,
name|color
operator|->
name|b
argument_list|,
name|color
operator|->
name|a
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|left_load_labels
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|left_save_labels
index|[
name|n
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|right_load_labels
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|gradient_editor
operator|->
name|right_save_labels
index|[
name|n
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
name|n
index|]
operator|=
operator|*
name|color
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_load_left_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_load_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|GimpRGB
name|fg
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|i
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
comment|/* Fetch from left neighbor's right endpoint */
if|if
condition|(
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
else|else
name|seg
operator|=
name|gimp_gradient_segment_get_last
argument_list|(
name|gradient_editor
operator|->
name|control_sel_l
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|seg
operator|->
name|right_color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|/* Fetch from right endpoint */
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* Fetch from FG color */
name|gimp_context_get_foreground
argument_list|(
name|gimp_context_get_user
argument_list|()
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|fg
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Load a color */
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|saved_colors
index|[
name|i
operator|-
literal|3
index|]
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_save_left_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_save_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|i
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
name|i
index|]
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_load_right_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_load_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|GimpRGB
name|fg
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|i
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
comment|/* Fetch from right neighbor's left endpoint */
if|if
condition|(
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
else|else
name|seg
operator|=
name|gradient
operator|->
name|segments
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|left_color
argument_list|,
operator|&
name|seg
operator|->
name|left_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|/* Fetch from left endpoint */
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* Fetch from FG color */
name|gimp_context_get_foreground
argument_list|(
name|gimp_context_get_user
argument_list|()
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|,
operator|&
name|fg
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Load a color */
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|saved_colors
index|[
name|i
operator|-
literal|3
index|]
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_save_right_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_save_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|i
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|saved_colors
index|[
name|i
index|]
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GimpGradientSegment
modifier|*
DECL|function|cpopup_save_selection (GradientEditor * gradient_editor)
name|cpopup_save_selection
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|prev
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|oseg
decl_stmt|,
modifier|*
name|oaseg
decl_stmt|;
name|prev
operator|=
name|NULL
expr_stmt|;
name|oseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
do|do
block|{
name|seg
operator|=
name|gimp_gradient_segment_new
argument_list|()
expr_stmt|;
operator|*
name|seg
operator|=
operator|*
name|oseg
expr_stmt|;
comment|/* Copy everything */
if|if
condition|(
name|prev
operator|==
name|NULL
condition|)
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
else|else
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
name|oaseg
operator|=
name|oseg
expr_stmt|;
name|oseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
return|return
name|tmp
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_replace_selection (GradientEditor * gradient_editor,GimpGradientSegment * replace_seg)
name|cpopup_replace_selection
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpGradientSegment
modifier|*
name|replace_seg
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|replace_last
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
comment|/* Remember left and right segments */
name|lseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
name|replace_last
operator|=
name|gimp_gradient_segment_get_last
argument_list|(
name|replace_seg
argument_list|)
expr_stmt|;
comment|/* Free old selection */
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|gimp_gradient_segments_free
argument_list|(
name|gradient_editor
operator|->
name|control_sel_l
argument_list|)
expr_stmt|;
comment|/* Link in new segments */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|replace_seg
expr_stmt|;
else|else
name|gradient
operator|->
name|segments
operator|=
name|replace_seg
expr_stmt|;
name|replace_seg
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|replace_last
expr_stmt|;
name|replace_last
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|replace_seg
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|replace_last
expr_stmt|;
name|gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
block|}
end_function

begin_comment
comment|/***** Color dialogs for left and right endpoint *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_set_left_color_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_set_left_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|left_saved_dirty
operator|=
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
operator|->
name|dirty
expr_stmt|;
name|gradient_editor
operator|->
name|left_saved_segments
operator|=
name|cpopup_save_selection
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|color_notebook_new
argument_list|(
name|_
argument_list|(
literal|"Left Endpoint Color"
argument_list|)
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_left_color_changed
argument_list|,
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|instant_update
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_set_right_color_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_set_right_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|right_saved_dirty
operator|=
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
operator|->
name|dirty
expr_stmt|;
name|gradient_editor
operator|->
name|right_saved_segments
operator|=
name|cpopup_save_selection
argument_list|(
name|gradient_editor
argument_list|)
expr_stmt|;
name|color_notebook_new
argument_list|(
name|_
argument_list|(
literal|"Right Endpoint Color"
argument_list|)
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|right_color
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_right_color_changed
argument_list|,
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|instant_update
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_left_color_changed (ColorNotebook * cnb,const GimpRGB * color,ColorNotebookState state,gpointer data)
name|cpopup_left_color_changed
parameter_list|(
name|ColorNotebook
modifier|*
name|cnb
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|,
name|ColorNotebookState
name|state
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GradientEditor
modifier|*
name|gradient_editor
decl_stmt|;
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gradient_editor
operator|=
operator|(
name|GradientEditor
operator|*
operator|)
name|data
expr_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|COLOR_NOTEBOOK_OK
case|:
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|(
name|GimpRGB
operator|*
operator|)
name|color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_gradient_segments_free
argument_list|(
name|gradient_editor
operator|->
name|left_saved_segments
argument_list|)
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|color_notebook_free
argument_list|(
name|cnb
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|COLOR_NOTEBOOK_UPDATE
case|:
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|(
name|GimpRGB
operator|*
operator|)
name|color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|COLOR_NOTEBOOK_CANCEL
case|:
name|cpopup_replace_selection
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|left_saved_segments
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
operator|->
name|dirty
operator|=
name|gradient_editor
operator|->
name|left_saved_dirty
expr_stmt|;
name|color_notebook_free
argument_list|(
name|cnb
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_right_color_changed (ColorNotebook * cnb,const GimpRGB * color,ColorNotebookState state,gpointer data)
name|cpopup_right_color_changed
parameter_list|(
name|ColorNotebook
modifier|*
name|cnb
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|,
name|ColorNotebookState
name|state
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GradientEditor
modifier|*
name|gradient_editor
decl_stmt|;
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gradient_editor
operator|=
operator|(
name|GradientEditor
operator|*
operator|)
name|data
expr_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|state
condition|)
block|{
case|case
name|COLOR_NOTEBOOK_UPDATE
case|:
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|left_color
argument_list|,
operator|(
name|GimpRGB
operator|*
operator|)
name|color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|COLOR_NOTEBOOK_OK
case|:
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|left_color
argument_list|,
operator|(
name|GimpRGB
operator|*
operator|)
name|color
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_gradient_segments_free
argument_list|(
name|gradient_editor
operator|->
name|right_saved_segments
argument_list|)
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|color_notebook_free
argument_list|(
name|cnb
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|COLOR_NOTEBOOK_CANCEL
case|:
name|cpopup_replace_selection
argument_list|(
name|gradient_editor
argument_list|,
name|gradient_editor
operator|->
name|right_saved_segments
argument_list|)
expr_stmt|;
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
operator|->
name|dirty
operator|=
name|gradient_editor
operator|->
name|right_saved_dirty
expr_stmt|;
name|color_notebook_free
argument_list|(
name|cnb
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Blending menu *****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_blending_menu (GradientEditor * gradient_editor)
name|cpopup_create_blending_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|num_items
decl_stmt|;
specifier|static
specifier|const
name|gchar
modifier|*
name|blending_types
index|[]
init|=
block|{
name|N_
argument_list|(
literal|"Linear"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Curved"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Sinusoidal"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Spherical (increasing)"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Spherical (decreasing)"
argument_list|)
block|}
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|group
operator|=
name|NULL
expr_stmt|;
name|num_items
operator|=
operator|(
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
literal|0
index|]
argument_list|)
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
operator|(
name|num_items
operator|-
literal|1
operator|)
condition|)
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"(Varies)"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|gettext
argument_list|(
name|blending_types
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_menu_item_group
argument_list|(
name|GTK_RADIO_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_blending_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
operator|=
name|menuitem
expr_stmt|;
block|}
comment|/* "Varies" is always disabled */
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_blending_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_blending_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegmentType
name|type
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
return|return;
comment|/* Do nothing if the menu item is being deactivated */
name|type
operator|=
operator|(
name|GimpGradientSegmentType
operator|)
name|GPOINTER_TO_INT
argument_list|(
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Coloring menu *****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_coloring_menu (GradientEditor * gradient_editor)
name|cpopup_create_coloring_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|num_items
decl_stmt|;
specifier|static
specifier|const
name|gchar
modifier|*
name|coloring_types
index|[]
init|=
block|{
name|N_
argument_list|(
literal|"Plain RGB"
argument_list|)
block|,
name|N_
argument_list|(
literal|"HSV (counter-clockwise hue)"
argument_list|)
block|,
name|N_
argument_list|(
literal|"HSV (clockwise hue)"
argument_list|)
block|}
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|group
operator|=
name|NULL
expr_stmt|;
name|num_items
operator|=
operator|(
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
literal|0
index|]
argument_list|)
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
operator|(
name|num_items
operator|-
literal|1
operator|)
condition|)
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"(Varies)"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|gettext
argument_list|(
name|coloring_types
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_menu_item_group
argument_list|(
name|GTK_RADIO_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_coloring_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
operator|=
name|menuitem
expr_stmt|;
block|}
comment|/* "Varies" is always disabled */
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_coloring_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_coloring_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegmentColor
name|color
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
return|return;
comment|/* Do nothing if the menu item is being deactivated */
name|color
operator|=
operator|(
name|GimpGradientSegmentColor
operator|)
name|GPOINTER_TO_INT
argument_list|(
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|color
operator|=
name|color
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_midpoint_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_split_midpoint_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|cpopup_split_midpoint
argument_list|(
name|gradient
argument_list|,
name|seg
argument_list|,
operator|&
name|lseg
argument_list|,
operator|&
name|rseg
argument_list|)
expr_stmt|;
name|seg
operator|=
name|rseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|lseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|rseg
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_split_midpoint (GimpGradient * gradient,GimpGradientSegment * lseg,GimpGradientSegment ** newl,GimpGradientSegment ** newr)
name|cpopup_split_midpoint
parameter_list|(
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GimpGradientSegment
modifier|*
name|lseg
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newl
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newr
parameter_list|)
block|{
name|GimpRGB
name|color
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|newseg
decl_stmt|;
comment|/* Get color at original segment's midpoint */
name|gimp_gradient_get_color_at
argument_list|(
name|gradient
argument_list|,
name|lseg
operator|->
name|middle
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
comment|/* Create a new segment and insert it in the list */
name|newseg
operator|=
name|gimp_gradient_segment_new
argument_list|()
expr_stmt|;
name|newseg
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
name|newseg
operator|->
name|next
operator|=
name|lseg
operator|->
name|next
expr_stmt|;
name|lseg
operator|->
name|next
operator|=
name|newseg
expr_stmt|;
if|if
condition|(
name|newseg
operator|->
name|next
condition|)
name|newseg
operator|->
name|next
operator|->
name|prev
operator|=
name|newseg
expr_stmt|;
comment|/* Set coordinates of new segment */
name|newseg
operator|->
name|left
operator|=
name|lseg
operator|->
name|middle
expr_stmt|;
name|newseg
operator|->
name|right
operator|=
name|lseg
operator|->
name|right
expr_stmt|;
name|newseg
operator|->
name|middle
operator|=
operator|(
name|newseg
operator|->
name|left
operator|+
name|newseg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
comment|/* Set coordinates of original segment */
name|lseg
operator|->
name|right
operator|=
name|newseg
operator|->
name|left
expr_stmt|;
name|lseg
operator|->
name|middle
operator|=
operator|(
name|lseg
operator|->
name|left
operator|+
name|lseg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
comment|/* Set colors of both segments */
name|newseg
operator|->
name|right_color
operator|=
name|lseg
operator|->
name|right_color
expr_stmt|;
name|lseg
operator|->
name|right_color
operator|.
name|r
operator|=
name|newseg
operator|->
name|left_color
operator|.
name|r
operator|=
name|color
operator|.
name|r
expr_stmt|;
name|lseg
operator|->
name|right_color
operator|.
name|g
operator|=
name|newseg
operator|->
name|left_color
operator|.
name|g
operator|=
name|color
operator|.
name|g
expr_stmt|;
name|lseg
operator|->
name|right_color
operator|.
name|b
operator|=
name|newseg
operator|->
name|left_color
operator|.
name|b
operator|=
name|color
operator|.
name|b
expr_stmt|;
name|lseg
operator|->
name|right_color
operator|.
name|a
operator|=
name|newseg
operator|->
name|left_color
operator|.
name|a
operator|=
name|color
operator|.
name|a
expr_stmt|;
comment|/* Set parameters of new segment */
name|newseg
operator|->
name|type
operator|=
name|lseg
operator|->
name|type
expr_stmt|;
name|newseg
operator|->
name|color
operator|=
name|lseg
operator|->
name|color
expr_stmt|;
comment|/* Done */
operator|*
name|newl
operator|=
name|lseg
expr_stmt|;
operator|*
name|newr
operator|=
name|newseg
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_split_uniform_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkObject
modifier|*
name|scale_data
decl_stmt|;
comment|/*  Create dialog window  */
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
operator|(
name|gradient_editor
operator|->
name|control_sel_l
operator|==
name|gradient_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"Split segment uniformly"
argument_list|)
else|:
name|_
argument_list|(
literal|"Split segments uniformly"
argument_list|)
argument_list|,
literal|"gradient_segment_split_uniformly"
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"dialogs/gradient_editor/split_segments_uniformly.html"
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Split"
argument_list|)
argument_list|,
name|cpopup_split_uniform_split_callback
argument_list|,
name|gradient_editor
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
name|cpopup_split_uniform_cancel_callback
argument_list|,
name|gradient_editor
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  The main vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  Instructions  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Please select the number of uniform parts"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
operator|(
name|gradient_editor
operator|->
name|control_sel_l
operator|==
name|gradient_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"in which you want to split the selected segment"
argument_list|)
else|:
name|_
argument_list|(
literal|"in which you want to split the segments in the selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/*  Scale  */
name|gradient_editor
operator|->
name|split_parts
operator|=
literal|2
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|2.0
argument_list|,
literal|2.0
argument_list|,
literal|21.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|scale
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|scale_data
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_split_uniform_scale_update
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/*  Show!  */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_scale_update (GtkAdjustment * adjustment,GradientEditor * gradient_editor)
name|cpopup_split_uniform_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gradient_editor
operator|->
name|split_parts
operator|=
name|ROUND
argument_list|(
name|adjustment
operator|->
name|value
operator|+
literal|0.5
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_split_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_split_uniform_split_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|,
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|,
modifier|*
name|lsel
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
name|lsel
operator|=
name|NULL
expr_stmt|;
do|do
block|{
name|aseg
operator|=
name|seg
expr_stmt|;
name|cpopup_split_uniform
argument_list|(
name|gradient
argument_list|,
name|seg
argument_list|,
name|gradient_editor
operator|->
name|split_parts
argument_list|,
operator|&
name|lseg
argument_list|,
operator|&
name|rseg
argument_list|)
expr_stmt|;
if|if
condition|(
name|seg
operator|==
name|gradient_editor
operator|->
name|control_sel_l
condition|)
name|lsel
operator|=
name|lseg
expr_stmt|;
name|seg
operator|=
name|rseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|lsel
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|rseg
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_cancel_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_split_uniform_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform (GimpGradient * gradient,GimpGradientSegment * lseg,gint parts,GimpGradientSegment ** newl,GimpGradientSegment ** newr)
name|cpopup_split_uniform
parameter_list|(
name|GimpGradient
modifier|*
name|gradient
parameter_list|,
name|GimpGradientSegment
modifier|*
name|lseg
parameter_list|,
name|gint
name|parts
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newl
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|newr
parameter_list|)
block|{
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|prev
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|gdouble
name|seg_len
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|seg_len
operator|=
operator|(
name|lseg
operator|->
name|right
operator|-
name|lseg
operator|->
name|left
operator|)
operator|/
name|parts
expr_stmt|;
comment|/* Length of divisions */
name|seg
operator|=
name|NULL
expr_stmt|;
name|prev
operator|=
name|NULL
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|parts
condition|;
name|i
operator|++
control|)
block|{
name|seg
operator|=
name|gimp_gradient_segment_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
name|seg
operator|->
name|left
operator|=
name|lseg
operator|->
name|left
operator|+
name|i
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|lseg
operator|->
name|left
operator|+
operator|(
name|i
operator|+
literal|1
operator|)
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
operator|(
name|seg
operator|->
name|left
operator|+
name|seg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
name|gimp_gradient_get_color_at
argument_list|(
name|gradient
argument_list|,
name|seg
operator|->
name|left
argument_list|,
operator|&
name|seg
operator|->
name|left_color
argument_list|)
expr_stmt|;
name|gimp_gradient_get_color_at
argument_list|(
name|gradient
argument_list|,
name|seg
operator|->
name|right
argument_list|,
operator|&
name|seg
operator|->
name|right_color
argument_list|)
expr_stmt|;
name|seg
operator|->
name|type
operator|=
name|lseg
operator|->
name|type
expr_stmt|;
name|seg
operator|->
name|color
operator|=
name|lseg
operator|->
name|color
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
block|}
comment|/* Fix edges */
name|tmp
operator|->
name|left_color
operator|=
name|lseg
operator|->
name|left_color
expr_stmt|;
name|seg
operator|->
name|right_color
operator|=
name|lseg
operator|->
name|right_color
expr_stmt|;
name|tmp
operator|->
name|left
operator|=
name|lseg
operator|->
name|left
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|lseg
operator|->
name|right
expr_stmt|;
comment|/* To squish accumulative error */
comment|/* Link in list */
name|tmp
operator|->
name|prev
operator|=
name|lseg
operator|->
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|lseg
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|lseg
operator|->
name|prev
condition|)
name|lseg
operator|->
name|prev
operator|->
name|next
operator|=
name|tmp
expr_stmt|;
else|else
name|gradient
operator|->
name|segments
operator|=
name|tmp
expr_stmt|;
comment|/* We are on leftmost segment */
if|if
condition|(
name|lseg
operator|->
name|next
condition|)
name|lseg
operator|->
name|next
operator|->
name|prev
operator|=
name|seg
expr_stmt|;
name|gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
comment|/* Done */
operator|*
name|newl
operator|=
name|tmp
expr_stmt|;
operator|*
name|newr
operator|=
name|seg
expr_stmt|;
comment|/* Delete old segment */
name|gimp_gradient_segment_free
argument_list|(
name|lseg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_delete_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|,
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|double
name|join
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
comment|/* Remember segments to the left and to the right of the selection */
name|lseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
comment|/* Cannot delete all the segments in the gradient */
if|if
condition|(
operator|(
name|lseg
operator|==
name|NULL
operator|)
operator|&&
operator|(
name|rseg
operator|==
name|NULL
operator|)
condition|)
return|return;
comment|/* Calculate join point */
name|join
operator|=
operator|(
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
operator|+
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
if|if
condition|(
name|lseg
operator|==
name|NULL
condition|)
name|join
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|rseg
operator|==
name|NULL
condition|)
name|join
operator|=
literal|1.0
expr_stmt|;
comment|/* Move segments */
if|if
condition|(
name|lseg
operator|!=
name|NULL
condition|)
name|control_compress_range
argument_list|(
name|lseg
argument_list|,
name|lseg
argument_list|,
name|lseg
operator|->
name|left
argument_list|,
name|join
argument_list|)
expr_stmt|;
if|if
condition|(
name|rseg
operator|!=
name|NULL
condition|)
name|control_compress_range
argument_list|(
name|rseg
argument_list|,
name|rseg
argument_list|,
name|join
argument_list|,
name|rseg
operator|->
name|right
argument_list|)
expr_stmt|;
comment|/* Link */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
comment|/* Delete old segments */
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|next
operator|=
name|seg
operator|->
name|next
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|gimp_gradient_segment_free
argument_list|(
name|seg
argument_list|)
expr_stmt|;
name|seg
operator|=
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
comment|/* Change selection */
if|if
condition|(
name|rseg
condition|)
block|{
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|rseg
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|rseg
expr_stmt|;
block|}
else|else
block|{
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|lseg
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|lseg
expr_stmt|;
block|}
if|if
condition|(
name|lseg
operator|==
name|NULL
condition|)
name|gradient
operator|->
name|segments
operator|=
name|rseg
expr_stmt|;
comment|/* Done */
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_recenter_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_recenter_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|middle
operator|=
operator|(
name|seg
operator|->
name|left
operator|+
name|seg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_redistribute_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_redistribute_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|gdouble
name|left
decl_stmt|,
name|right
decl_stmt|,
name|seg_len
decl_stmt|;
name|gint
name|num_segs
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
comment|/* Count number of segments in selection */
name|num_segs
operator|=
literal|0
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|num_segs
operator|++
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
comment|/* Calculate new segment length */
name|left
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|right
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
expr_stmt|;
name|seg_len
operator|=
operator|(
name|right
operator|-
name|left
operator|)
operator|/
name|num_segs
expr_stmt|;
comment|/* Redistribute */
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_segs
condition|;
name|i
operator|++
control|)
block|{
name|seg
operator|->
name|left
operator|=
name|left
operator|+
name|i
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|left
operator|+
operator|(
name|i
operator|+
literal|1
operator|)
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
operator|(
name|seg
operator|->
name|left
operator|+
name|seg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* Fix endpoints to squish accumulative error */
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
operator|=
name|left
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|=
name|right
expr_stmt|;
comment|/* Done */
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Control popup -> selection options functions *****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_sel_ops_menu (GradientEditor * gradient_editor)
name|cpopup_create_sel_ops_menu
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|accel_group
operator|=
name|gradient_editor
operator|->
name|accel_group
expr_stmt|;
name|gtk_menu_set_accel_group
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
comment|/* Flip */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_flip_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_flip_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Replicate */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_replicate_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_replicate_callback
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'M'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Blend colors / opacity */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Blend endpoints' colors"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_blend_colors
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_blend_colors_menu_item
operator|=
name|menuitem
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'B'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Blend endpoints' opacity"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_blend_opacity
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'B'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|gradient_editor
operator|->
name|control_blend_opacity_menu_item
operator|=
name|menuitem
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_flip_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_flip_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|oseg
decl_stmt|,
modifier|*
name|oaseg
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|,
modifier|*
name|prev
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|gdouble
name|left
decl_stmt|,
name|right
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|left
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|right
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
expr_stmt|;
comment|/* Build flipped segments */
name|prev
operator|=
name|NULL
expr_stmt|;
name|oseg
operator|=
name|gradient_editor
operator|->
name|control_sel_r
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
do|do
block|{
name|seg
operator|=
name|gimp_gradient_segment_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|prev
operator|==
name|NULL
condition|)
block|{
name|seg
operator|->
name|left
operator|=
name|left
expr_stmt|;
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
block|}
else|else
name|seg
operator|->
name|left
operator|=
name|left
operator|+
name|right
operator|-
name|oseg
operator|->
name|right
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|left
operator|+
name|right
operator|-
name|oseg
operator|->
name|middle
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|left
operator|+
name|right
operator|-
name|oseg
operator|->
name|left
expr_stmt|;
name|seg
operator|->
name|left_color
operator|=
name|oseg
operator|->
name|right_color
expr_stmt|;
name|seg
operator|->
name|right_color
operator|=
name|oseg
operator|->
name|left_color
expr_stmt|;
switch|switch
condition|(
name|oseg
operator|->
name|type
condition|)
block|{
case|case
name|GRAD_SPHERE_INCREASING
case|:
name|seg
operator|->
name|type
operator|=
name|GRAD_SPHERE_DECREASING
expr_stmt|;
break|break;
case|case
name|GRAD_SPHERE_DECREASING
case|:
name|seg
operator|->
name|type
operator|=
name|GRAD_SPHERE_INCREASING
expr_stmt|;
break|break;
default|default:
name|seg
operator|->
name|type
operator|=
name|oseg
operator|->
name|type
expr_stmt|;
block|}
switch|switch
condition|(
name|oseg
operator|->
name|color
condition|)
block|{
case|case
name|GRAD_HSV_CCW
case|:
name|seg
operator|->
name|color
operator|=
name|GRAD_HSV_CW
expr_stmt|;
break|break;
case|case
name|GRAD_HSV_CW
case|:
name|seg
operator|->
name|color
operator|=
name|GRAD_HSV_CCW
expr_stmt|;
break|break;
default|default:
name|seg
operator|->
name|color
operator|=
name|oseg
operator|->
name|color
expr_stmt|;
block|}
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
name|oaseg
operator|=
name|oseg
expr_stmt|;
name|oseg
operator|=
name|oseg
operator|->
name|prev
expr_stmt|;
comment|/* Move backwards! */
block|}
do|while
condition|(
name|oaseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_l
condition|)
do|;
name|seg
operator|->
name|right
operator|=
name|right
expr_stmt|;
comment|/* Squish accumulative error */
comment|/* Free old segments */
name|lseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
name|oseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|oaseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
name|gimp_gradient_segment_free
argument_list|(
name|oseg
argument_list|)
expr_stmt|;
name|oseg
operator|=
name|oaseg
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|rseg
condition|)
do|;
comment|/* Link in new segments */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|tmp
expr_stmt|;
else|else
name|gradient
operator|->
name|segments
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|seg
expr_stmt|;
comment|/* Reset selection */
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|tmp
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
comment|/* Done */
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_replicate_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkObject
modifier|*
name|scale_data
decl_stmt|;
comment|/*  Create dialog window  */
name|dialog
operator|=
name|gimp_dialog_new
argument_list|(
operator|(
name|gradient_editor
operator|->
name|control_sel_l
operator|==
name|gradient_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"Replicate segment"
argument_list|)
else|:
name|_
argument_list|(
literal|"Replicate selection"
argument_list|)
argument_list|,
literal|"gradient_segment_replicate"
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"dialogs/gradient_editor/replicate_segment.html"
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Replicate"
argument_list|)
argument_list|,
name|cpopup_do_replicate_callback
argument_list|,
name|gradient_editor
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
name|cpopup_replicate_cancel_callback
argument_list|,
name|gradient_editor
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  Instructions  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Please select the number of times"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
operator|(
name|gradient_editor
operator|->
name|control_sel_l
operator|==
name|gradient_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"you want to replicate the selected segment"
argument_list|)
else|:
name|_
argument_list|(
literal|"you want to replicate the selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/*  Scale  */
name|gradient_editor
operator|->
name|replicate_times
operator|=
literal|2
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|2.0
argument_list|,
literal|2.0
argument_list|,
literal|21.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|scale
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|scale_data
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|cpopup_replicate_scale_update
argument_list|)
argument_list|,
name|gradient_editor
argument_list|)
expr_stmt|;
comment|/*  Show!  */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_replicate_scale_update (GtkAdjustment * adjustment,GradientEditor * gradient_editor)
name|cpopup_replicate_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gradient_editor
operator|->
name|replicate_times
operator|=
call|(
name|int
call|)
argument_list|(
name|adjustment
operator|->
name|value
operator|+
literal|0.5
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_do_replicate_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_do_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
name|gdouble
name|sel_left
decl_stmt|,
name|sel_right
decl_stmt|,
name|sel_len
decl_stmt|;
name|gdouble
name|new_left
decl_stmt|;
name|gdouble
name|factor
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|prev
decl_stmt|,
modifier|*
name|seg
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|oseg
decl_stmt|,
modifier|*
name|oaseg
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gradient
operator|=
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Remember original parameters */
name|sel_left
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|sel_right
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
expr_stmt|;
name|sel_len
operator|=
name|sel_right
operator|-
name|sel_left
expr_stmt|;
name|factor
operator|=
literal|1.0
operator|/
name|gradient_editor
operator|->
name|replicate_times
expr_stmt|;
comment|/* Build replicated segments */
name|prev
operator|=
name|NULL
expr_stmt|;
name|seg
operator|=
name|NULL
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|gradient_editor
operator|->
name|replicate_times
condition|;
name|i
operator|++
control|)
block|{
comment|/* Build one cycle */
name|new_left
operator|=
name|sel_left
operator|+
name|i
operator|*
name|factor
operator|*
name|sel_len
expr_stmt|;
name|oseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|=
name|gimp_gradient_segment_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|prev
operator|==
name|NULL
condition|)
block|{
name|seg
operator|->
name|left
operator|=
name|sel_left
expr_stmt|;
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
block|}
else|else
name|seg
operator|->
name|left
operator|=
name|new_left
operator|+
name|factor
operator|*
operator|(
name|oseg
operator|->
name|left
operator|-
name|sel_left
operator|)
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|new_left
operator|+
name|factor
operator|*
operator|(
name|oseg
operator|->
name|middle
operator|-
name|sel_left
operator|)
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|new_left
operator|+
name|factor
operator|*
operator|(
name|oseg
operator|->
name|right
operator|-
name|sel_left
operator|)
expr_stmt|;
name|seg
operator|->
name|left_color
operator|=
name|oseg
operator|->
name|right_color
expr_stmt|;
name|seg
operator|->
name|right_color
operator|=
name|oseg
operator|->
name|right_color
expr_stmt|;
name|seg
operator|->
name|type
operator|=
name|oseg
operator|->
name|type
expr_stmt|;
name|seg
operator|->
name|color
operator|=
name|oseg
operator|->
name|color
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
name|oaseg
operator|=
name|oseg
expr_stmt|;
name|oseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
block|}
name|seg
operator|->
name|right
operator|=
name|sel_right
expr_stmt|;
comment|/* Squish accumulative error */
comment|/* Free old segments */
name|lseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
name|oseg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|oaseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
name|gimp_gradient_segment_free
argument_list|(
name|oseg
argument_list|)
expr_stmt|;
name|oseg
operator|=
name|oaseg
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|rseg
condition|)
do|;
comment|/* Link in new segments */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|tmp
expr_stmt|;
else|else
name|gradient
operator|->
name|segments
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|seg
expr_stmt|;
comment|/* Reset selection */
name|gradient_editor
operator|->
name|control_sel_l
operator|=
name|tmp
expr_stmt|;
name|gradient_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
comment|/* Done */
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_replicate_cancel_callback (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_replicate_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|gtk_widget_get_toplevel
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_blend_colors (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_blend_colors
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cpopup_blend_opacity (GtkWidget * widget,GradientEditor * gradient_editor)
name|cpopup_blend_opacity
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|)
block|{
name|cpopup_blend_endpoints
argument_list|(
name|gradient_editor
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left_color
argument_list|,
operator|&
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right_color
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_data_dirty
argument_list|(
name|GIMP_DATA
argument_list|(
name|gimp_context_get_gradient
argument_list|(
name|gradient_editor
operator|->
name|context
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|gradient_editor
argument_list|,
name|GRAD_UPDATE_GRADIENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***** Main blend function *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_blend_endpoints (GradientEditor * gradient_editor,GimpRGB * rgb1,GimpRGB * rgb2,gboolean blend_colors,gboolean blend_opacity)
name|cpopup_blend_endpoints
parameter_list|(
name|GradientEditor
modifier|*
name|gradient_editor
parameter_list|,
name|GimpRGB
modifier|*
name|rgb1
parameter_list|,
name|GimpRGB
modifier|*
name|rgb2
parameter_list|,
name|gboolean
name|blend_colors
parameter_list|,
name|gboolean
name|blend_opacity
parameter_list|)
block|{
name|GimpRGB
name|d
decl_stmt|;
name|gdouble
name|left
decl_stmt|,
name|len
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|aseg
decl_stmt|;
name|d
operator|.
name|r
operator|=
name|rgb2
operator|->
name|r
operator|-
name|rgb1
operator|->
name|r
expr_stmt|;
name|d
operator|.
name|g
operator|=
name|rgb2
operator|->
name|g
operator|-
name|rgb1
operator|->
name|g
expr_stmt|;
name|d
operator|.
name|b
operator|=
name|rgb2
operator|->
name|b
operator|-
name|rgb1
operator|->
name|b
expr_stmt|;
name|d
operator|.
name|a
operator|=
name|rgb2
operator|->
name|a
operator|-
name|rgb1
operator|->
name|a
expr_stmt|;
name|left
operator|=
name|gradient_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|len
operator|=
name|gradient_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|-
name|left
expr_stmt|;
name|seg
operator|=
name|gradient_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
if|if
condition|(
name|blend_colors
condition|)
block|{
name|seg
operator|->
name|left_color
operator|.
name|r
operator|=
name|rgb1
operator|->
name|r
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|r
expr_stmt|;
name|seg
operator|->
name|left_color
operator|.
name|g
operator|=
name|rgb1
operator|->
name|g
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|g
expr_stmt|;
name|seg
operator|->
name|left_color
operator|.
name|b
operator|=
name|rgb1
operator|->
name|b
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|b
expr_stmt|;
name|seg
operator|->
name|right_color
operator|.
name|r
operator|=
name|rgb1
operator|->
name|r
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|r
expr_stmt|;
name|seg
operator|->
name|right_color
operator|.
name|g
operator|=
name|rgb1
operator|->
name|g
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|g
expr_stmt|;
name|seg
operator|->
name|right_color
operator|.
name|b
operator|=
name|rgb1
operator|->
name|b
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|b
expr_stmt|;
block|}
if|if
condition|(
name|blend_opacity
condition|)
block|{
name|seg
operator|->
name|left_color
operator|.
name|a
operator|=
name|rgb1
operator|->
name|a
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|a
expr_stmt|;
name|seg
operator|->
name|right_color
operator|.
name|a
operator|=
name|rgb1
operator|->
name|a
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|d
operator|.
name|a
expr_stmt|;
block|}
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|gradient_editor
operator|->
name|control_sel_r
condition|)
do|;
block|}
end_function

begin_comment
comment|/***** Segment functions *****/
end_comment

begin_function
specifier|static
name|void
DECL|function|seg_get_closest_handle (GimpGradient * grad,gdouble pos,GimpGradientSegment ** seg,control_drag_mode_t * handle)
name|seg_get_closest_handle
parameter_list|(
name|GimpGradient
modifier|*
name|grad
parameter_list|,
name|gdouble
name|pos
parameter_list|,
name|GimpGradientSegment
modifier|*
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
modifier|*
name|handle
parameter_list|)
block|{
name|gdouble
name|l_delta
decl_stmt|,
name|m_delta
decl_stmt|,
name|r_delta
decl_stmt|;
operator|*
name|seg
operator|=
name|gimp_gradient_get_segment_at
argument_list|(
name|grad
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|m_delta
operator|=
name|fabs
argument_list|(
name|pos
operator|-
operator|(
operator|*
name|seg
operator|)
operator|->
name|middle
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|<
operator|(
operator|*
name|seg
operator|)
operator|->
name|middle
condition|)
block|{
name|l_delta
operator|=
name|fabs
argument_list|(
name|pos
operator|-
operator|(
operator|*
name|seg
operator|)
operator|->
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_delta
operator|<
name|m_delta
condition|)
operator|*
name|handle
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
else|else
operator|*
name|handle
operator|=
name|GRAD_DRAG_MIDDLE
expr_stmt|;
block|}
else|else
block|{
name|r_delta
operator|=
name|fabs
argument_list|(
name|pos
operator|-
operator|(
operator|*
name|seg
operator|)
operator|->
name|right
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_delta
operator|<
name|r_delta
condition|)
block|{
operator|*
name|handle
operator|=
name|GRAD_DRAG_MIDDLE
expr_stmt|;
block|}
else|else
block|{
operator|*
name|seg
operator|=
operator|(
operator|*
name|seg
operator|)
operator|->
name|next
expr_stmt|;
operator|*
name|handle
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
block|}
block|}
block|}
end_function

end_unit

