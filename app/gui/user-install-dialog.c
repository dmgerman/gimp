begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  * Copyright (C) 2000 Michael Natterer and Sven Neumann  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<glib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"apptypes.h"
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay_ops.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"gimpui.h"
end_include

begin_include
include|#
directive|include
file|"resolution_calibrate.h"
end_include

begin_include
include|#
directive|include
file|"unitrc.h"
end_include

begin_include
include|#
directive|include
file|"user_install.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpenv.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimplimits.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_include
include|#
directive|include
file|"pixmaps/eek.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/folder.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/new.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/wilber.xpm"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|G_OS_WIN32
end_ifndef

begin_ifndef
ifndef|#
directive|ifndef
name|__EMX__
end_ifndef

begin_define
DECL|macro|USER_INSTALL
define|#
directive|define
name|USER_INSTALL
value|"user_install"
end_define

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<process.h>
end_include

begin_define
DECL|macro|USER_INSTALL
define|#
directive|define
name|USER_INSTALL
value|"user_install.cmd"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_else
else|#
directive|else
end_else

begin_define
DECL|macro|STRICT
define|#
directive|define
name|STRICT
end_define

begin_include
include|#
directive|include
file|<windows.h>
end_include

begin_define
DECL|macro|USER_INSTALL
define|#
directive|define
name|USER_INSTALL
value|"user_install.bat"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|NUM_PAGES
define|#
directive|define
name|NUM_PAGES
value|6
end_define

begin_define
DECL|macro|EEK_PAGE
define|#
directive|define
name|EEK_PAGE
value|(NUM_PAGES - 1)
end_define

begin_define
DECL|macro|WILBER_WIDTH
define|#
directive|define
name|WILBER_WIDTH
value|62
end_define

begin_define
DECL|macro|PAGE_STYLE (widget)
define|#
directive|define
name|PAGE_STYLE
parameter_list|(
name|widget
parameter_list|)
value|gtk_widget_set_style (widget, page_style)
end_define

begin_define
DECL|macro|TITLE_STYLE (widget)
define|#
directive|define
name|TITLE_STYLE
parameter_list|(
name|widget
parameter_list|)
value|gtk_widget_set_style (widget, title_style)
end_define

begin_function_decl
specifier|static
name|void
name|user_install_dialog_create
parameter_list|(
name|UserInstallCallback
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_continue_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|user_install_run
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_tuning
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_tuning_done
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_resolution
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_resolution_done
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
DECL|function|user_install_verify (UserInstallCallback user_install_callback)
name|user_install_verify
parameter_list|(
name|UserInstallCallback
name|user_install_callback
parameter_list|)
block|{
name|gboolean
name|properly_installed
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|struct
name|stat
name|stat_buf
decl_stmt|;
comment|/* gimp_directory now always returns something */
name|filename
operator|=
name|gimp_directory
argument_list|()
expr_stmt|;
if|if
condition|(
name|stat
argument_list|(
name|filename
argument_list|,
operator|&
name|stat_buf
argument_list|)
operator|!=
literal|0
condition|)
name|properly_installed
operator|=
name|FALSE
expr_stmt|;
comment|/*  If there is already a proper installation, invoke the callback  */
if|if
condition|(
name|properly_installed
condition|)
block|{
call|(
modifier|*
name|user_install_callback
call|)
argument_list|()
expr_stmt|;
block|}
comment|/*  Otherwise, prepare for installation  */
elseif|else
if|if
condition|(
name|no_interface
condition|)
block|{
name|g_print
argument_list|(
name|_
argument_list|(
literal|"The GIMP is not properly installed for the current user\n"
argument_list|)
argument_list|)
expr_stmt|;
name|g_print
argument_list|(
name|_
argument_list|(
literal|"User installation was skipped because the '--nointerface' flag was encountered\n"
argument_list|)
argument_list|)
expr_stmt|;
name|g_print
argument_list|(
name|_
argument_list|(
literal|"To perform user installation, run the GIMP without the '--nointerface' flag\n"
argument_list|)
argument_list|)
expr_stmt|;
call|(
modifier|*
name|user_install_callback
call|)
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|user_install_dialog_create
argument_list|(
name|user_install_callback
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  private stuff  */
end_comment

begin_decl_stmt
DECL|variable|user_install_dialog
specifier|static
name|GtkWidget
modifier|*
name|user_install_dialog
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|notebook
specifier|static
name|GtkWidget
modifier|*
name|notebook
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_pixmap
specifier|static
name|GtkWidget
modifier|*
name|title_pixmap
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_label
specifier|static
name|GtkWidget
modifier|*
name|title_label
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|footer_label
specifier|static
name|GtkWidget
modifier|*
name|footer_label
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|log_page
specifier|static
name|GtkWidget
modifier|*
name|log_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tuning_page
specifier|static
name|GtkWidget
modifier|*
name|tuning_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|resolution_page
specifier|static
name|GtkWidget
modifier|*
name|resolution_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|continue_button
specifier|static
name|GtkWidget
modifier|*
name|continue_button
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|cancel_button
specifier|static
name|GtkWidget
modifier|*
name|cancel_button
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_style
specifier|static
name|GtkStyle
modifier|*
name|title_style
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|page_style
specifier|static
name|GtkStyle
modifier|*
name|page_style
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|colormap
specifier|static
name|GdkColormap
modifier|*
name|colormap
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|white_gc
specifier|static
name|GdkGC
modifier|*
name|white_gc
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|black_color
specifier|static
name|GdkColor
name|black_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|white_color
specifier|static
name|GdkColor
name|white_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_color
specifier|static
name|GdkColor
name|title_color
decl_stmt|;
end_decl_stmt

begin_struct
specifier|static
struct|struct
DECL|struct|__anon27ba69c30108
block|{
DECL|member|directory
name|gboolean
name|directory
decl_stmt|;
DECL|member|text
name|gchar
modifier|*
name|text
decl_stmt|;
DECL|member|description
name|gchar
modifier|*
name|description
decl_stmt|;
block|}
DECL|variable|tree_items
name|tree_items
index|[]
init|=
block|{
block|{
name|FALSE
block|,
literal|"gimprc"
block|,
name|N_
argument_list|(
literal|"The gimprc is used to store personal preferences\n"
literal|"that affect GIMP's default behavior.\n"
literal|"Paths to search for brushes, palettes, gradients,\n"
literal|"patterns, plug-ins and modules can also configured\n"
literal|"here."
argument_list|)
block|}
block|,
block|{
name|FALSE
block|,
literal|"gtkrc"
block|,
name|N_
argument_list|(
literal|"GIMP uses an additional gtkrc file so you can\n"
literal|"configure it to look differently than other GTK apps."
argument_list|)
block|}
block|,
block|{
name|FALSE
block|,
literal|"pluginrc"
block|,
name|N_
argument_list|(
literal|"Plug-ins and extensions are external programs run\n"
literal|"by the GIMP which provide additional functionality.\n"
literal|"These programs are searched for at run-time and\n"
literal|"information about their functionality and mod-times\n"
literal|"is cached in this file.  This file is intended to\n"
literal|"be GIMP-readable only, and should not be edited."
argument_list|)
block|}
block|,
block|{
name|FALSE
block|,
literal|"menurc"
block|,
name|N_
argument_list|(
literal|"Key shortcuts can be dynamically redefined in The GIMP.\n"
literal|"The menurc is a dump of your configuration so it can.\n"
literal|"be remembered for the next session.  You may edit this\n"
literal|"file if you wish, but it is much easier to define the\n"
literal|"keys from within The GIMP.  Deleting this file will\n"
literal|"restore the default shortcuts."
argument_list|)
block|}
block|,
block|{
name|FALSE
block|,
literal|"sessionrc"
block|,
name|N_
argument_list|(
literal|"The sessionrc is used to store what dialog windows were\n"
literal|"open the last time you quit The GIMP.  You can configure\n"
literal|"The GIMP to reopen these dialogs at the saved position."
argument_list|)
block|}
block|,
block|{
name|FALSE
block|,
literal|"unitrc"
block|,
name|N_
argument_list|(
literal|"The unitrc is used to store your user units database.\n"
literal|"You can define additional units and use them just\n"
literal|"like you use the built-in units inches, millimeters,\n"
literal|"points and picas.  This file is overwritten each time\n"
literal|"you quit the GIMP."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"brushes"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined brushes.  The default gimprc file\n"
literal|"checks this subdirectory in addition to the system-\n"
literal|"wide GIMP brushes installation when searching for\n"
literal|"brushes."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"generated_brushes"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which is used to store brushes\n"
literal|"that are created with the brush editor.  The default\n"
literal|"gimprc file checks this subdirectory when searching\n"
literal|"for generated brushes."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"gradients"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined gradients.  The default gimprc file\n"
literal|"checks this subdirectory in addition to the system-\n"
literal|"wide GIMP gradients installation when searching\n"
literal|"for gradients."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"palettes"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined palettes.  The default gimprc file\n"
literal|"checks only this subdirectory (not the system-wide\n"
literal|"installation) when searching for palettes.  During\n"
literal|"installation, the system palettes will be copied\n"
literal|"here.  This is done to allow modifications made to\n"
literal|"palettes during GIMP execution to persist across\n"
literal|"sessions."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"patterns"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined patterns.  The default gimprc file\n"
literal|"checks this subdirectory in addition to the system-\n"
literal|"wide GIMP patterns installation when searching for\n"
literal|"patterns."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"plug-ins"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user created, temporary, or otherwise non-system-\n"
literal|"supported plug-ins.  The default gimprc file checks\n"
literal|"this subdirectory in addition to the systemwide\n"
literal|"GIMP plug-in directories when searching for plug-ins."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"modules"
block|,
name|N_
argument_list|(
literal|"This subdirectory can be used to store user created,\n"
literal|"temporary, or otherwise non-system-supported DLL\n"
literal|"modules.  The default gimprc file checks this subdirectory\n"
literal|"in addition to the system-wide GIMP module directory\n"
literal|"when searching for modules to load when initializing."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"scripts"
block|,
name|N_
argument_list|(
literal|"This subdirectory is used by the GIMP to store user\n"
literal|"created and installed scripts.  The default gimprc file\n"
literal|"checks this subdirectory in addition to the systemwide\n"
literal|"GIMP scripts subdirectory when searching for scripts"
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"tmp"
block|,
name|N_
argument_list|(
literal|"This subdirectory is used by the GIMP to temporarily\n"
literal|"store undo buffers to reduce memory usage.  If GIMP is\n"
literal|"unceremoniously killed, files may persist in this directory\n"
literal|"of the form: gimp<#>.<#>.  These files are useless across\n"
literal|"GIMP sessions and can be destroyed with impunity."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"curves"
block|,
name|N_
argument_list|(
literal|"This subdirectory is used to store parameter files for\n"
literal|"the Curves tool."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"levels"
block|,
name|N_
argument_list|(
literal|"This subdirectory is used to store parameter files for\n"
literal|"the Levels tool."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"fractalexplorer"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined fractals to be used by the FractalExplorer\n"
literal|"plug-in.  The default gimprc file checks this subdirectory\n"
literal|"in addition to the systemwide GIMP FractalExplorer\n"
literal|"installation when searching for fractals."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"gfig"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined figures to be used by the GFig plug-in.\n"
literal|"The default gimprc file checks this subdirectory in\n"
literal|"addition to the systemwide GIMP GFig installation\n"
literal|"when searching for gfig figures."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"gflare"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined gflares to be used by the GFlare plug-in.\n"
literal|"The default gimprc file checks this subdirectory in\n"
literal|"addition to the systemwide GIMP GFlares installation\n"
literal|"when searching for gflares."
argument_list|)
block|}
block|,
block|{
name|TRUE
block|,
literal|"gimpressionist"
block|,
name|N_
argument_list|(
literal|"This is a subdirectory which can be used to store\n"
literal|"user defined data to be used by the Gimpressionist\n"
literal|"plug-in.  The default gimprc file checks this subdirectory\n"
literal|"in addition to the systemwide GIMP Gimpressionist\n"
literal|"installation when searching for data."
argument_list|)
block|}
block|}
struct|;
end_struct

begin_decl_stmt
DECL|variable|num_tree_items
specifier|static
name|gint
name|num_tree_items
init|=
sizeof|sizeof
argument_list|(
name|tree_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|tree_items
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|user_install_notebook_set_page (GtkNotebook * notebook,gint index)
name|user_install_notebook_set_page
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|gint
name|index
parameter_list|)
block|{
name|gchar
modifier|*
name|title
decl_stmt|;
name|gchar
modifier|*
name|footer
decl_stmt|;
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|page
operator|=
name|gtk_notebook_get_nth_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|title
operator|=
name|gtk_object_get_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"title"
argument_list|)
expr_stmt|;
name|footer
operator|=
name|gtk_object_get_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"footer"
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|title_label
argument_list|)
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|footer
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|==
name|EEK_PAGE
condition|)
block|{
name|gtk_widget_set_usize
argument_list|(
name|title_pixmap
argument_list|,
name|title_pixmap
operator|->
name|allocation
operator|.
name|width
argument_list|,
name|title_pixmap
operator|->
name|allocation
operator|.
name|height
argument_list|)
expr_stmt|;
name|gimp_pixmap_set
argument_list|(
name|GIMP_PIXMAP
argument_list|(
name|title_pixmap
argument_list|)
argument_list|,
name|eek_xpm
argument_list|)
expr_stmt|;
block|}
name|gtk_notebook_set_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_continue_callback (GtkWidget * widget,gpointer data)
name|user_install_continue_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|static
name|gint
name|notebook_index
init|=
literal|0
decl_stmt|;
name|UserInstallCallback
name|callback
decl_stmt|;
name|callback
operator|=
operator|(
name|UserInstallCallback
operator|)
name|data
expr_stmt|;
switch|switch
condition|(
name|notebook_index
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
comment|/*  Creatring the directories can take some time on NFS, so inform        *  the user and set the buttons insensitive        */
name|gtk_widget_set_sensitive
argument_list|(
name|continue_button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|cancel_button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Please wait while your personal\n"
literal|"GIMP directory is being created..."
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
if|if
condition|(
name|user_install_run
argument_list|()
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|continue_button
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|cancel_button
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
ifdef|#
directive|ifdef
name|G_OS_WIN32
name|FreeConsole
argument_list|()
expr_stmt|;
endif|#
directive|endif
name|parse_buffers_init
argument_list|()
expr_stmt|;
name|parse_unitrc
argument_list|()
expr_stmt|;
name|parse_gimprc
argument_list|()
expr_stmt|;
name|user_install_tuning
argument_list|()
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|user_install_tuning_done
argument_list|()
expr_stmt|;
name|user_install_resolution
argument_list|()
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|user_install_resolution_done
argument_list|()
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|user_install_dialog
argument_list|)
expr_stmt|;
name|gdk_gc_unref
argument_list|(
name|white_gc
argument_list|)
expr_stmt|;
name|gtk_style_unref
argument_list|(
name|title_style
argument_list|)
expr_stmt|;
name|gtk_style_unref
argument_list|(
name|page_style
argument_list|)
expr_stmt|;
call|(
modifier|*
name|callback
call|)
argument_list|()
expr_stmt|;
return|return;
break|break;
case|case
name|EEK_PAGE
case|:
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|notebook_index
operator|<
name|NUM_PAGES
operator|-
literal|1
condition|)
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
operator|++
name|notebook_index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_cancel_callback (GtkWidget * widget,gpointer data)
name|user_install_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|static
name|gint
name|timeout
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|timeout
condition|)
name|gtk_exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|continue_button
argument_list|)
expr_stmt|;
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|EEK_PAGE
argument_list|)
expr_stmt|;
name|timeout
operator|=
name|gtk_timeout_add
argument_list|(
literal|1024
argument_list|,
operator|(
name|GtkFunction
operator|)
name|gtk_exit
argument_list|,
operator|(
name|gpointer
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|user_install_corner_expose (GtkWidget * widget,GdkEventExpose * eevent,gpointer data)
name|user_install_corner_expose
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|eevent
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
operator|(
name|GtkCornerType
operator|)
name|data
condition|)
block|{
case|case
name|GTK_CORNER_TOP_LEFT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|white_gc
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|90
operator|*
literal|64
argument_list|,
literal|180
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_LEFT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|white_gc
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|height
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|180
operator|*
literal|64
argument_list|,
literal|270
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_TOP_RIGHT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|white_gc
argument_list|,
name|TRUE
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|width
argument_list|,
literal|0
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|0
operator|*
literal|64
argument_list|,
literal|90
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_RIGHT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|white_gc
argument_list|,
name|TRUE
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|width
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|height
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|270
operator|*
literal|64
argument_list|,
literal|360
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|user_install_notebook_append_page (GtkNotebook * notebook,gchar * title,gchar * footer)
name|user_install_notebook_append_page
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|gchar
modifier|*
name|title
parameter_list|,
name|gchar
modifier|*
name|footer
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"title"
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"footer"
argument_list|,
name|footer
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|notebook
argument_list|,
name|page
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|add_label (GtkBox * box,gchar * text)
name|add_label
parameter_list|(
name|GtkBox
modifier|*
name|box
parameter_list|,
name|gchar
modifier|*
name|text
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|box
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_ctree_select_row (GtkWidget * widget,gint row,gint column,GdkEventButton * bevent,gpointer data)
name|user_install_ctree_select_row
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkNotebook
modifier|*
name|notebook
decl_stmt|;
name|notebook
operator|=
operator|(
name|GtkNotebook
operator|*
operator|)
name|data
expr_stmt|;
name|gtk_notebook_set_page
argument_list|(
name|notebook
argument_list|,
name|row
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|user_install_dialog_create (UserInstallCallback callback)
name|user_install_dialog_create
parameter_list|(
name|UserInstallCallback
name|callback
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|ebox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|darea
decl_stmt|;
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|sep
decl_stmt|;
name|GdkFont
modifier|*
name|large_font
decl_stmt|;
name|dialog
operator|=
name|user_install_dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"GIMP User Installation"
argument_list|)
argument_list|,
literal|"user_installation"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GTK_WIN_POS_CENTER
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Continue"
argument_list|)
argument_list|,
name|user_install_continue_callback
argument_list|,
name|callback
argument_list|,
name|NULL
argument_list|,
operator|&
name|continue_button
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
name|user_install_cancel_callback
argument_list|,
name|callback
argument_list|,
literal|1
argument_list|,
operator|&
name|cancel_button
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_dialog_set_icon
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/*  hide the separator between the dialog's vbox and the action area  */
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|g_list_nth_data
argument_list|(
name|gtk_container_children
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_BIN
argument_list|(
name|dialog
argument_list|)
operator|->
name|child
argument_list|)
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_realize
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
comment|/*  B/W Style for the page contents  */
name|page_style
operator|=
name|gtk_style_copy
argument_list|(
name|gtk_widget_get_default_style
argument_list|()
argument_list|)
expr_stmt|;
name|colormap
operator|=
name|gtk_widget_get_colormap
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gdk_color_black
argument_list|(
name|colormap
argument_list|,
operator|&
name|black_color
argument_list|)
expr_stmt|;
name|gdk_color_white
argument_list|(
name|colormap
argument_list|,
operator|&
name|white_color
argument_list|)
expr_stmt|;
name|page_style
operator|->
name|fg
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|black_color
expr_stmt|;
name|page_style
operator|->
name|text
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|black_color
expr_stmt|;
name|page_style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|white_color
expr_stmt|;
name|gdk_font_unref
argument_list|(
name|page_style
operator|->
name|font
argument_list|)
expr_stmt|;
name|page_style
operator|->
name|font
operator|=
name|dialog
operator|->
name|style
operator|->
name|font
expr_stmt|;
name|gdk_font_ref
argument_list|(
name|page_style
operator|->
name|font
argument_list|)
expr_stmt|;
comment|/*  B/Colored Style for the page title  */
name|title_style
operator|=
name|gtk_style_copy
argument_list|(
name|page_style
argument_list|)
expr_stmt|;
if|if
condition|(
name|gdk_color_parse
argument_list|(
literal|"dark orange"
argument_list|,
operator|&
name|title_color
argument_list|)
operator|&&
name|gdk_colormap_alloc_color
argument_list|(
name|colormap
argument_list|,
operator|&
name|title_color
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
condition|)
block|{
name|title_style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|title_color
expr_stmt|;
block|}
comment|/*  this is a fontset, e.g. multiple comma-separated font definitions  */
name|large_font
operator|=
name|gdk_fontset_load
argument_list|(
name|_
argument_list|(
literal|"-*-helvetica-bold-r-normal-*-*-240-*-*-*-*-*-*,*"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|large_font
condition|)
block|{
name|gdk_font_unref
argument_list|(
name|title_style
operator|->
name|font
argument_list|)
expr_stmt|;
name|title_style
operator|->
name|font
operator|=
name|large_font
expr_stmt|;
name|gdk_font_ref
argument_list|(
name|title_style
operator|->
name|font
argument_list|)
expr_stmt|;
block|}
comment|/*  W/W GC for the corner  */
name|white_gc
operator|=
name|gdk_gc_new
argument_list|(
name|dialog
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|white_gc
argument_list|,
operator|&
name|white_color
argument_list|)
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|footer_label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|footer_label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_RIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|footer_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|footer_label
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|ebox
argument_list|,
name|GDK_EXPOSURE_MASK
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|ebox
argument_list|,
name|WILBER_WIDTH
operator|+
literal|16
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|ebox
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|title_pixmap
operator|=
name|gimp_pixmap_new
argument_list|(
name|wilber_xpm
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|title_pixmap
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title_pixmap
argument_list|)
expr_stmt|;
name|title_label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|title_label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|title_label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|title_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title_label
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|ebox
argument_list|,
literal|16
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|ebox
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|darea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|darea
argument_list|)
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|gtk_signal_connect_after
argument_list|(
name|GTK_OBJECT
argument_list|(
name|darea
argument_list|)
argument_list|,
literal|"expose_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|GTK_CORNER_TOP_LEFT
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|darea
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|darea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|darea
argument_list|)
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|gtk_signal_connect_after
argument_list|(
name|GTK_OBJECT
argument_list|(
name|darea
argument_list|)
argument_list|,
literal|"expose_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|GTK_CORNER_BOTTOM_LEFT
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|darea
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_show_tabs
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_border
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|notebook
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  Page 1  */
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Welcome to\n"
literal|"The GIMP User Installation"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to enter "
literal|"the GIMP user installation."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"The GIMP - GNU Image Manipulation Program\n"
literal|"Copyright (C) 1995-2000\n"
literal|"Spencer Kimball, Peter Mattis and the GIMP Development Team."
argument_list|)
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This program is free software; you can redistribute it and/or modify\n"
literal|"it under the terms of the GNU General Public License as published by\n"
literal|"the Free Software Foundation; either version 2 of the License, or\n"
literal|"(at your option) any later version."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This program is distributed in the hope that it will be useful,\n"
literal|"but WITHOUT ANY WARRANTY; without even the implied warranty of\n"
literal|"MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n"
literal|"See the GNU General Public License for more details."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"You should have received a copy of the GNU General Public License\n"
literal|"along with this program; if not, write to the Free Software\n"
literal|"Foundation, Inc., 59 Temple Place - Suite 330, Boston,\n"
literal|"MA 02111-1307, USA."
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Page 2  */
block|{
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|ctree
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook2
decl_stmt|;
name|GtkWidget
modifier|*
name|page2
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkCTreeNode
modifier|*
name|main_node
init|=
name|NULL
decl_stmt|;
name|GtkCTreeNode
modifier|*
name|sub_node
init|=
name|NULL
decl_stmt|;
name|GdkPixmap
modifier|*
name|file_pixmap
decl_stmt|;
name|GdkBitmap
modifier|*
name|file_mask
decl_stmt|;
name|GdkPixmap
modifier|*
name|folder_pixmap
decl_stmt|;
name|GdkBitmap
modifier|*
name|folder_mask
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gchar
modifier|*
name|node
index|[
literal|1
index|]
decl_stmt|;
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Personal GIMP Directory"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to create "
literal|"your personal GIMP directory."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|ctree
operator|=
name|gtk_ctree_new
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|ctree
argument_list|)
expr_stmt|;
name|gtk_ctree_set_indent
argument_list|(
name|GTK_CTREE
argument_list|(
name|ctree
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_clist_set_shadow_type
argument_list|(
name|GTK_CLIST
argument_list|(
name|ctree
argument_list|)
argument_list|,
name|GTK_SHADOW_NONE
argument_list|)
expr_stmt|;
name|gtk_clist_set_selection_mode
argument_list|(
name|GTK_CLIST
argument_list|(
name|ctree
argument_list|)
argument_list|,
name|GTK_SELECTION_BROWSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|ctree
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ctree
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"For a proper GIMP installation, a subdirectory named\n"
literal|"%s needs to be created."
argument_list|)
argument_list|,
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This subdirectory will contain a number of important files.\n"
literal|"Click on one of the files or subdirectories in the tree\n"
literal|"to get more information about the selected item."
argument_list|)
argument_list|)
expr_stmt|;
name|notebook2
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|notebook2
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_tabs
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_border
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|notebook2
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook2
argument_list|)
expr_stmt|;
comment|/*  empty page  */
name|page2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page2
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|page2
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|node
index|[
literal|0
index|]
operator|=
name|gimp_directory
argument_list|()
expr_stmt|;
name|main_node
operator|=
name|gtk_ctree_insert_node
argument_list|(
name|GTK_CTREE
argument_list|(
name|ctree
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|node
argument_list|,
literal|4
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|ctree
argument_list|)
argument_list|,
literal|"select_row"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|user_install_ctree_select_row
argument_list|)
argument_list|,
name|notebook2
argument_list|)
expr_stmt|;
name|file_pixmap
operator|=
name|gdk_pixmap_create_from_xpm_d
argument_list|(
name|dialog
operator|->
name|window
argument_list|,
operator|&
name|file_mask
argument_list|,
operator|&
name|page_style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|new_xpm
argument_list|)
expr_stmt|;
name|folder_pixmap
operator|=
name|gdk_pixmap_create_from_xpm_d
argument_list|(
name|dialog
operator|->
name|window
argument_list|,
operator|&
name|folder_mask
argument_list|,
operator|&
name|page_style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|folder_xpm
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_tree_items
condition|;
name|i
operator|++
control|)
block|{
name|node
index|[
literal|0
index|]
operator|=
name|tree_items
index|[
name|i
index|]
operator|.
name|text
expr_stmt|;
if|if
condition|(
name|tree_items
index|[
name|i
index|]
operator|.
name|directory
condition|)
block|{
name|sub_node
operator|=
name|gtk_ctree_insert_node
argument_list|(
name|GTK_CTREE
argument_list|(
name|ctree
argument_list|)
argument_list|,
name|main_node
argument_list|,
name|NULL
argument_list|,
name|node
argument_list|,
literal|4
argument_list|,
name|folder_pixmap
argument_list|,
name|folder_mask
argument_list|,
name|folder_pixmap
argument_list|,
name|folder_mask
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|sub_node
operator|=
name|gtk_ctree_insert_node
argument_list|(
name|GTK_CTREE
argument_list|(
name|ctree
argument_list|)
argument_list|,
name|main_node
argument_list|,
name|NULL
argument_list|,
name|node
argument_list|,
literal|4
argument_list|,
name|file_pixmap
argument_list|,
name|file_mask
argument_list|,
name|file_pixmap
argument_list|,
name|file_mask
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|page2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|gettext
argument_list|(
name|tree_items
index|[
name|i
index|]
operator|.
name|description
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page2
argument_list|)
argument_list|,
name|label
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page2
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|page2
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_clist_set_column_width
argument_list|(
name|GTK_CLIST
argument_list|(
name|ctree
argument_list|)
argument_list|,
literal|0
argument_list|,
name|gtk_clist_optimal_column_width
argument_list|(
name|GTK_CLIST
argument_list|(
name|ctree
argument_list|)
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|ctree
argument_list|,
operator|-
literal|1
argument_list|,
name|ctree
operator|->
name|requisition
operator|.
name|height
argument_list|)
expr_stmt|;
name|gdk_pixmap_unref
argument_list|(
name|file_pixmap
argument_list|)
expr_stmt|;
name|gdk_bitmap_unref
argument_list|(
name|file_mask
argument_list|)
expr_stmt|;
name|gdk_pixmap_unref
argument_list|(
name|folder_pixmap
argument_list|)
expr_stmt|;
name|gdk_bitmap_unref
argument_list|(
name|folder_mask
argument_list|)
expr_stmt|;
block|}
comment|/*  Page 3  */
name|page
operator|=
name|log_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"User Installation Log"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Page 4  */
name|page
operator|=
name|tuning_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP Performance Tuning"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to accept the settings above."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"For optimal GIMP performance, some settings may have to be adjusted."
argument_list|)
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
comment|/*  Page 5  */
name|page
operator|=
name|resolution_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Monitor Resolution"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to start The GIMP."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"To display images in their natural size, "
literal|"GIMP needs to know your monitor resolution."
argument_list|)
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
comment|/*  EEK page  */
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Aborting Installation..."
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*********************/
end_comment

begin_comment
comment|/*  Local functions  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_function
name|char
modifier|*
DECL|function|quote_spaces (char * string)
name|quote_spaces
parameter_list|(
name|char
modifier|*
name|string
parameter_list|)
block|{
name|int
name|nspaces
init|=
literal|0
decl_stmt|;
name|char
modifier|*
name|p
init|=
name|string
decl_stmt|,
modifier|*
name|q
decl_stmt|,
modifier|*
name|new
decl_stmt|;
while|while
condition|(
operator|*
name|p
condition|)
block|{
if|if
condition|(
operator|*
name|p
operator|==
literal|' '
condition|)
name|nspaces
operator|++
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|nspaces
operator|==
literal|0
condition|)
return|return
name|g_strdup
argument_list|(
name|string
argument_list|)
return|;
name|new
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|string
argument_list|)
operator|+
name|nspaces
operator|*
literal|2
operator|+
literal|1
argument_list|)
expr_stmt|;
name|p
operator|=
name|string
expr_stmt|;
name|q
operator|=
name|new
expr_stmt|;
while|while
condition|(
operator|*
name|p
condition|)
block|{
if|if
condition|(
operator|*
name|p
operator|==
literal|' '
condition|)
block|{
operator|*
name|q
operator|++
operator|=
literal|'"'
expr_stmt|;
operator|*
name|q
operator|++
operator|=
literal|' '
expr_stmt|;
operator|*
name|q
operator|++
operator|=
literal|'"'
expr_stmt|;
block|}
else|else
operator|*
name|q
operator|++
operator|=
operator|*
name|p
expr_stmt|;
name|p
operator|++
expr_stmt|;
block|}
operator|*
name|q
operator|=
literal|'\0'
expr_stmt|;
return|return
name|new
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|gboolean
DECL|function|user_install_run (void)
name|user_install_run
parameter_list|(
name|void
parameter_list|)
block|{
name|FILE
modifier|*
name|pfp
decl_stmt|;
name|gchar
name|buffer
index|[
literal|2048
index|]
decl_stmt|;
name|struct
name|stat
name|stat_buf
decl_stmt|;
name|gint
name|err
decl_stmt|;
name|gboolean
name|executable
init|=
name|TRUE
decl_stmt|;
comment|/*  Generate output  */
name|g_snprintf
argument_list|(
argument|buffer
argument_list|,
argument|sizeof (buffer)
argument_list|,
literal|"%s"
argument|G_DIR_SEPARATOR_S USER_INSTALL
argument_list|,
argument|gimp_data_directory ()
argument_list|)
empty_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|stat
argument_list|(
name|buffer
argument_list|,
operator|&
name|stat_buf
argument_list|)
operator|)
operator|!=
literal|0
condition|)
block|{
name|gchar
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s\n%s"
argument_list|,
name|buffer
argument_list|,
name|_
argument_list|(
literal|"does not exist.  Cannot install."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|executable
operator|=
name|FALSE
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|S_IXUSR
elseif|else
if|if
condition|(
operator|!
operator|(
name|S_IXUSR
operator|&
name|stat_buf
operator|.
name|st_mode
operator|)
operator|||
operator|!
operator|(
name|S_IRUSR
operator|&
name|stat_buf
operator|.
name|st_mode
operator|)
condition|)
block|{
name|gchar
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s\n%s"
argument_list|,
name|buffer
argument_list|,
name|_
argument_list|(
literal|"has invalid permissions.  Cannot install."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|executable
operator|=
name|FALSE
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|executable
condition|)
block|{
ifdef|#
directive|ifdef
name|G_OS_WIN32
name|char
modifier|*
name|quoted_data_dir
decl_stmt|,
modifier|*
name|quoted_user_dir
decl_stmt|,
modifier|*
name|quoted_sysconf_dir
decl_stmt|;
comment|/* On Windows, it is common for the GIMP data directory        * to have spaces in it ("c:\Program Files\GIMP"). Put spaces in quotes.        */
name|quoted_data_dir
operator|=
name|quote_spaces
argument_list|(
name|gimp_data_directory
argument_list|()
argument_list|)
expr_stmt|;
name|quoted_user_dir
operator|=
name|quote_spaces
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
name|quoted_sysconf_dir
operator|=
name|quote_spaces
argument_list|(
name|gimp_sysconf_directory
argument_list|()
argument_list|)
expr_stmt|;
comment|/* The Microsoft _popen doesn't work in Windows applications, sigh.        * Do the installation by calling system(). The user_install.bat        * ends with a pause command, so the user has to press enter in        * the console window to continue, and thus has a chance to read        * at the window contents.        */
name|AllocConsole
argument_list|()
expr_stmt|;
name|g_snprintf
argument_list|(
argument|buffer
argument_list|,
argument|sizeof(buffer)
argument_list|,
literal|"%s"
argument|G_DIR_SEPARATOR_S USER_INSTALL
literal|" %s %s %s"
argument_list|,
argument|quoted_data_dir
argument_list|,
argument|quoted_data_dir
argument_list|,
argument|quoted_user_dir
argument_list|,
argument|quoted_sysconf_dir
argument_list|)
empty_stmt|;
if|if
condition|(
name|system
argument_list|(
name|buffer
argument_list|)
operator|==
operator|-
literal|1
condition|)
name|executable
operator|=
name|FALSE
expr_stmt|;
name|g_free
argument_list|(
name|quoted_data_dir
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|quoted_user_dir
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|quoted_sysconf_dir
argument_list|)
expr_stmt|;
if|if
condition|(
name|executable
condition|)
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Did you notice any error messages in the console window?\n"
literal|"If not, installation was successful!\n"
literal|"Otherwise, quit and investigate the possible reason..."
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
ifndef|#
directive|ifndef
name|__EMX__
name|g_snprintf
argument_list|(
argument|buffer
argument_list|,
argument|sizeof(buffer)
argument_list|,
literal|"%s"
argument|G_DIR_SEPARATOR_S USER_INSTALL
literal|" %s %s %s %s"
argument_list|,
argument|gimp_data_directory ()
argument_list|,
literal|"2>&1"
argument_list|,
argument|gimp_data_directory()
argument_list|,
argument|gimp_directory ()
argument_list|,
argument|gimp_sysconf_directory()
argument_list|)
empty_stmt|;
else|#
directive|else
name|g_snprintf
argument_list|(
argument|buffer
argument_list|,
argument|sizeof(buffer)
argument_list|,
literal|"cmd.exe /c %s"
argument|G_DIR_SEPARATOR_S USER_INSTALL
literal|" %s %s %s"
argument_list|,
argument|gimp_data_directory ()
argument_list|,
argument|gimp_data_directory()
argument_list|,
argument|gimp_directory ()
argument_list|,
argument|gimp_sysconf_directory()
argument_list|)
empty_stmt|;
block|{
name|char
modifier|*
name|s
init|=
name|buffer
operator|+
literal|10
decl_stmt|;
while|while
condition|(
operator|*
name|s
condition|)
block|{
if|if
condition|(
operator|*
name|s
operator|==
literal|'/'
condition|)
operator|*
name|s
operator|=
literal|'\\'
expr_stmt|;
name|s
operator|++
expr_stmt|;
block|}
block|}
endif|#
directive|endif
comment|/* urk - should really use something better than popen(), since        * we can't tell if the installation script failed --austin */
if|if
condition|(
operator|(
name|pfp
operator|=
name|popen
argument_list|(
name|buffer
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|log_text
decl_stmt|;
name|GtkWidget
modifier|*
name|vsb
decl_stmt|;
name|GtkAdjustment
modifier|*
name|vadj
decl_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vadj
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|vsb
operator|=
name|gtk_vscrollbar_new
argument_list|(
name|vadj
argument_list|)
expr_stmt|;
name|log_text
operator|=
name|gtk_text_new
argument_list|(
name|NULL
argument_list|,
name|vadj
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|vsb
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|log_text
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vsb
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|log_text
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|pfp
argument_list|)
condition|)
name|gtk_text_insert
argument_list|(
name|GTK_TEXT
argument_list|(
name|log_text
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|buffer
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|pclose
argument_list|(
name|pfp
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Did you notice any error messages in the lines above?\n"
literal|"If not, installation was successful!\n"
literal|"Otherwise, quit and investigate the possible reason..."
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|executable
operator|=
name|FALSE
expr_stmt|;
endif|#
directive|endif
comment|/* !G_OS_WIN32 */
block|}
if|if
condition|(
name|executable
condition|)
block|{
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|log_page
argument_list|)
argument_list|,
literal|"footer"
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to complete GIMP installation."
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Installation failed.  Contact system administrator."
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|executable
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|tile_cache_adj
specifier|static
name|GtkObject
modifier|*
name|tile_cache_adj
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|swap_path_filesel
specifier|static
name|GtkWidget
modifier|*
name|swap_path_filesel
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|xserver_toggle
specifier|static
name|GtkWidget
modifier|*
name|xserver_toggle
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|resolution_entry
specifier|static
name|GtkWidget
modifier|*
name|resolution_entry
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|user_install_tuning (void)
name|user_install_tuning
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|sep
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|memsize
decl_stmt|;
comment|/*  tile cache size  */
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP uses a limited amount of memory to store image data, the so-called\n"
literal|"\"Tile Cache\". You should adjust its size to fit into memory. Consider\n"
literal|"the amount of memory used by other running processes."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|tile_cache_adj
operator|=
name|gtk_adjustment_new
argument_list|(
name|tile_cache_size
argument_list|,
literal|0
argument_list|,
operator|(
literal|4069.0
operator|*
literal|1024
operator|*
literal|1024
operator|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|memsize
operator|=
name|gimp_mem_size_entry_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|tile_cache_adj
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|memsize
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|memsize
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Tile Cache Size:"
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
comment|/*  swap file location  */
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"All image and undo data which doesn't fit into the Tile Cache will be\n"
literal|"written to a swap file. This file should be located on a local filesystem\n"
literal|"with enough free space (several hundred MB). On a UNIX system, you\n"
literal|"may want to use the system-wide temp-dir (\"/tmp\" or \"/var/tmp\")."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|swap_path_filesel
operator|=
name|gimp_file_selection_new
argument_list|(
name|_
argument_list|(
literal|"Select Swap Dir"
argument_list|)
argument_list|,
name|swap_path
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|swap_path_filesel
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|swap_path_filesel
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Swap Directory:"
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_tuning_done (void)
name|user_install_tuning_done
parameter_list|(
name|void
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_resolution_calibrate (GtkWidget * button,gpointer data)
name|user_install_resolution_calibrate
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|resolution_calibrate_dialog
argument_list|(
name|resolution_entry
argument_list|,
name|title_style
argument_list|,
name|page_style
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_resolution (void)
name|user_install_resolution
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|sep
decl_stmt|;
name|GimpChainButton
modifier|*
name|chain
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
name|pixels_per_unit
decl_stmt|;
name|gdouble
name|xres
decl_stmt|,
name|yres
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|gdisplay_xserver_resolution
argument_list|(
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP can obtain this information from the windowing system.\n"
literal|"However, usually this does not give useful values."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Get Resolution from windowing system (Currently %d x %d dpi)"
argument_list|)
argument_list|,
name|ROUND
argument_list|(
name|xres
argument_list|)
argument_list|,
name|ROUND
argument_list|(
name|yres
argument_list|)
argument_list|)
expr_stmt|;
name|xserver_toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|GTK_BIN
argument_list|(
name|xserver_toggle
argument_list|)
operator|->
name|child
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|xserver_toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|xserver_toggle
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Alternatively, you can set the monitor resolution manually."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|pixels_per_unit
operator|=
name|g_strconcat
argument_list|(
name|_
argument_list|(
literal|"Pixels"
argument_list|)
argument_list|,
literal|"/%s"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|resolution_entry
operator|=
name|gimp_coordinates_new
argument_list|(
name|GIMP_UNIT_INCH
argument_list|,
name|pixels_per_unit
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|75
argument_list|,
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
argument_list|,
name|abs
argument_list|(
name|monitor_xres
operator|-
name|monitor_yres
argument_list|)
operator|<
name|GIMP_MIN_RESOLUTION
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Monitor Resolution X:"
argument_list|)
argument_list|,
name|monitor_xres
argument_list|,
literal|1.0
argument_list|,
name|GIMP_MIN_RESOLUTION
argument_list|,
name|GIMP_MAX_RESOLUTION
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Y:"
argument_list|)
argument_list|,
name|monitor_yres
argument_list|,
literal|1.0
argument_list|,
name|GIMP_MIN_RESOLUTION
argument_list|,
name|GIMP_MAX_RESOLUTION
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pixels_per_unit
argument_list|)
expr_stmt|;
name|chain
operator|=
name|GIMP_COORDINATES_CHAINBUTTON
argument_list|(
name|resolution_entry
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chain
operator|->
name|line1
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chain
operator|->
name|line2
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|resolution_entry
argument_list|)
argument_list|,
literal|"chain_button"
argument_list|,
name|chain
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|GTK_TABLE
argument_list|(
name|resolution_entry
argument_list|)
operator|->
name|children
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GtkTableChild
modifier|*
name|child
init|=
operator|(
name|GtkTableChild
operator|*
operator|)
name|list
operator|->
name|data
decl_stmt|;
if|if
condition|(
name|child
operator|&&
name|GTK_IS_LABEL
argument_list|(
name|child
operator|->
name|widget
argument_list|)
condition|)
name|PAGE_STYLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|child
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|resolution_entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|resolution_entry
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"You can also press the \"Calibrate\" button to open a window\n"
literal|"which lets you determine your monitor resolution interactively."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Calibrate"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|button
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|user_install_resolution_calibrate
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|xserver_toggle
argument_list|)
argument_list|,
literal|"inverse_sensitive"
argument_list|,
name|resolution_entry
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|resolution_entry
argument_list|)
argument_list|,
literal|"inverse_sensitive"
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|xserver_toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_toggle_button_sensitive_update
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|xserver_toggle
argument_list|)
argument_list|,
name|using_xserver_resolution
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_resolution_done (void)
name|user_install_resolution_done
parameter_list|(
name|void
parameter_list|)
block|{
name|GList
modifier|*
name|update
init|=
name|NULL
decl_stmt|;
name|GList
modifier|*
name|remove
init|=
name|NULL
decl_stmt|;
name|gint
name|new_tile_cache_size
decl_stmt|;
name|gchar
modifier|*
name|new_swap_path
decl_stmt|;
name|gboolean
name|new_using_xserver_resolution
decl_stmt|;
name|gdouble
name|new_monitor_xres
decl_stmt|;
name|gdouble
name|new_monitor_yres
decl_stmt|;
name|new_tile_cache_size
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|tile_cache_adj
argument_list|)
operator|->
name|value
expr_stmt|;
name|new_swap_path
operator|=
name|gimp_file_selection_get_filename
argument_list|(
name|GIMP_FILE_SELECTION
argument_list|(
name|swap_path_filesel
argument_list|)
argument_list|)
expr_stmt|;
name|new_using_xserver_resolution
operator|=
name|gtk_toggle_button_get_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|xserver_toggle
argument_list|)
argument_list|)
expr_stmt|;
name|new_monitor_xres
operator|=
name|gimp_size_entry_get_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|resolution_entry
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|new_monitor_yres
operator|=
name|gimp_size_entry_get_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|resolution_entry
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|tile_cache_size
operator|!=
name|new_tile_cache_size
condition|)
block|{
name|tile_cache_size
operator|=
name|new_tile_cache_size
expr_stmt|;
name|update
operator|=
name|g_list_append
argument_list|(
name|update
argument_list|,
literal|"tile-cache-size"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|swap_path
operator|&&
name|new_swap_path
operator|&&
name|strcmp
argument_list|(
name|swap_path
argument_list|,
name|new_swap_path
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|swap_path
argument_list|)
expr_stmt|;
name|swap_path
operator|=
name|new_swap_path
expr_stmt|;
name|update
operator|=
name|g_list_append
argument_list|(
name|update
argument_list|,
literal|"swap-path"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|using_xserver_resolution
operator|!=
name|new_using_xserver_resolution
operator|||
name|ABS
argument_list|(
name|monitor_xres
operator|-
name|new_monitor_xres
argument_list|)
operator|>
name|GIMP_MIN_RESOLUTION
condition|)
block|{
name|monitor_xres
operator|=
name|new_monitor_xres
expr_stmt|;
name|update
operator|=
name|g_list_append
argument_list|(
name|update
argument_list|,
literal|"monitor-xresolution"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|using_xserver_resolution
operator|!=
name|new_using_xserver_resolution
operator|||
name|ABS
argument_list|(
name|monitor_yres
operator|-
name|new_monitor_yres
argument_list|)
operator|>
name|GIMP_MIN_RESOLUTION
condition|)
block|{
name|monitor_yres
operator|=
name|new_monitor_yres
expr_stmt|;
name|update
operator|=
name|g_list_append
argument_list|(
name|update
argument_list|,
literal|"monitor-yresolution"
argument_list|)
expr_stmt|;
block|}
name|using_xserver_resolution
operator|=
name|new_using_xserver_resolution
expr_stmt|;
if|if
condition|(
name|using_xserver_resolution
condition|)
block|{
comment|/* special value of 0 for either x or y res in the gimprc file        * means use the xserver's current resolution */
name|monitor_xres
operator|=
literal|0.0
expr_stmt|;
name|monitor_yres
operator|=
literal|0.0
expr_stmt|;
block|}
name|save_gimprc
argument_list|(
operator|&
name|update
argument_list|,
operator|&
name|remove
argument_list|)
expr_stmt|;
if|if
condition|(
name|using_xserver_resolution
condition|)
name|gdisplay_xserver_resolution
argument_list|(
operator|&
name|monitor_xres
argument_list|,
operator|&
name|monitor_yres
argument_list|)
expr_stmt|;
name|g_list_free
argument_list|(
name|update
argument_list|)
expr_stmt|;
name|g_list_free
argument_list|(
name|remove
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

