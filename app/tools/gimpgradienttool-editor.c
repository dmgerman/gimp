begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<https://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"tools-types.h"
end_include

begin_include
include|#
directive|include
file|"operations/gimp-operation-config.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdata.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpgradient.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp-gradients.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpcolorpanel.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpeditor.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpwidgets-utils.h"
end_include

begin_include
include|#
directive|include
file|"display/gimpdisplay.h"
end_include

begin_include
include|#
directive|include
file|"display/gimpdisplayshell.h"
end_include

begin_include
include|#
directive|include
file|"display/gimptoolgui.h"
end_include

begin_include
include|#
directive|include
file|"display/gimptoolline.h"
end_include

begin_include
include|#
directive|include
file|"gimpgradientoptions.h"
end_include

begin_include
include|#
directive|include
file|"gimpgradienttool.h"
end_include

begin_include
include|#
directive|include
file|"gimpgradienttool-editor.h"
end_include

begin_include
include|#
directive|include
file|"gimp-intl.h"
end_include

begin_define
DECL|macro|EPSILON
define|#
directive|define
name|EPSILON
value|2e-10
end_define

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2ad73ae30103
block|{
DECL|enumerator|DIRECTION_NONE
name|DIRECTION_NONE
block|,
DECL|enumerator|DIRECTION_LEFT
name|DIRECTION_LEFT
block|,
DECL|enumerator|DIRECTION_RIGHT
name|DIRECTION_RIGHT
DECL|typedef|Direction
block|}
name|Direction
typedef|;
end_typedef

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2ad73ae30208
block|{
comment|/* line endpoints at the beginning of the operation */
DECL|member|start_x
name|gdouble
name|start_x
decl_stmt|;
DECL|member|start_y
name|gdouble
name|start_y
decl_stmt|;
DECL|member|end_x
name|gdouble
name|end_x
decl_stmt|;
DECL|member|end_y
name|gdouble
name|end_y
decl_stmt|;
comment|/* copy of the gradient at the beginning of the operation, owned by the gradient    * info, or NULL, if the gradient isn't affected    */
DECL|member|gradient
name|GimpGradient
modifier|*
name|gradient
decl_stmt|;
comment|/* handle added by the operation, or HANDLE_NONE */
DECL|member|added_handle
name|gint
name|added_handle
decl_stmt|;
comment|/* handle removed by the operation, or HANDLE_NONE */
DECL|member|removed_handle
name|gint
name|removed_handle
decl_stmt|;
comment|/* selected handle at the end of the operation, or HANDLE_NONE */
DECL|member|selected_handle
name|gint
name|selected_handle
decl_stmt|;
DECL|typedef|GradientInfo
block|}
name|GradientInfo
typedef|;
end_typedef

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_line_can_add_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gdouble
name|value
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|gimp_gradient_tool_editor_line_add_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gdouble
name|value
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_line_prepare_to_remove_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gint
name|slider
parameter_list|,
name|gboolean
name|remove
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_line_remove_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gint
name|slider
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_line_selection_changed
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_line_handle_clicked
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gint
name|handle
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpButtonPressType
name|press_type
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_gui_response
parameter_list|(
name|GimpToolGui
modifier|*
name|gui
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_color_entry_color_clicked
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_color_entry_color_changed
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_color_entry_color_response
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|GimpColorDialogState
name|state
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_color_entry_type_changed
parameter_list|(
name|GtkComboBox
modifier|*
name|combo
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_endpoint_se_value_changed
parameter_list|(
name|GimpSizeEntry
modifier|*
name|se
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_stop_se_value_changed
parameter_list|(
name|GimpSizeEntry
modifier|*
name|se
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_stop_delete_clicked
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_midpoint_se_value_changed
parameter_list|(
name|GimpSizeEntry
modifier|*
name|se
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_midpoint_type_changed
parameter_list|(
name|GtkComboBox
modifier|*
name|combo
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_midpoint_color_changed
parameter_list|(
name|GtkComboBox
modifier|*
name|combo
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_midpoint_new_stop_clicked
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_midpoint_center_clicked
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_flush_idle
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_is_gradient_editable
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_handle_is_endpoint
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_handle_is_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_handle_is_midpoint
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpGradientSegment
modifier|*
name|gimp_gradient_tool_editor_handle_get_segment
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_block_handlers
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_unblock_handlers
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_are_handlers_blocked
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_freeze_gradient
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_thaw_gradient
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|gimp_gradient_tool_editor_add_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gdouble
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_delete_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|slider
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|gimp_gradient_tool_editor_midpoint_to_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|slider
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_update_sliders
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_purge_gradient_history
parameter_list|(
name|GSList
modifier|*
modifier|*
name|stack
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_purge_gradient
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|gimp_gradient_tool_editor_color_entry_new
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|Direction
name|direction
parameter_list|,
name|GtkWidget
modifier|*
name|chain_button
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|color_panel
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|type_combo
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_init_endpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_init_stop_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_init_midpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_update_endpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|selection
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_update_stop_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|selection
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_update_midpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|selection
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_update_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GradientInfo
modifier|*
name|gimp_gradient_tool_editor_gradient_info_new
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_gradient_info_free
parameter_list|(
name|GradientInfo
modifier|*
name|info
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_gradient_tool_editor_gradient_info_apply
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
specifier|const
name|GradientInfo
modifier|*
name|info
parameter_list|,
name|gboolean
name|set_selection
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_gradient_tool_editor_gradient_info_is_trivial
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
specifier|const
name|GradientInfo
modifier|*
name|info
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  private functions  */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_line_can_add_slider (GimpToolLine * line,gdouble value,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_line_can_add_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gdouble
name|value
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|gdouble
name|offset
init|=
name|options
operator|->
name|offset
operator|/
literal|100.0
decl_stmt|;
return|return
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
operator|&&
name|value
operator|>=
name|offset
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|gimp_gradient_tool_editor_line_add_slider (GimpToolLine * line,gdouble value,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_line_add_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gdouble
name|value
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpPaintOptions
modifier|*
name|paint_options
init|=
name|GIMP_PAINT_OPTIONS
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|gdouble
name|offset
init|=
name|options
operator|->
name|offset
operator|/
literal|100.0
decl_stmt|;
comment|/* adjust slider value according to the offset */
name|value
operator|=
operator|(
name|value
operator|-
name|offset
operator|)
operator|/
operator|(
literal|1.0
operator|-
name|offset
operator|)
expr_stmt|;
comment|/* flip the slider value, if necessary */
if|if
condition|(
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_reverse
condition|)
name|value
operator|=
literal|1.0
operator|-
name|value
expr_stmt|;
return|return
name|gimp_gradient_tool_editor_add_stop
argument_list|(
name|gradient_tool
argument_list|,
name|value
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_line_prepare_to_remove_slider (GimpToolLine * line,gint slider,gboolean remove,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_line_prepare_to_remove_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gint
name|slider
parameter_list|,
name|gboolean
name|remove
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
if|if
condition|(
name|remove
condition|)
block|{
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|GimpGradient
modifier|*
name|tentative_gradient
decl_stmt|;
comment|/* show a tentative gradient, demonstrating the result of actually        * removing the slider        */
name|info
operator|=
name|gradient_tool
operator|->
name|undo_stack
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|added_handle
operator|==
name|slider
condition|)
block|{
comment|/* see comment in gimp_gradient_tool_editor_delete_stop() */
name|gimp_assert
argument_list|(
name|info
operator|->
name|gradient
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|tentative_gradient
operator|=
name|g_object_ref
argument_list|(
name|info
operator|->
name|gradient
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|tentative_gradient
operator|=
name|GIMP_GRADIENT
argument_list|(
name|gimp_data_duplicate
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|slider
argument_list|)
expr_stmt|;
name|i
operator|=
name|gimp_gradient_segment_range_get_n_segments
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
argument_list|,
name|seg
argument_list|)
operator|-
literal|1
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_segment_get_nth
argument_list|(
name|tentative_gradient
operator|->
name|segments
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_range_merge
argument_list|(
name|tentative_gradient
argument_list|,
name|seg
argument_list|,
name|seg
operator|->
name|next
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gimp_gradient_tool_set_tentative_gradient
argument_list|(
name|gradient_tool
argument_list|,
name|tentative_gradient
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|tentative_gradient
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_gradient_tool_set_tentative_gradient
argument_list|(
name|gradient_tool
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_line_remove_slider (GimpToolLine * line,gint slider,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_line_remove_slider
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gint
name|slider
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gimp_gradient_tool_editor_delete_stop
argument_list|(
name|gradient_tool
argument_list|,
name|slider
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_set_tentative_gradient
argument_list|(
name|gradient_tool
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_line_selection_changed (GimpToolLine * line,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_line_selection_changed
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradient_tool
operator|->
name|gui
condition|)
block|{
comment|/* hide all color dialogs */
name|gimp_color_panel_dialog_response
argument_list|(
name|GIMP_COLOR_PANEL
argument_list|(
name|gradient_tool
operator|->
name|endpoint_color_panel
argument_list|)
argument_list|,
name|GIMP_COLOR_DIALOG_OK
argument_list|)
expr_stmt|;
name|gimp_color_panel_dialog_response
argument_list|(
name|GIMP_COLOR_PANEL
argument_list|(
name|gradient_tool
operator|->
name|stop_left_color_panel
argument_list|)
argument_list|,
name|GIMP_COLOR_DIALOG_OK
argument_list|)
expr_stmt|;
name|gimp_color_panel_dialog_response
argument_list|(
name|GIMP_COLOR_PANEL
argument_list|(
name|gradient_tool
operator|->
name|stop_right_color_panel
argument_list|)
argument_list|,
name|GIMP_COLOR_DIALOG_OK
argument_list|)
expr_stmt|;
comment|/* reset the stop colors chain button */
if|if
condition|(
name|gimp_gradient_tool_editor_handle_is_stop
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
condition|)
block|{
specifier|const
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gboolean
name|homogeneous
decl_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|homogeneous
operator|=
name|seg
operator|->
name|right_color
operator|.
name|r
operator|==
name|seg
operator|->
name|next
operator|->
name|left_color
operator|.
name|r
operator|&&
name|seg
operator|->
name|right_color
operator|.
name|g
operator|==
name|seg
operator|->
name|next
operator|->
name|left_color
operator|.
name|g
operator|&&
name|seg
operator|->
name|right_color
operator|.
name|b
operator|==
name|seg
operator|->
name|next
operator|->
name|left_color
operator|.
name|b
operator|&&
name|seg
operator|->
name|right_color
operator|.
name|a
operator|==
name|seg
operator|->
name|next
operator|->
name|left_color
operator|.
name|a
operator|&&
name|seg
operator|->
name|right_color_type
operator|==
name|seg
operator|->
name|next
operator|->
name|left_color_type
expr_stmt|;
name|gimp_chain_button_set_active
argument_list|(
name|GIMP_CHAIN_BUTTON
argument_list|(
name|gradient_tool
operator|->
name|stop_chain_button
argument_list|)
argument_list|,
name|homogeneous
argument_list|)
expr_stmt|;
block|}
block|}
name|gimp_gradient_tool_editor_update_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_line_handle_clicked (GimpToolLine * line,gint handle,GdkModifierType state,GimpButtonPressType press_type,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_line_handle_clicked
parameter_list|(
name|GimpToolLine
modifier|*
name|line
parameter_list|,
name|gint
name|handle
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpButtonPressType
name|press_type
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
if|if
condition|(
name|gimp_gradient_tool_editor_handle_is_midpoint
argument_list|(
name|gradient_tool
argument_list|,
name|handle
argument_list|)
condition|)
block|{
if|if
condition|(
name|press_type
operator|==
name|GIMP_BUTTON_PRESS_DOUBLE
operator|&&
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
condition|)
block|{
name|gint
name|stop
decl_stmt|;
name|stop
operator|=
name|gimp_gradient_tool_editor_midpoint_to_stop
argument_list|(
name|gradient_tool
argument_list|,
name|handle
argument_list|)
expr_stmt|;
name|gimp_tool_line_set_selection
argument_list|(
name|line
argument_list|,
name|stop
argument_list|)
expr_stmt|;
comment|/* return FALSE, so that the new slider can be dragged immediately */
return|return
name|FALSE
return|;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_gui_response (GimpToolGui * gui,gint response_id,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_gui_response
parameter_list|(
name|GimpToolGui
modifier|*
name|gui
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
switch|switch
condition|(
name|response_id
condition|)
block|{
default|default:
name|gimp_tool_line_set_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|GIMP_TOOL_LINE_HANDLE_NONE
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_color_entry_color_clicked (GimpColorButton * button,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_color_entry_color_clicked
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_color_entry_color_changed (GimpColorButton * button,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_color_entry_color_changed
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpPaintOptions
modifier|*
name|paint_options
init|=
name|GIMP_PAINT_OPTIONS
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|gint
name|selection
decl_stmt|;
name|GimpRGB
name|color
decl_stmt|;
name|Direction
name|direction
decl_stmt|;
name|GtkWidget
modifier|*
name|chain_button
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|button
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|direction
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-direction"
argument_list|)
argument_list|)
expr_stmt|;
name|chain_button
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-chain-button"
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
comment|/* swap the endpoint handles, if necessary */
if|if
condition|(
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_reverse
condition|)
block|{
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_END
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_START
expr_stmt|;
break|break;
block|}
block|}
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|seg
operator|->
name|left_color
operator|=
name|color
expr_stmt|;
name|seg
operator|->
name|left_color_type
operator|=
name|GIMP_GRADIENT_COLOR_FIXED
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|seg
operator|->
name|right_color
operator|=
name|color
expr_stmt|;
name|seg
operator|->
name|right_color_type
operator|=
name|GIMP_GRADIENT_COLOR_FIXED
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|direction
operator|==
name|DIRECTION_LEFT
operator|||
operator|(
name|chain_button
operator|&&
name|gimp_chain_button_get_active
argument_list|(
name|GIMP_CHAIN_BUTTON
argument_list|(
name|chain_button
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|seg
operator|->
name|right_color
operator|=
name|color
expr_stmt|;
name|seg
operator|->
name|right_color_type
operator|=
name|GIMP_GRADIENT_COLOR_FIXED
expr_stmt|;
block|}
if|if
condition|(
name|direction
operator|==
name|DIRECTION_RIGHT
operator|||
operator|(
name|chain_button
operator|&&
name|gimp_chain_button_get_active
argument_list|(
name|GIMP_CHAIN_BUTTON
argument_list|(
name|chain_button
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|seg
operator|->
name|next
operator|->
name|left_color
operator|=
name|color
expr_stmt|;
name|seg
operator|->
name|next
operator|->
name|left_color_type
operator|=
name|GIMP_GRADIENT_COLOR_FIXED
expr_stmt|;
block|}
block|}
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_color_entry_color_response (GimpColorButton * button,GimpColorDialogState state,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_color_entry_color_response
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|GimpColorDialogState
name|state
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_color_entry_type_changed (GtkComboBox * combo,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_color_entry_type_changed
parameter_list|(
name|GtkComboBox
modifier|*
name|combo
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpPaintOptions
modifier|*
name|paint_options
init|=
name|GIMP_PAINT_OPTIONS
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|gint
name|selection
decl_stmt|;
name|gint
name|color_type
decl_stmt|;
name|Direction
name|direction
decl_stmt|;
name|GtkWidget
modifier|*
name|chain_button
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_int_combo_box_get_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|combo
argument_list|)
argument_list|,
operator|&
name|color_type
argument_list|)
condition|)
return|return;
name|direction
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|combo
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-direction"
argument_list|)
argument_list|)
expr_stmt|;
name|chain_button
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|combo
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-chain-button"
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
comment|/* swap the endpoint handles, if necessary */
if|if
condition|(
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_reverse
condition|)
block|{
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_END
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_START
expr_stmt|;
break|break;
block|}
block|}
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|seg
operator|->
name|left_color_type
operator|=
name|color_type
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|seg
operator|->
name|right_color_type
operator|=
name|color_type
expr_stmt|;
break|break;
default|default:
if|if
condition|(
name|direction
operator|==
name|DIRECTION_LEFT
operator|||
operator|(
name|chain_button
operator|&&
name|gimp_chain_button_get_active
argument_list|(
name|GIMP_CHAIN_BUTTON
argument_list|(
name|chain_button
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|seg
operator|->
name|right_color_type
operator|=
name|color_type
expr_stmt|;
block|}
if|if
condition|(
name|direction
operator|==
name|DIRECTION_RIGHT
operator|||
operator|(
name|chain_button
operator|&&
name|gimp_chain_button_get_active
argument_list|(
name|GIMP_CHAIN_BUTTON
argument_list|(
name|chain_button
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|seg
operator|->
name|next
operator|->
name|left_color_type
operator|=
name|color_type
expr_stmt|;
block|}
block|}
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_endpoint_se_value_changed (GimpSizeEntry * se,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_endpoint_se_value_changed
parameter_list|(
name|GimpSizeEntry
modifier|*
name|se
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|gdouble
name|x
decl_stmt|;
name|gdouble
name|y
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|selection
operator|==
name|GIMP_TOOL_LINE_HANDLE_NONE
condition|)
return|return;
name|x
operator|=
name|gimp_size_entry_get_refval
argument_list|(
name|se
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|y
operator|=
name|gimp_size_entry_get_refval
argument_list|(
name|se
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_block_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|g_object_set
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"x1"
argument_list|,
name|x
argument_list|,
literal|"y1"
argument_list|,
name|y
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|g_object_set
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"x2"
argument_list|,
name|x
argument_list|,
literal|"y2"
argument_list|,
name|y
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gimp_assert_not_reached
argument_list|()
expr_stmt|;
block|}
name|gimp_gradient_tool_editor_unblock_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_stop_se_value_changed (GimpSizeEntry * se,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_stop_se_value_changed
parameter_list|(
name|GimpSizeEntry
modifier|*
name|se
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|gdouble
name|value
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|selection
operator|==
name|GIMP_TOOL_LINE_HANDLE_NONE
condition|)
return|return;
name|value
operator|=
name|gimp_size_entry_get_refval
argument_list|(
name|se
argument_list|,
literal|0
argument_list|)
operator|/
literal|100.0
expr_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_range_compress
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|seg
argument_list|,
name|seg
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_range_compress
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|seg
operator|->
name|next
argument_list|,
name|seg
operator|->
name|next
argument_list|,
name|value
argument_list|,
name|seg
operator|->
name|next
operator|->
name|right
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_stop_delete_clicked (GtkWidget * button,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_stop_delete_clicked
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_delete_stop
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_midpoint_se_value_changed (GimpSizeEntry * se,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_midpoint_se_value_changed
parameter_list|(
name|GimpSizeEntry
modifier|*
name|se
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|gdouble
name|value
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|selection
operator|==
name|GIMP_TOOL_LINE_HANDLE_NONE
condition|)
return|return;
name|value
operator|=
name|gimp_size_entry_get_refval
argument_list|(
name|se
argument_list|,
literal|0
argument_list|)
operator|/
literal|100.0
expr_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|value
expr_stmt|;
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_midpoint_type_changed (GtkComboBox * combo,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_midpoint_type_changed
parameter_list|(
name|GtkComboBox
modifier|*
name|combo
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|gint
name|type
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_int_combo_box_get_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|combo
argument_list|)
argument_list|,
operator|&
name|type
argument_list|)
condition|)
return|return;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|seg
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_midpoint_color_changed (GtkComboBox * combo,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_midpoint_color_changed
parameter_list|(
name|GtkComboBox
modifier|*
name|combo
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|gint
name|color
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_int_combo_box_get_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|combo
argument_list|)
argument_list|,
operator|&
name|color
argument_list|)
condition|)
return|return;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|seg
operator|->
name|color
operator|=
name|color
expr_stmt|;
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_midpoint_new_stop_clicked (GtkWidget * button,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_midpoint_new_stop_clicked
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|gint
name|stop
decl_stmt|;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|stop
operator|=
name|gimp_gradient_tool_editor_midpoint_to_stop
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|gimp_tool_line_set_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|stop
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_midpoint_center_clicked (GtkWidget * button,GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_midpoint_center_clicked
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_range_recenter_handles
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|seg
argument_list|,
name|seg
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_flush_idle (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_flush_idle
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpDisplay
modifier|*
name|display
init|=
name|GIMP_TOOL
argument_list|(
name|gradient_tool
argument_list|)
operator|->
name|display
decl_stmt|;
name|gimp_image_flush
argument_list|(
name|gimp_display_get_image
argument_list|(
name|display
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|flush_idle_id
operator|=
literal|0
expr_stmt|;
return|return
name|G_SOURCE_REMOVE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_is_gradient_editable (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_is_gradient_editable
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
return|return
operator|!
name|options
operator|->
name|modify_active
operator|||
name|gimp_data_is_writable
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_handle_is_endpoint (GimpGradientTool * gradient_tool,gint handle)
name|gimp_gradient_tool_editor_handle_is_endpoint
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
block|{
return|return
name|handle
operator|==
name|GIMP_TOOL_LINE_HANDLE_START
operator|||
name|handle
operator|==
name|GIMP_TOOL_LINE_HANDLE_END
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_handle_is_stop (GimpGradientTool * gradient_tool,gint handle)
name|gimp_gradient_tool_editor_handle_is_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
block|{
name|gint
name|n_sliders
decl_stmt|;
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
operator|&
name|n_sliders
argument_list|)
expr_stmt|;
return|return
name|handle
operator|>=
literal|0
operator|&&
name|handle
operator|<
name|n_sliders
operator|/
literal|2
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_handle_is_midpoint (GimpGradientTool * gradient_tool,gint handle)
name|gimp_gradient_tool_editor_handle_is_midpoint
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
block|{
name|gint
name|n_sliders
decl_stmt|;
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
operator|&
name|n_sliders
argument_list|)
expr_stmt|;
return|return
name|handle
operator|>=
name|n_sliders
operator|/
literal|2
return|;
block|}
end_function

begin_function
specifier|static
name|GimpGradientSegment
modifier|*
DECL|function|gimp_gradient_tool_editor_handle_get_segment (GimpGradientTool * gradient_tool,gint handle)
name|gimp_gradient_tool_editor_handle_get_segment
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|handle
parameter_list|)
block|{
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
return|return
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
return|;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
return|return
name|gimp_gradient_segment_get_last
argument_list|(
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
argument_list|)
return|;
default|default:
block|{
specifier|const
name|GimpControllerSlider
modifier|*
name|sliders
decl_stmt|;
name|gint
name|n_sliders
decl_stmt|;
name|gint
name|seg_i
decl_stmt|;
name|sliders
operator|=
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
operator|&
name|n_sliders
argument_list|)
expr_stmt|;
name|gimp_assert
argument_list|(
name|handle
operator|>=
literal|0
operator|&&
name|handle
operator|<
name|n_sliders
argument_list|)
expr_stmt|;
name|seg_i
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|sliders
index|[
name|handle
index|]
operator|.
name|data
argument_list|)
expr_stmt|;
return|return
name|gimp_gradient_segment_get_nth
argument_list|(
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
argument_list|,
name|seg_i
argument_list|)
return|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_block_handlers (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_block_handlers
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gradient_tool
operator|->
name|block_handlers_count
operator|++
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_unblock_handlers (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_unblock_handlers
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|block_handlers_count
operator|>
literal|0
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|block_handlers_count
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_are_handlers_blocked (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_are_handlers_blocked
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
return|return
name|gradient_tool
operator|->
name|block_handlers_count
operator|>
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_freeze_gradient (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_freeze_gradient
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpGradient
modifier|*
name|custom
decl_stmt|;
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|gimp_gradient_tool_editor_block_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|custom
operator|=
name|gimp_gradients_get_custom
argument_list|(
name|GIMP_CONTEXT
argument_list|(
name|options
argument_list|)
operator|->
name|gimp
argument_list|)
expr_stmt|;
if|if
condition|(
name|gradient_tool
operator|->
name|gradient
operator|==
name|custom
operator|||
name|options
operator|->
name|modify_active
condition|)
block|{
name|gimp_assert
argument_list|(
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_data_freeze
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* copy the active gradient to the custom gradient, and make the custom        * gradient active.        */
name|gimp_data_freeze
argument_list|(
name|GIMP_DATA
argument_list|(
name|custom
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_data_copy
argument_list|(
name|GIMP_DATA
argument_list|(
name|custom
argument_list|)
argument_list|,
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_context_set_gradient
argument_list|(
name|GIMP_CONTEXT
argument_list|(
name|options
argument_list|)
argument_list|,
name|custom
argument_list|)
expr_stmt|;
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|gradient
operator|==
name|custom
argument_list|)
expr_stmt|;
name|gimp_assert
argument_list|(
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gradient_tool
operator|->
name|edit_count
operator|>
literal|0
condition|)
block|{
name|info
operator|=
name|gradient_tool
operator|->
name|undo_stack
operator|->
name|data
expr_stmt|;
if|if
condition|(
operator|!
name|info
operator|->
name|gradient
condition|)
block|{
name|info
operator|->
name|gradient
operator|=
name|GIMP_GRADIENT
argument_list|(
name|gimp_data_duplicate
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_thaw_gradient (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_thaw_gradient
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gimp_data_thaw
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_update_sliders
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_update_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_unblock_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|gimp_gradient_tool_editor_add_stop (GimpGradientTool * gradient_tool,gdouble value)
name|gimp_gradient_tool_editor_add_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gdouble
name|value
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpPaintOptions
modifier|*
name|paint_options
init|=
name|GIMP_PAINT_OPTIONS
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gint
name|stop
decl_stmt|;
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_split_at
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|GIMP_CONTEXT
argument_list|(
name|options
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|value
argument_list|,
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_blend_color_space
argument_list|,
operator|&
name|seg
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stop
operator|=
name|gimp_gradient_segment_range_get_n_segments
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
argument_list|,
name|seg
argument_list|)
operator|-
literal|1
expr_stmt|;
name|info
operator|=
name|gradient_tool
operator|->
name|undo_stack
operator|->
name|data
expr_stmt|;
name|info
operator|->
name|added_handle
operator|=
name|stop
expr_stmt|;
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|stop
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_delete_stop (GimpGradientTool * gradient_tool,gint slider)
name|gimp_gradient_tool_editor_delete_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|slider
parameter_list|)
block|{
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|gimp_assert
argument_list|(
name|gimp_gradient_tool_editor_handle_is_stop
argument_list|(
name|gradient_tool
argument_list|,
name|slider
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|info
operator|=
name|gradient_tool
operator|->
name|undo_stack
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|added_handle
operator|==
name|slider
condition|)
block|{
comment|/* when removing a stop that was added as part of the current action,        * restore the original gradient at the beginning of the action, rather        * than deleting the stop from the current gradient, so that the affected        * midpoint returns to its state at the beginning of the action, instead        * of being reset.        *        * note that this assumes that the gradient hasn't changed in any other        * way during the action, which is ugly, but currently always true.        */
name|gimp_assert
argument_list|(
name|info
operator|->
name|gradient
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|gimp_data_copy
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|,
name|GIMP_DATA
argument_list|(
name|info
operator|->
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|g_clear_object
argument_list|(
operator|&
name|info
operator|->
name|gradient
argument_list|)
expr_stmt|;
name|info
operator|->
name|added_handle
operator|=
name|GIMP_TOOL_LINE_HANDLE_NONE
expr_stmt|;
block|}
else|else
block|{
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|slider
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_range_merge
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|seg
argument_list|,
name|seg
operator|->
name|next
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|info
operator|->
name|removed_handle
operator|=
name|slider
expr_stmt|;
block|}
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|gimp_gradient_tool_editor_midpoint_to_stop (GimpGradientTool * gradient_tool,gint slider)
name|gimp_gradient_tool_editor_midpoint_to_stop
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|slider
parameter_list|)
block|{
specifier|const
name|GimpControllerSlider
modifier|*
name|sliders
decl_stmt|;
name|gimp_assert
argument_list|(
name|gimp_gradient_tool_editor_handle_is_midpoint
argument_list|(
name|gradient_tool
argument_list|,
name|slider
argument_list|)
argument_list|)
expr_stmt|;
name|sliders
operator|=
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|sliders
index|[
name|slider
index|]
operator|.
name|value
operator|>
name|sliders
index|[
name|slider
index|]
operator|.
name|min
operator|+
name|EPSILON
operator|&&
name|sliders
index|[
name|slider
index|]
operator|.
name|value
operator|<
name|sliders
index|[
name|slider
index|]
operator|.
name|max
operator|-
name|EPSILON
condition|)
block|{
specifier|const
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gint
name|stop
decl_stmt|;
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|slider
argument_list|)
expr_stmt|;
name|stop
operator|=
name|gimp_gradient_tool_editor_add_stop
argument_list|(
name|gradient_tool
argument_list|,
name|seg
operator|->
name|middle
argument_list|)
expr_stmt|;
name|info
operator|=
name|gradient_tool
operator|->
name|undo_stack
operator|->
name|data
expr_stmt|;
name|info
operator|->
name|removed_handle
operator|=
name|slider
expr_stmt|;
name|slider
operator|=
name|stop
expr_stmt|;
block|}
return|return
name|slider
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_update_sliders (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_update_sliders
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpPaintOptions
modifier|*
name|paint_options
init|=
name|GIMP_PAINT_OPTIONS
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|gdouble
name|offset
init|=
name|options
operator|->
name|offset
operator|/
literal|100.0
decl_stmt|;
name|gboolean
name|editable
decl_stmt|;
name|GimpControllerSlider
modifier|*
name|sliders
decl_stmt|;
name|gint
name|n_sliders
decl_stmt|;
name|gint
name|n_segments
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|GimpControllerSlider
modifier|*
name|slider
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|widget
operator|||
name|options
operator|->
name|instant
condition|)
return|return;
name|editable
operator|=
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|n_segments
operator|=
name|gimp_gradient_segment_range_get_n_segments
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|n_sliders
operator|=
operator|(
name|n_segments
operator|-
literal|1
operator|)
operator|+
comment|/* gradient stops, between each adjacent                                   * pair of segments */
operator|(
name|n_segments
operator|)
expr_stmt|;
comment|/* midpoints, inside each segment */
name|sliders
operator|=
name|g_new
argument_list|(
name|GimpControllerSlider
argument_list|,
name|n_sliders
argument_list|)
expr_stmt|;
name|slider
operator|=
name|sliders
expr_stmt|;
comment|/* initialize the gradient-stop sliders */
for|for
control|(
name|seg
operator|=
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
operator|,
name|i
operator|=
literal|0
init|;
name|seg
operator|->
name|next
condition|;
name|seg
operator|=
name|seg
operator|->
name|next
operator|,
name|i
operator|++
control|)
block|{
operator|*
name|slider
operator|=
name|GIMP_CONTROLLER_SLIDER_DEFAULT
expr_stmt|;
name|slider
operator|->
name|value
operator|=
name|seg
operator|->
name|right
expr_stmt|;
name|slider
operator|->
name|min
operator|=
name|seg
operator|->
name|left
expr_stmt|;
name|slider
operator|->
name|max
operator|=
name|seg
operator|->
name|next
operator|->
name|right
expr_stmt|;
name|slider
operator|->
name|movable
operator|=
name|editable
expr_stmt|;
name|slider
operator|->
name|removable
operator|=
name|editable
expr_stmt|;
name|slider
operator|->
name|data
operator|=
name|GINT_TO_POINTER
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|slider
operator|++
expr_stmt|;
block|}
comment|/* initialize the midpoint sliders */
for|for
control|(
name|seg
operator|=
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
operator|,
name|i
operator|=
literal|0
init|;
name|seg
condition|;
name|seg
operator|=
name|seg
operator|->
name|next
operator|,
name|i
operator|++
control|)
block|{
operator|*
name|slider
operator|=
name|GIMP_CONTROLLER_SLIDER_DEFAULT
expr_stmt|;
name|slider
operator|->
name|value
operator|=
name|seg
operator|->
name|middle
expr_stmt|;
name|slider
operator|->
name|min
operator|=
name|seg
operator|->
name|left
expr_stmt|;
name|slider
operator|->
name|max
operator|=
name|seg
operator|->
name|right
expr_stmt|;
comment|/* hide midpoints of zero-length segments, since they'd otherwise        * prevent the segment's endpoints from being selected        */
name|slider
operator|->
name|visible
operator|=
name|fabs
argument_list|(
name|slider
operator|->
name|max
operator|-
name|slider
operator|->
name|min
argument_list|)
operator|>
name|EPSILON
expr_stmt|;
name|slider
operator|->
name|movable
operator|=
name|editable
expr_stmt|;
name|slider
operator|->
name|autohide
operator|=
name|TRUE
expr_stmt|;
name|slider
operator|->
name|type
operator|=
name|GIMP_HANDLE_FILLED_CIRCLE
expr_stmt|;
name|slider
operator|->
name|size
operator|=
literal|0.6
expr_stmt|;
name|slider
operator|->
name|data
operator|=
name|GINT_TO_POINTER
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|slider
operator|++
expr_stmt|;
block|}
comment|/* flip the slider limits and values, if necessary */
if|if
condition|(
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_reverse
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_sliders
condition|;
name|i
operator|++
control|)
block|{
name|gdouble
name|temp
decl_stmt|;
name|sliders
index|[
name|i
index|]
operator|.
name|value
operator|=
literal|1.0
operator|-
name|sliders
index|[
name|i
index|]
operator|.
name|value
expr_stmt|;
name|temp
operator|=
name|sliders
index|[
name|i
index|]
operator|.
name|min
expr_stmt|;
name|sliders
index|[
name|i
index|]
operator|.
name|min
operator|=
literal|1.0
operator|-
name|sliders
index|[
name|i
index|]
operator|.
name|max
expr_stmt|;
name|sliders
index|[
name|i
index|]
operator|.
name|max
operator|=
literal|1.0
operator|-
name|temp
expr_stmt|;
block|}
block|}
comment|/* adjust the sliders according to the offset */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_sliders
condition|;
name|i
operator|++
control|)
block|{
name|sliders
index|[
name|i
index|]
operator|.
name|value
operator|=
operator|(
literal|1.0
operator|-
name|offset
operator|)
operator|*
name|sliders
index|[
name|i
index|]
operator|.
name|value
operator|+
name|offset
expr_stmt|;
name|sliders
index|[
name|i
index|]
operator|.
name|min
operator|=
operator|(
literal|1.0
operator|-
name|offset
operator|)
operator|*
name|sliders
index|[
name|i
index|]
operator|.
name|min
operator|+
name|offset
expr_stmt|;
name|sliders
index|[
name|i
index|]
operator|.
name|max
operator|=
operator|(
literal|1.0
operator|-
name|offset
operator|)
operator|*
name|sliders
index|[
name|i
index|]
operator|.
name|max
operator|+
name|offset
expr_stmt|;
block|}
comment|/* avoid updating the gradient in gimp_gradient_tool_editor_line_changed() */
name|gimp_gradient_tool_editor_block_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_tool_line_set_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|sliders
argument_list|,
name|n_sliders
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_unblock_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|sliders
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_purge_gradient_history (GSList ** stack)
name|gimp_gradient_tool_editor_purge_gradient_history
parameter_list|(
name|GSList
modifier|*
modifier|*
name|stack
parameter_list|)
block|{
name|GSList
modifier|*
name|link
decl_stmt|;
comment|/* eliminate all history steps that modify the gradient */
while|while
condition|(
operator|(
name|link
operator|=
operator|*
name|stack
operator|)
condition|)
block|{
name|GradientInfo
modifier|*
name|info
init|=
name|link
operator|->
name|data
decl_stmt|;
if|if
condition|(
name|info
operator|->
name|gradient
condition|)
block|{
name|gimp_gradient_tool_editor_gradient_info_free
argument_list|(
name|info
argument_list|)
expr_stmt|;
operator|*
name|stack
operator|=
name|g_slist_delete_link
argument_list|(
operator|*
name|stack
argument_list|,
name|link
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|stack
operator|=
operator|&
name|link
operator|->
name|next
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_purge_gradient (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_purge_gradient
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
if|if
condition|(
name|gradient_tool
operator|->
name|widget
condition|)
block|{
name|gimp_gradient_tool_editor_update_sliders
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_tool_line_set_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|GIMP_TOOL_LINE_HANDLE_NONE
argument_list|)
expr_stmt|;
block|}
name|gimp_gradient_tool_editor_purge_gradient_history
argument_list|(
operator|&
name|gradient_tool
operator|->
name|undo_stack
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_purge_gradient_history
argument_list|(
operator|&
name|gradient_tool
operator|->
name|redo_stack
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|gimp_gradient_tool_editor_color_entry_new (GimpGradientTool * gradient_tool,const gchar * title,Direction direction,GtkWidget * chain_button,GtkWidget ** color_panel,GtkWidget ** type_combo)
name|gimp_gradient_tool_editor_color_entry_new
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
specifier|const
name|gchar
modifier|*
name|title
parameter_list|,
name|Direction
name|direction
parameter_list|,
name|GtkWidget
modifier|*
name|chain_button
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|color_panel
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|type_combo
parameter_list|)
block|{
name|GimpContext
modifier|*
name|context
init|=
name|GIMP_CONTEXT
argument_list|(
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
argument_list|)
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|combo
decl_stmt|;
name|GimpRGB
name|color
init|=
block|{}
decl_stmt|;
name|hbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/* the color panel */
operator|*
name|color_panel
operator|=
name|button
operator|=
name|gimp_color_panel_new
argument_list|(
name|title
argument_list|,
operator|&
name|color
argument_list|,
name|GIMP_COLOR_AREA_SMALL_CHECKS
argument_list|,
literal|24
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|gimp_color_button_set_update
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_color_panel_set_context
argument_list|(
name|GIMP_COLOR_PANEL
argument_list|(
name|button
argument_list|)
argument_list|,
name|context
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-direction"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|direction
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-chain-button"
argument_list|,
name|chain_button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_color_entry_color_clicked
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"color-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_color_entry_color_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_color_entry_color_response
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
comment|/* the color type combo */
operator|*
name|type_combo
operator|=
name|combo
operator|=
name|gimp_enum_combo_box_new
argument_list|(
name|GIMP_TYPE_GRADIENT_COLOR
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|combo
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|combo
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|combo
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-direction"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|direction
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|combo
argument_list|)
argument_list|,
literal|"gimp-gradient-tool-editor-chain-button"
argument_list|,
name|chain_button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_color_entry_type_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
return|return
name|hbox
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_init_endpoint_gui (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_init_endpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpDisplay
modifier|*
name|display
init|=
name|GIMP_TOOL
argument_list|(
name|gradient_tool
argument_list|)
operator|->
name|display
decl_stmt|;
name|GimpDisplayShell
modifier|*
name|shell
init|=
name|gimp_display_get_shell
argument_list|(
name|display
argument_list|)
decl_stmt|;
name|GimpImage
modifier|*
name|image
init|=
name|gimp_display_get_image
argument_list|(
name|display
argument_list|)
decl_stmt|;
name|gdouble
name|xres
decl_stmt|;
name|gdouble
name|yres
decl_stmt|;
name|GtkWidget
modifier|*
name|editor
decl_stmt|;
name|GtkWidget
modifier|*
name|grid
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|se
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|gint
name|row
init|=
literal|0
decl_stmt|;
name|gimp_image_get_resolution
argument_list|(
name|image
argument_list|,
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
comment|/* the endpoint editor */
name|gradient_tool
operator|->
name|endpoint_editor
operator|=
name|editor
operator|=
name|gimp_editor_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gimp_tool_gui_get_vbox
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|)
argument_list|)
argument_list|,
name|editor
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* the main grid */
name|grid
operator|=
name|gtk_grid_new
argument_list|()
expr_stmt|;
name|gtk_grid_set_row_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_grid_set_column_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|editor
argument_list|)
argument_list|,
name|grid
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|grid
argument_list|)
expr_stmt|;
comment|/* the position labels */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"X:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Y:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* the position size entry */
name|spinbutton
operator|=
name|gtk_spin_button_new_with_range
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_spin_button_set_numeric
argument_list|(
name|GTK_SPIN_BUTTON
argument_list|(
name|spinbutton
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_entry_set_width_chars
argument_list|(
name|GTK_ENTRY
argument_list|(
name|spinbutton
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|endpoint_se
operator|=
name|se
operator|=
name|gimp_size_entry_new
argument_list|(
literal|1
argument_list|,
name|GIMP_UNIT_PIXEL
argument_list|,
literal|"%a"
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|6
argument_list|,
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
argument_list|)
expr_stmt|;
name|gtk_grid_set_row_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|se
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_grid_set_column_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|se
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gimp_size_entry_add_field
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
name|GTK_SPIN_BUTTON
argument_list|(
name|spinbutton
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|se
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|se
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|se
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_unit
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
name|shell
operator|->
name|unit
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_resolution
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
literal|0
argument_list|,
name|xres
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_resolution
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
literal|1
argument_list|,
name|yres
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
name|GIMP_MAX_IMAGE_SIZE
argument_list|,
name|GIMP_MAX_IMAGE_SIZE
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
literal|1
argument_list|,
operator|-
name|GIMP_MAX_IMAGE_SIZE
argument_list|,
name|GIMP_MAX_IMAGE_SIZE
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_size
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_size
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|se
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_endpoint_se_value_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|row
operator|+=
literal|2
expr_stmt|;
comment|/* the color label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Color:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* the color entry */
name|hbox
operator|=
name|gimp_gradient_tool_editor_color_entry_new
argument_list|(
name|gradient_tool
argument_list|,
name|_
argument_list|(
literal|"Change Endpoint Color"
argument_list|)
argument_list|,
name|DIRECTION_NONE
argument_list|,
name|NULL
argument_list|,
operator|&
name|gradient_tool
operator|->
name|endpoint_color_panel
argument_list|,
operator|&
name|gradient_tool
operator|->
name|endpoint_type_combo
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|hbox
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|row
operator|++
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_init_stop_gui (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_init_stop_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|editor
decl_stmt|;
name|GtkWidget
modifier|*
name|grid
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|se
decl_stmt|;
name|GtkWidget
modifier|*
name|grid2
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|separator
decl_stmt|;
name|gint
name|row
init|=
literal|0
decl_stmt|;
comment|/* the stop editor */
name|gradient_tool
operator|->
name|stop_editor
operator|=
name|editor
operator|=
name|gimp_editor_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gimp_tool_gui_get_vbox
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|)
argument_list|)
argument_list|,
name|editor
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* the main grid */
name|grid
operator|=
name|gtk_grid_new
argument_list|()
expr_stmt|;
name|gtk_grid_set_row_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_grid_set_column_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|editor
argument_list|)
argument_list|,
name|grid
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|grid
argument_list|)
expr_stmt|;
comment|/* the position label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Position:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* the position size entry */
name|gradient_tool
operator|->
name|stop_se
operator|=
name|se
operator|=
name|gimp_size_entry_new
argument_list|(
literal|1
argument_list|,
name|GIMP_UNIT_PERCENT
argument_list|,
literal|"%a"
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|6
argument_list|,
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
argument_list|)
expr_stmt|;
name|gimp_size_entry_show_unit_menu
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|se
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|se
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|se
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_stop_se_value_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|row
operator|++
expr_stmt|;
comment|/* the color labels */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Left color:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Right color:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
operator|+
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* the color entries grid */
name|grid2
operator|=
name|gtk_grid_new
argument_list|()
expr_stmt|;
name|gtk_grid_set_row_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid2
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_grid_set_column_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid2
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|grid2
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|grid2
argument_list|)
expr_stmt|;
comment|/* the color entries chain button */
name|gradient_tool
operator|->
name|stop_chain_button
operator|=
name|button
operator|=
name|gimp_chain_button_new
argument_list|(
name|GIMP_CHAIN_RIGHT
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid2
argument_list|)
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* the color entries */
name|hbox
operator|=
name|gimp_gradient_tool_editor_color_entry_new
argument_list|(
name|gradient_tool
argument_list|,
name|_
argument_list|(
literal|"Change Stop Color"
argument_list|)
argument_list|,
name|DIRECTION_LEFT
argument_list|,
name|button
argument_list|,
operator|&
name|gradient_tool
operator|->
name|stop_left_color_panel
argument_list|,
operator|&
name|gradient_tool
operator|->
name|stop_left_type_combo
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid2
argument_list|)
argument_list|,
name|hbox
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gimp_gradient_tool_editor_color_entry_new
argument_list|(
name|gradient_tool
argument_list|,
name|_
argument_list|(
literal|"Change Stop Color"
argument_list|)
argument_list|,
name|DIRECTION_RIGHT
argument_list|,
name|button
argument_list|,
operator|&
name|gradient_tool
operator|->
name|stop_right_color_panel
argument_list|,
operator|&
name|gradient_tool
operator|->
name|stop_right_type_combo
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid2
argument_list|)
argument_list|,
name|hbox
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|row
operator|+=
literal|2
expr_stmt|;
comment|/* the action buttons separator */
name|separator
operator|=
name|gtk_separator_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|separator
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|separator
argument_list|)
expr_stmt|;
name|row
operator|++
expr_stmt|;
comment|/* the delete button */
name|gimp_editor_add_button
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|editor
argument_list|)
argument_list|,
name|GIMP_ICON_EDIT_DELETE
argument_list|,
name|_
argument_list|(
literal|"Delete stop"
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_stop_delete_clicked
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_init_midpoint_gui (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_init_midpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|editor
decl_stmt|;
name|GtkWidget
modifier|*
name|grid
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|se
decl_stmt|;
name|GtkWidget
modifier|*
name|combo
decl_stmt|;
name|GtkWidget
modifier|*
name|separator
decl_stmt|;
name|gint
name|row
init|=
literal|0
decl_stmt|;
comment|/* the stop editor */
name|gradient_tool
operator|->
name|midpoint_editor
operator|=
name|editor
operator|=
name|gimp_editor_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gimp_tool_gui_get_vbox
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|)
argument_list|)
argument_list|,
name|editor
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* the main grid */
name|grid
operator|=
name|gtk_grid_new
argument_list|()
expr_stmt|;
name|gtk_grid_set_row_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_grid_set_column_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|editor
argument_list|)
argument_list|,
name|grid
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|grid
argument_list|)
expr_stmt|;
comment|/* the position label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Position:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* the position size entry */
name|gradient_tool
operator|->
name|midpoint_se
operator|=
name|se
operator|=
name|gimp_size_entry_new
argument_list|(
literal|1
argument_list|,
name|GIMP_UNIT_PERCENT
argument_list|,
literal|"%a"
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|6
argument_list|,
name|GIMP_SIZE_ENTRY_UPDATE_SIZE
argument_list|)
expr_stmt|;
name|gimp_size_entry_show_unit_menu
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|se
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|se
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|se
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|se
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_midpoint_se_value_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|row
operator|++
expr_stmt|;
comment|/* the type label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Blending:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* the type combo */
name|gradient_tool
operator|->
name|midpoint_type_combo
operator|=
name|combo
operator|=
name|gimp_enum_combo_box_new
argument_list|(
name|GIMP_TYPE_GRADIENT_SEGMENT_TYPE
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|combo
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|combo
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_midpoint_type_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|row
operator|++
expr_stmt|;
comment|/* the color label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Coloring:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* the color combo */
name|gradient_tool
operator|->
name|midpoint_color_combo
operator|=
name|combo
operator|=
name|gimp_enum_combo_box_new
argument_list|(
name|GIMP_TYPE_GRADIENT_SEGMENT_COLOR
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|combo
argument_list|,
literal|1
argument_list|,
name|row
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|combo
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|combo
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_midpoint_color_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|row
operator|++
expr_stmt|;
comment|/* the action buttons separator */
name|separator
operator|=
name|gtk_separator_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|separator
argument_list|,
literal|0
argument_list|,
name|row
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|separator
argument_list|)
expr_stmt|;
name|row
operator|++
expr_stmt|;
comment|/* the new stop button */
name|gradient_tool
operator|->
name|midpoint_new_stop_button
operator|=
name|gimp_editor_add_button
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|editor
argument_list|)
argument_list|,
name|GIMP_ICON_DOCUMENT_NEW
argument_list|,
name|_
argument_list|(
literal|"New stop at midpoint"
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_midpoint_new_stop_clicked
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
comment|/* the center button */
name|gradient_tool
operator|->
name|midpoint_center_button
operator|=
name|gimp_editor_add_button
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|editor
argument_list|)
argument_list|,
name|GIMP_ICON_CENTER_HORIZONTAL
argument_list|,
name|_
argument_list|(
literal|"Center midpoint"
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_midpoint_center_clicked
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_update_endpoint_gui (GimpGradientTool * gradient_tool,gint selection)
name|gimp_gradient_tool_editor_update_endpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|selection
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpPaintOptions
modifier|*
name|paint_options
init|=
name|GIMP_PAINT_OPTIONS
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|GimpContext
modifier|*
name|context
init|=
name|GIMP_CONTEXT
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|gboolean
name|editable
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|title
decl_stmt|;
name|gdouble
name|x
decl_stmt|;
name|gdouble
name|y
decl_stmt|;
name|GimpRGB
name|color
decl_stmt|;
name|GimpGradientColor
name|color_type
decl_stmt|;
name|editable
operator|=
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|g_object_get
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"x1"
argument_list|,
operator|&
name|x
argument_list|,
literal|"y1"
argument_list|,
operator|&
name|y
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|g_object_get
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"x2"
argument_list|,
operator|&
name|x
argument_list|,
literal|"y2"
argument_list|,
operator|&
name|y
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gimp_assert_not_reached
argument_list|()
expr_stmt|;
block|}
comment|/* swap the endpoint handles, if necessary */
if|if
condition|(
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_reverse
condition|)
block|{
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_END
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_START
expr_stmt|;
break|break;
block|}
block|}
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|title
operator|=
name|_
argument_list|(
literal|"Start Endpoint"
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_get_left_flat_color
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|context
argument_list|,
name|seg
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|color_type
operator|=
name|seg
operator|->
name|left_color_type
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|title
operator|=
name|_
argument_list|(
literal|"End Endpoint"
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_get_right_flat_color
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|context
argument_list|,
name|seg
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|color_type
operator|=
name|seg
operator|->
name|right_color_type
expr_stmt|;
break|break;
default|default:
name|gimp_assert_not_reached
argument_list|()
expr_stmt|;
block|}
name|gimp_tool_gui_set_title
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|gradient_tool
operator|->
name|endpoint_se
argument_list|)
argument_list|,
literal|0
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|gradient_tool
operator|->
name|endpoint_se
argument_list|)
argument_list|,
literal|1
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gimp_color_button_set_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|gradient_tool
operator|->
name|endpoint_color_panel
argument_list|)
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|gradient_tool
operator|->
name|endpoint_type_combo
argument_list|)
argument_list|,
name|color_type
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|endpoint_color_panel
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|endpoint_type_combo
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_tool
operator|->
name|endpoint_editor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_update_stop_gui (GimpGradientTool * gradient_tool,gint selection)
name|gimp_gradient_tool_editor_update_stop_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|selection
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpContext
modifier|*
name|context
init|=
name|GIMP_CONTEXT
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|gboolean
name|editable
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gint
name|index
decl_stmt|;
name|gchar
modifier|*
name|title
decl_stmt|;
name|gdouble
name|min
decl_stmt|;
name|gdouble
name|max
decl_stmt|;
name|gdouble
name|value
decl_stmt|;
name|GimpRGB
name|left_color
decl_stmt|;
name|GimpGradientColor
name|left_color_type
decl_stmt|;
name|GimpRGB
name|right_color
decl_stmt|;
name|GimpGradientColor
name|right_color_type
decl_stmt|;
name|editable
operator|=
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|index
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|NULL
argument_list|)
index|[
name|selection
index|]
operator|.
name|data
argument_list|)
expr_stmt|;
name|title
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Stop %d"
argument_list|)
argument_list|,
name|index
operator|+
literal|1
argument_list|)
expr_stmt|;
name|min
operator|=
name|seg
operator|->
name|left
expr_stmt|;
name|max
operator|=
name|seg
operator|->
name|next
operator|->
name|right
expr_stmt|;
name|value
operator|=
name|seg
operator|->
name|right
expr_stmt|;
name|gimp_gradient_segment_get_right_flat_color
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|context
argument_list|,
name|seg
argument_list|,
operator|&
name|left_color
argument_list|)
expr_stmt|;
name|left_color_type
operator|=
name|seg
operator|->
name|right_color_type
expr_stmt|;
name|gimp_gradient_segment_get_left_flat_color
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|context
argument_list|,
name|seg
operator|->
name|next
argument_list|,
operator|&
name|right_color
argument_list|)
expr_stmt|;
name|right_color_type
operator|=
name|seg
operator|->
name|next
operator|->
name|left_color_type
expr_stmt|;
name|gimp_tool_gui_set_title
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|gradient_tool
operator|->
name|stop_se
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|100.0
operator|*
name|min
argument_list|,
literal|100.0
operator|*
name|max
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|gradient_tool
operator|->
name|stop_se
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|100.0
operator|*
name|value
argument_list|)
expr_stmt|;
name|gimp_color_button_set_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|gradient_tool
operator|->
name|stop_left_color_panel
argument_list|)
argument_list|,
operator|&
name|left_color
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|gradient_tool
operator|->
name|stop_left_type_combo
argument_list|)
argument_list|,
name|left_color_type
argument_list|)
expr_stmt|;
name|gimp_color_button_set_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|gradient_tool
operator|->
name|stop_right_color_panel
argument_list|)
argument_list|,
operator|&
name|right_color
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|gradient_tool
operator|->
name|stop_right_type_combo
argument_list|)
argument_list|,
name|right_color_type
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|stop_se
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|stop_left_color_panel
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|stop_left_type_combo
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|stop_right_color_panel
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|stop_right_type_combo
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|stop_chain_button
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|GTK_WIDGET
argument_list|(
name|gimp_editor_get_button_box
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|gradient_tool
operator|->
name|stop_editor
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_tool
operator|->
name|stop_editor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_update_midpoint_gui (GimpGradientTool * gradient_tool,gint selection)
name|gimp_gradient_tool_editor_update_midpoint_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gint
name|selection
parameter_list|)
block|{
name|gboolean
name|editable
decl_stmt|;
specifier|const
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gint
name|index
decl_stmt|;
name|gchar
modifier|*
name|title
decl_stmt|;
name|gdouble
name|min
decl_stmt|;
name|gdouble
name|max
decl_stmt|;
name|gdouble
name|value
decl_stmt|;
name|GimpGradientSegmentType
name|type
decl_stmt|;
name|GimpGradientSegmentColor
name|color
decl_stmt|;
name|editable
operator|=
name|gimp_gradient_tool_editor_is_gradient_editable
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|index
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|NULL
argument_list|)
index|[
name|selection
index|]
operator|.
name|data
argument_list|)
expr_stmt|;
name|title
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Midpoint %d"
argument_list|)
argument_list|,
name|index
operator|+
literal|1
argument_list|)
expr_stmt|;
name|min
operator|=
name|seg
operator|->
name|left
expr_stmt|;
name|max
operator|=
name|seg
operator|->
name|right
expr_stmt|;
name|value
operator|=
name|seg
operator|->
name|middle
expr_stmt|;
name|type
operator|=
name|seg
operator|->
name|type
expr_stmt|;
name|color
operator|=
name|seg
operator|->
name|color
expr_stmt|;
name|gimp_tool_gui_set_title
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval_boundaries
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|gradient_tool
operator|->
name|midpoint_se
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|100.0
operator|*
name|min
argument_list|,
literal|100.0
operator|*
name|max
argument_list|)
expr_stmt|;
name|gimp_size_entry_set_refval
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|gradient_tool
operator|->
name|midpoint_se
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|100.0
operator|*
name|value
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|gradient_tool
operator|->
name|midpoint_type_combo
argument_list|)
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_set_active
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|gradient_tool
operator|->
name|midpoint_color_combo
argument_list|)
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|midpoint_new_stop_button
argument_list|,
name|value
operator|>
name|min
operator|+
name|EPSILON
operator|&&
name|value
operator|<
name|max
operator|-
name|EPSILON
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|midpoint_center_button
argument_list|,
name|fabs
argument_list|(
name|value
operator|-
operator|(
name|min
operator|+
name|max
operator|)
operator|/
literal|2.0
argument_list|)
operator|>
name|EPSILON
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|midpoint_se
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|midpoint_type_combo
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|gradient_tool
operator|->
name|midpoint_color_combo
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|GTK_WIDGET
argument_list|(
name|gimp_editor_get_button_box
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|gradient_tool
operator|->
name|midpoint_editor
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|editable
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gradient_tool
operator|->
name|midpoint_editor
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_update_gui (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_update_gui
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
if|if
condition|(
name|gradient_tool
operator|->
name|gradient
operator|&&
name|gradient_tool
operator|->
name|widget
operator|&&
operator|!
name|options
operator|->
name|instant
condition|)
block|{
name|gint
name|selection
decl_stmt|;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|selection
operator|!=
name|GIMP_TOOL_LINE_HANDLE_NONE
condition|)
block|{
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|gui
condition|)
block|{
name|GimpDisplayShell
modifier|*
name|shell
decl_stmt|;
name|shell
operator|=
name|gimp_tool_widget_get_shell
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|gui
operator|=
name|gimp_tool_gui_new
argument_list|(
name|GIMP_TOOL
argument_list|(
name|gradient_tool
argument_list|)
operator|->
name|tool_info
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_widget_get_monitor
argument_list|(
name|GTK_WIDGET
argument_list|(
name|shell
argument_list|)
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"_Close"
argument_list|)
argument_list|,
name|GTK_RESPONSE_CLOSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_tool_gui_set_shell
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|,
name|shell
argument_list|)
expr_stmt|;
name|gimp_tool_gui_set_viewable
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|,
name|GIMP_VIEWABLE
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_tool_gui_set_auto_overlay
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_gui_response
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_init_endpoint_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_init_stop_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_init_midpoint_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
name|gimp_gradient_tool_editor_block_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_handle_is_endpoint
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
condition|)
name|gimp_gradient_tool_editor_update_endpoint_gui
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_hide
argument_list|(
name|gradient_tool
operator|->
name|endpoint_editor
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_handle_is_stop
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
condition|)
name|gimp_gradient_tool_editor_update_stop_gui
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_hide
argument_list|(
name|gradient_tool
operator|->
name|stop_editor
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_handle_is_midpoint
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
condition|)
name|gimp_gradient_tool_editor_update_midpoint_gui
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_hide
argument_list|(
name|gradient_tool
operator|->
name|midpoint_editor
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_unblock_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_tool_gui_show
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|)
expr_stmt|;
return|return;
block|}
block|}
if|if
condition|(
name|gradient_tool
operator|->
name|gui
condition|)
name|gimp_tool_gui_hide
argument_list|(
name|gradient_tool
operator|->
name|gui
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GradientInfo
modifier|*
DECL|function|gimp_gradient_tool_editor_gradient_info_new (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_gradient_info_new
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GradientInfo
modifier|*
name|info
init|=
name|g_slice_new
argument_list|(
name|GradientInfo
argument_list|)
decl_stmt|;
name|info
operator|->
name|start_x
operator|=
name|gradient_tool
operator|->
name|start_x
expr_stmt|;
name|info
operator|->
name|start_y
operator|=
name|gradient_tool
operator|->
name|start_y
expr_stmt|;
name|info
operator|->
name|end_x
operator|=
name|gradient_tool
operator|->
name|end_x
expr_stmt|;
name|info
operator|->
name|end_y
operator|=
name|gradient_tool
operator|->
name|end_y
expr_stmt|;
name|info
operator|->
name|gradient
operator|=
name|NULL
expr_stmt|;
name|info
operator|->
name|added_handle
operator|=
name|GIMP_TOOL_LINE_HANDLE_NONE
expr_stmt|;
name|info
operator|->
name|removed_handle
operator|=
name|GIMP_TOOL_LINE_HANDLE_NONE
expr_stmt|;
name|info
operator|->
name|selected_handle
operator|=
name|GIMP_TOOL_LINE_HANDLE_NONE
expr_stmt|;
return|return
name|info
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_gradient_info_free (GradientInfo * info)
name|gimp_gradient_tool_editor_gradient_info_free
parameter_list|(
name|GradientInfo
modifier|*
name|info
parameter_list|)
block|{
if|if
condition|(
name|info
operator|->
name|gradient
condition|)
name|g_object_unref
argument_list|(
name|info
operator|->
name|gradient
argument_list|)
expr_stmt|;
name|g_slice_free
argument_list|(
name|GradientInfo
argument_list|,
name|info
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gradient_tool_editor_gradient_info_apply (GimpGradientTool * gradient_tool,const GradientInfo * info,gboolean set_selection)
name|gimp_gradient_tool_editor_gradient_info_apply
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
specifier|const
name|GradientInfo
modifier|*
name|info
parameter_list|,
name|gboolean
name|set_selection
parameter_list|)
block|{
name|gint
name|selection
decl_stmt|;
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|widget
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|gradient
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* pick the handle to select */
if|if
condition|(
name|info
operator|->
name|gradient
condition|)
block|{
if|if
condition|(
name|info
operator|->
name|removed_handle
operator|!=
name|GIMP_TOOL_LINE_HANDLE_NONE
condition|)
block|{
comment|/* we're undoing a stop-deletion or midpoint-to-stop operation;            * select the removed handle            */
name|selection
operator|=
name|info
operator|->
name|removed_handle
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|info
operator|->
name|added_handle
operator|!=
name|GIMP_TOOL_LINE_HANDLE_NONE
condition|)
block|{
comment|/* we're undoing a stop addition operation */
name|gimp_assert
argument_list|(
name|gimp_gradient_tool_editor_handle_is_stop
argument_list|(
name|gradient_tool
argument_list|,
name|info
operator|->
name|added_handle
argument_list|)
argument_list|)
expr_stmt|;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
comment|/* if the selected handle is a stop... */
if|if
condition|(
name|gimp_gradient_tool_editor_handle_is_stop
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
condition|)
block|{
comment|/* if the added handle is selected, clear the selection */
if|if
condition|(
name|selection
operator|==
name|info
operator|->
name|added_handle
condition|)
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_NONE
expr_stmt|;
comment|/* otherwise, keep the currently selected stop, possibly                * adjusting its handle index                */
elseif|else
if|if
condition|(
name|selection
operator|>
name|info
operator|->
name|added_handle
condition|)
name|selection
operator|--
expr_stmt|;
block|}
comment|/* otherwise, if the selected handle is a midpoint... */
elseif|else
if|if
condition|(
name|gimp_gradient_tool_editor_handle_is_midpoint
argument_list|(
name|gradient_tool
argument_list|,
name|selection
argument_list|)
condition|)
block|{
specifier|const
name|GimpControllerSlider
modifier|*
name|sliders
decl_stmt|;
name|gint
name|seg_i
decl_stmt|;
name|sliders
operator|=
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|seg_i
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|sliders
index|[
name|selection
index|]
operator|.
name|data
argument_list|)
expr_stmt|;
comment|/* if the midpoint belongs to one of the two segments incident to                * the added stop, clear the selection                */
if|if
condition|(
name|seg_i
operator|==
name|info
operator|->
name|added_handle
operator|||
name|seg_i
operator|==
name|info
operator|->
name|added_handle
operator|+
literal|1
condition|)
block|{
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_NONE
expr_stmt|;
block|}
comment|/* otherwise, keep the currently selected stop, adjusting its                * handle index                */
else|else
block|{
comment|/* midpoint handles follow stop handles; since we removed a                    * stop, we must decrement the handle index                    */
name|selection
operator|--
expr_stmt|;
if|if
condition|(
name|seg_i
operator|>
name|info
operator|->
name|added_handle
condition|)
name|selection
operator|--
expr_stmt|;
block|}
block|}
comment|/* otherwise, don't change the selection */
else|else
block|{
name|set_selection
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|info
operator|->
name|selected_handle
operator|!=
name|GIMP_TOOL_LINE_HANDLE_NONE
condition|)
block|{
comment|/* we're undoing a property change operation; select the handle            * corresponding to the affected object            */
name|selection
operator|=
name|info
operator|->
name|selected_handle
expr_stmt|;
block|}
else|else
block|{
comment|/* something went wrong... */
name|g_warn_if_reached
argument_list|()
expr_stmt|;
name|set_selection
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|info
operator|->
name|start_x
operator|!=
name|gradient_tool
operator|->
name|start_x
operator|||
name|info
operator|->
name|start_y
operator|!=
name|gradient_tool
operator|->
name|start_y
operator|)
operator|&&
operator|(
name|info
operator|->
name|end_x
operator|==
name|gradient_tool
operator|->
name|end_x
operator|&&
name|info
operator|->
name|end_y
operator|==
name|gradient_tool
operator|->
name|end_y
operator|)
condition|)
block|{
comment|/* we're undoing a start-endpoint move operation; select the start        * endpoint        */
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_START
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|info
operator|->
name|end_x
operator|!=
name|gradient_tool
operator|->
name|end_x
operator|||
name|info
operator|->
name|end_y
operator|!=
name|gradient_tool
operator|->
name|end_y
operator|)
operator|&&
operator|(
name|info
operator|->
name|start_x
operator|==
name|gradient_tool
operator|->
name|start_x
operator|&&
name|info
operator|->
name|start_y
operator|==
name|gradient_tool
operator|->
name|start_y
operator|)
condition|)
block|{
comment|/* we're undoing am end-endpoint move operation; select the end        * endpoint        */
name|selection
operator|=
name|GIMP_TOOL_LINE_HANDLE_END
expr_stmt|;
block|}
else|else
block|{
comment|/* we're undoing a line move operation; don't change the selection */
name|set_selection
operator|=
name|FALSE
expr_stmt|;
block|}
name|gimp_gradient_tool_editor_block_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_object_set
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"x1"
argument_list|,
name|info
operator|->
name|start_x
argument_list|,
literal|"y1"
argument_list|,
name|info
operator|->
name|start_y
argument_list|,
literal|"x2"
argument_list|,
name|info
operator|->
name|end_x
argument_list|,
literal|"y2"
argument_list|,
name|info
operator|->
name|end_y
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|gradient
condition|)
block|{
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_data_copy
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|,
name|GIMP_DATA
argument_list|(
name|info
operator|->
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|set_selection
condition|)
block|{
name|gimp_tool_line_set_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|selection
argument_list|)
expr_stmt|;
block|}
name|gimp_gradient_tool_editor_update_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_unblock_handlers
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_gradient_tool_editor_gradient_info_is_trivial (GimpGradientTool * gradient_tool,const GradientInfo * info)
name|gimp_gradient_tool_editor_gradient_info_is_trivial
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
specifier|const
name|GradientInfo
modifier|*
name|info
parameter_list|)
block|{
specifier|const
name|GimpGradientSegment
modifier|*
name|seg1
decl_stmt|;
specifier|const
name|GimpGradientSegment
modifier|*
name|seg2
decl_stmt|;
if|if
condition|(
name|info
operator|->
name|start_x
operator|!=
name|gradient_tool
operator|->
name|start_x
operator|||
name|info
operator|->
name|start_y
operator|!=
name|gradient_tool
operator|->
name|start_y
operator|||
name|info
operator|->
name|end_x
operator|!=
name|gradient_tool
operator|->
name|end_x
operator|||
name|info
operator|->
name|end_y
operator|!=
name|gradient_tool
operator|->
name|end_y
condition|)
block|{
return|return
name|FALSE
return|;
block|}
if|if
condition|(
name|info
operator|->
name|gradient
condition|)
block|{
for|for
control|(
name|seg1
operator|=
name|info
operator|->
name|gradient
operator|->
name|segments
operator|,
name|seg2
operator|=
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
init|;
name|seg1
operator|&&
name|seg2
condition|;
name|seg1
operator|=
name|seg1
operator|->
name|next
operator|,
name|seg2
operator|=
name|seg2
operator|->
name|next
control|)
block|{
if|if
condition|(
name|memcmp
argument_list|(
name|seg1
argument_list|,
name|seg2
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpGradientSegment
argument_list|,
name|prev
argument_list|)
argument_list|)
condition|)
return|return
name|FALSE
return|;
block|}
if|if
condition|(
name|seg1
operator|||
name|seg2
condition|)
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/*  public functions  */
end_comment

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_options_notify (GimpGradientTool * gradient_tool,GimpToolOptions * options,const GParamSpec * pspec)
name|gimp_gradient_tool_editor_options_notify
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|GimpToolOptions
modifier|*
name|options
parameter_list|,
specifier|const
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|pspec
operator|->
name|name
argument_list|,
literal|"modify-active"
argument_list|)
condition|)
block|{
name|gimp_gradient_tool_editor_update_sliders
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_update_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|pspec
operator|->
name|name
argument_list|,
literal|"gradient-reverse"
argument_list|)
condition|)
block|{
name|gimp_gradient_tool_editor_update_sliders
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
comment|/* if an endpoint is selected, swap the selected endpoint */
if|if
condition|(
name|gradient_tool
operator|->
name|widget
condition|)
block|{
name|gint
name|selection
decl_stmt|;
name|selection
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|selection
condition|)
block|{
case|case
name|GIMP_TOOL_LINE_HANDLE_START
case|:
name|gimp_tool_line_set_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|GIMP_TOOL_LINE_HANDLE_END
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_TOOL_LINE_HANDLE_END
case|:
name|gimp_tool_line_set_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
name|GIMP_TOOL_LINE_HANDLE_START
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|gradient_tool
operator|->
name|render_node
operator|&&
name|gegl_node_find_property
argument_list|(
name|gradient_tool
operator|->
name|render_node
argument_list|,
name|pspec
operator|->
name|name
argument_list|)
condition|)
block|{
name|gimp_gradient_tool_editor_update_sliders
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_start (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_start
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|g_signal_connect
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"can-add-slider"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_line_can_add_slider
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"add-slider"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_line_add_slider
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"prepare-to-remove-slider"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_line_prepare_to_remove_slider
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"remove-slider"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_line_remove_slider
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"selection-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_line_selection_changed
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|,
literal|"handle-clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_gradient_tool_editor_line_handle_clicked
argument_list|)
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_halt (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_halt
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|g_clear_object
argument_list|(
operator|&
name|gradient_tool
operator|->
name|gui
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|edit_count
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|gradient_tool
operator|->
name|undo_stack
condition|)
block|{
name|g_slist_free_full
argument_list|(
name|gradient_tool
operator|->
name|undo_stack
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|gimp_gradient_tool_editor_gradient_info_free
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|undo_stack
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|gradient_tool
operator|->
name|redo_stack
condition|)
block|{
name|g_slist_free_full
argument_list|(
name|gradient_tool
operator|->
name|redo_stack
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|gimp_gradient_tool_editor_gradient_info_free
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|redo_stack
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|gradient_tool
operator|->
name|flush_idle_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|gradient_tool
operator|->
name|flush_idle_id
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|flush_idle_id
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_gradient_tool_editor_line_changed (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_line_changed
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpPaintOptions
modifier|*
name|paint_options
init|=
name|GIMP_PAINT_OPTIONS
argument_list|(
name|options
argument_list|)
decl_stmt|;
name|gdouble
name|offset
init|=
name|options
operator|->
name|offset
operator|/
literal|100.0
decl_stmt|;
specifier|const
name|GimpControllerSlider
modifier|*
name|sliders
decl_stmt|;
name|gint
name|n_sliders
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|GimpGradientSegment
modifier|*
name|seg
decl_stmt|;
name|gboolean
name|changed
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|gradient
operator|||
name|offset
operator|==
literal|1.0
condition|)
return|return
name|FALSE
return|;
name|sliders
operator|=
name|gimp_tool_line_get_sliders
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|,
operator|&
name|n_sliders
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_sliders
operator|==
literal|0
condition|)
return|return
name|FALSE
return|;
comment|/* update the midpoints first, since moving the gradient stops may change the    * gradient's midpoints w.r.t. the sliders, but not the other way around.    */
for|for
control|(
name|seg
operator|=
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
operator|,
name|i
operator|=
name|n_sliders
operator|/
literal|2
init|;
name|seg
condition|;
name|seg
operator|=
name|seg
operator|->
name|next
operator|,
name|i
operator|++
control|)
block|{
name|gdouble
name|value
decl_stmt|;
name|value
operator|=
name|sliders
index|[
name|i
index|]
operator|.
name|value
expr_stmt|;
comment|/* adjust slider value according to the offset */
name|value
operator|=
operator|(
name|value
operator|-
name|offset
operator|)
operator|/
operator|(
literal|1.0
operator|-
name|offset
operator|)
expr_stmt|;
comment|/* flip the slider value, if necessary */
if|if
condition|(
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_reverse
condition|)
name|value
operator|=
literal|1.0
operator|-
name|value
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|value
operator|-
name|seg
operator|->
name|middle
argument_list|)
operator|>
name|EPSILON
condition|)
block|{
if|if
condition|(
operator|!
name|changed
condition|)
block|{
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
comment|/* refetch the segment, since the gradient might have changed */
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|changed
operator|=
name|TRUE
expr_stmt|;
block|}
name|seg
operator|->
name|middle
operator|=
name|value
expr_stmt|;
block|}
block|}
comment|/* update the gradient stops */
for|for
control|(
name|seg
operator|=
name|gradient_tool
operator|->
name|gradient
operator|->
name|segments
operator|,
name|i
operator|=
literal|0
init|;
name|seg
operator|->
name|next
condition|;
name|seg
operator|=
name|seg
operator|->
name|next
operator|,
name|i
operator|++
control|)
block|{
name|gdouble
name|value
decl_stmt|;
name|value
operator|=
name|sliders
index|[
name|i
index|]
operator|.
name|value
expr_stmt|;
comment|/* adjust slider value according to the offset */
name|value
operator|=
operator|(
name|value
operator|-
name|offset
operator|)
operator|/
operator|(
literal|1.0
operator|-
name|offset
operator|)
expr_stmt|;
comment|/* flip the slider value, if necessary */
if|if
condition|(
name|paint_options
operator|->
name|gradient_options
operator|->
name|gradient_reverse
condition|)
name|value
operator|=
literal|1.0
operator|-
name|value
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|value
operator|-
name|seg
operator|->
name|right
argument_list|)
operator|>
name|EPSILON
condition|)
block|{
if|if
condition|(
operator|!
name|changed
condition|)
block|{
name|gimp_gradient_tool_editor_start_edit
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_freeze_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
comment|/* refetch the segment, since the gradient might have changed */
name|seg
operator|=
name|gimp_gradient_tool_editor_handle_get_segment
argument_list|(
name|gradient_tool
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|changed
operator|=
name|TRUE
expr_stmt|;
block|}
name|gimp_gradient_segment_range_compress
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|seg
argument_list|,
name|seg
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|gimp_gradient_segment_range_compress
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|,
name|seg
operator|->
name|next
argument_list|,
name|seg
operator|->
name|next
argument_list|,
name|value
argument_list|,
name|seg
operator|->
name|next
operator|->
name|right
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|changed
condition|)
block|{
name|gimp_gradient_tool_editor_thaw_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_end_edit
argument_list|(
name|gradient_tool
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
name|gimp_gradient_tool_editor_update_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
return|return
name|changed
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_fg_bg_changed (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_fg_bg_changed
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|gimp_gradient_tool_editor_update_gui
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_gradient_dirty (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_gradient_dirty
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|gimp_gradient_tool_editor_purge_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_gradient_changed (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_gradient_changed
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpGradientOptions
modifier|*
name|options
init|=
name|GIMP_GRADIENT_TOOL_GET_OPTIONS
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GimpContext
modifier|*
name|context
init|=
name|GIMP_CONTEXT
argument_list|(
name|options
argument_list|)
decl_stmt|;
if|if
condition|(
name|options
operator|->
name|modify_active_frame
condition|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|options
operator|->
name|modify_active_frame
argument_list|,
name|gradient_tool
operator|->
name|gradient
operator|!=
name|gimp_gradients_get_custom
argument_list|(
name|context
operator|->
name|gimp
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|options
operator|->
name|modify_active_hint
condition|)
block|{
name|gtk_widget_set_visible
argument_list|(
name|options
operator|->
name|modify_active_hint
argument_list|,
name|gradient_tool
operator|->
name|gradient
operator|&&
operator|!
name|gimp_data_is_writable
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gimp_gradient_tool_editor_are_handlers_blocked
argument_list|(
name|gradient_tool
argument_list|)
condition|)
return|return;
name|gimp_gradient_tool_editor_purge_gradient
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|const
name|gchar
modifier|*
DECL|function|gimp_gradient_tool_editor_can_undo (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_can_undo
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|undo_stack
operator|||
name|gradient_tool
operator|->
name|edit_count
operator|>
literal|0
condition|)
return|return
name|NULL
return|;
return|return
name|_
argument_list|(
literal|"Gradient Step"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|gchar
modifier|*
DECL|function|gimp_gradient_tool_editor_can_redo (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_can_redo
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|redo_stack
operator|||
name|gradient_tool
operator|->
name|edit_count
operator|>
literal|0
condition|)
return|return
name|NULL
return|;
return|return
name|_
argument_list|(
literal|"Gradient Step"
argument_list|)
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_gradient_tool_editor_undo (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_undo
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GimpTool
modifier|*
name|tool
init|=
name|GIMP_TOOL
argument_list|(
name|gradient_tool
argument_list|)
decl_stmt|;
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|GradientInfo
modifier|*
name|new_info
decl_stmt|;
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|undo_stack
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|edit_count
operator|==
literal|0
argument_list|)
expr_stmt|;
name|info
operator|=
name|gradient_tool
operator|->
name|undo_stack
operator|->
name|data
expr_stmt|;
name|new_info
operator|=
name|gimp_gradient_tool_editor_gradient_info_new
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|gradient
condition|)
block|{
name|new_info
operator|->
name|gradient
operator|=
name|GIMP_GRADIENT
argument_list|(
name|gimp_data_duplicate
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* swap the added and removed handles, so that gradient_info_apply() does        * the right thing on redo        */
name|new_info
operator|->
name|added_handle
operator|=
name|info
operator|->
name|removed_handle
expr_stmt|;
name|new_info
operator|->
name|removed_handle
operator|=
name|info
operator|->
name|added_handle
expr_stmt|;
name|new_info
operator|->
name|selected_handle
operator|=
name|info
operator|->
name|selected_handle
expr_stmt|;
block|}
name|gradient_tool
operator|->
name|undo_stack
operator|=
name|g_slist_remove
argument_list|(
name|gradient_tool
operator|->
name|undo_stack
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|redo_stack
operator|=
name|g_slist_prepend
argument_list|(
name|gradient_tool
operator|->
name|redo_stack
argument_list|,
name|new_info
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_gradient_info_apply
argument_list|(
name|gradient_tool
argument_list|,
name|info
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_gradient_info_free
argument_list|(
name|info
argument_list|)
expr_stmt|;
comment|/* the initial state of the gradient tool is not useful; we might as well halt */
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|undo_stack
condition|)
name|gimp_tool_control
argument_list|(
name|tool
argument_list|,
name|GIMP_TOOL_ACTION_HALT
argument_list|,
name|tool
operator|->
name|display
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_gradient_tool_editor_redo (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_redo
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|GradientInfo
modifier|*
name|new_info
decl_stmt|;
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|redo_stack
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|gimp_assert
argument_list|(
name|gradient_tool
operator|->
name|edit_count
operator|==
literal|0
argument_list|)
expr_stmt|;
name|info
operator|=
name|gradient_tool
operator|->
name|redo_stack
operator|->
name|data
expr_stmt|;
name|new_info
operator|=
name|gimp_gradient_tool_editor_gradient_info_new
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|gradient
condition|)
block|{
name|new_info
operator|->
name|gradient
operator|=
name|GIMP_GRADIENT
argument_list|(
name|gimp_data_duplicate
argument_list|(
name|GIMP_DATA
argument_list|(
name|gradient_tool
operator|->
name|gradient
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* swap the added and removed handles, so that gradient_info_apply() does        * the right thing on undo        */
name|new_info
operator|->
name|added_handle
operator|=
name|info
operator|->
name|removed_handle
expr_stmt|;
name|new_info
operator|->
name|removed_handle
operator|=
name|info
operator|->
name|added_handle
expr_stmt|;
name|new_info
operator|->
name|selected_handle
operator|=
name|info
operator|->
name|selected_handle
expr_stmt|;
block|}
name|gradient_tool
operator|->
name|redo_stack
operator|=
name|g_slist_remove
argument_list|(
name|gradient_tool
operator|->
name|redo_stack
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|undo_stack
operator|=
name|g_slist_prepend
argument_list|(
name|gradient_tool
operator|->
name|undo_stack
argument_list|,
name|new_info
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_gradient_info_apply
argument_list|(
name|gradient_tool
argument_list|,
name|info
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_gradient_info_free
argument_list|(
name|info
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_start_edit (GimpGradientTool * gradient_tool)
name|gimp_gradient_tool_editor_start_edit
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|)
block|{
if|if
condition|(
name|gradient_tool
operator|->
name|edit_count
operator|++
operator|==
literal|0
condition|)
block|{
name|GradientInfo
modifier|*
name|info
decl_stmt|;
name|info
operator|=
name|gimp_gradient_tool_editor_gradient_info_new
argument_list|(
name|gradient_tool
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|undo_stack
operator|=
name|g_slist_prepend
argument_list|(
name|gradient_tool
operator|->
name|undo_stack
argument_list|,
name|info
argument_list|)
expr_stmt|;
comment|/*  update the undo actions / menu items  */
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|flush_idle_id
condition|)
block|{
name|gradient_tool
operator|->
name|flush_idle_id
operator|=
name|g_idle_add
argument_list|(
operator|(
name|GSourceFunc
operator|)
name|gimp_gradient_tool_editor_flush_idle
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_gradient_tool_editor_end_edit (GimpGradientTool * gradient_tool,gboolean cancel)
name|gimp_gradient_tool_editor_end_edit
parameter_list|(
name|GimpGradientTool
modifier|*
name|gradient_tool
parameter_list|,
name|gboolean
name|cancel
parameter_list|)
block|{
comment|/* can happen when halting using esc */
if|if
condition|(
name|gradient_tool
operator|->
name|edit_count
operator|==
literal|0
condition|)
return|return;
if|if
condition|(
operator|--
name|gradient_tool
operator|->
name|edit_count
operator|==
literal|0
condition|)
block|{
name|GradientInfo
modifier|*
name|info
init|=
name|gradient_tool
operator|->
name|undo_stack
operator|->
name|data
decl_stmt|;
name|info
operator|->
name|selected_handle
operator|=
name|gimp_tool_line_get_selection
argument_list|(
name|GIMP_TOOL_LINE
argument_list|(
name|gradient_tool
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|cancel
operator|||
name|gimp_gradient_tool_editor_gradient_info_is_trivial
argument_list|(
name|gradient_tool
argument_list|,
name|info
argument_list|)
condition|)
block|{
comment|/* if the edit is canceled, or if nothing changed, undo the last            * step            */
name|gimp_gradient_tool_editor_gradient_info_apply
argument_list|(
name|gradient_tool
argument_list|,
name|info
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|undo_stack
operator|=
name|g_slist_remove
argument_list|(
name|gradient_tool
operator|->
name|undo_stack
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|gimp_gradient_tool_editor_gradient_info_free
argument_list|(
name|info
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* otherwise, blow the redo stack */
name|g_slist_free_full
argument_list|(
name|gradient_tool
operator|->
name|redo_stack
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|gimp_gradient_tool_editor_gradient_info_free
argument_list|)
expr_stmt|;
name|gradient_tool
operator|->
name|redo_stack
operator|=
name|NULL
expr_stmt|;
block|}
comment|/*  update the undo actions / menu items  */
if|if
condition|(
operator|!
name|gradient_tool
operator|->
name|flush_idle_id
condition|)
block|{
name|gradient_tool
operator|->
name|flush_idle_id
operator|=
name|g_idle_add
argument_list|(
operator|(
name|GSourceFunc
operator|)
name|gimp_gradient_tool_editor_flush_idle
argument_list|,
name|gradient_tool
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

end_unit

