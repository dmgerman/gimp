begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"actionarea.h"
end_include

begin_include
include|#
directive|include
file|"buildmenu.h"
end_include

begin_include
include|#
directive|include
file|"colormaps.h"
end_include

begin_include
include|#
directive|include
file|"cursorutil.h"
end_include

begin_include
include|#
directive|include
file|"drawable.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimphistogram.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"curves.h"
end_include

begin_include
include|#
directive|include
file|"gimplut.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_define
DECL|macro|ROUND (x)
define|#
directive|define
name|ROUND
parameter_list|(
name|x
parameter_list|)
value|((int) ((x) + 0.5))
end_define

begin_define
DECL|macro|GRAPH
define|#
directive|define
name|GRAPH
value|0x1
end_define

begin_define
DECL|macro|XRANGE_TOP
define|#
directive|define
name|XRANGE_TOP
value|0x2
end_define

begin_define
DECL|macro|XRANGE_BOTTOM
define|#
directive|define
name|XRANGE_BOTTOM
value|0x4
end_define

begin_define
DECL|macro|YRANGE
define|#
directive|define
name|YRANGE
value|0x8
end_define

begin_define
DECL|macro|DRAW
define|#
directive|define
name|DRAW
value|0x10
end_define

begin_define
DECL|macro|ALL
define|#
directive|define
name|ALL
value|0xFF
end_define

begin_comment
comment|/*  NB: take care when changing these values: make sure the curve[] array in  *  curves.h is large enough.  */
end_comment

begin_define
DECL|macro|GRAPH_WIDTH
define|#
directive|define
name|GRAPH_WIDTH
value|256
end_define

begin_define
DECL|macro|GRAPH_HEIGHT
define|#
directive|define
name|GRAPH_HEIGHT
value|256
end_define

begin_define
DECL|macro|XRANGE_WIDTH
define|#
directive|define
name|XRANGE_WIDTH
value|256
end_define

begin_define
DECL|macro|XRANGE_HEIGHT
define|#
directive|define
name|XRANGE_HEIGHT
value|16
end_define

begin_define
DECL|macro|YRANGE_WIDTH
define|#
directive|define
name|YRANGE_WIDTH
value|16
end_define

begin_define
DECL|macro|YRANGE_HEIGHT
define|#
directive|define
name|YRANGE_HEIGHT
value|256
end_define

begin_define
DECL|macro|RADIUS
define|#
directive|define
name|RADIUS
value|3
end_define

begin_define
DECL|macro|MIN_DISTANCE
define|#
directive|define
name|MIN_DISTANCE
value|8
end_define

begin_define
DECL|macro|RANGE_MASK
define|#
directive|define
name|RANGE_MASK
value|GDK_EXPOSURE_MASK | \                     GDK_ENTER_NOTIFY_MASK
end_define

begin_define
DECL|macro|GRAPH_MASK
define|#
directive|define
name|GRAPH_MASK
value|GDK_EXPOSURE_MASK | \ 		    GDK_POINTER_MOTION_MASK | \ 		    GDK_POINTER_MOTION_HINT_MASK | \                     GDK_ENTER_NOTIFY_MASK | \ 		    GDK_BUTTON_PRESS_MASK | \ 		    GDK_BUTTON_RELEASE_MASK | \ 		    GDK_BUTTON1_MOTION_MASK
end_define

begin_comment
comment|/*  the curves structures  */
end_comment

begin_typedef
DECL|typedef|Curves
typedef|typedef
name|struct
name|_Curves
name|Curves
typedef|;
end_typedef

begin_struct
DECL|struct|_Curves
struct|struct
name|_Curves
block|{
DECL|member|x
DECL|member|y
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
comment|/*  coords for last mouse click  */
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|CRMatrix
typedef|typedef
name|double
name|CRMatrix
index|[
literal|4
index|]
index|[
literal|4
index|]
typedef|;
end_typedef

begin_comment
comment|/*  the curves tool options  */
end_comment

begin_decl_stmt
DECL|variable|curves_options
specifier|static
name|ToolOptions
modifier|*
name|curves_options
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  the curves dialog  */
end_comment

begin_decl_stmt
DECL|variable|curves_dialog
specifier|static
name|CurvesDialog
modifier|*
name|curves_dialog
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|CR_basis
specifier|static
name|CRMatrix
name|CR_basis
init|=
block|{
block|{
operator|-
literal|0.5
block|,
literal|1.5
block|,
operator|-
literal|1.5
block|,
literal|0.5
block|}
block|,
block|{
literal|1.0
block|,
operator|-
literal|2.5
block|,
literal|2.0
block|,
operator|-
literal|0.5
block|}
block|,
block|{
operator|-
literal|0.5
block|,
literal|0.0
block|,
literal|0.5
block|,
literal|0.0
block|}
block|,
block|{
literal|0.0
block|,
literal|1.0
block|,
literal|0.0
block|,
literal|0.0
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  curves action functions  */
end_comment

begin_function_decl
specifier|static
name|void
name|curves_button_press
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_button_release
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_motion
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventMotion
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_cursor_update
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventMotion
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_control
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|ToolAction
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|CurvesDialog
modifier|*
name|curves_new_dialog
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_update
parameter_list|(
name|CurvesDialog
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_plot_curve
parameter_list|(
name|CurvesDialog
modifier|*
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_preview
parameter_list|(
name|CurvesDialog
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_value_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_red_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_green_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_blue_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_alpha_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_smooth_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_free_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_reset_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|curves_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_preview_update
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|curves_xrange_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|,
name|CurvesDialog
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|curves_yrange_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|,
name|CurvesDialog
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|curves_graph_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|,
name|CurvesDialog
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|curves_CR_compose
parameter_list|(
name|CRMatrix
parameter_list|,
name|CRMatrix
parameter_list|,
name|CRMatrix
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  curves machinery  */
end_comment

begin_function
name|float
DECL|function|curves_lut_func (CurvesDialog * cd,int nchannels,int channel,float value)
name|curves_lut_func
parameter_list|(
name|CurvesDialog
modifier|*
name|cd
parameter_list|,
name|int
name|nchannels
parameter_list|,
name|int
name|channel
parameter_list|,
name|float
name|value
parameter_list|)
block|{
name|float
name|f
decl_stmt|;
name|int
name|index
decl_stmt|;
name|double
name|inten
decl_stmt|;
name|int
name|j
decl_stmt|;
if|if
condition|(
name|nchannels
operator|==
literal|1
condition|)
name|j
operator|=
literal|0
expr_stmt|;
else|else
name|j
operator|=
name|channel
operator|+
literal|1
expr_stmt|;
name|inten
operator|=
name|value
expr_stmt|;
comment|/* For color images this runs through the loop with j = channel +1      the first time and j = 0 the second time */
comment|/* For bw images this runs through the loop with j = 0 the first and      only time  */
for|for
control|(
init|;
name|j
operator|>=
literal|0
condition|;
name|j
operator|-=
operator|(
name|channel
operator|+
literal|1
operator|)
control|)
block|{
comment|/* don't apply the overall curve to the alpha channel */
if|if
condition|(
name|j
operator|==
literal|0
operator|&&
operator|(
name|nchannels
operator|==
literal|2
operator|||
name|nchannels
operator|==
literal|4
operator|)
operator|&&
name|channel
operator|==
name|nchannels
operator|-
literal|1
condition|)
return|return
name|inten
return|;
if|if
condition|(
name|inten
operator|<
literal|0.0
condition|)
name|inten
operator|=
name|cd
operator|->
name|curve
index|[
name|j
index|]
index|[
literal|0
index|]
operator|/
literal|255.0
expr_stmt|;
elseif|else
if|if
condition|(
name|inten
operator|>=
literal|1.0
condition|)
name|inten
operator|=
name|cd
operator|->
name|curve
index|[
name|j
index|]
index|[
literal|255
index|]
operator|/
literal|255.0
expr_stmt|;
else|else
comment|/* interpolate the curve */
block|{
name|index
operator|=
name|floor
argument_list|(
name|inten
operator|*
literal|255.0
argument_list|)
expr_stmt|;
name|f
operator|=
name|inten
operator|*
literal|255.0
operator|-
name|index
expr_stmt|;
name|inten
operator|=
operator|(
operator|(
literal|1.0
operator|-
name|f
operator|)
operator|*
name|cd
operator|->
name|curve
index|[
name|j
index|]
index|[
name|index
index|]
operator|+
operator|(
name|f
operator|)
operator|*
name|cd
operator|->
name|curve
index|[
name|j
index|]
index|[
name|index
operator|+
literal|1
index|]
operator|)
operator|/
literal|255.0
expr_stmt|;
block|}
block|}
return|return
name|inten
return|;
block|}
end_function

begin_comment
comment|/*  curves action functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|curves_button_press (Tool * tool,GdkEventButton * bevent,gpointer gdisp_ptr)
name|curves_button_press
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gdisp
operator|=
name|gdisp_ptr
expr_stmt|;
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|!=
name|tool
operator|->
name|drawable
condition|)
block|{
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
name|image_map_abort
argument_list|(
name|curves_dialog
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|curves_dialog
operator|->
name|drawable
operator|=
name|tool
operator|->
name|drawable
operator|=
name|drawable
expr_stmt|;
name|curves_dialog
operator|->
name|color
operator|=
name|drawable_color
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|curves_dialog
operator|->
name|image_map
operator|=
name|image_map_create
argument_list|(
name|gdisp
argument_list|,
name|drawable
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|tool
condition|)
name|tool
operator|->
name|state
operator|=
name|ACTIVE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_colour_update (Tool * tool,GDisplay * gdisp,GimpDrawable * drawable,gint x,gint y)
name|curves_colour_update
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GDisplay
modifier|*
name|gdisp
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|color
decl_stmt|;
name|int
name|offx
decl_stmt|,
name|offy
decl_stmt|;
name|int
name|has_alpha
decl_stmt|;
name|int
name|is_indexed
decl_stmt|;
name|int
name|sample_type
decl_stmt|;
name|int
name|maxval
decl_stmt|;
if|if
condition|(
operator|!
name|tool
operator|||
name|tool
operator|->
name|state
operator|!=
name|ACTIVE
condition|)
return|return;
name|drawable_offsets
argument_list|(
name|drawable
argument_list|,
operator|&
name|offx
argument_list|,
operator|&
name|offy
argument_list|)
expr_stmt|;
name|x
operator|-=
name|offx
expr_stmt|;
name|y
operator|-=
name|offy
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|color
operator|=
name|image_map_get_color_at
argument_list|(
name|curves_dialog
operator|->
name|image_map
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
operator|)
condition|)
return|return;
name|sample_type
operator|=
name|gimp_drawable_type
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|is_indexed
operator|=
name|gimp_drawable_indexed
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|has_alpha
operator|=
name|TYPE_HAS_ALPHA
argument_list|(
name|sample_type
argument_list|)
expr_stmt|;
name|curves_dialog
operator|->
name|col_value
index|[
name|HISTOGRAM_RED
index|]
operator|=
name|color
index|[
name|RED_PIX
index|]
expr_stmt|;
name|curves_dialog
operator|->
name|col_value
index|[
name|HISTOGRAM_GREEN
index|]
operator|=
name|color
index|[
name|GREEN_PIX
index|]
expr_stmt|;
name|curves_dialog
operator|->
name|col_value
index|[
name|HISTOGRAM_BLUE
index|]
operator|=
name|color
index|[
name|BLUE_PIX
index|]
expr_stmt|;
if|if
condition|(
name|has_alpha
condition|)
block|{
name|curves_dialog
operator|->
name|col_value
index|[
name|HISTOGRAM_ALPHA
index|]
operator|=
name|color
index|[
literal|3
index|]
expr_stmt|;
block|}
if|if
condition|(
name|is_indexed
condition|)
name|curves_dialog
operator|->
name|col_value
index|[
name|HISTOGRAM_ALPHA
index|]
operator|=
name|color
index|[
literal|4
index|]
expr_stmt|;
name|maxval
operator|=
name|MAXIMUM
argument_list|(
name|color
index|[
name|RED_PIX
index|]
argument_list|,
name|color
index|[
name|GREEN_PIX
index|]
argument_list|)
expr_stmt|;
name|curves_dialog
operator|->
name|col_value
index|[
name|HISTOGRAM_VALUE
index|]
operator|=
name|MAXIMUM
argument_list|(
name|maxval
argument_list|,
name|color
index|[
name|BLUE_PIX
index|]
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|color
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_add_point (GimpDrawable * drawable,gint x,gint y,gint cchan)
name|curves_add_point
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|cchan
parameter_list|)
block|{
comment|/* Add point onto the curve */
name|int
name|closest_point
init|=
literal|0
decl_stmt|;
name|int
name|distance
decl_stmt|;
name|int
name|curvex
decl_stmt|;
name|int
name|i
decl_stmt|;
name|curvex
operator|=
name|curves_dialog
operator|->
name|col_value
index|[
name|cchan
index|]
expr_stmt|;
name|distance
operator|=
name|G_MAXINT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|17
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|curves_dialog
operator|->
name|points
index|[
name|cchan
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
operator|-
literal|1
condition|)
if|if
condition|(
name|abs
argument_list|(
name|curvex
operator|-
name|curves_dialog
operator|->
name|points
index|[
name|cchan
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|)
operator|<
name|distance
condition|)
block|{
name|distance
operator|=
name|abs
argument_list|(
name|curvex
operator|-
name|curves_dialog
operator|->
name|points
index|[
name|cchan
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|closest_point
operator|=
name|i
expr_stmt|;
block|}
block|}
if|if
condition|(
name|distance
operator|>
name|MIN_DISTANCE
condition|)
name|closest_point
operator|=
operator|(
name|curvex
operator|+
literal|8
operator|)
operator|/
literal|16
expr_stmt|;
name|curves_dialog
operator|->
name|points
index|[
name|cchan
index|]
index|[
name|closest_point
index|]
index|[
literal|0
index|]
operator|=
name|curvex
expr_stmt|;
name|curves_dialog
operator|->
name|points
index|[
name|cchan
index|]
index|[
name|closest_point
index|]
index|[
literal|1
index|]
operator|=
name|curves_dialog
operator|->
name|curve
index|[
name|cchan
index|]
index|[
name|curvex
index|]
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_button_release (Tool * tool,GdkEventButton * bevent,gpointer gdisp_ptr)
name|curves_button_release
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
if|if
condition|(
operator|!
name|curves_dialog
operator|||
operator|!
name|gdisp
operator|||
operator|!
operator|(
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
operator|)
condition|)
return|return;
name|gdisplay_untransform_coords
argument_list|(
name|gdisp
argument_list|,
name|bevent
operator|->
name|x
argument_list|,
name|bevent
operator|->
name|y
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|curves_colour_update
argument_list|(
name|tool
argument_list|,
name|gdisp
argument_list|,
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
name|curves_add_point
argument_list|(
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|curves_dialog
operator|->
name|channel
argument_list|)
expr_stmt|;
name|curves_calculate_curve
argument_list|(
name|curves_dialog
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|bevent
operator|->
name|state
operator|&
name|GDK_CONTROL_MASK
condition|)
block|{
name|curves_add_point
argument_list|(
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|HISTOGRAM_VALUE
argument_list|)
expr_stmt|;
name|curves_add_point
argument_list|(
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|HISTOGRAM_RED
argument_list|)
expr_stmt|;
name|curves_add_point
argument_list|(
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|HISTOGRAM_GREEN
argument_list|)
expr_stmt|;
name|curves_add_point
argument_list|(
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|HISTOGRAM_BLUE
argument_list|)
expr_stmt|;
name|curves_add_point
argument_list|(
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|HISTOGRAM_ALPHA
argument_list|)
expr_stmt|;
name|curves_calculate_curve
argument_list|(
name|curves_dialog
argument_list|)
expr_stmt|;
block|}
name|curves_update
argument_list|(
name|curves_dialog
argument_list|,
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_motion (Tool * tool,GdkEventMotion * mevent,gpointer gdisp_ptr)
name|curves_motion
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventMotion
modifier|*
name|mevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
if|if
condition|(
operator|!
name|curves_dialog
operator|||
operator|!
name|gdisp
operator|||
operator|!
operator|(
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
operator|)
condition|)
return|return;
name|gdisplay_untransform_coords
argument_list|(
name|gdisp
argument_list|,
name|mevent
operator|->
name|x
argument_list|,
name|mevent
operator|->
name|y
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|curves_colour_update
argument_list|(
name|tool
argument_list|,
name|gdisp
argument_list|,
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|curves_dialog
argument_list|,
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_cursor_update (Tool * tool,GdkEventMotion * mevent,gpointer gdisp_ptr)
name|curves_cursor_update
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventMotion
modifier|*
name|mevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|gdisplay_install_tool_cursor
argument_list|(
name|gdisp
argument_list|,
name|GDK_TOP_LEFT_ARROW
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_control (Tool * tool,ToolAction action,gpointer gdisp_ptr)
name|curves_control
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|ToolAction
name|action
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
switch|switch
condition|(
name|action
condition|)
block|{
case|case
name|PAUSE
case|:
break|break;
case|case
name|RESUME
case|:
break|break;
case|case
name|HALT
case|:
if|if
condition|(
name|curves_dialog
condition|)
name|curves_cancel_callback
argument_list|(
name|NULL
argument_list|,
operator|(
name|gpointer
operator|)
name|curves_dialog
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
name|Tool
modifier|*
DECL|function|tools_new_curves ()
name|tools_new_curves
parameter_list|()
block|{
name|Tool
modifier|*
name|tool
decl_stmt|;
name|Curves
modifier|*
name|private
decl_stmt|;
comment|/*  The tool options  */
if|if
condition|(
operator|!
name|curves_options
condition|)
block|{
name|curves_options
operator|=
name|tool_options_new
argument_list|(
name|_
argument_list|(
literal|"Curves Options"
argument_list|)
argument_list|)
expr_stmt|;
name|tools_register
argument_list|(
name|CURVES
argument_list|,
name|curves_options
argument_list|)
expr_stmt|;
block|}
name|tool
operator|=
operator|(
name|Tool
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|Tool
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
operator|(
name|Curves
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|Curves
argument_list|)
argument_list|)
expr_stmt|;
name|tool
operator|->
name|type
operator|=
name|CURVES
expr_stmt|;
name|tool
operator|->
name|state
operator|=
name|INACTIVE
expr_stmt|;
name|tool
operator|->
name|scroll_lock
operator|=
literal|1
expr_stmt|;
comment|/*  Disallow scrolling  */
name|tool
operator|->
name|auto_snap_to
operator|=
name|TRUE
expr_stmt|;
name|tool
operator|->
name|private
operator|=
operator|(
name|void
operator|*
operator|)
name|private
expr_stmt|;
name|tool
operator|->
name|button_press_func
operator|=
name|curves_button_press
expr_stmt|;
name|tool
operator|->
name|button_release_func
operator|=
name|curves_button_release
expr_stmt|;
name|tool
operator|->
name|motion_func
operator|=
name|curves_motion
expr_stmt|;
name|tool
operator|->
name|arrow_keys_func
operator|=
name|standard_arrow_keys_func
expr_stmt|;
name|tool
operator|->
name|modifier_key_func
operator|=
name|standard_modifier_key_func
expr_stmt|;
name|tool
operator|->
name|cursor_update_func
operator|=
name|curves_cursor_update
expr_stmt|;
name|tool
operator|->
name|control_func
operator|=
name|curves_control
expr_stmt|;
name|tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
return|return
name|tool
return|;
block|}
end_function

begin_function
name|void
DECL|function|tools_free_curves (Tool * tool)
name|tools_free_curves
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|)
block|{
name|Curves
modifier|*
name|_curves
decl_stmt|;
name|_curves
operator|=
operator|(
name|Curves
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
comment|/*  Close the color select dialog  */
if|if
condition|(
name|curves_dialog
condition|)
name|curves_cancel_callback
argument_list|(
name|NULL
argument_list|,
operator|(
name|gpointer
operator|)
name|curves_dialog
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|_curves
argument_list|)
expr_stmt|;
block|}
end_function

begin_decl_stmt
DECL|variable|channel_items
specifier|static
name|MenuItem
name|channel_items
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"Value"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|curves_value_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Red"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|curves_red_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Green"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|curves_green_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Blue"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|curves_blue_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Alpha"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|curves_alpha_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|curves_initialize (GDisplay * gdisp)
name|curves_initialize
parameter_list|(
name|GDisplay
modifier|*
name|gdisp
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|drawable_indexed
argument_list|(
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Curves for indexed drawables cannot be adjusted."
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/*  The curves dialog  */
if|if
condition|(
operator|!
name|curves_dialog
condition|)
name|curves_dialog
operator|=
name|curves_new_dialog
argument_list|()
expr_stmt|;
comment|/*  Initialize the values  */
name|curves_dialog
operator|->
name|channel
operator|=
name|HISTOGRAM_VALUE
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|256
condition|;
name|j
operator|++
control|)
name|curves_dialog
operator|->
name|curve
index|[
name|i
index|]
index|[
name|j
index|]
operator|=
name|j
expr_stmt|;
name|curves_dialog
operator|->
name|grab_point
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|17
condition|;
name|j
operator|++
control|)
block|{
name|curves_dialog
operator|->
name|points
index|[
name|i
index|]
index|[
name|j
index|]
index|[
literal|0
index|]
operator|=
operator|-
literal|1
expr_stmt|;
name|curves_dialog
operator|->
name|points
index|[
name|i
index|]
index|[
name|j
index|]
index|[
literal|1
index|]
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|curves_dialog
operator|->
name|points
index|[
name|i
index|]
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|curves_dialog
operator|->
name|points
index|[
name|i
index|]
index|[
literal|0
index|]
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|curves_dialog
operator|->
name|points
index|[
name|i
index|]
index|[
literal|16
index|]
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|curves_dialog
operator|->
name|points
index|[
name|i
index|]
index|[
literal|16
index|]
index|[
literal|1
index|]
operator|=
literal|255
expr_stmt|;
block|}
name|curves_dialog
operator|->
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|curves_dialog
operator|->
name|color
operator|=
name|drawable_color
argument_list|(
operator|(
name|curves_dialog
operator|->
name|drawable
operator|)
argument_list|)
expr_stmt|;
name|curves_dialog
operator|->
name|image_map
operator|=
name|image_map_create
argument_list|(
name|gdisp
argument_list|,
name|curves_dialog
operator|->
name|drawable
argument_list|)
expr_stmt|;
comment|/* check for alpha channel */
if|if
condition|(
name|drawable_has_alpha
argument_list|(
operator|(
name|curves_dialog
operator|->
name|drawable
operator|)
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_items
index|[
literal|4
index|]
operator|.
name|widget
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_set_sensitive
argument_list|(
name|channel_items
index|[
literal|4
index|]
operator|.
name|widget
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  hide or show the channel menu based on image type  */
if|if
condition|(
name|curves_dialog
operator|->
name|color
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_items
index|[
name|i
index|]
operator|.
name|widget
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
else|else
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_items
index|[
name|i
index|]
operator|.
name|widget
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* set the current selection */
name|gtk_option_menu_set_history
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|curves_dialog
operator|->
name|channel_menu
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GTK_WIDGET_VISIBLE
argument_list|(
name|curves_dialog
operator|->
name|shell
argument_list|)
condition|)
name|gtk_widget_show
argument_list|(
name|curves_dialog
operator|->
name|shell
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|curves_dialog
argument_list|,
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|curves_free ()
name|curves_free
parameter_list|()
block|{
if|if
condition|(
name|curves_dialog
condition|)
block|{
if|if
condition|(
name|curves_dialog
operator|->
name|image_map
condition|)
block|{
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
name|image_map_abort
argument_list|(
name|curves_dialog
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|curves_dialog
operator|->
name|image_map
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|curves_dialog
operator|->
name|pixmap
condition|)
name|gdk_pixmap_unref
argument_list|(
name|curves_dialog
operator|->
name|pixmap
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|curves_dialog
operator|->
name|shell
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**************************/
end_comment

begin_comment
comment|/*  Select Curves dialog  */
end_comment

begin_comment
comment|/**************************/
end_comment

begin_function
specifier|static
name|CurvesDialog
modifier|*
DECL|function|curves_new_dialog ()
name|curves_new_dialog
parameter_list|()
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|option_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|channel_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
specifier|static
name|ActionAreaItem
name|action_items
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"Reset"
argument_list|)
block|,
name|curves_reset_callback
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"OK"
argument_list|)
block|,
name|curves_ok_callback
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Cancel"
argument_list|)
block|,
name|curves_cancel_callback
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
specifier|static
name|MenuItem
name|curve_type_items
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"Smooth"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|curves_smooth_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Free"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|curves_free_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
name|cd
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|CurvesDialog
argument_list|)
argument_list|)
expr_stmt|;
name|cd
operator|->
name|preview
operator|=
name|TRUE
expr_stmt|;
name|cd
operator|->
name|curve_type
operator|=
name|SMOOTH
expr_stmt|;
name|cd
operator|->
name|pixmap
operator|=
name|NULL
expr_stmt|;
name|cd
operator|->
name|channel
operator|=
name|HISTOGRAM_VALUE
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|256
condition|;
name|j
operator|++
control|)
name|cd
operator|->
name|curve
index|[
name|i
index|]
index|[
name|j
index|]
operator|=
name|j
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
sizeof|sizeof
argument_list|(
name|cd
operator|->
name|col_value
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|cd
operator|->
name|col_value
index|[
literal|0
index|]
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|cd
operator|->
name|col_value
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|cd
operator|->
name|lut
operator|=
name|gimp_lut_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
name|channel_items
index|[
name|i
index|]
operator|.
name|user_data
operator|=
operator|(
name|gpointer
operator|)
name|cd
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
name|curve_type_items
index|[
name|i
index|]
operator|.
name|user_data
operator|=
operator|(
name|gpointer
operator|)
name|cd
expr_stmt|;
comment|/*  The shell and main vbox  */
name|cd
operator|->
name|shell
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
argument_list|,
literal|"curves"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Curves"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|curves_delete_callback
argument_list|)
argument_list|,
name|cd
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The option menu for selecting channels  */
name|channel_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|channel_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Modify Curves for Channel: "
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|channel_hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|menu
operator|=
name|build_menu
argument_list|(
name|channel_items
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|cd
operator|->
name|channel_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|channel_hbox
argument_list|)
argument_list|,
name|cd
operator|->
name|channel_menu
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|cd
operator|->
name|channel_menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channel_hbox
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|cd
operator|->
name|channel_menu
argument_list|)
argument_list|,
name|menu
argument_list|)
expr_stmt|;
comment|/*  The table for the yrange and the graph  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The range drawing area  */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|frame
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|cd
operator|->
name|yrange
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cd
operator|->
name|yrange
argument_list|)
argument_list|,
name|YRANGE_WIDTH
argument_list|,
name|YRANGE_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|cd
operator|->
name|yrange
argument_list|,
name|RANGE_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|cd
operator|->
name|yrange
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|curves_yrange_events
argument_list|,
name|cd
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|cd
operator|->
name|yrange
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|cd
operator|->
name|yrange
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
comment|/*  The curves graph  */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|frame
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|cd
operator|->
name|graph
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|cd
operator|->
name|graph
argument_list|)
argument_list|,
name|GRAPH_WIDTH
operator|+
name|RADIUS
operator|*
literal|2
argument_list|,
name|GRAPH_HEIGHT
operator|+
name|RADIUS
operator|*
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|cd
operator|->
name|graph
argument_list|,
name|GRAPH_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|cd
operator|->
name|graph
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|curves_graph_events
argument_list|,
name|cd
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|cd
operator|->
name|graph
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|cd
operator|->
name|graph
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
comment|/*  The range drawing area  */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|frame
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|cd
operator|->
name|xrange
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cd
operator|->
name|xrange
argument_list|)
argument_list|,
name|XRANGE_WIDTH
argument_list|,
name|XRANGE_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|cd
operator|->
name|xrange
argument_list|,
name|RANGE_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|cd
operator|->
name|xrange
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|curves_xrange_events
argument_list|,
name|cd
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|cd
operator|->
name|xrange
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|cd
operator|->
name|xrange
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*  Horizontal box for preview  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The option menu for selecting the drawing method  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Curve Type: "
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|menu
operator|=
name|build_menu
argument_list|(
name|curve_type_items
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|option_menu
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|option_menu
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|option_menu
argument_list|)
argument_list|,
name|menu
argument_list|)
expr_stmt|;
comment|/*  The preview toggle  */
name|toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Preview"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|cd
operator|->
name|preview
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|curves_preview_update
argument_list|,
name|cd
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/*  The action area  */
name|action_items
index|[
literal|0
index|]
operator|.
name|user_data
operator|=
name|cd
expr_stmt|;
name|action_items
index|[
literal|1
index|]
operator|.
name|user_data
operator|=
name|cd
expr_stmt|;
name|action_items
index|[
literal|2
index|]
operator|.
name|user_data
operator|=
name|cd
expr_stmt|;
name|build_action_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
argument_list|,
name|action_items
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
return|return
name|cd
return|;
block|}
end_function

begin_comment
comment|/* TODO: preview alpha channel stuff correctly.  -- austin, 20/May/99 */
end_comment

begin_function
specifier|static
name|void
DECL|function|curves_update (CurvesDialog * cd,int update)
name|curves_update
parameter_list|(
name|CurvesDialog
modifier|*
name|cd
parameter_list|,
name|int
name|update
parameter_list|)
block|{
name|GdkRectangle
name|area
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|update
operator|&
name|XRANGE_TOP
condition|)
block|{
name|unsigned
name|char
name|buf
index|[
name|XRANGE_WIDTH
operator|*
literal|3
index|]
decl_stmt|;
switch|switch
condition|(
name|cd
operator|->
name|channel
condition|)
block|{
case|case
name|HISTOGRAM_VALUE
case|:
case|case
name|HISTOGRAM_ALPHA
case|:
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XRANGE_HEIGHT
operator|/
literal|2
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|XRANGE_WIDTH
condition|;
name|j
operator|++
control|)
block|{
name|buf
index|[
name|j
operator|*
literal|3
operator|+
literal|0
index|]
operator|=
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|j
index|]
expr_stmt|;
name|buf
index|[
name|j
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|j
index|]
expr_stmt|;
name|buf
index|[
name|j
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|j
index|]
expr_stmt|;
block|}
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cd
operator|->
name|xrange
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|i
argument_list|,
name|XRANGE_WIDTH
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|HISTOGRAM_RED
case|:
case|case
name|HISTOGRAM_GREEN
case|:
case|case
name|HISTOGRAM_BLUE
case|:
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XRANGE_HEIGHT
operator|/
literal|2
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|XRANGE_WIDTH
condition|;
name|j
operator|++
control|)
block|{
name|buf
index|[
name|j
operator|*
literal|3
operator|+
literal|0
index|]
operator|=
name|cd
operator|->
name|curve
index|[
name|HISTOGRAM_RED
index|]
index|[
name|j
index|]
expr_stmt|;
name|buf
index|[
name|j
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|cd
operator|->
name|curve
index|[
name|HISTOGRAM_GREEN
index|]
index|[
name|j
index|]
expr_stmt|;
name|buf
index|[
name|j
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|cd
operator|->
name|curve
index|[
name|HISTOGRAM_BLUE
index|]
index|[
name|j
index|]
expr_stmt|;
block|}
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cd
operator|->
name|xrange
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|i
argument_list|,
name|XRANGE_WIDTH
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
default|default:
name|g_warning
argument_list|(
literal|"unknown channel type %d, can't happen!?!?"
argument_list|,
name|cd
operator|->
name|channel
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* end switch */
if|if
condition|(
name|update
operator|&
name|DRAW
condition|)
block|{
name|area
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|area
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|area
operator|.
name|width
operator|=
name|XRANGE_WIDTH
expr_stmt|;
name|area
operator|.
name|height
operator|=
name|XRANGE_HEIGHT
operator|/
literal|2
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|cd
operator|->
name|xrange
argument_list|,
operator|&
name|area
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|update
operator|&
name|XRANGE_BOTTOM
condition|)
block|{
name|unsigned
name|char
name|buf
index|[
name|XRANGE_WIDTH
operator|*
literal|3
index|]
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|XRANGE_WIDTH
condition|;
name|i
operator|++
control|)
block|{
name|buf
index|[
name|i
operator|*
literal|3
operator|+
literal|0
index|]
operator|=
name|i
expr_stmt|;
name|buf
index|[
name|i
operator|*
literal|3
operator|+
literal|1
index|]
operator|=
name|i
expr_stmt|;
name|buf
index|[
name|i
operator|*
literal|3
operator|+
literal|2
index|]
operator|=
name|i
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
name|XRANGE_HEIGHT
operator|/
literal|2
init|;
name|i
operator|<
name|XRANGE_HEIGHT
condition|;
name|i
operator|++
control|)
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cd
operator|->
name|xrange
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|i
argument_list|,
name|XRANGE_WIDTH
argument_list|)
expr_stmt|;
if|if
condition|(
name|update
operator|&
name|DRAW
condition|)
block|{
name|area
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|area
operator|.
name|y
operator|=
name|XRANGE_HEIGHT
operator|/
literal|2
expr_stmt|;
name|area
operator|.
name|width
operator|=
name|XRANGE_WIDTH
expr_stmt|;
name|area
operator|.
name|height
operator|=
name|XRANGE_HEIGHT
operator|/
literal|2
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|cd
operator|->
name|xrange
argument_list|,
operator|&
name|area
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|update
operator|&
name|YRANGE
condition|)
block|{
name|unsigned
name|char
name|buf
index|[
name|YRANGE_WIDTH
operator|*
literal|3
index|]
decl_stmt|;
name|unsigned
name|char
name|pix
index|[
literal|3
index|]
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|YRANGE_HEIGHT
condition|;
name|i
operator|++
control|)
block|{
switch|switch
condition|(
name|cd
operator|->
name|channel
condition|)
block|{
case|case
name|HISTOGRAM_VALUE
case|:
case|case
name|HISTOGRAM_ALPHA
case|:
name|pix
index|[
literal|0
index|]
operator|=
name|pix
index|[
literal|1
index|]
operator|=
name|pix
index|[
literal|2
index|]
operator|=
operator|(
literal|255
operator|-
name|i
operator|)
expr_stmt|;
break|break;
case|case
name|HISTOGRAM_RED
case|:
case|case
name|HISTOGRAM_GREEN
case|:
case|case
name|HISTOGRAM_BLUE
case|:
name|pix
index|[
literal|0
index|]
operator|=
name|pix
index|[
literal|1
index|]
operator|=
name|pix
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|pix
index|[
name|cd
operator|->
name|channel
operator|-
literal|1
index|]
operator|=
operator|(
literal|255
operator|-
name|i
operator|)
expr_stmt|;
break|break;
default|default:
name|g_warning
argument_list|(
literal|"unknown channel type %d, can't happen!?!?"
argument_list|,
name|cd
operator|->
name|channel
argument_list|)
expr_stmt|;
break|break;
block|}
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|YRANGE_WIDTH
operator|*
literal|3
condition|;
name|j
operator|++
control|)
name|buf
index|[
name|j
index|]
operator|=
name|pix
index|[
name|j
operator|%
literal|3
index|]
expr_stmt|;
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|cd
operator|->
name|yrange
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|i
argument_list|,
name|YRANGE_WIDTH
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|update
operator|&
name|DRAW
condition|)
name|gtk_widget_draw
argument_list|(
name|cd
operator|->
name|yrange
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|update
operator|&
name|GRAPH
operator|)
operator|&&
operator|(
name|update
operator|&
name|DRAW
operator|)
operator|&&
name|cd
operator|->
name|pixmap
operator|!=
name|NULL
condition|)
block|{
name|GdkPoint
name|points
index|[
literal|256
index|]
decl_stmt|;
comment|/*  Clear the pixmap  */
name|gdk_draw_rectangle
argument_list|(
name|cd
operator|->
name|pixmap
argument_list|,
name|cd
operator|->
name|graph
operator|->
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GRAPH_WIDTH
operator|+
name|RADIUS
operator|*
literal|2
argument_list|,
name|GRAPH_HEIGHT
operator|+
name|RADIUS
operator|*
literal|2
argument_list|)
expr_stmt|;
comment|/*  Draw the grid lines  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|gdk_draw_line
argument_list|(
name|cd
operator|->
name|pixmap
argument_list|,
name|cd
operator|->
name|graph
operator|->
name|style
operator|->
name|dark_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|RADIUS
argument_list|,
name|i
operator|*
operator|(
name|GRAPH_HEIGHT
operator|/
literal|4
operator|)
operator|+
name|RADIUS
argument_list|,
name|GRAPH_WIDTH
operator|+
name|RADIUS
argument_list|,
name|i
operator|*
operator|(
name|GRAPH_HEIGHT
operator|/
literal|4
operator|)
operator|+
name|RADIUS
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|cd
operator|->
name|pixmap
argument_list|,
name|cd
operator|->
name|graph
operator|->
name|style
operator|->
name|dark_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|i
operator|*
operator|(
name|GRAPH_WIDTH
operator|/
literal|4
operator|)
operator|+
name|RADIUS
argument_list|,
name|RADIUS
argument_list|,
name|i
operator|*
operator|(
name|GRAPH_WIDTH
operator|/
literal|4
operator|)
operator|+
name|RADIUS
argument_list|,
name|GRAPH_HEIGHT
operator|+
name|RADIUS
argument_list|)
expr_stmt|;
block|}
comment|/*  Draw the curve  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
block|{
name|points
index|[
name|i
index|]
operator|.
name|x
operator|=
name|i
operator|+
name|RADIUS
expr_stmt|;
name|points
index|[
name|i
index|]
operator|.
name|y
operator|=
literal|255
operator|-
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
operator|+
name|RADIUS
expr_stmt|;
block|}
name|gdk_draw_points
argument_list|(
name|cd
operator|->
name|pixmap
argument_list|,
name|cd
operator|->
name|graph
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|points
argument_list|,
literal|256
argument_list|)
expr_stmt|;
comment|/*  Draw the points  */
if|if
condition|(
name|cd
operator|->
name|curve_type
operator|==
name|SMOOTH
condition|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|17
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
operator|-
literal|1
condition|)
name|gdk_draw_arc
argument_list|(
name|cd
operator|->
name|pixmap
argument_list|,
name|cd
operator|->
name|graph
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|TRUE
argument_list|,
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|,
literal|255
operator|-
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|1
index|]
argument_list|,
name|RADIUS
operator|*
literal|2
argument_list|,
name|RADIUS
operator|*
literal|2
argument_list|,
literal|0
argument_list|,
literal|23040
argument_list|)
expr_stmt|;
block|}
comment|/* draw the colour line */
name|gdk_draw_line
argument_list|(
name|cd
operator|->
name|pixmap
argument_list|,
name|cd
operator|->
name|graph
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|cd
operator|->
name|col_value
index|[
name|cd
operator|->
name|channel
index|]
operator|+
name|RADIUS
argument_list|,
name|RADIUS
argument_list|,
name|cd
operator|->
name|col_value
index|[
name|cd
operator|->
name|channel
index|]
operator|+
name|RADIUS
argument_list|,
name|GRAPH_HEIGHT
operator|+
name|RADIUS
argument_list|)
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|cd
operator|->
name|graph
operator|->
name|window
argument_list|,
name|cd
operator|->
name|graph
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|cd
operator|->
name|pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GRAPH_WIDTH
operator|+
name|RADIUS
operator|*
literal|2
argument_list|,
name|GRAPH_HEIGHT
operator|+
name|RADIUS
operator|*
literal|2
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_plot_curve (CurvesDialog * cd,int p1,int p2,int p3,int p4)
name|curves_plot_curve
parameter_list|(
name|CurvesDialog
modifier|*
name|cd
parameter_list|,
name|int
name|p1
parameter_list|,
name|int
name|p2
parameter_list|,
name|int
name|p3
parameter_list|,
name|int
name|p4
parameter_list|)
block|{
name|CRMatrix
name|geometry
decl_stmt|;
name|CRMatrix
name|tmp1
decl_stmt|,
name|tmp2
decl_stmt|;
name|CRMatrix
name|deltas
decl_stmt|;
name|double
name|x
decl_stmt|,
name|dx
decl_stmt|,
name|dx2
decl_stmt|,
name|dx3
decl_stmt|;
name|double
name|y
decl_stmt|,
name|dy
decl_stmt|,
name|dy2
decl_stmt|,
name|dy3
decl_stmt|;
name|double
name|d
decl_stmt|,
name|d2
decl_stmt|,
name|d3
decl_stmt|;
name|int
name|lastx
decl_stmt|,
name|lasty
decl_stmt|;
name|gint32
name|newx
decl_stmt|,
name|newy
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* construct the geometry matrix from the segment */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|geometry
index|[
name|i
index|]
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|geometry
index|[
name|i
index|]
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|geometry
index|[
literal|0
index|]
index|[
name|i
index|]
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|p1
index|]
index|[
name|i
index|]
expr_stmt|;
name|geometry
index|[
literal|1
index|]
index|[
name|i
index|]
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|p2
index|]
index|[
name|i
index|]
expr_stmt|;
name|geometry
index|[
literal|2
index|]
index|[
name|i
index|]
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|p3
index|]
index|[
name|i
index|]
expr_stmt|;
name|geometry
index|[
literal|3
index|]
index|[
name|i
index|]
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|p4
index|]
index|[
name|i
index|]
expr_stmt|;
block|}
comment|/* subdivide the curve 1000 times */
comment|/* n can be adjusted to give a finer or coarser curve */
name|d
operator|=
literal|1.0
operator|/
literal|1000
expr_stmt|;
name|d2
operator|=
name|d
operator|*
name|d
expr_stmt|;
name|d3
operator|=
name|d
operator|*
name|d
operator|*
name|d
expr_stmt|;
comment|/* construct a temporary matrix for determining the forward differencing deltas */
name|tmp2
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|0
index|]
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|0
index|]
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|0
index|]
index|[
literal|3
index|]
operator|=
literal|1
expr_stmt|;
name|tmp2
index|[
literal|1
index|]
index|[
literal|0
index|]
operator|=
name|d3
expr_stmt|;
name|tmp2
index|[
literal|1
index|]
index|[
literal|1
index|]
operator|=
name|d2
expr_stmt|;
name|tmp2
index|[
literal|1
index|]
index|[
literal|2
index|]
operator|=
name|d
expr_stmt|;
name|tmp2
index|[
literal|1
index|]
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|2
index|]
index|[
literal|0
index|]
operator|=
literal|6
operator|*
name|d3
expr_stmt|;
name|tmp2
index|[
literal|2
index|]
index|[
literal|1
index|]
operator|=
literal|2
operator|*
name|d2
expr_stmt|;
name|tmp2
index|[
literal|2
index|]
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|2
index|]
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|3
index|]
index|[
literal|0
index|]
operator|=
literal|6
operator|*
name|d3
expr_stmt|;
name|tmp2
index|[
literal|3
index|]
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|3
index|]
index|[
literal|2
index|]
operator|=
literal|0
expr_stmt|;
name|tmp2
index|[
literal|3
index|]
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
comment|/* compose the basis and geometry matrices */
name|curves_CR_compose
argument_list|(
name|CR_basis
argument_list|,
name|geometry
argument_list|,
name|tmp1
argument_list|)
expr_stmt|;
comment|/* compose the above results to get the deltas matrix */
name|curves_CR_compose
argument_list|(
name|tmp2
argument_list|,
name|tmp1
argument_list|,
name|deltas
argument_list|)
expr_stmt|;
comment|/* extract the x deltas */
name|x
operator|=
name|deltas
index|[
literal|0
index|]
index|[
literal|0
index|]
expr_stmt|;
name|dx
operator|=
name|deltas
index|[
literal|1
index|]
index|[
literal|0
index|]
expr_stmt|;
name|dx2
operator|=
name|deltas
index|[
literal|2
index|]
index|[
literal|0
index|]
expr_stmt|;
name|dx3
operator|=
name|deltas
index|[
literal|3
index|]
index|[
literal|0
index|]
expr_stmt|;
comment|/* extract the y deltas */
name|y
operator|=
name|deltas
index|[
literal|0
index|]
index|[
literal|1
index|]
expr_stmt|;
name|dy
operator|=
name|deltas
index|[
literal|1
index|]
index|[
literal|1
index|]
expr_stmt|;
name|dy2
operator|=
name|deltas
index|[
literal|2
index|]
index|[
literal|1
index|]
expr_stmt|;
name|dy3
operator|=
name|deltas
index|[
literal|3
index|]
index|[
literal|1
index|]
expr_stmt|;
name|lastx
operator|=
name|BOUNDS
argument_list|(
name|x
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|lasty
operator|=
name|BOUNDS
argument_list|(
name|y
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|lastx
index|]
operator|=
name|lasty
expr_stmt|;
comment|/* loop over the curve */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|1000
condition|;
name|i
operator|++
control|)
block|{
comment|/* increment the x values */
name|x
operator|+=
name|dx
expr_stmt|;
name|dx
operator|+=
name|dx2
expr_stmt|;
name|dx2
operator|+=
name|dx3
expr_stmt|;
comment|/* increment the y values */
name|y
operator|+=
name|dy
expr_stmt|;
name|dy
operator|+=
name|dy2
expr_stmt|;
name|dy2
operator|+=
name|dy3
expr_stmt|;
name|newx
operator|=
name|CLAMP0255
argument_list|(
name|ROUND
argument_list|(
name|x
argument_list|)
argument_list|)
expr_stmt|;
name|newy
operator|=
name|CLAMP0255
argument_list|(
name|ROUND
argument_list|(
name|y
argument_list|)
argument_list|)
expr_stmt|;
comment|/* if this point is different than the last one...then draw it */
if|if
condition|(
operator|(
name|lastx
operator|!=
name|newx
operator|)
operator|||
operator|(
name|lasty
operator|!=
name|newy
operator|)
condition|)
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|newx
index|]
operator|=
name|newy
expr_stmt|;
name|lastx
operator|=
name|newx
expr_stmt|;
name|lasty
operator|=
name|newy
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|curves_calculate_curve (CurvesDialog * cd)
name|curves_calculate_curve
parameter_list|(
name|CurvesDialog
modifier|*
name|cd
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|points
index|[
literal|17
index|]
decl_stmt|;
name|int
name|num_pts
decl_stmt|;
name|int
name|p1
decl_stmt|,
name|p2
decl_stmt|,
name|p3
decl_stmt|,
name|p4
decl_stmt|;
switch|switch
condition|(
name|cd
operator|->
name|curve_type
condition|)
block|{
case|case
name|GFREE
case|:
break|break;
case|case
name|SMOOTH
case|:
comment|/*  cycle through the curves  */
name|num_pts
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|17
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
operator|-
literal|1
condition|)
name|points
index|[
name|num_pts
operator|++
index|]
operator|=
name|i
expr_stmt|;
comment|/*  Initialize boundary curve points */
if|if
condition|(
name|num_pts
operator|!=
literal|0
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|points
index|[
literal|0
index|]
index|]
index|[
literal|0
index|]
condition|;
name|i
operator|++
control|)
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|points
index|[
literal|0
index|]
index|]
index|[
literal|1
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|points
index|[
name|num_pts
operator|-
literal|1
index|]
index|]
index|[
literal|0
index|]
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|points
index|[
name|num_pts
operator|-
literal|1
index|]
index|]
index|[
literal|1
index|]
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_pts
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|p1
operator|=
operator|(
name|i
operator|==
literal|0
operator|)
condition|?
name|points
index|[
name|i
index|]
else|:
name|points
index|[
operator|(
name|i
operator|-
literal|1
operator|)
index|]
expr_stmt|;
name|p2
operator|=
name|points
index|[
name|i
index|]
expr_stmt|;
name|p3
operator|=
name|points
index|[
operator|(
name|i
operator|+
literal|1
operator|)
index|]
expr_stmt|;
name|p4
operator|=
operator|(
name|i
operator|==
operator|(
name|num_pts
operator|-
literal|2
operator|)
operator|)
condition|?
name|points
index|[
operator|(
name|num_pts
operator|-
literal|1
operator|)
index|]
else|:
name|points
index|[
operator|(
name|i
operator|+
literal|2
operator|)
index|]
expr_stmt|;
name|curves_plot_curve
argument_list|(
name|cd
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|,
name|p4
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
name|gimp_lut_setup
argument_list|(
name|cd
operator|->
name|lut
argument_list|,
operator|(
name|GimpLutFunc
operator|)
name|curves_lut_func
argument_list|,
operator|(
name|void
operator|*
operator|)
name|cd
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|cd
operator|->
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_preview (CurvesDialog * cd)
name|curves_preview
parameter_list|(
name|CurvesDialog
modifier|*
name|cd
parameter_list|)
block|{
if|if
condition|(
operator|!
name|cd
operator|->
name|image_map
condition|)
name|g_message
argument_list|(
literal|"curves_preview(): No image map"
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
comment|/* Going to dirty the display... */
name|image_map_apply
argument_list|(
name|cd
operator|->
name|image_map
argument_list|,
operator|(
name|ImageMapApplyFunc
operator|)
name|gimp_lut_process_2
argument_list|,
operator|(
name|void
operator|*
operator|)
name|cd
operator|->
name|lut
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
comment|/* All done */
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_value_callback (GtkWidget * w,gpointer client_data)
name|curves_value_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|channel
operator|!=
name|HISTOGRAM_VALUE
condition|)
block|{
name|cd
operator|->
name|channel
operator|=
name|HISTOGRAM_VALUE
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|XRANGE_TOP
operator||
name|YRANGE
operator||
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_red_callback (GtkWidget * w,gpointer client_data)
name|curves_red_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|channel
operator|!=
name|HISTOGRAM_RED
condition|)
block|{
name|cd
operator|->
name|channel
operator|=
name|HISTOGRAM_RED
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|XRANGE_TOP
operator||
name|YRANGE
operator||
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_green_callback (GtkWidget * w,gpointer client_data)
name|curves_green_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|channel
operator|!=
name|HISTOGRAM_GREEN
condition|)
block|{
name|cd
operator|->
name|channel
operator|=
name|HISTOGRAM_GREEN
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|XRANGE_TOP
operator||
name|YRANGE
operator||
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_blue_callback (GtkWidget * w,gpointer client_data)
name|curves_blue_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|channel
operator|!=
name|HISTOGRAM_BLUE
condition|)
block|{
name|cd
operator|->
name|channel
operator|=
name|HISTOGRAM_BLUE
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|XRANGE_TOP
operator||
name|YRANGE
operator||
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_alpha_callback (GtkWidget * w,gpointer client_data)
name|curves_alpha_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|channel
operator|!=
name|HISTOGRAM_ALPHA
condition|)
block|{
name|cd
operator|->
name|channel
operator|=
name|HISTOGRAM_ALPHA
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|XRANGE_TOP
operator||
name|YRANGE
operator||
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_smooth_callback (GtkWidget * w,gpointer client_data)
name|curves_smooth_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|int
name|i
decl_stmt|;
name|gint32
name|index
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|curve_type
operator|!=
name|SMOOTH
condition|)
block|{
name|cd
operator|->
name|curve_type
operator|=
name|SMOOTH
expr_stmt|;
comment|/*  pick representative points from the curve and make them control points  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<=
literal|8
condition|;
name|i
operator|++
control|)
block|{
name|index
operator|=
name|CLAMP0255
argument_list|(
name|i
operator|*
literal|32
argument_list|)
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
operator|*
literal|2
index|]
index|[
literal|0
index|]
operator|=
name|index
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
operator|*
literal|2
index|]
index|[
literal|1
index|]
operator|=
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|index
index|]
expr_stmt|;
block|}
name|curves_calculate_curve
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|preview
condition|)
name|curves_preview
argument_list|(
name|cd
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_free_callback (GtkWidget * w,gpointer client_data)
name|curves_free_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|curve_type
operator|!=
name|GFREE
condition|)
block|{
name|cd
operator|->
name|curve_type
operator|=
name|GFREE
expr_stmt|;
name|curves_calculate_curve
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|preview
condition|)
name|curves_preview
argument_list|(
name|cd
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_reset_callback (GtkWidget * widget,gpointer client_data)
name|curves_reset_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|int
name|i
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
comment|/*  Initialize the values  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
operator|=
name|i
expr_stmt|;
name|cd
operator|->
name|grab_point
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|17
condition|;
name|i
operator|++
control|)
block|{
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
operator|=
operator|-
literal|1
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|1
index|]
operator|=
operator|-
literal|1
expr_stmt|;
block|}
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
literal|0
index|]
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
literal|16
index|]
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
literal|16
index|]
index|[
literal|1
index|]
operator|=
literal|255
expr_stmt|;
name|curves_calculate_curve
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|GRAPH
operator||
name|XRANGE_TOP
operator||
name|DRAW
argument_list|)
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|preview
condition|)
name|curves_preview
argument_list|(
name|cd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_ok_callback (GtkWidget * widget,gpointer client_data)
name|curves_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
comment|/* We're about to dirty... */
if|if
condition|(
operator|!
name|cd
operator|->
name|preview
condition|)
name|image_map_apply
argument_list|(
name|cd
operator|->
name|image_map
argument_list|,
operator|(
name|ImageMapApplyFunc
operator|)
name|gimp_lut_process_2
argument_list|,
operator|(
name|void
operator|*
operator|)
name|cd
operator|->
name|lut
argument_list|)
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|image_map
condition|)
name|image_map_commit
argument_list|(
name|cd
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|cd
operator|->
name|image_map
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_cancel_callback (GtkWidget * widget,gpointer client_data)
name|curves_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|cd
operator|->
name|shell
argument_list|)
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|image_map
condition|)
block|{
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
name|image_map_abort
argument_list|(
name|cd
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|cd
operator|->
name|image_map
operator|=
name|NULL
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|curves_delete_callback (GtkWidget * w,GdkEvent * e,gpointer data)
name|curves_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|GdkEvent
modifier|*
name|e
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|curves_cancel_callback
argument_list|(
name|w
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_preview_update (GtkWidget * w,gpointer data)
name|curves_preview_update
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|CurvesDialog
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|CurvesDialog
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|w
argument_list|)
operator|->
name|active
condition|)
block|{
name|cd
operator|->
name|preview
operator|=
name|TRUE
expr_stmt|;
name|curves_preview
argument_list|(
name|cd
argument_list|)
expr_stmt|;
block|}
else|else
name|cd
operator|->
name|preview
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|curves_graph_events (GtkWidget * widget,GdkEvent * event,CurvesDialog * cd)
name|curves_graph_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|CurvesDialog
modifier|*
name|cd
parameter_list|)
block|{
specifier|static
name|GdkCursorType
name|cursor_type
init|=
name|GDK_TOP_LEFT_ARROW
decl_stmt|;
name|GdkCursorType
name|new_type
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|GdkEventMotion
modifier|*
name|mevent
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|tx
decl_stmt|,
name|ty
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|closest_point
decl_stmt|;
name|int
name|distance
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|x2
decl_stmt|,
name|y1
decl_stmt|,
name|y2
decl_stmt|;
name|new_type
operator|=
name|GDK_X_CURSOR
expr_stmt|;
name|closest_point
operator|=
literal|0
expr_stmt|;
comment|/*  get the pointer position  */
name|gdk_window_get_pointer
argument_list|(
name|cd
operator|->
name|graph
operator|->
name|window
argument_list|,
operator|&
name|tx
argument_list|,
operator|&
name|ty
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|x
operator|=
name|BOUNDS
argument_list|(
operator|(
name|tx
operator|-
name|RADIUS
operator|)
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|y
operator|=
name|BOUNDS
argument_list|(
operator|(
name|ty
operator|-
name|RADIUS
operator|)
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|distance
operator|=
name|G_MAXINT
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|17
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
operator|-
literal|1
condition|)
if|if
condition|(
name|abs
argument_list|(
name|x
operator|-
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|)
operator|<
name|distance
condition|)
block|{
name|distance
operator|=
name|abs
argument_list|(
name|x
operator|-
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|closest_point
operator|=
name|i
expr_stmt|;
block|}
block|}
if|if
condition|(
name|distance
operator|>
name|MIN_DISTANCE
condition|)
name|closest_point
operator|=
operator|(
name|x
operator|+
literal|8
operator|)
operator|/
literal|16
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
if|if
condition|(
name|cd
operator|->
name|pixmap
operator|==
name|NULL
condition|)
name|cd
operator|->
name|pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|cd
operator|->
name|graph
operator|->
name|window
argument_list|,
name|GRAPH_WIDTH
operator|+
name|RADIUS
operator|*
literal|2
argument_list|,
name|GRAPH_HEIGHT
operator|+
name|RADIUS
operator|*
literal|2
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|GRAPH
operator||
name|DRAW
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
name|new_type
operator|=
name|GDK_TCROSS
expr_stmt|;
switch|switch
condition|(
name|cd
operator|->
name|curve_type
condition|)
block|{
case|case
name|SMOOTH
case|:
comment|/*  determine the leftmost and rightmost points  */
name|cd
operator|->
name|leftmost
operator|=
operator|-
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
name|closest_point
operator|-
literal|1
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
if|if
condition|(
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
operator|-
literal|1
condition|)
block|{
name|cd
operator|->
name|leftmost
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
expr_stmt|;
break|break;
block|}
name|cd
operator|->
name|rightmost
operator|=
literal|256
expr_stmt|;
for|for
control|(
name|i
operator|=
name|closest_point
operator|+
literal|1
init|;
name|i
operator|<
literal|17
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
operator|!=
operator|-
literal|1
condition|)
block|{
name|cd
operator|->
name|rightmost
operator|=
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
index|[
literal|0
index|]
expr_stmt|;
break|break;
block|}
name|cd
operator|->
name|grab_point
operator|=
name|closest_point
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|cd
operator|->
name|grab_point
index|]
index|[
literal|0
index|]
operator|=
name|x
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|cd
operator|->
name|grab_point
index|]
index|[
literal|1
index|]
operator|=
literal|255
operator|-
name|y
expr_stmt|;
break|break;
case|case
name|GFREE
case|:
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|x
index|]
operator|=
literal|255
operator|-
name|y
expr_stmt|;
name|cd
operator|->
name|grab_point
operator|=
name|x
expr_stmt|;
name|cd
operator|->
name|last
operator|=
name|y
expr_stmt|;
break|break;
block|}
name|curves_calculate_curve
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|GRAPH
operator||
name|XRANGE_TOP
operator||
name|DRAW
argument_list|)
expr_stmt|;
name|gtk_grab_add
argument_list|(
name|widget
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
name|new_type
operator|=
name|GDK_FLEUR
expr_stmt|;
name|cd
operator|->
name|grab_point
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|preview
condition|)
name|curves_preview
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|gtk_grab_remove
argument_list|(
name|widget
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_MOTION_NOTIFY
case|:
name|mevent
operator|=
operator|(
name|GdkEventMotion
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|mevent
operator|->
name|is_hint
condition|)
block|{
name|mevent
operator|->
name|x
operator|=
name|tx
expr_stmt|;
name|mevent
operator|->
name|y
operator|=
name|ty
expr_stmt|;
block|}
switch|switch
condition|(
name|cd
operator|->
name|curve_type
condition|)
block|{
case|case
name|SMOOTH
case|:
comment|/*  If no point is grabbed...  */
if|if
condition|(
name|cd
operator|->
name|grab_point
operator|==
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|closest_point
index|]
index|[
literal|0
index|]
operator|!=
operator|-
literal|1
condition|)
name|new_type
operator|=
name|GDK_FLEUR
expr_stmt|;
else|else
name|new_type
operator|=
name|GDK_TCROSS
expr_stmt|;
block|}
comment|/*  Else, drag the grabbed point  */
else|else
block|{
name|new_type
operator|=
name|GDK_TCROSS
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|cd
operator|->
name|grab_point
index|]
index|[
literal|0
index|]
operator|=
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|x
operator|>
name|cd
operator|->
name|leftmost
operator|&&
name|x
operator|<
name|cd
operator|->
name|rightmost
condition|)
block|{
name|closest_point
operator|=
operator|(
name|x
operator|+
literal|8
operator|)
operator|/
literal|16
expr_stmt|;
if|if
condition|(
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|closest_point
index|]
index|[
literal|0
index|]
operator|==
operator|-
literal|1
condition|)
name|cd
operator|->
name|grab_point
operator|=
name|closest_point
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|cd
operator|->
name|grab_point
index|]
index|[
literal|0
index|]
operator|=
name|x
expr_stmt|;
name|cd
operator|->
name|points
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|cd
operator|->
name|grab_point
index|]
index|[
literal|1
index|]
operator|=
literal|255
operator|-
name|y
expr_stmt|;
block|}
name|curves_calculate_curve
argument_list|(
name|cd
argument_list|)
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|GRAPH
operator||
name|XRANGE_TOP
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|GFREE
case|:
if|if
condition|(
name|cd
operator|->
name|grab_point
operator|!=
operator|-
literal|1
condition|)
block|{
if|if
condition|(
name|cd
operator|->
name|grab_point
operator|>
name|x
condition|)
block|{
name|x1
operator|=
name|x
expr_stmt|;
name|x2
operator|=
name|cd
operator|->
name|grab_point
expr_stmt|;
name|y1
operator|=
name|y
expr_stmt|;
name|y2
operator|=
name|cd
operator|->
name|last
expr_stmt|;
block|}
else|else
block|{
name|x1
operator|=
name|cd
operator|->
name|grab_point
expr_stmt|;
name|x2
operator|=
name|x
expr_stmt|;
name|y1
operator|=
name|cd
operator|->
name|last
expr_stmt|;
name|y2
operator|=
name|y
expr_stmt|;
block|}
if|if
condition|(
name|x2
operator|!=
name|x1
condition|)
for|for
control|(
name|i
operator|=
name|x1
init|;
name|i
operator|<=
name|x2
condition|;
name|i
operator|++
control|)
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|i
index|]
operator|=
literal|255
operator|-
operator|(
name|y1
operator|+
operator|(
operator|(
name|y2
operator|-
name|y1
operator|)
operator|*
operator|(
name|i
operator|-
name|x1
operator|)
operator|)
operator|/
operator|(
name|x2
operator|-
name|x1
operator|)
operator|)
expr_stmt|;
else|else
name|cd
operator|->
name|curve
index|[
name|cd
operator|->
name|channel
index|]
index|[
name|x
index|]
operator|=
literal|255
operator|-
name|y
expr_stmt|;
name|cd
operator|->
name|grab_point
operator|=
name|x
expr_stmt|;
name|cd
operator|->
name|last
operator|=
name|y
expr_stmt|;
name|curves_update
argument_list|(
name|cd
argument_list|,
name|GRAPH
operator||
name|XRANGE_TOP
operator||
name|DRAW
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|mevent
operator|->
name|state
operator|&
name|GDK_BUTTON1_MASK
condition|)
name|new_type
operator|=
name|GDK_TCROSS
expr_stmt|;
else|else
name|new_type
operator|=
name|GDK_PENCIL
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|new_type
operator|!=
name|cursor_type
condition|)
block|{
name|cursor_type
operator|=
name|new_type
expr_stmt|;
name|change_win_cursor
argument_list|(
name|cd
operator|->
name|graph
operator|->
name|window
argument_list|,
name|cursor_type
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|curves_xrange_events (GtkWidget * widget,GdkEvent * event,CurvesDialog * cd)
name|curves_xrange_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|CurvesDialog
modifier|*
name|cd
parameter_list|)
block|{
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|curves_update
argument_list|(
name|cd
argument_list|,
name|XRANGE_TOP
operator||
name|XRANGE_BOTTOM
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_DELETE
case|:
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|curves_yrange_events (GtkWidget * widget,GdkEvent * event,CurvesDialog * cd)
name|curves_yrange_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|CurvesDialog
modifier|*
name|cd
parameter_list|)
block|{
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|curves_update
argument_list|(
name|cd
argument_list|,
name|YRANGE
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|curves_CR_compose (CRMatrix a,CRMatrix b,CRMatrix ab)
name|curves_CR_compose
parameter_list|(
name|CRMatrix
name|a
parameter_list|,
name|CRMatrix
name|b
parameter_list|,
name|CRMatrix
name|ab
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
name|j
operator|++
control|)
block|{
name|ab
index|[
name|i
index|]
index|[
name|j
index|]
operator|=
operator|(
name|a
index|[
name|i
index|]
index|[
literal|0
index|]
operator|*
name|b
index|[
literal|0
index|]
index|[
name|j
index|]
operator|+
name|a
index|[
name|i
index|]
index|[
literal|1
index|]
operator|*
name|b
index|[
literal|1
index|]
index|[
name|j
index|]
operator|+
name|a
index|[
name|i
index|]
index|[
literal|2
index|]
operator|*
name|b
index|[
literal|2
index|]
index|[
name|j
index|]
operator|+
name|a
index|[
name|i
index|]
index|[
literal|3
index|]
operator|*
name|b
index|[
literal|3
index|]
index|[
name|j
index|]
operator|)
expr_stmt|;
block|}
block|}
block|}
end_function

end_unit

