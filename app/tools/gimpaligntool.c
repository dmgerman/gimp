begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"tools-types.h"
end_include

begin_include
include|#
directive|include
file|"config/gimpdisplayconfig.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpguide.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-arrange.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-guides.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-undo.h"
end_include

begin_include
include|#
directive|include
file|"core/gimplayer.h"
end_include

begin_include
include|#
directive|include
file|"vectors/gimpvectors.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimphelp-ids.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpwidgets-utils.h"
end_include

begin_include
include|#
directive|include
file|"display/gimpdisplay.h"
end_include

begin_include
include|#
directive|include
file|"display/gimpdisplayshell.h"
end_include

begin_include
include|#
directive|include
file|"display/gimpdisplayshell-appearance.h"
end_include

begin_include
include|#
directive|include
file|"gimpalignoptions.h"
end_include

begin_include
include|#
directive|include
file|"gimpaligntool.h"
end_include

begin_include
include|#
directive|include
file|"gimptoolcontrol.h"
end_include

begin_include
include|#
directive|include
file|"gimp-intl.h"
end_include

begin_define
DECL|macro|EPSILON
define|#
directive|define
name|EPSILON
value|3
end_define

begin_comment
DECL|macro|EPSILON
comment|/* move distance after which we do a box-select */
end_comment

begin_define
DECL|macro|MARKER_WIDTH
define|#
directive|define
name|MARKER_WIDTH
value|5
end_define

begin_comment
DECL|macro|MARKER_WIDTH
comment|/* size (in pixels) of the square handles */
end_comment

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|GObject
modifier|*
name|gimp_align_tool_constructor
parameter_list|(
name|GType
name|type
parameter_list|,
name|guint
name|n_params
parameter_list|,
name|GObjectConstructParam
modifier|*
name|params
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_align_tool_initialize
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_control
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpToolAction
name|action
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_button_press
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|guint32
name|time
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpButtonPressType
name|press_type
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_button_release
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|guint32
name|time
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpButtonReleaseType
name|release_type
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_motion
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|guint32
name|time
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_oper_update
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|gboolean
name|proximity
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_status_update
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|gboolean
name|proximity
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_cursor_update
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_align_tool_draw
parameter_list|(
name|GimpDrawTool
modifier|*
name|draw_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|button_with_stock
parameter_list|(
name|GimpAlignmentType
name|action
parameter_list|,
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|gimp_align_tool_controls
parameter_list|(
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|do_alignment
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|clear_selected_object
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|clear_all_selected_objects
parameter_list|(
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpLayer
modifier|*
name|select_layer_by_coords
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|void
name|gimp_image_arrange_objects
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GList
modifier|*
name|list
parameter_list|,
name|GimpAlignmentType
name|alignment
parameter_list|,
name|GObject
modifier|*
name|reference
parameter_list|,
name|GimpAlignmentType
name|reference_alignment
parameter_list|,
name|gint
name|offset
parameter_list|)
function_decl|;
end_function_decl

begin_macro
DECL|function|G_DEFINE_TYPE (GimpAlignTool,gimp_align_tool,GIMP_TYPE_DRAW_TOOL)
name|G_DEFINE_TYPE
argument_list|(
argument|GimpAlignTool
argument_list|,
argument|gimp_align_tool
argument_list|,
argument|GIMP_TYPE_DRAW_TOOL
argument_list|)
end_macro

begin_define
DECL|macro|parent_class
define|#
directive|define
name|parent_class
value|gimp_align_tool_parent_class
end_define

begin_function
name|void
name|gimp_align_tool_register
parameter_list|(
name|GimpToolRegisterCallback
name|callback
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
call|(
modifier|*
name|callback
call|)
argument_list|(
name|GIMP_TYPE_ALIGN_TOOL
argument_list|,
name|GIMP_TYPE_ALIGN_OPTIONS
argument_list|,
name|gimp_align_options_gui
argument_list|,
literal|0
argument_list|,
literal|"gimp-align-tool"
argument_list|,
name|_
argument_list|(
literal|"Align"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Alignment Tool: Align or arrange layers and other objects"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"_Align"
argument_list|)
argument_list|,
literal|"Q"
argument_list|,
name|NULL
argument_list|,
name|GIMP_HELP_TOOL_ALIGN
argument_list|,
name|GIMP_STOCK_TOOL_ALIGN
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_class_init (GimpAlignToolClass * klass)
name|gimp_align_tool_class_init
parameter_list|(
name|GimpAlignToolClass
modifier|*
name|klass
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|object_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GimpToolClass
modifier|*
name|tool_class
init|=
name|GIMP_TOOL_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GimpDrawToolClass
modifier|*
name|draw_tool_class
init|=
name|GIMP_DRAW_TOOL_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|object_class
operator|->
name|finalize
operator|=
name|gimp_align_tool_finalize
expr_stmt|;
name|object_class
operator|->
name|constructor
operator|=
name|gimp_align_tool_constructor
expr_stmt|;
name|tool_class
operator|->
name|initialize
operator|=
name|gimp_align_tool_initialize
expr_stmt|;
name|tool_class
operator|->
name|control
operator|=
name|gimp_align_tool_control
expr_stmt|;
name|tool_class
operator|->
name|button_press
operator|=
name|gimp_align_tool_button_press
expr_stmt|;
name|tool_class
operator|->
name|button_release
operator|=
name|gimp_align_tool_button_release
expr_stmt|;
name|tool_class
operator|->
name|motion
operator|=
name|gimp_align_tool_motion
expr_stmt|;
name|tool_class
operator|->
name|oper_update
operator|=
name|gimp_align_tool_oper_update
expr_stmt|;
name|tool_class
operator|->
name|cursor_update
operator|=
name|gimp_align_tool_cursor_update
expr_stmt|;
name|draw_tool_class
operator|->
name|draw
operator|=
name|gimp_align_tool_draw
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_init (GimpAlignTool * align_tool)
name|gimp_align_tool_init
parameter_list|(
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
block|{
name|GimpTool
modifier|*
name|tool
init|=
name|GIMP_TOOL
argument_list|(
name|align_tool
argument_list|)
decl_stmt|;
name|align_tool
operator|->
name|controls
operator|=
name|NULL
expr_stmt|;
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_IDLE
expr_stmt|;
name|align_tool
operator|->
name|selected_objects
operator|=
name|NULL
expr_stmt|;
name|align_tool
operator|->
name|align_type
operator|=
name|GIMP_ALIGN_LEFT
expr_stmt|;
name|align_tool
operator|->
name|horz_offset
operator|=
literal|0
expr_stmt|;
name|align_tool
operator|->
name|vert_offset
operator|=
literal|0
expr_stmt|;
name|gimp_tool_control_set_snap_to
argument_list|(
name|tool
operator|->
name|control
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_tool_control_set_precision
argument_list|(
name|tool
operator|->
name|control
argument_list|,
name|GIMP_CURSOR_PRECISION_PIXEL_BORDER
argument_list|)
expr_stmt|;
name|gimp_tool_control_set_tool_cursor
argument_list|(
name|tool
operator|->
name|control
argument_list|,
name|GIMP_TOOL_CURSOR_MOVE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GObject
modifier|*
DECL|function|gimp_align_tool_constructor (GType type,guint n_params,GObjectConstructParam * params)
name|gimp_align_tool_constructor
parameter_list|(
name|GType
name|type
parameter_list|,
name|guint
name|n_params
parameter_list|,
name|GObjectConstructParam
modifier|*
name|params
parameter_list|)
block|{
name|GObject
modifier|*
name|object
decl_stmt|;
name|GimpTool
modifier|*
name|tool
decl_stmt|;
name|GimpAlignTool
modifier|*
name|align_tool
decl_stmt|;
name|GtkContainer
modifier|*
name|container
decl_stmt|;
name|GObject
modifier|*
name|options
decl_stmt|;
name|object
operator|=
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|constructor
argument_list|(
name|type
argument_list|,
name|n_params
argument_list|,
name|params
argument_list|)
expr_stmt|;
name|tool
operator|=
name|GIMP_TOOL
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|align_tool
operator|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|options
operator|=
name|G_OBJECT
argument_list|(
name|gimp_tool_get_options
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
comment|/* This line of code is evil because it relies on that the 'options'    * object is fully constructed before we get here, which is not    * guaranteed    */
name|container
operator|=
name|g_object_get_data
argument_list|(
name|options
argument_list|,
literal|"controls-container"
argument_list|)
expr_stmt|;
if|if
condition|(
name|container
condition|)
block|{
name|align_tool
operator|->
name|controls
operator|=
name|gimp_align_tool_controls
argument_list|(
name|align_tool
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|container
argument_list|,
name|align_tool
operator|->
name|controls
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|align_tool
operator|->
name|controls
argument_list|)
expr_stmt|;
block|}
return|return
name|object
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_finalize (GObject * object)
name|gimp_align_tool_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpTool
modifier|*
name|tool
init|=
name|GIMP_TOOL
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|object
argument_list|)
decl_stmt|;
if|if
condition|(
name|gimp_draw_tool_is_active
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|object
argument_list|)
argument_list|)
condition|)
name|gimp_draw_tool_stop
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|object
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_tool_control_is_active
argument_list|(
name|tool
operator|->
name|control
argument_list|)
condition|)
name|gimp_tool_control_halt
argument_list|(
name|tool
operator|->
name|control
argument_list|)
expr_stmt|;
if|if
condition|(
name|align_tool
operator|->
name|controls
condition|)
block|{
name|gtk_widget_destroy
argument_list|(
name|align_tool
operator|->
name|controls
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|controls
operator|=
name|NULL
expr_stmt|;
block|}
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|finalize
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_align_tool_initialize (GimpTool * tool,GimpDisplay * display,GError ** error)
name|gimp_align_tool_initialize
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
block|{
if|if
condition|(
name|tool
operator|->
name|display
operator|!=
name|display
condition|)
block|{     }
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_control (GimpTool * tool,GimpToolAction action,GimpDisplay * display)
name|gimp_align_tool_control
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpToolAction
name|action
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|tool
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|action
condition|)
block|{
case|case
name|GIMP_TOOL_ACTION_PAUSE
case|:
case|case
name|GIMP_TOOL_ACTION_RESUME
case|:
break|break;
case|case
name|GIMP_TOOL_ACTION_HALT
case|:
name|clear_all_selected_objects
argument_list|(
name|align_tool
argument_list|)
expr_stmt|;
break|break;
block|}
name|GIMP_TOOL_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|control
argument_list|(
name|tool
argument_list|,
name|action
argument_list|,
name|display
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_button_press (GimpTool * tool,const GimpCoords * coords,guint32 time,GdkModifierType state,GimpButtonPressType press_type,GimpDisplay * display)
name|gimp_align_tool_button_press
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|guint32
name|time
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpButtonPressType
name|press_type
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|tool
argument_list|)
decl_stmt|;
name|gimp_draw_tool_pause
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  If the tool was being used in another image... reset it  */
if|if
condition|(
name|display
operator|!=
name|tool
operator|->
name|display
condition|)
block|{
if|if
condition|(
name|gimp_draw_tool_is_active
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
condition|)
name|gimp_draw_tool_stop
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_tool_pop_status
argument_list|(
name|tool
argument_list|,
name|display
argument_list|)
expr_stmt|;
name|clear_all_selected_objects
argument_list|(
name|align_tool
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|gimp_tool_control_is_active
argument_list|(
name|tool
operator|->
name|control
argument_list|)
condition|)
name|gimp_tool_control_activate
argument_list|(
name|tool
operator|->
name|control
argument_list|)
expr_stmt|;
name|tool
operator|->
name|display
operator|=
name|display
expr_stmt|;
name|align_tool
operator|->
name|x1
operator|=
name|align_tool
operator|->
name|x0
operator|=
name|coords
operator|->
name|x
expr_stmt|;
name|align_tool
operator|->
name|y1
operator|=
name|align_tool
operator|->
name|y0
operator|=
name|coords
operator|->
name|y
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_draw_tool_is_active
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
condition|)
name|gimp_draw_tool_start
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|,
name|display
argument_list|)
expr_stmt|;
name|gimp_draw_tool_resume
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* some rather complex logic here.  If the user clicks without modifiers,  * then we start a new list, and use the first object in it as reference.  * If the user clicks using Shift, or draws a rubber-band box, then  * we add objects to the list, but do not specify which one should  * be used as reference.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_button_release (GimpTool * tool,const GimpCoords * coords,guint32 time,GdkModifierType state,GimpButtonReleaseType release_type,GimpDisplay * display)
name|gimp_align_tool_button_release
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|guint32
name|time
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpButtonReleaseType
name|release_type
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|tool
argument_list|)
decl_stmt|;
name|GimpDisplayShell
modifier|*
name|shell
init|=
name|gimp_display_get_shell
argument_list|(
name|display
argument_list|)
decl_stmt|;
name|GObject
modifier|*
name|object
init|=
name|NULL
decl_stmt|;
name|GimpImage
modifier|*
name|image
init|=
name|gimp_display_get_image
argument_list|(
name|display
argument_list|)
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gimp_draw_tool_pause
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|release_type
operator|==
name|GIMP_BUTTON_RELEASE_CANCEL
condition|)
block|{
name|align_tool
operator|->
name|x1
operator|=
name|align_tool
operator|->
name|x0
expr_stmt|;
name|align_tool
operator|->
name|y1
operator|=
name|align_tool
operator|->
name|y0
expr_stmt|;
name|gimp_draw_tool_resume
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
operator|(
name|state
operator|&
name|GDK_SHIFT_MASK
operator|)
condition|)
comment|/* start a new list */
block|{
name|clear_all_selected_objects
argument_list|(
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|set_reference
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/* if mouse has moved less than EPSILON pixels since button press, select      the nearest thing, otherwise make a rubber-band rectangle */
if|if
condition|(
name|hypot
argument_list|(
name|coords
operator|->
name|x
operator|-
name|align_tool
operator|->
name|x0
argument_list|,
name|coords
operator|->
name|y
operator|-
name|align_tool
operator|->
name|y0
argument_list|)
operator|<
name|EPSILON
condition|)
block|{
name|GimpVectors
modifier|*
name|vectors
decl_stmt|;
name|GimpGuide
modifier|*
name|guide
decl_stmt|;
name|GimpLayer
modifier|*
name|layer
decl_stmt|;
name|gint
name|snap_distance
init|=
name|display
operator|->
name|config
operator|->
name|snap_distance
decl_stmt|;
if|if
condition|(
name|gimp_draw_tool_on_vectors
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|,
name|display
argument_list|,
name|coords
argument_list|,
name|snap_distance
argument_list|,
name|snap_distance
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|vectors
argument_list|)
condition|)
block|{
name|object
operator|=
name|G_OBJECT
argument_list|(
name|vectors
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gimp_display_shell_get_show_guides
argument_list|(
name|shell
argument_list|)
operator|&&
operator|(
name|guide
operator|=
name|gimp_image_find_guide
argument_list|(
name|image
argument_list|,
name|coords
operator|->
name|x
argument_list|,
name|coords
operator|->
name|y
argument_list|,
name|FUNSCALEX
argument_list|(
name|shell
argument_list|,
name|snap_distance
argument_list|)
argument_list|,
name|FUNSCALEY
argument_list|(
name|shell
argument_list|,
name|snap_distance
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|object
operator|=
name|G_OBJECT
argument_list|(
name|guide
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|(
name|layer
operator|=
name|select_layer_by_coords
argument_list|(
name|image
argument_list|,
name|coords
operator|->
name|x
argument_list|,
name|coords
operator|->
name|y
argument_list|)
operator|)
condition|)
block|{
name|object
operator|=
name|G_OBJECT
argument_list|(
name|layer
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|object
condition|)
block|{
if|if
condition|(
operator|!
name|g_list_find
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|,
name|object
argument_list|)
condition|)
block|{
name|align_tool
operator|->
name|selected_objects
operator|=
name|g_list_append
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|,
name|object
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|object
argument_list|,
literal|"removed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|clear_selected_object
argument_list|)
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
comment|/* if an object has been selected using unmodified click,                * it should be used as the reference                */
if|if
condition|(
operator|!
operator|(
name|state
operator|&
operator|(
name|GDK_SHIFT_MASK
operator||
name|GDK_CONTROL_MASK
operator|)
operator|)
condition|)
name|align_tool
operator|->
name|set_reference
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
else|else
comment|/* FIXME: look for vectors too */
block|{
name|gint
name|X0
init|=
name|MIN
argument_list|(
name|coords
operator|->
name|x
argument_list|,
name|align_tool
operator|->
name|x0
argument_list|)
decl_stmt|;
name|gint
name|X1
init|=
name|MAX
argument_list|(
name|coords
operator|->
name|x
argument_list|,
name|align_tool
operator|->
name|x0
argument_list|)
decl_stmt|;
name|gint
name|Y0
init|=
name|MIN
argument_list|(
name|coords
operator|->
name|y
argument_list|,
name|align_tool
operator|->
name|y0
argument_list|)
decl_stmt|;
name|gint
name|Y1
init|=
name|MAX
argument_list|(
name|coords
operator|->
name|y
argument_list|,
name|align_tool
operator|->
name|y0
argument_list|)
decl_stmt|;
name|GList
modifier|*
name|all_layers
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|all_layers
operator|=
name|gimp_image_get_layer_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|all_layers
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpLayer
modifier|*
name|layer
init|=
name|list
operator|->
name|data
decl_stmt|;
name|gint
name|x0
decl_stmt|,
name|y0
decl_stmt|,
name|x1
decl_stmt|,
name|y1
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_item_get_visible
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
condition|)
continue|continue;
name|gimp_item_get_offset
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|,
operator|&
name|x0
argument_list|,
operator|&
name|y0
argument_list|)
expr_stmt|;
name|x1
operator|=
name|x0
operator|+
name|gimp_item_get_width
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
name|y1
operator|=
name|y0
operator|+
name|gimp_item_get_height
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|x0
operator|<
name|X0
operator|||
name|y0
operator|<
name|Y0
operator|||
name|x1
operator|>
name|X1
operator|||
name|y1
operator|>
name|Y1
condition|)
continue|continue;
if|if
condition|(
name|g_list_find
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|,
name|layer
argument_list|)
condition|)
continue|continue;
name|align_tool
operator|->
name|selected_objects
operator|=
name|g_list_append
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|,
name|layer
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|layer
argument_list|,
literal|"removed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|clear_selected_object
argument_list|)
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|all_layers
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|ALIGN_TOOL_NUM_BUTTONS
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|align_tool
operator|->
name|button
index|[
name|i
index|]
condition|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|align_tool
operator|->
name|button
index|[
name|i
index|]
argument_list|,
operator|(
name|align_tool
operator|->
name|selected_objects
operator|!=
name|NULL
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|align_tool
operator|->
name|x1
operator|=
name|align_tool
operator|->
name|x0
expr_stmt|;
name|align_tool
operator|->
name|y1
operator|=
name|align_tool
operator|->
name|y0
expr_stmt|;
name|gimp_draw_tool_resume
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_motion (GimpTool * tool,const GimpCoords * coords,guint32 time,GdkModifierType state,GimpDisplay * display)
name|gimp_align_tool_motion
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|guint32
name|time
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|tool
argument_list|)
decl_stmt|;
name|gimp_draw_tool_pause
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|x1
operator|=
name|coords
operator|->
name|x
expr_stmt|;
name|align_tool
operator|->
name|y1
operator|=
name|coords
operator|->
name|y
expr_stmt|;
name|gimp_draw_tool_resume
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_oper_update (GimpTool * tool,const GimpCoords * coords,GdkModifierType state,gboolean proximity,GimpDisplay * display)
name|gimp_align_tool_oper_update
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|gboolean
name|proximity
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|tool
argument_list|)
decl_stmt|;
name|GimpDisplayShell
modifier|*
name|shell
init|=
name|gimp_display_get_shell
argument_list|(
name|display
argument_list|)
decl_stmt|;
name|GimpImage
modifier|*
name|image
init|=
name|gimp_display_get_image
argument_list|(
name|display
argument_list|)
decl_stmt|;
name|gint
name|snap_distance
init|=
name|display
operator|->
name|config
operator|->
name|snap_distance
decl_stmt|;
if|if
condition|(
name|gimp_draw_tool_on_vectors
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|tool
argument_list|)
argument_list|,
name|display
argument_list|,
name|coords
argument_list|,
name|snap_distance
argument_list|,
name|snap_distance
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
condition|)
block|{
if|if
condition|(
operator|(
name|state
operator|&
name|GDK_SHIFT_MASK
operator|)
operator|&&
name|align_tool
operator|->
name|selected_objects
condition|)
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_ADD_PATH
expr_stmt|;
else|else
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_PICK_PATH
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gimp_display_shell_get_show_guides
argument_list|(
name|shell
argument_list|)
operator|&&
operator|(
name|NULL
operator|!=
name|gimp_image_find_guide
argument_list|(
name|image
argument_list|,
name|coords
operator|->
name|x
argument_list|,
name|coords
operator|->
name|y
argument_list|,
name|FUNSCALEX
argument_list|(
name|shell
argument_list|,
name|snap_distance
argument_list|)
argument_list|,
name|FUNSCALEY
argument_list|(
name|shell
argument_list|,
name|snap_distance
argument_list|)
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|state
operator|&
name|GDK_SHIFT_MASK
operator|)
operator|&&
name|align_tool
operator|->
name|selected_objects
condition|)
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_ADD_GUIDE
expr_stmt|;
else|else
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_PICK_GUIDE
expr_stmt|;
block|}
else|else
block|{
name|GimpLayer
modifier|*
name|layer
init|=
name|select_layer_by_coords
argument_list|(
name|image
argument_list|,
name|coords
operator|->
name|x
argument_list|,
name|coords
operator|->
name|y
argument_list|)
decl_stmt|;
if|if
condition|(
name|layer
condition|)
block|{
if|if
condition|(
operator|(
name|state
operator|&
name|GDK_SHIFT_MASK
operator|)
operator|&&
name|align_tool
operator|->
name|selected_objects
condition|)
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_ADD_LAYER
expr_stmt|;
else|else
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_PICK_LAYER
expr_stmt|;
block|}
else|else
block|{
name|align_tool
operator|->
name|function
operator|=
name|ALIGN_TOOL_IDLE
expr_stmt|;
block|}
block|}
name|gimp_align_tool_status_update
argument_list|(
name|tool
argument_list|,
name|display
argument_list|,
name|state
argument_list|,
name|proximity
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_cursor_update (GimpTool * tool,const GimpCoords * coords,GdkModifierType state,GimpDisplay * display)
name|gimp_align_tool_cursor_update
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|tool
argument_list|)
decl_stmt|;
name|GimpToolCursorType
name|tool_cursor
init|=
name|GIMP_TOOL_CURSOR_NONE
decl_stmt|;
name|GimpCursorModifier
name|modifier
init|=
name|GIMP_CURSOR_MODIFIER_NONE
decl_stmt|;
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
comment|/* always add '+' when Shift is pressed, even if nothing is selected */
name|modifier
operator|=
name|GIMP_CURSOR_MODIFIER_PLUS
expr_stmt|;
block|}
switch|switch
condition|(
name|align_tool
operator|->
name|function
condition|)
block|{
case|case
name|ALIGN_TOOL_IDLE
case|:
name|tool_cursor
operator|=
name|GIMP_TOOL_CURSOR_RECT_SELECT
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_PICK_LAYER
case|:
case|case
name|ALIGN_TOOL_ADD_LAYER
case|:
name|tool_cursor
operator|=
name|GIMP_TOOL_CURSOR_HAND
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_PICK_GUIDE
case|:
case|case
name|ALIGN_TOOL_ADD_GUIDE
case|:
name|tool_cursor
operator|=
name|GIMP_TOOL_CURSOR_MOVE
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_PICK_PATH
case|:
case|case
name|ALIGN_TOOL_ADD_PATH
case|:
name|tool_cursor
operator|=
name|GIMP_TOOL_CURSOR_PATHS
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_DRAG_BOX
case|:
comment|/* FIXME: it would be nice to add something here, but we cannot easily          detect when the tool is in this mode (the draw tool is always active)          so this state is not used for the moment.       */
break|break;
block|}
name|gimp_tool_control_set_cursor
argument_list|(
name|tool
operator|->
name|control
argument_list|,
name|GIMP_CURSOR_MOUSE
argument_list|)
expr_stmt|;
name|gimp_tool_control_set_tool_cursor
argument_list|(
name|tool
operator|->
name|control
argument_list|,
name|tool_cursor
argument_list|)
expr_stmt|;
name|gimp_tool_control_set_cursor_modifier
argument_list|(
name|tool
operator|->
name|control
argument_list|,
name|modifier
argument_list|)
expr_stmt|;
name|GIMP_TOOL_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|cursor_update
argument_list|(
name|tool
argument_list|,
name|coords
argument_list|,
name|state
argument_list|,
name|display
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_status_update (GimpTool * tool,GimpDisplay * display,GdkModifierType state,gboolean proximity)
name|gimp_align_tool_status_update
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpDisplay
modifier|*
name|display
parameter_list|,
name|GdkModifierType
name|state
parameter_list|,
name|gboolean
name|proximity
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|tool
argument_list|)
decl_stmt|;
name|gimp_tool_pop_status
argument_list|(
name|tool
argument_list|,
name|display
argument_list|)
expr_stmt|;
if|if
condition|(
name|proximity
condition|)
block|{
specifier|const
name|gchar
modifier|*
name|status
init|=
name|NULL
decl_stmt|;
name|gboolean
name|free_status
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
operator|!
name|align_tool
operator|->
name|selected_objects
condition|)
block|{
comment|/* no need to suggest Shift if nothing is selected */
name|state
operator||=
name|GDK_SHIFT_MASK
expr_stmt|;
block|}
switch|switch
condition|(
name|align_tool
operator|->
name|function
condition|)
block|{
case|case
name|ALIGN_TOOL_IDLE
case|:
name|status
operator|=
name|gimp_suggest_modifiers
argument_list|(
name|_
argument_list|(
literal|"Click on a layer, path or guide, "
literal|"or Click-Drag to pick several "
literal|"layers"
argument_list|)
argument_list|,
name|GDK_SHIFT_MASK
operator|&
operator|~
name|state
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|free_status
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_PICK_LAYER
case|:
name|status
operator|=
name|gimp_suggest_modifiers
argument_list|(
name|_
argument_list|(
literal|"Click to pick this layer as "
literal|"first item"
argument_list|)
argument_list|,
name|GDK_SHIFT_MASK
operator|&
operator|~
name|state
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|free_status
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_ADD_LAYER
case|:
name|status
operator|=
name|_
argument_list|(
literal|"Click to add this layer to the list"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_PICK_GUIDE
case|:
name|status
operator|=
name|gimp_suggest_modifiers
argument_list|(
name|_
argument_list|(
literal|"Click to pick this guide as "
literal|"first item"
argument_list|)
argument_list|,
name|GDK_SHIFT_MASK
operator|&
operator|~
name|state
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|free_status
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_ADD_GUIDE
case|:
name|status
operator|=
name|_
argument_list|(
literal|"Click to add this guide to the list"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_PICK_PATH
case|:
name|status
operator|=
name|gimp_suggest_modifiers
argument_list|(
name|_
argument_list|(
literal|"Click to pick this path as "
literal|"first item"
argument_list|)
argument_list|,
name|GDK_SHIFT_MASK
operator|&
operator|~
name|state
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|free_status
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_ADD_PATH
case|:
name|status
operator|=
name|_
argument_list|(
literal|"Click to add this path to the list"
argument_list|)
expr_stmt|;
break|break;
case|case
name|ALIGN_TOOL_DRAG_BOX
case|:
break|break;
block|}
if|if
condition|(
name|status
condition|)
name|gimp_tool_push_status
argument_list|(
name|tool
argument_list|,
name|display
argument_list|,
literal|"%s"
argument_list|,
name|status
argument_list|)
expr_stmt|;
if|if
condition|(
name|free_status
condition|)
name|g_free
argument_list|(
operator|(
name|gchar
operator|*
operator|)
name|status
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_align_tool_draw (GimpDrawTool * draw_tool)
name|gimp_align_tool_draw
parameter_list|(
name|GimpDrawTool
modifier|*
name|draw_tool
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|draw_tool
argument_list|)
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|w
decl_stmt|,
name|h
decl_stmt|;
comment|/* draw rubber-band rectangle */
name|x
operator|=
name|MIN
argument_list|(
name|align_tool
operator|->
name|x1
argument_list|,
name|align_tool
operator|->
name|x0
argument_list|)
expr_stmt|;
name|y
operator|=
name|MIN
argument_list|(
name|align_tool
operator|->
name|y1
argument_list|,
name|align_tool
operator|->
name|y0
argument_list|)
expr_stmt|;
name|w
operator|=
name|MAX
argument_list|(
name|align_tool
operator|->
name|x1
argument_list|,
name|align_tool
operator|->
name|x0
argument_list|)
operator|-
name|x
expr_stmt|;
name|h
operator|=
name|MAX
argument_list|(
name|align_tool
operator|->
name|y1
argument_list|,
name|align_tool
operator|->
name|y0
argument_list|)
operator|-
name|y
expr_stmt|;
name|gimp_draw_tool_add_rectangle
argument_list|(
name|draw_tool
argument_list|,
name|FALSE
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|w
argument_list|,
name|h
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|align_tool
operator|->
name|selected_objects
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
if|if
condition|(
name|GIMP_IS_ITEM
argument_list|(
name|list
operator|->
name|data
argument_list|)
condition|)
block|{
name|GimpItem
modifier|*
name|item
init|=
name|GIMP_ITEM
argument_list|(
name|list
operator|->
name|data
argument_list|)
decl_stmt|;
if|if
condition|(
name|GIMP_IS_VECTORS
argument_list|(
name|list
operator|->
name|data
argument_list|)
condition|)
block|{
name|gdouble
name|x1_f
decl_stmt|,
name|y1_f
decl_stmt|,
name|x2_f
decl_stmt|,
name|y2_f
decl_stmt|;
name|gimp_vectors_bounds
argument_list|(
name|GIMP_VECTORS
argument_list|(
name|item
argument_list|)
argument_list|,
operator|&
name|x1_f
argument_list|,
operator|&
name|y1_f
argument_list|,
operator|&
name|x2_f
argument_list|,
operator|&
name|y2_f
argument_list|)
expr_stmt|;
name|x
operator|=
name|ROUND
argument_list|(
name|x1_f
argument_list|)
expr_stmt|;
name|y
operator|=
name|ROUND
argument_list|(
name|y1_f
argument_list|)
expr_stmt|;
name|w
operator|=
name|ROUND
argument_list|(
name|x2_f
operator|-
name|x1_f
argument_list|)
expr_stmt|;
name|h
operator|=
name|ROUND
argument_list|(
name|y2_f
operator|-
name|y1_f
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_item_get_offset
argument_list|(
name|item
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|w
operator|=
name|gimp_item_get_width
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|h
operator|=
name|gimp_item_get_height
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_NORTH_WEST
argument_list|)
expr_stmt|;
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
name|x
operator|+
name|w
argument_list|,
name|y
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_NORTH_EAST
argument_list|)
expr_stmt|;
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
name|x
argument_list|,
name|y
operator|+
name|h
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_SOUTH_WEST
argument_list|)
expr_stmt|;
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
name|x
operator|+
name|w
argument_list|,
name|y
operator|+
name|h
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_SOUTH_EAST
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|GIMP_IS_GUIDE
argument_list|(
name|list
operator|->
name|data
argument_list|)
condition|)
block|{
name|GimpGuide
modifier|*
name|guide
init|=
name|GIMP_GUIDE
argument_list|(
name|list
operator|->
name|data
argument_list|)
decl_stmt|;
name|GimpImage
modifier|*
name|image
init|=
name|gimp_display_get_image
argument_list|(
name|GIMP_TOOL
argument_list|(
name|draw_tool
argument_list|)
operator|->
name|display
argument_list|)
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gint
name|w
decl_stmt|,
name|h
decl_stmt|;
switch|switch
condition|(
name|gimp_guide_get_orientation
argument_list|(
name|guide
argument_list|)
condition|)
block|{
case|case
name|GIMP_ORIENTATION_VERTICAL
case|:
name|x
operator|=
name|gimp_guide_get_position
argument_list|(
name|guide
argument_list|)
expr_stmt|;
name|h
operator|=
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
name|x
argument_list|,
name|h
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_SOUTH
argument_list|)
expr_stmt|;
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
name|x
argument_list|,
literal|0
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_NORTH
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_ORIENTATION_HORIZONTAL
case|:
name|y
operator|=
name|gimp_guide_get_position
argument_list|(
name|guide
argument_list|)
expr_stmt|;
name|w
operator|=
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
name|w
argument_list|,
name|y
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_EAST
argument_list|)
expr_stmt|;
name|gimp_draw_tool_add_handle
argument_list|(
name|draw_tool
argument_list|,
name|GIMP_HANDLE_FILLED_SQUARE
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|MARKER_WIDTH
argument_list|,
name|GIMP_HANDLE_ANCHOR_WEST
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|gimp_align_tool_controls (GimpAlignTool * align_tool)
name|gimp_align_tool_controls
parameter_list|(
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|combo
decl_stmt|;
name|gint
name|n
init|=
literal|0
decl_stmt|;
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Align"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Relative to:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|combo
operator|=
name|gimp_enum_combo_box_new
argument_list|(
name|GIMP_TYPE_ALIGN_REFERENCE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|combo
argument_list|)
expr_stmt|;
name|gimp_int_combo_box_connect
argument_list|(
name|GIMP_INT_COMBO_BOX
argument_list|(
name|combo
argument_list|)
argument_list|,
name|GIMP_ALIGN_REFERENCE_FIRST
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_int_combo_box_get_active
argument_list|)
argument_list|,
operator|&
name|align_tool
operator|->
name|align_reference_type
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|combo
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ALIGN_LEFT
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Align left edge of target"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ALIGN_HCENTER
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Align center of target"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ALIGN_RIGHT
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Align right edge of target"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ALIGN_TOP
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Align top edge of target"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ALIGN_VCENTER
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Align middle of target"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ALIGN_BOTTOM
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Align bottom of target"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|_
argument_list|(
literal|"Distribute"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ARRANGE_LEFT
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Distribute left edges of targets"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ARRANGE_HCENTER
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Distribute horizontal centers of targets"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ARRANGE_RIGHT
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Distribute right edges of targets"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ARRANGE_TOP
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Distribute top edges of targets"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ARRANGE_VCENTER
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Distribute vertical centers of targets"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|button_with_stock
argument_list|(
name|GIMP_ARRANGE_BOTTOM
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|button
index|[
name|n
operator|++
index|]
operator|=
name|button
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Distribute bottoms of targets"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Offset:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gimp_spin_button_new
argument_list|(
operator|(
name|GtkObject
operator|*
operator|*
operator|)
operator|&
name|align_tool
operator|->
name|horz_offset_adjustment
argument_list|,
literal|0
argument_list|,
operator|-
literal|100000
argument_list|,
literal|100000
argument_list|,
literal|1
argument_list|,
literal|20
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|align_tool
operator|->
name|horz_offset_adjustment
argument_list|,
literal|"value-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|align_tool
operator|->
name|horz_offset
argument_list|)
expr_stmt|;
return|return
name|main_vbox
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|do_alignment (GtkWidget * widget,gpointer data)
name|do_alignment
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpAlignTool
modifier|*
name|align_tool
init|=
name|GIMP_ALIGN_TOOL
argument_list|(
name|data
argument_list|)
decl_stmt|;
name|GimpImage
modifier|*
name|image
decl_stmt|;
name|GimpAlignmentType
name|action
decl_stmt|;
name|GObject
modifier|*
name|reference_object
init|=
name|NULL
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gint
name|offset
decl_stmt|;
name|image
operator|=
name|gimp_display_get_image
argument_list|(
name|GIMP_TOOL
argument_list|(
name|align_tool
argument_list|)
operator|->
name|display
argument_list|)
expr_stmt|;
name|action
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"action"
argument_list|)
argument_list|)
expr_stmt|;
name|offset
operator|=
name|align_tool
operator|->
name|horz_offset
expr_stmt|;
switch|switch
condition|(
name|action
condition|)
block|{
case|case
name|GIMP_ALIGN_LEFT
case|:
case|case
name|GIMP_ALIGN_HCENTER
case|:
case|case
name|GIMP_ALIGN_RIGHT
case|:
case|case
name|GIMP_ALIGN_TOP
case|:
case|case
name|GIMP_ALIGN_VCENTER
case|:
case|case
name|GIMP_ALIGN_BOTTOM
case|:
name|offset
operator|=
literal|0
expr_stmt|;
break|break;
case|case
name|GIMP_ARRANGE_LEFT
case|:
case|case
name|GIMP_ARRANGE_HCENTER
case|:
case|case
name|GIMP_ARRANGE_RIGHT
case|:
case|case
name|GIMP_ARRANGE_TOP
case|:
case|case
name|GIMP_ARRANGE_VCENTER
case|:
case|case
name|GIMP_ARRANGE_BOTTOM
case|:
name|offset
operator|=
name|align_tool
operator|->
name|horz_offset
expr_stmt|;
break|break;
block|}
comment|/* if nothing is selected, just return */
if|if
condition|(
name|g_list_length
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|)
operator|==
literal|0
condition|)
return|return;
comment|/* if only one object is selected, use the image as reference    * if multiple objects are selected, use the first one as reference if    * "set_reference" is TRUE, otherwise use NULL.    */
name|list
operator|=
name|align_tool
operator|->
name|selected_objects
expr_stmt|;
switch|switch
condition|(
name|align_tool
operator|->
name|align_reference_type
condition|)
block|{
case|case
name|GIMP_ALIGN_REFERENCE_IMAGE
case|:
name|reference_object
operator|=
name|G_OBJECT
argument_list|(
name|image
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_REFERENCE_FIRST
case|:
if|if
condition|(
name|g_list_length
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|)
operator|==
literal|1
condition|)
block|{
name|reference_object
operator|=
name|G_OBJECT
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|align_tool
operator|->
name|set_reference
condition|)
block|{
name|reference_object
operator|=
name|G_OBJECT
argument_list|(
name|align_tool
operator|->
name|selected_objects
operator|->
name|data
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_list_next
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|reference_object
operator|=
name|NULL
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GIMP_ALIGN_REFERENCE_SELECTION
case|:
name|reference_object
operator|=
name|G_OBJECT
argument_list|(
name|gimp_image_get_mask
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_REFERENCE_ACTIVE_LAYER
case|:
name|reference_object
operator|=
name|G_OBJECT
argument_list|(
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_REFERENCE_ACTIVE_CHANNEL
case|:
name|reference_object
operator|=
name|G_OBJECT
argument_list|(
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_REFERENCE_ACTIVE_PATH
case|:
name|g_print
argument_list|(
literal|"reference = active path not yet handled.\n"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|reference_object
condition|)
return|return;
name|gimp_draw_tool_pause
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|align_tool
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_image_arrange_objects
argument_list|(
name|image
argument_list|,
name|list
argument_list|,
name|action
argument_list|,
name|reference_object
argument_list|,
name|action
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|gimp_draw_tool_resume
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|align_tool
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_image_flush
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|button_with_stock (GimpAlignmentType action,GimpAlignTool * align_tool)
name|button_with_stock
parameter_list|(
name|GimpAlignmentType
name|action
parameter_list|,
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|image
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|stock_id
init|=
name|NULL
decl_stmt|;
switch|switch
condition|(
name|action
condition|)
block|{
case|case
name|GIMP_ALIGN_LEFT
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_WEST
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_HCENTER
case|:
name|stock_id
operator|=
name|GIMP_STOCK_HCENTER
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_RIGHT
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_EAST
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_TOP
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_NORTH
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_VCENTER
case|:
name|stock_id
operator|=
name|GIMP_STOCK_VCENTER
expr_stmt|;
break|break;
case|case
name|GIMP_ALIGN_BOTTOM
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_SOUTH
expr_stmt|;
break|break;
case|case
name|GIMP_ARRANGE_LEFT
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_WEST
expr_stmt|;
break|break;
case|case
name|GIMP_ARRANGE_HCENTER
case|:
name|stock_id
operator|=
name|GIMP_STOCK_HCENTER
expr_stmt|;
break|break;
case|case
name|GIMP_ARRANGE_RIGHT
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_EAST
expr_stmt|;
break|break;
case|case
name|GIMP_ARRANGE_TOP
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_NORTH
expr_stmt|;
break|break;
case|case
name|GIMP_ARRANGE_VCENTER
case|:
name|stock_id
operator|=
name|GIMP_STOCK_VCENTER
expr_stmt|;
break|break;
case|case
name|GIMP_ARRANGE_BOTTOM
case|:
name|stock_id
operator|=
name|GIMP_STOCK_GRAVITY_SOUTH
expr_stmt|;
break|break;
default|default:
name|g_return_val_if_reached
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
break|break;
block|}
name|button
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"action"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|action
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_stock
argument_list|(
name|stock_id
argument_list|,
name|GTK_ICON_SIZE_BUTTON
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|image
argument_list|)
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|do_alignment
argument_list|)
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
return|return
name|button
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|clear_selected_object (GObject * object,GimpAlignTool * align_tool)
name|clear_selected_object
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
block|{
name|gimp_draw_tool_pause
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|align_tool
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|align_tool
operator|->
name|selected_objects
condition|)
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|object
argument_list|,
name|G_CALLBACK
argument_list|(
name|clear_selected_object
argument_list|)
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|selected_objects
operator|=
name|g_list_remove
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|,
name|object
argument_list|)
expr_stmt|;
name|gimp_draw_tool_resume
argument_list|(
name|GIMP_DRAW_TOOL
argument_list|(
name|align_tool
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|clear_all_selected_objects (GimpAlignTool * align_tool)
name|clear_all_selected_objects
parameter_list|(
name|GimpAlignTool
modifier|*
name|align_tool
parameter_list|)
block|{
name|GimpDrawTool
modifier|*
name|draw_tool
init|=
name|GIMP_DRAW_TOOL
argument_list|(
name|align_tool
argument_list|)
decl_stmt|;
if|if
condition|(
name|gimp_draw_tool_is_active
argument_list|(
name|draw_tool
argument_list|)
condition|)
name|gimp_draw_tool_pause
argument_list|(
name|draw_tool
argument_list|)
expr_stmt|;
while|while
condition|(
name|align_tool
operator|->
name|selected_objects
condition|)
block|{
name|GObject
modifier|*
name|object
init|=
name|align_tool
operator|->
name|selected_objects
operator|->
name|data
decl_stmt|;
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|object
argument_list|,
name|clear_selected_object
argument_list|,
name|align_tool
argument_list|)
expr_stmt|;
name|align_tool
operator|->
name|selected_objects
operator|=
name|g_list_remove
argument_list|(
name|align_tool
operator|->
name|selected_objects
argument_list|,
name|object
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gimp_draw_tool_is_active
argument_list|(
name|draw_tool
argument_list|)
condition|)
name|gimp_draw_tool_resume
argument_list|(
name|draw_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GimpLayer
modifier|*
DECL|function|select_layer_by_coords (GimpImage * image,gint x,gint y)
name|select_layer_by_coords
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|GList
modifier|*
name|all_layers
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|all_layers
operator|=
name|gimp_image_get_layer_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|all_layers
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpLayer
modifier|*
name|layer
init|=
name|list
operator|->
name|data
decl_stmt|;
name|gint
name|off_x
decl_stmt|,
name|off_y
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_item_get_visible
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
condition|)
continue|continue;
name|gimp_item_get_offset
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|,
operator|&
name|off_x
argument_list|,
operator|&
name|off_y
argument_list|)
expr_stmt|;
name|width
operator|=
name|gimp_item_get_width
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
name|height
operator|=
name|gimp_item_get_height
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|off_x
operator|<=
name|x
operator|&&
name|off_y
operator|<=
name|y
operator|&&
name|x
operator|<
name|off_x
operator|+
name|width
operator|&&
name|y
operator|<
name|off_y
operator|+
name|height
condition|)
block|{
name|g_list_free
argument_list|(
name|all_layers
argument_list|)
expr_stmt|;
return|return
name|layer
return|;
block|}
block|}
name|g_list_free
argument_list|(
name|all_layers
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

end_unit

