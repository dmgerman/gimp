begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"asupsample.h"
end_include

begin_include
include|#
directive|include
file|"blend.h"
end_include

begin_include
include|#
directive|include
file|"brush_select.h"
end_include

begin_include
include|#
directive|include
file|"buildmenu.h"
end_include

begin_include
include|#
directive|include
file|"cursorutil.h"
end_include

begin_include
include|#
directive|include
file|"draw_core.h"
end_include

begin_include
include|#
directive|include
file|"drawable.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"fuzzy_select.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimage_mask.h"
end_include

begin_include
include|#
directive|include
file|"gradient.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"paint_funcs.h"
end_include

begin_include
include|#
directive|include
file|"palette.h"
end_include

begin_include
include|#
directive|include
file|"selection.h"
end_include

begin_include
include|#
directive|include
file|"tools.h"
end_include

begin_include
include|#
directive|include
file|"undo.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_include
include|#
directive|include
file|"tile.h"
end_include

begin_comment
comment|/*  target size  */
end_comment

begin_define
DECL|macro|TARGET_HEIGHT
define|#
directive|define
name|TARGET_HEIGHT
value|15
end_define

begin_define
DECL|macro|TARGET_WIDTH
define|#
directive|define
name|TARGET_WIDTH
value|15
end_define

begin_define
DECL|macro|SQR (x)
define|#
directive|define
name|SQR
parameter_list|(
name|x
parameter_list|)
value|((x) * (x))
end_define

begin_ifndef
ifndef|#
directive|ifndef
name|M_PI
end_ifndef

begin_define
DECL|macro|M_PI
define|#
directive|define
name|M_PI
value|3.14159265358979323846
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* M_PI */
end_comment

begin_define
DECL|macro|STATUSBAR_SIZE
define|#
directive|define
name|STATUSBAR_SIZE
value|128
end_define

begin_comment
comment|/*  the Blend structures  */
end_comment

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2aee260a0103
block|{
DECL|enumerator|Linear
name|Linear
block|,
DECL|enumerator|BiLinear
name|BiLinear
block|,
DECL|enumerator|Radial
name|Radial
block|,
DECL|enumerator|Square
name|Square
block|,
DECL|enumerator|ConicalSymmetric
name|ConicalSymmetric
block|,
DECL|enumerator|ConicalAsymmetric
name|ConicalAsymmetric
block|,
DECL|enumerator|ShapeburstAngular
name|ShapeburstAngular
block|,
DECL|enumerator|ShapeburstSpherical
name|ShapeburstSpherical
block|,
DECL|enumerator|ShapeburstDimpled
name|ShapeburstDimpled
block|,
DECL|enumerator|SpiralClockwise
name|SpiralClockwise
block|,
DECL|enumerator|SpiralAntiClockwise
name|SpiralAntiClockwise
block|,
DECL|enumerator|GradientTypeLast
name|GradientTypeLast
DECL|typedef|GradientType
block|}
name|GradientType
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2aee260a0203
block|{
DECL|enumerator|FG_BG_RGB_MODE
name|FG_BG_RGB_MODE
block|,
DECL|enumerator|FG_BG_HSV_MODE
name|FG_BG_HSV_MODE
block|,
DECL|enumerator|FG_TRANS_MODE
name|FG_TRANS_MODE
block|,
DECL|enumerator|CUSTOM_MODE
name|CUSTOM_MODE
block|,
DECL|enumerator|BLEND_MODE_LAST
name|BLEND_MODE_LAST
DECL|typedef|BlendMode
block|}
name|BlendMode
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2aee260a0303
block|{
DECL|enumerator|REPEAT_NONE
name|REPEAT_NONE
block|,
DECL|enumerator|REPEAT_SAWTOOTH
name|REPEAT_SAWTOOTH
block|,
DECL|enumerator|REPEAT_TRIANGULAR
name|REPEAT_TRIANGULAR
block|,
DECL|enumerator|REPEAT_LAST
name|REPEAT_LAST
DECL|typedef|RepeatMode
block|}
name|RepeatMode
typedef|;
end_typedef

begin_typedef
DECL|typedef|RepeatFunc
typedef|typedef
name|double
function_decl|(
modifier|*
name|RepeatFunc
function_decl|)
parameter_list|(
name|double
parameter_list|)
function_decl|;
end_typedef

begin_typedef
DECL|typedef|BlendTool
typedef|typedef
name|struct
name|_BlendTool
name|BlendTool
typedef|;
end_typedef

begin_struct
DECL|struct|_BlendTool
struct|struct
name|_BlendTool
block|{
DECL|member|core
name|DrawCore
modifier|*
name|core
decl_stmt|;
comment|/*  Core select object          */
DECL|member|startx
name|int
name|startx
decl_stmt|;
comment|/*  starting x coord            */
DECL|member|starty
name|int
name|starty
decl_stmt|;
comment|/*  starting y coord            */
DECL|member|endx
name|int
name|endx
decl_stmt|;
comment|/*  ending x coord              */
DECL|member|endy
name|int
name|endy
decl_stmt|;
comment|/*  ending y coord              */
DECL|member|context_id
name|guint
name|context_id
decl_stmt|;
comment|/*  for the statusbar           */
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|BlendOptions
typedef|typedef
name|struct
name|_BlendOptions
name|BlendOptions
typedef|;
end_typedef

begin_struct
DECL|struct|_BlendOptions
struct|struct
name|_BlendOptions
block|{
DECL|member|opacity
name|double
name|opacity
decl_stmt|;
DECL|member|offset
name|double
name|offset
decl_stmt|;
DECL|member|blend_mode
name|BlendMode
name|blend_mode
decl_stmt|;
DECL|member|paint_mode
name|int
name|paint_mode
decl_stmt|;
DECL|member|gradient_type
name|GradientType
name|gradient_type
decl_stmt|;
DECL|member|repeat
name|RepeatMode
name|repeat
decl_stmt|;
DECL|member|repeat_mode_menu
name|GtkWidget
modifier|*
name|repeat_mode_menu
decl_stmt|;
DECL|member|supersample
name|int
name|supersample
decl_stmt|;
DECL|member|frame
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
DECL|member|max_depth
name|int
name|max_depth
decl_stmt|;
DECL|member|threshold
name|double
name|threshold
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|struct|__anon2aee260a0408
typedef|typedef
struct|struct
block|{
DECL|member|offset
name|double
name|offset
decl_stmt|;
DECL|member|sx
DECL|member|sy
name|double
name|sx
decl_stmt|,
name|sy
decl_stmt|;
DECL|member|blend_mode
name|BlendMode
name|blend_mode
decl_stmt|;
DECL|member|gradient_type
name|GradientType
name|gradient_type
decl_stmt|;
DECL|member|fg
DECL|member|bg
name|color_t
name|fg
decl_stmt|,
name|bg
decl_stmt|;
DECL|member|dist
name|double
name|dist
decl_stmt|;
DECL|member|vec
name|double
name|vec
index|[
literal|2
index|]
decl_stmt|;
DECL|member|repeat_func
name|RepeatFunc
name|repeat_func
decl_stmt|;
DECL|typedef|RenderBlendData
block|}
name|RenderBlendData
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon2aee260a0508
typedef|typedef
struct|struct
block|{
DECL|member|PR
name|PixelRegion
modifier|*
name|PR
decl_stmt|;
DECL|member|row_data
name|unsigned
name|char
modifier|*
name|row_data
decl_stmt|;
DECL|member|bytes
name|int
name|bytes
decl_stmt|;
DECL|member|width
name|int
name|width
decl_stmt|;
DECL|typedef|PutPixelData
block|}
name|PutPixelData
typedef|;
end_typedef

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|blend_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
parameter_list|,
name|double
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_type_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|blend_mode_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|paint_mode_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|repeat_type_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|supersample_toggle_update
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|max_depth_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
parameter_list|,
name|int
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|threshold_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
parameter_list|,
name|double
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|blend_button_press
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|blend_button_release
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|blend_motion
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventMotion
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|blend_cursor_update
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventMotion
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|blend_control
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|int
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|blend
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|BlendMode
name|blend_mode
parameter_list|,
name|int
name|paint_mode
parameter_list|,
name|GradientType
name|gradient_type
parameter_list|,
name|double
name|opacity
parameter_list|,
name|double
name|offset
parameter_list|,
name|RepeatMode
name|repeat
parameter_list|,
name|int
name|supersample
parameter_list|,
name|int
name|max_depth
parameter_list|,
name|double
name|threshold
parameter_list|,
name|double
name|startx
parameter_list|,
name|double
name|starty
parameter_list|,
name|double
name|endx
parameter_list|,
name|double
name|endy
parameter_list|,
name|progress_func_t
name|progress_callback
parameter_list|,
name|void
modifier|*
name|progress_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_conical_sym_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|axis
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_conical_asym_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|axis
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_square_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_radial_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_linear_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|vec
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_bilinear_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|vec
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_spiral_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|axis
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|,
name|gint
name|cwise
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_shapeburst_angular_factor
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_shapeburst_spherical_factor
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_calc_shapeburst_dimpled_factor
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_repeat_none
parameter_list|(
name|double
name|val
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_repeat_sawtooth
parameter_list|(
name|double
name|val
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|gradient_repeat_triangular
parameter_list|(
name|double
name|val
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_precalc_shapeburst
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|PixelRegion
modifier|*
name|PR
parameter_list|,
name|double
name|dist
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_render_pixel
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|,
name|color_t
modifier|*
name|color
parameter_list|,
name|void
modifier|*
name|render_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_put_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|color_t
name|color
parameter_list|,
name|void
modifier|*
name|put_pixel_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gradient_fill_region
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|PixelRegion
modifier|*
name|PR
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|BlendMode
name|blend_mode
parameter_list|,
name|GradientType
name|gradient_type
parameter_list|,
name|double
name|offset
parameter_list|,
name|RepeatMode
name|repeat
parameter_list|,
name|int
name|supersample
parameter_list|,
name|int
name|max_depth
parameter_list|,
name|double
name|threshold
parameter_list|,
name|double
name|sx
parameter_list|,
name|double
name|sy
parameter_list|,
name|double
name|ex
parameter_list|,
name|double
name|ey
parameter_list|,
name|progress_func_t
name|progress_callback
parameter_list|,
name|void
modifier|*
name|progress_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_rgb_to_hsv
parameter_list|(
name|double
modifier|*
name|r
parameter_list|,
name|double
modifier|*
name|g
parameter_list|,
name|double
modifier|*
name|b
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_hsv_to_rgb
parameter_list|(
name|double
modifier|*
name|h
parameter_list|,
name|double
modifier|*
name|s
parameter_list|,
name|double
modifier|*
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|BlendOptions
modifier|*
name|create_blend_options
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|blend_invoker
parameter_list|(
name|Argument
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  variables for the shapeburst algs  */
end_comment

begin_decl_stmt
DECL|variable|distR
specifier|static
name|PixelRegion
name|distR
init|=
block|{
name|NULL
block|,
comment|/* data */
name|NULL
block|,
comment|/* tiles */
literal|0
block|,
comment|/* rowstride */
literal|0
block|,
literal|0
block|,
comment|/* w, h */
literal|0
block|,
literal|0
block|,
comment|/* x, y */
literal|4
block|,
comment|/* bytes */
literal|0
comment|/* process count */
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  the blend option menu items -- the blend modes  */
end_comment

begin_decl_stmt
DECL|variable|blend_option_items
specifier|static
name|MenuItem
name|blend_option_items
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"FG to BG RGB"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|blend_mode_callback
block|,
operator|(
name|gpointer
operator|)
name|FG_BG_RGB_MODE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"FG to BG HSV"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|blend_mode_callback
block|,
operator|(
name|gpointer
operator|)
name|FG_BG_HSV_MODE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"FG to Transparent"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|blend_mode_callback
block|,
operator|(
name|gpointer
operator|)
name|FG_TRANS_MODE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Custom from editor"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|blend_mode_callback
block|,
operator|(
name|gpointer
operator|)
name|CUSTOM_MODE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  the gradient option menu items -- the gradient modes  */
end_comment

begin_decl_stmt
DECL|variable|gradient_option_items
specifier|static
name|MenuItem
name|gradient_option_items
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"Linear"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|Linear
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Bi-Linear"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|BiLinear
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Radial"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|Radial
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Square"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|Square
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Conical (symmetric)"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|ConicalSymmetric
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Conical (asymmetric)"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|ConicalAsymmetric
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Shapeburst (angular)"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|ShapeburstAngular
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Shapeburst (spherical)"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|ShapeburstSpherical
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Shapeburst (dimpled)"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|ShapeburstDimpled
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Spiral (clockwise)"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|SpiralClockwise
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Spiral (anticlockwise)"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|gradient_type_callback
block|,
operator|(
name|gpointer
operator|)
name|SpiralAntiClockwise
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  blend options  */
end_comment

begin_decl_stmt
DECL|variable|blend_options
specifier|static
name|BlendOptions
modifier|*
name|blend_options
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* repeat menu items */
end_comment

begin_decl_stmt
DECL|variable|repeat_option_items
specifier|static
name|MenuItem
name|repeat_option_items
index|[]
init|=
block|{
block|{
name|N_
argument_list|(
literal|"None"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|repeat_type_callback
block|,
operator|(
name|gpointer
operator|)
name|REPEAT_NONE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Sawtooth wave"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|repeat_type_callback
block|,
operator|(
name|gpointer
operator|)
name|REPEAT_SAWTOOTH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|N_
argument_list|(
literal|"Triangular wave"
argument_list|)
block|,
literal|0
block|,
literal|0
block|,
name|repeat_type_callback
block|,
operator|(
name|gpointer
operator|)
name|REPEAT_TRIANGULAR
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|blend_scale_update (GtkAdjustment * adjustment,double * scale_val)
name|blend_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|double
modifier|*
name|scale_val
parameter_list|)
block|{
operator|*
name|scale_val
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_type_callback (GtkWidget * w,gpointer client_data)
name|gradient_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|blend_options
operator|->
name|gradient_type
operator|=
operator|(
name|GradientType
operator|)
name|client_data
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|blend_options
operator|->
name|repeat_mode_menu
argument_list|,
operator|(
name|blend_options
operator|->
name|gradient_type
operator|<
literal|6
operator|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|blend_mode_callback (GtkWidget * w,gpointer client_data)
name|blend_mode_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|blend_options
operator|->
name|blend_mode
operator|=
operator|(
name|BlendMode
operator|)
name|client_data
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|paint_mode_callback (GtkWidget * w,gpointer client_data)
name|paint_mode_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|blend_options
operator|->
name|paint_mode
operator|=
operator|(
name|long
operator|)
name|client_data
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|repeat_type_callback (GtkWidget * widget,gpointer client_data)
name|repeat_type_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|blend_options
operator|->
name|repeat
operator|=
operator|(
name|RepeatMode
operator|)
name|client_data
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|supersample_toggle_update (GtkWidget * widget,gpointer client_data)
name|supersample_toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|blend_options
operator|->
name|supersample
operator|=
name|TRUE
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|blend_options
operator|->
name|frame
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|blend_options
operator|->
name|supersample
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|blend_options
operator|->
name|frame
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|max_depth_scale_update (GtkAdjustment * adjustment,int * scale_val)
name|max_depth_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|int
modifier|*
name|scale_val
parameter_list|)
block|{
operator|*
name|scale_val
operator|=
operator|(
name|int
operator|)
name|adjustment
operator|->
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|threshold_scale_update (GtkAdjustment * adjustment,double * scale_val)
name|threshold_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|double
modifier|*
name|scale_val
parameter_list|)
block|{
operator|*
name|scale_val
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|BlendOptions
modifier|*
DECL|function|create_blend_options ()
name|create_blend_options
parameter_list|()
block|{
name|BlendOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|bm_option_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|bm_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|pm_option_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|pm_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|gt_option_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|gt_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|rt_option_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|rt_menu
decl_stmt|;
name|GtkWidget
modifier|*
name|opacity_scale
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|offset_scale
decl_stmt|;
name|GtkObject
modifier|*
name|opacity_scale_data
decl_stmt|;
name|GtkObject
modifier|*
name|offset_scale_data
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkObject
modifier|*
name|depth_scale_data
decl_stmt|;
name|GtkWidget
modifier|*
name|depth_scale
decl_stmt|;
name|GtkObject
modifier|*
name|threshold_scale_data
decl_stmt|;
name|GtkWidget
modifier|*
name|threshold_scale
decl_stmt|;
comment|/*  the new options structure  */
name|options
operator|=
operator|(
name|BlendOptions
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|BlendOptions
argument_list|)
argument_list|)
expr_stmt|;
name|options
operator|->
name|opacity
operator|=
literal|100.0
expr_stmt|;
name|options
operator|->
name|offset
operator|=
literal|0.0
expr_stmt|;
name|options
operator|->
name|blend_mode
operator|=
name|FG_BG_RGB_MODE
expr_stmt|;
name|options
operator|->
name|paint_mode
operator|=
name|NORMAL
expr_stmt|;
name|options
operator|->
name|gradient_type
operator|=
name|Linear
expr_stmt|;
name|options
operator|->
name|repeat
operator|=
name|REPEAT_NONE
expr_stmt|;
name|options
operator|->
name|supersample
operator|=
name|FALSE
expr_stmt|;
name|options
operator|->
name|max_depth
operator|=
literal|3
expr_stmt|;
name|options
operator|->
name|threshold
operator|=
literal|0.2
expr_stmt|;
comment|/*  the main vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/*  the main label  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Blend Options"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/*  the table  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  the opacity scale  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Opacity:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|opacity_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|100.0
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|opacity_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|opacity_scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|opacity_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|opacity_scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|blend_scale_update
argument_list|,
operator|&
name|options
operator|->
name|opacity
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|opacity_scale
argument_list|)
expr_stmt|;
comment|/*  the offset scale  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Offset:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|offset_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|offset_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|offset_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|offset_scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|offset_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|offset_scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|offset_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|blend_scale_update
argument_list|,
operator|&
name|options
operator|->
name|offset
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|offset_scale
argument_list|)
expr_stmt|;
comment|/*  the paint mode menu  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Mode:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|pm_menu
operator|=
name|create_paint_mode_menu
argument_list|(
name|paint_mode_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|pm_option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|pm_option_menu
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|pm_option_menu
argument_list|)
expr_stmt|;
comment|/*  the blend mode menu  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Blend:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|bm_menu
operator|=
name|build_menu
argument_list|(
name|blend_option_items
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|bm_option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|bm_option_menu
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|bm_option_menu
argument_list|)
expr_stmt|;
comment|/*  the gradient type menu  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Gradient:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gt_menu
operator|=
name|build_menu
argument_list|(
name|gradient_option_items
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gt_option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|gt_option_menu
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|4
argument_list|,
literal|5
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gt_option_menu
argument_list|)
expr_stmt|;
comment|/* the repeat option */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Repeat:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|rt_menu
operator|=
name|build_menu
argument_list|(
name|repeat_option_items
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|rt_option_menu
operator|=
name|gtk_option_menu_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|rt_option_menu
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|rt_option_menu
argument_list|)
expr_stmt|;
name|options
operator|->
name|repeat_mode_menu
operator|=
name|rt_option_menu
expr_stmt|;
comment|/* show the whole table */
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/* supersampling toggle */
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Adaptive supersampling"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|supersample_toggle_update
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* frame for supersampling options */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* table for supersamplign options */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
comment|/* max depth scale */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Max depth:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|depth_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|3.0
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|depth_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|depth_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|depth_scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|depth_scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|depth_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|depth_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|max_depth_scale_update
argument_list|,
operator|&
name|options
operator|->
name|max_depth
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|depth_scale
argument_list|)
expr_stmt|;
comment|/* threshold scale */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Threshold:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|threshold_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0.2
argument_list|,
literal|0.0
argument_list|,
literal|4.0
argument_list|,
literal|0.01
argument_list|,
literal|0.01
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|threshold_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|threshold_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|threshold_scale
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|threshold_scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|threshold_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|threshold_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|threshold_scale_update
argument_list|,
operator|&
name|options
operator|->
name|threshold
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|threshold_scale
argument_list|)
expr_stmt|;
comment|/* show table */
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/* show frame */
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|frame
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|options
operator|->
name|frame
operator|=
name|frame
expr_stmt|;
comment|/*  Register this selection options widget with the main tools options dialog  */
name|tools_register_options
argument_list|(
name|BLEND
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
comment|/*  Post initialization  */
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|bm_option_menu
argument_list|)
argument_list|,
name|bm_menu
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|gt_option_menu
argument_list|)
argument_list|,
name|gt_menu
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|pm_option_menu
argument_list|)
argument_list|,
name|pm_menu
argument_list|)
expr_stmt|;
name|gtk_option_menu_set_menu
argument_list|(
name|GTK_OPTION_MENU
argument_list|(
name|rt_option_menu
argument_list|)
argument_list|,
name|rt_menu
argument_list|)
expr_stmt|;
return|return
name|options
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|blend_button_press (Tool * tool,GdkEventButton * bevent,gpointer gdisp_ptr)
name|blend_button_press
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|BlendTool
modifier|*
name|blend_tool
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|blend_tool
operator|=
operator|(
name|BlendTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
switch|switch
condition|(
name|drawable_type
argument_list|(
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|)
condition|)
block|{
case|case
name|INDEXED_GIMAGE
case|:
case|case
name|INDEXEDA_GIMAGE
case|:
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Blend: Invalid for indexed images."
argument_list|)
argument_list|)
expr_stmt|;
return|return;
break|break;
default|default:
break|break;
block|}
comment|/*  Keep the coordinates of the target  */
name|gdisplay_untransform_coords
argument_list|(
name|gdisp
argument_list|,
name|bevent
operator|->
name|x
argument_list|,
name|bevent
operator|->
name|y
argument_list|,
operator|&
name|blend_tool
operator|->
name|startx
argument_list|,
operator|&
name|blend_tool
operator|->
name|starty
argument_list|,
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|blend_tool
operator|->
name|endx
operator|=
name|blend_tool
operator|->
name|startx
expr_stmt|;
name|blend_tool
operator|->
name|endy
operator|=
name|blend_tool
operator|->
name|starty
expr_stmt|;
comment|/*  Make the tool active and set the gdisplay which owns it  */
name|gdk_pointer_grab
argument_list|(
name|gdisp
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|FALSE
argument_list|,
name|GDK_POINTER_MOTION_HINT_MASK
operator||
name|GDK_BUTTON1_MOTION_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
name|tool
operator|->
name|gdisp_ptr
operator|=
name|gdisp_ptr
expr_stmt|;
name|tool
operator|->
name|state
operator|=
name|ACTIVE
expr_stmt|;
comment|/* initialize the statusbar display */
name|blend_tool
operator|->
name|context_id
operator|=
name|gtk_statusbar_get_context_id
argument_list|(
name|GTK_STATUSBAR
argument_list|(
name|gdisp
operator|->
name|statusbar
argument_list|)
argument_list|,
literal|"blend"
argument_list|)
expr_stmt|;
name|gtk_statusbar_push
argument_list|(
name|GTK_STATUSBAR
argument_list|(
name|gdisp
operator|->
name|statusbar
argument_list|)
argument_list|,
name|blend_tool
operator|->
name|context_id
argument_list|,
name|_
argument_list|(
literal|"Blend: 0, 0"
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Start drawing the blend tool  */
name|draw_core_start
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|gdisp
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|blend_button_release (Tool * tool,GdkEventButton * bevent,gpointer gdisp_ptr)
name|blend_button_release
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|BlendTool
modifier|*
name|blend_tool
decl_stmt|;
ifdef|#
directive|ifdef
name|BLEND_UI_CALLS_VIA_PDB
name|Argument
modifier|*
name|return_vals
decl_stmt|;
name|int
name|nreturn_vals
decl_stmt|;
else|#
directive|else
name|gimp_progress
modifier|*
name|progress
decl_stmt|;
endif|#
directive|endif
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|gimage
operator|=
name|gdisp
operator|->
name|gimage
expr_stmt|;
name|blend_tool
operator|=
operator|(
name|BlendTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
name|gdk_pointer_ungrab
argument_list|(
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
name|gtk_statusbar_pop
argument_list|(
name|GTK_STATUSBAR
argument_list|(
name|gdisp
operator|->
name|statusbar
argument_list|)
argument_list|,
name|blend_tool
operator|->
name|context_id
argument_list|)
expr_stmt|;
name|draw_core_stop
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
name|tool
operator|->
name|state
operator|=
name|INACTIVE
expr_stmt|;
comment|/*  if the 3rd button isn't pressed, fill the selected region  */
if|if
condition|(
operator|!
operator|(
name|bevent
operator|->
name|state
operator|&
name|GDK_BUTTON3_MASK
operator|)
operator|&&
operator|(
operator|(
name|blend_tool
operator|->
name|startx
operator|!=
name|blend_tool
operator|->
name|endx
operator|)
operator|||
operator|(
name|blend_tool
operator|->
name|starty
operator|!=
name|blend_tool
operator|->
name|endy
operator|)
operator|)
condition|)
block|{
comment|/* we can't do callbacks easily with the PDB, so this UI/backend        * separation (though good) is ignored for the moment */
ifdef|#
directive|ifdef
name|BLEND_UI_CALLS_VIA_PDB
name|return_vals
operator|=
name|procedural_db_run_proc
argument_list|(
literal|"gimp_blend"
argument_list|,
operator|&
name|nreturn_vals
argument_list|,
name|PDB_DRAWABLE
argument_list|,
name|drawable_ID
argument_list|(
name|gimage_active_drawable
argument_list|(
name|gimage
argument_list|)
argument_list|)
argument_list|,
name|PDB_INT32
argument_list|,
operator|(
name|gint32
operator|)
name|blend_options
operator|->
name|blend_mode
argument_list|,
name|PDB_INT32
argument_list|,
operator|(
name|gint32
operator|)
name|blend_options
operator|->
name|paint_mode
argument_list|,
name|PDB_INT32
argument_list|,
operator|(
name|gint32
operator|)
name|blend_options
operator|->
name|gradient_type
argument_list|,
name|PDB_FLOAT
argument_list|,
operator|(
name|gdouble
operator|)
name|blend_options
operator|->
name|opacity
argument_list|,
name|PDB_FLOAT
argument_list|,
operator|(
name|gdouble
operator|)
name|blend_options
operator|->
name|offset
argument_list|,
name|PDB_INT32
argument_list|,
operator|(
name|gint32
operator|)
name|blend_options
operator|->
name|repeat
argument_list|,
name|PDB_INT32
argument_list|,
operator|(
name|gint32
operator|)
name|blend_options
operator|->
name|supersample
argument_list|,
name|PDB_INT32
argument_list|,
operator|(
name|gint32
operator|)
name|blend_options
operator|->
name|max_depth
argument_list|,
name|PDB_FLOAT
argument_list|,
operator|(
name|gdouble
operator|)
name|blend_options
operator|->
name|threshold
argument_list|,
name|PDB_FLOAT
argument_list|,
operator|(
name|gdouble
operator|)
name|blend_tool
operator|->
name|startx
argument_list|,
name|PDB_FLOAT
argument_list|,
operator|(
name|gdouble
operator|)
name|blend_tool
operator|->
name|starty
argument_list|,
name|PDB_FLOAT
argument_list|,
operator|(
name|gdouble
operator|)
name|blend_tool
operator|->
name|endx
argument_list|,
name|PDB_FLOAT
argument_list|,
operator|(
name|gdouble
operator|)
name|blend_tool
operator|->
name|endy
argument_list|,
name|PDB_END
argument_list|)
expr_stmt|;
if|if
condition|(
name|return_vals
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|==
name|PDB_SUCCESS
condition|)
name|gdisplays_flush
argument_list|()
expr_stmt|;
else|else
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Blend operation failed."
argument_list|)
argument_list|)
expr_stmt|;
name|procedural_db_destroy_args
argument_list|(
name|return_vals
argument_list|,
name|nreturn_vals
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* ! BLEND_UI_CALLS_VIA_PDB */
name|progress
operator|=
name|progress_start
argument_list|(
name|gdisp
argument_list|,
name|_
argument_list|(
literal|"Blending..."
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|blend
argument_list|(
name|gimage
argument_list|,
name|gimage_active_drawable
argument_list|(
name|gimage
argument_list|)
argument_list|,
name|blend_options
operator|->
name|blend_mode
argument_list|,
name|blend_options
operator|->
name|paint_mode
argument_list|,
name|blend_options
operator|->
name|gradient_type
argument_list|,
name|blend_options
operator|->
name|opacity
argument_list|,
name|blend_options
operator|->
name|offset
argument_list|,
name|blend_options
operator|->
name|repeat
argument_list|,
name|blend_options
operator|->
name|supersample
argument_list|,
name|blend_options
operator|->
name|max_depth
argument_list|,
name|blend_options
operator|->
name|threshold
argument_list|,
name|blend_tool
operator|->
name|startx
argument_list|,
name|blend_tool
operator|->
name|starty
argument_list|,
name|blend_tool
operator|->
name|endx
argument_list|,
name|blend_tool
operator|->
name|endy
argument_list|,
name|progress
condition|?
name|progress_update_and_flush
else|:
name|NULL
argument_list|,
name|progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|progress
condition|)
name|progress_end
argument_list|(
name|progress
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
endif|#
directive|endif
comment|/* ! BLEND_UI_CALLS_VIA_PDB */
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|blend_motion (Tool * tool,GdkEventMotion * mevent,gpointer gdisp_ptr)
name|blend_motion
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventMotion
modifier|*
name|mevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|BlendTool
modifier|*
name|blend_tool
decl_stmt|;
name|gchar
name|vector
index|[
name|STATUSBAR_SIZE
index|]
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|blend_tool
operator|=
operator|(
name|BlendTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
comment|/*  undraw the current tool  */
name|draw_core_pause
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
comment|/*  Get the current coordinates  */
name|gdisplay_untransform_coords
argument_list|(
name|gdisp
argument_list|,
name|mevent
operator|->
name|x
argument_list|,
name|mevent
operator|->
name|y
argument_list|,
operator|&
name|blend_tool
operator|->
name|endx
argument_list|,
operator|&
name|blend_tool
operator|->
name|endy
argument_list|,
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_statusbar_pop
argument_list|(
name|GTK_STATUSBAR
argument_list|(
name|gdisp
operator|->
name|statusbar
argument_list|)
argument_list|,
name|blend_tool
operator|->
name|context_id
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|vector
argument_list|,
name|STATUSBAR_SIZE
argument_list|,
name|_
argument_list|(
literal|"Blend: %d, %d"
argument_list|)
argument_list|,
name|abs
argument_list|(
name|blend_tool
operator|->
name|endx
operator|-
name|blend_tool
operator|->
name|startx
argument_list|)
argument_list|,
name|abs
argument_list|(
name|blend_tool
operator|->
name|endy
operator|-
name|blend_tool
operator|->
name|starty
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_statusbar_push
argument_list|(
name|GTK_STATUSBAR
argument_list|(
name|gdisp
operator|->
name|statusbar
argument_list|)
argument_list|,
name|blend_tool
operator|->
name|context_id
argument_list|,
name|vector
argument_list|)
expr_stmt|;
comment|/*  redraw the current tool  */
name|draw_core_resume
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|blend_cursor_update (Tool * tool,GdkEventMotion * mevent,gpointer gdisp_ptr)
name|blend_cursor_update
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventMotion
modifier|*
name|mevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
switch|switch
condition|(
name|drawable_type
argument_list|(
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|)
condition|)
block|{
case|case
name|INDEXED_GIMAGE
case|:
case|case
name|INDEXEDA_GIMAGE
case|:
name|gdisplay_install_tool_cursor
argument_list|(
name|gdisp
argument_list|,
name|GDK_TOP_LEFT_ARROW
argument_list|)
expr_stmt|;
break|break;
default|default:
name|gdisplay_install_tool_cursor
argument_list|(
name|gdisp
argument_list|,
name|GDK_TCROSS
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|blend_draw (Tool * tool)
name|blend_draw
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|BlendTool
modifier|*
name|blend_tool
decl_stmt|;
name|int
name|tx1
decl_stmt|,
name|ty1
decl_stmt|,
name|tx2
decl_stmt|,
name|ty2
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|tool
operator|->
name|gdisp_ptr
expr_stmt|;
name|blend_tool
operator|=
operator|(
name|BlendTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
name|gdisplay_transform_coords
argument_list|(
name|gdisp
argument_list|,
name|blend_tool
operator|->
name|startx
argument_list|,
name|blend_tool
operator|->
name|starty
argument_list|,
operator|&
name|tx1
argument_list|,
operator|&
name|ty1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gdisplay_transform_coords
argument_list|(
name|gdisp
argument_list|,
name|blend_tool
operator|->
name|endx
argument_list|,
name|blend_tool
operator|->
name|endy
argument_list|,
operator|&
name|tx2
argument_list|,
operator|&
name|ty2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*  Draw start target  */
name|gdk_draw_line
argument_list|(
name|blend_tool
operator|->
name|core
operator|->
name|win
argument_list|,
name|blend_tool
operator|->
name|core
operator|->
name|gc
argument_list|,
name|tx1
operator|-
operator|(
name|TARGET_WIDTH
operator|>>
literal|1
operator|)
argument_list|,
name|ty1
argument_list|,
name|tx1
operator|+
operator|(
name|TARGET_WIDTH
operator|>>
literal|1
operator|)
argument_list|,
name|ty1
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|blend_tool
operator|->
name|core
operator|->
name|win
argument_list|,
name|blend_tool
operator|->
name|core
operator|->
name|gc
argument_list|,
name|tx1
argument_list|,
name|ty1
operator|-
operator|(
name|TARGET_HEIGHT
operator|>>
literal|1
operator|)
argument_list|,
name|tx1
argument_list|,
name|ty1
operator|+
operator|(
name|TARGET_HEIGHT
operator|>>
literal|1
operator|)
argument_list|)
expr_stmt|;
comment|/*  Draw end target  */
name|gdk_draw_line
argument_list|(
name|blend_tool
operator|->
name|core
operator|->
name|win
argument_list|,
name|blend_tool
operator|->
name|core
operator|->
name|gc
argument_list|,
name|tx2
operator|-
operator|(
name|TARGET_WIDTH
operator|>>
literal|1
operator|)
argument_list|,
name|ty2
argument_list|,
name|tx2
operator|+
operator|(
name|TARGET_WIDTH
operator|>>
literal|1
operator|)
argument_list|,
name|ty2
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|blend_tool
operator|->
name|core
operator|->
name|win
argument_list|,
name|blend_tool
operator|->
name|core
operator|->
name|gc
argument_list|,
name|tx2
argument_list|,
name|ty2
operator|-
operator|(
name|TARGET_HEIGHT
operator|>>
literal|1
operator|)
argument_list|,
name|tx2
argument_list|,
name|ty2
operator|+
operator|(
name|TARGET_HEIGHT
operator|>>
literal|1
operator|)
argument_list|)
expr_stmt|;
comment|/*  Draw the line between the start and end coords  */
name|gdk_draw_line
argument_list|(
name|blend_tool
operator|->
name|core
operator|->
name|win
argument_list|,
name|blend_tool
operator|->
name|core
operator|->
name|gc
argument_list|,
name|tx1
argument_list|,
name|ty1
argument_list|,
name|tx2
argument_list|,
name|ty2
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|blend_control (Tool * tool,int action,gpointer gdisp_ptr)
name|blend_control
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|int
name|action
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|BlendTool
modifier|*
name|blend_tool
decl_stmt|;
name|blend_tool
operator|=
operator|(
name|BlendTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
switch|switch
condition|(
name|action
condition|)
block|{
case|case
name|PAUSE
case|:
name|draw_core_pause
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
break|break;
case|case
name|RESUME
case|:
name|draw_core_resume
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
break|break;
case|case
name|HALT
case|:
name|draw_core_stop
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_comment
comment|/*  The actual blending procedure  */
end_comment

begin_function
specifier|static
name|void
DECL|function|blend (GImage * gimage,GimpDrawable * drawable,BlendMode blend_mode,int paint_mode,GradientType gradient_type,double opacity,double offset,RepeatMode repeat,int supersample,int max_depth,double threshold,double startx,double starty,double endx,double endy,progress_func_t progress_callback,void * progress_data)
name|blend
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|BlendMode
name|blend_mode
parameter_list|,
name|int
name|paint_mode
parameter_list|,
name|GradientType
name|gradient_type
parameter_list|,
name|double
name|opacity
parameter_list|,
name|double
name|offset
parameter_list|,
name|RepeatMode
name|repeat
parameter_list|,
name|int
name|supersample
parameter_list|,
name|int
name|max_depth
parameter_list|,
name|double
name|threshold
parameter_list|,
name|double
name|startx
parameter_list|,
name|double
name|starty
parameter_list|,
name|double
name|endx
parameter_list|,
name|double
name|endy
parameter_list|,
name|progress_func_t
name|progress_callback
parameter_list|,
name|void
modifier|*
name|progress_data
parameter_list|)
block|{
name|TileManager
modifier|*
name|buf_tiles
decl_stmt|;
name|PixelRegion
name|bufPR
decl_stmt|;
name|int
name|has_alpha
decl_stmt|;
name|int
name|has_selection
decl_stmt|;
name|int
name|bytes
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|gimp_add_busy_cursors
argument_list|()
expr_stmt|;
name|has_selection
operator|=
name|drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|has_alpha
operator|=
name|drawable_has_alpha
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|bytes
operator|=
name|drawable_bytes
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
comment|/*  Always create an alpha temp buf (for generality) */
if|if
condition|(
operator|!
name|has_alpha
condition|)
block|{
name|has_alpha
operator|=
name|TRUE
expr_stmt|;
name|bytes
operator|+=
literal|1
expr_stmt|;
block|}
name|buf_tiles
operator|=
name|tile_manager_new
argument_list|(
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|bufPR
argument_list|,
name|buf_tiles
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gradient_fill_region
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
operator|&
name|bufPR
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|blend_mode
argument_list|,
name|gradient_type
argument_list|,
name|offset
argument_list|,
name|repeat
argument_list|,
name|supersample
argument_list|,
name|max_depth
argument_list|,
name|threshold
argument_list|,
operator|(
name|startx
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|starty
operator|-
name|y1
operator|)
argument_list|,
operator|(
name|endx
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|endy
operator|-
name|y1
operator|)
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|bufPR
argument_list|,
name|buf_tiles
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimage_apply_image
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
operator|&
name|bufPR
argument_list|,
name|TRUE
argument_list|,
operator|(
name|opacity
operator|*
literal|255
operator|)
operator|/
literal|100
argument_list|,
name|paint_mode
argument_list|,
name|NULL
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
comment|/*  update the image  */
name|drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
comment|/*  free the temporary buffer  */
name|tile_manager_destroy
argument_list|(
name|buf_tiles
argument_list|)
expr_stmt|;
name|gimp_remove_busy_cursors
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|double
DECL|function|gradient_calc_conical_sym_factor (double dist,double * axis,double offset,double x,double y)
name|gradient_calc_conical_sym_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|axis
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|double
name|vec
index|[
literal|2
index|]
decl_stmt|;
name|double
name|r
decl_stmt|;
name|double
name|rat
decl_stmt|;
if|if
condition|(
name|dist
operator|==
literal|0.0
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|x
operator|!=
literal|0
operator|)
operator|||
operator|(
name|y
operator|!=
literal|0
operator|)
condition|)
block|{
comment|/* Calculate offset from the start in pixels */
name|r
operator|=
name|sqrt
argument_list|(
name|x
operator|*
name|x
operator|+
name|y
operator|*
name|y
argument_list|)
expr_stmt|;
name|vec
index|[
literal|0
index|]
operator|=
name|x
operator|/
name|r
expr_stmt|;
name|vec
index|[
literal|1
index|]
operator|=
name|y
operator|/
name|r
expr_stmt|;
name|rat
operator|=
name|axis
index|[
literal|0
index|]
operator|*
name|vec
index|[
literal|0
index|]
operator|+
name|axis
index|[
literal|1
index|]
operator|*
name|vec
index|[
literal|1
index|]
expr_stmt|;
comment|/* Dot product */
if|if
condition|(
name|rat
operator|>
literal|1.0
condition|)
name|rat
operator|=
literal|1.0
expr_stmt|;
elseif|else
if|if
condition|(
name|rat
operator|<
operator|-
literal|1.0
condition|)
name|rat
operator|=
operator|-
literal|1.0
expr_stmt|;
comment|/* This cool idea is courtesy Josh MacDonald, 	 * Ali Rahimi --- two more XCF losers.  */
name|rat
operator|=
name|acos
argument_list|(
name|rat
argument_list|)
operator|/
name|M_PI
expr_stmt|;
name|rat
operator|=
name|pow
argument_list|(
name|rat
argument_list|,
operator|(
name|offset
operator|/
literal|10
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|rat
operator|=
name|BOUNDS
argument_list|(
name|rat
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
block|}
else|else
name|rat
operator|=
literal|0.5
expr_stmt|;
return|return
name|rat
return|;
block|}
end_function

begin_comment
comment|/* gradient_calc_conical_sym_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|gradient_calc_conical_asym_factor (double dist,double * axis,double offset,double x,double y)
name|gradient_calc_conical_asym_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|axis
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|double
name|ang0
decl_stmt|,
name|ang1
decl_stmt|;
name|double
name|ang
decl_stmt|;
name|double
name|rat
decl_stmt|;
if|if
condition|(
name|dist
operator|==
literal|0.0
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|(
name|x
operator|!=
literal|0
operator|)
operator|||
operator|(
name|y
operator|!=
literal|0
operator|)
condition|)
block|{
name|ang0
operator|=
name|atan2
argument_list|(
name|axis
index|[
literal|0
index|]
argument_list|,
name|axis
index|[
literal|1
index|]
argument_list|)
operator|+
name|M_PI
expr_stmt|;
name|ang1
operator|=
name|atan2
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
operator|+
name|M_PI
expr_stmt|;
name|ang
operator|=
name|ang1
operator|-
name|ang0
expr_stmt|;
if|if
condition|(
name|ang
operator|<
literal|0.0
condition|)
name|ang
operator|+=
operator|(
literal|2.0
operator|*
name|M_PI
operator|)
expr_stmt|;
name|rat
operator|=
name|ang
operator|/
operator|(
literal|2.0
operator|*
name|M_PI
operator|)
expr_stmt|;
name|rat
operator|=
name|pow
argument_list|(
name|rat
argument_list|,
operator|(
name|offset
operator|/
literal|10
operator|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|rat
operator|=
name|BOUNDS
argument_list|(
name|rat
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
block|}
else|else
name|rat
operator|=
literal|0.5
expr_stmt|;
comment|/* We are on middle point */
block|}
comment|/* else */
return|return
name|rat
return|;
block|}
end_function

begin_comment
comment|/* gradient_calc_conical_asym_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|gradient_calc_square_factor (double dist,double offset,double x,double y)
name|gradient_calc_square_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|double
name|r
decl_stmt|;
name|double
name|rat
decl_stmt|;
if|if
condition|(
name|dist
operator|==
literal|0.0
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
comment|/* Calculate offset from start as a value in [0, 1] */
name|offset
operator|=
name|offset
operator|/
literal|100.0
expr_stmt|;
name|r
operator|=
name|MAXIMUM
argument_list|(
name|abs
argument_list|(
name|x
argument_list|)
argument_list|,
name|abs
argument_list|(
name|y
argument_list|)
argument_list|)
expr_stmt|;
name|rat
operator|=
name|r
operator|/
name|dist
expr_stmt|;
if|if
condition|(
name|rat
operator|<
name|offset
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|offset
operator|==
literal|1
condition|)
name|rat
operator|=
operator|(
name|rat
operator|>=
literal|1
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
else|else
name|rat
operator|=
operator|(
name|rat
operator|-
name|offset
operator|)
operator|/
operator|(
literal|1.0
operator|-
name|offset
operator|)
expr_stmt|;
block|}
comment|/* else */
return|return
name|rat
return|;
block|}
end_function

begin_comment
comment|/* gradient_calc_square_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|gradient_calc_radial_factor (double dist,double offset,double x,double y)
name|gradient_calc_radial_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|double
name|r
decl_stmt|;
name|double
name|rat
decl_stmt|;
if|if
condition|(
name|dist
operator|==
literal|0.0
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
comment|/* Calculate radial offset from start as a value in [0, 1] */
name|offset
operator|=
name|offset
operator|/
literal|100.0
expr_stmt|;
name|r
operator|=
name|sqrt
argument_list|(
name|SQR
argument_list|(
name|x
argument_list|)
operator|+
name|SQR
argument_list|(
name|y
argument_list|)
argument_list|)
expr_stmt|;
name|rat
operator|=
name|r
operator|/
name|dist
expr_stmt|;
if|if
condition|(
name|rat
operator|<
name|offset
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|offset
operator|==
literal|1
condition|)
name|rat
operator|=
operator|(
name|rat
operator|>=
literal|1
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
else|else
name|rat
operator|=
operator|(
name|rat
operator|-
name|offset
operator|)
operator|/
operator|(
literal|1.0
operator|-
name|offset
operator|)
expr_stmt|;
block|}
comment|/* else */
return|return
name|rat
return|;
block|}
end_function

begin_comment
comment|/* gradient_calc_radial_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|gradient_calc_linear_factor (double dist,double * vec,double x,double y)
name|gradient_calc_linear_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|vec
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|double
name|r
decl_stmt|;
name|double
name|rat
decl_stmt|;
if|if
condition|(
name|dist
operator|==
literal|0.0
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
name|r
operator|=
name|vec
index|[
literal|0
index|]
operator|*
name|x
operator|+
name|vec
index|[
literal|1
index|]
operator|*
name|y
expr_stmt|;
name|rat
operator|=
name|r
operator|/
name|dist
expr_stmt|;
block|}
comment|/* else */
return|return
name|rat
return|;
block|}
end_function

begin_comment
comment|/* gradient_calc_linear_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|gradient_calc_bilinear_factor (double dist,double * vec,double offset,double x,double y)
name|gradient_calc_bilinear_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|vec
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|double
name|r
decl_stmt|;
name|double
name|rat
decl_stmt|;
if|if
condition|(
name|dist
operator|==
literal|0.0
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
comment|/* Calculate linear offset from the start line outward */
name|offset
operator|=
name|offset
operator|/
literal|100.0
expr_stmt|;
name|r
operator|=
name|vec
index|[
literal|0
index|]
operator|*
name|x
operator|+
name|vec
index|[
literal|1
index|]
operator|*
name|y
expr_stmt|;
name|rat
operator|=
name|r
operator|/
name|dist
expr_stmt|;
if|if
condition|(
name|fabs
argument_list|(
name|rat
argument_list|)
operator|<
name|offset
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|offset
operator|==
literal|1
condition|)
name|rat
operator|=
operator|(
name|rat
operator|>=
literal|1
operator|)
condition|?
literal|1
else|:
literal|0
expr_stmt|;
else|else
name|rat
operator|=
operator|(
name|fabs
argument_list|(
name|rat
argument_list|)
operator|-
name|offset
operator|)
operator|/
operator|(
literal|1.0
operator|-
name|offset
operator|)
expr_stmt|;
block|}
comment|/* else */
return|return
name|rat
return|;
block|}
end_function

begin_comment
comment|/* gradient_calc_bilinear_factor */
end_comment

begin_function
specifier|static
name|double
DECL|function|gradient_calc_spiral_factor (double dist,double * axis,double offset,double x,double y,gint cwise)
name|gradient_calc_spiral_factor
parameter_list|(
name|double
name|dist
parameter_list|,
name|double
modifier|*
name|axis
parameter_list|,
name|double
name|offset
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|,
name|gint
name|cwise
parameter_list|)
block|{
name|double
name|ang0
decl_stmt|,
name|ang1
decl_stmt|;
name|double
name|ang
decl_stmt|,
name|r
decl_stmt|;
name|double
name|rat
decl_stmt|;
if|if
condition|(
name|dist
operator|==
literal|0.0
condition|)
name|rat
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
if|if
condition|(
name|x
operator|!=
literal|0.0
operator|||
name|y
operator|!=
literal|0.0
condition|)
block|{
name|ang0
operator|=
name|atan2
argument_list|(
name|axis
index|[
literal|0
index|]
argument_list|,
name|axis
index|[
literal|1
index|]
argument_list|)
operator|+
name|M_PI
expr_stmt|;
name|ang1
operator|=
name|atan2
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
operator|+
name|M_PI
expr_stmt|;
if|if
condition|(
operator|!
name|cwise
condition|)
name|ang
operator|=
name|ang0
operator|-
name|ang1
expr_stmt|;
else|else
name|ang
operator|=
name|ang1
operator|-
name|ang0
expr_stmt|;
if|if
condition|(
name|ang
operator|<
literal|0.0
condition|)
name|ang
operator|+=
operator|(
literal|2.0
operator|*
name|M_PI
operator|)
expr_stmt|;
name|r
operator|=
name|sqrt
argument_list|(
name|x
operator|*
name|x
operator|+
name|y
operator|*
name|y
argument_list|)
operator|/
name|dist
expr_stmt|;
name|rat
operator|=
name|ang
operator|/
operator|(
literal|2.0
operator|*
name|M_PI
operator|)
operator|+
name|r
operator|+
name|offset
expr_stmt|;
name|rat
operator|=
name|fmod
argument_list|(
name|rat
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
block|}
else|else
name|rat
operator|=
literal|0.5
expr_stmt|;
comment|/* We are on the middle point */
block|}
return|return
name|rat
return|;
block|}
end_function

begin_function
specifier|static
name|double
DECL|function|gradient_calc_shapeburst_angular_factor (double x,double y)
name|gradient_calc_shapeburst_angular_factor
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|int
name|ix
decl_stmt|,
name|iy
decl_stmt|;
name|Tile
modifier|*
name|tile
decl_stmt|;
name|float
name|value
decl_stmt|;
name|ix
operator|=
operator|(
name|int
operator|)
name|BOUNDS
argument_list|(
name|x
argument_list|,
literal|0
argument_list|,
name|distR
operator|.
name|w
argument_list|)
expr_stmt|;
name|iy
operator|=
operator|(
name|int
operator|)
name|BOUNDS
argument_list|(
name|y
argument_list|,
literal|0
argument_list|,
name|distR
operator|.
name|h
argument_list|)
expr_stmt|;
name|tile
operator|=
name|tile_manager_get_tile
argument_list|(
name|distR
operator|.
name|tiles
argument_list|,
name|ix
argument_list|,
name|iy
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|value
operator|=
literal|1.0
operator|-
operator|*
operator|(
operator|(
name|float
operator|*
operator|)
name|tile_data_pointer
argument_list|(
name|tile
argument_list|,
name|ix
operator|%
name|TILE_WIDTH
argument_list|,
name|iy
operator|%
name|TILE_HEIGHT
argument_list|)
operator|)
expr_stmt|;
name|tile_release
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|value
return|;
block|}
end_function

begin_function
specifier|static
name|double
DECL|function|gradient_calc_shapeburst_spherical_factor (double x,double y)
name|gradient_calc_shapeburst_spherical_factor
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|int
name|ix
decl_stmt|,
name|iy
decl_stmt|;
name|Tile
modifier|*
name|tile
decl_stmt|;
name|float
name|value
decl_stmt|;
name|ix
operator|=
operator|(
name|int
operator|)
name|BOUNDS
argument_list|(
name|x
argument_list|,
literal|0
argument_list|,
name|distR
operator|.
name|w
argument_list|)
expr_stmt|;
name|iy
operator|=
operator|(
name|int
operator|)
name|BOUNDS
argument_list|(
name|y
argument_list|,
literal|0
argument_list|,
name|distR
operator|.
name|h
argument_list|)
expr_stmt|;
name|tile
operator|=
name|tile_manager_get_tile
argument_list|(
name|distR
operator|.
name|tiles
argument_list|,
name|ix
argument_list|,
name|iy
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|value
operator|=
operator|*
operator|(
operator|(
name|float
operator|*
operator|)
name|tile_data_pointer
argument_list|(
name|tile
argument_list|,
name|ix
operator|%
name|TILE_WIDTH
argument_list|,
name|iy
operator|%
name|TILE_HEIGHT
argument_list|)
operator|)
expr_stmt|;
name|value
operator|=
literal|1.0
operator|-
name|sin
argument_list|(
literal|0.5
operator|*
name|M_PI
operator|*
name|value
argument_list|)
expr_stmt|;
name|tile_release
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|value
return|;
block|}
end_function

begin_function
specifier|static
name|double
DECL|function|gradient_calc_shapeburst_dimpled_factor (double x,double y)
name|gradient_calc_shapeburst_dimpled_factor
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
name|int
name|ix
decl_stmt|,
name|iy
decl_stmt|;
name|Tile
modifier|*
name|tile
decl_stmt|;
name|float
name|value
decl_stmt|;
name|ix
operator|=
operator|(
name|int
operator|)
name|BOUNDS
argument_list|(
name|x
argument_list|,
literal|0
argument_list|,
name|distR
operator|.
name|w
argument_list|)
expr_stmt|;
name|iy
operator|=
operator|(
name|int
operator|)
name|BOUNDS
argument_list|(
name|y
argument_list|,
literal|0
argument_list|,
name|distR
operator|.
name|h
argument_list|)
expr_stmt|;
name|tile
operator|=
name|tile_manager_get_tile
argument_list|(
name|distR
operator|.
name|tiles
argument_list|,
name|ix
argument_list|,
name|iy
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|value
operator|=
operator|*
operator|(
operator|(
name|float
operator|*
operator|)
name|tile_data_pointer
argument_list|(
name|tile
argument_list|,
name|ix
operator|%
name|TILE_WIDTH
argument_list|,
name|iy
operator|%
name|TILE_HEIGHT
argument_list|)
operator|)
expr_stmt|;
name|value
operator|=
name|cos
argument_list|(
literal|0.5
operator|*
name|M_PI
operator|*
name|value
argument_list|)
expr_stmt|;
name|tile_release
argument_list|(
name|tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|value
return|;
block|}
end_function

begin_function
specifier|static
name|double
DECL|function|gradient_repeat_none (double val)
name|gradient_repeat_none
parameter_list|(
name|double
name|val
parameter_list|)
block|{
return|return
name|BOUNDS
argument_list|(
name|val
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|double
DECL|function|gradient_repeat_sawtooth (double val)
name|gradient_repeat_sawtooth
parameter_list|(
name|double
name|val
parameter_list|)
block|{
if|if
condition|(
name|val
operator|>=
literal|0.0
condition|)
return|return
name|fmod
argument_list|(
name|val
argument_list|,
literal|1.0
argument_list|)
return|;
else|else
return|return
literal|1.0
operator|-
name|fmod
argument_list|(
operator|-
name|val
argument_list|,
literal|1.0
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|double
DECL|function|gradient_repeat_triangular (double val)
name|gradient_repeat_triangular
parameter_list|(
name|double
name|val
parameter_list|)
block|{
name|int
name|ival
decl_stmt|;
if|if
condition|(
name|val
operator|<
literal|0.0
condition|)
name|val
operator|=
operator|-
name|val
expr_stmt|;
name|ival
operator|=
operator|(
name|int
operator|)
name|val
expr_stmt|;
if|if
condition|(
name|ival
operator|&
literal|1
condition|)
return|return
literal|1.0
operator|-
name|fmod
argument_list|(
name|val
argument_list|,
literal|1.0
argument_list|)
return|;
else|else
return|return
name|fmod
argument_list|(
name|val
argument_list|,
literal|1.0
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|gradient_precalc_shapeburst (GImage * gimage,GimpDrawable * drawable,PixelRegion * PR,double dist)
name|gradient_precalc_shapeburst
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|PixelRegion
modifier|*
name|PR
parameter_list|,
name|double
name|dist
parameter_list|)
block|{
name|Channel
modifier|*
name|mask
decl_stmt|;
name|PixelRegion
name|tempR
decl_stmt|;
name|float
name|max_iteration
decl_stmt|;
name|float
modifier|*
name|distp
decl_stmt|;
name|int
name|size
decl_stmt|;
name|void
modifier|*
name|pr
decl_stmt|;
name|unsigned
name|char
name|white
index|[
literal|1
index|]
init|=
block|{
name|OPAQUE_OPACITY
block|}
decl_stmt|;
comment|/*  allocate the distance map  */
if|if
condition|(
name|distR
operator|.
name|tiles
condition|)
name|tile_manager_destroy
argument_list|(
name|distR
operator|.
name|tiles
argument_list|)
expr_stmt|;
name|distR
operator|.
name|tiles
operator|=
name|tile_manager_new
argument_list|(
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
sizeof|sizeof
argument_list|(
name|float
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  allocate the selection mask copy  */
name|tempR
operator|.
name|tiles
operator|=
name|tile_manager_new
argument_list|(
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|tempR
argument_list|,
name|tempR
operator|.
name|tiles
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/*  If the gimage mask is not empty, use it as the shape burst source  */
if|if
condition|(
operator|!
name|gimage_mask_is_empty
argument_list|(
name|gimage
argument_list|)
condition|)
block|{
name|PixelRegion
name|maskR
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|int
name|offx
decl_stmt|,
name|offy
decl_stmt|;
name|drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|drawable_offsets
argument_list|(
name|drawable
argument_list|,
operator|&
name|offx
argument_list|,
operator|&
name|offy
argument_list|)
expr_stmt|;
comment|/*  the selection mask  */
name|mask
operator|=
name|gimage_get_mask
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|maskR
argument_list|,
name|drawable_data
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|mask
argument_list|)
argument_list|)
argument_list|,
name|x1
operator|+
name|offx
argument_list|,
name|y1
operator|+
name|offy
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  copy the mask to the temp mask  */
name|copy_region
argument_list|(
operator|&
name|maskR
argument_list|,
operator|&
name|tempR
argument_list|)
expr_stmt|;
block|}
comment|/*  otherwise...  */
else|else
block|{
comment|/*  If the intended drawable has an alpha channel, use that  */
if|if
condition|(
name|drawable_has_alpha
argument_list|(
name|drawable
argument_list|)
condition|)
block|{
name|PixelRegion
name|drawableR
decl_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|drawableR
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|PR
operator|->
name|x
argument_list|,
name|PR
operator|->
name|y
argument_list|,
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|extract_alpha_region
argument_list|(
operator|&
name|drawableR
argument_list|,
name|NULL
argument_list|,
operator|&
name|tempR
argument_list|)
expr_stmt|;
block|}
comment|/*  Otherwise, just fill the shapeburst to white  */
else|else
name|color_region
argument_list|(
operator|&
name|tempR
argument_list|,
name|white
argument_list|)
expr_stmt|;
block|}
name|pixel_region_init
argument_list|(
operator|&
name|tempR
argument_list|,
name|tempR
operator|.
name|tiles
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|distR
argument_list|,
name|distR
operator|.
name|tiles
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|max_iteration
operator|=
name|shapeburst_region
argument_list|(
operator|&
name|tempR
argument_list|,
operator|&
name|distR
argument_list|)
expr_stmt|;
comment|/*  normalize the shapeburst with the max iteration  */
if|if
condition|(
name|max_iteration
operator|>
literal|0
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|distR
argument_list|,
name|distR
operator|.
name|tiles
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|pixel_regions_register
argument_list|(
literal|1
argument_list|,
operator|&
name|distR
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|pixel_regions_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
name|distp
operator|=
operator|(
name|float
operator|*
operator|)
name|distR
operator|.
name|data
expr_stmt|;
name|size
operator|=
name|distR
operator|.
name|w
operator|*
name|distR
operator|.
name|h
expr_stmt|;
while|while
condition|(
name|size
operator|--
condition|)
operator|*
name|distp
operator|++
operator|/=
name|max_iteration
expr_stmt|;
block|}
name|pixel_region_init
argument_list|(
operator|&
name|distR
argument_list|,
name|distR
operator|.
name|tiles
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|PR
operator|->
name|w
argument_list|,
name|PR
operator|->
name|h
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
name|tile_manager_destroy
argument_list|(
name|tempR
operator|.
name|tiles
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_render_pixel (double x,double y,color_t * color,void * render_data)
name|gradient_render_pixel
parameter_list|(
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|,
name|color_t
modifier|*
name|color
parameter_list|,
name|void
modifier|*
name|render_data
parameter_list|)
block|{
name|RenderBlendData
modifier|*
name|rbd
decl_stmt|;
name|double
name|factor
decl_stmt|;
name|rbd
operator|=
name|render_data
expr_stmt|;
comment|/* Calculate blending factor */
switch|switch
condition|(
name|rbd
operator|->
name|gradient_type
condition|)
block|{
case|case
name|Radial
case|:
name|factor
operator|=
name|gradient_calc_radial_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|offset
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|)
expr_stmt|;
break|break;
case|case
name|ConicalSymmetric
case|:
name|factor
operator|=
name|gradient_calc_conical_sym_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|vec
argument_list|,
name|rbd
operator|->
name|offset
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|)
expr_stmt|;
break|break;
case|case
name|ConicalAsymmetric
case|:
name|factor
operator|=
name|gradient_calc_conical_asym_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|vec
argument_list|,
name|rbd
operator|->
name|offset
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|)
expr_stmt|;
break|break;
case|case
name|Square
case|:
name|factor
operator|=
name|gradient_calc_square_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|offset
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|)
expr_stmt|;
break|break;
case|case
name|Linear
case|:
name|factor
operator|=
name|gradient_calc_linear_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|vec
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|)
expr_stmt|;
break|break;
case|case
name|BiLinear
case|:
name|factor
operator|=
name|gradient_calc_bilinear_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|vec
argument_list|,
name|rbd
operator|->
name|offset
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|)
expr_stmt|;
break|break;
case|case
name|ShapeburstAngular
case|:
name|factor
operator|=
name|gradient_calc_shapeburst_angular_factor
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
name|ShapeburstSpherical
case|:
name|factor
operator|=
name|gradient_calc_shapeburst_spherical_factor
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
name|ShapeburstDimpled
case|:
name|factor
operator|=
name|gradient_calc_shapeburst_dimpled_factor
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
break|break;
case|case
name|SpiralClockwise
case|:
name|factor
operator|=
name|gradient_calc_spiral_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|vec
argument_list|,
name|rbd
operator|->
name|offset
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|SpiralAntiClockwise
case|:
name|factor
operator|=
name|gradient_calc_spiral_factor
argument_list|(
name|rbd
operator|->
name|dist
argument_list|,
name|rbd
operator|->
name|vec
argument_list|,
name|rbd
operator|->
name|offset
argument_list|,
name|x
operator|-
name|rbd
operator|->
name|sx
argument_list|,
name|y
operator|-
name|rbd
operator|->
name|sy
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"gradient_render_pixel(): unknown gradient type %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|rbd
operator|->
name|gradient_type
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* Adjust for repeat */
name|factor
operator|=
call|(
modifier|*
name|rbd
operator|->
name|repeat_func
call|)
argument_list|(
name|factor
argument_list|)
expr_stmt|;
comment|/* Blend the colors */
if|if
condition|(
name|rbd
operator|->
name|blend_mode
operator|==
name|CUSTOM_MODE
condition|)
name|grad_get_color_at
argument_list|(
name|factor
argument_list|,
operator|&
name|color
operator|->
name|r
argument_list|,
operator|&
name|color
operator|->
name|g
argument_list|,
operator|&
name|color
operator|->
name|b
argument_list|,
operator|&
name|color
operator|->
name|a
argument_list|)
expr_stmt|;
else|else
block|{
comment|/* Blend values */
name|color
operator|->
name|r
operator|=
name|rbd
operator|->
name|fg
operator|.
name|r
operator|+
operator|(
name|rbd
operator|->
name|bg
operator|.
name|r
operator|-
name|rbd
operator|->
name|fg
operator|.
name|r
operator|)
operator|*
name|factor
expr_stmt|;
name|color
operator|->
name|g
operator|=
name|rbd
operator|->
name|fg
operator|.
name|g
operator|+
operator|(
name|rbd
operator|->
name|bg
operator|.
name|g
operator|-
name|rbd
operator|->
name|fg
operator|.
name|g
operator|)
operator|*
name|factor
expr_stmt|;
name|color
operator|->
name|b
operator|=
name|rbd
operator|->
name|fg
operator|.
name|b
operator|+
operator|(
name|rbd
operator|->
name|bg
operator|.
name|b
operator|-
name|rbd
operator|->
name|fg
operator|.
name|b
operator|)
operator|*
name|factor
expr_stmt|;
name|color
operator|->
name|a
operator|=
name|rbd
operator|->
name|fg
operator|.
name|a
operator|+
operator|(
name|rbd
operator|->
name|bg
operator|.
name|a
operator|-
name|rbd
operator|->
name|fg
operator|.
name|a
operator|)
operator|*
name|factor
expr_stmt|;
if|if
condition|(
name|rbd
operator|->
name|blend_mode
operator|==
name|FG_BG_HSV_MODE
condition|)
name|calc_hsv_to_rgb
argument_list|(
operator|&
name|color
operator|->
name|r
argument_list|,
operator|&
name|color
operator|->
name|g
argument_list|,
operator|&
name|color
operator|->
name|b
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_put_pixel (int x,int y,color_t color,void * put_pixel_data)
name|gradient_put_pixel
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|color_t
name|color
parameter_list|,
name|void
modifier|*
name|put_pixel_data
parameter_list|)
block|{
name|PutPixelData
modifier|*
name|ppd
decl_stmt|;
name|unsigned
name|char
modifier|*
name|data
decl_stmt|;
name|ppd
operator|=
name|put_pixel_data
expr_stmt|;
comment|/* Paint */
name|data
operator|=
name|ppd
operator|->
name|row_data
operator|+
name|ppd
operator|->
name|bytes
operator|*
name|x
expr_stmt|;
if|if
condition|(
name|ppd
operator|->
name|bytes
operator|>=
literal|3
condition|)
block|{
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|r
operator|*
literal|255.0
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|g
operator|*
literal|255.0
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|b
operator|*
literal|255.0
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|a
operator|*
literal|255.0
expr_stmt|;
block|}
else|else
block|{
comment|/* Convert to grayscale */
operator|*
name|data
operator|++
operator|=
literal|255.0
operator|*
operator|(
literal|0.30
operator|*
name|color
operator|.
name|r
operator|+
literal|0.59
operator|*
name|color
operator|.
name|g
operator|+
literal|0.11
operator|*
name|color
operator|.
name|b
operator|)
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|a
operator|*
literal|255.0
expr_stmt|;
block|}
comment|/* Paint whole row if we are on the rightmost pixel */
if|if
condition|(
name|x
operator|==
operator|(
name|ppd
operator|->
name|width
operator|-
literal|1
operator|)
condition|)
name|pixel_region_set_row
argument_list|(
name|ppd
operator|->
name|PR
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|ppd
operator|->
name|width
argument_list|,
name|ppd
operator|->
name|row_data
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gradient_fill_region (GImage * gimage,GimpDrawable * drawable,PixelRegion * PR,int width,int height,BlendMode blend_mode,GradientType gradient_type,double offset,RepeatMode repeat,int supersample,int max_depth,double threshold,double sx,double sy,double ex,double ey,progress_func_t progress_callback,void * progress_data)
name|gradient_fill_region
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|PixelRegion
modifier|*
name|PR
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|BlendMode
name|blend_mode
parameter_list|,
name|GradientType
name|gradient_type
parameter_list|,
name|double
name|offset
parameter_list|,
name|RepeatMode
name|repeat
parameter_list|,
name|int
name|supersample
parameter_list|,
name|int
name|max_depth
parameter_list|,
name|double
name|threshold
parameter_list|,
name|double
name|sx
parameter_list|,
name|double
name|sy
parameter_list|,
name|double
name|ex
parameter_list|,
name|double
name|ey
parameter_list|,
name|progress_func_t
name|progress_callback
parameter_list|,
name|void
modifier|*
name|progress_data
parameter_list|)
block|{
name|RenderBlendData
name|rbd
decl_stmt|;
name|PutPixelData
name|ppd
decl_stmt|;
name|unsigned
name|char
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|endx
decl_stmt|,
name|endy
decl_stmt|;
name|void
modifier|*
name|pr
decl_stmt|;
name|unsigned
name|char
modifier|*
name|data
decl_stmt|;
name|color_t
name|color
decl_stmt|;
comment|/* Get foreground and background colors, normalized */
name|palette_get_foreground
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
name|rbd
operator|.
name|fg
operator|.
name|r
operator|=
name|r
operator|/
literal|255.0
expr_stmt|;
name|rbd
operator|.
name|fg
operator|.
name|g
operator|=
name|g
operator|/
literal|255.0
expr_stmt|;
name|rbd
operator|.
name|fg
operator|.
name|b
operator|=
name|b
operator|/
literal|255.0
expr_stmt|;
name|rbd
operator|.
name|fg
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
comment|/* Foreground is always opaque */
name|palette_get_background
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
name|rbd
operator|.
name|bg
operator|.
name|r
operator|=
name|r
operator|/
literal|255.0
expr_stmt|;
name|rbd
operator|.
name|bg
operator|.
name|g
operator|=
name|g
operator|/
literal|255.0
expr_stmt|;
name|rbd
operator|.
name|bg
operator|.
name|b
operator|=
name|b
operator|/
literal|255.0
expr_stmt|;
name|rbd
operator|.
name|bg
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
comment|/* opaque, for now */
switch|switch
condition|(
name|blend_mode
condition|)
block|{
case|case
name|FG_BG_RGB_MODE
case|:
break|break;
case|case
name|FG_BG_HSV_MODE
case|:
comment|/* Convert to HSV */
name|calc_rgb_to_hsv
argument_list|(
operator|&
name|rbd
operator|.
name|fg
operator|.
name|r
argument_list|,
operator|&
name|rbd
operator|.
name|fg
operator|.
name|g
argument_list|,
operator|&
name|rbd
operator|.
name|fg
operator|.
name|b
argument_list|)
expr_stmt|;
name|calc_rgb_to_hsv
argument_list|(
operator|&
name|rbd
operator|.
name|bg
operator|.
name|r
argument_list|,
operator|&
name|rbd
operator|.
name|bg
operator|.
name|g
argument_list|,
operator|&
name|rbd
operator|.
name|bg
operator|.
name|b
argument_list|)
expr_stmt|;
break|break;
case|case
name|FG_TRANS_MODE
case|:
comment|/* Color does not change, just the opacity */
name|rbd
operator|.
name|bg
operator|=
name|rbd
operator|.
name|fg
expr_stmt|;
name|rbd
operator|.
name|bg
operator|.
name|a
operator|=
literal|0.0
expr_stmt|;
comment|/* transparent */
break|break;
case|case
name|CUSTOM_MODE
case|:
break|break;
default|default:
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"gradient_fill_region(): unknown blend mode %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|blend_mode
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* Calculate type-specific parameters */
switch|switch
condition|(
name|gradient_type
condition|)
block|{
case|case
name|Radial
case|:
name|rbd
operator|.
name|dist
operator|=
name|sqrt
argument_list|(
name|SQR
argument_list|(
name|ex
operator|-
name|sx
argument_list|)
operator|+
name|SQR
argument_list|(
name|ey
operator|-
name|sy
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Square
case|:
name|rbd
operator|.
name|dist
operator|=
name|MAXIMUM
argument_list|(
name|fabs
argument_list|(
name|ex
operator|-
name|sx
argument_list|)
argument_list|,
name|fabs
argument_list|(
name|ey
operator|-
name|sy
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ConicalSymmetric
case|:
case|case
name|ConicalAsymmetric
case|:
case|case
name|SpiralClockwise
case|:
case|case
name|SpiralAntiClockwise
case|:
case|case
name|Linear
case|:
case|case
name|BiLinear
case|:
name|rbd
operator|.
name|dist
operator|=
name|sqrt
argument_list|(
name|SQR
argument_list|(
name|ex
operator|-
name|sx
argument_list|)
operator|+
name|SQR
argument_list|(
name|ey
operator|-
name|sy
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|rbd
operator|.
name|dist
operator|>
literal|0.0
condition|)
block|{
name|rbd
operator|.
name|vec
index|[
literal|0
index|]
operator|=
operator|(
name|ex
operator|-
name|sx
operator|)
operator|/
name|rbd
operator|.
name|dist
expr_stmt|;
name|rbd
operator|.
name|vec
index|[
literal|1
index|]
operator|=
operator|(
name|ey
operator|-
name|sy
operator|)
operator|/
name|rbd
operator|.
name|dist
expr_stmt|;
block|}
break|break;
case|case
name|ShapeburstAngular
case|:
case|case
name|ShapeburstSpherical
case|:
case|case
name|ShapeburstDimpled
case|:
name|rbd
operator|.
name|dist
operator|=
name|sqrt
argument_list|(
name|SQR
argument_list|(
name|ex
operator|-
name|sx
argument_list|)
operator|+
name|SQR
argument_list|(
name|ey
operator|-
name|sy
argument_list|)
argument_list|)
expr_stmt|;
name|gradient_precalc_shapeburst
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
name|PR
argument_list|,
name|rbd
operator|.
name|dist
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"gradient_fill_region(): unknown gradient type %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|gradient_type
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* Set repeat function */
switch|switch
condition|(
name|repeat
condition|)
block|{
case|case
name|REPEAT_NONE
case|:
name|rbd
operator|.
name|repeat_func
operator|=
name|gradient_repeat_none
expr_stmt|;
break|break;
case|case
name|REPEAT_SAWTOOTH
case|:
name|rbd
operator|.
name|repeat_func
operator|=
name|gradient_repeat_sawtooth
expr_stmt|;
break|break;
case|case
name|REPEAT_TRIANGULAR
case|:
name|rbd
operator|.
name|repeat_func
operator|=
name|gradient_repeat_triangular
expr_stmt|;
break|break;
default|default:
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"gradient_fill_region(): unknown repeat mode %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|repeat
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* Initialize render data */
name|rbd
operator|.
name|offset
operator|=
name|offset
expr_stmt|;
name|rbd
operator|.
name|sx
operator|=
name|sx
expr_stmt|;
name|rbd
operator|.
name|sy
operator|=
name|sy
expr_stmt|;
name|rbd
operator|.
name|blend_mode
operator|=
name|blend_mode
expr_stmt|;
name|rbd
operator|.
name|gradient_type
operator|=
name|gradient_type
expr_stmt|;
comment|/* Render the gradient! */
if|if
condition|(
name|supersample
condition|)
block|{
comment|/* Initialize put pixel data */
name|ppd
operator|.
name|PR
operator|=
name|PR
expr_stmt|;
name|ppd
operator|.
name|row_data
operator|=
name|g_malloc
argument_list|(
name|width
operator|*
name|PR
operator|->
name|bytes
argument_list|)
expr_stmt|;
name|ppd
operator|.
name|bytes
operator|=
name|PR
operator|->
name|bytes
expr_stmt|;
name|ppd
operator|.
name|width
operator|=
name|width
expr_stmt|;
comment|/* Render! */
name|adaptive_supersample_area
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
operator|(
name|width
operator|-
literal|1
operator|)
argument_list|,
operator|(
name|height
operator|-
literal|1
operator|)
argument_list|,
name|max_depth
argument_list|,
name|threshold
argument_list|,
name|gradient_render_pixel
argument_list|,
operator|&
name|rbd
argument_list|,
name|gradient_put_pixel
argument_list|,
operator|&
name|ppd
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|)
expr_stmt|;
comment|/* Clean up */
name|g_free
argument_list|(
name|ppd
operator|.
name|row_data
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|int
name|max_progress
init|=
name|PR
operator|->
name|w
operator|*
name|PR
operator|->
name|h
decl_stmt|;
name|int
name|progress
init|=
literal|0
decl_stmt|;
for|for
control|(
name|pr
operator|=
name|pixel_regions_register
argument_list|(
literal|1
argument_list|,
name|PR
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|pixel_regions_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
name|data
operator|=
name|PR
operator|->
name|data
expr_stmt|;
name|endx
operator|=
name|PR
operator|->
name|x
operator|+
name|PR
operator|->
name|w
expr_stmt|;
name|endy
operator|=
name|PR
operator|->
name|y
operator|+
name|PR
operator|->
name|h
expr_stmt|;
for|for
control|(
name|y
operator|=
name|PR
operator|->
name|y
init|;
name|y
operator|<
name|endy
condition|;
name|y
operator|++
control|)
for|for
control|(
name|x
operator|=
name|PR
operator|->
name|x
init|;
name|x
operator|<
name|endx
condition|;
name|x
operator|++
control|)
block|{
name|gradient_render_pixel
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
operator|&
name|color
argument_list|,
operator|&
name|rbd
argument_list|)
expr_stmt|;
if|if
condition|(
name|PR
operator|->
name|bytes
operator|>=
literal|3
condition|)
block|{
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|r
operator|*
literal|255.0
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|g
operator|*
literal|255.0
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|b
operator|*
literal|255.0
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|a
operator|*
literal|255.0
expr_stmt|;
block|}
else|else
block|{
comment|/* Convert to grayscale */
operator|*
name|data
operator|++
operator|=
literal|255.0
operator|*
operator|(
literal|0.30
operator|*
name|color
operator|.
name|r
operator|+
literal|0.59
operator|*
name|color
operator|.
name|g
operator|+
literal|0.11
operator|*
name|color
operator|.
name|b
operator|)
expr_stmt|;
operator|*
name|data
operator|++
operator|=
name|color
operator|.
name|a
operator|*
literal|255.0
expr_stmt|;
block|}
block|}
name|progress
operator|+=
name|PR
operator|->
name|w
operator|*
name|PR
operator|->
name|h
expr_stmt|;
if|if
condition|(
name|progress_callback
condition|)
call|(
modifier|*
name|progress_callback
call|)
argument_list|(
literal|0
argument_list|,
name|max_progress
argument_list|,
name|progress
argument_list|,
name|progress_data
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_rgb_to_hsv (double * r,double * g,double * b)
name|calc_rgb_to_hsv
parameter_list|(
name|double
modifier|*
name|r
parameter_list|,
name|double
modifier|*
name|g
parameter_list|,
name|double
modifier|*
name|b
parameter_list|)
block|{
name|double
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
name|double
name|h
decl_stmt|,
name|s
decl_stmt|,
name|v
decl_stmt|;
name|double
name|min
decl_stmt|,
name|max
decl_stmt|;
name|double
name|delta
decl_stmt|;
name|red
operator|=
operator|*
name|r
expr_stmt|;
name|green
operator|=
operator|*
name|g
expr_stmt|;
name|blue
operator|=
operator|*
name|b
expr_stmt|;
name|h
operator|=
literal|0.0
expr_stmt|;
comment|/* Shut up -Wall */
if|if
condition|(
name|red
operator|>
name|green
condition|)
block|{
if|if
condition|(
name|red
operator|>
name|blue
condition|)
name|max
operator|=
name|red
expr_stmt|;
else|else
name|max
operator|=
name|blue
expr_stmt|;
if|if
condition|(
name|green
operator|<
name|blue
condition|)
name|min
operator|=
name|green
expr_stmt|;
else|else
name|min
operator|=
name|blue
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|green
operator|>
name|blue
condition|)
name|max
operator|=
name|green
expr_stmt|;
else|else
name|max
operator|=
name|blue
expr_stmt|;
if|if
condition|(
name|red
operator|<
name|blue
condition|)
name|min
operator|=
name|red
expr_stmt|;
else|else
name|min
operator|=
name|blue
expr_stmt|;
block|}
name|v
operator|=
name|max
expr_stmt|;
if|if
condition|(
name|max
operator|!=
literal|0.0
condition|)
name|s
operator|=
operator|(
name|max
operator|-
name|min
operator|)
operator|/
name|max
expr_stmt|;
else|else
name|s
operator|=
literal|0.0
expr_stmt|;
if|if
condition|(
name|s
operator|==
literal|0.0
condition|)
name|h
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
name|delta
operator|=
name|max
operator|-
name|min
expr_stmt|;
if|if
condition|(
name|red
operator|==
name|max
condition|)
name|h
operator|=
operator|(
name|green
operator|-
name|blue
operator|)
operator|/
name|delta
expr_stmt|;
elseif|else
if|if
condition|(
name|green
operator|==
name|max
condition|)
name|h
operator|=
literal|2
operator|+
operator|(
name|blue
operator|-
name|red
operator|)
operator|/
name|delta
expr_stmt|;
elseif|else
if|if
condition|(
name|blue
operator|==
name|max
condition|)
name|h
operator|=
literal|4
operator|+
operator|(
name|red
operator|-
name|green
operator|)
operator|/
name|delta
expr_stmt|;
name|h
operator|/=
literal|6.0
expr_stmt|;
if|if
condition|(
name|h
operator|<
literal|0.0
condition|)
name|h
operator|+=
literal|1.0
expr_stmt|;
elseif|else
if|if
condition|(
name|h
operator|>
literal|1.0
condition|)
name|h
operator|-=
literal|1.0
expr_stmt|;
block|}
operator|*
name|r
operator|=
name|h
expr_stmt|;
operator|*
name|g
operator|=
name|s
expr_stmt|;
operator|*
name|b
operator|=
name|v
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_hsv_to_rgb (double * h,double * s,double * v)
name|calc_hsv_to_rgb
parameter_list|(
name|double
modifier|*
name|h
parameter_list|,
name|double
modifier|*
name|s
parameter_list|,
name|double
modifier|*
name|v
parameter_list|)
block|{
name|double
name|hue
decl_stmt|,
name|saturation
decl_stmt|,
name|value
decl_stmt|;
name|double
name|f
decl_stmt|,
name|p
decl_stmt|,
name|q
decl_stmt|,
name|t
decl_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|0.0
condition|)
block|{
operator|*
name|h
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|s
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|v
operator|=
operator|*
name|v
expr_stmt|;
comment|/* heh */
block|}
else|else
block|{
name|hue
operator|=
operator|*
name|h
operator|*
literal|6.0
expr_stmt|;
name|saturation
operator|=
operator|*
name|s
expr_stmt|;
name|value
operator|=
operator|*
name|v
expr_stmt|;
if|if
condition|(
name|hue
operator|==
literal|6.0
condition|)
name|hue
operator|=
literal|0.0
expr_stmt|;
name|f
operator|=
name|hue
operator|-
operator|(
name|int
operator|)
name|hue
expr_stmt|;
name|p
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|)
expr_stmt|;
name|q
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|*
name|f
operator|)
expr_stmt|;
name|t
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|*
operator|(
literal|1.0
operator|-
name|f
operator|)
operator|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|hue
condition|)
block|{
case|case
literal|0
case|:
operator|*
name|h
operator|=
name|value
expr_stmt|;
operator|*
name|s
operator|=
name|t
expr_stmt|;
operator|*
name|v
operator|=
name|p
expr_stmt|;
break|break;
case|case
literal|1
case|:
operator|*
name|h
operator|=
name|q
expr_stmt|;
operator|*
name|s
operator|=
name|value
expr_stmt|;
operator|*
name|v
operator|=
name|p
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|*
name|h
operator|=
name|p
expr_stmt|;
operator|*
name|s
operator|=
name|value
expr_stmt|;
operator|*
name|v
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|3
case|:
operator|*
name|h
operator|=
name|p
expr_stmt|;
operator|*
name|s
operator|=
name|q
expr_stmt|;
operator|*
name|v
operator|=
name|value
expr_stmt|;
break|break;
case|case
literal|4
case|:
operator|*
name|h
operator|=
name|t
expr_stmt|;
operator|*
name|s
operator|=
name|p
expr_stmt|;
operator|*
name|v
operator|=
name|value
expr_stmt|;
break|break;
case|case
literal|5
case|:
operator|*
name|h
operator|=
name|value
expr_stmt|;
operator|*
name|s
operator|=
name|p
expr_stmt|;
operator|*
name|v
operator|=
name|q
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_comment
comment|/****************************/
end_comment

begin_comment
comment|/*  Global blend functions  */
end_comment

begin_comment
comment|/****************************/
end_comment

begin_function
name|Tool
modifier|*
DECL|function|tools_new_blend ()
name|tools_new_blend
parameter_list|()
block|{
name|Tool
modifier|*
name|tool
decl_stmt|;
name|BlendTool
modifier|*
name|private
decl_stmt|;
if|if
condition|(
operator|!
name|blend_options
condition|)
name|blend_options
operator|=
name|create_blend_options
argument_list|()
expr_stmt|;
name|tool
operator|=
operator|(
name|Tool
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|Tool
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
operator|(
name|BlendTool
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|BlendTool
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|->
name|core
operator|=
name|draw_core_new
argument_list|(
name|blend_draw
argument_list|)
expr_stmt|;
name|tool
operator|->
name|type
operator|=
name|BLEND
expr_stmt|;
name|tool
operator|->
name|state
operator|=
name|INACTIVE
expr_stmt|;
name|tool
operator|->
name|scroll_lock
operator|=
literal|1
expr_stmt|;
comment|/*  Disallow scrolling  */
name|tool
operator|->
name|auto_snap_to
operator|=
name|TRUE
expr_stmt|;
name|tool
operator|->
name|private
operator|=
name|private
expr_stmt|;
name|tool
operator|->
name|button_press_func
operator|=
name|blend_button_press
expr_stmt|;
name|tool
operator|->
name|button_release_func
operator|=
name|blend_button_release
expr_stmt|;
name|tool
operator|->
name|motion_func
operator|=
name|blend_motion
expr_stmt|;
name|tool
operator|->
name|arrow_keys_func
operator|=
name|standard_arrow_keys_func
expr_stmt|;
name|tool
operator|->
name|cursor_update_func
operator|=
name|blend_cursor_update
expr_stmt|;
name|tool
operator|->
name|control_func
operator|=
name|blend_control
expr_stmt|;
name|tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
return|return
name|tool
return|;
block|}
end_function

begin_function
name|void
DECL|function|tools_free_blend (Tool * tool)
name|tools_free_blend
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|)
block|{
name|BlendTool
modifier|*
name|blend_tool
decl_stmt|;
name|blend_tool
operator|=
operator|(
name|BlendTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
if|if
condition|(
name|tool
operator|->
name|state
operator|==
name|ACTIVE
condition|)
name|draw_core_stop
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
name|draw_core_free
argument_list|(
name|blend_tool
operator|->
name|core
argument_list|)
expr_stmt|;
comment|/*  free the distance map data if it exists  */
if|if
condition|(
name|distR
operator|.
name|tiles
condition|)
name|tile_manager_destroy
argument_list|(
name|distR
operator|.
name|tiles
argument_list|)
expr_stmt|;
name|distR
operator|.
name|tiles
operator|=
name|NULL
expr_stmt|;
name|g_free
argument_list|(
name|blend_tool
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  The blend procedure definition  */
end_comment

begin_decl_stmt
DECL|variable|blend_args
name|ProcArg
name|blend_args
index|[]
init|=
block|{
block|{
name|PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The affected drawable"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"blend_mode"
block|,
literal|"The type of blend: { FG-BG-RGB (0), FG-BG-HSV (1), FG-TRANS (2), CUSTOM (3) }"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"paint_mode"
block|,
literal|"the paint application mode: { NORMAL (0), DISSOLVE (1), BEHIND (2), MULTIPLY/BURN (3), SCREEN (4), OVERLAY (5) DIFFERENCE (6), ADDITION (7), SUBTRACT (8), DARKEN-ONLY (9), LIGHTEN-ONLY (10), HUE (11), SATURATION (12), COLOR (13), VALUE (14), DIVIDE/DODGE (15) }"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"gradient_type"
block|,
literal|"The type of gradient: { LINEAR (0), BILINEAR (1), RADIAL (2), SQUARE (3), CONICAL-SYMMETRIC (4), CONICAL-ASYMMETRIC (5), SHAPEBURST-ANGULAR (6), SHAPEBURST-SPHERICAL (7), SHAPEBURST-DIMPLED (8), SPIRAL-CLOCKWISE(9), SPRIAL-ANTICLOCKWISE(10) }"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"opacity"
block|,
literal|"The opacity of the final blend (0<= opacity<= 100)"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"offset"
block|,
literal|"Offset relates to the starting and ending coordinates specified for the blend.  This parameter is mode depndent (0<= offset)"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"repeat"
block|,
literal|"Repeat mode: { REPEAT-NONE (0), REPEAT-SAWTOOTH (1), REPEAT-TRIANGULAR (2) }"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"supersample"
block|,
literal|"Do adaptive supersampling (true / false)"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"max_depth"
block|,
literal|"Maximum recursion levels for supersampling"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"threshold"
block|,
literal|"Supersampling threshold"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"x1"
block|,
literal|"The x coordinate of this blend's starting point"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"y1"
block|,
literal|"The y coordinate of this blend's starting point"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"x2"
block|,
literal|"The x coordinate of this blend's ending point"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"y2"
block|,
literal|"The y coordinate of this blend's ending point"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|blend_proc
name|ProcRecord
name|blend_proc
init|=
block|{
literal|"gimp_blend"
block|,
literal|"Blend between the starting and ending coordinates with the specified blend mode and gradient type."
block|,
literal|"This tool requires information on the paint application mode, the blend mode, and the gradient type.  It creates the specified variety of blend using the starting and ending coordinates as defined for each gradient type."
block|,
literal|"Spencer Kimball& Peter Mattis& Federico Mena Quintero"
block|,
literal|"Spencer Kimball& Peter Mattis& Federico Mena Quintero"
block|,
literal|"1995-1996"
block|,
name|PDB_INTERNAL
block|,
comment|/*  Input arguments  */
literal|14
block|,
name|blend_args
block|,
comment|/*  Output arguments  */
literal|0
block|,
name|NULL
block|,
comment|/*  Exec method  */
block|{
block|{
name|blend_invoker
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|blend_invoker (Argument * args)
name|blend_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|int
name|success
init|=
name|TRUE
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|BlendMode
name|blend_mode
decl_stmt|;
name|int
name|paint_mode
decl_stmt|;
name|GradientType
name|gradient_type
decl_stmt|;
name|double
name|opacity
decl_stmt|;
name|double
name|offset
decl_stmt|;
name|RepeatMode
name|repeat
decl_stmt|;
name|int
name|supersample
decl_stmt|;
name|int
name|max_depth
decl_stmt|;
name|double
name|threshold
decl_stmt|;
name|double
name|x1
decl_stmt|,
name|y1
decl_stmt|;
name|double
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|int
name|int_value
decl_stmt|;
name|double
name|fp_value
decl_stmt|;
name|drawable
operator|=
name|NULL
expr_stmt|;
name|blend_mode
operator|=
name|FG_BG_RGB_MODE
expr_stmt|;
name|paint_mode
operator|=
name|NORMAL_MODE
expr_stmt|;
name|gradient_type
operator|=
name|Linear
expr_stmt|;
name|opacity
operator|=
literal|100.0
expr_stmt|;
name|offset
operator|=
literal|0.0
expr_stmt|;
name|repeat
operator|=
name|REPEAT_NONE
expr_stmt|;
name|supersample
operator|=
name|FALSE
expr_stmt|;
name|max_depth
operator|=
literal|0
expr_stmt|;
name|threshold
operator|=
literal|0.0
expr_stmt|;
comment|/*  the drawable  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|drawable
operator|=
name|drawable_get_ID
argument_list|(
name|int_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
name|gimage
operator|=
name|drawable_gimage
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
comment|/*  blend mode  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|0
operator|&&
name|int_value
operator|<
name|BLEND_MODE_LAST
condition|)
name|blend_mode
operator|=
operator|(
name|BlendMode
operator|)
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  paint mode  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
name|NORMAL_MODE
operator|&&
name|int_value
operator|<=
name|DIVIDE_MODE
condition|)
name|paint_mode
operator|=
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  gradient type  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|0
operator|&&
name|int_value
operator|<
name|GradientTypeLast
condition|)
name|gradient_type
operator|=
operator|(
name|GradientType
operator|)
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  opacity  */
if|if
condition|(
name|success
condition|)
block|{
name|fp_value
operator|=
name|args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|fp_value
operator|>=
literal|0.0
operator|&&
name|fp_value
operator|<=
literal|100.0
condition|)
name|opacity
operator|=
name|fp_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  offset  */
if|if
condition|(
name|success
condition|)
block|{
name|fp_value
operator|=
name|args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|fp_value
operator|>=
literal|0.0
condition|)
name|offset
operator|=
name|fp_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/* repeat */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|6
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|0
operator|&&
name|int_value
operator|<
name|REPEAT_LAST
condition|)
name|repeat
operator|=
operator|(
name|RepeatMode
operator|)
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/* supersampling */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|7
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|supersample
operator|=
operator|(
name|int_value
condition|?
name|TRUE
else|:
name|FALSE
operator|)
expr_stmt|;
block|}
comment|/* max_depth */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|8
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int_value
operator|>=
literal|1
operator|)
operator|&&
operator|(
name|int_value
operator|<=
literal|9
operator|)
operator|)
operator|||
operator|!
name|supersample
condition|)
name|max_depth
operator|=
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/* threshold */
if|if
condition|(
name|success
condition|)
block|{
name|fp_value
operator|=
name|args
index|[
literal|9
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|fp_value
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|fp_value
operator|<=
literal|4.0
operator|)
operator|)
operator|||
operator|!
name|supersample
condition|)
name|threshold
operator|=
name|fp_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  x1, y1, x2, y2  */
if|if
condition|(
name|success
condition|)
block|{
name|x1
operator|=
name|args
index|[
literal|10
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
name|y1
operator|=
name|args
index|[
literal|11
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
name|x2
operator|=
name|args
index|[
literal|12
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
name|y2
operator|=
name|args
index|[
literal|13
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
block|}
comment|/*  call the blend procedure  */
if|if
condition|(
name|success
condition|)
block|{
name|blend
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
name|blend_mode
argument_list|,
name|paint_mode
argument_list|,
name|gradient_type
argument_list|,
name|opacity
argument_list|,
name|offset
argument_list|,
name|repeat
argument_list|,
name|supersample
argument_list|,
name|max_depth
argument_list|,
name|threshold
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|blend_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

end_unit

