begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* airbrush_blob.c: routines for manipulating scan converted convex  *         polygons.  *    * Copyright 1998-1999, Owen Taylor<otaylor@gtk.org>  *  *> Please contact the above author before modifying the copy<  *> of this file in the GIMP distribution. Thanks.<  *   * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA. */
end_comment

begin_include
include|#
directive|include
file|<glib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<libgimp/gimpmath.h>
end_include

begin_include
include|#
directive|include
file|"airbrush_blob.h"
end_include

begin_define
DECL|macro|SUBSAMPLE
define|#
directive|define
name|SUBSAMPLE
value|8.0
end_define

begin_define
DECL|macro|SU
define|#
directive|define
name|SU
value|8.0
end_define

begin_function
specifier|static
name|AirBrushBlob
modifier|*
DECL|function|airbrush_blob_new (int y,int height)
name|airbrush_blob_new
parameter_list|(
name|int
name|y
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|AirBrushBlob
modifier|*
name|result
decl_stmt|;
name|result
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|AirBrushBlob
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|AirBrushBlobSpan
argument_list|)
operator|*
operator|(
name|height
operator|-
literal|1
operator|)
argument_list|)
expr_stmt|;
name|result
operator|->
name|y
operator|=
name|y
expr_stmt|;
name|result
operator|->
name|height
operator|=
name|height
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
specifier|static
name|AirBlob
modifier|*
DECL|function|airblob_new (int y)
name|airblob_new
parameter_list|(
name|int
name|y
parameter_list|)
block|{
name|AirBlob
modifier|*
name|result
decl_stmt|;
name|result
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|AirBlob
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
specifier|static
name|AirLine
modifier|*
DECL|function|airline_new (int y)
name|airline_new
parameter_list|(
name|int
name|y
parameter_list|)
block|{
name|AirLine
modifier|*
name|result
decl_stmt|;
name|result
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|AirLine
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_typedef
DECL|enum|__anon28bf57800103
typedef|typedef
enum|enum
block|{
DECL|enumerator|EDGE_NONE
name|EDGE_NONE
init|=
literal|0
block|,
DECL|enumerator|EDGE_LEFT
name|EDGE_LEFT
init|=
literal|1
operator|<<
literal|0
block|,
DECL|enumerator|EDGE_RIGHT
name|EDGE_RIGHT
init|=
literal|1
operator|<<
literal|1
DECL|typedef|EdgeType
block|}
name|EdgeType
typedef|;
end_typedef

begin_function
specifier|static
name|void
DECL|function|airbrush_blob_fill (AirBrushBlob * b,EdgeType * present)
name|airbrush_blob_fill
parameter_list|(
name|AirBrushBlob
modifier|*
name|b
parameter_list|,
name|EdgeType
modifier|*
name|present
parameter_list|)
block|{
name|int
name|start
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|x2
decl_stmt|,
name|i1
decl_stmt|,
name|i2
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* Mark empty lines at top and bottom as unused */
name|start
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|present
index|[
name|start
index|]
operator|)
condition|)
block|{
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|left
operator|=
literal|0
expr_stmt|;
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|right
operator|=
operator|-
literal|1
expr_stmt|;
name|start
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|present
index|[
name|start
index|]
operator|!=
operator|(
name|EDGE_RIGHT
operator||
name|EDGE_LEFT
operator|)
condition|)
block|{
if|if
condition|(
name|present
index|[
name|start
index|]
operator|==
name|EDGE_RIGHT
condition|)
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|left
operator|=
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|right
expr_stmt|;
else|else
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|right
operator|=
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|left
expr_stmt|;
name|present
index|[
name|start
index|]
operator|=
name|EDGE_RIGHT
operator||
name|EDGE_LEFT
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
name|b
operator|->
name|height
operator|-
literal|1
init|;
operator|!
name|present
index|[
name|i
index|]
condition|;
name|i
operator|--
control|)
block|{
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|=
literal|0
expr_stmt|;
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|=
operator|-
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|present
index|[
name|i
index|]
operator|!=
operator|(
name|EDGE_RIGHT
operator||
name|EDGE_LEFT
operator|)
condition|)
block|{
if|if
condition|(
name|present
index|[
name|i
index|]
operator|==
name|EDGE_RIGHT
condition|)
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
expr_stmt|;
else|else
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
expr_stmt|;
name|present
index|[
name|i
index|]
operator|=
name|EDGE_RIGHT
operator||
name|EDGE_LEFT
expr_stmt|;
block|}
comment|/* Restore missing edges  */
comment|/* We fill only interior regions of convex hull, as if we were filling      polygons. But since we draw ellipses with nearest points, not interior      points, maybe it would look better if we did the same here. Probably      not a big deal either way after anti-aliasing */
comment|/*     left edge */
for|for
control|(
name|i1
operator|=
name|start
init|;
name|i1
operator|<
name|b
operator|->
name|height
operator|-
literal|2
condition|;
name|i1
operator|++
control|)
block|{
comment|/* Find empty gaps */
if|if
condition|(
operator|!
operator|(
name|present
index|[
name|i1
operator|+
literal|1
index|]
operator|&
name|EDGE_LEFT
operator|)
condition|)
block|{
name|int
name|increment
decl_stmt|;
comment|/* fractional part */
name|int
name|denom
decl_stmt|;
comment|/* denominator of fraction */
name|int
name|step
decl_stmt|;
comment|/* integral step */
name|int
name|frac
decl_stmt|;
comment|/* fractional step */
name|int
name|reverse
decl_stmt|;
comment|/* find bottom of gap */
name|i2
operator|=
name|i1
operator|+
literal|2
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|present
index|[
name|i2
index|]
operator|&
name|EDGE_LEFT
operator|)
operator|&&
name|i2
operator|<
name|b
operator|->
name|height
condition|)
name|i2
operator|++
expr_stmt|;
if|if
condition|(
name|i2
operator|<
name|b
operator|->
name|height
condition|)
block|{
name|denom
operator|=
name|i2
operator|-
name|i1
expr_stmt|;
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|i1
index|]
operator|.
name|left
expr_stmt|;
name|x2
operator|=
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|left
expr_stmt|;
name|step
operator|=
operator|(
name|x2
operator|-
name|x1
operator|)
operator|/
name|denom
expr_stmt|;
name|frac
operator|=
name|x2
operator|-
name|x1
operator|-
name|step
operator|*
name|denom
expr_stmt|;
if|if
condition|(
name|frac
operator|<
literal|0
condition|)
block|{
name|frac
operator|=
operator|-
name|frac
expr_stmt|;
name|reverse
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|reverse
operator|=
literal|0
expr_stmt|;
name|increment
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|i1
operator|+
literal|1
init|;
name|i
operator|<
name|i2
condition|;
name|i
operator|++
control|)
block|{
name|x1
operator|+=
name|step
expr_stmt|;
name|increment
operator|+=
name|frac
expr_stmt|;
if|if
condition|(
name|increment
operator|>=
name|denom
condition|)
block|{
name|increment
operator|-=
name|denom
expr_stmt|;
name|x1
operator|+=
name|reverse
condition|?
operator|-
literal|1
else|:
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|increment
operator|==
literal|0
operator|||
name|reverse
condition|)
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|=
name|x1
expr_stmt|;
else|else
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|=
name|x1
operator|+
literal|1
expr_stmt|;
block|}
block|}
name|i1
operator|=
name|i2
operator|-
literal|1
expr_stmt|;
comment|/* advance to next possibility */
block|}
block|}
comment|/*     right edge */
for|for
control|(
name|i1
operator|=
name|start
init|;
name|i1
operator|<
name|b
operator|->
name|height
operator|-
literal|2
condition|;
name|i1
operator|++
control|)
block|{
comment|/* Find empty gaps */
if|if
condition|(
operator|!
operator|(
name|present
index|[
name|i1
operator|+
literal|1
index|]
operator|&
name|EDGE_RIGHT
operator|)
condition|)
block|{
name|int
name|increment
decl_stmt|;
comment|/* fractional part */
name|int
name|denom
decl_stmt|;
comment|/* denominator of fraction */
name|int
name|step
decl_stmt|;
comment|/* integral step */
name|int
name|frac
decl_stmt|;
comment|/* fractional step */
name|int
name|reverse
decl_stmt|;
comment|/* find bottom of gap */
name|i2
operator|=
name|i1
operator|+
literal|2
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|present
index|[
name|i2
index|]
operator|&
name|EDGE_RIGHT
operator|)
operator|&&
name|i2
operator|<
name|b
operator|->
name|height
condition|)
name|i2
operator|++
expr_stmt|;
if|if
condition|(
name|i2
operator|<
name|b
operator|->
name|height
condition|)
block|{
name|denom
operator|=
name|i2
operator|-
name|i1
expr_stmt|;
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|i1
index|]
operator|.
name|right
expr_stmt|;
name|x2
operator|=
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|right
expr_stmt|;
name|step
operator|=
operator|(
name|x2
operator|-
name|x1
operator|)
operator|/
name|denom
expr_stmt|;
name|frac
operator|=
name|x2
operator|-
name|x1
operator|-
name|step
operator|*
name|denom
expr_stmt|;
if|if
condition|(
name|frac
operator|<
literal|0
condition|)
block|{
name|frac
operator|=
operator|-
name|frac
expr_stmt|;
name|reverse
operator|=
literal|1
expr_stmt|;
block|}
else|else
name|reverse
operator|=
literal|0
expr_stmt|;
name|increment
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|i1
operator|+
literal|1
init|;
name|i
operator|<
name|i2
condition|;
name|i
operator|++
control|)
block|{
name|x1
operator|+=
name|step
expr_stmt|;
name|increment
operator|+=
name|frac
expr_stmt|;
if|if
condition|(
name|increment
operator|>=
name|denom
condition|)
block|{
name|increment
operator|-=
name|denom
expr_stmt|;
name|x1
operator|+=
name|reverse
condition|?
operator|-
literal|1
else|:
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|reverse
operator|&&
name|increment
operator|!=
literal|0
condition|)
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|=
name|x1
operator|-
literal|1
expr_stmt|;
else|else
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|=
name|x1
expr_stmt|;
block|}
block|}
name|i1
operator|=
name|i2
operator|-
literal|1
expr_stmt|;
comment|/* advance to next possibility */
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|airbrush_blob_make_convex (AirBrushBlob * b,EdgeType * present)
name|airbrush_blob_make_convex
parameter_list|(
name|AirBrushBlob
modifier|*
name|b
parameter_list|,
name|EdgeType
modifier|*
name|present
parameter_list|)
block|{
name|int
name|x1
decl_stmt|,
name|x2
decl_stmt|,
name|y1
decl_stmt|,
name|y2
decl_stmt|,
name|i1
decl_stmt|,
name|i2
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|start
decl_stmt|;
comment|/* Walk through edges, deleting points that aren't on convex hull */
name|start
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|present
index|[
name|start
index|]
operator|)
condition|)
name|start
operator|++
expr_stmt|;
comment|/*    left edge */
name|i1
operator|=
name|start
operator|-
literal|1
expr_stmt|;
name|i2
operator|=
name|start
expr_stmt|;
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|left
operator|-
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|right
expr_stmt|;
name|y1
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|start
operator|+
literal|1
init|;
name|i
operator|<
name|b
operator|->
name|height
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|present
index|[
name|i
index|]
operator|&
name|EDGE_LEFT
operator|)
condition|)
continue|continue;
name|x2
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|-
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|left
expr_stmt|;
name|y2
operator|=
name|i
operator|-
name|i2
expr_stmt|;
while|while
condition|(
name|x2
operator|*
name|y1
operator|-
name|x1
operator|*
name|y2
operator|<
literal|0
condition|)
comment|/* clockwise rotation */
block|{
name|present
index|[
name|i2
index|]
operator|&=
operator|~
name|EDGE_LEFT
expr_stmt|;
name|i2
operator|=
name|i1
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|present
index|[
operator|--
name|i1
index|]
operator|&
name|EDGE_LEFT
operator|)
operator|&&
name|i1
operator|>=
name|start
condition|)
empty_stmt|;
if|if
condition|(
name|i1
operator|<
name|start
condition|)
block|{
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|left
operator|-
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|right
expr_stmt|;
name|y1
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|left
operator|-
name|b
operator|->
name|data
index|[
name|i1
index|]
operator|.
name|left
expr_stmt|;
name|y1
operator|=
name|i2
operator|-
name|i1
expr_stmt|;
block|}
name|x2
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|-
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|left
expr_stmt|;
name|y2
operator|=
name|i
operator|-
name|i2
expr_stmt|;
block|}
name|x1
operator|=
name|x2
expr_stmt|;
name|y1
operator|=
name|y2
expr_stmt|;
name|i1
operator|=
name|i2
expr_stmt|;
name|i2
operator|=
name|i
expr_stmt|;
block|}
comment|/*     Right edge */
name|i1
operator|=
name|start
operator|-
literal|1
expr_stmt|;
name|i2
operator|=
name|start
expr_stmt|;
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|right
operator|-
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|left
expr_stmt|;
name|y1
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
name|start
operator|+
literal|1
init|;
name|i
operator|<
name|b
operator|->
name|height
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|present
index|[
name|i
index|]
operator|&
name|EDGE_RIGHT
operator|)
condition|)
continue|continue;
name|x2
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|-
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|right
expr_stmt|;
name|y2
operator|=
name|i
operator|-
name|i2
expr_stmt|;
while|while
condition|(
name|x2
operator|*
name|y1
operator|-
name|x1
operator|*
name|y2
operator|>
literal|0
condition|)
comment|/* counter-clockwise rotation */
block|{
name|present
index|[
name|i2
index|]
operator|&=
operator|~
name|EDGE_RIGHT
expr_stmt|;
name|i2
operator|=
name|i1
expr_stmt|;
while|while
condition|(
operator|!
operator|(
name|present
index|[
operator|--
name|i1
index|]
operator|&
name|EDGE_RIGHT
operator|)
operator|&&
name|i1
operator|>=
name|start
condition|)
empty_stmt|;
if|if
condition|(
name|i1
operator|<
name|start
condition|)
block|{
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|right
operator|-
name|b
operator|->
name|data
index|[
name|start
index|]
operator|.
name|left
expr_stmt|;
name|y1
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|right
operator|-
name|b
operator|->
name|data
index|[
name|i1
index|]
operator|.
name|right
expr_stmt|;
name|y1
operator|=
name|i2
operator|-
name|i1
expr_stmt|;
block|}
name|x2
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|-
name|b
operator|->
name|data
index|[
name|i2
index|]
operator|.
name|right
expr_stmt|;
name|y2
operator|=
name|i
operator|-
name|i2
expr_stmt|;
block|}
name|x1
operator|=
name|x2
expr_stmt|;
name|y1
operator|=
name|y2
expr_stmt|;
name|i1
operator|=
name|i2
expr_stmt|;
name|i2
operator|=
name|i
expr_stmt|;
block|}
name|airbrush_blob_fill
argument_list|(
name|b
argument_list|,
name|present
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|AirBrushBlob
modifier|*
DECL|function|airbrush_blob_convex_union (AirBrushBlob * b1,AirBrushBlob * b2)
name|airbrush_blob_convex_union
parameter_list|(
name|AirBrushBlob
modifier|*
name|b1
parameter_list|,
name|AirBrushBlob
modifier|*
name|b2
parameter_list|)
block|{
name|AirBrushBlob
modifier|*
name|result
decl_stmt|;
name|int
name|y
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|EdgeType
modifier|*
name|present
decl_stmt|;
comment|/* Create the storage for the result */
name|y
operator|=
name|MIN
argument_list|(
name|b1
operator|->
name|y
argument_list|,
name|b2
operator|->
name|y
argument_list|)
expr_stmt|;
name|result
operator|=
name|airbrush_blob_new
argument_list|(
name|y
argument_list|,
name|MAX
argument_list|(
name|b1
operator|->
name|y
operator|+
name|b1
operator|->
name|height
argument_list|,
name|b2
operator|->
name|y
operator|+
name|b2
operator|->
name|height
argument_list|)
operator|-
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|->
name|height
operator|==
literal|0
condition|)
return|return
name|result
return|;
name|present
operator|=
name|g_new0
argument_list|(
name|EdgeType
argument_list|,
name|result
operator|->
name|height
argument_list|)
expr_stmt|;
comment|/* Initialize spans from original objects */
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
name|b1
operator|->
name|y
operator|-
name|y
init|;
name|i
operator|<
name|b1
operator|->
name|height
condition|;
name|i
operator|++
operator|,
name|j
operator|++
control|)
block|{
if|if
condition|(
name|b1
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|>=
name|b1
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
condition|)
block|{
name|present
index|[
name|j
index|]
operator|=
name|EDGE_LEFT
operator||
name|EDGE_RIGHT
expr_stmt|;
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|left
operator|=
name|b1
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
expr_stmt|;
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|right
operator|=
name|b1
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
expr_stmt|;
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|j
operator|=
name|b2
operator|->
name|y
operator|-
name|y
init|;
name|i
operator|<
name|b2
operator|->
name|height
condition|;
name|i
operator|++
operator|,
name|j
operator|++
control|)
block|{
if|if
condition|(
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|>=
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
condition|)
block|{
if|if
condition|(
name|present
index|[
name|j
index|]
condition|)
block|{
if|if
condition|(
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|left
operator|>
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
condition|)
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|left
operator|=
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
expr_stmt|;
if|if
condition|(
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|right
operator|<
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|)
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|right
operator|=
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
expr_stmt|;
block|}
else|else
block|{
name|present
index|[
name|j
index|]
operator|=
name|EDGE_LEFT
operator||
name|EDGE_RIGHT
expr_stmt|;
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|left
operator|=
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
expr_stmt|;
name|result
operator|->
name|data
index|[
name|j
index|]
operator|.
name|right
operator|=
name|b2
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
expr_stmt|;
block|}
block|}
block|}
name|airbrush_blob_make_convex
argument_list|(
name|result
argument_list|,
name|present
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|present
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_comment
comment|/* You must be able to divide TABLE_SIZE with 4*/
end_comment

begin_define
DECL|macro|TABLE_SIZE
define|#
directive|define
name|TABLE_SIZE
value|256
end_define

begin_define
DECL|macro|TABLE_QUARTER
define|#
directive|define
name|TABLE_QUARTER
value|TABLE_SIZE/4
end_define

begin_define
DECL|macro|ELLIPSE_SHIFT
define|#
directive|define
name|ELLIPSE_SHIFT
value|2
end_define

begin_define
DECL|macro|TABLE_SHIFT
define|#
directive|define
name|TABLE_SHIFT
value|14
end_define

begin_define
DECL|macro|TOTAL_SHIFT
define|#
directive|define
name|TOTAL_SHIFT
value|(ELLIPSE_SHIFT + TABLE_SHIFT)
end_define

begin_decl_stmt
DECL|variable|trig_initialized
specifier|static
name|int
name|trig_initialized
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|trig_table
specifier|static
name|int
name|trig_table
index|[
name|TABLE_SIZE
index|]
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|POWFAC
define|#
directive|define
name|POWFAC
value|0.999
end_define

begin_comment
comment|/* Scan convert an ellipse specified by _offsets_ of major and    minor axes, and by center into a airbrush_blob */
end_comment

begin_comment
comment|/* Warning UGLY code ahead :-)*/
end_comment

begin_function
name|AirBrushBlob
modifier|*
DECL|function|airbrush_blob_ellipse (double xc,double yc,double xt,double yt,double xr,double yr,double xb,double yb,double xl,double yl)
name|airbrush_blob_ellipse
parameter_list|(
name|double
name|xc
parameter_list|,
name|double
name|yc
parameter_list|,
name|double
name|xt
parameter_list|,
name|double
name|yt
parameter_list|,
name|double
name|xr
parameter_list|,
name|double
name|yr
parameter_list|,
name|double
name|xb
parameter_list|,
name|double
name|yb
parameter_list|,
name|double
name|xl
parameter_list|,
name|double
name|yl
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|AirBrushBlob
modifier|*
name|rma
decl_stmt|,
modifier|*
name|rmi
decl_stmt|,
modifier|*
name|rtot
decl_stmt|;
name|gint
name|maxyma
decl_stmt|,
name|minyma
decl_stmt|,
name|maxymi
decl_stmt|,
name|minymi
decl_stmt|;
name|gint
name|step
decl_stmt|;
name|double
name|max_radius
decl_stmt|;
name|double
name|ma_ang1
decl_stmt|,
name|ma_ang2
decl_stmt|;
name|double
name|x1
decl_stmt|,
name|x2
decl_stmt|,
name|y1
decl_stmt|,
name|y2
decl_stmt|;
name|double
name|xtotma
decl_stmt|,
name|ytotma
decl_stmt|;
name|double
name|xcma
decl_stmt|,
name|ycma
decl_stmt|,
name|ytma
decl_stmt|,
name|xrma
decl_stmt|,
name|ybma
decl_stmt|,
name|xlma
decl_stmt|;
name|double
name|xcmi
decl_stmt|,
name|ycmi
decl_stmt|,
name|ytmi
decl_stmt|,
name|xrmi
decl_stmt|,
name|ybmi
decl_stmt|,
name|xlmi
decl_stmt|;
name|double
name|mapoint_i
decl_stmt|,
name|mapoint
decl_stmt|;
name|gint
name|xcma_shift
decl_stmt|,
name|ycma_shift
decl_stmt|;
name|gint
name|xcmi_shift
decl_stmt|,
name|ycmi_shift
decl_stmt|;
name|gint
name|ytma_shift
decl_stmt|,
name|ytmi_shift
decl_stmt|;
name|gint
name|xrma_shift
decl_stmt|,
name|xrmi_shift
decl_stmt|;
name|gint
name|ybma_shift
decl_stmt|,
name|ybmi_shift
decl_stmt|;
name|gint
name|xlma_shift
decl_stmt|,
name|xlmi_shift
decl_stmt|;
name|EdgeType
modifier|*
name|presentma
decl_stmt|;
name|EdgeType
modifier|*
name|presentmi
decl_stmt|;
if|if
condition|(
operator|(
name|yt
operator|==
name|yb
operator|)
operator|&&
operator|(
name|xr
operator|==
name|xl
operator|)
operator|&&
operator|(
name|yt
operator|==
name|xr
operator|)
condition|)
block|{
comment|/*Zero*/
name|ytma
operator|=
name|ytmi
operator|=
name|xrma
operator|=
name|xrmi
operator|=
name|ybma
operator|=
name|ybmi
operator|=
name|xlma
operator|=
name|xlmi
operator|=
name|yt
expr_stmt|;
name|ycma
operator|=
name|ycmi
operator|=
name|yc
expr_stmt|;
name|xcma
operator|=
name|xcmi
operator|=
name|xc
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|xr
operator|==
name|xl
condition|)
block|{
if|if
condition|(
name|yt
operator|>
name|yb
condition|)
block|{
comment|/*South*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|xl
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yt
operator|*
name|yt
operator|)
operator|/
name|yb
operator|)
operator|-
name|yt
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
expr_stmt|;
name|ycma
operator|=
name|yc
operator|+
name|mapoint
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|-
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
else|else
block|{
comment|/*North*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|xl
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yb
operator|*
name|yb
operator|)
operator|/
name|yt
operator|)
operator|-
name|yb
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
expr_stmt|;
name|ycma
operator|=
name|yc
operator|-
name|mapoint
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|+
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|yt
operator|==
name|yb
condition|)
block|{
if|if
condition|(
name|xr
operator|>
name|xl
condition|)
block|{
comment|/*East*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|yt
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|xr
operator|*
name|xr
operator|)
operator|/
name|xl
operator|)
operator|-
name|xr
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|mapoint
operator|+
name|xc
expr_stmt|;
name|ycma
operator|=
name|yc
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|ybmi
operator|=
name|xrmi
operator|=
name|xlmi
operator|=
name|yt
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|-
name|mapoint
operator|/
literal|2
expr_stmt|;
name|ycmi
operator|=
name|yc
expr_stmt|;
block|}
else|else
block|{
comment|/*West*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|yt
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|xl
operator|*
name|xl
operator|)
operator|/
name|xr
operator|)
operator|-
name|xl
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|-
name|mapoint
expr_stmt|;
name|ycma
operator|=
name|yc
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|ybmi
operator|=
name|xrmi
operator|=
name|xlmi
operator|=
name|yt
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|+
name|mapoint
operator|/
literal|2
expr_stmt|;
name|ycmi
operator|=
name|yc
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|yt
operator|>
name|yb
operator|)
operator|&&
operator|(
name|xr
operator|>
name|xl
operator|)
condition|)
block|{
comment|/*SouthEast*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yt
operator|/
name|xr
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yt
operator|*
name|yt
operator|+
name|xr
operator|*
name|xr
operator|)
operator|/
name|hypot
argument_list|(
name|yb
argument_list|,
name|xl
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yt
argument_list|,
name|xr
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yb
argument_list|,
name|xl
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|yt
operator|>
name|yb
operator|)
operator|&&
operator|(
name|xl
operator|>
name|xr
operator|)
condition|)
block|{
comment|/*SouthWest*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yt
operator|/
name|xl
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yt
operator|*
name|yt
operator|+
name|xl
operator|*
name|xl
operator|)
operator|/
name|hypot
argument_list|(
name|yb
argument_list|,
name|xr
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yt
argument_list|,
name|xl
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yb
argument_list|,
name|xr
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|yb
operator|>
name|yt
operator|)
operator|&&
operator|(
name|xl
operator|>
name|xr
operator|)
condition|)
block|{
comment|/*NorthWest*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yb
operator|/
name|xl
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yb
operator|*
name|yb
operator|+
name|xl
operator|*
name|xl
operator|)
operator|/
name|hypot
argument_list|(
name|yt
argument_list|,
name|xr
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yb
argument_list|,
name|xl
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yt
argument_list|,
name|xr
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
block|}
else|else
comment|/*if ((yb> yt)&& (xr> xl))*/
block|{
comment|/*NorthEast*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yb
operator|/
name|xr
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yb
operator|*
name|yb
operator|+
name|xr
operator|*
name|xr
operator|)
operator|/
name|hypot
argument_list|(
name|yt
argument_list|,
name|xl
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yb
argument_list|,
name|xr
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yt
argument_list|,
name|xl
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|ytmi
operator|<=
literal|0
condition|)
block|{
name|ytmi
operator|=
name|ybmi
operator|=
name|xrmi
operator|=
name|xlmi
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|ytma
operator|<=
literal|0
condition|)
block|{
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|trig_initialized
condition|)
block|{
name|trig_initialized
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
name|trig_table
index|[
name|i
index|]
operator|=
literal|0.5
operator|+
name|sin
argument_list|(
name|i
operator|*
operator|(
name|G_PI
operator|/
literal|128.0
operator|)
argument_list|)
operator|*
operator|(
literal|1
operator|<<
name|TABLE_SHIFT
operator|)
expr_stmt|;
block|}
comment|/*Make the Max circle*/
name|maxyma
operator|=
name|ceil
argument_list|(
name|ycma
operator|+
name|fabs
argument_list|(
name|ytma
argument_list|)
argument_list|)
expr_stmt|;
name|minyma
operator|=
name|floor
argument_list|(
name|ycma
operator|-
name|fabs
argument_list|(
name|ybma
argument_list|)
argument_list|)
expr_stmt|;
name|rma
operator|=
name|airbrush_blob_new
argument_list|(
name|minyma
argument_list|,
name|maxyma
operator|-
name|minyma
operator|+
literal|1
argument_list|)
expr_stmt|;
name|presentma
operator|=
name|g_new0
argument_list|(
name|EdgeType
argument_list|,
name|rma
operator|->
name|height
argument_list|)
expr_stmt|;
name|max_radius
operator|=
name|ytma
expr_stmt|;
name|step
operator|=
name|TABLE_SIZE
expr_stmt|;
while|while
condition|(
name|step
operator|>
literal|1
operator|&&
operator|(
name|TABLE_SIZE
operator|/
name|step
operator|<
literal|4
operator|*
name|max_radius
operator|)
condition|)
name|step
operator|>>=
literal|1
expr_stmt|;
comment|/* Fill in the edge points */
name|xcma_shift
operator|=
literal|0.5
operator|+
name|xcma
operator|*
operator|(
literal|1
operator|<<
name|TOTAL_SHIFT
operator|)
expr_stmt|;
name|ycma_shift
operator|=
literal|0.5
operator|+
name|ycma
operator|*
operator|(
literal|1
operator|<<
name|TOTAL_SHIFT
operator|)
expr_stmt|;
name|ytma_shift
operator|=
literal|0.5
operator|+
name|ytma
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
name|xrma_shift
operator|=
literal|0.5
operator|+
name|xrma
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
name|ybma_shift
operator|=
literal|0.5
operator|+
name|ybma
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
name|xlma_shift
operator|=
literal|0.5
operator|+
name|xlma
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TABLE_SIZE
condition|;
name|i
operator|+=
name|step
control|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|yi
decl_stmt|,
name|dydi
decl_stmt|;
name|gint
name|s
init|=
name|trig_table
index|[
name|i
index|]
decl_stmt|;
name|gint
name|c
init|=
name|trig_table
index|[
operator|(
name|TABLE_SIZE
operator|+
name|TABLE_SIZE
operator|/
literal|4
operator|-
name|i
operator|)
operator|%
name|TABLE_SIZE
index|]
decl_stmt|;
if|if
condition|(
name|i
operator|<
name|TABLE_QUARTER
condition|)
block|{
name|x
operator|=
operator|(
name|xcma_shift
operator|+
name|c
operator|*
name|xrma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|yi
operator|=
operator|(
name|ycma_shift
operator|+
name|s
operator|*
name|ytma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
name|yi
operator|-
name|rma
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|i
operator|<
operator|(
literal|2
operator|*
name|TABLE_QUARTER
operator|)
condition|)
block|{
name|x
operator|=
operator|(
name|xcma_shift
operator|+
name|c
operator|*
name|xlma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|yi
operator|=
operator|(
name|ycma_shift
operator|+
name|s
operator|*
name|ytma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
name|yi
operator|-
name|rma
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|i
operator|<
operator|(
literal|3
operator|*
name|TABLE_QUARTER
operator|)
condition|)
block|{
name|x
operator|=
operator|(
name|xcma_shift
operator|+
name|c
operator|*
name|xlma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|yi
operator|=
operator|(
name|ycma_shift
operator|+
name|s
operator|*
name|ybma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
name|yi
operator|-
name|rma
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|x
operator|=
operator|(
name|xcma_shift
operator|+
name|c
operator|*
name|xrma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
operator|(
operator|(
name|ycma_shift
operator|+
name|s
operator|*
name|ybma_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
operator|)
operator|-
name|rma
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|dydi
operator|<=
literal|0
condition|)
comment|/* left edge */
block|{
if|if
condition|(
name|presentma
index|[
name|y
index|]
operator|&
name|EDGE_LEFT
condition|)
block|{
name|rma
operator|->
name|data
index|[
name|y
index|]
operator|.
name|left
operator|=
name|MIN
argument_list|(
name|rma
operator|->
name|data
index|[
name|y
index|]
operator|.
name|left
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|presentma
index|[
name|y
index|]
operator||=
name|EDGE_LEFT
expr_stmt|;
name|rma
operator|->
name|data
index|[
name|y
index|]
operator|.
name|left
operator|=
name|x
expr_stmt|;
block|}
block|}
if|if
condition|(
name|dydi
operator|>
literal|0
condition|)
comment|/* right edge */
block|{
if|if
condition|(
name|presentma
index|[
name|y
index|]
operator|&
name|EDGE_RIGHT
condition|)
block|{
name|rma
operator|->
name|data
index|[
name|y
index|]
operator|.
name|right
operator|=
name|MAX
argument_list|(
name|rma
operator|->
name|data
index|[
name|y
index|]
operator|.
name|right
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|presentma
index|[
name|y
index|]
operator||=
name|EDGE_RIGHT
expr_stmt|;
name|rma
operator|->
name|data
index|[
name|y
index|]
operator|.
name|right
operator|=
name|x
expr_stmt|;
block|}
block|}
block|}
comment|/* Now fill in missing points */
name|airbrush_blob_fill
argument_list|(
name|rma
argument_list|,
name|presentma
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|presentma
argument_list|)
expr_stmt|;
comment|/*Make the Min circle*/
name|maxymi
operator|=
name|ceil
argument_list|(
name|ycmi
operator|+
name|fabs
argument_list|(
name|ytmi
argument_list|)
argument_list|)
expr_stmt|;
name|minymi
operator|=
name|floor
argument_list|(
name|ycmi
operator|-
name|fabs
argument_list|(
name|ybmi
argument_list|)
argument_list|)
expr_stmt|;
name|rmi
operator|=
name|airbrush_blob_new
argument_list|(
name|minymi
argument_list|,
name|maxymi
operator|-
name|minymi
operator|+
literal|1
argument_list|)
expr_stmt|;
name|presentmi
operator|=
name|g_new0
argument_list|(
name|EdgeType
argument_list|,
name|rmi
operator|->
name|height
argument_list|)
expr_stmt|;
name|max_radius
operator|=
name|ytmi
expr_stmt|;
name|step
operator|=
name|TABLE_SIZE
expr_stmt|;
while|while
condition|(
name|step
operator|>
literal|1
operator|&&
operator|(
name|TABLE_SIZE
operator|/
name|step
operator|<
literal|4
operator|*
name|max_radius
operator|)
condition|)
name|step
operator|>>=
literal|1
expr_stmt|;
comment|/* Fill in the edge points */
name|xcmi_shift
operator|=
literal|0.5
operator|+
name|xcmi
operator|*
operator|(
literal|1
operator|<<
name|TOTAL_SHIFT
operator|)
expr_stmt|;
name|ycmi_shift
operator|=
literal|0.5
operator|+
name|ycmi
operator|*
operator|(
literal|1
operator|<<
name|TOTAL_SHIFT
operator|)
expr_stmt|;
name|ytmi_shift
operator|=
literal|0.5
operator|+
name|ytmi
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
name|xrmi_shift
operator|=
literal|0.5
operator|+
name|xrmi
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
name|ybmi_shift
operator|=
literal|0.5
operator|+
name|ybmi
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
name|xlmi_shift
operator|=
literal|0.5
operator|+
name|xlmi
operator|*
operator|(
literal|1
operator|<<
name|ELLIPSE_SHIFT
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TABLE_SIZE
condition|;
name|i
operator|+=
name|step
control|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|yi
decl_stmt|,
name|dydi
decl_stmt|;
name|gint
name|s
init|=
name|trig_table
index|[
name|i
index|]
decl_stmt|;
name|gint
name|c
init|=
name|trig_table
index|[
operator|(
name|TABLE_SIZE
operator|+
name|TABLE_SIZE
operator|/
literal|4
operator|-
name|i
operator|)
operator|%
name|TABLE_SIZE
index|]
decl_stmt|;
if|if
condition|(
name|i
operator|<
name|TABLE_QUARTER
condition|)
block|{
name|x
operator|=
operator|(
name|xcmi_shift
operator|+
name|c
operator|*
name|xrmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|yi
operator|=
operator|(
name|ycmi_shift
operator|+
name|s
operator|*
name|ytmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
name|yi
operator|-
name|rmi
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|i
operator|<
operator|(
literal|2
operator|*
name|TABLE_QUARTER
operator|)
condition|)
block|{
name|x
operator|=
operator|(
name|xcmi_shift
operator|+
name|c
operator|*
name|xlmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|yi
operator|=
operator|(
name|ycmi_shift
operator|+
name|s
operator|*
name|ytmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
name|yi
operator|-
name|rmi
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
operator|-
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|i
operator|<
operator|(
literal|3
operator|*
name|TABLE_QUARTER
operator|)
condition|)
block|{
name|x
operator|=
operator|(
name|xcmi_shift
operator|+
name|c
operator|*
name|xlmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|yi
operator|=
operator|(
name|ycmi_shift
operator|+
name|s
operator|*
name|ybmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
name|yi
operator|-
name|rmi
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|x
operator|=
operator|(
name|xcmi_shift
operator|+
name|c
operator|*
name|xrmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
expr_stmt|;
name|y
operator|=
operator|(
operator|(
name|ycmi_shift
operator|+
name|s
operator|*
name|ybmi_shift
operator|+
operator|(
literal|1
operator|<<
operator|(
name|TOTAL_SHIFT
operator|-
literal|1
operator|)
operator|)
operator|)
operator|>>
name|TOTAL_SHIFT
operator|)
operator|-
name|rmi
operator|->
name|y
expr_stmt|;
name|dydi
operator|=
literal|1
expr_stmt|;
block|}
if|if
condition|(
name|dydi
operator|<=
literal|0
condition|)
comment|/* left edge */
block|{
if|if
condition|(
name|presentmi
index|[
name|y
index|]
operator|&
name|EDGE_LEFT
condition|)
block|{
name|rmi
operator|->
name|data
index|[
name|y
index|]
operator|.
name|left
operator|=
name|MIN
argument_list|(
name|rmi
operator|->
name|data
index|[
name|y
index|]
operator|.
name|left
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|presentmi
index|[
name|y
index|]
operator||=
name|EDGE_LEFT
expr_stmt|;
name|rmi
operator|->
name|data
index|[
name|y
index|]
operator|.
name|left
operator|=
name|x
expr_stmt|;
block|}
block|}
if|if
condition|(
name|dydi
operator|>
literal|0
condition|)
comment|/* right edge */
block|{
if|if
condition|(
name|presentmi
index|[
name|y
index|]
operator|&
name|EDGE_RIGHT
condition|)
block|{
name|rmi
operator|->
name|data
index|[
name|y
index|]
operator|.
name|right
operator|=
name|MAX
argument_list|(
name|rmi
operator|->
name|data
index|[
name|y
index|]
operator|.
name|right
argument_list|,
name|x
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|presentmi
index|[
name|y
index|]
operator||=
name|EDGE_RIGHT
expr_stmt|;
name|rmi
operator|->
name|data
index|[
name|y
index|]
operator|.
name|right
operator|=
name|x
expr_stmt|;
block|}
block|}
block|}
comment|/* Now fill in missing points */
name|airbrush_blob_fill
argument_list|(
name|rmi
argument_list|,
name|presentmi
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|presentmi
argument_list|)
expr_stmt|;
name|rtot
operator|=
name|airbrush_blob_convex_union
argument_list|(
name|rma
argument_list|,
name|rmi
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|rma
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|rmi
argument_list|)
expr_stmt|;
return|return
name|rtot
return|;
block|}
end_function

begin_function
name|void
DECL|function|airbrush_blob_bounds (AirBrushBlob * b,int * x,int * y,int * width,int * height)
name|airbrush_blob_bounds
parameter_list|(
name|AirBrushBlob
modifier|*
name|b
parameter_list|,
name|int
modifier|*
name|x
parameter_list|,
name|int
modifier|*
name|y
parameter_list|,
name|int
modifier|*
name|width
parameter_list|,
name|int
modifier|*
name|height
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|x0
decl_stmt|,
name|x1
decl_stmt|,
name|y0
decl_stmt|,
name|y1
decl_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|b
operator|->
name|height
operator|&&
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|>
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|)
name|i
operator|++
expr_stmt|;
if|if
condition|(
name|i
operator|<
name|b
operator|->
name|height
condition|)
block|{
name|y0
operator|=
name|b
operator|->
name|y
operator|+
name|i
expr_stmt|;
name|x0
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
expr_stmt|;
name|x1
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|+
literal|1
expr_stmt|;
while|while
condition|(
name|i
operator|<
name|b
operator|->
name|height
operator|&&
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|<=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|)
block|{
name|x0
operator|=
name|MIN
argument_list|(
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
argument_list|,
name|x0
argument_list|)
expr_stmt|;
name|x1
operator|=
name|MAX
argument_list|(
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|+
literal|1
argument_list|,
name|x1
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
name|y1
operator|=
name|b
operator|->
name|y
operator|+
name|i
expr_stmt|;
block|}
else|else
block|{
name|x0
operator|=
name|y0
operator|=
literal|0
expr_stmt|;
name|x1
operator|=
name|y1
operator|=
literal|0
expr_stmt|;
block|}
operator|*
name|x
operator|=
name|x0
expr_stmt|;
operator|*
name|y
operator|=
name|y0
expr_stmt|;
operator|*
name|width
operator|=
name|x1
operator|-
name|x0
expr_stmt|;
operator|*
name|height
operator|=
name|y1
operator|-
name|y0
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|airbrush_blob_dump (AirBrushBlob * b)
name|airbrush_blob_dump
parameter_list|(
name|AirBrushBlob
modifier|*
name|b
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|b
operator|->
name|height
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
condition|;
name|j
operator|++
control|)
name|putchar
argument_list|(
literal|' '
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
init|;
name|j
operator|<=
name|b
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|;
name|j
operator|++
control|)
name|putchar
argument_list|(
literal|'*'
argument_list|)
expr_stmt|;
name|putchar
argument_list|(
literal|'\n'
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* This is just a first try to see how it works i.e ugly code :-) */
end_comment

begin_function
name|AirBlob
modifier|*
DECL|function|create_air_blob (double xc,double yc,double xt,double yt,double xr,double yr,double xb,double yb,double xl,double yl,double direction_abs,double direction)
name|create_air_blob
parameter_list|(
name|double
name|xc
parameter_list|,
name|double
name|yc
parameter_list|,
name|double
name|xt
parameter_list|,
name|double
name|yt
parameter_list|,
name|double
name|xr
parameter_list|,
name|double
name|yr
parameter_list|,
name|double
name|xb
parameter_list|,
name|double
name|yb
parameter_list|,
name|double
name|xl
parameter_list|,
name|double
name|yl
parameter_list|,
name|double
name|direction_abs
parameter_list|,
name|double
name|direction
parameter_list|)
block|{
name|AirBlob
modifier|*
name|air_blob
decl_stmt|;
name|double
name|ma_ang1
decl_stmt|,
name|ma_ang2
decl_stmt|;
name|double
name|x1
decl_stmt|,
name|x2
decl_stmt|,
name|y1
decl_stmt|,
name|y2
decl_stmt|;
name|double
name|xtotma
decl_stmt|,
name|ytotma
decl_stmt|;
name|double
name|xcma
decl_stmt|,
name|ycma
decl_stmt|,
name|ytma
decl_stmt|,
name|xrma
decl_stmt|,
name|ybma
decl_stmt|,
name|xlma
decl_stmt|;
name|double
name|xcmi
decl_stmt|,
name|ycmi
decl_stmt|,
name|ytmi
decl_stmt|,
name|xrmi
decl_stmt|,
name|ybmi
decl_stmt|,
name|xlmi
decl_stmt|;
name|double
name|mapoint_i
decl_stmt|,
name|mapoint
decl_stmt|;
name|air_blob
operator|=
name|airblob_new
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|air_blob
operator|->
name|direction_abs
operator|=
name|direction_abs
expr_stmt|;
name|air_blob
operator|->
name|direction
operator|=
name|direction
expr_stmt|;
name|air_blob
operator|->
name|ycenter
operator|=
name|yc
expr_stmt|;
name|air_blob
operator|->
name|xcenter
operator|=
name|xc
expr_stmt|;
if|if
condition|(
operator|(
name|yt
operator|==
name|yb
operator|)
operator|&&
operator|(
name|xr
operator|==
name|xl
operator|)
operator|&&
operator|(
name|yt
operator|==
name|xr
operator|)
condition|)
block|{
comment|/*Zero*/
name|ytma
operator|=
name|ytmi
operator|=
name|xrma
operator|=
name|xrmi
operator|=
name|ybma
operator|=
name|ybmi
operator|=
name|xlma
operator|=
name|xlmi
operator|=
name|yt
expr_stmt|;
name|ycma
operator|=
name|ycmi
operator|=
name|yc
expr_stmt|;
name|xcma
operator|=
name|xcmi
operator|=
name|xc
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|yt
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|yt
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|yt
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
literal|0.0
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|yt
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
literal|0.0
expr_stmt|;
name|air_blob
operator|->
name|direction
operator|=
name|G_PI_2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|xr
operator|==
name|xl
condition|)
block|{
if|if
condition|(
name|yt
operator|>
name|yb
condition|)
block|{
comment|/*South*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|xl
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yt
operator|*
name|yt
operator|)
operator|/
name|yb
operator|)
operator|-
name|yt
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
expr_stmt|;
name|ycma
operator|=
name|yc
operator|+
name|mapoint
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|-
name|mapoint
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|xl
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|xl
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xl
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
else|else
block|{
comment|/*North*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|xl
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yb
operator|*
name|yb
operator|)
operator|/
name|yt
operator|)
operator|-
name|yb
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
expr_stmt|;
name|ycma
operator|=
name|yc
operator|-
name|mapoint
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|+
name|mapoint
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|xl
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|xl
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xl
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|yt
operator|==
name|yb
condition|)
block|{
if|if
condition|(
name|xr
operator|>
name|xl
condition|)
block|{
comment|/*East*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|yt
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|xr
operator|*
name|xr
operator|)
operator|/
name|xl
operator|)
operator|-
name|xr
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|mapoint
operator|+
name|xc
expr_stmt|;
name|ycma
operator|=
name|yc
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|ybmi
operator|=
name|xrmi
operator|=
name|xlmi
operator|=
name|yt
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|-
name|mapoint
operator|/
literal|2
expr_stmt|;
name|ycmi
operator|=
name|yc
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|yt
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|yt
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xl
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
else|else
block|{
comment|/*West*/
comment|/*The Max circle*/
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|yt
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|xl
operator|*
name|xl
operator|)
operator|/
name|xr
operator|)
operator|-
name|xl
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|-
name|mapoint
expr_stmt|;
name|ycma
operator|=
name|yc
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|ybmi
operator|=
name|xrmi
operator|=
name|xlmi
operator|=
name|yt
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|+
name|mapoint
operator|/
literal|2
expr_stmt|;
name|ycmi
operator|=
name|yc
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|yt
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|yt
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xl
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xl
operator|/
literal|2
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|yt
operator|>
name|yb
operator|)
operator|&&
operator|(
name|xr
operator|>
name|xl
operator|)
condition|)
block|{
comment|/*SouthEast*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yt
operator|/
name|xr
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yt
operator|*
name|yt
operator|+
name|xr
operator|*
name|xr
operator|)
operator|/
name|hypot
argument_list|(
name|yb
argument_list|,
name|xl
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yt
argument_list|,
name|xr
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yb
argument_list|,
name|xl
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|xlma
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xlma
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|yt
operator|>
name|yb
operator|)
operator|&&
operator|(
name|xl
operator|>
name|xr
operator|)
condition|)
block|{
comment|/*SouthWest*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yt
operator|/
name|xl
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yt
operator|*
name|yt
operator|+
name|xl
operator|*
name|xl
operator|)
operator|/
name|hypot
argument_list|(
name|yb
argument_list|,
name|xr
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yt
argument_list|,
name|xl
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yb
argument_list|,
name|xr
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|xlma
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xlma
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|yb
operator|>
name|yt
operator|)
operator|&&
operator|(
name|xl
operator|>
name|xr
operator|)
condition|)
block|{
comment|/*NorthWest*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yb
operator|/
name|xl
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yb
operator|*
name|yb
operator|+
name|xl
operator|*
name|xl
operator|)
operator|/
name|hypot
argument_list|(
name|yt
argument_list|,
name|xr
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yb
argument_list|,
name|xl
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yt
argument_list|,
name|xr
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|xlma
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xlma
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
else|else
comment|/*if ((yb> yt)&& (xr> xl))*/
block|{
comment|/*NorthEast*/
comment|/*The Max circle*/
name|ma_ang1
operator|=
name|atan
argument_list|(
name|yb
operator|/
name|xr
argument_list|)
expr_stmt|;
name|x1
operator|=
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|xr
expr_stmt|;
name|y1
operator|=
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|yt
expr_stmt|;
name|ma_ang2
operator|=
name|G_PI_2
operator|-
name|ma_ang1
expr_stmt|;
name|x2
operator|=
name|cos
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|xl
expr_stmt|;
name|y2
operator|=
name|sin
argument_list|(
name|ma_ang2
argument_list|)
operator|*
name|yb
expr_stmt|;
name|xtotma
operator|=
name|x1
operator|+
name|x2
expr_stmt|;
name|ytotma
operator|=
name|y1
operator|+
name|y2
expr_stmt|;
name|ytma
operator|=
name|ybma
operator|=
name|xrma
operator|=
name|xlma
operator|=
name|hypot
argument_list|(
name|ytotma
argument_list|,
name|xtotma
argument_list|)
operator|/
literal|2
expr_stmt|;
name|mapoint_i
operator|=
operator|(
operator|(
operator|(
name|yb
operator|*
name|yb
operator|+
name|xr
operator|*
name|xr
operator|)
operator|/
name|hypot
argument_list|(
name|yt
argument_list|,
name|xl
argument_list|)
operator|)
operator|-
name|hypot
argument_list|(
name|yb
argument_list|,
name|xr
argument_list|)
operator|)
expr_stmt|;
name|mapoint
operator|=
name|mapoint_i
operator|*
name|pow
argument_list|(
name|POWFAC
argument_list|,
name|mapoint_i
argument_list|)
expr_stmt|;
name|xcma
operator|=
name|xc
operator|+
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
name|ycma
operator|=
name|yc
operator|-
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|)
expr_stmt|;
comment|/*The Min Circle*/
name|ytmi
operator|=
name|xrmi
operator|=
name|ybmi
operator|=
name|xlmi
operator|=
name|hypot
argument_list|(
name|yt
argument_list|,
name|xl
argument_list|)
operator|/
literal|2
expr_stmt|;
name|xcmi
operator|=
name|xc
operator|-
operator|(
name|cos
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|ycmi
operator|=
name|yc
operator|+
operator|(
name|sin
argument_list|(
name|ma_ang1
argument_list|)
operator|*
name|mapoint
operator|*
literal|0.5
operator|)
expr_stmt|;
name|air_blob
operator|->
name|main_line
operator|.
name|size
operator|=
name|mapoint
operator|+
name|xlma
expr_stmt|;
name|air_blob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|mapoint
operator|/
literal|2
operator|+
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|xlma
operator|*
literal|2
expr_stmt|;
name|air_blob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|mapoint
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|xlmi
expr_stmt|;
name|air_blob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|mapoint
operator|/
literal|2
expr_stmt|;
block|}
return|return
name|air_blob
return|;
block|}
end_function

begin_function
name|AirLine
modifier|*
DECL|function|create_air_line (AirBlob * airblob)
name|create_air_line
parameter_list|(
name|AirBlob
modifier|*
name|airblob
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|double
name|xcenter
decl_stmt|,
name|ycenter
decl_stmt|;
name|double
name|direction
decl_stmt|;
name|double
name|masupport
decl_stmt|,
name|misupport
decl_stmt|;
name|double
name|ma_angsupport
decl_stmt|,
name|mi_angsupport
decl_stmt|,
name|iang
decl_stmt|;
name|int
name|min_x
decl_stmt|,
name|max_x
decl_stmt|;
name|int
name|min_y
decl_stmt|,
name|max_y
decl_stmt|;
name|AirLine
modifier|*
name|airline
decl_stmt|;
comment|/*       Yes I know I can do a cal of number of lines, but it is for      the moment much easier to just set a side mem for 16 lines   */
name|airline
operator|=
name|airline_new
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|xcenter
operator|=
name|airblob
operator|->
name|xcenter
expr_stmt|;
name|ycenter
operator|=
name|airblob
operator|->
name|ycenter
expr_stmt|;
name|airline
operator|->
name|xcenter
operator|=
name|xcenter
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|ycenter
operator|=
name|ycenter
operator|/
name|SUBSAMPLE
expr_stmt|;
name|direction
operator|=
name|airblob
operator|->
name|direction_abs
expr_stmt|;
comment|/*     printf("Direction: %f\n", direction);     printf("Xcenter: %f\n",xcenter/SUBSAMPLE);     printf("Ycenter: %f\n",ycenter/SUBSAMPLE);     printf("MaCr.dist: %f\n",airblob->maincross_line.dist);     printf("MaCr.size: %f\n",airblob->maincross_line.size);     printf("MiCr.dist: %f\n",airblob->minorcross_line.dist);     printf("MiCr.size: %f\n",airblob->minorcross_line.size);     printf("Ma.size: %f\n",airblob->main_line.size);     printf("Mi.size: %f\n",airblob->minor_line.size);   */
if|if
condition|(
name|direction
operator|==
name|G_PI_2
operator|||
name|direction
operator|==
name|G_PI
condition|)
block|{
name|direction
operator|=
name|direction
operator|-
literal|0.001
expr_stmt|;
block|}
if|if
condition|(
name|direction
operator|==
operator|-
name|G_PI_2
operator|||
name|direction
operator|==
operator|-
name|G_PI
condition|)
block|{
name|direction
operator|=
name|direction
operator|+
literal|0.001
expr_stmt|;
block|}
if|if
condition|(
name|direction
operator|==
literal|0.0
condition|)
block|{
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|direction
operator|==
name|G_PI_2
condition|)
block|{
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
name|printf
argument_list|(
literal|"Hmm bummer G_PI_2\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|direction
operator|==
name|G_PI
condition|)
block|{
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
name|printf
argument_list|(
literal|"Hmm bummer G_PI\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|direction
operator|==
operator|-
name|G_PI_2
condition|)
block|{
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
name|printf
argument_list|(
literal|"Hmm bummer -G_PI_2\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|direction
operator|==
operator|-
name|G_PI
condition|)
block|{
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
name|printf
argument_list|(
literal|"Hmm bummer -G_PI\n"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction
operator|<
name|G_PI
operator|)
operator|&&
operator|(
name|direction
operator|>
name|G_PI_2
operator|)
condition|)
block|{
name|masupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|misupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|ma_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|mi_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|iang
operator|=
name|airblob
operator|->
name|direction_abs
operator|-
name|G_PI_2
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|sin
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|cos
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|sin
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|cos
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|sin
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|cos
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|sin
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|cos
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
comment|/*airline->line[6].x = (xcenter - sin(iang + ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[6].y = (ycenter - cos(iang + ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[7].x = (xcenter - sin(iang - ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[7].y = (ycenter - cos(iang - ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE;  	airline->line[8].x = (xcenter - sin(iang + ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[8].y = (ycenter - cos(iang + ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[9].x = (xcenter - sin(iang - ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[9].y = (ycenter - cos(iang - ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE;  	airline->line[10].x = (xcenter - sin(iang + ma_angsupport/2. + ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[10].y = (ycenter - cos(iang + ma_angsupport/2. + ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[11].x = (xcenter - sin(iang - ma_angsupport/2. - ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[11].y = (ycenter - cos(iang - ma_angsupport/2. - ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE;*/
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction
operator|<
name|G_PI_2
operator|)
operator|&&
operator|(
name|direction
operator|>
literal|0.0
operator|)
condition|)
block|{
name|masupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|misupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|ma_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|mi_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|iang
operator|=
name|airblob
operator|->
name|direction_abs
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|cos
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|sin
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|cos
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|sin
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|cos
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|sin
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|cos
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|sin
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
comment|/*airline->line[6].x = (xcenter + cos(iang + ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[6].y = (ycenter - sin(iang + ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[7].x = (xcenter + cos(iang - ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[7].y = (ycenter - sin(iang - ma_angsupport/2.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE;  	airline->line[8].x = (xcenter + cos(iang + ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[8].y = (ycenter - sin(iang + ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[9].x = (xcenter + cos(iang - ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[9].y = (ycenter - sin(iang - ma_angsupport/4.) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE;  	airline->line[10].x = (xcenter + cos(iang + ma_angsupport/2. + ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[10].y = (ycenter - sin(iang + ma_angsupport/2. + ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[11].x = (xcenter + cos(iang - ma_angsupport/2. + ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE; 	airline->line[11].y = (ycenter - sin(iang - ma_angsupport/2. + ma_angsupport) * (masupport + (airblob->main_line.size - masupport)/2.0))/SUBSAMPLE;  	airline->line[12].x = airline->line[2].x + (airline->line[4].x - airline->line[2].x)/4; 	airline->line[12].y = airline->line[2].y + (airline->line[4].y - airline->line[2].y)/4; 	airline->line[13].x = airline->line[2].x + 3 * (airline->line[4].x - airline->line[2].x)/4; 	airline->line[13].y = airline->line[2].y + 3 * (airline->line[4].y - airline->line[2].y)/4; 	*/
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction
operator|<
literal|0.0
operator|)
operator|&&
operator|(
name|direction
operator|>
operator|-
name|G_PI_2
operator|)
condition|)
block|{
name|masupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|misupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|ma_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|mi_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|iang
operator|=
name|fabs
argument_list|(
name|airblob
operator|->
name|direction_abs
argument_list|)
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|cos
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|sin
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|cos
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|sin
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|cos
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|sin
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|cos
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|sin
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction
operator|<
operator|-
name|G_PI_2
operator|)
operator|&&
operator|(
name|direction
operator|>
operator|-
name|G_PI
operator|)
condition|)
block|{
name|masupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|misupport
operator|=
name|hypot
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|,
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
argument_list|)
expr_stmt|;
name|ma_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|maincross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|maincross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|mi_angsupport
operator|=
name|atan
argument_list|(
name|airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|/
literal|2
operator|/
name|airblob
operator|->
name|minorcross_line
operator|.
name|dist
argument_list|)
expr_stmt|;
name|iang
operator|=
name|fabs
argument_list|(
name|airblob
operator|->
name|direction_abs
argument_list|)
operator|-
name|G_PI_2
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|sin
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|0
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|cos
argument_list|(
name|iang
operator|+
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|sin
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|1
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|cos
argument_list|(
name|iang
operator|+
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|2
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|main_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|sin
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|3
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|cos
argument_list|(
name|iang
argument_list|)
operator|*
name|airblob
operator|->
name|minor_line
operator|.
name|size
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|-
name|sin
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|4
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|+
name|cos
argument_list|(
name|iang
operator|-
name|ma_angsupport
argument_list|)
operator|*
name|masupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|x
operator|=
operator|(
name|xcenter
operator|+
name|sin
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|line
index|[
literal|5
index|]
operator|.
name|y
operator|=
operator|(
name|ycenter
operator|-
name|cos
argument_list|(
name|iang
operator|-
name|mi_angsupport
argument_list|)
operator|*
name|misupport
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|airline
operator|->
name|nlines
operator|=
literal|6
expr_stmt|;
block|}
else|else
block|{
name|printf
argument_list|(
literal|"Hmm a bug in the create_air_line"
argument_list|)
expr_stmt|;
block|}
name|min_x
operator|=
name|max_x
operator|=
name|airline
operator|->
name|xcenter
expr_stmt|;
name|min_y
operator|=
name|max_y
operator|=
name|airline
operator|->
name|ycenter
expr_stmt|;
comment|/*        for (i=0; i< airline->nlines ; i++)     {       printf("x%d, value %d\n", i, airline->line[i].x);       printf("y%d, value %d\n", i, airline->line[i].y);     }    printf("The xcenter %d\n",airline->xcenter);     printf("The ycenter %d\n",airline->ycenter);      */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|airline
operator|->
name|nlines
condition|;
name|i
operator|++
control|)
block|{
name|min_x
operator|=
name|MIN
argument_list|(
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|x
argument_list|,
name|min_x
argument_list|)
expr_stmt|;
name|max_x
operator|=
name|MAX
argument_list|(
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|x
argument_list|,
name|max_x
argument_list|)
expr_stmt|;
name|min_y
operator|=
name|MIN
argument_list|(
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|y
argument_list|,
name|min_y
argument_list|)
expr_stmt|;
name|max_y
operator|=
name|MAX
argument_list|(
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|y
argument_list|,
name|max_y
argument_list|)
expr_stmt|;
block|}
name|airline
operator|->
name|width
operator|=
name|max_x
operator|-
name|min_x
operator|+
literal|1
expr_stmt|;
name|airline
operator|->
name|height
operator|=
name|max_y
operator|-
name|min_y
operator|+
literal|1
expr_stmt|;
name|airline
operator|->
name|min_x
operator|=
name|min_x
expr_stmt|;
name|airline
operator|->
name|min_y
operator|=
name|min_y
expr_stmt|;
name|airline
operator|->
name|max_x
operator|=
name|max_x
expr_stmt|;
name|airline
operator|->
name|max_y
operator|=
name|max_y
expr_stmt|;
return|return
name|airline
return|;
block|}
end_function

begin_function
name|AirBlob
modifier|*
DECL|function|trans_air_blob (AirBlob * airblob_last,AirBlob * airblob_present,double dist,int xcen,int ycen)
name|trans_air_blob
parameter_list|(
name|AirBlob
modifier|*
name|airblob_last
parameter_list|,
name|AirBlob
modifier|*
name|airblob_present
parameter_list|,
name|double
name|dist
parameter_list|,
name|int
name|xcen
parameter_list|,
name|int
name|ycen
parameter_list|)
block|{
name|AirBlob
modifier|*
name|trans_airblob
decl_stmt|;
name|double
name|direction_last_abs
decl_stmt|,
name|direction_present_abs
decl_stmt|;
name|double
name|idirection_abs
decl_stmt|;
name|double
name|direction_last
decl_stmt|,
name|direction_present
decl_stmt|;
name|double
name|idirection
decl_stmt|;
name|double
name|main_line_present
decl_stmt|,
name|main_line_last
decl_stmt|;
name|double
name|minor_line_present
decl_stmt|,
name|minor_line_last
decl_stmt|;
name|double
name|maincross_line_dist_present
decl_stmt|,
name|maincross_line_dist_last
decl_stmt|;
name|double
name|minorcross_line_dist_present
decl_stmt|,
name|minorcross_line_dist_last
decl_stmt|;
name|double
name|maincross_line_size_present
decl_stmt|,
name|maincross_line_size_last
decl_stmt|;
name|double
name|minorcross_line_size_present
decl_stmt|,
name|minorcross_line_size_last
decl_stmt|;
name|trans_airblob
operator|=
name|airblob_new
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|direction_last_abs
operator|=
name|airblob_last
operator|->
name|direction_abs
operator|+
name|G_PI
expr_stmt|;
name|direction_present_abs
operator|=
name|airblob_present
operator|->
name|direction_abs
operator|+
name|G_PI
expr_stmt|;
name|idirection_abs
operator|=
name|direction_present_abs
operator|-
name|direction_last_abs
expr_stmt|;
name|direction_last
operator|=
name|airblob_last
operator|->
name|direction
operator|+
name|G_PI_2
expr_stmt|;
name|direction_present
operator|=
name|airblob_present
operator|->
name|direction
operator|+
name|G_PI_2
expr_stmt|;
name|idirection
operator|=
name|direction_present
operator|-
name|direction_last
expr_stmt|;
name|main_line_present
operator|=
name|airblob_present
operator|->
name|main_line
operator|.
name|size
expr_stmt|;
name|main_line_last
operator|=
name|airblob_last
operator|->
name|main_line
operator|.
name|size
expr_stmt|;
name|minor_line_present
operator|=
name|airblob_present
operator|->
name|minor_line
operator|.
name|size
expr_stmt|;
name|minor_line_last
operator|=
name|airblob_last
operator|->
name|minor_line
operator|.
name|size
expr_stmt|;
name|maincross_line_dist_present
operator|=
name|airblob_present
operator|->
name|maincross_line
operator|.
name|dist
expr_stmt|;
name|maincross_line_size_present
operator|=
name|airblob_present
operator|->
name|maincross_line
operator|.
name|size
expr_stmt|;
name|minorcross_line_dist_present
operator|=
name|airblob_present
operator|->
name|minorcross_line
operator|.
name|dist
expr_stmt|;
name|minorcross_line_size_present
operator|=
name|airblob_present
operator|->
name|minorcross_line
operator|.
name|size
expr_stmt|;
name|maincross_line_dist_last
operator|=
name|airblob_last
operator|->
name|maincross_line
operator|.
name|dist
expr_stmt|;
name|maincross_line_size_last
operator|=
name|airblob_last
operator|->
name|maincross_line
operator|.
name|size
expr_stmt|;
name|minorcross_line_dist_last
operator|=
name|airblob_last
operator|->
name|minorcross_line
operator|.
name|dist
expr_stmt|;
name|minorcross_line_size_last
operator|=
name|airblob_last
operator|->
name|minorcross_line
operator|.
name|size
expr_stmt|;
comment|/*       Now we have to guess a little :-). Why?       Well we can't know if the users is painting      up/down or if she is painting a circle at high speed.      As you may notice it be so that the last airblob has       a direction more or less G_PI rad differernt from the      present airblob. But we can't know if she tured the       airbrush quickly (so that there was no mouse capture       during the turn) or if she paints just up and down the      same direction.       There for we guess that we want to pait up and down       when the diff in direction is bigger than 171 deg and       smaller than 189 deg.    */
if|if
condition|(
operator|(
name|fabs
argument_list|(
name|idirection_abs
argument_list|)
operator|>
operator|(
name|G_PI
operator|-
literal|0.1571
operator|)
operator|)
operator|&&
operator|(
name|fabs
argument_list|(
name|idirection_abs
argument_list|)
operator|<
operator|(
name|G_PI
operator|+
literal|0.1571
operator|)
operator|)
condition|)
block|{
comment|/* We asume that the artist meant to paint in a "strait line" by just tilting the airbrush*/
name|idirection_abs
operator|=
name|idirection_abs
operator|-
name|G_PI
expr_stmt|;
if|if
condition|(
operator|(
name|idirection_abs
operator|*
name|dist
operator|)
operator|>
operator|(
name|idirection_abs
operator|/
literal|2
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|direction_present_abs
operator|-
name|idirection_abs
operator|*
name|dist
operator|)
operator|>
literal|2
operator|*
name|G_PI
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_present_abs
operator|-
name|idirection_abs
operator|*
name|dist
operator|-
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction_present_abs
operator|-
name|idirection_abs
operator|*
name|dist
operator|)
operator|<
literal|0.0
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_present_abs
operator|-
name|idirection_abs
operator|*
name|dist
operator|+
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
else|else
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_present_abs
operator|-
name|idirection_abs
operator|*
name|dist
operator|-
name|G_PI
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
operator|(
name|direction_present_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|)
operator|>
literal|2
operator|*
name|G_PI
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_present_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|-
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction_present_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|)
operator|<
literal|0.0
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_present_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|+
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
else|else
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_present_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|-
name|G_PI
expr_stmt|;
block|}
block|}
name|trans_airblob
operator|->
name|main_line
operator|.
name|size
operator|=
name|main_line_last
operator|+
operator|(
operator|(
name|minor_line_present
operator|-
name|main_line_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|minor_line_last
operator|+
operator|(
operator|(
name|main_line_present
operator|-
name|minor_line_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|maincross_line_dist_last
operator|+
operator|(
operator|(
name|minorcross_line_dist_present
operator|-
name|maincross_line_dist_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|maincross_line_size_last
operator|+
operator|(
operator|(
name|minorcross_line_size_present
operator|-
name|maincross_line_size_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|minorcross_line_dist_last
operator|+
operator|(
operator|(
name|maincross_line_dist_present
operator|-
name|minorcross_line_dist_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|minorcross_line_size_last
operator|+
operator|(
operator|(
name|maincross_line_size_present
operator|-
name|minorcross_line_size_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|fabs
argument_list|(
name|idirection_abs
argument_list|)
operator|<
operator|(
name|G_PI
operator|-
literal|0.1571
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|)
operator|>
literal|2
operator|*
name|G_PI
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|-
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|)
operator|<
literal|0.0
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|+
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
else|else
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|-
name|G_PI
expr_stmt|;
block|}
name|trans_airblob
operator|->
name|main_line
operator|.
name|size
operator|=
name|main_line_last
operator|+
operator|(
operator|(
name|main_line_present
operator|-
name|main_line_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|minor_line_last
operator|+
operator|(
operator|(
name|minor_line_present
operator|-
name|minor_line_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|maincross_line_dist_last
operator|+
operator|(
operator|(
name|maincross_line_dist_present
operator|-
name|maincross_line_dist_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|maincross_line_size_last
operator|+
operator|(
operator|(
name|maincross_line_size_present
operator|-
name|maincross_line_size_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|minorcross_line_dist_last
operator|+
operator|(
operator|(
name|minorcross_line_dist_present
operator|-
name|minorcross_line_dist_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|minorcross_line_size_last
operator|+
operator|(
operator|(
name|minorcross_line_size_present
operator|-
name|minorcross_line_size_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* We asume that the artist always travels the shortest way around the "clock" */
name|idirection_abs
operator|=
name|idirection_abs
operator|-
name|G_PI
expr_stmt|;
if|if
condition|(
operator|(
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|)
operator|>
literal|2
operator|*
name|G_PI
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|-
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|)
operator|<
literal|0.0
condition|)
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|+
literal|2
operator|*
name|G_PI
operator|-
name|G_PI
expr_stmt|;
block|}
else|else
block|{
name|trans_airblob
operator|->
name|direction_abs
operator|=
name|direction_last_abs
operator|+
name|idirection_abs
operator|*
name|dist
operator|-
name|G_PI
expr_stmt|;
block|}
name|trans_airblob
operator|->
name|main_line
operator|.
name|size
operator|=
name|main_line_last
operator|+
operator|(
operator|(
name|main_line_present
operator|-
name|main_line_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minor_line
operator|.
name|size
operator|=
name|minor_line_last
operator|+
operator|(
operator|(
name|minor_line_present
operator|-
name|minor_line_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|maincross_line
operator|.
name|dist
operator|=
name|maincross_line_dist_last
operator|+
operator|(
operator|(
name|maincross_line_dist_present
operator|-
name|maincross_line_dist_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|maincross_line
operator|.
name|size
operator|=
name|maincross_line_size_last
operator|+
operator|(
operator|(
name|maincross_line_size_present
operator|-
name|maincross_line_size_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minorcross_line
operator|.
name|dist
operator|=
name|minorcross_line_dist_last
operator|+
operator|(
operator|(
name|minorcross_line_dist_present
operator|-
name|minorcross_line_dist_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
name|trans_airblob
operator|->
name|minorcross_line
operator|.
name|size
operator|=
name|minorcross_line_size_last
operator|+
operator|(
operator|(
name|minorcross_line_size_present
operator|-
name|minorcross_line_size_last
operator|)
operator|*
name|dist
operator|)
expr_stmt|;
block|}
name|trans_airblob
operator|->
name|xcenter
operator|=
name|xcen
operator|*
name|SUBSAMPLE
expr_stmt|;
name|trans_airblob
operator|->
name|ycenter
operator|=
name|ycen
operator|*
name|SUBSAMPLE
expr_stmt|;
return|return
name|trans_airblob
return|;
block|}
end_function

end_unit

