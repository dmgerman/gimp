begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<glib-object.h>
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"paint-funcs-types.h"
end_include

begin_include
include|#
directive|include
file|"base/tile.h"
end_include

begin_include
include|#
directive|include
file|"base/tile-manager.h"
end_include

begin_include
include|#
directive|include
file|"base/pixel-region.h"
end_include

begin_include
include|#
directive|include
file|"paint-funcs.h"
end_include

begin_include
include|#
directive|include
file|"scale-region.h"
end_include

begin_function_decl
specifier|static
name|void
name|scale_region_buffer
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|,
name|GimpProgressFunc
name|progress_callback
parameter_list|,
name|gpointer
name|progress_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|scale_region_tile
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|,
name|GimpProgressFunc
name|progress_callback
parameter_list|,
name|gpointer
name|progress_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|scale
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
name|TileManager
modifier|*
name|dstTM
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|,
name|GimpProgressFunc
name|progress_callback
parameter_list|,
name|gpointer
name|progress_data
parameter_list|,
name|gint
modifier|*
name|progress
parameter_list|,
name|gint
name|max_progress
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|scale_pr
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|interpolate_bilinear
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|interpolate_nearest
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|interpolate_cubic
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|decimate_gauss
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|decimate_average
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gfloat
modifier|*
name|create_lanczos3_lookup
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|interpolate_lanczos3
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|,
specifier|const
name|gfloat
modifier|*
name|kernel_lookup
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|decimate_average_pr
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|interpolate_bilinear_pr
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|determine_scale
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|gint
modifier|*
name|levelx
parameter_list|,
name|gint
modifier|*
name|levely
parameter_list|,
name|gint
modifier|*
name|max_progress
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|void
name|gaussan_lanczos2
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|void
name|decimate_lanczos2
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|void
name|pixel_average
parameter_list|(
specifier|const
name|guchar
modifier|*
name|p1
parameter_list|,
specifier|const
name|guchar
modifier|*
name|p2
parameter_list|,
specifier|const
name|guchar
modifier|*
name|p3
parameter_list|,
specifier|const
name|guchar
modifier|*
name|p4
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|void
name|gaussan_decimate
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gdouble
name|cubic_spline_fit
parameter_list|(
specifier|const
name|gdouble
name|dx
parameter_list|,
specifier|const
name|gint
name|pt0
parameter_list|,
specifier|const
name|gint
name|pt1
parameter_list|,
specifier|const
name|gint
name|pt2
parameter_list|,
specifier|const
name|gint
name|pt3
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gdouble
name|weighted_sum
parameter_list|(
specifier|const
name|gdouble
name|dx
parameter_list|,
specifier|const
name|gdouble
name|dy
parameter_list|,
specifier|const
name|gint
name|s00
parameter_list|,
specifier|const
name|gint
name|s10
parameter_list|,
specifier|const
name|gint
name|s01
parameter_list|,
specifier|const
name|gint
name|s11
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gdouble
name|sinc
parameter_list|(
specifier|const
name|gdouble
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gdouble
name|lanczos3_mul_alpha
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|x_kernel
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|y_kernel
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
specifier|const
name|gint
name|byte
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gdouble
name|lanczos3_mul
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|x_kernel
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|y_kernel
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
specifier|const
name|gint
name|byte
parameter_list|)
function_decl|;
end_function_decl

begin_function
specifier|static
name|void
DECL|function|determine_scale (PixelRegion * srcPR,PixelRegion * dstPR,gint * levelx,gint * levely,gint * max_progress)
name|determine_scale
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|gint
modifier|*
name|levelx
parameter_list|,
name|gint
modifier|*
name|levely
parameter_list|,
name|gint
modifier|*
name|max_progress
parameter_list|)
block|{
name|gdouble
name|scalex
init|=
operator|(
name|gdouble
operator|)
name|dstPR
operator|->
name|w
operator|/
operator|(
name|gdouble
operator|)
name|srcPR
operator|->
name|w
decl_stmt|;
name|gdouble
name|scaley
init|=
operator|(
name|gdouble
operator|)
name|dstPR
operator|->
name|h
operator|/
operator|(
name|gdouble
operator|)
name|srcPR
operator|->
name|h
decl_stmt|;
name|gint
name|width
init|=
name|srcPR
operator|->
name|w
decl_stmt|;
name|gint
name|height
init|=
name|srcPR
operator|->
name|h
decl_stmt|;
operator|*
name|max_progress
operator|=
operator|(
operator|(
name|height
operator|%
name|TILE_HEIGHT
operator|)
operator|+
literal|1
operator|)
operator|*
operator|(
operator|(
name|width
operator|%
name|TILE_WIDTH
operator|)
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* determine scaling levels */
while|while
condition|(
name|scalex
operator|>
literal|2
condition|)
block|{
name|scalex
operator|/=
literal|2
expr_stmt|;
name|width
operator|*=
literal|2
expr_stmt|;
operator|*
name|levelx
operator|-=
literal|1
expr_stmt|;
operator|*
name|max_progress
operator|+=
operator|(
operator|(
operator|(
name|height
operator|%
name|TILE_HEIGHT
operator|)
operator|+
literal|1
operator|)
operator|*
operator|(
operator|(
name|width
operator|%
name|TILE_WIDTH
operator|)
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
block|}
while|while
condition|(
name|scaley
operator|>
literal|2
condition|)
block|{
name|scaley
operator|/=
literal|2
expr_stmt|;
name|height
operator|*=
literal|2
expr_stmt|;
operator|*
name|levely
operator|-=
literal|1
expr_stmt|;
operator|*
name|max_progress
operator|+=
operator|(
operator|(
operator|(
name|height
operator|%
name|TILE_HEIGHT
operator|)
operator|+
literal|1
operator|)
operator|*
operator|(
operator|(
name|width
operator|%
name|TILE_WIDTH
operator|)
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
block|}
while|while
condition|(
name|scalex
operator|<
literal|0.5
condition|)
block|{
name|scalex
operator|*=
literal|2
expr_stmt|;
name|width
operator|/=
literal|2
expr_stmt|;
operator|*
name|levelx
operator|+=
literal|1
expr_stmt|;
operator|*
name|max_progress
operator|+=
operator|(
operator|(
operator|(
name|height
operator|%
name|TILE_HEIGHT
operator|)
operator|+
literal|1
operator|)
operator|*
operator|(
operator|(
name|width
operator|%
name|TILE_WIDTH
operator|)
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
block|}
while|while
condition|(
name|scaley
operator|<
literal|0.5
condition|)
block|{
name|scaley
operator|*=
literal|2
expr_stmt|;
name|height
operator|*=
literal|2
expr_stmt|;
operator|*
name|levely
operator|+=
literal|1
expr_stmt|;
operator|*
name|max_progress
operator|+=
operator|(
operator|(
operator|(
name|height
operator|%
name|TILE_HEIGHT
operator|)
operator|+
literal|1
operator|)
operator|*
operator|(
operator|(
name|width
operator|%
name|TILE_WIDTH
operator|)
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|scale_region_buffer (PixelRegion * srcPR,PixelRegion * dstPR,GimpInterpolationType interpolation,GimpProgressFunc progress_callback,gpointer progress_data)
name|scale_region_buffer
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|,
name|GimpProgressFunc
name|progress_callback
parameter_list|,
name|gpointer
name|progress_data
parameter_list|)
block|{
name|PixelRegion
name|tmpPR0
decl_stmt|;
name|PixelRegion
name|tmpPR1
decl_stmt|;
name|gint
name|width
init|=
name|srcPR
operator|->
name|w
decl_stmt|;
name|gint
name|height
init|=
name|srcPR
operator|->
name|h
decl_stmt|;
name|gint
name|bytes
init|=
name|srcPR
operator|->
name|bytes
decl_stmt|;
name|gint
name|max_progress
init|=
literal|0
decl_stmt|;
name|gint
name|levelx
init|=
literal|0
decl_stmt|;
name|gint
name|levely
init|=
literal|0
decl_stmt|;
comment|/* determine scaling levels */
name|determine_scale
argument_list|(
name|srcPR
argument_list|,
name|dstPR
argument_list|,
operator|&
name|levelx
argument_list|,
operator|&
name|levely
argument_list|,
operator|&
name|max_progress
argument_list|)
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|g_memdup
argument_list|(
name|srcPR
operator|->
name|data
argument_list|,
name|width
operator|*
name|height
operator|*
name|bytes
argument_list|)
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
while|while
condition|(
name|levelx
operator|<
literal|0
operator|&&
name|levely
operator|<
literal|0
condition|)
block|{
name|width
operator|<<=
literal|1
expr_stmt|;
name|height
operator|<<=
literal|1
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR1
argument_list|,
name|g_new
argument_list|(
name|guchar
argument_list|,
name|width
operator|*
name|height
operator|*
name|bytes
argument_list|)
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|scale_pr
argument_list|(
operator|&
name|tmpPR0
argument_list|,
operator|&
name|tmpPR1
argument_list|,
name|interpolation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpPR0
operator|.
name|data
argument_list|)
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|tmpPR1
operator|.
name|data
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|levelx
operator|++
expr_stmt|;
name|levely
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|levelx
operator|<
literal|0
condition|)
block|{
name|width
operator|<<=
literal|1
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR1
argument_list|,
name|g_new
argument_list|(
name|guchar
argument_list|,
name|width
operator|*
name|height
operator|*
name|bytes
argument_list|)
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|scale_pr
argument_list|(
operator|&
name|tmpPR0
argument_list|,
operator|&
name|tmpPR1
argument_list|,
name|interpolation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpPR0
operator|.
name|data
argument_list|)
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|tmpPR1
operator|.
name|data
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|levelx
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|levely
operator|<
literal|0
condition|)
block|{
name|height
operator|<<=
literal|1
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR1
argument_list|,
name|g_new
argument_list|(
name|guchar
argument_list|,
name|width
operator|*
name|height
operator|*
name|bytes
argument_list|)
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|scale_pr
argument_list|(
operator|&
name|tmpPR0
argument_list|,
operator|&
name|tmpPR1
argument_list|,
name|interpolation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpPR0
operator|.
name|data
argument_list|)
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|tmpPR1
operator|.
name|data
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|levely
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|levelx
operator|>
literal|0
operator|&&
name|levely
operator|>
literal|0
condition|)
block|{
name|width
operator|>>=
literal|1
expr_stmt|;
name|height
operator|>>=
literal|1
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR1
argument_list|,
name|g_new
argument_list|(
name|guchar
argument_list|,
name|width
operator|*
name|height
operator|*
name|bytes
argument_list|)
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|scale_pr
argument_list|(
operator|&
name|tmpPR0
argument_list|,
operator|&
name|tmpPR1
argument_list|,
name|interpolation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpPR0
operator|.
name|data
argument_list|)
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|tmpPR1
operator|.
name|data
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|levelx
operator|--
expr_stmt|;
name|levely
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|levelx
operator|>
literal|0
condition|)
block|{
name|width
operator|<<=
literal|1
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR1
argument_list|,
name|g_new
argument_list|(
name|guchar
argument_list|,
name|width
operator|*
name|height
operator|*
name|bytes
argument_list|)
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|scale_pr
argument_list|(
operator|&
name|tmpPR0
argument_list|,
operator|&
name|tmpPR1
argument_list|,
name|interpolation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpPR0
operator|.
name|data
argument_list|)
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|tmpPR1
operator|.
name|data
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|levelx
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|levely
operator|>
literal|0
condition|)
block|{
name|height
operator|<<=
literal|1
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR1
argument_list|,
name|g_new
argument_list|(
name|guchar
argument_list|,
name|width
operator|*
name|height
operator|*
name|bytes
argument_list|)
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|scale_pr
argument_list|(
operator|&
name|tmpPR0
argument_list|,
operator|&
name|tmpPR1
argument_list|,
name|interpolation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpPR0
operator|.
name|data
argument_list|)
expr_stmt|;
name|pixel_region_init_data
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|tmpPR1
operator|.
name|data
argument_list|,
name|bytes
argument_list|,
name|width
operator|*
name|bytes
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|levely
operator|--
expr_stmt|;
block|}
name|scale_pr
argument_list|(
operator|&
name|tmpPR0
argument_list|,
name|dstPR
argument_list|,
name|interpolation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmpPR0
operator|.
name|data
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|scale_region_tile (PixelRegion * srcPR,PixelRegion * dstPR,GimpInterpolationType interpolation,GimpProgressFunc progress_callback,gpointer progress_data)
name|scale_region_tile
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|,
name|GimpProgressFunc
name|progress_callback
parameter_list|,
name|gpointer
name|progress_data
parameter_list|)
block|{
name|TileManager
modifier|*
name|tmpTM
init|=
name|NULL
decl_stmt|;
name|TileManager
modifier|*
name|srcTM
init|=
name|srcPR
operator|->
name|tiles
decl_stmt|;
name|TileManager
modifier|*
name|dstTM
init|=
name|dstPR
operator|->
name|tiles
decl_stmt|;
name|gint
name|width
init|=
name|srcPR
operator|->
name|w
decl_stmt|;
name|gint
name|height
init|=
name|srcPR
operator|->
name|h
decl_stmt|;
name|gint
name|bytes
init|=
name|srcPR
operator|->
name|bytes
decl_stmt|;
name|gint
name|max_progress
init|=
operator|(
operator|(
operator|(
name|height
operator|%
name|TILE_HEIGHT
operator|)
operator|+
literal|1
operator|)
operator|*
operator|(
operator|(
name|width
operator|%
name|TILE_WIDTH
operator|)
operator|+
literal|1
operator|)
operator|)
decl_stmt|;
name|gint
name|progress
init|=
literal|0
decl_stmt|;
name|gint
name|levelx
init|=
literal|0
decl_stmt|;
name|gint
name|levely
init|=
literal|0
decl_stmt|;
comment|/* determine scaling levels */
name|determine_scale
argument_list|(
name|srcPR
argument_list|,
name|dstPR
argument_list|,
operator|&
name|levelx
argument_list|,
operator|&
name|levely
argument_list|,
operator|&
name|max_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|levelx
operator|==
literal|0
operator|&&
name|levely
operator|==
literal|0
condition|)
block|{
name|scale
argument_list|(
name|srcTM
argument_list|,
name|dstTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
block|}
while|while
condition|(
name|levelx
operator|<
literal|0
operator|&&
name|levely
operator|<
literal|0
condition|)
block|{
name|width
operator|<<=
literal|1
expr_stmt|;
name|height
operator|<<=
literal|1
expr_stmt|;
name|tmpTM
operator|=
name|tile_manager_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
name|scale
argument_list|(
name|srcTM
argument_list|,
name|tmpTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcTM
operator|!=
name|srcPR
operator|->
name|tiles
condition|)
name|tile_manager_unref
argument_list|(
name|srcTM
argument_list|)
expr_stmt|;
name|srcTM
operator|=
name|tmpTM
expr_stmt|;
name|levelx
operator|++
expr_stmt|;
name|levely
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|levelx
operator|<
literal|0
condition|)
block|{
name|width
operator|<<=
literal|1
expr_stmt|;
name|tmpTM
operator|=
name|tile_manager_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
name|scale
argument_list|(
name|srcTM
argument_list|,
name|tmpTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcTM
operator|!=
name|srcPR
operator|->
name|tiles
condition|)
name|tile_manager_unref
argument_list|(
name|srcTM
argument_list|)
expr_stmt|;
name|srcTM
operator|=
name|tmpTM
expr_stmt|;
name|levelx
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|levely
operator|<
literal|0
condition|)
block|{
name|height
operator|<<=
literal|1
expr_stmt|;
name|tmpTM
operator|=
name|tile_manager_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
name|scale
argument_list|(
name|srcTM
argument_list|,
name|tmpTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcTM
operator|!=
name|srcPR
operator|->
name|tiles
condition|)
name|tile_manager_unref
argument_list|(
name|srcTM
argument_list|)
expr_stmt|;
name|srcTM
operator|=
name|tmpTM
expr_stmt|;
name|levely
operator|++
expr_stmt|;
block|}
while|while
condition|(
name|levelx
operator|>
literal|0
operator|&&
name|levely
operator|>
literal|0
condition|)
block|{
name|width
operator|>>=
literal|1
expr_stmt|;
name|height
operator|>>=
literal|1
expr_stmt|;
name|tmpTM
operator|=
name|tile_manager_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
name|scale
argument_list|(
name|srcTM
argument_list|,
name|tmpTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcTM
operator|!=
name|srcPR
operator|->
name|tiles
condition|)
name|tile_manager_unref
argument_list|(
name|srcTM
argument_list|)
expr_stmt|;
name|srcTM
operator|=
name|tmpTM
expr_stmt|;
name|levelx
operator|--
expr_stmt|;
name|levely
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|levelx
operator|>
literal|0
condition|)
block|{
name|width
operator|<<=
literal|1
expr_stmt|;
name|tmpTM
operator|=
name|tile_manager_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
name|scale
argument_list|(
name|srcTM
argument_list|,
name|tmpTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcTM
operator|!=
name|srcPR
operator|->
name|tiles
condition|)
name|tile_manager_unref
argument_list|(
name|srcTM
argument_list|)
expr_stmt|;
name|srcTM
operator|=
name|tmpTM
expr_stmt|;
name|levelx
operator|--
expr_stmt|;
block|}
while|while
condition|(
name|levely
operator|>
literal|0
condition|)
block|{
name|height
operator|<<=
literal|1
expr_stmt|;
name|tmpTM
operator|=
name|tile_manager_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
name|scale
argument_list|(
name|srcTM
argument_list|,
name|tmpTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
if|if
condition|(
name|srcTM
operator|!=
name|srcPR
operator|->
name|tiles
condition|)
name|tile_manager_unref
argument_list|(
name|srcTM
argument_list|)
expr_stmt|;
name|srcTM
operator|=
name|tmpTM
expr_stmt|;
name|levely
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|tmpTM
operator|!=
name|NULL
condition|)
block|{
name|scale
argument_list|(
name|tmpTM
argument_list|,
name|dstTM
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|,
operator|&
name|progress
argument_list|,
name|max_progress
argument_list|)
expr_stmt|;
name|tile_manager_unref
argument_list|(
name|tmpTM
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|progress_callback
condition|)
name|progress_callback
argument_list|(
literal|0
argument_list|,
name|max_progress
argument_list|,
name|max_progress
argument_list|,
name|progress_data
argument_list|)
expr_stmt|;
return|return;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|scale (TileManager * srcTM,TileManager * dstTM,GimpInterpolationType interpolation,GimpProgressFunc progress_callback,gpointer progress_data,gint * progress,gint max_progress)
name|scale
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
name|TileManager
modifier|*
name|dstTM
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|,
name|GimpProgressFunc
name|progress_callback
parameter_list|,
name|gpointer
name|progress_data
parameter_list|,
name|gint
modifier|*
name|progress
parameter_list|,
name|gint
name|max_progress
parameter_list|)
block|{
name|PixelRegion
name|region
decl_stmt|;
specifier|const
name|guint
name|src_width
init|=
name|tile_manager_width
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_height
init|=
name|tile_manager_height
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|dst_width
init|=
name|tile_manager_width
argument_list|(
name|dstTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|dst_height
init|=
name|tile_manager_height
argument_list|(
name|dstTM
argument_list|)
decl_stmt|;
specifier|const
name|gdouble
name|scaley
init|=
operator|(
name|gdouble
operator|)
name|dst_height
operator|/
operator|(
name|gdouble
operator|)
name|src_height
decl_stmt|;
specifier|const
name|gdouble
name|scalex
init|=
operator|(
name|gdouble
operator|)
name|dst_width
operator|/
operator|(
name|gdouble
operator|)
name|src_width
decl_stmt|;
name|gpointer
name|pr
decl_stmt|;
name|gfloat
modifier|*
name|kernel_lookup
init|=
name|NULL
decl_stmt|;
comment|/* fall back if not enough pixels available */
if|if
condition|(
name|interpolation
operator|!=
name|GIMP_INTERPOLATION_NONE
condition|)
block|{
if|if
condition|(
name|src_width
operator|<
literal|2
operator|||
name|src_height
operator|<
literal|2
operator|||
name|dst_width
operator|<
literal|2
operator|||
name|dst_height
operator|<
literal|2
condition|)
block|{
name|interpolation
operator|=
name|GIMP_INTERPOLATION_NONE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|src_width
operator|<
literal|3
operator|||
name|src_height
operator|<
literal|3
operator|||
name|dst_width
operator|<
literal|3
operator|||
name|dst_height
operator|<
literal|3
condition|)
block|{
name|interpolation
operator|=
name|GIMP_INTERPOLATION_LINEAR
expr_stmt|;
block|}
block|}
if|if
condition|(
name|interpolation
operator|==
name|GIMP_INTERPOLATION_LANCZOS
condition|)
name|kernel_lookup
operator|=
name|create_lanczos3_lookup
argument_list|()
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|region
argument_list|,
name|dstTM
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|dst_width
argument_list|,
name|dst_height
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|pixel_regions_register
argument_list|(
literal|1
argument_list|,
operator|&
name|region
argument_list|)
init|;
name|pr
operator|!=
name|NULL
condition|;
name|pr
operator|=
name|pixel_regions_process
argument_list|(
name|pr
argument_list|)
control|)
block|{
specifier|const
name|gint
name|x1
init|=
name|region
operator|.
name|x
operator|+
name|region
operator|.
name|w
decl_stmt|;
specifier|const
name|gint
name|y1
init|=
name|region
operator|.
name|y
operator|+
name|region
operator|.
name|h
decl_stmt|;
name|guchar
modifier|*
name|row
init|=
name|region
operator|.
name|data
decl_stmt|;
name|gint
name|y
decl_stmt|;
for|for
control|(
name|y
operator|=
name|region
operator|.
name|y
init|;
name|y
operator|<
name|y1
condition|;
name|y
operator|++
control|)
block|{
name|guchar
modifier|*
name|pixel
init|=
name|row
decl_stmt|;
name|gdouble
name|yfrac
init|=
name|y
operator|/
name|scaley
decl_stmt|;
name|gint
name|sy0
init|=
operator|(
name|gint
operator|)
name|yfrac
decl_stmt|;
name|gint
name|sy1
init|=
name|sy0
operator|+
literal|1
decl_stmt|;
name|gint
name|x
decl_stmt|;
name|sy0
operator|=
operator|(
name|sy0
operator|>
literal|0
operator|)
condition|?
name|sy0
else|:
literal|0
expr_stmt|;
name|sy1
operator|=
operator|(
name|sy1
operator|>
literal|0
operator|)
condition|?
name|sy1
else|:
literal|0
expr_stmt|;
name|sy0
operator|=
operator|(
name|sy0
operator|<
name|src_height
operator|-
literal|1
operator|)
condition|?
name|sy0
else|:
name|src_height
operator|-
literal|1
expr_stmt|;
name|sy1
operator|=
operator|(
name|sy1
operator|<
name|src_height
operator|-
literal|1
operator|)
condition|?
name|sy1
else|:
name|src_height
operator|-
literal|1
expr_stmt|;
name|yfrac
operator|=
name|yfrac
operator|-
name|sy0
expr_stmt|;
for|for
control|(
name|x
operator|=
name|region
operator|.
name|x
init|;
name|x
operator|<
name|x1
condition|;
name|x
operator|++
control|)
block|{
name|gdouble
name|xfrac
init|=
name|x
operator|/
name|scalex
decl_stmt|;
name|gint
name|sx0
init|=
operator|(
name|gint
operator|)
name|xfrac
decl_stmt|;
name|gint
name|sx1
init|=
name|sx0
operator|+
literal|1
decl_stmt|;
name|sx0
operator|=
operator|(
name|sx0
operator|>
literal|0
operator|)
condition|?
name|sx0
else|:
literal|0
expr_stmt|;
name|sx1
operator|=
operator|(
name|sx1
operator|>
literal|0
operator|)
condition|?
name|sx1
else|:
literal|0
expr_stmt|;
name|sx0
operator|=
operator|(
name|sx0
operator|<
name|src_width
operator|-
literal|1
operator|)
condition|?
name|sx0
else|:
name|src_width
operator|-
literal|1
expr_stmt|;
name|sx1
operator|=
operator|(
name|sx1
operator|<
name|src_width
operator|-
literal|1
operator|)
condition|?
name|sx1
else|:
name|src_width
operator|-
literal|1
expr_stmt|;
name|xfrac
operator|=
name|xfrac
operator|-
name|sx0
expr_stmt|;
switch|switch
condition|(
name|interpolation
condition|)
block|{
case|case
name|GIMP_INTERPOLATION_NONE
case|:
name|interpolate_nearest
argument_list|(
name|srcTM
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|sx1
argument_list|,
name|sy1
argument_list|,
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_INTERPOLATION_LINEAR
case|:
if|if
condition|(
name|scalex
operator|==
literal|0.5
operator|||
name|scaley
operator|==
literal|0.5
condition|)
name|decimate_average
argument_list|(
name|srcTM
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|sx1
argument_list|,
name|sy1
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
else|else
name|interpolate_bilinear
argument_list|(
name|srcTM
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|sx1
argument_list|,
name|sy1
argument_list|,
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_INTERPOLATION_CUBIC
case|:
if|if
condition|(
name|scalex
operator|==
literal|0.5
operator|||
name|scaley
operator|==
literal|0.5
condition|)
name|decimate_gauss
argument_list|(
name|srcTM
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
else|else
name|interpolate_cubic
argument_list|(
name|srcTM
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_INTERPOLATION_LANCZOS
case|:
if|if
condition|(
name|scalex
operator|==
literal|0.5
operator|||
name|scaley
operator|==
literal|0.5
condition|)
name|decimate_lanczos2
argument_list|(
name|srcTM
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
else|else
name|interpolate_lanczos3
argument_list|(
name|srcTM
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|sx1
argument_list|,
name|sy1
argument_list|,
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|pixel
argument_list|,
name|kernel_lookup
argument_list|)
expr_stmt|;
break|break;
block|}
name|pixel
operator|+=
name|region
operator|.
name|bytes
expr_stmt|;
block|}
name|row
operator|+=
name|region
operator|.
name|rowstride
expr_stmt|;
block|}
if|if
condition|(
name|progress_callback
condition|)
name|progress_callback
argument_list|(
literal|0
argument_list|,
name|max_progress
argument_list|,
operator|(
operator|(
operator|*
name|progress
operator|)
operator|++
operator|)
argument_list|,
name|progress_data
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|interpolation
operator|==
name|GIMP_INTERPOLATION_LANCZOS
condition|)
name|g_free
argument_list|(
name|kernel_lookup
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
specifier|inline
DECL|function|pixel_average (const guchar * p1,const guchar * p2,const guchar * p3,const guchar * p4,guchar * p,const gint bytes)
name|pixel_average
parameter_list|(
specifier|const
name|guchar
modifier|*
name|p1
parameter_list|,
specifier|const
name|guchar
modifier|*
name|p2
parameter_list|,
specifier|const
name|guchar
modifier|*
name|p3
parameter_list|,
specifier|const
name|guchar
modifier|*
name|p4
parameter_list|,
name|guchar
modifier|*
name|p
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|)
block|{
switch|switch
condition|(
name|bytes
condition|)
block|{
case|case
literal|1
case|:
name|p
index|[
literal|0
index|]
operator|=
operator|(
name|p1
index|[
literal|0
index|]
operator|+
name|p2
index|[
literal|0
index|]
operator|+
name|p3
index|[
literal|0
index|]
operator|+
name|p4
index|[
literal|0
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
break|break;
case|case
literal|2
case|:
block|{
name|guint
name|a
init|=
name|p1
index|[
literal|1
index|]
operator|+
name|p2
index|[
literal|1
index|]
operator|+
name|p3
index|[
literal|1
index|]
operator|+
name|p4
index|[
literal|1
index|]
decl_stmt|;
switch|switch
condition|(
name|a
condition|)
block|{
case|case
literal|0
case|:
comment|/* all transparent */
name|p
index|[
literal|0
index|]
operator|=
name|p
index|[
literal|1
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|1020
case|:
comment|/* all opaque */
name|p
index|[
literal|0
index|]
operator|=
operator|(
name|p1
index|[
literal|0
index|]
operator|+
name|p2
index|[
literal|0
index|]
operator|+
name|p3
index|[
literal|0
index|]
operator|+
name|p4
index|[
literal|0
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|=
literal|255
expr_stmt|;
break|break;
default|default:
name|p
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|p1
index|[
literal|0
index|]
operator|*
name|p1
index|[
literal|1
index|]
operator|+
name|p2
index|[
literal|0
index|]
operator|*
name|p2
index|[
literal|1
index|]
operator|+
name|p3
index|[
literal|0
index|]
operator|*
name|p3
index|[
literal|1
index|]
operator|+
name|p4
index|[
literal|0
index|]
operator|*
name|p4
index|[
literal|1
index|]
operator|)
operator|/
name|a
operator|)
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|=
operator|(
name|a
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
break|break;
block|}
block|}
break|break;
case|case
literal|3
case|:
name|p
index|[
literal|0
index|]
operator|=
operator|(
name|p1
index|[
literal|0
index|]
operator|+
name|p2
index|[
literal|0
index|]
operator|+
name|p3
index|[
literal|0
index|]
operator|+
name|p4
index|[
literal|0
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|=
operator|(
name|p1
index|[
literal|1
index|]
operator|+
name|p2
index|[
literal|1
index|]
operator|+
name|p3
index|[
literal|1
index|]
operator|+
name|p4
index|[
literal|1
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
name|p
index|[
literal|2
index|]
operator|=
operator|(
name|p1
index|[
literal|2
index|]
operator|+
name|p2
index|[
literal|2
index|]
operator|+
name|p3
index|[
literal|2
index|]
operator|+
name|p4
index|[
literal|2
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
break|break;
case|case
literal|4
case|:
block|{
name|guint
name|a
init|=
name|p1
index|[
literal|3
index|]
operator|+
name|p2
index|[
literal|3
index|]
operator|+
name|p3
index|[
literal|3
index|]
operator|+
name|p4
index|[
literal|3
index|]
decl_stmt|;
switch|switch
condition|(
name|a
condition|)
block|{
case|case
literal|0
case|:
comment|/* all transparent */
name|p
index|[
literal|0
index|]
operator|=
name|p
index|[
literal|1
index|]
operator|=
name|p
index|[
literal|2
index|]
operator|=
name|p
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
break|break;
case|case
literal|1020
case|:
comment|/* all opaque */
name|p
index|[
literal|0
index|]
operator|=
operator|(
name|p1
index|[
literal|0
index|]
operator|+
name|p2
index|[
literal|0
index|]
operator|+
name|p3
index|[
literal|0
index|]
operator|+
name|p4
index|[
literal|0
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|=
operator|(
name|p1
index|[
literal|1
index|]
operator|+
name|p2
index|[
literal|1
index|]
operator|+
name|p3
index|[
literal|1
index|]
operator|+
name|p4
index|[
literal|1
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
name|p
index|[
literal|2
index|]
operator|=
operator|(
name|p1
index|[
literal|2
index|]
operator|+
name|p2
index|[
literal|2
index|]
operator|+
name|p3
index|[
literal|2
index|]
operator|+
name|p4
index|[
literal|2
index|]
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
name|p
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
break|break;
default|default:
name|p
index|[
literal|0
index|]
operator|=
operator|(
operator|(
name|p1
index|[
literal|0
index|]
operator|*
name|p1
index|[
literal|3
index|]
operator|+
name|p2
index|[
literal|0
index|]
operator|*
name|p2
index|[
literal|3
index|]
operator|+
name|p3
index|[
literal|0
index|]
operator|*
name|p3
index|[
literal|3
index|]
operator|+
name|p4
index|[
literal|0
index|]
operator|*
name|p4
index|[
literal|3
index|]
operator|)
operator|/
name|a
operator|)
expr_stmt|;
name|p
index|[
literal|1
index|]
operator|=
operator|(
operator|(
name|p1
index|[
literal|1
index|]
operator|*
name|p1
index|[
literal|3
index|]
operator|+
name|p2
index|[
literal|1
index|]
operator|*
name|p2
index|[
literal|3
index|]
operator|+
name|p3
index|[
literal|1
index|]
operator|*
name|p3
index|[
literal|3
index|]
operator|+
name|p4
index|[
literal|1
index|]
operator|*
name|p4
index|[
literal|3
index|]
operator|)
operator|/
name|a
operator|)
expr_stmt|;
name|p
index|[
literal|2
index|]
operator|=
operator|(
operator|(
name|p1
index|[
literal|2
index|]
operator|*
name|p1
index|[
literal|3
index|]
operator|+
name|p2
index|[
literal|2
index|]
operator|*
name|p2
index|[
literal|3
index|]
operator|+
name|p3
index|[
literal|2
index|]
operator|*
name|p3
index|[
literal|3
index|]
operator|+
name|p4
index|[
literal|2
index|]
operator|*
name|p4
index|[
literal|3
index|]
operator|)
operator|/
name|a
operator|)
expr_stmt|;
name|p
index|[
literal|3
index|]
operator|=
operator|(
name|a
operator|+
literal|2
operator|)
operator|>>
literal|2
expr_stmt|;
break|break;
block|}
block|}
break|break;
block|}
block|}
end_function

begin_function
name|void
DECL|function|scale_region (PixelRegion * srcPR,PixelRegion * dstPR,GimpInterpolationType interpolation,GimpProgressFunc progress_callback,gpointer progress_data)
name|scale_region
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|,
name|GimpProgressFunc
name|progress_callback
parameter_list|,
name|gpointer
name|progress_data
parameter_list|)
block|{
comment|/* Copy and return if scale = 1.0 */
if|if
condition|(
name|srcPR
operator|->
name|h
operator|==
name|dstPR
operator|->
name|h
operator|&&
name|srcPR
operator|->
name|w
operator|==
name|dstPR
operator|->
name|w
condition|)
block|{
name|copy_region
argument_list|(
name|srcPR
argument_list|,
name|dstPR
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|srcPR
operator|->
name|tiles
operator|==
name|NULL
operator|&&
name|srcPR
operator|->
name|data
operator|!=
name|NULL
condition|)
block|{
name|scale_region_buffer
argument_list|(
name|srcPR
argument_list|,
name|dstPR
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|)
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|srcPR
operator|->
name|tiles
operator|!=
name|NULL
operator|&&
name|srcPR
operator|->
name|data
operator|==
name|NULL
condition|)
block|{
name|scale_region_tile
argument_list|(
name|srcPR
argument_list|,
name|dstPR
argument_list|,
name|interpolation
argument_list|,
name|progress_callback
argument_list|,
name|progress_data
argument_list|)
expr_stmt|;
return|return;
block|}
name|g_assert_not_reached
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|decimate_gauss (TileManager * srcTM,const gint x0,const gint y0,guchar * pixel)
name|decimate_gauss
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|const
name|gint
name|src_bpp
init|=
name|tile_manager_bpp
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_width
init|=
name|tile_manager_width
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_height
init|=
name|tile_manager_height
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
name|guchar
name|pixel1
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel2
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel3
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel4
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixels
index|[
literal|16
operator|*
literal|4
index|]
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|i
decl_stmt|;
name|guchar
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|y
operator|=
name|y0
operator|-
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|y
operator|<=
name|y0
operator|+
literal|2
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
name|x0
operator|-
literal|1
init|;
name|x
operator|<=
name|x0
operator|+
literal|2
condition|;
name|x
operator|++
operator|,
name|i
operator|++
control|)
block|{
name|gint
name|u
decl_stmt|,
name|v
decl_stmt|;
name|u
operator|=
operator|(
name|x
operator|>
literal|0
operator|)
condition|?
name|x
else|:
literal|0
expr_stmt|;
name|u
operator|=
operator|(
name|u
operator|<
name|src_width
operator|-
literal|1
operator|)
condition|?
name|u
else|:
name|src_width
operator|-
literal|1
expr_stmt|;
name|v
operator|=
operator|(
name|y
operator|>
literal|0
operator|)
condition|?
name|y
else|:
literal|0
expr_stmt|;
name|v
operator|=
operator|(
name|v
operator|<
name|src_height
operator|-
literal|1
operator|)
condition|?
name|v
else|:
name|src_height
operator|-
literal|1
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|u
argument_list|,
name|v
argument_list|,
name|pixels
operator|+
operator|(
name|i
operator|*
name|src_bpp
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|p
operator|=
name|pixels
operator|+
operator|(
literal|0
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_decimate
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel1
argument_list|)
expr_stmt|;
name|p
operator|=
name|pixels
operator|+
operator|(
literal|1
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_decimate
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel2
argument_list|)
expr_stmt|;
name|p
operator|=
name|pixels
operator|+
operator|(
literal|4
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_decimate
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel3
argument_list|)
expr_stmt|;
name|p
operator|=
name|pixels
operator|+
operator|(
literal|5
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_decimate
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel4
argument_list|)
expr_stmt|;
name|pixel_average
argument_list|(
name|pixel1
argument_list|,
name|pixel2
argument_list|,
name|pixel3
argument_list|,
name|pixel4
argument_list|,
name|pixel
argument_list|,
name|src_bpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
DECL|function|gaussan_decimate (const guchar * pixels,const gint bytes,guchar * pixel)
name|gaussan_decimate
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|const
name|guchar
modifier|*
name|p
decl_stmt|;
name|gdouble
name|sum
decl_stmt|;
name|gdouble
name|alphasum
decl_stmt|;
name|gdouble
name|alpha
decl_stmt|;
name|gint
name|b
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|bytes
condition|;
name|b
operator|++
control|)
name|pixel
index|[
name|b
index|]
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|pixels
expr_stmt|;
switch|switch
condition|(
name|bytes
condition|)
block|{
case|case
literal|1
case|:
name|sum
operator|=
name|p
index|[
literal|0
index|]
operator|+
name|p
index|[
literal|1
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|2
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|4
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|5
index|]
operator|*
literal|4
operator|+
name|p
index|[
literal|6
index|]
operator|*
literal|2
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|8
index|]
operator|+
name|p
index|[
literal|9
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|10
index|]
expr_stmt|;
name|sum
operator|/=
literal|16
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|alphasum
operator|=
name|p
index|[
literal|1
index|]
operator|+
name|p
index|[
literal|3
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|5
index|]
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|9
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|11
index|]
operator|*
literal|4
operator|+
name|p
index|[
literal|13
index|]
operator|*
literal|2
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|17
index|]
operator|+
name|p
index|[
literal|19
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|21
index|]
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
name|sum
operator|=
name|p
index|[
literal|0
index|]
operator|*
name|p
index|[
literal|1
index|]
operator|+
name|p
index|[
literal|2
index|]
operator|*
name|p
index|[
literal|3
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|4
index|]
operator|*
name|p
index|[
literal|5
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|8
index|]
operator|*
name|p
index|[
literal|9
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|10
index|]
operator|*
name|p
index|[
literal|11
index|]
operator|*
literal|4
operator|+
name|p
index|[
literal|12
index|]
operator|*
name|p
index|[
literal|13
index|]
operator|*
literal|2
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|16
index|]
operator|*
name|p
index|[
literal|17
index|]
operator|+
name|p
index|[
literal|18
index|]
operator|*
name|p
index|[
literal|19
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|20
index|]
operator|*
name|p
index|[
literal|21
index|]
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|alpha
operator|=
name|alphasum
operator|/
literal|16
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|1
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alpha
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|p
index|[
name|b
index|]
operator|+
name|p
index|[
literal|3
operator|+
name|b
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|6
operator|+
name|b
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|12
operator|+
name|b
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|15
operator|+
name|b
index|]
operator|*
literal|4
operator|+
name|p
index|[
literal|18
operator|+
name|b
index|]
operator|*
literal|2
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|24
operator|+
name|b
index|]
operator|+
name|p
index|[
literal|27
operator|+
name|b
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|30
operator|+
name|b
index|]
expr_stmt|;
name|sum
operator|/=
literal|16
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
name|alphasum
operator|=
name|p
index|[
literal|3
index|]
operator|+
name|p
index|[
literal|7
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|11
index|]
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|19
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|23
index|]
operator|*
literal|4
operator|+
name|p
index|[
literal|27
index|]
operator|*
literal|2
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|35
index|]
operator|+
name|p
index|[
literal|39
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|43
index|]
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|p
index|[
name|b
index|]
operator|*
name|p
index|[
literal|3
index|]
operator|+
name|p
index|[
literal|4
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|7
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|8
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|11
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|16
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|19
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|20
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|23
index|]
operator|*
literal|4
operator|+
name|p
index|[
literal|24
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|27
index|]
operator|*
literal|2
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|32
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|35
index|]
operator|+
name|p
index|[
literal|36
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|39
index|]
operator|*
literal|2
operator|+
name|p
index|[
literal|40
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|43
index|]
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
name|alpha
operator|=
name|alphasum
operator|/
literal|16
expr_stmt|;
name|pixel
index|[
literal|3
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alpha
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
DECL|function|decimate_lanczos2 (TileManager * srcTM,const gint x0,const gint y0,guchar * pixel)
name|decimate_lanczos2
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|const
name|gint
name|src_bpp
init|=
name|tile_manager_bpp
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_width
init|=
name|tile_manager_width
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_height
init|=
name|tile_manager_height
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
name|guchar
name|pixel1
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel2
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel3
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel4
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixels
index|[
literal|36
operator|*
literal|4
index|]
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|i
decl_stmt|;
name|guchar
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|y
operator|=
name|y0
operator|-
literal|2
operator|,
name|i
operator|=
literal|0
init|;
name|y
operator|<=
name|y0
operator|+
literal|3
condition|;
name|y
operator|++
control|)
for|for
control|(
name|x
operator|=
name|x0
operator|-
literal|2
init|;
name|x
operator|<=
name|x0
operator|+
literal|3
condition|;
name|x
operator|++
operator|,
name|i
operator|++
control|)
block|{
name|gint
name|u
decl_stmt|,
name|v
decl_stmt|;
name|u
operator|=
operator|(
name|x
operator|>
literal|0
operator|)
condition|?
name|x
else|:
literal|0
expr_stmt|;
name|u
operator|=
operator|(
name|u
operator|<
name|src_width
operator|-
literal|1
operator|)
condition|?
name|u
else|:
name|src_width
operator|-
literal|1
expr_stmt|;
name|v
operator|=
operator|(
name|y
operator|>
literal|0
operator|)
condition|?
name|y
else|:
literal|0
expr_stmt|;
name|v
operator|=
operator|(
name|v
operator|<
name|src_height
operator|-
literal|1
operator|)
condition|?
name|v
else|:
name|src_height
operator|-
literal|1
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|u
argument_list|,
name|v
argument_list|,
name|pixels
operator|+
operator|(
name|i
operator|*
name|src_bpp
operator|)
argument_list|)
expr_stmt|;
block|}
name|p
operator|=
name|pixels
operator|+
operator|(
literal|0
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_lanczos2
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel1
argument_list|)
expr_stmt|;
name|p
operator|=
name|pixels
operator|+
operator|(
literal|1
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_lanczos2
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel2
argument_list|)
expr_stmt|;
name|p
operator|=
name|pixels
operator|+
operator|(
literal|6
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_lanczos2
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel3
argument_list|)
expr_stmt|;
name|p
operator|=
name|pixels
operator|+
operator|(
literal|7
operator|*
name|src_bpp
operator|)
expr_stmt|;
name|gaussan_lanczos2
argument_list|(
name|p
argument_list|,
name|src_bpp
argument_list|,
name|pixel4
argument_list|)
expr_stmt|;
name|pixel_average
argument_list|(
name|pixel1
argument_list|,
name|pixel2
argument_list|,
name|pixel3
argument_list|,
name|pixel4
argument_list|,
name|pixel
argument_list|,
name|src_bpp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|void
DECL|function|gaussan_lanczos2 (const guchar * pixels,const gint bytes,guchar * pixel)
name|gaussan_lanczos2
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
comment|/*    *   Filter source taken from document:    *   www.worldserver.com/turk/computergraphics/ResamplingFilters.pdf    *    *   Filters for Common Resampling Tasks    *    *   Ken Turkowski, Apple computer    *    */
specifier|const
name|guchar
modifier|*
name|p
decl_stmt|;
name|gdouble
name|sum
decl_stmt|;
name|gdouble
name|alphasum
decl_stmt|;
name|gdouble
name|alpha
decl_stmt|;
name|gint
name|b
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|bytes
condition|;
name|b
operator|++
control|)
name|pixel
index|[
name|b
index|]
operator|=
literal|0
expr_stmt|;
name|p
operator|=
name|pixels
expr_stmt|;
switch|switch
condition|(
name|bytes
condition|)
block|{
case|case
literal|1
case|:
name|sum
operator|=
name|p
index|[
literal|0
index|]
operator|+
name|p
index|[
literal|1
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|2
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|3
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|4
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|6
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|7
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|8
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|9
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|10
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|12
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|13
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|14
index|]
operator|*
literal|256
operator|+
name|p
index|[
literal|15
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|16
index|]
operator|*
operator|-
literal|16
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|18
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|19
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|20
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|21
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|22
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|24
index|]
operator|+
name|p
index|[
literal|25
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|26
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|27
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|28
index|]
expr_stmt|;
name|sum
operator|/=
literal|1024
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|alphasum
operator|=
name|p
index|[
literal|1
index|]
operator|+
name|p
index|[
literal|3
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|5
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|7
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|9
index|]
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|13
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|15
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|17
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|19
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|21
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|25
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|27
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|29
index|]
operator|*
literal|256
operator|+
name|p
index|[
literal|31
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|33
index|]
operator|*
operator|-
literal|16
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|37
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|39
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|41
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|43
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|45
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|49
index|]
operator|+
name|p
index|[
literal|51
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|53
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|55
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|57
index|]
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
name|sum
operator|=
name|p
index|[
literal|0
index|]
operator|*
name|p
index|[
literal|1
index|]
operator|+
name|p
index|[
literal|2
index|]
operator|*
name|p
index|[
literal|3
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|4
index|]
operator|*
name|p
index|[
literal|5
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|6
index|]
operator|*
name|p
index|[
literal|7
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|8
index|]
operator|*
name|p
index|[
literal|9
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|12
index|]
operator|*
name|p
index|[
literal|13
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|14
index|]
operator|*
name|p
index|[
literal|15
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|16
index|]
operator|*
name|p
index|[
literal|17
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|18
index|]
operator|*
name|p
index|[
literal|19
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|20
index|]
operator|*
name|p
index|[
literal|21
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|24
index|]
operator|*
name|p
index|[
literal|25
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|26
index|]
operator|*
name|p
index|[
literal|27
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|28
index|]
operator|*
name|p
index|[
literal|29
index|]
operator|*
literal|256
operator|+
name|p
index|[
literal|30
index|]
operator|*
name|p
index|[
literal|31
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|32
index|]
operator|*
name|p
index|[
literal|33
index|]
operator|*
operator|-
literal|16
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|36
index|]
operator|*
name|p
index|[
literal|37
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|38
index|]
operator|*
name|p
index|[
literal|39
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|40
index|]
operator|*
name|p
index|[
literal|41
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|42
index|]
operator|*
name|p
index|[
literal|43
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|44
index|]
operator|*
name|p
index|[
literal|45
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|48
index|]
operator|*
name|p
index|[
literal|49
index|]
operator|+
name|p
index|[
literal|50
index|]
operator|*
name|p
index|[
literal|51
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|52
index|]
operator|*
name|p
index|[
literal|53
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|54
index|]
operator|*
name|p
index|[
literal|55
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|56
index|]
operator|*
name|p
index|[
literal|57
index|]
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|alpha
operator|=
name|alphasum
operator|/
literal|1024
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|1
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alpha
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|p
index|[
name|b
index|]
operator|+
name|p
index|[
literal|3
operator|+
name|b
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|6
operator|+
name|b
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|9
operator|+
name|b
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|12
operator|+
name|b
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|18
operator|+
name|b
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|21
operator|+
name|b
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|24
operator|+
name|b
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|27
operator|+
name|b
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|30
operator|+
name|b
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|36
operator|+
name|b
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|39
operator|+
name|b
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|42
operator|+
name|b
index|]
operator|*
literal|256
operator|+
name|p
index|[
literal|45
operator|+
name|b
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|48
operator|+
name|b
index|]
operator|*
operator|-
literal|16
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|54
operator|+
name|b
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|57
operator|+
name|b
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|60
operator|+
name|b
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|63
operator|+
name|b
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|66
operator|+
name|b
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|72
operator|+
name|b
index|]
operator|+
name|p
index|[
literal|75
operator|+
name|b
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|78
operator|+
name|b
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|81
operator|+
name|b
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|84
operator|+
name|b
index|]
expr_stmt|;
name|sum
operator|/=
literal|1024
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
name|alphasum
operator|=
name|p
index|[
literal|3
index|]
operator|+
name|p
index|[
literal|7
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|11
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|15
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|19
index|]
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|27
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|31
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|35
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|39
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|43
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|51
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|55
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|59
index|]
operator|*
literal|256
operator|+
name|p
index|[
literal|63
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|67
index|]
operator|*
operator|-
literal|16
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|75
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|79
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|83
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|87
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|91
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|alphasum
operator|+=
name|p
index|[
literal|99
index|]
operator|+
name|p
index|[
literal|103
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|107
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|111
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|115
index|]
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|p
index|[
literal|0
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|3
index|]
operator|+
name|p
index|[
literal|4
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|7
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|8
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|11
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|12
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|15
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|16
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|19
index|]
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|24
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|27
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|28
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|31
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|32
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|35
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|36
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|39
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|40
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|43
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|48
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|51
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|52
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|55
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|56
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|59
index|]
operator|*
literal|256
operator|+
name|p
index|[
literal|60
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|63
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|64
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|67
index|]
operator|*
operator|-
literal|16
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|72
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|75
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|76
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|79
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|80
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|83
index|]
operator|*
literal|144
operator|+
name|p
index|[
literal|84
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|87
index|]
operator|*
literal|81
operator|+
name|p
index|[
literal|88
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|91
index|]
operator|*
operator|-
literal|9
expr_stmt|;
name|sum
operator|+=
name|p
index|[
literal|96
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|99
index|]
operator|+
name|p
index|[
literal|100
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|103
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|104
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|107
index|]
operator|*
operator|-
literal|16
operator|+
name|p
index|[
literal|108
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|111
index|]
operator|*
operator|-
literal|9
operator|+
name|p
index|[
literal|112
operator|+
name|b
index|]
operator|*
name|p
index|[
literal|115
index|]
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
name|alpha
operator|=
operator|(
name|gint
operator|)
name|alphasum
operator|/
literal|1024
expr_stmt|;
name|pixel
index|[
literal|3
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alpha
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|decimate_average (TileManager * srcTM,const gint x0,const gint y0,const gint x1,const gint y1,guchar * pixel)
name|decimate_average
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
name|guchar
name|pixel1
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel2
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel3
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|pixel4
index|[
literal|4
index|]
decl_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|pixel1
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x1
argument_list|,
name|y0
argument_list|,
name|pixel2
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x0
argument_list|,
name|y1
argument_list|,
name|pixel3
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|pixel4
argument_list|)
expr_stmt|;
name|pixel_average
argument_list|(
name|pixel1
argument_list|,
name|pixel2
argument_list|,
name|pixel3
argument_list|,
name|pixel4
argument_list|,
name|pixel
argument_list|,
name|tile_manager_bpp
argument_list|(
name|srcTM
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gdouble
DECL|function|sinc (const gdouble x)
name|sinc
parameter_list|(
specifier|const
name|gdouble
name|x
parameter_list|)
block|{
name|gdouble
name|y
init|=
name|x
operator|*
name|G_PI
decl_stmt|;
if|if
condition|(
name|ABS
argument_list|(
name|x
argument_list|)
operator|<
name|LANCZOS_MIN
condition|)
return|return
literal|1.0
return|;
return|return
name|sin
argument_list|(
name|y
argument_list|)
operator|/
name|y
return|;
block|}
end_function

begin_comment
comment|/*  * allocate and fill lookup table of Lanczos windowed sinc function  * use gfloat since errors due to granularity of array far exceed  * data precision  */
end_comment

begin_function
name|gfloat
modifier|*
DECL|function|create_lanczos_lookup (void)
name|create_lanczos_lookup
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|gdouble
name|dx
init|=
name|LANCZOS_WIDTH
operator|/
call|(
name|gdouble
call|)
argument_list|(
name|LANCZOS_SAMPLES
operator|-
literal|1
argument_list|)
decl_stmt|;
name|gfloat
modifier|*
name|lookup
init|=
name|g_new
argument_list|(
name|gfloat
argument_list|,
name|LANCZOS_SAMPLES
argument_list|)
decl_stmt|;
name|gdouble
name|x
init|=
literal|0.0
decl_stmt|;
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|LANCZOS_SAMPLES
condition|;
name|i
operator|++
control|)
block|{
name|lookup
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|ABS
argument_list|(
name|x
argument_list|)
operator|<
name|LANCZOS_WIDTH
operator|)
condition|?
operator|(
name|sinc
argument_list|(
name|x
argument_list|)
operator|*
name|sinc
argument_list|(
name|x
operator|/
name|LANCZOS_WIDTH
argument_list|)
operator|)
else|:
literal|0.0
operator|)
expr_stmt|;
name|x
operator|+=
name|dx
expr_stmt|;
block|}
return|return
name|lookup
return|;
block|}
end_function

begin_function
specifier|static
name|gfloat
modifier|*
DECL|function|create_lanczos3_lookup (void)
name|create_lanczos3_lookup
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|gdouble
name|dx
init|=
literal|3.0
operator|/
call|(
name|gdouble
call|)
argument_list|(
name|LANCZOS_SAMPLES
operator|-
literal|1
argument_list|)
decl_stmt|;
name|gfloat
modifier|*
name|lookup
init|=
name|g_new
argument_list|(
name|gfloat
argument_list|,
name|LANCZOS_SAMPLES
argument_list|)
decl_stmt|;
name|gdouble
name|x
init|=
literal|0.0
decl_stmt|;
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|LANCZOS_SAMPLES
condition|;
name|i
operator|++
control|)
block|{
name|lookup
index|[
name|i
index|]
operator|=
operator|(
operator|(
name|ABS
argument_list|(
name|x
argument_list|)
operator|<
literal|3.0
operator|)
condition|?
operator|(
name|sinc
argument_list|(
name|x
argument_list|)
operator|*
name|sinc
argument_list|(
name|x
operator|/
literal|3.0
argument_list|)
operator|)
else|:
literal|0.0
operator|)
expr_stmt|;
name|x
operator|+=
name|dx
expr_stmt|;
block|}
return|return
name|lookup
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|interpolate_nearest (TileManager * srcTM,const gint x0,const gint y0,const gint x1,const gint y1,const gdouble xfrac,const gdouble yfrac,guchar * pixel)
name|interpolate_nearest
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
name|gint
name|x
init|=
operator|(
name|xfrac
operator|<=
literal|0.5
operator|)
condition|?
name|x0
else|:
name|x1
decl_stmt|;
name|gint
name|y
init|=
operator|(
name|yfrac
operator|<=
literal|0.5
operator|)
condition|?
name|y0
else|:
name|y1
decl_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gdouble
DECL|function|weighted_sum (const gdouble dx,const gdouble dy,const gint s00,const gint s10,const gint s01,const gint s11)
name|weighted_sum
parameter_list|(
specifier|const
name|gdouble
name|dx
parameter_list|,
specifier|const
name|gdouble
name|dy
parameter_list|,
specifier|const
name|gint
name|s00
parameter_list|,
specifier|const
name|gint
name|s10
parameter_list|,
specifier|const
name|gint
name|s01
parameter_list|,
specifier|const
name|gint
name|s11
parameter_list|)
block|{
return|return
operator|(
operator|(
literal|1
operator|-
name|dy
operator|)
operator|*
operator|(
operator|(
literal|1
operator|-
name|dx
operator|)
operator|*
name|s00
operator|+
name|dx
operator|*
name|s10
operator|)
operator|+
name|dy
operator|*
operator|(
operator|(
literal|1
operator|-
name|dx
operator|)
operator|*
name|s01
operator|+
name|dx
operator|*
name|s11
operator|)
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|interpolate_bilinear (TileManager * srcTM,const gint x0,const gint y0,const gint x1,const gint y1,const gdouble xfrac,const gdouble yfrac,guchar * pixel)
name|interpolate_bilinear
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|const
name|gint
name|src_bpp
init|=
name|tile_manager_bpp
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
name|guchar
name|p1
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|p2
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|p3
index|[
literal|4
index|]
decl_stmt|;
name|guchar
name|p4
index|[
literal|4
index|]
decl_stmt|;
name|gint
name|b
decl_stmt|;
name|gdouble
name|sum
decl_stmt|,
name|alphasum
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|src_bpp
condition|;
name|b
operator|++
control|)
name|pixel
index|[
name|b
index|]
operator|=
literal|0
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x0
argument_list|,
name|y0
argument_list|,
name|p1
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x1
argument_list|,
name|y0
argument_list|,
name|p2
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x0
argument_list|,
name|y1
argument_list|,
name|p3
argument_list|)
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|p4
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|src_bpp
condition|)
block|{
case|case
literal|1
case|:
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|0
index|]
argument_list|,
name|p2
index|[
literal|0
index|]
argument_list|,
name|p3
index|[
literal|0
index|]
argument_list|,
name|p4
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|alphasum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|1
index|]
argument_list|,
name|p2
index|[
literal|1
index|]
argument_list|,
name|p3
index|[
literal|1
index|]
argument_list|,
name|p4
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|0
index|]
operator|*
name|p1
index|[
literal|1
index|]
argument_list|,
name|p2
index|[
literal|0
index|]
operator|*
name|p2
index|[
literal|1
index|]
argument_list|,
name|p3
index|[
literal|0
index|]
operator|*
name|p3
index|[
literal|1
index|]
argument_list|,
name|p4
index|[
literal|0
index|]
operator|*
name|p4
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|1
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
name|b
index|]
argument_list|,
name|p2
index|[
name|b
index|]
argument_list|,
name|p3
index|[
name|b
index|]
argument_list|,
name|p4
index|[
name|b
index|]
argument_list|)
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
name|alphasum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|3
index|]
argument_list|,
name|p2
index|[
literal|3
index|]
argument_list|,
name|p3
index|[
literal|3
index|]
argument_list|,
name|p4
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
name|b
index|]
operator|*
name|p1
index|[
literal|3
index|]
argument_list|,
name|p2
index|[
name|b
index|]
operator|*
name|p2
index|[
literal|3
index|]
argument_list|,
name|p3
index|[
name|b
index|]
operator|*
name|p3
index|[
literal|3
index|]
argument_list|,
name|p4
index|[
name|b
index|]
operator|*
name|p4
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
name|pixel
index|[
literal|3
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_comment
comment|/* Catmull-Rom spline - not bad   * basic intro http://www.mvps.org/directx/articles/catmull/   * This formula will calculate an interpolated point between pt1 and pt2   * dx=0 returns pt1; dx=1 returns pt2   */
end_comment

begin_function
specifier|static
specifier|inline
name|gdouble
DECL|function|cubic_spline_fit (const gdouble dx,const gint pt0,const gint pt1,const gint pt2,const gint pt3)
name|cubic_spline_fit
parameter_list|(
specifier|const
name|gdouble
name|dx
parameter_list|,
specifier|const
name|gint
name|pt0
parameter_list|,
specifier|const
name|gint
name|pt1
parameter_list|,
specifier|const
name|gint
name|pt2
parameter_list|,
specifier|const
name|gint
name|pt3
parameter_list|)
block|{
return|return
call|(
name|gdouble
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|-
name|pt0
operator|+
literal|3
operator|*
name|pt1
operator|-
literal|3
operator|*
name|pt2
operator|+
name|pt3
operator|)
operator|*
name|dx
operator|+
operator|(
literal|2
operator|*
name|pt0
operator|-
literal|5
operator|*
name|pt1
operator|+
literal|4
operator|*
name|pt2
operator|-
name|pt3
operator|)
operator|)
operator|*
name|dx
operator|+
operator|(
operator|-
name|pt0
operator|+
name|pt2
operator|)
operator|)
operator|*
name|dx
operator|+
operator|(
name|pt1
operator|+
name|pt1
operator|)
argument_list|)
operator|/
literal|2.0
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|interpolate_cubic (TileManager * srcTM,const gint x0,const gint y0,const gdouble xfrac,const gdouble yfrac,guchar * pixel)
name|interpolate_cubic
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|const
name|gint
name|src_bpp
init|=
name|tile_manager_bpp
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_width
init|=
name|tile_manager_width
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_height
init|=
name|tile_manager_height
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
name|gint
name|b
decl_stmt|,
name|i
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guchar
name|ps
index|[
literal|16
operator|*
literal|4
index|]
decl_stmt|;
name|gdouble
name|p0
decl_stmt|,
name|p1
decl_stmt|,
name|p2
decl_stmt|,
name|p3
decl_stmt|;
name|gdouble
name|sum
decl_stmt|,
name|alphasum
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|src_bpp
condition|;
name|b
operator|++
control|)
name|pixel
index|[
name|b
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|y
operator|=
name|y0
operator|-
literal|1
operator|,
name|i
operator|=
literal|0
init|;
name|y
operator|<=
name|y0
operator|+
literal|2
condition|;
name|y
operator|++
control|)
for|for
control|(
name|x
operator|=
name|x0
operator|-
literal|1
init|;
name|x
operator|<=
name|x0
operator|+
literal|2
condition|;
name|x
operator|++
operator|,
name|i
operator|++
control|)
block|{
name|gint
name|u
decl_stmt|,
name|v
decl_stmt|;
name|u
operator|=
operator|(
name|x
operator|>
literal|0
operator|)
condition|?
name|x
else|:
literal|0
expr_stmt|;
name|u
operator|=
operator|(
name|u
operator|<
name|src_width
operator|-
literal|1
operator|)
condition|?
name|u
else|:
name|src_width
operator|-
literal|1
expr_stmt|;
name|v
operator|=
operator|(
name|y
operator|>
literal|0
operator|)
condition|?
name|y
else|:
literal|0
expr_stmt|;
name|v
operator|=
operator|(
name|v
operator|<
name|src_height
operator|-
literal|1
operator|)
condition|?
name|v
else|:
name|src_height
operator|-
literal|1
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|u
argument_list|,
name|v
argument_list|,
name|ps
operator|+
operator|(
name|i
operator|*
name|src_bpp
operator|)
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|src_bpp
condition|)
block|{
case|case
literal|1
case|:
name|p0
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|0
index|]
argument_list|,
name|ps
index|[
literal|1
index|]
argument_list|,
name|ps
index|[
literal|2
index|]
argument_list|,
name|ps
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|p1
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|4
index|]
argument_list|,
name|ps
index|[
literal|5
index|]
argument_list|,
name|ps
index|[
literal|6
index|]
argument_list|,
name|ps
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|p2
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|8
index|]
argument_list|,
name|ps
index|[
literal|9
index|]
argument_list|,
name|ps
index|[
literal|10
index|]
argument_list|,
name|ps
index|[
literal|11
index|]
argument_list|)
expr_stmt|;
name|p3
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|12
index|]
argument_list|,
name|ps
index|[
literal|13
index|]
argument_list|,
name|ps
index|[
literal|14
index|]
argument_list|,
name|ps
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|sum
operator|=
name|cubic_spline_fit
argument_list|(
name|yfrac
argument_list|,
name|p0
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|p0
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|1
index|]
argument_list|,
name|ps
index|[
literal|3
index|]
argument_list|,
name|ps
index|[
literal|5
index|]
argument_list|,
name|ps
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|p1
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|9
index|]
argument_list|,
name|ps
index|[
literal|11
index|]
argument_list|,
name|ps
index|[
literal|13
index|]
argument_list|,
name|ps
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|p2
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|17
index|]
argument_list|,
name|ps
index|[
literal|19
index|]
argument_list|,
name|ps
index|[
literal|21
index|]
argument_list|,
name|ps
index|[
literal|23
index|]
argument_list|)
expr_stmt|;
name|p3
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|25
index|]
argument_list|,
name|ps
index|[
literal|27
index|]
argument_list|,
name|ps
index|[
literal|29
index|]
argument_list|,
name|ps
index|[
literal|31
index|]
argument_list|)
expr_stmt|;
name|alphasum
operator|=
name|cubic_spline_fit
argument_list|(
name|yfrac
argument_list|,
name|p0
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
name|p0
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|0
index|]
operator|*
name|ps
index|[
literal|1
index|]
argument_list|,
name|ps
index|[
literal|2
index|]
operator|*
name|ps
index|[
literal|3
index|]
argument_list|,
name|ps
index|[
literal|4
index|]
operator|*
name|ps
index|[
literal|5
index|]
argument_list|,
name|ps
index|[
literal|6
index|]
operator|*
name|ps
index|[
literal|7
index|]
argument_list|)
expr_stmt|;
name|p1
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|8
index|]
operator|*
name|ps
index|[
literal|9
index|]
argument_list|,
name|ps
index|[
literal|10
index|]
operator|*
name|ps
index|[
literal|11
index|]
argument_list|,
name|ps
index|[
literal|12
index|]
operator|*
name|ps
index|[
literal|13
index|]
argument_list|,
name|ps
index|[
literal|14
index|]
operator|*
name|ps
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|p2
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|16
index|]
operator|*
name|ps
index|[
literal|17
index|]
argument_list|,
name|ps
index|[
literal|18
index|]
operator|*
name|ps
index|[
literal|19
index|]
argument_list|,
name|ps
index|[
literal|20
index|]
operator|*
name|ps
index|[
literal|21
index|]
argument_list|,
name|ps
index|[
literal|22
index|]
operator|*
name|ps
index|[
literal|23
index|]
argument_list|)
expr_stmt|;
name|p3
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|24
index|]
operator|*
name|ps
index|[
literal|25
index|]
argument_list|,
name|ps
index|[
literal|26
index|]
operator|*
name|ps
index|[
literal|27
index|]
argument_list|,
name|ps
index|[
literal|28
index|]
operator|*
name|ps
index|[
literal|29
index|]
argument_list|,
name|ps
index|[
literal|30
index|]
operator|*
name|ps
index|[
literal|31
index|]
argument_list|)
expr_stmt|;
name|sum
operator|=
name|cubic_spline_fit
argument_list|(
name|yfrac
argument_list|,
name|p0
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|1
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|p0
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
name|b
index|]
argument_list|,
name|ps
index|[
literal|3
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|6
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|9
operator|+
name|b
index|]
argument_list|)
expr_stmt|;
name|p1
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|12
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|15
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|18
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|21
operator|+
name|b
index|]
argument_list|)
expr_stmt|;
name|p2
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|24
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|27
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|30
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|33
operator|+
name|b
index|]
argument_list|)
expr_stmt|;
name|p3
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|36
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|39
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|42
operator|+
name|b
index|]
argument_list|,
name|ps
index|[
literal|45
operator|+
name|b
index|]
argument_list|)
expr_stmt|;
name|sum
operator|=
name|cubic_spline_fit
argument_list|(
name|yfrac
argument_list|,
name|p0
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
name|p0
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|3
index|]
argument_list|,
name|ps
index|[
literal|7
index|]
argument_list|,
name|ps
index|[
literal|11
index|]
argument_list|,
name|ps
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|p1
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|19
index|]
argument_list|,
name|ps
index|[
literal|23
index|]
argument_list|,
name|ps
index|[
literal|27
index|]
argument_list|,
name|ps
index|[
literal|31
index|]
argument_list|)
expr_stmt|;
name|p2
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|35
index|]
argument_list|,
name|ps
index|[
literal|39
index|]
argument_list|,
name|ps
index|[
literal|43
index|]
argument_list|,
name|ps
index|[
literal|47
index|]
argument_list|)
expr_stmt|;
name|p3
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|51
index|]
argument_list|,
name|ps
index|[
literal|55
index|]
argument_list|,
name|ps
index|[
literal|59
index|]
argument_list|,
name|ps
index|[
literal|63
index|]
argument_list|)
expr_stmt|;
name|alphasum
operator|=
name|cubic_spline_fit
argument_list|(
name|yfrac
argument_list|,
name|p0
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|p0
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|0
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|3
index|]
argument_list|,
name|ps
index|[
literal|4
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|7
index|]
argument_list|,
name|ps
index|[
literal|8
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|11
index|]
argument_list|,
name|ps
index|[
literal|12
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|15
index|]
argument_list|)
expr_stmt|;
name|p1
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|16
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|19
index|]
argument_list|,
name|ps
index|[
literal|20
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|23
index|]
argument_list|,
name|ps
index|[
literal|24
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|27
index|]
argument_list|,
name|ps
index|[
literal|28
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|31
index|]
argument_list|)
expr_stmt|;
name|p2
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|32
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|35
index|]
argument_list|,
name|ps
index|[
literal|36
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|39
index|]
argument_list|,
name|ps
index|[
literal|40
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|43
index|]
argument_list|,
name|ps
index|[
literal|44
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|47
index|]
argument_list|)
expr_stmt|;
name|p3
operator|=
name|cubic_spline_fit
argument_list|(
name|xfrac
argument_list|,
name|ps
index|[
literal|48
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|51
index|]
argument_list|,
name|ps
index|[
literal|52
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|55
index|]
argument_list|,
name|ps
index|[
literal|56
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|59
index|]
argument_list|,
name|ps
index|[
literal|60
operator|+
name|b
index|]
operator|*
name|ps
index|[
literal|63
index|]
argument_list|)
expr_stmt|;
name|sum
operator|=
name|cubic_spline_fit
argument_list|(
name|yfrac
argument_list|,
name|p0
argument_list|,
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
name|pixel
index|[
literal|3
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|gdouble
specifier|inline
DECL|function|lanczos3_mul_alpha (const guchar * pixels,const gdouble * x_kernel,const gdouble * y_kernel,const gint bytes,const gint byte)
name|lanczos3_mul_alpha
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|x_kernel
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|y_kernel
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
specifier|const
name|gint
name|byte
parameter_list|)
block|{
specifier|const
name|guchar
modifier|*
name|p
init|=
name|pixels
decl_stmt|;
specifier|const
name|guchar
name|alpha
init|=
name|bytes
operator|-
literal|1
decl_stmt|;
name|gdouble
name|sum
init|=
literal|0.0
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
literal|6
condition|;
name|y
operator|++
control|)
block|{
name|gdouble
name|tmpsum
init|=
literal|0.0
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
literal|6
condition|;
name|x
operator|++
operator|,
name|p
operator|+=
name|bytes
control|)
block|{
name|tmpsum
operator|+=
name|x_kernel
index|[
name|x
index|]
operator|*
name|p
index|[
name|byte
index|]
operator|*
name|p
index|[
name|alpha
index|]
expr_stmt|;
block|}
name|tmpsum
operator|*=
name|y_kernel
index|[
name|y
index|]
expr_stmt|;
name|sum
operator|+=
name|tmpsum
expr_stmt|;
block|}
return|return
name|sum
return|;
block|}
end_function

begin_function
specifier|static
name|gdouble
specifier|inline
DECL|function|lanczos3_mul (const guchar * pixels,const gdouble * x_kernel,const gdouble * y_kernel,const gint bytes,const gint byte)
name|lanczos3_mul
parameter_list|(
specifier|const
name|guchar
modifier|*
name|pixels
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|x_kernel
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|y_kernel
parameter_list|,
specifier|const
name|gint
name|bytes
parameter_list|,
specifier|const
name|gint
name|byte
parameter_list|)
block|{
specifier|const
name|guchar
modifier|*
name|p
init|=
name|pixels
decl_stmt|;
name|gdouble
name|sum
init|=
literal|0.0
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
literal|6
condition|;
name|y
operator|++
control|)
block|{
name|gdouble
name|tmpsum
init|=
literal|0.0
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
literal|6
condition|;
name|x
operator|++
operator|,
name|p
operator|+=
name|bytes
control|)
block|{
name|tmpsum
operator|+=
name|x_kernel
index|[
name|x
index|]
operator|*
name|p
index|[
name|byte
index|]
expr_stmt|;
block|}
name|tmpsum
operator|*=
name|y_kernel
index|[
name|y
index|]
expr_stmt|;
name|sum
operator|+=
name|tmpsum
expr_stmt|;
block|}
return|return
name|sum
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|interpolate_lanczos3 (TileManager * srcTM,const gint x0,const gint y0,const gint x1,const gint y1,const gdouble xfrac,const gdouble yfrac,guchar * pixel,const gfloat * kernel_lookup)
name|interpolate_lanczos3
parameter_list|(
name|TileManager
modifier|*
name|srcTM
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|,
specifier|const
name|gfloat
modifier|*
name|kernel_lookup
parameter_list|)
block|{
specifier|const
name|gint
name|src_bpp
init|=
name|tile_manager_bpp
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_width
init|=
name|tile_manager_width
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|guint
name|src_height
init|=
name|tile_manager_height
argument_list|(
name|srcTM
argument_list|)
decl_stmt|;
specifier|const
name|gint
name|x_shift
init|=
call|(
name|gint
call|)
argument_list|(
name|xfrac
operator|*
name|LANCZOS_SPP
operator|+
literal|0.5
argument_list|)
decl_stmt|;
specifier|const
name|gint
name|y_shift
init|=
call|(
name|gint
call|)
argument_list|(
name|yfrac
operator|*
name|LANCZOS_SPP
operator|+
literal|0.5
argument_list|)
decl_stmt|;
name|gint
name|b
decl_stmt|,
name|i
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gdouble
name|kx_sum
decl_stmt|,
name|ky_sum
decl_stmt|;
name|gdouble
name|x_kernel
index|[
literal|6
index|]
decl_stmt|,
name|y_kernel
index|[
literal|6
index|]
decl_stmt|;
name|guchar
name|pixels
index|[
literal|36
operator|*
literal|4
index|]
decl_stmt|;
name|gdouble
name|sum
decl_stmt|,
name|alphasum
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|src_bpp
condition|;
name|b
operator|++
control|)
name|pixel
index|[
name|b
index|]
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|y
operator|=
name|y0
operator|-
literal|2
operator|,
name|i
operator|=
literal|0
init|;
name|y
operator|<=
name|y0
operator|+
literal|3
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
name|x0
operator|-
literal|2
init|;
name|x
operator|<=
name|x0
operator|+
literal|3
condition|;
name|x
operator|++
operator|,
name|i
operator|++
control|)
block|{
name|gint
name|u
decl_stmt|,
name|v
decl_stmt|;
name|u
operator|=
operator|(
name|x
operator|>
literal|0
operator|)
condition|?
name|x
else|:
literal|0
expr_stmt|;
name|u
operator|=
operator|(
name|u
operator|<
name|src_width
operator|-
literal|1
operator|)
condition|?
name|u
else|:
name|src_width
operator|-
literal|1
expr_stmt|;
name|v
operator|=
operator|(
name|y
operator|>
literal|0
operator|)
condition|?
name|y
else|:
literal|0
expr_stmt|;
name|v
operator|=
operator|(
name|v
operator|<
name|src_height
operator|-
literal|1
operator|)
condition|?
name|v
else|:
name|src_height
operator|-
literal|1
expr_stmt|;
name|read_pixel_data_1
argument_list|(
name|srcTM
argument_list|,
name|u
argument_list|,
name|v
argument_list|,
name|pixels
operator|+
operator|(
name|i
operator|*
name|src_bpp
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|kx_sum
operator|=
name|ky_sum
operator|=
literal|0.0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|3
init|;
name|i
operator|>=
operator|-
literal|2
condition|;
name|i
operator|--
control|)
block|{
name|gint
name|pos
init|=
name|i
operator|*
name|LANCZOS_SPP
decl_stmt|;
name|kx_sum
operator|+=
name|x_kernel
index|[
literal|2
operator|+
name|i
index|]
operator|=
name|kernel_lookup
index|[
name|ABS
argument_list|(
name|x_shift
operator|-
name|pos
argument_list|)
index|]
expr_stmt|;
name|ky_sum
operator|+=
name|y_kernel
index|[
literal|2
operator|+
name|i
index|]
operator|=
name|kernel_lookup
index|[
name|ABS
argument_list|(
name|y_shift
operator|-
name|pos
argument_list|)
index|]
expr_stmt|;
block|}
comment|/* normalise the kernel arrays */
for|for
control|(
name|i
operator|=
operator|-
literal|2
init|;
name|i
operator|<=
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|x_kernel
index|[
literal|2
operator|+
name|i
index|]
operator|/=
name|kx_sum
expr_stmt|;
name|y_kernel
index|[
literal|2
operator|+
name|i
index|]
operator|/=
name|ky_sum
expr_stmt|;
block|}
switch|switch
condition|(
name|src_bpp
condition|)
block|{
case|case
literal|1
case|:
name|sum
operator|=
name|lanczos3_mul
argument_list|(
name|pixels
argument_list|,
name|x_kernel
argument_list|,
name|y_kernel
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
operator|(
name|gint
operator|)
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|alphasum
operator|=
name|lanczos3_mul
argument_list|(
name|pixels
argument_list|,
name|x_kernel
argument_list|,
name|y_kernel
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
name|sum
operator|=
name|lanczos3_mul_alpha
argument_list|(
name|pixels
argument_list|,
name|x_kernel
argument_list|,
name|y_kernel
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|1
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|lanczos3_mul
argument_list|(
name|pixels
argument_list|,
name|x_kernel
argument_list|,
name|y_kernel
argument_list|,
literal|3
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
name|alphasum
operator|=
name|lanczos3_mul
argument_list|(
name|pixels
argument_list|,
name|x_kernel
argument_list|,
name|y_kernel
argument_list|,
literal|4
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|lanczos3_mul_alpha
argument_list|(
name|pixels
argument_list|,
name|x_kernel
argument_list|,
name|y_kernel
argument_list|,
literal|4
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
name|pixel
index|[
literal|3
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|scale_pr (PixelRegion * srcPR,PixelRegion * dstPR,GimpInterpolationType interpolation)
name|scale_pr
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|dstPR
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|)
block|{
specifier|const
name|gdouble
name|scalex
init|=
operator|(
name|gdouble
operator|)
name|dstPR
operator|->
name|w
operator|/
operator|(
name|gdouble
operator|)
name|srcPR
operator|->
name|w
decl_stmt|;
specifier|const
name|gdouble
name|scaley
init|=
operator|(
name|gdouble
operator|)
name|dstPR
operator|->
name|h
operator|/
operator|(
name|gdouble
operator|)
name|srcPR
operator|->
name|h
decl_stmt|;
specifier|const
name|gint
name|src_width
init|=
name|srcPR
operator|->
name|w
decl_stmt|;
specifier|const
name|gint
name|src_height
init|=
name|srcPR
operator|->
name|h
decl_stmt|;
specifier|const
name|gint
name|bytes
init|=
name|srcPR
operator|->
name|bytes
decl_stmt|;
name|guchar
modifier|*
name|dstPtr
init|=
name|dstPR
operator|->
name|data
decl_stmt|;
name|gdouble
name|xfrac
decl_stmt|,
name|yfrac
decl_stmt|;
name|gint
name|b
decl_stmt|,
name|x
decl_stmt|,
name|sx0
decl_stmt|,
name|sx1
decl_stmt|,
name|y
decl_stmt|,
name|sy0
decl_stmt|,
name|sy1
decl_stmt|;
name|guchar
name|pixel
index|[
name|bytes
index|]
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|dstPR
operator|->
name|h
condition|;
name|y
operator|++
control|)
block|{
name|yfrac
operator|=
operator|(
name|y
operator|/
name|scaley
operator|)
expr_stmt|;
name|sy0
operator|=
operator|(
name|gint
operator|)
name|yfrac
expr_stmt|;
name|sy1
operator|=
name|sy0
operator|+
literal|1
expr_stmt|;
name|sy1
operator|=
operator|(
name|sy1
operator|<
name|src_height
operator|-
literal|1
operator|)
condition|?
name|sy1
else|:
name|src_height
operator|-
literal|1
expr_stmt|;
name|yfrac
operator|=
name|yfrac
operator|-
name|sy0
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|dstPR
operator|->
name|w
condition|;
name|x
operator|++
control|)
block|{
name|xfrac
operator|=
operator|(
name|x
operator|/
name|scalex
operator|)
expr_stmt|;
name|sx0
operator|=
operator|(
name|gint
operator|)
name|xfrac
expr_stmt|;
name|sx1
operator|=
name|sx0
operator|+
literal|1
expr_stmt|;
name|sx1
operator|=
operator|(
name|sx1
operator|<
name|src_width
operator|-
literal|1
operator|)
condition|?
name|sx1
else|:
name|src_width
operator|-
literal|1
expr_stmt|;
name|xfrac
operator|=
name|xfrac
operator|-
name|sx0
expr_stmt|;
switch|switch
condition|(
name|interpolation
condition|)
block|{
case|case
name|GIMP_INTERPOLATION_NONE
case|:
case|case
name|GIMP_INTERPOLATION_LINEAR
case|:
case|case
name|GIMP_INTERPOLATION_CUBIC
case|:
case|case
name|GIMP_INTERPOLATION_LANCZOS
case|:
if|if
condition|(
name|scalex
operator|==
literal|0.5
operator|||
name|scaley
operator|==
literal|0.5
condition|)
block|{
name|decimate_average_pr
argument_list|(
name|srcPR
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|sx1
argument_list|,
name|sy1
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|interpolate_bilinear_pr
argument_list|(
name|srcPR
argument_list|,
name|sx0
argument_list|,
name|sy0
argument_list|,
name|sx1
argument_list|,
name|sy1
argument_list|,
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|pixel
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|bytes
condition|;
name|b
operator|++
operator|,
name|dstPtr
operator|++
control|)
operator|*
name|dstPtr
operator|=
name|pixel
index|[
name|b
index|]
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|decimate_average_pr (PixelRegion * srcPR,const gint x0,const gint y0,const gint x1,const gint y1,guchar * pixel)
name|decimate_average_pr
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|const
name|gint
name|bytes
init|=
name|srcPR
operator|->
name|bytes
decl_stmt|;
specifier|const
name|gint
name|width
init|=
name|srcPR
operator|->
name|w
decl_stmt|;
name|guchar
modifier|*
name|p1
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y0
operator|*
name|width
operator|+
name|x0
operator|)
operator|*
name|bytes
decl_stmt|;
name|guchar
modifier|*
name|p2
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y0
operator|*
name|width
operator|+
name|x1
operator|)
operator|*
name|bytes
decl_stmt|;
name|guchar
modifier|*
name|p3
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y1
operator|*
name|width
operator|+
name|x0
operator|)
operator|*
name|bytes
decl_stmt|;
name|guchar
modifier|*
name|p4
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y1
operator|*
name|width
operator|+
name|x1
operator|)
operator|*
name|bytes
decl_stmt|;
name|pixel_average
argument_list|(
name|p1
argument_list|,
name|p2
argument_list|,
name|p3
argument_list|,
name|p4
argument_list|,
name|pixel
argument_list|,
name|bytes
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|interpolate_bilinear_pr (PixelRegion * srcPR,const gint x0,const gint y0,const gint x1,const gint y1,const gdouble xfrac,const gdouble yfrac,guchar * pixel)
name|interpolate_bilinear_pr
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
specifier|const
name|gint
name|x0
parameter_list|,
specifier|const
name|gint
name|y0
parameter_list|,
specifier|const
name|gint
name|x1
parameter_list|,
specifier|const
name|gint
name|y1
parameter_list|,
specifier|const
name|gdouble
name|xfrac
parameter_list|,
specifier|const
name|gdouble
name|yfrac
parameter_list|,
name|guchar
modifier|*
name|pixel
parameter_list|)
block|{
specifier|const
name|gint
name|bytes
init|=
name|srcPR
operator|->
name|bytes
decl_stmt|;
specifier|const
name|gint
name|width
init|=
name|srcPR
operator|->
name|w
decl_stmt|;
name|guchar
modifier|*
name|p1
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y0
operator|*
name|width
operator|+
name|x0
operator|)
operator|*
name|bytes
decl_stmt|;
name|guchar
modifier|*
name|p2
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y0
operator|*
name|width
operator|+
name|x1
operator|)
operator|*
name|bytes
decl_stmt|;
name|guchar
modifier|*
name|p3
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y1
operator|*
name|width
operator|+
name|x0
operator|)
operator|*
name|bytes
decl_stmt|;
name|guchar
modifier|*
name|p4
init|=
name|srcPR
operator|->
name|data
operator|+
operator|(
name|y1
operator|*
name|width
operator|+
name|x1
operator|)
operator|*
name|bytes
decl_stmt|;
name|gint
name|b
decl_stmt|;
name|gdouble
name|sum
decl_stmt|,
name|alphasum
decl_stmt|;
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
name|bytes
condition|;
name|b
operator|++
control|)
name|pixel
index|[
name|b
index|]
operator|=
literal|0
expr_stmt|;
switch|switch
condition|(
name|bytes
condition|)
block|{
case|case
literal|1
case|:
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|0
index|]
argument_list|,
name|p2
index|[
literal|0
index|]
argument_list|,
name|p3
index|[
literal|0
index|]
argument_list|,
name|p4
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|alphasum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|1
index|]
argument_list|,
name|p2
index|[
literal|1
index|]
argument_list|,
name|p3
index|[
literal|1
index|]
argument_list|,
name|p4
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|0
index|]
operator|*
name|p1
index|[
literal|1
index|]
argument_list|,
name|p2
index|[
literal|0
index|]
operator|*
name|p2
index|[
literal|1
index|]
argument_list|,
name|p3
index|[
literal|0
index|]
operator|*
name|p3
index|[
literal|1
index|]
argument_list|,
name|p4
index|[
literal|0
index|]
operator|*
name|p4
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
literal|0
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|pixel
index|[
literal|1
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
name|b
index|]
argument_list|,
name|p2
index|[
name|b
index|]
argument_list|,
name|p3
index|[
name|b
index|]
argument_list|,
name|p4
index|[
name|b
index|]
argument_list|)
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
name|alphasum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
literal|3
index|]
argument_list|,
name|p2
index|[
literal|3
index|]
argument_list|,
name|p3
index|[
literal|3
index|]
argument_list|,
name|p4
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|alphasum
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
block|{
name|sum
operator|=
name|weighted_sum
argument_list|(
name|xfrac
argument_list|,
name|yfrac
argument_list|,
name|p1
index|[
name|b
index|]
operator|*
name|p1
index|[
literal|3
index|]
argument_list|,
name|p2
index|[
name|b
index|]
operator|*
name|p2
index|[
literal|3
index|]
argument_list|,
name|p3
index|[
name|b
index|]
operator|*
name|p3
index|[
literal|3
index|]
argument_list|,
name|p4
index|[
name|b
index|]
operator|*
name|p4
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|sum
operator|/=
name|alphasum
expr_stmt|;
name|pixel
index|[
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|sum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
name|pixel
index|[
literal|3
index|]
operator|=
operator|(
name|guchar
operator|)
name|CLAMP
argument_list|(
name|alphasum
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

end_unit

