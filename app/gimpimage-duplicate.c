begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"actionarea.h"
end_include

begin_include
include|#
directive|include
file|"channel_ops.h"
end_include

begin_include
include|#
directive|include
file|"drawable.h"
end_include

begin_include
include|#
directive|include
file|"floating_sel.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"palette.h"
end_include

begin_include
include|#
directive|include
file|"channel_pvt.h"
end_include

begin_define
DECL|macro|ENTRY_WIDTH
define|#
directive|define
name|ENTRY_WIDTH
value|60
end_define

begin_define
DECL|macro|OFFSET_BACKGROUND
define|#
directive|define
name|OFFSET_BACKGROUND
value|0
end_define

begin_define
DECL|macro|OFFSET_TRANSPARENT
define|#
directive|define
name|OFFSET_TRANSPARENT
value|1
end_define

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2bc3aad90108
block|{
DECL|member|dlg
name|GtkWidget
modifier|*
name|dlg
decl_stmt|;
DECL|member|fill_options
name|GtkWidget
modifier|*
name|fill_options
decl_stmt|;
DECL|member|off_x_entry
name|GtkWidget
modifier|*
name|off_x_entry
decl_stmt|;
DECL|member|off_y_entry
name|GtkWidget
modifier|*
name|off_y_entry
decl_stmt|;
DECL|member|wrap_around
name|int
name|wrap_around
decl_stmt|;
DECL|member|transparent
name|int
name|transparent
decl_stmt|;
DECL|member|background
name|int
name|background
decl_stmt|;
DECL|member|gimage_id
name|int
name|gimage_id
decl_stmt|;
DECL|typedef|OffsetDialog
block|}
name|OffsetDialog
typedef|;
end_typedef

begin_comment
comment|/*  Local procedures  */
end_comment

begin_function_decl
specifier|static
name|void
name|offset
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|wrap_around
parameter_list|,
name|int
name|fill_type
parameter_list|,
name|int
name|offset_x
parameter_list|,
name|int
name|offset_y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|offset_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|offset_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|offset_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|offset_toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|offset_wraparound_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|offset_halfheight_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|channel_ops_offset_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|void
DECL|function|channel_ops_offset (void * gimage_ptr)
name|channel_ops_offset
parameter_list|(
name|void
modifier|*
name|gimage_ptr
parameter_list|)
block|{
name|OffsetDialog
modifier|*
name|off_d
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|check
decl_stmt|;
name|GtkWidget
modifier|*
name|push
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GSList
modifier|*
name|group
init|=
name|NULL
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|gimage
operator|=
operator|(
name|GImage
operator|*
operator|)
name|gimage_ptr
expr_stmt|;
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
name|off_d
operator|=
name|g_new
argument_list|(
name|OffsetDialog
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|off_d
operator|->
name|wrap_around
operator|=
name|TRUE
expr_stmt|;
name|off_d
operator|->
name|transparent
operator|=
name|drawable_has_alpha
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|off_d
operator|->
name|background
operator|=
operator|!
name|off_d
operator|->
name|transparent
expr_stmt|;
name|off_d
operator|->
name|gimage_id
operator|=
name|gimage
operator|->
name|ID
expr_stmt|;
name|off_d
operator|->
name|dlg
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
argument_list|,
literal|"Offset"
argument_list|)
expr_stmt|;
comment|/* handle the wm close signal */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|offset_delete_callback
argument_list|)
argument_list|,
name|off_d
argument_list|)
expr_stmt|;
comment|/*  Action area  */
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"OK"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|offset_ok_callback
argument_list|,
name|off_d
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Cancel"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|offset_cancel_callback
argument_list|,
name|off_d
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/*  The vbox for first column of options  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  the table for offsets  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Offset X:"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|off_d
operator|->
name|off_x_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|off_d
operator|->
name|off_x_entry
argument_list|)
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|off_d
operator|->
name|off_x_entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|off_d
operator|->
name|off_x_entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|off_d
operator|->
name|off_x_entry
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Offset Y:"
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|off_d
operator|->
name|off_y_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|off_d
operator|->
name|off_y_entry
argument_list|)
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|off_d
operator|->
name|off_y_entry
argument_list|,
name|ENTRY_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|off_d
operator|->
name|off_y_entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
operator||
name|GTK_EXPAND
argument_list|,
name|GTK_FILL
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|off_d
operator|->
name|off_y_entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*  the wrap around option  */
name|check
operator|=
name|gtk_check_button_new_with_label
argument_list|(
literal|"Wrap-Around"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|check
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|check
argument_list|)
expr_stmt|;
comment|/*  The fill options  */
name|off_d
operator|->
name|fill_options
operator|=
name|gtk_frame_new
argument_list|(
literal|"Fill Options"
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|off_d
operator|->
name|fill_options
argument_list|)
argument_list|,
name|GTK_SHADOW_ETCHED_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|off_d
operator|->
name|fill_options
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|toggle_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|off_d
operator|->
name|fill_options
argument_list|)
argument_list|,
name|toggle_vbox
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Background"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|offset_toggle_update
argument_list|,
operator|&
name|off_d
operator|->
name|background
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|off_d
operator|->
name|background
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable_has_alpha
argument_list|(
name|drawable
argument_list|)
condition|)
block|{
name|toggle
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
literal|"Transparent"
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|toggle_vbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|offset_toggle_update
argument_list|,
operator|&
name|off_d
operator|->
name|transparent
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|off_d
operator|->
name|transparent
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
block|}
comment|/*  the by half height and half width offtion */
name|push
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Offset by (x/2),(y/2)"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|push
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|push
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle_vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|off_d
operator|->
name|fill_options
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
expr_stmt|;
comment|/*  Hook up the wrap around  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|check
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|offset_wraparound_update
argument_list|,
name|off_d
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_state
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|check
argument_list|)
argument_list|,
name|off_d
operator|->
name|wrap_around
argument_list|)
expr_stmt|;
comment|/* Hook up the by half */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|push
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|offset_halfheight_update
argument_list|,
name|off_d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|offset (GImage * gimage,GimpDrawable * drawable,int wrap_around,int fill_type,int offset_x,int offset_y)
name|offset
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|wrap_around
parameter_list|,
name|int
name|fill_type
parameter_list|,
name|int
name|offset_x
parameter_list|,
name|int
name|offset_y
parameter_list|)
block|{
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|TileManager
modifier|*
name|new_tiles
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|int
name|src_x
decl_stmt|,
name|src_y
decl_stmt|;
name|int
name|dest_x
decl_stmt|,
name|dest_y
decl_stmt|;
name|unsigned
name|char
name|fill
index|[
name|MAX_CHANNELS
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|drawable
condition|)
return|return;
name|width
operator|=
name|drawable_width
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|height
operator|=
name|drawable_height
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
if|if
condition|(
name|wrap_around
condition|)
block|{
name|offset_x
operator|%=
name|width
expr_stmt|;
name|offset_y
operator|%=
name|height
expr_stmt|;
block|}
else|else
block|{
name|offset_x
operator|=
name|BOUNDS
argument_list|(
name|offset_x
argument_list|,
operator|-
name|width
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|offset_y
operator|=
name|BOUNDS
argument_list|(
name|offset_y
argument_list|,
operator|-
name|height
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|offset_x
operator|==
literal|0
operator|&&
name|offset_y
operator|==
literal|0
condition|)
return|return;
name|new_tiles
operator|=
name|tile_manager_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|offset_x
operator|>=
literal|0
condition|)
block|{
name|src_x
operator|=
literal|0
expr_stmt|;
name|dest_x
operator|=
name|offset_x
expr_stmt|;
name|width
operator|=
name|BOUNDS
argument_list|(
operator|(
name|width
operator|-
name|offset_x
operator|)
argument_list|,
literal|0
argument_list|,
name|width
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|src_x
operator|=
operator|-
name|offset_x
expr_stmt|;
name|dest_x
operator|=
literal|0
expr_stmt|;
name|width
operator|=
name|BOUNDS
argument_list|(
operator|(
name|width
operator|+
name|offset_x
operator|)
argument_list|,
literal|0
argument_list|,
name|width
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|offset_y
operator|>=
literal|0
condition|)
block|{
name|src_y
operator|=
literal|0
expr_stmt|;
name|dest_y
operator|=
name|offset_y
expr_stmt|;
name|height
operator|=
name|BOUNDS
argument_list|(
operator|(
name|height
operator|-
name|offset_y
operator|)
argument_list|,
literal|0
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|src_y
operator|=
operator|-
name|offset_y
expr_stmt|;
name|dest_y
operator|=
literal|0
expr_stmt|;
name|height
operator|=
name|BOUNDS
argument_list|(
operator|(
name|height
operator|+
name|offset_y
operator|)
argument_list|,
literal|0
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
comment|/*  Copy the center region  */
if|if
condition|(
name|width
operator|&&
name|height
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|src_x
argument_list|,
name|src_y
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
argument_list|,
name|dest_y
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|copy_region
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
block|}
comment|/*  Copy appropriately for wrap around  */
if|if
condition|(
name|wrap_around
operator|==
name|TRUE
condition|)
block|{
if|if
condition|(
name|offset_x
operator|>=
literal|0
operator|&&
name|offset_y
operator|>=
literal|0
condition|)
block|{
name|src_x
operator|=
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|offset_x
expr_stmt|;
name|src_y
operator|=
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|offset_y
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_x
operator|>=
literal|0
operator|&&
name|offset_y
operator|<
literal|0
condition|)
block|{
name|src_x
operator|=
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|offset_x
expr_stmt|;
name|src_y
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_x
operator|<
literal|0
operator|&&
name|offset_y
operator|>=
literal|0
condition|)
block|{
name|src_x
operator|=
literal|0
expr_stmt|;
name|src_y
operator|=
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|offset_y
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_x
operator|<
literal|0
operator|&&
name|offset_y
operator|<
literal|0
condition|)
block|{
name|src_x
operator|=
literal|0
expr_stmt|;
name|src_y
operator|=
literal|0
expr_stmt|;
block|}
name|dest_x
operator|=
operator|(
name|src_x
operator|+
name|offset_x
operator|)
operator|%
name|drawable_width
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
if|if
condition|(
name|dest_x
operator|<
literal|0
condition|)
name|dest_x
operator|=
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|+
name|dest_x
expr_stmt|;
name|dest_y
operator|=
operator|(
name|src_y
operator|+
name|offset_y
operator|)
operator|%
name|drawable_height
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
if|if
condition|(
name|dest_y
operator|<
literal|0
condition|)
name|dest_y
operator|=
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|+
name|dest_y
expr_stmt|;
comment|/*  intersecting region  */
if|if
condition|(
name|offset_x
operator|!=
literal|0
operator|&&
name|offset_y
operator|!=
literal|0
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|src_x
argument_list|,
name|src_y
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
argument_list|,
name|dest_y
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|copy_region
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
block|}
comment|/*  X offset  */
if|if
condition|(
name|offset_x
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|offset_y
operator|>=
literal|0
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|src_x
argument_list|,
literal|0
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
argument_list|,
name|dest_y
operator|+
name|offset_y
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_y
operator|<
literal|0
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|src_x
argument_list|,
name|src_y
operator|-
name|offset_y
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
argument_list|,
literal|0
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|copy_region
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
block|}
comment|/*  X offset  */
if|if
condition|(
name|offset_y
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|offset_x
operator|>=
literal|0
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
literal|0
argument_list|,
name|src_y
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
operator|+
name|offset_x
argument_list|,
name|dest_y
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_x
operator|<
literal|0
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|src_x
operator|-
name|offset_x
argument_list|,
name|src_y
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
literal|0
argument_list|,
name|dest_y
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
name|copy_region
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  Otherwise, fill the vacated regions  */
else|else
block|{
if|if
condition|(
name|fill_type
operator|==
name|OFFSET_BACKGROUND
condition|)
block|{
name|palette_get_background
argument_list|(
operator|&
name|fill
index|[
literal|0
index|]
argument_list|,
operator|&
name|fill
index|[
literal|1
index|]
argument_list|,
operator|&
name|fill
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable_has_alpha
argument_list|(
name|drawable
argument_list|)
condition|)
name|fill
index|[
name|drawable_bytes
argument_list|(
name|drawable
argument_list|)
operator|-
literal|1
index|]
operator|=
name|OPAQUE
expr_stmt|;
block|}
if|if
condition|(
name|offset_x
operator|>=
literal|0
operator|&&
name|offset_y
operator|>=
literal|0
condition|)
block|{
name|dest_x
operator|=
literal|0
expr_stmt|;
name|dest_y
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_x
operator|>=
literal|0
operator|&&
name|offset_y
operator|<
literal|0
condition|)
block|{
name|dest_x
operator|=
literal|0
expr_stmt|;
name|dest_y
operator|=
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|+
name|offset_y
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_x
operator|<
literal|0
operator|&&
name|offset_y
operator|>=
literal|0
condition|)
block|{
name|dest_x
operator|=
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|+
name|offset_x
expr_stmt|;
name|dest_y
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|offset_x
operator|<
literal|0
operator|&&
name|offset_y
operator|<
literal|0
condition|)
block|{
name|dest_x
operator|=
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|+
name|offset_x
expr_stmt|;
name|dest_y
operator|=
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|+
name|offset_y
expr_stmt|;
block|}
comment|/*  intersecting region  */
if|if
condition|(
name|offset_x
operator|!=
literal|0
operator|&&
name|offset_y
operator|!=
literal|0
condition|)
block|{
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
argument_list|,
name|dest_y
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|color_region
argument_list|(
operator|&
name|destPR
argument_list|,
name|fill
argument_list|)
expr_stmt|;
block|}
comment|/*  X offset  */
if|if
condition|(
name|offset_x
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|offset_y
operator|>=
literal|0
condition|)
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
argument_list|,
name|dest_y
operator|+
name|offset_y
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|offset_y
operator|<
literal|0
condition|)
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
argument_list|,
literal|0
argument_list|,
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|color_region
argument_list|(
operator|&
name|destPR
argument_list|,
name|fill
argument_list|)
expr_stmt|;
block|}
comment|/*  X offset  */
if|if
condition|(
name|offset_y
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|offset_x
operator|>=
literal|0
condition|)
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
name|dest_x
operator|+
name|offset_x
argument_list|,
name|dest_y
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|offset_x
operator|<
literal|0
condition|)
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|new_tiles
argument_list|,
literal|0
argument_list|,
name|dest_y
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
operator|-
name|ABS
argument_list|(
name|offset_x
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|offset_y
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|color_region
argument_list|(
operator|&
name|destPR
argument_list|,
name|fill
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  push an undo  */
name|drawable_apply_image
argument_list|(
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  swap the tiles  */
name|drawable
operator|->
name|tiles
operator|=
name|new_tiles
expr_stmt|;
comment|/*  update the drawable  */
name|drawable_update
argument_list|(
name|drawable
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|drawable_width
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  Interface callbacks  */
end_comment

begin_function
specifier|static
name|void
DECL|function|offset_ok_callback (GtkWidget * widget,gpointer data)
name|offset_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|OffsetDialog
modifier|*
name|off_d
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|int
name|offset_x
decl_stmt|,
name|offset_y
decl_stmt|;
name|int
name|fill_type
decl_stmt|;
name|off_d
operator|=
operator|(
name|OffsetDialog
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|off_d
operator|->
name|gimage_id
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
name|offset_x
operator|=
operator|(
name|int
operator|)
name|atof
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|off_d
operator|->
name|off_x_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|offset_y
operator|=
operator|(
name|int
operator|)
name|atof
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|off_d
operator|->
name|off_y_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|off_d
operator|->
name|transparent
condition|)
name|fill_type
operator|=
name|OFFSET_TRANSPARENT
expr_stmt|;
else|else
name|fill_type
operator|=
name|OFFSET_BACKGROUND
expr_stmt|;
name|offset
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
name|off_d
operator|->
name|wrap_around
argument_list|,
name|fill_type
argument_list|,
name|offset_x
argument_list|,
name|offset_y
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|off_d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|offset_delete_callback (GtkWidget * widget,GdkEvent * event,gpointer data)
name|offset_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|offset_cancel_callback
argument_list|(
name|widget
argument_list|,
name|data
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|offset_cancel_callback (GtkWidget * widget,gpointer data)
name|offset_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|OffsetDialog
modifier|*
name|off_d
decl_stmt|;
name|off_d
operator|=
operator|(
name|OffsetDialog
operator|*
operator|)
name|data
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|off_d
operator|->
name|dlg
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|off_d
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|offset_toggle_update (GtkWidget * widget,gpointer data)
name|offset_toggle_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|int
modifier|*
name|toggle_val
decl_stmt|;
name|toggle_val
operator|=
operator|(
name|int
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
operator|*
name|toggle_val
operator|=
name|TRUE
expr_stmt|;
else|else
operator|*
name|toggle_val
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|offset_wraparound_update (GtkWidget * widget,gpointer data)
name|offset_wraparound_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|OffsetDialog
modifier|*
name|off_d
decl_stmt|;
name|off_d
operator|=
operator|(
name|OffsetDialog
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
name|off_d
operator|->
name|wrap_around
operator|=
name|TRUE
expr_stmt|;
else|else
name|off_d
operator|->
name|wrap_around
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|off_d
operator|->
name|fill_options
argument_list|,
operator|!
name|off_d
operator|->
name|wrap_around
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|offset_halfheight_update (GtkWidget * widget,gpointer data)
name|offset_halfheight_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|OffsetDialog
modifier|*
name|off_d
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|gchar
name|buffer
index|[
literal|16
index|]
decl_stmt|;
name|off_d
operator|=
operator|(
name|OffsetDialog
operator|*
operator|)
name|data
expr_stmt|;
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|off_d
operator|->
name|gimage_id
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d"
argument_list|,
name|gimage
operator|->
name|width
operator|/
literal|2
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|off_d
operator|->
name|off_x_entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|buffer
argument_list|,
literal|"%d"
argument_list|,
name|gimage
operator|->
name|height
operator|/
literal|2
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|off_d
operator|->
name|off_y_entry
argument_list|)
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  Procedure database functions and data structures  */
end_comment

begin_comment
comment|/*  *  Procedure database functions and data structures  */
end_comment

begin_comment
comment|/*  The offset procedure definition  */
end_comment

begin_decl_stmt
DECL|variable|channel_ops_offset_args
name|ProcArg
name|channel_ops_offset_args
index|[]
init|=
block|{
block|{
name|PDB_IMAGE
block|,
literal|"image"
block|,
literal|"the image"
block|}
block|,
block|{
name|PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"the drawable to offset"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"wrap_around"
block|,
literal|"wrap image around or fill vacated regions"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"fill_type"
block|,
literal|"fill vacated regions of drawable with background or transparent: { OFFSET_BACKGROUND (0), OFFSET_TRANSPARENT (1) }"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"offset_x"
block|,
literal|"offset by this amount in X direction"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"offset_y"
block|,
literal|"offset by this amount in Y direction"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channel_ops_offset_proc
name|ProcRecord
name|channel_ops_offset_proc
init|=
block|{
literal|"gimp_channel_ops_offset"
block|,
literal|"Offset the drawable by the specified amounts in the X and Y directions"
block|,
literal|"This procedure offsets the specified drawable by the amounts specified by 'offset_x' and 'offset_y'.  If 'wrap_around' is set to TRUE, then portions of the drawable which are offset out of bounds are wrapped around.  Alternatively, the undefined regions of the drawable can be filled with transparency or the background color, as specified by the 'fill_type' parameter."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/*  Input arguments  */
literal|6
block|,
name|channel_ops_offset_args
block|,
comment|/*  Output arguments  */
literal|0
block|,
name|NULL
block|,
comment|/*  Exec method  */
block|{
block|{
name|channel_ops_offset_invoker
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|channel_ops_offset_invoker (Argument * args)
name|channel_ops_offset_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|int
name|success
init|=
name|TRUE
decl_stmt|;
name|int
name|int_value
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|int
name|wrap_around
decl_stmt|;
name|int
name|fill_type
decl_stmt|;
name|int
name|offset_x
decl_stmt|;
name|int
name|offset_y
decl_stmt|;
comment|/*  the gimage  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|int_value
argument_list|)
operator|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|drawable
operator|=
name|drawable_get_ID
argument_list|(
name|int_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
operator|||
name|gimage
operator|!=
name|drawable_gimage
argument_list|(
name|drawable
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|success
condition|)
block|{
name|wrap_around
operator|=
operator|(
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|)
condition|?
name|TRUE
else|:
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|success
condition|)
block|{
name|fill_type
operator|=
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|fill_type
operator|<
name|OFFSET_BACKGROUND
operator|||
name|fill_type
operator|>
name|OFFSET_TRANSPARENT
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|success
condition|)
block|{
name|offset_x
operator|=
name|args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|offset_y
operator|=
name|args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
block|}
if|if
condition|(
name|success
condition|)
name|offset
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
name|wrap_around
argument_list|,
name|fill_type
argument_list|,
name|offset_x
argument_list|,
name|offset_y
argument_list|)
expr_stmt|;
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|channel_ops_offset_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

end_unit

