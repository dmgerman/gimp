begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|__GNUC__
end_ifdef

begin_warning
warning|#
directive|warning
warning|GTK_DISABLE_DEPRECATED
end_warning

begin_endif
endif|#
directive|endif
end_endif

begin_undef
undef|#
directive|undef
name|GTK_DISABLE_DEPRECATED
end_undef

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpcolor/gimpcolor.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"tools-types.h"
end_include

begin_include
include|#
directive|include
file|"base/pixel-region.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdrawable.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-mask.h"
end_include

begin_include
include|#
directive|include
file|"display/gimpdisplay.h"
end_include

begin_include
include|#
directive|include
file|"display/gimpdisplay-foreach.h"
end_include

begin_include
include|#
directive|include
file|"gimphuesaturationtool.h"
end_include

begin_include
include|#
directive|include
file|"tool_manager.h"
end_include

begin_include
include|#
directive|include
file|"app_procs.h"
end_include

begin_include
include|#
directive|include
file|"image_map.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_define
DECL|macro|HUE_PARTITION_MASK
define|#
directive|define
name|HUE_PARTITION_MASK
value|GDK_EXPOSURE_MASK | GDK_ENTER_NOTIFY_MASK
end_define

begin_define
DECL|macro|SLIDER_WIDTH
define|#
directive|define
name|SLIDER_WIDTH
value|200
end_define

begin_define
DECL|macro|DA_WIDTH
define|#
directive|define
name|DA_WIDTH
value|40
end_define

begin_define
DECL|macro|DA_HEIGHT
define|#
directive|define
name|DA_HEIGHT
value|20
end_define

begin_define
DECL|macro|HUE_PARTITION
define|#
directive|define
name|HUE_PARTITION
value|0x0
end_define

begin_define
DECL|macro|HUE_SLIDER
define|#
directive|define
name|HUE_SLIDER
value|0x1
end_define

begin_define
DECL|macro|LIGHTNESS_SLIDER
define|#
directive|define
name|LIGHTNESS_SLIDER
value|0x2
end_define

begin_define
DECL|macro|SATURATION_SLIDER
define|#
directive|define
name|SATURATION_SLIDER
value|0x4
end_define

begin_define
DECL|macro|DRAW
define|#
directive|define
name|DRAW
value|0x40
end_define

begin_define
DECL|macro|ALL
define|#
directive|define
name|ALL
value|0xFF
end_define

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_hue_saturation_tool_class_init
parameter_list|(
name|GimpHueSaturationToolClass
modifier|*
name|klass
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_hue_saturation_tool_init
parameter_list|(
name|GimpHueSaturationTool
modifier|*
name|bc_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_hue_saturation_tool_initialize
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpDisplay
modifier|*
name|gdisp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_hue_saturation_tool_control
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpToolAction
name|action
parameter_list|,
name|GimpDisplay
modifier|*
name|gdisp
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|HueSaturationDialog
modifier|*
name|hue_saturation_dialog_new
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_dialog_hide
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_update
parameter_list|(
name|HueSaturationDialog
modifier|*
name|hsd
parameter_list|,
name|gint
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_preview
parameter_list|(
name|HueSaturationDialog
modifier|*
name|hsd
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_reset_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_partition_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_preview_update
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_hue_adjustment_update
parameter_list|(
name|GtkAdjustment
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_lightness_adjustment_update
parameter_list|(
name|GtkAdjustment
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|hue_saturation_saturation_adjustment_update
parameter_list|(
name|GtkAdjustment
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|hue_saturation_hue_partition_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|,
name|HueSaturationDialog
modifier|*
name|hsd
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  Local variables  */
end_comment

begin_decl_stmt
DECL|variable|hue_transfer
specifier|static
name|gint
name|hue_transfer
index|[
literal|6
index|]
index|[
literal|256
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|lightness_transfer
specifier|static
name|gint
name|lightness_transfer
index|[
literal|6
index|]
index|[
literal|256
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|saturation_transfer
specifier|static
name|gint
name|saturation_transfer
index|[
literal|6
index|]
index|[
literal|256
index|]
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_colors
specifier|static
name|gint
name|default_colors
index|[
literal|6
index|]
index|[
literal|3
index|]
init|=
block|{
block|{
literal|255
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|255
block|,
literal|255
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|255
block|,
literal|0
block|}
block|,
block|{
literal|0
block|,
literal|255
block|,
literal|255
block|}
block|,
block|{
literal|0
block|,
literal|0
block|,
literal|255
block|}
block|,
block|{
literal|255
block|,
literal|0
block|,
literal|255
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|hue_saturation_dialog
specifier|static
name|HueSaturationDialog
modifier|*
name|hue_saturation_dialog
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|parent_class
specifier|static
name|GimpImageMapToolClass
modifier|*
name|parent_class
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  public functions  */
end_comment

begin_function
name|void
DECL|function|gimp_hue_saturation_tool_register (Gimp * gimp,GimpToolRegisterCallback callback)
name|gimp_hue_saturation_tool_register
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpToolRegisterCallback
name|callback
parameter_list|)
block|{
call|(
modifier|*
name|callback
call|)
argument_list|(
name|gimp
argument_list|,
name|GIMP_TYPE_HUE_SATURATION_TOOL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
literal|"gimp:hue_saturation_tool"
argument_list|,
name|_
argument_list|(
literal|"Hue-Saturation"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Adjust hue and saturation"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"/Layer/Colors/Hue-Saturation..."
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|"tools/hue_saturation.html"
argument_list|,
name|GIMP_STOCK_TOOL_HUE_SATURATION
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GType
DECL|function|gimp_hue_saturation_tool_get_type (void)
name|gimp_hue_saturation_tool_get_type
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|GType
name|tool_type
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|tool_type
condition|)
block|{
specifier|static
specifier|const
name|GTypeInfo
name|tool_info
init|=
block|{
sizeof|sizeof
argument_list|(
name|GimpHueSaturationToolClass
argument_list|)
block|,
operator|(
name|GBaseInitFunc
operator|)
name|NULL
block|,
operator|(
name|GBaseFinalizeFunc
operator|)
name|NULL
block|,
operator|(
name|GClassInitFunc
operator|)
name|gimp_hue_saturation_tool_class_init
block|,
name|NULL
block|,
comment|/* class_finalize */
name|NULL
block|,
comment|/* class_data     */
sizeof|sizeof
argument_list|(
name|GimpHueSaturationTool
argument_list|)
block|,
literal|0
block|,
comment|/* n_preallocs    */
operator|(
name|GInstanceInitFunc
operator|)
name|gimp_hue_saturation_tool_init
block|,       }
decl_stmt|;
name|tool_type
operator|=
name|g_type_register_static
argument_list|(
name|GIMP_TYPE_IMAGE_MAP_TOOL
argument_list|,
literal|"GimpHueSaturationTool"
argument_list|,
operator|&
name|tool_info
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
return|return
name|tool_type
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_hue_saturation_tool_class_init (GimpHueSaturationToolClass * klass)
name|gimp_hue_saturation_tool_class_init
parameter_list|(
name|GimpHueSaturationToolClass
modifier|*
name|klass
parameter_list|)
block|{
name|GimpToolClass
modifier|*
name|tool_class
decl_stmt|;
name|tool_class
operator|=
name|GIMP_TOOL_CLASS
argument_list|(
name|klass
argument_list|)
expr_stmt|;
name|parent_class
operator|=
name|g_type_class_peek_parent
argument_list|(
name|klass
argument_list|)
expr_stmt|;
name|tool_class
operator|->
name|initialize
operator|=
name|gimp_hue_saturation_tool_initialize
expr_stmt|;
name|tool_class
operator|->
name|control
operator|=
name|gimp_hue_saturation_tool_control
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_hue_saturation_tool_init (GimpHueSaturationTool * bc_tool)
name|gimp_hue_saturation_tool_init
parameter_list|(
name|GimpHueSaturationTool
modifier|*
name|bc_tool
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_hue_saturation_tool_initialize (GimpTool * tool,GimpDisplay * gdisp)
name|gimp_hue_saturation_tool_initialize
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpDisplay
modifier|*
name|gdisp
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|gdisp
condition|)
block|{
name|hue_saturation_dialog_hide
argument_list|()
expr_stmt|;
return|return;
block|}
if|if
condition|(
operator|!
name|gimp_drawable_is_rgb
argument_list|(
name|gimp_image_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|)
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"Hue-Saturation operates only on RGB color drawables."
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/*  The "hue-saturation" dialog  */
if|if
condition|(
operator|!
name|hue_saturation_dialog
condition|)
name|hue_saturation_dialog
operator|=
name|hue_saturation_dialog_new
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|GTK_WIDGET_VISIBLE
argument_list|(
name|hue_saturation_dialog
operator|->
name|shell
argument_list|)
condition|)
name|gtk_widget_show
argument_list|(
name|hue_saturation_dialog
operator|->
name|shell
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|7
condition|;
name|i
operator|++
control|)
block|{
name|hue_saturation_dialog
operator|->
name|hue
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
name|hue_saturation_dialog
operator|->
name|lightness
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
name|hue_saturation_dialog
operator|->
name|saturation
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
block|}
name|hue_saturation_dialog
operator|->
name|drawable
operator|=
name|gimp_image_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|hue_saturation_dialog
operator|->
name|image_map
operator|=
name|image_map_create
argument_list|(
name|gdisp
argument_list|,
name|hue_saturation_dialog
operator|->
name|drawable
argument_list|)
expr_stmt|;
name|hue_saturation_update
argument_list|(
name|hue_saturation_dialog
argument_list|,
name|ALL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_hue_saturation_tool_control (GimpTool * tool,GimpToolAction action,GimpDisplay * gdisp)
name|gimp_hue_saturation_tool_control
parameter_list|(
name|GimpTool
modifier|*
name|tool
parameter_list|,
name|GimpToolAction
name|action
parameter_list|,
name|GimpDisplay
modifier|*
name|gdisp
parameter_list|)
block|{
switch|switch
condition|(
name|action
condition|)
block|{
case|case
name|PAUSE
case|:
break|break;
case|case
name|RESUME
case|:
break|break;
case|case
name|HALT
case|:
name|hue_saturation_dialog_hide
argument_list|()
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|GIMP_TOOL_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|control
argument_list|(
name|tool
argument_list|,
name|action
argument_list|,
name|gdisp
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  hue saturation machinery  */
end_comment

begin_function
name|void
DECL|function|hue_saturation_calculate_transfers (HueSaturationDialog * hsd)
name|hue_saturation_calculate_transfers
parameter_list|(
name|HueSaturationDialog
modifier|*
name|hsd
parameter_list|)
block|{
name|gint
name|value
decl_stmt|;
name|gint
name|hue
decl_stmt|;
name|gint
name|i
decl_stmt|;
comment|/*  Calculate transfers  */
for|for
control|(
name|hue
operator|=
literal|0
init|;
name|hue
operator|<
literal|6
condition|;
name|hue
operator|++
control|)
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
name|i
operator|++
control|)
block|{
name|value
operator|=
operator|(
name|hsd
operator|->
name|hue
index|[
literal|0
index|]
operator|+
name|hsd
operator|->
name|hue
index|[
name|hue
operator|+
literal|1
index|]
operator|)
operator|*
literal|255.0
operator|/
literal|360.0
expr_stmt|;
if|if
condition|(
operator|(
name|i
operator|+
name|value
operator|)
operator|<
literal|0
condition|)
name|hue_transfer
index|[
name|hue
index|]
index|[
name|i
index|]
operator|=
literal|255
operator|+
operator|(
name|i
operator|+
name|value
operator|)
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|i
operator|+
name|value
operator|)
operator|>
literal|255
condition|)
name|hue_transfer
index|[
name|hue
index|]
index|[
name|i
index|]
operator|=
name|i
operator|+
name|value
operator|-
literal|255
expr_stmt|;
else|else
name|hue_transfer
index|[
name|hue
index|]
index|[
name|i
index|]
operator|=
name|i
operator|+
name|value
expr_stmt|;
comment|/*  Lightness  */
name|value
operator|=
operator|(
name|hsd
operator|->
name|lightness
index|[
literal|0
index|]
operator|+
name|hsd
operator|->
name|lightness
index|[
name|hue
operator|+
literal|1
index|]
operator|)
operator|*
literal|127.0
operator|/
literal|100.0
expr_stmt|;
name|value
operator|=
name|CLAMP
argument_list|(
name|value
argument_list|,
operator|-
literal|255
argument_list|,
literal|255
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|<
literal|0
condition|)
name|lightness_transfer
index|[
name|hue
index|]
index|[
name|i
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
operator|(
name|i
operator|*
operator|(
literal|255
operator|+
name|value
operator|)
operator|)
operator|/
literal|255
argument_list|)
expr_stmt|;
else|else
name|lightness_transfer
index|[
name|hue
index|]
index|[
name|i
index|]
operator|=
call|(
name|unsigned
name|char
call|)
argument_list|(
name|i
operator|+
operator|(
operator|(
literal|255
operator|-
name|i
operator|)
operator|*
name|value
operator|)
operator|/
literal|255
argument_list|)
expr_stmt|;
comment|/*  Saturation  */
name|value
operator|=
operator|(
name|hsd
operator|->
name|saturation
index|[
literal|0
index|]
operator|+
name|hsd
operator|->
name|saturation
index|[
name|hue
operator|+
literal|1
index|]
operator|)
operator|*
literal|255.0
operator|/
literal|100.0
expr_stmt|;
name|value
operator|=
name|CLAMP
argument_list|(
name|value
argument_list|,
operator|-
literal|255
argument_list|,
literal|255
argument_list|)
expr_stmt|;
comment|/* This change affects the way saturation is computed. With the 	   old code (different code for value< 0), increasing the 	   saturation affected muted colors very much, and bright colors 	   less. With the new code, it affects muted colors and bright 	   colors more or less evenly. For enhancing the color in photos, 	   the new behavior is exactly what you want. It's hard for me 	   to imagine a case in which the old behavior is better. 	*/
name|saturation_transfer
index|[
name|hue
index|]
index|[
name|i
index|]
operator|=
name|CLAMP
argument_list|(
operator|(
name|i
operator|*
operator|(
literal|255
operator|+
name|value
operator|)
operator|)
operator|/
literal|255
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|hue_saturation (PixelRegion * srcPR,PixelRegion * destPR,void * user_data)
name|hue_saturation
parameter_list|(
name|PixelRegion
modifier|*
name|srcPR
parameter_list|,
name|PixelRegion
modifier|*
name|destPR
parameter_list|,
name|void
modifier|*
name|user_data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|unsigned
name|char
modifier|*
name|src
decl_stmt|,
modifier|*
name|s
decl_stmt|;
name|unsigned
name|char
modifier|*
name|dest
decl_stmt|,
modifier|*
name|d
decl_stmt|;
name|int
name|alpha
decl_stmt|;
name|int
name|w
decl_stmt|,
name|h
decl_stmt|;
name|int
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|int
name|hue
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|user_data
expr_stmt|;
comment|/*  Set the transfer arrays  (for speed)  */
name|h
operator|=
name|srcPR
operator|->
name|h
expr_stmt|;
name|src
operator|=
name|srcPR
operator|->
name|data
expr_stmt|;
name|dest
operator|=
name|destPR
operator|->
name|data
expr_stmt|;
name|alpha
operator|=
operator|(
name|srcPR
operator|->
name|bytes
operator|==
literal|4
operator|)
condition|?
name|TRUE
else|:
name|FALSE
expr_stmt|;
while|while
condition|(
name|h
operator|--
condition|)
block|{
name|w
operator|=
name|srcPR
operator|->
name|w
expr_stmt|;
name|s
operator|=
name|src
expr_stmt|;
name|d
operator|=
name|dest
expr_stmt|;
while|while
condition|(
name|w
operator|--
condition|)
block|{
name|r
operator|=
name|s
index|[
name|RED_PIX
index|]
expr_stmt|;
name|g
operator|=
name|s
index|[
name|GREEN_PIX
index|]
expr_stmt|;
name|b
operator|=
name|s
index|[
name|BLUE_PIX
index|]
expr_stmt|;
name|gimp_rgb_to_hls_int
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
if|if
condition|(
name|r
operator|<
literal|43
condition|)
name|hue
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|r
operator|<
literal|85
condition|)
name|hue
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|r
operator|<
literal|128
condition|)
name|hue
operator|=
literal|2
expr_stmt|;
elseif|else
if|if
condition|(
name|r
operator|<
literal|171
condition|)
name|hue
operator|=
literal|3
expr_stmt|;
elseif|else
if|if
condition|(
name|r
operator|<
literal|213
condition|)
name|hue
operator|=
literal|4
expr_stmt|;
else|else
name|hue
operator|=
literal|5
expr_stmt|;
name|r
operator|=
name|hue_transfer
index|[
name|hue
index|]
index|[
name|r
index|]
expr_stmt|;
name|g
operator|=
name|lightness_transfer
index|[
name|hue
index|]
index|[
name|g
index|]
expr_stmt|;
name|b
operator|=
name|saturation_transfer
index|[
name|hue
index|]
index|[
name|b
index|]
expr_stmt|;
name|gimp_hls_to_rgb_int
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
name|d
index|[
name|RED_PIX
index|]
operator|=
name|r
expr_stmt|;
name|d
index|[
name|GREEN_PIX
index|]
operator|=
name|g
expr_stmt|;
name|d
index|[
name|BLUE_PIX
index|]
operator|=
name|b
expr_stmt|;
if|if
condition|(
name|alpha
condition|)
name|d
index|[
name|ALPHA_PIX
index|]
operator|=
name|s
index|[
name|ALPHA_PIX
index|]
expr_stmt|;
name|s
operator|+=
name|srcPR
operator|->
name|bytes
expr_stmt|;
name|d
operator|+=
name|destPR
operator|->
name|bytes
expr_stmt|;
block|}
name|src
operator|+=
name|srcPR
operator|->
name|rowstride
expr_stmt|;
name|dest
operator|+=
name|destPR
operator|->
name|rowstride
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  hue saturation action functions  */
end_comment

begin_function
name|void
DECL|function|hue_saturation_free (void)
name|hue_saturation_free
parameter_list|(
name|void
parameter_list|)
block|{
name|GimpTool
modifier|*
name|active_tool
decl_stmt|;
name|active_tool
operator|=
name|tool_manager_get_active
argument_list|(
name|the_gimp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hue_saturation_dialog
condition|)
block|{
if|if
condition|(
name|hue_saturation_dialog
operator|->
name|image_map
condition|)
block|{
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
name|image_map_abort
argument_list|(
name|hue_saturation_dialog
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|hue_saturation_dialog
operator|->
name|image_map
operator|=
name|NULL
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|hue_saturation_dialog
operator|->
name|shell
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/***************************/
end_comment

begin_comment
comment|/*  Hue-Saturation dialog  */
end_comment

begin_comment
comment|/***************************/
end_comment

begin_function
specifier|static
name|HueSaturationDialog
modifier|*
DECL|function|hue_saturation_dialog_new (void)
name|hue_saturation_dialog_new
parameter_list|(
name|void
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|GtkWidget
modifier|*
name|main_vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|main_hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|slider
decl_stmt|;
name|GtkWidget
modifier|*
name|abox
decl_stmt|;
name|GtkWidget
modifier|*
name|spinbutton
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|radio_button
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkObject
modifier|*
name|data
decl_stmt|;
name|GSList
modifier|*
name|group
init|=
name|NULL
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gchar
modifier|*
name|hue_partition_names
index|[]
init|=
block|{
name|N_
argument_list|(
literal|"Master"
argument_list|)
block|,
name|N_
argument_list|(
literal|"R"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Y"
argument_list|)
block|,
name|N_
argument_list|(
literal|"G"
argument_list|)
block|,
name|N_
argument_list|(
literal|"C"
argument_list|)
block|,
name|N_
argument_list|(
literal|"B"
argument_list|)
block|,
name|N_
argument_list|(
literal|"M"
argument_list|)
block|}
decl_stmt|;
name|hsd
operator|=
name|g_new
argument_list|(
name|HueSaturationDialog
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|hsd
operator|->
name|hue_partition
operator|=
name|ALL_HUES
expr_stmt|;
name|hsd
operator|->
name|preview
operator|=
name|TRUE
expr_stmt|;
comment|/*  The shell and main vbox  */
name|hsd
operator|->
name|shell
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Hue-Saturation"
argument_list|)
argument_list|,
literal|"hue_saturation"
argument_list|,
name|tool_manager_help_func
argument_list|,
name|NULL
argument_list|,
name|GTK_WIN_POS_NONE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|hue_saturation_cancel_callback
argument_list|,
name|hsd
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|GIMP_STOCK_RESET
argument_list|,
name|hue_saturation_reset_callback
argument_list|,
name|hsd
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|hue_saturation_ok_callback
argument_list|,
name|hsd
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|main_vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|hsd
operator|->
name|shell
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|main_vbox
argument_list|)
expr_stmt|;
comment|/*  The main hbox containing hue partitions and sliders  */
name|main_hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_vbox
argument_list|)
argument_list|,
name|main_hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The table containing hue partitions  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|7
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  the radio buttons for hue partitions  */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|7
condition|;
name|i
operator|++
control|)
block|{
name|radio_button
operator|=
name|gtk_radio_button_new_with_label
argument_list|(
name|group
argument_list|,
name|gettext
argument_list|(
name|hue_partition_names
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_button_get_group
argument_list|(
name|GTK_RADIO_BUTTON
argument_list|(
name|radio_button
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|radio_button
argument_list|)
argument_list|,
literal|"hue_partition"
argument_list|,
operator|(
name|gpointer
operator|)
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|i
condition|)
block|{
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|radio_button
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|radio_button
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|i
argument_list|,
name|i
operator|+
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|frame
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|i
argument_list|,
name|i
operator|+
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
operator|-
literal|1
index|]
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
operator|-
literal|1
index|]
argument_list|)
argument_list|,
name|DA_WIDTH
argument_list|,
name|DA_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
operator|-
literal|1
index|]
argument_list|,
name|HUE_PARTITION_MASK
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
operator|-
literal|1
index|]
argument_list|)
argument_list|,
literal|"event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|hue_saturation_hue_partition_events
argument_list|)
argument_list|,
name|hsd
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
block|}
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|radio_button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|hue_saturation_partition_callback
argument_list|)
argument_list|,
name|hsd
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|radio_button
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*  The vbox for the table and preview toggle  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|main_hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Hue / Lightness / Saturation Adjustments"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/*  The table containing sliders  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  Create the hue scale widget  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Hue:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0
argument_list|,
operator|-
literal|180
argument_list|,
literal|180.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|hsd
operator|->
name|hue_data
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|hsd
operator|->
name|hue_data
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|slider
argument_list|,
name|SLIDER_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|abox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gtk_spin_button_new
argument_list|(
name|hsd
operator|->
name|hue_data
argument_list|,
literal|1.0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|spinbutton
argument_list|,
literal|74
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|abox
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|abox
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|hsd
operator|->
name|hue_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|hue_saturation_hue_adjustment_update
argument_list|)
argument_list|,
name|hsd
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|abox
argument_list|)
expr_stmt|;
comment|/*  Create the lightness scale widget  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Lightness:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|hsd
operator|->
name|lightness_data
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|hsd
operator|->
name|lightness_data
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|slider
argument_list|,
name|SLIDER_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|abox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gtk_spin_button_new
argument_list|(
name|hsd
operator|->
name|lightness_data
argument_list|,
literal|1.0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|spinbutton
argument_list|,
literal|75
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|abox
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|abox
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|hsd
operator|->
name|lightness_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|hue_saturation_lightness_adjustment_update
argument_list|)
argument_list|,
name|hsd
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|abox
argument_list|)
expr_stmt|;
comment|/*  Create the saturation scale widget  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Saturation:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0
argument_list|,
operator|-
literal|100.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|hsd
operator|->
name|saturation_data
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|data
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|hsd
operator|->
name|saturation_data
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|slider
argument_list|,
name|SLIDER_WIDTH
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|abox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|spinbutton
operator|=
name|gtk_spin_button_new
argument_list|(
name|hsd
operator|->
name|saturation_data
argument_list|,
literal|1.0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|spinbutton
argument_list|,
literal|75
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|abox
argument_list|)
argument_list|,
name|spinbutton
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|abox
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|hsd
operator|->
name|saturation_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|hue_saturation_saturation_adjustment_update
argument_list|)
argument_list|,
name|hsd
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|spinbutton
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|abox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
comment|/*  Horizontal box for preview toggle button  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The preview toggle  */
name|toggle
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Preview"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|toggle
argument_list|)
argument_list|,
name|hsd
operator|->
name|preview
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|hue_saturation_preview_update
argument_list|)
argument_list|,
name|hsd
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|main_vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hsd
operator|->
name|shell
argument_list|)
expr_stmt|;
return|return
name|hsd
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_dialog_hide (void)
name|hue_saturation_dialog_hide
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|hue_saturation_dialog
condition|)
name|hue_saturation_cancel_callback
argument_list|(
name|NULL
argument_list|,
operator|(
name|gpointer
operator|)
name|hue_saturation_dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_update (HueSaturationDialog * hsd,gint update)
name|hue_saturation_update
parameter_list|(
name|HueSaturationDialog
modifier|*
name|hsd
parameter_list|,
name|gint
name|update
parameter_list|)
block|{
name|gint
name|i
decl_stmt|,
name|j
decl_stmt|,
name|b
decl_stmt|;
name|gint
name|rgb
index|[
literal|3
index|]
decl_stmt|;
name|guchar
name|buf
index|[
name|DA_WIDTH
operator|*
literal|3
index|]
decl_stmt|;
if|if
condition|(
name|update
operator|&
name|HUE_SLIDER
condition|)
block|{
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|hsd
operator|->
name|hue_data
argument_list|)
argument_list|,
name|hsd
operator|->
name|hue
index|[
name|hsd
operator|->
name|hue_partition
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|update
operator|&
name|LIGHTNESS_SLIDER
condition|)
block|{
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|hsd
operator|->
name|lightness_data
argument_list|)
argument_list|,
name|hsd
operator|->
name|lightness
index|[
name|hsd
operator|->
name|hue_partition
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|update
operator|&
name|SATURATION_SLIDER
condition|)
block|{
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|hsd
operator|->
name|saturation_data
argument_list|)
argument_list|,
name|hsd
operator|->
name|saturation
index|[
name|hsd
operator|->
name|hue_partition
index|]
argument_list|)
expr_stmt|;
block|}
name|hue_saturation_calculate_transfers
argument_list|(
name|hsd
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|rgb
index|[
name|RED_PIX
index|]
operator|=
name|default_colors
index|[
name|i
index|]
index|[
name|RED_PIX
index|]
expr_stmt|;
name|rgb
index|[
name|GREEN_PIX
index|]
operator|=
name|default_colors
index|[
name|i
index|]
index|[
name|GREEN_PIX
index|]
expr_stmt|;
name|rgb
index|[
name|BLUE_PIX
index|]
operator|=
name|default_colors
index|[
name|i
index|]
index|[
name|BLUE_PIX
index|]
expr_stmt|;
name|gimp_rgb_to_hls_int
argument_list|(
name|rgb
argument_list|,
name|rgb
operator|+
literal|1
argument_list|,
name|rgb
operator|+
literal|2
argument_list|)
expr_stmt|;
name|rgb
index|[
name|RED_PIX
index|]
operator|=
name|hue_transfer
index|[
name|i
index|]
index|[
name|rgb
index|[
name|RED_PIX
index|]
index|]
expr_stmt|;
name|rgb
index|[
name|GREEN_PIX
index|]
operator|=
name|lightness_transfer
index|[
name|i
index|]
index|[
name|rgb
index|[
name|GREEN_PIX
index|]
index|]
expr_stmt|;
name|rgb
index|[
name|BLUE_PIX
index|]
operator|=
name|saturation_transfer
index|[
name|i
index|]
index|[
name|rgb
index|[
name|BLUE_PIX
index|]
index|]
expr_stmt|;
name|gimp_hls_to_rgb_int
argument_list|(
name|rgb
argument_list|,
name|rgb
operator|+
literal|1
argument_list|,
name|rgb
operator|+
literal|2
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|DA_WIDTH
condition|;
name|j
operator|++
control|)
for|for
control|(
name|b
operator|=
literal|0
init|;
name|b
operator|<
literal|3
condition|;
name|b
operator|++
control|)
name|buf
index|[
name|j
operator|*
literal|3
operator|+
name|b
index|]
operator|=
operator|(
name|guchar
operator|)
name|rgb
index|[
name|b
index|]
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|DA_HEIGHT
condition|;
name|j
operator|++
control|)
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
index|]
argument_list|)
argument_list|,
name|buf
argument_list|,
literal|0
argument_list|,
name|j
argument_list|,
name|DA_WIDTH
argument_list|)
expr_stmt|;
if|if
condition|(
name|update
operator|&
name|DRAW
condition|)
name|gtk_widget_queue_draw
argument_list|(
name|hsd
operator|->
name|hue_partition_da
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_preview (HueSaturationDialog * hsd)
name|hue_saturation_preview
parameter_list|(
name|HueSaturationDialog
modifier|*
name|hsd
parameter_list|)
block|{
name|GimpTool
modifier|*
name|active_tool
decl_stmt|;
name|active_tool
operator|=
name|tool_manager_get_active
argument_list|(
name|the_gimp
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|hsd
operator|->
name|image_map
condition|)
block|{
name|g_warning
argument_list|(
literal|"hue_saturation_preview(): No image map"
argument_list|)
expr_stmt|;
return|return;
block|}
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
name|image_map_apply
argument_list|(
name|hsd
operator|->
name|image_map
argument_list|,
name|hue_saturation
argument_list|,
operator|(
name|void
operator|*
operator|)
name|hsd
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_reset_callback (GtkWidget * widget,gpointer data)
name|hue_saturation_reset_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
name|hsd
operator|->
name|hue
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|=
literal|0.0
expr_stmt|;
name|hsd
operator|->
name|lightness
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|=
literal|0.0
expr_stmt|;
name|hsd
operator|->
name|saturation
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|=
literal|0.0
expr_stmt|;
name|hue_saturation_update
argument_list|(
name|hsd
argument_list|,
name|ALL
argument_list|)
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|preview
condition|)
name|hue_saturation_preview
argument_list|(
name|hsd
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_ok_callback (GtkWidget * widget,gpointer data)
name|hue_saturation_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|GimpTool
modifier|*
name|active_tool
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|hsd
operator|->
name|shell
argument_list|)
expr_stmt|;
name|active_tool
operator|=
name|tool_manager_get_active
argument_list|(
name|the_gimp
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
operator|!
name|hsd
operator|->
name|preview
condition|)
name|image_map_apply
argument_list|(
name|hsd
operator|->
name|image_map
argument_list|,
name|hue_saturation
argument_list|,
operator|(
name|gpointer
operator|)
name|hsd
argument_list|)
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|image_map
condition|)
name|image_map_commit
argument_list|(
name|hsd
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|hsd
operator|->
name|image_map
operator|=
name|NULL
expr_stmt|;
name|active_tool
operator|->
name|gdisp
operator|=
name|NULL
expr_stmt|;
name|active_tool
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_cancel_callback (GtkWidget * widget,gpointer data)
name|hue_saturation_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|GimpTool
modifier|*
name|active_tool
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|hsd
operator|->
name|shell
argument_list|)
expr_stmt|;
name|active_tool
operator|=
name|tool_manager_get_active
argument_list|(
name|the_gimp
argument_list|)
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|image_map
condition|)
block|{
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
name|image_map_abort
argument_list|(
name|hsd
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
name|hsd
operator|->
name|image_map
operator|=
name|NULL
expr_stmt|;
block|}
name|active_tool
operator|->
name|gdisp
operator|=
name|NULL
expr_stmt|;
name|active_tool
operator|->
name|drawable
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_partition_callback (GtkWidget * widget,gpointer data)
name|hue_saturation_partition_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|HueRange
name|partition
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
name|partition
operator|=
operator|(
name|HueRange
operator|)
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"hue_partition"
argument_list|)
expr_stmt|;
name|hsd
operator|->
name|hue_partition
operator|=
name|partition
expr_stmt|;
name|hue_saturation_update
argument_list|(
name|hsd
argument_list|,
name|ALL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_preview_update (GtkWidget * widget,gpointer data)
name|hue_saturation_preview_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|GimpTool
modifier|*
name|active_tool
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|hsd
operator|->
name|preview
operator|=
name|TRUE
expr_stmt|;
name|hue_saturation_preview
argument_list|(
name|hsd
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|hsd
operator|->
name|preview
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|image_map
condition|)
block|{
name|active_tool
operator|=
name|tool_manager_get_active
argument_list|(
name|the_gimp
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|TRUE
expr_stmt|;
name|image_map_clear
argument_list|(
name|hsd
operator|->
name|image_map
argument_list|)
expr_stmt|;
name|active_tool
operator|->
name|preserve
operator|=
name|FALSE
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_hue_adjustment_update (GtkAdjustment * adjustment,gpointer data)
name|hue_saturation_hue_adjustment_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|hue
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|!=
name|adjustment
operator|->
name|value
condition|)
block|{
name|hsd
operator|->
name|hue
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
name|hue_saturation_update
argument_list|(
name|hsd
argument_list|,
name|DRAW
argument_list|)
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|preview
condition|)
name|hue_saturation_preview
argument_list|(
name|hsd
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_lightness_adjustment_update (GtkAdjustment * adjustment,gpointer data)
name|hue_saturation_lightness_adjustment_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|lightness
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|!=
name|adjustment
operator|->
name|value
condition|)
block|{
name|hsd
operator|->
name|lightness
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
name|hue_saturation_update
argument_list|(
name|hsd
argument_list|,
name|DRAW
argument_list|)
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|preview
condition|)
name|hue_saturation_preview
argument_list|(
name|hsd
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|hue_saturation_saturation_adjustment_update (GtkAdjustment * adjustment,gpointer data)
name|hue_saturation_saturation_adjustment_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|HueSaturationDialog
modifier|*
name|hsd
decl_stmt|;
name|hsd
operator|=
operator|(
name|HueSaturationDialog
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|saturation
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|!=
name|adjustment
operator|->
name|value
condition|)
block|{
name|hsd
operator|->
name|saturation
index|[
name|hsd
operator|->
name|hue_partition
index|]
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
name|hue_saturation_update
argument_list|(
name|hsd
argument_list|,
name|DRAW
argument_list|)
expr_stmt|;
if|if
condition|(
name|hsd
operator|->
name|preview
condition|)
name|hue_saturation_preview
argument_list|(
name|hsd
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|hue_saturation_hue_partition_events (GtkWidget * widget,GdkEvent * event,HueSaturationDialog * hsd)
name|hue_saturation_hue_partition_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|HueSaturationDialog
modifier|*
name|hsd
parameter_list|)
block|{
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|hue_saturation_update
argument_list|(
name|hsd
argument_list|,
name|HUE_PARTITION
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

end_unit

