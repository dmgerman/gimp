begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 2009 Martin Nordholts  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"core/core-types.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdrawable.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpgrid.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpguide.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-grid.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-guides.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage-sample-points.h"
end_include

begin_include
include|#
directive|include
file|"core/gimplayer.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpsamplepoint.h"
end_include

begin_include
include|#
directive|include
file|"file/file-open.h"
end_include

begin_include
include|#
directive|include
file|"file/file-procedure.h"
end_include

begin_include
include|#
directive|include
file|"file/file-save.h"
end_include

begin_include
include|#
directive|include
file|"plug-in/gimppluginmanager.h"
end_include

begin_include
include|#
directive|include
file|"tests.h"
end_include

begin_include
include|#
directive|include
file|"gimp-app-test-utils.h"
end_include

begin_define
DECL|macro|GIMP_MAINIMAGE_WIDTH
define|#
directive|define
name|GIMP_MAINIMAGE_WIDTH
value|100
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_HEIGHT
define|#
directive|define
name|GIMP_MAINIMAGE_HEIGHT
value|90
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_TYPE
define|#
directive|define
name|GIMP_MAINIMAGE_TYPE
value|GIMP_RGB
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_LAYER1_WIDTH
define|#
directive|define
name|GIMP_MAINIMAGE_LAYER1_WIDTH
value|50
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_LAYER1_HEIGHT
define|#
directive|define
name|GIMP_MAINIMAGE_LAYER1_HEIGHT
value|51
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_LAYER1_TYPE
define|#
directive|define
name|GIMP_MAINIMAGE_LAYER1_TYPE
value|GIMP_RGBA_IMAGE
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_LAYER1_NAME
define|#
directive|define
name|GIMP_MAINIMAGE_LAYER1_NAME
value|"foo"
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_LAYER1_OPACITY
define|#
directive|define
name|GIMP_MAINIMAGE_LAYER1_OPACITY
value|1.0
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_LAYER1_MODE
define|#
directive|define
name|GIMP_MAINIMAGE_LAYER1_MODE
value|GIMP_NORMAL_MODE
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_VGUIDE1_POS
define|#
directive|define
name|GIMP_MAINIMAGE_VGUIDE1_POS
value|42
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_VGUIDE2_POS
define|#
directive|define
name|GIMP_MAINIMAGE_VGUIDE2_POS
value|82
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_HGUIDE1_POS
define|#
directive|define
name|GIMP_MAINIMAGE_HGUIDE1_POS
value|3
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_HGUIDE2_POS
define|#
directive|define
name|GIMP_MAINIMAGE_HGUIDE2_POS
value|4
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_SAMPLEPOINT1_X
define|#
directive|define
name|GIMP_MAINIMAGE_SAMPLEPOINT1_X
value|10
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_SAMPLEPOINT1_Y
define|#
directive|define
name|GIMP_MAINIMAGE_SAMPLEPOINT1_Y
value|12
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_SAMPLEPOINT2_X
define|#
directive|define
name|GIMP_MAINIMAGE_SAMPLEPOINT2_X
value|41
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_SAMPLEPOINT2_Y
define|#
directive|define
name|GIMP_MAINIMAGE_SAMPLEPOINT2_Y
value|49
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_RESOLUTIONX
define|#
directive|define
name|GIMP_MAINIMAGE_RESOLUTIONX
value|400
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_RESOLUTIONY
define|#
directive|define
name|GIMP_MAINIMAGE_RESOLUTIONY
value|410
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_PARASITE_NAME
define|#
directive|define
name|GIMP_MAINIMAGE_PARASITE_NAME
value|"test-parasite"
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_PARASITE_DATA
define|#
directive|define
name|GIMP_MAINIMAGE_PARASITE_DATA
value|"foo"
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_PARASITE_SIZE
define|#
directive|define
name|GIMP_MAINIMAGE_PARASITE_SIZE
value|4
end_define

begin_comment
DECL|macro|GIMP_MAINIMAGE_PARASITE_SIZE
comment|/* 'f' 'o' 'o' '\0' */
end_comment

begin_define
DECL|macro|GIMP_MAINIMAGE_UNIT
define|#
directive|define
name|GIMP_MAINIMAGE_UNIT
value|GIMP_UNIT_PICA
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_GRIDXSPACING
define|#
directive|define
name|GIMP_MAINIMAGE_GRIDXSPACING
value|25.0
end_define

begin_define
DECL|macro|GIMP_MAINIMAGE_GRIDYSPACING
define|#
directive|define
name|GIMP_MAINIMAGE_GRIDYSPACING
value|27.0
end_define

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2a98d7090108
block|{
DECL|member|avoid_sizeof_zero
name|gint
name|avoid_sizeof_zero
decl_stmt|;
DECL|typedef|GimpTestFixture
block|}
name|GimpTestFixture
typedef|;
end_typedef

begin_function_decl
specifier|static
name|void
name|gimp_write_and_read_current_format
parameter_list|(
name|GimpTestFixture
modifier|*
name|fixture
parameter_list|,
name|gconstpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpImage
modifier|*
name|gimp_create_mainimage
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_assert_mainimage
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|gimp
specifier|static
name|Gimp
modifier|*
name|gimp
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**  * gimp_write_and_read_current_format:  * @fixture:  * @data:  *  * Constructs the main test image and asserts its state, writes it to  * a file, reads the image from the file, and asserts the state of the  * loaded file.  **/
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_write_and_read_current_format (GimpTestFixture * fixture,gconstpointer data)
name|gimp_write_and_read_current_format
parameter_list|(
name|GimpTestFixture
modifier|*
name|fixture
parameter_list|,
name|gconstpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|NULL
decl_stmt|;
name|GimpImage
modifier|*
name|loaded_image
init|=
name|NULL
decl_stmt|;
name|GimpPlugInProcedure
modifier|*
name|proc
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|uri
init|=
name|NULL
decl_stmt|;
name|GimpPDBStatusType
name|status
init|=
literal|0
decl_stmt|;
comment|/* Create the image */
name|image
operator|=
name|gimp_create_mainimage
argument_list|()
expr_stmt|;
comment|/* Assert valid state */
name|gimp_assert_mainimage
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/* Write to file */
name|uri
operator|=
name|g_build_filename
argument_list|(
name|g_get_tmp_dir
argument_list|()
argument_list|,
literal|"gimp-test.xcf"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|proc
operator|=
name|file_procedure_find
argument_list|(
name|image
operator|->
name|gimp
operator|->
name|plug_in_manager
operator|->
name|save_procs
argument_list|,
name|uri
argument_list|,
name|NULL
comment|/*error*/
argument_list|)
expr_stmt|;
name|file_save
argument_list|(
name|gimp
argument_list|,
name|image
argument_list|,
name|NULL
comment|/*progress*/
argument_list|,
name|uri
argument_list|,
name|proc
argument_list|,
name|GIMP_RUN_NONINTERACTIVE
argument_list|,
name|FALSE
comment|/*change_saved_state*/
argument_list|,
name|FALSE
comment|/*export*/
argument_list|,
name|NULL
comment|/*error*/
argument_list|)
expr_stmt|;
comment|/* Load from file */
name|proc
operator|=
name|file_procedure_find
argument_list|(
name|image
operator|->
name|gimp
operator|->
name|plug_in_manager
operator|->
name|load_procs
argument_list|,
name|uri
argument_list|,
name|NULL
comment|/*error*/
argument_list|)
expr_stmt|;
name|loaded_image
operator|=
name|file_open_image
argument_list|(
name|gimp
argument_list|,
name|gimp_get_user_context
argument_list|(
name|gimp
argument_list|)
argument_list|,
name|NULL
comment|/*progress*/
argument_list|,
name|uri
argument_list|,
literal|"irrelevant"
comment|/*entered_filename*/
argument_list|,
name|FALSE
comment|/*as_new*/
argument_list|,
name|proc
argument_list|,
name|GIMP_RUN_NONINTERACTIVE
argument_list|,
operator|&
name|status
argument_list|,
name|NULL
comment|/*mime_type*/
argument_list|,
name|NULL
comment|/*error*/
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
comment|/* Assert on the loaded file. If success, it means that there is no    * significant information loss when we wrote the image to a file    * and loaded it again    */
name|gimp_assert_mainimage
argument_list|(
name|loaded_image
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_create_mainimage:  *  * Creates the main test image, i.e. the image that we use for most of  * our XCF testing purposes.  *  * Returns: The #GimpImage  **/
end_comment

begin_function
specifier|static
name|GimpImage
modifier|*
DECL|function|gimp_create_mainimage (void)
name|gimp_create_mainimage
parameter_list|(
name|void
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|NULL
decl_stmt|;
name|GimpLayer
modifier|*
name|layer
init|=
name|NULL
decl_stmt|;
name|GimpParasite
modifier|*
name|parasite
init|=
name|NULL
decl_stmt|;
name|GimpGrid
modifier|*
name|grid
init|=
name|NULL
decl_stmt|;
comment|/* Image size and type */
name|image
operator|=
name|gimp_image_new
argument_list|(
name|gimp
argument_list|,
name|GIMP_MAINIMAGE_WIDTH
argument_list|,
name|GIMP_MAINIMAGE_HEIGHT
argument_list|,
name|GIMP_MAINIMAGE_TYPE
argument_list|)
expr_stmt|;
comment|/* Layer */
name|layer
operator|=
name|gimp_layer_new
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_WIDTH
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_HEIGHT
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_TYPE
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_NAME
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_OPACITY
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_MODE
argument_list|)
expr_stmt|;
name|gimp_image_add_layer
argument_list|(
name|image
argument_list|,
name|layer
argument_list|,
name|NULL
argument_list|,
operator|-
literal|1
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
comment|/* Image compression type    *    * We don't do any explicit test, only implicit when we read tile    * data in other tests    */
comment|/* Guides, note we add them in reversed order */
name|gimp_image_add_hguide
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_HGUIDE2_POS
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
name|gimp_image_add_hguide
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_HGUIDE1_POS
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
name|gimp_image_add_vguide
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_VGUIDE2_POS
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
name|gimp_image_add_vguide
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_VGUIDE1_POS
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
comment|/* Sample points */
name|gimp_image_add_sample_point_at_pos
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT1_X
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT1_Y
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
name|gimp_image_add_sample_point_at_pos
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT2_X
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT2_Y
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
comment|/* Tatto    * We don't bother testing this, not yet at least    */
comment|/* Resolution */
name|gimp_image_set_resolution
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_RESOLUTIONX
argument_list|,
name|GIMP_MAINIMAGE_RESOLUTIONY
argument_list|)
expr_stmt|;
comment|/* Parasites */
name|parasite
operator|=
name|gimp_parasite_new
argument_list|(
name|GIMP_MAINIMAGE_PARASITE_NAME
argument_list|,
name|GIMP_PARASITE_PERSISTENT
argument_list|,
name|GIMP_MAINIMAGE_PARASITE_SIZE
argument_list|,
name|GIMP_MAINIMAGE_PARASITE_DATA
argument_list|)
expr_stmt|;
name|gimp_image_parasite_attach
argument_list|(
name|image
argument_list|,
name|parasite
argument_list|)
expr_stmt|;
comment|/* Unit */
name|gimp_image_set_unit
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_UNIT
argument_list|)
expr_stmt|;
comment|/* Grid */
name|grid
operator|=
name|g_object_new
argument_list|(
name|GIMP_TYPE_GRID
argument_list|,
literal|"xspacing"
argument_list|,
name|GIMP_MAINIMAGE_GRIDXSPACING
argument_list|,
literal|"yspacing"
argument_list|,
name|GIMP_MAINIMAGE_GRIDYSPACING
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_image_set_grid
argument_list|(
name|image
argument_list|,
name|grid
argument_list|,
name|FALSE
comment|/*push_undo*/
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|grid
argument_list|)
expr_stmt|;
comment|/* Todo, test somehow:    *    * - Color maps    * - Custom user units    * - Old-style paths, gimp_vectors_compat_is_compatible()    * - New-style paths    * - Layers, more compliated compositions    * - Channels, including selection    * - Floating selection    */
return|return
name|image
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_assert_mainimage:  * @image:  *  * Verifies that the passed #GimpImage contains all the information  * that was put in it by gimp_create_mainimage().  **/
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_assert_mainimage (GimpImage * image)
name|gimp_assert_mainimage
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
specifier|const
name|GimpParasite
modifier|*
name|parasite
init|=
name|NULL
decl_stmt|;
name|GimpLayer
modifier|*
name|layer
init|=
name|NULL
decl_stmt|;
name|GList
modifier|*
name|iter
init|=
name|NULL
decl_stmt|;
name|GimpGuide
modifier|*
name|guide
init|=
name|NULL
decl_stmt|;
name|GimpSamplePoint
modifier|*
name|sample_point
init|=
name|NULL
decl_stmt|;
name|gdouble
name|xres
init|=
literal|0.0
decl_stmt|;
name|gdouble
name|yres
init|=
literal|0.0
decl_stmt|;
name|GimpGrid
modifier|*
name|grid
init|=
name|NULL
decl_stmt|;
name|gdouble
name|xspacing
init|=
literal|0.0
decl_stmt|;
name|gdouble
name|yspacing
init|=
literal|0.0
decl_stmt|;
comment|/* Image size and type */
name|g_assert_cmpint
argument_list|(
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_WIDTH
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_HEIGHT
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_image_base_type
argument_list|(
name|image
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_TYPE
argument_list|)
expr_stmt|;
comment|/* Layer */
name|layer
operator|=
name|gimp_image_get_layer_by_name
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_NAME
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_item_get_width
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_WIDTH
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_item_get_height
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_HEIGHT
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_drawable_type
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_TYPE
argument_list|)
expr_stmt|;
name|g_assert_cmpstr
argument_list|(
name|gimp_object_get_name
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_NAME
argument_list|)
expr_stmt|;
name|g_assert_cmpfloat
argument_list|(
name|gimp_layer_get_opacity
argument_list|(
name|layer
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_OPACITY
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_layer_get_mode
argument_list|(
name|layer
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_LAYER1_MODE
argument_list|)
expr_stmt|;
comment|/* Guides, note that we rely on internal ordering */
name|iter
operator|=
name|gimp_image_get_guides
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|guide
operator|=
name|GIMP_GUIDE
argument_list|(
name|iter
operator|->
name|data
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_guide_get_position
argument_list|(
name|guide
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_VGUIDE1_POS
argument_list|)
expr_stmt|;
name|iter
operator|=
name|g_list_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|guide
operator|=
name|GIMP_GUIDE
argument_list|(
name|iter
operator|->
name|data
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_guide_get_position
argument_list|(
name|guide
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_VGUIDE2_POS
argument_list|)
expr_stmt|;
name|iter
operator|=
name|g_list_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|guide
operator|=
name|GIMP_GUIDE
argument_list|(
name|iter
operator|->
name|data
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_guide_get_position
argument_list|(
name|guide
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_HGUIDE1_POS
argument_list|)
expr_stmt|;
name|iter
operator|=
name|g_list_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|guide
operator|=
name|GIMP_GUIDE
argument_list|(
name|iter
operator|->
name|data
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_guide_get_position
argument_list|(
name|guide
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_HGUIDE2_POS
argument_list|)
expr_stmt|;
name|iter
operator|=
name|g_list_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|==
name|NULL
argument_list|)
expr_stmt|;
comment|/* Sample points, we rely on the same ordering as when we added    * them, although this ordering is not a necessaity    */
name|iter
operator|=
name|gimp_image_get_sample_points
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|sample_point
operator|=
operator|(
name|GimpSamplePoint
operator|*
operator|)
name|iter
operator|->
name|data
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|sample_point
operator|->
name|x
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT1_X
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|sample_point
operator|->
name|y
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT1_Y
argument_list|)
expr_stmt|;
name|iter
operator|=
name|g_list_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|sample_point
operator|=
operator|(
name|GimpSamplePoint
operator|*
operator|)
name|iter
operator|->
name|data
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|sample_point
operator|->
name|x
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT2_X
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|sample_point
operator|->
name|y
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_SAMPLEPOINT2_Y
argument_list|)
expr_stmt|;
name|iter
operator|=
name|g_list_next
argument_list|(
name|iter
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|iter
operator|==
name|NULL
argument_list|)
expr_stmt|;
comment|/* Resolution */
name|gimp_image_get_resolution
argument_list|(
name|image
argument_list|,
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|xres
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_RESOLUTIONX
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|yres
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_RESOLUTIONY
argument_list|)
expr_stmt|;
comment|/* Parasites */
name|parasite
operator|=
name|gimp_image_parasite_find
argument_list|(
name|image
argument_list|,
name|GIMP_MAINIMAGE_PARASITE_NAME
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|gimp_parasite_data_size
argument_list|(
name|parasite
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_PARASITE_SIZE
argument_list|)
expr_stmt|;
name|g_assert_cmpstr
argument_list|(
name|gimp_parasite_data
argument_list|(
name|parasite
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_PARASITE_DATA
argument_list|)
expr_stmt|;
comment|/* Unit */
name|g_assert_cmpint
argument_list|(
name|gimp_image_get_unit
argument_list|(
name|image
argument_list|)
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_UNIT
argument_list|)
expr_stmt|;
comment|/* Grid */
name|grid
operator|=
name|gimp_image_get_grid
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_object_get
argument_list|(
name|grid
argument_list|,
literal|"xspacing"
argument_list|,
operator|&
name|xspacing
argument_list|,
literal|"yspacing"
argument_list|,
operator|&
name|yspacing
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|xspacing
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_GRIDXSPACING
argument_list|)
expr_stmt|;
name|g_assert_cmpint
argument_list|(
name|yspacing
argument_list|,
operator|==
argument_list|,
name|GIMP_MAINIMAGE_GRIDYSPACING
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * main:  * @argc:  * @argv:  *  * These tests, when done, will  *  *  - Make sure that we are backwards compatible with files created by  *    older version of GIMP, i.e. that we can load files from earlier  *    version of GIMP  *  *  - Make sure that the information put into a #GimpImage is not lost  *    when the #GimpImage is written to a file and then read again  **/
end_comment

begin_function
name|int
DECL|function|main (int argc,char ** argv)
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|g_type_init
argument_list|()
expr_stmt|;
name|gtk_init
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|)
expr_stmt|;
name|g_test_init
argument_list|(
operator|&
name|argc
argument_list|,
operator|&
name|argv
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_test_utils_set_gimp2_directory
argument_list|(
literal|"gimpdir"
argument_list|)
expr_stmt|;
comment|/* We share the same application instance across all tests. We need    * the GUI variant for the file procs    */
name|gimp
operator|=
name|gimp_init_for_gui_testing
argument_list|(
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* Setup the tests */
name|g_test_add
argument_list|(
literal|"/gimp-xcf/write-and-read-current-format"
argument_list|,
name|GimpTestFixture
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_write_and_read_current_format
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Exit so we don't break script-fu plug-in wire */
name|gimp_exit
argument_list|(
name|gimp
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Run the tests and return status */
return|return
name|g_test_run
argument_list|()
return|;
block|}
end_function

end_unit

