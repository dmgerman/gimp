begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"lebl-dialog.h"
end_include

begin_include
include|#
directive|include
file|"gimp-intl.h"
end_include

begin_comment
comment|/* phish code */
end_comment

begin_define
DECL|macro|PHSHFRAMES
define|#
directive|define
name|PHSHFRAMES
value|8
end_define

begin_define
DECL|macro|PHSHORIGWIDTH
define|#
directive|define
name|PHSHORIGWIDTH
value|288
end_define

begin_define
DECL|macro|PHSHORIGHEIGHT
define|#
directive|define
name|PHSHORIGHEIGHT
value|22
end_define

begin_define
DECL|macro|PHSHWIDTH
define|#
directive|define
name|PHSHWIDTH
value|(PHSHORIGWIDTH/PHSHFRAMES)
end_define

begin_define
DECL|macro|PHSHHEIGHT
define|#
directive|define
name|PHSHHEIGHT
value|PHSHORIGHEIGHT
end_define

begin_define
DECL|macro|PHSHCHECKTIMEOUT
define|#
directive|define
name|PHSHCHECKTIMEOUT
value|(g_random_int()%120*1000)
end_define

begin_define
DECL|macro|PHSHTIMEOUT
define|#
directive|define
name|PHSHTIMEOUT
value|120
end_define

begin_define
DECL|macro|PHSHHIDETIMEOUT
define|#
directive|define
name|PHSHHIDETIMEOUT
value|80
end_define

begin_define
DECL|macro|PHSHXS
define|#
directive|define
name|PHSHXS
value|5
end_define

begin_define
DECL|macro|PHSHYS
define|#
directive|define
name|PHSHYS
value|((g_random_int() % 2) + 1)
end_define

begin_define
DECL|macro|PHSHXSHIDEFACTOR
define|#
directive|define
name|PHSHXSHIDEFACTOR
value|2.5
end_define

begin_define
DECL|macro|PHSHYSHIDEFACTOR
define|#
directive|define
name|PHSHYSHIDEFACTOR
value|2.5
end_define

begin_define
DECL|macro|PHSHPIXELSTOREMOVE (p)
define|#
directive|define
name|PHSHPIXELSTOREMOVE
parameter_list|(
name|p
parameter_list|)
value|(p[3]< 55 || p[2]> 200)
end_define

begin_function
specifier|static
name|void
DECL|function|phsh_unsea (GdkPixbuf * gp)
name|phsh_unsea
parameter_list|(
name|GdkPixbuf
modifier|*
name|gp
parameter_list|)
block|{
name|guchar
modifier|*
name|pixels
init|=
name|gdk_pixbuf_get_pixels
argument_list|(
name|gp
argument_list|)
decl_stmt|;
name|int
name|rs
init|=
name|gdk_pixbuf_get_rowstride
argument_list|(
name|gp
argument_list|)
decl_stmt|;
name|int
name|w
init|=
name|gdk_pixbuf_get_width
argument_list|(
name|gp
argument_list|)
decl_stmt|;
name|int
name|h
init|=
name|gdk_pixbuf_get_height
argument_list|(
name|gp
argument_list|)
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|h
condition|;
name|y
operator|++
operator|,
name|pixels
operator|+=
name|rs
control|)
block|{
name|guchar
modifier|*
name|p
init|=
name|pixels
decl_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|w
condition|;
name|x
operator|++
operator|,
name|p
operator|+=
literal|4
control|)
block|{
if|if
condition|(
name|PHSHPIXELSTOREMOVE
argument_list|(
name|p
argument_list|)
condition|)
name|p
index|[
literal|3
index|]
operator|=
literal|0
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|GdkPixbuf
modifier|*
DECL|function|get_phsh_frame (GdkPixbuf * pb,int frame)
name|get_phsh_frame
parameter_list|(
name|GdkPixbuf
modifier|*
name|pb
parameter_list|,
name|int
name|frame
parameter_list|)
block|{
name|GdkPixbuf
modifier|*
name|newpb
decl_stmt|;
name|newpb
operator|=
name|gdk_pixbuf_new
argument_list|(
name|GDK_COLORSPACE_RGB
argument_list|,
name|TRUE
argument_list|,
literal|8
argument_list|,
name|PHSHWIDTH
argument_list|,
name|PHSHHEIGHT
argument_list|)
expr_stmt|;
name|gdk_pixbuf_copy_area
argument_list|(
name|pb
argument_list|,
name|frame
operator|*
name|PHSHWIDTH
argument_list|,
literal|0
argument_list|,
name|PHSHWIDTH
argument_list|,
name|PHSHHEIGHT
argument_list|,
name|newpb
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|newpb
return|;
block|}
end_function

begin_typedef
DECL|struct|__anon2c099f8e0108
typedef|typedef
struct|struct
block|{
DECL|member|live
name|gboolean
name|live
decl_stmt|;
DECL|member|x
DECL|member|y
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
DECL|typedef|InvGoat
block|}
name|InvGoat
typedef|;
end_typedef

begin_typedef
DECL|struct|__anon2c099f8e0208
typedef|typedef
struct|struct
block|{
DECL|member|good
name|gboolean
name|good
decl_stmt|;
DECL|member|y
name|int
name|y
decl_stmt|;
DECL|member|x
name|int
name|x
decl_stmt|;
DECL|typedef|InvShot
block|}
name|InvShot
typedef|;
end_typedef

begin_decl_stmt
DECL|variable|geginv
specifier|static
name|GtkWidget
modifier|*
name|geginv
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|geginv_canvas
specifier|static
name|GtkWidget
modifier|*
name|geginv_canvas
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|geginv_label
specifier|static
name|GtkWidget
modifier|*
name|geginv_label
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_goat1
specifier|static
name|GdkPixbuf
modifier|*
name|inv_goat1
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_goat2
specifier|static
name|GdkPixbuf
modifier|*
name|inv_goat2
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_phsh1
specifier|static
name|GdkPixbuf
modifier|*
name|inv_phsh1
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_phsh2
specifier|static
name|GdkPixbuf
modifier|*
name|inv_phsh2
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_phsh_state
specifier|static
name|int
name|inv_phsh_state
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_goat_state
specifier|static
name|int
name|inv_goat_state
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_width
specifier|static
name|int
name|inv_width
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_height
specifier|static
name|int
name|inv_height
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_goat_width
specifier|static
name|int
name|inv_goat_width
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_goat_height
specifier|static
name|int
name|inv_goat_height
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_phsh_width
specifier|static
name|int
name|inv_phsh_width
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_phsh_height
specifier|static
name|int
name|inv_phsh_height
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|INV_ROWS
define|#
directive|define
name|INV_ROWS
value|3
end_define

begin_define
DECL|macro|INV_COLS
define|#
directive|define
name|INV_COLS
value|5
end_define

begin_decl_stmt
DECL|variable|invs
specifier|static
name|InvGoat
name|invs
index|[
name|INV_COLS
index|]
index|[
name|INV_ROWS
index|]
init|=
block|{
block|{
block|{
name|FALSE
block|,
literal|0
block|,
literal|0
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_num
specifier|static
name|int
name|inv_num
init|=
name|INV_ROWS
operator|*
name|INV_COLS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_factor
specifier|static
name|double
name|inv_factor
init|=
literal|1.0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_our_x
specifier|static
name|int
name|inv_our_x
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_x
specifier|static
name|int
name|inv_x
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_y
specifier|static
name|int
name|inv_y
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_first_col
specifier|static
name|int
name|inv_first_col
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_last_col
specifier|static
name|int
name|inv_last_col
init|=
name|INV_COLS
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_level
specifier|static
name|int
name|inv_level
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_lives
specifier|static
name|int
name|inv_lives
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_do_pause
specifier|static
name|gboolean
name|inv_do_pause
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_reverse
specifier|static
name|gboolean
name|inv_reverse
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_game_over
specifier|static
name|gboolean
name|inv_game_over
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_left_pressed
specifier|static
name|gboolean
name|inv_left_pressed
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_right_pressed
specifier|static
name|gboolean
name|inv_right_pressed
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_fire_pressed
specifier|static
name|gboolean
name|inv_fire_pressed
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_left_released
specifier|static
name|gboolean
name|inv_left_released
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_right_released
specifier|static
name|gboolean
name|inv_right_released
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_fire_released
specifier|static
name|gboolean
name|inv_fire_released
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_paused
specifier|static
name|gboolean
name|inv_paused
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_shots
specifier|static
name|GSList
modifier|*
name|inv_shots
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|inv_draw_idle
specifier|static
name|guint
name|inv_draw_idle
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|inv_show_status (void)
name|inv_show_status
parameter_list|(
name|void
parameter_list|)
block|{
name|gchar
modifier|*
name|s
decl_stmt|,
modifier|*
name|t
decl_stmt|,
modifier|*
name|u
decl_stmt|,
modifier|*
name|v
decl_stmt|,
modifier|*
name|w
decl_stmt|;
if|if
condition|(
name|geginv
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|inv_game_over
condition|)
block|{
name|t
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"<b>GAME OVER</b> at level %d!"
argument_list|)
argument_list|,
name|inv_level
operator|+
literal|1
argument_list|)
expr_stmt|;
name|u
operator|=
name|g_strdup_printf
argument_list|(
literal|"<big>%s</big>"
argument_list|,
name|t
argument_list|)
expr_stmt|;
comment|/* Translators: the first and third strings are similar to a 		 * title, and the second string is a small information text. 		 * The spaces are there only to separate all the strings, so 		 try to keep them as is. */
name|s
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%1$s   %2$s   %3$s"
argument_list|)
argument_list|,
name|u
argument_list|,
name|_
argument_list|(
literal|"Press 'q' to quit"
argument_list|)
argument_list|,
name|u
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|u
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|inv_paused
condition|)
block|{
name|t
operator|=
name|g_strdup_printf
argument_list|(
literal|"<big><b>%s</b></big>"
argument_list|,
name|_
argument_list|(
literal|"Paused"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Translators: the first string is a title and the second 		 * string is a small information text. */
name|s
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%1$s\t%2$s"
argument_list|)
argument_list|,
name|t
argument_list|,
name|_
argument_list|(
literal|"Press 'p' to unpause"
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|t
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|t
operator|=
name|g_strdup_printf
argument_list|(
literal|"<b>%d</b>"
argument_list|,
name|inv_level
operator|+
literal|1
argument_list|)
expr_stmt|;
name|u
operator|=
name|g_strdup_printf
argument_list|(
literal|"<b>%d</b>"
argument_list|,
name|inv_lives
argument_list|)
expr_stmt|;
name|v
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Level: %s,  Lives: %s"
argument_list|)
argument_list|,
name|t
argument_list|,
name|u
argument_list|)
expr_stmt|;
name|w
operator|=
name|g_strdup_printf
argument_list|(
literal|"<big>%s</big>"
argument_list|,
name|v
argument_list|)
expr_stmt|;
comment|/* Translators: the first string is a title and the second 		 * string is a small information text. */
name|s
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%1$s\t%2$s"
argument_list|)
argument_list|,
name|w
argument_list|,
name|_
argument_list|(
literal|"Left/Right to move, Space to fire, 'p' to pause, 'q' to quit"
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|t
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|u
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|v
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|w
argument_list|)
expr_stmt|;
block|}
name|gtk_label_set_markup
argument_list|(
name|GTK_LABEL
argument_list|(
name|geginv_label
argument_list|)
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|inv_queue_draw_idle (gpointer data)
name|inv_queue_draw_idle
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_widget_queue_draw
argument_list|(
name|data
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|inv_queue_draw (GtkWidget * window)
name|inv_queue_draw
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|)
block|{
if|if
condition|(
name|inv_draw_idle
operator|==
literal|0
condition|)
name|inv_draw_idle
operator|=
name|g_idle_add
argument_list|(
name|inv_queue_draw_idle
argument_list|,
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|inv_draw_explosion (int x,int y)
name|inv_draw_explosion
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
name|cairo_t
modifier|*
name|cr
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|gtk_widget_is_drawable
argument_list|(
name|geginv_canvas
argument_list|)
condition|)
return|return;
name|cr
operator|=
name|gdk_cairo_create
argument_list|(
name|gtk_widget_get_window
argument_list|(
name|geginv_canvas
argument_list|)
argument_list|)
expr_stmt|;
name|cairo_set_source_rgb
argument_list|(
name|cr
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|5
init|;
name|i
operator|<
literal|100
condition|;
name|i
operator|+=
literal|5
control|)
block|{
name|cairo_arc
argument_list|(
name|cr
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|i
argument_list|,
literal|0
argument_list|,
literal|2
operator|*
name|G_PI
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|gdk_display_flush
argument_list|(
name|gtk_widget_get_display
argument_list|(
name|geginv_canvas
argument_list|)
argument_list|)
expr_stmt|;
name|g_usleep
argument_list|(
literal|50000
argument_list|)
expr_stmt|;
block|}
name|cairo_set_source_rgb
argument_list|(
name|cr
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|5
init|;
name|i
operator|<
literal|100
condition|;
name|i
operator|+=
literal|5
control|)
block|{
name|cairo_arc
argument_list|(
name|cr
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|i
argument_list|,
literal|0
argument_list|,
literal|2
operator|*
name|G_PI
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|gdk_display_flush
argument_list|(
name|gtk_widget_get_display
argument_list|(
name|geginv_canvas
argument_list|)
argument_list|)
expr_stmt|;
name|g_usleep
argument_list|(
literal|50000
argument_list|)
expr_stmt|;
block|}
name|cairo_destroy
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|inv_do_game_over (void)
name|inv_do_game_over
parameter_list|(
name|void
parameter_list|)
block|{
name|GSList
modifier|*
name|li
decl_stmt|;
name|inv_game_over
operator|=
name|TRUE
expr_stmt|;
for|for
control|(
name|li
operator|=
name|inv_shots
init|;
name|li
operator|!=
name|NULL
condition|;
name|li
operator|=
name|li
operator|->
name|next
control|)
block|{
name|InvShot
modifier|*
name|shot
init|=
name|li
operator|->
name|data
decl_stmt|;
name|shot
operator|->
name|good
operator|=
name|FALSE
expr_stmt|;
block|}
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
name|inv_show_status
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GdkPixbuf
modifier|*
DECL|function|pb_scale (GdkPixbuf * pb,double scale)
name|pb_scale
parameter_list|(
name|GdkPixbuf
modifier|*
name|pb
parameter_list|,
name|double
name|scale
parameter_list|)
block|{
name|int
name|w
decl_stmt|,
name|h
decl_stmt|;
if|if
condition|(
name|scale
operator|==
literal|1.0
condition|)
return|return
operator|(
name|GdkPixbuf
operator|*
operator|)
name|g_object_ref
argument_list|(
operator|(
name|GObject
operator|*
operator|)
name|pb
argument_list|)
return|;
name|w
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|pb
argument_list|)
operator|*
name|scale
expr_stmt|;
name|h
operator|=
name|gdk_pixbuf_get_height
argument_list|(
name|pb
argument_list|)
operator|*
name|scale
expr_stmt|;
return|return
name|gdk_pixbuf_scale_simple
argument_list|(
name|pb
argument_list|,
name|w
argument_list|,
name|h
argument_list|,
name|GDK_INTERP_BILINEAR
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|refind_first_and_last (void)
name|refind_first_and_last
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|INV_COLS
condition|;
name|i
operator|++
control|)
block|{
name|gboolean
name|all_null
init|=
name|TRUE
decl_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INV_ROWS
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
condition|)
block|{
name|all_null
operator|=
name|FALSE
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|all_null
condition|)
block|{
name|inv_first_col
operator|=
name|i
expr_stmt|;
break|break;
block|}
block|}
for|for
control|(
name|i
operator|=
name|INV_COLS
operator|-
literal|1
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|gboolean
name|all_null
init|=
name|TRUE
decl_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INV_ROWS
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
condition|)
block|{
name|all_null
operator|=
name|FALSE
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|all_null
condition|)
block|{
name|inv_last_col
operator|=
name|i
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|whack_gegl (int i,int j)
name|whack_gegl
parameter_list|(
name|int
name|i
parameter_list|,
name|int
name|j
parameter_list|)
block|{
if|if
condition|(
operator|!
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
condition|)
return|return;
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
operator|=
name|FALSE
expr_stmt|;
name|inv_num
operator|--
expr_stmt|;
if|if
condition|(
name|inv_num
operator|>
literal|0
condition|)
block|{
name|refind_first_and_last
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|inv_x
operator|=
literal|70
expr_stmt|;
name|inv_y
operator|=
literal|70
expr_stmt|;
name|inv_first_col
operator|=
literal|0
expr_stmt|;
name|inv_last_col
operator|=
name|INV_COLS
operator|-
literal|1
expr_stmt|;
name|inv_reverse
operator|=
name|FALSE
expr_stmt|;
name|g_slist_foreach
argument_list|(
name|inv_shots
argument_list|,
operator|(
name|GFunc
operator|)
name|g_free
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|inv_shots
argument_list|)
expr_stmt|;
name|inv_shots
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|INV_COLS
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INV_ROWS
condition|;
name|j
operator|++
control|)
block|{
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
operator|=
name|TRUE
expr_stmt|;
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
operator|=
literal|70
operator|+
name|i
operator|*
literal|100
expr_stmt|;
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
operator|=
literal|70
operator|+
name|j
operator|*
literal|80
expr_stmt|;
block|}
block|}
name|inv_num
operator|=
name|INV_ROWS
operator|*
name|INV_COLS
expr_stmt|;
name|inv_level
operator|++
expr_stmt|;
name|inv_show_status
argument_list|()
expr_stmt|;
block|}
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|geginv_timeout (gpointer data)
name|geginv_timeout
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|int
name|limitx1
decl_stmt|;
name|int
name|limitx2
decl_stmt|;
name|int
name|speed
decl_stmt|;
name|int
name|shots
decl_stmt|;
name|int
name|max_shots
decl_stmt|;
if|if
condition|(
name|inv_paused
condition|)
return|return
name|TRUE
return|;
if|if
condition|(
name|geginv
operator|!=
name|data
operator|||
name|inv_num
operator|<=
literal|0
operator|||
name|inv_y
operator|>
literal|700
condition|)
return|return
name|FALSE
return|;
name|limitx1
operator|=
literal|70
operator|-
operator|(
name|inv_first_col
operator|*
literal|100
operator|)
expr_stmt|;
name|limitx2
operator|=
literal|800
operator|-
literal|70
operator|-
operator|(
name|inv_last_col
operator|*
literal|100
operator|)
expr_stmt|;
if|if
condition|(
name|inv_game_over
condition|)
block|{
name|inv_y
operator|+=
literal|30
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|inv_num
operator|<
operator|(
name|INV_COLS
operator|*
name|INV_ROWS
operator|)
operator|/
literal|3
condition|)
name|speed
operator|=
literal|45
operator|+
literal|2
operator|*
name|inv_level
expr_stmt|;
elseif|else
if|if
condition|(
name|inv_num
operator|<
operator|(
literal|2
operator|*
name|INV_COLS
operator|*
name|INV_ROWS
operator|)
operator|/
literal|3
condition|)
name|speed
operator|=
literal|30
operator|+
literal|2
operator|*
name|inv_level
expr_stmt|;
else|else
name|speed
operator|=
literal|15
operator|+
literal|2
operator|*
name|inv_level
expr_stmt|;
if|if
condition|(
name|inv_reverse
condition|)
block|{
name|inv_x
operator|-=
name|speed
expr_stmt|;
if|if
condition|(
name|inv_x
operator|<
name|limitx1
condition|)
block|{
name|inv_reverse
operator|=
name|FALSE
expr_stmt|;
name|inv_x
operator|=
operator|(
name|limitx1
operator|+
operator|(
name|limitx1
operator|-
name|inv_x
operator|)
operator|)
expr_stmt|;
name|inv_y
operator|+=
literal|30
operator|+
name|inv_level
expr_stmt|;
block|}
block|}
else|else
block|{
name|inv_x
operator|+=
name|speed
expr_stmt|;
if|if
condition|(
name|inv_x
operator|>
name|limitx2
condition|)
block|{
name|inv_reverse
operator|=
name|TRUE
expr_stmt|;
name|inv_x
operator|=
operator|(
name|limitx2
operator|-
operator|(
name|inv_x
operator|-
name|limitx2
operator|)
operator|)
expr_stmt|;
name|inv_y
operator|+=
literal|30
operator|+
name|inv_level
expr_stmt|;
block|}
block|}
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|INV_COLS
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INV_ROWS
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
condition|)
block|{
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
operator|=
name|inv_x
operator|+
name|i
operator|*
literal|100
expr_stmt|;
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
operator|=
name|inv_y
operator|+
name|j
operator|*
literal|80
expr_stmt|;
if|if
condition|(
operator|!
name|inv_game_over
operator|&&
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
operator|>=
literal|570
condition|)
block|{
name|inv_do_game_over
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|inv_game_over
operator|&&
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
operator|>=
literal|530
operator|&&
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
operator|+
literal|40
operator|>
name|inv_our_x
operator|-
literal|25
operator|&&
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
operator|-
literal|40
operator|<
name|inv_our_x
operator|+
literal|25
condition|)
block|{
name|whack_gegl
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|inv_lives
operator|--
expr_stmt|;
name|inv_draw_explosion
argument_list|(
name|inv_our_x
argument_list|,
literal|550
argument_list|)
expr_stmt|;
if|if
condition|(
name|inv_lives
operator|<=
literal|0
condition|)
block|{
name|inv_do_game_over
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|g_slist_foreach
argument_list|(
name|inv_shots
argument_list|,
operator|(
name|GFunc
operator|)
name|g_free
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|inv_shots
argument_list|)
expr_stmt|;
name|inv_shots
operator|=
name|NULL
expr_stmt|;
name|inv_our_x
operator|=
literal|400
expr_stmt|;
name|inv_do_pause
operator|=
name|TRUE
expr_stmt|;
name|inv_show_status
argument_list|()
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
name|shots
operator|=
literal|0
expr_stmt|;
name|max_shots
operator|=
operator|(
name|g_random_int
argument_list|()
operator|>>
literal|3
operator|)
operator|%
operator|(
literal|2
operator|+
name|inv_level
operator|)
expr_stmt|;
while|while
condition|(
operator|!
name|inv_game_over
operator|&&
name|shots
operator|<
name|MIN
argument_list|(
name|max_shots
argument_list|,
name|inv_num
argument_list|)
condition|)
block|{
name|int
name|i
init|=
operator|(
name|g_random_int
argument_list|()
operator|>>
literal|3
operator|)
operator|%
name|INV_COLS
decl_stmt|;
for|for
control|(
name|j
operator|=
name|INV_ROWS
operator|-
literal|1
init|;
name|j
operator|>=
literal|0
condition|;
name|j
operator|--
control|)
block|{
if|if
condition|(
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
condition|)
block|{
name|InvShot
modifier|*
name|shot
init|=
name|g_new0
argument_list|(
name|InvShot
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|shot
operator|->
name|good
operator|=
name|FALSE
expr_stmt|;
name|shot
operator|->
name|x
operator|=
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
operator|+
operator|(
name|g_random_int
argument_list|()
operator|%
literal|6
operator|)
operator|-
literal|3
expr_stmt|;
name|shot
operator|->
name|y
operator|=
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
operator|+
name|inv_goat_height
operator|/
literal|2
operator|+
operator|(
name|g_random_int
argument_list|()
operator|%
literal|3
operator|)
expr_stmt|;
name|inv_shots
operator|=
name|g_slist_prepend
argument_list|(
name|inv_shots
argument_list|,
name|shot
argument_list|)
expr_stmt|;
name|shots
operator|++
expr_stmt|;
break|break;
block|}
block|}
block|}
name|inv_goat_state
operator|=
operator|(
name|inv_goat_state
operator|+
literal|1
operator|)
operator|%
literal|2
expr_stmt|;
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
name|g_timeout_add
argument_list|(
operator|(
operator|(
name|inv_num
operator|/
literal|4
operator|)
operator|+
literal|1
operator|)
operator|*
literal|100
argument_list|,
name|geginv_timeout
argument_list|,
name|geginv
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|find_gegls (int x,int y)
name|find_gegls
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
comment|/* FIXME: this is stupid, we can do better */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|INV_COLS
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INV_ROWS
condition|;
name|j
operator|++
control|)
block|{
name|int
name|ix
init|=
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
decl_stmt|;
name|int
name|iy
init|=
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
decl_stmt|;
if|if
condition|(
operator|!
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
condition|)
continue|continue;
if|if
condition|(
name|y
operator|>=
name|iy
operator|-
literal|30
operator|&&
name|y
operator|<=
name|iy
operator|+
literal|30
operator|&&
name|x
operator|>=
name|ix
operator|-
literal|40
operator|&&
name|x
operator|<=
name|ix
operator|+
literal|40
condition|)
block|{
name|whack_gegl
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|geginv_move_timeout (gpointer data)
name|geginv_move_timeout
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|GSList
modifier|*
name|li
decl_stmt|;
specifier|static
name|int
name|shot_inhibit
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|inv_paused
condition|)
return|return
name|TRUE
return|;
if|if
condition|(
name|geginv
operator|!=
name|data
operator|||
name|inv_num
operator|<=
literal|0
operator|||
name|inv_y
operator|>
literal|700
condition|)
return|return
name|FALSE
return|;
name|inv_phsh_state
operator|=
operator|(
name|inv_phsh_state
operator|+
literal|1
operator|)
operator|%
literal|10
expr_stmt|;
comment|/* we will be drawing something */
if|if
condition|(
name|inv_shots
operator|!=
name|NULL
condition|)
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
name|li
operator|=
name|inv_shots
expr_stmt|;
while|while
condition|(
name|li
operator|!=
name|NULL
condition|)
block|{
name|InvShot
modifier|*
name|shot
init|=
name|li
operator|->
name|data
decl_stmt|;
if|if
condition|(
name|shot
operator|->
name|good
condition|)
block|{
name|shot
operator|->
name|y
operator|-=
literal|30
expr_stmt|;
if|if
condition|(
name|find_gegls
argument_list|(
name|shot
operator|->
name|x
argument_list|,
name|shot
operator|->
name|y
argument_list|)
operator|||
name|shot
operator|->
name|y
operator|<=
literal|0
condition|)
block|{
name|GSList
modifier|*
name|list
init|=
name|li
decl_stmt|;
comment|/* we were restarted */
if|if
condition|(
name|inv_shots
operator|==
name|NULL
condition|)
return|return
name|TRUE
return|;
name|li
operator|=
name|li
operator|->
name|next
expr_stmt|;
name|g_free
argument_list|(
name|shot
argument_list|)
expr_stmt|;
name|inv_shots
operator|=
name|g_slist_delete_link
argument_list|(
name|inv_shots
argument_list|,
name|list
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
else|else
comment|/* bad */
block|{
name|shot
operator|->
name|y
operator|+=
literal|30
expr_stmt|;
if|if
condition|(
operator|!
name|inv_game_over
operator|&&
name|shot
operator|->
name|y
operator|>=
literal|535
operator|&&
name|shot
operator|->
name|y
operator|<=
literal|565
operator|&&
name|shot
operator|->
name|x
operator|>=
name|inv_our_x
operator|-
literal|25
operator|&&
name|shot
operator|->
name|x
operator|<=
name|inv_our_x
operator|+
literal|25
condition|)
block|{
name|inv_lives
operator|--
expr_stmt|;
name|inv_draw_explosion
argument_list|(
name|inv_our_x
argument_list|,
literal|550
argument_list|)
expr_stmt|;
if|if
condition|(
name|inv_lives
operator|<=
literal|0
condition|)
block|{
name|inv_do_game_over
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|g_slist_foreach
argument_list|(
name|inv_shots
argument_list|,
operator|(
name|GFunc
operator|)
name|g_free
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|inv_shots
argument_list|)
expr_stmt|;
name|inv_shots
operator|=
name|NULL
expr_stmt|;
name|inv_our_x
operator|=
literal|400
expr_stmt|;
name|inv_do_pause
operator|=
name|TRUE
expr_stmt|;
name|inv_show_status
argument_list|()
expr_stmt|;
return|return
name|TRUE
return|;
block|}
block|}
if|if
condition|(
name|shot
operator|->
name|y
operator|>=
literal|600
condition|)
block|{
name|GSList
modifier|*
name|list
init|=
name|li
decl_stmt|;
name|li
operator|=
name|li
operator|->
name|next
expr_stmt|;
name|g_free
argument_list|(
name|shot
argument_list|)
expr_stmt|;
name|inv_shots
operator|=
name|g_slist_delete_link
argument_list|(
name|inv_shots
argument_list|,
name|list
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
name|li
operator|=
name|li
operator|->
name|next
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|inv_game_over
condition|)
block|{
if|if
condition|(
name|inv_left_pressed
operator|&&
name|inv_our_x
operator|>
literal|100
condition|)
block|{
name|inv_our_x
operator|-=
literal|20
expr_stmt|;
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|inv_right_pressed
operator|&&
name|inv_our_x
operator|<
literal|700
condition|)
block|{
name|inv_our_x
operator|+=
literal|20
expr_stmt|;
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|shot_inhibit
operator|>
literal|0
condition|)
name|shot_inhibit
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|inv_game_over
operator|&&
name|inv_fire_pressed
operator|&&
name|shot_inhibit
operator|==
literal|0
condition|)
block|{
name|InvShot
modifier|*
name|shot
init|=
name|g_new0
argument_list|(
name|InvShot
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|shot
operator|->
name|good
operator|=
name|TRUE
expr_stmt|;
name|shot
operator|->
name|x
operator|=
name|inv_our_x
expr_stmt|;
name|shot
operator|->
name|y
operator|=
literal|540
expr_stmt|;
name|inv_shots
operator|=
name|g_slist_prepend
argument_list|(
name|inv_shots
argument_list|,
name|shot
argument_list|)
expr_stmt|;
name|shot_inhibit
operator|=
literal|5
expr_stmt|;
name|inv_queue_draw
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|inv_left_released
condition|)
name|inv_left_pressed
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|inv_right_released
condition|)
name|inv_right_pressed
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|inv_fire_released
condition|)
name|inv_fire_pressed
operator|=
name|FALSE
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|inv_key_press (GtkWidget * widget,GdkEventKey * event,gpointer data)
name|inv_key_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|event
operator|->
name|keyval
condition|)
block|{
case|case
name|GDK_KEY_Left
case|:
case|case
name|GDK_KEY_KP_Left
case|:
case|case
name|GDK_KEY_Pointer_Left
case|:
name|inv_left_pressed
operator|=
name|TRUE
expr_stmt|;
name|inv_left_released
operator|=
name|FALSE
expr_stmt|;
return|return
name|TRUE
return|;
case|case
name|GDK_KEY_Right
case|:
case|case
name|GDK_KEY_KP_Right
case|:
case|case
name|GDK_KEY_Pointer_Right
case|:
name|inv_right_pressed
operator|=
name|TRUE
expr_stmt|;
name|inv_right_released
operator|=
name|FALSE
expr_stmt|;
return|return
name|TRUE
return|;
case|case
name|GDK_KEY_space
case|:
case|case
name|GDK_KEY_KP_Space
case|:
name|inv_fire_pressed
operator|=
name|TRUE
expr_stmt|;
name|inv_fire_released
operator|=
name|FALSE
expr_stmt|;
return|return
name|TRUE
return|;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|inv_key_release (GtkWidget * widget,GdkEventKey * event,gpointer data)
name|inv_key_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
switch|switch
condition|(
name|event
operator|->
name|keyval
condition|)
block|{
case|case
name|GDK_KEY_Left
case|:
case|case
name|GDK_KEY_KP_Left
case|:
case|case
name|GDK_KEY_Pointer_Left
case|:
name|inv_left_released
operator|=
name|TRUE
expr_stmt|;
return|return
name|TRUE
return|;
case|case
name|GDK_KEY_Right
case|:
case|case
name|GDK_KEY_KP_Right
case|:
case|case
name|GDK_KEY_Pointer_Right
case|:
name|inv_right_released
operator|=
name|TRUE
expr_stmt|;
return|return
name|TRUE
return|;
case|case
name|GDK_KEY_space
case|:
case|case
name|GDK_KEY_KP_Space
case|:
name|inv_fire_released
operator|=
name|TRUE
expr_stmt|;
return|return
name|TRUE
return|;
case|case
name|GDK_KEY_q
case|:
case|case
name|GDK_KEY_Q
case|:
name|gtk_widget_destroy
argument_list|(
name|widget
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
case|case
name|GDK_KEY_p
case|:
case|case
name|GDK_KEY_P
case|:
name|inv_paused
operator|=
operator|!
name|inv_paused
expr_stmt|;
name|inv_show_status
argument_list|()
expr_stmt|;
return|return
name|TRUE
return|;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|ensure_creatures (void)
name|ensure_creatures
parameter_list|(
name|void
parameter_list|)
block|{
name|GdkPixbuf
modifier|*
name|pb
decl_stmt|,
modifier|*
name|pb1
decl_stmt|;
if|if
condition|(
name|inv_goat1
operator|!=
name|NULL
condition|)
return|return
name|TRUE
return|;
name|pb
operator|=
name|gdk_pixbuf_new_from_resource
argument_list|(
literal|"/org/gimp/lebl-dialog/wanda.png"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|pb
operator|==
name|NULL
condition|)
return|return
name|FALSE
return|;
name|pb1
operator|=
name|get_phsh_frame
argument_list|(
name|pb
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|inv_phsh1
operator|=
name|pb_scale
argument_list|(
name|pb1
argument_list|,
name|inv_factor
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|pb1
argument_list|)
argument_list|)
expr_stmt|;
name|phsh_unsea
argument_list|(
name|inv_phsh1
argument_list|)
expr_stmt|;
name|pb1
operator|=
name|get_phsh_frame
argument_list|(
name|pb
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|inv_phsh2
operator|=
name|pb_scale
argument_list|(
name|pb1
argument_list|,
name|inv_factor
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|pb1
argument_list|)
argument_list|)
expr_stmt|;
name|phsh_unsea
argument_list|(
name|inv_phsh2
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|pb
argument_list|)
argument_list|)
expr_stmt|;
name|pb
operator|=
name|gdk_pixbuf_new_from_resource
argument_list|(
literal|"/org/gimp/lebl-dialog/gegl-1.png"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|pb
operator|==
name|NULL
condition|)
block|{
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|inv_phsh1
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|inv_phsh2
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
name|inv_goat1
operator|=
name|pb_scale
argument_list|(
name|pb
argument_list|,
name|inv_factor
operator|*
literal|0.66
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pb
argument_list|)
expr_stmt|;
name|pb
operator|=
name|gdk_pixbuf_new_from_resource
argument_list|(
literal|"/org/gimp/lebl-dialog/gegl-2.png"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|pb
operator|==
name|NULL
condition|)
block|{
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|inv_goat1
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|inv_phsh1
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|inv_phsh2
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
name|inv_goat2
operator|=
name|pb_scale
argument_list|(
name|pb
argument_list|,
name|inv_factor
operator|*
literal|0.66
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pb
argument_list|)
expr_stmt|;
name|inv_goat_width
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|inv_goat1
argument_list|)
expr_stmt|;
name|inv_goat_height
operator|=
name|gdk_pixbuf_get_height
argument_list|(
name|inv_goat1
argument_list|)
expr_stmt|;
name|inv_phsh_width
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|inv_phsh1
argument_list|)
expr_stmt|;
name|inv_phsh_height
operator|=
name|gdk_pixbuf_get_height
argument_list|(
name|inv_phsh1
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|geginv_destroyed (GtkWidget * w,gpointer data)
name|geginv_destroyed
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|geginv
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|inv_draw (GtkWidget * widget,cairo_t * cr)
name|inv_draw
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|cairo_t
modifier|*
name|cr
parameter_list|)
block|{
name|GdkPixbuf
modifier|*
name|goat
decl_stmt|;
name|GSList
modifier|*
name|li
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|geginv
operator|==
name|NULL
condition|)
block|{
name|inv_draw_idle
operator|=
literal|0
expr_stmt|;
return|return
name|TRUE
return|;
block|}
name|cairo_set_source_rgb
argument_list|(
name|cr
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|cairo_paint
argument_list|(
name|cr
argument_list|)
expr_stmt|;
if|if
condition|(
name|inv_goat_state
operator|==
literal|0
condition|)
name|goat
operator|=
name|inv_goat1
expr_stmt|;
else|else
name|goat
operator|=
name|inv_goat2
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|INV_COLS
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INV_ROWS
condition|;
name|j
operator|++
control|)
block|{
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
if|if
condition|(
operator|!
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
condition|)
continue|continue;
name|x
operator|=
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
operator|*
name|inv_factor
operator|-
name|inv_goat_width
operator|/
literal|2
operator|,
name|y
operator|=
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
operator|*
name|inv_factor
operator|-
name|inv_goat_height
operator|/
literal|2
operator|,
name|gdk_cairo_set_source_pixbuf
argument_list|(
name|cr
argument_list|,
name|goat
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|cairo_rectangle
argument_list|(
name|cr
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|inv_goat_width
argument_list|,
name|inv_goat_height
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|li
operator|=
name|inv_shots
init|;
name|li
operator|!=
name|NULL
condition|;
name|li
operator|=
name|li
operator|->
name|next
control|)
block|{
name|InvShot
modifier|*
name|shot
init|=
name|li
operator|->
name|data
decl_stmt|;
name|cairo_set_source_rgb
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|cairo_rectangle
argument_list|(
name|cr
argument_list|,
operator|(
name|shot
operator|->
name|x
operator|-
literal|1
operator|)
operator|*
name|inv_factor
argument_list|,
operator|(
name|shot
operator|->
name|y
operator|-
literal|4
operator|)
operator|*
name|inv_factor
argument_list|,
literal|3
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|inv_game_over
condition|)
block|{
name|GdkPixbuf
modifier|*
name|phsh
decl_stmt|;
if|if
condition|(
name|inv_phsh_state
operator|<
literal|5
condition|)
block|{
name|phsh
operator|=
name|inv_phsh1
expr_stmt|;
block|}
else|else
block|{
name|phsh
operator|=
name|inv_phsh2
expr_stmt|;
block|}
name|gdk_cairo_set_source_pixbuf
argument_list|(
name|cr
argument_list|,
name|phsh
argument_list|,
name|inv_our_x
operator|*
name|inv_factor
operator|-
name|inv_phsh_width
operator|/
literal|2
argument_list|,
literal|550
operator|*
name|inv_factor
operator|-
name|inv_phsh_height
operator|/
literal|2
argument_list|)
expr_stmt|;
name|cairo_rectangle
argument_list|(
name|cr
argument_list|,
name|inv_our_x
operator|*
name|inv_factor
operator|-
name|inv_phsh_width
operator|/
literal|2
argument_list|,
literal|550
operator|*
name|inv_factor
operator|-
name|inv_phsh_height
operator|/
literal|2
argument_list|,
name|inv_phsh_width
argument_list|,
name|inv_phsh_height
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|inv_do_pause
condition|)
block|{
name|g_usleep
argument_list|(
name|G_USEC_PER_SEC
argument_list|)
expr_stmt|;
name|inv_do_pause
operator|=
name|FALSE
expr_stmt|;
block|}
name|inv_draw_idle
operator|=
literal|0
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function_decl
name|gboolean
name|gimp_lebl_dialog
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function
name|gboolean
DECL|function|gimp_lebl_dialog (void)
name|gimp_lebl_dialog
parameter_list|(
name|void
parameter_list|)
block|{
name|GdkMonitor
modifier|*
name|monitor
decl_stmt|;
name|GdkRectangle
name|workarea
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
if|if
condition|(
name|geginv
operator|!=
name|NULL
condition|)
block|{
name|gtk_window_present
argument_list|(
name|GTK_WINDOW
argument_list|(
name|geginv
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
name|inv_width
operator|=
literal|800
expr_stmt|;
name|inv_height
operator|=
literal|600
expr_stmt|;
name|monitor
operator|=
name|gimp_get_monitor_at_pointer
argument_list|()
expr_stmt|;
name|gdk_monitor_get_workarea
argument_list|(
name|monitor
argument_list|,
operator|&
name|workarea
argument_list|)
expr_stmt|;
if|if
condition|(
name|inv_width
operator|>
name|workarea
operator|.
name|width
operator|*
literal|0.9
condition|)
block|{
name|inv_width
operator|=
name|workarea
operator|.
name|width
operator|*
literal|0.9
expr_stmt|;
name|inv_height
operator|=
name|inv_width
operator|*
operator|(
literal|600.0
operator|/
literal|800.0
operator|)
expr_stmt|;
block|}
if|if
condition|(
name|inv_height
operator|>
name|workarea
operator|.
name|height
operator|*
literal|0.9
condition|)
block|{
name|inv_height
operator|=
name|workarea
operator|.
name|height
operator|*
literal|0.9
expr_stmt|;
name|inv_width
operator|=
name|inv_height
operator|*
operator|(
literal|800.0
operator|/
literal|600.0
operator|)
expr_stmt|;
block|}
name|inv_factor
operator|=
operator|(
name|double
operator|)
name|inv_width
operator|/
literal|800.0
expr_stmt|;
if|if
condition|(
operator|!
name|ensure_creatures
argument_list|()
condition|)
return|return
name|FALSE
return|;
name|geginv
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_TOPLEVEL
argument_list|)
expr_stmt|;
name|gtk_window_set_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|geginv
argument_list|)
argument_list|,
name|GTK_WIN_POS_CENTER
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|geginv
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Killer GEGLs from Outer Space"
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set
argument_list|(
name|G_OBJECT
argument_list|(
name|geginv
argument_list|)
argument_list|,
literal|"resizable"
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|geginv
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|G_CALLBACK
argument_list|(
name|geginv_destroyed
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|geginv_canvas
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|geginv_canvas
argument_list|,
name|inv_width
argument_list|,
name|inv_height
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|geginv
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|geginv_canvas
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|geginv_label
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|geginv_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|inv_our_x
operator|=
literal|400
expr_stmt|;
name|inv_x
operator|=
literal|70
expr_stmt|;
name|inv_y
operator|=
literal|70
expr_stmt|;
name|inv_first_col
operator|=
literal|0
expr_stmt|;
name|inv_level
operator|=
literal|0
expr_stmt|;
name|inv_lives
operator|=
literal|3
expr_stmt|;
name|inv_last_col
operator|=
name|INV_COLS
operator|-
literal|1
expr_stmt|;
name|inv_reverse
operator|=
name|FALSE
expr_stmt|;
name|inv_game_over
operator|=
name|FALSE
expr_stmt|;
name|inv_left_pressed
operator|=
name|FALSE
expr_stmt|;
name|inv_right_pressed
operator|=
name|FALSE
expr_stmt|;
name|inv_fire_pressed
operator|=
name|FALSE
expr_stmt|;
name|inv_left_released
operator|=
name|FALSE
expr_stmt|;
name|inv_right_released
operator|=
name|FALSE
expr_stmt|;
name|inv_fire_released
operator|=
name|FALSE
expr_stmt|;
name|inv_paused
operator|=
name|FALSE
expr_stmt|;
name|gtk_widget_add_events
argument_list|(
name|geginv
argument_list|,
name|GDK_KEY_RELEASE_MASK
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|geginv
argument_list|)
argument_list|,
literal|"key_press_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|inv_key_press
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|geginv
argument_list|)
argument_list|,
literal|"key_release_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|inv_key_release
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|geginv_canvas
argument_list|)
argument_list|,
literal|"draw"
argument_list|,
name|G_CALLBACK
argument_list|(
name|inv_draw
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_slist_foreach
argument_list|(
name|inv_shots
argument_list|,
operator|(
name|GFunc
operator|)
name|g_free
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|inv_shots
argument_list|)
expr_stmt|;
name|inv_shots
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|INV_COLS
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|INV_ROWS
condition|;
name|j
operator|++
control|)
block|{
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|live
operator|=
name|TRUE
expr_stmt|;
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|x
operator|=
literal|70
operator|+
name|i
operator|*
literal|100
expr_stmt|;
name|invs
index|[
name|i
index|]
index|[
name|j
index|]
operator|.
name|y
operator|=
literal|70
operator|+
name|j
operator|*
literal|80
expr_stmt|;
block|}
block|}
name|inv_num
operator|=
name|INV_ROWS
operator|*
name|INV_COLS
expr_stmt|;
name|g_timeout_add
argument_list|(
operator|(
operator|(
name|inv_num
operator|/
literal|4
operator|)
operator|+
literal|1
operator|)
operator|*
literal|100
argument_list|,
name|geginv_timeout
argument_list|,
name|geginv
argument_list|)
expr_stmt|;
name|g_timeout_add
argument_list|(
literal|90
argument_list|,
name|geginv_move_timeout
argument_list|,
name|geginv
argument_list|)
expr_stmt|;
name|inv_show_status
argument_list|()
expr_stmt|;
name|gtk_widget_show_all
argument_list|(
name|geginv
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

end_unit

