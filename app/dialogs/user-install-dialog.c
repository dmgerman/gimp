begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  * Copyright (C) 2000 Michael Natterer and Sven Neumann  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"gui-types.h"
end_include

begin_include
include|#
directive|include
file|"config/gimprc.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimppropwidgets.h"
end_include

begin_include
include|#
directive|include
file|"gui.h"
end_include

begin_include
include|#
directive|include
file|"resolution-calibrate-dialog.h"
end_include

begin_include
include|#
directive|include
file|"user-install-dialog.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|G_OS_WIN32
end_ifndef

begin_ifndef
ifndef|#
directive|ifndef
name|__EMX__
end_ifndef

begin_define
DECL|macro|USER_INSTALL
define|#
directive|define
name|USER_INSTALL
value|"user_install"
end_define

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<process.h>
end_include

begin_define
DECL|macro|USER_INSTALL
define|#
directive|define
name|USER_INSTALL
value|"user_install.cmd"
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_else
else|#
directive|else
end_else

begin_include
include|#
directive|include
file|<io.h>
end_include

begin_define
DECL|macro|mkdir (path,mode)
define|#
directive|define
name|mkdir
parameter_list|(
name|path
parameter_list|,
name|mode
parameter_list|)
value|_mkdir(path)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|NUM_PAGES
define|#
directive|define
name|NUM_PAGES
value|6
end_define

begin_define
DECL|macro|EEK_PAGE
define|#
directive|define
name|EEK_PAGE
value|(NUM_PAGES - 1)
end_define

begin_define
DECL|macro|PAGE_STYLE (widget)
define|#
directive|define
name|PAGE_STYLE
parameter_list|(
name|widget
parameter_list|)
value|gtk_widget_modify_style (widget, page_style)
end_define

begin_define
DECL|macro|TITLE_STYLE (widget)
define|#
directive|define
name|TITLE_STYLE
parameter_list|(
name|widget
parameter_list|)
value|gtk_widget_modify_style (widget, title_style)
end_define

begin_enum
DECL|enum|__anon2c54062e0103
enum|enum
block|{
DECL|enumerator|DIRENT_COLUMN
name|DIRENT_COLUMN
block|,
DECL|enumerator|PIXBUF_COLUMN
name|PIXBUF_COLUMN
block|,
DECL|enumerator|DESC_COLUMN
name|DESC_COLUMN
block|,
DECL|enumerator|NUM_COLUMNS
name|NUM_COLUMNS
block|}
enum|;
end_enum

begin_function_decl
specifier|static
name|void
name|user_install_continue_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|user_install_run
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_tuning
parameter_list|(
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_resolution
parameter_list|(
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  private stuff  */
end_comment

begin_decl_stmt
DECL|variable|user_install_dialog
specifier|static
name|GtkWidget
modifier|*
name|user_install_dialog
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|notebook
specifier|static
name|GtkWidget
modifier|*
name|notebook
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_image
specifier|static
name|GtkWidget
modifier|*
name|title_image
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_label
specifier|static
name|GtkWidget
modifier|*
name|title_label
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|footer_label
specifier|static
name|GtkWidget
modifier|*
name|footer_label
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|log_page
specifier|static
name|GtkWidget
modifier|*
name|log_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tuning_page
specifier|static
name|GtkWidget
modifier|*
name|tuning_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|resolution_page
specifier|static
name|GtkWidget
modifier|*
name|resolution_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|continue_button
specifier|static
name|GtkWidget
modifier|*
name|continue_button
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|cancel_button
specifier|static
name|GtkWidget
modifier|*
name|cancel_button
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_style
specifier|static
name|GtkRcStyle
modifier|*
name|title_style
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|page_style
specifier|static
name|GtkRcStyle
modifier|*
name|page_style
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|black_color
specifier|static
name|GdkColor
name|black_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|white_color
specifier|static
name|GdkColor
name|white_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_color
specifier|static
name|GdkColor
name|title_color
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2c54062e0203
block|{
DECL|enumerator|TREE_ITEM_DONT
name|TREE_ITEM_DONT
block|,
comment|/* Don't pre-create */
DECL|enumerator|TREE_ITEM_MKDIR_ONLY
name|TREE_ITEM_MKDIR_ONLY
block|,
comment|/* Just mkdir */
DECL|enumerator|TREE_ITEM_FROM_SYSCONF_DIR
name|TREE_ITEM_FROM_SYSCONF_DIR
block|,
comment|/* Copy from sysconf directory */
DECL|enumerator|TREE_ITEM_FROM_DATA_DIR
name|TREE_ITEM_FROM_DATA_DIR
comment|/* ... from data directory */
DECL|typedef|TreeItemType
block|}
name|TreeItemType
typedef|;
end_typedef

begin_struct
specifier|static
struct|struct
DECL|struct|__anon2c54062e0308
block|{
DECL|member|directory
name|gboolean
name|directory
decl_stmt|;
DECL|member|text
name|gchar
modifier|*
name|text
decl_stmt|;
DECL|member|description
name|gchar
modifier|*
name|description
decl_stmt|;
DECL|member|type
name|TreeItemType
name|type
decl_stmt|;
DECL|member|source_filename
name|gchar
modifier|*
name|source_filename
decl_stmt|;
comment|/* If NULL, use text */
block|}
DECL|variable|tree_items
name|tree_items
index|[]
init|=
block|{
block|{
name|FALSE
block|,
literal|"gimprc"
block|,
name|N_
argument_list|(
literal|"The gimprc is used to store personal preferences\n"
literal|"that affect GIMP's default behavior.\n"
literal|"Paths to search for brushes, palettes, gradients,\n"
literal|"patterns, plug-ins and modules can also configured\n"
literal|"here."
argument_list|)
block|,
name|TREE_ITEM_FROM_SYSCONF_DIR
block|,
literal|"gimprc_user"
block|}
block|,
block|{
name|FALSE
block|,
literal|"gtkrc"
block|,
name|N_
argument_list|(
literal|"GIMP uses an additional gtkrc file so you can\n"
literal|"configure it to look differently than other GTK apps."
argument_list|)
block|,
name|TREE_ITEM_FROM_SYSCONF_DIR
block|,
literal|"gtkrc_user"
block|}
block|,
block|{
name|FALSE
block|,
literal|"pluginrc"
block|,
name|N_
argument_list|(
literal|"Plug-ins and extensions are external programs run\n"
literal|"by the GIMP which provide additional functionality.\n"
literal|"These programs are searched for at run-time and\n"
literal|"information about their functionality and mod-times\n"
literal|"is cached in this file.  This file is intended to\n"
literal|"be GIMP-readable only, and should not be edited."
argument_list|)
block|,
name|TREE_ITEM_DONT
block|,
name|NULL
block|}
block|,
block|{
name|FALSE
block|,
literal|"menurc"
block|,
name|N_
argument_list|(
literal|"Key shortcuts can be dynamically redefined in The GIMP.\n"
literal|"The menurc is a dump of your configuration so it can.\n"
literal|"be remembered for the next session.  You may edit this\n"
literal|"file if you wish, but it is much easier to define the\n"
literal|"keys from within The GIMP.  Deleting this file will\n"
literal|"restore the default shortcuts."
argument_list|)
block|,
name|TREE_ITEM_DONT
block|,
name|NULL
block|}
block|,
block|{
name|FALSE
block|,
literal|"sessionrc"
block|,
name|N_
argument_list|(
literal|"The sessionrc is used to store what dialog windows were\n"
literal|"open the last time you quit The GIMP.  You can configure\n"
literal|"The GIMP to reopen these dialogs at the saved position."
argument_list|)
block|,
name|TREE_ITEM_DONT
block|,
name|NULL
block|}
block|,
block|{
name|FALSE
block|,
literal|"unitrc"
block|,
name|N_
argument_list|(
literal|"The unitrc is used to store your user units database.\n"
literal|"You can define additional units and use them just\n"
literal|"like you use the built-in units inches, millimeters,\n"
literal|"points and picas.  This file is overwritten each time\n"
literal|"you quit the GIMP."
argument_list|)
block|,
name|TREE_ITEM_FROM_SYSCONF_DIR
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"brushes"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined brushes.\n"
literal|"The GIMP checks this folder in addition to the system-\n"
literal|"wide GIMP brushes installation when searching for\n"
literal|"brushes."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"generated_brushes"
block|,
name|N_
argument_list|(
literal|"This folder is used to store brushes that are created\n"
literal|"with the brush editor."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"gradients"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined gradients\n"
literal|"The GIMP checks this folder in addition to the system-\n"
literal|"wide GIMP gradients installation when searching for\n"
literal|"gradients."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"palettes"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined palettes.\n"
literal|"The GIMP checks this folder in addition to the system-\n"
literal|"wide GIMP palettes installation when searching for\n"
literal|"palettes."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"patterns"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined patterns.\n"
literal|"The GIMP checks this folder in addition to the system-\n"
literal|"wide GIMP patterns installation when searching for\n"
literal|"patterns."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"plug-ins"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created, temporary,\n"
literal|"or otherwise non-system-supported plug-ins.  The GIMP\n"
literal|"checks this folder in addition to the system-wide\n"
literal|"GIMP plug-in folder when searching for plug-ins."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"modules"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created, temporary,\n"
literal|"or otherwise non-system-supported DLL modules.  The\n"
literal|"GIMP checks this folder in addition to the system-wide\n"
literal|"GIMP module folder when searching for modules to load\n"
literal|"during initialization."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"environ"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created, temporary,\n"
literal|"or otherwise non-system-supported additions to the\n"
literal|"plug-in environment.  The GIMP checks this folder in\n"
literal|"addition to the system-wide GIMP environment folder\n"
literal|"when searching for plug-in environment modification\n"
literal|"files."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"scripts"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created and installed\n"
literal|"scripts.  The GIMP checks this folder in addition to\n"
literal|"the systemwide GIMP scripts folder when searching for\n"
literal|"scripts."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"tmp"
block|,
name|N_
argument_list|(
literal|"This folder is used to temporarily store undo buffers\n"
literal|"to reduce memory usage.  If The GIMP is unceremoniously\n"
literal|"killed, files of the form: gimp<#>.<#> may persist in\n"
literal|"this folder.  These files are useless across GIMP\n"
literal|"sessions and can be destroyed with impunity."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"curves"
block|,
name|N_
argument_list|(
literal|"This folder is used to store parameter files for the\n"
literal|"Curves tool."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"levels"
block|,
name|N_
argument_list|(
literal|"This folder is used to store parameter files for the\n"
literal|"Levels tool."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"fractalexplorer"
block|,
name|N_
argument_list|(
literal|"This is folder used to store user defined fractals to\n"
literal|"be used by the FractalExplorer plug-in.  The GIMP\n"
literal|"checks this folder in addition to the systemwide\n"
literal|"FractalExplorer installation when searching for fractals."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"gfig"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined figures to\n"
literal|"be used by the GFig plug-in.  The GIMP checks this\n"
literal|"folder in addition to the systemwide GFig installation\n"
literal|"when searching for gfig figures."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"gflare"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined gflares to\n"
literal|"be used by the GFlare plug-in.  The GIMP checks this\n"
literal|"folder in addition to the systemwide GFlares\n"
literal|"installation when searching for gflares."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|,
block|{
name|TRUE
block|,
literal|"gimpressionist"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined data to be\n"
literal|"used by the Gimpressionist plug-in.  The GIMP checks\n"
literal|"this folder in addition to the systemwide Gimpressionist\n"
literal|"installation when searching for data."
argument_list|)
block|,
name|TREE_ITEM_MKDIR_ONLY
block|,
name|NULL
block|}
block|}
struct|;
end_struct

begin_decl_stmt
specifier|static
name|gint
name|num_tree_items
init|=
name|G_N_ELEMENTS
argument_list|(
name|tree_items
argument_list|)
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|user_install_notebook_set_page (GtkNotebook * notebook,gint index)
name|user_install_notebook_set_page
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|gint
name|index
parameter_list|)
block|{
name|gchar
modifier|*
name|title
decl_stmt|;
name|gchar
modifier|*
name|footer
decl_stmt|;
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|page
operator|=
name|gtk_notebook_get_nth_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|title
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"title"
argument_list|)
expr_stmt|;
name|footer
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"footer"
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|title_label
argument_list|)
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|footer
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|==
name|EEK_PAGE
operator|&&
name|title_image
condition|)
block|{
name|GdkPixbuf
modifier|*
name|wilber
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|filename
operator|=
name|g_build_filename
argument_list|(
name|gimp_data_directory
argument_list|()
argument_list|,
literal|"images"
argument_list|,
literal|"wilber-eek.png"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|wilber
operator|=
name|gdk_pixbuf_new_from_file
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|wilber
condition|)
block|{
name|gtk_image_set_from_pixbuf
argument_list|(
name|GTK_IMAGE
argument_list|(
name|title_image
argument_list|)
argument_list|,
name|wilber
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|wilber
argument_list|)
expr_stmt|;
block|}
block|}
name|gtk_notebook_set_current_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_continue_callback (GtkWidget * widget,GimpRc * gimprc)
name|user_install_continue_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
block|{
specifier|static
name|gint
name|notebook_index
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|notebook_index
condition|)
block|{
case|case
literal|0
case|:
break|break;
case|case
literal|1
case|:
comment|/*  Creatring the directories can take some time on NFS, so inform        *  the user and set the buttons insensitive        */
name|gtk_widget_set_sensitive
argument_list|(
name|continue_button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|cancel_button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Please wait while your personal\n"
literal|"GIMP folder is being created..."
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
if|if
condition|(
name|user_install_run
argument_list|()
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|continue_button
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|cancel_button
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|user_install_tuning
argument_list|(
name|gimprc
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|user_install_resolution
argument_list|(
name|gimprc
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|gimp_rc_save
argument_list|(
name|gimprc
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|title_style
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|G_OBJECT
argument_list|(
name|page_style
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|user_install_dialog
argument_list|)
expr_stmt|;
name|gtk_main_quit
argument_list|()
expr_stmt|;
return|return;
break|break;
case|case
name|EEK_PAGE
case|:
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|notebook_index
operator|<
name|NUM_PAGES
operator|-
literal|1
condition|)
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
operator|++
name|notebook_index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_cancel_callback (GtkWidget * widget,gpointer data)
name|user_install_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
specifier|static
name|gint
name|timeout
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|timeout
condition|)
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|continue_button
argument_list|)
expr_stmt|;
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|EEK_PAGE
argument_list|)
expr_stmt|;
name|timeout
operator|=
name|g_timeout_add
argument_list|(
literal|1024
argument_list|,
operator|(
name|GSourceFunc
operator|)
name|exit
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|user_install_corner_expose (GtkWidget * widget,GdkEventExpose * eevent,gpointer data)
name|user_install_corner_expose
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|eevent
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkCornerType
name|corner
decl_stmt|;
comment|/* call default handler explicitly, then draw the corners */
if|if
condition|(
name|GTK_WIDGET_GET_CLASS
argument_list|(
name|widget
argument_list|)
operator|->
name|expose_event
condition|)
name|GTK_WIDGET_GET_CLASS
argument_list|(
name|widget
argument_list|)
operator|->
name|expose_event
argument_list|(
name|widget
argument_list|,
name|eevent
argument_list|)
expr_stmt|;
name|corner
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|corner
condition|)
block|{
case|case
name|GTK_CORNER_TOP_LEFT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|90
operator|*
literal|64
argument_list|,
literal|180
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_LEFT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|height
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|180
operator|*
literal|64
argument_list|,
literal|270
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_TOP_RIGHT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|width
argument_list|,
literal|0
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|0
operator|*
literal|64
argument_list|,
literal|90
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_RIGHT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|width
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|height
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|270
operator|*
literal|64
argument_list|,
literal|360
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|user_install_notebook_append_page (GtkNotebook * notebook,gchar * title,gchar * footer)
name|user_install_notebook_append_page
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|gchar
modifier|*
name|title
parameter_list|,
name|gchar
modifier|*
name|footer
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"title"
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"footer"
argument_list|,
name|footer
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|notebook
argument_list|,
name|page
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|add_label (GtkBox * box,gchar * text)
name|add_label
parameter_list|(
name|GtkBox
modifier|*
name|box
parameter_list|,
name|gchar
modifier|*
name|text
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|box
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_sel_changed (GtkTreeSelection * sel,gpointer data)
name|user_install_sel_changed
parameter_list|(
name|GtkTreeSelection
modifier|*
name|sel
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkNotebook
modifier|*
name|notebook
init|=
name|GTK_NOTEBOOK
argument_list|(
name|data
argument_list|)
decl_stmt|;
name|GtkTreeModel
modifier|*
name|model
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|;
name|gint
name|index
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|gtk_tree_selection_get_selected
argument_list|(
name|sel
argument_list|,
operator|&
name|model
argument_list|,
operator|&
name|iter
argument_list|)
condition|)
name|gtk_tree_model_get
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|,
name|DESC_COLUMN
argument_list|,
operator|&
name|index
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_tv_fix_size_request (GtkWidget * widget,GtkAllocation * allocation)
name|user_install_tv_fix_size_request
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkAllocation
modifier|*
name|allocation
parameter_list|)
block|{
name|gtk_widget_set_size_request
argument_list|(
name|widget
argument_list|,
name|allocation
operator|->
name|width
argument_list|,
name|allocation
operator|->
name|height
argument_list|)
expr_stmt|;
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|widget
argument_list|,
name|user_install_tv_fix_size_request
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|user_install_dialog_create (const gchar * alternate_system_gimprc,const gchar * alternate_gimprc,gboolean verbose)
name|user_install_dialog_create
parameter_list|(
specifier|const
name|gchar
modifier|*
name|alternate_system_gimprc
parameter_list|,
specifier|const
name|gchar
modifier|*
name|alternate_gimprc
parameter_list|,
name|gboolean
name|verbose
parameter_list|)
block|{
name|GimpRc
modifier|*
name|gimprc
decl_stmt|;
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|ebox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|darea
decl_stmt|;
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|sep
decl_stmt|;
name|GtkWidget
modifier|*
name|eek_box
decl_stmt|;
name|GdkPixbuf
modifier|*
name|wilber
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|gimprc
operator|=
name|gimp_rc_new
argument_list|(
name|alternate_system_gimprc
argument_list|,
name|alternate_gimprc
argument_list|,
name|verbose
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|user_install_dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"GIMP User Installation"
argument_list|)
argument_list|,
literal|"user_installation"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GTK_WIN_POS_CENTER
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|user_install_cancel_callback
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|,
operator|&
name|cancel_button
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"Continue"
argument_list|)
argument_list|,
name|user_install_continue_callback
argument_list|,
name|gimprc
argument_list|,
name|NULL
argument_list|,
operator|&
name|continue_button
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_object_weak_ref
argument_list|(
name|G_OBJECT
argument_list|(
name|dialog
argument_list|)
argument_list|,
operator|(
name|GWeakNotify
operator|)
name|g_object_unref
argument_list|,
name|gimprc
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_dialog_set_has_separator
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|eek_box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
operator|->
name|parent
argument_list|)
argument_list|,
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|eek_box
argument_list|)
argument_list|,
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|eek_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|eek_box
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"black"
argument_list|,
operator|&
name|black_color
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"white"
argument_list|,
operator|&
name|white_color
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"dark orange"
argument_list|,
operator|&
name|title_color
argument_list|)
expr_stmt|;
name|gtk_widget_realize
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
comment|/*  B/W Style for the page contents  */
name|page_style
operator|=
name|gtk_widget_get_modifier_style
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|page_style
argument_list|)
expr_stmt|;
name|page_style
operator|->
name|fg
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|black_color
expr_stmt|;
name|page_style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|white_color
expr_stmt|;
name|page_style
operator|->
name|text
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|black_color
expr_stmt|;
name|page_style
operator|->
name|base
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|white_color
expr_stmt|;
name|page_style
operator|->
name|color_flags
index|[
name|GTK_STATE_NORMAL
index|]
operator||=
operator|(
name|GTK_RC_FG
operator||
name|GTK_RC_BG
operator||
name|GTK_RC_TEXT
operator||
name|GTK_RC_BASE
operator|)
expr_stmt|;
name|page_style
operator|->
name|fg
index|[
name|GTK_STATE_ACTIVE
index|]
operator|=
name|black_color
expr_stmt|;
name|page_style
operator|->
name|bg
index|[
name|GTK_STATE_ACTIVE
index|]
operator|=
name|white_color
expr_stmt|;
name|page_style
operator|->
name|color_flags
index|[
name|GTK_STATE_ACTIVE
index|]
operator||=
operator|(
name|GTK_RC_FG
operator||
name|GTK_RC_BG
operator|)
expr_stmt|;
comment|/*  B/Colored Style for the page title  */
name|title_style
operator|=
name|gtk_rc_style_copy
argument_list|(
name|page_style
argument_list|)
expr_stmt|;
name|title_style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|title_color
expr_stmt|;
name|pango_font_description_free
argument_list|(
name|title_style
operator|->
name|font_desc
argument_list|)
expr_stmt|;
name|title_style
operator|->
name|font_desc
operator|=
name|pango_font_description_from_string
argument_list|(
literal|"sans 20"
argument_list|)
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|footer_label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|footer_label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_RIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|eek_box
argument_list|)
argument_list|,
name|footer_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|footer_label
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|ebox
argument_list|,
name|GDK_EXPOSURE_MASK
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|ebox
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|filename
operator|=
name|g_build_filename
argument_list|(
name|gimp_data_directory
argument_list|()
argument_list|,
literal|"images"
argument_list|,
literal|"wilber-wizard.png"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|wilber
operator|=
name|gdk_pixbuf_new_from_file
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|wilber
condition|)
block|{
name|title_image
operator|=
name|gtk_image_new_from_pixbuf
argument_list|(
name|wilber
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|wilber
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|title_image
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title_image
argument_list|)
expr_stmt|;
block|}
name|title_label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|title_label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|title_label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|title_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title_label
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|ebox
argument_list|,
literal|16
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|ebox
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|darea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|darea
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|darea
argument_list|)
argument_list|,
literal|"expose_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|GTK_CORNER_TOP_LEFT
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|darea
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|darea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|darea
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|darea
argument_list|)
argument_list|,
literal|"expose_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|GTK_CORNER_BOTTOM_LEFT
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|darea
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_show_tabs
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_border
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|notebook
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  Page 1  */
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Welcome to\n"
literal|"The GIMP User Installation"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to enter "
literal|"the GIMP user installation."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"The GIMP - GNU Image Manipulation Program\n"
literal|"Copyright (C) 1995-2002\n"
literal|"Spencer Kimball, Peter Mattis and the GIMP Development Team."
argument_list|)
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This program is free software; you can redistribute it and/or modify\n"
literal|"it under the terms of the GNU General Public License as published by\n"
literal|"the Free Software Foundation; either version 2 of the License, or\n"
literal|"(at your option) any later version."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This program is distributed in the hope that it will be useful,\n"
literal|"but WITHOUT ANY WARRANTY; without even the implied warranty of\n"
literal|"MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n"
literal|"See the GNU General Public License for more details."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"You should have received a copy of the GNU General Public License\n"
literal|"along with this program; if not, write to the Free Software\n"
literal|"Foundation, Inc., 59 Temple Place - Suite 330, Boston,\n"
literal|"MA 02111-1307, USA."
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Page 2  */
block|{
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|tv
decl_stmt|;
name|GdkPixbuf
modifier|*
name|file_pixbuf
decl_stmt|;
name|GdkPixbuf
modifier|*
name|folder_pixbuf
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook2
decl_stmt|;
name|GtkWidget
modifier|*
name|page2
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|GtkTreeStore
modifier|*
name|tree
decl_stmt|;
name|GtkTreeViewColumn
modifier|*
name|column
decl_stmt|;
name|GtkCellRenderer
modifier|*
name|cell
decl_stmt|;
name|GtkTreeSelection
modifier|*
name|sel
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|,
name|child
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Personal GIMP Folder"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to create "
literal|"your personal GIMP folder."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|tree
operator|=
name|gtk_tree_store_new
argument_list|(
name|NUM_COLUMNS
argument_list|,
name|G_TYPE_STRING
argument_list|,
name|GDK_TYPE_PIXBUF
argument_list|,
name|G_TYPE_INT
argument_list|)
expr_stmt|;
name|tv
operator|=
name|gtk_tree_view_new_with_model
argument_list|(
name|GTK_TREE_MODEL
argument_list|(
name|tree
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|tree
argument_list|)
expr_stmt|;
name|column
operator|=
name|gtk_tree_view_column_new
argument_list|()
expr_stmt|;
name|cell
operator|=
name|gtk_cell_renderer_pixbuf_new
argument_list|()
expr_stmt|;
name|gtk_tree_view_column_pack_start
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_tree_view_column_set_attributes
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
literal|"pixbuf"
argument_list|,
name|PIXBUF_COLUMN
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|cell
operator|=
name|gtk_cell_renderer_text_new
argument_list|()
expr_stmt|;
name|gtk_tree_view_column_pack_start
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_tree_view_column_set_attributes
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
literal|"text"
argument_list|,
name|DIRENT_COLUMN
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_view_append_column
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|gtk_tree_view_set_headers_visible
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|tv
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"For a proper GIMP installation, a folder named\n"
literal|"%s needs to be created."
argument_list|)
argument_list|,
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This folder will contain a number of important files.\n"
literal|"Click on one of the files or folders in the tree\n"
literal|"to get more information about the selected item."
argument_list|)
argument_list|)
expr_stmt|;
name|notebook2
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|notebook2
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_tabs
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_border
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|notebook2
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook2
argument_list|)
expr_stmt|;
comment|/*  empty page  */
name|page2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page2
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|page2
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|sel
operator|=
name|gtk_tree_view_get_selection
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|sel
argument_list|)
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_sel_changed
argument_list|)
argument_list|,
name|notebook2
argument_list|)
expr_stmt|;
name|file_pixbuf
operator|=
name|gtk_widget_render_icon
argument_list|(
name|tv
argument_list|,
name|GTK_STOCK_NEW
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|folder_pixbuf
operator|=
name|gtk_widget_render_icon
argument_list|(
name|tv
argument_list|,
name|GTK_STOCK_OPEN
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_store_append
argument_list|(
name|tree
argument_list|,
operator|&
name|iter
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_store_set
argument_list|(
name|tree
argument_list|,
operator|&
name|iter
argument_list|,
name|DIRENT_COLUMN
argument_list|,
name|gimp_directory
argument_list|()
argument_list|,
name|PIXBUF_COLUMN
argument_list|,
name|folder_pixbuf
argument_list|,
name|DESC_COLUMN
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_tree_items
condition|;
name|i
operator|++
control|)
block|{
name|gtk_tree_store_append
argument_list|(
name|tree
argument_list|,
operator|&
name|child
argument_list|,
operator|&
name|iter
argument_list|)
expr_stmt|;
name|gtk_tree_store_set
argument_list|(
name|tree
argument_list|,
operator|&
name|child
argument_list|,
name|DIRENT_COLUMN
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|text
argument_list|,
name|PIXBUF_COLUMN
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|directory
condition|?
name|folder_pixbuf
else|:
name|file_pixbuf
argument_list|,
name|DESC_COLUMN
argument_list|,
name|i
operator|+
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|page2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|gettext
argument_list|(
name|tree_items
index|[
name|i
index|]
operator|.
name|description
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page2
argument_list|)
argument_list|,
name|label
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page2
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|page2
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_tree_view_expand_all
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|tv
argument_list|,
literal|"size_allocate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_tv_fix_size_request
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|file_pixbuf
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|folder_pixbuf
argument_list|)
expr_stmt|;
block|}
comment|/*  Page 3  */
name|page
operator|=
name|log_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"User Installation Log"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Page 4  */
name|page
operator|=
name|tuning_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP Performance Tuning"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to accept the settings above."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"For optimal GIMP performance, some settings may have to be adjusted."
argument_list|)
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
comment|/*  Page 5  */
name|page
operator|=
name|resolution_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Monitor Resolution"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to start The GIMP."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"To display images in their natural size, "
literal|"GIMP needs to know your monitor resolution."
argument_list|)
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
comment|/*  EEK page  */
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Aborting Installation..."
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_focus
argument_list|(
name|continue_button
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|continue_button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*********************/
end_comment

begin_comment
comment|/*  Local functions  */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_decl_stmt
DECL|variable|install_error_message
specifier|static
name|gchar
modifier|*
name|install_error_message
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
DECL|function|copy_file (gchar * source,gchar * dest)
name|copy_file
parameter_list|(
name|gchar
modifier|*
name|source
parameter_list|,
name|gchar
modifier|*
name|dest
parameter_list|)
block|{
name|char
name|buffer
index|[
literal|4096
index|]
decl_stmt|;
name|FILE
modifier|*
name|sfile
decl_stmt|,
modifier|*
name|dfile
decl_stmt|;
name|int
name|nbytes
decl_stmt|;
name|sfile
operator|=
name|fopen
argument_list|(
name|source
argument_list|,
literal|"rb"
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfile
operator|==
name|NULL
condition|)
block|{
name|install_error_message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Cannot open %s for reading"
argument_list|)
argument_list|,
name|source
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|dfile
operator|=
name|fopen
argument_list|(
name|dest
argument_list|,
literal|"wb"
argument_list|)
expr_stmt|;
if|if
condition|(
name|dfile
operator|==
name|NULL
condition|)
block|{
name|install_error_message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Cannot open %s for writing"
argument_list|)
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|sfile
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
while|while
condition|(
operator|(
name|nbytes
operator|=
name|fread
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|sfile
argument_list|)
operator|)
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|fwrite
argument_list|(
name|buffer
argument_list|,
literal|1
argument_list|,
name|nbytes
argument_list|,
name|dfile
argument_list|)
operator|<
name|nbytes
condition|)
block|{
name|install_error_message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Error while writing %s"
argument_list|)
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|sfile
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|dfile
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
block|}
if|if
condition|(
name|ferror
argument_list|(
name|sfile
argument_list|)
condition|)
block|{
name|install_error_message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Error while reading %s"
argument_list|)
argument_list|,
name|source
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|sfile
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|dfile
argument_list|)
expr_stmt|;
return|return
operator|-
literal|1
return|;
block|}
name|fclose
argument_list|(
name|sfile
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|dfile
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_function
specifier|static
name|gboolean
DECL|function|user_install_run (void)
name|user_install_run
parameter_list|(
name|void
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|G_OS_WIN32
name|FILE
modifier|*
name|pfp
decl_stmt|;
name|gchar
modifier|*
name|filename
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|command
init|=
name|NULL
decl_stmt|;
name|struct
name|stat
name|stat_buf
decl_stmt|;
name|gint
name|err
decl_stmt|;
name|gboolean
name|executable
init|=
name|TRUE
decl_stmt|;
name|filename
operator|=
name|g_build_filename
argument_list|(
name|gimp_data_directory
argument_list|()
argument_list|,
literal|"misc"
argument_list|,
name|USER_INSTALL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|err
operator|=
name|stat
argument_list|(
name|filename
argument_list|,
operator|&
name|stat_buf
argument_list|)
operator|)
operator|!=
literal|0
condition|)
block|{
name|gchar
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s\n%s"
argument_list|,
name|filename
argument_list|,
name|_
argument_list|(
literal|"does not exist.  Cannot install."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|executable
operator|=
name|FALSE
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|S_IXUSR
elseif|else
if|if
condition|(
operator|!
operator|(
name|S_IXUSR
operator|&
name|stat_buf
operator|.
name|st_mode
operator|)
operator|||
operator|!
operator|(
name|S_IRUSR
operator|&
name|stat_buf
operator|.
name|st_mode
operator|)
condition|)
block|{
name|gchar
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s\n%s"
argument_list|,
name|filename
argument_list|,
name|_
argument_list|(
literal|"has invalid permissions.  Cannot install."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|executable
operator|=
name|FALSE
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|executable
condition|)
block|{
ifdef|#
directive|ifdef
name|__EMX__
name|command
operator|=
name|g_strdup_printf
argument_list|(
literal|"cmd.exe /c %s %s %s %s"
argument_list|,
name|filename
argument_list|,
name|gimp_data_directory
argument_list|()
argument_list|,
name|gimp_directory
argument_list|()
argument_list|,
name|gimp_sysconf_directory
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|gchar
modifier|*
name|s
init|=
name|buffer
operator|+
literal|11
decl_stmt|;
while|while
condition|(
operator|*
name|s
condition|)
block|{
if|if
condition|(
operator|*
name|s
operator|==
literal|'/'
condition|)
operator|*
name|s
operator|=
literal|'\\'
expr_stmt|;
name|s
operator|++
expr_stmt|;
block|}
block|}
else|#
directive|else
name|command
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s 2>&1 %s %s %s"
argument_list|,
name|filename
argument_list|,
name|gimp_data_directory
argument_list|()
argument_list|,
name|gimp_directory
argument_list|()
argument_list|,
name|gimp_sysconf_directory
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
comment|/*  urk - should really use something better than popen(), since        *  we can't tell if the installation script failed --austin        */
if|if
condition|(
operator|(
name|pfp
operator|=
name|popen
argument_list|(
name|command
argument_list|,
literal|"r"
argument_list|)
operator|)
operator|!=
name|NULL
condition|)
block|{
name|GtkWidget
modifier|*
name|scrolled_window
decl_stmt|;
name|GtkWidget
modifier|*
name|log_view
decl_stmt|;
name|GtkTextBuffer
modifier|*
name|log_buffer
decl_stmt|;
specifier|static
name|gchar
name|buffer
index|[
literal|2048
index|]
decl_stmt|;
name|scrolled_window
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|scrolled_window
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_window
argument_list|)
expr_stmt|;
name|log_buffer
operator|=
name|gtk_text_buffer_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|log_view
operator|=
name|gtk_text_view_new_with_buffer
argument_list|(
name|log_buffer
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|log_buffer
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|log_view
argument_list|)
expr_stmt|;
name|gtk_text_view_set_editable
argument_list|(
name|GTK_TEXT_VIEW
argument_list|(
name|log_view
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|log_view
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|log_view
argument_list|)
expr_stmt|;
while|while
condition|(
name|fgets
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
name|pfp
argument_list|)
condition|)
block|{
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|buffer
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|pclose
argument_list|(
name|pfp
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Did you notice any error messages in the lines above?\n"
literal|"If not, installation was successful!\n"
literal|"Otherwise, quit and investigate the possible reason..."
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|executable
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
name|g_free
argument_list|(
name|command
argument_list|)
expr_stmt|;
if|if
condition|(
name|executable
condition|)
block|{
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|log_page
argument_list|)
argument_list|,
literal|"footer"
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to complete GIMP installation."
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Installation failed.  Contact your system administrator."
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|executable
return|;
else|#
directive|else
name|GtkWidget
modifier|*
name|scrolled_window
decl_stmt|;
name|GtkTextBuffer
modifier|*
name|log_buffer
decl_stmt|;
name|GtkWidget
modifier|*
name|log_view
decl_stmt|;
name|gchar
name|dest
index|[
literal|1000
index|]
decl_stmt|;
name|gchar
name|source
index|[
literal|1000
index|]
decl_stmt|;
name|gchar
name|log_line
index|[
literal|1000
index|]
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|scrolled_window
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|scrolled_window
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_window
argument_list|)
expr_stmt|;
name|log_buffer
operator|=
name|gtk_text_buffer_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|log_view
operator|=
name|gtk_text_view_new_with_buffer
argument_list|(
name|log_buffer
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|log_buffer
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|log_view
argument_list|)
expr_stmt|;
name|gtk_text_view_set_editable
argument_list|(
name|GTK_TEXT_VIEW
argument_list|(
name|log_view
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|log_view
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|log_view
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_tree_items
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
name|g_snprintf
argument_list|(
name|log_line
argument_list|,
sizeof|sizeof
argument_list|(
name|log_line
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Creating directory %s\n"
argument_list|)
argument_list|,
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|log_line
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|mkdir
argument_list|(
name|gimp_directory
argument_list|()
argument_list|,
literal|0666
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|install_error_message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Cannot create directory -- %s"
argument_list|)
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|break_out_of_loop
goto|;
block|}
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|_
argument_list|(
literal|"  Success\n"
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|g_snprintf
argument_list|(
name|dest
argument_list|,
sizeof|sizeof
argument_list|(
name|dest
argument_list|)
argument_list|,
literal|"%s%c%s"
argument_list|,
name|gimp_directory
argument_list|()
argument_list|,
name|G_DIR_SEPARATOR
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tree_items
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|TREE_ITEM_DONT
case|:
break|break;
case|case
name|TREE_ITEM_MKDIR_ONLY
case|:
name|g_snprintf
argument_list|(
name|log_line
argument_list|,
sizeof|sizeof
argument_list|(
name|log_line
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Creating directory %s\n"
argument_list|)
argument_list|,
name|dest
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|log_line
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|mkdir
argument_list|(
name|dest
argument_list|,
literal|0666
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|install_error_message
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Cannot create directory -- %s"
argument_list|)
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|break_out_of_loop
goto|;
block|}
break|break;
case|case
name|TREE_ITEM_FROM_SYSCONF_DIR
case|:
name|g_snprintf
argument_list|(
name|source
argument_list|,
sizeof|sizeof
argument_list|(
name|source
argument_list|)
argument_list|,
literal|"%s%c%s"
argument_list|,
name|gimp_sysconf_directory
argument_list|()
argument_list|,
name|G_DIR_SEPARATOR
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|source_filename
condition|?
name|tree_items
index|[
name|i
index|]
operator|.
name|source_filename
else|:
name|tree_items
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
goto|goto
name|do_copy
goto|;
case|case
name|TREE_ITEM_FROM_DATA_DIR
case|:
name|g_snprintf
argument_list|(
name|source
argument_list|,
sizeof|sizeof
argument_list|(
name|source
argument_list|)
argument_list|,
literal|"%s%c%s"
argument_list|,
name|gimp_data_directory
argument_list|()
argument_list|,
name|G_DIR_SEPARATOR
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|source_filename
condition|?
name|tree_items
index|[
name|i
index|]
operator|.
name|source_filename
else|:
name|tree_items
index|[
name|i
index|]
operator|.
name|text
argument_list|)
expr_stmt|;
name|do_copy
label|:
name|g_assert
argument_list|(
operator|!
name|tree_items
index|[
name|i
index|]
operator|.
name|directory
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|log_line
argument_list|,
sizeof|sizeof
argument_list|(
name|log_line
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Copying file %s from %s\n"
argument_list|)
argument_list|,
name|dest
argument_list|,
name|source
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|log_line
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|copy_file
argument_list|(
name|source
argument_list|,
name|dest
argument_list|)
operator|==
operator|-
literal|1
condition|)
goto|goto
name|break_out_of_loop
goto|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|tree_items
index|[
name|i
index|]
operator|.
name|type
operator|!=
name|TREE_ITEM_DONT
condition|)
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|_
argument_list|(
literal|"  Success\n"
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|break_out_of_loop
label|:
if|if
condition|(
name|i
operator|<
name|num_tree_items
condition|)
block|{
name|g_snprintf
argument_list|(
name|log_line
argument_list|,
sizeof|sizeof
argument_list|(
name|log_line
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"  Failure -- %s\n"
argument_list|)
argument_list|,
name|install_error_message
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|log_line
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Installation failed.  Contact system administrator."
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_tuning (GimpRc * gimprc)
name|user_install_tuning
parameter_list|(
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|sep
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
comment|/*  tile cache size  */
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP uses a limited amount of memory to store image data, the so-called\n"
literal|"\"Tile Cache\". You should adjust its size to fit into memory. Consider\n"
literal|"the amount of memory used by other running processes."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gimp_prop_memsize_entry_new
argument_list|(
name|G_OBJECT
argument_list|(
name|gimprc
argument_list|)
argument_list|,
literal|"tile-cache-size"
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Tile Cache Size:"
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
comment|/*  swap file location  */
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"All image and undo data which doesn't fit into the Tile Cache will be\n"
literal|"written to a swap file. This file should be located on a local filesystem\n"
literal|"with enough free space (several hundred MB). On a UNIX system, you\n"
literal|"may want to use the system-wide temp-dir (\"/tmp\" or \"/var/tmp\")."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gimp_prop_file_entry_new
argument_list|(
name|G_OBJECT
argument_list|(
name|gimprc
argument_list|)
argument_list|,
literal|"swap-path"
argument_list|,
name|_
argument_list|(
literal|"Select Swap Dir"
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Swap Folder:"
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_resolution_calibrate (GtkWidget * button,gpointer data)
name|user_install_resolution_calibrate
parameter_list|(
name|GtkWidget
modifier|*
name|button
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|filename
operator|=
name|g_build_filename
argument_list|(
name|gimp_data_directory
argument_list|()
argument_list|,
literal|"themes"
argument_list|,
literal|"Default"
argument_list|,
literal|"images"
argument_list|,
literal|"preferences"
argument_list|,
literal|"monitor.png"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gdk_pixbuf_new_from_file
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|resolution_calibrate_dialog
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|,
name|pixbuf
argument_list|,
name|title_style
argument_list|,
name|page_style
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|pixbuf
condition|)
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_resolution (GimpRc * gimprc)
name|user_install_resolution
parameter_list|(
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
block|{
name|GimpDisplayConfig
modifier|*
name|config
init|=
name|GIMP_DISPLAY_CONFIG
argument_list|(
name|gimprc
argument_list|)
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
name|GtkWidget
modifier|*
name|sep
decl_stmt|;
name|GimpChainButton
modifier|*
name|chain
decl_stmt|;
name|GtkWidget
modifier|*
name|toggle
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gdouble
name|xres
decl_stmt|,
name|yres
decl_stmt|;
name|gchar
modifier|*
name|pixels_per_unit
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|gui_get_screen_resolution
argument_list|(
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP can obtain this information from the windowing system.\n"
literal|"However, usually this does not give useful values."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Get Resolution from windowing system (Currently %d x %d dpi)"
argument_list|)
argument_list|,
name|ROUND
argument_list|(
name|xres
argument_list|)
argument_list|,
name|ROUND
argument_list|(
name|yres
argument_list|)
argument_list|)
expr_stmt|;
name|toggle
operator|=
name|gimp_prop_check_button_new
argument_list|(
name|G_OBJECT
argument_list|(
name|gimprc
argument_list|)
argument_list|,
literal|"monitor-resolution-from-windowing-system"
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|GTK_BIN
argument_list|(
name|toggle
argument_list|)
operator|->
name|child
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|toggle
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|toggle
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Alternatively, you can set the monitor resolution manually."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|pixels_per_unit
operator|=
name|g_strconcat
argument_list|(
name|_
argument_list|(
literal|"Pixels"
argument_list|)
argument_list|,
literal|"/%s"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gimp_prop_coordinates_new
argument_list|(
name|G_OBJECT
argument_list|(
name|gimprc
argument_list|)
argument_list|,
literal|"monitor-xresolution"
argument_list|,
literal|"monitor-yresolution"
argument_list|,
name|NULL
argument_list|,
name|pixels_per_unit
argument_list|,
name|GIMP_SIZE_ENTRY_UPDATE_RESOLUTION
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pixels_per_unit
argument_list|)
expr_stmt|;
name|gimp_size_entry_attach_label
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Horizontal"
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gimp_size_entry_attach_label
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Vertical"
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gimp_size_entry_attach_label
argument_list|(
name|GIMP_SIZE_ENTRY
argument_list|(
name|entry
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"dpi"
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|4
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|chain
operator|=
name|GIMP_COORDINATES_CHAINBUTTON
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chain
operator|->
name|line1
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|chain
operator|->
name|line2
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|GTK_TABLE
argument_list|(
name|entry
argument_list|)
operator|->
name|children
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GtkTableChild
modifier|*
name|child
init|=
operator|(
name|GtkTableChild
operator|*
operator|)
name|list
operator|->
name|data
decl_stmt|;
if|if
condition|(
name|child
operator|&&
name|GTK_IS_LABEL
argument_list|(
name|child
operator|->
name|widget
argument_list|)
condition|)
name|PAGE_STYLE
argument_list|(
name|GTK_WIDGET
argument_list|(
name|child
operator|->
name|widget
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|entry
argument_list|,
operator|!
name|config
operator|->
name|monitor_res_from_gdk
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"You can also press the \"Calibrate\" button to open a window\n"
literal|"which lets you determine your monitor resolution interactively."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|resolution_page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Calibrate"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|GTK_BIN
argument_list|(
name|button
argument_list|)
operator|->
name|child
argument_list|)
argument_list|,
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|button
argument_list|,
operator|!
name|config
operator|->
name|monitor_res_from_gdk
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_resolution_calibrate
argument_list|)
argument_list|,
name|entry
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"inverse_sensitive"
argument_list|,
name|entry
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|entry
argument_list|)
argument_list|,
literal|"inverse_sensitive"
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|toggle
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_toggle_button_sensitive_update
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

