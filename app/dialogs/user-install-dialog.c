begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  * Copyright (C) 2000 Michael Natterer and Sven Neumann  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_include
include|#
directive|include
file|<direct.h>
end_include

begin_comment
comment|/* _mkdir() */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"dialogs-types.h"
end_include

begin_include
include|#
directive|include
file|"config/gimpconfig-utils.h"
end_include

begin_include
include|#
directive|include
file|"config/gimprc.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimppropwidgets.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpwidgets-utils.h"
end_include

begin_include
include|#
directive|include
file|"user-install-dialog.h"
end_include

begin_include
include|#
directive|include
file|"gimp-intl.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_include
include|#
directive|include
file|<io.h>
end_include

begin_define
DECL|macro|mkdir (path,mode)
define|#
directive|define
name|mkdir
parameter_list|(
name|path
parameter_list|,
name|mode
parameter_list|)
value|_mkdir(path)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_define
DECL|macro|PAGE_STYLE (widget)
define|#
directive|define
name|PAGE_STYLE
parameter_list|(
name|widget
parameter_list|)
value|gtk_widget_modify_style (widget, page_style)
end_define

begin_define
DECL|macro|TITLE_STYLE (widget)
define|#
directive|define
name|TITLE_STYLE
parameter_list|(
name|widget
parameter_list|)
value|gtk_widget_modify_style (widget, title_style)
end_define

begin_enum
enum|enum
DECL|enum|__anon2acefcd80103
block|{
DECL|enumerator|GPL_PAGE
name|GPL_PAGE
block|,
DECL|enumerator|MIGRATION_PAGE
name|MIGRATION_PAGE
block|,
DECL|enumerator|TREE_PAGE
name|TREE_PAGE
block|,
DECL|enumerator|LOG_PAGE
name|LOG_PAGE
block|,
DECL|enumerator|TUNING_PAGE
name|TUNING_PAGE
block|,
DECL|enumerator|NUM_PAGES
name|NUM_PAGES
block|}
enum|;
end_enum

begin_enum
enum|enum
DECL|enum|__anon2acefcd80203
block|{
DECL|enumerator|DIRENT_COLUMN
name|DIRENT_COLUMN
block|,
DECL|enumerator|PIXBUF_COLUMN
name|PIXBUF_COLUMN
block|,
DECL|enumerator|DESC_COLUMN
name|DESC_COLUMN
block|,
DECL|enumerator|NUM_COLUMNS
name|NUM_COLUMNS
block|}
enum|;
end_enum

begin_function_decl
specifier|static
name|void
name|user_install_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|user_install_run
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|user_install_tuning
parameter_list|(
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  private stuff  */
end_comment

begin_decl_stmt
DECL|variable|user_install_dialog
specifier|static
name|GtkWidget
modifier|*
name|user_install_dialog
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|notebook
specifier|static
name|GtkWidget
modifier|*
name|notebook
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_image
specifier|static
name|GtkWidget
modifier|*
name|title_image
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_label
specifier|static
name|GtkWidget
modifier|*
name|title_label
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|footer_label
specifier|static
name|GtkWidget
modifier|*
name|footer_label
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|log_page
specifier|static
name|GtkWidget
modifier|*
name|log_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tuning_page
specifier|static
name|GtkWidget
modifier|*
name|tuning_page
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_style
specifier|static
name|GtkRcStyle
modifier|*
name|title_style
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|page_style
specifier|static
name|GtkRcStyle
modifier|*
name|page_style
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|black_color
specifier|static
name|GdkColor
name|black_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|white_color
specifier|static
name|GdkColor
name|white_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|title_color
specifier|static
name|GdkColor
name|title_color
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|oldgimp
specifier|static
name|gchar
modifier|*
name|oldgimp
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|migrate
specifier|static
name|gboolean
name|migrate
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2acefcd80303
block|{
DECL|enumerator|TREE_ITEM_DO_NOTHING
name|TREE_ITEM_DO_NOTHING
block|,
comment|/* Don't pre-create            */
DECL|enumerator|TREE_ITEM_MKDIR
name|TREE_ITEM_MKDIR
block|,
comment|/* Create the directory        */
DECL|enumerator|TREE_ITEM_FROM_SYSCONF_DIR
name|TREE_ITEM_FROM_SYSCONF_DIR
comment|/* Copy from sysconf directory */
DECL|typedef|TreeItemType
block|}
name|TreeItemType
typedef|;
end_typedef

begin_struct
specifier|static
struct|struct
DECL|struct|__anon2acefcd80408
block|{
DECL|member|directory
name|gboolean
name|directory
decl_stmt|;
DECL|member|name
name|gchar
modifier|*
name|name
decl_stmt|;
DECL|member|description
name|gchar
modifier|*
name|description
decl_stmt|;
DECL|member|type
name|TreeItemType
name|type
decl_stmt|;
block|}
DECL|variable|tree_items
name|tree_items
index|[]
init|=
block|{
block|{
name|FALSE
block|,
literal|"gimprc"
block|,
name|N_
argument_list|(
literal|"The gimprc is used to store personal preferences "
literal|"that affect GIMP's default behavior.  "
literal|"Paths to search for brushes, palettes, gradients, "
literal|"patterns, plug-ins and modules can also configured "
literal|"here."
argument_list|)
block|,
name|TREE_ITEM_DO_NOTHING
block|}
block|,
block|{
name|FALSE
block|,
literal|"gtkrc"
block|,
name|N_
argument_list|(
literal|"GIMP uses an additional gtkrc file so you can "
literal|"configure it to look differently than other GTK apps."
argument_list|)
block|,
name|TREE_ITEM_FROM_SYSCONF_DIR
block|}
block|,
block|{
name|FALSE
block|,
literal|"pluginrc"
block|,
name|N_
argument_list|(
literal|"Plug-ins and extensions are external programs run "
literal|"by the GIMP which provide additional functionality.  "
literal|"These programs are searched for at run-time and "
literal|"information about their functionality and mod-times "
literal|"is cached in this file.  This file is intended to "
literal|"be GIMP-readable only, and should not be edited."
argument_list|)
block|,
name|TREE_ITEM_DO_NOTHING
block|}
block|,
block|{
name|FALSE
block|,
literal|"menurc"
block|,
name|N_
argument_list|(
literal|"Key shortcuts can be dynamically redefined in The GIMP. "
literal|"The menurc is a dump of your configuration so it can. "
literal|"be remembered for the next session.  You may edit this "
literal|"file if you wish, but it is much easier to define the "
literal|"keys from within The GIMP.  Deleting this file will "
literal|"restore the default shortcuts."
argument_list|)
block|,
name|TREE_ITEM_DO_NOTHING
block|}
block|,
block|{
name|FALSE
block|,
literal|"sessionrc"
block|,
name|N_
argument_list|(
literal|"The sessionrc is used to store what dialog windows were "
literal|"open the last time you quit The GIMP.  You can configure "
literal|"The GIMP to reopen these dialogs at the saved position."
argument_list|)
block|,
name|TREE_ITEM_DO_NOTHING
block|}
block|,
block|{
name|FALSE
block|,
literal|"templaterc"
block|,
name|N_
argument_list|(
literal|"This file holds a collection of standard media sizes that "
literal|"serve as image templates."
argument_list|)
block|,
name|TREE_ITEM_DO_NOTHING
block|}
block|,
block|{
name|FALSE
block|,
literal|"unitrc"
block|,
name|N_
argument_list|(
literal|"The unitrc is used to store your user units database.  "
literal|"You can define additional units and use them just "
literal|"like you use the built-in units inches, millimeters, "
literal|"points and picas.  This file is overwritten each time "
literal|"you quit the GIMP."
argument_list|)
block|,
name|TREE_ITEM_DO_NOTHING
block|}
block|,
block|{
name|TRUE
block|,
literal|"brushes"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined brushes. "
literal|"The GIMP checks this folder in addition to the system-wide "
literal|"GIMP brushes installation when searching for "
literal|"brushes."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"fonts"
block|,
name|N_
argument_list|(
literal|"This folder is used to store fonts you only want "
literal|"visible in the GIMP. The GIMP checks this folder in "
literal|"addition to the system-wide GIMP fonts installation "
literal|"when searching for fonts. Use this only if you really "
literal|"want to have GIMP-only fonts, otherwise put things "
literal|"in your global font directory."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"gradients"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined gradients.  "
literal|"The GIMP checks this folder in addition to the system-wide "
literal|"GIMP gradients installation when searching for gradients."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"palettes"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined palettes.  "
literal|"The GIMP checks this folder in addition to the system-wide "
literal|"GIMP palettes installation when searching for palettes."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"patterns"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user defined patterns.  "
literal|"The GIMP checks this folder in addition to the system-wide "
literal|"GIMP patterns installation when searching for patterns."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"plug-ins"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created, temporary, "
literal|"or otherwise non-system-supported plug-ins.  The GIMP "
literal|"checks this folder in addition to the system-wide "
literal|"GIMP plug-in folder when searching for plug-ins."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"modules"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created, temporary, "
literal|"or otherwise non-system-supported DLL modules.  The "
literal|"GIMP checks this folder in addition to the system-wide "
literal|"GIMP module folder when searching for modules to load "
literal|"during initialization."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"environ"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created, temporary, "
literal|"or otherwise non-system-supported additions to the "
literal|"plug-in environment.  The GIMP checks this folder in "
literal|"addition to the system-wide GIMP environment folder "
literal|"when searching for plug-in environment modification "
literal|"files."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"scripts"
block|,
name|N_
argument_list|(
literal|"This folder is used to store user created and installed "
literal|"scripts.  The GIMP checks this folder in addition to "
literal|"the systemwide GIMP scripts folder when searching for "
literal|"scripts."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"templates"
block|,
name|N_
argument_list|(
literal|"This folder is searched for image templates."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"themes"
block|,
name|N_
argument_list|(
literal|"This folder is searched for user-installed themes."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"tmp"
block|,
name|N_
argument_list|(
literal|"This folder is used to temporarily store undo buffers "
literal|"to reduce memory usage.  If The GIMP is unceremoniously "
literal|"killed, files of the form: gimp<#>.<#> may persist in "
literal|"this folder.  These files are useless across GIMP "
literal|"sessions and can be destroyed with impunity."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"tool-options"
block|,
name|N_
argument_list|(
literal|"This folder is used to store tool options."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"curves"
block|,
name|N_
argument_list|(
literal|"This folder is used to store parameter files for the Curves tool."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"levels"
block|,
name|N_
argument_list|(
literal|"This folder is used to store parameter files for the Levels tool."
argument_list|)
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"fractalexplorer"
block|,
name|NULL
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"gfig"
block|,
name|NULL
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"gflare"
block|,
name|NULL
block|,
name|TREE_ITEM_MKDIR
block|}
block|,
block|{
name|TRUE
block|,
literal|"gimpressionist"
block|,
name|NULL
block|,
name|TREE_ITEM_MKDIR
block|}
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
DECL|function|user_install_notebook_set_page (GtkNotebook * notebook,gint index)
name|user_install_notebook_set_page
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|gint
name|index
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|gchar
modifier|*
name|title
decl_stmt|;
name|gchar
modifier|*
name|footer
decl_stmt|;
name|page
operator|=
name|gtk_notebook_get_nth_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|title
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"title"
argument_list|)
expr_stmt|;
name|footer
operator|=
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"footer"
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|title_label
argument_list|)
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|footer
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_response (GtkWidget * widget,gint response_id,GimpRc * gimprc)
name|user_install_response
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|response_id
parameter_list|,
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
block|{
specifier|static
name|gint
name|notebook_index
init|=
name|GPL_PAGE
decl_stmt|;
if|if
condition|(
name|response_id
operator|!=
name|GTK_RESPONSE_OK
condition|)
block|{
name|exit
argument_list|(
name|EXIT_SUCCESS
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|notebook_index
condition|)
block|{
case|case
name|GPL_PAGE
case|:
if|if
condition|(
name|oldgimp
condition|)
name|notebook_index
operator|+=
literal|1
expr_stmt|;
else|else
name|notebook_index
operator|+=
literal|2
expr_stmt|;
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|notebook_index
argument_list|)
expr_stmt|;
break|break;
case|case
name|MIGRATION_PAGE
case|:
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
operator|++
name|notebook_index
argument_list|)
expr_stmt|;
break|break;
case|case
name|TREE_PAGE
case|:
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
operator|++
name|notebook_index
argument_list|)
expr_stmt|;
comment|/*  Creating the directories can take some time on NFS, so inform        *  the user and set the buttons insensitive        */
name|gtk_dialog_set_response_sensitive
argument_list|(
name|GTK_DIALOG
argument_list|(
name|widget
argument_list|)
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_dialog_set_response_sensitive
argument_list|(
name|GTK_DIALOG
argument_list|(
name|widget
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|user_install_run
argument_list|()
condition|)
block|{
name|gtk_dialog_set_response_sensitive
argument_list|(
name|GTK_DIALOG
argument_list|(
name|widget
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Installation successful.  "
literal|"Click \"Continue\" to proceed."
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Installation failed.  "
literal|"Contact system administrator."
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|gtk_dialog_set_response_sensitive
argument_list|(
name|GTK_DIALOG
argument_list|(
name|widget
argument_list|)
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
name|LOG_PAGE
case|:
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
operator|++
name|notebook_index
argument_list|)
expr_stmt|;
name|user_install_tuning
argument_list|(
name|gimprc
argument_list|)
expr_stmt|;
break|break;
case|case
name|TUNING_PAGE
case|:
name|gimp_rc_save
argument_list|(
name|gimprc
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|title_style
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|page_style
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|user_install_dialog
argument_list|)
expr_stmt|;
name|gtk_main_quit
argument_list|()
expr_stmt|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|user_install_corner_expose (GtkWidget * widget,GdkEventExpose * eevent,gpointer data)
name|user_install_corner_expose
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|eevent
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkCornerType
name|corner
decl_stmt|;
comment|/* call default handler explicitly, then draw the corners */
if|if
condition|(
name|GTK_WIDGET_GET_CLASS
argument_list|(
name|widget
argument_list|)
operator|->
name|expose_event
condition|)
name|GTK_WIDGET_GET_CLASS
argument_list|(
name|widget
argument_list|)
operator|->
name|expose_event
argument_list|(
name|widget
argument_list|,
name|eevent
argument_list|)
expr_stmt|;
name|corner
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
name|gtk_widget_get_direction
argument_list|(
name|widget
argument_list|)
operator|==
name|GTK_TEXT_DIR_RTL
condition|)
block|{
switch|switch
condition|(
name|corner
condition|)
block|{
case|case
name|GTK_CORNER_TOP_LEFT
case|:
name|corner
operator|=
name|GTK_CORNER_TOP_RIGHT
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_LEFT
case|:
name|corner
operator|=
name|GTK_CORNER_BOTTOM_RIGHT
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_TOP_RIGHT
case|:
name|corner
operator|=
name|GTK_CORNER_TOP_LEFT
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_RIGHT
case|:
name|corner
operator|=
name|GTK_CORNER_BOTTOM_LEFT
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|corner
condition|)
block|{
case|case
name|GTK_CORNER_TOP_LEFT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|90
operator|*
literal|64
argument_list|,
literal|180
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_LEFT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|height
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|180
operator|*
literal|64
argument_list|,
literal|270
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_TOP_RIGHT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|width
argument_list|,
literal|0
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|0
operator|*
literal|64
argument_list|,
literal|90
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
case|case
name|GTK_CORNER_BOTTOM_RIGHT
case|:
name|gdk_draw_arc
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|white_gc
argument_list|,
name|TRUE
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|width
argument_list|,
operator|-
name|widget
operator|->
name|allocation
operator|.
name|height
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|width
operator|*
literal|2
argument_list|,
name|widget
operator|->
name|allocation
operator|.
name|height
operator|*
literal|2
argument_list|,
literal|270
operator|*
literal|64
argument_list|,
literal|360
operator|*
literal|64
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|user_install_notebook_append_page (GtkNotebook * notebook,gchar * title,gchar * footer,gint vbox_spacing)
name|user_install_notebook_append_page
parameter_list|(
name|GtkNotebook
modifier|*
name|notebook
parameter_list|,
name|gchar
modifier|*
name|title
parameter_list|,
name|gchar
modifier|*
name|footer
parameter_list|,
name|gint
name|vbox_spacing
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|page
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
name|vbox_spacing
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"title"
argument_list|,
name|title
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|page
argument_list|)
argument_list|,
literal|"footer"
argument_list|,
name|footer
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|notebook
argument_list|,
name|page
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page
argument_list|)
expr_stmt|;
return|return
name|page
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|add_label (GtkBox * box,gchar * text)
name|add_label
parameter_list|(
name|GtkBox
modifier|*
name|box
parameter_list|,
name|gchar
modifier|*
name|text
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_markup
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_label_set_line_wrap
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|box
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_sel_changed (GtkTreeSelection * sel,gpointer data)
name|user_install_sel_changed
parameter_list|(
name|GtkTreeSelection
modifier|*
name|sel
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkNotebook
modifier|*
name|notebook
init|=
name|GTK_NOTEBOOK
argument_list|(
name|data
argument_list|)
decl_stmt|;
name|GtkTreeModel
modifier|*
name|model
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|;
name|gint
name|index
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|gtk_tree_selection_get_selected
argument_list|(
name|sel
argument_list|,
operator|&
name|model
argument_list|,
operator|&
name|iter
argument_list|)
condition|)
name|gtk_tree_model_get
argument_list|(
name|model
argument_list|,
operator|&
name|iter
argument_list|,
name|DESC_COLUMN
argument_list|,
operator|&
name|index
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_notebook_set_current_page
argument_list|(
name|notebook
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_tv_fix_size_request (GtkWidget * widget,GtkAllocation * allocation)
name|user_install_tv_fix_size_request
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkAllocation
modifier|*
name|allocation
parameter_list|)
block|{
name|gtk_widget_set_size_request
argument_list|(
name|widget
argument_list|,
name|allocation
operator|->
name|width
argument_list|,
name|allocation
operator|->
name|height
argument_list|)
expr_stmt|;
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|widget
argument_list|,
name|user_install_tv_fix_size_request
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|user_install_dialog_run (const gchar * alternate_system_gimprc,const gchar * alternate_gimprc,gboolean verbose)
name|user_install_dialog_run
parameter_list|(
specifier|const
name|gchar
modifier|*
name|alternate_system_gimprc
parameter_list|,
specifier|const
name|gchar
modifier|*
name|alternate_gimprc
parameter_list|,
name|gboolean
name|verbose
parameter_list|)
block|{
name|GimpRc
modifier|*
name|gimprc
decl_stmt|;
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|ebox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|darea
decl_stmt|;
name|GtkWidget
modifier|*
name|page
decl_stmt|;
name|GtkWidget
modifier|*
name|sep
decl_stmt|;
name|GtkWidget
modifier|*
name|eek_box
decl_stmt|;
name|GdkPixbuf
modifier|*
name|wilber
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|gchar
modifier|*
name|version
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|oldgimp
operator|=
name|g_strdup
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
expr_stmt|;
comment|/*  FIXME  */
name|version
operator|=
name|strstr
argument_list|(
name|oldgimp
argument_list|,
literal|"2.2"
argument_list|)
expr_stmt|;
if|if
condition|(
name|version
condition|)
name|version
index|[
literal|2
index|]
operator|=
literal|'0'
expr_stmt|;
if|if
condition|(
operator|!
name|version
operator|||
operator|!
name|g_file_test
argument_list|(
name|oldgimp
argument_list|,
name|G_FILE_TEST_IS_DIR
argument_list|)
condition|)
block|{
name|g_free
argument_list|(
name|oldgimp
argument_list|)
expr_stmt|;
name|oldgimp
operator|=
name|NULL
expr_stmt|;
block|}
name|gimprc
operator|=
name|gimp_rc_new
argument_list|(
name|alternate_system_gimprc
argument_list|,
name|alternate_gimprc
argument_list|,
name|verbose
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|user_install_dialog
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"GIMP User Installation"
argument_list|)
argument_list|,
literal|"user_installation"
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|_
argument_list|(
literal|"Continue"
argument_list|)
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|dialog
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_response
argument_list|)
argument_list|,
name|gimprc
argument_list|)
expr_stmt|;
name|g_object_weak_ref
argument_list|(
name|G_OBJECT
argument_list|(
name|dialog
argument_list|)
argument_list|,
operator|(
name|GWeakNotify
operator|)
name|g_object_unref
argument_list|,
name|gimprc
argument_list|)
expr_stmt|;
name|eek_box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
operator|->
name|parent
argument_list|)
argument_list|,
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|eek_box
argument_list|)
argument_list|,
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|eek_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|eek_box
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"black"
argument_list|,
operator|&
name|black_color
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"white"
argument_list|,
operator|&
name|white_color
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"dark orange"
argument_list|,
operator|&
name|title_color
argument_list|)
expr_stmt|;
name|gtk_widget_realize
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
comment|/*  B/W Style for the page contents  */
name|page_style
operator|=
name|gtk_widget_get_modifier_style
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|page_style
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|page_style
operator|->
name|fg
index|[
name|i
index|]
operator|=
name|black_color
expr_stmt|;
name|page_style
operator|->
name|bg
index|[
name|i
index|]
operator|=
name|white_color
expr_stmt|;
name|page_style
operator|->
name|color_flags
index|[
name|i
index|]
operator|=
operator|(
name|GTK_RC_FG
operator||
name|GTK_RC_BG
operator|)
expr_stmt|;
block|}
name|page_style
operator|->
name|text
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|black_color
expr_stmt|;
name|page_style
operator|->
name|base
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|white_color
expr_stmt|;
name|page_style
operator|->
name|color_flags
index|[
name|GTK_STATE_NORMAL
index|]
operator||=
operator|(
name|GTK_RC_TEXT
operator||
name|GTK_RC_BASE
operator|)
expr_stmt|;
name|g_free
argument_list|(
name|page_style
operator|->
name|bg_pixmap_name
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|)
expr_stmt|;
name|page_style
operator|->
name|bg_pixmap_name
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|g_strdup
argument_list|(
literal|"<none>"
argument_list|)
expr_stmt|;
comment|/*  B/Colored Style for the page title  */
name|title_style
operator|=
name|gtk_rc_style_copy
argument_list|(
name|page_style
argument_list|)
expr_stmt|;
name|title_style
operator|->
name|bg
index|[
name|GTK_STATE_NORMAL
index|]
operator|=
name|title_color
expr_stmt|;
name|pango_font_description_free
argument_list|(
name|title_style
operator|->
name|font_desc
argument_list|)
expr_stmt|;
name|title_style
operator|->
name|font_desc
operator|=
name|pango_font_description_from_string
argument_list|(
literal|"sans 20"
argument_list|)
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|footer_label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|footer_label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_RIGHT
argument_list|)
expr_stmt|;
name|gtk_label_set_line_wrap
argument_list|(
name|GTK_LABEL
argument_list|(
name|footer_label
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|eek_box
argument_list|)
argument_list|,
name|footer_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|footer_label
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|ebox
argument_list|,
name|GDK_EXPOSURE_MASK
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|ebox
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|filename
operator|=
name|g_build_filename
argument_list|(
name|gimp_data_directory
argument_list|()
argument_list|,
literal|"images"
argument_list|,
literal|"wilber-wizard.png"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|wilber
operator|=
name|gdk_pixbuf_new_from_file
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|wilber
condition|)
block|{
name|title_image
operator|=
name|gtk_image_new_from_pixbuf
argument_list|(
name|wilber
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|wilber
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|title_image
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title_image
argument_list|)
expr_stmt|;
block|}
name|title_label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|title_label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|title_label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_label_set_line_wrap
argument_list|(
name|GTK_LABEL
argument_list|(
name|title_label
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|title_label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|title_label
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|ebox
argument_list|,
literal|16
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|ebox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|ebox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|ebox
argument_list|)
expr_stmt|;
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacing
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|ebox
argument_list|)
argument_list|,
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|darea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|darea
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|darea
argument_list|,
literal|"expose_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|GTK_CORNER_TOP_LEFT
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|darea
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|darea
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|TITLE_STYLE
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|darea
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|darea
argument_list|,
literal|"expose_event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_corner_expose
argument_list|)
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|GTK_CORNER_BOTTOM_LEFT
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|darea
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|darea
argument_list|)
expr_stmt|;
name|notebook
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_show_tabs
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_border
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|notebook
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/*  GPL_PAGE  */
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Welcome to\n"
literal|"The GIMP User Installation"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to enter "
literal|"the GIMP user installation."
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"<b>The GIMP - GNU Image Manipulation Program</b>\n"
literal|"Copyright (C) 1995-2004\n"
literal|"Spencer Kimball, Peter Mattis and the GIMP Development Team."
argument_list|)
argument_list|)
expr_stmt|;
name|sep
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|sep
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|sep
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This program is free software; you can redistribute it and/or modify "
literal|"it under the terms of the GNU General Public License as published by "
literal|"the Free Software Foundation; either version 2 of the License, or "
literal|"(at your option) any later version."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This program is distributed in the hope that it will be useful, "
literal|"but WITHOUT ANY WARRANTY; without even the implied warranty of "
literal|"MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. "
literal|"See the GNU General Public License for more details."
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"You should have received a copy of the GNU General Public License "
literal|"along with this program; if not, write to the Free Software "
literal|"Foundation, Inc., 59 Temple Place - Suite 330, Boston, "
literal|"MA 02111-1307, USA."
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  MIGRATION_PAGE  */
block|{
name|GtkWidget
modifier|*
name|box
decl_stmt|;
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Migrate User Settings"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to proceed "
literal|"with the user installation."
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|box
operator|=
name|gimp_int_radio_group_new
argument_list|(
name|TRUE
argument_list|,
name|_
argument_list|(
literal|"It seems you have a GIMP 2.0 installation."
argument_list|)
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_radio_button_update
argument_list|)
argument_list|,
operator|&
name|migrate
argument_list|,
name|migrate
argument_list|,
name|_
argument_list|(
literal|"_Migrate user settings"
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|,
name|_
argument_list|(
literal|"Do a _fresh user installation"
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|box
argument_list|)
expr_stmt|;
block|}
comment|/*  TREE_PAGE  */
block|{
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|scr
decl_stmt|;
name|GtkWidget
modifier|*
name|tv
decl_stmt|;
name|GdkPixbuf
modifier|*
name|file_pixbuf
decl_stmt|;
name|GdkPixbuf
modifier|*
name|folder_pixbuf
decl_stmt|;
name|GtkWidget
modifier|*
name|notebook2
decl_stmt|;
name|GtkWidget
modifier|*
name|page2
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|GtkTreeStore
modifier|*
name|tree
decl_stmt|;
name|GtkTreeViewColumn
modifier|*
name|column
decl_stmt|;
name|GtkCellRenderer
modifier|*
name|cell
decl_stmt|;
name|GtkTreeSelection
modifier|*
name|sel
decl_stmt|;
name|GtkTreeIter
name|iter
decl_stmt|,
name|child
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Personal GIMP Folder"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to create "
literal|"your personal GIMP folder."
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|tree
operator|=
name|gtk_tree_store_new
argument_list|(
name|NUM_COLUMNS
argument_list|,
name|G_TYPE_STRING
argument_list|,
name|GDK_TYPE_PIXBUF
argument_list|,
name|G_TYPE_INT
argument_list|)
expr_stmt|;
name|tv
operator|=
name|gtk_tree_view_new_with_model
argument_list|(
name|GTK_TREE_MODEL
argument_list|(
name|tree
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|tree
argument_list|)
expr_stmt|;
name|column
operator|=
name|gtk_tree_view_column_new
argument_list|()
expr_stmt|;
name|cell
operator|=
name|gtk_cell_renderer_pixbuf_new
argument_list|()
expr_stmt|;
name|gtk_tree_view_column_pack_start
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_tree_view_column_set_attributes
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
literal|"pixbuf"
argument_list|,
name|PIXBUF_COLUMN
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|cell
operator|=
name|gtk_cell_renderer_text_new
argument_list|()
expr_stmt|;
name|gtk_tree_view_column_pack_start
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_tree_view_column_set_attributes
argument_list|(
name|column
argument_list|,
name|cell
argument_list|,
literal|"text"
argument_list|,
name|DIRENT_COLUMN
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_view_append_column
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|gtk_tree_view_set_headers_visible
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|scr
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scr
argument_list|)
argument_list|,
name|GTK_POLICY_NEVER
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|scr
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scr
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scr
argument_list|)
argument_list|,
name|tv
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|tv
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"For a proper GIMP installation, a folder named "
literal|"'<b>%s</b>' needs to be created."
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"This folder will contain a number of important files.  "
literal|"Click on one of the files or folders in the tree "
literal|"to get more information about the selected item."
argument_list|)
argument_list|)
expr_stmt|;
name|notebook2
operator|=
name|gtk_notebook_new
argument_list|()
expr_stmt|;
name|gtk_notebook_set_show_tabs
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_notebook_set_show_border
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|notebook2
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|32
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|notebook2
argument_list|)
expr_stmt|;
comment|/*  empty page  */
name|page2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page2
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|page2
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|sel
operator|=
name|gtk_tree_view_get_selection
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|sel
argument_list|,
literal|"changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_sel_changed
argument_list|)
argument_list|,
name|notebook2
argument_list|)
expr_stmt|;
name|file_pixbuf
operator|=
name|gtk_widget_render_icon
argument_list|(
name|tv
argument_list|,
name|GTK_STOCK_NEW
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|folder_pixbuf
operator|=
name|gtk_widget_render_icon
argument_list|(
name|tv
argument_list|,
name|GTK_STOCK_OPEN
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_store_append
argument_list|(
name|tree
argument_list|,
operator|&
name|iter
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_tree_store_set
argument_list|(
name|tree
argument_list|,
operator|&
name|iter
argument_list|,
name|DIRENT_COLUMN
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
argument_list|,
name|PIXBUF_COLUMN
argument_list|,
name|folder_pixbuf
argument_list|,
name|DESC_COLUMN
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|tree_items
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|gchar
modifier|*
name|foo
decl_stmt|;
if|if
condition|(
operator|!
name|tree_items
index|[
name|i
index|]
operator|.
name|description
condition|)
continue|continue;
name|gtk_tree_store_append
argument_list|(
name|tree
argument_list|,
operator|&
name|child
argument_list|,
operator|&
name|iter
argument_list|)
expr_stmt|;
name|gtk_tree_store_set
argument_list|(
name|tree
argument_list|,
operator|&
name|child
argument_list|,
name|DIRENT_COLUMN
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|PIXBUF_COLUMN
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|directory
condition|?
name|folder_pixbuf
else|:
name|file_pixbuf
argument_list|,
name|DESC_COLUMN
argument_list|,
name|i
operator|+
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|page2
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|foo
operator|=
name|g_strdup_printf
argument_list|(
literal|"<b>%s</b>"
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_markup
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|foo
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|foo
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_label_set_line_wrap
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page2
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|gettext
argument_list|(
name|tree_items
index|[
name|i
index|]
operator|.
name|description
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_justify
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|GTK_JUSTIFY_LEFT
argument_list|)
expr_stmt|;
name|gtk_label_set_line_wrap
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|page2
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|page2
argument_list|)
expr_stmt|;
name|gtk_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook2
argument_list|)
argument_list|,
name|page2
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_tree_view_expand_all
argument_list|(
name|GTK_TREE_VIEW
argument_list|(
name|tv
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|tv
argument_list|,
literal|"size_allocate"
argument_list|,
name|G_CALLBACK
argument_list|(
name|user_install_tv_fix_size_request
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|file_pixbuf
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|folder_pixbuf
argument_list|)
expr_stmt|;
block|}
comment|/*  LOG_PAGE  */
name|page
operator|=
name|log_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"User Installation Log"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Please wait while your personal "
literal|"GIMP folder is being created..."
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  TUNING_PAGE  */
name|page
operator|=
name|tuning_page
operator|=
name|user_install_notebook_append_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP Performance Tuning"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Click \"Continue\" to accept the "
literal|"settings above."
argument_list|)
argument_list|,
literal|24
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|page
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"<b>For optimal GIMP performance, some settings may have to "
literal|"be adjusted.</b>"
argument_list|)
argument_list|)
expr_stmt|;
name|user_install_notebook_set_page
argument_list|(
name|GTK_NOTEBOOK
argument_list|(
name|notebook
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_main
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/*********************/
end_comment

begin_comment
comment|/*  Local functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|print_log (GtkWidget * view,GtkTextBuffer * buffer,GError * error)
name|print_log
parameter_list|(
name|GtkWidget
modifier|*
name|view
parameter_list|,
name|GtkTextBuffer
modifier|*
name|buffer
parameter_list|,
name|GError
modifier|*
name|error
parameter_list|)
block|{
name|GtkTextIter
name|cursor
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
decl_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|buffer
argument_list|,
name|error
condition|?
literal|"\n"
else|:
literal|" "
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_text_buffer_get_end_iter
argument_list|(
name|buffer
argument_list|,
operator|&
name|cursor
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gtk_widget_render_icon
argument_list|(
name|view
argument_list|,
name|error
condition|?
name|GIMP_STOCK_ERROR
else|:
name|GTK_STOCK_APPLY
argument_list|,
name|error
condition|?
name|GTK_ICON_SIZE_DIALOG
else|:
name|GTK_ICON_SIZE_MENU
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_pixbuf
argument_list|(
name|buffer
argument_list|,
operator|&
name|cursor
argument_list|,
name|pixbuf
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
block|{
name|gtk_text_buffer_insert
argument_list|(
name|buffer
argument_list|,
operator|&
name|cursor
argument_list|,
literal|"\n"
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_with_tags_by_name
argument_list|(
name|buffer
argument_list|,
operator|&
name|cursor
argument_list|,
name|error
operator|->
name|message
argument_list|,
operator|-
literal|1
argument_list|,
literal|"bold"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|gtk_text_buffer_insert
argument_list|(
name|buffer
argument_list|,
operator|&
name|cursor
argument_list|,
literal|"\n"
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|user_install_run (void)
name|user_install_run
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|scrolled_window
decl_stmt|;
name|GtkTextBuffer
modifier|*
name|log_buffer
decl_stmt|;
name|GtkWidget
modifier|*
name|log_view
decl_stmt|;
name|GError
modifier|*
name|error
init|=
name|NULL
decl_stmt|;
name|gchar
name|dest
index|[
literal|1024
index|]
decl_stmt|;
name|gchar
name|source
index|[
literal|1024
index|]
decl_stmt|;
name|gchar
name|log_line
index|[
literal|1024
index|]
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|scrolled_window
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|log_page
argument_list|)
argument_list|,
name|scrolled_window
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_window
argument_list|)
expr_stmt|;
name|log_buffer
operator|=
name|gtk_text_buffer_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_text_buffer_create_tag
argument_list|(
name|log_buffer
argument_list|,
literal|"bold"
argument_list|,
literal|"weight"
argument_list|,
name|PANGO_WEIGHT_BOLD
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|log_view
operator|=
name|gtk_text_view_new_with_buffer
argument_list|(
name|log_buffer
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|log_buffer
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|log_view
argument_list|)
expr_stmt|;
name|gtk_text_view_set_editable
argument_list|(
name|GTK_TEXT_VIEW
argument_list|(
name|log_view
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|log_view
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|log_view
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|log_line
argument_list|,
sizeof|sizeof
argument_list|(
name|log_line
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Creating folder '%s'..."
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|log_line
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
if|if
condition|(
name|mkdir
argument_list|(
name|gimp_directory
argument_list|()
argument_list|,
name|S_IRUSR
operator||
name|S_IWUSR
operator||
name|S_IXUSR
operator||
name|S_IRGRP
operator||
name|S_IXGRP
operator||
name|S_IROTH
operator||
name|S_IXOTH
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|g_set_error
argument_list|(
operator|&
name|error
argument_list|,
name|G_FILE_ERROR
argument_list|,
name|g_file_error_from_errno
argument_list|(
name|errno
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Cannot create folder '%s': %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|gimp_directory
argument_list|()
argument_list|)
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|break_out_of_loop
goto|;
block|}
name|print_log
argument_list|(
name|log_view
argument_list|,
name|log_buffer
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|tree_items
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|g_snprintf
argument_list|(
name|dest
argument_list|,
sizeof|sizeof
argument_list|(
name|dest
argument_list|)
argument_list|,
literal|"%s%c%s"
argument_list|,
name|gimp_directory
argument_list|()
argument_list|,
name|G_DIR_SEPARATOR
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|tree_items
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|TREE_ITEM_DO_NOTHING
case|:
break|break;
case|case
name|TREE_ITEM_MKDIR
case|:
name|g_snprintf
argument_list|(
name|log_line
argument_list|,
sizeof|sizeof
argument_list|(
name|log_line
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Creating folder '%s'..."
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|dest
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|log_line
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
if|if
condition|(
name|mkdir
argument_list|(
name|dest
argument_list|,
name|S_IRUSR
operator||
name|S_IWUSR
operator||
name|S_IXUSR
operator||
name|S_IRGRP
operator||
name|S_IXGRP
operator||
name|S_IROTH
operator||
name|S_IXOTH
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|g_set_error
argument_list|(
operator|&
name|error
argument_list|,
name|G_FILE_ERROR
argument_list|,
name|g_file_error_from_errno
argument_list|(
name|errno
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Cannot create folder '%s': %s"
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|dest
argument_list|)
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
expr_stmt|;
goto|goto
name|break_out_of_loop
goto|;
block|}
break|break;
case|case
name|TREE_ITEM_FROM_SYSCONF_DIR
case|:
name|g_snprintf
argument_list|(
name|source
argument_list|,
sizeof|sizeof
argument_list|(
name|source
argument_list|)
argument_list|,
literal|"%s%c%s"
argument_list|,
name|gimp_sysconf_directory
argument_list|()
argument_list|,
name|G_DIR_SEPARATOR
argument_list|,
name|tree_items
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
operator|!
name|tree_items
index|[
name|i
index|]
operator|.
name|directory
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|log_line
argument_list|,
sizeof|sizeof
argument_list|(
name|log_line
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Copying file '%s' from '%s'..."
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|dest
argument_list|)
argument_list|,
name|gimp_filename_to_utf8
argument_list|(
name|source
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_text_buffer_insert_at_cursor
argument_list|(
name|log_buffer
argument_list|,
name|log_line
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
while|while
condition|(
name|gtk_events_pending
argument_list|()
condition|)
name|gtk_main_iteration
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_config_file_copy
argument_list|(
name|source
argument_list|,
name|dest
argument_list|,
operator|&
name|error
argument_list|)
condition|)
goto|goto
name|break_out_of_loop
goto|;
break|break;
default|default:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|tree_items
index|[
name|i
index|]
operator|.
name|type
operator|!=
name|TREE_ITEM_DO_NOTHING
condition|)
name|print_log
argument_list|(
name|log_view
argument_list|,
name|log_buffer
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|break_out_of_loop
label|:
if|if
condition|(
name|error
condition|)
block|{
name|print_log
argument_list|(
name|log_view
argument_list|,
name|log_buffer
argument_list|,
name|error
argument_list|)
expr_stmt|;
name|g_clear_error
argument_list|(
operator|&
name|error
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|user_install_tuning (GimpRc * gimprc)
name|user_install_tuning
parameter_list|(
name|GimpRc
modifier|*
name|gimprc
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|entry
decl_stmt|;
comment|/*  tile cache size  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"GIMP uses a limited amount of memory to store image data, "
literal|"the so-called \"Tile Cache\".  You should adjust its size "
literal|"to fit into memory.  Consider the amount of memory used by "
literal|"other running processes."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gimp_prop_memsize_entry_new
argument_list|(
name|G_OBJECT
argument_list|(
name|gimprc
argument_list|)
argument_list|,
literal|"tile-cache-size"
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Tile cache size:"
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/*  swap file location  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|tuning_page
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|add_label
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"All image and undo data which doesn't fit into the Tile Cache "
literal|"will be written to a swap file.  This file should be located "
literal|"on a local filesystem with enough free space (several hundred "
literal|"MB). On a UNIX system, you may want to use the system-wide "
literal|"temp-dir (\"/tmp\" or \"/var/tmp\")."
argument_list|)
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|entry
operator|=
name|gimp_prop_file_entry_new
argument_list|(
name|G_OBJECT
argument_list|(
name|gimprc
argument_list|)
argument_list|,
literal|"swap-path"
argument_list|,
name|_
argument_list|(
literal|"Select swap dir"
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|entry
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|entry
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Swap folder:"
argument_list|)
argument_list|)
expr_stmt|;
name|PAGE_STYLE
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

