begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"airbrush_blob.h"
end_include

begin_include
include|#
directive|include
file|"drawable.h"
end_include

begin_include
include|#
directive|include
file|"draw_core.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimage_mask.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"gimpui.h"
end_include

begin_include
include|#
directive|include
file|"paint_options.h"
end_include

begin_include
include|#
directive|include
file|"tools.h"
end_include

begin_include
include|#
directive|include
file|"undo.h"
end_include

begin_include
include|#
directive|include
file|"xinput_airbrush.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"tile.h"
end_include

begin_comment
comment|/* ick. */
end_comment

begin_define
DECL|macro|SUBSAMPLE
define|#
directive|define
name|SUBSAMPLE
value|8
end_define

begin_define
DECL|macro|DIST_SMOOTHER_BUFFER
define|#
directive|define
name|DIST_SMOOTHER_BUFFER
value|10
end_define

begin_define
DECL|macro|TIME_SMOOTHER_BUFFER
define|#
directive|define
name|TIME_SMOOTHER_BUFFER
value|10
end_define

begin_comment
comment|/*  the XinputAirbrush structures  */
end_comment

begin_typedef
DECL|typedef|XinputAirbrushTool
typedef|typedef
name|struct
name|_XinputAirbrushTool
name|XinputAirbrushTool
typedef|;
end_typedef

begin_struct
DECL|struct|_XinputAirbrushTool
struct|struct
name|_XinputAirbrushTool
block|{
DECL|member|core
name|DrawCore
modifier|*
name|core
decl_stmt|;
comment|/*  Core select object             */
DECL|member|last_airbrush
name|AirBrush
modifier|*
name|last_airbrush
decl_stmt|;
DECL|member|last_airbrush_blob
name|AirBrushBlob
modifier|*
name|last_airbrush_blob
decl_stmt|;
comment|/*  airbrush_blob for last cursor position  */
DECL|member|last_airblob
name|AirBlob
modifier|*
name|last_airblob
decl_stmt|;
DECL|member|x1
DECL|member|y1
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|;
comment|/*  image space coordinate         */
DECL|member|x2
DECL|member|y2
name|int
name|x2
decl_stmt|,
name|y2
decl_stmt|;
comment|/*  image space coords             */
comment|/* circular distance history buffer */
DECL|member|dt_buffer
name|gdouble
name|dt_buffer
index|[
name|DIST_SMOOTHER_BUFFER
index|]
decl_stmt|;
DECL|member|dt_index
name|gint
name|dt_index
decl_stmt|;
comment|/* circular timing history buffer */
DECL|member|ts_buffer
name|guint32
name|ts_buffer
index|[
name|TIME_SMOOTHER_BUFFER
index|]
decl_stmt|;
DECL|member|ts_index
name|gint
name|ts_index
decl_stmt|;
comment|/* Direction and center point */
DECL|member|xcenter
DECL|member|ycenter
name|double
name|xcenter
decl_stmt|,
name|ycenter
decl_stmt|;
DECL|member|direction_abs
name|double
name|direction_abs
decl_stmt|;
DECL|member|direction
name|double
name|direction
decl_stmt|;
DECL|member|c_direction
name|double
name|c_direction
decl_stmt|;
DECL|member|c_direction_abs
name|double
name|c_direction_abs
decl_stmt|;
DECL|member|last_time
name|gdouble
name|last_time
decl_stmt|;
comment|/*  previous time of a motion event      */
DECL|member|lastx
DECL|member|lasty
name|gdouble
name|lastx
decl_stmt|,
name|lasty
decl_stmt|;
comment|/*  previous position of a motion event  */
DECL|member|last_lastx
DECL|member|last_lasty
name|gdouble
name|last_lastx
decl_stmt|,
name|last_lasty
decl_stmt|;
comment|/* The previous previous position of a motion event i.e pos of the blob */
DECL|member|init_velocity
name|gboolean
name|init_velocity
decl_stmt|;
DECL|member|init_prepre
name|gboolean
name|init_prepre
decl_stmt|;
DECL|member|last_value
name|double
name|last_value
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|XinputAirbrushOptions
typedef|typedef
name|struct
name|_XinputAirbrushOptions
name|XinputAirbrushOptions
typedef|;
end_typedef

begin_struct
DECL|struct|_XinputAirbrushOptions
struct|struct
name|_XinputAirbrushOptions
block|{
DECL|member|paint_options
name|PaintOptions
name|paint_options
decl_stmt|;
DECL|member|flow
name|double
name|flow
decl_stmt|;
DECL|member|flow_d
name|double
name|flow_d
decl_stmt|;
DECL|member|flow_w
name|GtkObject
modifier|*
name|flow_w
decl_stmt|;
DECL|member|sensitivity
name|double
name|sensitivity
decl_stmt|;
DECL|member|sensitivity_d
name|double
name|sensitivity_d
decl_stmt|;
DECL|member|sensitivity_w
name|GtkObject
modifier|*
name|sensitivity_w
decl_stmt|;
DECL|member|starttilt
name|double
name|starttilt
decl_stmt|;
DECL|member|starttilt_d
name|double
name|starttilt_d
decl_stmt|;
DECL|member|starttilt_w
name|GtkObject
modifier|*
name|starttilt_w
decl_stmt|;
DECL|member|vel_sensitivity
name|double
name|vel_sensitivity
decl_stmt|;
DECL|member|vel_sensitivity_d
name|double
name|vel_sensitivity_d
decl_stmt|;
DECL|member|vel_sensitivity_w
name|GtkObject
modifier|*
name|vel_sensitivity_w
decl_stmt|;
DECL|member|tilt_sensitivity
name|double
name|tilt_sensitivity
decl_stmt|;
DECL|member|tilt_sensitivity_d
name|double
name|tilt_sensitivity_d
decl_stmt|;
DECL|member|tilt_sensitivity_w
name|GtkObject
modifier|*
name|tilt_sensitivity_w
decl_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
DECL|member|minheight
name|double
name|minheight
decl_stmt|;
DECL|member|minheight_d
name|double
name|minheight_d
decl_stmt|;
DECL|member|minheight_w
name|GtkObject
modifier|*
name|minheight_w
decl_stmt|;
DECL|member|maxheight
name|double
name|maxheight
decl_stmt|;
DECL|member|maxheight_d
name|double
name|maxheight_d
decl_stmt|;
DECL|member|maxheight_w
name|GtkObject
modifier|*
name|maxheight_w
decl_stmt|;
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
DECL|member|height
name|double
name|height
decl_stmt|;
DECL|member|height_d
name|double
name|height_d
decl_stmt|;
DECL|member|height_w
name|GtkObject
modifier|*
name|height_w
decl_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
block|}
struct|;
end_struct

begin_comment
comment|/* the xinput_airbrush tool options  */
end_comment

begin_decl_stmt
DECL|variable|xinput_airbrush_options
specifier|static
name|XinputAirbrushOptions
modifier|*
name|xinput_airbrush_options
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* local variables */
end_comment

begin_comment
comment|/*  undo blocks variables  */
end_comment

begin_decl_stmt
DECL|variable|undo_tiles
specifier|static
name|TileManager
modifier|*
name|undo_tiles
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Tiles used to render the stroke at 1 byte/pp */
end_comment

begin_decl_stmt
DECL|variable|canvas_tiles
specifier|static
name|TileManager
modifier|*
name|canvas_tiles
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* Flat buffer that is used to used to render the dirty region  * for composition onto the destination drawable  */
end_comment

begin_decl_stmt
DECL|variable|canvas_buf
specifier|static
name|TempBuf
modifier|*
name|canvas_buf
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_button_press
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_button_release
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventButton
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_motion
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventMotion
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_cursor_update
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|GdkEventMotion
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_control
parameter_list|(
name|Tool
modifier|*
parameter_list|,
name|ToolAction
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|time_smoother_add
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|guint32
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gdouble
name|time_smoother_result
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|time_smoother_init
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|guint32
name|initval
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dist_smoother_add
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|gdouble
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gdouble
name|dist_smoother_result
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|dist_smoother_init
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|gdouble
name|initval
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_init
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_finish
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|tool_id
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_cleanup
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*Mask functions*/
end_comment

begin_function_decl
specifier|static
name|void
name|calc_angle
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|,
name|double
name|xcenter
parameter_list|,
name|double
name|ycenter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_width
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|render_airbrush_line
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|,
name|guchar
modifier|*
name|dest
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|make_single_mask
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|,
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|MaskBuf
modifier|*
name|dest
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|make_stroke
parameter_list|(
name|AirBlob
modifier|*
name|airblob
parameter_list|,
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|guint
name|last_value
parameter_list|,
name|guint
name|present_value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|make_mask
parameter_list|(
name|AirLine
modifier|*
name|airline
parameter_list|,
name|MaskBuf
modifier|*
name|brush_mask
parameter_list|,
name|guint
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|print_mask
parameter_list|(
name|MaskBuf
modifier|*
name|dest
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  Rendering functions  */
end_comment

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_set_paint_area
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_paste
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|MaskBuf
modifier|*
name|brush_mask
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_to_canvas_tiles
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|MaskBuf
modifier|*
name|brush_mask
parameter_list|,
name|int
name|brush_opacity
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_canvas_tiles_to_canvas_buf
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_set_undo_tiles
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|xinput_airbrush_set_canvas_tiles
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Start of functions */
end_comment

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_options_reset (void)
name|xinput_airbrush_options_reset
parameter_list|(
name|void
parameter_list|)
block|{
name|XinputAirbrushOptions
modifier|*
name|options
init|=
name|xinput_airbrush_options
decl_stmt|;
name|paint_options_reset
argument_list|(
operator|(
name|PaintOptions
operator|*
operator|)
name|options
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|flow_w
argument_list|)
argument_list|,
name|options
operator|->
name|flow_d
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|sensitivity_w
argument_list|)
argument_list|,
name|options
operator|->
name|sensitivity_d
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|starttilt_w
argument_list|)
argument_list|,
name|options
operator|->
name|starttilt_d
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|tilt_sensitivity_w
argument_list|)
argument_list|,
name|options
operator|->
name|tilt_sensitivity_d
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|vel_sensitivity_w
argument_list|)
argument_list|,
name|options
operator|->
name|vel_sensitivity_d
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|minheight_w
argument_list|)
argument_list|,
name|options
operator|->
name|minheight_d
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|maxheight_w
argument_list|)
argument_list|,
name|options
operator|->
name|maxheight_d
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
name|gtk_adjustment_set_value
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|height_w
argument_list|)
argument_list|,
name|options
operator|->
name|height_d
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
block|}
end_function

begin_function
specifier|static
name|XinputAirbrushOptions
modifier|*
DECL|function|xinput_airbrush_options_new (void)
name|xinput_airbrush_options_new
parameter_list|(
name|void
parameter_list|)
block|{
name|XinputAirbrushOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|abox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|slider
decl_stmt|;
comment|/*  the new xinput_airbrush tool options structure  */
name|options
operator|=
operator|(
name|XinputAirbrushOptions
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|XinputAirbrushOptions
argument_list|)
argument_list|)
expr_stmt|;
name|paint_options_init
argument_list|(
operator|(
name|PaintOptions
operator|*
operator|)
name|options
argument_list|,
name|XINPUT_AIRBRUSH
argument_list|,
name|xinput_airbrush_options_reset
argument_list|)
expr_stmt|;
name|options
operator|->
name|flow
operator|=
name|options
operator|->
name|flow_d
operator|=
literal|100
expr_stmt|;
name|options
operator|->
name|sensitivity
operator|=
name|options
operator|->
name|sensitivity_d
operator|=
literal|1.0
expr_stmt|;
name|options
operator|->
name|starttilt
operator|=
name|options
operator|->
name|starttilt_d
operator|=
literal|90
expr_stmt|;
name|options
operator|->
name|vel_sensitivity
operator|=
name|options
operator|->
name|vel_sensitivity_d
operator|=
literal|0.8
expr_stmt|;
name|options
operator|->
name|tilt_sensitivity
operator|=
name|options
operator|->
name|tilt_sensitivity_d
operator|=
literal|0.4
expr_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|options
operator|->
name|minheight
operator|=
name|options
operator|->
name|minheight_d
operator|=
literal|25.0
expr_stmt|;
name|options
operator|->
name|maxheight
operator|=
name|options
operator|->
name|maxheight_d
operator|=
literal|50.0
expr_stmt|;
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
name|options
operator|->
name|height
operator|=
name|options
operator|->
name|height_d
operator|=
literal|45.0
expr_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
comment|/*the main table*/
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|6
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
operator|(
operator|(
name|ToolOptions
operator|*
operator|)
name|options
operator|)
operator|->
name|main_vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*flow slider*/
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Flow Relation:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|flow_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|flow_d
argument_list|,
literal|50.0
argument_list|,
literal|201.0
argument_list|,
literal|1.0
argument_list|,
literal|10.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|flow_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|flow_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|flow
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*flow sens slider*/
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Flow Sensitivity:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|sensitivity_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|sensitivity_d
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|sensitivity_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|sensitivity_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|sensitivity
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
comment|/*base tilt slider*/
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Base Tilt:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|starttilt_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|starttilt_d
argument_list|,
literal|30.0
argument_list|,
literal|91.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|starttilt_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|starttilt_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|starttilt
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*tilt sens slider*/
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Tilt Sensitivity:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|abox
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|abox
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|4
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|abox
argument_list|)
expr_stmt|;
name|options
operator|->
name|tilt_sensitivity_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|tilt_sensitivity_d
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|tilt_sensitivity_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|abox
argument_list|)
argument_list|,
name|slider
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|tilt_sensitivity_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|tilt_sensitivity
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
comment|/*velocity sens slider*/
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Speed Sensitivity:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|abox
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|abox
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|5
argument_list|,
literal|6
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|abox
argument_list|)
expr_stmt|;
name|options
operator|->
name|vel_sensitivity_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|vel_sensitivity_d
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
literal|0.01
argument_list|,
literal|0.1
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|vel_sensitivity_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|abox
argument_list|)
argument_list|,
name|slider
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|vel_sensitivity_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|vel_sensitivity
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
comment|/*min height slider*/
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Min Height:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|minheight_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|minheight_d
argument_list|,
literal|25.0
argument_list|,
literal|41.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|minheight_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|minheight_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|minheight
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*max height slider*/
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Max Height:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|9
argument_list|,
literal|10
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|maxheight_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|maxheight_d
argument_list|,
literal|41.0
argument_list|,
literal|81.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|maxheight_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|9
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|maxheight_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|maxheight
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Height:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|height_w
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|height_d
argument_list|,
literal|25.0
argument_list|,
literal|81.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|slider
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|options
operator|->
name|height_w
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|slider
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|7
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|slider
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|height_w
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gimp_double_adjustment_update
argument_list|)
argument_list|,
operator|&
name|options
operator|->
name|height
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|slider
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|slider
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
name|gtk_widget_show_all
argument_list|(
name|table
argument_list|)
expr_stmt|;
return|return
name|options
return|;
block|}
end_function

begin_function
specifier|static
name|AirBlob
modifier|*
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
DECL|function|xinput_airbrush_pen_ellipse (XinputAirbrushTool * xinput_airbrush_tool,gdouble x_center,gdouble y_center,gdouble pressure,gdouble xtiltv,gdouble ytiltv,gdouble wheel)
name|xinput_airbrush_pen_ellipse
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|gdouble
name|x_center
parameter_list|,
name|gdouble
name|y_center
parameter_list|,
name|gdouble
name|pressure
parameter_list|,
name|gdouble
name|xtiltv
parameter_list|,
name|gdouble
name|ytiltv
parameter_list|,
name|gdouble
name|wheel
parameter_list|)
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
function|xinput_airbrush_pen_ellipse
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|gdouble
name|x_center
parameter_list|,
name|gdouble
name|y_center
parameter_list|,
name|gdouble
name|pressure
parameter_list|,
name|gdouble
name|xtiltv
parameter_list|,
name|gdouble
name|ytiltv
parameter_list|)
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
block|{
name|gdouble
name|xtilt
decl_stmt|,
name|ytilt
decl_stmt|;
name|double
name|height
decl_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|double
name|inter_height
decl_stmt|;
name|double
name|min_height
decl_stmt|;
name|double
name|max_height
decl_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
name|double
name|tanx
decl_stmt|,
name|tany
decl_stmt|;
name|double
name|tanytop
decl_stmt|,
name|tanxright
decl_stmt|,
name|tanybot
decl_stmt|,
name|tanxleft
decl_stmt|;
name|double
name|sprayangle
decl_stmt|;
name|double
name|distx
decl_stmt|,
name|disty
decl_stmt|;
name|double
name|ytop
decl_stmt|,
name|xright
decl_stmt|,
name|ybot
decl_stmt|,
name|xleft
decl_stmt|;
comment|/* Virtual height over the drawing */
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|min_height
operator|=
name|xinput_airbrush_options
operator|->
name|minheight
expr_stmt|;
name|max_height
operator|=
name|xinput_airbrush_options
operator|->
name|maxheight
expr_stmt|;
name|inter_height
operator|=
name|CLAMP
argument_list|(
name|wheel
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
operator|*
operator|(
name|max_height
operator|-
name|min_height
operator|)
expr_stmt|;
name|height
operator|=
name|min_height
operator|+
name|inter_height
expr_stmt|;
comment|/*       printf("Height: %f\n", height);     */
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
name|height
operator|=
name|xinput_airbrush_options
operator|->
name|height
expr_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
comment|/*        Fix av tilt negative when it should be positive       Also a clamp of to big tilts compared to the height       i.e you will not get big brushes      */
name|xtilt
operator|=
name|xtiltv
operator|*
operator|-
literal|1.0
operator|*
operator|(
literal|1
operator|-
operator|(
operator|(
literal|0.5
operator|*
operator|(
name|height
operator|-
literal|15
operator|)
operator|)
operator|/
literal|100
operator|)
operator|)
expr_stmt|;
name|ytilt
operator|=
name|ytiltv
operator|*
operator|-
literal|1.0
operator|*
operator|(
literal|1
operator|-
operator|(
operator|(
literal|0.5
operator|*
operator|(
name|height
operator|-
literal|15
operator|)
operator|)
operator|/
literal|100
operator|)
operator|)
expr_stmt|;
comment|/* The airflow controls the spray angel         High airflow renders in a big spray angel        but if the inkflow is low the blob will be         very thin.     */
name|sprayangle
operator|=
name|G_PI
operator|/
literal|6
operator|*
operator|(
name|xinput_airbrush_options
operator|->
name|flow
operator|/
literal|100.0
operator|)
operator|*
name|MAX
argument_list|(
name|pressure
argument_list|,
literal|0.1
argument_list|)
expr_stmt|;
name|sprayangle
operator|=
name|MAX
argument_list|(
name|sprayangle
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
comment|/*printf("Angle: %f\n", sprayangle);*/
comment|/*Tan of x and y tilt plus spray angles x r/l and y t/b tan*/
name|tanx
operator|=
name|tan
argument_list|(
name|xtilt
operator|*
name|G_PI
operator|/
literal|2.0
argument_list|)
expr_stmt|;
name|tany
operator|=
name|tan
argument_list|(
name|ytilt
operator|*
name|G_PI
operator|/
literal|2.0
argument_list|)
expr_stmt|;
name|tanytop
operator|=
name|tan
argument_list|(
operator|(
name|ytilt
operator|*
name|G_PI
operator|/
literal|2.0
operator|)
operator|+
operator|(
name|sprayangle
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
name|tanxright
operator|=
name|tan
argument_list|(
operator|(
name|xtilt
operator|*
name|G_PI
operator|/
literal|2.0
operator|)
operator|+
operator|(
name|sprayangle
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
name|tanybot
operator|=
name|tan
argument_list|(
operator|(
name|ytilt
operator|*
name|G_PI
operator|/
literal|2.0
operator|)
operator|-
operator|(
name|sprayangle
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
name|tanxleft
operator|=
name|tan
argument_list|(
operator|(
name|xtilt
operator|*
name|G_PI
operator|/
literal|2.0
operator|)
operator|-
operator|(
name|sprayangle
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|/* Offset from cursor due to tilt in x and y  depening on the hight*/
name|distx
operator|=
name|tanx
operator|*
name|height
expr_stmt|;
name|disty
operator|=
name|tany
operator|*
name|height
expr_stmt|;
comment|/* Offset from center of blob in all for axies */
name|ytop
operator|=
name|fabs
argument_list|(
name|fabs
argument_list|(
name|tanytop
operator|*
name|height
argument_list|)
operator|-
name|fabs
argument_list|(
name|disty
argument_list|)
argument_list|)
expr_stmt|;
name|xright
operator|=
name|fabs
argument_list|(
name|fabs
argument_list|(
name|tanxright
operator|*
name|height
argument_list|)
operator|-
name|fabs
argument_list|(
name|distx
argument_list|)
argument_list|)
expr_stmt|;
name|ybot
operator|=
name|fabs
argument_list|(
name|fabs
argument_list|(
name|tanybot
operator|*
name|height
argument_list|)
operator|-
name|fabs
argument_list|(
name|disty
argument_list|)
argument_list|)
expr_stmt|;
name|xleft
operator|=
name|fabs
argument_list|(
name|fabs
argument_list|(
name|tanxleft
operator|*
name|height
argument_list|)
operator|-
name|fabs
argument_list|(
name|distx
argument_list|)
argument_list|)
expr_stmt|;
name|x_center
operator|=
name|x_center
operator|+
name|distx
expr_stmt|;
name|y_center
operator|=
name|y_center
operator|+
name|disty
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|xcenter
operator|=
name|x_center
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|ycenter
operator|=
name|y_center
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|direction_abs
operator|=
name|atan2
argument_list|(
name|ytiltv
argument_list|,
name|xtiltv
argument_list|)
operator|+
name|G_PI
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|direction
operator|=
name|atan
argument_list|(
name|ytiltv
operator|/
name|xtiltv
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|c_direction
operator|=
name|atan
argument_list|(
name|ytiltv
operator|/
name|xtilt
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|c_direction_abs
operator|=
name|atan2
argument_list|(
name|ytiltv
argument_list|,
name|xtilt
argument_list|)
operator|+
name|G_PI
expr_stmt|;
return|return
name|create_air_blob
argument_list|(
name|x_center
operator|*
name|SUBSAMPLE
argument_list|,
name|y_center
operator|*
name|SUBSAMPLE
argument_list|,
literal|0.
argument_list|,
name|ytop
operator|*
name|SUBSAMPLE
argument_list|,
name|xright
operator|*
name|SUBSAMPLE
argument_list|,
literal|0.
argument_list|,
literal|0.
argument_list|,
name|ybot
operator|*
name|SUBSAMPLE
argument_list|,
name|xleft
operator|*
name|SUBSAMPLE
argument_list|,
literal|0.
argument_list|,
operator|(
name|xinput_airbrush_tool
operator|->
name|c_direction_abs
operator|-
name|G_PI
operator|)
argument_list|,
name|xinput_airbrush_tool
operator|->
name|c_direction
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_button_press (Tool * tool,GdkEventButton * bevent,gpointer gdisp_ptr)
name|xinput_airbrush_button_press
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|gdouble
name|x
decl_stmt|,
name|y
decl_stmt|;
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|AirBlob
modifier|*
name|airblob
decl_stmt|;
name|AirLine
modifier|*
name|airline
decl_stmt|;
name|MaskBuf
modifier|*
name|brush_mask
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|int
name|x_min
decl_stmt|,
name|y_min
decl_stmt|;
name|guint
name|value
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|xinput_airbrush_tool
operator|=
operator|(
name|XinputAirbrushTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
comment|/*  Keep the coordinates of the target  */
name|gdisplay_untransform_coords_f
argument_list|(
name|gdisp
argument_list|,
name|bevent
operator|->
name|x
argument_list|,
name|bevent
operator|->
name|y
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|xinput_airbrush_init
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|drawable
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|tool
operator|->
name|state
operator|=
name|ACTIVE
expr_stmt|;
name|tool
operator|->
name|gdisp_ptr
operator|=
name|gdisp_ptr
expr_stmt|;
name|tool
operator|->
name|paused_count
operator|=
literal|0
expr_stmt|;
comment|/*  pause the current selection and grab the pointer  */
name|gdisplays_selection_visibility
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|,
name|SelectionPause
argument_list|)
expr_stmt|;
comment|/* add motion memory if you press mod1 first ^ perfectmouse */
if|if
condition|(
operator|(
operator|(
name|bevent
operator|->
name|state
operator|&
name|GDK_MOD1_MASK
operator|)
operator|!=
literal|0
operator|)
operator|!=
operator|(
name|perfectmouse
operator|!=
literal|0
operator|)
condition|)
name|gdk_pointer_grab
argument_list|(
name|gdisp
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|FALSE
argument_list|,
name|GDK_BUTTON1_MOTION_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
else|else
name|gdk_pointer_grab
argument_list|(
name|gdisp
operator|->
name|canvas
operator|->
name|window
argument_list|,
name|FALSE
argument_list|,
name|GDK_POINTER_MOTION_HINT_MASK
operator||
name|GDK_BUTTON1_MOTION_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
name|tool
operator|->
name|gdisp_ptr
operator|=
name|gdisp_ptr
expr_stmt|;
name|tool
operator|->
name|state
operator|=
name|ACTIVE
expr_stmt|;
comment|/* Get the AirBlob from xinput_airbrush_pen_ellipse */
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|airblob
operator|=
name|xinput_airbrush_pen_ellipse
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|bevent
operator|->
name|pressure
argument_list|,
name|bevent
operator|->
name|xtilt
argument_list|,
name|bevent
operator|->
name|ytilt
argument_list|,
name|bevent
operator|->
name|wheel
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
name|airblob
operator|=
name|xinput_airbrush_pen_ellipse
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|bevent
operator|->
name|pressure
argument_list|,
name|bevent
operator|->
name|xtilt
argument_list|,
name|bevent
operator|->
name|ytilt
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
comment|/* Make the AirBlob mask */
name|value
operator|=
literal|256
operator|*
name|bevent
operator|->
name|pressure
expr_stmt|;
name|airline
operator|=
name|create_air_line
argument_list|(
name|airblob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|airline
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|airline
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|airline
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|airline
operator|->
name|height
expr_stmt|;
name|brush_mask
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|make_mask
argument_list|(
name|airline
argument_list|,
name|brush_mask
argument_list|,
name|value
argument_list|)
expr_stmt|;
comment|/*print_mask(brush_mask);*/
comment|/*Paint the mask on the drawable*/
name|xinput_airbrush_paste
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|drawable
argument_list|,
name|brush_mask
argument_list|,
name|x_min
argument_list|,
name|y_min
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/*Prepare for next stroke*/
name|xinput_airbrush_tool
operator|->
name|last_airblob
operator|=
name|airblob
expr_stmt|;
name|time_smoother_init
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|last_time
operator|=
name|bevent
operator|->
name|time
expr_stmt|;
name|dist_smoother_init
argument_list|(
name|xinput_airbrush_tool
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|init_velocity
operator|=
name|TRUE
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|init_prepre
operator|=
name|FALSE
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|lastx
operator|=
name|xinput_airbrush_tool
operator|->
name|xcenter
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|lasty
operator|=
name|xinput_airbrush_tool
operator|->
name|ycenter
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|last_value
operator|=
name|value
expr_stmt|;
comment|/*Free the maks_buf and airline*/
name|mask_buf_free
argument_list|(
name|brush_mask
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|airline
argument_list|)
expr_stmt|;
name|gdisplay_flush_now
argument_list|(
name|gdisp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_button_release (Tool * tool,GdkEventButton * bevent,gpointer gdisp_ptr)
name|xinput_airbrush_button_release
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|gimage
operator|=
name|gdisp
operator|->
name|gimage
expr_stmt|;
name|xinput_airbrush_tool
operator|=
operator|(
name|XinputAirbrushTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
comment|/*  resume the current selection and ungrab the pointer  */
name|gdisplays_selection_visibility
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|,
name|SelectionResume
argument_list|)
expr_stmt|;
name|gdk_pointer_ungrab
argument_list|(
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
comment|/*  Set tool state to inactive -- no longer painting */
name|tool
operator|->
name|state
operator|=
name|INACTIVE
expr_stmt|;
name|xinput_airbrush_finish
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
argument_list|,
name|tool
operator|->
name|ID
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dist_smoother_init (XinputAirbrushTool * xinput_airbrush_tool,gdouble initval)
name|dist_smoother_init
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|gdouble
name|initval
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|xinput_airbrush_tool
operator|->
name|dt_index
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DIST_SMOOTHER_BUFFER
condition|;
name|i
operator|++
control|)
block|{
name|xinput_airbrush_tool
operator|->
name|dt_buffer
index|[
name|i
index|]
operator|=
name|initval
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gdouble
DECL|function|dist_smoother_result (XinputAirbrushTool * xinput_airbrush_tool)
name|dist_smoother_result
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|gdouble
name|result
init|=
literal|0.0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|DIST_SMOOTHER_BUFFER
condition|;
name|i
operator|++
control|)
block|{
name|result
operator|+=
name|xinput_airbrush_tool
operator|->
name|dt_buffer
index|[
name|i
index|]
expr_stmt|;
block|}
return|return
operator|(
name|result
operator|/
operator|(
name|gdouble
operator|)
name|DIST_SMOOTHER_BUFFER
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|dist_smoother_add (XinputAirbrushTool * xinput_airbrush_tool,gdouble value)
name|dist_smoother_add
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|gdouble
name|value
parameter_list|)
block|{
name|xinput_airbrush_tool
operator|->
name|dt_buffer
index|[
name|xinput_airbrush_tool
operator|->
name|dt_index
index|]
operator|=
name|value
expr_stmt|;
if|if
condition|(
operator|(
operator|++
name|xinput_airbrush_tool
operator|->
name|dt_index
operator|)
operator|==
name|DIST_SMOOTHER_BUFFER
condition|)
name|xinput_airbrush_tool
operator|->
name|dt_index
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|time_smoother_init (XinputAirbrushTool * xinput_airbrush_tool,guint32 initval)
name|time_smoother_init
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|guint32
name|initval
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|xinput_airbrush_tool
operator|->
name|ts_index
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TIME_SMOOTHER_BUFFER
condition|;
name|i
operator|++
control|)
block|{
name|xinput_airbrush_tool
operator|->
name|ts_buffer
index|[
name|i
index|]
operator|=
name|initval
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gdouble
DECL|function|time_smoother_result (XinputAirbrushTool * xinput_airbrush_tool)
name|time_smoother_result
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
name|guint64
name|result
init|=
literal|0
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|TIME_SMOOTHER_BUFFER
condition|;
name|i
operator|++
control|)
block|{
name|result
operator|+=
name|xinput_airbrush_tool
operator|->
name|ts_buffer
index|[
name|i
index|]
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|_MSC_VER
return|return
call|(
name|gdouble
call|)
argument_list|(
name|gint64
argument_list|)
argument_list|(
name|result
operator|/
name|TIME_SMOOTHER_BUFFER
argument_list|)
return|;
else|#
directive|else
return|return
operator|(
name|result
operator|/
name|TIME_SMOOTHER_BUFFER
operator|)
return|;
endif|#
directive|endif
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|time_smoother_add (XinputAirbrushTool * xinput_airbrush_tool,guint32 value)
name|time_smoother_add
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|guint32
name|value
parameter_list|)
block|{
name|xinput_airbrush_tool
operator|->
name|ts_buffer
index|[
name|xinput_airbrush_tool
operator|->
name|ts_index
index|]
operator|=
name|value
expr_stmt|;
if|if
condition|(
operator|(
operator|++
name|xinput_airbrush_tool
operator|->
name|ts_index
operator|)
operator|==
name|TIME_SMOOTHER_BUFFER
condition|)
name|xinput_airbrush_tool
operator|->
name|ts_index
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_motion (Tool * tool,GdkEventMotion * mevent,gpointer gdisp_ptr)
name|xinput_airbrush_motion
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventMotion
modifier|*
name|mevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|AirBlob
modifier|*
name|airblob
decl_stmt|;
name|double
name|x
decl_stmt|,
name|y
decl_stmt|;
name|double
name|pressure
decl_stmt|;
name|double
name|velocity
decl_stmt|;
name|double
name|dist
decl_stmt|;
name|gdouble
name|lasttime
decl_stmt|,
name|thistime
decl_stmt|;
name|guint
name|last_value
decl_stmt|,
name|present_value
decl_stmt|;
name|double
name|a
decl_stmt|,
name|b
decl_stmt|,
name|c
decl_stmt|,
name|A
decl_stmt|;
name|gboolean
name|turn_around
decl_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|double
name|min_height
decl_stmt|;
name|double
name|max_height
decl_stmt|;
name|double
name|inter_height
decl_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
name|double
name|height
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|xinput_airbrush_tool
operator|=
operator|(
name|XinputAirbrushTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
name|gdisplay_untransform_coords_f
argument_list|(
name|gdisp
argument_list|,
name|mevent
operator|->
name|x
argument_list|,
name|mevent
operator|->
name|y
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|drawable
operator|=
name|gimage_active_drawable
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|pressure
operator|=
name|mevent
operator|->
name|pressure
expr_stmt|;
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|airblob
operator|=
name|xinput_airbrush_pen_ellipse
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pressure
argument_list|,
name|mevent
operator|->
name|xtilt
argument_list|,
name|mevent
operator|->
name|ytilt
argument_list|,
name|mevent
operator|->
name|wheel
argument_list|)
expr_stmt|;
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
name|airblob
operator|=
name|xinput_airbrush_pen_ellipse
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|pressure
argument_list|,
name|mevent
operator|->
name|xtilt
argument_list|,
name|mevent
operator|->
name|ytilt
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
name|x
operator|=
name|xinput_airbrush_tool
operator|->
name|xcenter
expr_stmt|;
name|y
operator|=
name|xinput_airbrush_tool
operator|->
name|ycenter
expr_stmt|;
name|lasttime
operator|=
name|xinput_airbrush_tool
operator|->
name|last_time
expr_stmt|;
name|time_smoother_add
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|mevent
operator|->
name|time
argument_list|)
expr_stmt|;
name|thistime
operator|=
name|xinput_airbrush_tool
operator|->
name|last_time
operator|=
name|time_smoother_result
argument_list|(
name|xinput_airbrush_tool
argument_list|)
expr_stmt|;
comment|/* The time resolution on X-based GDK motion events is        bloody awful, hence the use of the smoothing function.        Sadly this also means that there is always the chance of        having an indeterminite velocity since this event and        the previous several may still appear to issue at the same        instant. -ADM */
if|if
condition|(
name|thistime
operator|==
name|lasttime
condition|)
name|thistime
operator|=
name|lasttime
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|xinput_airbrush_tool
operator|->
name|init_velocity
condition|)
block|{
name|dist_smoother_init
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|dist
operator|=
name|sqrt
argument_list|(
operator|(
name|xinput_airbrush_tool
operator|->
name|lastx
operator|-
name|x
operator|)
operator|*
operator|(
name|xinput_airbrush_tool
operator|->
name|lastx
operator|-
name|x
operator|)
operator|+
operator|(
name|xinput_airbrush_tool
operator|->
name|lasty
operator|-
name|y
operator|)
operator|*
operator|(
name|xinput_airbrush_tool
operator|->
name|lasty
operator|-
name|y
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|init_velocity
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
block|{
name|dist_smoother_add
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|sqrt
argument_list|(
operator|(
name|xinput_airbrush_tool
operator|->
name|lastx
operator|-
name|x
operator|)
operator|*
operator|(
name|xinput_airbrush_tool
operator|->
name|lastx
operator|-
name|x
operator|)
operator|+
operator|(
name|xinput_airbrush_tool
operator|->
name|lasty
operator|-
name|y
operator|)
operator|*
operator|(
name|xinput_airbrush_tool
operator|->
name|lasty
operator|-
name|y
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|dist
operator|=
name|dist_smoother_result
argument_list|(
name|xinput_airbrush_tool
argument_list|)
expr_stmt|;
block|}
name|turn_around
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|xinput_airbrush_tool
operator|->
name|init_prepre
condition|)
block|{
name|a
operator|=
name|hypot
argument_list|(
name|xinput_airbrush_tool
operator|->
name|last_lastx
operator|-
name|x
argument_list|,
name|xinput_airbrush_tool
operator|->
name|last_lasty
operator|-
name|y
argument_list|)
expr_stmt|;
name|b
operator|=
name|hypot
argument_list|(
name|xinput_airbrush_tool
operator|->
name|lastx
operator|-
name|x
argument_list|,
name|xinput_airbrush_tool
operator|->
name|lasty
operator|-
name|y
argument_list|)
expr_stmt|;
name|c
operator|=
name|hypot
argument_list|(
name|xinput_airbrush_tool
operator|->
name|last_lastx
operator|-
name|xinput_airbrush_tool
operator|->
name|lastx
argument_list|,
name|xinput_airbrush_tool
operator|->
name|last_lasty
operator|-
name|xinput_airbrush_tool
operator|->
name|lasty
argument_list|)
expr_stmt|;
comment|/* Maybe fix the fact that a, b or c can be zero i.e that we had a perfectly strait turn around or continue*/
name|A
operator|=
name|acos
argument_list|(
operator|(
name|b
operator|*
name|b
operator|+
name|c
operator|*
name|c
operator|-
name|a
operator|*
name|a
operator|)
operator|/
literal|2
operator|*
name|b
operator|*
name|c
argument_list|)
expr_stmt|;
comment|/* 1.65806 RAD == 95deg*/
if|if
condition|(
operator|(
name|A
operator|>=
literal|0.0
operator|)
operator|&&
operator|(
name|A
operator|<
literal|1.65806
operator|)
condition|)
block|{
name|turn_around
operator|=
name|TRUE
expr_stmt|;
comment|/* printf("TURN_AROUND\n");*/
block|}
block|}
name|velocity
operator|=
literal|10.0
operator|*
name|sqrt
argument_list|(
operator|(
name|dist
operator|)
operator|/
call|(
name|double
call|)
argument_list|(
name|thistime
operator|-
name|lasttime
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Normal Speed is 2.0, Break point for zero ink is 18.        Slow speed is between 2.0 and 0.5 */
comment|/*printf("Speed: %f\n", velocity);*/
ifdef|#
directive|ifdef
name|GTK_HAVE_SIX_VALUATORS
name|min_height
operator|=
name|xinput_airbrush_options
operator|->
name|minheight
expr_stmt|;
name|max_height
operator|=
name|xinput_airbrush_options
operator|->
name|maxheight
expr_stmt|;
name|inter_height
operator|=
name|CLAMP
argument_list|(
name|mevent
operator|->
name|wheel
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
operator|*
operator|(
name|max_height
operator|-
name|min_height
operator|)
expr_stmt|;
name|height
operator|=
name|min_height
operator|+
name|inter_height
expr_stmt|;
comment|/*       printf("Height: %f\n", height);     */
else|#
directive|else
comment|/* !GTK_HAVE_SIX_VALUATORS */
name|height
operator|=
name|xinput_airbrush_options
operator|->
name|height
expr_stmt|;
endif|#
directive|endif
comment|/* GTK_HAVE_SIX_VALUATORS */
name|last_value
operator|=
name|xinput_airbrush_tool
operator|->
name|last_value
expr_stmt|;
name|present_value
operator|=
literal|256
operator|*
name|pressure
operator|*
operator|(
literal|1
operator|-
operator|(
operator|(
name|height
operator|-
literal|25
operator|)
operator|/
literal|100
operator|)
operator|)
expr_stmt|;
name|make_stroke
argument_list|(
name|airblob
argument_list|,
name|xinput_airbrush_tool
argument_list|,
name|drawable
argument_list|,
name|last_value
argument_list|,
name|present_value
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|last_lastx
operator|=
name|xinput_airbrush_tool
operator|->
name|lastx
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|last_lasty
operator|=
name|xinput_airbrush_tool
operator|->
name|lasty
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|lastx
operator|=
name|x
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|lasty
operator|=
name|y
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|last_value
operator|=
name|present_value
expr_stmt|;
name|g_free
argument_list|(
name|xinput_airbrush_tool
operator|->
name|last_airblob
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|last_airblob
operator|=
name|airblob
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|init_velocity
operator|=
name|TRUE
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|init_prepre
operator|=
name|TRUE
expr_stmt|;
name|gdisplay_flush_now
argument_list|(
name|gdisp
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_cursor_update (Tool * tool,GdkEventMotion * mevent,gpointer gdisp_ptr)
name|xinput_airbrush_cursor_update
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|GdkEventMotion
modifier|*
name|mevent
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|GDisplay
modifier|*
name|gdisp
decl_stmt|;
name|Layer
modifier|*
name|layer
decl_stmt|;
name|GdkCursorType
name|ctype
init|=
name|GDK_TOP_LEFT_ARROW
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gdisp
operator|=
operator|(
name|GDisplay
operator|*
operator|)
name|gdisp_ptr
expr_stmt|;
name|gdisplay_untransform_coords
argument_list|(
name|gdisp
argument_list|,
name|mevent
operator|->
name|x
argument_list|,
name|mevent
operator|->
name|y
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|layer
operator|=
name|gimage_get_active_layer
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|int
name|off_x
decl_stmt|,
name|off_y
decl_stmt|;
name|drawable_offsets
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|,
operator|&
name|off_x
argument_list|,
operator|&
name|off_y
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|>=
name|off_x
operator|&&
name|y
operator|>=
name|off_y
operator|&&
name|x
operator|<
operator|(
name|off_x
operator|+
name|drawable_width
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
operator|)
operator|&&
name|y
operator|<
operator|(
name|off_y
operator|+
name|drawable_height
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
operator|)
condition|)
block|{
comment|/*  One more test--is there a selected region?              *  if so, is cursor inside?              */
if|if
condition|(
name|gimage_mask_is_empty
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|)
condition|)
name|ctype
operator|=
name|GDK_PENCIL
expr_stmt|;
elseif|else
if|if
condition|(
name|gimage_mask_value
argument_list|(
name|gdisp
operator|->
name|gimage
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
name|ctype
operator|=
name|GDK_PENCIL
expr_stmt|;
block|}
block|}
name|gdisplay_install_tool_cursor
argument_list|(
name|gdisp
argument_list|,
name|ctype
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_control (Tool * tool,ToolAction action,gpointer gdisp_ptr)
name|xinput_airbrush_control
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|,
name|ToolAction
name|action
parameter_list|,
name|gpointer
name|gdisp_ptr
parameter_list|)
block|{
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
decl_stmt|;
name|xinput_airbrush_tool
operator|=
operator|(
name|XinputAirbrushTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
switch|switch
condition|(
name|action
condition|)
block|{
case|case
name|PAUSE
case|:
name|draw_core_pause
argument_list|(
name|xinput_airbrush_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
break|break;
case|case
name|RESUME
case|:
name|draw_core_resume
argument_list|(
name|xinput_airbrush_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
break|break;
case|case
name|HALT
case|:
name|xinput_airbrush_cleanup
argument_list|()
expr_stmt|;
break|break;
default|default:
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_init (XinputAirbrushTool * xinput_airbrush_tool,GimpDrawable * drawable,double x,double y)
name|xinput_airbrush_init
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|double
name|x
parameter_list|,
name|double
name|y
parameter_list|)
block|{
comment|/*  free the block structures  */
if|if
condition|(
name|undo_tiles
condition|)
name|tile_manager_destroy
argument_list|(
name|undo_tiles
argument_list|)
expr_stmt|;
if|if
condition|(
name|canvas_tiles
condition|)
name|tile_manager_destroy
argument_list|(
name|canvas_tiles
argument_list|)
expr_stmt|;
comment|/*  Allocate the undo structure  */
name|undo_tiles
operator|=
name|tile_manager_new
argument_list|(
name|drawable_width
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Allocate the canvas blocks structure  */
name|canvas_tiles
operator|=
name|tile_manager_new
argument_list|(
name|drawable_width
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|drawable_height
argument_list|(
name|drawable
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*  Get the initial undo extents  */
name|xinput_airbrush_tool
operator|->
name|x1
operator|=
name|xinput_airbrush_tool
operator|->
name|x2
operator|=
name|x
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|y1
operator|=
name|xinput_airbrush_tool
operator|->
name|y2
operator|=
name|y
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_finish (XinputAirbrushTool * xinput_airbrush_tool,GimpDrawable * drawable,int tool_id)
name|xinput_airbrush_finish
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|tool_id
parameter_list|)
block|{
comment|/*  push an undo  */
name|drawable_apply_image
argument_list|(
name|drawable
argument_list|,
name|xinput_airbrush_tool
operator|->
name|x1
argument_list|,
name|xinput_airbrush_tool
operator|->
name|y1
argument_list|,
name|xinput_airbrush_tool
operator|->
name|x2
argument_list|,
name|xinput_airbrush_tool
operator|->
name|y2
argument_list|,
name|undo_tiles
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|undo_tiles
operator|=
name|NULL
expr_stmt|;
comment|/*  invalidate the drawable--have to do it here, because      *  it is not done during the actual painting.      */
name|drawable_invalidate_preview
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_cleanup (void)
name|xinput_airbrush_cleanup
parameter_list|(
name|void
parameter_list|)
block|{
comment|/*  CLEANUP  */
comment|/*  If the undo tiles exist, nuke them  */
if|if
condition|(
name|undo_tiles
condition|)
block|{
name|tile_manager_destroy
argument_list|(
name|undo_tiles
argument_list|)
expr_stmt|;
name|undo_tiles
operator|=
name|NULL
expr_stmt|;
block|}
comment|/*  If the canvas blocks exist, nuke them  */
if|if
condition|(
name|canvas_tiles
condition|)
block|{
name|tile_manager_destroy
argument_list|(
name|canvas_tiles
argument_list|)
expr_stmt|;
name|canvas_tiles
operator|=
name|NULL
expr_stmt|;
block|}
comment|/*  Free the temporary buffer if it exist  */
if|if
condition|(
name|canvas_buf
condition|)
name|temp_buf_free
argument_list|(
name|canvas_buf
argument_list|)
expr_stmt|;
name|canvas_buf
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_comment
comment|/*********************************  *  Rendering functions          *  *********************************/
end_comment

begin_comment
comment|/* Some of this stuff should probably be combined with the  * code it was copied from in paint_core.c; but I wanted  * to learn this stuff, so I've kept it simple.  */
end_comment

begin_function
specifier|static
specifier|inline
name|int
DECL|function|number_of_steps (int x0,int y0,int x1,int y1)
name|number_of_steps
parameter_list|(
name|int
name|x0
parameter_list|,
name|int
name|y0
parameter_list|,
name|int
name|x1
parameter_list|,
name|int
name|y1
parameter_list|)
block|{
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|dx
operator|=
name|abs
argument_list|(
name|x0
operator|-
name|x1
argument_list|)
expr_stmt|;
name|dy
operator|=
name|abs
argument_list|(
name|y0
operator|-
name|y1
argument_list|)
expr_stmt|;
if|if
condition|(
name|dy
operator|>
name|dx
condition|)
block|{
return|return
name|dy
operator|+
literal|1
return|;
block|}
else|else
block|{
return|return
name|dx
operator|+
literal|1
return|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|make_stroke (AirBlob * airblob,XinputAirbrushTool * xinput_airbrush_tool,GimpDrawable * drawable,guint last_value,guint present_value)
name|make_stroke
parameter_list|(
name|AirBlob
modifier|*
name|airblob
parameter_list|,
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|guint
name|last_value
parameter_list|,
name|guint
name|present_value
parameter_list|)
block|{
name|int
name|steps
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|;
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|x0
decl_stmt|,
name|x1
decl_stmt|,
name|y0
decl_stmt|,
name|y1
decl_stmt|;
name|double
name|x0d
decl_stmt|,
name|x1d
decl_stmt|,
name|y0d
decl_stmt|,
name|y1d
decl_stmt|;
name|int
name|x_min
decl_stmt|,
name|x_max
decl_stmt|,
name|y_min
decl_stmt|,
name|y_max
decl_stmt|,
name|width
decl_stmt|,
name|height
decl_stmt|;
name|int
name|number
decl_stmt|,
name|ystart
decl_stmt|,
name|xstart
decl_stmt|;
name|guint
name|ivalue
decl_stmt|;
name|double
name|lv
decl_stmt|,
name|pv
decl_stmt|,
name|mv
decl_stmt|;
name|double
name|dist
decl_stmt|;
name|int
name|slopeterm
decl_stmt|;
name|AirBlob
modifier|*
name|last_airblob
decl_stmt|;
name|AirBlob
modifier|*
name|trans_blob
decl_stmt|;
name|AirLine
modifier|*
name|air_line
decl_stmt|;
name|MaskBuf
modifier|*
name|brush_mask
decl_stmt|;
name|MaskBuf
modifier|*
modifier|*
name|bufs
decl_stmt|;
name|guchar
modifier|*
name|source
decl_stmt|;
name|guchar
modifier|*
name|dest
decl_stmt|;
name|int
modifier|*
name|xpoints
decl_stmt|;
name|int
modifier|*
name|ypoints
decl_stmt|;
name|gboolean
name|something
decl_stmt|;
name|something
operator|=
name|FALSE
expr_stmt|;
name|x0
operator|=
name|xinput_airbrush_tool
operator|->
name|lastx
expr_stmt|;
name|x1
operator|=
name|xinput_airbrush_tool
operator|->
name|xcenter
expr_stmt|;
name|y0
operator|=
name|xinput_airbrush_tool
operator|->
name|lasty
expr_stmt|;
name|y1
operator|=
name|xinput_airbrush_tool
operator|->
name|ycenter
expr_stmt|;
name|x0d
operator|=
name|xinput_airbrush_tool
operator|->
name|lastx
expr_stmt|;
name|x1d
operator|=
name|xinput_airbrush_tool
operator|->
name|xcenter
expr_stmt|;
name|y0d
operator|=
name|xinput_airbrush_tool
operator|->
name|lasty
expr_stmt|;
name|y1d
operator|=
name|xinput_airbrush_tool
operator|->
name|ycenter
expr_stmt|;
name|last_airblob
operator|=
name|xinput_airbrush_tool
operator|->
name|last_airblob
expr_stmt|;
name|steps
operator|=
name|number_of_steps
argument_list|(
name|x0
argument_list|,
name|y0
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
comment|/*     printf("Stoke Steps: %d\n", steps);   */
name|ypoints
operator|=
name|g_new
argument_list|(
name|int
argument_list|,
name|steps
argument_list|)
expr_stmt|;
name|xpoints
operator|=
name|g_new
argument_list|(
name|int
argument_list|,
name|steps
argument_list|)
expr_stmt|;
name|bufs
operator|=
name|g_new
argument_list|(
name|MaskBuf
operator|*
argument_list|,
name|steps
argument_list|)
expr_stmt|;
name|dx
operator|=
name|abs
argument_list|(
name|x0
operator|-
name|x1
argument_list|)
expr_stmt|;
name|dy
operator|=
name|abs
argument_list|(
name|y0
operator|-
name|y1
argument_list|)
expr_stmt|;
name|lv
operator|=
name|last_value
expr_stmt|;
name|pv
operator|=
name|present_value
expr_stmt|;
name|mv
operator|=
name|pv
operator|-
name|lv
expr_stmt|;
comment|/*     Yes I know this is bulky code :-),     --> see comment on make_mask.          But I wanted to keep it simple while I      implemented the tool :-). I will make it      more effective later on. And yes I could      look for the three special cases.   */
comment|/*     There is also a possiblity of a bug in the     scanline function that will explain the      "jumping lines".   */
if|if
condition|(
name|dy
operator|>
name|dx
condition|)
block|{
comment|/* Step in the y direction*/
if|if
condition|(
name|y0
operator|<
name|y1
condition|)
block|{
comment|/*  	     Step from y0 to y1  	  */
if|if
condition|(
name|x1
operator|<
name|x0
condition|)
block|{
comment|/* 		We have to x-- 	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
name|slopeterm
operator|=
name|dx
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		 We have to x++ 	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|slopeterm
operator|=
name|dx
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* Step from y0 to y1 with neg steps */
if|if
condition|(
name|x1
operator|<
name|x0
condition|)
block|{
comment|/* 		We have to x--  	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|slopeterm
operator|=
name|dx
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|y
operator|>
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		 We have to x++ 	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|slopeterm
operator|=
name|dx
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|y
operator|>
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
block|}
else|else
block|{
comment|/* Step in the X direction*/
if|if
condition|(
name|x0
operator|<
name|x1
condition|)
block|{
comment|/* Step from x0 to x1 */
if|if
condition|(
name|y1
operator|<
name|y0
condition|)
block|{
comment|/* 		We have to y-- 	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		 We have to y++ 	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* Step from x0 to x1 neg direction */
if|if
condition|(
name|y1
operator|<
name|y0
condition|)
block|{
comment|/* 		We have to y-- 	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|>
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		 We have to y++ 	      */
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|number
operator|=
literal|0
expr_stmt|;
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|>
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|dist
operator|=
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
expr_stmt|;
name|ivalue
operator|=
name|lv
operator|+
name|mv
operator|*
name|dist
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
name|dist
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|ivalue
argument_list|)
expr_stmt|;
name|number
operator|++
expr_stmt|;
name|something
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
block|}
if|if
condition|(
operator|!
name|something
condition|)
block|{
comment|/* 	printf("Nothing \n");       */
name|number
operator|=
literal|0
expr_stmt|;
name|dist
operator|=
literal|1.0
expr_stmt|;
name|trans_blob
operator|=
name|trans_air_blob
argument_list|(
name|last_airblob
argument_list|,
name|airblob
argument_list|,
literal|0.5
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|)
expr_stmt|;
name|air_line
operator|=
name|create_air_line
argument_list|(
name|trans_blob
argument_list|)
expr_stmt|;
name|x_min
operator|=
name|air_line
operator|->
name|min_x
expr_stmt|;
name|y_min
operator|=
name|air_line
operator|->
name|min_y
expr_stmt|;
name|width
operator|=
name|air_line
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|air_line
operator|->
name|height
expr_stmt|;
name|bufs
index|[
name|number
index|]
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|ypoints
index|[
name|number
index|]
operator|=
name|y_min
expr_stmt|;
name|xpoints
index|[
name|number
index|]
operator|=
name|x_min
expr_stmt|;
name|make_mask
argument_list|(
name|air_line
argument_list|,
name|bufs
index|[
name|number
index|]
argument_list|,
name|pv
argument_list|)
expr_stmt|;
comment|/* 	print_mask(bufs[number]);       */
name|brush_mask
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|dest
operator|=
name|brush_mask
operator|->
name|data
expr_stmt|;
name|source
operator|=
name|bufs
index|[
name|number
index|]
operator|->
name|data
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|bufs
index|[
name|number
index|]
operator|->
name|height
condition|;
name|k
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|bufs
index|[
name|number
index|]
operator|->
name|width
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|(
name|int
operator|)
name|dest
index|[
name|k
operator|*
name|width
operator|+
name|j
index|]
operator|+
operator|(
name|int
operator|)
name|source
index|[
name|k
operator|*
name|bufs
index|[
name|number
index|]
operator|->
name|width
operator|+
name|j
index|]
operator|)
operator|>
literal|255
condition|)
block|{
name|dest
index|[
name|k
operator|*
name|width
operator|+
name|j
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
name|dest
index|[
name|k
operator|*
name|width
operator|+
name|j
index|]
operator|+=
name|source
index|[
name|k
operator|*
name|bufs
index|[
name|number
index|]
operator|->
name|width
operator|+
name|j
index|]
expr_stmt|;
block|}
block|}
block|}
name|xinput_airbrush_paste
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|drawable
argument_list|,
name|brush_mask
argument_list|,
name|x_min
argument_list|,
name|y_min
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* 	print_mask(brush_mask);       */
name|mask_buf_free
argument_list|(
name|brush_mask
argument_list|)
expr_stmt|;
name|mask_buf_free
argument_list|(
name|bufs
index|[
name|number
index|]
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|bufs
argument_list|)
expr_stmt|;
comment|/* 	printf("Nothing again\n");       */
block|}
if|if
condition|(
name|something
condition|)
block|{
name|y_min
operator|=
name|y_max
operator|=
name|ypoints
index|[
literal|0
index|]
expr_stmt|;
name|height
operator|=
name|bufs
index|[
literal|0
index|]
operator|->
name|height
expr_stmt|;
name|x_min
operator|=
name|x_max
operator|=
name|xpoints
index|[
literal|0
index|]
expr_stmt|;
name|width
operator|=
name|bufs
index|[
literal|0
index|]
operator|->
name|width
expr_stmt|;
comment|/*printf("xmin %d, ymin %d, width %d, weight %d\n", x_min, y_min, width, height);*/
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|steps
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
comment|/*printf("xmin %d, ymin %d, width %d, weight %d\n", xpoints[i], ypoints[i], bufs[i]->width, bufs[i]->height);*/
name|x_min
operator|=
name|MIN
argument_list|(
name|xpoints
index|[
name|i
index|]
argument_list|,
name|x_min
argument_list|)
expr_stmt|;
name|y_min
operator|=
name|MIN
argument_list|(
name|ypoints
index|[
name|i
index|]
argument_list|,
name|y_min
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x_max
operator|+
name|width
operator|)
operator|<
operator|(
name|xpoints
index|[
name|i
index|]
operator|+
name|bufs
index|[
name|i
index|]
operator|->
name|width
operator|)
condition|)
block|{
name|x_max
operator|=
name|xpoints
index|[
name|i
index|]
expr_stmt|;
name|width
operator|=
name|bufs
index|[
name|i
index|]
operator|->
name|width
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|y_max
operator|+
name|height
operator|)
operator|<
operator|(
name|ypoints
index|[
name|i
index|]
operator|+
name|bufs
index|[
name|i
index|]
operator|->
name|height
operator|)
condition|)
block|{
name|y_max
operator|=
name|ypoints
index|[
name|i
index|]
expr_stmt|;
name|height
operator|=
name|bufs
index|[
name|i
index|]
operator|->
name|height
expr_stmt|;
block|}
block|}
name|width
operator|=
name|x_max
operator|-
name|x_min
operator|+
name|width
expr_stmt|;
name|height
operator|=
name|y_max
operator|-
name|y_min
operator|+
name|height
expr_stmt|;
comment|/*printf("Xmin %d, Ymin %d, Width %d, Height %d\n", x_min, y_min, width, height); 	printf("\n");*/
name|brush_mask
operator|=
name|mask_buf_new
argument_list|(
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|dest
operator|=
name|brush_mask
operator|->
name|data
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|steps
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
name|ystart
operator|=
name|ypoints
index|[
name|i
index|]
operator|-
name|y_min
expr_stmt|;
name|xstart
operator|=
name|xpoints
index|[
name|i
index|]
operator|-
name|x_min
expr_stmt|;
comment|/*printf("xstart %d, ystart %d\n", xstart, ystart);*/
name|y
operator|=
name|width
operator|*
name|ystart
expr_stmt|;
name|source
operator|=
name|bufs
index|[
name|i
index|]
operator|->
name|data
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
name|bufs
index|[
name|i
index|]
operator|->
name|height
condition|;
name|k
operator|++
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|bufs
index|[
name|i
index|]
operator|->
name|width
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
operator|(
operator|(
name|int
operator|)
name|dest
index|[
name|y
operator|+
name|k
operator|*
name|width
operator|+
name|xstart
operator|+
name|j
index|]
operator|+
operator|(
name|int
operator|)
name|source
index|[
name|k
operator|*
name|bufs
index|[
name|i
index|]
operator|->
name|width
operator|+
name|j
index|]
operator|)
operator|>
literal|255
condition|)
block|{
name|dest
index|[
name|y
operator|+
name|k
operator|*
name|width
operator|+
name|xstart
operator|+
name|j
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
name|dest
index|[
name|y
operator|+
name|k
operator|*
name|width
operator|+
name|xstart
operator|+
name|j
index|]
operator|+=
name|source
index|[
name|k
operator|*
name|bufs
index|[
name|i
index|]
operator|->
name|width
operator|+
name|j
index|]
expr_stmt|;
block|}
block|}
block|}
block|}
comment|/*printf("\n\n");*/
for|for
control|(
name|i
operator|=
name|steps
operator|-
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|mask_buf_free
argument_list|(
name|bufs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|bufs
argument_list|)
expr_stmt|;
name|xinput_airbrush_paste
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|drawable
argument_list|,
name|brush_mask
argument_list|,
name|x_min
argument_list|,
name|y_min
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|mask_buf_free
argument_list|(
name|brush_mask
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* 	printf("Hmm something was FALSE\n");       */
block|}
block|}
end_function

begin_comment
comment|/************************************************** *************************************************** */
end_comment

begin_function
specifier|static
name|void
DECL|function|make_mask (AirLine * airline,MaskBuf * dest,guint value)
name|make_mask
parameter_list|(
name|AirLine
modifier|*
name|airline
parameter_list|,
name|MaskBuf
modifier|*
name|dest
parameter_list|,
name|guint
name|value
parameter_list|)
block|{
name|int
name|steps
decl_stmt|;
name|int
name|total_steps
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|j
decl_stmt|;
name|int
name|dx
decl_stmt|,
name|dy
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|x0
decl_stmt|,
name|x1
decl_stmt|,
name|y0
decl_stmt|,
name|y1
decl_stmt|;
name|unsigned
name|char
modifier|*
name|s
decl_stmt|;
name|guint
name|midvalue
decl_stmt|;
name|double
name|ivalue
decl_stmt|;
name|int
name|rowlength
decl_stmt|;
name|int
name|slopeterm
decl_stmt|;
name|gboolean
name|nothing
decl_stmt|;
name|rowlength
operator|=
name|dest
operator|->
name|width
operator|*
name|dest
operator|->
name|bytes
expr_stmt|;
name|nothing
operator|=
name|TRUE
expr_stmt|;
name|total_steps
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|airline
operator|->
name|nlines
condition|;
name|i
operator|++
control|)
block|{
name|steps
operator|=
name|number_of_steps
argument_list|(
name|airline
operator|->
name|xcenter
argument_list|,
name|airline
operator|->
name|ycenter
argument_list|,
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|x
argument_list|,
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|y
argument_list|)
expr_stmt|;
name|total_steps
operator|+=
name|steps
expr_stmt|;
block|}
comment|/*     printf("Total Steps: %d\n", total_steps);   */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|airline
operator|->
name|nlines
condition|;
name|i
operator|++
control|)
block|{
name|steps
operator|=
name|number_of_steps
argument_list|(
name|airline
operator|->
name|xcenter
argument_list|,
name|airline
operator|->
name|ycenter
argument_list|,
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|x
argument_list|,
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|y
argument_list|)
expr_stmt|;
name|x0
operator|=
name|airline
operator|->
name|xcenter
operator|-
name|airline
operator|->
name|min_x
expr_stmt|;
name|x1
operator|=
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|x
operator|-
name|airline
operator|->
name|min_x
expr_stmt|;
name|y0
operator|=
name|airline
operator|->
name|ycenter
operator|-
name|airline
operator|->
name|min_y
expr_stmt|;
name|y1
operator|=
name|airline
operator|->
name|line
index|[
name|i
index|]
operator|.
name|y
operator|-
name|airline
operator|->
name|min_y
expr_stmt|;
name|dx
operator|=
name|abs
argument_list|(
name|x0
operator|-
name|x1
argument_list|)
expr_stmt|;
name|dy
operator|=
name|abs
argument_list|(
name|y0
operator|-
name|y1
argument_list|)
expr_stmt|;
comment|/* 	Yes I know this is bulky code :-), 	you could insted set the x direction 	to 1 or -1, and y to - or + rowside. 	Then set the first X and Y and of you  	go. 	 	But I wanted to keep it simple while I  	implemented the tool :-). I will make it  	more effective later on. And yes I could  	look for the three special cases.       */
name|midvalue
operator|=
name|value
expr_stmt|;
if|if
condition|(
name|dy
operator|>
name|dx
condition|)
block|{
comment|/* Step in the y direction*/
if|if
condition|(
name|y0
operator|<
name|y1
condition|)
block|{
comment|/*  		 Step from y0 to y1  	      */
if|if
condition|(
name|x1
operator|<
name|x0
condition|)
block|{
comment|/* 		    We have to x-- 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dx
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		     We have to x++ 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dx
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|y
operator|<
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* Step from y0 to y1 with neg steps */
if|if
condition|(
name|x1
operator|<
name|x0
condition|)
block|{
comment|/* 		    We have to x-- 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dx
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|y
operator|>
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		     We have to x++ 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dx
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|y
operator|>
name|y1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dy
condition|)
block|{
name|slopeterm
operator|-=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
block|}
else|else
block|{
comment|/* Step in the X direction*/
if|if
condition|(
name|x0
operator|<
name|x1
condition|)
block|{
comment|/* Step from x0 to x1 */
if|if
condition|(
name|y1
operator|<
name|y0
condition|)
block|{
comment|/* 		    We have to y-- 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		     We have to y++ 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|<
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|++
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* Step from x0 to x1 neg direction */
if|if
condition|(
name|y1
operator|<
name|y0
condition|)
block|{
comment|/* 		    We have to y-- 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|>
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|--
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  		     We have to y++ 		  */
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|x
operator|=
name|x0
expr_stmt|;
name|y
operator|=
name|y0
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
operator|(
name|int
operator|)
name|midvalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
name|midvalue
operator|+
operator|*
name|s
expr_stmt|;
block|}
name|slopeterm
operator|=
name|dy
expr_stmt|;
name|j
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|x
operator|>
name|x1
condition|)
block|{
if|if
condition|(
name|slopeterm
operator|>
name|dx
condition|)
block|{
name|slopeterm
operator|-=
name|dx
expr_stmt|;
name|y
operator|++
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
else|else
block|{
name|slopeterm
operator|+=
name|dy
expr_stmt|;
name|x
operator|--
expr_stmt|;
block|}
name|j
operator|++
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|s
operator|+=
name|y
operator|*
name|rowlength
operator|+
name|x
expr_stmt|;
name|ivalue
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
operator|(
name|double
operator|)
name|j
operator|/
operator|(
name|double
operator|)
name|steps
operator|)
expr_stmt|;
if|if
condition|(
operator|(
operator|(
name|int
operator|)
operator|*
name|s
operator|+
name|ivalue
operator|)
operator|>
literal|255
condition|)
block|{
operator|*
name|s
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
operator|*
name|s
operator|=
operator|*
name|s
operator|+
name|ivalue
expr_stmt|;
block|}
name|nothing
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
if|if
condition|(
name|nothing
condition|)
block|{
name|printf
argument_list|(
literal|"Hmm I retured a nothing brush\n"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_set_paint_area (XinputAirbrushTool * xinput_airbrush_tool,GimpDrawable * drawable,int x,int y,int width,int height)
name|xinput_airbrush_set_paint_area
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|int
name|iwidth
decl_stmt|,
name|iheight
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|int
name|bytes
decl_stmt|;
name|int
name|dwidth
decl_stmt|,
name|dheight
decl_stmt|;
name|bytes
operator|=
name|drawable_has_alpha
argument_list|(
name|drawable
argument_list|)
condition|?
name|drawable_bytes
argument_list|(
name|drawable
argument_list|)
else|:
name|drawable_bytes
argument_list|(
name|drawable
argument_list|)
operator|+
literal|1
expr_stmt|;
name|dwidth
operator|=
name|drawable_width
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|dheight
operator|=
name|drawable_height
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|x1
operator|=
name|CLAMP
argument_list|(
name|x
argument_list|,
literal|0
argument_list|,
name|dwidth
argument_list|)
expr_stmt|;
name|y1
operator|=
name|CLAMP
argument_list|(
name|y
argument_list|,
literal|0
argument_list|,
name|dheight
argument_list|)
expr_stmt|;
name|x2
operator|=
name|CLAMP
argument_list|(
operator|(
name|x
operator|+
name|width
operator|)
argument_list|,
literal|0
argument_list|,
name|dwidth
argument_list|)
expr_stmt|;
name|y2
operator|=
name|CLAMP
argument_list|(
operator|(
name|y
operator|+
name|height
operator|)
argument_list|,
literal|0
argument_list|,
name|dheight
argument_list|)
expr_stmt|;
name|iwidth
operator|=
name|MIN
argument_list|(
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|iheight
operator|=
name|MIN
argument_list|(
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/*  configure the canvas buffer  */
if|if
condition|(
operator|(
name|x2
operator|-
name|x1
operator|)
operator|&&
operator|(
name|y2
operator|-
name|y1
operator|)
condition|)
name|canvas_buf
operator|=
name|temp_buf_resize
argument_list|(
name|canvas_buf
argument_list|,
name|bytes
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
name|iwidth
argument_list|,
name|iheight
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|render_airbrush_line (AirBrushBlob * airbrush_blob,guchar * dest,int y,int width,XinputAirbrushTool * xinput_airbrush_tool)
name|render_airbrush_line
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|,
name|guchar
modifier|*
name|dest
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|,
name|k
decl_stmt|,
name|l
decl_stmt|,
name|m
decl_stmt|,
name|g
decl_stmt|;
name|int
name|left
decl_stmt|,
name|right
decl_stmt|;
name|int
name|brush_width
decl_stmt|;
name|double
name|x_dest
decl_stmt|;
name|double
name|xdist
decl_stmt|,
name|ydist
decl_stmt|,
name|dist
decl_stmt|,
name|angle
decl_stmt|;
name|double
name|i_value
decl_stmt|;
name|guchar
name|value
decl_stmt|;
if|if
condition|(
name|airbrush_blob
operator|->
name|height
operator|<=
literal|6
condition|)
block|{
return|return;
block|}
name|left
operator|=
literal|0
expr_stmt|;
name|right
operator|=
literal|0
expr_stmt|;
name|j
operator|=
name|y
operator|*
name|SUBSAMPLE
expr_stmt|;
name|g
operator|=
name|y
operator|*
name|SUBSAMPLE
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SUBSAMPLE
condition|;
name|i
operator|++
operator|,
name|j
operator|++
control|)
block|{
if|if
condition|(
name|j
operator|>=
name|airbrush_blob
operator|->
name|height
condition|)
block|{
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
return|return;
block|}
else|else
block|{
name|left
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|g
index|]
operator|.
name|left
operator|-
name|airbrush_blob
operator|->
name|min_x
expr_stmt|;
name|right
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|g
index|]
operator|.
name|right
operator|-
name|airbrush_blob
operator|->
name|min_x
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|i
operator|==
name|SUBSAMPLE
operator|/
literal|2
condition|)
block|{
name|left
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|j
index|]
operator|.
name|left
operator|-
name|airbrush_blob
operator|->
name|min_x
expr_stmt|;
name|right
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|j
index|]
operator|.
name|right
operator|-
name|airbrush_blob
operator|->
name|min_x
expr_stmt|;
break|break;
block|}
block|}
name|brush_width
operator|=
name|right
operator|-
name|left
expr_stmt|;
if|if
condition|(
name|brush_width
operator|<=
name|SUBSAMPLE
operator|*
literal|2
condition|)
block|{
return|return;
block|}
name|dest
operator|=
name|dest
operator|+
operator|(
name|left
operator|/
name|SUBSAMPLE
operator|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|4
init|;
name|i
operator|<=
name|brush_width
condition|;
name|i
operator|=
name|i
operator|+
name|SUBSAMPLE
control|)
block|{
name|x_dest
operator|=
operator|(
name|left
operator|+
name|i
operator|)
operator|/
name|SUBSAMPLE
expr_stmt|;
name|xdist
operator|=
operator|(
name|airbrush_blob
operator|->
name|min_x
operator|/
name|SUBSAMPLE
operator|)
operator|+
name|x_dest
operator|-
name|xinput_airbrush_tool
operator|->
name|xcenter
expr_stmt|;
name|ydist
operator|=
name|xinput_airbrush_tool
operator|->
name|ycenter
operator|-
operator|(
name|airbrush_blob
operator|->
name|y
operator|/
name|SUBSAMPLE
operator|)
operator|-
name|y
expr_stmt|;
name|angle
operator|=
name|atan2
argument_list|(
name|ydist
argument_list|,
name|xdist
argument_list|)
operator|+
name|G_PI
expr_stmt|;
name|dist
operator|=
name|hypot
argument_list|(
name|xdist
argument_list|,
name|ydist
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|1
init|;
name|j
operator|<
operator|(
name|airbrush_blob
operator|->
name|height
operator|-
literal|1
operator|)
condition|;
name|j
operator|++
control|)
block|{
name|k
operator|=
name|j
operator|-
literal|1
expr_stmt|;
name|l
operator|=
name|j
operator|+
literal|1
expr_stmt|;
name|m
operator|=
literal|0
expr_stmt|;
if|if
condition|(
operator|(
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|k
index|]
operator|.
name|angle_right_abs
operator|-
name|airbrush_blob
operator|->
name|data
index|[
name|l
index|]
operator|.
name|angle_right_abs
argument_list|)
operator|>
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|k
index|]
operator|.
name|angle_right_abs
operator|-
name|angle
argument_list|)
operator|)
operator|&&
operator|(
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|k
index|]
operator|.
name|angle_right_abs
operator|-
name|airbrush_blob
operator|->
name|data
index|[
name|l
index|]
operator|.
name|angle_right_abs
argument_list|)
operator|>
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|l
index|]
operator|.
name|angle_right_abs
operator|-
name|angle
argument_list|)
operator|)
condition|)
block|{
name|i_value
operator|=
name|MIN
argument_list|(
literal|1.
argument_list|,
operator|(
name|dist
operator|*
name|SUBSAMPLE
operator|)
operator|/
operator|(
name|airbrush_blob
operator|->
name|data
index|[
name|j
index|]
operator|.
name|dist_right
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
literal|255
operator|*
operator|(
literal|1
operator|-
name|i_value
operator|)
expr_stmt|;
operator|*
name|dest
operator|=
name|value
expr_stmt|;
name|dest
operator|++
expr_stmt|;
name|m
operator|=
literal|1
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
operator|(
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|k
index|]
operator|.
name|angle_left_abs
operator|-
name|airbrush_blob
operator|->
name|data
index|[
name|l
index|]
operator|.
name|angle_left_abs
argument_list|)
operator|>
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|k
index|]
operator|.
name|angle_left_abs
operator|-
name|angle
argument_list|)
operator|)
operator|&&
operator|(
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|k
index|]
operator|.
name|angle_left_abs
operator|-
name|airbrush_blob
operator|->
name|data
index|[
name|l
index|]
operator|.
name|angle_left_abs
argument_list|)
operator|>
name|fabs
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|l
index|]
operator|.
name|angle_left_abs
operator|-
name|angle
argument_list|)
operator|)
condition|)
block|{
name|i_value
operator|=
name|MIN
argument_list|(
literal|1.
argument_list|,
operator|(
name|dist
operator|*
name|SUBSAMPLE
operator|)
operator|/
operator|(
name|airbrush_blob
operator|->
name|data
index|[
name|j
index|]
operator|.
name|dist_left
operator|)
argument_list|)
expr_stmt|;
name|value
operator|=
literal|255
operator|*
operator|(
literal|1
operator|-
name|i_value
operator|)
expr_stmt|;
operator|*
name|dest
operator|=
name|value
expr_stmt|;
name|dest
operator|++
expr_stmt|;
name|m
operator|=
literal|1
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
operator|(
name|j
operator|==
operator|(
name|airbrush_blob
operator|->
name|height
operator|-
literal|2
operator|)
operator|)
operator|&&
operator|(
name|m
operator|==
literal|0
operator|)
condition|)
block|{
operator|*
name|dest
operator|=
literal|0
expr_stmt|;
name|dest
operator|++
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_width (AirBrushBlob * airbrush_blob)
name|calc_width
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|int
name|min_x
decl_stmt|,
name|max_x
decl_stmt|;
name|i
operator|=
operator|(
name|airbrush_blob
operator|->
name|height
operator|)
operator|/
literal|2
expr_stmt|;
name|min_x
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
expr_stmt|;
name|max_x
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|airbrush_blob
operator|->
name|height
operator|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|<=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|)
block|{
name|min_x
operator|=
name|MIN
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
argument_list|,
name|min_x
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|<=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|)
block|{
name|max_x
operator|=
name|MAX
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
argument_list|,
name|max_x
argument_list|)
expr_stmt|;
block|}
block|}
name|airbrush_blob
operator|->
name|width
operator|=
name|max_x
operator|-
name|min_x
expr_stmt|;
name|airbrush_blob
operator|->
name|min_x
operator|=
name|min_x
expr_stmt|;
name|airbrush_blob
operator|->
name|max_x
operator|=
name|max_x
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|calc_angle (AirBrushBlob * airbrush_blob,double xcenter,double ycenter)
name|calc_angle
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|,
name|double
name|xcenter
parameter_list|,
name|double
name|ycenter
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|double
name|y_center
decl_stmt|,
name|x_center
decl_stmt|;
name|double
name|y_dist
decl_stmt|,
name|x_dist
decl_stmt|;
name|double
name|left_ang
decl_stmt|,
name|right_ang
decl_stmt|;
name|double
name|left_ang_abs
decl_stmt|,
name|right_ang_abs
decl_stmt|;
name|int
name|min_x
decl_stmt|,
name|max_x
decl_stmt|;
name|x_center
operator|=
name|xcenter
operator|*
name|SUBSAMPLE
expr_stmt|;
name|y_center
operator|=
name|ycenter
operator|*
name|SUBSAMPLE
operator|-
name|airbrush_blob
operator|->
name|y
expr_stmt|;
name|i
operator|=
operator|(
name|airbrush_blob
operator|->
name|height
operator|)
operator|/
literal|2
expr_stmt|;
name|min_x
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
expr_stmt|;
name|max_x
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|airbrush_blob
operator|->
name|height
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|y_dist
operator|=
name|y_center
operator|-
name|i
expr_stmt|;
name|x_dist
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|-
name|x_center
expr_stmt|;
name|left_ang_abs
operator|=
name|atan2
argument_list|(
name|y_dist
argument_list|,
name|x_dist
argument_list|)
operator|+
name|G_PI
expr_stmt|;
name|left_ang
operator|=
name|atan
argument_list|(
name|y_dist
operator|/
name|x_dist
argument_list|)
expr_stmt|;
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|angle_left
operator|=
name|left_ang
expr_stmt|;
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|angle_left_abs
operator|=
name|left_ang_abs
expr_stmt|;
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|dist_left
operator|=
name|hypot
argument_list|(
name|x_dist
argument_list|,
name|y_dist
argument_list|)
expr_stmt|;
if|if
condition|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|<=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|)
block|{
name|min_x
operator|=
name|MIN
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
argument_list|,
name|min_x
argument_list|)
expr_stmt|;
block|}
name|x_dist
operator|=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
operator|-
name|x_center
expr_stmt|;
name|right_ang_abs
operator|=
name|atan2
argument_list|(
name|y_dist
argument_list|,
name|x_dist
argument_list|)
operator|+
name|G_PI
expr_stmt|;
name|right_ang
operator|=
name|atan
argument_list|(
name|y_dist
operator|/
name|x_dist
argument_list|)
expr_stmt|;
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|angle_right
operator|=
name|right_ang
expr_stmt|;
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|angle_right_abs
operator|=
name|right_ang_abs
expr_stmt|;
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|dist_right
operator|=
name|hypot
argument_list|(
name|x_dist
argument_list|,
name|y_dist
argument_list|)
expr_stmt|;
if|if
condition|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|left
operator|<=
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
condition|)
block|{
name|max_x
operator|=
name|MAX
argument_list|(
name|airbrush_blob
operator|->
name|data
index|[
name|i
index|]
operator|.
name|right
argument_list|,
name|max_x
argument_list|)
expr_stmt|;
block|}
block|}
name|airbrush_blob
operator|->
name|width
operator|=
name|max_x
operator|-
name|min_x
expr_stmt|;
name|airbrush_blob
operator|->
name|min_x
operator|=
name|min_x
expr_stmt|;
name|airbrush_blob
operator|->
name|max_x
operator|=
name|max_x
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|make_single_mask (AirBrushBlob * airbrush_blob,XinputAirbrushTool * xinput_airbrush_tool,MaskBuf * dest)
name|make_single_mask
parameter_list|(
name|AirBrushBlob
modifier|*
name|airbrush_blob
parameter_list|,
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|MaskBuf
modifier|*
name|dest
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|h
decl_stmt|;
name|int
name|i
decl_stmt|;
name|h
operator|=
name|dest
operator|->
name|height
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|h
condition|;
name|i
operator|++
control|)
block|{
name|render_airbrush_line
argument_list|(
name|airbrush_blob
argument_list|,
name|s
argument_list|,
name|i
argument_list|,
name|dest
operator|->
name|width
argument_list|,
name|xinput_airbrush_tool
argument_list|)
expr_stmt|;
name|s
operator|+=
operator|(
name|dest
operator|->
name|width
operator|*
name|dest
operator|->
name|bytes
operator|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|print_line (guchar * dest,int width)
name|print_line
parameter_list|(
name|guchar
modifier|*
name|dest
parameter_list|,
name|int
name|width
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|width
condition|;
name|i
operator|++
control|)
block|{
name|printf
argument_list|(
literal|"%d       "
argument_list|,
operator|*
name|dest
argument_list|)
expr_stmt|;
name|dest
operator|++
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|print_mask (MaskBuf * dest)
name|print_mask
parameter_list|(
name|MaskBuf
modifier|*
name|dest
parameter_list|)
block|{
name|unsigned
name|char
modifier|*
name|s
decl_stmt|;
name|int
name|h
decl_stmt|;
name|int
name|i
decl_stmt|;
name|h
operator|=
name|dest
operator|->
name|height
expr_stmt|;
name|s
operator|=
name|dest
operator|->
name|data
expr_stmt|;
name|printf
argument_list|(
literal|"\nBrush_Mask\n\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|h
condition|;
name|i
operator|++
control|)
block|{
name|print_line
argument_list|(
name|s
argument_list|,
name|dest
operator|->
name|width
argument_list|)
expr_stmt|;
name|s
operator|+=
operator|(
name|dest
operator|->
name|width
operator|*
name|dest
operator|->
name|bytes
operator|)
expr_stmt|;
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
name|printf
argument_list|(
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|MaskBuf
modifier|*
DECL|function|blur_mask_1 (MaskBuf * mask)
name|blur_mask_1
parameter_list|(
name|MaskBuf
modifier|*
name|mask
parameter_list|)
block|{
name|MaskBuf
modifier|*
name|retur
decl_stmt|;
name|int
name|y
decl_stmt|,
name|x
decl_stmt|;
name|unsigned
name|char
modifier|*
name|source
decl_stmt|;
name|unsigned
name|char
modifier|*
name|dest
decl_stmt|;
name|int
name|height
decl_stmt|,
name|width
decl_stmt|;
name|retur
operator|=
name|mask_buf_new
argument_list|(
name|mask
operator|->
name|width
argument_list|,
name|mask
operator|->
name|height
argument_list|)
expr_stmt|;
name|source
operator|=
name|mask
operator|->
name|data
expr_stmt|;
name|dest
operator|=
name|retur
operator|->
name|data
expr_stmt|;
name|width
operator|=
name|mask
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|mask
operator|->
name|height
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|1
init|;
name|y
operator|<
operator|(
name|height
operator|-
literal|1
operator|)
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
literal|1
init|;
name|x
operator|<
operator|(
name|width
operator|-
literal|1
operator|)
condition|;
name|x
operator|++
control|)
block|{
name|dest
index|[
operator|(
name|y
operator|*
name|retur
operator|->
name|width
operator|+
name|x
operator|)
index|]
operator|=
operator|(
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|)
operator|/
literal|16
expr_stmt|;
block|}
block|}
name|mask_buf_free
argument_list|(
name|mask
argument_list|)
expr_stmt|;
return|return
name|retur
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|MaskBuf
modifier|*
DECL|function|blur_mask_2 (MaskBuf * mask)
name|blur_mask_2
parameter_list|(
name|MaskBuf
modifier|*
name|mask
parameter_list|)
block|{
name|MaskBuf
modifier|*
name|retur
decl_stmt|;
name|int
name|y
decl_stmt|,
name|x
decl_stmt|;
name|unsigned
name|char
modifier|*
name|source
decl_stmt|;
name|unsigned
name|char
modifier|*
name|dest
decl_stmt|;
name|int
name|height
decl_stmt|,
name|width
decl_stmt|;
name|retur
operator|=
name|mask_buf_new
argument_list|(
name|mask
operator|->
name|width
argument_list|,
name|mask
operator|->
name|height
argument_list|)
expr_stmt|;
name|source
operator|=
name|mask
operator|->
name|data
expr_stmt|;
name|dest
operator|=
name|retur
operator|->
name|data
expr_stmt|;
name|width
operator|=
name|mask
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|mask
operator|->
name|height
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|2
init|;
name|y
operator|<
operator|(
name|height
operator|-
literal|2
operator|)
condition|;
name|y
operator|++
control|)
block|{
for|for
control|(
name|x
operator|=
literal|2
init|;
name|x
operator|<
operator|(
name|width
operator|-
literal|2
operator|)
condition|;
name|x
operator|++
control|)
block|{
name|dest
index|[
operator|(
name|y
operator|*
name|retur
operator|->
name|width
operator|+
name|x
operator|)
index|]
operator|=
operator|(
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|2
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|2
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|2
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|-
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|2
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|2
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
literal|1
operator|*
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|+
literal|1
operator|*
name|source
index|[
operator|(
name|y
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|2
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|2
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
literal|4
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|1
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|2
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|2
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|-
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|1
index|]
operator|+
literal|2
operator|*
name|source
index|[
operator|(
operator|(
name|y
operator|+
literal|2
operator|)
operator|*
name|width
operator|)
operator|+
name|x
operator|+
literal|2
index|]
operator|)
operator|/
literal|64
expr_stmt|;
block|}
block|}
name|mask_buf_free
argument_list|(
name|mask
argument_list|)
expr_stmt|;
return|return
name|retur
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|MaskBuf
modifier|*
DECL|function|blur_mask_3 (MaskBuf * mask)
name|blur_mask_3
parameter_list|(
name|MaskBuf
modifier|*
name|mask
parameter_list|)
block|{
name|MaskBuf
modifier|*
name|retur
decl_stmt|;
name|int
name|y
decl_stmt|,
name|x
decl_stmt|,
name|y_3
decl_stmt|,
name|y_2
decl_stmt|,
name|y_1
decl_stmt|,
name|y1
decl_stmt|,
name|y2
decl_stmt|,
name|y3
decl_stmt|,
name|x_3
decl_stmt|,
name|x_2
decl_stmt|,
name|x_1
decl_stmt|,
name|x1
decl_stmt|,
name|x2
decl_stmt|,
name|x3
decl_stmt|;
name|unsigned
name|char
modifier|*
name|source
decl_stmt|;
name|unsigned
name|char
modifier|*
name|dest
decl_stmt|;
name|int
name|height
decl_stmt|,
name|width
decl_stmt|,
name|max_height
decl_stmt|,
name|max_width
decl_stmt|;
name|retur
operator|=
name|mask_buf_new
argument_list|(
name|mask
operator|->
name|width
argument_list|,
name|mask
operator|->
name|height
argument_list|)
expr_stmt|;
name|source
operator|=
name|mask
operator|->
name|data
expr_stmt|;
name|dest
operator|=
name|retur
operator|->
name|data
expr_stmt|;
name|width
operator|=
name|mask
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|mask
operator|->
name|height
expr_stmt|;
name|max_height
operator|=
name|width
operator|*
name|height
operator|-
literal|3
operator|*
name|width
expr_stmt|;
name|max_width
operator|=
name|width
operator|-
literal|3
expr_stmt|;
name|y_3
operator|=
literal|0
expr_stmt|;
name|y_2
operator|=
name|width
expr_stmt|;
name|y_1
operator|=
literal|2
operator|*
name|width
expr_stmt|;
name|y
operator|=
literal|3
operator|*
name|width
expr_stmt|;
name|y1
operator|=
literal|4
operator|*
name|width
expr_stmt|;
name|y2
operator|=
literal|5
operator|*
name|width
expr_stmt|;
name|y3
operator|=
literal|6
operator|*
name|width
expr_stmt|;
for|for
control|(
init|;
name|y
operator|<
name|max_height
condition|;
name|y_3
operator|+=
name|width
operator|,
name|y_2
operator|+=
name|width
operator|,
name|y_1
operator|+=
name|width
operator|,
name|y
operator|+=
name|width
operator|,
name|y1
operator|+=
name|width
operator|,
name|y2
operator|+=
name|width
operator|,
name|y3
operator|+=
name|width
control|)
block|{
for|for
control|(
name|x_3
operator|=
literal|0
operator|,
name|x_2
operator|=
literal|1
operator|,
name|x_1
operator|=
literal|2
operator|,
name|x
operator|=
literal|3
operator|,
name|x1
operator|=
literal|4
operator|,
name|x2
operator|=
literal|5
operator|,
name|x3
operator|=
literal|6
init|;
name|x
operator|<
name|max_width
condition|;
name|x_3
operator|++
operator|,
name|x_2
operator|++
operator|,
name|x_1
operator|++
operator|,
name|x
operator|++
operator|,
name|x1
operator|++
operator|,
name|x2
operator|++
operator|,
name|x3
operator|++
control|)
block|{
name|dest
index|[
name|y
operator|+
name|x
index|]
operator|=
operator|(
literal|1
operator|*
name|source
index|[
name|y_3
operator|+
name|x_3
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y_3
operator|+
name|x_2
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y_3
operator|+
name|x_1
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y_3
operator|+
name|x
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y_3
operator|+
name|x1
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y_3
operator|+
name|x2
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y_3
operator|+
name|x3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_2
operator|+
name|x_3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_2
operator|+
name|x_2
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_2
operator|+
name|x_1
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_2
operator|+
name|x
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_2
operator|+
name|x1
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_2
operator|+
name|x2
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_2
operator|+
name|x3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_1
operator|+
name|x_3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_1
operator|+
name|x_2
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y_1
operator|+
name|x_1
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y_1
operator|+
name|x
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y_1
operator|+
name|x1
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_1
operator|+
name|x2
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y_1
operator|+
name|x3
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y
operator|+
name|x_3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y
operator|+
name|x_2
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y
operator|+
name|x_1
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y
operator|+
name|x
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y
operator|+
name|x1
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y
operator|+
name|x2
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y
operator|+
name|x3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y1
operator|+
name|x_3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y1
operator|+
name|x_2
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y1
operator|+
name|x_1
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y1
operator|+
name|x
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y1
operator|+
name|x1
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y1
operator|+
name|x2
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y1
operator|+
name|x3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y2
operator|+
name|x_3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y2
operator|+
name|x_2
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y2
operator|+
name|x_1
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y2
operator|+
name|x
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y2
operator|+
name|x1
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y2
operator|+
name|x2
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y2
operator|+
name|x3
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y3
operator|+
name|x_3
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y3
operator|+
name|x_2
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y3
operator|+
name|x_1
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y3
operator|+
name|x
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y3
operator|+
name|x1
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y3
operator|+
name|x2
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y3
operator|+
name|x3
index|]
operator|)
operator|/
literal|128
expr_stmt|;
block|}
block|}
name|mask_buf_free
argument_list|(
name|mask
argument_list|)
expr_stmt|;
return|return
name|retur
return|;
block|}
end_function

begin_function
name|MaskBuf
modifier|*
DECL|function|blur_mask_4 (MaskBuf * mask)
name|blur_mask_4
parameter_list|(
name|MaskBuf
modifier|*
name|mask
parameter_list|)
block|{
name|MaskBuf
modifier|*
name|retur
decl_stmt|;
name|int
name|y
decl_stmt|,
name|x
decl_stmt|,
name|x_4
decl_stmt|,
name|x_3
decl_stmt|,
name|x_2
decl_stmt|,
name|x_1
decl_stmt|,
name|x1
decl_stmt|,
name|x2
decl_stmt|,
name|x3
decl_stmt|,
name|x4
decl_stmt|,
name|x5
decl_stmt|;
name|unsigned
name|char
modifier|*
name|source
decl_stmt|;
name|unsigned
name|char
modifier|*
name|dest
decl_stmt|;
name|int
name|height
decl_stmt|,
name|width
decl_stmt|,
name|max_height
decl_stmt|,
name|max_width
decl_stmt|;
name|retur
operator|=
name|mask_buf_new
argument_list|(
name|mask
operator|->
name|width
argument_list|,
name|mask
operator|->
name|height
argument_list|)
expr_stmt|;
name|source
operator|=
name|mask
operator|->
name|data
expr_stmt|;
name|dest
operator|=
name|retur
operator|->
name|data
expr_stmt|;
name|width
operator|=
name|mask
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|mask
operator|->
name|height
expr_stmt|;
name|max_height
operator|=
name|width
operator|*
name|height
operator|-
literal|3
operator|*
name|width
expr_stmt|;
name|max_width
operator|=
name|width
operator|-
literal|5
expr_stmt|;
name|y
operator|=
name|width
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|max_height
condition|;
name|y
operator|+=
name|width
control|)
block|{
for|for
control|(
name|x_4
operator|=
literal|0
operator|,
name|x_3
operator|=
literal|1
operator|,
name|x_2
operator|=
literal|2
operator|,
name|x_1
operator|=
literal|3
operator|,
name|x
operator|=
literal|4
operator|,
name|x1
operator|=
literal|5
operator|,
name|x2
operator|=
literal|6
operator|,
name|x3
operator|=
literal|7
operator|,
name|x4
operator|=
literal|8
operator|,
name|x5
operator|=
literal|9
init|;
name|x
operator|<
name|max_width
condition|;
name|x_3
operator|++
operator|,
name|x_2
operator|++
operator|,
name|x_1
operator|++
operator|,
name|x
operator|++
operator|,
name|x1
operator|++
operator|,
name|x2
operator|++
operator|,
name|x3
operator|++
control|)
block|{
name|dest
index|[
name|y
operator|+
name|x
index|]
operator|=
operator|(
literal|4
operator|*
name|source
index|[
name|y
operator|+
name|x_4
index|]
operator|+
literal|4
operator|*
name|source
index|[
name|y
operator|+
name|x_3
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y
operator|+
name|x_2
index|]
operator|+
literal|16
operator|*
name|source
index|[
name|y
operator|+
name|x_1
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y
operator|+
name|x
index|]
operator|+
literal|16
operator|*
name|source
index|[
name|y
operator|+
name|x1
index|]
operator|+
literal|8
operator|*
name|source
index|[
name|y
operator|+
name|x2
index|]
operator|+
literal|4
operator|*
name|source
index|[
name|y
operator|+
name|x3
index|]
operator|+
literal|2
operator|*
name|source
index|[
name|y
operator|+
name|x4
index|]
operator|+
literal|1
operator|*
name|source
index|[
name|y
operator|+
name|x5
index|]
operator|)
operator|/
literal|64
expr_stmt|;
block|}
block|}
name|mask_buf_free
argument_list|(
name|mask
argument_list|)
expr_stmt|;
return|return
name|retur
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_paste (XinputAirbrushTool * xinput_airbrush_tool,GimpDrawable * drawable,MaskBuf * brush_mask_in,int x,int y,int width,int height)
name|xinput_airbrush_paste
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|MaskBuf
modifier|*
name|brush_mask_in
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|;
name|int
name|offx
decl_stmt|,
name|offy
decl_stmt|;
name|int
name|size
decl_stmt|;
name|unsigned
name|char
name|col
index|[
name|MAX_CHANNELS
index|]
decl_stmt|;
name|MaskBuf
modifier|*
name|brush_mask1
decl_stmt|;
name|MaskBuf
modifier|*
name|brush_mask3
decl_stmt|;
name|MaskBuf
modifier|*
name|brush_mask2
decl_stmt|;
name|MaskBuf
modifier|*
name|brush_mask
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|drawable_gimage
argument_list|(
name|drawable
argument_list|)
operator|)
condition|)
return|return;
name|size
operator|=
name|height
operator|*
name|width
expr_stmt|;
name|brush_mask1
operator|=
name|mask_buf_new
argument_list|(
name|brush_mask_in
operator|->
name|width
argument_list|,
name|brush_mask_in
operator|->
name|height
argument_list|)
expr_stmt|;
name|brush_mask1
operator|=
name|temp_buf_copy
argument_list|(
name|brush_mask_in
argument_list|,
name|brush_mask1
argument_list|)
expr_stmt|;
comment|/* printf("Size: %d\n", size); */
if|if
condition|(
name|size
operator|<=
literal|40
condition|)
block|{
name|brush_mask1
operator|=
name|blur_mask_1
argument_list|(
name|brush_mask1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|size
operator|>=
literal|40
operator|)
operator|&&
operator|(
name|size
operator|<=
literal|90
operator|)
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|brush_mask2
operator|=
name|blur_mask_1
argument_list|(
name|brush_mask1
argument_list|)
expr_stmt|;
name|brush_mask3
operator|=
name|blur_mask_1
argument_list|(
name|brush_mask2
argument_list|)
expr_stmt|;
name|brush_mask1
operator|=
name|blur_mask_1
argument_list|(
name|brush_mask3
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|size
operator|>=
literal|91
operator|)
operator|&&
operator|(
name|size
operator|<=
literal|1000
operator|)
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|brush_mask2
operator|=
name|blur_mask_3
argument_list|(
name|brush_mask1
argument_list|)
expr_stmt|;
name|brush_mask3
operator|=
name|blur_mask_3
argument_list|(
name|brush_mask2
argument_list|)
expr_stmt|;
name|brush_mask1
operator|=
name|blur_mask_3
argument_list|(
name|brush_mask3
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|(
name|size
operator|>=
literal|1001
operator|)
operator|&&
operator|(
name|size
operator|<=
literal|5000
operator|)
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|brush_mask2
operator|=
name|blur_mask_4
argument_list|(
name|brush_mask1
argument_list|)
expr_stmt|;
name|brush_mask3
operator|=
name|blur_mask_4
argument_list|(
name|brush_mask2
argument_list|)
expr_stmt|;
name|brush_mask1
operator|=
name|blur_mask_3
argument_list|(
name|brush_mask3
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|size
operator|>=
literal|5001
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|brush_mask2
operator|=
name|blur_mask_3
argument_list|(
name|brush_mask1
argument_list|)
expr_stmt|;
name|brush_mask3
operator|=
name|blur_mask_4
argument_list|(
name|brush_mask2
argument_list|)
expr_stmt|;
name|brush_mask1
operator|=
name|blur_mask_3
argument_list|(
name|brush_mask3
argument_list|)
expr_stmt|;
block|}
block|}
name|brush_mask
operator|=
name|brush_mask1
expr_stmt|;
comment|/* Get the the buffer */
name|xinput_airbrush_set_paint_area
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|drawable
argument_list|,
name|x
operator|-
literal|1
argument_list|,
name|y
operator|-
literal|1
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* check to make sure there is actually a canvas to draw on */
if|if
condition|(
operator|!
name|canvas_buf
condition|)
return|return;
name|gimage_get_foreground
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
name|col
argument_list|)
expr_stmt|;
comment|/*  set the alpha channel  */
name|col
index|[
name|canvas_buf
operator|->
name|bytes
operator|-
literal|1
index|]
operator|=
name|OPAQUE_OPACITY
expr_stmt|;
comment|/*  color the pixels  */
name|color_pixels
argument_list|(
name|temp_buf_data
argument_list|(
name|canvas_buf
argument_list|)
argument_list|,
name|col
argument_list|,
name|canvas_buf
operator|->
name|width
operator|*
name|canvas_buf
operator|->
name|height
argument_list|,
name|canvas_buf
operator|->
name|bytes
argument_list|)
expr_stmt|;
comment|/*  set undo blocks  */
name|xinput_airbrush_set_undo_tiles
argument_list|(
name|drawable
argument_list|,
name|canvas_buf
operator|->
name|x
argument_list|,
name|canvas_buf
operator|->
name|y
argument_list|,
name|canvas_buf
operator|->
name|width
argument_list|,
name|canvas_buf
operator|->
name|height
argument_list|)
expr_stmt|;
comment|/*  initialize any invalid canvas tiles  */
name|xinput_airbrush_set_canvas_tiles
argument_list|(
name|canvas_buf
operator|->
name|x
argument_list|,
name|canvas_buf
operator|->
name|y
argument_list|,
name|canvas_buf
operator|->
name|width
argument_list|,
name|canvas_buf
operator|->
name|height
argument_list|)
expr_stmt|;
comment|/*DON'T FORGETT THE 100 VALUE, I.E. THE BRUSH OPACITY WHICH SHOULD BE 255*/
name|xinput_airbrush_to_canvas_tiles
argument_list|(
name|xinput_airbrush_tool
argument_list|,
name|brush_mask
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|xinput_airbrush_canvas_tiles_to_canvas_buf
argument_list|(
name|xinput_airbrush_tool
argument_list|)
expr_stmt|;
comment|/*  initialize canvas buf source pixel regions  */
name|srcPR
operator|.
name|bytes
operator|=
name|canvas_buf
operator|->
name|bytes
expr_stmt|;
name|srcPR
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|srcPR
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|srcPR
operator|.
name|w
operator|=
name|canvas_buf
operator|->
name|width
expr_stmt|;
name|srcPR
operator|.
name|h
operator|=
name|canvas_buf
operator|->
name|height
expr_stmt|;
name|srcPR
operator|.
name|rowstride
operator|=
name|canvas_buf
operator|->
name|width
operator|*
name|canvas_buf
operator|->
name|bytes
expr_stmt|;
name|srcPR
operator|.
name|data
operator|=
name|temp_buf_data
argument_list|(
name|canvas_buf
argument_list|)
expr_stmt|;
comment|/*  apply the paint area to the gimage  */
name|gimage_apply_image
argument_list|(
name|gimage
argument_list|,
name|drawable
argument_list|,
operator|&
name|srcPR
argument_list|,
name|FALSE
argument_list|,
call|(
name|int
call|)
argument_list|(
name|gimp_context_get_opacity
argument_list|(
name|NULL
argument_list|)
operator|*
literal|255
argument_list|)
argument_list|,
name|gimp_context_get_paint_mode
argument_list|(
name|NULL
argument_list|)
argument_list|,
name|undo_tiles
argument_list|,
comment|/*  specify an alternative src1  */
name|canvas_buf
operator|->
name|x
argument_list|,
name|canvas_buf
operator|->
name|y
argument_list|)
expr_stmt|;
comment|/*  Update the undo extents  */
name|xinput_airbrush_tool
operator|->
name|x1
operator|=
name|MIN
argument_list|(
name|xinput_airbrush_tool
operator|->
name|x1
argument_list|,
name|canvas_buf
operator|->
name|x
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|y1
operator|=
name|MIN
argument_list|(
name|xinput_airbrush_tool
operator|->
name|y1
argument_list|,
name|canvas_buf
operator|->
name|y
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|x2
operator|=
name|MAX
argument_list|(
name|xinput_airbrush_tool
operator|->
name|x2
argument_list|,
operator|(
name|canvas_buf
operator|->
name|x
operator|+
name|canvas_buf
operator|->
name|width
operator|)
argument_list|)
expr_stmt|;
name|xinput_airbrush_tool
operator|->
name|y2
operator|=
name|MAX
argument_list|(
name|xinput_airbrush_tool
operator|->
name|y2
argument_list|,
operator|(
name|canvas_buf
operator|->
name|y
operator|+
name|canvas_buf
operator|->
name|height
operator|)
argument_list|)
expr_stmt|;
comment|/*  Update the gimage--it is important to call gdisplays_update_area    *  instead of drawable_update because we don't want the drawable    *  preview to be constantly invalidated    */
name|drawable_offsets
argument_list|(
name|drawable
argument_list|,
operator|&
name|offx
argument_list|,
operator|&
name|offy
argument_list|)
expr_stmt|;
name|gdisplays_update_area
argument_list|(
name|gimage
argument_list|,
name|canvas_buf
operator|->
name|x
operator|+
name|offx
argument_list|,
name|canvas_buf
operator|->
name|y
operator|+
name|offy
argument_list|,
name|canvas_buf
operator|->
name|width
argument_list|,
name|canvas_buf
operator|->
name|height
argument_list|)
expr_stmt|;
name|mask_buf_free
argument_list|(
name|brush_mask
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_to_canvas_tiles (XinputAirbrushTool * xinput_airbrush_tool,MaskBuf * brush_mask,int brush_opacity)
name|xinput_airbrush_to_canvas_tiles
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|,
name|MaskBuf
modifier|*
name|brush_mask
parameter_list|,
name|int
name|brush_opacity
parameter_list|)
block|{
name|PixelRegion
name|srcPR
decl_stmt|,
name|maskPR
decl_stmt|;
comment|/*   combine the brush mask and the canvas tiles  */
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|canvas_tiles
argument_list|,
name|canvas_buf
operator|->
name|x
argument_list|,
name|canvas_buf
operator|->
name|y
argument_list|,
name|canvas_buf
operator|->
name|width
argument_list|,
name|canvas_buf
operator|->
name|height
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|maskPR
operator|.
name|bytes
operator|=
literal|1
expr_stmt|;
name|maskPR
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|maskPR
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|maskPR
operator|.
name|w
operator|=
name|srcPR
operator|.
name|w
expr_stmt|;
name|maskPR
operator|.
name|h
operator|=
name|srcPR
operator|.
name|h
expr_stmt|;
name|maskPR
operator|.
name|rowstride
operator|=
name|maskPR
operator|.
name|bytes
operator|*
name|brush_mask
operator|->
name|width
expr_stmt|;
name|maskPR
operator|.
name|data
operator|=
name|mask_buf_data
argument_list|(
name|brush_mask
argument_list|)
expr_stmt|;
comment|/*  combine the mask to the canvas tiles  */
name|combine_mask_and_region
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|maskPR
argument_list|,
name|brush_opacity
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_canvas_tiles_to_canvas_buf (XinputAirbrushTool * xinput_airbrush_tool)
name|xinput_airbrush_canvas_tiles_to_canvas_buf
parameter_list|(
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
parameter_list|)
block|{
name|PixelRegion
name|srcPR
decl_stmt|,
name|maskPR
decl_stmt|;
comment|/*  combine the canvas tiles and the canvas buf  */
name|srcPR
operator|.
name|bytes
operator|=
name|canvas_buf
operator|->
name|bytes
expr_stmt|;
name|srcPR
operator|.
name|x
operator|=
literal|0
expr_stmt|;
name|srcPR
operator|.
name|y
operator|=
literal|0
expr_stmt|;
name|srcPR
operator|.
name|w
operator|=
name|canvas_buf
operator|->
name|width
expr_stmt|;
name|srcPR
operator|.
name|h
operator|=
name|canvas_buf
operator|->
name|height
expr_stmt|;
name|srcPR
operator|.
name|rowstride
operator|=
name|canvas_buf
operator|->
name|width
operator|*
name|canvas_buf
operator|->
name|bytes
expr_stmt|;
name|srcPR
operator|.
name|data
operator|=
name|temp_buf_data
argument_list|(
name|canvas_buf
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|maskPR
argument_list|,
name|canvas_tiles
argument_list|,
name|canvas_buf
operator|->
name|x
argument_list|,
name|canvas_buf
operator|->
name|y
argument_list|,
name|canvas_buf
operator|->
name|width
argument_list|,
name|canvas_buf
operator|->
name|height
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  apply the canvas tiles to the canvas buf  */
name|apply_mask_to_region
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|maskPR
argument_list|,
name|OPAQUE_OPACITY
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_set_undo_tiles (GimpDrawable * drawable,int x,int y,int w,int h)
name|xinput_airbrush_set_undo_tiles
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|Tile
modifier|*
name|src_tile
decl_stmt|;
name|Tile
modifier|*
name|dest_tile
decl_stmt|;
for|for
control|(
name|i
operator|=
name|y
init|;
name|i
operator|<
operator|(
name|y
operator|+
name|h
operator|)
condition|;
name|i
operator|+=
operator|(
name|TILE_HEIGHT
operator|-
operator|(
name|i
operator|%
name|TILE_HEIGHT
operator|)
operator|)
control|)
block|{
for|for
control|(
name|j
operator|=
name|x
init|;
name|j
operator|<
operator|(
name|x
operator|+
name|w
operator|)
condition|;
name|j
operator|+=
operator|(
name|TILE_WIDTH
operator|-
operator|(
name|j
operator|%
name|TILE_WIDTH
operator|)
operator|)
control|)
block|{
name|dest_tile
operator|=
name|tile_manager_get_tile
argument_list|(
name|undo_tiles
argument_list|,
name|j
argument_list|,
name|i
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|tile_is_valid
argument_list|(
name|dest_tile
argument_list|)
operator|==
name|FALSE
condition|)
block|{
name|src_tile
operator|=
name|tile_manager_get_tile
argument_list|(
name|drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|j
argument_list|,
name|i
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|tile_manager_map_tile
argument_list|(
name|undo_tiles
argument_list|,
name|j
argument_list|,
name|i
argument_list|,
name|src_tile
argument_list|)
expr_stmt|;
name|tile_release
argument_list|(
name|src_tile
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|xinput_airbrush_set_canvas_tiles (int x,int y,int w,int h)
name|xinput_airbrush_set_canvas_tiles
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|w
parameter_list|,
name|int
name|h
parameter_list|)
block|{
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|Tile
modifier|*
name|tile
decl_stmt|;
for|for
control|(
name|i
operator|=
name|y
init|;
name|i
operator|<
operator|(
name|y
operator|+
name|h
operator|)
condition|;
name|i
operator|+=
operator|(
name|TILE_HEIGHT
operator|-
operator|(
name|i
operator|%
name|TILE_HEIGHT
operator|)
operator|)
control|)
block|{
for|for
control|(
name|j
operator|=
name|x
init|;
name|j
operator|<
operator|(
name|x
operator|+
name|w
operator|)
condition|;
name|j
operator|+=
operator|(
name|TILE_WIDTH
operator|-
operator|(
name|j
operator|%
name|TILE_WIDTH
operator|)
operator|)
control|)
block|{
name|tile
operator|=
name|tile_manager_get_tile
argument_list|(
name|canvas_tiles
argument_list|,
name|j
argument_list|,
name|i
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|tile_is_valid
argument_list|(
name|tile
argument_list|)
operator|==
name|FALSE
condition|)
block|{
name|tile
operator|=
name|tile_manager_get_tile
argument_list|(
name|canvas_tiles
argument_list|,
name|j
argument_list|,
name|i
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|memset
argument_list|(
name|tile_data_pointer
argument_list|(
name|tile
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|,
name|tile_size
argument_list|(
name|tile
argument_list|)
argument_list|)
expr_stmt|;
name|tile_release
argument_list|(
name|tile
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_comment
comment|/**************************/
end_comment

begin_comment
comment|/*  Global xinput_airbrush functions  */
end_comment

begin_comment
comment|/**************************/
end_comment

begin_function
name|void
DECL|function|xinput_airbrush_no_draw (Tool * tool)
name|xinput_airbrush_no_draw
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|)
block|{
return|return;
block|}
end_function

begin_function
name|Tool
modifier|*
DECL|function|tools_new_xinput_airbrush (void)
name|tools_new_xinput_airbrush
parameter_list|(
name|void
parameter_list|)
block|{
name|Tool
modifier|*
name|tool
decl_stmt|;
name|XinputAirbrushTool
modifier|*
name|private
decl_stmt|;
comment|/*  The tool options  */
if|if
condition|(
operator|!
name|xinput_airbrush_options
condition|)
block|{
name|xinput_airbrush_options
operator|=
name|xinput_airbrush_options_new
argument_list|()
expr_stmt|;
name|tools_register
argument_list|(
name|XINPUT_AIRBRUSH
argument_list|,
operator|(
name|ToolOptions
operator|*
operator|)
name|xinput_airbrush_options
argument_list|)
expr_stmt|;
comment|/*  press all default buttons  */
name|xinput_airbrush_options_reset
argument_list|()
expr_stmt|;
block|}
name|tool
operator|=
name|tools_new_tool
argument_list|(
name|XINPUT_AIRBRUSH
argument_list|)
expr_stmt|;
name|private
operator|=
name|g_new
argument_list|(
name|XinputAirbrushTool
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|private
operator|->
name|core
operator|=
name|draw_core_new
argument_list|(
name|xinput_airbrush_no_draw
argument_list|)
expr_stmt|;
name|private
operator|->
name|last_airbrush_blob
operator|=
name|NULL
expr_stmt|;
name|tool
operator|->
name|private
operator|=
name|private
expr_stmt|;
name|tool
operator|->
name|button_press_func
operator|=
name|xinput_airbrush_button_press
expr_stmt|;
name|tool
operator|->
name|button_release_func
operator|=
name|xinput_airbrush_button_release
expr_stmt|;
name|tool
operator|->
name|motion_func
operator|=
name|xinput_airbrush_motion
expr_stmt|;
name|tool
operator|->
name|cursor_update_func
operator|=
name|xinput_airbrush_cursor_update
expr_stmt|;
name|tool
operator|->
name|control_func
operator|=
name|xinput_airbrush_control
expr_stmt|;
return|return
name|tool
return|;
block|}
end_function

begin_function
name|void
DECL|function|tools_free_xinput_airbrush (Tool * tool)
name|tools_free_xinput_airbrush
parameter_list|(
name|Tool
modifier|*
name|tool
parameter_list|)
block|{
name|XinputAirbrushTool
modifier|*
name|xinput_airbrush_tool
decl_stmt|;
name|xinput_airbrush_tool
operator|=
operator|(
name|XinputAirbrushTool
operator|*
operator|)
name|tool
operator|->
name|private
expr_stmt|;
comment|/*  Make sure the selection core is not visible  */
if|if
condition|(
name|tool
operator|->
name|state
operator|==
name|ACTIVE
operator|&&
name|xinput_airbrush_tool
operator|->
name|core
condition|)
name|draw_core_stop
argument_list|(
name|xinput_airbrush_tool
operator|->
name|core
argument_list|,
name|tool
argument_list|)
expr_stmt|;
comment|/*  Free the selection core  */
if|if
condition|(
name|xinput_airbrush_tool
operator|->
name|core
condition|)
name|draw_core_free
argument_list|(
name|xinput_airbrush_tool
operator|->
name|core
argument_list|)
expr_stmt|;
comment|/*  Free the last airbrush_blob, if any */
if|if
condition|(
name|xinput_airbrush_tool
operator|->
name|last_airbrush_blob
condition|)
name|g_free
argument_list|(
name|xinput_airbrush_tool
operator|->
name|last_airbrush_blob
argument_list|)
expr_stmt|;
comment|/*  Cleanup memory  */
name|xinput_airbrush_cleanup
argument_list|()
expr_stmt|;
comment|/*  Free the paint core  */
name|g_free
argument_list|(
name|xinput_airbrush_tool
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

