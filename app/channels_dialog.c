begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|"gdk/gdkkeysyms.h"
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"actionarea.h"
end_include

begin_include
include|#
directive|include
file|"buildmenu.h"
end_include

begin_include
include|#
directive|include
file|"channels_dialog.h"
end_include

begin_include
include|#
directive|include
file|"colormaps.h"
end_include

begin_include
include|#
directive|include
file|"color_panel.h"
end_include

begin_include
include|#
directive|include
file|"drawable.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimage.h"
end_include

begin_include
include|#
directive|include
file|"gimage_mask.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"layers_dialogP.h"
end_include

begin_include
include|#
directive|include
file|"ops_buttons.h"
end_include

begin_include
include|#
directive|include
file|"paint_funcs.h"
end_include

begin_include
include|#
directive|include
file|"palette.h"
end_include

begin_include
include|#
directive|include
file|"resize.h"
end_include

begin_include
include|#
directive|include
file|"tools/eye.xbm"
end_include

begin_include
include|#
directive|include
file|"tools/channel.xbm"
end_include

begin_include
include|#
directive|include
file|"tools/new.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/new_is.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/raise.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/raise_is.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/lower.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/lower_is.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/duplicate.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/duplicate_is.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/delete.xpm"
end_include

begin_include
include|#
directive|include
file|"tools/delete_is.xpm"
end_include

begin_include
include|#
directive|include
file|"channel_pvt.h"
end_include

begin_define
DECL|macro|PREVIEW_EVENT_MASK
define|#
directive|define
name|PREVIEW_EVENT_MASK
value|GDK_EXPOSURE_MASK | GDK_BUTTON_PRESS_MASK | GDK_ENTER_NOTIFY_MASK
end_define

begin_define
DECL|macro|BUTTON_EVENT_MASK
define|#
directive|define
name|BUTTON_EVENT_MASK
value|GDK_EXPOSURE_MASK | GDK_ENTER_NOTIFY_MASK | GDK_LEAVE_NOTIFY_MASK | \                            GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK
end_define

begin_define
DECL|macro|CHANNEL_LIST_WIDTH
define|#
directive|define
name|CHANNEL_LIST_WIDTH
value|200
end_define

begin_define
DECL|macro|CHANNEL_LIST_HEIGHT
define|#
directive|define
name|CHANNEL_LIST_HEIGHT
value|150
end_define

begin_define
DECL|macro|NORMAL
define|#
directive|define
name|NORMAL
value|0
end_define

begin_define
DECL|macro|SELECTED
define|#
directive|define
name|SELECTED
value|1
end_define

begin_define
DECL|macro|INSENSITIVE
define|#
directive|define
name|INSENSITIVE
value|2
end_define

begin_define
DECL|macro|COMPONENT_BASE_ID
define|#
directive|define
name|COMPONENT_BASE_ID
value|0x10000000
end_define

begin_typedef
DECL|typedef|ChannelWidget
typedef|typedef
name|struct
name|_ChannelWidget
name|ChannelWidget
typedef|;
end_typedef

begin_struct
DECL|struct|_ChannelWidget
struct|struct
name|_ChannelWidget
block|{
DECL|member|eye_widget
name|GtkWidget
modifier|*
name|eye_widget
decl_stmt|;
DECL|member|clip_widget
name|GtkWidget
modifier|*
name|clip_widget
decl_stmt|;
DECL|member|channel_preview
name|GtkWidget
modifier|*
name|channel_preview
decl_stmt|;
DECL|member|list_item
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
DECL|member|label
name|GtkWidget
modifier|*
name|label
decl_stmt|;
DECL|member|gimage
name|GImage
modifier|*
name|gimage
decl_stmt|;
DECL|member|channel
name|Channel
modifier|*
name|channel
decl_stmt|;
DECL|member|channel_pixmap
name|GdkPixmap
modifier|*
name|channel_pixmap
decl_stmt|;
DECL|member|type
name|ChannelType
name|type
decl_stmt|;
DECL|member|ID
name|int
name|ID
decl_stmt|;
DECL|member|width
DECL|member|height
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
DECL|member|visited
name|int
name|visited
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|ChannelsDialog
typedef|typedef
name|struct
name|_ChannelsDialog
name|ChannelsDialog
typedef|;
end_typedef

begin_struct
DECL|struct|_ChannelsDialog
struct|struct
name|_ChannelsDialog
block|{
DECL|member|vbox
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
DECL|member|channel_list
name|GtkWidget
modifier|*
name|channel_list
decl_stmt|;
DECL|member|preview
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
DECL|member|ops_menu
name|GtkWidget
modifier|*
name|ops_menu
decl_stmt|;
DECL|member|accel_table
name|GtkAcceleratorTable
modifier|*
name|accel_table
decl_stmt|;
DECL|member|num_components
name|int
name|num_components
decl_stmt|;
DECL|member|base_type
name|int
name|base_type
decl_stmt|;
DECL|member|components
name|ChannelType
name|components
index|[
literal|3
index|]
decl_stmt|;
DECL|member|ratio
name|double
name|ratio
decl_stmt|;
DECL|member|image_width
DECL|member|image_height
name|int
name|image_width
decl_stmt|,
name|image_height
decl_stmt|;
DECL|member|gimage_width
DECL|member|gimage_height
name|int
name|gimage_width
decl_stmt|,
name|gimage_height
decl_stmt|;
comment|/*  state information  */
DECL|member|gimage_id
name|int
name|gimage_id
decl_stmt|;
DECL|member|active_channel
name|Channel
modifier|*
name|active_channel
decl_stmt|;
DECL|member|floating_sel
name|Layer
modifier|*
name|floating_sel
decl_stmt|;
DECL|member|channel_widgets
name|GSList
modifier|*
name|channel_widgets
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  channels dialog widget routines  */
end_comment

begin_function_decl
specifier|static
name|void
name|channels_dialog_preview_extents
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_set_menu_sensitivity
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_set_channel
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_unset_channel
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_position_channel
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|,
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_add_channel
parameter_list|(
name|Channel
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_remove_channel
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|channel_list_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  channels dialog menu callbacks  */
end_comment

begin_function_decl
specifier|static
name|void
name|channels_dialog_map_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_unmap_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_new_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_raise_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_lower_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_duplicate_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_delete_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_channel_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  channel widget function prototypes  */
end_comment

begin_function_decl
specifier|static
name|ChannelWidget
modifier|*
name|channel_widget_get_ID
parameter_list|(
name|Channel
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|ChannelWidget
modifier|*
name|create_channel_widget
parameter_list|(
name|GImage
modifier|*
parameter_list|,
name|Channel
modifier|*
parameter_list|,
name|ChannelType
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_delete
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_select_update
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|channel_widget_button_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|channel_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|GdkEvent
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_no_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_eye_redraw
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_exclusive_visible
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_channel_flush
parameter_list|(
name|GtkWidget
modifier|*
parameter_list|,
name|gpointer
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  assorted query dialogs  */
end_comment

begin_function_decl
specifier|static
name|void
name|channels_dialog_new_channel_query
parameter_list|(
name|int
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_edit_channel_query
parameter_list|(
name|ChannelWidget
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  Only one channels dialog  */
end_comment

begin_decl_stmt
DECL|variable|channelsD
specifier|static
name|ChannelsDialog
modifier|*
name|channelsD
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|eye_pixmap
specifier|static
name|GdkPixmap
modifier|*
name|eye_pixmap
index|[
literal|3
index|]
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channel_pixmap
specifier|static
name|GdkPixmap
modifier|*
name|channel_pixmap
index|[
literal|3
index|]
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|suspend_gimage_notify
specifier|static
name|int
name|suspend_gimage_notify
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|button_click_time
specifier|static
name|guint32
name|button_click_time
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|button_last_id
specifier|static
name|int
name|button_last_id
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channels_ops
specifier|static
name|MenuItem
name|channels_ops
index|[]
init|=
block|{
block|{
literal|"New Channel"
block|,
literal|'N'
block|,
name|GDK_CONTROL_MASK
block|,
name|channels_dialog_new_channel_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"Raise Channel"
block|,
literal|'F'
block|,
name|GDK_CONTROL_MASK
block|,
name|channels_dialog_raise_channel_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"Lower Channel"
block|,
literal|'B'
block|,
name|GDK_CONTROL_MASK
block|,
name|channels_dialog_lower_channel_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"Duplicate Channel"
block|,
literal|'C'
block|,
name|GDK_CONTROL_MASK
block|,
name|channels_dialog_duplicate_channel_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"Delete Channel"
block|,
literal|'X'
block|,
name|GDK_CONTROL_MASK
block|,
name|channels_dialog_delete_channel_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"Channel To Selection"
block|,
literal|'S'
block|,
name|GDK_CONTROL_MASK
block|,
name|channels_dialog_channel_to_sel_callback
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
literal|0
block|,
literal|0
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* the ops buttons */
end_comment

begin_decl_stmt
DECL|variable|channels_ops_buttons
specifier|static
name|OpsButton
name|channels_ops_buttons
index|[]
init|=
block|{
block|{
name|new_xpm
block|,
name|new_is_xpm
block|,
name|channels_dialog_new_channel_callback
block|,
literal|"New Channel"
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|raise_xpm
block|,
name|raise_is_xpm
block|,
name|channels_dialog_raise_channel_callback
block|,
literal|"Raise Channel"
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|lower_xpm
block|,
name|lower_is_xpm
block|,
name|channels_dialog_lower_channel_callback
block|,
literal|"Lower Channel"
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|duplicate_xpm
block|,
name|duplicate_is_xpm
block|,
name|channels_dialog_duplicate_channel_callback
block|,
literal|"Duplicate Channel"
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|delete_xpm
block|,
name|delete_is_xpm
block|,
name|channels_dialog_delete_channel_callback
block|,
literal|"Delete Channel"
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**************************************/
end_comment

begin_comment
comment|/*  Public channels dialog functions  */
end_comment

begin_comment
comment|/**************************************/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|channels_dialog_create ()
name|channels_dialog_create
parameter_list|()
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|listbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button_box
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
block|{
name|channelsD
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ChannelsDialog
argument_list|)
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|preview
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|gimage_id
operator|=
operator|-
literal|1
expr_stmt|;
name|channelsD
operator|->
name|active_channel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|floating_sel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|accel_table
operator|=
name|gtk_accelerator_table_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|preview_size
condition|)
block|{
name|channelsD
operator|->
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_GRAYSCALE
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|channelsD
operator|->
name|preview
argument_list|)
argument_list|,
name|preview_size
argument_list|,
name|preview_size
argument_list|)
expr_stmt|;
block|}
comment|/*  The main vbox  */
name|channelsD
operator|->
name|vbox
operator|=
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|/*  The layers commands pulldown menu  */
name|channelsD
operator|->
name|ops_menu
operator|=
name|build_menu
argument_list|(
name|channels_ops
argument_list|,
name|channelsD
operator|->
name|accel_table
argument_list|)
expr_stmt|;
comment|/*  The channels listbox  */
name|listbox
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|listbox
argument_list|,
name|CHANNEL_LIST_WIDTH
argument_list|,
name|CHANNEL_LIST_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|listbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_list
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|listbox
argument_list|)
argument_list|,
name|channelsD
operator|->
name|channel_list
argument_list|)
expr_stmt|;
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|GTK_SELECTION_MULTIPLE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channel_list_events
argument_list|,
name|channelsD
argument_list|)
expr_stmt|;
name|gtk_container_set_focus_vadjustment
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|listbox
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|listbox
argument_list|)
operator|->
name|vscrollbar
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|listbox
argument_list|)
expr_stmt|;
comment|/* The ops buttons */
name|button_box
operator|=
name|ops_button_box_new
argument_list|(
name|lc_shell
argument_list|,
name|tool_tips
argument_list|,
name|channels_ops_buttons
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button_box
argument_list|)
expr_stmt|;
comment|/*  Set up signals for map/unmap for the accelerators  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channels_dialog_map_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|vbox
argument_list|)
argument_list|,
literal|"unmap"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channels_dialog_unmap_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
block|}
return|return
name|channelsD
operator|->
name|vbox
return|;
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_flush ()
name|channels_dialog_flush
parameter_list|()
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|Channel
modifier|*
name|channel
decl_stmt|;
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|int
name|gimage_pos
decl_stmt|;
name|int
name|pos
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
comment|/*  Check if the gimage extents have changed  */
if|if
condition|(
operator|(
name|gimage
operator|->
name|width
operator|!=
name|channelsD
operator|->
name|gimage_width
operator|)
operator|||
operator|(
name|gimage
operator|->
name|height
operator|!=
name|channelsD
operator|->
name|gimage_height
operator|)
operator|||
operator|(
name|gimage_base_type
argument_list|(
name|gimage
argument_list|)
operator|!=
name|channelsD
operator|->
name|base_type
operator|)
condition|)
block|{
name|channelsD
operator|->
name|gimage_id
operator|=
operator|-
literal|1
expr_stmt|;
name|channels_dialog_update
argument_list|(
name|gimage
operator|->
name|ID
argument_list|)
expr_stmt|;
block|}
comment|/*  Set all current channel widgets to visited = FALSE  */
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|cw
operator|->
name|visited
operator|=
name|FALSE
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
comment|/*  Add any missing channels  */
name|list
operator|=
name|gimage
operator|->
name|channels
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|channel
operator|=
operator|(
name|Channel
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|cw
operator|=
name|channel_widget_get_ID
argument_list|(
name|channel
argument_list|)
expr_stmt|;
comment|/*  If the channel isn't in the channel widget list, add it  */
if|if
condition|(
name|cw
operator|==
name|NULL
condition|)
name|channels_dialog_add_channel
argument_list|(
name|channel
argument_list|)
expr_stmt|;
else|else
name|cw
operator|->
name|visited
operator|=
name|TRUE
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
comment|/*  Remove any extraneous auxillary channels  */
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
if|if
condition|(
name|cw
operator|->
name|visited
operator|==
name|FALSE
operator|&&
name|cw
operator|->
name|type
operator|==
name|Auxillary
condition|)
comment|/*  will only be true for auxillary channels  */
name|channels_dialog_remove_channel
argument_list|(
name|cw
argument_list|)
expr_stmt|;
block|}
comment|/*  Switch positions of items if necessary  */
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
name|pos
operator|=
operator|-
name|channelsD
operator|->
name|num_components
operator|+
literal|1
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
if|if
condition|(
name|cw
operator|->
name|type
operator|==
name|Auxillary
condition|)
if|if
condition|(
operator|(
name|gimage_pos
operator|=
name|gimage_get_channel_index
argument_list|(
name|gimage
argument_list|,
name|cw
operator|->
name|channel
argument_list|)
operator|)
operator|!=
name|pos
condition|)
name|channels_dialog_position_channel
argument_list|(
name|cw
argument_list|,
name|gimage_pos
argument_list|)
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
comment|/*  Set the active channel  */
if|if
condition|(
name|channelsD
operator|->
name|active_channel
operator|!=
name|gimage
operator|->
name|active_channel
condition|)
name|channelsD
operator|->
name|active_channel
operator|=
name|gimage
operator|->
name|active_channel
expr_stmt|;
comment|/*  set the menus if floating sel status has changed  */
if|if
condition|(
name|channelsD
operator|->
name|floating_sel
operator|!=
name|gimage
operator|->
name|floating_sel
condition|)
name|channelsD
operator|->
name|floating_sel
operator|=
name|gimage
operator|->
name|floating_sel
expr_stmt|;
name|channels_dialog_set_menu_sensitivity
argument_list|()
expr_stmt|;
name|gtk_container_foreach
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|channel_widget_channel_flush
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*************************************/
end_comment

begin_comment
comment|/*  channels dialog widget routines  */
end_comment

begin_comment
comment|/*************************************/
end_comment

begin_function
name|void
DECL|function|channels_dialog_update (int gimage_id)
name|channels_dialog_update
parameter_list|(
name|int
name|gimage_id
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|Channel
modifier|*
name|channel
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|GList
modifier|*
name|item_list
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
name|channelsD
operator|->
name|gimage_id
operator|==
name|gimage_id
condition|)
return|return;
name|channelsD
operator|->
name|gimage_id
operator|=
name|gimage_id
expr_stmt|;
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Free all elements in the channels listbox  */
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|channel_widget_delete
argument_list|(
name|cw
argument_list|)
expr_stmt|;
block|}
name|channelsD
operator|->
name|channel_widgets
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
comment|/*  Find the preview extents  */
name|channels_dialog_preview_extents
argument_list|()
expr_stmt|;
name|channelsD
operator|->
name|active_channel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|floating_sel
operator|=
name|NULL
expr_stmt|;
comment|/*  The image components  */
name|item_list
operator|=
name|NULL
expr_stmt|;
switch|switch
condition|(
operator|(
name|channelsD
operator|->
name|base_type
operator|=
name|gimage_base_type
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
case|case
name|RGB
case|:
name|cw
operator|=
name|create_channel_widget
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|Red
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|0
index|]
operator|=
name|Red
expr_stmt|;
name|cw
operator|=
name|create_channel_widget
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|Green
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|1
index|]
operator|=
name|Green
expr_stmt|;
name|cw
operator|=
name|create_channel_widget
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|Blue
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|2
index|]
operator|=
name|Blue
expr_stmt|;
name|channelsD
operator|->
name|num_components
operator|=
literal|3
expr_stmt|;
break|break;
case|case
name|GRAY
case|:
name|cw
operator|=
name|create_channel_widget
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|Gray
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|0
index|]
operator|=
name|Gray
expr_stmt|;
name|channelsD
operator|->
name|num_components
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|INDEXED
case|:
name|cw
operator|=
name|create_channel_widget
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|Indexed
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|0
index|]
operator|=
name|Indexed
expr_stmt|;
name|channelsD
operator|->
name|num_components
operator|=
literal|1
expr_stmt|;
break|break;
block|}
comment|/*  The auxillary image channels  */
name|list
operator|=
name|gimage
operator|->
name|channels
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
comment|/*  create a channel list item  */
name|channel
operator|=
operator|(
name|Channel
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|cw
operator|=
name|create_channel_widget
argument_list|(
name|gimage
argument_list|,
name|channel
argument_list|,
name|Auxillary
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
comment|/*  get the index of the active channel  */
if|if
condition|(
name|item_list
condition|)
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|item_list
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_clear ()
name|channels_dialog_clear
parameter_list|()
block|{
name|ops_button_box_set_insensitive
argument_list|(
name|channels_ops_buttons
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|++
expr_stmt|;
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_free ()
name|channels_dialog_free
parameter_list|()
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
if|if
condition|(
name|channelsD
operator|==
name|NULL
condition|)
return|return;
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Free all elements in the channels listbox  */
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|channel_widget_delete
argument_list|(
name|cw
argument_list|)
expr_stmt|;
block|}
name|channelsD
operator|->
name|channel_widgets
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|active_channel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|floating_sel
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|preview
condition|)
name|gtk_object_sink
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|preview
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|ops_menu
condition|)
name|gtk_object_sink
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|ops_menu
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|channelsD
argument_list|)
expr_stmt|;
name|channelsD
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_preview_extents ()
name|channels_dialog_preview_extents
parameter_list|()
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|gimage_width
operator|=
name|gimage
operator|->
name|width
expr_stmt|;
name|channelsD
operator|->
name|gimage_height
operator|=
name|gimage
operator|->
name|height
expr_stmt|;
comment|/*  Get the image width and height variables, based on the gimage  */
if|if
condition|(
name|gimage
operator|->
name|width
operator|>
name|gimage
operator|->
name|height
condition|)
name|channelsD
operator|->
name|ratio
operator|=
operator|(
name|double
operator|)
name|preview_size
operator|/
operator|(
name|double
operator|)
name|gimage
operator|->
name|width
expr_stmt|;
else|else
name|channelsD
operator|->
name|ratio
operator|=
operator|(
name|double
operator|)
name|preview_size
operator|/
operator|(
name|double
operator|)
name|gimage
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|preview_size
condition|)
block|{
name|channelsD
operator|->
name|image_width
operator|=
call|(
name|int
call|)
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|gimage
operator|->
name|width
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|image_height
operator|=
call|(
name|int
call|)
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|gimage
operator|->
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|image_width
operator|<
literal|1
condition|)
name|channelsD
operator|->
name|image_width
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|image_height
operator|<
literal|1
condition|)
name|channelsD
operator|->
name|image_height
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|channelsD
operator|->
name|image_width
operator|=
name|channel_width
expr_stmt|;
name|channelsD
operator|->
name|image_height
operator|=
name|channel_height
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_set_menu_sensitivity ()
name|channels_dialog_set_menu_sensitivity
parameter_list|()
block|{
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|gint
name|fs_sensitive
decl_stmt|;
name|gint
name|aux_sensitive
decl_stmt|;
name|cw
operator|=
name|channel_widget_get_ID
argument_list|(
name|channelsD
operator|->
name|active_channel
argument_list|)
expr_stmt|;
name|fs_sensitive
operator|=
operator|(
name|channelsD
operator|->
name|floating_sel
operator|!=
name|NULL
operator|)
expr_stmt|;
if|if
condition|(
name|cw
condition|)
name|aux_sensitive
operator|=
operator|(
name|cw
operator|->
name|type
operator|==
name|Auxillary
operator|)
expr_stmt|;
else|else
name|aux_sensitive
operator|=
name|FALSE
expr_stmt|;
comment|/* new channel */
name|gtk_widget_set_sensitive
argument_list|(
name|channels_ops
index|[
literal|0
index|]
operator|.
name|widget
argument_list|,
operator|!
name|fs_sensitive
argument_list|)
expr_stmt|;
name|ops_button_set_sensitive
argument_list|(
name|channels_ops_buttons
index|[
literal|0
index|]
argument_list|,
operator|!
name|fs_sensitive
argument_list|)
expr_stmt|;
comment|/* raise channel */
name|gtk_widget_set_sensitive
argument_list|(
name|channels_ops
index|[
literal|1
index|]
operator|.
name|widget
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
name|ops_button_set_sensitive
argument_list|(
name|channels_ops_buttons
index|[
literal|1
index|]
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
comment|/* lower channel */
name|gtk_widget_set_sensitive
argument_list|(
name|channels_ops
index|[
literal|2
index|]
operator|.
name|widget
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
name|ops_button_set_sensitive
argument_list|(
name|channels_ops_buttons
index|[
literal|2
index|]
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
comment|/* duplicate channel */
name|gtk_widget_set_sensitive
argument_list|(
name|channels_ops
index|[
literal|3
index|]
operator|.
name|widget
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
name|ops_button_set_sensitive
argument_list|(
name|channels_ops_buttons
index|[
literal|3
index|]
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
comment|/* delete channel */
name|gtk_widget_set_sensitive
argument_list|(
name|channels_ops
index|[
literal|4
index|]
operator|.
name|widget
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
name|ops_button_set_sensitive
argument_list|(
name|channels_ops_buttons
index|[
literal|4
index|]
argument_list|,
operator|!
name|fs_sensitive
operator|&&
name|aux_sensitive
argument_list|)
expr_stmt|;
comment|/* channel to selection */
name|gtk_widget_set_sensitive
argument_list|(
name|channels_ops
index|[
literal|5
index|]
operator|.
name|widget
argument_list|,
name|aux_sensitive
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_set_channel (ChannelWidget * channel_widget)
name|channels_dialog_set_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GtkStateType
name|state
decl_stmt|;
name|int
name|index
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  get the list item data  */
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
block|{
comment|/*  turn on the specified auxillary channel  */
name|index
operator|=
name|gimage_get_channel_index
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|index
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|state
operator|!=
name|GTK_STATE_SELECTED
operator|)
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|state
operator|!=
name|GTK_STATE_SELECTED
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Red
case|:
case|case
name|Gray
case|:
case|case
name|Indexed
case|:
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|Green
case|:
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|Blue
case|:
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
name|Auxillary
case|:
name|g_error
argument_list|(
literal|"error in %s at %d: this shouldn't happen."
argument_list|,
name|__FILE__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_unset_channel (ChannelWidget * channel_widget)
name|channels_dialog_unset_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GtkStateType
name|state
decl_stmt|;
name|int
name|index
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  get the list item data  */
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
block|{
comment|/*  turn off the specified auxillary channel  */
name|index
operator|=
name|gimage_get_channel_index
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|index
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|state
operator|==
name|GTK_STATE_SELECTED
operator|)
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Red
case|:
case|case
name|Gray
case|:
case|case
name|Indexed
case|:
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|Green
case|:
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|Blue
case|:
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
name|Auxillary
case|:
name|g_error
argument_list|(
literal|"error in %s at %d: this shouldn't happen."
argument_list|,
name|__FILE__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_position_channel (ChannelWidget * channel_widget,int new_index)
name|channels_dialog_position_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|,
name|int
name|new_index
parameter_list|)
block|{
name|GList
modifier|*
name|list
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Remove the channel from the dialog  */
name|list
operator|=
name|g_list_append
argument_list|(
name|list
argument_list|,
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_remove_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_remove
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
comment|/*  Add it back at the proper index  */
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|list
argument_list|,
name|new_index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_insert
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|,
name|new_index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_add_channel (Channel * channel)
name|channels_dialog_add_channel
parameter_list|(
name|Channel
modifier|*
name|channel
parameter_list|)
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|GList
modifier|*
name|item_list
decl_stmt|;
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|int
name|position
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
name|item_list
operator|=
name|NULL
expr_stmt|;
name|channel_widget
operator|=
name|create_channel_widget
argument_list|(
name|gimage
argument_list|,
name|channel
argument_list|,
name|Auxillary
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|position
operator|=
name|gimage_get_channel_index
argument_list|(
name|gimage
argument_list|,
name|channel
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_insert
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|,
name|position
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|item_list
argument_list|,
name|position
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_remove_channel (ChannelWidget * channel_widget)
name|channels_dialog_remove_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GList
modifier|*
name|list
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Remove the requested channel from the dialog  */
name|list
operator|=
name|g_list_append
argument_list|(
name|list
argument_list|,
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_remove_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
comment|/*  Delete the channel_widget  */
name|channel_widget_delete
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|channel_list_events (GtkWidget * widget,GdkEvent * event)
name|channel_list_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventKey
modifier|*
name|kevent
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|GtkWidget
modifier|*
name|event_widget
decl_stmt|;
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|event_widget
operator|=
name|gtk_get_event_widget
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|GTK_IS_LIST_ITEM
argument_list|(
name|event_widget
argument_list|)
condition|)
block|{
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|event_widget
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|channelsD
operator|->
name|ops_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
comment|/* Grumble - we have to handle double clicks ourselves because channels_dialog_flush is broken */
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
if|if
condition|(
operator|(
name|event
operator|->
name|button
operator|.
name|time
operator|<
operator|(
name|button_click_time
operator|+
literal|250
operator|)
operator|)
operator|&&
operator|(
name|channel_widget
operator|->
name|ID
operator|==
name|button_last_id
operator|)
condition|)
block|{
name|channels_dialog_edit_channel_query
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
else|else
block|{
name|button_click_time
operator|=
name|event
operator|->
name|button
operator|.
name|time
expr_stmt|;
name|button_last_id
operator|=
name|channel_widget
operator|->
name|ID
expr_stmt|;
block|}
break|break;
case|case
name|GDK_2BUTTON_PRESS
case|:
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
name|channels_dialog_edit_channel_query
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
break|break;
case|case
name|GDK_KEY_PRESS
case|:
name|kevent
operator|=
operator|(
name|GdkEventKey
operator|*
operator|)
name|event
expr_stmt|;
switch|switch
condition|(
name|kevent
operator|->
name|keyval
condition|)
block|{
case|case
name|GDK_Up
case|:
name|printf
argument_list|(
literal|"up arrow\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_Down
case|:
name|printf
argument_list|(
literal|"down arrow\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
name|FALSE
return|;
break|break;
block|}
return|return
name|TRUE
return|;
break|break;
default|default:
break|break;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*******************************/
end_comment

begin_comment
comment|/*  channels dialog callbacks  */
end_comment

begin_comment
comment|/*******************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|channels_dialog_map_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
name|gtk_window_add_accelerator_table
argument_list|(
name|GTK_WINDOW
argument_list|(
name|lc_shell
argument_list|)
argument_list|,
name|channelsD
operator|->
name|accel_table
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_unmap_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_unmap_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
name|gtk_window_remove_accelerator_table
argument_list|(
name|GTK_WINDOW
argument_list|(
name|lc_shell
argument_list|)
argument_list|,
name|channelsD
operator|->
name|accel_table
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_new_channel_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_new_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
comment|/*  if there is a currently selected gimage, request a new channel    */
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
name|channelsD
operator|->
name|gimage_id
operator|==
operator|-
literal|1
condition|)
return|return;
name|channels_dialog_new_channel_query
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_raise_channel_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_raise_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
if|if
condition|(
name|gimage
operator|->
name|active_channel
operator|!=
name|NULL
condition|)
block|{
name|gimage_raise_channel
argument_list|(
name|gimage
argument_list|,
name|gimage
operator|->
name|active_channel
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_lower_channel_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_lower_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
if|if
condition|(
name|gimage
operator|->
name|active_channel
operator|!=
name|NULL
condition|)
block|{
name|gimage_lower_channel
argument_list|(
name|gimage
argument_list|,
name|gimage
operator|->
name|active_channel
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_duplicate_channel_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_duplicate_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|Channel
modifier|*
name|active_channel
decl_stmt|;
name|Channel
modifier|*
name|new_channel
decl_stmt|;
comment|/*  if there is a currently selected gimage, request a new channel    */
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|active_channel
operator|=
name|gimage_get_active_channel
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|new_channel
operator|=
name|channel_copy
argument_list|(
name|active_channel
argument_list|)
expr_stmt|;
name|gimage_add_channel
argument_list|(
name|gimage
argument_list|,
name|new_channel
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_delete_channel_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_delete_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
comment|/*  if there is a currently selected gimage    */
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
if|if
condition|(
name|gimage
operator|->
name|active_channel
operator|!=
name|NULL
condition|)
block|{
name|gimage_remove_channel
argument_list|(
name|gimage
argument_list|,
name|gimage
operator|->
name|active_channel
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_channel_to_sel_callback (GtkWidget * w,gpointer client_data)
name|channels_dialog_channel_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GImage
modifier|*
name|gimage
decl_stmt|;
comment|/*  if there is a currently selected gimage    */
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|channelsD
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
return|return;
if|if
condition|(
name|gimage
operator|->
name|active_channel
operator|!=
name|NULL
condition|)
block|{
name|gimage_mask_load
argument_list|(
name|gimage
argument_list|,
name|gimage
operator|->
name|active_channel
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/****************************/
end_comment

begin_comment
comment|/*  channel widget functions  */
end_comment

begin_comment
comment|/****************************/
end_comment

begin_function
specifier|static
name|ChannelWidget
modifier|*
DECL|function|channel_widget_get_ID (Channel * channel)
name|channel_widget_get_ID
parameter_list|(
name|Channel
modifier|*
name|channel
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|lw
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return
name|NULL
return|;
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|lw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|lw
operator|->
name|channel
operator|==
name|channel
condition|)
return|return
name|lw
return|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|ChannelWidget
modifier|*
DECL|function|create_channel_widget (GImage * gimage,Channel * channel,ChannelType type)
name|create_channel_widget
parameter_list|(
name|GImage
modifier|*
name|gimage
parameter_list|,
name|Channel
modifier|*
name|channel
parameter_list|,
name|ChannelType
name|type
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|alignment
decl_stmt|;
name|list_item
operator|=
name|gtk_list_item_new
argument_list|()
expr_stmt|;
comment|/*  create the channel widget and add it to the list  */
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|ChannelWidget
argument_list|)
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|gimage
operator|=
name|gimage
expr_stmt|;
name|channel_widget
operator|->
name|channel
operator|=
name|channel
expr_stmt|;
name|channel_widget
operator|->
name|channel_preview
operator|=
name|NULL
expr_stmt|;
name|channel_widget
operator|->
name|channel_pixmap
operator|=
name|NULL
expr_stmt|;
name|channel_widget
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|channel_widget
operator|->
name|ID
operator|=
operator|(
name|type
operator|==
name|Auxillary
operator|)
condition|?
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|ID
else|:
operator|(
name|COMPONENT_BASE_ID
operator|+
name|type
operator|)
expr_stmt|;
name|channel_widget
operator|->
name|list_item
operator|=
name|list_item
expr_stmt|;
name|channel_widget
operator|->
name|width
operator|=
operator|-
literal|1
expr_stmt|;
name|channel_widget
operator|->
name|height
operator|=
operator|-
literal|1
expr_stmt|;
name|channel_widget
operator|->
name|visited
operator|=
name|TRUE
expr_stmt|;
comment|/*  Need to let the list item know about the channel_widget  */
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  set up the list item observer  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"select"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channel_widget_select_update
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"deselect"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channel_widget_select_update
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/* Create the visibility toggle button */
name|alignment
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|alignment
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|eye_widget
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|,
name|BUTTON_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channel_widget_button_events
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|alignment
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|eye_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
comment|/*  The preview  */
name|alignment
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|alignment
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|channel_preview
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|,
name|PREVIEW_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channel_widget_preview_events
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|alignment
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|channel_preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
expr_stmt|;
comment|/*  the channel name label */
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Red
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Red"
argument_list|)
expr_stmt|;
break|break;
case|case
name|Green
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Green"
argument_list|)
expr_stmt|;
break|break;
case|case
name|Blue
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Blue"
argument_list|)
expr_stmt|;
break|break;
case|case
name|Gray
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Gray"
argument_list|)
expr_stmt|;
break|break;
case|case
name|Indexed
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Indexed"
argument_list|)
expr_stmt|;
break|break;
case|case
name|Auxillary
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|name
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channel_widget
operator|->
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|gtk_widget_ref
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
return|return
name|channel_widget
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_delete (ChannelWidget * channel_widget)
name|channel_widget_delete
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
if|if
condition|(
name|channel_widget
operator|->
name|channel_pixmap
condition|)
name|gdk_pixmap_unref
argument_list|(
name|channel_widget
operator|->
name|channel_pixmap
argument_list|)
expr_stmt|;
comment|/*  Remove the channel widget from the list  */
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_remove
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  Release the widget  */
name|gtk_widget_unref
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_select_update (GtkWidget * w,gpointer data)
name|channel_widget_select_update
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
if|if
condition|(
operator|(
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|data
operator|)
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|suspend_gimage_notify
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
block|{
if|if
condition|(
name|w
operator|->
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
comment|/*  set the gimage's active channel to be this channel  */
name|gimage_set_active_channel
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|channel
argument_list|)
expr_stmt|;
else|else
comment|/*  unset the gimage's active channel  */
name|gimage_unset_active_channel
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|!=
name|Auxillary
condition|)
block|{
if|if
condition|(
name|w
operator|->
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|gimage_set_component_active
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|gimage_set_component_active
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|channel_widget_button_events (GtkWidget * widget,GdkEvent * event)
name|channel_widget_button_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
specifier|static
name|int
name|button_down
init|=
literal|0
decl_stmt|;
specifier|static
name|GtkWidget
modifier|*
name|click_widget
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|old_state
decl_stmt|;
specifier|static
name|int
name|exclusive
decl_stmt|;
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|event_widget
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|gint
name|return_val
decl_stmt|;
name|int
name|visible
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|visible
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
expr_stmt|;
name|width
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|height
expr_stmt|;
break|break;
default|default:
name|visible
operator|=
name|gimage_get_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
expr_stmt|;
name|width
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|height
expr_stmt|;
break|break;
block|}
name|return_val
operator|=
name|FALSE
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
name|channel_widget_eye_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
name|return_val
operator|=
name|TRUE
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|channelsD
operator|->
name|ops_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
name|button_down
operator|=
literal|1
expr_stmt|;
name|click_widget
operator|=
name|widget
expr_stmt|;
name|gtk_grab_add
argument_list|(
name|click_widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
block|{
name|old_state
operator|=
name|visible
expr_stmt|;
comment|/*  If this was a shift-click, make all/none visible  */
if|if
condition|(
name|event
operator|->
name|button
operator|.
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
name|exclusive
operator|=
name|TRUE
expr_stmt|;
name|channel_widget_exclusive_visible
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|exclusive
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
operator|!
name|visible
expr_stmt|;
else|else
name|gimage_set_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
operator|!
name|visible
argument_list|)
expr_stmt|;
name|channel_widget_eye_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
name|return_val
operator|=
name|TRUE
expr_stmt|;
name|button_down
operator|=
literal|0
expr_stmt|;
name|gtk_grab_remove
argument_list|(
name|click_widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
block|{
if|if
condition|(
name|exclusive
condition|)
block|{
name|gdisplays_update_area
argument_list|(
name|channel_widget
operator|->
name|gimage
operator|->
name|ID
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|old_state
operator|!=
name|visible
condition|)
block|{
name|gdisplays_update_area
argument_list|(
name|channel_widget
operator|->
name|gimage
operator|->
name|ID
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GDK_ENTER_NOTIFY
case|:
case|case
name|GDK_LEAVE_NOTIFY
case|:
name|event_widget
operator|=
name|gtk_get_event_widget
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|button_down
operator|&&
operator|(
name|event_widget
operator|==
name|click_widget
operator|)
condition|)
block|{
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
block|{
if|if
condition|(
name|exclusive
condition|)
block|{
name|channel_widget_exclusive_visible
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
operator|!
name|visible
expr_stmt|;
else|else
name|gimage_set_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
operator|!
name|visible
argument_list|)
expr_stmt|;
name|channel_widget_eye_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|return_val
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|channel_widget_preview_events (GtkWidget * widget,GdkEvent * event)
name|channel_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventExpose
modifier|*
name|eevent
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|int
name|valid
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|channelsD
operator|->
name|ops_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|GDK_EXPOSE
case|:
if|if
condition|(
operator|!
name|preview_size
condition|)
name|channel_widget_no_preview_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
else|else
block|{
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|valid
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|preview_valid
expr_stmt|;
break|break;
default|default:
name|valid
operator|=
name|gimage_preview_valid
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|valid
operator|||
operator|!
name|channel_widget
operator|->
name|channel_pixmap
condition|)
block|{
name|channel_widget_preview_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|channel_widget
operator|->
name|channel_pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|eevent
operator|=
operator|(
name|GdkEventExpose
operator|*
operator|)
name|event
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|channel_widget
operator|->
name|channel_pixmap
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|x
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|y
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|x
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|y
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|width
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|height
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_preview_redraw (ChannelWidget * channel_widget)
name|channel_widget_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|TempBuf
modifier|*
name|preview_buf
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|int
name|channel
decl_stmt|;
comment|/*  allocate the channel widget pixmap  */
if|if
condition|(
operator|!
name|channel_widget
operator|->
name|channel_pixmap
condition|)
name|channel_widget
operator|->
name|channel_pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|channel_widget
operator|->
name|channel_preview
operator|->
name|window
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/*  determine width and height  */
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|width
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|height
expr_stmt|;
name|channel_widget
operator|->
name|width
operator|=
call|(
name|int
call|)
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|width
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|height
operator|=
call|(
name|int
call|)
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|height
argument_list|)
expr_stmt|;
name|preview_buf
operator|=
name|channel_preview
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|,
name|channel_widget
operator|->
name|width
argument_list|,
name|channel_widget
operator|->
name|height
argument_list|)
expr_stmt|;
break|break;
default|default:
name|width
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|height
expr_stmt|;
name|channel_widget
operator|->
name|width
operator|=
call|(
name|int
call|)
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|width
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|height
operator|=
call|(
name|int
call|)
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|height
argument_list|)
expr_stmt|;
name|preview_buf
operator|=
name|gimage_composite_preview
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
name|channel_widget
operator|->
name|width
argument_list|,
name|channel_widget
operator|->
name|height
argument_list|)
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Red
case|:
name|channel
operator|=
name|RED_PIX
expr_stmt|;
break|break;
case|case
name|Green
case|:
name|channel
operator|=
name|GREEN_PIX
expr_stmt|;
break|break;
case|case
name|Blue
case|:
name|channel
operator|=
name|BLUE_PIX
expr_stmt|;
break|break;
case|case
name|Gray
case|:
name|channel
operator|=
name|GRAY_PIX
expr_stmt|;
break|break;
case|case
name|Indexed
case|:
name|channel
operator|=
name|INDEXED_PIX
expr_stmt|;
break|break;
case|case
name|Auxillary
case|:
name|channel
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
default|default:
name|channel
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|render_preview
argument_list|(
name|preview_buf
argument_list|,
name|channelsD
operator|->
name|preview
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|,
name|channel
argument_list|)
expr_stmt|;
name|gtk_preview_put
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|channelsD
operator|->
name|preview
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|channel_pixmap
argument_list|,
name|channel_widget
operator|->
name|channel_preview
operator|->
name|style
operator|->
name|black_gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|)
expr_stmt|;
comment|/*  make sure the image has been transfered completely to the pixmap before    *  we use it again...    */
name|gdk_flush
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_no_preview_redraw (ChannelWidget * channel_widget)
name|channel_widget_no_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
name|GdkPixmap
modifier|*
modifier|*
name|pixmap_normal
decl_stmt|;
name|GdkPixmap
modifier|*
modifier|*
name|pixmap_selected
decl_stmt|;
name|GdkPixmap
modifier|*
modifier|*
name|pixmap_insensitive
decl_stmt|;
name|GdkColor
modifier|*
name|color
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
name|GtkStateType
name|state
decl_stmt|;
name|gchar
modifier|*
name|bits
decl_stmt|;
name|int
name|width
decl_stmt|,
name|height
decl_stmt|;
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
name|widget
operator|=
name|channel_widget
operator|->
name|channel_preview
expr_stmt|;
name|pixmap_normal
operator|=
operator|&
name|channel_pixmap
index|[
name|NORMAL
index|]
expr_stmt|;
name|pixmap_selected
operator|=
operator|&
name|channel_pixmap
index|[
name|SELECTED
index|]
expr_stmt|;
name|pixmap_insensitive
operator|=
operator|&
name|channel_pixmap
index|[
name|INSENSITIVE
index|]
expr_stmt|;
name|bits
operator|=
operator|(
name|gchar
operator|*
operator|)
name|channel_bits
expr_stmt|;
name|width
operator|=
name|channel_width
expr_stmt|;
name|height
operator|=
name|channel_height
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|color
operator|=
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
expr_stmt|;
else|else
name|color
operator|=
operator|&
name|widget
operator|->
name|style
operator|->
name|white
expr_stmt|;
block|}
else|else
name|color
operator|=
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
expr_stmt|;
name|gdk_window_set_background
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|pixmap_normal
condition|)
block|{
operator|*
name|pixmap_normal
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|bits
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|)
expr_stmt|;
operator|*
name|pixmap_selected
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|bits
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|white
argument_list|)
expr_stmt|;
operator|*
name|pixmap_insensitive
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|bits
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|pixmap
operator|=
operator|*
name|pixmap_selected
expr_stmt|;
else|else
name|pixmap
operator|=
operator|*
name|pixmap_normal
expr_stmt|;
block|}
else|else
name|pixmap
operator|=
operator|*
name|pixmap_insensitive
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_eye_redraw (ChannelWidget * channel_widget)
name|channel_widget_eye_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
name|GdkColor
modifier|*
name|color
decl_stmt|;
name|GtkStateType
name|state
decl_stmt|;
name|int
name|visible
decl_stmt|;
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|color
operator|=
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
expr_stmt|;
else|else
name|color
operator|=
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|white
expr_stmt|;
block|}
else|else
name|color
operator|=
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
expr_stmt|;
name|gdk_window_set_background
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
name|color
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|visible
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
expr_stmt|;
break|break;
default|default:
name|visible
operator|=
name|gimage_get_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|visible
condition|)
block|{
if|if
condition|(
operator|!
name|eye_pixmap
index|[
name|NORMAL
index|]
condition|)
block|{
name|eye_pixmap
index|[
name|NORMAL
index|]
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|eye_bits
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|white
argument_list|)
expr_stmt|;
name|eye_pixmap
index|[
name|SELECTED
index|]
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|eye_bits
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|)
expr_stmt|;
name|eye_pixmap
index|[
name|INSENSITIVE
index|]
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|eye_bits
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|pixmap
operator|=
name|eye_pixmap
index|[
name|SELECTED
index|]
expr_stmt|;
else|else
name|pixmap
operator|=
name|eye_pixmap
index|[
name|NORMAL
index|]
expr_stmt|;
block|}
else|else
name|pixmap
operator|=
name|eye_pixmap
index|[
name|INSENSITIVE
index|]
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gdk_window_clear
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_exclusive_visible (ChannelWidget * channel_widget)
name|channel_widget_exclusive_visible
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|int
name|visible
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
comment|/*  First determine if _any_ other channel widgets are set to visible  */
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|cw
operator|!=
name|channel_widget
condition|)
block|{
switch|switch
condition|(
name|cw
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|visible
operator||=
name|GIMP_DRAWABLE
argument_list|(
name|cw
operator|->
name|channel
argument_list|)
operator|->
name|visible
expr_stmt|;
break|break;
default|default:
name|visible
operator||=
name|gimage_get_component_visible
argument_list|(
name|cw
operator|->
name|gimage
argument_list|,
name|cw
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
comment|/*  Now, toggle the visibility for all channels except the specified one  */
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|cw
operator|!=
name|channel_widget
condition|)
switch|switch
condition|(
name|cw
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|GIMP_DRAWABLE
argument_list|(
name|cw
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
operator|!
name|visible
expr_stmt|;
break|break;
default|default:
name|gimage_set_component_visible
argument_list|(
name|cw
operator|->
name|gimage
argument_list|,
name|cw
operator|->
name|type
argument_list|,
operator|!
name|visible
argument_list|)
expr_stmt|;
break|break;
block|}
else|else
switch|switch
condition|(
name|cw
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|GIMP_DRAWABLE
argument_list|(
name|cw
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
name|TRUE
expr_stmt|;
break|break;
default|default:
name|gimage_set_component_visible
argument_list|(
name|cw
operator|->
name|gimage
argument_list|,
name|cw
operator|->
name|type
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
name|channel_widget_eye_redraw
argument_list|(
name|cw
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_channel_flush (GtkWidget * widget,gpointer client_data)
name|channel_widget_channel_flush
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|int
name|update_preview
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
comment|/***  Sensitivity  ***/
comment|/*  If there is a floating selection...  */
if|if
condition|(
name|channelsD
operator|->
name|floating_sel
operator|!=
name|NULL
condition|)
block|{
comment|/*  to insensitive if this is an auxillary channel  */
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
block|{
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
comment|/*  to sensitive otherwise  */
else|else
block|{
if|if
condition|(
operator|!
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  to insensitive if there is an active channel, and this is a component channel  */
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|!=
name|Auxillary
operator|&&
name|channelsD
operator|->
name|active_channel
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
comment|/*  to sensitive otherwise  */
else|else
block|{
if|if
condition|(
operator|!
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
comment|/***  Selection  ***/
comment|/*  If this is an auxillary channel  */
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|Auxillary
condition|)
block|{
comment|/*  select if this is the active channel  */
if|if
condition|(
name|channelsD
operator|->
name|active_channel
operator|==
operator|(
name|channel_widget
operator|->
name|channel
operator|)
condition|)
name|channels_dialog_set_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  unselect if this is not the active channel  */
else|else
name|channels_dialog_unset_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/*  If the component is active, select. otherwise, deselect  */
if|if
condition|(
name|gimage_get_component_active
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
condition|)
name|channels_dialog_set_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
else|else
name|channels_dialog_unset_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|Auxillary
case|:
name|update_preview
operator|=
operator|!
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|preview_valid
expr_stmt|;
break|break;
default|default:
name|update_preview
operator|=
operator|!
name|gimage_preview_valid
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|update_preview
condition|)
name|gtk_widget_draw
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  The new channel query dialog  */
end_comment

begin_typedef
DECL|typedef|NewChannelOptions
typedef|typedef
name|struct
name|_NewChannelOptions
name|NewChannelOptions
typedef|;
end_typedef

begin_struct
DECL|struct|_NewChannelOptions
struct|struct
name|_NewChannelOptions
block|{
DECL|member|query_box
name|GtkWidget
modifier|*
name|query_box
decl_stmt|;
DECL|member|name_entry
name|GtkWidget
modifier|*
name|name_entry
decl_stmt|;
DECL|member|color_panel
name|ColorPanel
modifier|*
name|color_panel
decl_stmt|;
DECL|member|gimage_id
name|int
name|gimage_id
decl_stmt|;
DECL|member|opacity
name|double
name|opacity
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
DECL|variable|channel_name
specifier|static
name|char
modifier|*
name|channel_name
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channel_color
specifier|static
name|unsigned
name|char
name|channel_color
index|[
literal|3
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|new_channel_query_ok_callback (GtkWidget * w,gpointer client_data)
name|new_channel_query_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|NewChannelOptions
modifier|*
name|options
decl_stmt|;
name|Channel
modifier|*
name|new_channel
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|int
name|i
decl_stmt|;
name|options
operator|=
operator|(
name|NewChannelOptions
operator|*
operator|)
name|client_data
expr_stmt|;
if|if
condition|(
name|channel_name
condition|)
name|g_free
argument_list|(
name|channel_name
argument_list|)
expr_stmt|;
name|channel_name
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|options
operator|->
name|gimage_id
argument_list|)
operator|)
condition|)
block|{
name|new_channel
operator|=
name|channel_new
argument_list|(
name|gimage
operator|->
name|ID
argument_list|,
name|gimage
operator|->
name|width
argument_list|,
name|gimage
operator|->
name|height
argument_list|,
name|channel_name
argument_list|,
call|(
name|int
call|)
argument_list|(
literal|255
operator|*
name|options
operator|->
name|opacity
argument_list|)
operator|/
literal|100
argument_list|,
name|options
operator|->
name|color_panel
operator|->
name|color
argument_list|)
expr_stmt|;
name|drawable_fill
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|new_channel
argument_list|)
argument_list|,
name|TRANSPARENT_FILL
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
name|channel_color
index|[
name|i
index|]
operator|=
name|options
operator|->
name|color_panel
operator|->
name|color
index|[
name|i
index|]
expr_stmt|;
name|gimage_add_channel
argument_list|(
name|gimage
argument_list|,
name|new_channel
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
name|color_panel_free
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|new_channel_query_cancel_callback (GtkWidget * w,gpointer client_data)
name|new_channel_query_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|NewChannelOptions
modifier|*
name|options
decl_stmt|;
name|options
operator|=
operator|(
name|NewChannelOptions
operator|*
operator|)
name|client_data
expr_stmt|;
name|color_panel_free
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|new_channel_query_delete_callback (GtkWidget * w,GdkEvent * e,gpointer client_data)
name|new_channel_query_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|GdkEvent
modifier|*
name|e
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|new_channel_query_cancel_callback
argument_list|(
name|w
argument_list|,
name|client_data
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|new_channel_query_scale_update (GtkAdjustment * adjustment,double * scale_val)
name|new_channel_query_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|double
modifier|*
name|scale_val
parameter_list|)
block|{
operator|*
name|scale_val
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_new_channel_query (int gimage_id)
name|channels_dialog_new_channel_query
parameter_list|(
name|int
name|gimage_id
parameter_list|)
block|{
specifier|static
name|ActionAreaItem
name|action_items
index|[
literal|2
index|]
init|=
block|{
block|{
literal|"OK"
block|,
name|new_channel_query_ok_callback
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"Cancel"
block|,
name|new_channel_query_cancel_callback
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
name|GImage
modifier|*
name|gimage
decl_stmt|;
name|NewChannelOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|opacity_scale
decl_stmt|;
name|GtkObject
modifier|*
name|opacity_scale_data
decl_stmt|;
name|gimage
operator|=
name|gimage_get_ID
argument_list|(
name|gimage_id
argument_list|)
expr_stmt|;
comment|/*  the new options structure  */
name|options
operator|=
operator|(
name|NewChannelOptions
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|NewChannelOptions
argument_list|)
argument_list|)
expr_stmt|;
name|options
operator|->
name|gimage_id
operator|=
name|gimage_id
expr_stmt|;
name|options
operator|->
name|opacity
operator|=
literal|50.0
expr_stmt|;
name|options
operator|->
name|color_panel
operator|=
name|color_panel_new
argument_list|(
name|channel_color
argument_list|,
literal|48
argument_list|,
literal|64
argument_list|)
expr_stmt|;
comment|/*  the dialog  */
name|options
operator|->
name|query_box
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"new_channel_options"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"New Channel Options"
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
comment|/* handle the wm close signal */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|new_channel_query_delete_callback
argument_list|)
argument_list|,
name|options
argument_list|)
expr_stmt|;
comment|/*  the main vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The table  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  the name entry hbox, label and entry  */
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Channel name: "
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|name_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|options
operator|->
name|name_entry
argument_list|,
literal|75
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|options
operator|->
name|name_entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|,
operator|(
name|channel_name
condition|?
name|channel_name
else|:
literal|"New Channel"
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
expr_stmt|;
comment|/*  the opacity scale  */
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Fill Opacity: "
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|opacity_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|opacity
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|opacity_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|opacity_scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|opacity_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|opacity_scale
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|new_channel_query_scale_update
argument_list|,
operator|&
name|options
operator|->
name|opacity
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|opacity_scale
argument_list|)
expr_stmt|;
comment|/*  the color panel  */
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|options
operator|->
name|color_panel
operator|->
name|color_panel_widget
argument_list|,
literal|2
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|color_panel
operator|->
name|color_panel_widget
argument_list|)
expr_stmt|;
name|action_items
index|[
literal|0
index|]
operator|.
name|user_data
operator|=
name|options
expr_stmt|;
name|action_items
index|[
literal|1
index|]
operator|.
name|user_data
operator|=
name|options
expr_stmt|;
name|build_action_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
name|action_items
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  *  The edit channel attributes dialog  */
end_comment

begin_typedef
DECL|typedef|EditChannelOptions
typedef|typedef
name|struct
name|_EditChannelOptions
name|EditChannelOptions
typedef|;
end_typedef

begin_struct
DECL|struct|_EditChannelOptions
struct|struct
name|_EditChannelOptions
block|{
DECL|member|query_box
name|GtkWidget
modifier|*
name|query_box
decl_stmt|;
DECL|member|name_entry
name|GtkWidget
modifier|*
name|name_entry
decl_stmt|;
DECL|member|channel_widget
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
DECL|member|color_panel
name|ColorPanel
modifier|*
name|color_panel
decl_stmt|;
DECL|member|opacity
name|double
name|opacity
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
DECL|function|edit_channel_query_ok_callback (GtkWidget * w,gpointer client_data)
name|edit_channel_query_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|EditChannelOptions
modifier|*
name|options
decl_stmt|;
name|Channel
modifier|*
name|channel
decl_stmt|;
name|int
name|opacity
decl_stmt|;
name|int
name|update
init|=
name|FALSE
decl_stmt|;
name|int
name|i
decl_stmt|;
name|options
operator|=
operator|(
name|EditChannelOptions
operator|*
operator|)
name|client_data
expr_stmt|;
name|channel
operator|=
name|options
operator|->
name|channel_widget
operator|->
name|channel
expr_stmt|;
name|opacity
operator|=
call|(
name|int
call|)
argument_list|(
literal|255
operator|*
name|options
operator|->
name|opacity
argument_list|)
operator|/
literal|100
expr_stmt|;
if|if
condition|(
name|gimage_get_ID
argument_list|(
name|options
operator|->
name|channel_widget
operator|->
name|ID
argument_list|)
condition|)
block|{
comment|/*  Set the new channel name  */
if|if
condition|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|name
condition|)
name|g_free
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|name
argument_list|)
expr_stmt|;
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|options
operator|->
name|channel_widget
operator|->
name|label
argument_list|)
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|->
name|opacity
operator|!=
name|opacity
condition|)
block|{
name|channel
operator|->
name|opacity
operator|=
name|opacity
expr_stmt|;
name|update
operator|=
name|TRUE
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|options
operator|->
name|color_panel
operator|->
name|color
index|[
name|i
index|]
operator|!=
name|channel
operator|->
name|col
index|[
name|i
index|]
condition|)
block|{
name|channel
operator|->
name|col
index|[
name|i
index|]
operator|=
name|options
operator|->
name|color_panel
operator|->
name|color
index|[
name|i
index|]
expr_stmt|;
name|update
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
name|update
condition|)
block|{
name|drawable_update
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|width
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|height
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
name|color_panel_free
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|edit_channel_query_cancel_callback (GtkWidget * w,gpointer client_data)
name|edit_channel_query_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|EditChannelOptions
modifier|*
name|options
decl_stmt|;
name|options
operator|=
operator|(
name|EditChannelOptions
operator|*
operator|)
name|client_data
expr_stmt|;
name|color_panel_free
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|edit_channel_query_delete_callback (GtkWidget * w,GdkEvent * e,gpointer client_data)
name|edit_channel_query_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|w
parameter_list|,
name|GdkEvent
modifier|*
name|e
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|edit_channel_query_cancel_callback
argument_list|(
name|w
argument_list|,
name|client_data
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_edit_channel_query (ChannelWidget * channel_widget)
name|channels_dialog_edit_channel_query
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
specifier|static
name|ActionAreaItem
name|action_items
index|[
literal|2
index|]
init|=
block|{
block|{
literal|"OK"
block|,
name|edit_channel_query_ok_callback
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"Cancel"
block|,
name|edit_channel_query_cancel_callback
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
name|EditChannelOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|opacity_scale
decl_stmt|;
name|GtkObject
modifier|*
name|opacity_scale_data
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/*  the new options structure  */
name|options
operator|=
operator|(
name|EditChannelOptions
operator|*
operator|)
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|EditChannelOptions
argument_list|)
argument_list|)
expr_stmt|;
name|options
operator|->
name|channel_widget
operator|=
name|channel_widget
expr_stmt|;
name|options
operator|->
name|opacity
operator|=
operator|(
name|double
operator|)
name|channel_widget
operator|->
name|channel
operator|->
name|opacity
operator|/
literal|2.55
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
name|channel_color
index|[
name|i
index|]
operator|=
name|channel_widget
operator|->
name|channel
operator|->
name|col
index|[
name|i
index|]
expr_stmt|;
name|options
operator|->
name|color_panel
operator|=
name|color_panel_new
argument_list|(
name|channel_color
argument_list|,
literal|48
argument_list|,
literal|64
argument_list|)
expr_stmt|;
comment|/*  the dialog  */
name|options
operator|->
name|query_box
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"edit_channel_atributes"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"Edit Channel Attributes"
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
comment|/* deal with the wm close signal */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|edit_channel_query_delete_callback
argument_list|)
argument_list|,
name|options
argument_list|)
expr_stmt|;
comment|/*  the main vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The table  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  the name entry hbox, label and entry  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|hbox
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Channel name:"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|name_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|options
operator|->
name|name_entry
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|name
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/*  the opacity scale  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|hbox
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Fill Opacity"
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|opacity_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|options
operator|->
name|opacity
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|opacity_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|opacity_scale
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|opacity_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|new_channel_query_scale_update
argument_list|,
operator|&
name|options
operator|->
name|opacity
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|opacity_scale
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/*  the color panel  */
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|options
operator|->
name|color_panel
operator|->
name|color_panel_widget
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
argument_list|,
name|GTK_EXPAND
argument_list|,
literal|4
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|color_panel
operator|->
name|color_panel_widget
argument_list|)
expr_stmt|;
name|action_items
index|[
literal|0
index|]
operator|.
name|user_data
operator|=
name|options
expr_stmt|;
name|action_items
index|[
literal|1
index|]
operator|.
name|user_data
operator|=
name|options
expr_stmt|;
name|build_action_area
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
name|action_items
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

