begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_include
include|#
directive|include
file|"libgimpcolor/gimpcolor.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"apptypes.h"
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"channels_dialog.h"
end_include

begin_include
include|#
directive|include
file|"color_panel.h"
end_include

begin_include
include|#
directive|include
file|"drawable.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"gimage.h"
end_include

begin_include
include|#
directive|include
file|"gimage_mask.h"
end_include

begin_include
include|#
directive|include
file|"gimpchannel.h"
end_include

begin_include
include|#
directive|include
file|"gimpdnd.h"
end_include

begin_include
include|#
directive|include
file|"gimplist.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"gimpui.h"
end_include

begin_include
include|#
directive|include
file|"layers_dialogP.h"
end_include

begin_include
include|#
directive|include
file|"lc_dialogP.h"
end_include

begin_include
include|#
directive|include
file|"menus.h"
end_include

begin_include
include|#
directive|include
file|"ops_buttons.h"
end_include

begin_include
include|#
directive|include
file|"paint_funcs.h"
end_include

begin_include
include|#
directive|include
file|"temp_buf.h"
end_include

begin_include
include|#
directive|include
file|"undo.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_include
include|#
directive|include
file|"pixmaps/eye.xbm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/channel.xbm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/new.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/raise.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/lower.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/duplicate.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/delete.xpm"
end_include

begin_include
include|#
directive|include
file|"pixmaps/toselection.xpm"
end_include

begin_define
DECL|macro|COMPONENT_BASE_ID
define|#
directive|define
name|COMPONENT_BASE_ID
value|0x10000000
end_define

begin_typedef
DECL|typedef|ChannelsDialog
typedef|typedef
name|struct
name|_ChannelsDialog
name|ChannelsDialog
typedef|;
end_typedef

begin_struct
DECL|struct|_ChannelsDialog
struct|struct
name|_ChannelsDialog
block|{
DECL|member|vbox
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
DECL|member|channel_list
name|GtkWidget
modifier|*
name|channel_list
decl_stmt|;
DECL|member|scrolled_win
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
DECL|member|preview
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
DECL|member|ops_menu
name|GtkWidget
modifier|*
name|ops_menu
decl_stmt|;
DECL|member|accel_group
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
comment|/*  state information  */
DECL|member|gimage
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
DECL|member|image_width
DECL|member|image_height
name|gint
name|image_width
decl_stmt|,
name|image_height
decl_stmt|;
DECL|member|gimage_width
DECL|member|gimage_height
name|gint
name|gimage_width
decl_stmt|,
name|gimage_height
decl_stmt|;
DECL|member|ratio
name|gdouble
name|ratio
decl_stmt|;
DECL|member|num_components
name|gint
name|num_components
decl_stmt|;
DECL|member|base_type
name|gint
name|base_type
decl_stmt|;
DECL|member|components
name|ChannelType
name|components
index|[
name|MAX_CHANNELS
index|]
decl_stmt|;
DECL|member|active_channel
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
DECL|member|floating_sel
name|GimpLayer
modifier|*
name|floating_sel
decl_stmt|;
DECL|member|channel_widgets
name|GSList
modifier|*
name|channel_widgets
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|ChannelWidget
typedef|typedef
name|struct
name|_ChannelWidget
name|ChannelWidget
typedef|;
end_typedef

begin_struct
DECL|struct|_ChannelWidget
struct|struct
name|_ChannelWidget
block|{
DECL|member|eye_widget
name|GtkWidget
modifier|*
name|eye_widget
decl_stmt|;
DECL|member|clip_widget
name|GtkWidget
modifier|*
name|clip_widget
decl_stmt|;
DECL|member|channel_preview
name|GtkWidget
modifier|*
name|channel_preview
decl_stmt|;
DECL|member|list_item
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
DECL|member|label
name|GtkWidget
modifier|*
name|label
decl_stmt|;
DECL|member|channel_pixmap
name|GdkPixmap
modifier|*
name|channel_pixmap
decl_stmt|;
comment|/*  state information  */
DECL|member|gimage
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
DECL|member|channel
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
DECL|member|width
DECL|member|height
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
DECL|member|type
name|ChannelType
name|type
decl_stmt|;
DECL|member|ID
name|gint
name|ID
decl_stmt|;
DECL|member|visited
name|gboolean
name|visited
decl_stmt|;
DECL|member|drop_type
name|GimpDropType
name|drop_type
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  channels dialog widget routines  */
end_comment

begin_function_decl
specifier|static
name|void
name|channels_dialog_preview_extents
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_set_menu_sensitivity
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_set_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_unset_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_position_channel
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|gint
name|position
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_add_channel
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_remove_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|channel_list_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  for (un)installing the menu accelarators  */
end_comment

begin_function_decl
specifier|static
name|void
name|channels_dialog_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_unmap_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  ops buttons dnd callbacks  */
end_comment

begin_function_decl
specifier|static
name|gboolean
name|channels_dialog_drag_new_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|channels_dialog_drag_duplicate_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|channels_dialog_drag_channel_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|channels_dialog_drag_delete_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  channel widget function prototypes  */
end_comment

begin_function_decl
specifier|static
name|ChannelWidget
modifier|*
name|channel_widget_get_ID
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|ChannelWidget
modifier|*
name|channel_widget_create
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|ChannelType
name|channel_type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|channel_widget_drag_motion_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|channel_widget_drag_drop_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_drag_begin_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_drag_leave_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|guint
name|time
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_drag_indicator_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_drop_color
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_draw_drop_indicator
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|,
name|GimpDropType
name|drop_type
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_delete
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_select_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|channel_widget_button_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|channel_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_no_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_eye_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_exclusive_visible
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channel_widget_channel_flush
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_opacity_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_color_changed
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  assorted query dialogs  */
end_comment

begin_function_decl
specifier|static
name|void
name|channels_dialog_new_channel_query
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|channels_dialog_edit_channel_query
parameter_list|(
name|ChannelWidget
modifier|*
name|cw
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/****************/
end_comment

begin_comment
comment|/*  Local data  */
end_comment

begin_comment
comment|/****************/
end_comment

begin_decl_stmt
DECL|variable|channelsD
specifier|static
name|ChannelsDialog
modifier|*
name|channelsD
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|eye_pixmap
specifier|static
name|GdkPixmap
modifier|*
name|eye_pixmap
index|[]
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channel_pixmap
specifier|static
name|GdkPixmap
modifier|*
name|channel_pixmap
index|[]
init|=
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|suspend_gimage_notify
specifier|static
name|gint
name|suspend_gimage_notify
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  the ops buttons  */
end_comment

begin_decl_stmt
DECL|variable|to_selection_ext_callbacks
specifier|static
name|GtkSignalFunc
name|to_selection_ext_callbacks
index|[]
init|=
block|{
name|channels_dialog_add_channel_to_sel_callback
block|,
comment|/* SHIFT */
name|channels_dialog_sub_channel_from_sel_callback
block|,
comment|/* CTRL  */
name|channels_dialog_intersect_channel_with_sel_callback
block|,
comment|/* MOD1  */
name|channels_dialog_intersect_channel_with_sel_callback
block|,
comment|/* SHIFT + CTRL */
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channels_ops_buttons
specifier|static
name|OpsButton
name|channels_ops_buttons
index|[]
init|=
block|{
block|{
name|new_xpm
block|,
name|channels_dialog_new_channel_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"New Channel"
argument_list|)
block|,
literal|"channels/dialogs/new_channel.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|raise_xpm
block|,
name|channels_dialog_raise_channel_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Raise Channel"
argument_list|)
block|,
literal|"channels/raise_channel.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|lower_xpm
block|,
name|channels_dialog_lower_channel_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Lower Channel"
argument_list|)
block|,
literal|"channels/lower_channel.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|duplicate_xpm
block|,
name|channels_dialog_duplicate_channel_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Duplicate Channel"
argument_list|)
block|,
literal|"channels/duplicate_channel.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|toselection_xpm
block|,
name|channels_dialog_channel_to_sel_callback
block|,
name|to_selection_ext_callbacks
block|,
name|N_
argument_list|(
literal|"Channel to Selection \n"
literal|"<Shift> Add          "
literal|"<Ctrl> Subtract      "
literal|"<Shift><Ctrl> Intersect"
argument_list|)
block|,
literal|"channels/channel_to_selection.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|delete_xpm
block|,
name|channels_dialog_delete_channel_callback
block|,
name|NULL
block|,
name|N_
argument_list|(
literal|"Delete Channel"
argument_list|)
block|,
literal|"channels/delete_channel.html"
block|,
name|NULL
block|,
literal|0
block|}
block|,
block|{
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
literal|0
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  dnd structures  */
end_comment

begin_decl_stmt
DECL|variable|channel_color_target_table
specifier|static
name|GtkTargetEntry
name|channel_color_target_table
index|[]
init|=
block|{
name|GIMP_TARGET_CHANNEL
block|,
name|GIMP_TARGET_COLOR
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|n_channel_color_targets
specifier|static
name|guint
name|n_channel_color_targets
init|=
operator|(
sizeof|sizeof
argument_list|(
name|channel_color_target_table
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|channel_color_target_table
index|[
literal|0
index|]
argument_list|)
operator|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channel_target_table
specifier|static
name|GtkTargetEntry
name|channel_target_table
index|[]
init|=
block|{
name|GIMP_TARGET_CHANNEL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|n_channel_targets
specifier|static
name|guint
name|n_channel_targets
init|=
operator|(
sizeof|sizeof
argument_list|(
name|channel_target_table
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|channel_target_table
index|[
literal|0
index|]
argument_list|)
operator|)
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|component_target_table
specifier|static
name|GtkTargetEntry
name|component_target_table
index|[]
init|=
block|{
name|GIMP_TARGET_COMPONENT
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|n_component_targets
specifier|static
name|guint
name|n_component_targets
init|=
operator|(
sizeof|sizeof
argument_list|(
name|component_target_table
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|component_target_table
index|[
literal|0
index|]
argument_list|)
operator|)
decl_stmt|;
end_decl_stmt

begin_comment
comment|/**************************************/
end_comment

begin_comment
comment|/*  Public channels dialog functions  */
end_comment

begin_comment
comment|/**************************************/
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|channels_dialog_create (void)
name|channels_dialog_create
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button_box
decl_stmt|;
if|if
condition|(
name|channelsD
condition|)
return|return
name|channelsD
operator|->
name|vbox
return|;
name|channelsD
operator|=
name|g_new
argument_list|(
name|ChannelsDialog
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|preview
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|gimage
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|active_channel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|floating_sel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|preview_size
condition|)
block|{
name|channelsD
operator|->
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_GRAYSCALE
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|channelsD
operator|->
name|preview
argument_list|)
argument_list|,
name|preview_size
argument_list|,
name|preview_size
argument_list|)
expr_stmt|;
block|}
comment|/*  The main vbox  */
name|channelsD
operator|->
name|vbox
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|channelsD
operator|->
name|vbox
argument_list|,
name|NULL
argument_list|,
literal|"dialogs/channels/channels.html"
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|channelsD
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
comment|/*  The channels commands pulldown menu  */
name|menus_get_channels_menu
argument_list|(
operator|&
name|channelsD
operator|->
name|ops_menu
argument_list|,
operator|&
name|channelsD
operator|->
name|accel_group
argument_list|)
expr_stmt|;
comment|/*  The channels listbox  */
name|channelsD
operator|->
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|channelsD
operator|->
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_ALWAYS
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|channelsD
operator|->
name|scrolled_win
argument_list|,
name|LIST_WIDTH
argument_list|,
name|LIST_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|channelsD
operator|->
name|scrolled_win
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_list
operator|=
name|gtk_list_new
argument_list|()
expr_stmt|;
name|gtk_scrolled_window_add_with_viewport
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|channelsD
operator|->
name|scrolled_win
argument_list|)
argument_list|,
name|channelsD
operator|->
name|channel_list
argument_list|)
expr_stmt|;
name|gtk_list_set_selection_mode
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|GTK_SELECTION_MULTIPLE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channel_list_events
argument_list|,
name|channelsD
argument_list|)
expr_stmt|;
name|gtk_container_set_focus_vadjustment
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|channelsD
operator|->
name|scrolled_win
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|GTK_WIDGET_UNSET_FLAGS
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|channelsD
operator|->
name|scrolled_win
argument_list|)
operator|->
name|vscrollbar
argument_list|,
name|GTK_CAN_FOCUS
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channelsD
operator|->
name|scrolled_win
argument_list|)
expr_stmt|;
comment|/*  The ops buttons  */
name|button_box
operator|=
name|ops_button_box_new
argument_list|(
name|channels_ops_buttons
argument_list|,
name|OPS_BUTTON_NORMAL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|button_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button_box
argument_list|)
expr_stmt|;
comment|/*  Drop to new  */
name|gtk_drag_dest_set
argument_list|(
name|channels_ops_buttons
index|[
literal|0
index|]
operator|.
name|widget
argument_list|,
name|GTK_DEST_DEFAULT_ALL
argument_list|,
name|channel_target_table
argument_list|,
name|n_channel_targets
argument_list|,
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channels_ops_buttons
index|[
literal|0
index|]
operator|.
name|widget
argument_list|)
argument_list|,
literal|"drag_drop"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channels_dialog_drag_new_channel_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Drop to duplicate  */
name|gtk_drag_dest_set
argument_list|(
name|channels_ops_buttons
index|[
literal|3
index|]
operator|.
name|widget
argument_list|,
name|GTK_DEST_DEFAULT_ALL
argument_list|,
name|channel_target_table
argument_list|,
name|n_channel_targets
argument_list|,
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channels_ops_buttons
index|[
literal|3
index|]
operator|.
name|widget
argument_list|)
argument_list|,
literal|"drag_drop"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channels_dialog_drag_duplicate_channel_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Drop to channel to selection  */
name|gtk_drag_dest_set
argument_list|(
name|channels_ops_buttons
index|[
literal|4
index|]
operator|.
name|widget
argument_list|,
name|GTK_DEST_DEFAULT_ALL
argument_list|,
name|channel_target_table
argument_list|,
name|n_channel_targets
argument_list|,
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channels_ops_buttons
index|[
literal|4
index|]
operator|.
name|widget
argument_list|)
argument_list|,
literal|"drag_drop"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channels_dialog_drag_channel_to_sel_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Drop to trahcan  */
name|gtk_drag_dest_set
argument_list|(
name|channels_ops_buttons
index|[
literal|5
index|]
operator|.
name|widget
argument_list|,
name|GTK_DEST_DEFAULT_ALL
argument_list|,
name|channel_target_table
argument_list|,
name|n_channel_targets
argument_list|,
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channels_ops_buttons
index|[
literal|5
index|]
operator|.
name|widget
argument_list|)
argument_list|,
literal|"drag_drop"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channels_dialog_drag_delete_channel_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  Set up signals for map/unmap for the accelerators  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|vbox
argument_list|)
argument_list|,
literal|"map"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channels_dialog_map_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|vbox
argument_list|)
argument_list|,
literal|"unmap"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|channels_dialog_unmap_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channelsD
operator|->
name|vbox
argument_list|)
expr_stmt|;
return|return
name|channelsD
operator|->
name|vbox
return|;
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_free (void)
name|channels_dialog_free
parameter_list|(
name|void
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Free all elements in the channels listbox  */
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
while|while
condition|(
name|channelsD
operator|->
name|channel_widgets
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|channelsD
operator|->
name|channel_widgets
operator|->
name|data
expr_stmt|;
name|channel_widget_delete
argument_list|(
name|cw
argument_list|)
expr_stmt|;
block|}
name|channelsD
operator|->
name|channel_widgets
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|active_channel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|floating_sel
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|preview
condition|)
name|gtk_object_sink
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channelsD
operator|->
name|preview
argument_list|)
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|channelsD
argument_list|)
expr_stmt|;
name|channelsD
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_update (GimpImage * gimage)
name|channels_dialog_update
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|)
block|{
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|GList
modifier|*
name|item_list
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
name|channelsD
operator|->
name|gimage
operator|==
name|gimage
condition|)
return|return;
name|channelsD
operator|->
name|gimage
operator|=
name|gimage
expr_stmt|;
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Free all elements in the channels listbox  */
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
while|while
condition|(
name|channelsD
operator|->
name|channel_widgets
condition|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|channelsD
operator|->
name|channel_widgets
operator|->
name|data
expr_stmt|;
name|channel_widget_delete
argument_list|(
name|cw
argument_list|)
expr_stmt|;
block|}
name|channelsD
operator|->
name|channel_widgets
operator|=
name|NULL
expr_stmt|;
comment|/*  Find the preview extents  */
name|channels_dialog_preview_extents
argument_list|()
expr_stmt|;
name|channelsD
operator|->
name|active_channel
operator|=
name|NULL
expr_stmt|;
name|channelsD
operator|->
name|floating_sel
operator|=
name|NULL
expr_stmt|;
comment|/*  The image components  */
name|item_list
operator|=
name|NULL
expr_stmt|;
switch|switch
condition|(
operator|(
name|channelsD
operator|->
name|base_type
operator|=
name|gimp_image_base_type
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
case|case
name|RGB
case|:
name|cw
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|RED_CHANNEL
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|0
index|]
operator|=
name|RED_CHANNEL
expr_stmt|;
name|cw
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|GREEN_CHANNEL
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|1
index|]
operator|=
name|GREEN_CHANNEL
expr_stmt|;
name|cw
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|BLUE_CHANNEL
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|2
index|]
operator|=
name|BLUE_CHANNEL
expr_stmt|;
name|channelsD
operator|->
name|num_components
operator|=
literal|3
expr_stmt|;
break|break;
case|case
name|GRAY
case|:
name|cw
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|GRAY_CHANNEL
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|0
index|]
operator|=
name|GRAY_CHANNEL
expr_stmt|;
name|channelsD
operator|->
name|num_components
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|INDEXED
case|:
name|cw
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|INDEXED_CHANNEL
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
literal|0
index|]
operator|=
name|INDEXED_CHANNEL
expr_stmt|;
name|channelsD
operator|->
name|num_components
operator|=
literal|1
expr_stmt|;
break|break;
block|}
comment|/* EEEK */
name|cw
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|NULL
argument_list|,
name|ALPHA_CHANNEL
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|components
index|[
name|channelsD
operator|->
name|num_components
index|]
operator|=
name|ALPHA_CHANNEL
expr_stmt|;
name|channelsD
operator|->
name|num_components
operator|++
expr_stmt|;
comment|/*  The auxillary image channels  */
for|for
control|(
name|list
operator|=
name|GIMP_LIST
argument_list|(
name|gimage
operator|->
name|channels
argument_list|)
operator|->
name|list
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
comment|/*  create a channel list item  */
name|channel
operator|=
operator|(
name|GimpChannel
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|cw
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|channel
argument_list|,
name|AUXILLARY_CHANNEL
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_append
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|cw
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|cw
operator|->
name|list_item
argument_list|)
expr_stmt|;
block|}
comment|/*  get the index of the active channel  */
if|if
condition|(
name|item_list
condition|)
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|item_list
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_flush (void)
name|channels_dialog_flush
parameter_list|(
name|void
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|GSList
modifier|*
name|slist
decl_stmt|;
name|gint
name|pos
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
comment|/*  Check if the gimage extents have changed  */
if|if
condition|(
operator|(
name|gimage
operator|->
name|width
operator|!=
name|channelsD
operator|->
name|gimage_width
operator|)
operator|||
operator|(
name|gimage
operator|->
name|height
operator|!=
name|channelsD
operator|->
name|gimage_height
operator|)
operator|||
operator|(
name|gimp_image_base_type
argument_list|(
name|gimage
argument_list|)
operator|!=
name|channelsD
operator|->
name|base_type
operator|)
condition|)
block|{
name|channelsD
operator|->
name|gimage
operator|=
name|NULL
expr_stmt|;
name|channels_dialog_update
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/*  Set all current channel widgets to visited = FALSE  */
for|for
control|(
name|slist
operator|=
name|channelsD
operator|->
name|channel_widgets
init|;
name|slist
condition|;
name|slist
operator|=
name|g_slist_next
argument_list|(
name|slist
argument_list|)
control|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|slist
operator|->
name|data
expr_stmt|;
name|cw
operator|->
name|visited
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  Add any missing channels  */
for|for
control|(
name|list
operator|=
name|GIMP_LIST
argument_list|(
name|gimage
operator|->
name|channels
argument_list|)
operator|->
name|list
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|channel
operator|=
operator|(
name|GimpChannel
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|cw
operator|=
name|channel_widget_get_ID
argument_list|(
name|channel
argument_list|)
expr_stmt|;
comment|/*  If the channel isn't in the channel widget list, add it  */
if|if
condition|(
name|cw
operator|==
name|NULL
condition|)
block|{
comment|/*  sets visited = TRUE  */
name|channels_dialog_add_channel
argument_list|(
name|channel
argument_list|)
expr_stmt|;
block|}
else|else
name|cw
operator|->
name|visited
operator|=
name|TRUE
expr_stmt|;
block|}
comment|/*  Remove any extraneous auxillary channels  */
for|for
control|(
name|slist
operator|=
name|channelsD
operator|->
name|channel_widgets
init|;
name|slist
condition|;
control|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|slist
operator|->
name|data
expr_stmt|;
name|slist
operator|=
name|g_slist_next
argument_list|(
name|slist
argument_list|)
expr_stmt|;
if|if
condition|(
name|cw
operator|->
name|visited
operator|==
name|FALSE
operator|&&
name|cw
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
block|{
comment|/*  will only be true for auxillary channels  */
name|channels_dialog_remove_channel
argument_list|(
name|cw
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  Switch positions of items if necessary  */
name|pos
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|list
operator|=
name|GIMP_LIST
argument_list|(
name|gimage
operator|->
name|channels
argument_list|)
operator|->
name|list
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|channel
operator|=
operator|(
name|GimpChannel
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|channels_dialog_position_channel
argument_list|(
name|channel
argument_list|,
name|pos
operator|++
argument_list|)
expr_stmt|;
block|}
comment|/*  Set the active channel  */
if|if
condition|(
name|channelsD
operator|->
name|active_channel
operator|!=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
condition|)
name|channelsD
operator|->
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
comment|/*  set the menus if floating sel status has changed  */
if|if
condition|(
name|channelsD
operator|->
name|floating_sel
operator|!=
name|gimage
operator|->
name|floating_sel
condition|)
name|channelsD
operator|->
name|floating_sel
operator|=
name|gimage
operator|->
name|floating_sel
expr_stmt|;
name|channels_dialog_set_menu_sensitivity
argument_list|()
expr_stmt|;
name|gtk_container_foreach
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|channel_widget_channel_flush
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_clear (void)
name|channels_dialog_clear
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
name|suspend_gimage_notify
operator|++
expr_stmt|;
name|gtk_list_clear_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
name|channelsD
operator|->
name|gimage
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_preview_extents (void)
name|channels_dialog_preview_extents
parameter_list|(
name|void
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|channelsD
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
name|channelsD
operator|->
name|gimage_width
operator|=
name|gimage
operator|->
name|width
expr_stmt|;
name|channelsD
operator|->
name|gimage_height
operator|=
name|gimage
operator|->
name|height
expr_stmt|;
comment|/*  Get the image width and height variables, based on the gimage  */
if|if
condition|(
name|gimage
operator|->
name|width
operator|>
name|gimage
operator|->
name|height
condition|)
name|channelsD
operator|->
name|ratio
operator|=
operator|(
name|gdouble
operator|)
name|preview_size
operator|/
operator|(
name|gdouble
operator|)
name|gimage
operator|->
name|width
expr_stmt|;
else|else
name|channelsD
operator|->
name|ratio
operator|=
operator|(
name|gdouble
operator|)
name|preview_size
operator|/
operator|(
name|gdouble
operator|)
name|gimage
operator|->
name|height
expr_stmt|;
if|if
condition|(
name|preview_size
condition|)
block|{
name|channelsD
operator|->
name|image_width
operator|=
name|RINT
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|gimage
operator|->
name|width
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|image_height
operator|=
name|RINT
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|gimage
operator|->
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|image_width
operator|<
literal|1
condition|)
name|channelsD
operator|->
name|image_width
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|image_height
operator|<
literal|1
condition|)
name|channelsD
operator|->
name|image_height
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|channelsD
operator|->
name|image_width
operator|=
name|channel_width
expr_stmt|;
name|channelsD
operator|->
name|image_height
operator|=
name|channel_height
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_set_menu_sensitivity (void)
name|channels_dialog_set_menu_sensitivity
parameter_list|(
name|void
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|gint
name|fs_sens
decl_stmt|;
name|gint
name|aux_sens
decl_stmt|;
name|cw
operator|=
name|channel_widget_get_ID
argument_list|(
name|channelsD
operator|->
name|active_channel
argument_list|)
expr_stmt|;
name|fs_sens
operator|=
operator|(
name|channelsD
operator|->
name|floating_sel
operator|!=
name|NULL
operator|)
expr_stmt|;
if|if
condition|(
name|cw
condition|)
name|aux_sens
operator|=
operator|(
name|cw
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
operator|)
expr_stmt|;
else|else
name|aux_sens
operator|=
name|FALSE
expr_stmt|;
DECL|macro|SET_SENSITIVE (menu,condition)
define|#
directive|define
name|SET_SENSITIVE
parameter_list|(
name|menu
parameter_list|,
name|condition
parameter_list|)
define|\
value|menus_set_sensitive ("<Channels>/" menu, (condition) != 0)
DECL|macro|SET_OPS_SENSITIVE (button,condition)
define|#
directive|define
name|SET_OPS_SENSITIVE
parameter_list|(
name|button
parameter_list|,
name|condition
parameter_list|)
define|\
value|gtk_widget_set_sensitive (channels_ops_buttons[(button)].widget, \                                  (condition) != 0)
name|SET_SENSITIVE
argument_list|(
literal|"New Channel..."
argument_list|,
operator|!
name|fs_sens
argument_list|)
expr_stmt|;
name|SET_OPS_SENSITIVE
argument_list|(
literal|0
argument_list|,
operator|!
name|fs_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Raise Channel"
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_OPS_SENSITIVE
argument_list|(
literal|1
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Lower Channel"
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_OPS_SENSITIVE
argument_list|(
literal|2
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Duplicate Channel"
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_OPS_SENSITIVE
argument_list|(
literal|3
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Channel to Selection"
argument_list|,
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_OPS_SENSITIVE
argument_list|(
literal|4
argument_list|,
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Add to Selection"
argument_list|,
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Subtract from Selection"
argument_list|,
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Intersect with Selection"
argument_list|,
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Delete Channel"
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_OPS_SENSITIVE
argument_list|(
literal|5
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
name|SET_SENSITIVE
argument_list|(
literal|"Edit Channel Attributes..."
argument_list|,
operator|!
name|fs_sens
operator|&&
name|aux_sens
argument_list|)
expr_stmt|;
undef|#
directive|undef
name|SET_OPS_SENSITIVE
undef|#
directive|undef
name|SET_SENSITIVE
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|channels_dialog_idle_set_channel_focus (gpointer data)
name|channels_dialog_idle_set_channel_focus
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|gtk_widget_grab_focus
argument_list|(
name|GTK_WIDGET
argument_list|(
name|data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_set_channel (ChannelWidget * channel_widget)
name|channels_dialog_set_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GtkStateType
name|state
decl_stmt|;
name|gint
name|index
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  get the list item data  */
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
block|{
comment|/*  turn on the specified auxillary channel  */
name|index
operator|=
name|gimp_image_get_channel_index
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|index
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|state
operator|!=
name|GTK_STATE_SELECTED
operator|)
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
comment|/*  let dnd finish it's work before setting the focus  */
name|gtk_idle_add
argument_list|(
operator|(
name|GtkFunction
operator|)
name|channels_dialog_idle_set_channel_focus
argument_list|,
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/* channels_dialog_scroll_index (index + channelsD->num_components); */
block|}
block|}
else|else
block|{
if|if
condition|(
name|state
operator|!=
name|GTK_STATE_SELECTED
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|RED_CHANNEL
case|:
case|case
name|GRAY_CHANNEL
case|:
case|case
name|INDEXED_CHANNEL
case|:
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|GREEN_CHANNEL
case|:
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|BLUE_CHANNEL
case|:
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
name|ALPHA_CHANNEL
case|:
name|gtk_list_select_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUXILLARY_CHANNEL
case|:
name|g_error
argument_list|(
literal|"error in %s at %d: this shouldn't happen."
argument_list|,
name|__FILE__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/* channels_dialog_scroll_index (0); */
block|}
block|}
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_unset_channel (ChannelWidget * channel_widget)
name|channels_dialog_unset_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GtkStateType
name|state
decl_stmt|;
name|gint
name|index
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  get the list item data  */
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
block|{
comment|/*  turn off the specified auxillary channel  */
name|index
operator|=
name|gimp_image_get_channel_index
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|index
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|state
operator|==
name|GTK_STATE_SELECTED
operator|)
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
block|{
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|RED_CHANNEL
case|:
case|case
name|GRAY_CHANNEL
case|:
case|case
name|INDEXED_CHANNEL
case|:
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|GREEN_CHANNEL
case|:
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
break|break;
case|case
name|BLUE_CHANNEL
case|:
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
break|break;
case|case
name|ALPHA_CHANNEL
case|:
name|gtk_list_unselect_item
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUXILLARY_CHANNEL
case|:
name|g_error
argument_list|(
literal|"error in %s at %d: this shouldn't happen."
argument_list|,
name|__FILE__
argument_list|,
name|__LINE__
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_position_channel (GimpChannel * channel,gint new_index)
name|channels_dialog_position_channel
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|gint
name|new_index
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GList
modifier|*
name|list
init|=
name|NULL
decl_stmt|;
name|channel_widget
operator|=
name|channel_widget_get_ID
argument_list|(
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
if|if
condition|(
operator|(
name|new_index
operator|+
name|channelsD
operator|->
name|num_components
operator|)
operator|==
name|g_slist_index
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|)
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Remove the channel from the dialog  */
name|list
operator|=
name|g_list_append
argument_list|(
name|list
argument_list|,
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_remove_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_remove
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  Add it back at the proper index  */
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|list
argument_list|,
name|new_index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_insert
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|,
name|new_index
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
comment|/*   channels_dialog_scroll_index (new_index> 0 ?  */
comment|/* 				new_index + channelsD->num_components + 1 : */
comment|/* 				channelsD->num_components); */
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_add_channel (GimpChannel * channel)
name|channels_dialog_add_channel
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GList
modifier|*
name|item_list
decl_stmt|;
name|gint
name|position
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
name|item_list
operator|=
name|NULL
expr_stmt|;
name|channel_widget
operator|=
name|channel_widget_create
argument_list|(
name|gimage
argument_list|,
name|channel
argument_list|,
name|AUXILLARY_CHANNEL
argument_list|)
expr_stmt|;
name|item_list
operator|=
name|g_list_append
argument_list|(
name|item_list
argument_list|,
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|position
operator|=
name|gimp_image_get_channel_index
argument_list|(
name|gimage
argument_list|,
name|channel
argument_list|)
expr_stmt|;
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_insert
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|,
name|position
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
name|gtk_list_insert_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|item_list
argument_list|,
name|position
operator|+
name|channelsD
operator|->
name|num_components
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_remove_channel (ChannelWidget * channel_widget)
name|channels_dialog_remove_channel
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GList
modifier|*
name|list
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
name|channel_widget
condition|)
return|return;
comment|/*  Make sure the gimage is not notified of this change  */
name|suspend_gimage_notify
operator|++
expr_stmt|;
comment|/*  Remove the requested channel from the dialog  */
name|list
operator|=
name|g_list_append
argument_list|(
name|list
argument_list|,
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|gtk_list_remove_items
argument_list|(
name|GTK_LIST
argument_list|(
name|channelsD
operator|->
name|channel_list
argument_list|)
argument_list|,
name|list
argument_list|)
expr_stmt|;
comment|/*  Delete the channel_widget  */
name|channel_widget_delete
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
name|suspend_gimage_notify
operator|--
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|channel_list_events (GtkWidget * widget,GdkEvent * event)
name|channel_list_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|GtkWidget
modifier|*
name|event_widget
decl_stmt|;
name|event_widget
operator|=
name|gtk_get_event_widget
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|GTK_IS_LIST_ITEM
argument_list|(
name|event_widget
argument_list|)
condition|)
block|{
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|event_widget
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|channelsD
operator|->
name|ops_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|bevent
operator|->
name|button
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|GDK_2BUTTON_PRESS
case|:
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
name|channels_dialog_edit_channel_query
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
default|default:
break|break;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*******************************/
end_comment

begin_comment
comment|/*  channels dialog callbacks  */
end_comment

begin_comment
comment|/*******************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|channels_dialog_map_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_map_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
name|gtk_window_add_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|lc_dialog
operator|->
name|shell
argument_list|)
argument_list|,
name|channelsD
operator|->
name|accel_group
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_unmap_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_unmap_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
name|gtk_window_remove_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|lc_dialog
operator|->
name|shell
argument_list|)
argument_list|,
name|channelsD
operator|->
name|accel_group
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/***********************************/
end_comment

begin_comment
comment|/*  callbacks exported to menus.c  */
end_comment

begin_comment
comment|/***********************************/
end_comment

begin_function
name|void
DECL|function|channels_dialog_new_channel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_new_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|channelsD
operator|||
name|channelsD
operator|->
name|gimage
operator|==
name|NULL
condition|)
return|return;
name|channels_dialog_new_channel_query
argument_list|(
name|channelsD
operator|->
name|gimage
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_raise_channel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_raise_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
condition|)
block|{
name|gimp_image_raise_channel
argument_list|(
name|gimage
argument_list|,
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_lower_channel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_lower_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
condition|)
block|{
name|gimp_image_lower_channel
argument_list|(
name|gimage
argument_list|,
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_duplicate_channel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_duplicate_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
name|GimpChannel
modifier|*
name|new_channel
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|new_channel
operator|=
name|gimp_channel_copy
argument_list|(
name|active_channel
argument_list|)
expr_stmt|;
name|gimp_image_add_channel
argument_list|(
name|gimage
argument_list|,
name|new_channel
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_delete_channel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_delete_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|gimp_image_remove_channel
argument_list|(
name|gimage
argument_list|,
name|active_channel
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_channel_to_sel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_channel_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|gimage_mask_load
argument_list|(
name|gimage
argument_list|,
name|active_channel
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_add_channel_to_sel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_add_channel_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
name|GimpChannel
modifier|*
name|new_channel
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|new_channel
operator|=
name|gimp_channel_copy
argument_list|(
name|gimp_image_get_mask
argument_list|(
name|gimage
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_channel_combine_mask
argument_list|(
name|new_channel
argument_list|,
name|active_channel
argument_list|,
name|CHANNEL_OP_ADD
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* off x/y */
name|gimage_mask_load
argument_list|(
name|gimage
argument_list|,
name|new_channel
argument_list|)
expr_stmt|;
name|gtk_object_unref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|new_channel
argument_list|)
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_sub_channel_from_sel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_sub_channel_from_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
name|GimpChannel
modifier|*
name|new_channel
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|new_channel
operator|=
name|gimp_channel_copy
argument_list|(
name|gimp_image_get_mask
argument_list|(
name|gimage
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_channel_combine_mask
argument_list|(
name|new_channel
argument_list|,
name|active_channel
argument_list|,
name|CHANNEL_OP_SUB
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* off x/y */
name|gimage_mask_load
argument_list|(
name|gimage
argument_list|,
name|new_channel
argument_list|)
expr_stmt|;
name|gtk_object_unref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|new_channel
argument_list|)
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_intersect_channel_with_sel_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_intersect_channel_with_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
name|GimpChannel
modifier|*
name|new_channel
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
operator|||
operator|!
operator|(
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
operator|)
condition|)
return|return;
if|if
condition|(
operator|(
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|gimage
argument_list|)
operator|)
condition|)
block|{
name|new_channel
operator|=
name|gimp_channel_copy
argument_list|(
name|gimp_image_get_mask
argument_list|(
name|gimage
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_channel_combine_mask
argument_list|(
name|new_channel
argument_list|,
name|active_channel
argument_list|,
name|CHANNEL_OP_INTERSECT
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* off x/y */
name|gimage_mask_load
argument_list|(
name|gimage
argument_list|,
name|new_channel
argument_list|)
expr_stmt|;
name|gtk_object_unref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|new_channel
argument_list|)
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|channels_dialog_edit_channel_attributes_callback (GtkWidget * widget,gpointer data)
name|channels_dialog_edit_channel_attributes_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|channelsD
operator|&&
name|channelsD
operator|->
name|active_channel
condition|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|channel_widget
operator|=
name|channel_widget_get_ID
argument_list|(
name|channelsD
operator|->
name|active_channel
argument_list|)
expr_stmt|;
name|channels_dialog_edit_channel_query
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*******************************/
end_comment

begin_comment
comment|/*  ops buttons dnd callbacks  */
end_comment

begin_comment
comment|/*******************************/
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|channels_dialog_drag_new_channel_callback (GtkWidget * widget,GdkDragContext * context,gint x,gint y,guint time)
name|channels_dialog_drag_new_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|src_widget
decl_stmt|;
name|gboolean
name|return_val
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
operator|(
name|src_widget
operator|=
name|gtk_drag_get_source_widget
argument_list|(
name|context
argument_list|)
operator|)
condition|)
block|{
name|ChannelWidget
modifier|*
name|src
decl_stmt|;
name|src
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|src_widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|&&
name|src
operator|->
name|channel
operator|==
name|channelsD
operator|->
name|active_channel
condition|)
block|{
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
name|gint
name|off_x
decl_stmt|,
name|off_y
decl_stmt|;
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
expr_stmt|;
name|width
operator|=
name|gimp_drawable_width
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|src
operator|->
name|channel
argument_list|)
argument_list|)
expr_stmt|;
name|height
operator|=
name|gimp_drawable_height
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|src
operator|->
name|channel
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_drawable_offsets
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|src
operator|->
name|channel
argument_list|)
argument_list|,
operator|&
name|off_x
argument_list|,
operator|&
name|off_y
argument_list|)
expr_stmt|;
comment|/*  Start a group undo  */
name|undo_push_group_start
argument_list|(
name|gimage
argument_list|,
name|EDIT_PASTE_UNDO
argument_list|)
expr_stmt|;
name|channel
operator|=
name|gimp_channel_new
argument_list|(
name|gimage
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
name|_
argument_list|(
literal|"Empty Channel Copy"
argument_list|)
argument_list|,
operator|&
name|src
operator|->
name|channel
operator|->
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
condition|)
block|{
name|drawable_fill
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
argument_list|,
name|TRANSPARENT_FILL
argument_list|)
expr_stmt|;
name|gimp_channel_translate
argument_list|(
name|channel
argument_list|,
name|off_x
argument_list|,
name|off_y
argument_list|)
expr_stmt|;
name|gimp_image_add_channel
argument_list|(
name|gimage
argument_list|,
name|channel
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/*  End the group undo  */
name|undo_push_group_end
argument_list|(
name|gimage
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|g_message
argument_list|(
literal|"channels_dialog_drop_new_channel_callback():\n"
literal|"could not allocate new channel"
argument_list|)
expr_stmt|;
block|}
name|return_val
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
name|gtk_drag_finish
argument_list|(
name|context
argument_list|,
name|return_val
argument_list|,
name|FALSE
argument_list|,
name|time
argument_list|)
expr_stmt|;
return|return
name|return_val
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|channels_dialog_drag_duplicate_channel_callback (GtkWidget * widget,GdkDragContext * context,gint x,gint y,guint time)
name|channels_dialog_drag_duplicate_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|src_widget
decl_stmt|;
name|gboolean
name|return_val
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
operator|(
name|src_widget
operator|=
name|gtk_drag_get_source_widget
argument_list|(
name|context
argument_list|)
operator|)
condition|)
block|{
name|ChannelWidget
modifier|*
name|src
decl_stmt|;
name|src
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|src_widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|&&
name|src
operator|->
name|channel
operator|==
name|channelsD
operator|->
name|active_channel
condition|)
block|{
name|channels_dialog_duplicate_channel_callback
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|return_val
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
name|gtk_drag_finish
argument_list|(
name|context
argument_list|,
name|return_val
argument_list|,
name|FALSE
argument_list|,
name|time
argument_list|)
expr_stmt|;
return|return
name|return_val
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|channels_dialog_drag_channel_to_sel_callback (GtkWidget * widget,GdkDragContext * context,gint x,gint y,guint time)
name|channels_dialog_drag_channel_to_sel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|src_widget
decl_stmt|;
name|gboolean
name|return_val
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
operator|(
name|src_widget
operator|=
name|gtk_drag_get_source_widget
argument_list|(
name|context
argument_list|)
operator|)
condition|)
block|{
name|ChannelWidget
modifier|*
name|src
decl_stmt|;
name|src
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|src_widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|&&
name|src
operator|->
name|channel
operator|==
name|channelsD
operator|->
name|active_channel
condition|)
block|{
name|channels_dialog_channel_to_sel_callback
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|return_val
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
name|gtk_drag_finish
argument_list|(
name|context
argument_list|,
name|return_val
argument_list|,
name|FALSE
argument_list|,
name|time
argument_list|)
expr_stmt|;
return|return
name|return_val
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|channels_dialog_drag_delete_channel_callback (GtkWidget * widget,GdkDragContext * context,gint x,gint y,guint time)
name|channels_dialog_drag_delete_channel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|src_widget
decl_stmt|;
name|gboolean
name|return_val
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
operator|(
name|src_widget
operator|=
name|gtk_drag_get_source_widget
argument_list|(
name|context
argument_list|)
operator|)
condition|)
block|{
name|ChannelWidget
modifier|*
name|src
decl_stmt|;
name|src
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|src_widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|&&
name|src
operator|->
name|channel
operator|==
name|channelsD
operator|->
name|active_channel
condition|)
block|{
name|channels_dialog_delete_channel_callback
argument_list|(
name|widget
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|return_val
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
name|gtk_drag_finish
argument_list|(
name|context
argument_list|,
name|return_val
argument_list|,
name|FALSE
argument_list|,
name|time
argument_list|)
expr_stmt|;
return|return
name|return_val
return|;
block|}
end_function

begin_comment
comment|/******************************/
end_comment

begin_comment
comment|/*  channel widget functions  */
end_comment

begin_comment
comment|/******************************/
end_comment

begin_function
specifier|static
name|ChannelWidget
modifier|*
DECL|function|channel_widget_get_ID (GimpChannel * channel)
name|channel_widget_get_ID
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|lw
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return
name|NULL
return|;
for|for
control|(
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
init|;
name|list
condition|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|lw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|lw
operator|->
name|channel
operator|==
name|channel
condition|)
return|return
name|lw
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|ChannelWidget
modifier|*
DECL|function|channel_widget_create (GimpImage * gimage,GimpChannel * channel,ChannelType type)
name|channel_widget_create
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|ChannelType
name|type
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|list_item
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|alignment
decl_stmt|;
name|list_item
operator|=
name|gtk_list_item_new
argument_list|()
expr_stmt|;
comment|/*  Create the channel widget and add it to the list  */
name|channel_widget
operator|=
name|g_new
argument_list|(
name|ChannelWidget
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|gimage
operator|=
name|gimage
expr_stmt|;
name|channel_widget
operator|->
name|channel
operator|=
name|channel
expr_stmt|;
name|channel_widget
operator|->
name|channel_preview
operator|=
name|NULL
expr_stmt|;
name|channel_widget
operator|->
name|channel_pixmap
operator|=
name|NULL
expr_stmt|;
name|channel_widget
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|channel_widget
operator|->
name|ID
operator|=
operator|(
operator|(
name|type
operator|==
name|AUXILLARY_CHANNEL
operator|)
condition|?
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|ID
else|:
operator|(
name|COMPONENT_BASE_ID
operator|+
name|type
operator|)
operator|)
expr_stmt|;
name|channel_widget
operator|->
name|list_item
operator|=
name|list_item
expr_stmt|;
name|channel_widget
operator|->
name|width
operator|=
operator|-
literal|1
expr_stmt|;
name|channel_widget
operator|->
name|height
operator|=
operator|-
literal|1
expr_stmt|;
name|channel_widget
operator|->
name|visited
operator|=
name|TRUE
expr_stmt|;
name|channel_widget
operator|->
name|drop_type
operator|=
name|GIMP_DROP_NONE
expr_stmt|;
comment|/*  Need to let the list item know about the channel_widget  */
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  Set up the list item observer  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"select"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_select_update
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"deselect"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_select_update
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|list_item
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|/*  Create the visibility toggle button  */
name|alignment
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|alignment
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|eye_widget
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|,
name|BUTTON_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
argument_list|,
literal|"event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_button_events
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|alignment
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|eye_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channel_widget
operator|->
name|eye_widget
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
comment|/*  The channel preview  */
name|alignment
operator|=
name|gtk_alignment_new
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|alignment
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|channel_preview
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|,
name|PREVIEW_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
argument_list|,
literal|"event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_preview_events
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_object_set_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|alignment
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|channel_preview
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
expr_stmt|;
comment|/*  The channel name label */
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|RED_CHANNEL
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Red"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|GREEN_CHANNEL
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Green"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|BLUE_CHANNEL
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Blue"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAY_CHANNEL
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Gray"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|INDEXED_CHANNEL
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Indexed"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|ALPHA_CHANNEL
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Alpha"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|AUXILLARY_CHANNEL
case|:
name|channel_widget
operator|->
name|label
operator|=
name|gtk_label_new
argument_list|(
name|gimp_object_get_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|channel
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|channel_widget
operator|->
name|label
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
block|{
comment|/*  dnd destination  */
name|gtk_drag_dest_set
argument_list|(
name|list_item
argument_list|,
name|GTK_DEST_DEFAULT_ALL
argument_list|,
name|channel_color_target_table
argument_list|,
name|n_channel_color_targets
argument_list|,
name|GDK_ACTION_MOVE
operator||
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gimp_dnd_color_dest_set
argument_list|(
name|list_item
argument_list|,
name|channel_widget_drop_color
argument_list|,
operator|(
name|gpointer
operator|)
name|channel_widget
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"drag_leave"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_drag_leave_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"drag_motion"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_drag_motion_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"drag_drop"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_drag_drop_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  re-paint the drop indicator after drawing the widget  */
name|gtk_signal_connect_after
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"draw"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_drag_indicator_callback
argument_list|)
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  dnd source  */
name|gtk_drag_source_set
argument_list|(
name|list_item
argument_list|,
name|GDK_BUTTON1_MASK
operator||
name|GDK_BUTTON2_MASK
argument_list|,
name|channel_target_table
argument_list|,
name|n_channel_targets
argument_list|,
name|GDK_ACTION_MOVE
operator||
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"drag_begin"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channel_widget_drag_begin_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"gimp_channel"
argument_list|,
operator|(
name|gpointer
operator|)
name|channel
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/*  dnd source  */
name|gtk_drag_source_set
argument_list|(
name|list_item
argument_list|,
name|GDK_BUTTON1_MASK
operator||
name|GDK_BUTTON2_MASK
argument_list|,
name|component_target_table
argument_list|,
name|n_component_targets
argument_list|,
name|GDK_ACTION_MOVE
operator||
name|GDK_ACTION_COPY
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"gimp_component"
argument_list|,
operator|(
name|gpointer
operator|)
name|gimage
argument_list|)
expr_stmt|;
name|gtk_object_set_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|list_item
argument_list|)
argument_list|,
literal|"gimp_component_type"
argument_list|,
operator|(
name|gpointer
operator|)
name|channel_widget
operator|->
name|type
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|list_item
argument_list|)
expr_stmt|;
name|gtk_widget_ref
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
return|return
name|channel_widget
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|channel_widget_drag_motion_callback (GtkWidget * widget,GdkDragContext * context,gint x,gint y,guint time)
name|channel_widget_drag_motion_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|dest
decl_stmt|;
name|gint
name|dest_index
decl_stmt|;
name|GtkWidget
modifier|*
name|src_widget
decl_stmt|;
name|ChannelWidget
modifier|*
name|src
init|=
name|NULL
decl_stmt|;
name|gint
name|src_index
decl_stmt|;
name|gint
name|difference
decl_stmt|;
name|GimpDropType
name|drop_type
init|=
name|GIMP_DROP_NONE
decl_stmt|;
name|GdkDragAction
name|drag_action
init|=
name|GDK_ACTION_DEFAULT
decl_stmt|;
name|gboolean
name|return_val
init|=
name|FALSE
decl_stmt|;
name|dest
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dest
condition|)
block|{
name|src_widget
operator|=
name|gtk_drag_get_source_widget
argument_list|(
name|context
argument_list|)
expr_stmt|;
if|if
condition|(
name|src_widget
condition|)
block|{
name|src
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|src_widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|&&
name|src
operator|->
name|channel
operator|==
name|channelsD
operator|->
name|active_channel
condition|)
block|{
name|src_index
operator|=
name|gimp_image_get_channel_index
argument_list|(
name|channelsD
operator|->
name|gimage
argument_list|,
name|src
operator|->
name|channel
argument_list|)
expr_stmt|;
name|dest_index
operator|=
name|gimp_image_get_channel_index
argument_list|(
name|channelsD
operator|->
name|gimage
argument_list|,
name|dest
operator|->
name|channel
argument_list|)
expr_stmt|;
name|difference
operator|=
name|dest_index
operator|-
name|src_index
expr_stmt|;
name|drop_type
operator|=
operator|(
operator|(
name|y
operator|<
name|widget
operator|->
name|allocation
operator|.
name|height
operator|/
literal|2
operator|)
condition|?
name|GIMP_DROP_ABOVE
else|:
name|GIMP_DROP_BELOW
operator|)
expr_stmt|;
if|if
condition|(
name|difference
operator|<
literal|0
operator|&&
name|drop_type
operator|==
name|GIMP_DROP_BELOW
condition|)
block|{
name|dest_index
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|difference
operator|>
literal|0
operator|&&
name|drop_type
operator|==
name|GIMP_DROP_ABOVE
condition|)
block|{
name|dest_index
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|src_index
operator|!=
name|dest_index
condition|)
block|{
name|drag_action
operator|=
name|GDK_ACTION_MOVE
expr_stmt|;
name|return_val
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|drop_type
operator|=
name|GIMP_DROP_NONE
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|src
condition|)
block|{
name|drag_action
operator|=
name|GDK_ACTION_COPY
expr_stmt|;
name|return_val
operator|=
name|TRUE
expr_stmt|;
name|drop_type
operator|=
name|GIMP_DROP_NONE
expr_stmt|;
block|}
block|}
name|gdk_drag_status
argument_list|(
name|context
argument_list|,
name|drag_action
argument_list|,
name|time
argument_list|)
expr_stmt|;
if|if
condition|(
name|dest
operator|&&
name|drop_type
operator|!=
name|dest
operator|->
name|drop_type
condition|)
block|{
name|channel_widget_draw_drop_indicator
argument_list|(
name|dest
argument_list|,
name|dest
operator|->
name|drop_type
argument_list|)
expr_stmt|;
name|channel_widget_draw_drop_indicator
argument_list|(
name|dest
argument_list|,
name|drop_type
argument_list|)
expr_stmt|;
name|dest
operator|->
name|drop_type
operator|=
name|drop_type
expr_stmt|;
block|}
return|return
name|return_val
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_drag_begin_callback (GtkWidget * widget,GdkDragContext * context)
name|channel_widget_drag_begin_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_dnd_set_drawable_preview_icon
argument_list|(
name|widget
argument_list|,
name|context
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon2bd3140c0108
block|{
DECL|member|gimage
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
DECL|member|channel
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
DECL|member|dest_index
name|gint
name|dest_index
decl_stmt|;
DECL|typedef|ChannelDrop
block|}
name|ChannelDrop
typedef|;
end_typedef

begin_function
specifier|static
name|gint
DECL|function|channel_widget_idle_drop_channel (gpointer data)
name|channel_widget_idle_drop_channel
parameter_list|(
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelDrop
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
operator|(
name|ChannelDrop
operator|*
operator|)
name|data
expr_stmt|;
name|gimp_image_position_channel
argument_list|(
name|cd
operator|->
name|gimage
argument_list|,
name|cd
operator|->
name|channel
argument_list|,
name|cd
operator|->
name|dest_index
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
name|g_free
argument_list|(
name|cd
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|channel_widget_drag_drop_callback (GtkWidget * widget,GdkDragContext * context,gint x,gint y,guint time)
name|channel_widget_drag_drop_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|time
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|dest
decl_stmt|;
name|gint
name|dest_index
decl_stmt|;
name|GtkWidget
modifier|*
name|src_widget
decl_stmt|;
name|ChannelWidget
modifier|*
name|src
decl_stmt|;
name|gint
name|src_index
decl_stmt|;
name|gint
name|difference
decl_stmt|;
name|GimpDropType
name|drop_type
init|=
name|GIMP_DROP_NONE
decl_stmt|;
name|gboolean
name|return_val
init|=
name|FALSE
decl_stmt|;
name|dest
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dest
operator|&&
operator|(
name|src_widget
operator|=
name|gtk_drag_get_source_widget
argument_list|(
name|context
argument_list|)
operator|)
condition|)
block|{
name|src
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|src_widget
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|src
operator|&&
name|src
operator|->
name|channel
operator|==
name|channelsD
operator|->
name|active_channel
condition|)
block|{
name|src_index
operator|=
name|gimp_image_get_channel_index
argument_list|(
name|channelsD
operator|->
name|gimage
argument_list|,
name|src
operator|->
name|channel
argument_list|)
expr_stmt|;
name|dest_index
operator|=
name|gimp_image_get_channel_index
argument_list|(
name|channelsD
operator|->
name|gimage
argument_list|,
name|dest
operator|->
name|channel
argument_list|)
expr_stmt|;
name|difference
operator|=
name|dest_index
operator|-
name|src_index
expr_stmt|;
name|drop_type
operator|=
operator|(
operator|(
name|y
operator|<
name|widget
operator|->
name|allocation
operator|.
name|height
operator|/
literal|2
operator|)
condition|?
name|GIMP_DROP_ABOVE
else|:
name|GIMP_DROP_BELOW
operator|)
expr_stmt|;
if|if
condition|(
name|difference
operator|<
literal|0
operator|&&
name|drop_type
operator|==
name|GIMP_DROP_BELOW
condition|)
block|{
name|dest_index
operator|++
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|difference
operator|>
literal|0
operator|&&
name|drop_type
operator|==
name|GIMP_DROP_ABOVE
condition|)
block|{
name|dest_index
operator|--
expr_stmt|;
block|}
if|if
condition|(
name|src_index
operator|!=
name|dest_index
condition|)
block|{
name|ChannelDrop
modifier|*
name|cd
decl_stmt|;
name|cd
operator|=
name|g_new
argument_list|(
name|ChannelDrop
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|cd
operator|->
name|gimage
operator|=
name|channelsD
operator|->
name|gimage
expr_stmt|;
name|cd
operator|->
name|channel
operator|=
name|src
operator|->
name|channel
expr_stmt|;
name|cd
operator|->
name|dest_index
operator|=
name|dest_index
expr_stmt|;
comment|/*  let dnd finish it's work before changing the widget tree  */
name|gtk_idle_add
argument_list|(
operator|(
name|GtkFunction
operator|)
name|channel_widget_idle_drop_channel
argument_list|,
name|cd
argument_list|)
expr_stmt|;
name|return_val
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|dest
condition|)
block|{
if|if
condition|(
operator|!
name|return_val
condition|)
name|channel_widget_draw_drop_indicator
argument_list|(
name|dest
argument_list|,
name|dest
operator|->
name|drop_type
argument_list|)
expr_stmt|;
name|dest
operator|->
name|drop_type
operator|=
name|GIMP_DROP_NONE
expr_stmt|;
block|}
name|gtk_drag_finish
argument_list|(
name|context
argument_list|,
name|return_val
argument_list|,
name|FALSE
argument_list|,
name|time
argument_list|)
expr_stmt|;
return|return
name|return_val
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_drag_leave_callback (GtkWidget * widget,GdkDragContext * context,guint time)
name|channel_widget_drag_leave_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkDragContext
modifier|*
name|context
parameter_list|,
name|guint
name|time
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|drop_type
operator|=
name|GIMP_DROP_NONE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_drag_indicator_callback (GtkWidget * widget,gpointer data)
name|channel_widget_drag_indicator_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|channel_widget_draw_drop_indicator
argument_list|(
name|channel_widget
argument_list|,
name|channel_widget
operator|->
name|drop_type
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_drop_color (GtkWidget * widget,const GimpRGB * color,gpointer data)
name|channel_widget_drop_color
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|data
expr_stmt|;
name|channel
operator|=
name|channel_widget
operator|->
name|channel
expr_stmt|;
if|if
condition|(
name|gimp_rgba_distance
argument_list|(
name|color
argument_list|,
operator|&
name|channel
operator|->
name|color
argument_list|)
operator|>
literal|0.0001
condition|)
block|{
name|channel
operator|->
name|color
operator|=
operator|*
name|color
expr_stmt|;
name|drawable_update
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|width
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|height
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_draw_drop_indicator (ChannelWidget * channel_widget,GimpDropType drop_type)
name|channel_widget_draw_drop_indicator
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|,
name|GimpDropType
name|drop_type
parameter_list|)
block|{
specifier|static
name|GdkGC
modifier|*
name|gc
init|=
name|NULL
decl_stmt|;
name|gint
name|y
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|gc
condition|)
block|{
name|GdkColor
name|fg
decl_stmt|,
name|bg
decl_stmt|;
name|gc
operator|=
name|gdk_gc_new
argument_list|(
name|channel_widget
operator|->
name|list_item
operator|->
name|window
argument_list|)
expr_stmt|;
name|fg
operator|.
name|pixel
operator|=
literal|0xFFFFFFFF
expr_stmt|;
name|bg
operator|.
name|pixel
operator|=
literal|0x00000000
expr_stmt|;
name|gdk_gc_set_function
argument_list|(
name|gc
argument_list|,
name|GDK_INVERT
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|gc
argument_list|,
operator|&
name|fg
argument_list|)
expr_stmt|;
name|gdk_gc_set_background
argument_list|(
name|gc
argument_list|,
operator|&
name|bg
argument_list|)
expr_stmt|;
name|gdk_gc_set_line_attributes
argument_list|(
name|gc
argument_list|,
literal|5
argument_list|,
name|GDK_LINE_SOLID
argument_list|,
name|GDK_CAP_BUTT
argument_list|,
name|GDK_JOIN_MITER
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|drop_type
operator|!=
name|GIMP_DROP_NONE
condition|)
block|{
name|y
operator|=
operator|(
operator|(
name|drop_type
operator|==
name|GIMP_DROP_ABOVE
operator|)
condition|?
literal|3
else|:
name|channel_widget
operator|->
name|list_item
operator|->
name|allocation
operator|.
name|height
operator|-
literal|4
operator|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|channel_widget
operator|->
name|list_item
operator|->
name|window
argument_list|,
name|gc
argument_list|,
literal|2
argument_list|,
name|y
argument_list|,
name|channel_widget
operator|->
name|list_item
operator|->
name|allocation
operator|.
name|width
operator|-
literal|3
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_delete (ChannelWidget * channel_widget)
name|channel_widget_delete
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
if|if
condition|(
name|channel_widget
operator|->
name|channel_pixmap
condition|)
name|gdk_pixmap_unref
argument_list|(
name|channel_widget
operator|->
name|channel_pixmap
argument_list|)
expr_stmt|;
comment|/*  Remove the channel widget from the list  */
name|channelsD
operator|->
name|channel_widgets
operator|=
name|g_slist_remove
argument_list|(
name|channelsD
operator|->
name|channel_widgets
argument_list|,
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  Release the widget  */
name|gtk_widget_unref
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_select_update (GtkWidget * widget,gpointer data)
name|channel_widget_select_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
if|if
condition|(
operator|(
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|data
operator|)
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|suspend_gimage_notify
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
block|{
if|if
condition|(
name|widget
operator|->
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
comment|/*  set the gimage's active channel to be this channel  */
name|gimp_image_set_active_channel
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|channel
argument_list|)
expr_stmt|;
else|else
comment|/*  unset the gimage's active channel  */
name|gimp_image_unset_active_channel
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|!=
name|AUXILLARY_CHANNEL
condition|)
block|{
if|if
condition|(
name|widget
operator|->
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|gimp_image_set_component_active
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
else|else
name|gimp_image_set_component_active
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|channel_widget_button_events (GtkWidget * widget,GdkEvent * event,gpointer data)
name|channel_widget_button_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GtkWidget
modifier|*
name|event_widget
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|gint
name|return_val
decl_stmt|;
name|gint
name|visible
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
specifier|static
name|gboolean
name|button_down
init|=
name|FALSE
decl_stmt|;
specifier|static
name|GtkWidget
modifier|*
name|click_widget
init|=
name|NULL
decl_stmt|;
specifier|static
name|gint
name|old_state
decl_stmt|;
specifier|static
name|gint
name|exclusive
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|return_val
operator|=
name|FALSE
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|visible
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
expr_stmt|;
name|width
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|height
expr_stmt|;
break|break;
default|default:
name|visible
operator|=
name|gimp_image_get_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
expr_stmt|;
name|width
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|height
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
name|channel_widget_eye_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
name|return_val
operator|=
name|TRUE
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|channelsD
operator|->
name|ops_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
name|button_down
operator|=
name|TRUE
expr_stmt|;
name|click_widget
operator|=
name|widget
expr_stmt|;
name|gtk_grab_add
argument_list|(
name|click_widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
block|{
name|old_state
operator|=
name|visible
expr_stmt|;
comment|/*  If this was a shift-click, make all/none visible  */
if|if
condition|(
name|event
operator|->
name|button
operator|.
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
name|exclusive
operator|=
name|TRUE
expr_stmt|;
name|channel_widget_exclusive_visible
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|exclusive
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
operator|!
name|visible
expr_stmt|;
else|else
name|gimp_image_set_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
operator|!
name|visible
argument_list|)
expr_stmt|;
name|channel_widget_eye_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
name|return_val
operator|=
name|TRUE
expr_stmt|;
name|button_down
operator|=
name|FALSE
expr_stmt|;
name|gtk_grab_remove
argument_list|(
name|click_widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
block|{
if|if
condition|(
name|exclusive
condition|)
block|{
name|gdisplays_update_area
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|old_state
operator|!=
name|visible
condition|)
block|{
name|gdisplays_update_area
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GDK_LEAVE_NOTIFY
case|:
name|event_widget
operator|=
name|gtk_get_event_widget
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|button_down
operator|&&
operator|(
name|event_widget
operator|==
name|click_widget
operator|)
condition|)
block|{
comment|/* the user moved the cursor out of the widget before              releasing the button -> cancel the button_press */
name|button_down
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|channel_widget
operator|->
name|eye_widget
condition|)
block|{
if|if
condition|(
name|exclusive
condition|)
block|{
name|channel_widget_exclusive_visible
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
operator|!
name|visible
expr_stmt|;
else|else
name|gimp_image_set_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|,
operator|!
name|visible
argument_list|)
expr_stmt|;
name|channel_widget_eye_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
block|}
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|return_val
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|channel_widget_preview_events (GtkWidget * widget,GdkEvent * event,gpointer data)
name|channel_widget_preview_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|GdkEventExpose
modifier|*
name|eevent
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|gboolean
name|valid
decl_stmt|;
name|valid
operator|=
name|FALSE
expr_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_BUTTON_PRESS
case|:
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|3
condition|)
block|{
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|channelsD
operator|->
name|ops_menu
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
name|bevent
operator|->
name|time
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
break|break;
case|case
name|GDK_EXPOSE
case|:
if|if
condition|(
operator|!
name|preview_size
condition|)
name|channel_widget_no_preview_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
else|else
block|{
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|valid
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|preview_valid
expr_stmt|;
break|break;
default|default:
name|valid
operator|=
name|gimp_image_preview_valid
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|valid
operator|||
operator|!
name|channel_widget
operator|->
name|channel_pixmap
condition|)
block|{
name|channel_widget_preview_redraw
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|channel_widget
operator|->
name|channel_pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|eevent
operator|=
operator|(
name|GdkEventExpose
operator|*
operator|)
name|event
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|channel_widget
operator|->
name|channel_pixmap
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|x
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|y
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|x
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|y
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|width
argument_list|,
name|eevent
operator|->
name|area
operator|.
name|height
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
default|default:
break|break;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_preview_redraw (ChannelWidget * channel_widget)
name|channel_widget_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|TempBuf
modifier|*
name|preview_buf
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
name|gint
name|channel
decl_stmt|;
comment|/*  allocate the channel widget pixmap  */
if|if
condition|(
operator|!
name|channel_widget
operator|->
name|channel_pixmap
condition|)
name|channel_widget
operator|->
name|channel_pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|channel_widget
operator|->
name|channel_preview
operator|->
name|window
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|/*  determine width and height  */
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|width
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|height
expr_stmt|;
name|channel_widget
operator|->
name|width
operator|=
name|RINT
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|width
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|height
operator|=
name|RINT
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|ratio
operator|>
literal|1.0
condition|)
comment|/*  Preview is scaling up!  */
block|{
name|preview_buf
operator|=
name|gimp_viewable_get_preview
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
argument_list|,
name|channelsD
operator|->
name|gimage_width
argument_list|,
name|channelsD
operator|->
name|gimage_height
argument_list|)
expr_stmt|;
name|preview_buf
operator|=
name|temp_buf_scale
argument_list|(
name|preview_buf
argument_list|,
name|channel_widget
operator|->
name|width
argument_list|,
name|channel_widget
operator|->
name|height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|preview_buf
operator|=
name|gimp_viewable_get_preview
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|width
argument_list|,
name|channel_widget
operator|->
name|height
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|width
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|width
expr_stmt|;
name|height
operator|=
name|channel_widget
operator|->
name|gimage
operator|->
name|height
expr_stmt|;
name|channel_widget
operator|->
name|width
operator|=
name|RINT
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|width
argument_list|)
expr_stmt|;
name|channel_widget
operator|->
name|height
operator|=
name|RINT
argument_list|(
name|channelsD
operator|->
name|ratio
operator|*
name|height
argument_list|)
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|ratio
operator|>
literal|1.0
condition|)
comment|/*  Preview is scaling up!  */
block|{
name|preview_buf
operator|=
name|gimp_viewable_get_preview
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|)
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|preview_buf
operator|=
name|temp_buf_scale
argument_list|(
name|preview_buf
argument_list|,
name|channel_widget
operator|->
name|width
argument_list|,
name|channel_widget
operator|->
name|height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|preview_buf
operator|=
name|gimp_viewable_get_preview
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|width
argument_list|,
name|channel_widget
operator|->
name|height
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|RED_CHANNEL
case|:
name|channel
operator|=
name|RED_PIX
expr_stmt|;
break|break;
case|case
name|GREEN_CHANNEL
case|:
name|channel
operator|=
name|GREEN_PIX
expr_stmt|;
break|break;
case|case
name|BLUE_CHANNEL
case|:
name|channel
operator|=
name|BLUE_PIX
expr_stmt|;
break|break;
case|case
name|GRAY_CHANNEL
case|:
name|channel
operator|=
name|GRAY_PIX
expr_stmt|;
break|break;
case|case
name|INDEXED_CHANNEL
case|:
name|channel
operator|=
name|INDEXED_PIX
expr_stmt|;
break|break;
case|case
name|ALPHA_CHANNEL
case|:
name|channel
operator|=
name|ALPHA_PIX
expr_stmt|;
break|break;
case|case
name|AUXILLARY_CHANNEL
case|:
name|channel
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
default|default:
name|channel
operator|=
operator|-
literal|1
expr_stmt|;
break|break;
block|}
name|render_preview
argument_list|(
name|preview_buf
argument_list|,
name|channelsD
operator|->
name|preview
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|,
name|channel
argument_list|)
expr_stmt|;
name|gtk_preview_put
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|channelsD
operator|->
name|preview
argument_list|)
argument_list|,
name|channel_widget
operator|->
name|channel_pixmap
argument_list|,
name|channel_widget
operator|->
name|channel_preview
operator|->
name|style
operator|->
name|black_gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|channelsD
operator|->
name|image_width
argument_list|,
name|channelsD
operator|->
name|image_height
argument_list|)
expr_stmt|;
comment|/*  make sure the image has been transfered completely to the pixmap before    *  we use it again...    */
name|gdk_flush
argument_list|()
expr_stmt|;
if|if
condition|(
name|channelsD
operator|->
name|ratio
operator|>
literal|1.0
condition|)
name|temp_buf_free
argument_list|(
name|preview_buf
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_no_preview_redraw (ChannelWidget * channel_widget)
name|channel_widget_no_preview_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
name|GdkPixmap
modifier|*
modifier|*
name|pixmap_normal
decl_stmt|;
name|GdkPixmap
modifier|*
modifier|*
name|pixmap_selected
decl_stmt|;
name|GdkPixmap
modifier|*
modifier|*
name|pixmap_insensitive
decl_stmt|;
name|GdkColor
modifier|*
name|color
decl_stmt|;
name|GtkWidget
modifier|*
name|widget
decl_stmt|;
name|GtkStateType
name|state
decl_stmt|;
name|gchar
modifier|*
name|bits
decl_stmt|;
name|gint
name|width
decl_stmt|,
name|height
decl_stmt|;
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
name|pixmap_normal
operator|=
operator|&
name|channel_pixmap
index|[
name|NORMAL
index|]
expr_stmt|;
name|pixmap_selected
operator|=
operator|&
name|channel_pixmap
index|[
name|SELECTED
index|]
expr_stmt|;
name|pixmap_insensitive
operator|=
operator|&
name|channel_pixmap
index|[
name|INSENSITIVE
index|]
expr_stmt|;
name|widget
operator|=
name|channel_widget
operator|->
name|channel_preview
expr_stmt|;
name|bits
operator|=
operator|(
name|gchar
operator|*
operator|)
name|channel_bits
expr_stmt|;
name|width
operator|=
name|channel_width
expr_stmt|;
name|height
operator|=
name|channel_height
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|color
operator|=
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
expr_stmt|;
else|else
name|color
operator|=
operator|&
name|widget
operator|->
name|style
operator|->
name|white
expr_stmt|;
block|}
else|else
name|color
operator|=
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
expr_stmt|;
name|gdk_window_set_background
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|pixmap_normal
condition|)
block|{
operator|*
name|pixmap_normal
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|bits
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|)
expr_stmt|;
operator|*
name|pixmap_selected
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|bits
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|white
argument_list|)
expr_stmt|;
operator|*
name|pixmap_insensitive
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|bits
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|,
operator|&
name|widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|pixmap
operator|=
operator|*
name|pixmap_selected
expr_stmt|;
else|else
name|pixmap
operator|=
operator|*
name|pixmap_normal
expr_stmt|;
block|}
else|else
name|pixmap
operator|=
operator|*
name|pixmap_insensitive
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_eye_redraw (ChannelWidget * channel_widget)
name|channel_widget_eye_redraw
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GdkPixmap
modifier|*
name|pixmap
decl_stmt|;
name|GdkColor
modifier|*
name|color
decl_stmt|;
name|GtkStateType
name|state
decl_stmt|;
name|gboolean
name|visible
decl_stmt|;
name|state
operator|=
name|channel_widget
operator|->
name|list_item
operator|->
name|state
expr_stmt|;
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|color
operator|=
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
expr_stmt|;
else|else
name|color
operator|=
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|white
expr_stmt|;
block|}
else|else
name|color
operator|=
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
expr_stmt|;
name|gdk_window_set_background
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
name|color
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|visible
operator|=
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|visible
expr_stmt|;
break|break;
default|default:
name|visible
operator|=
name|gimp_image_get_component_visible
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|visible
condition|)
block|{
if|if
condition|(
operator|!
name|eye_pixmap
index|[
name|NORMAL
index|]
condition|)
block|{
name|eye_pixmap
index|[
name|NORMAL
index|]
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|eye_bits
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|white
argument_list|)
expr_stmt|;
name|eye_pixmap
index|[
name|SELECTED
index|]
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|eye_bits
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_SELECTED
index|]
argument_list|)
expr_stmt|;
name|eye_pixmap
index|[
name|INSENSITIVE
index|]
operator|=
name|gdk_pixmap_create_from_data
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|eye_bits
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|,
operator|-
literal|1
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|fg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|,
operator|&
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|bg
index|[
name|GTK_STATE_INSENSITIVE
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
block|{
if|if
condition|(
name|state
operator|==
name|GTK_STATE_SELECTED
condition|)
name|pixmap
operator|=
name|eye_pixmap
index|[
name|SELECTED
index|]
expr_stmt|;
else|else
name|pixmap
operator|=
name|eye_pixmap
index|[
name|NORMAL
index|]
expr_stmt|;
block|}
else|else
name|pixmap
operator|=
name|eye_pixmap
index|[
name|INSENSITIVE
index|]
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|,
name|channel_widget
operator|->
name|eye_widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|eye_width
argument_list|,
name|eye_height
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gdk_window_clear
argument_list|(
name|channel_widget
operator|->
name|eye_widget
operator|->
name|window
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_exclusive_visible (ChannelWidget * channel_widget)
name|channel_widget_exclusive_visible
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|ChannelWidget
modifier|*
name|cw
decl_stmt|;
name|gboolean
name|visible
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
operator|!
name|channelsD
condition|)
return|return;
comment|/*  First determine if _any_ other channel widgets are set to visible  */
for|for
control|(
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
init|;
name|list
condition|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|cw
operator|!=
name|channel_widget
condition|)
block|{
switch|switch
condition|(
name|cw
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|visible
operator||=
name|GIMP_DRAWABLE
argument_list|(
name|cw
operator|->
name|channel
argument_list|)
operator|->
name|visible
expr_stmt|;
break|break;
default|default:
name|visible
operator||=
name|gimp_image_get_component_visible
argument_list|(
name|cw
operator|->
name|gimage
argument_list|,
name|cw
operator|->
name|type
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/*  Now, toggle the visibility for all channels except the specified one  */
for|for
control|(
name|list
operator|=
name|channelsD
operator|->
name|channel_widgets
init|;
name|list
condition|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|cw
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|cw
operator|!=
name|channel_widget
condition|)
switch|switch
condition|(
name|cw
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|GIMP_DRAWABLE
argument_list|(
name|cw
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
operator|!
name|visible
expr_stmt|;
break|break;
default|default:
name|gimp_image_set_component_visible
argument_list|(
name|cw
operator|->
name|gimage
argument_list|,
name|cw
operator|->
name|type
argument_list|,
operator|!
name|visible
argument_list|)
expr_stmt|;
break|break;
block|}
else|else
switch|switch
condition|(
name|cw
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|GIMP_DRAWABLE
argument_list|(
name|cw
operator|->
name|channel
argument_list|)
operator|->
name|visible
operator|=
name|TRUE
expr_stmt|;
break|break;
default|default:
name|gimp_image_set_component_visible
argument_list|(
name|cw
operator|->
name|gimage
argument_list|,
name|cw
operator|->
name|type
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
name|channel_widget_eye_redraw
argument_list|(
name|cw
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channel_widget_channel_flush (GtkWidget * widget,gpointer data)
name|channel_widget_channel_flush
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
name|gboolean
name|update_preview
init|=
name|FALSE
decl_stmt|;
name|channel_widget
operator|=
operator|(
name|ChannelWidget
operator|*
operator|)
name|gtk_object_get_user_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  Set sensitivity  */
comment|/*  If there is a floating selection...  */
if|if
condition|(
name|channelsD
operator|->
name|floating_sel
operator|!=
name|NULL
condition|)
block|{
comment|/*  to insensitive if this is an auxillary channel  */
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
block|{
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
comment|/*  to sensitive otherwise  */
else|else
block|{
if|if
condition|(
operator|!
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/*  to insensitive if there is an active channel,        *  and this is a component channel        */
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|!=
name|AUXILLARY_CHANNEL
operator|&&
name|channelsD
operator|->
name|active_channel
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
comment|/*  to sensitive otherwise  */
else|else
block|{
if|if
condition|(
operator|!
name|GTK_WIDGET_IS_SENSITIVE
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|channel_widget
operator|->
name|list_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*  Set selection  */
comment|/*  If this is an auxillary channel  */
if|if
condition|(
name|channel_widget
operator|->
name|type
operator|==
name|AUXILLARY_CHANNEL
condition|)
block|{
comment|/*  select if this is the active channel  */
if|if
condition|(
name|channelsD
operator|->
name|active_channel
operator|==
operator|(
name|channel_widget
operator|->
name|channel
operator|)
condition|)
name|channels_dialog_set_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
comment|/*  unselect if this is not the active channel  */
else|else
name|channels_dialog_unset_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/*  If the component is active, select. otherwise, deselect  */
if|if
condition|(
name|gimp_image_get_component_active
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|,
name|channel_widget
operator|->
name|type
argument_list|)
condition|)
name|channels_dialog_set_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
else|else
name|channels_dialog_unset_channel
argument_list|(
name|channel_widget
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|channel_widget
operator|->
name|type
condition|)
block|{
case|case
name|AUXILLARY_CHANNEL
case|:
name|update_preview
operator|=
operator|!
name|GIMP_DRAWABLE
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
operator|->
name|preview_valid
expr_stmt|;
break|break;
default|default:
name|update_preview
operator|=
operator|!
name|gimp_image_preview_valid
argument_list|(
name|channel_widget
operator|->
name|gimage
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|update_preview
condition|)
name|gtk_widget_queue_draw
argument_list|(
name|channel_widget
operator|->
name|channel_preview
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_opacity_update (GtkAdjustment * adjustment,gpointer data)
name|channels_dialog_opacity_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GimpRGB
name|color
decl_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|data
argument_list|)
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_rgb_set_alpha
argument_list|(
operator|&
name|color
argument_list|,
name|adjustment
operator|->
name|value
operator|/
literal|100.0
argument_list|)
expr_stmt|;
name|gimp_color_button_set_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|data
argument_list|)
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_color_changed (GimpColorButton * button,gpointer data)
name|channels_dialog_color_changed
parameter_list|(
name|GimpColorButton
modifier|*
name|button
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adj
init|=
name|GTK_ADJUSTMENT
argument_list|(
name|data
argument_list|)
decl_stmt|;
name|GimpRGB
name|color
decl_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|button
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gtk_adjustment_set_value
argument_list|(
name|adj
argument_list|,
name|color
operator|.
name|a
operator|*
literal|100.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**********************************/
end_comment

begin_comment
comment|/*  The new channel query dialog  */
end_comment

begin_comment
comment|/**********************************/
end_comment

begin_typedef
DECL|typedef|NewChannelOptions
typedef|typedef
name|struct
name|_NewChannelOptions
name|NewChannelOptions
typedef|;
end_typedef

begin_struct
DECL|struct|_NewChannelOptions
struct|struct
name|_NewChannelOptions
block|{
DECL|member|query_box
name|GtkWidget
modifier|*
name|query_box
decl_stmt|;
DECL|member|name_entry
name|GtkWidget
modifier|*
name|name_entry
decl_stmt|;
DECL|member|color_panel
name|GtkWidget
modifier|*
name|color_panel
decl_stmt|;
DECL|member|gimage
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
DECL|variable|channel_name
specifier|static
name|gchar
modifier|*
name|channel_name
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|channel_color
specifier|static
name|GimpRGB
name|channel_color
init|=
block|{
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|0.5
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|new_channel_query_ok_callback (GtkWidget * widget,gpointer data)
name|new_channel_query_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|NewChannelOptions
modifier|*
name|options
decl_stmt|;
name|GimpChannel
modifier|*
name|new_channel
decl_stmt|;
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|options
operator|=
operator|(
name|NewChannelOptions
operator|*
operator|)
name|data
expr_stmt|;
if|if
condition|(
name|channel_name
condition|)
name|g_free
argument_list|(
name|channel_name
argument_list|)
expr_stmt|;
name|channel_name
operator|=
name|g_strdup
argument_list|(
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|gimage
operator|=
name|options
operator|->
name|gimage
operator|)
condition|)
block|{
name|gimp_color_button_get_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
argument_list|,
operator|&
name|channel_color
argument_list|)
expr_stmt|;
name|new_channel
operator|=
name|gimp_channel_new
argument_list|(
name|gimage
argument_list|,
name|gimage
operator|->
name|width
argument_list|,
name|gimage
operator|->
name|height
argument_list|,
name|channel_name
argument_list|,
operator|&
name|channel_color
argument_list|)
expr_stmt|;
name|drawable_fill
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|new_channel
argument_list|)
argument_list|,
name|TRANSPARENT_FILL
argument_list|)
expr_stmt|;
name|gimp_image_add_channel
argument_list|(
name|gimage
argument_list|,
name|new_channel
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_new_channel_query (GimpImage * gimage)
name|channels_dialog_new_channel_query
parameter_list|(
name|GimpImage
modifier|*
name|gimage
parameter_list|)
block|{
name|NewChannelOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|opacity_scale
decl_stmt|;
name|GtkObject
modifier|*
name|opacity_scale_data
decl_stmt|;
comment|/*  the new options structure  */
name|options
operator|=
name|g_new
argument_list|(
name|NewChannelOptions
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|options
operator|->
name|gimage
operator|=
name|gimage
expr_stmt|;
name|options
operator|->
name|color_panel
operator|=
name|gimp_color_panel_new
argument_list|(
name|_
argument_list|(
literal|"New Channel Color"
argument_list|)
argument_list|,
operator|&
name|channel_color
argument_list|,
name|GIMP_COLOR_AREA_LARGE_CHECKS
argument_list|,
literal|48
argument_list|,
literal|64
argument_list|)
expr_stmt|;
comment|/*  The dialog  */
name|options
operator|->
name|query_box
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"New Channel Options"
argument_list|)
argument_list|,
literal|"new_channel_options"
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"dialogs/channels/new_channel.html"
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"OK"
argument_list|)
argument_list|,
name|new_channel_query_ok_callback
argument_list|,
name|options
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
name|gtk_widget_destroy
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|g_free
argument_list|)
argument_list|,
operator|(
name|GtkObject
operator|*
operator|)
name|options
argument_list|)
expr_stmt|;
comment|/*  The main hbox  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
comment|/*  The vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The table  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The name entry hbox, label and entry  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Channel name:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|name_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|options
operator|->
name|name_entry
argument_list|,
literal|150
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|options
operator|->
name|name_entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|,
operator|(
name|channel_name
condition|?
name|channel_name
else|:
name|_
argument_list|(
literal|"New Channel"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
expr_stmt|;
comment|/*  The opacity scale  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Fill Opacity:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
name|GTK_SHRINK
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|opacity_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|channel_color
operator|.
name|a
operator|*
literal|100.0
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|opacity_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|opacity_scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|opacity_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channels_dialog_opacity_update
argument_list|)
argument_list|,
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|opacity_scale
argument_list|)
expr_stmt|;
comment|/*  The color panel  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
argument_list|,
literal|"color_changed"
argument_list|,
name|channels_dialog_color_changed
argument_list|,
name|opacity_scale_data
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|options
operator|->
name|color_panel
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/****************************************/
end_comment

begin_comment
comment|/*  The edit channel attributes dialog  */
end_comment

begin_comment
comment|/****************************************/
end_comment

begin_typedef
DECL|typedef|EditChannelOptions
typedef|typedef
name|struct
name|_EditChannelOptions
name|EditChannelOptions
typedef|;
end_typedef

begin_struct
DECL|struct|_EditChannelOptions
struct|struct
name|_EditChannelOptions
block|{
DECL|member|query_box
name|GtkWidget
modifier|*
name|query_box
decl_stmt|;
DECL|member|name_entry
name|GtkWidget
modifier|*
name|name_entry
decl_stmt|;
DECL|member|color_panel
name|GtkWidget
modifier|*
name|color_panel
decl_stmt|;
DECL|member|channel_widget
name|ChannelWidget
modifier|*
name|channel_widget
decl_stmt|;
DECL|member|gimage
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
block|}
struct|;
end_struct

begin_function
specifier|static
name|void
DECL|function|edit_channel_query_ok_callback (GtkWidget * widget,gpointer data)
name|edit_channel_query_ok_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|EditChannelOptions
modifier|*
name|options
decl_stmt|;
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
name|GimpRGB
name|color
decl_stmt|;
name|options
operator|=
operator|(
name|EditChannelOptions
operator|*
operator|)
name|data
expr_stmt|;
name|channel
operator|=
name|options
operator|->
name|channel_widget
operator|->
name|channel
expr_stmt|;
if|if
condition|(
name|options
operator|->
name|gimage
condition|)
block|{
comment|/*  Set the new channel name  */
name|gimp_object_set_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|channel
argument_list|)
argument_list|,
name|gtk_entry_get_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|GTK_LABEL
argument_list|(
name|options
operator|->
name|channel_widget
operator|->
name|label
argument_list|)
argument_list|,
name|gimp_object_get_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|channel
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_color_button_get_color
argument_list|(
name|GIMP_COLOR_BUTTON
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_rgba_distance
argument_list|(
operator|&
name|color
argument_list|,
operator|&
name|channel
operator|->
name|color
argument_list|)
operator|>
literal|0.0001
condition|)
block|{
name|channel
operator|->
name|color
operator|=
name|color
expr_stmt|;
name|drawable_update
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|width
argument_list|,
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
operator|->
name|height
argument_list|)
expr_stmt|;
name|gdisplays_flush
argument_list|()
expr_stmt|;
block|}
block|}
name|gtk_widget_destroy
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|channels_dialog_edit_channel_query (ChannelWidget * channel_widget)
name|channels_dialog_edit_channel_query
parameter_list|(
name|ChannelWidget
modifier|*
name|channel_widget
parameter_list|)
block|{
name|EditChannelOptions
modifier|*
name|options
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|opacity_scale
decl_stmt|;
name|GtkObject
modifier|*
name|opacity_scale_data
decl_stmt|;
comment|/*  the new options structure  */
name|options
operator|=
name|g_new
argument_list|(
name|EditChannelOptions
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|options
operator|->
name|channel_widget
operator|=
name|channel_widget
expr_stmt|;
name|options
operator|->
name|gimage
operator|=
name|channel_widget
operator|->
name|gimage
expr_stmt|;
name|channel_color
operator|=
name|channel_widget
operator|->
name|channel
operator|->
name|color
expr_stmt|;
name|options
operator|->
name|color_panel
operator|=
name|gimp_color_panel_new
argument_list|(
name|_
argument_list|(
literal|"Edit Channel Color"
argument_list|)
argument_list|,
operator|&
name|channel_color
argument_list|,
name|GIMP_COLOR_AREA_LARGE_CHECKS
argument_list|,
literal|48
argument_list|,
literal|64
argument_list|)
expr_stmt|;
comment|/*  The dialog  */
name|options
operator|->
name|query_box
operator|=
name|gimp_dialog_new
argument_list|(
name|_
argument_list|(
literal|"Edit Channel Attributes"
argument_list|)
argument_list|,
literal|"edit_channel_attributes"
argument_list|,
name|gimp_standard_help_func
argument_list|,
literal|"dialogs/channels/edit_channel_attributes.html"
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"OK"
argument_list|)
argument_list|,
name|edit_channel_query_ok_callback
argument_list|,
name|options
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
name|gtk_widget_destroy
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect_object
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
argument_list|,
literal|"destroy"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|g_free
argument_list|)
argument_list|,
operator|(
name|GtkObject
operator|*
operator|)
name|options
argument_list|)
expr_stmt|;
comment|/*  The main hbox  */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_container_set_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
comment|/*  The vbox  */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The table  */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_table_set_col_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_table_set_row_spacings
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/*  The name entry  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Channel name:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|options
operator|->
name|name_entry
operator|=
name|gtk_entry_new
argument_list|()
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|options
operator|->
name|name_entry
argument_list|,
literal|150
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|options
operator|->
name|name_entry
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_entry_set_text
argument_list|(
name|GTK_ENTRY
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
argument_list|,
name|gimp_object_get_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|channel_widget
operator|->
name|channel
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|name_entry
argument_list|)
expr_stmt|;
comment|/*  The opacity scale  */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Fill Opacity:"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|opacity_scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
name|channel_color
operator|.
name|a
operator|*
literal|100.0
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|opacity_scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_table_attach_defaults
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|opacity_scale
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|opacity_scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|opacity_scale_data
argument_list|)
argument_list|,
literal|"value_changed"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|channels_dialog_opacity_update
argument_list|)
argument_list|,
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|opacity_scale
argument_list|)
expr_stmt|;
comment|/*  The color panel  */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
argument_list|,
literal|"color_changed"
argument_list|,
name|channels_dialog_color_changed
argument_list|,
name|opacity_scale_data
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|options
operator|->
name|color_panel
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|color_panel
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|options
operator|->
name|query_box
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

