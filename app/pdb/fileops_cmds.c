begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995-2003 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* NOTE: This file is autogenerated by pdbgen.pl. */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gdk-pixbuf/gdk-pixbuf.h>
end_include

begin_include
include|#
directive|include
file|<glib.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_include
include|#
directive|include
file|<process.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<glib-object.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpconfig/gimpconfig.h"
end_include

begin_include
include|#
directive|include
file|"libgimpthumb/gimpthumb.h"
end_include

begin_include
include|#
directive|include
file|"pdb-types.h"
end_include

begin_include
include|#
directive|include
file|"procedural_db.h"
end_include

begin_include
include|#
directive|include
file|"config/gimpbaseconfig.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimagefile.h"
end_include

begin_include
include|#
directive|include
file|"core/gimplayer.h"
end_include

begin_include
include|#
directive|include
file|"file/file-open.h"
end_include

begin_include
include|#
directive|include
file|"file/file-utils.h"
end_include

begin_include
include|#
directive|include
file|"plug-in/plug-in-proc-def.h"
end_include

begin_include
include|#
directive|include
file|"plug-in/plug-in.h"
end_include

begin_include
include|#
directive|include
file|"plug-in/plug-ins.h"
end_include

begin_decl_stmt
DECL|variable|file_load_proc
specifier|static
name|ProcRecord
name|file_load_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_layer_proc
specifier|static
name|ProcRecord
name|file_load_layer_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_thumbnail_proc
specifier|static
name|ProcRecord
name|file_load_thumbnail_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_save_proc
specifier|static
name|ProcRecord
name|file_save_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_save_thumbnail_proc
specifier|static
name|ProcRecord
name|file_save_thumbnail_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|temp_name_proc
specifier|static
name|ProcRecord
name|temp_name_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_magic_load_handler_proc
specifier|static
name|ProcRecord
name|register_magic_load_handler_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_load_handler_proc
specifier|static
name|ProcRecord
name|register_load_handler_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_save_handler_proc
specifier|static
name|ProcRecord
name|register_save_handler_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_file_handler_mime_proc
specifier|static
name|ProcRecord
name|register_file_handler_mime_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_thumbnail_loader_proc
specifier|static
name|ProcRecord
name|register_thumbnail_loader_proc
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|register_fileops_procs (Gimp * gimp)
name|register_fileops_procs
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|)
block|{
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|file_load_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|file_load_layer_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|file_load_thumbnail_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|file_save_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|file_save_thumbnail_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|temp_name_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|register_magic_load_handler_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|register_load_handler_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|register_save_handler_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|register_file_handler_mime_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|register_thumbnail_loader_proc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|fileops_register_magic_load_handler (Gimp * gimp,const gchar * procedure_name,const gchar * extensions,const gchar * prefixes,const gchar * magics)
name|fileops_register_magic_load_handler
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
specifier|const
name|gchar
modifier|*
name|procedure_name
parameter_list|,
specifier|const
name|gchar
modifier|*
name|extensions
parameter_list|,
specifier|const
name|gchar
modifier|*
name|prefixes
parameter_list|,
specifier|const
name|gchar
modifier|*
name|magics
parameter_list|)
block|{
name|ProcRecord
modifier|*
name|proc
decl_stmt|;
name|PlugInProcDef
modifier|*
name|file_proc
decl_stmt|;
name|gchar
modifier|*
name|canonical
decl_stmt|;
name|gboolean
name|success
init|=
name|FALSE
decl_stmt|;
name|canonical
operator|=
name|gimp_canonicalize_identifier
argument_list|(
name|procedure_name
argument_list|)
expr_stmt|;
name|proc
operator|=
name|procedural_db_lookup
argument_list|(
name|gimp
argument_list|,
name|canonical
argument_list|)
expr_stmt|;
if|if
condition|(
name|proc
operator|&&
operator|(
operator|(
name|proc
operator|->
name|num_args
operator|<
literal|3
operator|)
operator|||
operator|(
name|proc
operator|->
name|num_values
operator|<
literal|1
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|0
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_INT32
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|1
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_STRING
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|2
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_STRING
operator|)
operator|||
operator|(
name|proc
operator|->
name|values
index|[
literal|0
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_IMAGE
operator|)
operator|)
condition|)
block|{
name|g_message
argument_list|(
literal|"load handler \"%s\" does not take the standard load handler args"
argument_list|,
name|canonical
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
name|file_proc
operator|=
name|plug_ins_file_register_magic
argument_list|(
name|gimp
argument_list|,
name|canonical
argument_list|,
name|extensions
argument_list|,
name|prefixes
argument_list|,
name|magics
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file_proc
condition|)
block|{
name|g_message
argument_list|(
literal|"attempt to register nonexistent load handler \"%s\""
argument_list|,
name|canonical
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
operator|!
name|g_slist_find
argument_list|(
name|gimp
operator|->
name|load_procs
argument_list|,
name|file_proc
argument_list|)
condition|)
name|gimp
operator|->
name|load_procs
operator|=
name|g_slist_prepend
argument_list|(
name|gimp
operator|->
name|load_procs
argument_list|,
name|file_proc
argument_list|)
expr_stmt|;
name|success
operator|=
name|TRUE
expr_stmt|;
name|done
label|:
name|g_free
argument_list|(
name|canonical
argument_list|)
expr_stmt|;
return|return
name|success
return|;
block|}
end_function

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|file_load_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|file_load_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|new_args
decl_stmt|;
name|Argument
modifier|*
name|return_vals
decl_stmt|;
name|PlugInProcDef
modifier|*
name|file_proc
decl_stmt|;
specifier|const
name|ProcRecord
modifier|*
name|proc
decl_stmt|;
name|gchar
modifier|*
name|uri
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|uri
operator|=
name|file_utils_filename_to_uri
argument_list|(
name|gimp
operator|->
name|load_procs
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|uri
condition|)
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|file_load_proc
argument_list|,
name|FALSE
argument_list|)
return|;
name|file_proc
operator|=
name|file_utils_find_proc
argument_list|(
name|gimp
operator|->
name|load_procs
argument_list|,
name|uri
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file_proc
condition|)
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|file_load_proc
argument_list|,
name|FALSE
argument_list|)
return|;
name|proc
operator|=
name|plug_in_proc_def_get_proc
argument_list|(
name|file_proc
argument_list|)
expr_stmt|;
name|new_args
operator|=
name|g_new0
argument_list|(
name|Argument
argument_list|,
name|proc
operator|->
name|num_args
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|new_args
argument_list|,
name|args
argument_list|,
sizeof|sizeof
argument_list|(
name|Argument
argument_list|)
operator|*
literal|3
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|3
init|;
name|i
operator|<
name|proc
operator|->
name|num_args
condition|;
name|i
operator|++
control|)
block|{
name|new_args
index|[
name|i
index|]
operator|.
name|arg_type
operator|=
name|proc
operator|->
name|args
index|[
name|i
index|]
operator|.
name|arg_type
expr_stmt|;
if|if
condition|(
name|proc
operator|->
name|args
index|[
name|i
index|]
operator|.
name|arg_type
operator|==
name|GIMP_PDB_STRING
condition|)
name|new_args
index|[
name|i
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
name|return_vals
operator|=
name|procedural_db_execute
argument_list|(
name|gimp
argument_list|,
name|context
argument_list|,
name|progress
argument_list|,
name|proc
operator|->
name|name
argument_list|,
name|new_args
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|new_args
argument_list|)
expr_stmt|;
return|return
name|return_vals
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|file_load_inargs
specifier|static
name|ProcArg
name|file_load_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode: GIMP_RUN_INTERACTIVE (0) or GIMP_RUN_NONINTERACTIVE (1)"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to load"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"raw-filename"
block|,
literal|"The name as entered by the user"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_outargs
specifier|static
name|ProcArg
name|file_load_outargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"The output image"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_proc
specifier|static
name|ProcRecord
name|file_load_proc
init|=
block|{
literal|"gimp-file-load"
block|,
literal|"gimp-file-load"
block|,
literal|"Loads an image file by invoking the right load handler."
block|,
literal|"This procedure invokes the correct file load handler using magic if possible, and falling back on the file's extension and/or prefix if not. The name of the file to load is typically a full pathname, and the name entered is what the user actually typed before prepending a directory path. The reason for this is that if the user types http://www.xcf/~gimp/ he wants to fetch a URL, and the full pathname will not look like a URL.\""
block|,
literal|"Josh MacDonald"
block|,
literal|"Josh MacDonald"
block|,
literal|"1997"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|3
block|,
name|file_load_inargs
block|,
literal|1
block|,
name|file_load_outargs
block|,
block|{
block|{
name|file_load_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|file_load_layer_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|file_load_layer_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gint32
name|run_mode
decl_stmt|;
name|GimpImage
modifier|*
name|image
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|GimpLayer
modifier|*
name|layer
init|=
name|NULL
decl_stmt|;
name|run_mode
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|run_mode
operator|<
name|GIMP_RUN_INTERACTIVE
operator|||
name|run_mode
operator|>
name|GIMP_RUN_NONINTERACTIVE
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|image
operator|=
name|gimp_image_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|filename
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|filename
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|GimpPDBStatusType
name|status
decl_stmt|;
name|gchar
modifier|*
name|uri
decl_stmt|;
name|uri
operator|=
name|file_utils_filename_to_uri
argument_list|(
name|gimp
operator|->
name|load_procs
argument_list|,
name|filename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|uri
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
name|layer
operator|=
name|file_open_layer
argument_list|(
name|gimp
argument_list|,
name|context
argument_list|,
name|progress
argument_list|,
name|image
argument_list|,
name|uri
argument_list|,
name|run_mode
argument_list|,
name|NULL
argument_list|,
operator|&
name|status
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|success
operator|=
name|layer
operator|!=
name|NULL
expr_stmt|;
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|file_load_layer_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|layer
condition|?
name|gimp_item_get_ID
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
else|:
operator|-
literal|1
expr_stmt|;
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|file_load_layer_inargs
specifier|static
name|ProcArg
name|file_load_layer_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode: GIMP_RUN_INTERACTIVE (0) or GIMP_RUN_NONINTERACTIVE (1)"
block|}
block|,
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Destination image"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to load"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_layer_outargs
specifier|static
name|ProcArg
name|file_load_layer_outargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_LAYER
block|,
literal|"layer"
block|,
literal|"The layer created when loading the image file"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_layer_proc
specifier|static
name|ProcRecord
name|file_load_layer_proc
init|=
block|{
literal|"gimp-file-load-layer"
block|,
literal|"gimp-file-load-layer"
block|,
literal|"Loads an image file as a layer into an already opened image."
block|,
literal|"This procedure behaves like the file-load procedure but opens the specified image as a layer into an already opened image."
block|,
literal|"Sven Neumann<sven@gimp.org>"
block|,
literal|"Sven Neumann"
block|,
literal|"2005"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|3
block|,
name|file_load_layer_inargs
block|,
literal|1
block|,
name|file_load_layer_outargs
block|,
block|{
block|{
name|file_load_layer_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|file_load_thumbnail_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|file_load_thumbnail_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|gint32
name|width
init|=
literal|0
decl_stmt|;
name|gint32
name|height
init|=
literal|0
decl_stmt|;
name|gint32
name|thumb_data_count
init|=
literal|0
decl_stmt|;
name|guint8
modifier|*
name|thumb_data
init|=
name|NULL
decl_stmt|;
name|filename
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|filename
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|GimpThumbnail
modifier|*
name|thumbnail
init|=
name|NULL
decl_stmt|;
name|GdkPixbuf
modifier|*
name|pixbuf
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|uri
decl_stmt|;
name|uri
operator|=
name|g_filename_to_uri
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|uri
condition|)
block|{
name|thumbnail
operator|=
name|gimp_thumbnail_new
argument_list|()
expr_stmt|;
name|gimp_thumbnail_set_uri
argument_list|(
name|thumbnail
argument_list|,
name|uri
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|gimp_thumbnail_load_thumb
argument_list|(
name|thumbnail
argument_list|,
name|GIMP_THUMBNAIL_SIZE_NORMAL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pixbuf
condition|)
block|{
name|width
operator|=
name|gdk_pixbuf_get_width
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|height
operator|=
name|gdk_pixbuf_get_height
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|gdk_pixbuf_get_n_channels
argument_list|(
name|pixbuf
argument_list|)
operator|!=
literal|3
condition|)
block|{
name|GdkPixbuf
modifier|*
name|tmp
init|=
name|gdk_pixbuf_new
argument_list|(
name|GDK_COLORSPACE_RGB
argument_list|,
name|FALSE
argument_list|,
literal|8
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
decl_stmt|;
name|gdk_pixbuf_composite_color
argument_list|(
name|pixbuf
argument_list|,
name|tmp
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
name|GDK_INTERP_NEAREST
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GIMP_CHECK_SIZE_SM
argument_list|,
literal|0x66666666
argument_list|,
literal|0x99999999
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|pixbuf
operator|=
name|tmp
expr_stmt|;
block|}
name|thumb_data_count
operator|=
literal|3
operator|*
name|width
operator|*
name|height
expr_stmt|;
name|thumb_data
operator|=
name|g_memdup
argument_list|(
name|gdk_pixbuf_get_pixels
argument_list|(
name|pixbuf
argument_list|)
argument_list|,
name|thumb_data_count
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|pixbuf
argument_list|)
expr_stmt|;
name|success
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|file_load_thumbnail_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|width
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|height
expr_stmt|;
name|return_args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|thumb_data_count
expr_stmt|;
name|return_args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|thumb_data
expr_stmt|;
block|}
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|file_load_thumbnail_inargs
specifier|static
name|ProcArg
name|file_load_thumbnail_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file that owns the thumbnail to load"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_thumbnail_outargs
specifier|static
name|ProcArg
name|file_load_thumbnail_outargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"width"
block|,
literal|"The width of the thumbnail"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"height"
block|,
literal|"The height of the thumbnail"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"thumb-data-count"
block|,
literal|"The number of bytes in thumbnail data"
block|}
block|,
block|{
name|GIMP_PDB_INT8ARRAY
block|,
literal|"thumb-data"
block|,
literal|"The thumbnail data"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_load_thumbnail_proc
specifier|static
name|ProcRecord
name|file_load_thumbnail_proc
init|=
block|{
literal|"gimp-file-load-thumbnail"
block|,
literal|"gimp-file-load-thumbnail"
block|,
literal|"Loads the thumbnail for a file."
block|,
literal|"This procedure tries to load a thumbnail that belongs to the file with the given filename. This name is a full pathname. The returned data is an array of colordepth 3 (RGB), regardless of the image type. Width and height of the thumbnail are also returned. Don't use this function if you need a thumbnail of an already opened image, use gimp_image_thumbnail instead."
block|,
literal|"Adam D. Moss, Sven Neumann"
block|,
literal|"Adam D. Moss, Sven Neumann"
block|,
literal|"1999-2003"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|1
block|,
name|file_load_thumbnail_inargs
block|,
literal|4
block|,
name|file_load_thumbnail_outargs
block|,
block|{
block|{
name|file_load_thumbnail_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|file_save_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|file_save_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|new_args
decl_stmt|;
name|Argument
modifier|*
name|return_vals
decl_stmt|;
name|PlugInProcDef
modifier|*
name|file_proc
decl_stmt|;
specifier|const
name|ProcRecord
modifier|*
name|proc
decl_stmt|;
name|gchar
modifier|*
name|uri
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|uri
operator|=
name|file_utils_filename_to_uri
argument_list|(
name|gimp
operator|->
name|load_procs
argument_list|,
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|uri
condition|)
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|file_save_proc
argument_list|,
name|FALSE
argument_list|)
return|;
name|file_proc
operator|=
name|file_utils_find_proc
argument_list|(
name|gimp
operator|->
name|save_procs
argument_list|,
name|uri
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file_proc
condition|)
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|file_save_proc
argument_list|,
name|FALSE
argument_list|)
return|;
name|proc
operator|=
name|plug_in_proc_def_get_proc
argument_list|(
name|file_proc
argument_list|)
expr_stmt|;
name|new_args
operator|=
name|g_new0
argument_list|(
name|Argument
argument_list|,
name|proc
operator|->
name|num_args
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|new_args
argument_list|,
name|args
argument_list|,
sizeof|sizeof
argument_list|(
name|Argument
argument_list|)
operator|*
literal|5
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|5
init|;
name|i
operator|<
name|proc
operator|->
name|num_args
condition|;
name|i
operator|++
control|)
block|{
name|new_args
index|[
name|i
index|]
operator|.
name|arg_type
operator|=
name|proc
operator|->
name|args
index|[
name|i
index|]
operator|.
name|arg_type
expr_stmt|;
if|if
condition|(
name|proc
operator|->
name|args
index|[
name|i
index|]
operator|.
name|arg_type
operator|==
name|GIMP_PDB_STRING
condition|)
name|new_args
index|[
name|i
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
name|return_vals
operator|=
name|procedural_db_execute
argument_list|(
name|gimp
argument_list|,
name|context
argument_list|,
name|progress
argument_list|,
name|proc
operator|->
name|name
argument_list|,
name|new_args
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|new_args
argument_list|)
expr_stmt|;
return|return
name|return_vals
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|file_save_inargs
specifier|static
name|ProcArg
name|file_save_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_INT32
block|,
literal|"run-mode"
block|,
literal|"The run mode: GIMP_RUN_INTERACTIVE (0) or GIMP_RUN_NONINTERACTIVE (1)"
block|}
block|,
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"Input image"
block|}
block|,
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"Drawable to save"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file to save the image in"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"raw-filename"
block|,
literal|"The name as entered by the user"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_save_proc
specifier|static
name|ProcRecord
name|file_save_proc
init|=
block|{
literal|"gimp-file-save"
block|,
literal|"gimp-file-save"
block|,
literal|"Saves a file by extension."
block|,
literal|"This procedure invokes the correct file save handler according to the file's extension and/or prefix. The name of the file to save is typically a full pathname, and the name entered is what the user actually typed before prepending a directory path. The reason for this is that if the user types http://www.xcf/~gimp/ she wants to fetch a URL, and the full pathname will not look like a URL."
block|,
literal|"Josh MacDonald"
block|,
literal|"Josh MacDonald"
block|,
literal|"1997"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|5
block|,
name|file_save_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|file_save_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|file_save_thumbnail_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|file_save_thumbnail_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpImage
modifier|*
name|image
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|image
operator|=
name|gimp_image_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|filename
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|filename
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
specifier|const
name|gchar
modifier|*
name|image_uri
init|=
name|gimp_object_get_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|image
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|image_uri
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|gchar
modifier|*
name|uri
init|=
name|g_filename_to_uri
argument_list|(
name|filename
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|uri
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|uri
argument_list|,
name|image_uri
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|GimpImagefile
modifier|*
name|imagefile
decl_stmt|;
name|imagefile
operator|=
name|gimp_imagefile_new
argument_list|(
name|gimp
argument_list|,
name|uri
argument_list|)
expr_stmt|;
name|success
operator|=
name|gimp_imagefile_save_thumbnail
argument_list|(
name|imagefile
argument_list|,
name|NULL
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|imagefile
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|uri
argument_list|)
expr_stmt|;
block|}
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|file_save_thumbnail_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|file_save_thumbnail_inargs
specifier|static
name|ProcArg
name|file_save_thumbnail_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_IMAGE
block|,
literal|"image"
block|,
literal|"The image"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"filename"
block|,
literal|"The name of the file the thumbnail belongs to"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|file_save_thumbnail_proc
specifier|static
name|ProcRecord
name|file_save_thumbnail_proc
init|=
block|{
literal|"gimp-file-save-thumbnail"
block|,
literal|"gimp-file-save-thumbnail"
block|,
literal|"Saves a thumbnail for the given image"
block|,
literal|"This procedure saves a thumbnail for the given image according to the Free Desktop Thumbnail Managing Standard. The thumbnail is saved so that it belongs to the file with the given filename. This means you have to save the image under this name first, otherwise this procedure will fail. This procedure may become useful if you want to explicitely save a thumbnail with a file."
block|,
literal|"Josh MacDonald"
block|,
literal|"Josh MacDonald"
block|,
literal|"1997"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|2
block|,
name|file_save_thumbnail_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|file_save_thumbnail_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|temp_name_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|temp_name_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|extension
decl_stmt|;
name|gchar
modifier|*
name|name
init|=
name|NULL
decl_stmt|;
name|extension
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|extension
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
specifier|static
name|gint
name|id
init|=
literal|0
decl_stmt|;
specifier|static
name|gint
name|pid
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|gchar
modifier|*
name|path
decl_stmt|;
if|if
condition|(
name|id
operator|==
literal|0
condition|)
name|pid
operator|=
name|getpid
argument_list|()
expr_stmt|;
name|filename
operator|=
name|g_strdup_printf
argument_list|(
literal|"gimp_temp_%d%d.%s"
argument_list|,
name|pid
argument_list|,
name|id
operator|++
argument_list|,
name|extension
argument_list|)
expr_stmt|;
name|path
operator|=
name|gimp_config_path_expand
argument_list|(
name|GIMP_BASE_CONFIG
argument_list|(
name|gimp
operator|->
name|config
argument_list|)
operator|->
name|temp_path
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|name
operator|=
name|g_build_filename
argument_list|(
name|path
argument_list|,
name|filename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|temp_name_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|name
expr_stmt|;
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|temp_name_inargs
specifier|static
name|ProcArg
name|temp_name_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"extension"
block|,
literal|"The extension the file will have"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|temp_name_outargs
specifier|static
name|ProcArg
name|temp_name_outargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"name"
block|,
literal|"The new temp filename"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|temp_name_proc
specifier|static
name|ProcRecord
name|temp_name_proc
init|=
block|{
literal|"gimp-temp-name"
block|,
literal|"gimp-temp-name"
block|,
literal|"Generates a unique filename."
block|,
literal|"Generates a unique filename using the temp path supplied in the user's gimprc."
block|,
literal|"Josh MacDonald"
block|,
literal|"Josh MacDonald"
block|,
literal|"1997"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|1
block|,
name|temp_name_inargs
block|,
literal|1
block|,
name|temp_name_outargs
block|,
block|{
block|{
name|temp_name_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|register_magic_load_handler_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|register_magic_load_handler_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|procedure_name
decl_stmt|;
name|gchar
modifier|*
name|extensions
decl_stmt|;
name|gchar
modifier|*
name|prefixes
decl_stmt|;
name|gchar
modifier|*
name|magics
decl_stmt|;
name|procedure_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|procedure_name
operator|==
name|NULL
operator|||
operator|!
name|g_utf8_validate
argument_list|(
name|procedure_name
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|extensions
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
name|prefixes
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
name|magics
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|success
operator|=
name|fileops_register_magic_load_handler
argument_list|(
name|gimp
argument_list|,
name|procedure_name
argument_list|,
name|extensions
argument_list|,
name|prefixes
argument_list|,
name|magics
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|register_magic_load_handler_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|register_magic_load_handler_inargs
specifier|static
name|ProcArg
name|register_magic_load_handler_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"procedure-name"
block|,
literal|"The name of the procedure to be used for loading"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"extensions"
block|,
literal|"comma separated list of extensions this handler can load (i.e. \"jpg,jpeg\")"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"prefixes"
block|,
literal|"comma separated list of prefixes this handler can load (i.e. \"http:,ftp:\")"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"magics"
block|,
literal|"comma separated list of magic file information this handler can load (i.e. \"0,string,GIF\")"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_magic_load_handler_proc
specifier|static
name|ProcRecord
name|register_magic_load_handler_proc
init|=
block|{
literal|"gimp-register-magic-load-handler"
block|,
literal|"gimp-register-magic-load-handler"
block|,
literal|"Registers a file load handler procedure."
block|,
literal|"Registers a procedural database procedure to be called to load files of a particular file format using magic file information."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|4
block|,
name|register_magic_load_handler_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|register_magic_load_handler_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|register_load_handler_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|register_load_handler_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|procedure_name
decl_stmt|;
name|gchar
modifier|*
name|extensions
decl_stmt|;
name|gchar
modifier|*
name|prefixes
decl_stmt|;
name|procedure_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|procedure_name
operator|==
name|NULL
operator|||
operator|!
name|g_utf8_validate
argument_list|(
name|procedure_name
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|extensions
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
name|prefixes
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|success
operator|=
name|fileops_register_magic_load_handler
argument_list|(
name|gimp
argument_list|,
name|procedure_name
argument_list|,
name|extensions
argument_list|,
name|prefixes
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|register_load_handler_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|register_load_handler_inargs
specifier|static
name|ProcArg
name|register_load_handler_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"procedure-name"
block|,
literal|"The name of the procedure to be used for loading"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"extensions"
block|,
literal|"comma separated list of extensions this handler can load (i.e. \"jpg,jpeg\")"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"prefixes"
block|,
literal|"comma separated list of prefixes this handler can load (i.e. \"http:,ftp:\")"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_load_handler_proc
specifier|static
name|ProcRecord
name|register_load_handler_proc
init|=
block|{
literal|"gimp-register-load-handler"
block|,
literal|"gimp-register-load-handler"
block|,
literal|"Registers a file load handler procedure."
block|,
literal|"Registers a procedural database procedure to be called to load files of a particular file format."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|3
block|,
name|register_load_handler_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|register_load_handler_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|register_save_handler_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|register_save_handler_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|procedure_name
decl_stmt|;
name|gchar
modifier|*
name|extensions
decl_stmt|;
name|gchar
modifier|*
name|prefixes
decl_stmt|;
name|procedure_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|procedure_name
operator|==
name|NULL
operator|||
operator|!
name|g_utf8_validate
argument_list|(
name|procedure_name
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|extensions
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
name|prefixes
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|ProcRecord
modifier|*
name|proc
decl_stmt|;
name|PlugInProcDef
modifier|*
name|file_proc
decl_stmt|;
name|gchar
modifier|*
name|canonical
decl_stmt|;
name|success
operator|=
name|FALSE
expr_stmt|;
name|canonical
operator|=
name|gimp_canonicalize_identifier
argument_list|(
name|procedure_name
argument_list|)
expr_stmt|;
name|proc
operator|=
name|procedural_db_lookup
argument_list|(
name|gimp
argument_list|,
name|canonical
argument_list|)
expr_stmt|;
if|if
condition|(
name|proc
operator|&&
operator|(
operator|(
name|proc
operator|->
name|num_args
operator|<
literal|5
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|0
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_INT32
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|1
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_IMAGE
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|2
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_DRAWABLE
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|3
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_STRING
operator|)
operator|||
operator|(
name|proc
operator|->
name|args
index|[
literal|4
index|]
operator|.
name|arg_type
operator|!=
name|GIMP_PDB_STRING
operator|)
operator|)
condition|)
block|{
name|g_message
argument_list|(
literal|"save handler \"%s\" does not take the standard save handler args"
argument_list|,
name|canonical
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
name|file_proc
operator|=
name|plug_ins_file_register_magic
argument_list|(
name|gimp
argument_list|,
name|canonical
argument_list|,
name|extensions
argument_list|,
name|prefixes
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file_proc
condition|)
block|{
name|g_message
argument_list|(
literal|"attempt to register nonexistent save handler \"%s\""
argument_list|,
name|canonical
argument_list|)
expr_stmt|;
goto|goto
name|done
goto|;
block|}
if|if
condition|(
operator|!
name|g_slist_find
argument_list|(
name|gimp
operator|->
name|save_procs
argument_list|,
name|file_proc
argument_list|)
condition|)
name|gimp
operator|->
name|save_procs
operator|=
name|g_slist_prepend
argument_list|(
name|gimp
operator|->
name|save_procs
argument_list|,
name|file_proc
argument_list|)
expr_stmt|;
name|success
operator|=
name|TRUE
expr_stmt|;
name|done
label|:
name|g_free
argument_list|(
name|canonical
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|register_save_handler_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|register_save_handler_inargs
specifier|static
name|ProcArg
name|register_save_handler_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"procedure-name"
block|,
literal|"The name of the procedure to be used for saving"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"extensions"
block|,
literal|"comma separated list of extensions this handler can save (i.e. \"jpg,jpeg\")"
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"prefixes"
block|,
literal|"comma separated list of prefixes this handler can save (i.e. \"http:,ftp:\")"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_save_handler_proc
specifier|static
name|ProcRecord
name|register_save_handler_proc
init|=
block|{
literal|"gimp-register-save-handler"
block|,
literal|"gimp-register-save-handler"
block|,
literal|"Registers a file save handler procedure."
block|,
literal|"Registers a procedural database procedure to be called to save files in a particular file format."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|3
block|,
name|register_save_handler_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|register_save_handler_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|register_file_handler_mime_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|register_file_handler_mime_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|procedure_name
decl_stmt|;
name|gchar
modifier|*
name|mime_type
decl_stmt|;
name|procedure_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|procedure_name
operator|==
name|NULL
operator|||
operator|!
name|g_utf8_validate
argument_list|(
name|procedure_name
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|mime_type
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|mime_type
operator|==
name|NULL
operator|||
operator|!
name|g_utf8_validate
argument_list|(
name|mime_type
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|gchar
modifier|*
name|canonical
decl_stmt|;
name|canonical
operator|=
name|gimp_canonicalize_identifier
argument_list|(
name|procedure_name
argument_list|)
expr_stmt|;
name|success
operator|=
operator|(
name|plug_ins_file_register_mime
argument_list|(
name|gimp
argument_list|,
name|canonical
argument_list|,
name|mime_type
argument_list|)
operator|!=
name|NULL
operator|)
expr_stmt|;
name|g_free
argument_list|(
name|canonical
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|register_file_handler_mime_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|register_file_handler_mime_inargs
specifier|static
name|ProcArg
name|register_file_handler_mime_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"procedure-name"
block|,
literal|"The name of the procedure to associate a MIME type with."
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"mime-type"
block|,
literal|"A single MIME type, like for example \"image/jpeg\"."
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_file_handler_mime_proc
specifier|static
name|ProcRecord
name|register_file_handler_mime_proc
init|=
block|{
literal|"gimp-register-file-handler-mime"
block|,
literal|"gimp-register-file-handler-mime"
block|,
literal|"Associates a MIME type with a file handler procedure."
block|,
literal|"Registers a MIME type for a file handler procedure. This allows GIMP to determine the MIME type of the file opened or saved using this procedure."
block|,
literal|"Sven Neumann<sven@gimp.org>"
block|,
literal|"Sven Neumann"
block|,
literal|"2004"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|2
block|,
name|register_file_handler_mime_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|register_file_handler_mime_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|register_thumbnail_loader_invoker (Gimp * gimp,GimpContext * context,GimpProgress * progress,Argument * args)
name|register_thumbnail_loader_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpContext
modifier|*
name|context
parameter_list|,
name|GimpProgress
modifier|*
name|progress
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|load_proc
decl_stmt|;
name|gchar
modifier|*
name|thumb_proc
decl_stmt|;
name|load_proc
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|load_proc
operator|==
name|NULL
operator|||
operator|!
name|g_utf8_validate
argument_list|(
name|load_proc
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|thumb_proc
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|thumb_proc
operator|==
name|NULL
operator|||
operator|!
name|g_utf8_validate
argument_list|(
name|thumb_proc
argument_list|,
operator|-
literal|1
argument_list|,
name|NULL
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|gchar
modifier|*
name|canonical
decl_stmt|;
name|canonical
operator|=
name|gimp_canonicalize_identifier
argument_list|(
name|load_proc
argument_list|)
expr_stmt|;
name|success
operator|=
operator|(
name|plug_ins_file_register_thumb_loader
argument_list|(
name|gimp
argument_list|,
name|canonical
argument_list|,
name|thumb_proc
argument_list|)
operator|!=
name|NULL
operator|)
expr_stmt|;
name|g_free
argument_list|(
name|canonical
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|register_thumbnail_loader_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|register_thumbnail_loader_inargs
specifier|static
name|ProcArg
name|register_thumbnail_loader_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_STRING
block|,
literal|"load-proc"
block|,
literal|"The name of the procedure the thumbnail loader with."
block|}
block|,
block|{
name|GIMP_PDB_STRING
block|,
literal|"thumb-proc"
block|,
literal|"The name of the thumbnail load procedure."
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|register_thumbnail_loader_proc
specifier|static
name|ProcRecord
name|register_thumbnail_loader_proc
init|=
block|{
literal|"gimp-register-thumbnail-loader"
block|,
literal|"gimp-register-thumbnail-loader"
block|,
literal|"Associates a thumbnail loader with a file load procedure."
block|,
literal|"Some file formats allow for embedded thumbnails, other file formats contain a scalable image or provide the image data in different resolutions. A file plug-in for such a format may register a special procedure that allows GIMP to load a thumbnail preview of the image. This procedure is then associated with the standard load procedure using this function."
block|,
literal|"Sven Neumann<sven@gimp.org>"
block|,
literal|"Sven Neumann"
block|,
literal|"2004"
block|,
name|NULL
block|,
name|GIMP_INTERNAL
block|,
literal|2
block|,
name|register_thumbnail_loader_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|register_thumbnail_loader_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

end_unit

