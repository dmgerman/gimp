begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995-2000 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* NOTE: This file is autogenerated by pdbgen.pl. */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbasetypes.h"
end_include

begin_include
include|#
directive|include
file|"pdb-types.h"
end_include

begin_include
include|#
directive|include
file|"tools/tools-types.h"
end_include

begin_include
include|#
directive|include
file|"procedural_db.h"
end_include

begin_include
include|#
directive|include
file|"base/base-types.h"
end_include

begin_include
include|#
directive|include
file|"base/gimphistogram.h"
end_include

begin_include
include|#
directive|include
file|"base/gimplut.h"
end_include

begin_include
include|#
directive|include
file|"base/lut-funcs.h"
end_include

begin_include
include|#
directive|include
file|"base/pixel-processor.h"
end_include

begin_include
include|#
directive|include
file|"base/pixel-region.h"
end_include

begin_include
include|#
directive|include
file|"core/core-types.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdrawable-desaturate.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdrawable-equalize.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdrawable-invert.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpdrawable.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"tools/gimpcolorbalancetool.h"
end_include

begin_include
include|#
directive|include
file|"tools/gimpcurvestool.h"
end_include

begin_include
include|#
directive|include
file|"tools/gimphuesaturationtool.h"
end_include

begin_include
include|#
directive|include
file|"tools/gimpthresholdtool.h"
end_include

begin_decl_stmt
DECL|variable|brightness_contrast_proc
specifier|static
name|ProcRecord
name|brightness_contrast_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|levels_proc
specifier|static
name|ProcRecord
name|levels_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|posterize_proc
specifier|static
name|ProcRecord
name|posterize_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|desaturate_proc
specifier|static
name|ProcRecord
name|desaturate_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|equalize_proc
specifier|static
name|ProcRecord
name|equalize_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|invert_proc
specifier|static
name|ProcRecord
name|invert_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|curves_spline_proc
specifier|static
name|ProcRecord
name|curves_spline_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|curves_explicit_proc
specifier|static
name|ProcRecord
name|curves_explicit_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|color_balance_proc
specifier|static
name|ProcRecord
name|color_balance_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|histogram_proc
specifier|static
name|ProcRecord
name|histogram_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|hue_saturation_proc
specifier|static
name|ProcRecord
name|hue_saturation_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|threshold_proc
specifier|static
name|ProcRecord
name|threshold_proc
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|register_color_procs (Gimp * gimp)
name|register_color_procs
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|)
block|{
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|brightness_contrast_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|levels_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|posterize_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|desaturate_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|equalize_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|invert_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|curves_spline_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|curves_explicit_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|color_balance_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|histogram_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|hue_saturation_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
name|gimp
argument_list|,
operator|&
name|threshold_proc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|brightness_contrast_invoker (Gimp * gimp,Argument * args)
name|brightness_contrast_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|brightness
decl_stmt|;
name|gint32
name|contrast
decl_stmt|;
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpLut
modifier|*
name|lut
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|brightness
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|brightness
operator|<
operator|-
literal|127
operator|||
name|brightness
operator|>
literal|127
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|contrast
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|contrast
operator|<
operator|-
literal|127
operator|||
name|contrast
operator|>
literal|127
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
name|gimage
operator|=
name|gimp_drawable_gimage
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|lut
operator|=
name|brightness_contrast_lut_new
argument_list|(
name|brightness
operator|/
literal|255.0
argument_list|,
name|contrast
operator|/
literal|127.0
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|brightness_contrast_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|brightness_contrast_inargs
specifier|static
name|ProcArg
name|brightness_contrast_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"brightness"
block|,
literal|"Brightness adjustment: (-127<= brightness<= 127)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"contrast"
block|,
literal|"Contrast adjustment: (-127<= contrast<= 127)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|brightness_contrast_proc
specifier|static
name|ProcRecord
name|brightness_contrast_proc
init|=
block|{
literal|"gimp_brightness_contrast"
block|,
literal|"Modify brightness/contrast in the specified drawable."
block|,
literal|"This procedures allows the brightness and contrast of the specified drawable to be modified. Both 'brightness' and 'contrast' parameters are defined between -127 and 127."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|GIMP_INTERNAL
block|,
literal|3
block|,
name|brightness_contrast_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|brightness_contrast_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|levels_invoker (Gimp * gimp,Argument * args)
name|levels_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|channel
decl_stmt|;
name|gint32
name|low_inputv
decl_stmt|;
name|gint32
name|high_inputv
decl_stmt|;
name|gdouble
name|gammav
decl_stmt|;
name|gint32
name|low_outputv
decl_stmt|;
name|gint32
name|high_outputv
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|GimpLut
modifier|*
name|lut
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|low_input
index|[
literal|5
index|]
decl_stmt|;
name|int
name|high_input
index|[
literal|5
index|]
decl_stmt|;
name|double
name|gamma
index|[
literal|5
index|]
decl_stmt|;
name|int
name|low_output
index|[
literal|5
index|]
decl_stmt|;
name|int
name|high_output
index|[
literal|5
index|]
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|channel
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|channel
operator|<
name|VALUE_LUT
operator|||
name|channel
operator|>
name|ALPHA_LUT
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|low_inputv
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|low_inputv
operator|<
literal|0
operator|||
name|low_inputv
operator|>
literal|255
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|high_inputv
operator|=
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|high_inputv
operator|<
literal|0
operator|||
name|high_inputv
operator|>
literal|255
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|gammav
operator|=
name|args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|gammav
operator|<
literal|0.1
operator|||
name|gammav
operator|>
literal|10.0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|low_outputv
operator|=
name|args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|low_outputv
operator|<
literal|0
operator|||
name|low_outputv
operator|>
literal|255
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|high_outputv
operator|=
name|args
index|[
literal|6
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|high_outputv
operator|<
literal|0
operator|||
name|high_outputv
operator|>
literal|255
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
operator|||
operator|(
operator|!
name|gimp_drawable_has_alpha
argument_list|(
name|drawable
argument_list|)
operator|&&
name|channel
operator|==
name|ALPHA_LUT
operator|)
operator|||
operator|(
name|gimp_drawable_is_gray
argument_list|(
name|drawable
argument_list|)
operator|&&
name|channel
operator|!=
name|GRAY_LUT
operator|&&
name|channel
operator|!=
name|ALPHA_LUT
operator|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|low_input
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|high_input
index|[
name|i
index|]
operator|=
literal|255
expr_stmt|;
name|low_output
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|high_output
index|[
name|i
index|]
operator|=
literal|255
expr_stmt|;
name|gamma
index|[
name|i
index|]
operator|=
literal|1.0
expr_stmt|;
block|}
name|low_input
index|[
name|channel
index|]
operator|=
name|low_inputv
expr_stmt|;
name|high_input
index|[
name|channel
index|]
operator|=
name|high_inputv
expr_stmt|;
name|gamma
index|[
name|channel
index|]
operator|=
name|gammav
expr_stmt|;
name|low_output
index|[
name|channel
index|]
operator|=
name|low_outputv
expr_stmt|;
name|high_output
index|[
name|channel
index|]
operator|=
name|high_outputv
expr_stmt|;
comment|/* setup the lut */
name|lut
operator|=
name|levels_lut_new
argument_list|(
name|gamma
argument_list|,
name|low_input
argument_list|,
name|high_input
argument_list|,
name|low_output
argument_list|,
name|high_output
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|levels_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|levels_inargs
specifier|static
name|ProcArg
name|levels_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"channel"
block|,
literal|"The channel to modify: { VALUE_LUT (0), RED_LUT (1), GREEN_LUT (2), BLUE_LUT (3), ALPHA_LUT (4) }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"low_input"
block|,
literal|"Intensity of lowest input: (0<= low_input<= 255)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"high_input"
block|,
literal|"Intensity of highest input: (0<= high_input<= 255)"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"gamma"
block|,
literal|"Gamma correction factor: (0.1<= gamma<= 10)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"low_output"
block|,
literal|"Intensity of lowest output: (0<= low_output<= 255)"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"high_output"
block|,
literal|"Intensity of highest output: (0<= high_output<= 255)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|levels_proc
specifier|static
name|ProcRecord
name|levels_proc
init|=
block|{
literal|"gimp_levels"
block|,
literal|"Modifies intensity levels in the specified drawable."
block|,
literal|"This tool allows intensity levels in the specified drawable to be remapped according to a set of parameters. The low/high input levels specify an initial mapping from the source intensities. The gamma value determines how intensities between the low and high input intensities are interpolated. A gamma value of 1.0 results in a linear interpolation. Higher gamma values result in more high-level intensities. Lower gamma values result in more low-level intensities. The low/high output levels constrain the final intensity mapping--that is, no final intensity will be lower than the low output level and no final intensity will be higher than the high output level. This tool is only valid on RGB color and grayscale images. It will not operate on indexed drawables."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|GIMP_INTERNAL
block|,
literal|7
block|,
name|levels_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|levels_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|posterize_invoker (Gimp * gimp,Argument * args)
name|posterize_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|levels
decl_stmt|;
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpLut
modifier|*
name|lut
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|levels
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|levels
operator|<
literal|2
operator|||
name|levels
operator|>
literal|255
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
name|gimage
operator|=
name|gimp_drawable_gimage
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|lut
operator|=
name|posterize_lut_new
argument_list|(
name|levels
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|posterize_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|posterize_inargs
specifier|static
name|ProcArg
name|posterize_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"levels"
block|,
literal|"Levels of posterization: (2<= levels<= 255)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|posterize_proc
specifier|static
name|ProcRecord
name|posterize_proc
init|=
block|{
literal|"gimp_posterize"
block|,
literal|"Posterize the specified drawable."
block|,
literal|"This procedures reduces the number of shades allows in each intensity channel to the specified 'levels' parameter."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|GIMP_INTERNAL
block|,
literal|2
block|,
name|posterize_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|posterize_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|desaturate_invoker (Gimp * gimp,Argument * args)
name|desaturate_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_rgb
argument_list|(
name|drawable
argument_list|)
condition|)
name|gimp_drawable_desaturate
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|desaturate_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|desaturate_inargs
specifier|static
name|ProcArg
name|desaturate_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|desaturate_proc
specifier|static
name|ProcRecord
name|desaturate_proc
init|=
block|{
literal|"gimp_desaturate"
block|,
literal|"Desaturate the contents of the specified drawable."
block|,
literal|"This procedure desaturates the contents of the specified drawable. This procedure only works on drawables of type RGB color."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|GIMP_INTERNAL
block|,
literal|1
block|,
name|desaturate_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|desaturate_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|equalize_invoker (Gimp * gimp,Argument * args)
name|equalize_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gboolean
name|mask_only
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|mask_only
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
condition|?
name|TRUE
else|:
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
operator|!
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
condition|)
name|gimp_drawable_equalize
argument_list|(
name|drawable
argument_list|,
name|mask_only
argument_list|)
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|equalize_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|equalize_inargs
specifier|static
name|ProcArg
name|equalize_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"mask_only"
block|,
literal|"Equalization option"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|equalize_proc
specifier|static
name|ProcRecord
name|equalize_proc
init|=
block|{
literal|"gimp_equalize"
block|,
literal|"Equalize the contents of the specified drawable."
block|,
literal|"This procedure equalizes the contents of the specified drawable. Each intensity channel is equalizeed independently. The equalized intensity is given as inten' = (255 - inten). Indexed color drawables are not valid for this operation. The 'mask_only' option specifies whether to adjust only the area of the image within the selection bounds, or the entire image based on the histogram of the selected area. If there is no selection, the entire image is adjusted based on the histogram for the entire image."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|GIMP_INTERNAL
block|,
literal|2
block|,
name|equalize_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|equalize_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|invert_invoker (Gimp * gimp,Argument * args)
name|invert_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
operator|!
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
condition|)
name|gimp_drawable_invert
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|invert_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|invert_inargs
specifier|static
name|ProcArg
name|invert_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|invert_proc
specifier|static
name|ProcRecord
name|invert_proc
init|=
block|{
literal|"gimp_invert"
block|,
literal|"Invert the contents of the specified drawable."
block|,
literal|"This procedure inverts the contents of the specified drawable. Each intensity channel is inverted independently. The inverted intensity is given as inten' = (255 - inten). Indexed color drawables are not valid for this operation."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|GIMP_INTERNAL
block|,
literal|1
block|,
name|invert_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|invert_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|curves_spline_invoker (Gimp * gimp,Argument * args)
name|curves_spline_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|channel
decl_stmt|;
name|gint32
name|num_points
decl_stmt|;
name|guint8
modifier|*
name|control_pts
decl_stmt|;
name|CurvesDialog
name|cd
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|channel
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|channel
operator|<
name|VALUE_LUT
operator|||
name|channel
operator|>
name|ALPHA_LUT
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|num_points
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|num_points
operator|<=
literal|3
operator|||
name|num_points
operator|>
literal|32
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|control_pts
operator|=
operator|(
name|guint8
operator|*
operator|)
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
operator|||
operator|(
name|num_points
operator|&
literal|1
operator|)
operator|||
operator|(
name|gimp_drawable_is_gray
argument_list|(
name|drawable
argument_list|)
operator|&&
name|channel
operator|!=
name|GRAY_LUT
operator|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
name|cd
operator|.
name|lut
operator|=
name|gimp_lut_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|256
condition|;
name|j
operator|++
control|)
name|cd
operator|.
name|curve
index|[
name|i
index|]
index|[
name|j
index|]
operator|=
name|j
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|17
condition|;
name|j
operator|++
control|)
block|{
name|cd
operator|.
name|points
index|[
name|i
index|]
index|[
name|j
index|]
index|[
literal|0
index|]
operator|=
operator|-
literal|1
expr_stmt|;
name|cd
operator|.
name|points
index|[
name|i
index|]
index|[
name|j
index|]
index|[
literal|1
index|]
operator|=
operator|-
literal|1
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
name|cd
operator|.
name|curve_type
index|[
name|i
index|]
operator|=
name|SMOOTH
expr_stmt|;
name|cd
operator|.
name|drawable
operator|=
name|drawable
expr_stmt|;
name|cd
operator|.
name|channel
operator|=
name|channel
expr_stmt|;
name|cd
operator|.
name|color
operator|=
name|gimp_drawable_is_rgb
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|num_points
operator|/
literal|2
condition|;
name|j
operator|++
control|)
block|{
name|cd
operator|.
name|points
index|[
name|cd
operator|.
name|channel
index|]
index|[
name|j
index|]
index|[
literal|0
index|]
operator|=
name|control_pts
index|[
name|j
operator|*
literal|2
index|]
expr_stmt|;
name|cd
operator|.
name|points
index|[
name|cd
operator|.
name|channel
index|]
index|[
name|j
index|]
index|[
literal|1
index|]
operator|=
name|control_pts
index|[
name|j
operator|*
literal|2
operator|+
literal|1
index|]
expr_stmt|;
block|}
name|curves_calculate_curve
argument_list|(
operator|&
name|cd
argument_list|)
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|cd
operator|.
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|cd
operator|.
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|curves_spline_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|curves_spline_inargs
specifier|static
name|ProcArg
name|curves_spline_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"channel"
block|,
literal|"The channel to modify: { VALUE_LUT (0), RED_LUT (1), GREEN_LUT (2), BLUE_LUT (3), ALPHA_LUT (4) }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"num_points"
block|,
literal|"The number of values in the control point array (3< num_points<= 32)"
block|}
block|,
block|{
name|GIMP_PDB_INT8ARRAY
block|,
literal|"control_pts"
block|,
literal|"The spline control points: { cp1.x, cp1.y, cp2.x, cp2.y, ... }"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|curves_spline_proc
specifier|static
name|ProcRecord
name|curves_spline_proc
init|=
block|{
literal|"gimp_curves_spline"
block|,
literal|"Modifies the intensity curve(s) for specified drawable."
block|,
literal|"Modifies the intensity mapping for one channel in the specified drawable. The drawable must be either grayscale or RGB, and the channel can be either an intensity component, or the value. The 'control_pts' parameter is an array of integers which define a set of control points which describe a Catmull Rom spline which yields the final intensity curve. Use the 'gimp_curves_explicit' function to explicitly modify intensity levels."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|GIMP_INTERNAL
block|,
literal|4
block|,
name|curves_spline_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|curves_spline_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|curves_explicit_invoker (Gimp * gimp,Argument * args)
name|curves_explicit_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|channel
decl_stmt|;
name|gint32
name|num_bytes
decl_stmt|;
name|guint8
modifier|*
name|curve
decl_stmt|;
name|CurvesDialog
name|cd
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|int
name|i
decl_stmt|,
name|j
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|channel
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|channel
operator|<
name|VALUE_LUT
operator|||
name|channel
operator|>
name|ALPHA_LUT
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|num_bytes
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|num_bytes
operator|<=
literal|0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|curve
operator|=
operator|(
name|guint8
operator|*
operator|)
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
operator|||
operator|(
name|num_bytes
operator|!=
literal|256
operator|)
operator|||
operator|(
name|gimp_drawable_is_gray
argument_list|(
name|drawable
argument_list|)
operator|&&
name|channel
operator|!=
name|GRAY_LUT
operator|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|256
condition|;
name|j
operator|++
control|)
name|cd
operator|.
name|curve
index|[
name|i
index|]
index|[
name|j
index|]
operator|=
name|j
expr_stmt|;
name|cd
operator|.
name|drawable
operator|=
name|drawable
expr_stmt|;
name|cd
operator|.
name|channel
operator|=
name|channel
expr_stmt|;
name|cd
operator|.
name|color
operator|=
name|gimp_drawable_is_rgb
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|256
condition|;
name|j
operator|++
control|)
name|cd
operator|.
name|curve
index|[
name|cd
operator|.
name|channel
index|]
index|[
name|j
index|]
operator|=
name|curve
index|[
name|j
index|]
expr_stmt|;
name|cd
operator|.
name|lut
operator|=
name|gimp_lut_new
argument_list|()
expr_stmt|;
name|gimp_lut_setup
argument_list|(
name|cd
operator|.
name|lut
argument_list|,
operator|(
name|GimpLutFunc
operator|)
name|curves_lut_func
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|cd
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|cd
operator|.
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|cd
operator|.
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|curves_explicit_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|curves_explicit_inargs
specifier|static
name|ProcArg
name|curves_explicit_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"channel"
block|,
literal|"The channel to modify: { VALUE_LUT (0), RED_LUT (1), GREEN_LUT (2), BLUE_LUT (3), ALPHA_LUT (4) }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"num_bytes"
block|,
literal|"The number of bytes in the new curve (always 256)"
block|}
block|,
block|{
name|GIMP_PDB_INT8ARRAY
block|,
literal|"curve"
block|,
literal|"The explicit curve"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|curves_explicit_proc
specifier|static
name|ProcRecord
name|curves_explicit_proc
init|=
block|{
literal|"gimp_curves_explicit"
block|,
literal|"Modifies the intensity curve(s) for specified drawable."
block|,
literal|"Modifies the intensity mapping for one channel in the specified drawable. The drawable must be either grayscale or RGB, and the channel can be either an intensity component, or the value. The 'curve' parameter is an array of bytes which explicitly defines how each pixel value in the drawable will be modified. Use the 'gimp_curves_spline' function to modify intensity levels with Catmull Rom splines."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|GIMP_INTERNAL
block|,
literal|4
block|,
name|curves_explicit_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|curves_explicit_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|color_balance_invoker (Gimp * gimp,Argument * args)
name|color_balance_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|transfer_mode
decl_stmt|;
name|gboolean
name|preserve_lum
decl_stmt|;
name|gdouble
name|cyan_red
decl_stmt|;
name|gdouble
name|magenta_green
decl_stmt|;
name|gdouble
name|yellow_blue
decl_stmt|;
name|ColorBalanceDialog
name|cbd
decl_stmt|;
name|int
name|i
decl_stmt|;
name|void
modifier|*
name|pr
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|transfer_mode
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|transfer_mode
operator|<
name|GIMP_SHADOWS
operator|||
name|transfer_mode
operator|>
name|GIMP_HIGHLIGHTS
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|preserve_lum
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
condition|?
name|TRUE
else|:
name|FALSE
expr_stmt|;
name|cyan_red
operator|=
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|cyan_red
operator|<
operator|-
literal|100.0
operator|||
name|cyan_red
operator|>
literal|100.0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|magenta_green
operator|=
name|args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|magenta_green
operator|<
operator|-
literal|100.0
operator|||
name|magenta_green
operator|>
literal|100.0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|yellow_blue
operator|=
name|args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|yellow_blue
operator|<
operator|-
literal|100.0
operator|||
name|yellow_blue
operator|>
literal|100.0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|cbd
operator|.
name|cyan_red
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
name|cbd
operator|.
name|magenta_green
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
name|cbd
operator|.
name|yellow_blue
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
block|}
name|cbd
operator|.
name|preserve_luminosity
operator|=
name|preserve_lum
expr_stmt|;
name|cbd
operator|.
name|cyan_red
index|[
name|transfer_mode
index|]
operator|=
name|cyan_red
expr_stmt|;
name|cbd
operator|.
name|magenta_green
index|[
name|transfer_mode
index|]
operator|=
name|magenta_green
expr_stmt|;
name|cbd
operator|.
name|yellow_blue
index|[
name|transfer_mode
index|]
operator|=
name|yellow_blue
expr_stmt|;
name|color_balance_create_lookup_tables
argument_list|(
operator|&
name|cbd
argument_list|)
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|pixel_regions_register
argument_list|(
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
init|;
name|pr
condition|;
name|pr
operator|=
name|pixel_regions_process
argument_list|(
name|pr
argument_list|)
control|)
name|color_balance
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|cbd
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|color_balance_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|color_balance_inargs
specifier|static
name|ProcArg
name|color_balance_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"transfer_mode"
block|,
literal|"Transfer mode: { SHADOWS (0), MIDTONES (1), HIGHLIGHTS (2) }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"preserve_lum"
block|,
literal|"Preserve luminosity values at each pixel"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"cyan_red"
block|,
literal|"Cyan-Red color balance: (-100<= cyan_red<= 100)"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"magenta_green"
block|,
literal|"Magenta-Green color balance: (-100<= magenta_green<= 100)"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"yellow_blue"
block|,
literal|"Yellow-Blue color balance: (-100<= yellow_blue<= 100)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|color_balance_proc
specifier|static
name|ProcRecord
name|color_balance_proc
init|=
block|{
literal|"gimp_color_balance"
block|,
literal|"Modify the color balance of the specified drawable."
block|,
literal|"Modify the color balance of the specified drawable. There are three axis which can be modified: cyan-red, magenta-green, and yellow-blue. Negative values increase the amount of the former, positive values increase the amount of the latter. Color balance can be controlled with the 'transfer_mode' setting, which allows shadows, midtones, and highlights in an image to be affected differently. The 'preserve_lum' parameter, if non-zero, ensures that the luminosity of each pixel remains fixed."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|GIMP_INTERNAL
block|,
literal|6
block|,
name|color_balance_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|color_balance_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|histogram_invoker (Gimp * gimp,Argument * args)
name|histogram_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|channel
decl_stmt|;
name|gint32
name|start_range
decl_stmt|;
name|gint32
name|end_range
decl_stmt|;
name|gdouble
name|mean
init|=
literal|0
decl_stmt|;
name|gdouble
name|std_dev
init|=
literal|0
decl_stmt|;
name|gdouble
name|median
init|=
literal|0
decl_stmt|;
name|gdouble
name|pixels
init|=
literal|0
decl_stmt|;
name|gdouble
name|count
init|=
literal|0
decl_stmt|;
name|gdouble
name|percentile
init|=
literal|0
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|maskPR
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|GimpHistogram
modifier|*
name|histogram
decl_stmt|;
name|int
name|off_x
decl_stmt|,
name|off_y
decl_stmt|;
name|gboolean
name|no_mask
decl_stmt|;
name|GimpChannel
modifier|*
name|mask
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|channel
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|channel
operator|<
name|VALUE_LUT
operator|||
name|channel
operator|>
name|ALPHA_LUT
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|start_range
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|start_range
operator|<
literal|0
operator|||
name|start_range
operator|>=
literal|256
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|end_range
operator|=
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|end_range
operator|<
literal|0
operator|||
name|end_range
operator|>=
literal|256
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
operator|||
operator|(
name|gimp_drawable_is_gray
argument_list|(
name|drawable
argument_list|)
operator|&&
name|channel
operator|!=
name|GRAY_LUT
operator|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
comment|/* The information collection should occur only within selection bounds */
name|no_mask
operator|=
operator|(
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
operator|==
name|FALSE
operator|)
expr_stmt|;
name|gimp_drawable_offsets
argument_list|(
name|drawable
argument_list|,
operator|&
name|off_x
argument_list|,
operator|&
name|off_y
argument_list|)
expr_stmt|;
comment|/* Configure the src from the drawable data */
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/*  Configure the mask from the gimage's selection mask */
name|mask
operator|=
name|gimp_image_get_mask
argument_list|(
name|gimp_drawable_gimage
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|maskPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|mask
argument_list|)
argument_list|)
argument_list|,
name|x1
operator|+
name|off_x
argument_list|,
name|y1
operator|+
name|off_y
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* Apply the image transformation to the pixels */
name|histogram
operator|=
name|gimp_histogram_new
argument_list|()
expr_stmt|;
if|if
condition|(
name|no_mask
condition|)
name|gimp_histogram_calculate
argument_list|(
name|histogram
argument_list|,
operator|&
name|srcPR
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
else|else
name|gimp_histogram_calculate
argument_list|(
name|histogram
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|maskPR
argument_list|)
expr_stmt|;
comment|/* Calculate the statistics */
name|mean
operator|=
name|gimp_histogram_get_mean
argument_list|(
name|histogram
argument_list|,
name|channel
argument_list|,
name|start_range
argument_list|,
name|end_range
argument_list|)
expr_stmt|;
name|std_dev
operator|=
name|gimp_histogram_get_std_dev
argument_list|(
name|histogram
argument_list|,
name|channel
argument_list|,
name|start_range
argument_list|,
name|end_range
argument_list|)
expr_stmt|;
name|median
operator|=
name|gimp_histogram_get_median
argument_list|(
name|histogram
argument_list|,
name|channel
argument_list|,
name|start_range
argument_list|,
name|end_range
argument_list|)
expr_stmt|;
name|pixels
operator|=
name|gimp_histogram_get_count
argument_list|(
name|histogram
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
expr_stmt|;
name|count
operator|=
name|gimp_histogram_get_count
argument_list|(
name|histogram
argument_list|,
name|start_range
argument_list|,
name|end_range
argument_list|)
expr_stmt|;
name|percentile
operator|=
name|count
operator|/
name|pixels
expr_stmt|;
name|gimp_histogram_free
argument_list|(
name|histogram
argument_list|)
expr_stmt|;
block|}
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|histogram_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_float
operator|=
name|mean
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_float
operator|=
name|std_dev
expr_stmt|;
name|return_args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_float
operator|=
name|median
expr_stmt|;
name|return_args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_float
operator|=
name|pixels
expr_stmt|;
name|return_args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_float
operator|=
name|count
expr_stmt|;
name|return_args
index|[
literal|6
index|]
operator|.
name|value
operator|.
name|pdb_float
operator|=
name|percentile
expr_stmt|;
block|}
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|histogram_inargs
specifier|static
name|ProcArg
name|histogram_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"channel"
block|,
literal|"The channel to modify: { VALUE_LUT (0), RED_LUT (1), GREEN_LUT (2), BLUE_LUT (3), ALPHA_LUT (4) }"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"start_range"
block|,
literal|"Start of the intensity measurement range"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"end_range"
block|,
literal|"End of the intensity measurement range"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|histogram_outargs
specifier|static
name|ProcArg
name|histogram_outargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"mean"
block|,
literal|"Mean intensity value"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"std_dev"
block|,
literal|"Standard deviation of intensity values"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"median"
block|,
literal|"Median intensity value"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"pixels"
block|,
literal|"Alpha-weighted pixel count for entire image"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"count"
block|,
literal|"Alpha-weighted pixel count for range"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"percentile"
block|,
literal|"Percentile that range falls under"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|histogram_proc
specifier|static
name|ProcRecord
name|histogram_proc
init|=
block|{
literal|"gimp_histogram"
block|,
literal|"Returns information on the intensity histogram for the specified drawable."
block|,
literal|"This tool makes it possible to gather information about the intensity histogram of a drawable. A channel to examine is first specified. This can be either value, red, green, or blue, depending on whether the drawable is of type color or grayscale. The drawable may not be indexed. Second, a range of intensities are specified. The gimp_histogram function returns statistics based on the pixels in the drawable that fall under this range of values. Mean, standard deviation, median, number of pixels, and percentile are all returned. Additionally, the total count of pixels in the image is returned. Counts of pixels are weighted by any associated alpha values and by the current selection mask. That is, pixels that lie outside an active selection mask will not be counted. Similarly, pixels with transparent alpha values will not be counted."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|GIMP_INTERNAL
block|,
literal|4
block|,
name|histogram_inargs
block|,
literal|6
block|,
name|histogram_outargs
block|,
block|{
block|{
name|histogram_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|hue_saturation_invoker (Gimp * gimp,Argument * args)
name|hue_saturation_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|hue_range
decl_stmt|;
name|gdouble
name|hue_offset
decl_stmt|;
name|gdouble
name|lightness
decl_stmt|;
name|gdouble
name|saturation
decl_stmt|;
name|HueSaturationDialog
name|hsd
decl_stmt|;
name|int
name|i
decl_stmt|;
name|void
modifier|*
name|pr
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|hue_range
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|hue_range
operator|<
name|ALL_HUES
operator|||
name|hue_range
operator|>
name|MAGENTA_HUES
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|hue_offset
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|hue_offset
operator|<
operator|-
literal|180.0
operator|||
name|hue_offset
operator|>
literal|180.0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|lightness
operator|=
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|lightness
operator|<
operator|-
literal|100.0
operator|||
name|lightness
operator|>
literal|100.0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|saturation
operator|=
name|args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|saturation
operator|<
operator|-
literal|100.0
operator|||
name|saturation
operator|>
literal|100.0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|7
condition|;
name|i
operator|++
control|)
block|{
name|hsd
operator|.
name|hue
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
name|hsd
operator|.
name|lightness
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
name|hsd
operator|.
name|saturation
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
block|}
name|hsd
operator|.
name|hue
index|[
name|hue_range
index|]
operator|=
name|hue_offset
expr_stmt|;
name|hsd
operator|.
name|lightness
index|[
name|hue_range
index|]
operator|=
name|lightness
expr_stmt|;
name|hsd
operator|.
name|saturation
index|[
name|hue_range
index|]
operator|=
name|saturation
expr_stmt|;
comment|/* Calculate the transfer arrays */
name|hue_saturation_calculate_transfers
argument_list|(
operator|&
name|hsd
argument_list|)
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|pr
operator|=
name|pixel_regions_register
argument_list|(
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
init|;
name|pr
condition|;
name|pr
operator|=
name|pixel_regions_process
argument_list|(
name|pr
argument_list|)
control|)
name|hue_saturation
argument_list|(
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|hsd
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|hue_saturation_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|hue_saturation_inargs
specifier|static
name|ProcArg
name|hue_saturation_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"hue_range"
block|,
literal|"Range of affected hues: { ALL_HUES (0), RED_HUES (1), YELLOW_HUES (2), GREEN_HUES (3), CYAN_HUES (4), BLUE_HUES (5), MAGENTA_HUES (6) }"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"hue_offset"
block|,
literal|"Hue offset in degrees: (-180<= hue_offset<= 180)"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"lightness"
block|,
literal|"lightness modification: (-100<= lightness<= 100)"
block|}
block|,
block|{
name|GIMP_PDB_FLOAT
block|,
literal|"saturation"
block|,
literal|"saturation modification: (-100<= saturation<= 100)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|hue_saturation_proc
specifier|static
name|ProcRecord
name|hue_saturation_proc
init|=
block|{
literal|"gimp_hue_saturation"
block|,
literal|"Modify hue, lightness, and saturation in the specified drawable."
block|,
literal|"This procedures allows the hue, lightness, and saturation in the specified drawable to be modified. The 'hue_range' parameter provides the capability to limit range of affected hues."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|GIMP_INTERNAL
block|,
literal|5
block|,
name|hue_saturation_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|hue_saturation_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|threshold_invoker (Gimp * gimp,Argument * args)
name|threshold_invoker
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|gint32
name|low_threshold
decl_stmt|;
name|gint32
name|high_threshold
decl_stmt|;
name|ThresholdDialog
name|td
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_by_ID
argument_list|(
name|gimp
argument_list|,
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|low_threshold
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|low_threshold
operator|<
literal|0
operator|||
name|low_threshold
operator|>
literal|255
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|high_threshold
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|high_threshold
operator|<
literal|0
operator|||
name|high_threshold
operator|>
literal|255
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_is_indexed
argument_list|(
name|drawable
argument_list|)
operator|||
operator|(
name|low_threshold
operator|>=
name|high_threshold
operator|)
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
block|{
name|td
operator|.
name|color
operator|=
name|gimp_drawable_is_rgb
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
name|td
operator|.
name|low_threshold
operator|=
name|low_threshold
expr_stmt|;
name|td
operator|.
name|high_threshold
operator|=
name|high_threshold
expr_stmt|;
comment|/* The application should occur only within selection bounds */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|threshold_2
argument_list|,
operator|(
name|void
operator|*
operator|)
operator|&
name|td
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|threshold_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|threshold_inargs
specifier|static
name|ProcArg
name|threshold_inargs
index|[]
init|=
block|{
block|{
name|GIMP_PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"The drawable"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"low_threshold"
block|,
literal|"The low threshold value: 0<= low_threshold<= 255"
block|}
block|,
block|{
name|GIMP_PDB_INT32
block|,
literal|"high_threshold"
block|,
literal|"The high threshold value: 0<= high_threshold<= 255"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|threshold_proc
specifier|static
name|ProcRecord
name|threshold_proc
init|=
block|{
literal|"gimp_threshold"
block|,
literal|"Threshold the specified drawable."
block|,
literal|"This procedures generates a threshold map of the specified drawable. All pixels between the values of 'low_threshold' and 'high_threshold' are replaced with white, and all other pixels with black."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|GIMP_INTERNAL
block|,
literal|3
block|,
name|threshold_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|threshold_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

end_unit

