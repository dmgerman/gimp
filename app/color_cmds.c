begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"color_cmds.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"gimpdrawable.h"
end_include

begin_include
include|#
directive|include
file|"gimplut.h"
end_include

begin_include
include|#
directive|include
file|"lut_funcs.h"
end_include

begin_function_decl
specifier|static
name|Argument
modifier|*
name|brightness_contrast_invoker
parameter_list|(
name|Argument
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|levels_invoker
parameter_list|(
name|Argument
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|posterize_invoker
parameter_list|(
name|Argument
modifier|*
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  ------------------------------------------------------------------  */
end_comment

begin_comment
comment|/*  --------- The brightness_contrast procedure definition  ----------  */
end_comment

begin_comment
comment|/*  ------------------------------------------------------------------  */
end_comment

begin_decl_stmt
DECL|variable|brightness_contrast_args
name|ProcArg
name|brightness_contrast_args
index|[]
init|=
block|{
block|{
name|PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"the drawable"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"brightness"
block|,
literal|"brightness adjustment: (-127<= brightness<= 127)"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"contrast"
block|,
literal|"constrast adjustment: (-127<= contrast<= 127)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|brightness_contrast_proc
name|ProcRecord
name|brightness_contrast_proc
init|=
block|{
literal|"gimp_brightness_contrast"
block|,
literal|"Modify brightness/contrast in the specified drawable"
block|,
literal|"This procedures allows the brightness and contrast of the specified drawable to be modified.  Both 'brightness' and 'contrast' parameters are defined between -127 and 127."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/*  Input arguments  */
literal|3
block|,
name|brightness_contrast_args
block|,
comment|/*  Output arguments  */
literal|0
block|,
name|NULL
block|,
comment|/*  Exec method  */
block|{
block|{
name|brightness_contrast_invoker
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|brightness_contrast_invoker (Argument * args)
name|brightness_contrast_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|success
init|=
name|TRUE
decl_stmt|;
name|int
name|int_value
decl_stmt|;
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|int
name|brightness
decl_stmt|;
name|int
name|contrast
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|drawable
operator|=
name|NULL
expr_stmt|;
name|brightness
operator|=
literal|0
expr_stmt|;
name|contrast
operator|=
literal|0
expr_stmt|;
comment|/*  the drawable  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_ID
argument_list|(
name|int_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
name|gimage
operator|=
name|gimp_drawable_gimage
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
comment|/*  make sure the drawable is not indexed color  */
if|if
condition|(
name|success
condition|)
name|success
operator|=
operator|!
name|gimp_drawable_indexed
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
comment|/*  brightness  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|<
operator|-
literal|127
operator|||
name|int_value
operator|>
literal|127
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
name|brightness
operator|=
name|int_value
expr_stmt|;
block|}
comment|/*  contrast  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|<
operator|-
literal|127
operator|||
name|int_value
operator|>
literal|127
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
name|contrast
operator|=
name|int_value
expr_stmt|;
block|}
comment|/*  arrange to modify the brightness/contrast  */
if|if
condition|(
name|success
condition|)
block|{
name|GimpLut
modifier|*
name|lut
decl_stmt|;
name|lut
operator|=
name|brightness_contrast_lut_new
argument_list|(
name|brightness
operator|/
literal|255.0
argument_list|,
name|contrast
operator|/
literal|127.0
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  The application should occur only within selection bounds  */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|brightness_contrast_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  ------------------------------------------------------------------  */
end_comment

begin_comment
comment|/*  ---------------- The levels procedure definition -----------------  */
end_comment

begin_comment
comment|/*  ------------------------------------------------------------------  */
end_comment

begin_decl_stmt
DECL|variable|levels_args
name|ProcArg
name|levels_args
index|[]
init|=
block|{
block|{
name|PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"the drawable"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"channel"
block|,
literal|"the channel to modify: { VALUE (0), RED (1), GREEN (2), BLUE (3), GRAY (0) }"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"low_input"
block|,
literal|"intensity of lowest input: (0<= low_input<= 255)"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"high_input"
block|,
literal|"intensity of highest input: (0<= high_input<= 255)"
block|}
block|,
block|{
name|PDB_FLOAT
block|,
literal|"gamma"
block|,
literal|"gamma correction factor: (0.1<= gamma<= 10)"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"low_output"
block|,
literal|"intensity of lowest output: (0<= low_input<= 255)"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"high_output"
block|,
literal|"intensity of highest output: (0<= high_input<= 255)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|levels_proc
name|ProcRecord
name|levels_proc
init|=
block|{
literal|"gimp_levels"
block|,
literal|"Modifies intensity levels in the specified drawable"
block|,
literal|"This tool allows intensity levels in the specified drawable to be remapped according to a set of parameters.  The low/high input levels specify an initial mapping from the source intensities.  The gamma value determines how intensities between the low and high input intensities are interpolated.  A gamma value of 1.0 results in a linear interpolation.  Higher gamma values result in more high-level intensities.  Lower gamma values result in more low-level intensities.  The low/high output levels constrain the final intensity mapping--that is, no final intensity will be lower than the low output level and no final intensity will be higher than the high output level.  This tool is only valid on RGB color and grayscale images.  It will not operate on indexed drawables."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|PDB_INTERNAL
block|,
comment|/*  Input arguments  */
literal|7
block|,
name|levels_args
block|,
comment|/*  Output arguments  */
literal|0
block|,
name|NULL
block|,
comment|/*  Exec method  */
block|{
block|{
name|levels_invoker
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|levels_invoker (Argument * args)
name|levels_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|int
name|channel
decl_stmt|;
name|int
name|low_inputv
decl_stmt|;
name|int
name|high_inputv
decl_stmt|;
name|double
name|gammav
decl_stmt|;
name|int
name|low_outputv
decl_stmt|;
name|int
name|high_outputv
decl_stmt|;
name|int
name|int_value
decl_stmt|;
name|double
name|fp_value
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|low_input
index|[
literal|5
index|]
decl_stmt|;
name|double
name|gamma
index|[
literal|5
index|]
decl_stmt|;
name|int
name|high_input
index|[
literal|5
index|]
decl_stmt|;
name|int
name|low_output
index|[
literal|5
index|]
decl_stmt|;
name|int
name|high_output
index|[
literal|5
index|]
decl_stmt|;
name|drawable
operator|=
name|NULL
expr_stmt|;
name|low_inputv
operator|=
literal|0
expr_stmt|;
name|high_inputv
operator|=
literal|0
expr_stmt|;
name|gammav
operator|=
literal|1.0
expr_stmt|;
name|low_outputv
operator|=
literal|0
expr_stmt|;
name|high_outputv
operator|=
literal|0
expr_stmt|;
comment|/*  the drawable  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_ID
argument_list|(
name|int_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  make sure the drawable is not indexed color  */
if|if
condition|(
name|success
condition|)
name|success
operator|=
operator|!
name|gimp_drawable_indexed
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
comment|/*  channel  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
name|gimp_drawable_gray
argument_list|(
name|drawable
argument_list|)
condition|)
block|{
if|if
condition|(
name|int_value
operator|!=
literal|0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gimp_drawable_color
argument_list|(
name|drawable
argument_list|)
condition|)
block|{
if|if
condition|(
name|int_value
operator|<
literal|0
operator|||
name|int_value
operator|>
literal|3
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
name|channel
operator|=
name|int_value
expr_stmt|;
block|}
comment|/*  low input  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|0
operator|&&
name|int_value
operator|<
literal|256
condition|)
name|low_inputv
operator|=
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  high input  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|0
operator|&&
name|int_value
operator|<
literal|256
condition|)
name|high_inputv
operator|=
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  gamma  */
if|if
condition|(
name|success
condition|)
block|{
name|fp_value
operator|=
name|args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_float
expr_stmt|;
if|if
condition|(
name|fp_value
operator|>=
literal|0.1
operator|&&
name|fp_value
operator|<=
literal|10.0
condition|)
name|gammav
operator|=
name|fp_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  low output  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|0
operator|&&
name|int_value
operator|<
literal|256
condition|)
name|low_outputv
operator|=
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  high output  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|6
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|0
operator|&&
name|int_value
operator|<
literal|256
condition|)
name|high_outputv
operator|=
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  arrange to modify the levels  */
if|if
condition|(
name|success
condition|)
block|{
name|GimpLut
modifier|*
name|lut
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|low_input
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|gamma
index|[
name|i
index|]
operator|=
literal|1.0
expr_stmt|;
name|high_input
index|[
name|i
index|]
operator|=
literal|255
expr_stmt|;
name|low_output
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|high_output
index|[
name|i
index|]
operator|=
literal|255
expr_stmt|;
block|}
name|low_input
index|[
name|channel
index|]
operator|=
name|low_inputv
expr_stmt|;
name|high_input
index|[
name|channel
index|]
operator|=
name|high_inputv
expr_stmt|;
name|gamma
index|[
name|channel
index|]
operator|=
name|gammav
expr_stmt|;
name|low_output
index|[
name|channel
index|]
operator|=
name|low_outputv
expr_stmt|;
name|high_output
index|[
name|channel
index|]
operator|=
name|high_outputv
expr_stmt|;
comment|/*  setup the lut  */
name|lut
operator|=
name|levels_lut_new
argument_list|(
name|gamma
argument_list|,
name|low_input
argument_list|,
name|high_input
argument_list|,
name|low_output
argument_list|,
name|high_output
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  The application should occur only within selection bounds  */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|levels_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  ------------------------------------------------------------------  */
end_comment

begin_comment
comment|/*  ---------------- The posterize procedure definition --------------  */
end_comment

begin_comment
comment|/*  ------------------------------------------------------------------  */
end_comment

begin_decl_stmt
DECL|variable|posterize_args
name|ProcArg
name|posterize_args
index|[]
init|=
block|{
block|{
name|PDB_DRAWABLE
block|,
literal|"drawable"
block|,
literal|"the drawable"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"levels"
block|,
literal|"levels of posterization: (2<= levels<= 255)"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|posterize_proc
name|ProcRecord
name|posterize_proc
init|=
block|{
literal|"gimp_posterize"
block|,
literal|"Posterize the specified drawable"
block|,
literal|"This procedures reduces the number of shades allows in each intensity channel to the specified 'levels' parameter."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/*  Input arguments  */
literal|2
block|,
name|posterize_args
block|,
comment|/*  Output arguments  */
literal|0
block|,
name|NULL
block|,
comment|/*  Exec method  */
block|{
block|{
name|posterize_invoker
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|posterize_invoker (Argument * args)
name|posterize_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|PixelRegion
name|srcPR
decl_stmt|,
name|destPR
decl_stmt|;
name|int
name|success
init|=
name|TRUE
decl_stmt|;
name|GimpImage
modifier|*
name|gimage
decl_stmt|;
name|GimpDrawable
modifier|*
name|drawable
decl_stmt|;
name|int
name|levels
decl_stmt|;
name|int
name|int_value
decl_stmt|;
name|int
name|x1
decl_stmt|,
name|y1
decl_stmt|,
name|x2
decl_stmt|,
name|y2
decl_stmt|;
name|drawable
operator|=
name|NULL
expr_stmt|;
name|levels
operator|=
literal|0
expr_stmt|;
comment|/*  the drawable  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|drawable
operator|=
name|gimp_drawable_get_ID
argument_list|(
name|int_value
argument_list|)
expr_stmt|;
if|if
condition|(
name|drawable
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
else|else
name|gimage
operator|=
name|gimp_drawable_gimage
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
block|}
comment|/*  make sure the drawable is not indexed color  */
if|if
condition|(
name|success
condition|)
name|success
operator|=
operator|!
name|gimp_drawable_indexed
argument_list|(
name|drawable
argument_list|)
expr_stmt|;
comment|/*  levels  */
if|if
condition|(
name|success
condition|)
block|{
name|int_value
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|int_value
operator|>=
literal|2
operator|&&
name|int_value
operator|<
literal|256
condition|)
name|levels
operator|=
name|int_value
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
comment|/*  arrange to modify the levels  */
if|if
condition|(
name|success
condition|)
block|{
name|GimpLut
modifier|*
name|lut
decl_stmt|;
name|lut
operator|=
name|posterize_lut_new
argument_list|(
name|levels
argument_list|,
name|gimp_drawable_bytes
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
comment|/*  The application should occur only within selection bounds  */
name|gimp_drawable_mask_bounds
argument_list|(
name|drawable
argument_list|,
operator|&
name|x1
argument_list|,
operator|&
name|y1
argument_list|,
operator|&
name|x2
argument_list|,
operator|&
name|y2
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|srcPR
argument_list|,
name|gimp_drawable_data
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|pixel_region_init
argument_list|(
operator|&
name|destPR
argument_list|,
name|gimp_drawable_shadow
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|pixel_regions_process_parallel
argument_list|(
operator|(
name|p_func
operator|)
name|gimp_lut_process
argument_list|,
name|lut
argument_list|,
literal|2
argument_list|,
operator|&
name|srcPR
argument_list|,
operator|&
name|destPR
argument_list|)
expr_stmt|;
name|gimp_lut_free
argument_list|(
name|lut
argument_list|)
expr_stmt|;
name|gimp_drawable_merge_shadow
argument_list|(
name|drawable
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|drawable_update
argument_list|(
name|drawable
argument_list|,
name|x1
argument_list|,
name|y1
argument_list|,
operator|(
name|x2
operator|-
name|x1
operator|)
argument_list|,
operator|(
name|y2
operator|-
name|y1
operator|)
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|posterize_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

end_unit

