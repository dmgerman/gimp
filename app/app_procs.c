begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|<signal.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"app_procs.h"
end_include

begin_include
include|#
directive|include
file|"batch.h"
end_include

begin_include
include|#
directive|include
file|"brushes.h"
end_include

begin_include
include|#
directive|include
file|"color_transfer.h"
end_include

begin_include
include|#
directive|include
file|"curves.h"
end_include

begin_include
include|#
directive|include
file|"devices.h"
end_include

begin_include
include|#
directive|include
file|"gdisplay.h"
end_include

begin_include
include|#
directive|include
file|"colormaps.h"
end_include

begin_include
include|#
directive|include
file|"fileops.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"global_edit.h"
end_include

begin_include
include|#
directive|include
file|"gradient.h"
end_include

begin_include
include|#
directive|include
file|"gximage.h"
end_include

begin_include
include|#
directive|include
file|"hue_saturation.h"
end_include

begin_include
include|#
directive|include
file|"image_render.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"internal_procs.h"
end_include

begin_include
include|#
directive|include
file|"layers_dialog.h"
end_include

begin_include
include|#
directive|include
file|"levels.h"
end_include

begin_include
include|#
directive|include
file|"menus.h"
end_include

begin_include
include|#
directive|include
file|"paint_funcs.h"
end_include

begin_include
include|#
directive|include
file|"palette.h"
end_include

begin_include
include|#
directive|include
file|"patterns.h"
end_include

begin_include
include|#
directive|include
file|"plug_in.h"
end_include

begin_include
include|#
directive|include
file|"procedural_db.h"
end_include

begin_include
include|#
directive|include
file|"session.h"
end_include

begin_include
include|#
directive|include
file|"temp_buf.h"
end_include

begin_include
include|#
directive|include
file|"tile_swap.h"
end_include

begin_include
include|#
directive|include
file|"tips_dialog.h"
end_include

begin_include
include|#
directive|include
file|"tools.h"
end_include

begin_include
include|#
directive|include
file|"undo.h"
end_include

begin_include
include|#
directive|include
file|"xcf.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_define
DECL|macro|LOGO_WIDTH_MIN
define|#
directive|define
name|LOGO_WIDTH_MIN
value|350
end_define

begin_define
DECL|macro|LOGO_HEIGHT_MIN
define|#
directive|define
name|LOGO_HEIGHT_MIN
value|110
end_define

begin_define
DECL|macro|NAME
define|#
directive|define
name|NAME
value|"The GIMP"
end_define

begin_define
DECL|macro|BROUGHT
define|#
directive|define
name|BROUGHT
value|"brought to you by"
end_define

begin_define
DECL|macro|AUTHORS
define|#
directive|define
name|AUTHORS
value|"Spencer Kimball and Peter Mattis"
end_define

begin_define
DECL|macro|SHOW_NEVER
define|#
directive|define
name|SHOW_NEVER
value|0
end_define

begin_define
DECL|macro|SHOW_LATER
define|#
directive|define
name|SHOW_LATER
value|1
end_define

begin_define
DECL|macro|SHOW_NOW
define|#
directive|define
name|SHOW_NOW
value|2
end_define

begin_comment
comment|/*  Function prototype for affirmation dialog when exiting application  */
end_comment

begin_function_decl
specifier|static
name|void
name|really_quit_dialog
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|quit_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|make_initialization_status_window
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|destroy_initialization_status_window
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|splash_logo_load
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|splash_logo_load_size
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|splash_logo_draw
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|splash_text_draw
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|splash_logo_expose
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|is_app_exit_finish_done
specifier|static
name|gint
name|is_app_exit_finish_done
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|quit_args
specifier|static
name|ProcArg
name|quit_args
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"kill"
block|,
literal|"Flag specifying whether to kill the gimp process or exit normally"
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|quit_proc
specifier|static
name|ProcRecord
name|quit_proc
init|=
block|{
literal|"gimp_quit"
block|,
literal|"Causes the gimp to exit gracefully"
block|,
literal|"The internal procedure which can either be used to make the gimp quit normally, or to have the gimp clean up its resources and exit immediately. The normaly shutdown process allows for querying the user to save any dirty images."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|PDB_INTERNAL
block|,
literal|1
block|,
name|quit_args
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|quit_invoker
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|gimp_init (int gimp_argc,char ** gimp_argv)
name|gimp_init
parameter_list|(
name|int
name|gimp_argc
parameter_list|,
name|char
modifier|*
modifier|*
name|gimp_argv
parameter_list|)
block|{
comment|/* Initialize the application */
name|app_init
argument_list|()
expr_stmt|;
comment|/* Parse the rest of the command line arguments as images to load */
if|if
condition|(
name|gimp_argc
operator|>
literal|0
condition|)
while|while
condition|(
name|gimp_argc
operator|--
condition|)
block|{
if|if
condition|(
operator|*
name|gimp_argv
condition|)
name|file_open
argument_list|(
operator|*
name|gimp_argv
argument_list|,
operator|*
name|gimp_argv
argument_list|)
expr_stmt|;
name|gimp_argv
operator|++
expr_stmt|;
block|}
name|batch_init
argument_list|()
expr_stmt|;
comment|/* Handle showing dialogs with gdk_quit_adds here  */
if|if
condition|(
operator|!
name|no_interface
operator|&&
name|show_tips
condition|)
name|tips_dialog_create
argument_list|()
expr_stmt|;
block|}
end_function

begin_decl_stmt
DECL|variable|logo_area
specifier|static
name|GtkWidget
modifier|*
name|logo_area
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|logo_pixmap
specifier|static
name|GdkPixmap
modifier|*
name|logo_pixmap
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|logo_width
specifier|static
name|int
name|logo_width
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|logo_height
specifier|static
name|int
name|logo_height
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|logo_area_width
specifier|static
name|int
name|logo_area_width
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|logo_area_height
specifier|static
name|int
name|logo_area_height
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|show_logo
specifier|static
name|int
name|show_logo
init|=
name|SHOW_NEVER
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|max_label_length
specifier|static
name|int
name|max_label_length
init|=
name|MAXPATHLEN
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|int
DECL|function|splash_logo_load_size (GtkWidget * window)
name|splash_logo_load_size
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|)
block|{
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
if|if
condition|(
name|logo_pixmap
condition|)
return|return
name|TRUE
return|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s/gimp_splash.ppm"
argument_list|,
name|DATADIR
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|buf
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
return|return
literal|0
return|;
name|fgets
argument_list|(
name|buf
argument_list|,
literal|1024
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"P6\n"
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|fgets
argument_list|(
name|buf
argument_list|,
literal|1024
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|buf
argument_list|,
literal|1024
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|sscanf
argument_list|(
name|buf
argument_list|,
literal|"%d %d"
argument_list|,
operator|&
name|logo_width
argument_list|,
operator|&
name|logo_height
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|splash_logo_load (GtkWidget * window)
name|splash_logo_load
parameter_list|(
name|GtkWidget
modifier|*
name|window
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|preview
decl_stmt|;
name|GdkGC
modifier|*
name|gc
decl_stmt|;
name|char
name|buf
index|[
literal|1024
index|]
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pixelrow
decl_stmt|;
name|FILE
modifier|*
name|fp
decl_stmt|;
name|int
name|count
decl_stmt|;
name|int
name|i
decl_stmt|;
if|if
condition|(
name|logo_pixmap
condition|)
return|return
name|TRUE
return|;
name|sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s/gimp_splash.ppm"
argument_list|,
name|DATADIR
argument_list|)
expr_stmt|;
name|fp
operator|=
name|fopen
argument_list|(
name|buf
argument_list|,
literal|"r"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|fp
condition|)
return|return
literal|0
return|;
name|fgets
argument_list|(
name|buf
argument_list|,
literal|1024
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"P6\n"
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|fgets
argument_list|(
name|buf
argument_list|,
literal|1024
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|buf
argument_list|,
literal|1024
argument_list|,
name|fp
argument_list|)
expr_stmt|;
name|sscanf
argument_list|(
name|buf
argument_list|,
literal|"%d %d"
argument_list|,
operator|&
name|logo_width
argument_list|,
operator|&
name|logo_height
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|buf
argument_list|,
literal|1024
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|buf
argument_list|,
literal|"255\n"
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
argument_list|)
argument_list|,
name|logo_width
argument_list|,
name|logo_height
argument_list|)
expr_stmt|;
name|pixelrow
operator|=
name|g_new
argument_list|(
name|guchar
argument_list|,
name|logo_width
operator|*
literal|3
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|logo_height
condition|;
name|i
operator|++
control|)
block|{
name|count
operator|=
name|fread
argument_list|(
name|pixelrow
argument_list|,
expr|sizeof
operator|(
name|unsigned
name|char
operator|)
argument_list|,
name|logo_width
operator|*
literal|3
argument_list|,
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|count
operator|!=
operator|(
name|logo_width
operator|*
literal|3
operator|)
condition|)
block|{
name|gtk_widget_destroy
argument_list|(
name|preview
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pixelrow
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
argument_list|)
argument_list|,
name|pixelrow
argument_list|,
literal|0
argument_list|,
name|i
argument_list|,
name|logo_width
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_realize
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|logo_pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|window
operator|->
name|window
argument_list|,
name|logo_width
argument_list|,
name|logo_height
argument_list|,
name|gtk_preview_get_visual
argument_list|()
operator|->
name|depth
argument_list|)
expr_stmt|;
name|gc
operator|=
name|gdk_gc_new
argument_list|(
name|logo_pixmap
argument_list|)
expr_stmt|;
name|gtk_preview_put
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|preview
argument_list|)
argument_list|,
name|logo_pixmap
argument_list|,
name|gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|logo_width
argument_list|,
name|logo_height
argument_list|)
expr_stmt|;
name|gdk_gc_destroy
argument_list|(
name|gc
argument_list|)
expr_stmt|;
name|gtk_widget_unref
argument_list|(
name|preview
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pixelrow
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|splash_text_draw (GtkWidget * widget)
name|splash_text_draw
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GdkFont
modifier|*
name|font
init|=
name|NULL
decl_stmt|;
name|font
operator|=
name|gdk_font_load
argument_list|(
literal|"-Adobe-Helvetica-Bold-R-Normal--*-140-*-*-*-*-*-*"
argument_list|)
expr_stmt|;
name|gdk_draw_string
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|font
argument_list|,
name|widget
operator|->
name|style
operator|->
name|fg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|(
operator|(
name|logo_area_width
operator|-
name|gdk_string_width
argument_list|(
name|font
argument_list|,
name|NAME
argument_list|)
operator|)
operator|/
literal|2
operator|)
argument_list|,
operator|(
literal|0.25
operator|*
name|logo_area_height
operator|)
argument_list|,
name|NAME
argument_list|)
expr_stmt|;
name|font
operator|=
name|gdk_font_load
argument_list|(
literal|"-Adobe-Helvetica-Bold-R-Normal--*-120-*-*-*-*-*-*"
argument_list|)
expr_stmt|;
name|gdk_draw_string
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|font
argument_list|,
name|widget
operator|->
name|style
operator|->
name|fg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|(
operator|(
name|logo_area_width
operator|-
name|gdk_string_width
argument_list|(
name|font
argument_list|,
name|GIMP_VERSION
argument_list|)
operator|)
operator|/
literal|2
operator|)
argument_list|,
operator|(
literal|0.45
operator|*
name|logo_area_height
operator|)
argument_list|,
name|GIMP_VERSION
argument_list|)
expr_stmt|;
name|gdk_draw_string
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|font
argument_list|,
name|widget
operator|->
name|style
operator|->
name|fg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|(
operator|(
name|logo_area_width
operator|-
name|gdk_string_width
argument_list|(
name|font
argument_list|,
name|BROUGHT
argument_list|)
operator|)
operator|/
literal|2
operator|)
argument_list|,
operator|(
literal|0.65
operator|*
name|logo_area_height
operator|)
argument_list|,
name|BROUGHT
argument_list|)
expr_stmt|;
name|gdk_draw_string
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|font
argument_list|,
name|widget
operator|->
name|style
operator|->
name|fg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
operator|(
operator|(
name|logo_area_width
operator|-
name|gdk_string_width
argument_list|(
name|font
argument_list|,
name|AUTHORS
argument_list|)
operator|)
operator|/
literal|2
operator|)
argument_list|,
operator|(
literal|0.80
operator|*
name|logo_area_height
operator|)
argument_list|,
name|AUTHORS
argument_list|)
expr_stmt|;
comment|/*      *  This is a hack: we try to compute a good guess for the maximum number    *  of charcters that will fit into the splash-screen using the given font     */
name|max_label_length
operator|=
operator|(
name|float
operator|)
name|strlen
argument_list|(
name|AUTHORS
argument_list|)
operator|*
operator|(
operator|(
name|float
operator|)
name|logo_area_width
operator|/
operator|(
name|float
operator|)
name|gdk_string_width
argument_list|(
name|font
argument_list|,
name|AUTHORS
argument_list|)
operator|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|splash_logo_draw (GtkWidget * widget)
name|splash_logo_draw
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|gdk_draw_pixmap
argument_list|(
name|widget
operator|->
name|window
argument_list|,
name|widget
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|logo_pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|(
operator|(
name|logo_area_width
operator|-
name|logo_width
operator|)
operator|/
literal|2
operator|)
argument_list|,
operator|(
operator|(
name|logo_area_height
operator|-
name|logo_height
operator|)
operator|/
literal|2
operator|)
argument_list|,
name|logo_width
argument_list|,
name|logo_height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|splash_logo_expose (GtkWidget * widget)
name|splash_logo_expose
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
switch|switch
condition|(
name|show_logo
condition|)
block|{
case|case
name|SHOW_NEVER
case|:
case|case
name|SHOW_LATER
case|:
name|splash_text_draw
argument_list|(
name|widget
argument_list|)
expr_stmt|;
break|break;
case|case
name|SHOW_NOW
case|:
name|splash_logo_draw
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_decl_stmt
DECL|variable|win_initstatus
specifier|static
name|GtkWidget
modifier|*
name|win_initstatus
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|label1
specifier|static
name|GtkWidget
modifier|*
name|label1
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|label2
specifier|static
name|GtkWidget
modifier|*
name|label2
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pbar
specifier|static
name|GtkWidget
modifier|*
name|pbar
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|idle_tag
specifier|static
name|gint
name|idle_tag
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|destroy_initialization_status_window (void)
name|destroy_initialization_status_window
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|win_initstatus
condition|)
block|{
name|gtk_widget_destroy
argument_list|(
name|win_initstatus
argument_list|)
expr_stmt|;
if|if
condition|(
name|logo_pixmap
operator|!=
name|NULL
condition|)
name|gdk_pixmap_unref
argument_list|(
name|logo_pixmap
argument_list|)
expr_stmt|;
name|win_initstatus
operator|=
name|label1
operator|=
name|label2
operator|=
name|pbar
operator|=
name|logo_area
operator|=
name|NULL
expr_stmt|;
name|logo_pixmap
operator|=
name|NULL
expr_stmt|;
name|gtk_idle_remove
argument_list|(
name|idle_tag
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|make_initialization_status_window (void)
name|make_initialization_status_window
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|no_interface
operator|==
name|FALSE
condition|)
block|{
if|if
condition|(
name|no_splash
operator|==
name|FALSE
condition|)
block|{
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|win_initstatus
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_DIALOG
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|win_initstatus
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|gtk_true
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|win_initstatus
argument_list|)
argument_list|,
literal|"gimp_startup"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|win_initstatus
argument_list|)
argument_list|,
literal|"GIMP Startup"
argument_list|)
expr_stmt|;
if|if
condition|(
name|no_splash_image
operator|==
name|FALSE
operator|&&
name|splash_logo_load_size
argument_list|(
name|win_initstatus
argument_list|)
condition|)
block|{
name|show_logo
operator|=
name|SHOW_LATER
expr_stmt|;
block|}
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|win_initstatus
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_push_visual
argument_list|(
name|gtk_preview_get_visual
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_widget_push_colormap
argument_list|(
name|gtk_preview_get_cmap
argument_list|()
argument_list|)
expr_stmt|;
name|logo_area
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_widget_pop_colormap
argument_list|()
expr_stmt|;
name|gtk_widget_pop_visual
argument_list|()
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|logo_area
argument_list|)
argument_list|,
literal|"expose_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|splash_logo_expose
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|logo_area_width
operator|=
operator|(
name|logo_width
operator|>
name|LOGO_WIDTH_MIN
operator|)
condition|?
name|logo_width
else|:
name|LOGO_WIDTH_MIN
expr_stmt|;
name|logo_area_height
operator|=
operator|(
name|logo_height
operator|>
name|LOGO_HEIGHT_MIN
operator|)
condition|?
name|logo_height
else|:
name|LOGO_HEIGHT_MIN
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|logo_area
argument_list|)
argument_list|,
name|logo_area_width
argument_list|,
name|logo_area_height
argument_list|)
expr_stmt|;
name|gtk_box_pack_start_defaults
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|logo_area
argument_list|)
expr_stmt|;
name|label1
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_box_pack_start_defaults
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label1
argument_list|)
expr_stmt|;
name|label2
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_box_pack_start_defaults
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label2
argument_list|)
expr_stmt|;
name|pbar
operator|=
name|gtk_progress_bar_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start_defaults
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|pbar
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|logo_area
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|pbar
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|win_initstatus
argument_list|)
argument_list|,
name|GTK_WIN_POS_CENTER
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|win_initstatus
argument_list|)
expr_stmt|;
name|gtk_window_set_policy
argument_list|(
name|GTK_WINDOW
argument_list|(
name|win_initstatus
argument_list|)
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
name|void
DECL|function|app_init_update_status (char * label1val,char * label2val,float pct_progress)
name|app_init_update_status
parameter_list|(
name|char
modifier|*
name|label1val
parameter_list|,
name|char
modifier|*
name|label2val
parameter_list|,
name|float
name|pct_progress
parameter_list|)
block|{
name|char
modifier|*
name|temp
decl_stmt|;
if|if
condition|(
name|no_interface
operator|==
name|FALSE
operator|&&
name|no_splash
operator|==
name|FALSE
operator|&&
name|win_initstatus
condition|)
block|{
name|GdkRectangle
name|area
init|=
block|{
literal|0
block|,
literal|0
block|,
operator|-
literal|1
block|,
operator|-
literal|1
block|}
decl_stmt|;
if|if
condition|(
name|label1val
operator|&&
name|strcmp
argument_list|(
name|label1val
argument_list|,
name|GTK_LABEL
argument_list|(
name|label1
argument_list|)
operator|->
name|label
argument_list|)
condition|)
block|{
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|label1
argument_list|)
argument_list|,
name|label1val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|label2val
operator|&&
name|strcmp
argument_list|(
name|label2val
argument_list|,
name|GTK_LABEL
argument_list|(
name|label2
argument_list|)
operator|->
name|label
argument_list|)
condition|)
block|{
while|while
condition|(
name|strlen
argument_list|(
name|label2val
argument_list|)
operator|>
name|max_label_length
condition|)
block|{
name|temp
operator|=
name|strchr
argument_list|(
name|label2val
argument_list|,
literal|'/'
argument_list|)
expr_stmt|;
if|if
condition|(
name|temp
operator|==
name|NULL
condition|)
comment|/* for sanity */
break|break;
name|temp
operator|++
expr_stmt|;
name|label2val
operator|=
name|temp
expr_stmt|;
block|}
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|label2
argument_list|)
argument_list|,
name|label2val
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pct_progress
operator|>=
literal|0
operator|&&
name|GTK_PROGRESS_BAR
argument_list|(
name|pbar
argument_list|)
operator|->
name|percentage
operator|!=
name|pct_progress
condition|)
block|{
name|gtk_progress_bar_update
argument_list|(
name|GTK_PROGRESS_BAR
argument_list|(
name|pbar
argument_list|)
argument_list|,
name|pct_progress
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_draw
argument_list|(
name|win_initstatus
argument_list|,
operator|&
name|area
argument_list|)
expr_stmt|;
name|idle_tag
operator|=
name|gtk_idle_add
argument_list|(
operator|(
name|GtkFunction
operator|)
name|gtk_true
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_main_iteration
argument_list|()
expr_stmt|;
name|gtk_idle_remove
argument_list|(
name|idle_tag
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* #define RESET_BAR() app_init_update_status("", "", 0) */
end_comment

begin_define
DECL|macro|RESET_BAR ()
define|#
directive|define
name|RESET_BAR
parameter_list|()
end_define

begin_function
name|void
DECL|function|app_init (void)
name|app_init
parameter_list|(
name|void
parameter_list|)
block|{
name|char
name|filename
index|[
name|MAXPATHLEN
index|]
decl_stmt|;
name|char
modifier|*
name|gimp_dir
decl_stmt|;
name|char
modifier|*
name|path
decl_stmt|;
name|gimp_dir
operator|=
name|gimp_directory
argument_list|()
expr_stmt|;
if|if
condition|(
name|gimp_dir
index|[
literal|0
index|]
operator|!=
literal|'\000'
condition|)
block|{
name|sprintf
argument_list|(
name|filename
argument_list|,
literal|"%s/gtkrc"
argument_list|,
name|gimp_dir
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|be_verbose
operator|==
name|TRUE
operator|)
operator|||
operator|(
name|no_splash
operator|==
name|TRUE
operator|)
condition|)
name|g_print
argument_list|(
literal|"parsing \"%s\"\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|gtk_rc_parse
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
name|make_initialization_status_window
argument_list|()
expr_stmt|;
if|if
condition|(
name|no_interface
operator|==
name|FALSE
operator|&&
name|no_splash
operator|==
name|FALSE
operator|&&
name|win_initstatus
condition|)
block|{
name|splash_text_draw
argument_list|(
name|logo_area
argument_list|)
expr_stmt|;
block|}
comment|/*    *  Initialize the procedural database    *    We need to do this first because any of the init    *    procedures might install or query it as needed.    */
name|procedural_db_init
argument_list|()
expr_stmt|;
name|RESET_BAR
argument_list|()
expr_stmt|;
name|internal_procs_init
argument_list|()
expr_stmt|;
name|RESET_BAR
argument_list|()
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|quit_proc
argument_list|)
expr_stmt|;
name|RESET_BAR
argument_list|()
expr_stmt|;
name|parse_gimprc
argument_list|()
expr_stmt|;
comment|/*  parse the local GIMP configuration file  */
comment|/* Now we are ready to draw the splash-screen-image to the start-up window */
if|if
condition|(
name|no_interface
operator|==
name|FALSE
condition|)
block|{
if|if
condition|(
name|no_splash_image
operator|==
name|FALSE
operator|&&
name|show_logo
operator|&&
name|splash_logo_load
argument_list|(
name|win_initstatus
argument_list|)
condition|)
block|{
name|show_logo
operator|=
name|SHOW_NOW
expr_stmt|;
name|splash_logo_draw
argument_list|(
name|logo_area
argument_list|)
expr_stmt|;
block|}
block|}
name|RESET_BAR
argument_list|()
expr_stmt|;
name|file_ops_pre_init
argument_list|()
expr_stmt|;
comment|/*  pre-initialize the file types  */
name|RESET_BAR
argument_list|()
expr_stmt|;
name|xcf_init
argument_list|()
expr_stmt|;
comment|/*  initialize the xcf file format routines */
name|app_init_update_status
argument_list|(
literal|"Looking for data files"
argument_list|,
literal|"Brushes"
argument_list|,
literal|0.00
argument_list|)
expr_stmt|;
name|brushes_init
argument_list|(
name|no_data
argument_list|)
expr_stmt|;
comment|/*  initialize the list of gimp brushes  */
name|app_init_update_status
argument_list|(
name|NULL
argument_list|,
literal|"Patterns"
argument_list|,
literal|0.25
argument_list|)
expr_stmt|;
name|patterns_init
argument_list|(
name|no_data
argument_list|)
expr_stmt|;
comment|/*  initialize the list of gimp patterns  */
name|app_init_update_status
argument_list|(
name|NULL
argument_list|,
literal|"Palettes"
argument_list|,
literal|0.50
argument_list|)
expr_stmt|;
name|palettes_init
argument_list|(
name|no_data
argument_list|)
expr_stmt|;
comment|/*  initialize the list of gimp palettes  */
name|app_init_update_status
argument_list|(
name|NULL
argument_list|,
literal|"Gradients"
argument_list|,
literal|0.75
argument_list|)
expr_stmt|;
name|gradients_init
argument_list|(
name|no_data
argument_list|)
expr_stmt|;
comment|/*  initialize the list of gimp gradients  */
name|app_init_update_status
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|1.00
argument_list|)
expr_stmt|;
name|plug_in_init
argument_list|()
expr_stmt|;
comment|/*  initialize the plug in structures  */
name|RESET_BAR
argument_list|()
expr_stmt|;
name|file_ops_post_init
argument_list|()
expr_stmt|;
comment|/*  post-initialize the file types  */
comment|/* Add the swap file  */
if|if
condition|(
name|swap_path
operator|==
name|NULL
condition|)
name|swap_path
operator|=
literal|"/tmp"
expr_stmt|;
name|path
operator|=
name|g_new
argument_list|(
name|gchar
argument_list|,
name|strlen
argument_list|(
name|swap_path
argument_list|)
operator|+
literal|32
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|path
argument_list|,
literal|"%s/gimpswap.%ld"
argument_list|,
name|swap_path
argument_list|,
operator|(
name|long
operator|)
name|getpid
argument_list|()
argument_list|)
expr_stmt|;
name|tile_swap_add
argument_list|(
name|path
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|destroy_initialization_status_window
argument_list|()
expr_stmt|;
comment|/*  Things to do only if there is an interface  */
if|if
condition|(
name|no_interface
operator|==
name|FALSE
condition|)
block|{
name|get_standard_colormaps
argument_list|()
expr_stmt|;
name|devices_init
argument_list|()
expr_stmt|;
name|session_init
argument_list|()
expr_stmt|;
name|create_toolbox
argument_list|()
expr_stmt|;
name|gximage_init
argument_list|()
expr_stmt|;
name|render_setup
argument_list|(
name|transparency_type
argument_list|,
name|transparency_size
argument_list|)
expr_stmt|;
name|tools_options_dialog_new
argument_list|()
expr_stmt|;
name|tools_select
argument_list|(
name|RECT_SELECT
argument_list|)
expr_stmt|;
name|message_handler
operator|=
name|MESSAGE_BOX
expr_stmt|;
block|}
name|color_transfer_init
argument_list|()
expr_stmt|;
name|get_active_brush
argument_list|()
expr_stmt|;
name|get_active_pattern
argument_list|()
expr_stmt|;
name|paint_funcs_setup
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|int
DECL|function|app_exit_finish_done (void)
name|app_exit_finish_done
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|is_app_exit_finish_done
return|;
block|}
end_function

begin_function
name|void
DECL|function|app_exit_finish (void)
name|app_exit_finish
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|app_exit_finish_done
argument_list|()
condition|)
return|return;
name|is_app_exit_finish_done
operator|=
name|TRUE
expr_stmt|;
name|message_handler
operator|=
name|CONSOLE
expr_stmt|;
name|lc_dialog_free
argument_list|()
expr_stmt|;
name|gdisplays_delete
argument_list|()
expr_stmt|;
name|global_edit_free
argument_list|()
expr_stmt|;
name|named_buffers_free
argument_list|()
expr_stmt|;
name|swapping_free
argument_list|()
expr_stmt|;
name|brushes_free
argument_list|()
expr_stmt|;
name|patterns_free
argument_list|()
expr_stmt|;
name|palettes_free
argument_list|()
expr_stmt|;
name|gradients_free
argument_list|()
expr_stmt|;
name|grad_free_gradient_editor
argument_list|()
expr_stmt|;
name|hue_saturation_free
argument_list|()
expr_stmt|;
name|curves_free
argument_list|()
expr_stmt|;
name|levels_free
argument_list|()
expr_stmt|;
name|brush_select_dialog_free
argument_list|()
expr_stmt|;
name|pattern_select_dialog_free
argument_list|()
expr_stmt|;
name|palette_free
argument_list|()
expr_stmt|;
name|paint_funcs_free
argument_list|()
expr_stmt|;
name|procedural_db_free
argument_list|()
expr_stmt|;
name|plug_in_kill
argument_list|()
expr_stmt|;
name|menus_quit
argument_list|()
expr_stmt|;
name|tile_swap_exit
argument_list|()
expr_stmt|;
comment|/*  Things to do only if there is an interface  */
if|if
condition|(
name|no_interface
operator|==
name|FALSE
condition|)
block|{
name|gximage_free
argument_list|()
expr_stmt|;
name|render_free
argument_list|()
expr_stmt|;
name|tools_options_dialog_free
argument_list|()
expr_stmt|;
name|save_sessionrc
argument_list|()
expr_stmt|;
block|}
comment|/*  gtk_exit (0); */
name|gtk_main_quit
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|app_exit (int kill_it)
name|app_exit
parameter_list|(
name|int
name|kill_it
parameter_list|)
block|{
comment|/*  If it's the user's perogative, and there are dirty images  */
if|if
condition|(
name|kill_it
operator|==
literal|0
operator|&&
name|gdisplays_dirty
argument_list|()
operator|&&
name|no_interface
operator|==
name|FALSE
condition|)
name|really_quit_dialog
argument_list|()
expr_stmt|;
elseif|else
if|if
condition|(
name|no_interface
operator|==
name|FALSE
condition|)
name|toolbox_free
argument_list|()
expr_stmt|;
else|else
name|app_exit_finish
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/********************************************************  *   Routines to query exiting the application          *  ********************************************************/
end_comment

begin_function
specifier|static
name|void
DECL|function|really_quit_callback (GtkButton * button,GtkWidget * dialog)
name|really_quit_callback
parameter_list|(
name|GtkButton
modifier|*
name|button
parameter_list|,
name|GtkWidget
modifier|*
name|dialog
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|toolbox_free
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_quit_cancel_callback (GtkWidget * widget,GtkWidget * dialog)
name|really_quit_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkWidget
modifier|*
name|dialog
parameter_list|)
block|{
name|menus_set_sensitive
argument_list|(
literal|"<Toolbox>/File/Quit"
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|menus_set_sensitive
argument_list|(
literal|"<Image>/File/Quit"
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|really_quit_delete_callback (GtkWidget * widget,GdkEvent * event,gpointer client_data)
name|really_quit_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|really_quit_cancel_callback
argument_list|(
name|widget
argument_list|,
operator|(
name|GtkWidget
operator|*
operator|)
name|client_data
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|really_quit_dialog ()
name|really_quit_dialog
parameter_list|()
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|menus_set_sensitive
argument_list|(
literal|"<Toolbox>/File/Quit"
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|menus_set_sensitive
argument_list|(
literal|"<Image>/File/Quit"
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|dialog
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"really_quit"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"Really Quit?"
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|really_quit_delete_callback
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"Yes"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|really_quit_callback
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"No"
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|really_quit_cancel_callback
argument_list|,
name|dialog
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
literal|"Some files unsaved.  Quit the GIMP?"
argument_list|)
expr_stmt|;
name|gtk_misc_set_padding
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|quit_invoker (Argument * args)
name|quit_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|int
name|kill_it
decl_stmt|;
name|kill_it
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|app_exit
argument_list|(
name|kill_it
argument_list|)
expr_stmt|;
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|quit_proc
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|return_args
return|;
block|}
end_function

end_unit

