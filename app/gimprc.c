begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_UNISTD_H
end_ifdef

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<sys/types.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_PARAM_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/param.h>
end_include

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimputils.h"
end_include

begin_include
include|#
directive|include
file|"libgimpcolor/gimpcolor.h"
end_include

begin_include
include|#
directive|include
file|"core/core-types.h"
end_include

begin_include
include|#
directive|include
file|"tools/tools-types.h"
end_include

begin_include
include|#
directive|include
file|"widgets/widgets-types.h"
end_include

begin_include
include|#
directive|include
file|"base/base-config.c"
end_include

begin_include
include|#
directive|include
file|"core/gimp.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpcoreconfig.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpimagefile.h"
end_include

begin_include
include|#
directive|include
file|"core/gimplist.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpparasite.h"
end_include

begin_include
include|#
directive|include
file|"core/gimptoolinfo.h"
end_include

begin_include
include|#
directive|include
file|"tools/gimptool.h"
end_include

begin_include
include|#
directive|include
file|"widgets/gimpdialogfactory.h"
end_include

begin_include
include|#
directive|include
file|"gui/color-notebook.h"
end_include

begin_include
include|#
directive|include
file|"gui/menus.h"
end_include

begin_include
include|#
directive|include
file|"app_procs.h"
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"devices.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"gimphelp.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"plug_in.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_define
DECL|macro|ERROR
define|#
directive|define
name|ERROR
value|0
end_define

begin_define
DECL|macro|DONE
define|#
directive|define
name|DONE
value|1
end_define

begin_define
DECL|macro|OK
define|#
directive|define
name|OK
value|2
end_define

begin_define
DECL|macro|LOCALE_DEF
define|#
directive|define
name|LOCALE_DEF
value|3
end_define

begin_define
DECL|macro|HELP_DEF
define|#
directive|define
name|HELP_DEF
value|4
end_define

begin_define
DECL|macro|DEFAULT_IMAGE_TITLE_FORMAT
define|#
directive|define
name|DEFAULT_IMAGE_TITLE_FORMAT
value|"%f-%p.%i (%t)"
end_define

begin_define
DECL|macro|DEFAULT_COMMENT
define|#
directive|define
name|DEFAULT_COMMENT
value|"Created with The GIMP"
end_define

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon274731300103
block|{
DECL|enumerator|TT_STRING
name|TT_STRING
block|,
DECL|enumerator|TT_PATH
name|TT_PATH
block|,
DECL|enumerator|TT_DOUBLE
name|TT_DOUBLE
block|,
DECL|enumerator|TT_FLOAT
name|TT_FLOAT
block|,
DECL|enumerator|TT_INT
name|TT_INT
block|,
DECL|enumerator|TT_BOOLEAN
name|TT_BOOLEAN
block|,
DECL|enumerator|TT_POSITION
name|TT_POSITION
block|,
DECL|enumerator|TT_MEMSIZE
name|TT_MEMSIZE
block|,
DECL|enumerator|TT_IMAGETYPE
name|TT_IMAGETYPE
block|,
DECL|enumerator|TT_INTERP
name|TT_INTERP
block|,
DECL|enumerator|TT_XPREVSIZE
name|TT_XPREVSIZE
block|,
DECL|enumerator|TT_XUNIT
name|TT_XUNIT
block|,
DECL|enumerator|TT_XPLUGIN
name|TT_XPLUGIN
block|,
DECL|enumerator|TT_XPLUGINDEF
name|TT_XPLUGINDEF
block|,
DECL|enumerator|TT_XMENUPATH
name|TT_XMENUPATH
block|,
DECL|enumerator|TT_XDEVICE
name|TT_XDEVICE
block|,
DECL|enumerator|TT_XSESSIONINFO
name|TT_XSESSIONINFO
block|,
DECL|enumerator|TT_XCOLORHISTORY
name|TT_XCOLORHISTORY
block|,
DECL|enumerator|TT_XUNITINFO
name|TT_XUNITINFO
block|,
DECL|enumerator|TT_XPARASITE
name|TT_XPARASITE
block|,
DECL|enumerator|TT_XNAVPREVSIZE
name|TT_XNAVPREVSIZE
block|,
DECL|enumerator|TT_XHELPBROWSER
name|TT_XHELPBROWSER
block|,
DECL|enumerator|TT_XCURSORMODE
name|TT_XCURSORMODE
block|,
DECL|enumerator|TT_XCOMMENT
name|TT_XCOMMENT
block|,
DECL|enumerator|TT_XDOCUMENT
name|TT_XDOCUMENT
DECL|typedef|TokenType
block|}
name|TokenType
typedef|;
end_typedef

begin_typedef
DECL|typedef|ParseFunc
typedef|typedef
name|struct
name|_ParseFunc
name|ParseFunc
typedef|;
end_typedef

begin_struct
DECL|struct|_ParseFunc
struct|struct
name|_ParseFunc
block|{
DECL|member|name
name|gchar
modifier|*
name|name
decl_stmt|;
DECL|member|type
name|TokenType
name|type
decl_stmt|;
DECL|member|val1p
name|gpointer
name|val1p
decl_stmt|;
DECL|member|val2p
name|gpointer
name|val2p
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|UnknownToken
typedef|typedef
name|struct
name|_UnknownToken
name|UnknownToken
typedef|;
end_typedef

begin_struct
DECL|struct|_UnknownToken
struct|struct
name|_UnknownToken
block|{
DECL|member|token
name|gchar
modifier|*
name|token
decl_stmt|;
DECL|member|value
name|gchar
modifier|*
name|value
decl_stmt|;
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|gint
name|get_next_token
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|peek_next_token
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_statement
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_string
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_double
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_float
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_int
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_boolean
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_position
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_mem_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_image_type
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_interpolation_type
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_preview_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_nav_preview_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_units
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_plug_in
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_plug_in_def
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_device
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_menu_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_session_info
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_unit_info
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_parasite
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_help_browser
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_cursor_mode
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_color_history
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_document
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_locale_def
parameter_list|(
name|PlugInDef
modifier|*
name|plug_in_def
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_help_def
parameter_list|(
name|PlugInDef
modifier|*
name|plug_in_def
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_proc_def
parameter_list|(
name|PlugInProcDef
modifier|*
modifier|*
name|proc_def
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_proc_arg
parameter_list|(
name|ProcArg
modifier|*
name|arg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_color
parameter_list|(
name|GimpRGB
modifier|*
name|color
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|parse_unknown
parameter_list|(
name|gchar
modifier|*
name|token_sym
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
name|gchar
modifier|*
name|gimprc_value_to_str
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gchar
modifier|*
name|value_to_str
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|string_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|path_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|double_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|float_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|int_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|boolean_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|position_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|mem_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|image_type_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|interpolation_type_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|preview_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|nav_preview_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|units_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|help_browser_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|cursor_mode_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|inline
name|gchar
modifier|*
name|comment_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gchar
modifier|*
name|transform_path
parameter_list|(
name|gchar
modifier|*
name|path
parameter_list|,
name|gboolean
name|destroy
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimprc_set_token
parameter_list|(
name|gchar
modifier|*
name|token
parameter_list|,
name|gchar
modifier|*
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|add_gimp_directory_token
parameter_list|(
specifier|const
name|gchar
modifier|*
name|gimp_dir
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|__EMX__
end_ifdef

begin_function_decl
specifier|static
name|void
name|add_x11root_token
parameter_list|(
name|gchar
modifier|*
name|x11root
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_function_decl
specifier|static
name|gchar
modifier|*
name|open_backup_file
parameter_list|(
name|gchar
modifier|*
name|filename
parameter_list|,
name|gchar
modifier|*
name|secondary_filename
parameter_list|,
name|gchar
modifier|*
modifier|*
name|name_used
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_new
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_old
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  global gimprc variables  */
end_comment

begin_decl_stmt
DECL|variable|gimprc
name|GimpRc
name|gimprc
init|=
block|{
comment|/* marching_speed            */
literal|300
block|,
comment|/* 300 ms */
comment|/* last_opened_size          */
literal|4
block|,
comment|/* gamma_val                 */
literal|1.0
block|,
comment|/* transparency_type         */
literal|1
block|,
comment|/* Mid-Tone Checks */
comment|/* perfectmouse              */
name|FALSE
block|,
comment|/* off (fast and sloppy) */
comment|/* transparency_size         */
literal|1
block|,
comment|/* Medium sized */
comment|/* min_colors                */
literal|144
block|,
comment|/* 6*6*4 */
comment|/* install_cmap              */
name|FALSE
block|,
comment|/* cycled_marching_ants      */
literal|0
block|,
comment|/* default_threshold         */
literal|15
block|,
comment|/* allow_resize_windows      */
name|FALSE
block|,
comment|/* no_cursor_updating        */
name|FALSE
block|,
comment|/* preview_size              */
literal|32
block|,
comment|/* nav_preview_size          */
literal|112
block|,
comment|/* show_rulers               */
name|TRUE
block|,
comment|/* show_statusbar            */
name|TRUE
block|,
comment|/* auto_save                 */
name|TRUE
block|,
comment|/* confirm_on_close          */
name|TRUE
block|,
comment|/* default_dot_for_dot       */
name|TRUE
block|,
comment|/* save_session_info         */
name|TRUE
block|,
comment|/* save_device_status        */
name|FALSE
block|,
comment|/* always_restore_session    */
name|TRUE
block|,
comment|/* show_tips                 */
name|TRUE
block|,
comment|/* last_tip                  */
operator|-
literal|1
block|,
comment|/* show_tool_tips            */
name|TRUE
block|,
comment|/* monitor_xres              */
literal|72.0
block|,
comment|/* monitor_yres              */
literal|72.0
block|,
comment|/* using_xserver_resolution  */
name|FALSE
block|,
comment|/* image_title_format        */
name|NULL
block|,
comment|/* global_paint_options      */
name|FALSE
block|,
comment|/* show_indicators           */
name|TRUE
block|,
comment|/* max_new_image_size        */
literal|33554432
block|,
comment|/* 32 MB */
comment|/* trust_dirty_flag          */
name|FALSE
block|,
comment|/* use_help                  */
name|TRUE
block|,
comment|/* nav_window_per_display    */
name|FALSE
block|,
comment|/* info_window_follows_mouse */
name|TRUE
block|,
comment|/* help_browser              */
name|HELP_BROWSER_GIMP
block|,
comment|/* cursor_mode               */
name|CURSOR_MODE_TOOL_ICON
block|,
comment|/* disable_tearoff_menus     */
name|FALSE
block|,
comment|/* theme_path                */
name|NULL
block|,
comment|/* theme                     */
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|parse_func_hash
specifier|static
name|GHashTable
modifier|*
name|parse_func_hash
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|funcs
specifier|static
name|ParseFunc
name|funcs
index|[]
init|=
block|{
block|{
literal|"gamma-correction"
block|,
name|TT_DOUBLE
block|,
operator|&
operator|(
name|gimprc
operator|.
name|gamma_val
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"marching-ants-speed"
block|,
name|TT_INT
block|,
operator|&
operator|(
name|gimprc
operator|.
name|marching_speed
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"last-opened-size"
block|,
name|TT_INT
block|,
operator|&
operator|(
name|gimprc
operator|.
name|last_opened_size
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"transparency-type"
block|,
name|TT_INT
block|,
operator|&
operator|(
name|gimprc
operator|.
name|transparency_type
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"perfect-mouse"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|perfectmouse
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"transparency-size"
block|,
name|TT_INT
block|,
operator|&
operator|(
name|gimprc
operator|.
name|transparency_size
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"min-colors"
block|,
name|TT_INT
block|,
operator|&
operator|(
name|gimprc
operator|.
name|min_colors
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"install-colormap"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|install_cmap
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"colormap-cycling"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|cycled_marching_ants
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"default-threshold"
block|,
name|TT_INT
block|,
operator|&
operator|(
name|gimprc
operator|.
name|default_threshold
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"allow-resize-windows"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|allow_resize_windows
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-allow-resize-windows"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|allow_resize_windows
operator|)
block|}
block|,
block|{
literal|"cursor-updating"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|no_cursor_updating
operator|)
block|}
block|,
block|{
literal|"no-cursor-updating"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|no_cursor_updating
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"preview-size"
block|,
name|TT_XPREVSIZE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"nav-preview-size"
block|,
name|TT_XNAVPREVSIZE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"show-rulers"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_rulers
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-rulers"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_rulers
operator|)
block|}
block|,
block|{
literal|"show-statusbar"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_statusbar
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-statusbar"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_statusbar
operator|)
block|}
block|,
block|{
literal|"auto-save"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|auto_save
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-auto-save"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|auto_save
operator|)
block|}
block|,
block|{
literal|"confirm-on-close"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|confirm_on_close
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-confirm-on-close"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|confirm_on_close
operator|)
block|}
block|,
block|{
literal|"save-session-info"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|save_session_info
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-save-session-info"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|save_session_info
operator|)
block|}
block|,
block|{
literal|"save-device-status"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|save_device_status
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-save-device-status"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|save_device_status
operator|)
block|}
block|,
block|{
literal|"always-restore-session"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|always_restore_session
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"show-tips"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_tips
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-tips"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_tips
operator|)
block|}
block|,
block|{
literal|"last-tip-shown"
block|,
name|TT_INT
block|,
operator|&
operator|(
name|gimprc
operator|.
name|last_tip
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"show-tool-tips"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_tool_tips
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-tool-tips"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_tool_tips
operator|)
block|}
block|,
block|{
literal|"default-dot-for-dot"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|default_dot_for_dot
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"monitor-xresolution"
block|,
name|TT_DOUBLE
block|,
operator|&
operator|(
name|gimprc
operator|.
name|monitor_xres
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"monitor-yresolution"
block|,
name|TT_DOUBLE
block|,
operator|&
operator|(
name|gimprc
operator|.
name|monitor_yres
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"image-title-format"
block|,
name|TT_STRING
block|,
operator|&
operator|(
name|gimprc
operator|.
name|image_title_format
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"parasite"
block|,
name|TT_XPARASITE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"global-paint-options"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|global_paint_options
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"show-indicators"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_indicators
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-indicators"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|show_indicators
operator|)
block|}
block|,
block|{
literal|"no-global-paint-options"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|global_paint_options
operator|)
block|}
block|,
block|{
literal|"max-new-image-size"
block|,
name|TT_MEMSIZE
block|,
operator|&
operator|(
name|gimprc
operator|.
name|max_new_image_size
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"trust-dirty-flag"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|trust_dirty_flag
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-trust-dirty-flag"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|trust_dirty_flag
operator|)
block|}
block|,
block|{
literal|"use-help"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|use_help
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-use-help"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|use_help
operator|)
block|}
block|,
block|{
literal|"nav-window-per-display"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|nav_window_per_display
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"nav-window-follows-auto"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|nav_window_per_display
operator|)
block|}
block|,
block|{
literal|"info-window-follows-mouse"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|info_window_follows_mouse
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"info-window-per-display"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
operator|(
name|gimprc
operator|.
name|info_window_follows_mouse
operator|)
block|}
block|,
block|{
literal|"help-browser"
block|,
name|TT_XHELPBROWSER
block|,
operator|&
operator|(
name|gimprc
operator|.
name|help_browser
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"cursor-mode"
block|,
name|TT_XCURSORMODE
block|,
operator|&
operator|(
name|gimprc
operator|.
name|cursor_mode
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"disable-tearoff-menus"
block|,
name|TT_BOOLEAN
block|,
operator|&
operator|(
name|gimprc
operator|.
name|disable_tearoff_menus
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"theme-path"
block|,
name|TT_PATH
block|,
operator|&
operator|(
name|gimprc
operator|.
name|theme_path
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"theme"
block|,
name|TT_STRING
block|,
operator|&
operator|(
name|gimprc
operator|.
name|theme
operator|)
block|,
name|NULL
block|}
block|,
block|{
literal|"plug-in"
block|,
name|TT_XPLUGIN
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"plug-in-def"
block|,
name|TT_XPLUGINDEF
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"menu-path"
block|,
name|TT_XMENUPATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"device"
block|,
name|TT_XDEVICE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"session-info"
block|,
name|TT_XSESSIONINFO
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"color-history"
block|,
name|TT_XCOLORHISTORY
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"unit-info"
block|,
name|TT_XUNITINFO
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"document"
block|,
name|TT_XDOCUMENT
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|parse_info
specifier|static
name|ParseInfo
name|parse_info
init|=
block|{
name|NULL
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|unknown_tokens
specifier|static
name|GList
modifier|*
name|unknown_tokens
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|cur_token
specifier|static
name|gint
name|cur_token
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|next_token
specifier|static
name|gint
name|next_token
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|gimp_system_rc_file (void)
name|gimp_system_rc_file
parameter_list|(
name|void
parameter_list|)
block|{
specifier|static
name|gchar
modifier|*
name|value
init|=
name|NULL
decl_stmt|;
if|if
condition|(
operator|!
name|value
condition|)
block|{
name|value
operator|=
name|g_strconcat
argument_list|(
name|gimp_sysconf_directory
argument_list|()
argument_list|,
name|G_DIR_SEPARATOR_S
argument_list|,
literal|"gimprc"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
return|return
name|value
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimprc_init (Gimp * gimp)
name|gimprc_init
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|)
block|{
if|if
condition|(
operator|!
name|parse_info
operator|.
name|buffer
condition|)
block|{
name|gint
name|i
decl_stmt|;
specifier|static
name|ParseFunc
name|base_funcs
index|[]
init|=
block|{
block|{
literal|"temp-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"swap-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"tile-cache-size"
block|,
name|TT_MEMSIZE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"stingy-memory-use"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"interpolation-type"
block|,
name|TT_INTERP
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"num-processors"
block|,
name|TT_INT
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
specifier|static
name|ParseFunc
name|core_funcs
index|[]
init|=
block|{
block|{
literal|"plug-in-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"module-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"brush-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"pattern-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"palette-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"gradient-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-brush"
block|,
name|TT_STRING
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-pattern"
block|,
name|TT_STRING
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-palette"
block|,
name|TT_STRING
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-gradient"
block|,
name|TT_STRING
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-comment"
block|,
name|TT_STRING
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-image-type"
block|,
name|TT_IMAGETYPE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-image-size"
block|,
name|TT_POSITION
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-units"
block|,
name|TT_XUNIT
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-xresolution"
block|,
name|TT_DOUBLE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-yresolution"
block|,
name|TT_DOUBLE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"default-resolution-units"
block|,
name|TT_XUNIT
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"undo-levels"
block|,
name|TT_INT
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"pluginrc-path"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"module-load-inhibit"
block|,
name|TT_PATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"thumbnail-mode"
block|,
name|TT_INT
block|,
name|NULL
block|,
name|NULL
block|}
block|}
decl_stmt|;
comment|/*  this hurts badly  */
name|base_funcs
index|[
literal|0
index|]
operator|.
name|val1p
operator|=
operator|&
name|base_config
operator|->
name|temp_path
expr_stmt|;
name|base_funcs
index|[
literal|1
index|]
operator|.
name|val1p
operator|=
operator|&
name|base_config
operator|->
name|swap_path
expr_stmt|;
name|base_funcs
index|[
literal|2
index|]
operator|.
name|val1p
operator|=
operator|&
name|base_config
operator|->
name|tile_cache_size
expr_stmt|;
name|base_funcs
index|[
literal|3
index|]
operator|.
name|val1p
operator|=
operator|&
name|base_config
operator|->
name|stingy_memory_use
expr_stmt|;
name|base_funcs
index|[
literal|4
index|]
operator|.
name|val1p
operator|=
operator|&
name|base_config
operator|->
name|interpolation_type
expr_stmt|;
name|base_funcs
index|[
literal|4
index|]
operator|.
name|val1p
operator|=
operator|&
name|base_config
operator|->
name|num_processors
expr_stmt|;
name|core_funcs
index|[
literal|0
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|plug_in_path
expr_stmt|;
name|core_funcs
index|[
literal|1
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|module_path
expr_stmt|;
name|core_funcs
index|[
literal|2
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|brush_path
expr_stmt|;
name|core_funcs
index|[
literal|3
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|pattern_path
expr_stmt|;
name|core_funcs
index|[
literal|4
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|palette_path
expr_stmt|;
name|core_funcs
index|[
literal|5
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|gradient_path
expr_stmt|;
name|core_funcs
index|[
literal|6
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_brush
expr_stmt|;
name|core_funcs
index|[
literal|7
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_pattern
expr_stmt|;
name|core_funcs
index|[
literal|8
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_palette
expr_stmt|;
name|core_funcs
index|[
literal|9
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_gradient
expr_stmt|;
name|core_funcs
index|[
literal|10
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_comment
expr_stmt|;
name|core_funcs
index|[
literal|11
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_type
expr_stmt|;
name|core_funcs
index|[
literal|12
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_width
expr_stmt|;
name|core_funcs
index|[
literal|12
index|]
operator|.
name|val2p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_height
expr_stmt|;
name|core_funcs
index|[
literal|13
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_units
expr_stmt|;
name|core_funcs
index|[
literal|14
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_xresolution
expr_stmt|;
name|core_funcs
index|[
literal|15
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_xresolution
expr_stmt|;
name|core_funcs
index|[
literal|16
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|default_resolution_units
expr_stmt|;
name|core_funcs
index|[
literal|17
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|levels_of_undo
expr_stmt|;
name|core_funcs
index|[
literal|18
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|pluginrc_path
expr_stmt|;
name|core_funcs
index|[
literal|19
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|module_db_load_inhibit
expr_stmt|;
name|core_funcs
index|[
literal|20
index|]
operator|.
name|val1p
operator|=
operator|&
name|gimp
operator|->
name|config
operator|->
name|thumbnail_mode
expr_stmt|;
name|parse_func_hash
operator|=
name|g_hash_table_new
argument_list|(
name|g_str_hash
argument_list|,
name|g_str_equal
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|base_funcs
argument_list|)
condition|;
name|i
operator|++
control|)
name|g_hash_table_insert
argument_list|(
name|parse_func_hash
argument_list|,
name|base_funcs
index|[
name|i
index|]
operator|.
name|name
argument_list|,
operator|&
name|base_funcs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|core_funcs
argument_list|)
condition|;
name|i
operator|++
control|)
name|g_hash_table_insert
argument_list|(
name|parse_func_hash
argument_list|,
name|core_funcs
index|[
name|i
index|]
operator|.
name|name
argument_list|,
operator|&
name|core_funcs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|G_N_ELEMENTS
argument_list|(
name|funcs
argument_list|)
condition|;
name|i
operator|++
control|)
name|g_hash_table_insert
argument_list|(
name|parse_func_hash
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|name
argument_list|,
operator|&
name|funcs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|parse_info
operator|.
name|buffer
operator|=
name|g_new
argument_list|(
name|gchar
argument_list|,
literal|4096
argument_list|)
expr_stmt|;
name|parse_info
operator|.
name|tokenbuf
operator|=
name|parse_info
operator|.
name|buffer
operator|+
literal|2048
expr_stmt|;
name|parse_info
operator|.
name|buffer_size
operator|=
literal|2048
expr_stmt|;
name|parse_info
operator|.
name|tokenbuf_size
operator|=
literal|2048
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|GList
modifier|*
DECL|function|parse_add_directory_tokens (void)
name|parse_add_directory_tokens
parameter_list|(
name|void
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|gimp_dir
decl_stmt|;
name|gimp_dir
operator|=
name|gimp_directory
argument_list|()
expr_stmt|;
name|add_gimp_directory_token
argument_list|(
name|gimp_dir
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|__EMX__
name|add_x11root_token
argument_list|(
name|getenv
argument_list|(
literal|"X11ROOT"
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* the real output is unknown_tokens list !  */
return|return
name|unknown_tokens
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimprc_parse (Gimp * gimp)
name|gimprc_parse
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|)
block|{
name|gchar
modifier|*
name|libfilename
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|parse_add_directory_tokens
argument_list|()
expr_stmt|;
if|if
condition|(
name|alternate_system_gimprc
condition|)
name|libfilename
operator|=
name|g_strdup
argument_list|(
name|alternate_system_gimprc
argument_list|)
expr_stmt|;
else|else
name|libfilename
operator|=
name|g_strdup
argument_list|(
name|gimp_system_rc_file
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimprc_parse_file
argument_list|(
name|libfilename
argument_list|)
condition|)
name|g_message
argument_list|(
literal|"Can't open '%s' for reading."
argument_list|,
name|libfilename
argument_list|)
expr_stmt|;
if|if
condition|(
name|alternate_gimprc
operator|!=
name|NULL
condition|)
name|filename
operator|=
name|g_strdup
argument_list|(
name|alternate_gimprc
argument_list|)
expr_stmt|;
else|else
name|filename
operator|=
name|gimp_personal_rc_file
argument_list|(
literal|"gimprc"
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_strcasecmp
argument_list|(
name|filename
argument_list|,
name|libfilename
argument_list|)
operator|!=
literal|0
condition|)
name|gimprc_parse_file
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|libfilename
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimprc
operator|.
name|image_title_format
condition|)
name|gimprc
operator|.
name|image_title_format
operator|=
name|g_strdup
argument_list|(
name|DEFAULT_IMAGE_TITLE_FORMAT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|gimp
operator|->
name|config
operator|->
name|default_comment
condition|)
name|gimp
operator|->
name|config
operator|->
name|default_comment
operator|=
name|g_strdup
argument_list|(
name|DEFAULT_COMMENT
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gboolean
DECL|function|parse_absolute_gimprc_file (char * filename)
name|parse_absolute_gimprc_file
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|gint
name|status
decl_stmt|;
name|parse_info
operator|.
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"rt"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|parse_info
operator|.
name|fp
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|be_verbose
condition|)
name|g_print
argument_list|(
name|_
argument_list|(
literal|"parsing \"%s\"\n"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|cur_token
operator|=
operator|-
literal|1
expr_stmt|;
name|next_token
operator|=
operator|-
literal|1
expr_stmt|;
name|parse_info
operator|.
name|position
operator|=
operator|-
literal|1
expr_stmt|;
name|parse_info
operator|.
name|linenum
operator|=
literal|1
expr_stmt|;
name|parse_info
operator|.
name|charnum
operator|=
literal|1
expr_stmt|;
name|parse_info
operator|.
name|inc_linenum
operator|=
name|FALSE
expr_stmt|;
name|parse_info
operator|.
name|inc_charnum
operator|=
name|FALSE
expr_stmt|;
while|while
condition|(
operator|(
name|status
operator|=
name|parse_statement
argument_list|()
operator|)
operator|==
name|OK
condition|)
empty_stmt|;
name|fclose
argument_list|(
name|parse_info
operator|.
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ERROR
condition|)
block|{
name|g_print
argument_list|(
name|_
argument_list|(
literal|"error parsing: \"%s\"\n"
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_print
argument_list|(
name|_
argument_list|(
literal|"  at line %d column %d\n"
argument_list|)
argument_list|,
name|parse_info
operator|.
name|linenum
argument_list|,
name|parse_info
operator|.
name|charnum
argument_list|)
expr_stmt|;
name|g_print
argument_list|(
name|_
argument_list|(
literal|"  unexpected token: %s\n"
argument_list|)
argument_list|,
name|token_sym
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimprc_parse_file (gchar * filename)
name|gimprc_parse_file
parameter_list|(
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
name|gchar
modifier|*
name|rfilename
decl_stmt|;
name|gboolean
name|parsed
decl_stmt|;
if|if
condition|(
operator|!
name|g_path_is_absolute
argument_list|(
name|filename
argument_list|)
condition|)
block|{
specifier|const
name|gchar
modifier|*
name|home_dir
init|=
name|g_get_home_dir
argument_list|()
decl_stmt|;
name|gchar
modifier|*
name|home_dir_sep
decl_stmt|;
if|if
condition|(
name|home_dir
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|home_dir
index|[
name|strlen
argument_list|(
name|home_dir
argument_list|)
operator|-
literal|1
index|]
operator|!=
name|G_DIR_SEPARATOR
condition|)
name|home_dir_sep
operator|=
name|G_DIR_SEPARATOR_S
expr_stmt|;
else|else
name|home_dir_sep
operator|=
literal|""
expr_stmt|;
name|rfilename
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s%s%s"
argument_list|,
name|home_dir
argument_list|,
name|home_dir_sep
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|parsed
operator|=
name|parse_absolute_gimprc_file
argument_list|(
name|rfilename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|rfilename
argument_list|)
expr_stmt|;
return|return
name|parsed
return|;
block|}
block|}
name|parsed
operator|=
name|parse_absolute_gimprc_file
argument_list|(
name|filename
argument_list|)
expr_stmt|;
return|return
name|parsed
return|;
block|}
end_function

begin_function
specifier|static
name|GList
modifier|*
DECL|function|g_list_findstr (GList * list,gchar * str)
name|g_list_findstr
parameter_list|(
name|GList
modifier|*
name|list
parameter_list|,
name|gchar
modifier|*
name|str
parameter_list|)
block|{
for|for
control|(
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|list
operator|->
name|data
argument_list|,
name|str
argument_list|)
condition|)
break|break;
block|}
return|return
name|list
return|;
block|}
end_function

begin_function
name|void
DECL|function|save_gimprc_strings (gchar * token,gchar * value)
name|save_gimprc_strings
parameter_list|(
name|gchar
modifier|*
name|token
parameter_list|,
name|gchar
modifier|*
name|value
parameter_list|)
block|{
name|gchar
name|timestamp
index|[
literal|40
index|]
decl_stmt|;
comment|/* variables for parsing and updating gimprc */
name|gchar
modifier|*
name|name
decl_stmt|;
name|gchar
name|tokname
index|[
literal|51
index|]
decl_stmt|;
name|FILE
modifier|*
name|fp_new
decl_stmt|;
name|FILE
modifier|*
name|fp_old
decl_stmt|;
name|gchar
modifier|*
name|cur_line
decl_stmt|;
name|gchar
modifier|*
name|prev_line
decl_stmt|;
name|gchar
modifier|*
name|error_msg
decl_stmt|;
name|gboolean
name|found
init|=
name|FALSE
decl_stmt|;
name|gchar
modifier|*
name|personal_gimprc
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
comment|/* variables to modify unknown_tokens */
name|UnknownToken
modifier|*
name|tmp
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|g_assert
argument_list|(
name|token
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|value
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/* get the name of the backup file, and the file pointers.  'name'    * is reused in another context later, disregard it here    */
name|personal_gimprc
operator|=
name|gimp_personal_rc_file
argument_list|(
literal|"gimprc"
argument_list|)
expr_stmt|;
name|error_msg
operator|=
name|open_backup_file
argument_list|(
name|personal_gimprc
argument_list|,
name|gimp_system_rc_file
argument_list|()
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|fp_new
argument_list|,
operator|&
name|fp_old
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|personal_gimprc
argument_list|)
expr_stmt|;
if|if
condition|(
name|error_msg
operator|!=
name|NULL
condition|)
block|{
name|g_message
argument_list|(
name|error_msg
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|error_msg
argument_list|)
expr_stmt|;
return|return;
block|}
name|strcpy
argument_list|(
name|timestamp
argument_list|,
literal|"by GIMP on "
argument_list|)
expr_stmt|;
name|iso_8601_date_format
argument_list|(
name|timestamp
operator|+
name|strlen
argument_list|(
name|timestamp
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* copy the old .gimprc into the new one, modifying it as needed */
name|prev_line
operator|=
name|NULL
expr_stmt|;
name|cur_line
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
literal|1024
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|feof
argument_list|(
name|fp_old
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|fgets
argument_list|(
name|cur_line
argument_list|,
literal|1024
argument_list|,
name|fp_old
argument_list|)
condition|)
continue|continue;
comment|/* special case: save lines starting with '#-' (added by GIMP) */
if|if
condition|(
operator|(
name|cur_line
index|[
literal|0
index|]
operator|==
literal|'#'
operator|)
operator|&&
operator|(
name|cur_line
index|[
literal|1
index|]
operator|==
literal|'-'
operator|)
condition|)
block|{
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|fputs
argument_list|(
name|prev_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
block|}
name|prev_line
operator|=
name|g_strdup
argument_list|(
name|cur_line
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* see if the line contains something that we can use         * and place that into 'name' if its found        */
if|if
condition|(
name|find_token
argument_list|(
name|cur_line
argument_list|,
name|tokname
argument_list|,
literal|50
argument_list|)
condition|)
block|{
comment|/* check if that entry should be updated */
if|if
condition|(
operator|!
name|g_strcasecmp
argument_list|(
name|token
argument_list|,
name|tokname
argument_list|)
condition|)
comment|/* if they match */
block|{
if|if
condition|(
name|prev_line
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line commented out %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"# %s\n"
argument_list|,
name|cur_line
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line added %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line modified %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
block|}
name|str
operator|=
name|gimp_strescape
argument_list|(
name|value
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|found
condition|)
block|{
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"(%s \"%s\")\n"
argument_list|,
name|token
argument_list|,
name|str
argument_list|)
expr_stmt|;
block|}
else|else
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- (%s \"%s\")\n"
argument_list|,
name|token
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|found
operator|=
name|TRUE
expr_stmt|;
continue|continue;
block|}
block|}
comment|/* all lines that did not match the tests above are simply copied */
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|fputs
argument_list|(
name|prev_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
block|}
name|fputs
argument_list|(
name|cur_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
block|}
comment|/* end of while(!feof) */
name|g_free
argument_list|(
name|cur_line
argument_list|)
expr_stmt|;
if|if
condition|(
name|prev_line
condition|)
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp_old
argument_list|)
expr_stmt|;
comment|/* append the options that were not in the old .gimprc */
if|if
condition|(
operator|!
name|found
condition|)
block|{
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line added %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|str
operator|=
name|gimp_strescape
argument_list|(
name|value
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"(%s \"%s\")\n\n"
argument_list|,
name|token
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
comment|/* update unknown_tokens to reflect new token value */
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|unknown_tokens
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|tmp
operator|=
operator|(
name|UnknownToken
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|tmp
operator|->
name|token
argument_list|,
name|ut
operator|->
name|token
argument_list|)
operator|==
literal|0
condition|)
block|{
name|unknown_tokens
operator|=
name|g_list_remove
argument_list|(
name|unknown_tokens
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
operator|->
name|token
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
operator|->
name|value
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
block|}
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp_new
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimprc_save (GList ** updated_options,GList ** conflicting_options)
name|gimprc_save
parameter_list|(
name|GList
modifier|*
modifier|*
name|updated_options
parameter_list|,
name|GList
modifier|*
modifier|*
name|conflicting_options
parameter_list|)
block|{
name|gchar
name|timestamp
index|[
literal|40
index|]
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|gchar
name|tokname
index|[
literal|51
index|]
decl_stmt|;
name|FILE
modifier|*
name|fp_new
decl_stmt|;
name|FILE
modifier|*
name|fp_old
decl_stmt|;
name|GList
modifier|*
name|option
decl_stmt|;
name|gchar
modifier|*
name|cur_line
decl_stmt|;
name|gchar
modifier|*
name|prev_line
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|gchar
modifier|*
name|error_msg
decl_stmt|;
name|gchar
modifier|*
name|personal_gimprc
decl_stmt|;
name|g_assert
argument_list|(
name|updated_options
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|conflicting_options
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|personal_gimprc
operator|=
name|gimp_personal_rc_file
argument_list|(
literal|"gimprc"
argument_list|)
expr_stmt|;
name|error_msg
operator|=
name|open_backup_file
argument_list|(
name|personal_gimprc
argument_list|,
name|gimp_system_rc_file
argument_list|()
argument_list|,
operator|&
name|name
argument_list|,
operator|&
name|fp_new
argument_list|,
operator|&
name|fp_old
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|personal_gimprc
argument_list|)
expr_stmt|;
if|if
condition|(
name|error_msg
operator|!=
name|NULL
condition|)
block|{
name|g_message
argument_list|(
name|error_msg
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|error_msg
argument_list|)
expr_stmt|;
return|return;
block|}
name|strcpy
argument_list|(
name|timestamp
argument_list|,
literal|"by GIMP on "
argument_list|)
expr_stmt|;
name|iso_8601_date_format
argument_list|(
name|timestamp
operator|+
name|strlen
argument_list|(
name|timestamp
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* copy the old .gimprc into the new one, modifying it as needed */
name|prev_line
operator|=
name|NULL
expr_stmt|;
name|cur_line
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
literal|1024
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|feof
argument_list|(
name|fp_old
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|fgets
argument_list|(
name|cur_line
argument_list|,
literal|1024
argument_list|,
name|fp_old
argument_list|)
condition|)
continue|continue;
comment|/* special case: save lines starting with '#-' (added by GIMP) */
if|if
condition|(
operator|(
name|cur_line
index|[
literal|0
index|]
operator|==
literal|'#'
operator|)
operator|&&
operator|(
name|cur_line
index|[
literal|1
index|]
operator|==
literal|'-'
operator|)
condition|)
block|{
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|fputs
argument_list|(
name|prev_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
block|}
name|prev_line
operator|=
name|g_strdup
argument_list|(
name|cur_line
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* see if the line contains something that we can use */
if|if
condition|(
name|find_token
argument_list|(
name|cur_line
argument_list|,
name|tokname
argument_list|,
literal|50
argument_list|)
condition|)
block|{
comment|/* check if that entry should be updated */
name|option
operator|=
name|g_list_findstr
argument_list|(
operator|*
name|updated_options
argument_list|,
name|tokname
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|prev_line
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line commented out %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"# %s\n"
argument_list|,
name|cur_line
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line added %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line modified %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
block|}
name|str
operator|=
name|value_to_str
argument_list|(
name|tokname
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"(%s %s)\n"
argument_list|,
name|tokname
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
operator|*
name|updated_options
operator|=
name|g_list_remove_link
argument_list|(
operator|*
name|updated_options
argument_list|,
name|option
argument_list|)
expr_stmt|;
operator|*
name|conflicting_options
operator|=
name|g_list_concat
argument_list|(
operator|*
name|conflicting_options
argument_list|,
name|option
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* check if that entry should be commented out */
name|option
operator|=
name|g_list_findstr
argument_list|(
operator|*
name|conflicting_options
argument_list|,
name|tokname
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line commented out %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"# %s\n"
argument_list|,
name|cur_line
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
comment|/* all lines that did not match the tests above are simply copied */
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|fputs
argument_list|(
name|prev_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
block|}
name|fputs
argument_list|(
name|cur_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|cur_line
argument_list|)
expr_stmt|;
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp_old
argument_list|)
expr_stmt|;
comment|/* append the options that were not in the old .gimprc */
name|option
operator|=
operator|*
name|updated_options
expr_stmt|;
while|while
condition|(
name|option
condition|)
block|{
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line added %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|str
operator|=
name|value_to_str
argument_list|(
operator|(
name|char
operator|*
operator|)
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"(%s %s)\n\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|option
operator|->
name|data
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|option
operator|=
name|option
operator|->
name|next
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp_new
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|get_next_token (void)
name|get_next_token
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|next_token
operator|!=
operator|-
literal|1
condition|)
block|{
name|cur_token
operator|=
name|next_token
expr_stmt|;
name|next_token
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|cur_token
operator|=
name|get_token
argument_list|(
operator|&
name|parse_info
argument_list|)
expr_stmt|;
block|}
return|return
name|cur_token
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|peek_next_token (void)
name|peek_next_token
parameter_list|(
name|void
parameter_list|)
block|{
if|if
condition|(
name|next_token
operator|==
operator|-
literal|1
condition|)
name|next_token
operator|=
name|get_token
argument_list|(
operator|&
name|parse_info
argument_list|)
expr_stmt|;
return|return
name|next_token
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_statement (void)
name|parse_statement
parameter_list|(
name|void
parameter_list|)
block|{
name|ParseFunc
modifier|*
name|func
decl_stmt|;
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
condition|)
return|return
name|DONE
return|;
if|if
condition|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|func
operator|=
name|g_hash_table_lookup
argument_list|(
name|parse_func_hash
argument_list|,
name|token_sym
argument_list|)
expr_stmt|;
if|if
condition|(
name|func
condition|)
block|{
switch|switch
condition|(
name|func
operator|->
name|type
condition|)
block|{
case|case
name|TT_STRING
case|:
return|return
name|parse_string
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_PATH
case|:
return|return
name|parse_path
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_DOUBLE
case|:
return|return
name|parse_double
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_FLOAT
case|:
return|return
name|parse_float
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_INT
case|:
return|return
name|parse_int
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_BOOLEAN
case|:
return|return
name|parse_boolean
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_POSITION
case|:
return|return
name|parse_position
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_MEMSIZE
case|:
return|return
name|parse_mem_size
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_IMAGETYPE
case|:
return|return
name|parse_image_type
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_INTERP
case|:
return|return
name|parse_interpolation_type
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XPREVSIZE
case|:
return|return
name|parse_preview_size
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XNAVPREVSIZE
case|:
return|return
name|parse_nav_preview_size
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XUNIT
case|:
return|return
name|parse_units
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XPLUGIN
case|:
return|return
name|parse_plug_in
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XPLUGINDEF
case|:
return|return
name|parse_plug_in_def
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XMENUPATH
case|:
return|return
name|parse_menu_path
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XDEVICE
case|:
return|return
name|parse_device
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XSESSIONINFO
case|:
return|return
name|parse_session_info
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XCOLORHISTORY
case|:
return|return
name|parse_color_history
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XUNITINFO
case|:
return|return
name|parse_unit_info
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XPARASITE
case|:
return|return
name|parse_parasite
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XHELPBROWSER
case|:
return|return
name|parse_help_browser
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XCURSORMODE
case|:
return|return
name|parse_cursor_mode
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XCOMMENT
case|:
return|return
name|parse_string
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XDOCUMENT
case|:
return|return
name|parse_document
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
block|}
block|}
return|return
name|parse_unknown
argument_list|(
name|token_sym
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_path (gpointer val1p,gpointer val2p)
name|parse_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|pathp
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|pathp
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|pathp
condition|)
name|g_free
argument_list|(
operator|*
name|pathp
argument_list|)
expr_stmt|;
operator|*
name|pathp
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
operator|*
name|pathp
argument_list|)
expr_stmt|;
operator|*
name|pathp
operator|=
name|NULL
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|pathp
operator|=
name|transform_path
argument_list|(
operator|*
name|pathp
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_string (gpointer val1p,gpointer val2p)
name|parse_string
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|strp
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|strp
operator|=
operator|(
name|gchar
operator|*
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|strp
condition|)
name|g_free
argument_list|(
operator|*
name|strp
argument_list|)
expr_stmt|;
operator|*
name|strp
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
operator|*
name|strp
argument_list|)
expr_stmt|;
operator|*
name|strp
operator|=
name|NULL
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_double (gpointer val1p,gpointer val2p)
name|parse_double
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gdouble
modifier|*
name|nump
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|nump
operator|=
operator|(
name|gdouble
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|nump
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_float (gpointer val1p,gpointer val2p)
name|parse_float
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gfloat
modifier|*
name|nump
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|nump
operator|=
operator|(
name|gfloat
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|nump
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_int (gpointer val1p,gpointer val2p)
name|parse_int
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gint
modifier|*
name|nump
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|nump
operator|=
operator|(
name|gint
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|nump
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_boolean (gpointer val1p,gpointer val2p)
name|parse_boolean
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gint
modifier|*
name|boolp
decl_stmt|;
comment|/* The variable to be set should be passed in the first or second    * pointer.  If the pointer is in val2p, then the opposite value is    * stored in the pointer.  This is useful for "dont-xxx" or "no-xxx"    * type of options.    * If the expression to be parsed is written as "(option)" instead    * of "(option yes)" or "(option no)", then the default value is    * TRUE if the variable is passed in val1p, or FALSE if in val2p.    */
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
operator|||
name|val2p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|val1p
operator|!=
name|NULL
condition|)
name|boolp
operator|=
operator|(
name|gint
operator|*
operator|)
name|val1p
expr_stmt|;
else|else
name|boolp
operator|=
operator|(
name|gint
operator|*
operator|)
name|val2p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
condition|)
return|return
name|ERROR
return|;
switch|switch
condition|(
name|token
condition|)
block|{
case|case
name|TOKEN_RIGHT_PAREN
case|:
operator|*
name|boolp
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|TOKEN_NUMBER
case|:
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|boolp
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
break|break;
case|case
name|TOKEN_SYMBOL
case|:
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"true"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"on"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"yes"
argument_list|)
condition|)
operator|*
name|boolp
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"false"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"off"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"no"
argument_list|)
condition|)
operator|*
name|boolp
operator|=
name|FALSE
expr_stmt|;
else|else
return|return
name|ERROR
return|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
break|break;
default|default:
return|return
name|ERROR
return|;
block|}
if|if
condition|(
name|val1p
operator|==
name|NULL
condition|)
operator|*
name|boolp
operator|=
operator|!
operator|*
name|boolp
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_position (gpointer val1p,gpointer val2p)
name|parse_position
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gint
modifier|*
name|xp
decl_stmt|;
name|gint
modifier|*
name|yp
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
operator|&&
name|val2p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|xp
operator|=
operator|(
name|gint
operator|*
operator|)
name|val1p
expr_stmt|;
name|yp
operator|=
operator|(
name|gint
operator|*
operator|)
name|val2p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|xp
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|yp
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_mem_size (gpointer val1p,gpointer val2p)
name|parse_mem_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|suffix
decl_stmt|;
name|gint
name|token
decl_stmt|;
name|guint
name|mult
decl_stmt|;
name|guint
modifier|*
name|sizep
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|sizep
operator|=
operator|(
name|guint
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
operator|&&
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_NUMBER
condition|)
block|{
operator|*
name|sizep
operator|=
name|token_num
operator|*
literal|1024
expr_stmt|;
block|}
else|else
block|{
operator|*
name|sizep
operator|=
name|atoi
argument_list|(
name|token_sym
argument_list|)
expr_stmt|;
name|suffix
operator|=
name|token_sym
index|[
name|strlen
argument_list|(
name|token_sym
argument_list|)
operator|-
literal|1
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|suffix
operator|==
literal|'m'
operator|)
operator|||
operator|(
name|suffix
operator|==
literal|'M'
operator|)
condition|)
name|mult
operator|=
literal|1024
operator|*
literal|1024
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|suffix
operator|==
literal|'k'
operator|)
operator|||
operator|(
name|suffix
operator|==
literal|'K'
operator|)
condition|)
name|mult
operator|=
literal|1024
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|suffix
operator|==
literal|'b'
operator|)
operator|||
operator|(
name|suffix
operator|==
literal|'B'
operator|)
condition|)
name|mult
operator|=
literal|1
expr_stmt|;
else|else
return|return
name|FALSE
return|;
operator|*
name|sizep
operator|*=
name|mult
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_image_type (gpointer val1p,gpointer val2p)
name|parse_image_type
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gint
modifier|*
name|typep
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|typep
operator|=
operator|(
name|gint
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"rgb"
argument_list|)
condition|)
operator|*
name|typep
operator|=
name|RGB
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"gray"
argument_list|)
operator|)
operator|||
operator|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"grey"
argument_list|)
operator|)
condition|)
operator|*
name|typep
operator|=
name|GRAY
expr_stmt|;
else|else
return|return
name|ERROR
return|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_interpolation_type (gpointer val1p,gpointer val2p)
name|parse_interpolation_type
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|InterpolationType
modifier|*
name|typep
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|typep
operator|=
operator|(
name|InterpolationType
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"nearest-neighbor"
argument_list|)
operator|==
literal|0
condition|)
operator|*
name|typep
operator|=
name|NEAREST_NEIGHBOR_INTERPOLATION
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"linear"
argument_list|)
operator|==
literal|0
condition|)
operator|*
name|typep
operator|=
name|LINEAR_INTERPOLATION
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"cubic"
argument_list|)
operator|==
literal|0
condition|)
operator|*
name|typep
operator|=
name|CUBIC_INTERPOLATION
expr_stmt|;
else|else
return|return
name|ERROR
return|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_preview_size (gpointer val1p,gpointer val2p)
name|parse_preview_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|&&
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_SYMBOL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|preview_size
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"tiny"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|preview_size
operator|=
literal|24
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"small"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|preview_size
operator|=
literal|32
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"medium"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|preview_size
operator|=
literal|48
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"large"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|preview_size
operator|=
literal|64
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"huge"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|preview_size
operator|=
literal|128
expr_stmt|;
else|else
name|gimprc
operator|.
name|preview_size
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|token
operator|==
name|TOKEN_NUMBER
condition|)
name|gimprc
operator|.
name|preview_size
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_nav_preview_size (gpointer val1p,gpointer val2p)
name|parse_nav_preview_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|&&
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_SYMBOL
condition|)
block|{
comment|/*       if (strcmp (token_sym, "none") == 0) */
comment|/* 	preview_size = 0; */
comment|/*       else  */
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"small"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|nav_preview_size
operator|=
literal|48
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"medium"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|nav_preview_size
operator|=
literal|80
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"large"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|nav_preview_size
operator|=
literal|112
expr_stmt|;
else|else
name|gimprc
operator|.
name|nav_preview_size
operator|=
literal|112
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|token
operator|==
name|TOKEN_NUMBER
condition|)
name|gimprc
operator|.
name|nav_preview_size
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_units (gpointer val1p,gpointer val2p)
name|parse_units
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
operator|(
operator|(
name|GimpUnit
operator|*
operator|)
name|val1p
operator|)
operator|=
name|GIMP_UNIT_INCH
expr_stmt|;
for|for
control|(
name|i
operator|=
name|GIMP_UNIT_INCH
init|;
name|i
operator|<
name|gimp_unit_get_number_of_units
argument_list|()
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
name|gimp_unit_get_identifier
argument_list|(
name|i
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
block|{
operator|*
operator|(
operator|(
name|GimpUnit
operator|*
operator|)
name|val1p
operator|)
operator|=
name|i
expr_stmt|;
break|break;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_plug_in (gpointer val1p,gpointer val2p)
name|parse_plug_in
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gchar
modifier|*
name|name
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|menu_path
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|accelerator
init|=
name|NULL
decl_stmt|;
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_STRING
condition|)
block|{
name|menu_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_STRING
condition|)
block|{
name|accelerator
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|menu_path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|accelerator
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|name
operator|&&
name|menu_path
condition|)
name|plug_in_add
argument_list|(
name|name
argument_list|,
name|menu_path
argument_list|,
name|accelerator
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_plug_in_def (gpointer val1p,gpointer val2p)
name|parse_plug_in_def
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|PlugInDef
modifier|*
name|plug_in_def
decl_stmt|;
name|PlugInProcDef
modifier|*
name|proc_def
decl_stmt|;
name|gint
name|token
decl_stmt|;
name|gint
name|success
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|plug_in_def
operator|=
name|plug_in_def_new
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|plug_in_def
operator|->
name|mtime
operator|=
name|token_int
expr_stmt|;
name|success
operator|=
name|OK
expr_stmt|;
while|while
condition|(
name|success
operator|==
name|OK
condition|)
block|{
name|success
operator|=
name|parse_proc_def
argument_list|(
operator|&
name|proc_def
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
operator|==
name|OK
condition|)
block|{
name|proc_def
operator|->
name|mtime
operator|=
name|plug_in_def
operator|->
name|mtime
expr_stmt|;
name|proc_def
operator|->
name|prog
operator|=
name|g_strdup
argument_list|(
name|plug_in_def
operator|->
name|prog
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|proc_defs
operator|=
name|g_slist_append
argument_list|(
name|plug_in_def
operator|->
name|proc_defs
argument_list|,
name|proc_def
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|success
operator|==
name|LOCALE_DEF
condition|)
name|success
operator|=
name|parse_locale_def
argument_list|(
name|plug_in_def
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|success
operator|==
name|HELP_DEF
condition|)
name|success
operator|=
name|parse_help_def
argument_list|(
name|plug_in_def
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|plug_in_def_add
argument_list|(
name|plug_in_def
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_message
argument_list|(
name|_
argument_list|(
literal|"error parsing pluginrc"
argument_list|)
argument_list|)
expr_stmt|;
name|plug_in_def_free
argument_list|(
name|plug_in_def
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_locale_def (PlugInDef * plug_in_def)
name|parse_locale_def
parameter_list|(
name|PlugInDef
modifier|*
name|plug_in_def
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|plug_in_def
operator|->
name|locale_domain
condition|)
name|g_free
argument_list|(
name|plug_in_def
operator|->
name|locale_domain
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|locale_domain
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|&&
name|token
operator|==
name|TOKEN_STRING
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|plug_in_def
operator|->
name|locale_path
condition|)
name|g_free
argument_list|(
name|plug_in_def
operator|->
name|locale_path
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|locale_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|token
operator|||
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|plug_in_def
operator|->
name|locale_domain
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|locale_domain
operator|=
name|NULL
expr_stmt|;
name|g_free
argument_list|(
name|plug_in_def
operator|->
name|locale_path
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|locale_path
operator|=
name|NULL
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_help_def (PlugInDef * plug_in_def)
name|parse_help_def
parameter_list|(
name|PlugInDef
modifier|*
name|plug_in_def
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|plug_in_def
operator|->
name|help_path
condition|)
name|g_free
argument_list|(
name|plug_in_def
operator|->
name|help_path
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|help_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|plug_in_def
operator|->
name|help_path
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|help_path
operator|=
name|NULL
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_proc_def (PlugInProcDef ** proc_def)
name|parse_proc_def
parameter_list|(
name|PlugInProcDef
modifier|*
modifier|*
name|proc_def
parameter_list|)
block|{
name|PlugInProcDef
modifier|*
name|pd
decl_stmt|;
name|gint
name|token
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
if|if
condition|(
operator|(
name|strcmp
argument_list|(
literal|"locale-def"
argument_list|,
name|token_sym
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
comment|/* it's a locale_def, let parse_locale_def do the rest */
return|return
name|LOCALE_DEF
return|;
block|}
if|if
condition|(
operator|(
name|strcmp
argument_list|(
literal|"help-def"
argument_list|,
name|token_sym
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
comment|/* it's a help_def, let parse_help_def do the rest */
return|return
name|HELP_DEF
return|;
block|}
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
literal|"proc-def"
argument_list|,
name|token_sym
argument_list|)
operator|!=
literal|0
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|=
name|g_new0
argument_list|(
name|PlugInProcDef
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|proc_type
operator|=
name|token_int
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|blurb
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|help
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|author
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|copyright
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|date
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|menu_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|extensions
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|prefixes
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|magics
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|pd
operator|->
name|image_types
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|pd
operator|->
name|image_types_val
operator|=
name|plug_in_image_types_parse
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|num_args
operator|=
name|token_int
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|args
operator|=
name|g_new0
argument_list|(
name|ProcArg
argument_list|,
name|pd
operator|->
name|db_info
operator|.
name|num_args
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|num_values
operator|=
name|token_int
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|values
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|pd
operator|->
name|db_info
operator|.
name|num_values
operator|>
literal|0
condition|)
name|pd
operator|->
name|db_info
operator|.
name|values
operator|=
name|g_new
argument_list|(
name|ProcArg
argument_list|,
name|pd
operator|->
name|db_info
operator|.
name|num_values
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_args
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|parse_proc_arg
argument_list|(
operator|&
name|pd
operator|->
name|db_info
operator|.
name|args
index|[
name|i
index|]
argument_list|)
condition|)
goto|goto
name|error
goto|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_values
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|parse_proc_arg
argument_list|(
operator|&
name|pd
operator|->
name|db_info
operator|.
name|values
index|[
name|i
index|]
argument_list|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|proc_def
operator|=
name|pd
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|blurb
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|help
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|copyright
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|date
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|menu_path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|extensions
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|prefixes
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|magics
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|image_types
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_args
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|args
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|args
index|[
name|i
index|]
operator|.
name|description
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_values
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|values
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|values
index|[
name|i
index|]
operator|.
name|description
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|args
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|values
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_proc_arg (ProcArg * arg)
name|parse_proc_arg
parameter_list|(
name|ProcArg
modifier|*
name|arg
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|arg
operator|->
name|arg_type
operator|=
operator|-
literal|1
expr_stmt|;
name|arg
operator|->
name|name
operator|=
name|NULL
expr_stmt|;
name|arg
operator|->
name|description
operator|=
name|NULL
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
operator|||
operator|(
name|strcmp
argument_list|(
literal|"proc-arg"
argument_list|,
name|token_sym
argument_list|)
operator|!=
literal|0
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|arg
operator|->
name|arg_type
operator|=
name|token_int
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|arg
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|arg
operator|->
name|description
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|arg
operator|->
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|description
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_color (GimpRGB * color)
name|parse_color
parameter_list|(
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|gdouble
name|col
index|[
literal|4
index|]
init|=
block|{
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|1.0
block|}
decl_stmt|;
name|gint
name|token
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|n_channels
decl_stmt|;
name|gboolean
name|is_hsv
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|color
operator|!=
name|NULL
argument_list|,
name|ERROR
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"color-rgb"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|is_hsv
operator|=
name|FALSE
expr_stmt|;
name|n_channels
operator|=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"color-rgba"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|is_hsv
operator|=
name|FALSE
expr_stmt|;
name|n_channels
operator|=
literal|4
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"color-hsv"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|is_hsv
operator|=
name|TRUE
expr_stmt|;
name|n_channels
operator|=
literal|3
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"color-hsva"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|is_hsv
operator|=
name|TRUE
expr_stmt|;
name|n_channels
operator|=
literal|4
expr_stmt|;
block|}
else|else
block|{
return|return
name|ERROR
return|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_channels
condition|;
name|i
operator|++
control|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|col
index|[
name|i
index|]
operator|=
name|token_num
expr_stmt|;
block|}
if|if
condition|(
name|is_hsv
condition|)
block|{
name|GimpHSV
name|hsv
decl_stmt|;
name|gimp_hsva_set
argument_list|(
operator|&
name|hsv
argument_list|,
name|col
index|[
literal|0
index|]
argument_list|,
name|col
index|[
literal|1
index|]
argument_list|,
name|col
index|[
literal|2
index|]
argument_list|,
name|col
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|gimp_hsv_clamp
argument_list|(
operator|&
name|hsv
argument_list|)
expr_stmt|;
name|gimp_hsv_to_rgb
argument_list|(
operator|&
name|hsv
argument_list|,
name|color
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_rgba_set
argument_list|(
name|color
argument_list|,
name|col
index|[
literal|0
index|]
argument_list|,
name|col
index|[
literal|1
index|]
argument_list|,
name|col
index|[
literal|2
index|]
argument_list|,
name|col
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|gimp_rgb_clamp
argument_list|(
name|color
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_menu_path (gpointer val1p,gpointer val2p)
name|parse_menu_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gchar
modifier|*
name|menu_path
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|accelerator
init|=
name|NULL
decl_stmt|;
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|menu_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|accelerator
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|menu_path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|accelerator
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|transform_path (gchar * path,gboolean destroy)
name|transform_path
parameter_list|(
name|gchar
modifier|*
name|path
parameter_list|,
name|gboolean
name|destroy
parameter_list|)
block|{
name|gint
name|length
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|new_path
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|home
decl_stmt|;
name|gchar
modifier|*
name|token
decl_stmt|;
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|gchar
modifier|*
name|tmp2
decl_stmt|;
name|gboolean
name|substituted
init|=
name|FALSE
decl_stmt|;
name|gboolean
name|is_env
init|=
name|FALSE
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
name|home
operator|=
name|g_get_home_dir
argument_list|()
expr_stmt|;
name|tmp
operator|=
name|path
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
condition|)
block|{
ifndef|#
directive|ifndef
name|G_OS_WIN32
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'~'
condition|)
block|{
name|length
operator|+=
name|strlen
argument_list|(
name|home
argument_list|)
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
elseif|else
endif|#
directive|endif
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'$'
condition|)
block|{
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
operator|||
operator|(
operator|*
name|tmp
operator|!=
literal|'{'
operator|)
condition|)
return|return
name|path
return|;
name|tmp
operator|+=
literal|1
expr_stmt|;
name|token
operator|=
name|tmp
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'}'
operator|)
condition|)
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
condition|)
return|return
name|path
return|;
operator|*
name|tmp
operator|=
literal|'\0'
expr_stmt|;
name|tmp2
operator|=
name|gimprc_find_token
argument_list|(
name|token
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp2
operator|==
name|NULL
condition|)
block|{
comment|/* maybe token is an environment variable */
name|tmp2
operator|=
name|g_getenv
argument_list|(
name|token
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|G_OS_WIN32
comment|/* The default user gimprc on Windows references 	       * ${TEMP}, but not all Windows installations have that 	       * environment variable, even if it should be kinda 	       * standard. So special-case it. 	       */
if|if
condition|(
name|tmp2
operator|==
name|NULL
operator|&&
operator|(
name|g_strcasecmp
argument_list|(
name|token
argument_list|,
literal|"temp"
argument_list|)
operator|==
literal|0
operator|||
name|g_strcasecmp
argument_list|(
name|token
argument_list|,
literal|"tmp"
argument_list|)
operator|==
literal|0
operator|)
condition|)
block|{
name|tmp2
operator|=
name|g_get_tmp_dir
argument_list|()
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|tmp2
operator|!=
name|NULL
condition|)
block|{
name|is_env
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|gimp_terminate
argument_list|(
literal|"transform_path(): gimprc token referenced but not defined: %s"
argument_list|,
name|token
argument_list|)
expr_stmt|;
block|}
block|}
name|tmp2
operator|=
name|transform_path
argument_list|(
name|tmp2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_env
condition|)
block|{
comment|/* then add to list of unknown tokens */
comment|/* but only if it isn't already in list */
if|if
condition|(
name|gimprc_find_token
argument_list|(
name|token
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|tmp2
argument_list|)
expr_stmt|;
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|gimprc_set_token
argument_list|(
name|token
argument_list|,
name|tmp2
argument_list|)
expr_stmt|;
block|}
name|length
operator|+=
name|strlen
argument_list|(
name|tmp2
argument_list|)
expr_stmt|;
operator|*
name|tmp
operator|=
literal|'}'
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
name|substituted
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|length
operator|+=
literal|1
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|length
operator|==
name|strlen
argument_list|(
name|path
argument_list|)
operator|)
operator|&&
operator|!
name|substituted
condition|)
return|return
name|path
return|;
name|new_path
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
name|length
operator|+
literal|1
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|path
expr_stmt|;
name|tmp2
operator|=
name|new_path
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
condition|)
block|{
ifndef|#
directive|ifndef
name|G_OS_WIN32
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'~'
condition|)
block|{
operator|*
name|tmp2
operator|=
literal|'\0'
expr_stmt|;
name|strcat
argument_list|(
name|tmp2
argument_list|,
name|home
argument_list|)
expr_stmt|;
name|tmp2
operator|+=
name|strlen
argument_list|(
name|home
argument_list|)
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
elseif|else
endif|#
directive|endif
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'$'
condition|)
block|{
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
operator|||
operator|(
operator|*
name|tmp
operator|!=
literal|'{'
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|new_path
argument_list|)
expr_stmt|;
return|return
name|path
return|;
block|}
name|tmp
operator|+=
literal|1
expr_stmt|;
name|token
operator|=
name|tmp
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'}'
operator|)
condition|)
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
condition|)
block|{
name|g_free
argument_list|(
name|new_path
argument_list|)
expr_stmt|;
return|return
name|path
return|;
block|}
operator|*
name|tmp
operator|=
literal|'\0'
expr_stmt|;
name|token
operator|=
name|gimprc_find_token
argument_list|(
name|token
argument_list|)
expr_stmt|;
operator|*
name|tmp
operator|=
literal|'}'
expr_stmt|;
operator|*
name|tmp2
operator|=
literal|'\0'
expr_stmt|;
name|strcat
argument_list|(
name|tmp2
argument_list|,
name|token
argument_list|)
expr_stmt|;
name|tmp2
operator|+=
name|strlen
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
else|else
block|{
operator|*
name|tmp2
operator|++
operator|=
operator|*
name|tmp
operator|++
expr_stmt|;
block|}
block|}
operator|*
name|tmp2
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|destroy
condition|)
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
return|return
name|new_path
return|;
block|}
end_function

begin_comment
comment|/* Copied from gtk_menu_factory_parse_accelerator() */
end_comment

begin_function
specifier|static
name|void
DECL|function|parse_device_accelerator (const gchar * accelerator,GdkDeviceKey * key)
name|parse_device_accelerator
parameter_list|(
specifier|const
name|gchar
modifier|*
name|accelerator
parameter_list|,
name|GdkDeviceKey
modifier|*
name|key
parameter_list|)
block|{
name|gboolean
name|done
init|=
name|FALSE
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|accelerator
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|key
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|key
operator|->
name|modifiers
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|done
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
name|accelerator
argument_list|,
literal|"<shift>"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|accelerator
operator|+=
literal|7
expr_stmt|;
name|key
operator|->
name|modifiers
operator||=
name|GDK_SHIFT_MASK
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|accelerator
argument_list|,
literal|"<alt>"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|accelerator
operator|+=
literal|5
expr_stmt|;
name|key
operator|->
name|modifiers
operator||=
name|GDK_MOD1_MASK
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|accelerator
argument_list|,
literal|"<control>"
argument_list|,
literal|9
argument_list|)
operator|==
literal|0
condition|)
block|{
name|accelerator
operator|+=
literal|9
expr_stmt|;
name|key
operator|->
name|modifiers
operator||=
name|GDK_CONTROL_MASK
expr_stmt|;
block|}
else|else
block|{
name|done
operator|=
name|TRUE
expr_stmt|;
comment|/* Tricky, but works... ("" => keyval = 0, or no translation) */
name|key
operator|->
name|keyval
operator|=
name|accelerator
index|[
literal|0
index|]
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_device (gpointer val1p,gpointer val2p)
name|parse_device
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|DeviceValues
name|values
init|=
literal|0
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|token
decl_stmt|;
comment|/* The initialized values here are meaningless */
name|gchar
modifier|*
name|name
init|=
name|NULL
decl_stmt|;
name|GdkInputMode
name|mode
init|=
name|GDK_MODE_DISABLED
decl_stmt|;
name|gint
name|num_axes
init|=
literal|0
decl_stmt|;
name|GdkAxisUse
modifier|*
name|axes
init|=
name|NULL
decl_stmt|;
name|gint
name|num_keys
init|=
literal|0
decl_stmt|;
name|GdkDeviceKey
modifier|*
name|keys
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|tool_name
init|=
name|NULL
decl_stmt|;
name|GimpRGB
name|foreground
init|=
block|{
literal|1.0
block|,
literal|1.0
block|,
literal|1.0
block|,
literal|1.0
block|}
decl_stmt|;
name|GimpRGB
name|background
init|=
block|{
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|1.0
block|}
decl_stmt|;
name|gchar
modifier|*
name|brush_name
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|pattern_name
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|gradient_name
init|=
name|NULL
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
comment|/* Parse options for device */
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_LEFT_PAREN
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"mode"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_MODE
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"disabled"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|mode
operator|=
name|GDK_MODE_DISABLED
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"window"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|mode
operator|=
name|GDK_MODE_WINDOW
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"screen"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|mode
operator|=
name|GDK_MODE_SCREEN
expr_stmt|;
else|else
goto|goto
name|error
goto|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"axes"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_AXES
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|num_axes
operator|=
name|token_int
expr_stmt|;
name|axes
operator|=
name|g_new
argument_list|(
name|GdkAxisUse
argument_list|,
name|num_axes
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_axes
condition|;
name|i
operator|++
control|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"ignore"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_IGNORE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"x"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_X
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"y"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_Y
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"pressure"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_PRESSURE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"xtilt"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_XTILT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"ytilt"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_YTILT
expr_stmt|;
else|else
goto|goto
name|error
goto|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"keys"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_KEYS
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|num_keys
operator|=
name|token_int
expr_stmt|;
name|keys
operator|=
name|g_new
argument_list|(
name|GdkDeviceKey
argument_list|,
name|num_keys
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_keys
condition|;
name|i
operator|++
control|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|parse_device_accelerator
argument_list|(
name|token_str
argument_list|,
operator|&
name|keys
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"tool"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_TOOL
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|tool_name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"foreground"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_FOREGROUND
expr_stmt|;
if|if
condition|(
name|parse_color
argument_list|(
operator|&
name|foreground
argument_list|)
operator|==
name|ERROR
condition|)
goto|goto
name|error
goto|;
name|foreground
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"background"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_BACKGROUND
expr_stmt|;
if|if
condition|(
name|parse_color
argument_list|(
operator|&
name|background
argument_list|)
operator|==
name|ERROR
condition|)
goto|goto
name|error
goto|;
name|background
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"brush"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_BRUSH
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|brush_name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"pattern"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_PATTERN
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pattern_name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"gradient"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_GRADIENT
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|gradient_name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
else|else
goto|goto
name|error
goto|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|devices_rc_update
argument_list|(
name|name
argument_list|,
name|values
argument_list|,
name|mode
argument_list|,
name|num_axes
argument_list|,
name|axes
argument_list|,
name|num_keys
argument_list|,
name|keys
argument_list|,
name|tool_name
argument_list|,
operator|&
name|foreground
argument_list|,
operator|&
name|background
argument_list|,
name|brush_name
argument_list|,
name|pattern_name
argument_list|,
name|gradient_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tool_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|brush_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pattern_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradient_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|axes
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|keys
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|brush_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pattern_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|gradient_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|axes
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|keys
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_session_info (gpointer val1p,gpointer val2p)
name|parse_session_info
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|GimpDialogFactory
modifier|*
name|factory
decl_stmt|;
name|GimpSessionInfo
modifier|*
name|info
init|=
name|NULL
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|factory
operator|=
name|gimp_dialog_factory_from_name
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|factory
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|=
name|g_new0
argument_list|(
name|GimpSessionInfo
argument_list|,
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|token_str
argument_list|,
literal|"dock"
argument_list|)
condition|)
block|{
name|info
operator|->
name|toplevel_entry
operator|=
name|gimp_dialog_factory_find_entry
argument_list|(
name|factory
argument_list|,
name|token_str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|info
operator|->
name|toplevel_entry
condition|)
goto|goto
name|error
goto|;
block|}
comment|/* Parse options for session info */
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_LEFT_PAREN
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"position"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|->
name|x
operator|=
name|token_int
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|->
name|y
operator|=
name|token_int
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"size"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|->
name|width
operator|=
name|token_int
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|->
name|height
operator|=
name|token_int
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"open-on-exit"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|info
operator|->
name|open
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"aux-info"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_STRING
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|->
name|aux_info
operator|=
name|g_list_append
argument_list|(
name|info
operator|->
name|aux_info
argument_list|,
name|g_strdup
argument_list|(
name|token_str
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"dock"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
if|if
condition|(
name|info
operator|->
name|toplevel_entry
condition|)
goto|goto
name|error
goto|;
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_LEFT_PAREN
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|->
name|sub_dialogs
operator|=
name|g_list_prepend
argument_list|(
name|info
operator|->
name|sub_dialogs
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_STRING
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|info
operator|->
name|sub_dialogs
operator|->
name|data
operator|=
name|g_list_append
argument_list|(
name|info
operator|->
name|sub_dialogs
operator|->
name|data
argument_list|,
name|g_strdup
argument_list|(
name|token_str
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|g_list_length
argument_list|(
name|info
operator|->
name|sub_dialogs
operator|->
name|data
argument_list|)
condition|)
block|{
name|info
operator|->
name|sub_dialogs
operator|=
name|g_list_remove
argument_list|(
name|info
operator|->
name|sub_dialogs
argument_list|,
name|info
operator|->
name|sub_dialogs
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
block|}
name|info
operator|->
name|sub_dialogs
operator|=
name|g_list_reverse
argument_list|(
name|info
operator|->
name|sub_dialogs
argument_list|)
expr_stmt|;
block|}
else|else
block|{
goto|goto
name|error
goto|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|factory
operator|->
name|session_infos
operator|=
name|g_list_append
argument_list|(
name|factory
operator|->
name|session_infos
argument_list|,
name|info
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
if|if
condition|(
name|info
condition|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
for|for
control|(
name|list
operator|=
name|info
operator|->
name|sub_dialogs
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|g_list_foreach
argument_list|(
name|list
operator|->
name|data
argument_list|,
operator|(
name|GFunc
operator|)
name|g_free
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_list_free
argument_list|(
name|list
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|info
operator|->
name|sub_dialogs
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|info
argument_list|)
expr_stmt|;
block|}
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_color_history (gpointer val1p,gpointer val2p)
name|parse_color_history
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
init|=
literal|0
decl_stmt|;
name|GimpRGB
name|color
decl_stmt|;
comment|/* Parse one color per line: (color r g b a) */
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_LEFT_PAREN
condition|)
block|{
if|if
condition|(
name|parse_color
argument_list|(
operator|&
name|color
argument_list|)
operator|==
name|ERROR
condition|)
return|return
name|ERROR
return|;
name|color_history_add_color_from_rc
argument_list|(
operator|&
name|color
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_unit_info (gpointer val1p,gpointer val2p)
name|parse_unit_info
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|GimpUnit
name|unit
decl_stmt|;
name|gchar
modifier|*
name|identifier
init|=
name|NULL
decl_stmt|;
name|gdouble
name|factor
init|=
literal|1.0
decl_stmt|;
name|gint
name|digits
init|=
literal|2.0
decl_stmt|;
name|gchar
modifier|*
name|symbol
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|abbreviation
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|singular
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|plural
init|=
name|NULL
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|identifier
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
comment|/* Parse options for unit info */
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_LEFT_PAREN
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"factor"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|factor
operator|=
name|token_num
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"digits"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|digits
operator|=
name|token_int
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"symbol"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|symbol
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"abbreviation"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|abbreviation
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"singular"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|singular
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"plural"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|plural
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
else|else
goto|goto
name|error
goto|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|unit
operator|=
name|gimp_unit_new
argument_list|(
name|identifier
argument_list|,
name|factor
argument_list|,
name|digits
argument_list|,
name|symbol
argument_list|,
name|abbreviation
argument_list|,
name|singular
argument_list|,
name|plural
argument_list|)
expr_stmt|;
comment|/*  make the unit definition persistent  */
name|gimp_unit_set_deletion_flag
argument_list|(
name|unit
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|identifier
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|symbol
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|abbreviation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|singular
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|plural
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|identifier
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|symbol
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|abbreviation
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|singular
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|plural
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_parasite (gpointer val1p,gpointer val2p)
name|parse_parasite
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|gint
name|res
init|=
name|ERROR
decl_stmt|;
name|gchar
modifier|*
name|identifier
init|=
name|NULL
decl_stmt|;
name|gulong
name|flags
init|=
literal|0
decl_stmt|;
name|GimpParasite
modifier|*
name|parasite
decl_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|TOKEN_STRING
condition|)
goto|goto
name|error
goto|;
name|identifier
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
comment|/* possible future extension: allow flags as symbolic strings.  */
if|if
condition|(
name|token
operator|==
name|TOKEN_NUMBER
condition|)
name|flags
operator||=
name|token_int
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|TOKEN_STRING
condition|)
goto|goto
name|error
goto|;
name|parasite
operator|=
name|gimp_parasite_new
argument_list|(
name|identifier
argument_list|,
name|flags
argument_list|,
name|token_int
argument_list|,
name|token_str
argument_list|)
expr_stmt|;
name|gimp_parasite_attach
argument_list|(
name|the_gimp
argument_list|,
name|parasite
argument_list|)
expr_stmt|;
comment|/* attaches a copy */
name|gimp_parasite_free
argument_list|(
name|parasite
argument_list|)
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
condition|)
goto|goto
name|error
goto|;
name|res
operator|=
name|OK
expr_stmt|;
name|error
label|:
name|g_free
argument_list|(
name|identifier
argument_list|)
expr_stmt|;
return|return
name|res
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_help_browser (gpointer val1p,gpointer val2p)
name|parse_help_browser
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
name|token
operator|!=
name|TOKEN_SYMBOL
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"gimp"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|help_browser
operator|=
name|HELP_BROWSER_GIMP
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"netscape"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|help_browser
operator|=
name|HELP_BROWSER_NETSCAPE
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_cursor_mode (gpointer val1p,gpointer val2p)
name|parse_cursor_mode
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
name|token
operator|!=
name|TOKEN_SYMBOL
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"tool-icon"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|cursor_mode
operator|=
name|CURSOR_MODE_TOOL_ICON
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"tool-crosshair"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|cursor_mode
operator|=
name|CURSOR_MODE_TOOL_CROSSHAIR
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"crosshair"
argument_list|)
operator|==
literal|0
condition|)
name|gimprc
operator|.
name|cursor_mode
operator|=
name|CURSOR_MODE_CROSSHAIR
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_document (gpointer val1p,gpointer val2p)
name|parse_document
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|token
init|=
literal|0
decl_stmt|;
name|gchar
modifier|*
name|filename
init|=
name|NULL
decl_stmt|;
name|GimpImagefile
modifier|*
name|imagefile
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
name|token
operator|!=
name|TOKEN_STRING
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|filename
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|imagefile
operator|=
name|gimp_imagefile_new
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|GIMP_LIST
argument_list|(
name|the_gimp
operator|->
name|documents
argument_list|)
operator|->
name|list
operator|=
name|g_list_append
argument_list|(
name|GIMP_LIST
argument_list|(
name|the_gimp
operator|->
name|documents
argument_list|)
operator|->
name|list
argument_list|,
name|imagefile
argument_list|)
expr_stmt|;
name|gtk_object_ref
argument_list|(
name|GTK_OBJECT
argument_list|(
name|imagefile
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_object_sink
argument_list|(
name|GTK_OBJECT
argument_list|(
name|imagefile
argument_list|)
argument_list|)
expr_stmt|;
name|the_gimp
operator|->
name|documents
operator|->
name|num_children
operator|++
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|parse_unknown (gchar * token_sym)
name|parse_unknown
parameter_list|(
name|gchar
modifier|*
name|token_sym
parameter_list|)
block|{
name|gint
name|token
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
name|UnknownToken
modifier|*
name|tmp
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
name|token_sym
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|ut
operator|->
name|token
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|ut
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|ut
operator|->
name|token
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|ut
operator|->
name|value
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|ut
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
comment|/*  search through the list of unknown tokens and replace an existing entry  */
name|list
operator|=
name|unknown_tokens
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|tmp
operator|=
operator|(
name|UnknownToken
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|tmp
operator|->
name|token
argument_list|,
name|ut
operator|->
name|token
argument_list|)
operator|==
literal|0
condition|)
block|{
name|unknown_tokens
operator|=
name|g_list_remove
argument_list|(
name|unknown_tokens
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
operator|->
name|token
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
operator|->
name|value
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
block|}
name|ut
operator|->
name|value
operator|=
name|transform_path
argument_list|(
name|ut
operator|->
name|value
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
name|gchar
modifier|*
DECL|function|gimprc_value_to_str (gchar * name)
name|gimprc_value_to_str
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
block|{
return|return
name|value_to_str
argument_list|(
name|name
argument_list|)
return|;
comment|/* had a namespace collision */
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|value_to_str (gchar * name)
name|value_to_str
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|ParseFunc
modifier|*
name|func
decl_stmt|;
name|func
operator|=
name|g_hash_table_lookup
argument_list|(
name|parse_func_hash
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|func
condition|)
block|{
switch|switch
condition|(
name|func
operator|->
name|type
condition|)
block|{
case|case
name|TT_STRING
case|:
return|return
name|string_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_PATH
case|:
return|return
name|path_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_DOUBLE
case|:
return|return
name|double_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_FLOAT
case|:
return|return
name|float_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_INT
case|:
return|return
name|int_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_BOOLEAN
case|:
return|return
name|boolean_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_POSITION
case|:
return|return
name|position_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_MEMSIZE
case|:
return|return
name|mem_size_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_IMAGETYPE
case|:
return|return
name|image_type_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_INTERP
case|:
return|return
name|interpolation_type_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XPREVSIZE
case|:
return|return
name|preview_size_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XNAVPREVSIZE
case|:
return|return
name|nav_preview_size_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XUNIT
case|:
return|return
name|units_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XHELPBROWSER
case|:
return|return
name|help_browser_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XCURSORMODE
case|:
return|return
name|cursor_mode_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XCOMMENT
case|:
return|return
name|comment_to_str
argument_list|(
name|func
operator|->
name|val1p
argument_list|,
name|func
operator|->
name|val2p
argument_list|)
return|;
case|case
name|TT_XPLUGIN
case|:
case|case
name|TT_XPLUGINDEF
case|:
case|case
name|TT_XMENUPATH
case|:
case|case
name|TT_XDEVICE
case|:
case|case
name|TT_XSESSIONINFO
case|:
case|case
name|TT_XCOLORHISTORY
case|:
case|case
name|TT_XUNITINFO
case|:
case|case
name|TT_XPARASITE
case|:
case|case
name|TT_XDOCUMENT
case|:
return|return
name|NULL
return|;
block|}
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|string_to_str (gpointer val1p,gpointer val2p)
name|string_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gchar
modifier|*
name|str
init|=
name|gimp_strescape
argument_list|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|)
name|val1p
operator|)
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|retval
decl_stmt|;
name|retval
operator|=
name|g_strdup_printf
argument_list|(
literal|"%c%s%c"
argument_list|,
literal|'"'
argument_list|,
name|str
argument_list|,
literal|'"'
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
return|return
name|retval
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|path_to_str (gpointer val1p,gpointer val2p)
name|path_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
return|return
name|string_to_str
argument_list|(
name|val1p
argument_list|,
name|val2p
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|double_to_str (gpointer val1p,gpointer val2p)
name|double_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
return|return
name|g_strdup_printf
argument_list|(
literal|"%f"
argument_list|,
operator|*
operator|(
operator|(
name|gdouble
operator|*
operator|)
name|val1p
operator|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|float_to_str (gpointer val1p,gpointer val2p)
name|float_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
return|return
name|g_strdup_printf
argument_list|(
literal|"%f"
argument_list|,
call|(
name|gdouble
call|)
argument_list|(
operator|*
operator|(
operator|(
name|float
operator|*
operator|)
name|val1p
operator|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|int_to_str (gpointer val1p,gpointer val2p)
name|int_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
return|return
name|g_strdup_printf
argument_list|(
literal|"%d"
argument_list|,
operator|*
operator|(
operator|(
name|gint
operator|*
operator|)
name|val1p
operator|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|boolean_to_str (gpointer val1p,gpointer val2p)
name|boolean_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|v
decl_stmt|;
if|if
condition|(
name|val1p
operator|!=
name|NULL
condition|)
name|v
operator|=
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val1p
operator|)
expr_stmt|;
else|else
name|v
operator|=
operator|!
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val2p
operator|)
expr_stmt|;
if|if
condition|(
name|v
condition|)
return|return
name|g_strdup
argument_list|(
literal|"yes"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"no"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|position_to_str (gpointer val1p,gpointer val2p)
name|position_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
return|return
name|g_strdup_printf
argument_list|(
literal|"%d %d"
argument_list|,
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val1p
operator|)
argument_list|,
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val2p
operator|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|mem_size_to_str (gpointer val1p,gpointer val2p)
name|mem_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|guint
name|size
decl_stmt|;
name|size
operator|=
operator|*
operator|(
operator|(
name|guint
operator|*
operator|)
name|val1p
operator|)
expr_stmt|;
if|if
condition|(
name|size
operator|%
literal|1048576
operator|==
literal|0
condition|)
return|return
name|g_strdup_printf
argument_list|(
literal|"%dM"
argument_list|,
name|size
operator|/
literal|1048576
argument_list|)
return|;
elseif|else
if|if
condition|(
name|size
operator|%
literal|1024
operator|==
literal|0
condition|)
return|return
name|g_strdup_printf
argument_list|(
literal|"%dK"
argument_list|,
name|size
operator|/
literal|1024
argument_list|)
return|;
else|else
return|return
name|g_strdup_printf
argument_list|(
literal|"%dB"
argument_list|,
name|size
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|image_type_to_str (gpointer val1p,gpointer val2p)
name|image_type_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gint
name|type
decl_stmt|;
name|type
operator|=
operator|*
operator|(
operator|(
name|gint
operator|*
operator|)
name|val1p
operator|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|GRAY
condition|)
return|return
name|g_strdup
argument_list|(
literal|"gray"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"rgb"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|interpolation_type_to_str (gpointer val1p,gpointer val2p)
name|interpolation_type_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|InterpolationType
name|type
decl_stmt|;
name|type
operator|=
operator|*
operator|(
operator|(
name|InterpolationType
operator|*
operator|)
name|val1p
operator|)
expr_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|LINEAR_INTERPOLATION
case|:
return|return
name|g_strdup
argument_list|(
literal|"linear"
argument_list|)
return|;
case|case
name|CUBIC_INTERPOLATION
case|:
return|return
name|g_strdup
argument_list|(
literal|"cubic"
argument_list|)
return|;
case|case
name|NEAREST_NEIGHBOR_INTERPOLATION
case|:
return|return
name|g_strdup
argument_list|(
literal|"nearest-neighbor"
argument_list|)
return|;
default|default:
return|return
name|g_strdup
argument_list|(
literal|"bad interpolation type"
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|preview_size_to_str (gpointer val1p,gpointer val2p)
name|preview_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
if|if
condition|(
name|gimprc
operator|.
name|preview_size
operator|>=
literal|128
condition|)
return|return
name|g_strdup
argument_list|(
literal|"huge"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|gimprc
operator|.
name|preview_size
operator|>=
literal|64
condition|)
return|return
name|g_strdup
argument_list|(
literal|"large"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|gimprc
operator|.
name|preview_size
operator|>=
literal|48
condition|)
return|return
name|g_strdup
argument_list|(
literal|"medium"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|gimprc
operator|.
name|preview_size
operator|>=
literal|32
condition|)
return|return
name|g_strdup
argument_list|(
literal|"small"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|gimprc
operator|.
name|preview_size
operator|>=
literal|24
condition|)
return|return
name|g_strdup
argument_list|(
literal|"tiny"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"none"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|nav_preview_size_to_str (gpointer val1p,gpointer val2p)
name|nav_preview_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
if|if
condition|(
name|gimprc
operator|.
name|nav_preview_size
operator|>=
literal|112
condition|)
return|return
name|g_strdup
argument_list|(
literal|"large"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|gimprc
operator|.
name|nav_preview_size
operator|>=
literal|80
condition|)
return|return
name|g_strdup
argument_list|(
literal|"medium"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|gimprc
operator|.
name|nav_preview_size
operator|>=
literal|48
condition|)
return|return
name|g_strdup
argument_list|(
literal|"small"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"large"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|units_to_str (gpointer val1p,gpointer val2p)
name|units_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
return|return
name|g_strdup
argument_list|(
name|gimp_unit_get_identifier
argument_list|(
operator|*
operator|(
operator|(
name|GimpUnit
operator|*
operator|)
name|val1p
operator|)
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|help_browser_to_str (gpointer val1p,gpointer val2p)
name|help_browser_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
if|if
condition|(
name|gimprc
operator|.
name|help_browser
operator|==
name|HELP_BROWSER_NETSCAPE
condition|)
return|return
name|g_strdup
argument_list|(
literal|"netscape"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"gimp"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|cursor_mode_to_str (gpointer val1p,gpointer val2p)
name|cursor_mode_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
if|if
condition|(
name|gimprc
operator|.
name|cursor_mode
operator|==
name|CURSOR_MODE_TOOL_ICON
condition|)
return|return
name|g_strdup
argument_list|(
literal|"tool-icon"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|gimprc
operator|.
name|cursor_mode
operator|==
name|CURSOR_MODE_TOOL_CROSSHAIR
condition|)
return|return
name|g_strdup
argument_list|(
literal|"tool-crosshair"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"crosshair"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|inline
name|gchar
modifier|*
DECL|function|comment_to_str (gpointer val1p,gpointer val2p)
name|comment_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|gchar
modifier|*
modifier|*
name|str_array
decl_stmt|;
name|gchar
modifier|*
name|retval
decl_stmt|;
name|gchar
modifier|*
name|str
init|=
name|gimp_strescape
argument_list|(
operator|*
operator|(
operator|(
name|gchar
operator|*
operator|*
operator|)
name|val1p
operator|)
argument_list|,
name|NULL
argument_list|)
decl_stmt|;
name|str_array
operator|=
name|g_strsplit
argument_list|(
name|str
argument_list|,
literal|"\n"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strjoinv
argument_list|(
literal|"\\n"
argument_list|,
name|str_array
argument_list|)
expr_stmt|;
name|g_strfreev
argument_list|(
name|str_array
argument_list|)
expr_stmt|;
name|retval
operator|=
name|g_strdup_printf
argument_list|(
literal|"%c%s%c"
argument_list|,
literal|'"'
argument_list|,
name|str
argument_list|,
literal|'"'
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
return|return
name|retval
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|add_gimp_directory_token (const gchar * gimp_dir)
name|add_gimp_directory_token
parameter_list|(
specifier|const
name|gchar
modifier|*
name|gimp_dir
parameter_list|)
block|{
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
comment|/* The token holds data from a static buffer which is initialized    * once.  There should be no need to change an already-existing    * value.    */
if|if
condition|(
name|NULL
operator|!=
name|gimprc_find_token
argument_list|(
literal|"gimp_dir"
argument_list|)
condition|)
return|return;
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
literal|"gimp_dir"
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|gimp_dir
argument_list|)
expr_stmt|;
comment|/* Similarly, transforming the path should be silly. */
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
comment|/* While we're at it, also add the token gimp_install_dir */
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
literal|"gimp_install_dir"
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
operator|(
name|gchar
operator|*
operator|)
name|gimp_data_directory
argument_list|()
expr_stmt|;
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|__EMX__
end_ifdef

begin_function
specifier|static
name|void
DECL|function|add_x11root_token (gchar * x11root)
name|add_x11root_token
parameter_list|(
name|gchar
modifier|*
name|x11root
parameter_list|)
block|{
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
if|if
condition|(
name|x11root
operator|==
name|NULL
condition|)
return|return;
comment|/*     The token holds data from a static buffer which is initialized     once.  There should be no need to change an already-existing     value.   */
if|if
condition|(
name|gimprc_find_token
argument_list|(
literal|"x11root"
argument_list|)
operator|!=
name|NULL
condition|)
return|return;
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
literal|"x11root"
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|x11root
argument_list|)
expr_stmt|;
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* Try to:     1. Open the personal file for reading.     1b. If that fails, try to open the system (overriding) file     2. If we could open the personal file, rename it to file.old.     3. Open personal file for writing.     On success, return NULL. On failure, return a string in English    explaining the problem.     */
end_comment

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|open_backup_file (gchar * filename,gchar * secondary_filename,gchar ** name_used,FILE ** fp_new,FILE ** fp_old)
name|open_backup_file
parameter_list|(
name|gchar
modifier|*
name|filename
parameter_list|,
name|gchar
modifier|*
name|secondary_filename
parameter_list|,
name|gchar
modifier|*
modifier|*
name|name_used
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_new
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_old
parameter_list|)
block|{
name|gchar
modifier|*
name|oldfilename
init|=
name|NULL
decl_stmt|;
comment|/* Rename the file to *.old, open it for reading and create the new file. */
if|if
condition|(
operator|(
operator|*
name|fp_old
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"rt"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
operator|(
operator|*
name|fp_old
operator|=
name|fopen
argument_list|(
name|secondary_filename
argument_list|,
literal|"rt"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
return|return
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Can't open %s; %s"
argument_list|)
argument_list|,
name|secondary_filename
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
return|;
block|}
else|else
operator|*
name|name_used
operator|=
name|secondary_filename
expr_stmt|;
block|}
else|else
block|{
operator|*
name|name_used
operator|=
name|filename
expr_stmt|;
name|oldfilename
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s.old"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|G_OS_WIN32
argument_list|)
operator|||
name|defined
argument_list|(
name|__EMX__
argument_list|)
comment|/* Can't rename open files... */
name|fclose
argument_list|(
operator|*
name|fp_old
argument_list|)
expr_stmt|;
comment|/* Also, can't rename to an existing file name */
name|unlink
argument_list|(
name|oldfilename
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|rename
argument_list|(
name|filename
argument_list|,
name|oldfilename
argument_list|)
operator|<
literal|0
condition|)
block|{
name|g_free
argument_list|(
name|oldfilename
argument_list|)
expr_stmt|;
return|return
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Can't rename %s to %s.old; %s"
argument_list|)
argument_list|,
name|filename
argument_list|,
name|filename
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
return|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|G_OS_WIN32
argument_list|)
operator|||
name|defined
argument_list|(
name|__EMX__
argument_list|)
comment|/* Can't rename open files... */
if|if
condition|(
operator|(
operator|*
name|fp_old
operator|=
name|fopen
argument_list|(
name|oldfilename
argument_list|,
literal|"rt"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
name|g_error
argument_list|(
name|_
argument_list|(
literal|"Couldn't reopen %s\n"
argument_list|)
argument_list|,
name|oldfilename
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
if|if
condition|(
operator|(
operator|*
name|fp_new
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"w"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|oldfilename
operator|!=
name|NULL
condition|)
block|{
comment|/* Undo the renaming... */
operator|(
name|void
operator|)
name|rename
argument_list|(
name|oldfilename
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|oldfilename
argument_list|)
expr_stmt|;
block|}
return|return
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"Can't write to %s; %s"
argument_list|)
argument_list|,
name|filename
argument_list|,
name|g_strerror
argument_list|(
name|errno
argument_list|)
argument_list|)
return|;
block|}
if|if
condition|(
name|oldfilename
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|oldfilename
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|gchar
modifier|*
DECL|function|gimprc_find_token (gchar * token)
name|gimprc_find_token
parameter_list|(
name|gchar
modifier|*
name|token
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
for|for
control|(
name|list
operator|=
name|unknown_tokens
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|ut
operator|=
operator|(
name|UnknownToken
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|ut
operator|->
name|token
argument_list|,
name|token
argument_list|)
operator|==
literal|0
condition|)
return|return
name|ut
operator|->
name|value
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimprc_set_token (gchar * token,gchar * value)
name|gimprc_set_token
parameter_list|(
name|gchar
modifier|*
name|token
parameter_list|,
name|gchar
modifier|*
name|value
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
for|for
control|(
name|list
operator|=
name|unknown_tokens
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|ut
operator|=
operator|(
name|UnknownToken
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|ut
operator|->
name|token
argument_list|,
name|token
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ut
operator|->
name|value
operator|!=
name|value
condition|)
block|{
if|if
condition|(
name|ut
operator|->
name|value
condition|)
name|g_free
argument_list|(
name|ut
operator|->
name|value
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|value
expr_stmt|;
block|}
break|break;
block|}
block|}
block|}
end_function

end_unit

