begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<errno.h>
end_include

begin_include
include|#
directive|include
file|<sys/stat.h>
end_include

begin_include
include|#
directive|include
file|<glib.h>
end_include

begin_include
include|#
directive|include
file|"app_procs.h"
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"devices.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"fileops.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"menus.h"
end_include

begin_include
include|#
directive|include
file|"plug_in.h"
end_include

begin_include
include|#
directive|include
file|"gimage.h"
end_include

begin_include
include|#
directive|include
file|"tools.h"
end_include

begin_define
DECL|macro|ERROR
define|#
directive|define
name|ERROR
value|0
end_define

begin_define
DECL|macro|DONE
define|#
directive|define
name|DONE
value|1
end_define

begin_define
DECL|macro|OK
define|#
directive|define
name|OK
value|2
end_define

begin_typedef
DECL|enum|__anon2c6459bd0103
typedef|typedef
enum|enum
block|{
DECL|enumerator|TT_STRING
name|TT_STRING
block|,
DECL|enumerator|TT_PATH
name|TT_PATH
block|,
DECL|enumerator|TT_DOUBLE
name|TT_DOUBLE
block|,
DECL|enumerator|TT_INT
name|TT_INT
block|,
DECL|enumerator|TT_BOOLEAN
name|TT_BOOLEAN
block|,
DECL|enumerator|TT_POSITION
name|TT_POSITION
block|,
DECL|enumerator|TT_MEMSIZE
name|TT_MEMSIZE
block|,
DECL|enumerator|TT_IMAGETYPE
name|TT_IMAGETYPE
block|,
DECL|enumerator|TT_XCOLORCUBE
name|TT_XCOLORCUBE
block|,
DECL|enumerator|TT_XPREVSIZE
name|TT_XPREVSIZE
block|,
DECL|enumerator|TT_XRULERUNIT
name|TT_XRULERUNIT
block|,
DECL|enumerator|TT_XPLUGIN
name|TT_XPLUGIN
block|,
DECL|enumerator|TT_XPLUGINDEF
name|TT_XPLUGINDEF
block|,
DECL|enumerator|TT_XMENUPATH
name|TT_XMENUPATH
block|,
DECL|enumerator|TT_XDEVICE
name|TT_XDEVICE
DECL|typedef|TokenType
block|}
name|TokenType
typedef|;
end_typedef

begin_typedef
DECL|typedef|ParseFunc
typedef|typedef
name|struct
name|_ParseFunc
name|ParseFunc
typedef|;
end_typedef

begin_struct
DECL|struct|_ParseFunc
struct|struct
name|_ParseFunc
block|{
DECL|member|name
name|char
modifier|*
name|name
decl_stmt|;
DECL|member|type
name|TokenType
name|type
decl_stmt|;
DECL|member|val1p
name|gpointer
name|val1p
decl_stmt|;
DECL|member|val2p
name|gpointer
name|val2p
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|UnknownToken
typedef|typedef
name|struct
name|_UnknownToken
name|UnknownToken
typedef|;
end_typedef

begin_struct
DECL|struct|_UnknownToken
struct|struct
name|_UnknownToken
block|{
DECL|member|token
name|char
modifier|*
name|token
decl_stmt|;
DECL|member|value
name|char
modifier|*
name|value
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  global gimprc variables  */
end_comment

begin_decl_stmt
DECL|variable|plug_in_path
name|char
modifier|*
name|plug_in_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|temp_path
name|char
modifier|*
name|temp_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|swap_path
name|char
modifier|*
name|swap_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|brush_path
name|char
modifier|*
name|brush_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_brush
name|char
modifier|*
name|default_brush
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pattern_path
name|char
modifier|*
name|pattern_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_pattern
name|char
modifier|*
name|default_pattern
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|palette_path
name|char
modifier|*
name|palette_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_palette
name|char
modifier|*
name|default_palette
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gradient_path
name|char
modifier|*
name|gradient_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_gradient
name|char
modifier|*
name|default_gradient
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|pluginrc_path
name|char
modifier|*
name|pluginrc_path
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tile_cache_size
name|int
name|tile_cache_size
init|=
literal|4194304
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|tile_cache_size
comment|/* 4 MB */
end_comment

begin_decl_stmt
DECL|variable|marching_speed
name|int
name|marching_speed
init|=
literal|150
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|marching_speed
comment|/* 150 ms */
end_comment

begin_decl_stmt
DECL|variable|gamma_val
name|double
name|gamma_val
init|=
literal|1.0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|transparency_type
name|int
name|transparency_type
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|transparency_type
comment|/* Mid-Tone Checks */
end_comment

begin_decl_stmt
DECL|variable|transparency_size
name|int
name|transparency_size
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|transparency_size
comment|/* Medium sized */
end_comment

begin_decl_stmt
DECL|variable|levels_of_undo
name|int
name|levels_of_undo
init|=
literal|1
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|levels_of_undo
comment|/* 1 level of undo default */
end_comment

begin_decl_stmt
DECL|variable|color_cube_shades
name|int
name|color_cube_shades
index|[
literal|4
index|]
init|=
block|{
literal|6
block|,
literal|7
block|,
literal|4
block|,
literal|24
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|install_cmap
name|int
name|install_cmap
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|cycled_marching_ants
name|int
name|cycled_marching_ants
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_threshold
name|int
name|default_threshold
init|=
literal|15
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|stingy_memory_use
name|int
name|stingy_memory_use
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|allow_resize_windows
name|int
name|allow_resize_windows
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|no_cursor_updating
name|int
name|no_cursor_updating
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|preview_size
name|int
name|preview_size
init|=
literal|64
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|show_rulers
name|int
name|show_rulers
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|ruler_units
name|int
name|ruler_units
init|=
name|GTK_PIXELS
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|auto_save
name|int
name|auto_save
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|cubic_interpolation
name|int
name|cubic_interpolation
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|toolbox_x
DECL|variable|toolbox_y
name|int
name|toolbox_x
init|=
literal|0
decl_stmt|,
name|toolbox_y
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|lc_x
DECL|variable|lc_y
name|int
name|lc_x
init|=
literal|0
decl_stmt|,
name|lc_y
init|=
literal|400
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|progress_x
DECL|variable|progress_y
name|int
name|progress_x
init|=
literal|170
decl_stmt|,
name|progress_y
init|=
literal|5
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|info_x
DECL|variable|info_y
name|int
name|info_x
init|=
literal|165
decl_stmt|,
name|info_y
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|color_select_x
DECL|variable|color_select_y
name|int
name|color_select_x
init|=
literal|140
decl_stmt|,
name|color_select_y
init|=
literal|120
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|tool_options_x
DECL|variable|tool_options_y
name|int
name|tool_options_x
init|=
literal|0
decl_stmt|,
name|tool_options_y
init|=
literal|345
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|confirm_on_close
name|int
name|confirm_on_close
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|save_window_positions_on_exit
name|int
name|save_window_positions_on_exit
init|=
name|FALSE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_width
name|int
name|default_width
init|=
literal|256
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_height
name|int
name|default_height
init|=
literal|256
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_type
name|int
name|default_type
init|=
name|RGB
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_resolution
name|int
name|default_resolution
init|=
literal|72
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_resolution_units
name|int
name|default_resolution_units
init|=
name|GTK_INCHES
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_width_units
name|int
name|default_width_units
init|=
name|GTK_INCHES
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|default_height_units
name|int
name|default_height_units
init|=
name|GTK_INCHES
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|show_tips
name|int
name|show_tips
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|last_tip
name|int
name|last_tip
init|=
operator|-
literal|1
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|show_tool_tips
name|int
name|show_tool_tips
init|=
name|TRUE
decl_stmt|;
end_decl_stmt

begin_function_decl
specifier|static
name|int
name|get_next_token
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|peek_next_token
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_statement
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_string
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_double
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_int
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_boolean
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_position
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_mem_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_image_type
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_color_cube
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_preview_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_ruler_units
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_plug_in
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_plug_in_def
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_device
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_menu_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_proc_def
parameter_list|(
name|PlugInProcDef
modifier|*
modifier|*
name|proc_def
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_proc_arg
parameter_list|(
name|ProcArg
modifier|*
name|arg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|parse_unknown
parameter_list|(
name|char
modifier|*
name|token_sym
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|value_to_str
parameter_list|(
name|char
modifier|*
name|name
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|string_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|path_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|double_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|int_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|boolean_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|position_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|mem_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|image_type_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|color_cube_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|preview_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|ruler_units_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|transform_path
parameter_list|(
name|char
modifier|*
name|path
parameter_list|,
name|int
name|destroy
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|gimprc_find_token
parameter_list|(
name|char
modifier|*
name|token
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimprc_set_token
parameter_list|(
name|char
modifier|*
name|token
parameter_list|,
name|char
modifier|*
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|gimprc_query
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|add_gimp_directory_token
parameter_list|(
name|char
modifier|*
name|gimp_dir
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|char
modifier|*
name|open_backup_file
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_new
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_old
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|parse_info
specifier|static
name|ParseInfo
name|parse_info
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|unknown_tokens
specifier|static
name|GList
modifier|*
name|unknown_tokens
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|cur_token
specifier|static
name|int
name|cur_token
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|next_token
specifier|static
name|int
name|next_token
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|done
specifier|static
name|int
name|done
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|funcs
specifier|static
name|ParseFunc
name|funcs
index|[]
init|=
block|{
block|{
literal|"temp-path"
block|,
name|TT_PATH
block|,
operator|&
name|temp_path
block|,
name|NULL
block|}
block|,
block|{
literal|"swap-path"
block|,
name|TT_PATH
block|,
operator|&
name|swap_path
block|,
name|NULL
block|}
block|,
block|{
literal|"brush-path"
block|,
name|TT_PATH
block|,
operator|&
name|brush_path
block|,
name|NULL
block|}
block|,
block|{
literal|"pattern-path"
block|,
name|TT_PATH
block|,
operator|&
name|pattern_path
block|,
name|NULL
block|}
block|,
block|{
literal|"plug-in-path"
block|,
name|TT_PATH
block|,
operator|&
name|plug_in_path
block|,
name|NULL
block|}
block|,
block|{
literal|"palette-path"
block|,
name|TT_PATH
block|,
operator|&
name|palette_path
block|,
name|NULL
block|}
block|,
block|{
literal|"gradient-path"
block|,
name|TT_PATH
block|,
operator|&
name|gradient_path
block|,
name|NULL
block|}
block|,
block|{
literal|"pluginrc-path"
block|,
name|TT_PATH
block|,
operator|&
name|pluginrc_path
block|,
name|NULL
block|}
block|,
block|{
literal|"default-brush"
block|,
name|TT_STRING
block|,
operator|&
name|default_brush
block|,
name|NULL
block|}
block|,
block|{
literal|"default-pattern"
block|,
name|TT_STRING
block|,
operator|&
name|default_pattern
block|,
name|NULL
block|}
block|,
block|{
literal|"default-palette"
block|,
name|TT_STRING
block|,
operator|&
name|default_palette
block|,
name|NULL
block|}
block|,
block|{
literal|"default-gradient"
block|,
name|TT_STRING
block|,
operator|&
name|default_gradient
block|,
name|NULL
block|}
block|,
block|{
literal|"gamma-correction"
block|,
name|TT_DOUBLE
block|,
operator|&
name|gamma_val
block|,
name|NULL
block|}
block|,
block|{
literal|"color-cube"
block|,
name|TT_XCOLORCUBE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"tile-cache-size"
block|,
name|TT_MEMSIZE
block|,
operator|&
name|tile_cache_size
block|,
name|NULL
block|}
block|,
block|{
literal|"marching-ants-speed"
block|,
name|TT_INT
block|,
operator|&
name|marching_speed
block|,
name|NULL
block|}
block|,
block|{
literal|"undo-levels"
block|,
name|TT_INT
block|,
operator|&
name|levels_of_undo
block|,
name|NULL
block|}
block|,
block|{
literal|"transparency-type"
block|,
name|TT_INT
block|,
operator|&
name|transparency_type
block|,
name|NULL
block|}
block|,
block|{
literal|"transparency-size"
block|,
name|TT_INT
block|,
operator|&
name|transparency_size
block|,
name|NULL
block|}
block|,
block|{
literal|"install-colormap"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|install_cmap
block|,
name|NULL
block|}
block|,
block|{
literal|"colormap-cycling"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|cycled_marching_ants
block|,
name|NULL
block|}
block|,
block|{
literal|"default-threshold"
block|,
name|TT_INT
block|,
operator|&
name|default_threshold
block|,
name|NULL
block|}
block|,
block|{
literal|"stingy-memory-use"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|stingy_memory_use
block|,
name|NULL
block|}
block|,
block|{
literal|"allow-resize-windows"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|allow_resize_windows
block|,
name|NULL
block|}
block|,
block|{
literal|"cursor-updating"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
name|no_cursor_updating
block|}
block|,
block|{
literal|"no-cursor-updating"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|no_cursor_updating
block|,
name|NULL
block|}
block|,
block|{
literal|"preview-size"
block|,
name|TT_XPREVSIZE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"show-rulers"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|show_rulers
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-rulers"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
name|show_rulers
block|}
block|,
block|{
literal|"ruler-units"
block|,
name|TT_XRULERUNIT
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"auto-save"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|auto_save
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-auto-save"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
name|auto_save
block|}
block|,
block|{
literal|"cubic-interpolation"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|cubic_interpolation
block|,
name|NULL
block|}
block|,
block|{
literal|"toolbox-position"
block|,
name|TT_POSITION
block|,
operator|&
name|toolbox_x
block|,
operator|&
name|toolbox_y
block|}
block|,
block|{
literal|"lc-dialog-position"
block|,
name|TT_POSITION
block|,
operator|&
name|lc_x
block|,
operator|&
name|lc_y
block|}
block|,
block|{
literal|"progress-position"
block|,
name|TT_POSITION
block|,
operator|&
name|progress_x
block|,
operator|&
name|progress_y
block|}
block|,
block|{
literal|"info-position"
block|,
name|TT_POSITION
block|,
operator|&
name|info_x
block|,
operator|&
name|info_y
block|}
block|,
block|{
literal|"color-select-position"
block|,
name|TT_POSITION
block|,
operator|&
name|color_select_x
block|,
operator|&
name|color_select_y
block|}
block|,
block|{
literal|"tool-options-position"
block|,
name|TT_POSITION
block|,
operator|&
name|tool_options_x
block|,
operator|&
name|tool_options_y
block|}
block|,
block|{
literal|"confirm-on-close"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|confirm_on_close
block|,
name|NULL
block|}
block|,
block|{
literal|"save-window-positions-on-exit"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|save_window_positions_on_exit
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-save-window-positions-on-exit"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
name|save_window_positions_on_exit
block|}
block|,
block|{
literal|"dont-confirm-on-close"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
name|confirm_on_close
block|}
block|,
block|{
literal|"show-tips"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|show_tips
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-tips"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
name|show_tips
block|}
block|,
block|{
literal|"last-tip-shown"
block|,
name|TT_INT
block|,
operator|&
name|last_tip
block|,
name|NULL
block|}
block|,
block|{
literal|"default-image-size"
block|,
name|TT_POSITION
block|,
operator|&
name|default_width
block|,
operator|&
name|default_height
block|}
block|,
block|{
literal|"default-image-type"
block|,
name|TT_IMAGETYPE
block|,
operator|&
name|default_type
block|,
name|NULL
block|}
block|,
block|{
literal|"default-resolution"
block|,
name|TT_INT
block|,
operator|&
name|default_resolution
block|,
name|NULL
block|}
block|,
block|{
literal|"default-resolution-units"
block|,
name|TT_XRULERUNIT
block|,
operator|&
name|default_resolution_units
block|,
name|NULL
block|}
block|,
block|{
literal|"plug-in"
block|,
name|TT_XPLUGIN
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"plug-in-def"
block|,
name|TT_XPLUGINDEF
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"menu-path"
block|,
name|TT_XMENUPATH
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"device"
block|,
name|TT_XDEVICE
block|,
name|NULL
block|,
name|NULL
block|}
block|,
block|{
literal|"show-tool-tips"
block|,
name|TT_BOOLEAN
block|,
operator|&
name|show_tool_tips
block|,
name|NULL
block|}
block|,
block|{
literal|"dont-show-tool-tips"
block|,
name|TT_BOOLEAN
block|,
name|NULL
block|,
operator|&
name|show_tool_tips
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|nfuncs
specifier|static
name|int
name|nfuncs
init|=
sizeof|sizeof
argument_list|(
name|funcs
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|funcs
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|MAX_GIMPDIR_LEN
define|#
directive|define
name|MAX_GIMPDIR_LEN
value|500
end_define

begin_function
name|char
modifier|*
DECL|function|gimp_directory ()
name|gimp_directory
parameter_list|()
block|{
specifier|static
name|char
name|gimp_dir
index|[
name|MAX_GIMPDIR_LEN
operator|+
literal|1
index|]
init|=
literal|""
decl_stmt|;
name|char
modifier|*
name|env_gimp_dir
decl_stmt|;
name|char
modifier|*
name|env_home_dir
decl_stmt|;
name|size_t
name|len_env_home_dir
init|=
literal|0
decl_stmt|;
if|if
condition|(
literal|'\000'
operator|!=
name|gimp_dir
index|[
literal|0
index|]
condition|)
return|return
name|gimp_dir
return|;
name|env_gimp_dir
operator|=
name|getenv
argument_list|(
literal|"GIMP_DIRECTORY"
argument_list|)
expr_stmt|;
name|env_home_dir
operator|=
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
operator|!=
name|env_home_dir
condition|)
name|len_env_home_dir
operator|=
name|strlen
argument_list|(
name|env_home_dir
argument_list|)
expr_stmt|;
if|if
condition|(
name|NULL
operator|!=
name|env_gimp_dir
condition|)
block|{
if|if
condition|(
literal|'/'
operator|==
name|env_gimp_dir
index|[
literal|0
index|]
condition|)
name|strncpy
argument_list|(
name|gimp_dir
argument_list|,
name|env_gimp_dir
argument_list|,
name|MAX_GIMPDIR_LEN
argument_list|)
expr_stmt|;
else|else
block|{
if|if
condition|(
name|NULL
operator|!=
name|env_home_dir
condition|)
block|{
name|strncpy
argument_list|(
name|gimp_dir
argument_list|,
name|env_home_dir
argument_list|,
name|MAX_GIMPDIR_LEN
argument_list|)
expr_stmt|;
name|gimp_dir
index|[
name|len_env_home_dir
index|]
operator|=
literal|'/'
expr_stmt|;
block|}
else|else
name|g_message
argument_list|(
literal|"warning: no home directory."
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|&
name|gimp_dir
index|[
name|len_env_home_dir
operator|+
literal|1
index|]
argument_list|,
name|env_gimp_dir
argument_list|,
name|MAX_GIMPDIR_LEN
operator|-
name|len_env_home_dir
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|NULL
operator|!=
name|env_home_dir
condition|)
block|{
name|strncpy
argument_list|(
name|gimp_dir
argument_list|,
name|env_home_dir
argument_list|,
name|MAX_GIMPDIR_LEN
argument_list|)
expr_stmt|;
name|gimp_dir
index|[
name|len_env_home_dir
index|]
operator|=
literal|'/'
expr_stmt|;
block|}
else|else
name|g_message
argument_list|(
literal|"warning: no home directory."
argument_list|)
expr_stmt|;
name|strncpy
argument_list|(
operator|&
name|gimp_dir
index|[
name|len_env_home_dir
operator|+
literal|1
index|]
argument_list|,
name|GIMPDIR
argument_list|,
name|MAX_GIMPDIR_LEN
operator|-
name|len_env_home_dir
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
name|gimp_dir
index|[
name|MAX_GIMPDIR_LEN
index|]
operator|=
literal|'\000'
expr_stmt|;
return|return
name|gimp_dir
return|;
block|}
end_function

begin_function
name|void
DECL|function|parse_gimprc ()
name|parse_gimprc
parameter_list|()
block|{
name|char
name|libfilename
index|[
literal|512
index|]
decl_stmt|;
name|char
name|filename
index|[
literal|512
index|]
decl_stmt|;
name|char
modifier|*
name|gimp_dir
decl_stmt|;
name|parse_info
operator|.
name|buffer
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
literal|4096
argument_list|)
expr_stmt|;
name|parse_info
operator|.
name|tokenbuf
operator|=
name|parse_info
operator|.
name|buffer
operator|+
literal|2048
expr_stmt|;
name|parse_info
operator|.
name|buffer_size
operator|=
literal|2048
expr_stmt|;
name|parse_info
operator|.
name|tokenbuf_size
operator|=
literal|2048
expr_stmt|;
name|gimp_dir
operator|=
name|gimp_directory
argument_list|()
expr_stmt|;
name|add_gimp_directory_token
argument_list|(
name|gimp_dir
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|libfilename
argument_list|,
literal|"%s/gimprc"
argument_list|,
name|DATADIR
argument_list|)
expr_stmt|;
name|app_init_update_status
argument_list|(
literal|"Resource configuration"
argument_list|,
name|libfilename
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|parse_gimprc_file
argument_list|(
name|libfilename
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|filename
argument_list|,
literal|"%s/gimprc"
argument_list|,
name|gimp_dir
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|filename
argument_list|,
name|libfilename
argument_list|)
operator|!=
literal|0
condition|)
block|{
name|app_init_update_status
argument_list|(
name|NULL
argument_list|,
name|filename
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|parse_gimprc_file
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|parse_gimprc_file (char * filename)
name|parse_gimprc_file
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|)
block|{
specifier|static
name|char
modifier|*
name|home_dir
init|=
name|NULL
decl_stmt|;
name|int
name|status
decl_stmt|;
name|char
name|rfilename
index|[
literal|512
index|]
decl_stmt|;
if|if
condition|(
name|filename
index|[
literal|0
index|]
operator|!=
literal|'/'
condition|)
block|{
if|if
condition|(
operator|!
name|home_dir
condition|)
name|home_dir
operator|=
name|g_strdup
argument_list|(
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|rfilename
argument_list|,
literal|"%s/%s"
argument_list|,
name|home_dir
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|filename
operator|=
name|rfilename
expr_stmt|;
block|}
name|parse_info
operator|.
name|fp
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"rt"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|parse_info
operator|.
name|fp
condition|)
return|return;
if|if
condition|(
operator|(
name|be_verbose
operator|==
name|TRUE
operator|)
operator|||
operator|(
name|no_splash
operator|==
name|TRUE
operator|)
condition|)
name|g_print
argument_list|(
literal|"parsing \"%s\"\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|cur_token
operator|=
operator|-
literal|1
expr_stmt|;
name|next_token
operator|=
operator|-
literal|1
expr_stmt|;
name|parse_info
operator|.
name|position
operator|=
operator|-
literal|1
expr_stmt|;
name|parse_info
operator|.
name|linenum
operator|=
literal|1
expr_stmt|;
name|parse_info
operator|.
name|charnum
operator|=
literal|1
expr_stmt|;
name|parse_info
operator|.
name|inc_linenum
operator|=
name|FALSE
expr_stmt|;
name|parse_info
operator|.
name|inc_charnum
operator|=
name|FALSE
expr_stmt|;
name|done
operator|=
name|FALSE
expr_stmt|;
while|while
condition|(
operator|(
name|status
operator|=
name|parse_statement
argument_list|()
operator|)
operator|==
name|OK
condition|)
empty_stmt|;
name|fclose
argument_list|(
name|parse_info
operator|.
name|fp
argument_list|)
expr_stmt|;
if|if
condition|(
name|status
operator|==
name|ERROR
condition|)
block|{
name|g_print
argument_list|(
literal|"error parsing: \"%s\"\n"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_print
argument_list|(
literal|"  at line %d column %d\n"
argument_list|,
name|parse_info
operator|.
name|linenum
argument_list|,
name|parse_info
operator|.
name|charnum
argument_list|)
expr_stmt|;
name|g_print
argument_list|(
literal|"  unexpected token: %s\n"
argument_list|,
name|token_sym
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|GList
modifier|*
DECL|function|g_list_findstr (GList * list,char * str)
name|g_list_findstr
parameter_list|(
name|GList
modifier|*
name|list
parameter_list|,
name|char
modifier|*
name|str
parameter_list|)
block|{
while|while
condition|(
name|list
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|(
name|char
operator|*
operator|)
name|list
operator|->
name|data
argument_list|,
name|str
argument_list|)
condition|)
break|break;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
return|return
name|list
return|;
block|}
end_function

begin_function
name|void
DECL|function|save_gimprc (GList ** updated_options,GList ** conflicting_options)
name|save_gimprc
parameter_list|(
name|GList
modifier|*
modifier|*
name|updated_options
parameter_list|,
name|GList
modifier|*
modifier|*
name|conflicting_options
parameter_list|)
block|{
name|char
name|timestamp
index|[
literal|40
index|]
decl_stmt|;
name|char
modifier|*
name|gimp_dir
decl_stmt|;
name|char
name|name
index|[
literal|512
index|]
decl_stmt|;
name|FILE
modifier|*
name|fp_new
decl_stmt|;
name|FILE
modifier|*
name|fp_old
decl_stmt|;
name|GList
modifier|*
name|option
decl_stmt|;
name|char
modifier|*
name|cur_line
decl_stmt|;
name|char
modifier|*
name|prev_line
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
name|char
modifier|*
name|error_msg
decl_stmt|;
name|g_assert
argument_list|(
name|updated_options
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|conflicting_options
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|gimp_dir
operator|=
name|gimp_directory
argument_list|()
expr_stmt|;
name|sprintf
argument_list|(
name|name
argument_list|,
literal|"%s/gimprc"
argument_list|,
name|gimp_dir
argument_list|)
expr_stmt|;
name|error_msg
operator|=
name|open_backup_file
argument_list|(
name|name
argument_list|,
operator|&
name|fp_new
argument_list|,
operator|&
name|fp_old
argument_list|)
expr_stmt|;
if|if
condition|(
name|error_msg
operator|!=
name|NULL
condition|)
block|{
name|g_message
argument_list|(
name|error_msg
argument_list|)
expr_stmt|;
return|return;
block|}
name|strcpy
argument_list|(
name|timestamp
argument_list|,
literal|"by GIMP on "
argument_list|)
expr_stmt|;
name|iso_8601_date_format
argument_list|(
name|timestamp
operator|+
name|strlen
argument_list|(
name|timestamp
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* copy the old .gimprc into the new one, modifying it as needed */
name|prev_line
operator|=
name|NULL
expr_stmt|;
name|cur_line
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
literal|1024
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|feof
argument_list|(
name|fp_old
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|fgets
argument_list|(
name|cur_line
argument_list|,
literal|1024
argument_list|,
name|fp_old
argument_list|)
condition|)
continue|continue;
comment|/* special case: save lines starting with '#-' (added by GIMP) */
if|if
condition|(
operator|(
name|cur_line
index|[
literal|0
index|]
operator|==
literal|'#'
operator|)
operator|&&
operator|(
name|cur_line
index|[
literal|1
index|]
operator|==
literal|'-'
operator|)
condition|)
block|{
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|fputs
argument_list|(
name|prev_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
block|}
name|prev_line
operator|=
name|g_strdup
argument_list|(
name|cur_line
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* see if the line contains something that we can use */
if|if
condition|(
name|find_token
argument_list|(
name|cur_line
argument_list|,
name|name
argument_list|,
literal|50
argument_list|)
condition|)
block|{
comment|/* check if that entry should be updated */
name|option
operator|=
name|g_list_findstr
argument_list|(
operator|*
name|updated_options
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|prev_line
operator|==
name|NULL
condition|)
block|{
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line commented out %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"# %s\n"
argument_list|,
name|cur_line
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line added %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line modified %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
block|}
name|str
operator|=
name|value_to_str
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"(%s %s)\n"
argument_list|,
name|name
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
operator|*
name|updated_options
operator|=
name|g_list_remove_link
argument_list|(
operator|*
name|updated_options
argument_list|,
name|option
argument_list|)
expr_stmt|;
operator|*
name|conflicting_options
operator|=
name|g_list_append
argument_list|(
operator|*
name|conflicting_options
argument_list|,
operator|(
name|gpointer
operator|)
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
name|g_list_free_1
argument_list|(
name|option
argument_list|)
expr_stmt|;
continue|continue;
block|}
comment|/* check if that entry should be commented out */
name|option
operator|=
name|g_list_findstr
argument_list|(
operator|*
name|conflicting_options
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line commented out %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"# %s\n"
argument_list|,
name|cur_line
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
comment|/* all lines that did not match the tests above are simply copied */
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
block|{
name|fputs
argument_list|(
name|prev_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|prev_line
operator|=
name|NULL
expr_stmt|;
block|}
name|fputs
argument_list|(
name|cur_line
argument_list|,
name|fp_new
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|cur_line
argument_list|)
expr_stmt|;
if|if
condition|(
name|prev_line
operator|!=
name|NULL
condition|)
name|g_free
argument_list|(
name|prev_line
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|fp_old
argument_list|)
expr_stmt|;
comment|/* append the options that were not in the old .gimprc */
name|option
operator|=
operator|*
name|updated_options
expr_stmt|;
while|while
condition|(
name|option
condition|)
block|{
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"#- Next line added %s\n"
argument_list|,
name|timestamp
argument_list|)
expr_stmt|;
name|str
operator|=
name|value_to_str
argument_list|(
operator|(
name|char
operator|*
operator|)
name|option
operator|->
name|data
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fp_new
argument_list|,
literal|"(%s %s)\n\n"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|option
operator|->
name|data
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|option
operator|=
name|option
operator|->
name|next
expr_stmt|;
block|}
name|fclose
argument_list|(
name|fp_new
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|get_next_token ()
name|get_next_token
parameter_list|()
block|{
if|if
condition|(
name|next_token
operator|!=
operator|-
literal|1
condition|)
block|{
name|cur_token
operator|=
name|next_token
expr_stmt|;
name|next_token
operator|=
operator|-
literal|1
expr_stmt|;
block|}
else|else
block|{
name|cur_token
operator|=
name|get_token
argument_list|(
operator|&
name|parse_info
argument_list|)
expr_stmt|;
block|}
return|return
name|cur_token
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|peek_next_token ()
name|peek_next_token
parameter_list|()
block|{
if|if
condition|(
name|next_token
operator|==
operator|-
literal|1
condition|)
name|next_token
operator|=
name|get_token
argument_list|(
operator|&
name|parse_info
argument_list|)
expr_stmt|;
return|return
name|next_token
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_statement ()
name|parse_statement
parameter_list|()
block|{
name|int
name|token
decl_stmt|;
name|int
name|i
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
condition|)
return|return
name|DONE
return|;
if|if
condition|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nfuncs
condition|;
name|i
operator|++
control|)
if|if
condition|(
name|strcmp
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|token_sym
argument_list|)
operator|==
literal|0
condition|)
switch|switch
condition|(
name|funcs
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|TT_STRING
case|:
return|return
name|parse_string
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_PATH
case|:
return|return
name|parse_path
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_DOUBLE
case|:
return|return
name|parse_double
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_INT
case|:
return|return
name|parse_int
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_BOOLEAN
case|:
return|return
name|parse_boolean
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_POSITION
case|:
return|return
name|parse_position
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_MEMSIZE
case|:
return|return
name|parse_mem_size
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_IMAGETYPE
case|:
return|return
name|parse_image_type
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XCOLORCUBE
case|:
return|return
name|parse_color_cube
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XPREVSIZE
case|:
return|return
name|parse_preview_size
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XRULERUNIT
case|:
return|return
name|parse_ruler_units
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XPLUGIN
case|:
return|return
name|parse_plug_in
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XPLUGINDEF
case|:
return|return
name|parse_plug_in_def
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XMENUPATH
case|:
return|return
name|parse_menu_path
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XDEVICE
case|:
return|return
name|parse_device
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
block|}
return|return
name|parse_unknown
argument_list|(
name|token_sym
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_path (gpointer val1p,gpointer val2p)
name|parse_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|char
modifier|*
modifier|*
name|pathp
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|pathp
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|pathp
condition|)
name|g_free
argument_list|(
operator|*
name|pathp
argument_list|)
expr_stmt|;
operator|*
name|pathp
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
operator|*
name|pathp
argument_list|)
expr_stmt|;
operator|*
name|pathp
operator|=
name|NULL
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|pathp
operator|=
name|transform_path
argument_list|(
operator|*
name|pathp
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_string (gpointer val1p,gpointer val2p)
name|parse_string
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|char
modifier|*
modifier|*
name|strp
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|strp
operator|=
operator|(
name|char
operator|*
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|*
name|strp
condition|)
name|g_free
argument_list|(
operator|*
name|strp
argument_list|)
expr_stmt|;
operator|*
name|strp
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
operator|*
name|strp
argument_list|)
expr_stmt|;
operator|*
name|strp
operator|=
name|NULL
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_double (gpointer val1p,gpointer val2p)
name|parse_double
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|double
modifier|*
name|nump
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|nump
operator|=
operator|(
name|double
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|nump
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_int (gpointer val1p,gpointer val2p)
name|parse_int
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|int
modifier|*
name|nump
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|nump
operator|=
operator|(
name|int
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|nump
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_boolean (gpointer val1p,gpointer val2p)
name|parse_boolean
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|int
modifier|*
name|boolp
decl_stmt|;
comment|/* The variable to be set should be passed in the first or second    * pointer.  If the pointer is in val2p, then the opposite value is    * stored in the pointer.  This is useful for "dont-xxx" or "no-xxx"    * type of options.    * If the expression to be parsed is written as "(option)" instead    * of "(option yes)" or "(option no)", then the default value is    * TRUE if the variable is passed in val1p, or FALSE if in val2p.    */
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
operator|||
name|val2p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|val1p
operator|!=
name|NULL
condition|)
name|boolp
operator|=
operator|(
name|int
operator|*
operator|)
name|val1p
expr_stmt|;
else|else
name|boolp
operator|=
operator|(
name|int
operator|*
operator|)
name|val2p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
condition|)
return|return
name|ERROR
return|;
switch|switch
condition|(
name|token
condition|)
block|{
case|case
name|TOKEN_RIGHT_PAREN
case|:
operator|*
name|boolp
operator|=
name|TRUE
expr_stmt|;
break|break;
case|case
name|TOKEN_NUMBER
case|:
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|boolp
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
break|break;
case|case
name|TOKEN_SYMBOL
case|:
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"true"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"on"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"yes"
argument_list|)
condition|)
operator|*
name|boolp
operator|=
name|TRUE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"false"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"off"
argument_list|)
operator|||
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"no"
argument_list|)
condition|)
operator|*
name|boolp
operator|=
name|FALSE
expr_stmt|;
else|else
return|return
name|ERROR
return|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
break|break;
default|default:
return|return
name|ERROR
return|;
block|}
if|if
condition|(
name|val1p
operator|==
name|NULL
condition|)
operator|*
name|boolp
operator|=
operator|!
operator|*
name|boolp
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_position (gpointer val1p,gpointer val2p)
name|parse_position
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|int
modifier|*
name|xp
decl_stmt|;
name|int
modifier|*
name|yp
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
operator|&&
name|val2p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|xp
operator|=
operator|(
name|int
operator|*
operator|)
name|val1p
expr_stmt|;
name|yp
operator|=
operator|(
name|int
operator|*
operator|)
name|val2p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|xp
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|yp
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_mem_size (gpointer val1p,gpointer val2p)
name|parse_mem_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|mult
decl_stmt|;
name|int
name|suffix
decl_stmt|;
name|int
name|token
decl_stmt|;
name|int
modifier|*
name|sizep
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|sizep
operator|=
operator|(
name|int
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
operator|&&
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_NUMBER
condition|)
block|{
operator|*
name|sizep
operator|=
name|token_num
operator|*
literal|1024
expr_stmt|;
block|}
else|else
block|{
operator|*
name|sizep
operator|=
name|atoi
argument_list|(
name|token_sym
argument_list|)
expr_stmt|;
name|suffix
operator|=
name|token_sym
index|[
name|strlen
argument_list|(
name|token_sym
argument_list|)
operator|-
literal|1
index|]
expr_stmt|;
if|if
condition|(
operator|(
name|suffix
operator|==
literal|'m'
operator|)
operator|||
operator|(
name|suffix
operator|==
literal|'M'
operator|)
condition|)
name|mult
operator|=
literal|1024
operator|*
literal|1024
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|suffix
operator|==
literal|'k'
operator|)
operator|||
operator|(
name|suffix
operator|==
literal|'K'
operator|)
condition|)
name|mult
operator|=
literal|1024
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|suffix
operator|==
literal|'b'
operator|)
operator|||
operator|(
name|suffix
operator|==
literal|'B'
operator|)
condition|)
name|mult
operator|=
literal|1
expr_stmt|;
else|else
return|return
name|FALSE
return|;
operator|*
name|sizep
operator|*=
name|mult
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_image_type (gpointer val1p,gpointer val2p)
name|parse_image_type
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|int
modifier|*
name|typep
decl_stmt|;
name|g_assert
argument_list|(
name|val1p
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|typep
operator|=
operator|(
name|int
operator|*
operator|)
name|val1p
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"rgb"
argument_list|)
condition|)
operator|*
name|typep
operator|=
name|RGB
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"gray"
argument_list|)
operator|)
operator|||
operator|(
operator|!
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"grey"
argument_list|)
operator|)
condition|)
operator|*
name|typep
operator|=
name|GRAY
expr_stmt|;
else|else
return|return
name|ERROR
return|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_color_cube (gpointer val1p,gpointer val2p)
name|parse_color_cube
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|color_cube_shades
index|[
literal|0
index|]
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|color_cube_shades
index|[
literal|1
index|]
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|color_cube_shades
index|[
literal|2
index|]
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|color_cube_shades
index|[
literal|3
index|]
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_preview_size (gpointer val1p,gpointer val2p)
name|parse_preview_size
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|&&
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_SYMBOL
condition|)
block|{
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"none"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|0
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"small"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|32
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"medium"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|64
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"large"
argument_list|)
operator|==
literal|0
condition|)
name|preview_size
operator|=
literal|128
expr_stmt|;
else|else
name|preview_size
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|token
operator|==
name|TOKEN_NUMBER
condition|)
name|preview_size
operator|=
name|token_num
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_ruler_units (gpointer val1p,gpointer val2p)
name|parse_ruler_units
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"pixels"
argument_list|)
operator|==
literal|0
condition|)
name|ruler_units
operator|=
name|GTK_PIXELS
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"inches"
argument_list|)
operator|==
literal|0
condition|)
name|ruler_units
operator|=
name|GTK_INCHES
expr_stmt|;
elseif|else
if|if
condition|(
name|strcmp
argument_list|(
name|token_sym
argument_list|,
literal|"centimeters"
argument_list|)
operator|==
literal|0
condition|)
name|ruler_units
operator|=
name|GTK_CENTIMETERS
expr_stmt|;
else|else
name|ruler_units
operator|=
name|GTK_PIXELS
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_plug_in (gpointer val1p,gpointer val2p)
name|parse_plug_in
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|char
modifier|*
name|menu_path
decl_stmt|;
name|char
modifier|*
name|accelerator
decl_stmt|;
name|int
name|token
decl_stmt|;
name|name
operator|=
name|NULL
expr_stmt|;
name|menu_path
operator|=
name|NULL
expr_stmt|;
name|accelerator
operator|=
name|NULL
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_STRING
condition|)
block|{
name|menu_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token
operator|==
name|TOKEN_STRING
condition|)
block|{
name|accelerator
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|menu_path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|accelerator
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|name
operator|&&
name|menu_path
condition|)
name|plug_in_add
argument_list|(
name|name
argument_list|,
name|menu_path
argument_list|,
name|accelerator
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_plug_in_def (gpointer val1p,gpointer val2p)
name|parse_plug_in_def
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|PlugInDef
modifier|*
name|plug_in_def
decl_stmt|;
name|PlugInProcDef
modifier|*
name|proc_def
decl_stmt|;
name|GSList
modifier|*
name|tmp_list
decl_stmt|;
name|int
name|token
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|plug_in_def
operator|=
name|g_new
argument_list|(
name|PlugInDef
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|prog
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|proc_defs
operator|=
name|NULL
expr_stmt|;
name|plug_in_def
operator|->
name|mtime
operator|=
literal|0
expr_stmt|;
name|plug_in_def
operator|->
name|query
operator|=
name|FALSE
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|plug_in_def
operator|->
name|mtime
operator|=
name|token_int
expr_stmt|;
while|while
condition|(
name|parse_proc_def
argument_list|(
operator|&
name|proc_def
argument_list|)
condition|)
block|{
name|proc_def
operator|->
name|prog
operator|=
name|g_strdup
argument_list|(
name|plug_in_def
operator|->
name|prog
argument_list|)
expr_stmt|;
name|plug_in_def
operator|->
name|proc_defs
operator|=
name|g_slist_append
argument_list|(
name|plug_in_def
operator|->
name|proc_defs
argument_list|,
name|proc_def
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|plug_in_def_add
argument_list|(
name|plug_in_def
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_message
argument_list|(
literal|"error parsing pluginrc"
argument_list|)
expr_stmt|;
name|tmp_list
operator|=
name|plug_in_def
operator|->
name|proc_defs
expr_stmt|;
while|while
condition|(
name|tmp_list
condition|)
block|{
name|g_free
argument_list|(
name|tmp_list
operator|->
name|data
argument_list|)
expr_stmt|;
name|tmp_list
operator|=
name|tmp_list
operator|->
name|next
expr_stmt|;
block|}
name|g_slist_free
argument_list|(
name|plug_in_def
operator|->
name|proc_defs
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|plug_in_def
operator|->
name|prog
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|plug_in_def
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_proc_def (PlugInProcDef ** proc_def)
name|parse_proc_def
parameter_list|(
name|PlugInProcDef
modifier|*
modifier|*
name|proc_def
parameter_list|)
block|{
name|PlugInProcDef
modifier|*
name|pd
decl_stmt|;
name|int
name|token
decl_stmt|;
name|int
name|i
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
operator|||
operator|(
name|strcmp
argument_list|(
literal|"proc-def"
argument_list|,
name|token_sym
argument_list|)
operator|!=
literal|0
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|=
name|g_new0
argument_list|(
name|PlugInProcDef
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|proc_type
operator|=
name|token_int
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|blurb
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|help
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|author
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|copyright
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|date
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|menu_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|extensions
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|prefixes
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
name|pd
operator|->
name|magics
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
name|token_str
index|[
literal|0
index|]
operator|!=
literal|'\0'
condition|)
block|{
name|pd
operator|->
name|image_types
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|pd
operator|->
name|image_types_val
operator|=
name|plug_in_image_types_parse
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|num_args
operator|=
name|token_int
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|args
operator|=
name|g_new0
argument_list|(
name|ProcArg
argument_list|,
name|pd
operator|->
name|db_info
operator|.
name|num_args
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|num_values
operator|=
name|token_int
expr_stmt|;
name|pd
operator|->
name|db_info
operator|.
name|values
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|pd
operator|->
name|db_info
operator|.
name|num_values
operator|>
literal|0
condition|)
name|pd
operator|->
name|db_info
operator|.
name|values
operator|=
name|g_new
argument_list|(
name|ProcArg
argument_list|,
name|pd
operator|->
name|db_info
operator|.
name|num_values
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_args
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|parse_proc_arg
argument_list|(
operator|&
name|pd
operator|->
name|db_info
operator|.
name|args
index|[
name|i
index|]
argument_list|)
condition|)
goto|goto
name|error
goto|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_values
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|parse_proc_arg
argument_list|(
operator|&
name|pd
operator|->
name|db_info
operator|.
name|values
index|[
name|i
index|]
argument_list|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
operator|*
name|proc_def
operator|=
name|pd
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|blurb
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|help
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|author
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|copyright
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|date
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|menu_path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|extensions
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|prefixes
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|magics
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|image_types
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_args
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|args
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|args
index|[
name|i
index|]
operator|.
name|description
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pd
operator|->
name|db_info
operator|.
name|num_values
condition|;
name|i
operator|++
control|)
block|{
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|values
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|values
index|[
name|i
index|]
operator|.
name|description
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|args
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
operator|->
name|db_info
operator|.
name|values
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|pd
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_proc_arg (ProcArg * arg)
name|parse_proc_arg
parameter_list|(
name|ProcArg
modifier|*
name|arg
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|arg
operator|->
name|arg_type
operator|=
operator|-
literal|1
expr_stmt|;
name|arg
operator|->
name|name
operator|=
name|NULL
expr_stmt|;
name|arg
operator|->
name|description
operator|=
name|NULL
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_LEFT_PAREN
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
operator|||
operator|(
name|strcmp
argument_list|(
literal|"proc-arg"
argument_list|,
name|token_sym
argument_list|)
operator|!=
literal|0
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|arg
operator|->
name|arg_type
operator|=
name|token_int
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
return|return
name|ERROR
return|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|arg
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|arg
operator|->
name|description
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|arg
operator|->
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|arg
operator|->
name|description
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_menu_path (gpointer val1p,gpointer val2p)
name|parse_menu_path
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|char
modifier|*
name|menu_path
decl_stmt|;
name|char
modifier|*
name|accelerator
decl_stmt|;
name|int
name|token
decl_stmt|;
name|menu_path
operator|=
name|NULL
expr_stmt|;
name|accelerator
operator|=
name|NULL
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|menu_path
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|accelerator
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
comment|// FIXME   menus_add_path (menu_path, accelerator);
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|menu_path
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|accelerator
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|transform_path (char * path,int destroy)
name|transform_path
parameter_list|(
name|char
modifier|*
name|path
parameter_list|,
name|int
name|destroy
parameter_list|)
block|{
name|int
name|length
decl_stmt|;
name|char
modifier|*
name|new_path
decl_stmt|;
name|char
modifier|*
name|home
decl_stmt|;
name|char
modifier|*
name|token
decl_stmt|;
name|char
modifier|*
name|tmp
decl_stmt|;
name|char
modifier|*
name|tmp2
decl_stmt|;
name|int
name|substituted
decl_stmt|;
name|int
name|is_env
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
name|home
operator|=
name|getenv
argument_list|(
literal|"HOME"
argument_list|)
expr_stmt|;
name|length
operator|=
literal|0
expr_stmt|;
name|substituted
operator|=
name|FALSE
expr_stmt|;
name|is_env
operator|=
name|FALSE
expr_stmt|;
name|tmp
operator|=
name|path
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
condition|)
block|{
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'~'
condition|)
block|{
name|length
operator|+=
name|strlen
argument_list|(
name|home
argument_list|)
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'$'
condition|)
block|{
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
operator|||
operator|(
operator|*
name|tmp
operator|!=
literal|'{'
operator|)
condition|)
return|return
name|path
return|;
name|tmp
operator|+=
literal|1
expr_stmt|;
name|token
operator|=
name|tmp
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'}'
operator|)
condition|)
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
condition|)
return|return
name|path
return|;
operator|*
name|tmp
operator|=
literal|'\0'
expr_stmt|;
name|tmp2
operator|=
name|gimprc_find_token
argument_list|(
name|token
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp2
operator|==
name|NULL
condition|)
block|{
comment|/* maybe token is an environment variable */
name|tmp2
operator|=
name|getenv
argument_list|(
name|token
argument_list|)
expr_stmt|;
if|if
condition|(
name|tmp2
operator|!=
name|NULL
condition|)
block|{
name|is_env
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|terminate
argument_list|(
literal|"gimprc token referenced but not defined: %s"
argument_list|,
name|token
argument_list|)
expr_stmt|;
block|}
block|}
name|tmp2
operator|=
name|transform_path
argument_list|(
name|tmp2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|is_env
condition|)
block|{
comment|/* then add to list of unknown tokens */
comment|/* but only if it isn't already in list */
if|if
condition|(
name|gimprc_find_token
argument_list|(
name|token
argument_list|)
operator|==
name|NULL
condition|)
block|{
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|tmp2
argument_list|)
expr_stmt|;
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|gimprc_set_token
argument_list|(
name|token
argument_list|,
name|tmp2
argument_list|)
expr_stmt|;
block|}
name|length
operator|+=
name|strlen
argument_list|(
name|tmp2
argument_list|)
expr_stmt|;
operator|*
name|tmp
operator|=
literal|'}'
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
name|substituted
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|length
operator|+=
literal|1
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|(
name|length
operator|==
name|strlen
argument_list|(
name|path
argument_list|)
operator|)
operator|&&
operator|!
name|substituted
condition|)
return|return
name|path
return|;
name|new_path
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
name|length
operator|+
literal|1
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|path
expr_stmt|;
name|tmp2
operator|=
name|new_path
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
condition|)
block|{
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'~'
condition|)
block|{
operator|*
name|tmp2
operator|=
literal|'\0'
expr_stmt|;
name|strcat
argument_list|(
name|tmp2
argument_list|,
name|home
argument_list|)
expr_stmt|;
name|tmp2
operator|+=
name|strlen
argument_list|(
name|home
argument_list|)
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|*
name|tmp
operator|==
literal|'$'
condition|)
block|{
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
operator|||
operator|(
operator|*
name|tmp
operator|!=
literal|'{'
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|new_path
argument_list|)
expr_stmt|;
return|return
name|path
return|;
block|}
name|tmp
operator|+=
literal|1
expr_stmt|;
name|token
operator|=
name|tmp
expr_stmt|;
while|while
condition|(
operator|*
name|tmp
operator|&&
operator|(
operator|*
name|tmp
operator|!=
literal|'}'
operator|)
condition|)
name|tmp
operator|+=
literal|1
expr_stmt|;
if|if
condition|(
operator|!
operator|*
name|tmp
condition|)
block|{
name|g_free
argument_list|(
name|new_path
argument_list|)
expr_stmt|;
return|return
name|path
return|;
block|}
operator|*
name|tmp
operator|=
literal|'\0'
expr_stmt|;
name|token
operator|=
name|gimprc_find_token
argument_list|(
name|token
argument_list|)
expr_stmt|;
operator|*
name|tmp
operator|=
literal|'}'
expr_stmt|;
operator|*
name|tmp2
operator|=
literal|'\0'
expr_stmt|;
name|strcat
argument_list|(
name|tmp2
argument_list|,
name|token
argument_list|)
expr_stmt|;
name|tmp2
operator|+=
name|strlen
argument_list|(
name|token
argument_list|)
expr_stmt|;
name|tmp
operator|+=
literal|1
expr_stmt|;
block|}
else|else
block|{
operator|*
name|tmp2
operator|++
operator|=
operator|*
name|tmp
operator|++
expr_stmt|;
block|}
block|}
operator|*
name|tmp2
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|destroy
condition|)
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
return|return
name|new_path
return|;
block|}
end_function

begin_comment
comment|/* Copied from gtk_menu_factory_parse_accelerator() */
end_comment

begin_function
specifier|static
name|void
DECL|function|parse_device_accelerator (const char * accelerator,GdkDeviceKey * key)
name|parse_device_accelerator
parameter_list|(
specifier|const
name|char
modifier|*
name|accelerator
parameter_list|,
name|GdkDeviceKey
modifier|*
name|key
parameter_list|)
block|{
name|int
name|done
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|accelerator
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|key
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|key
operator|->
name|modifiers
operator|=
literal|0
expr_stmt|;
name|done
operator|=
name|FALSE
expr_stmt|;
while|while
condition|(
operator|!
name|done
condition|)
block|{
if|if
condition|(
name|strncmp
argument_list|(
name|accelerator
argument_list|,
literal|"<shift>"
argument_list|,
literal|7
argument_list|)
operator|==
literal|0
condition|)
block|{
name|accelerator
operator|+=
literal|7
expr_stmt|;
name|key
operator|->
name|modifiers
operator||=
name|GDK_SHIFT_MASK
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|accelerator
argument_list|,
literal|"<alt>"
argument_list|,
literal|5
argument_list|)
operator|==
literal|0
condition|)
block|{
name|accelerator
operator|+=
literal|5
expr_stmt|;
name|key
operator|->
name|modifiers
operator||=
name|GDK_MOD1_MASK
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|strncmp
argument_list|(
name|accelerator
argument_list|,
literal|"<control>"
argument_list|,
literal|9
argument_list|)
operator|==
literal|0
condition|)
block|{
name|accelerator
operator|+=
literal|9
expr_stmt|;
name|key
operator|->
name|modifiers
operator||=
name|GDK_CONTROL_MASK
expr_stmt|;
block|}
else|else
block|{
name|done
operator|=
name|TRUE
expr_stmt|;
comment|/* Tricky, but works... ("" => keyval = 0, or no translation) */
name|key
operator|->
name|keyval
operator|=
name|accelerator
index|[
literal|0
index|]
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_device (gpointer val1p,gpointer val2p)
name|parse_device
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|DeviceValues
name|values
init|=
literal|0
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|token
decl_stmt|;
comment|/* The initialized values here are meaningless */
name|gchar
modifier|*
name|name
init|=
name|NULL
decl_stmt|;
name|GdkInputMode
name|mode
init|=
name|GDK_MODE_DISABLED
decl_stmt|;
name|gint
name|num_axes
init|=
literal|0
decl_stmt|;
name|GdkAxisUse
modifier|*
name|axes
init|=
name|NULL
decl_stmt|;
name|gint
name|num_keys
init|=
literal|0
decl_stmt|;
name|GdkDeviceKey
modifier|*
name|keys
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|brush_name
init|=
name|NULL
decl_stmt|;
name|ToolType
name|tool
init|=
name|RECT_SELECT
decl_stmt|;
name|guchar
name|foreground
index|[
literal|3
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|}
decl_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
comment|/* Parse options for device */
while|while
condition|(
name|peek_next_token
argument_list|()
operator|==
name|TOKEN_LEFT_PAREN
condition|)
block|{
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"mode"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_MODE
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"disabled"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|mode
operator|=
name|GDK_MODE_DISABLED
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"window"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|mode
operator|=
name|GDK_MODE_WINDOW
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"screen"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|mode
operator|=
name|GDK_MODE_SCREEN
expr_stmt|;
else|else
goto|goto
name|error
goto|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"axes"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_AXES
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|num_axes
operator|=
name|token_int
expr_stmt|;
name|axes
operator|=
name|g_new
argument_list|(
name|GdkAxisUse
argument_list|,
name|num_axes
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_axes
condition|;
name|i
operator|++
control|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_SYMBOL
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"ignore"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_IGNORE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"x"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_X
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"y"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_Y
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"pressure"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_PRESSURE
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"xtilt"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_XTILT
expr_stmt|;
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"ytilt"
argument_list|,
name|token_sym
argument_list|)
condition|)
name|axes
index|[
name|i
index|]
operator|=
name|GDK_AXIS_YTILT
expr_stmt|;
else|else
goto|goto
name|error
goto|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"keys"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_KEYS
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|num_keys
operator|=
name|token_int
expr_stmt|;
name|keys
operator|=
name|g_new
argument_list|(
name|GdkDeviceKey
argument_list|,
name|num_keys
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_keys
condition|;
name|i
operator|++
control|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|parse_device_accelerator
argument_list|(
name|token_str
argument_list|,
operator|&
name|keys
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"brush"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_BRUSH
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|brush_name
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"tool"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_TOOL
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
comment|/* FIXME: this shouldn't be hard coded like this */
for|for
control|(
name|tool
operator|=
name|FIRST_TOOLBOX_TOOL
init|;
name|tool
operator|<=
name|LAST_TOOLBOX_TOOL
condition|;
name|tool
operator|++
control|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|tool_info
index|[
name|tool
index|]
operator|.
name|tool_name
argument_list|,
name|token_str
argument_list|)
condition|)
break|break;
block|}
if|if
condition|(
name|tool
operator|>
name|LAST_TOOLBOX_TOOL
condition|)
goto|goto
name|error
goto|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
literal|"foreground"
argument_list|,
name|token_sym
argument_list|)
condition|)
block|{
name|values
operator||=
name|DEVICE_FOREGROUND
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_NUMBER
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|foreground
index|[
name|i
index|]
operator|=
name|token_int
expr_stmt|;
block|}
block|}
else|else
goto|goto
name|error
goto|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
goto|goto
name|error
goto|;
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|devices_rc_update
argument_list|(
name|name
argument_list|,
name|values
argument_list|,
name|mode
argument_list|,
name|num_axes
argument_list|,
name|axes
argument_list|,
name|num_keys
argument_list|,
name|keys
argument_list|,
name|brush_name
argument_list|,
name|tool
argument_list|,
name|foreground
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|brush_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|axes
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|keys
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
name|error
label|:
name|g_free
argument_list|(
name|brush_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|axes
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|keys
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|parse_unknown (char * token_sym)
name|parse_unknown
parameter_list|(
name|char
modifier|*
name|token_sym
parameter_list|)
block|{
name|int
name|token
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
name|token_sym
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_STRING
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|ut
operator|->
name|token
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|ut
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|token_str
argument_list|)
expr_stmt|;
name|token
operator|=
name|peek_next_token
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|token
operator|||
operator|(
name|token
operator|!=
name|TOKEN_RIGHT_PAREN
operator|)
condition|)
block|{
name|g_free
argument_list|(
name|ut
operator|->
name|token
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|ut
operator|->
name|value
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|ut
argument_list|)
expr_stmt|;
return|return
name|ERROR
return|;
block|}
name|token
operator|=
name|get_next_token
argument_list|()
expr_stmt|;
comment|/*  search through the list of unknown tokens and replace an existing entry  */
name|list
operator|=
name|unknown_tokens
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|tmp
operator|=
operator|(
name|UnknownToken
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|tmp
operator|->
name|token
argument_list|,
name|ut
operator|->
name|token
argument_list|)
operator|==
literal|0
condition|)
block|{
name|unknown_tokens
operator|=
name|g_list_remove
argument_list|(
name|unknown_tokens
argument_list|,
name|tmp
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
operator|->
name|token
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
operator|->
name|value
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
block|}
name|ut
operator|->
name|value
operator|=
name|transform_path
argument_list|(
name|ut
operator|->
name|value
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
return|return
name|OK
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|value_to_str (char * name)
name|value_to_str
parameter_list|(
name|char
modifier|*
name|name
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|nfuncs
condition|;
name|i
operator|++
control|)
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|name
argument_list|,
name|name
argument_list|)
condition|)
switch|switch
condition|(
name|funcs
index|[
name|i
index|]
operator|.
name|type
condition|)
block|{
case|case
name|TT_STRING
case|:
return|return
name|string_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_PATH
case|:
return|return
name|path_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_DOUBLE
case|:
return|return
name|double_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_INT
case|:
return|return
name|int_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_BOOLEAN
case|:
return|return
name|boolean_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_POSITION
case|:
return|return
name|position_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_MEMSIZE
case|:
return|return
name|mem_size_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_IMAGETYPE
case|:
return|return
name|image_type_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XCOLORCUBE
case|:
return|return
name|color_cube_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XPREVSIZE
case|:
return|return
name|preview_size_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XRULERUNIT
case|:
return|return
name|ruler_units_to_str
argument_list|(
name|funcs
index|[
name|i
index|]
operator|.
name|val1p
argument_list|,
name|funcs
index|[
name|i
index|]
operator|.
name|val2p
argument_list|)
return|;
case|case
name|TT_XPLUGIN
case|:
case|case
name|TT_XPLUGINDEF
case|:
case|case
name|TT_XMENUPATH
case|:
case|case
name|TT_XDEVICE
case|:
return|return
name|NULL
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|string_to_str (gpointer val1p,gpointer val2p)
name|string_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|)
name|val1p
operator|)
argument_list|)
operator|+
literal|3
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%c%s%c"
argument_list|,
literal|'"'
argument_list|,
operator|*
operator|(
operator|(
name|char
operator|*
operator|*
operator|)
name|val1p
operator|)
argument_list|,
literal|'"'
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|path_to_str (gpointer val1p,gpointer val2p)
name|path_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
return|return
name|string_to_str
argument_list|(
name|val1p
argument_list|,
name|val2p
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|double_to_str (gpointer val1p,gpointer val2p)
name|double_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%f"
argument_list|,
operator|*
operator|(
operator|(
name|double
operator|*
operator|)
name|val1p
operator|)
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|int_to_str (gpointer val1p,gpointer val2p)
name|int_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%d"
argument_list|,
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val1p
operator|)
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|boolean_to_str (gpointer val1p,gpointer val2p)
name|boolean_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|v
decl_stmt|;
if|if
condition|(
name|val1p
operator|!=
name|NULL
condition|)
name|v
operator|=
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val1p
operator|)
expr_stmt|;
else|else
name|v
operator|=
operator|!
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val2p
operator|)
expr_stmt|;
if|if
condition|(
name|v
condition|)
return|return
name|g_strdup
argument_list|(
literal|"yes"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"no"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|position_to_str (gpointer val1p,gpointer val2p)
name|position_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
literal|40
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%d %d"
argument_list|,
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val1p
operator|)
argument_list|,
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val2p
operator|)
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|mem_size_to_str (gpointer val1p,gpointer val2p)
name|mem_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|size
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
name|size
operator|=
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val1p
operator|)
expr_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
literal|20
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|%
literal|1048576
operator|==
literal|0
condition|)
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%dM"
argument_list|,
name|size
operator|/
literal|1048576
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|size
operator|%
literal|1024
operator|==
literal|0
condition|)
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%dK"
argument_list|,
name|size
operator|/
literal|1024
argument_list|)
expr_stmt|;
else|else
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%dB"
argument_list|,
name|size
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|image_type_to_str (gpointer val1p,gpointer val2p)
name|image_type_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|int
name|type
decl_stmt|;
name|type
operator|=
operator|*
operator|(
operator|(
name|int
operator|*
operator|)
name|val1p
operator|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
name|GRAY
condition|)
return|return
name|g_strdup
argument_list|(
literal|"gray"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"rgb"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|color_cube_to_str (gpointer val1p,gpointer val2p)
name|color_cube_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
name|char
modifier|*
name|str
decl_stmt|;
name|str
operator|=
name|g_malloc
argument_list|(
literal|40
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|str
argument_list|,
literal|"%d %d %d  %d"
argument_list|,
name|color_cube_shades
index|[
literal|0
index|]
argument_list|,
name|color_cube_shades
index|[
literal|1
index|]
argument_list|,
name|color_cube_shades
index|[
literal|2
index|]
argument_list|,
name|color_cube_shades
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
return|return
name|str
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|preview_size_to_str (gpointer val1p,gpointer val2p)
name|preview_size_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
if|if
condition|(
name|preview_size
operator|>=
literal|128
condition|)
return|return
name|g_strdup
argument_list|(
literal|"large"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|preview_size
operator|>=
literal|64
condition|)
return|return
name|g_strdup
argument_list|(
literal|"medium"
argument_list|)
return|;
elseif|else
if|if
condition|(
name|preview_size
operator|>=
literal|32
condition|)
return|return
name|g_strdup
argument_list|(
literal|"small"
argument_list|)
return|;
else|else
return|return
name|g_strdup
argument_list|(
literal|"none"
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|ruler_units_to_str (gpointer val1p,gpointer val2p)
name|ruler_units_to_str
parameter_list|(
name|gpointer
name|val1p
parameter_list|,
name|gpointer
name|val2p
parameter_list|)
block|{
switch|switch
condition|(
name|ruler_units
condition|)
block|{
case|case
name|GTK_INCHES
case|:
return|return
name|g_strdup
argument_list|(
literal|"inches"
argument_list|)
return|;
case|case
name|GTK_CENTIMETERS
case|:
return|return
name|g_strdup
argument_list|(
literal|"centimeters"
argument_list|)
return|;
case|case
name|GTK_PIXELS
case|:
return|return
name|g_strdup
argument_list|(
literal|"pixels"
argument_list|)
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|add_gimp_directory_token (char * gimp_dir)
name|add_gimp_directory_token
parameter_list|(
name|char
modifier|*
name|gimp_dir
parameter_list|)
block|{
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
comment|/*     The token holds data from a static buffer which is initialized     once.  There should be no need to change an already-existing     value.   */
if|if
condition|(
name|NULL
operator|!=
name|gimprc_find_token
argument_list|(
literal|"gimp_dir"
argument_list|)
condition|)
return|return;
name|ut
operator|=
name|g_new
argument_list|(
name|UnknownToken
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|ut
operator|->
name|token
operator|=
name|g_strdup
argument_list|(
literal|"gimp_dir"
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|g_strdup
argument_list|(
name|gimp_dir
argument_list|)
expr_stmt|;
comment|/* Similarly, transforming the path should be silly. */
name|unknown_tokens
operator|=
name|g_list_append
argument_list|(
name|unknown_tokens
argument_list|,
name|ut
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* Try to:     1. Open gimprc for reading.     2. Rename gimprc to gimprc.old.     3. Open gimprc for writing.     On success, return NULL. On failure, return a string in English    explaining the problem.     */
end_comment

begin_function
specifier|static
name|char
modifier|*
DECL|function|open_backup_file (char * filename,FILE ** fp_new,FILE ** fp_old)
name|open_backup_file
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_new
parameter_list|,
name|FILE
modifier|*
modifier|*
name|fp_old
parameter_list|)
block|{
name|char
modifier|*
name|oldfilename
decl_stmt|;
comment|/*     Rename the file to *.old, open it for reading and create the new file.   */
if|if
condition|(
operator|(
operator|*
name|fp_old
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"rt"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
if|if
condition|(
name|errno
operator|==
name|EACCES
condition|)
return|return
literal|"Can't open gimprc; permission problems"
return|;
if|if
condition|(
name|errno
operator|==
name|ENOENT
condition|)
return|return
literal|"Can't open gimprc; file does not exist"
return|;
return|return
literal|"Can't open gimprc, reason unknown"
return|;
block|}
name|oldfilename
operator|=
name|g_malloc
argument_list|(
name|strlen
argument_list|(
name|filename
argument_list|)
operator|+
literal|5
argument_list|)
expr_stmt|;
name|sprintf
argument_list|(
name|oldfilename
argument_list|,
literal|"%s.old"
argument_list|,
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|rename
argument_list|(
name|filename
argument_list|,
name|oldfilename
argument_list|)
operator|<
literal|0
condition|)
block|{
name|g_free
argument_list|(
name|oldfilename
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|==
name|EACCES
condition|)
return|return
literal|"Can't rename gimprc to gimprc.old; permission problems"
return|;
if|if
condition|(
name|errno
operator|==
name|EISDIR
condition|)
return|return
literal|"Can't rename gimprc to gimprc.old; gimprc.old is a directory"
return|;
return|return
literal|"Can't rename gimprc to gimprc.old, reason unknown"
return|;
block|}
if|if
condition|(
operator|(
operator|*
name|fp_new
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"wt"
argument_list|)
operator|)
operator|==
name|NULL
condition|)
block|{
operator|(
name|void
operator|)
name|rename
argument_list|(
name|oldfilename
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|oldfilename
argument_list|)
expr_stmt|;
if|if
condition|(
name|errno
operator|==
name|EACCES
condition|)
return|return
literal|"Can't write to gimprc; permission problems"
return|;
return|return
literal|"Can't write to gimprc, reason unknown"
return|;
block|}
name|g_free
argument_list|(
name|oldfilename
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|char
modifier|*
DECL|function|gimprc_find_token (char * token)
name|gimprc_find_token
parameter_list|(
name|char
modifier|*
name|token
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
name|list
operator|=
name|unknown_tokens
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|ut
operator|=
operator|(
name|UnknownToken
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|ut
operator|->
name|token
argument_list|,
name|token
argument_list|)
operator|==
literal|0
condition|)
return|return
name|ut
operator|->
name|value
return|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimprc_set_token (char * token,char * value)
name|gimprc_set_token
parameter_list|(
name|char
modifier|*
name|token
parameter_list|,
name|char
modifier|*
name|value
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|UnknownToken
modifier|*
name|ut
decl_stmt|;
name|list
operator|=
name|unknown_tokens
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|ut
operator|=
operator|(
name|UnknownToken
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|ut
operator|->
name|token
argument_list|,
name|token
argument_list|)
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|ut
operator|->
name|value
operator|!=
name|value
condition|)
block|{
if|if
condition|(
name|ut
operator|->
name|value
condition|)
name|g_free
argument_list|(
name|ut
operator|->
name|value
argument_list|)
expr_stmt|;
name|ut
operator|->
name|value
operator|=
name|value
expr_stmt|;
block|}
break|break;
block|}
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/******************/
end_comment

begin_comment
comment|/*  GIMPRC_QUERY  */
end_comment

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|gimprc_query (Argument * args)
name|gimprc_query
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|int
name|success
init|=
name|TRUE
decl_stmt|;
name|char
modifier|*
name|token
decl_stmt|;
name|char
modifier|*
name|value
decl_stmt|;
name|token
operator|=
operator|(
name|char
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
name|success
operator|=
operator|(
operator|(
name|value
operator|=
name|gimprc_find_token
argument_list|(
name|token
argument_list|)
operator|)
operator|!=
name|NULL
operator|)
expr_stmt|;
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|gimprc_query_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|value
argument_list|)
expr_stmt|;
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|gimprc_query_args
specifier|static
name|ProcArg
name|gimprc_query_args
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"token"
block|,
literal|"the token to query for"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gimprc_query_out_args
specifier|static
name|ProcArg
name|gimprc_query_out_args
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"value"
block|,
literal|"the value associated with the queried token"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|gimprc_query_proc
name|ProcRecord
name|gimprc_query_proc
init|=
block|{
literal|"gimp_gimprc_query"
block|,
literal|"Queries the gimprc file parser for information on a specified token"
block|,
literal|"This procedure is used to locate additional information contained in the gimprc file considered extraneous to the operation of the GIMP.  Plug-ins that need configuration information can expect it will be stored in the user's gimprc file and can use this procedure to retrieve it.  This query procedure will return the value associated with the specified token.  This corresponds _only_ to entries with the format: (<token><value>).  The value must be a string.  Entries not corresponding to this format will cause warnings to be issued on gimprc parsing and will not be queryable."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/*  Input arguments  */
literal|1
block|,
name|gimprc_query_args
block|,
comment|/*  Output arguments  */
literal|1
block|,
name|gimprc_query_out_args
block|,
comment|/*  Exec method  */
block|{
block|{
name|gimprc_query
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

end_unit

