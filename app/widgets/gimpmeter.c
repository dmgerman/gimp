begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * gimpmeter.c  * Copyright (C) 2017 Ell  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpcolor/gimpcolor.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"widgets-types.h"
end_include

begin_include
include|#
directive|include
file|"gimpmeter.h"
end_include

begin_define
DECL|macro|BORDER_WIDTH
define|#
directive|define
name|BORDER_WIDTH
value|1.0
end_define

begin_define
DECL|macro|REV
define|#
directive|define
name|REV
value|(2.0 * G_PI)
end_define

begin_define
DECL|macro|SAMPLE (i)
define|#
directive|define
name|SAMPLE
parameter_list|(
name|i
parameter_list|)
value|(meter->priv->samples + (i) * meter->priv->n_values)
end_define

begin_define
DECL|macro|SAMPLE_SIZE
define|#
directive|define
name|SAMPLE_SIZE
value|(meter->priv->n_values * sizeof (gdouble))
end_define

begin_define
DECL|macro|VALUE (i,j)
define|#
directive|define
name|VALUE
parameter_list|(
name|i
parameter_list|,
name|j
parameter_list|)
value|((SAFE_CLAMP (SAMPLE (i)[j],                              \                                    meter->priv->range_min,                     \                                    meter->priv->range_max) -                   \                         meter->priv->range_min) /                              \                        (meter->priv->range_max - meter->priv->range_min))
end_define

begin_enum
enum|enum
DECL|enum|__anon296d672d0103
block|{
DECL|enumerator|PROP_0
name|PROP_0
block|,
DECL|enumerator|PROP_SIZE
name|PROP_SIZE
block|,
DECL|enumerator|PROP_REFRESH_RATE
name|PROP_REFRESH_RATE
block|,
DECL|enumerator|PROP_RANGE_MIN
name|PROP_RANGE_MIN
block|,
DECL|enumerator|PROP_RANGE_MAX
name|PROP_RANGE_MAX
block|,
DECL|enumerator|PROP_N_VALUES
name|PROP_N_VALUES
block|,
DECL|enumerator|PROP_HISTORY_VISIBLE
name|PROP_HISTORY_VISIBLE
block|,
DECL|enumerator|PROP_HISTORY_DURATION
name|PROP_HISTORY_DURATION
block|,
DECL|enumerator|PROP_HISTORY_RESOLUTION
name|PROP_HISTORY_RESOLUTION
block|,
DECL|enumerator|PROP_LED_ACTIVE
name|PROP_LED_ACTIVE
block|,
DECL|enumerator|PROP_LED_COLOR
name|PROP_LED_COLOR
block|}
enum|;
end_enum

begin_typedef
typedef|typedef
struct|struct
DECL|struct|__anon296d672d0208
block|{
DECL|member|active
name|gboolean
name|active
decl_stmt|;
DECL|member|show_in_gauge
name|gboolean
name|show_in_gauge
decl_stmt|;
DECL|member|show_in_history
name|gboolean
name|show_in_history
decl_stmt|;
DECL|member|color
name|GimpRGB
name|color
decl_stmt|;
DECL|member|interpolation
name|GimpInterpolationType
name|interpolation
decl_stmt|;
DECL|typedef|Value
block|}
name|Value
typedef|;
end_typedef

begin_struct
DECL|struct|_GimpMeterPrivate
struct|struct
name|_GimpMeterPrivate
block|{
DECL|member|mutex
name|GMutex
name|mutex
decl_stmt|;
DECL|member|size
name|gint
name|size
decl_stmt|;
DECL|member|refresh_rate
name|gdouble
name|refresh_rate
decl_stmt|;
DECL|member|range_min
name|gdouble
name|range_min
decl_stmt|;
DECL|member|range_max
name|gdouble
name|range_max
decl_stmt|;
DECL|member|n_values
name|gint
name|n_values
decl_stmt|;
DECL|member|values
name|Value
modifier|*
name|values
decl_stmt|;
DECL|member|history_visible
name|gboolean
name|history_visible
decl_stmt|;
DECL|member|history_duration
name|gdouble
name|history_duration
decl_stmt|;
DECL|member|history_resolution
name|gdouble
name|history_resolution
decl_stmt|;
DECL|member|led_active
name|gboolean
name|led_active
decl_stmt|;
DECL|member|led_color
name|GimpRGB
name|led_color
decl_stmt|;
DECL|member|samples
name|gdouble
modifier|*
name|samples
decl_stmt|;
DECL|member|n_samples
name|gint
name|n_samples
decl_stmt|;
DECL|member|sample_duration
name|gint
name|sample_duration
decl_stmt|;
DECL|member|last_sample_time
name|gint64
name|last_sample_time
decl_stmt|;
DECL|member|current_time
name|gint64
name|current_time
decl_stmt|;
DECL|member|uniform_sample
name|gdouble
modifier|*
name|uniform_sample
decl_stmt|;
DECL|member|timeout_id
name|gint
name|timeout_id
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_meter_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_map
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_size_request
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkRequisition
modifier|*
name|requisition
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_meter_expose_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_meter_timeout
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_clear_history_unlocked
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_update_samples
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_shift_samples
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_meter_mask_sample
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|sample
parameter_list|,
name|gdouble
modifier|*
name|result
parameter_list|)
function_decl|;
end_function_decl

begin_macro
DECL|function|G_DEFINE_TYPE (GimpMeter,gimp_meter,GTK_TYPE_WIDGET)
name|G_DEFINE_TYPE
argument_list|(
argument|GimpMeter
argument_list|,
argument|gimp_meter
argument_list|,
argument|GTK_TYPE_WIDGET
argument_list|)
end_macro

begin_define
DECL|macro|parent_class
define|#
directive|define
name|parent_class
value|gimp_meter_parent_class
end_define

begin_comment
comment|/*  private functions  */
end_comment

begin_function
specifier|static
name|void
name|gimp_meter_class_init
parameter_list|(
name|GimpMeterClass
modifier|*
name|klass
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|object_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GtkWidgetClass
modifier|*
name|widget_class
init|=
name|GTK_WIDGET_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|object_class
operator|->
name|dispose
operator|=
name|gimp_meter_dispose
expr_stmt|;
name|object_class
operator|->
name|finalize
operator|=
name|gimp_meter_finalize
expr_stmt|;
name|object_class
operator|->
name|get_property
operator|=
name|gimp_meter_get_property
expr_stmt|;
name|object_class
operator|->
name|set_property
operator|=
name|gimp_meter_set_property
expr_stmt|;
name|widget_class
operator|->
name|map
operator|=
name|gimp_meter_map
expr_stmt|;
name|widget_class
operator|->
name|unmap
operator|=
name|gimp_meter_unmap
expr_stmt|;
name|widget_class
operator|->
name|size_request
operator|=
name|gimp_meter_size_request
expr_stmt|;
name|widget_class
operator|->
name|expose_event
operator|=
name|gimp_meter_expose_event
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_SIZE
argument_list|,
name|g_param_spec_int
argument_list|(
literal|"size"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|32
argument_list|,
literal|1024
argument_list|,
literal|48
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_REFRESH_RATE
argument_list|,
name|g_param_spec_double
argument_list|(
literal|"refresh-rate"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|0.001
argument_list|,
literal|1000.0
argument_list|,
literal|8.0
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_RANGE_MIN
argument_list|,
name|g_param_spec_double
argument_list|(
literal|"range-min"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|0.0
argument_list|,
name|G_MAXDOUBLE
argument_list|,
literal|0.0
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_RANGE_MAX
argument_list|,
name|g_param_spec_double
argument_list|(
literal|"range-max"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|0.0
argument_list|,
name|G_MAXDOUBLE
argument_list|,
literal|1.0
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_N_VALUES
argument_list|,
name|g_param_spec_int
argument_list|(
literal|"n-values"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
literal|32
argument_list|,
literal|0
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_HISTORY_VISIBLE
argument_list|,
name|g_param_spec_boolean
argument_list|(
literal|"history-visible"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_HISTORY_DURATION
argument_list|,
name|g_param_spec_double
argument_list|(
literal|"history-duration"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|0.0
argument_list|,
literal|3600.0
argument_list|,
literal|60.0
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_HISTORY_RESOLUTION
argument_list|,
name|g_param_spec_double
argument_list|(
literal|"history-resolution"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|0.1
argument_list|,
literal|3600.0
argument_list|,
literal|1.0
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_LED_ACTIVE
argument_list|,
name|g_param_spec_boolean
argument_list|(
literal|"led-active"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_LED_COLOR
argument_list|,
name|gimp_param_spec_rgb
argument_list|(
literal|"led-color"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|TRUE
argument_list|,
operator|&
operator|(
name|GimpRGB
operator|)
block|{}
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_type_class_add_private
argument_list|(
name|klass
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpMeterPrivate
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_init (GimpMeter * meter)
name|gimp_meter_init
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|meter
operator|->
name|priv
operator|=
name|G_TYPE_INSTANCE_GET_PRIVATE
argument_list|(
name|meter
argument_list|,
name|GIMP_TYPE_METER
argument_list|,
name|GimpMeterPrivate
argument_list|)
expr_stmt|;
name|g_mutex_init
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gtk_widget_set_has_window
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|range_min
operator|=
literal|0.0
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|range_max
operator|=
literal|1.0
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|n_values
operator|=
literal|0
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|history_duration
operator|=
literal|60.0
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|history_resolution
operator|=
literal|1.0
expr_stmt|;
name|gimp_meter_update_samples
argument_list|(
name|meter
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_dispose (GObject * object)
name|gimp_meter_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|g_clear_pointer
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|values
argument_list|,
name|g_free
argument_list|)
expr_stmt|;
name|g_clear_pointer
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|samples
argument_list|,
name|g_free
argument_list|)
expr_stmt|;
name|g_clear_pointer
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
argument_list|,
name|g_free
argument_list|)
expr_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|timeout_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|timeout_id
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|timeout_id
operator|=
literal|0
expr_stmt|;
block|}
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|dispose
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_finalize (GObject * object)
name|gimp_meter_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|g_mutex_clear
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|finalize
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_set_property (GObject * object,guint property_id,const GValue * value,GParamSpec * pspec)
name|gimp_meter_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|object
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|property_id
condition|)
block|{
case|case
name|PROP_SIZE
case|:
name|gimp_meter_set_size
argument_list|(
name|meter
argument_list|,
name|g_value_get_int
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_REFRESH_RATE
case|:
name|gimp_meter_set_refresh_rate
argument_list|(
name|meter
argument_list|,
name|g_value_get_double
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_RANGE_MIN
case|:
name|gimp_meter_set_range
argument_list|(
name|meter
argument_list|,
name|g_value_get_double
argument_list|(
name|value
argument_list|)
argument_list|,
name|gimp_meter_get_range_max
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_RANGE_MAX
case|:
name|gimp_meter_set_range
argument_list|(
name|meter
argument_list|,
name|gimp_meter_get_range_min
argument_list|(
name|meter
argument_list|)
argument_list|,
name|g_value_get_double
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_N_VALUES
case|:
name|gimp_meter_set_n_values
argument_list|(
name|meter
argument_list|,
name|g_value_get_int
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HISTORY_VISIBLE
case|:
name|gimp_meter_set_history_visible
argument_list|(
name|meter
argument_list|,
name|g_value_get_boolean
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HISTORY_DURATION
case|:
name|gimp_meter_set_history_duration
argument_list|(
name|meter
argument_list|,
name|g_value_get_double
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HISTORY_RESOLUTION
case|:
name|gimp_meter_set_history_resolution
argument_list|(
name|meter
argument_list|,
name|g_value_get_double
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_LED_ACTIVE
case|:
name|gimp_meter_set_led_active
argument_list|(
name|meter
argument_list|,
name|g_value_get_boolean
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_LED_COLOR
case|:
name|gimp_meter_set_led_color
argument_list|(
name|meter
argument_list|,
name|g_value_get_boxed
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|property_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_get_property (GObject * object,guint property_id,GValue * value,GParamSpec * pspec)
name|gimp_meter_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|object
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|property_id
condition|)
block|{
case|case
name|PROP_SIZE
case|:
name|g_value_set_int
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_size
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_REFRESH_RATE
case|:
name|g_value_set_double
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_refresh_rate
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_RANGE_MIN
case|:
name|g_value_set_double
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_range_min
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_RANGE_MAX
case|:
name|g_value_set_double
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_range_max
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_N_VALUES
case|:
name|g_value_set_int
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_n_values
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HISTORY_VISIBLE
case|:
name|g_value_set_boolean
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_history_visible
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HISTORY_DURATION
case|:
name|g_value_set_int
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_history_duration
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HISTORY_RESOLUTION
case|:
name|g_value_set_int
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_history_resolution
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_LED_ACTIVE
case|:
name|g_value_set_boolean
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_led_active
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_LED_COLOR
case|:
name|g_value_set_boxed
argument_list|(
name|value
argument_list|,
name|gimp_meter_get_led_color
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|property_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_map (GtkWidget * widget)
name|gimp_meter_map
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|map
argument_list|(
name|widget
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|meter
operator|->
name|priv
operator|->
name|timeout_id
condition|)
block|{
name|gint
name|interval
init|=
name|ROUND
argument_list|(
literal|1000.0
operator|/
name|meter
operator|->
name|priv
operator|->
name|refresh_rate
argument_list|)
decl_stmt|;
name|meter
operator|->
name|priv
operator|->
name|timeout_id
operator|=
name|g_timeout_add
argument_list|(
name|interval
argument_list|,
operator|(
name|GSourceFunc
operator|)
name|gimp_meter_timeout
argument_list|,
name|meter
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_unmap (GtkWidget * widget)
name|gimp_meter_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|widget
argument_list|)
decl_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|timeout_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|timeout_id
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|timeout_id
operator|=
literal|0
expr_stmt|;
block|}
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|unmap
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_size_request (GtkWidget * widget,GtkRequisition * requisition)
name|gimp_meter_size_request
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GtkRequisition
modifier|*
name|requisition
parameter_list|)
block|{
name|gint
name|hsize
decl_stmt|;
name|gint
name|vsize
decl_stmt|;
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|hsize
operator|=
name|meter
operator|->
name|priv
operator|->
name|size
expr_stmt|;
name|vsize
operator|=
name|meter
operator|->
name|priv
operator|->
name|size
expr_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|history_visible
condition|)
name|hsize
operator|*=
literal|3
expr_stmt|;
name|requisition
operator|->
name|width
operator|=
name|ceil
argument_list|(
name|hsize
operator|+
literal|2.0
operator|*
name|BORDER_WIDTH
argument_list|)
expr_stmt|;
name|requisition
operator|->
name|height
operator|=
name|ceil
argument_list|(
literal|3.0
operator|/
literal|4.0
operator|*
name|vsize
operator|+
literal|4.0
operator|*
name|BORDER_WIDTH
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_meter_expose_event (GtkWidget * widget,GdkEventExpose * event)
name|gimp_meter_expose_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventExpose
modifier|*
name|event
parameter_list|)
block|{
name|GimpMeter
modifier|*
name|meter
init|=
name|GIMP_METER
argument_list|(
name|widget
argument_list|)
decl_stmt|;
if|if
condition|(
name|gtk_widget_is_drawable
argument_list|(
name|widget
argument_list|)
condition|)
block|{
name|GtkAllocation
name|allocation
decl_stmt|;
name|gint
name|size
init|=
name|meter
operator|->
name|priv
operator|->
name|size
decl_stmt|;
name|GtkStyle
modifier|*
name|style
init|=
name|gtk_widget_get_style
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GtkStateType
name|state
init|=
name|gtk_widget_get_state
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|cairo_t
modifier|*
name|cr
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|j
decl_stmt|;
name|gint
name|k
decl_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|cr
operator|=
name|gdk_cairo_create
argument_list|(
name|event
operator|->
name|window
argument_list|)
expr_stmt|;
name|gdk_cairo_region
argument_list|(
name|cr
argument_list|,
name|event
operator|->
name|region
argument_list|)
expr_stmt|;
name|cairo_clip
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|widget
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
comment|/* translate to allocation top-left */
name|cairo_translate
argument_list|(
name|cr
argument_list|,
name|allocation
operator|.
name|x
argument_list|,
name|allocation
operator|.
name|y
argument_list|)
expr_stmt|;
name|cairo_save
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* translate to gauge center */
name|cairo_translate
argument_list|(
name|cr
argument_list|,
literal|0.5
operator|*
name|BORDER_WIDTH
operator|+
literal|0.5
operator|*
name|size
argument_list|,
literal|1.5
operator|*
name|BORDER_WIDTH
operator|+
literal|2.0
operator|/
literal|3.0
operator|*
operator|(
name|allocation
operator|.
name|height
operator|-
literal|4.0
operator|*
name|BORDER_WIDTH
operator|)
argument_list|)
expr_stmt|;
name|cairo_save
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* paint led */
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|led_active
condition|)
block|{
name|cairo_arc
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.06
operator|*
name|size
argument_list|,
literal|0.0
operator|*
name|REV
argument_list|,
literal|1.0
operator|*
name|REV
argument_list|)
expr_stmt|;
name|gimp_cairo_set_source_rgba
argument_list|(
name|cr
argument_list|,
operator|&
name|meter
operator|->
name|priv
operator|->
name|led_color
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
comment|/* clip to gauge interior */
name|cairo_arc
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.5
operator|*
name|size
argument_list|,
literal|5.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|,
literal|1.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|)
expr_stmt|;
name|cairo_arc_negative
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.1
operator|*
name|size
argument_list|,
literal|1.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|,
literal|5.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|)
expr_stmt|;
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_clip
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* paint gauge background */
name|gdk_cairo_set_source_color
argument_list|(
name|cr
argument_list|,
operator|&
name|style
operator|->
name|light
index|[
name|state
index|]
argument_list|)
expr_stmt|;
name|cairo_paint
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* paint values of last sample */
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|range_min
operator|<
name|meter
operator|->
name|priv
operator|->
name|range_max
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
condition|;
name|i
operator|++
control|)
block|{
name|gdouble
name|v
init|=
name|VALUE
argument_list|(
literal|0
argument_list|,
name|i
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|active
operator|||
operator|!
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|show_in_gauge
condition|)
block|{
continue|continue;
block|}
name|gimp_cairo_set_source_rgba
argument_list|(
name|cr
argument_list|,
operator|&
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
name|cairo_move_to
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|cairo_arc
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.5
operator|*
name|size
argument_list|,
literal|5.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|,
operator|(
literal|5.0
operator|/
literal|12.0
operator|+
literal|2.0
operator|/
literal|3.0
operator|*
name|v
operator|)
operator|*
name|REV
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
block|}
name|cairo_restore
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* paint gauge border */
name|gdk_cairo_set_source_color
argument_list|(
name|cr
argument_list|,
operator|&
name|style
operator|->
name|fg
index|[
name|state
index|]
argument_list|)
expr_stmt|;
name|cairo_set_line_width
argument_list|(
name|cr
argument_list|,
name|BORDER_WIDTH
argument_list|)
expr_stmt|;
name|cairo_arc
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.5
operator|*
name|size
argument_list|,
literal|5.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|,
literal|1.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|)
expr_stmt|;
name|cairo_arc_negative
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.1
operator|*
name|size
argument_list|,
literal|1.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|,
literal|5.0
operator|/
literal|12.0
operator|*
name|REV
argument_list|)
expr_stmt|;
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* history */
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|history_visible
condition|)
block|{
name|gdouble
name|a1
decl_stmt|,
name|a2
decl_stmt|;
name|gdouble
name|history_x1
decl_stmt|,
name|history_y1
decl_stmt|;
name|gdouble
name|history_x2
decl_stmt|,
name|history_y2
decl_stmt|;
name|cairo_save
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|a1
operator|=
operator|+
name|asin
argument_list|(
literal|0.25
operator|/
literal|0.6
argument_list|)
expr_stmt|;
name|a2
operator|=
operator|-
name|asin
argument_list|(
literal|0.50
operator|/
literal|0.6
argument_list|)
expr_stmt|;
comment|/* clip to history interior */
name|cairo_arc_negative
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.6
operator|*
name|size
argument_list|,
name|a1
argument_list|,
name|a2
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|allocation
operator|.
name|width
operator|-
name|BORDER_WIDTH
operator|-
literal|0.5
operator|*
name|size
argument_list|,
operator|-
literal|0.50
operator|*
name|size
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|allocation
operator|.
name|width
operator|-
name|BORDER_WIDTH
operator|-
literal|0.5
operator|*
name|size
argument_list|,
literal|0.25
operator|*
name|size
argument_list|)
expr_stmt|;
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_clip
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_clip_extents
argument_list|(
name|cr
argument_list|,
operator|&
name|history_x1
argument_list|,
operator|&
name|history_y1
argument_list|,
operator|&
name|history_x2
argument_list|,
operator|&
name|history_y2
argument_list|)
expr_stmt|;
name|history_x1
operator|=
name|floor
argument_list|(
name|history_x1
argument_list|)
expr_stmt|;
name|history_y1
operator|=
name|floor
argument_list|(
name|history_y1
argument_list|)
expr_stmt|;
name|history_x2
operator|=
name|ceil
argument_list|(
name|history_x2
argument_list|)
expr_stmt|;
name|history_y2
operator|=
name|ceil
argument_list|(
name|history_y2
argument_list|)
expr_stmt|;
comment|/* paint history background */
name|gdk_cairo_set_source_color
argument_list|(
name|cr
argument_list|,
operator|&
name|style
operator|->
name|light
index|[
name|state
index|]
argument_list|)
expr_stmt|;
name|cairo_paint
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* history graph */
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|range_min
operator|<
name|meter
operator|->
name|priv
operator|->
name|range_max
condition|)
block|{
name|gdouble
name|sample_width
init|=
operator|(
name|history_x2
operator|-
name|history_x1
operator|)
operator|/
operator|(
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
literal|4
operator|)
decl_stmt|;
name|gdouble
name|dx
init|=
literal|1.0
operator|/
name|sample_width
decl_stmt|;
name|cairo_save
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* translate to history bottom-right, and scale so that the                * x-axis points left, and has a length of one sample, and the                * y-axis points up, and has a length of the history window.                */
name|cairo_translate
argument_list|(
name|cr
argument_list|,
name|history_x2
argument_list|,
name|history_y2
argument_list|)
expr_stmt|;
name|cairo_scale
argument_list|(
name|cr
argument_list|,
operator|-
name|sample_width
argument_list|,
operator|-
operator|(
name|history_y2
operator|-
name|history_y1
operator|)
argument_list|)
expr_stmt|;
name|cairo_translate
argument_list|(
name|cr
argument_list|,
call|(
name|gdouble
call|)
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|current_time
operator|-
name|meter
operator|->
name|priv
operator|->
name|last_sample_time
operator|*
name|meter
operator|->
name|priv
operator|->
name|sample_duration
argument_list|)
operator|/
name|meter
operator|->
name|priv
operator|->
name|sample_duration
operator|-
literal|2.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
comment|/* paint history graph for each value */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
condition|;
name|i
operator|++
control|)
block|{
name|gdouble
name|y
decl_stmt|;
if|if
condition|(
operator|!
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|active
operator|||
operator|!
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|show_in_history
condition|)
block|{
continue|continue;
block|}
name|gimp_cairo_set_source_rgba
argument_list|(
name|cr
argument_list|,
operator|&
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|color
argument_list|)
expr_stmt|;
name|cairo_move_to
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|interpolation
condition|)
block|{
case|case
name|GIMP_INTERPOLATION_NONE
case|:
block|{
for|for
control|(
name|j
operator|=
literal|1
init|;
name|j
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
literal|2
condition|;
name|j
operator|++
control|)
block|{
name|gdouble
name|y0
init|=
name|VALUE
argument_list|(
name|j
operator|-
literal|1
argument_list|,
name|i
argument_list|)
decl_stmt|;
name|gdouble
name|y1
init|=
name|VALUE
argument_list|(
name|j
argument_list|,
name|i
argument_list|)
decl_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|j
argument_list|,
name|y0
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|j
argument_list|,
name|y1
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GIMP_INTERPOLATION_LINEAR
case|:
block|{
for|for
control|(
name|j
operator|=
literal|1
init|;
name|j
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
literal|2
condition|;
name|j
operator|++
control|)
block|{
name|gdouble
name|y
init|=
name|VALUE
argument_list|(
name|j
argument_list|,
name|i
argument_list|)
decl_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|j
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|GIMP_INTERPOLATION_CUBIC
case|:
default|default:
block|{
for|for
control|(
name|j
operator|=
literal|1
init|;
name|j
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
literal|2
condition|;
name|j
operator|++
control|)
block|{
name|gdouble
name|y
index|[
literal|4
index|]
decl_stmt|;
name|gdouble
name|t
index|[
literal|2
index|]
decl_stmt|;
name|gdouble
name|c
index|[
literal|4
index|]
decl_stmt|;
name|gdouble
name|x
decl_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
literal|4
condition|;
name|k
operator|++
control|)
name|y
index|[
name|k
index|]
operator|=
name|VALUE
argument_list|(
name|j
operator|+
name|k
operator|-
literal|1
argument_list|,
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|k
operator|=
literal|0
init|;
name|k
operator|<
literal|2
condition|;
name|k
operator|++
control|)
block|{
name|t
index|[
name|k
index|]
operator|=
operator|(
name|y
index|[
name|k
operator|+
literal|2
index|]
operator|-
name|y
index|[
name|k
index|]
operator|)
operator|/
literal|2.0
expr_stmt|;
name|t
index|[
name|k
index|]
operator|=
name|CLAMP
argument_list|(
name|t
index|[
name|k
index|]
argument_list|,
name|y
index|[
name|k
operator|+
literal|1
index|]
operator|-
literal|1.0
argument_list|,
name|y
index|[
name|k
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
name|t
index|[
name|k
index|]
operator|=
name|CLAMP
argument_list|(
name|t
index|[
name|k
index|]
argument_list|,
operator|-
name|y
index|[
name|k
operator|+
literal|1
index|]
argument_list|,
literal|1.0
operator|-
name|y
index|[
name|k
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|c
index|[
literal|0
index|]
operator|=
name|y
index|[
literal|1
index|]
expr_stmt|;
name|c
index|[
literal|1
index|]
operator|=
name|t
index|[
literal|0
index|]
expr_stmt|;
name|c
index|[
literal|2
index|]
operator|=
literal|3
operator|*
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|1
index|]
operator|)
operator|-
literal|2
operator|*
name|t
index|[
literal|0
index|]
operator|-
name|t
index|[
literal|1
index|]
expr_stmt|;
name|c
index|[
literal|3
index|]
operator|=
name|t
index|[
literal|0
index|]
operator|+
name|t
index|[
literal|1
index|]
operator|-
literal|2
operator|*
operator|(
name|y
index|[
literal|2
index|]
operator|-
name|y
index|[
literal|1
index|]
operator|)
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0.0
init|;
name|x
operator|<
literal|1.0
condition|;
name|x
operator|+=
name|dx
control|)
block|{
name|gdouble
name|y
init|=
operator|(
operator|(
name|c
index|[
literal|3
index|]
operator|*
name|x
operator|+
name|c
index|[
literal|2
index|]
operator|)
operator|*
name|x
operator|+
name|c
index|[
literal|1
index|]
operator|)
operator|*
name|x
operator|+
name|c
index|[
literal|0
index|]
decl_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|j
operator|+
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
block|}
block|}
break|break;
block|}
name|y
operator|=
name|VALUE
argument_list|(
name|j
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
literal|2
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
literal|2
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_fill
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
name|cairo_restore
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
comment|/* paint history grid */
name|cairo_set_antialias
argument_list|(
name|cr
argument_list|,
name|CAIRO_ANTIALIAS_NONE
argument_list|)
expr_stmt|;
name|cairo_set_source_rgba
argument_list|(
name|cr
argument_list|,
operator|(
name|gdouble
operator|)
name|style
operator|->
name|fg
index|[
name|state
index|]
operator|.
name|red
operator|/
literal|0xffff
argument_list|,
operator|(
name|gdouble
operator|)
name|style
operator|->
name|fg
index|[
name|state
index|]
operator|.
name|green
operator|/
literal|0xffff
argument_list|,
operator|(
name|gdouble
operator|)
name|style
operator|->
name|fg
index|[
name|state
index|]
operator|.
name|blue
operator|/
literal|0xffff
argument_list|,
literal|0.3
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|cairo_move_to
argument_list|(
name|cr
argument_list|,
name|history_x1
argument_list|,
name|history_y1
operator|+
name|i
operator|/
literal|4.0
operator|*
operator|(
name|history_y2
operator|-
name|history_y1
operator|)
argument_list|)
expr_stmt|;
name|cairo_rel_line_to
argument_list|(
name|cr
argument_list|,
name|history_x2
operator|-
name|history_x1
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|6
condition|;
name|i
operator|++
control|)
block|{
name|cairo_move_to
argument_list|(
name|cr
argument_list|,
name|history_x1
operator|+
name|i
operator|/
literal|6.0
operator|*
operator|(
name|history_x2
operator|-
name|history_x1
operator|)
argument_list|,
name|history_y1
argument_list|)
expr_stmt|;
name|cairo_rel_line_to
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
name|history_y2
operator|-
name|history_y1
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
name|cairo_restore
argument_list|(
name|cr
argument_list|)
expr_stmt|;
comment|/* paint history border */
name|cairo_arc_negative
argument_list|(
name|cr
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.6
operator|*
name|size
argument_list|,
name|a1
argument_list|,
name|a2
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|allocation
operator|.
name|width
operator|-
name|BORDER_WIDTH
operator|-
literal|0.5
operator|*
name|size
argument_list|,
operator|-
literal|0.50
operator|*
name|size
argument_list|)
expr_stmt|;
name|cairo_line_to
argument_list|(
name|cr
argument_list|,
name|allocation
operator|.
name|width
operator|-
name|BORDER_WIDTH
operator|-
literal|0.5
operator|*
name|size
argument_list|,
literal|0.25
operator|*
name|size
argument_list|)
expr_stmt|;
name|cairo_close_path
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_stroke
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
name|cairo_restore
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|cairo_destroy
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_meter_timeout (GimpMeter * meter)
name|gimp_meter_timeout
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|gboolean
name|uniform
init|=
name|TRUE
decl_stmt|;
name|gboolean
name|redraw
init|=
name|TRUE
decl_stmt|;
name|gdouble
name|sample0
index|[
name|meter
operator|->
name|priv
operator|->
name|n_values
index|]
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_meter_shift_samples
argument_list|(
name|meter
argument_list|)
expr_stmt|;
name|gimp_meter_mask_sample
argument_list|(
name|meter
argument_list|,
name|SAMPLE
argument_list|(
literal|0
argument_list|)
argument_list|,
name|sample0
argument_list|)
expr_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|history_visible
condition|)
block|{
for|for
control|(
name|i
operator|=
literal|1
init|;
name|uniform
operator|&&
name|i
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_samples
condition|;
name|i
operator|++
control|)
block|{
name|gdouble
name|sample
index|[
name|meter
operator|->
name|priv
operator|->
name|n_values
index|]
decl_stmt|;
name|gimp_meter_mask_sample
argument_list|(
name|meter
argument_list|,
name|SAMPLE
argument_list|(
name|i
argument_list|)
argument_list|,
name|sample
argument_list|)
expr_stmt|;
name|uniform
operator|=
operator|!
name|memcmp
argument_list|(
name|sample0
argument_list|,
name|sample
argument_list|,
name|SAMPLE_SIZE
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|uniform
operator|&&
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
condition|)
name|redraw
operator|=
name|memcmp
argument_list|(
name|sample0
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
argument_list|,
name|SAMPLE_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|uniform
condition|)
block|{
if|if
condition|(
operator|!
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
condition|)
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
operator|=
name|g_malloc
argument_list|(
name|SAMPLE_SIZE
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
argument_list|,
name|sample0
argument_list|,
name|SAMPLE_SIZE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_clear_pointer
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
argument_list|,
name|g_free
argument_list|)
expr_stmt|;
block|}
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
if|if
condition|(
name|redraw
condition|)
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|G_SOURCE_CONTINUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_clear_history_unlocked (GimpMeter * meter)
name|gimp_meter_clear_history_unlocked
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|meter
operator|->
name|priv
operator|->
name|current_time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|last_sample_time
operator|=
name|meter
operator|->
name|priv
operator|->
name|current_time
operator|/
name|meter
operator|->
name|priv
operator|->
name|sample_duration
expr_stmt|;
name|memset
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|samples
argument_list|,
literal|0
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|*
name|SAMPLE_SIZE
argument_list|)
expr_stmt|;
name|g_clear_pointer
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|uniform_sample
argument_list|,
name|g_free
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_update_samples (GimpMeter * meter)
name|gimp_meter_update_samples
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|=
name|ceil
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|history_duration
operator|/
name|meter
operator|->
name|priv
operator|->
name|history_resolution
argument_list|)
operator|+
literal|4
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|samples
operator|=
name|g_renew
argument_list|(
name|gdouble
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|samples
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|*
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|sample_duration
operator|=
name|ROUND
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|history_resolution
operator|*
name|G_TIME_SPAN_SECOND
argument_list|)
expr_stmt|;
name|gimp_meter_clear_history_unlocked
argument_list|(
name|meter
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_shift_samples (GimpMeter * meter)
name|gimp_meter_shift_samples
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|gint64
name|time
decl_stmt|;
name|gint
name|n_new_samples
decl_stmt|;
name|meter
operator|->
name|priv
operator|->
name|current_time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
name|time
operator|=
name|meter
operator|->
name|priv
operator|->
name|current_time
operator|/
name|meter
operator|->
name|priv
operator|->
name|sample_duration
expr_stmt|;
name|n_new_samples
operator|=
name|MIN
argument_list|(
name|time
operator|-
name|meter
operator|->
name|priv
operator|->
name|last_sample_time
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
literal|1
argument_list|)
expr_stmt|;
name|memmove
argument_list|(
name|SAMPLE
argument_list|(
name|n_new_samples
argument_list|)
argument_list|,
name|SAMPLE
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|(
name|meter
operator|->
name|priv
operator|->
name|n_samples
operator|-
name|n_new_samples
operator|)
operator|*
name|SAMPLE_SIZE
argument_list|)
expr_stmt|;
name|gegl_memset_pattern
argument_list|(
name|SAMPLE
argument_list|(
literal|0
argument_list|)
argument_list|,
name|SAMPLE
argument_list|(
name|n_new_samples
argument_list|)
argument_list|,
name|SAMPLE_SIZE
argument_list|,
name|n_new_samples
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|last_sample_time
operator|=
name|time
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_meter_mask_sample (GimpMeter * meter,const gdouble * sample,gdouble * result)
name|gimp_meter_mask_sample
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|sample
parameter_list|,
name|gdouble
modifier|*
name|result
parameter_list|)
block|{
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|active
operator|&&
operator|(
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|show_in_gauge
operator|||
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|i
index|]
operator|.
name|show_in_history
operator|)
condition|)
block|{
name|result
index|[
name|i
index|]
operator|=
name|sample
index|[
name|i
index|]
expr_stmt|;
block|}
else|else
block|{
name|result
index|[
name|i
index|]
operator|=
literal|0.0
expr_stmt|;
block|}
block|}
block|}
end_function

begin_comment
comment|/*  public functions  */
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_meter_new (gint n_values)
name|gimp_meter_new
parameter_list|(
name|gint
name|n_values
parameter_list|)
block|{
return|return
name|g_object_new
argument_list|(
name|GIMP_TYPE_METER
argument_list|,
literal|"n-values"
argument_list|,
name|n_values
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_size (GimpMeter * meter,gint size)
name|gimp_meter_set_size
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|size
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|size
operator|>
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|!=
name|meter
operator|->
name|priv
operator|->
name|size
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|size
operator|=
name|size
expr_stmt|;
name|gtk_widget_queue_resize
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"size"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gint
DECL|function|gimp_meter_get_size (GimpMeter * meter)
name|gimp_meter_get_size
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|size
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_refresh_rate (GimpMeter * meter,gdouble rate)
name|gimp_meter_set_refresh_rate
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gdouble
name|rate
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|rate
operator|>
literal|0.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|rate
operator|!=
name|meter
operator|->
name|priv
operator|->
name|refresh_rate
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|refresh_rate
operator|=
name|rate
expr_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|timeout_id
condition|)
block|{
name|gint
name|interval
init|=
name|ROUND
argument_list|(
literal|1000.0
operator|/
name|meter
operator|->
name|priv
operator|->
name|refresh_rate
argument_list|)
decl_stmt|;
name|g_source_remove
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|timeout_id
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|timeout_id
operator|=
name|g_timeout_add
argument_list|(
name|interval
argument_list|,
operator|(
name|GSourceFunc
operator|)
name|gimp_meter_timeout
argument_list|,
name|meter
argument_list|)
expr_stmt|;
block|}
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"refresh-rate"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gdouble
DECL|function|gimp_meter_get_refresh_rate (GimpMeter * meter)
name|gimp_meter_get_refresh_rate
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|refresh_rate
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_range (GimpMeter * meter,gdouble min,gdouble max)
name|gimp_meter_set_range
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gdouble
name|min
parameter_list|,
name|gdouble
name|max
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|min
operator|<=
name|max
argument_list|)
expr_stmt|;
if|if
condition|(
name|min
operator|!=
name|meter
operator|->
name|priv
operator|->
name|range_min
condition|)
block|{
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|range_min
operator|=
name|min
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"range-min"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|max
operator|!=
name|meter
operator|->
name|priv
operator|->
name|range_max
condition|)
block|{
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|range_max
operator|=
name|max
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"range-max"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gdouble
DECL|function|gimp_meter_get_range_min (GimpMeter * meter)
name|gimp_meter_get_range_min
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|range_min
return|;
block|}
end_function

begin_function
name|gdouble
DECL|function|gimp_meter_get_range_max (GimpMeter * meter)
name|gimp_meter_get_range_max
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|range_max
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_n_values (GimpMeter * meter,gint n_values)
name|gimp_meter_set_n_values
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|n_values
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|n_values
operator|>=
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_values
operator|!=
name|meter
operator|->
name|priv
operator|->
name|n_values
condition|)
block|{
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|values
operator|=
name|g_renew
argument_list|(
name|Value
argument_list|,
name|meter
operator|->
name|priv
operator|->
name|values
argument_list|,
name|n_values
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_values
operator|>
name|meter
operator|->
name|priv
operator|->
name|n_values
condition|)
block|{
name|gegl_memset_pattern
argument_list|(
name|meter
operator|->
name|priv
operator|->
name|values
argument_list|,
operator|&
operator|(
name|Value
operator|)
block|{
operator|.
name|active
operator|=
name|TRUE
block|,
operator|.
name|show_in_gauge
operator|=
name|TRUE
block|,
operator|.
name|show_in_history
operator|=
name|TRUE
block|,
operator|.
name|interpolation
operator|=
name|GIMP_INTERPOLATION_CUBIC
block|}
argument_list|,
sizeof|sizeof
argument_list|(
name|Value
argument_list|)
argument_list|,
name|n_values
operator|-
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|)
expr_stmt|;
block|}
name|meter
operator|->
name|priv
operator|->
name|n_values
operator|=
name|n_values
expr_stmt|;
name|gimp_meter_update_samples
argument_list|(
name|meter
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"n-values"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gint
DECL|function|gimp_meter_get_n_values (GimpMeter * meter)
name|gimp_meter_get_n_values
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|n_values
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_value_active (GimpMeter * meter,gint value,gboolean active)
name|gimp_meter_set_value_active
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|,
name|gboolean
name|active
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|)
expr_stmt|;
if|if
condition|(
name|active
operator|!=
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|active
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|active
operator|=
name|active
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_meter_get_value_active (GimpMeter * meter,gint value)
name|gimp_meter_get_value_active
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|active
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_value_color (GimpMeter * meter,gint value,const GimpRGB * color)
name|gimp_meter_set_value_color
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|color
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|color
argument_list|,
operator|&
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|color
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpRGB
argument_list|)
argument_list|)
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|color
operator|=
operator|*
name|color
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|const
name|GimpRGB
modifier|*
DECL|function|gimp_meter_get_value_color (GimpMeter * meter,gint value)
name|gimp_meter_get_value_color
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
operator|&
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|color
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_value_interpolation (GimpMeter * meter,gint value,GimpInterpolationType interpolation)
name|gimp_meter_set_value_interpolation
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|,
name|GimpInterpolationType
name|interpolation
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|)
expr_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|interpolation
operator|!=
name|interpolation
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|interpolation
operator|=
name|interpolation
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|GimpInterpolationType
DECL|function|gimp_meter_get_value_interpolation (GimpMeter * meter,gint value)
name|gimp_meter_get_value_interpolation
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|,
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|interpolation
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_value_show_in_gauge (GimpMeter * meter,gint value,gboolean show)
name|gimp_meter_set_value_show_in_gauge
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|,
name|gboolean
name|show
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|)
expr_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|show_in_gauge
operator|!=
name|show
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|show_in_gauge
operator|=
name|show
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_meter_get_value_show_in_gauge (GimpMeter * meter,gint value)
name|gimp_meter_get_value_show_in_gauge
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|show_in_gauge
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_value_show_in_history (GimpMeter * meter,gint value,gboolean show)
name|gimp_meter_set_value_show_in_history
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|,
name|gboolean
name|show
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|)
expr_stmt|;
if|if
condition|(
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|show_in_history
operator|!=
name|show
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|show_in_history
operator|=
name|show
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_meter_get_value_show_in_history (GimpMeter * meter,gint value)
name|gimp_meter_get_value_show_in_history
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gint
name|value
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|value
operator|>=
literal|0
operator|&&
name|value
operator|<
name|meter
operator|->
name|priv
operator|->
name|n_values
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|values
index|[
name|value
index|]
operator|.
name|show_in_history
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_history_visible (GimpMeter * meter,gboolean visible)
name|gimp_meter_set_history_visible
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gboolean
name|visible
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|visible
operator|!=
name|meter
operator|->
name|priv
operator|->
name|history_visible
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|history_visible
operator|=
name|visible
expr_stmt|;
name|gtk_widget_queue_resize
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"history-visible"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_meter_get_history_visible (GimpMeter * meter)
name|gimp_meter_get_history_visible
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|history_visible
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_history_duration (GimpMeter * meter,gdouble duration)
name|gimp_meter_set_history_duration
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gdouble
name|duration
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|duration
operator|>=
literal|0.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|duration
operator|!=
name|meter
operator|->
name|priv
operator|->
name|history_duration
condition|)
block|{
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|history_duration
operator|=
name|duration
expr_stmt|;
name|gimp_meter_update_samples
argument_list|(
name|meter
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"history-duration"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gdouble
DECL|function|gimp_meter_get_history_duration (GimpMeter * meter)
name|gimp_meter_get_history_duration
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|history_duration
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_history_resolution (GimpMeter * meter,gdouble resolution)
name|gimp_meter_set_history_resolution
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gdouble
name|resolution
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|resolution
operator|>
literal|0.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|resolution
operator|!=
name|meter
operator|->
name|priv
operator|->
name|history_resolution
condition|)
block|{
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|meter
operator|->
name|priv
operator|->
name|history_resolution
operator|=
name|resolution
expr_stmt|;
name|gimp_meter_update_samples
argument_list|(
name|meter
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"history-resolution"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gdouble
DECL|function|gimp_meter_get_history_resolution (GimpMeter * meter)
name|gimp_meter_get_history_resolution
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|history_resolution
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_clear_history (GimpMeter * meter)
name|gimp_meter_clear_history
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_meter_clear_history_unlocked
argument_list|(
name|meter
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_add_sample (GimpMeter * meter,const gdouble * sample)
name|gimp_meter_add_sample
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
specifier|const
name|gdouble
modifier|*
name|sample
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|sample
operator|!=
name|NULL
operator|||
name|meter
operator|->
name|priv
operator|->
name|n_values
operator|==
literal|0
argument_list|)
expr_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_meter_shift_samples
argument_list|(
name|meter
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|SAMPLE
argument_list|(
literal|0
argument_list|)
argument_list|,
name|sample
argument_list|,
name|SAMPLE_SIZE
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|meter
operator|->
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_led_active (GimpMeter * meter,gboolean active)
name|gimp_meter_set_led_active
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
name|gboolean
name|active
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|active
operator|!=
name|meter
operator|->
name|priv
operator|->
name|led_active
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|led_active
operator|=
name|active
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"led-active"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_meter_get_led_active (GimpMeter * meter)
name|gimp_meter_get_led_active
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|meter
operator|->
name|priv
operator|->
name|led_active
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_meter_set_led_color (GimpMeter * meter,const GimpRGB * color)
name|gimp_meter_set_led_color
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|,
specifier|const
name|GimpRGB
modifier|*
name|color
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|color
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|memcmp
argument_list|(
name|color
argument_list|,
operator|&
name|meter
operator|->
name|priv
operator|->
name|led_color
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpRGB
argument_list|)
argument_list|)
condition|)
block|{
name|meter
operator|->
name|priv
operator|->
name|led_color
operator|=
operator|*
name|color
expr_stmt|;
name|gtk_widget_queue_draw
argument_list|(
name|GTK_WIDGET
argument_list|(
name|meter
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|meter
argument_list|)
argument_list|,
literal|"led-color"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|const
name|GimpRGB
modifier|*
DECL|function|gimp_meter_get_led_color (GimpMeter * meter)
name|gimp_meter_get_led_color
parameter_list|(
name|GimpMeter
modifier|*
name|meter
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
operator|&
name|meter
operator|->
name|priv
operator|->
name|led_color
return|;
block|}
end_function

end_unit

