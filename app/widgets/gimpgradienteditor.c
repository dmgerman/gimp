begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * Gradient editor module copyight (C) 1996-1997 Federico Mena Quintero  * federico@nuclecu.unam.mx  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURIGHTE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* alt: Added previews and some other buttons to gradient dialog.   *  * hof: Hofer Wolfgang, 1998.01.27   avoid resize bug by keeping   *                                   preview widgetsize constant.  * hof: Hofer Wolfgang, 1997.10.17   Added "Load From FG color"  */
end_comment

begin_comment
comment|/* Release date: 1997/06/02  *  * - Added the following procedural_db calls:  *     gimp_gradients_get_list  *     gimp_gradients_get_active  *     gimp_gradients_set_active  *     gimp_gradients_sample_uniform  *     gimp_gradients_sample_custom  *   Many thanks to Eiichi and Marcelo for their suggestions!  */
end_comment

begin_comment
comment|/* Release date: 1997/05/07  *  * - Added accelerator keys for the popup functions.  This allows for  * very fast operation of the editor.  *  * - Added Replicate Selection function.  *  * - Re-arranged the pop-up menu a bit; it was getting too big.  I am  * still not entirely happy with it.  *  * - Added grad_dump_gradient(); it is useful for debugging.  */
end_comment

begin_comment
comment|/* Release date: 1997/04/30  *  * - All `dangerous' dialogs now de-sensitize the main editor window.  * This fixes a lot of potential bugs when the dialogs are active.  *  * - Fixed two bugs due to uninitialized variables, one in  * prev_events() (thanks to Marcelo for pointing it out) and another  * in cpopup_render_color_box() (me), and removed all warnings due to  * those.  *  * - Removed the printf()'s in the pop-up menu (they were only used  * for debugging).  */
end_comment

begin_comment
comment|/* Release date: 1997/04/22  *  * - Added GtkRadioMenuItems to the blending and coloring pop-up  * menus.  You no longer have to remember the dang type for each  * segment.  *  * - Added midpoint capabilities to sinuosidal and spherical sigments.  * Many thanks to Marcelo for the patches!  *  * - Added a *real* Cancel function to the color pickers.  I don't  * know why nobody killed me for not having done it before.  */
end_comment

begin_comment
comment|/* Release date: 1997/04/21  *  * - Re-wrote the old pop-up menu code, which was *horrible*.  The  * memory leaks *should* go away once I write  * grad_free_gradient_editor().  I'll do it once I'm finished adding  * crap to gradient_editor_t.  *  * - Added "fetch from" color buttons.  Yeah, we all missed them.  You  * should shed happiness tears when you see it.  *  * - Added an eyedropper function to the preview widget.  You can now  * click on the preview widget and the foreground color will be set to  * the gradient's color under the cursor.  This is still missing the  * eyedropper cursor shape.  *  * - You can now invoke the pop-up menu from the preview widget.  Even  * my hand gets unsteady at times.  *  * - Cool functions: Flip selection, Blend colors.  Can't live without  * them.  */
end_comment

begin_comment
comment|/* Special thanks to:  *  * Luis Albarran (luis4@mindspring.com) - Nice UI suggestions  *  * Miguel de Icaza (miguel@nuclecu.unam.mx) - Pop-up menu suggestion  *  * Marcelo Malheiros (malheiro@dca.fee.unicamp.br) - many, many  * suggestions, nice gradient files  *  * Adam Moss (adam@uunet.pipex.com) - idea for the hint bar  *  * Everyone on #gimp - many suggestions  */
end_comment

begin_comment
comment|/* TODO:  *  * - Fix memory leaks: grad_free_gradient_editor() and any others  * which I may have missed.  *  * - Add all of Marcelo's neat suggestions:  *   - Hue rotate, saturation, brightness, contrast.  *  * - Add Save Dirty Gradients function.  *  * - Add Reload function.  *  * - See that the default-gradient really gets selected on startup.  *  * - Provide a way of renaming a gradient (instead of having to do  *   copy/delete).  *  * - Fix the flicker in the hint bar.  *  * - Maybe add a little preview of each gradient to the listbox?  *  * - Better handling of bogus gradient files and inconsistent  *   segments.  Do not loop indefinitely in seg_get_segment_at() if  *   there is a missing segment between two others.  *  * - Add a Gradient brush mode (color changes as you move it).  */
end_comment

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|"appenv.h"
end_include

begin_include
include|#
directive|include
file|"colormaps.h"
end_include

begin_include
include|#
directive|include
file|"cursorutil.h"
end_include

begin_include
include|#
directive|include
file|"datafiles.h"
end_include

begin_include
include|#
directive|include
file|"errors.h"
end_include

begin_include
include|#
directive|include
file|"general.h"
end_include

begin_include
include|#
directive|include
file|"gimprc.h"
end_include

begin_include
include|#
directive|include
file|"gradient.h"
end_include

begin_include
include|#
directive|include
file|"interface.h"
end_include

begin_include
include|#
directive|include
file|"palette.h"
end_include

begin_include
include|#
directive|include
file|"session.h"
end_include

begin_include
include|#
directive|include
file|"gradient_header.h"
end_include

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_comment
comment|/***** Magic numbers *****/
end_comment

begin_ifndef
ifndef|#
directive|ifndef
name|M_PI
end_ifndef

begin_define
DECL|macro|M_PI
define|#
directive|define
name|M_PI
value|3.14159265358979323846
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* M_PI */
end_comment

begin_define
DECL|macro|EPSILON
define|#
directive|define
name|EPSILON
value|1e-10
end_define

begin_comment
comment|/***** Local functions *****/
end_comment

begin_comment
comment|/* Gradient editor functions */
end_comment

begin_function_decl
specifier|static
name|void
name|ed_fetch_foreground
parameter_list|(
name|double
modifier|*
name|fg_r
parameter_list|,
name|double
modifier|*
name|fg_g
parameter_list|,
name|double
modifier|*
name|fg_b
parameter_list|,
name|double
modifier|*
name|fg_a
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_update_editor
parameter_list|(
name|int
name|flags
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|ed_create_button
parameter_list|(
name|gchar
modifier|*
name|label
parameter_list|,
name|double
name|xalign
parameter_list|,
name|double
name|yalign
parameter_list|,
name|GtkSignalFunc
name|signal_func
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_set_hint
parameter_list|(
name|char
modifier|*
name|str
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_list_item_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_initialize_saved_colors
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint
name|ed_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_refresh_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_new_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_do_rename_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_do_new_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_copy_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_do_copy_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_delete_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_do_delete_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_cancel_delete_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_rename_grads_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_save_grads_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_do_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_cancel_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_scrollbar_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_zoom_all_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_zoom_out_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_zoom_in_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|ed_instant_update_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Gradient preview functions */
end_comment

begin_function_decl
specifier|static
name|gint
name|prev_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|prev_set_hint
parameter_list|(
name|gint
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|prev_set_foreground
parameter_list|(
name|gint
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|prev_update
parameter_list|(
name|int
name|recalculate
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|prev_fill_image
parameter_list|(
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|double
name|left
parameter_list|,
name|double
name|right
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Gradient control functions */
end_comment

begin_function_decl
specifier|static
name|gint
name|control_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_do_hint
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_button_press
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|button
parameter_list|,
name|guint
name|state
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|control_point_in_handle
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|grad_segment_t
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_select_single_segment
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_extend_selection
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_motion
parameter_list|(
name|gint
name|x
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_compress_left
parameter_list|(
name|grad_segment_t
modifier|*
name|range_l
parameter_list|,
name|grad_segment_t
modifier|*
name|range_r
parameter_list|,
name|grad_segment_t
modifier|*
name|drag_seg
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_compress_range
parameter_list|(
name|grad_segment_t
modifier|*
name|range_l
parameter_list|,
name|grad_segment_t
modifier|*
name|range_r
parameter_list|,
name|double
name|new_l
parameter_list|,
name|double
name|new_r
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|control_move
parameter_list|(
name|grad_segment_t
modifier|*
name|range_l
parameter_list|,
name|grad_segment_t
modifier|*
name|range_r
parameter_list|,
name|double
name|delta
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_update
parameter_list|(
name|int
name|recalculate
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|double
name|left
parameter_list|,
name|double
name|right
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw_normal_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|double
name|pos
parameter_list|,
name|int
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw_middle_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|double
name|pos
parameter_list|,
name|int
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|control_draw_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|GdkGC
modifier|*
name|border_gc
parameter_list|,
name|GdkGC
modifier|*
name|fill_gc
parameter_list|,
name|int
name|xpos
parameter_list|,
name|int
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|control_calc_p_pos
parameter_list|(
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|control_calc_g_pos
parameter_list|(
name|int
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Control popup functions */
end_comment

begin_function_decl
specifier|static
name|void
name|cpopup_create_main_menu
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_do_popup
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_color_item
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_box
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_adjust_menus
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_adjust_blending_menu
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_adjust_coloring_menu
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_check_selection_params
parameter_list|(
name|int
modifier|*
name|equal_blending
parameter_list|,
name|int
modifier|*
name|equal_coloring
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_menu_item_with_label
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_render_color_box
parameter_list|(
name|GtkPreview
modifier|*
name|preview
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_load_menu
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|char
modifier|*
name|label1
parameter_list|,
name|char
modifier|*
name|label2
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|,
name|gchar
name|accel_key_0
parameter_list|,
name|guint8
name|accel_mods_0
parameter_list|,
name|gchar
name|accel_key_1
parameter_list|,
name|guint8
name|accel_mods_1
parameter_list|,
name|gchar
name|accel_key_2
parameter_list|,
name|guint8
name|accel_mods_2
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_save_menu
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_update_saved_color
parameter_list|(
name|int
name|n
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_load_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_save_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_load_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_save_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_blending_menu
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_blending_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_coloring_menu
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_coloring_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|cpopup_create_sel_ops_menu
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_blend_colors
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_blend_opacity
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_set_color_selection_color
parameter_list|(
name|GtkColorSelection
modifier|*
name|cs
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_get_color_selection_color
parameter_list|(
name|GtkColorSelection
modifier|*
name|cs
parameter_list|,
name|double
modifier|*
name|r
parameter_list|,
name|double
modifier|*
name|g
parameter_list|,
name|double
modifier|*
name|b
parameter_list|,
name|double
modifier|*
name|a
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_create_color_dialog
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|,
name|GtkSignalFunc
name|color_changed_callback
parameter_list|,
name|GtkSignalFunc
name|ok_callback
parameter_list|,
name|GtkSignalFunc
name|cancel_callback
parameter_list|,
name|GtkSignalFunc
name|delete_callback
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|grad_segment_t
modifier|*
name|cpopup_save_selection
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_free_selection
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replace_selection
parameter_list|(
name|grad_segment_t
modifier|*
name|replace_seg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_set_left_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_left_color_changed
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_left_color_dialog_ok
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_left_color_dialog_cancel
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|cpopup_left_color_dialog_delete
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_set_right_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_right_color_changed
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_right_color_dialog_ok
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_right_color_dialog_cancel
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|cpopup_right_color_dialog_delete
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_midpoint_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_recenter_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_redistribute_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_flip_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_split_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replicate_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_do_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_replicate_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_blend_endpoints
parameter_list|(
name|double
name|r0
parameter_list|,
name|double
name|g0
parameter_list|,
name|double
name|b0
parameter_list|,
name|double
name|a0
parameter_list|,
name|double
name|r1
parameter_list|,
name|double
name|g1
parameter_list|,
name|double
name|b1
parameter_list|,
name|double
name|a1
parameter_list|,
name|int
name|blend_colors
parameter_list|,
name|int
name|blend_opacity
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_midpoint
parameter_list|(
name|grad_segment_t
modifier|*
name|lseg
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newl
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newr
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cpopup_split_uniform
parameter_list|(
name|grad_segment_t
modifier|*
name|lseg
parameter_list|,
name|int
name|parts
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newl
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newr
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Gradient functions */
end_comment

begin_function_decl
specifier|static
name|gradient_t
modifier|*
name|grad_new_gradient
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|grad_free_gradient
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|grad_free_gradients
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|grad_load_gradient
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|grad_save_gradient
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|char
modifier|*
name|filename
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|grad_save_all
parameter_list|(
name|int
name|need_free
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gradient_t
modifier|*
name|grad_create_default_gradient
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|int
name|grad_insert_in_gradients_list
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|grad_dump_gradient
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|FILE
modifier|*
name|file
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Segment functions */
end_comment

begin_function_decl
specifier|static
name|grad_segment_t
modifier|*
name|seg_new_segment
parameter_list|(
name|void
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|seg_free_segment
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|seg_free_segments
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|grad_segment_t
modifier|*
name|seg_get_segment_at
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|grad_segment_t
modifier|*
name|seg_get_last_segment
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|seg_get_closest_handle
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|double
name|pos
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
modifier|*
name|handle
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Calculation functions */
end_comment

begin_function_decl
specifier|static
name|double
name|calc_linear_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|calc_curved_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|calc_sine_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|calc_sphere_increasing_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|double
name|calc_sphere_decreasing_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_rgb_to_hsv
parameter_list|(
name|double
modifier|*
name|r
parameter_list|,
name|double
modifier|*
name|g
parameter_list|,
name|double
modifier|*
name|b
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|calc_hsv_to_rgb
parameter_list|(
name|double
modifier|*
name|h
parameter_list|,
name|double
modifier|*
name|s
parameter_list|,
name|double
modifier|*
name|v
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Files and paths functions */
end_comment

begin_function_decl
specifier|static
name|char
modifier|*
name|build_user_filename
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|path_str
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* Procedural database functions */
end_comment

begin_function_decl
specifier|static
name|Argument
modifier|*
name|gradients_get_list_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|gradients_get_active_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|gradients_set_active_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|gradients_sample_uniform_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|Argument
modifier|*
name|gradients_sample_custom_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/***** Local variables *****/
end_comment

begin_decl_stmt
DECL|variable|black
name|GdkColor
name|black
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|num_gradients
specifier|static
name|int
name|num_gradients
init|=
literal|0
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|curr_gradient
name|gradient_t
modifier|*
name|curr_gradient
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|curr_gradient
comment|/* The active gradient */
end_comment

begin_decl_stmt
DECL|variable|gradients_list
name|GSList
modifier|*
name|gradients_list
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|gradients_list
comment|/* The list of gradients */
end_comment

begin_decl_stmt
DECL|variable|grad_default_gradient
name|gradient_t
modifier|*
name|grad_default_gradient
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|g_editor
name|gradient_editor_t
modifier|*
name|g_editor
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
DECL|variable|g_editor
comment|/* The gradient editor */
end_comment

begin_decl_stmt
DECL|variable|blending_types
specifier|static
specifier|const
name|char
modifier|*
name|blending_types
index|[]
init|=
block|{
name|N_
argument_list|(
literal|"Linear"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Curved"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Sinusoidal"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Spherical (increasing)"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Spherical (decreasing)"
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* blending_types */
end_comment

begin_decl_stmt
DECL|variable|coloring_types
specifier|static
specifier|const
name|char
modifier|*
name|coloring_types
index|[]
init|=
block|{
name|N_
argument_list|(
literal|"Plain RGB"
argument_list|)
block|,
name|N_
argument_list|(
literal|"HSV (counter-clockwise hue)"
argument_list|)
block|,
name|N_
argument_list|(
literal|"HSV (clockwise hue)"
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* coloring_types */
end_comment

begin_comment
comment|/***** Public functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
name|void
DECL|function|gradients_init (int no_data)
name|gradients_init
parameter_list|(
name|int
name|no_data
parameter_list|)
block|{
if|if
condition|(
operator|!
name|no_data
condition|)
name|datafiles_read_directories
argument_list|(
name|gradient_path
argument_list|,
name|grad_load_gradient
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|grad_default_gradient
operator|!=
name|NULL
condition|)
name|curr_gradient
operator|=
name|grad_default_gradient
expr_stmt|;
elseif|else
if|if
condition|(
name|gradients_list
operator|!=
name|NULL
condition|)
name|curr_gradient
operator|=
operator|(
name|gradient_t
operator|*
operator|)
name|gradients_list
operator|->
name|data
expr_stmt|;
else|else
block|{
name|curr_gradient
operator|=
name|grad_create_default_gradient
argument_list|()
expr_stmt|;
name|curr_gradient
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|_
argument_list|(
literal|"Default"
argument_list|)
argument_list|)
expr_stmt|;
name|curr_gradient
operator|->
name|filename
operator|=
name|build_user_filename
argument_list|(
name|curr_gradient
operator|->
name|name
argument_list|,
name|gradient_path
argument_list|)
expr_stmt|;
name|curr_gradient
operator|->
name|dirty
operator|=
name|FALSE
expr_stmt|;
name|grad_insert_in_gradients_list
argument_list|(
name|curr_gradient
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* gradients_init */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
name|void
DECL|function|gradients_free (void)
name|gradients_free
parameter_list|(
name|void
parameter_list|)
block|{
name|grad_free_gradients
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/* gradients_free */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
name|void
DECL|function|grad_get_color_at (double pos,double * r,double * g,double * b,double * a)
name|grad_get_color_at
parameter_list|(
name|double
name|pos
parameter_list|,
name|double
modifier|*
name|r
parameter_list|,
name|double
modifier|*
name|g
parameter_list|,
name|double
modifier|*
name|b
parameter_list|,
name|double
modifier|*
name|a
parameter_list|)
block|{
name|double
name|factor
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|double
name|seg_len
decl_stmt|,
name|middle
decl_stmt|;
name|double
name|h0
decl_stmt|,
name|s0
decl_stmt|,
name|v0
decl_stmt|;
name|double
name|h1
decl_stmt|,
name|s1
decl_stmt|,
name|v1
decl_stmt|;
comment|/* if there is no gradient return a totally transparent black */
if|if
condition|(
name|curr_gradient
operator|==
name|NULL
condition|)
block|{
name|r
operator|=
literal|0
expr_stmt|;
name|g
operator|=
literal|0
expr_stmt|;
name|b
operator|=
literal|0
expr_stmt|;
name|a
operator|=
literal|0
expr_stmt|;
return|return;
block|}
if|if
condition|(
name|pos
operator|<
literal|0.0
condition|)
name|pos
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|pos
operator|>
literal|1.0
condition|)
name|pos
operator|=
literal|1.0
expr_stmt|;
name|seg
operator|=
name|seg_get_segment_at
argument_list|(
name|curr_gradient
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|seg_len
operator|=
name|seg
operator|->
name|right
operator|-
name|seg
operator|->
name|left
expr_stmt|;
if|if
condition|(
name|seg_len
operator|<
name|EPSILON
condition|)
block|{
name|middle
operator|=
literal|0.5
expr_stmt|;
name|pos
operator|=
literal|0.5
expr_stmt|;
block|}
else|else
block|{
name|middle
operator|=
operator|(
name|seg
operator|->
name|middle
operator|-
name|seg
operator|->
name|left
operator|)
operator|/
name|seg_len
expr_stmt|;
name|pos
operator|=
operator|(
name|pos
operator|-
name|seg
operator|->
name|left
operator|)
operator|/
name|seg_len
expr_stmt|;
block|}
comment|/* else */
switch|switch
condition|(
name|seg
operator|->
name|type
condition|)
block|{
case|case
name|GRAD_LINEAR
case|:
name|factor
operator|=
name|calc_linear_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_CURVED
case|:
name|factor
operator|=
name|calc_curved_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_SINE
case|:
name|factor
operator|=
name|calc_sine_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_SPHERE_INCREASING
case|:
name|factor
operator|=
name|calc_sphere_increasing_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_SPHERE_DECREASING
case|:
name|factor
operator|=
name|calc_sphere_decreasing_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
expr_stmt|;
break|break;
default|default:
name|grad_dump_gradient
argument_list|(
name|curr_gradient
argument_list|,
name|stderr
argument_list|)
expr_stmt|;
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"grad_get_color_at(): aieee, unknown gradient type %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|seg
operator|->
name|type
argument_list|)
expr_stmt|;
name|factor
operator|=
literal|0.0
expr_stmt|;
comment|/* Shut up -Wall */
break|break;
block|}
comment|/* switch */
comment|/* Calculate color components */
operator|*
name|a
operator|=
name|seg
operator|->
name|a0
operator|+
operator|(
name|seg
operator|->
name|a1
operator|-
name|seg
operator|->
name|a0
operator|)
operator|*
name|factor
expr_stmt|;
if|if
condition|(
name|seg
operator|->
name|color
operator|==
name|GRAD_RGB
condition|)
block|{
operator|*
name|r
operator|=
name|seg
operator|->
name|r0
operator|+
operator|(
name|seg
operator|->
name|r1
operator|-
name|seg
operator|->
name|r0
operator|)
operator|*
name|factor
expr_stmt|;
operator|*
name|g
operator|=
name|seg
operator|->
name|g0
operator|+
operator|(
name|seg
operator|->
name|g1
operator|-
name|seg
operator|->
name|g0
operator|)
operator|*
name|factor
expr_stmt|;
operator|*
name|b
operator|=
name|seg
operator|->
name|b0
operator|+
operator|(
name|seg
operator|->
name|b1
operator|-
name|seg
operator|->
name|b0
operator|)
operator|*
name|factor
expr_stmt|;
block|}
else|else
block|{
name|h0
operator|=
name|seg
operator|->
name|r0
expr_stmt|;
name|s0
operator|=
name|seg
operator|->
name|g0
expr_stmt|;
name|v0
operator|=
name|seg
operator|->
name|b0
expr_stmt|;
name|h1
operator|=
name|seg
operator|->
name|r1
expr_stmt|;
name|s1
operator|=
name|seg
operator|->
name|g1
expr_stmt|;
name|v1
operator|=
name|seg
operator|->
name|b1
expr_stmt|;
name|calc_rgb_to_hsv
argument_list|(
operator|&
name|h0
argument_list|,
operator|&
name|s0
argument_list|,
operator|&
name|v0
argument_list|)
expr_stmt|;
name|calc_rgb_to_hsv
argument_list|(
operator|&
name|h1
argument_list|,
operator|&
name|s1
argument_list|,
operator|&
name|v1
argument_list|)
expr_stmt|;
name|s0
operator|=
name|s0
operator|+
operator|(
name|s1
operator|-
name|s0
operator|)
operator|*
name|factor
expr_stmt|;
name|v0
operator|=
name|v0
operator|+
operator|(
name|v1
operator|-
name|v0
operator|)
operator|*
name|factor
expr_stmt|;
switch|switch
condition|(
name|seg
operator|->
name|color
condition|)
block|{
case|case
name|GRAD_HSV_CCW
case|:
if|if
condition|(
name|h0
operator|<
name|h1
condition|)
name|h0
operator|=
name|h0
operator|+
operator|(
name|h1
operator|-
name|h0
operator|)
operator|*
name|factor
expr_stmt|;
else|else
block|{
name|h0
operator|=
name|h0
operator|+
operator|(
literal|1.0
operator|-
operator|(
name|h0
operator|-
name|h1
operator|)
operator|)
operator|*
name|factor
expr_stmt|;
if|if
condition|(
name|h0
operator|>
literal|1.0
condition|)
name|h0
operator|-=
literal|1.0
expr_stmt|;
block|}
comment|/* else */
break|break;
case|case
name|GRAD_HSV_CW
case|:
if|if
condition|(
name|h1
operator|<
name|h0
condition|)
name|h0
operator|=
name|h0
operator|-
operator|(
name|h0
operator|-
name|h1
operator|)
operator|*
name|factor
expr_stmt|;
else|else
block|{
name|h0
operator|=
name|h0
operator|-
operator|(
literal|1.0
operator|-
operator|(
name|h1
operator|-
name|h0
operator|)
operator|)
operator|*
name|factor
expr_stmt|;
if|if
condition|(
name|h0
operator|<
literal|0.0
condition|)
name|h0
operator|+=
literal|1.0
expr_stmt|;
block|}
comment|/* else */
break|break;
default|default:
name|grad_dump_gradient
argument_list|(
name|curr_gradient
argument_list|,
name|stderr
argument_list|)
expr_stmt|;
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"grad_get_color_at(): aieee, unknown coloring mode %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|seg
operator|->
name|color
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* switch */
operator|*
name|r
operator|=
name|h0
expr_stmt|;
operator|*
name|g
operator|=
name|s0
expr_stmt|;
operator|*
name|b
operator|=
name|v0
expr_stmt|;
name|calc_hsv_to_rgb
argument_list|(
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* grad_get_color_at */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
name|void
DECL|function|grad_create_gradient_editor_init (gint need_show)
name|grad_create_gradient_editor_init
parameter_list|(
name|gint
name|need_show
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|topvbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|table
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|gvbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|separator
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled_win
decl_stmt|;
name|GdkColormap
modifier|*
name|colormap
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|select_pos
decl_stmt|;
comment|/* If the editor already exists, just show it */
if|if
condition|(
name|g_editor
condition|)
block|{
if|if
condition|(
operator|!
name|GTK_WIDGET_VISIBLE
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
condition|)
block|{
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
comment|/* Do this because os a proble with scrolling 			 * clists when not visible on screen. 			 */
name|grad_set_grad_to_name
argument_list|(
name|curr_gradient
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
else|else
name|gdk_window_raise
argument_list|(
name|g_editor
operator|->
name|shell
operator|->
name|window
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
comment|/* Create editor */
if|if
condition|(
name|no_data
condition|)
name|gradients_init
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|g_editor
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|gradient_editor_t
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Shell and main vbox */
name|g_editor
operator|->
name|shell
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_TOPLEVEL
argument_list|)
expr_stmt|;
name|gtk_window_set_wmclass
argument_list|(
name|GTK_WINDOW
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
argument_list|,
literal|"gradient_editor"
argument_list|,
literal|"Gimp"
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Gradient Editor"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* handle window manager close signals */
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_close_callback
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|topvbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|topvbox
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
argument_list|,
name|topvbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|topvbox
argument_list|)
expr_stmt|;
comment|/* Hint bar and close button */
name|table
operator|=
name|gtk_table_new
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|table
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|topvbox
argument_list|)
argument_list|,
name|table
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|table
argument_list|)
expr_stmt|;
name|separator
operator|=
name|gtk_hseparator_new
argument_list|()
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|separator
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|separator
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|hint_label
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|g_editor
operator|->
name|hint_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|g_editor
operator|->
name|hint_label
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
name|GTK_FILL
argument_list|,
literal|8
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|hint_label
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Close"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_close_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_usize
argument_list|(
name|button
argument_list|,
name|GRAD_CLOSE_BUTTON_WIDTH
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_table_attach
argument_list|(
name|GTK_TABLE
argument_list|(
name|table
argument_list|)
argument_list|,
name|button
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|,
literal|2
argument_list|,
name|GTK_FILL
argument_list|,
name|GTK_EXPAND
operator||
name|GTK_FILL
argument_list|,
literal|8
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Vbox for everything else */
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|topvbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Gradients list box */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Gradients: "
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/* clist preview of gradients */
name|scrolled_win
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|clist
operator|=
name|gtk_clist_new
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|gtk_clist_set_shadow_type
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_clist_set_row_height
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
literal|18
argument_list|)
expr_stmt|;
name|gtk_clist_set_column_width
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|52
argument_list|)
expr_stmt|;
name|gtk_clist_set_column_title
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
literal|0
argument_list|,
name|_
argument_list|(
literal|"Gradient"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_set_column_title
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
literal|1
argument_list|,
name|_
argument_list|(
literal|"Name"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_column_titles_show
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|scrolled_win
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|g_editor
operator|->
name|clist
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_win
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_ALWAYS
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_win
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
expr_stmt|;
name|colormap
operator|=
name|gtk_widget_get_colormap
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
expr_stmt|;
name|gdk_color_parse
argument_list|(
literal|"black"
argument_list|,
operator|&
name|black
argument_list|)
expr_stmt|;
name|gdk_color_alloc
argument_list|(
name|colormap
argument_list|,
operator|&
name|black
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
literal|"select_row"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|ed_list_item_update
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|NULL
argument_list|)
expr_stmt|;
comment|/* Buttons for gradient functions */
name|gvbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|gvbox
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|gvbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gvbox
argument_list|)
expr_stmt|;
comment|/* Buttons for gradient functions */
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"New gradient"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_new_gradient_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Copy gradient"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_copy_gradient_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Delete gradient"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_delete_gradient_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Save as POV-Ray"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_save_pov_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Save Gradients"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_save_grads_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Rename Gradient"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_rename_grads_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Refresh gradients"
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_refresh_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Horizontal box for zoom controls, scrollbar, and instant update toggle */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|hbox
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/* Zoom buttons */
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Zoom all"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_zoom_all_callback
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Zoom -"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_zoom_out_callback
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Zoom +"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_zoom_in_callback
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Scrollbar */
name|g_editor
operator|->
name|zoom_factor
operator|=
literal|1
expr_stmt|;
name|g_editor
operator|->
name|scroll_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
argument_list|,
literal|1.0
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_scrollbar_update
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|,
literal|"changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_scrollbar_update
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|scrollbar
operator|=
name|gtk_hscrollbar_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|g_editor
operator|->
name|scrollbar
argument_list|)
argument_list|,
name|GTK_UPDATE_CONTINUOUS
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|g_editor
operator|->
name|scrollbar
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|scrollbar
argument_list|)
expr_stmt|;
comment|/* Instant update toggle */
name|g_editor
operator|->
name|instant_update
operator|=
literal|1
expr_stmt|;
name|button
operator|=
name|gtk_check_button_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Instant update"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"toggled"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_instant_update_update
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|gtk_toggle_button_set_active
argument_list|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* hbox for that holds the frame for gradient preview and gradient control;             this is only here, because resizing the preview doesn't work (and is disabled)             to keep the preview and controls together */
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|hbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/* Frame for gradient preview and gradient control */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_IN
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|frame
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
name|gvbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|gvbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|gvbox
argument_list|)
expr_stmt|;
comment|/* Gradient preview */
name|g_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|preview_last_x
operator|=
literal|0
expr_stmt|;
name|g_editor
operator|->
name|preview_button_down
operator|=
literal|0
expr_stmt|;
name|g_editor
operator|->
name|preview
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_set_dither
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|GDK_RGB_DITHER_MAX
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|GRAD_PREVIEW_WIDTH
argument_list|,
name|GRAD_PREVIEW_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|,
name|GRAD_PREVIEW_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|prev_events
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|g_editor
operator|->
name|preview
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
expr_stmt|;
comment|/* Gradient control */
name|g_editor
operator|->
name|control_pixmap
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_drag_segment
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_sel_l
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_NONE
expr_stmt|;
name|g_editor
operator|->
name|control_click_time
operator|=
literal|0
expr_stmt|;
name|g_editor
operator|->
name|control_compress
operator|=
literal|0
expr_stmt|;
name|g_editor
operator|->
name|control_last_x
operator|=
literal|0
expr_stmt|;
name|g_editor
operator|->
name|control_last_gx
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|control_orig_pos
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|control_main_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_blending_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_coloring_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_splitm_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_splitu_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_delete_menu_item
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_delete_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_recenter_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_redistribute_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_flip_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_replicate_label
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_blend_colors_menu_item
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_blend_opacity_menu_item
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_left_load_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_left_save_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_right_load_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_right_save_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_blending_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_coloring_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control_sel_ops_popup
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|accel_group
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_blending_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
literal|0
index|]
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|g_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
literal|0
index|]
argument_list|)
operator|)
condition|;
name|i
operator|++
control|)
name|g_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|control
operator|=
name|gtk_drawing_area_new
argument_list|()
expr_stmt|;
name|gtk_drawing_area_size
argument_list|(
name|GTK_DRAWING_AREA
argument_list|(
name|g_editor
operator|->
name|control
argument_list|)
argument_list|,
name|GRAD_PREVIEW_WIDTH
argument_list|,
name|GRAD_CONTROL_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_widget_set_events
argument_list|(
name|g_editor
operator|->
name|control
argument_list|,
name|GRAD_CONTROL_EVENT_MASK
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|control
argument_list|)
argument_list|,
literal|"event"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|control_events
argument_list|,
name|g_editor
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|gvbox
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|control
argument_list|)
expr_stmt|;
comment|/* Initialize other data */
name|g_editor
operator|->
name|left_color_preview
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|left_saved_segments
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|left_saved_dirty
operator|=
literal|0
expr_stmt|;
name|g_editor
operator|->
name|right_color_preview
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|right_saved_segments
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|right_saved_dirty
operator|=
literal|0
expr_stmt|;
name|ed_initialize_saved_colors
argument_list|()
expr_stmt|;
name|cpopup_create_main_menu
argument_list|()
expr_stmt|;
comment|/* Show everything */
name|gtk_widget_realize
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|gc
operator|=
name|gdk_gc_new
argument_list|(
name|g_editor
operator|->
name|shell
operator|->
name|window
argument_list|)
expr_stmt|;
name|select_pos
operator|=
name|ed_set_list_of_gradients
argument_list|(
name|g_editor
operator|->
name|gc
argument_list|,
name|g_editor
operator|->
name|clist
argument_list|,
name|curr_gradient
argument_list|)
expr_stmt|;
if|if
condition|(
name|need_show
condition|)
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
if|if
condition|(
name|select_pos
operator|!=
operator|-
literal|1
condition|)
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|select_pos
argument_list|,
literal|0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* grad_create_gradient_editor */
end_comment

begin_comment
comment|/***** Gradient editor functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_fetch_foreground (double * fg_r,double * fg_g,double * fg_b,double * fg_a)
name|ed_fetch_foreground
parameter_list|(
name|double
modifier|*
name|fg_r
parameter_list|,
name|double
modifier|*
name|fg_g
parameter_list|,
name|double
modifier|*
name|fg_b
parameter_list|,
name|double
modifier|*
name|fg_a
parameter_list|)
block|{
name|unsigned
name|char
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|;
name|palette_get_foreground
argument_list|(
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|)
expr_stmt|;
operator|*
name|fg_r
operator|=
operator|(
name|double
operator|)
name|r
operator|/
literal|255.0
expr_stmt|;
operator|*
name|fg_g
operator|=
operator|(
name|double
operator|)
name|g
operator|/
literal|255.0
expr_stmt|;
operator|*
name|fg_b
operator|=
operator|(
name|double
operator|)
name|b
operator|/
literal|255.0
expr_stmt|;
operator|*
name|fg_a
operator|=
literal|1.0
expr_stmt|;
comment|/* opacity 100 % */
block|}
end_function

begin_comment
comment|/* ed_fetch_foreground */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_update_editor (int flags)
name|ed_update_editor
parameter_list|(
name|int
name|flags
parameter_list|)
block|{
if|if
condition|(
name|flags
operator|&
name|GRAD_UPDATE_PREVIEW
condition|)
name|prev_update
argument_list|(
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|GRAD_UPDATE_CONTROL
condition|)
name|control_update
argument_list|(
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|GRAD_RESET_CONTROL
condition|)
name|control_update
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_update_editor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|ed_create_button (gchar * label,double xalign,double yalign,GtkSignalFunc signal_func,gpointer user_data)
name|ed_create_button
parameter_list|(
name|gchar
modifier|*
name|label
parameter_list|,
name|double
name|xalign
parameter_list|,
name|double
name|yalign
parameter_list|,
name|GtkSignalFunc
name|signal_func
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|text
decl_stmt|;
name|button
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|text
operator|=
name|gtk_label_new
argument_list|(
name|gettext
argument_list|(
name|label
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|text
argument_list|)
argument_list|,
name|xalign
argument_list|,
name|yalign
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|text
argument_list|)
expr_stmt|;
if|if
condition|(
name|signal_func
operator|!=
name|NULL
condition|)
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|GTK_SIGNAL_FUNC
argument_list|(
name|signal_func
argument_list|)
argument_list|,
name|user_data
argument_list|)
expr_stmt|;
return|return
name|button
return|;
block|}
end_function

begin_comment
comment|/* ed_create_button */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_set_hint (char * str)
name|ed_set_hint
parameter_list|(
name|char
modifier|*
name|str
parameter_list|)
block|{
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|hint_label
argument_list|)
argument_list|,
name|gettext
argument_list|(
name|str
argument_list|)
argument_list|)
expr_stmt|;
name|gdk_flush
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_set_hint */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
name|gint
DECL|function|ed_set_list_of_gradients (GdkGC * gc,GtkWidget * clist,gradient_t * sel_gradient)
name|ed_set_list_of_gradients
parameter_list|(
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|GtkWidget
modifier|*
name|clist
parameter_list|,
name|gradient_t
modifier|*
name|sel_gradient
parameter_list|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|int
name|n
decl_stmt|;
name|int
name|select_pos
init|=
operator|-
literal|1
decl_stmt|;
name|list
operator|=
name|gradients_list
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sel_gradient
operator|==
name|NULL
condition|)
name|sel_gradient
operator|=
name|curr_gradient
expr_stmt|;
name|gtk_clist_freeze
argument_list|(
name|GTK_CLIST
argument_list|(
name|clist
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|grad
operator|=
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|grad
operator|==
name|sel_gradient
condition|)
block|{
name|ed_insert_in_gradients_listbox
argument_list|(
name|gc
argument_list|,
name|clist
argument_list|,
name|grad
argument_list|,
name|n
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|select_pos
operator|=
name|n
expr_stmt|;
block|}
else|else
block|{
name|ed_insert_in_gradients_listbox
argument_list|(
name|gc
argument_list|,
name|clist
argument_list|,
name|grad
argument_list|,
name|n
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|n
operator|++
expr_stmt|;
block|}
comment|/* while */
name|gtk_clist_thaw
argument_list|(
name|GTK_CLIST
argument_list|(
name|clist
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|select_pos
return|;
block|}
end_function

begin_comment
comment|/* ed_set_list_of_gradients */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|fill_clist_prev (gradient_t * grad,guchar * buf,gint width,gint height,double left,double right)
name|fill_clist_prev
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|guchar
modifier|*
name|buf
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|double
name|left
parameter_list|,
name|double
name|right
parameter_list|)
block|{
name|guchar
modifier|*
name|p0
decl_stmt|,
modifier|*
name|p1
decl_stmt|,
modifier|*
name|even
decl_stmt|,
modifier|*
name|odd
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|double
name|dx
decl_stmt|,
name|cur_x
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|double
name|c0
decl_stmt|,
name|c1
decl_stmt|;
name|gradient_t
modifier|*
name|oldgrad
init|=
name|curr_gradient
decl_stmt|;
name|curr_gradient
operator|=
name|grad
expr_stmt|;
name|dx
operator|=
operator|(
name|right
operator|-
name|left
operator|)
operator|/
operator|(
name|width
operator|-
literal|1
operator|)
expr_stmt|;
name|cur_x
operator|=
name|left
expr_stmt|;
name|p0
operator|=
name|even
operator|=
name|g_malloc
argument_list|(
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
name|p1
operator|=
name|odd
operator|=
name|g_malloc
argument_list|(
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
comment|/* Create lines to fill the image */
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|width
condition|;
name|x
operator|++
control|)
block|{
name|grad_get_color_at
argument_list|(
name|cur_x
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|/
name|GRAD_CHECK_SIZE_SM
operator|)
operator|&
literal|1
condition|)
block|{
name|c0
operator|=
name|GRAD_CHECK_LIGHT
expr_stmt|;
name|c1
operator|=
name|GRAD_CHECK_DARK
expr_stmt|;
block|}
else|else
block|{
name|c0
operator|=
name|GRAD_CHECK_DARK
expr_stmt|;
name|c1
operator|=
name|GRAD_CHECK_LIGHT
expr_stmt|;
block|}
comment|/* else */
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|r
operator|-
name|c0
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|g
operator|-
name|c0
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|b
operator|-
name|c0
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|r
operator|-
name|c1
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|g
operator|-
name|c1
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|b
operator|-
name|c1
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|cur_x
operator|+=
name|dx
expr_stmt|;
block|}
comment|/* for */
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|y
operator|/
name|GRAD_CHECK_SIZE_SM
operator|)
operator|&
literal|1
condition|)
block|{
name|memcpy
argument_list|(
name|buf
operator|+
operator|(
name|width
operator|*
name|y
operator|*
literal|3
operator|)
argument_list|,
name|odd
argument_list|,
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|memcpy
argument_list|(
name|buf
operator|+
operator|(
name|width
operator|*
name|y
operator|*
literal|3
operator|)
argument_list|,
name|even
argument_list|,
name|width
operator|*
literal|3
argument_list|)
expr_stmt|;
block|}
block|}
name|g_free
argument_list|(
name|even
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|odd
argument_list|)
expr_stmt|;
name|curr_gradient
operator|=
name|oldgrad
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|draw_small_preview (GdkGC * gc,GtkWidget * clist,gradient_t * grad,int pos)
name|draw_small_preview
parameter_list|(
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|GtkWidget
modifier|*
name|clist
parameter_list|,
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|int
name|pos
parameter_list|)
block|{
name|char
name|rgb_buf
index|[
literal|48
operator|*
literal|16
operator|*
literal|3
index|]
decl_stmt|;
name|fill_clist_prev
argument_list|(
name|grad
argument_list|,
name|rgb_buf
argument_list|,
literal|48
argument_list|,
literal|16
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|gdk_draw_rgb_image
argument_list|(
name|grad
operator|->
name|pixmap
argument_list|,
name|gc
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|48
argument_list|,
literal|16
argument_list|,
name|GDK_RGB_DITHER_NORMAL
argument_list|,
name|rgb_buf
argument_list|,
literal|48
operator|*
literal|3
argument_list|)
expr_stmt|;
name|gdk_gc_set_foreground
argument_list|(
name|gc
argument_list|,
operator|&
name|black
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|grad
operator|->
name|pixmap
argument_list|,
name|gc
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|47
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|gtk_clist_set_text
argument_list|(
name|GTK_CLIST
argument_list|(
name|clist
argument_list|)
argument_list|,
name|pos
argument_list|,
literal|1
argument_list|,
name|grad
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
name|void
DECL|function|ed_insert_in_gradients_listbox (GdkGC * gc,GtkWidget * clist,gradient_t * grad,int pos,int select)
name|ed_insert_in_gradients_listbox
parameter_list|(
name|GdkGC
modifier|*
name|gc
parameter_list|,
name|GtkWidget
modifier|*
name|clist
parameter_list|,
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|int
name|pos
parameter_list|,
name|int
name|select
parameter_list|)
block|{
name|char
modifier|*
name|string
index|[
literal|2
index|]
decl_stmt|;
name|string
index|[
literal|0
index|]
operator|=
name|NULL
expr_stmt|;
name|string
index|[
literal|1
index|]
operator|=
name|grad
operator|->
name|name
expr_stmt|;
name|gtk_clist_insert
argument_list|(
name|GTK_CLIST
argument_list|(
name|clist
argument_list|)
argument_list|,
name|pos
argument_list|,
name|string
argument_list|)
expr_stmt|;
if|if
condition|(
name|grad
operator|->
name|pixmap
operator|==
name|NULL
condition|)
name|grad
operator|->
name|pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|g_editor
operator|->
name|shell
operator|->
name|window
argument_list|,
literal|48
argument_list|,
literal|16
argument_list|,
name|gtk_widget_get_visual
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
operator|->
name|depth
argument_list|)
expr_stmt|;
name|draw_small_preview
argument_list|(
name|gc
argument_list|,
name|clist
argument_list|,
name|grad
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|gtk_clist_set_pixmap
argument_list|(
name|GTK_CLIST
argument_list|(
name|clist
argument_list|)
argument_list|,
name|pos
argument_list|,
literal|0
argument_list|,
name|grad
operator|->
name|pixmap
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|select
condition|)
block|{
name|gtk_clist_select_row
argument_list|(
name|GTK_CLIST
argument_list|(
name|clist
argument_list|)
argument_list|,
name|pos
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|clist
argument_list|)
argument_list|,
name|pos
argument_list|,
literal|0
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/* ed_insert_in_gradients_listbox */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_list_item_update (GtkWidget * widget,gint row,gint column,GdkEventButton * event,gpointer data)
name|ed_list_item_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gint
name|row
parameter_list|,
name|gint
name|column
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
comment|/* Update current gradient */
name|GSList
modifier|*
name|tmp
init|=
name|g_slist_nth
argument_list|(
name|gradients_list
argument_list|,
name|row
argument_list|)
decl_stmt|;
name|curr_gradient
operator|=
operator|(
name|gradient_t
operator|*
operator|)
operator|(
name|tmp
operator|->
name|data
operator|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_RESET_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_list_item_update */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_initialize_saved_colors (void)
name|ed_initialize_saved_colors
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|GRAD_NUM_COLORS
operator|+
literal|3
operator|)
condition|;
name|i
operator|++
control|)
block|{
name|g_editor
operator|->
name|left_load_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|left_load_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|right_load_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|right_load_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* for */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRAD_NUM_COLORS
condition|;
name|i
operator|++
control|)
block|{
name|g_editor
operator|->
name|left_save_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|left_save_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|right_save_color_boxes
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
name|g_editor
operator|->
name|right_save_labels
index|[
name|i
index|]
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* for */
name|g_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Black */
name|g_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|0
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|r
operator|=
literal|0.5
expr_stmt|;
comment|/* 50% Gray */
name|g_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|g
operator|=
literal|0.5
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|b
operator|=
literal|0.5
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|1
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* White */
name|g_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|2
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Clear */
name|g_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|3
index|]
operator|.
name|a
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* Red */
name|g_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|4
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* Yellow */
name|g_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|5
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Green */
name|g_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|b
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|6
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Cyan */
name|g_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|g
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|7
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|r
operator|=
literal|0.0
expr_stmt|;
comment|/* Blue */
name|g_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|8
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|r
operator|=
literal|1.0
expr_stmt|;
comment|/* Magenta */
name|g_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|g
operator|=
literal|0.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|b
operator|=
literal|1.0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
literal|9
index|]
operator|.
name|a
operator|=
literal|1.0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_initialize_saved_colors */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|gint
DECL|function|ed_close_callback (GtkWidget * widget,gpointer client_data)
name|ed_close_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
if|if
condition|(
name|GTK_WIDGET_VISIBLE
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
condition|)
name|gtk_widget_hide
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_comment
comment|/* ed_close_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_new_gradient_callback (GtkWidget * widget,gpointer client_data)
name|ed_new_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|query_string_box
argument_list|(
name|N_
argument_list|(
literal|"New gradient"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"Enter a name for the new gradient"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"untitled"
argument_list|)
argument_list|,
name|ed_do_new_gradient_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_new_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_do_new_gradient_callback (GtkWidget * widget,gpointer client_data,gpointer call_data)
name|ed_do_new_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
block|{
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|char
modifier|*
name|gradient_name
decl_stmt|;
name|int
name|pos
decl_stmt|;
name|gradient_name
operator|=
operator|(
name|char
operator|*
operator|)
name|call_data
expr_stmt|;
if|if
condition|(
operator|!
name|gradient_name
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"ed_do_new_gradient_callback(): oops, received NULL in call_data"
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
name|grad
operator|=
name|grad_create_default_gradient
argument_list|()
expr_stmt|;
name|grad
operator|->
name|name
operator|=
name|gradient_name
expr_stmt|;
comment|/* We don't need to copy since this memory is ours */
name|grad
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|grad
operator|->
name|filename
operator|=
name|build_user_filename
argument_list|(
name|grad
operator|->
name|name
argument_list|,
name|gradient_path
argument_list|)
expr_stmt|;
comment|/* Put new gradient in list */
name|pos
operator|=
name|grad_insert_in_gradients_list
argument_list|(
name|grad
argument_list|)
expr_stmt|;
name|gtk_clist_freeze
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|ed_insert_in_gradients_listbox
argument_list|(
name|g_editor
operator|->
name|gc
argument_list|,
name|g_editor
operator|->
name|clist
argument_list|,
name|grad
argument_list|,
name|pos
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_clist_thaw
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|pos
argument_list|,
literal|0
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|curr_gradient
operator|=
name|grad
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_RESET_CONTROL
argument_list|)
expr_stmt|;
name|grad_sel_new_all
argument_list|(
name|pos
argument_list|,
name|grad
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_do_new_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_do_rename_gradient_callback (GtkWidget * widget,gpointer client_data,gpointer call_data)
name|ed_do_rename_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
block|{
name|gradient_t
modifier|*
name|grad
init|=
operator|(
name|gradient_t
operator|*
operator|)
name|client_data
decl_stmt|;
name|gradient_t
modifier|*
name|grad_list
init|=
name|NULL
decl_stmt|;
name|char
modifier|*
name|gradient_name
decl_stmt|;
name|GSList
modifier|*
name|tmp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|gradient_name
operator|=
operator|(
name|char
operator|*
operator|)
name|call_data
expr_stmt|;
if|if
condition|(
operator|!
name|gradient_name
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"ed_do_rename_gradient_callback(): oops, received NULL in call_data"
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gradients_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|grad_list
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|grad_list
operator|==
name|grad
condition|)
break|break;
name|n
operator|++
expr_stmt|;
name|tmp
operator|=
name|g_slist_next
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
comment|/* while */
if|if
condition|(
operator|!
name|grad
operator|||
operator|!
name|grad_list
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"ed_do_rename_gradient_callback(): oops, can't find gradient to rename"
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
comment|/* leak? */
name|grad
operator|->
name|name
operator|=
name|gradient_name
expr_stmt|;
comment|/* We don't need to copy since this memory is ours */
name|grad
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
comment|/* Delete file and free gradient */
name|unlink
argument_list|(
name|grad
operator|->
name|filename
argument_list|)
expr_stmt|;
name|grad
operator|->
name|filename
operator|=
name|build_user_filename
argument_list|(
name|grad
operator|->
name|name
argument_list|,
name|gradient_path
argument_list|)
expr_stmt|;
name|gtk_clist_set_text
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|n
argument_list|,
literal|1
argument_list|,
name|grad
operator|->
name|name
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_RESET_CONTROL
argument_list|)
expr_stmt|;
name|grad_sel_rename_all
argument_list|(
name|n
argument_list|,
name|grad
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_do_rename_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_copy_gradient_callback (GtkWidget * widget,gpointer client_data)
name|ed_copy_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
if|if
condition|(
name|curr_gradient
operator|==
name|NULL
condition|)
return|return;
name|name
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%s copy"
argument_list|)
argument_list|,
name|curr_gradient
operator|->
name|name
argument_list|)
expr_stmt|;
name|query_string_box
argument_list|(
name|N_
argument_list|(
literal|"Copy gradient"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"Enter a name for the copied gradient"
argument_list|)
argument_list|,
name|name
argument_list|,
name|ed_do_copy_gradient_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_copy_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_do_copy_gradient_callback (GtkWidget * widget,gpointer client_data,gpointer call_data)
name|ed_do_copy_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|,
name|gpointer
name|call_data
parameter_list|)
block|{
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|char
modifier|*
name|gradient_name
decl_stmt|;
name|int
name|pos
decl_stmt|;
name|grad_segment_t
modifier|*
name|head
decl_stmt|,
modifier|*
name|prev
decl_stmt|,
modifier|*
name|cur
decl_stmt|,
modifier|*
name|orig
decl_stmt|;
name|gradient_name
operator|=
operator|(
name|char
operator|*
operator|)
name|call_data
expr_stmt|;
if|if
condition|(
operator|!
name|gradient_name
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"ed_do_copy_gradient_callback(): oops, received NULL in call_data"
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
comment|/* Copy current gradient */
name|grad
operator|=
name|grad_new_gradient
argument_list|()
expr_stmt|;
name|grad
operator|->
name|name
operator|=
name|gradient_name
expr_stmt|;
comment|/* We don't need to copy since this memory is ours */
name|grad
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|grad
operator|->
name|filename
operator|=
name|build_user_filename
argument_list|(
name|grad
operator|->
name|name
argument_list|,
name|gradient_path
argument_list|)
expr_stmt|;
name|prev
operator|=
name|NULL
expr_stmt|;
name|orig
operator|=
name|curr_gradient
operator|->
name|segments
expr_stmt|;
name|head
operator|=
name|NULL
expr_stmt|;
while|while
condition|(
name|orig
condition|)
block|{
name|cur
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
operator|*
name|cur
operator|=
operator|*
name|orig
expr_stmt|;
comment|/* Copy everything */
name|cur
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|cur
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|cur
expr_stmt|;
else|else
name|head
operator|=
name|cur
expr_stmt|;
comment|/* Remember head */
name|prev
operator|=
name|cur
expr_stmt|;
name|orig
operator|=
name|orig
operator|->
name|next
expr_stmt|;
block|}
comment|/* while */
name|grad
operator|->
name|segments
operator|=
name|head
expr_stmt|;
comment|/* Put new gradient in list */
name|pos
operator|=
name|grad_insert_in_gradients_list
argument_list|(
name|grad
argument_list|)
expr_stmt|;
name|gtk_clist_freeze
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|ed_insert_in_gradients_listbox
argument_list|(
name|g_editor
operator|->
name|gc
argument_list|,
name|g_editor
operator|->
name|clist
argument_list|,
name|grad
argument_list|,
name|pos
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_clist_thaw
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|curr_gradient
operator|=
name|grad
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_RESET_CONTROL
argument_list|)
expr_stmt|;
name|grad_sel_copy_all
argument_list|(
name|pos
argument_list|,
name|grad
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_do_copy_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_delete_gradient_callback (GtkWidget * widget,gpointer client_data)
name|ed_delete_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|char
modifier|*
name|str
decl_stmt|;
if|if
condition|(
name|num_gradients
operator|<=
literal|1
condition|)
return|return;
name|dialog
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Delete gradient"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Question */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Are you sure you want to delete"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"\"%s\" from the list and from disk?"
argument_list|)
argument_list|,
name|curr_gradient
operator|->
name|name
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
comment|/* Buttons */
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Delete"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_do_delete_gradient_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_cancel_delete_gradient_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Show! */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_delete_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_do_delete_gradient_callback (GtkWidget * widget,gpointer client_data)
name|ed_do_delete_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GSList
modifier|*
name|tmp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|int
name|real_pos
decl_stmt|;
name|gradient_t
modifier|*
name|g
decl_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* See which gradient we will have to select once the current one is deleted */
name|real_pos
operator|=
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gradients_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|g
operator|==
name|curr_gradient
condition|)
block|{
name|real_pos
operator|=
name|n
expr_stmt|;
if|if
condition|(
name|tmp
operator|->
name|next
operator|==
name|NULL
condition|)
name|n
operator|--
expr_stmt|;
comment|/* Will have to select the *previous* one */
break|break;
comment|/* We found the one we want */
block|}
comment|/* if */
name|n
operator|++
expr_stmt|;
comment|/* Next gradient */
name|tmp
operator|=
name|g_slist_next
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
comment|/* while */
if|if
condition|(
name|tmp
operator|==
name|NULL
condition|)
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"ed_do_delete_gradient_callback(): aieee, could not find gradient to delete!"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Delete gradient from gradients list */
name|gradients_list
operator|=
name|g_slist_remove
argument_list|(
name|gradients_list
argument_list|,
name|curr_gradient
argument_list|)
expr_stmt|;
comment|/* Delete file and free gradient */
name|unlink
argument_list|(
name|curr_gradient
operator|->
name|filename
argument_list|)
expr_stmt|;
name|grad_free_gradient
argument_list|(
name|curr_gradient
argument_list|)
expr_stmt|;
comment|/* Delete gradient from listbox */
name|gtk_clist_remove
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|real_pos
argument_list|)
expr_stmt|;
comment|/* Select new gradient */
name|curr_gradient
operator|=
name|g_slist_nth
argument_list|(
name|gradients_list
argument_list|,
name|n
argument_list|)
operator|->
name|data
expr_stmt|;
name|gtk_clist_select_row
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|n
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|n
argument_list|,
literal|0
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
comment|/* Update! */
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_RESET_CONTROL
argument_list|)
expr_stmt|;
name|grad_sel_delete_all
argument_list|(
name|real_pos
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_do_delete_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_cancel_delete_gradient_callback (GtkWidget * widget,gpointer client_data)
name|ed_cancel_delete_gradient_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_cancel_delete_gradient_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_save_grads_callback (GtkWidget * widget,gpointer client_data)
name|ed_save_grads_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|grad_save_all
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_rename_grads_callback (GtkWidget * widget,gpointer client_data)
name|ed_rename_grads_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
if|if
condition|(
name|curr_gradient
operator|==
name|NULL
condition|)
return|return;
name|query_string_box
argument_list|(
name|N_
argument_list|(
literal|"Rename gradient"
argument_list|)
argument_list|,
name|N_
argument_list|(
literal|"Enter a new name for the gradient"
argument_list|)
argument_list|,
name|curr_gradient
operator|->
name|name
argument_list|,
name|ed_do_rename_gradient_callback
argument_list|,
name|curr_gradient
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_save_pov_callback (GtkWidget * widget,gpointer client_data)
name|ed_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|window
decl_stmt|;
if|if
condition|(
name|curr_gradient
operator|==
name|NULL
condition|)
return|return;
name|window
operator|=
name|gtk_file_selection_new
argument_list|(
name|_
argument_list|(
literal|"Save as POV-Ray"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|window
argument_list|)
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_do_save_pov_callback
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|window
argument_list|)
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|ed_cancel_save_pov_callback
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_save_pov_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_refresh_callback (GtkWidget * widget,gpointer client_data)
name|ed_refresh_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|int
name|select_pos
decl_stmt|;
name|gtk_clist_freeze
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_clear
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_clist_thaw
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|)
expr_stmt|;
name|grad_sel_free_all
argument_list|()
expr_stmt|;
name|grad_free_gradients
argument_list|()
expr_stmt|;
name|gradients_init
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
name|select_pos
operator|=
name|ed_set_list_of_gradients
argument_list|(
name|g_editor
operator|->
name|gc
argument_list|,
name|g_editor
operator|->
name|clist
argument_list|,
name|curr_gradient
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_RESET_CONTROL
argument_list|)
expr_stmt|;
if|if
condition|(
name|select_pos
operator|!=
operator|-
literal|1
condition|)
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|select_pos
argument_list|,
literal|0
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|grad_sel_refill_all
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_refresh_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_do_save_pov_callback (GtkWidget * widget,gpointer client_data)
name|ed_do_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|char
modifier|*
name|filename
decl_stmt|;
name|FILE
modifier|*
name|file
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|filename
operator|=
name|gtk_file_selection_get_filename
argument_list|(
name|GTK_FILE_SELECTION
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|file
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"wb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
name|g_message
argument_list|(
name|_
argument_list|(
literal|"ed_do_save_pov_callback(): oops, could not open \"%s\""
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
else|else
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"/* color_map file created by the GIMP */\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"/* http://www.gimp.org/               */\n"
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"color_map {\n"
argument_list|)
expr_stmt|;
name|seg
operator|=
name|curr_gradient
operator|->
name|segments
expr_stmt|;
while|while
condition|(
name|seg
condition|)
block|{
comment|/* Left */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\t[%f color rgbt<%f, %f, %f, %f>]\n"
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|seg
operator|->
name|r0
argument_list|,
name|seg
operator|->
name|g0
argument_list|,
name|seg
operator|->
name|b0
argument_list|,
literal|1.0
operator|-
name|seg
operator|->
name|a0
argument_list|)
expr_stmt|;
comment|/* Middle */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\t[%f color rgbt<%f, %f, %f, %f>]\n"
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
operator|(
name|seg
operator|->
name|r0
operator|+
name|seg
operator|->
name|r1
operator|)
operator|/
literal|2.0
argument_list|,
operator|(
name|seg
operator|->
name|g0
operator|+
name|seg
operator|->
name|g1
operator|)
operator|/
literal|2.0
argument_list|,
operator|(
name|seg
operator|->
name|b0
operator|+
name|seg
operator|->
name|b1
operator|)
operator|/
literal|2.0
argument_list|,
literal|1.0
operator|-
operator|(
name|seg
operator|->
name|a0
operator|+
name|seg
operator|->
name|a1
operator|)
operator|/
literal|2.0
argument_list|)
expr_stmt|;
comment|/* Right */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"\t[%f color rgbt<%f, %f, %f, %f>]\n"
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|seg
operator|->
name|r1
argument_list|,
name|seg
operator|->
name|g1
argument_list|,
name|seg
operator|->
name|b1
argument_list|,
literal|1.0
operator|-
name|seg
operator|->
name|a1
argument_list|)
expr_stmt|;
comment|/* Next! */
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* while */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"} /* color_map */\n"
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|file
argument_list|)
expr_stmt|;
block|}
comment|/* else */
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_do_save_pov_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_cancel_save_pov_callback (GtkWidget * widget,gpointer client_data)
name|ed_cancel_save_pov_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_cancel_save_pov_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_scrollbar_update (GtkAdjustment * adjustment,gpointer data)
name|ed_scrollbar_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|char
name|str
index|[
literal|256
index|]
decl_stmt|;
name|g_snprintf
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Zoom factor: %d:1    Displaying [%0.6f, %0.6f]"
argument_list|)
argument_list|,
name|g_editor
operator|->
name|zoom_factor
argument_list|,
name|adjustment
operator|->
name|value
argument_list|,
name|adjustment
operator|->
name|value
operator|+
name|adjustment
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_scrollbar_update */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_zoom_all_callback (GtkWidget * widget,gpointer client_data)
name|ed_zoom_all_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|zoom_factor
operator|=
literal|1
expr_stmt|;
name|adjustment
operator|->
name|value
operator|=
literal|0.0
expr_stmt|;
name|adjustment
operator|->
name|page_size
operator|=
literal|1.0
expr_stmt|;
name|adjustment
operator|->
name|step_increment
operator|=
literal|1.0
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
expr_stmt|;
name|adjustment
operator|->
name|page_increment
operator|=
literal|1.0
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
expr_stmt|;
name|gtk_signal_emit_by_name
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|,
literal|"changed"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_zoom_all_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_zoom_out_callback (GtkWidget * widget,gpointer client_data)
name|ed_zoom_out_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|double
name|old_value
decl_stmt|,
name|value
decl_stmt|;
name|double
name|old_page_size
decl_stmt|,
name|page_size
decl_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|zoom_factor
operator|<=
literal|1
condition|)
return|return;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|old_value
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
name|old_page_size
operator|=
name|adjustment
operator|->
name|page_size
expr_stmt|;
name|g_editor
operator|->
name|zoom_factor
operator|--
expr_stmt|;
name|page_size
operator|=
literal|1.0
operator|/
name|g_editor
operator|->
name|zoom_factor
expr_stmt|;
name|value
operator|=
name|old_value
operator|-
operator|(
name|page_size
operator|-
name|old_page_size
operator|)
operator|/
literal|2.0
expr_stmt|;
if|if
condition|(
name|value
operator|<
literal|0.0
condition|)
name|value
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
operator|(
name|value
operator|+
name|page_size
operator|)
operator|>
literal|1.0
condition|)
name|value
operator|=
literal|1.0
operator|-
name|page_size
expr_stmt|;
name|adjustment
operator|->
name|value
operator|=
name|value
expr_stmt|;
name|adjustment
operator|->
name|page_size
operator|=
name|page_size
expr_stmt|;
name|adjustment
operator|->
name|step_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
expr_stmt|;
name|adjustment
operator|->
name|page_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
expr_stmt|;
name|gtk_signal_emit_by_name
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|,
literal|"changed"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_zoom_out_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_zoom_in_callback (GtkWidget * widget,gpointer client_data)
name|ed_zoom_in_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|double
name|old_value
decl_stmt|;
name|double
name|old_page_size
decl_stmt|,
name|page_size
decl_stmt|;
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|old_value
operator|=
name|adjustment
operator|->
name|value
expr_stmt|;
name|old_page_size
operator|=
name|adjustment
operator|->
name|page_size
expr_stmt|;
name|g_editor
operator|->
name|zoom_factor
operator|++
expr_stmt|;
name|page_size
operator|=
literal|1.0
operator|/
name|g_editor
operator|->
name|zoom_factor
expr_stmt|;
name|adjustment
operator|->
name|value
operator|=
name|old_value
operator|+
operator|(
name|old_page_size
operator|-
name|page_size
operator|)
operator|/
literal|2.0
expr_stmt|;
name|adjustment
operator|->
name|page_size
operator|=
name|page_size
expr_stmt|;
name|adjustment
operator|->
name|step_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_STEP_SIZE
expr_stmt|;
name|adjustment
operator|->
name|page_increment
operator|=
name|page_size
operator|*
name|GRAD_SCROLLBAR_PAGE_SIZE
expr_stmt|;
name|gtk_signal_emit_by_name
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|,
literal|"changed"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* ed_zoom_in_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|ed_instant_update_update (GtkWidget * widget,gpointer data)
name|ed_instant_update_update
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
if|if
condition|(
name|GTK_TOGGLE_BUTTON
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
block|{
name|g_editor
operator|->
name|instant_update
operator|=
literal|1
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|g_editor
operator|->
name|scrollbar
argument_list|)
argument_list|,
name|GTK_UPDATE_CONTINUOUS
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_editor
operator|->
name|instant_update
operator|=
literal|0
expr_stmt|;
name|gtk_range_set_update_policy
argument_list|(
name|GTK_RANGE
argument_list|(
name|g_editor
operator|->
name|scrollbar
argument_list|)
argument_list|,
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* ed_instant_update_update */
end_comment

begin_comment
comment|/***** Gradient preview functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|gint
DECL|function|prev_events (GtkWidget * widget,GdkEvent * event)
name|prev_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
comment|/* ignore events when no gradient is present */
if|if
condition|(
name|curr_gradient
operator|==
name|NULL
condition|)
return|return
name|FALSE
return|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|prev_update
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_LEAVE_NOTIFY
case|:
name|ed_set_hint
argument_list|(
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_MOTION_NOTIFY
case|:
name|gtk_widget_get_pointer
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|!=
name|g_editor
operator|->
name|preview_last_x
condition|)
block|{
name|g_editor
operator|->
name|preview_last_x
operator|=
name|x
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|preview_button_down
condition|)
name|prev_set_foreground
argument_list|(
name|x
argument_list|)
expr_stmt|;
else|else
name|prev_set_hint
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
comment|/* if */
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
name|gtk_widget_get_pointer
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
switch|switch
condition|(
name|bevent
operator|->
name|button
condition|)
block|{
case|case
literal|1
case|:
name|g_editor
operator|->
name|preview_last_x
operator|=
name|x
expr_stmt|;
name|g_editor
operator|->
name|preview_button_down
operator|=
literal|1
expr_stmt|;
name|prev_set_foreground
argument_list|(
name|x
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|cpopup_do_popup
argument_list|()
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/* switch */
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
if|if
condition|(
name|g_editor
operator|->
name|preview_button_down
condition|)
block|{
name|gtk_widget_get_pointer
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|preview_last_x
operator|=
name|x
expr_stmt|;
name|g_editor
operator|->
name|preview_button_down
operator|=
literal|0
expr_stmt|;
name|prev_set_foreground
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
comment|/* if */
break|break;
default|default:
break|break;
block|}
comment|/* switch */
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* prev_events */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|prev_set_hint (gint x)
name|prev_set_hint
parameter_list|(
name|gint
name|x
parameter_list|)
block|{
name|double
name|xpos
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|double
name|h
decl_stmt|,
name|s
decl_stmt|,
name|v
decl_stmt|;
name|char
name|str
index|[
literal|256
index|]
decl_stmt|;
name|xpos
operator|=
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|grad_get_color_at
argument_list|(
name|xpos
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
name|h
operator|=
name|r
expr_stmt|;
name|s
operator|=
name|g
expr_stmt|;
name|v
operator|=
name|b
expr_stmt|;
name|calc_rgb_to_hsv
argument_list|(
operator|&
name|h
argument_list|,
operator|&
name|s
argument_list|,
operator|&
name|v
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Position: %0.6f    "
literal|"RGB (%0.3f, %0.3f, %0.3f)    "
literal|"HSV (%0.3f, %0.3f, %0.3f)    "
literal|"Opacity: %0.3f"
argument_list|)
argument_list|,
name|xpos
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|h
operator|*
literal|360.0
argument_list|,
name|s
argument_list|,
name|v
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* prev_set_hint */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|prev_set_foreground (gint x)
name|prev_set_foreground
parameter_list|(
name|gint
name|x
parameter_list|)
block|{
name|double
name|xpos
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|char
name|str
index|[
literal|512
index|]
decl_stmt|;
name|xpos
operator|=
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|grad_get_color_at
argument_list|(
name|xpos
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
name|palette_set_foreground
argument_list|(
name|r
operator|*
literal|255.0
argument_list|,
name|g
operator|*
literal|255.0
argument_list|,
name|b
operator|*
literal|255.0
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Foreground color set to RGB (%d, %d, %d)<-> (%0.3f, %0.3f, %0.3f)"
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
name|r
operator|*
literal|255.0
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
name|g
operator|*
literal|255.0
argument_list|)
argument_list|,
call|(
name|int
call|)
argument_list|(
name|b
operator|*
literal|255.0
argument_list|)
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|str
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* prev_set_foreground */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|prev_update (int recalculate)
name|prev_update
parameter_list|(
name|int
name|recalculate
parameter_list|)
block|{
name|long
name|rowsiz
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
name|guint16
name|width
decl_stmt|,
name|height
decl_stmt|;
name|guint16
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
name|GSList
modifier|*
name|tmp
decl_stmt|;
name|int
name|n
decl_stmt|;
name|gradient_t
modifier|*
name|g
decl_stmt|;
specifier|static
name|gradient_t
modifier|*
name|last_grad
init|=
name|NULL
decl_stmt|;
specifier|static
name|int
name|last_row
init|=
operator|-
literal|1
decl_stmt|;
comment|/* We only update if we can draw to the widget and a gradient is present */
if|if
condition|(
name|curr_gradient
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
operator|!
name|GTK_WIDGET_DRAWABLE
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
condition|)
return|return;
comment|/* See whether we have to re-create the preview widget */
name|width
operator|=
name|g_editor
operator|->
name|preview
operator|->
name|allocation
operator|.
name|width
expr_stmt|;
name|height
operator|=
name|g_editor
operator|->
name|preview
operator|->
name|allocation
operator|.
name|height
expr_stmt|;
comment|/* hof: do not change preview size on Window resize. 	 *      The original code allows expansion of the preview 	 *      on window resize events. But once expanded, there is no way to shrink 	 *      the window back to the original size. 	 *  A full Bugfix should change the preview size according to the users      	 *  window resize actions.    	 */
name|width
operator|=
name|GRAD_PREVIEW_WIDTH
expr_stmt|;
name|height
operator|=
name|GRAD_PREVIEW_HEIGHT
expr_stmt|;
name|pwidth
operator|=
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
operator|->
name|buffer_width
expr_stmt|;
name|pheight
operator|=
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
operator|->
name|buffer_height
expr_stmt|;
if|if
condition|(
operator|!
name|g_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
operator|||
operator|!
name|g_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
operator|||
operator|(
name|width
operator|!=
name|pwidth
operator|)
operator|||
operator|(
name|height
operator|!=
name|pheight
operator|)
condition|)
block|{
if|if
condition|(
name|g_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
condition|)
name|g_free
argument_list|(
name|g_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
condition|)
name|g_free
argument_list|(
name|g_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|rowsiz
operator|=
name|width
operator|*
literal|3
operator|*
sizeof|sizeof
argument_list|(
name|guchar
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
operator|=
name|g_malloc
argument_list|(
name|rowsiz
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
operator|=
name|g_malloc
argument_list|(
name|rowsiz
argument_list|)
expr_stmt|;
name|recalculate
operator|=
literal|1
expr_stmt|;
comment|/* Force recalculation */
block|}
comment|/* if */
comment|/* Have to redraw? */
if|if
condition|(
name|recalculate
condition|)
block|{
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|prev_fill_image
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|adjustment
operator|->
name|value
argument_list|,
name|adjustment
operator|->
name|value
operator|+
name|adjustment
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gtk_widget_draw
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
comment|/* if */
if|if
condition|(
name|last_grad
operator|!=
name|curr_gradient
operator|||
name|last_row
operator|<
literal|0
condition|)
block|{
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gradients_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|g
operator|==
name|curr_gradient
condition|)
block|{
break|break;
comment|/* We found the one we want */
block|}
comment|/* if */
name|n
operator|++
expr_stmt|;
comment|/* Next gradient */
name|tmp
operator|=
name|g_slist_next
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
comment|/* while */
name|last_grad
operator|=
name|curr_gradient
expr_stmt|;
name|last_row
operator|=
name|n
expr_stmt|;
block|}
comment|/* if */
name|draw_small_preview
argument_list|(
name|g_editor
operator|->
name|gc
argument_list|,
name|g_editor
operator|->
name|clist
argument_list|,
name|curr_gradient
argument_list|,
name|last_row
argument_list|)
expr_stmt|;
comment|/* Update any others that are on screen */
name|sel_update_dialogs
argument_list|(
name|last_row
argument_list|,
name|curr_gradient
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* prev_update */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|prev_fill_image (int width,int height,double left,double right)
name|prev_fill_image
parameter_list|(
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|double
name|left
parameter_list|,
name|double
name|right
parameter_list|)
block|{
name|guchar
modifier|*
name|p0
decl_stmt|,
modifier|*
name|p1
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|double
name|dx
decl_stmt|,
name|cur_x
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|double
name|c0
decl_stmt|,
name|c1
decl_stmt|;
name|dx
operator|=
operator|(
name|right
operator|-
name|left
operator|)
operator|/
operator|(
name|width
operator|-
literal|1
operator|)
expr_stmt|;
name|cur_x
operator|=
name|left
expr_stmt|;
name|p0
operator|=
name|g_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
expr_stmt|;
name|p1
operator|=
name|g_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
expr_stmt|;
comment|/* Create lines to fill the image */
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|width
condition|;
name|x
operator|++
control|)
block|{
name|grad_get_color_at
argument_list|(
name|cur_x
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|/
name|GRAD_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
block|{
name|c0
operator|=
name|GRAD_CHECK_LIGHT
expr_stmt|;
name|c1
operator|=
name|GRAD_CHECK_DARK
expr_stmt|;
block|}
else|else
block|{
name|c0
operator|=
name|GRAD_CHECK_DARK
expr_stmt|;
name|c1
operator|=
name|GRAD_CHECK_LIGHT
expr_stmt|;
block|}
comment|/* else */
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|r
operator|-
name|c0
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|g
operator|-
name|c0
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
operator|(
name|c0
operator|+
operator|(
name|b
operator|-
name|c0
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|r
operator|-
name|c1
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|g
operator|-
name|c1
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
operator|(
name|c1
operator|+
operator|(
name|b
operator|-
name|c1
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|cur_x
operator|+=
name|dx
expr_stmt|;
block|}
comment|/* for */
comment|/* Fill image */
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
if|if
condition|(
operator|(
name|y
operator|/
name|GRAD_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|g_editor
operator|->
name|preview_rows
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|width
argument_list|)
expr_stmt|;
else|else
name|gtk_preview_draw_row
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|preview
argument_list|)
argument_list|,
name|g_editor
operator|->
name|preview_rows
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|width
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* prev_fill_image */
end_comment

begin_comment
comment|/***** Gradient control functions *****/
end_comment

begin_comment
comment|/* *** WARNING *** WARNING *** WARNING ***  *  * All the event-handling code for the gradient control widget is  * extremely hairy.  You are not expected to understand it.  If you  * find bugs, mail me unless you are very brave and you want to fix  * them yourself ;-)  */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|gint
DECL|function|control_events (GtkWidget * widget,GdkEvent * event)
name|control_events
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|guint32
name|time
decl_stmt|;
name|GdkEventButton
modifier|*
name|bevent
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
condition|)
block|{
case|case
name|GDK_EXPOSE
case|:
name|control_update
argument_list|(
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_LEAVE_NOTIFY
case|:
name|ed_set_hint
argument_list|(
literal|""
argument_list|)
expr_stmt|;
break|break;
case|case
name|GDK_BUTTON_PRESS
case|:
if|if
condition|(
name|g_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_NONE
condition|)
block|{
name|gtk_widget_get_pointer
argument_list|(
name|g_editor
operator|->
name|control
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|bevent
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
expr_stmt|;
name|g_editor
operator|->
name|control_last_x
operator|=
name|x
expr_stmt|;
name|g_editor
operator|->
name|control_click_time
operator|=
name|bevent
operator|->
name|time
expr_stmt|;
name|control_button_press
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|bevent
operator|->
name|button
argument_list|,
name|bevent
operator|->
name|state
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|control_drag_mode
operator|!=
name|GRAD_DRAG_NONE
condition|)
name|gtk_grab_add
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
comment|/* if */
break|break;
case|case
name|GDK_BUTTON_RELEASE
case|:
name|ed_set_hint
argument_list|(
literal|""
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|control_drag_mode
operator|!=
name|GRAD_DRAG_NONE
condition|)
block|{
name|gtk_grab_remove
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gtk_widget_get_pointer
argument_list|(
name|g_editor
operator|->
name|control
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|time
operator|=
operator|(
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
operator|)
operator|->
name|time
expr_stmt|;
if|if
condition|(
operator|(
name|time
operator|-
name|g_editor
operator|->
name|control_click_time
operator|)
operator|>=
name|GRAD_MOVE_TIME
condition|)
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
comment|/* Possible move */
elseif|else
if|if
condition|(
operator|(
name|g_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_MIDDLE
operator|)
operator|||
operator|(
name|g_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_ALL
operator|)
condition|)
block|{
name|seg
operator|=
name|g_editor
operator|->
name|control_drag_segment
expr_stmt|;
if|if
condition|(
operator|(
name|g_editor
operator|->
name|control_drag_mode
operator|==
name|GRAD_DRAG_ALL
operator|)
operator|&&
name|g_editor
operator|->
name|control_compress
condition|)
name|control_extend_selection
argument_list|(
name|seg
argument_list|,
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|control_select_single_segment
argument_list|(
name|seg
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
comment|/* if */
name|g_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_NONE
expr_stmt|;
name|g_editor
operator|->
name|control_compress
operator|=
literal|0
expr_stmt|;
name|control_do_hint
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
comment|/* if */
break|break;
case|case
name|GDK_MOTION_NOTIFY
case|:
name|gtk_widget_get_pointer
argument_list|(
name|g_editor
operator|->
name|control
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|x
operator|!=
name|g_editor
operator|->
name|control_last_x
condition|)
block|{
name|g_editor
operator|->
name|control_last_x
operator|=
name|x
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|control_drag_mode
operator|!=
name|GRAD_DRAG_NONE
condition|)
block|{
name|time
operator|=
operator|(
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
operator|)
operator|->
name|time
expr_stmt|;
if|if
condition|(
operator|(
name|time
operator|-
name|g_editor
operator|->
name|control_click_time
operator|)
operator|>=
name|GRAD_MOVE_TIME
condition|)
name|control_motion
argument_list|(
name|x
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
name|control_do_hint
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
comment|/* if */
break|break;
default|default:
break|break;
block|}
comment|/* switch */
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* control_events */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_do_hint (gint x,gint y)
name|control_do_hint
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|control_drag_mode_t
name|handle
decl_stmt|;
name|int
name|in_handle
decl_stmt|;
name|double
name|pos
decl_stmt|;
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|pos
operator|<
literal|0.0
operator|)
operator|||
operator|(
name|pos
operator|>
literal|1.0
operator|)
condition|)
return|return;
name|seg_get_closest_handle
argument_list|(
name|curr_gradient
argument_list|,
name|pos
argument_list|,
operator|&
name|seg
argument_list|,
operator|&
name|handle
argument_list|)
expr_stmt|;
name|in_handle
operator|=
name|control_point_in_handle
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|seg
argument_list|,
name|handle
argument_list|)
expr_stmt|;
if|if
condition|(
name|in_handle
condition|)
block|{
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|seg
operator|->
name|prev
operator|!=
name|NULL
condition|)
name|ed_set_hint
argument_list|(
name|N_
argument_list|(
literal|"Drag: move    Shift+drag: move& compress"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|ed_set_hint
argument_list|(
name|N_
argument_list|(
literal|"Click: select    Shift+click: extend selection"
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
name|ed_set_hint
argument_list|(
name|N_
argument_list|(
literal|"Click: select    Shift+click: extend selection"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|ed_set_hint
argument_list|(
name|N_
argument_list|(
literal|"Click: select    Shift+click: extend selection    "
literal|"Drag: move"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_message
argument_list|(
name|_
argument_list|(
literal|"control_do_hint: oops, in_handle is true "
literal|"yet we got handle type %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|handle
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* switch */
block|}
else|else
name|ed_set_hint
argument_list|(
name|N_
argument_list|(
literal|"Click: select    Shift+click: extend selection    "
literal|"Drag: move    Shift+drag: move& compress"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_do_hint */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_button_press (gint x,gint y,guint button,guint state)
name|control_button_press
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|guint
name|button
parameter_list|,
name|guint
name|state
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|control_drag_mode_t
name|handle
decl_stmt|;
name|double
name|xpos
decl_stmt|;
name|int
name|in_handle
decl_stmt|;
comment|/* See which button was pressed */
switch|switch
condition|(
name|button
condition|)
block|{
case|case
literal|1
case|:
break|break;
case|case
literal|3
case|:
name|cpopup_do_popup
argument_list|()
expr_stmt|;
return|return;
default|default:
return|return;
block|}
comment|/* switch */
comment|/* Find the closest handle */
name|xpos
operator|=
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|seg_get_closest_handle
argument_list|(
name|curr_gradient
argument_list|,
name|xpos
argument_list|,
operator|&
name|seg
argument_list|,
operator|&
name|handle
argument_list|)
expr_stmt|;
name|in_handle
operator|=
name|control_point_in_handle
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|seg
argument_list|,
name|handle
argument_list|)
expr_stmt|;
comment|/* Now see what we have */
if|if
condition|(
name|in_handle
condition|)
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
operator|!=
name|NULL
condition|)
block|{
comment|/* Left handle of some segment */
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
if|if
condition|(
name|seg
operator|->
name|prev
operator|!=
name|NULL
condition|)
block|{
name|g_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
name|g_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
name|g_editor
operator|->
name|control_compress
operator|=
literal|1
expr_stmt|;
block|}
else|else
block|{
name|control_extend_selection
argument_list|(
name|seg
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
elseif|else
if|if
condition|(
name|seg
operator|->
name|prev
operator|!=
name|NULL
condition|)
block|{
name|g_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
name|g_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
block|}
else|else
block|{
name|control_select_single_segment
argument_list|(
name|seg
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
comment|/* else */
return|return;
block|}
else|else
block|{
comment|/* Right handle of last segment */
name|seg
operator|=
name|seg_get_last_segment
argument_list|(
name|curr_gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
name|control_extend_selection
argument_list|(
name|seg
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|control_select_single_segment
argument_list|(
name|seg
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
comment|/* else */
return|return;
block|}
comment|/* else */
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
block|{
name|control_extend_selection
argument_list|(
name|seg
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_MIDDLE
expr_stmt|;
name|g_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
block|}
comment|/* else */
return|return;
default|default:
name|g_message
argument_list|(
name|_
argument_list|(
literal|"control_button_press(): oops, in_handle is true "
literal|"yet we got handle type %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|handle
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* switch */
else|else
block|{
name|seg
operator|=
name|seg_get_segment_at
argument_list|(
name|curr_gradient
argument_list|,
name|xpos
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_drag_mode
operator|=
name|GRAD_DRAG_ALL
expr_stmt|;
name|g_editor
operator|->
name|control_drag_segment
operator|=
name|seg
expr_stmt|;
name|g_editor
operator|->
name|control_last_gx
operator|=
name|xpos
expr_stmt|;
name|g_editor
operator|->
name|control_orig_pos
operator|=
name|xpos
expr_stmt|;
if|if
condition|(
name|state
operator|&
name|GDK_SHIFT_MASK
condition|)
name|g_editor
operator|->
name|control_compress
operator|=
literal|1
expr_stmt|;
return|return;
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* control_button_press */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|int
DECL|function|control_point_in_handle (gint x,gint y,grad_segment_t * seg,control_drag_mode_t handle)
name|control_point_in_handle
parameter_list|(
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|grad_segment_t
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
name|handle
parameter_list|)
block|{
name|gint
name|handle_pos
decl_stmt|;
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
condition|)
name|handle_pos
operator|=
name|control_calc_p_pos
argument_list|(
name|seg
operator|->
name|left
argument_list|)
expr_stmt|;
else|else
block|{
name|seg
operator|=
name|seg_get_last_segment
argument_list|(
name|curr_gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
name|handle_pos
operator|=
name|control_calc_p_pos
argument_list|(
name|seg
operator|->
name|right
argument_list|)
expr_stmt|;
block|}
comment|/* else */
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|handle_pos
operator|=
name|control_calc_p_pos
argument_list|(
name|seg
operator|->
name|middle
argument_list|)
expr_stmt|;
break|break;
default|default:
name|g_message
argument_list|(
name|_
argument_list|(
literal|"control_point_in_handle(): oops, can not handle drag mode %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|handle
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* switch */
name|y
operator|/=
literal|2
expr_stmt|;
if|if
condition|(
operator|(
name|x
operator|>=
operator|(
name|handle_pos
operator|-
name|y
operator|)
operator|)
operator|&&
operator|(
name|x
operator|<=
operator|(
name|handle_pos
operator|+
name|y
operator|)
operator|)
condition|)
return|return
literal|1
return|;
else|else
return|return
literal|0
return|;
block|}
end_function

begin_comment
comment|/* control_point_in_handle */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_select_single_segment (grad_segment_t * seg)
name|control_select_single_segment
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
block|{
name|g_editor
operator|->
name|control_sel_l
operator|=
name|seg
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_select_single_segment */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_extend_selection (grad_segment_t * seg,double pos)
name|control_extend_selection
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
if|if
condition|(
name|fabs
argument_list|(
name|pos
operator|-
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
argument_list|)
operator|<
name|fabs
argument_list|(
name|pos
operator|-
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
argument_list|)
condition|)
name|g_editor
operator|->
name|control_sel_l
operator|=
name|seg
expr_stmt|;
else|else
name|g_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_extend_selection */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_motion (gint x)
name|control_motion
parameter_list|(
name|gint
name|x
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|double
name|pos
decl_stmt|;
name|double
name|delta
decl_stmt|;
name|char
name|str
index|[
literal|256
index|]
decl_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_drag_segment
expr_stmt|;
switch|switch
condition|(
name|g_editor
operator|->
name|control_drag_mode
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|g_editor
operator|->
name|control_compress
condition|)
name|seg
operator|->
name|prev
operator|->
name|right
operator|=
name|seg
operator|->
name|left
operator|=
name|BOUNDS
argument_list|(
name|pos
argument_list|,
name|seg
operator|->
name|prev
operator|->
name|middle
operator|+
name|EPSILON
argument_list|,
name|seg
operator|->
name|middle
operator|-
name|EPSILON
argument_list|)
expr_stmt|;
else|else
name|control_compress_left
argument_list|(
name|g_editor
operator|->
name|control_sel_l
argument_list|,
name|g_editor
operator|->
name|control_sel_r
argument_list|,
name|seg
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Handle position: %0.6f"
argument_list|)
argument_list|,
name|seg
operator|->
name|left
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|BOUNDS
argument_list|(
name|pos
argument_list|,
name|seg
operator|->
name|left
operator|+
name|EPSILON
argument_list|,
name|seg
operator|->
name|right
operator|-
name|EPSILON
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Handle position: %0.6f"
argument_list|)
argument_list|,
name|seg
operator|->
name|middle
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|str
argument_list|)
expr_stmt|;
break|break;
case|case
name|GRAD_DRAG_ALL
case|:
name|pos
operator|=
name|control_calc_g_pos
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|delta
operator|=
name|pos
operator|-
name|g_editor
operator|->
name|control_last_gx
expr_stmt|;
if|if
condition|(
operator|(
name|seg
operator|->
name|left
operator|>=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
operator|)
operator|&&
operator|(
name|seg
operator|->
name|right
operator|<=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|)
condition|)
name|delta
operator|=
name|control_move
argument_list|(
name|g_editor
operator|->
name|control_sel_l
argument_list|,
name|g_editor
operator|->
name|control_sel_r
argument_list|,
name|delta
argument_list|)
expr_stmt|;
else|else
name|delta
operator|=
name|control_move
argument_list|(
name|seg
argument_list|,
name|seg
argument_list|,
name|delta
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_last_gx
operator|+=
name|delta
expr_stmt|;
name|g_snprintf
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Distance: %0.6f"
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_last_gx
operator|-
name|g_editor
operator|->
name|control_orig_pos
argument_list|)
expr_stmt|;
name|ed_set_hint
argument_list|(
name|str
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"control_motion(): aieee, attempt to move bogus handle %d"
argument_list|)
argument_list|,
operator|(
name|int
operator|)
name|g_editor
operator|->
name|control_drag_mode
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* switch */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|instant_update
condition|)
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
else|else
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_motion */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_compress_left (grad_segment_t * range_l,grad_segment_t * range_r,grad_segment_t * drag_seg,double pos)
name|control_compress_left
parameter_list|(
name|grad_segment_t
modifier|*
name|range_l
parameter_list|,
name|grad_segment_t
modifier|*
name|range_r
parameter_list|,
name|grad_segment_t
modifier|*
name|drag_seg
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|double
name|lbound
decl_stmt|,
name|rbound
decl_stmt|;
name|int
name|k
decl_stmt|;
comment|/* Check what we have to compress */
if|if
condition|(
operator|!
operator|(
operator|(
name|drag_seg
operator|->
name|left
operator|>=
name|range_l
operator|->
name|left
operator|)
operator|&&
operator|(
operator|(
name|drag_seg
operator|->
name|right
operator|<=
name|range_r
operator|->
name|right
operator|)
operator|||
operator|(
name|drag_seg
operator|==
name|range_r
operator|->
name|next
operator|)
operator|)
operator|)
condition|)
block|{
comment|/* We are compressing a segment outside the selection */
name|range_l
operator|=
name|range_r
operator|=
name|drag_seg
expr_stmt|;
block|}
comment|/* else */
comment|/* Calculate left bound for dragged hadle */
if|if
condition|(
name|drag_seg
operator|==
name|range_l
condition|)
name|lbound
operator|=
name|range_l
operator|->
name|prev
operator|->
name|left
operator|+
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
block|{
comment|/* Count number of segments to the left of the dragged handle */
name|seg
operator|=
name|drag_seg
expr_stmt|;
name|k
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|seg
operator|!=
name|range_l
condition|)
block|{
name|k
operator|++
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|prev
expr_stmt|;
block|}
comment|/* while */
comment|/* 2*k handles have to fit */
name|lbound
operator|=
name|range_l
operator|->
name|left
operator|+
literal|2.0
operator|*
name|k
operator|*
name|EPSILON
expr_stmt|;
block|}
comment|/* else */
comment|/* Calculate right bound for dragged handle */
if|if
condition|(
name|drag_seg
operator|==
name|range_r
operator|->
name|next
condition|)
name|rbound
operator|=
name|range_r
operator|->
name|next
operator|->
name|right
operator|-
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
block|{
comment|/* Count number of segments to the right of the dragged handle */
name|seg
operator|=
name|drag_seg
expr_stmt|;
name|k
operator|=
literal|1
expr_stmt|;
while|while
condition|(
name|seg
operator|!=
name|range_r
condition|)
block|{
name|k
operator|++
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* while */
comment|/* 2*k handles have to fit */
name|rbound
operator|=
name|range_r
operator|->
name|right
operator|-
literal|2.0
operator|*
name|k
operator|*
name|EPSILON
expr_stmt|;
block|}
comment|/* else */
comment|/* Calculate position */
name|pos
operator|=
name|BOUNDS
argument_list|(
name|pos
argument_list|,
name|lbound
argument_list|,
name|rbound
argument_list|)
expr_stmt|;
comment|/* Compress segments to the left of the handle */
if|if
condition|(
name|drag_seg
operator|==
name|range_l
condition|)
name|control_compress_range
argument_list|(
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
operator|->
name|left
argument_list|,
name|pos
argument_list|)
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|range_l
argument_list|,
name|drag_seg
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|left
argument_list|,
name|pos
argument_list|)
expr_stmt|;
comment|/* Compress segments to the right of the handle */
if|if
condition|(
name|drag_seg
operator|!=
name|range_r
operator|->
name|next
condition|)
name|control_compress_range
argument_list|(
name|drag_seg
argument_list|,
name|range_r
argument_list|,
name|pos
argument_list|,
name|range_r
operator|->
name|right
argument_list|)
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|drag_seg
argument_list|,
name|drag_seg
argument_list|,
name|pos
argument_list|,
name|drag_seg
operator|->
name|right
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_compress_left */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_compress_range (grad_segment_t * range_l,grad_segment_t * range_r,double new_l,double new_r)
name|control_compress_range
parameter_list|(
name|grad_segment_t
modifier|*
name|range_l
parameter_list|,
name|grad_segment_t
modifier|*
name|range_r
parameter_list|,
name|double
name|new_l
parameter_list|,
name|double
name|new_r
parameter_list|)
block|{
name|double
name|orig_l
decl_stmt|,
name|orig_r
decl_stmt|;
name|double
name|scale
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|orig_l
operator|=
name|range_l
operator|->
name|left
expr_stmt|;
name|orig_r
operator|=
name|range_r
operator|->
name|right
expr_stmt|;
name|scale
operator|=
operator|(
name|new_r
operator|-
name|new_l
operator|)
operator|/
operator|(
name|orig_r
operator|-
name|orig_l
operator|)
expr_stmt|;
name|seg
operator|=
name|range_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|left
operator|=
name|new_l
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|orig_l
operator|)
operator|*
name|scale
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|new_l
operator|+
operator|(
name|seg
operator|->
name|middle
operator|-
name|orig_l
operator|)
operator|*
name|scale
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|new_l
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|orig_l
operator|)
operator|*
name|scale
expr_stmt|;
comment|/* Next */
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|range_r
condition|)
do|;
block|}
end_function

begin_comment
comment|/* control_compress_range */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|control_move (grad_segment_t * range_l,grad_segment_t * range_r,double delta)
name|control_move
parameter_list|(
name|grad_segment_t
modifier|*
name|range_l
parameter_list|,
name|grad_segment_t
modifier|*
name|range_r
parameter_list|,
name|double
name|delta
parameter_list|)
block|{
name|double
name|lbound
decl_stmt|,
name|rbound
decl_stmt|;
name|int
name|is_first
decl_stmt|,
name|is_last
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
comment|/* First or last segments in gradient? */
name|is_first
operator|=
operator|(
name|range_l
operator|->
name|prev
operator|==
name|NULL
operator|)
expr_stmt|;
name|is_last
operator|=
operator|(
name|range_r
operator|->
name|next
operator|==
name|NULL
operator|)
expr_stmt|;
comment|/* Calculate drag bounds */
if|if
condition|(
operator|!
name|g_editor
operator|->
name|control_compress
condition|)
block|{
if|if
condition|(
operator|!
name|is_first
condition|)
name|lbound
operator|=
name|range_l
operator|->
name|prev
operator|->
name|middle
operator|+
name|EPSILON
expr_stmt|;
else|else
name|lbound
operator|=
name|range_l
operator|->
name|left
operator|+
name|EPSILON
expr_stmt|;
if|if
condition|(
operator|!
name|is_last
condition|)
name|rbound
operator|=
name|range_r
operator|->
name|next
operator|->
name|middle
operator|-
name|EPSILON
expr_stmt|;
else|else
name|rbound
operator|=
name|range_r
operator|->
name|right
operator|-
name|EPSILON
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|is_first
condition|)
name|lbound
operator|=
name|range_l
operator|->
name|prev
operator|->
name|left
operator|+
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
name|lbound
operator|=
name|range_l
operator|->
name|left
operator|+
name|EPSILON
expr_stmt|;
if|if
condition|(
operator|!
name|is_last
condition|)
name|rbound
operator|=
name|range_r
operator|->
name|next
operator|->
name|right
operator|-
literal|2.0
operator|*
name|EPSILON
expr_stmt|;
else|else
name|rbound
operator|=
name|range_r
operator|->
name|right
operator|-
name|EPSILON
expr_stmt|;
block|}
comment|/* if */
comment|/* Fix the delta if necessary */
if|if
condition|(
name|delta
operator|<
literal|0.0
condition|)
block|{
if|if
condition|(
operator|!
name|is_first
condition|)
block|{
if|if
condition|(
name|range_l
operator|->
name|left
operator|+
name|delta
operator|<
name|lbound
condition|)
name|delta
operator|=
name|lbound
operator|-
name|range_l
operator|->
name|left
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|range_l
operator|->
name|middle
operator|+
name|delta
operator|<
name|lbound
condition|)
name|delta
operator|=
name|lbound
operator|-
name|range_l
operator|->
name|middle
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|!
name|is_last
condition|)
block|{
if|if
condition|(
name|range_r
operator|->
name|right
operator|+
name|delta
operator|>
name|rbound
condition|)
name|delta
operator|=
name|rbound
operator|-
name|range_r
operator|->
name|right
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|range_r
operator|->
name|middle
operator|+
name|delta
operator|>
name|rbound
condition|)
name|delta
operator|=
name|rbound
operator|-
name|range_r
operator|->
name|middle
expr_stmt|;
block|}
comment|/* else */
comment|/* Move all the segments inside the range */
name|seg
operator|=
name|range_l
expr_stmt|;
do|do
block|{
if|if
condition|(
operator|!
operator|(
operator|(
name|seg
operator|==
name|range_l
operator|)
operator|&&
name|is_first
operator|)
condition|)
name|seg
operator|->
name|left
operator|+=
name|delta
expr_stmt|;
name|seg
operator|->
name|middle
operator|+=
name|delta
expr_stmt|;
if|if
condition|(
operator|!
operator|(
operator|(
name|seg
operator|==
name|range_r
operator|)
operator|&&
name|is_last
operator|)
condition|)
name|seg
operator|->
name|right
operator|+=
name|delta
expr_stmt|;
comment|/* Next */
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|range_r
condition|)
do|;
comment|/* Fix the segments that surround the range */
if|if
condition|(
operator|!
name|is_first
condition|)
block|{
if|if
condition|(
operator|!
name|g_editor
operator|->
name|control_compress
condition|)
name|range_l
operator|->
name|prev
operator|->
name|right
operator|=
name|range_l
operator|->
name|left
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
argument_list|,
name|range_l
operator|->
name|prev
operator|->
name|left
argument_list|,
name|range_l
operator|->
name|left
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|is_last
condition|)
block|{
if|if
condition|(
operator|!
name|g_editor
operator|->
name|control_compress
condition|)
name|range_r
operator|->
name|next
operator|->
name|left
operator|=
name|range_r
operator|->
name|right
expr_stmt|;
else|else
name|control_compress_range
argument_list|(
name|range_r
operator|->
name|next
argument_list|,
name|range_r
operator|->
name|next
argument_list|,
name|range_r
operator|->
name|right
argument_list|,
name|range_r
operator|->
name|next
operator|->
name|right
argument_list|)
expr_stmt|;
block|}
return|return
name|delta
return|;
block|}
end_function

begin_comment
comment|/* control_move */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_update (int recalculate)
name|control_update
parameter_list|(
name|int
name|recalculate
parameter_list|)
block|{
name|gint
name|cwidth
decl_stmt|,
name|cheight
decl_stmt|;
name|gint
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
comment|/* We only update if we can redraw and a gradient is present */
if|if
condition|(
name|curr_gradient
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
operator|!
name|GTK_WIDGET_DRAWABLE
argument_list|(
name|g_editor
operator|->
name|control
argument_list|)
condition|)
return|return;
comment|/* See whether we have to re-create the control pixmap */
name|gdk_window_get_size
argument_list|(
name|g_editor
operator|->
name|control
operator|->
name|window
argument_list|,
operator|&
name|cwidth
argument_list|,
operator|&
name|cheight
argument_list|)
expr_stmt|;
comment|/* as long as we have that ugly workaround in prev_update() don't 	   change the size of the controls either when the window is resized */
name|cwidth
operator|=
name|GRAD_PREVIEW_WIDTH
expr_stmt|;
name|cheight
operator|=
name|GRAD_PREVIEW_HEIGHT
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|control_pixmap
condition|)
name|gdk_window_get_size
argument_list|(
name|g_editor
operator|->
name|control_pixmap
argument_list|,
operator|&
name|pwidth
argument_list|,
operator|&
name|pheight
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|g_editor
operator|->
name|control_pixmap
operator|||
operator|(
name|cwidth
operator|!=
name|pwidth
operator|)
operator|||
operator|(
name|cheight
operator|!=
name|pheight
operator|)
condition|)
block|{
if|if
condition|(
name|g_editor
operator|->
name|control_pixmap
condition|)
name|gdk_pixmap_unref
argument_list|(
name|g_editor
operator|->
name|control_pixmap
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_pixmap
operator|=
name|gdk_pixmap_new
argument_list|(
name|g_editor
operator|->
name|control
operator|->
name|window
argument_list|,
name|cwidth
argument_list|,
name|cheight
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|recalculate
operator|=
literal|1
expr_stmt|;
block|}
comment|/* if */
comment|/* Have to reset the selection? */
if|if
condition|(
name|recalculate
condition|)
name|control_select_single_segment
argument_list|(
name|curr_gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
comment|/* Redraw pixmap */
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|control_draw
argument_list|(
name|g_editor
operator|->
name|control_pixmap
argument_list|,
name|cwidth
argument_list|,
name|cheight
argument_list|,
name|adjustment
operator|->
name|value
argument_list|,
name|adjustment
operator|->
name|value
operator|+
name|adjustment
operator|->
name|page_size
argument_list|)
expr_stmt|;
name|gdk_draw_pixmap
argument_list|(
name|g_editor
operator|->
name|control
operator|->
name|window
argument_list|,
name|g_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|g_editor
operator|->
name|control_pixmap
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|cwidth
argument_list|,
name|cheight
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_update */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_draw (GdkPixmap * pixmap,int width,int height,double left,double right)
name|control_draw
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|double
name|left
parameter_list|,
name|double
name|right
parameter_list|)
block|{
name|int
name|sel_l
decl_stmt|,
name|sel_r
decl_stmt|;
name|double
name|g_pos
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|control_drag_mode_t
name|handle
decl_stmt|;
comment|/* Clear the pixmap */
name|gdk_draw_rectangle
argument_list|(
name|pixmap
argument_list|,
name|g_editor
operator|->
name|control
operator|->
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Draw selection */
name|sel_l
operator|=
name|control_calc_p_pos
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
argument_list|)
expr_stmt|;
name|sel_r
operator|=
name|control_calc_p_pos
argument_list|(
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
argument_list|)
expr_stmt|;
name|gdk_draw_rectangle
argument_list|(
name|pixmap
argument_list|,
name|g_editor
operator|->
name|control
operator|->
name|style
operator|->
name|dark_gc
index|[
name|GTK_STATE_NORMAL
index|]
argument_list|,
name|TRUE
argument_list|,
name|sel_l
argument_list|,
literal|0
argument_list|,
name|sel_r
operator|-
name|sel_l
operator|+
literal|1
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Draw handles */
name|seg
operator|=
name|curr_gradient
operator|->
name|segments
expr_stmt|;
while|while
condition|(
name|seg
condition|)
block|{
name|control_draw_normal_handle
argument_list|(
name|pixmap
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|control_draw_middle_handle
argument_list|(
name|pixmap
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Draw right handle only if this is the last segment */
if|if
condition|(
name|seg
operator|->
name|next
operator|==
name|NULL
condition|)
name|control_draw_normal_handle
argument_list|(
name|pixmap
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|height
argument_list|)
expr_stmt|;
comment|/* Next! */
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* while */
comment|/* Draw the handle which is closest to the mouse position */
name|g_pos
operator|=
name|control_calc_g_pos
argument_list|(
name|g_editor
operator|->
name|control_last_x
argument_list|)
expr_stmt|;
name|seg_get_closest_handle
argument_list|(
name|curr_gradient
argument_list|,
name|BOUNDS
argument_list|(
name|g_pos
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
argument_list|,
operator|&
name|seg
argument_list|,
operator|&
name|handle
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|handle
condition|)
block|{
case|case
name|GRAD_DRAG_LEFT
case|:
if|if
condition|(
name|seg
condition|)
name|control_draw_normal_handle
argument_list|(
name|pixmap
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|height
argument_list|)
expr_stmt|;
else|else
block|{
name|seg
operator|=
name|seg_get_last_segment
argument_list|(
name|curr_gradient
operator|->
name|segments
argument_list|)
expr_stmt|;
name|control_draw_normal_handle
argument_list|(
name|pixmap
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
comment|/* else */
break|break;
case|case
name|GRAD_DRAG_MIDDLE
case|:
name|control_draw_middle_handle
argument_list|(
name|pixmap
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
name|height
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/* switch */
block|}
end_function

begin_comment
comment|/* control_draw */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_draw_normal_handle (GdkPixmap * pixmap,double pos,int height)
name|control_draw_normal_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|double
name|pos
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|control_draw_handle
argument_list|(
name|pixmap
argument_list|,
name|g_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|g_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|control_calc_p_pos
argument_list|(
name|pos
argument_list|)
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_draw_normal_handle */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_draw_middle_handle (GdkPixmap * pixmap,double pos,int height)
name|control_draw_middle_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|double
name|pos
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|control_draw_handle
argument_list|(
name|pixmap
argument_list|,
name|g_editor
operator|->
name|control
operator|->
name|style
operator|->
name|black_gc
argument_list|,
name|g_editor
operator|->
name|control
operator|->
name|style
operator|->
name|bg_gc
index|[
name|GTK_STATE_PRELIGHT
index|]
argument_list|,
name|control_calc_p_pos
argument_list|(
name|pos
argument_list|)
argument_list|,
name|height
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_draw_middle_handle */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|control_draw_handle (GdkPixmap * pixmap,GdkGC * border_gc,GdkGC * fill_gc,int xpos,int height)
name|control_draw_handle
parameter_list|(
name|GdkPixmap
modifier|*
name|pixmap
parameter_list|,
name|GdkGC
modifier|*
name|border_gc
parameter_list|,
name|GdkGC
modifier|*
name|fill_gc
parameter_list|,
name|int
name|xpos
parameter_list|,
name|int
name|height
parameter_list|)
block|{
name|int
name|y
decl_stmt|;
name|int
name|left
decl_stmt|,
name|right
decl_stmt|,
name|bottom
decl_stmt|;
for|for
control|(
name|y
operator|=
literal|0
init|;
name|y
operator|<
name|height
condition|;
name|y
operator|++
control|)
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|fill_gc
argument_list|,
name|xpos
operator|-
name|y
operator|/
literal|2
argument_list|,
name|y
argument_list|,
name|xpos
operator|+
name|y
operator|/
literal|2
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|bottom
operator|=
name|height
operator|-
literal|1
expr_stmt|;
name|left
operator|=
name|xpos
operator|-
name|bottom
operator|/
literal|2
expr_stmt|;
name|right
operator|=
name|xpos
operator|+
name|bottom
operator|/
literal|2
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|border_gc
argument_list|,
name|xpos
argument_list|,
literal|0
argument_list|,
name|left
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|border_gc
argument_list|,
name|xpos
argument_list|,
literal|0
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|gdk_draw_line
argument_list|(
name|pixmap
argument_list|,
name|border_gc
argument_list|,
name|left
argument_list|,
name|bottom
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* control_draw_handle */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|int
DECL|function|control_calc_p_pos (double pos)
name|control_calc_p_pos
parameter_list|(
name|double
name|pos
parameter_list|)
block|{
name|gint
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
comment|/* Calculate the position (in widget's coordinates) of the 	 * requested point from the gradient.  Rounding is done to 	 * minimize mismatches between the rendered gradient preview 	 * and the gradient control's handles. 	 */
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|gdk_window_get_size
argument_list|(
name|g_editor
operator|->
name|control_pixmap
argument_list|,
operator|&
name|pwidth
argument_list|,
operator|&
name|pheight
argument_list|)
expr_stmt|;
return|return
call|(
name|int
call|)
argument_list|(
operator|(
name|pwidth
operator|-
literal|1
operator|)
operator|*
operator|(
name|pos
operator|-
name|adjustment
operator|->
name|value
operator|)
operator|/
name|adjustment
operator|->
name|page_size
operator|+
literal|0.5
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* control_calc_p_pos */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|control_calc_g_pos (int pos)
name|control_calc_g_pos
parameter_list|(
name|int
name|pos
parameter_list|)
block|{
name|gint
name|pwidth
decl_stmt|,
name|pheight
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
comment|/* Calculate the gradient position that corresponds to widget's coordinates */
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|g_editor
operator|->
name|scroll_data
argument_list|)
expr_stmt|;
name|gdk_window_get_size
argument_list|(
name|g_editor
operator|->
name|control_pixmap
argument_list|,
operator|&
name|pwidth
argument_list|,
operator|&
name|pheight
argument_list|)
expr_stmt|;
return|return
name|adjustment
operator|->
name|page_size
operator|*
name|pos
operator|/
operator|(
name|pwidth
operator|-
literal|1
operator|)
operator|+
name|adjustment
operator|->
name|value
return|;
block|}
end_function

begin_comment
comment|/* control_calc_g_pos */
end_comment

begin_comment
comment|/***** Control popup functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_create_main_menu (void)
name|cpopup_create_main_menu
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|accel_group
operator|=
name|gtk_accel_group_new
argument_list|()
expr_stmt|;
name|g_editor
operator|->
name|accel_group
operator|=
name|accel_group
expr_stmt|;
name|gtk_menu_set_accel_group
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
name|gtk_window_add_accel_group
argument_list|(
name|GTK_WINDOW
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
comment|/* Left endpoint */
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|g_editor
operator|->
name|left_color_preview
argument_list|,
operator|&
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Left endpoint's color"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_set_left_color_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'L'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Load from"
argument_list|)
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_left_load_popup
operator|=
name|cpopup_create_load_menu
argument_list|(
name|g_editor
operator|->
name|left_load_color_boxes
argument_list|,
name|g_editor
operator|->
name|left_load_labels
argument_list|,
name|_
argument_list|(
literal|"Left neighbor's right endpoint"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Right endpoint"
argument_list|)
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_load_left_callback
argument_list|,
literal|'L'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
literal|'L'
argument_list|,
name|GDK_MOD1_MASK
argument_list|,
literal|'F'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_left_load_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Save to"
argument_list|)
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_left_save_popup
operator|=
name|cpopup_create_save_menu
argument_list|(
name|g_editor
operator|->
name|left_save_color_boxes
argument_list|,
name|g_editor
operator|->
name|left_save_labels
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_save_left_callback
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_left_save_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Right endpoint */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|g_editor
operator|->
name|right_color_preview
argument_list|,
operator|&
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Right endpoint's color"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_set_right_color_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'R'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Load from"
argument_list|)
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_right_load_popup
operator|=
name|cpopup_create_load_menu
argument_list|(
name|g_editor
operator|->
name|right_load_color_boxes
argument_list|,
name|g_editor
operator|->
name|right_load_labels
argument_list|,
name|_
argument_list|(
literal|"Right neighbor's left endpoint"
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Left endpoint"
argument_list|)
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_load_right_callback
argument_list|,
literal|'R'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
literal|'R'
argument_list|,
name|GDK_MOD1_MASK
argument_list|,
literal|'F'
argument_list|,
name|GDK_MOD1_MASK
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_right_load_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Save to"
argument_list|)
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_right_save_popup
operator|=
name|cpopup_create_save_menu
argument_list|(
name|g_editor
operator|->
name|right_save_color_boxes
argument_list|,
name|g_editor
operator|->
name|right_save_labels
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_save_right_callback
argument_list|)
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_right_save_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Blending function */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_blending_label
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_blending_popup
operator|=
name|cpopup_create_blending_menu
argument_list|()
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_blending_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Coloring type */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_coloring_label
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_coloring_popup
operator|=
name|cpopup_create_coloring_menu
argument_list|()
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_coloring_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Operations */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Split at midpoint */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_splitm_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_split_midpoint_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'S'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Split uniformly */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_splitu_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_split_uniform_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'U'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Delete */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_delete_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_delete_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_delete_menu_item
operator|=
name|menuitem
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'D'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Recenter */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_recenter_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_recenter_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'C'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Redistribute */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_redistribute_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_redistribute_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'C'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Selection ops */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Selection operations"
argument_list|)
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_sel_ops_popup
operator|=
name|cpopup_create_sel_ops_menu
argument_list|()
expr_stmt|;
name|gtk_menu_item_set_submenu
argument_list|(
name|GTK_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_sel_ops_popup
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
comment|/* Done */
name|g_editor
operator|->
name|control_main_popup
operator|=
name|menu
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_create_main_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_do_popup (void)
name|cpopup_do_popup
parameter_list|(
name|void
parameter_list|)
block|{
name|cpopup_adjust_menus
argument_list|()
expr_stmt|;
name|gtk_menu_popup
argument_list|(
name|GTK_MENU
argument_list|(
name|g_editor
operator|->
name|control_main_popup
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|3
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_do_popup */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_color_item (GtkWidget ** color_box,GtkWidget ** label)
name|cpopup_create_color_item
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_box
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|wcolor_box
decl_stmt|;
name|GtkWidget
modifier|*
name|wlabel
decl_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|hbox
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
name|wcolor_box
operator|=
name|gtk_preview_new
argument_list|(
name|GTK_PREVIEW_COLOR
argument_list|)
expr_stmt|;
name|gtk_preview_set_dither
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|wcolor_box
argument_list|)
argument_list|,
name|GDK_RGB_DITHER_MAX
argument_list|)
expr_stmt|;
name|gtk_preview_size
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|wcolor_box
argument_list|)
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|,
name|GRAD_COLOR_BOX_HEIGHT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|wcolor_box
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|wcolor_box
argument_list|)
expr_stmt|;
if|if
condition|(
name|color_box
condition|)
operator|*
name|color_box
operator|=
name|wcolor_box
expr_stmt|;
name|wlabel
operator|=
name|gtk_label_new
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|wlabel
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|wlabel
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|wlabel
argument_list|)
expr_stmt|;
if|if
condition|(
name|label
condition|)
operator|*
name|label
operator|=
name|wlabel
expr_stmt|;
return|return
name|menuitem
return|;
block|}
end_function

begin_comment
comment|/* cpopup_create_color_item */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_adjust_menus (void)
name|cpopup_adjust_menus
parameter_list|(
name|void
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|int
name|i
decl_stmt|;
name|double
name|fg_r
decl_stmt|,
name|fg_g
decl_stmt|,
name|fg_b
decl_stmt|;
name|double
name|fg_a
decl_stmt|;
comment|/* Render main menu color boxes */
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|left_color_preview
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|right_color_preview
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|)
expr_stmt|;
comment|/* Render load color from endpoint color boxes */
if|if
condition|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
else|else
name|seg
operator|=
name|seg_get_last_segment
argument_list|(
name|g_editor
operator|->
name|control_sel_l
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|left_load_color_boxes
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|seg
operator|->
name|r1
argument_list|,
name|seg
operator|->
name|g1
argument_list|,
name|seg
operator|->
name|b1
argument_list|,
name|seg
operator|->
name|a1
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|left_load_color_boxes
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
else|else
name|seg
operator|=
name|curr_gradient
operator|->
name|segments
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|right_load_color_boxes
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|seg
operator|->
name|r0
argument_list|,
name|seg
operator|->
name|g0
argument_list|,
name|seg
operator|->
name|b0
argument_list|,
name|seg
operator|->
name|a0
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|right_load_color_boxes
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|)
expr_stmt|;
comment|/* Render Foreground color boxes */
name|ed_fetch_foreground
argument_list|(
operator|&
name|fg_r
argument_list|,
operator|&
name|fg_g
argument_list|,
operator|&
name|fg_b
argument_list|,
operator|&
name|fg_a
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|left_load_color_boxes
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|fg_r
argument_list|,
name|fg_g
argument_list|,
name|fg_b
argument_list|,
name|fg_a
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|right_load_color_boxes
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|fg_r
argument_list|,
name|fg_g
argument_list|,
name|fg_b
argument_list|,
name|fg_a
argument_list|)
expr_stmt|;
comment|/* Render saved color boxes */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRAD_NUM_COLORS
condition|;
name|i
operator|++
control|)
name|cpopup_update_saved_color
argument_list|(
name|i
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
name|i
index|]
operator|.
name|r
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
name|i
index|]
operator|.
name|g
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
name|i
index|]
operator|.
name|b
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
name|i
index|]
operator|.
name|a
argument_list|)
expr_stmt|;
comment|/* Adjust labels */
if|if
condition|(
name|g_editor
operator|->
name|control_sel_l
operator|==
name|g_editor
operator|->
name|control_sel_r
condition|)
block|{
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_blending_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Blending function for segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_coloring_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Coloring type for segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_splitm_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segment at midpoint"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_splitu_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segment uniformly"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_delete_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Delete segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_recenter_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-center segment's midpoint"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_redistribute_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-distribute handles in segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_flip_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Flip segment"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_replicate_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Replicate segment"
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_blending_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Blending function for selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_coloring_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Coloring type for selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_splitm_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segments at midpoints"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_splitu_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Split segments uniformly"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_delete_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Delete selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_recenter_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-center midpoints in selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_redistribute_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Re-distribute handles in selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_flip_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Flip selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|control_replicate_label
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Replicate selection"
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* else */
comment|/* Adjust blending and coloring menus */
name|cpopup_adjust_blending_menu
argument_list|()
expr_stmt|;
name|cpopup_adjust_coloring_menu
argument_list|()
expr_stmt|;
comment|/* Can invoke delete? */
if|if
condition|(
operator|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
operator|==
name|NULL
operator|)
operator|&&
operator|(
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|==
name|NULL
operator|)
condition|)
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_delete_menu_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
else|else
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_delete_menu_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Can invoke blend colors / opacity? */
if|if
condition|(
name|g_editor
operator|->
name|control_sel_l
operator|==
name|g_editor
operator|->
name|control_sel_r
condition|)
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_blend_colors_menu_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_blend_opacity_menu_item
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_blend_colors_menu_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_blend_opacity_menu_item
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* cpopup_adjust_menus */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_adjust_blending_menu (void)
name|cpopup_adjust_blending_menu
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|equal
decl_stmt|;
name|long
name|i
decl_stmt|,
name|num_items
decl_stmt|;
name|int
name|type
decl_stmt|;
name|cpopup_check_selection_params
argument_list|(
operator|&
name|equal
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Block activate signals */
name|num_items
operator|=
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_blending_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|type
operator|=
operator|(
name|int
operator|)
name|g_editor
operator|->
name|control_sel_l
operator|->
name|type
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_block_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|i
argument_list|)
expr_stmt|;
comment|/* Set state */
if|if
condition|(
name|equal
condition|)
block|{
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
name|type
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/* else */
comment|/* Unblock signals */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_unblock_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|i
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_adjust_blending_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_adjust_coloring_menu (void)
name|cpopup_adjust_coloring_menu
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|equal
decl_stmt|;
name|long
name|i
decl_stmt|,
name|num_items
decl_stmt|;
name|int
name|coloring
decl_stmt|;
name|cpopup_check_selection_params
argument_list|(
name|NULL
argument_list|,
operator|&
name|equal
argument_list|)
expr_stmt|;
comment|/* Block activate signals */
name|num_items
operator|=
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|coloring
operator|=
operator|(
name|int
operator|)
name|g_editor
operator|->
name|control_sel_l
operator|->
name|color
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_block_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|i
argument_list|)
expr_stmt|;
comment|/* Set state */
if|if
condition|(
name|equal
condition|)
block|{
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
name|coloring
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_widget_show
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
expr_stmt|;
name|gtk_check_menu_item_set_active
argument_list|(
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
comment|/* else */
comment|/* Unblock signals */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
name|gtk_signal_handler_unblock_by_data
argument_list|(
name|GTK_OBJECT
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
argument_list|)
argument_list|,
operator|(
name|gpointer
operator|)
name|i
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_adjust_coloring_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_check_selection_params (int * equal_blending,int * equal_coloring)
name|cpopup_check_selection_params
parameter_list|(
name|int
modifier|*
name|equal_blending
parameter_list|,
name|int
modifier|*
name|equal_coloring
parameter_list|)
block|{
name|grad_type_t
name|type
decl_stmt|;
name|grad_color_t
name|color
decl_stmt|;
name|int
name|etype
decl_stmt|,
name|ecolor
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|type
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|type
expr_stmt|;
name|color
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|color
expr_stmt|;
name|etype
operator|=
literal|1
expr_stmt|;
name|ecolor
operator|=
literal|1
expr_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|etype
operator|=
name|etype
operator|&&
operator|(
name|seg
operator|->
name|type
operator|==
name|type
operator|)
expr_stmt|;
name|ecolor
operator|=
name|ecolor
operator|&&
operator|(
name|seg
operator|->
name|color
operator|==
name|color
operator|)
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
if|if
condition|(
name|equal_blending
condition|)
operator|*
name|equal_blending
operator|=
name|etype
expr_stmt|;
if|if
condition|(
name|equal_coloring
condition|)
operator|*
name|equal_coloring
operator|=
name|ecolor
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_check_selection_params */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_menu_item_with_label (char * str,GtkWidget ** label)
name|cpopup_create_menu_item_with_label
parameter_list|(
name|char
modifier|*
name|str
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|label
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkWidget
modifier|*
name|accel_label
decl_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|accel_label
operator|=
name|gtk_accel_label_new
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|accel_label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|menuitem
argument_list|)
argument_list|,
name|accel_label
argument_list|)
expr_stmt|;
name|gtk_accel_label_set_accel_widget
argument_list|(
name|GTK_ACCEL_LABEL
argument_list|(
name|accel_label
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|accel_label
argument_list|)
expr_stmt|;
if|if
condition|(
name|label
condition|)
operator|*
name|label
operator|=
name|accel_label
expr_stmt|;
return|return
name|menuitem
return|;
block|}
end_function

begin_comment
comment|/* cpopup_create_menu_item_with_label */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_render_color_box (GtkPreview * preview,double r,double g,double b,double a)
name|cpopup_render_color_box
parameter_list|(
name|GtkPreview
modifier|*
name|preview
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|)
block|{
name|guchar
name|rows
index|[
literal|3
index|]
index|[
name|GRAD_COLOR_BOX_WIDTH
operator|*
literal|3
index|]
decl_stmt|;
name|int
name|x
decl_stmt|,
name|y
decl_stmt|;
name|int
name|r0
decl_stmt|,
name|g0
decl_stmt|,
name|b0
decl_stmt|;
name|int
name|r1
decl_stmt|,
name|g1
decl_stmt|,
name|b1
decl_stmt|;
name|guchar
modifier|*
name|p0
decl_stmt|,
modifier|*
name|p1
decl_stmt|,
modifier|*
name|p2
decl_stmt|;
comment|/* Fill rows */
name|r0
operator|=
operator|(
name|GRAD_CHECK_DARK
operator|+
operator|(
name|r
operator|-
name|GRAD_CHECK_DARK
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|r1
operator|=
operator|(
name|GRAD_CHECK_LIGHT
operator|+
operator|(
name|r
operator|-
name|GRAD_CHECK_LIGHT
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|g0
operator|=
operator|(
name|GRAD_CHECK_DARK
operator|+
operator|(
name|g
operator|-
name|GRAD_CHECK_DARK
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|g1
operator|=
operator|(
name|GRAD_CHECK_LIGHT
operator|+
operator|(
name|g
operator|-
name|GRAD_CHECK_LIGHT
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|b0
operator|=
operator|(
name|GRAD_CHECK_DARK
operator|+
operator|(
name|b
operator|-
name|GRAD_CHECK_DARK
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|b1
operator|=
operator|(
name|GRAD_CHECK_LIGHT
operator|+
operator|(
name|b
operator|-
name|GRAD_CHECK_LIGHT
operator|)
operator|*
name|a
operator|)
operator|*
literal|255.0
expr_stmt|;
name|p0
operator|=
name|rows
index|[
literal|0
index|]
expr_stmt|;
name|p1
operator|=
name|rows
index|[
literal|1
index|]
expr_stmt|;
name|p2
operator|=
name|rows
index|[
literal|2
index|]
expr_stmt|;
for|for
control|(
name|x
operator|=
literal|0
init|;
name|x
operator|<
name|GRAD_COLOR_BOX_WIDTH
condition|;
name|x
operator|++
control|)
block|{
if|if
condition|(
operator|(
name|x
operator|==
literal|0
operator|)
operator|||
operator|(
name|x
operator|==
operator|(
name|GRAD_COLOR_BOX_WIDTH
operator|-
literal|1
operator|)
operator|)
condition|)
block|{
operator|*
name|p0
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
literal|0
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|(
name|x
operator|/
name|GRAD_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
block|{
operator|*
name|p0
operator|++
operator|=
name|r1
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|g1
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|b1
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|r0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|g0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|b0
expr_stmt|;
block|}
else|else
block|{
operator|*
name|p0
operator|++
operator|=
name|r0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|g0
expr_stmt|;
operator|*
name|p0
operator|++
operator|=
name|b0
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|r1
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|g1
expr_stmt|;
operator|*
name|p1
operator|++
operator|=
name|b1
expr_stmt|;
block|}
comment|/* else */
operator|*
name|p2
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p2
operator|++
operator|=
literal|0
expr_stmt|;
operator|*
name|p2
operator|++
operator|=
literal|0
expr_stmt|;
block|}
comment|/* for */
comment|/* Fill preview */
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
for|for
control|(
name|y
operator|=
literal|1
init|;
name|y
operator|<
operator|(
name|GRAD_COLOR_BOX_HEIGHT
operator|-
literal|1
operator|)
condition|;
name|y
operator|++
control|)
if|if
condition|(
operator|(
name|y
operator|/
name|GRAD_CHECK_SIZE
operator|)
operator|&
literal|1
condition|)
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
else|else
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|0
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
name|gtk_preview_draw_row
argument_list|(
name|preview
argument_list|,
name|rows
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|,
name|y
argument_list|,
name|GRAD_COLOR_BOX_WIDTH
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_render_color_box */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_load_menu (GtkWidget ** color_boxes,GtkWidget ** labels,char * label1,char * label2,GtkSignalFunc callback,gchar accel_key_0,guint8 accel_mods_0,gchar accel_key_1,guint8 accel_mods_1,gchar accel_key_2,guint8 accel_mods_2)
name|cpopup_create_load_menu
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|char
modifier|*
name|label1
parameter_list|,
name|char
modifier|*
name|label2
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|,
name|gchar
name|accel_key_0
parameter_list|,
name|guint8
name|accel_mods_0
parameter_list|,
name|gchar
name|accel_key_1
parameter_list|,
name|guint8
name|accel_mods_1
parameter_list|,
name|gchar
name|accel_key_2
parameter_list|,
name|guint8
name|accel_mods_2
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
name|int
name|i
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|accel_group
operator|=
name|g_editor
operator|->
name|accel_group
expr_stmt|;
name|gtk_menu_set_accel_group
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
comment|/* Create items */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
operator|(
name|GRAD_NUM_COLORS
operator|+
literal|3
operator|)
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
literal|3
condition|)
block|{
comment|/* Insert separator between "to fetch" and "saved" colors */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
block|}
comment|/* if */
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|color_boxes
index|[
name|i
index|]
argument_list|,
operator|&
name|labels
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|callback
argument_list|,
call|(
name|gpointer
call|)
argument_list|(
operator|(
name|long
operator|)
name|i
argument_list|)
argument_list|)
expr_stmt|;
comment|/* FIXME: I don't like this cast */
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
name|accel_key_0
argument_list|,
name|accel_mods_0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
name|accel_key_1
argument_list|,
name|accel_mods_1
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
name|accel_key_2
argument_list|,
name|accel_mods_2
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/* switch */
block|}
comment|/* for */
comment|/* Set labels */
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|labels
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|label1
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|labels
index|[
literal|1
index|]
argument_list|)
argument_list|,
name|label2
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|labels
index|[
literal|2
index|]
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"FG color"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_comment
comment|/* cpopup_create_load_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_save_menu (GtkWidget ** color_boxes,GtkWidget ** labels,GtkSignalFunc callback)
name|cpopup_create_save_menu
parameter_list|(
name|GtkWidget
modifier|*
modifier|*
name|color_boxes
parameter_list|,
name|GtkWidget
modifier|*
modifier|*
name|labels
parameter_list|,
name|GtkSignalFunc
name|callback
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|int
name|i
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|GRAD_NUM_COLORS
condition|;
name|i
operator|++
control|)
block|{
name|menuitem
operator|=
name|cpopup_create_color_item
argument_list|(
operator|&
name|color_boxes
index|[
name|i
index|]
argument_list|,
operator|&
name|labels
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
name|callback
argument_list|,
call|(
name|gpointer
call|)
argument_list|(
operator|(
name|long
operator|)
name|i
argument_list|)
argument_list|)
expr_stmt|;
comment|/* FIXME: I don't like this cast */
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
block|}
comment|/* for */
return|return
name|menu
return|;
block|}
end_function

begin_comment
comment|/* cpopup_create_save_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_update_saved_color (int n,double r,double g,double b,double a)
name|cpopup_update_saved_color
parameter_list|(
name|int
name|n
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|)
block|{
name|char
name|str
index|[
literal|256
index|]
decl_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|left_load_color_boxes
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|left_save_color_boxes
index|[
name|n
index|]
argument_list|)
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|right_load_color_boxes
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|cpopup_render_color_box
argument_list|(
name|GTK_PREVIEW
argument_list|(
name|g_editor
operator|->
name|right_save_color_boxes
index|[
name|n
index|]
argument_list|)
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|g_snprintf
argument_list|(
name|str
argument_list|,
sizeof|sizeof
argument_list|(
name|str
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"RGBA (%0.3f, %0.3f, %0.3f, %0.3f)"
argument_list|)
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|left_load_labels
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|left_save_labels
index|[
name|n
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|right_load_labels
index|[
name|n
operator|+
literal|3
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|gtk_label_set
argument_list|(
name|GTK_LABEL
argument_list|(
name|g_editor
operator|->
name|right_save_labels
index|[
name|n
index|]
argument_list|)
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
name|n
index|]
operator|.
name|r
operator|=
name|r
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
name|n
index|]
operator|.
name|g
operator|=
name|g
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
name|n
index|]
operator|.
name|b
operator|=
name|b
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
name|n
index|]
operator|.
name|a
operator|=
name|a
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_update_saved_color */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_load_left_callback (GtkWidget * widget,gpointer data)
name|cpopup_load_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|double
name|fg_r
decl_stmt|,
name|fg_g
decl_stmt|,
name|fg_b
decl_stmt|;
name|double
name|fg_a
decl_stmt|;
switch|switch
condition|(
operator|(
name|long
operator|)
name|data
condition|)
block|{
case|case
literal|0
case|:
comment|/* Fetch from left neighbor's right endpoint */
if|if
condition|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
else|else
name|seg
operator|=
name|seg_get_last_segment
argument_list|(
name|g_editor
operator|->
name|control_sel_l
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|seg
operator|->
name|r1
argument_list|,
name|seg
operator|->
name|g1
argument_list|,
name|seg
operator|->
name|b1
argument_list|,
name|seg
operator|->
name|a1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|/* Fetch from right endpoint */
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* Fetch from FG color */
name|ed_fetch_foreground
argument_list|(
operator|&
name|fg_r
argument_list|,
operator|&
name|fg_g
argument_list|,
operator|&
name|fg_b
argument_list|,
operator|&
name|fg_a
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|fg_r
argument_list|,
name|fg_g
argument_list|,
name|fg_b
argument_list|,
name|fg_a
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Load a color */
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|r
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|g
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|b
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|a
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* switch */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_load_left_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_save_left_callback (GtkWidget * widget,gpointer data)
name|cpopup_save_left_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|r
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|g
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|b
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|a
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_save_left_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_load_right_callback (GtkWidget * widget,gpointer data)
name|cpopup_load_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|double
name|fg_r
decl_stmt|,
name|fg_g
decl_stmt|,
name|fg_b
decl_stmt|;
name|double
name|fg_a
decl_stmt|;
switch|switch
condition|(
operator|(
name|long
operator|)
name|data
condition|)
block|{
case|case
literal|0
case|:
comment|/* Fetch from right neighbor's left endpoint */
if|if
condition|(
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|!=
name|NULL
condition|)
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
else|else
name|seg
operator|=
name|curr_gradient
operator|->
name|segments
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a0
argument_list|,
name|seg
operator|->
name|r0
argument_list|,
name|seg
operator|->
name|g0
argument_list|,
name|seg
operator|->
name|b0
argument_list|,
name|seg
operator|->
name|a0
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|/* Fetch from left endpoint */
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* Fetch from FG color */
name|ed_fetch_foreground
argument_list|(
operator|&
name|fg_r
argument_list|,
operator|&
name|fg_g
argument_list|,
operator|&
name|fg_b
argument_list|,
operator|&
name|fg_a
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|fg_r
argument_list|,
name|fg_g
argument_list|,
name|fg_b
argument_list|,
name|fg_a
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
default|default:
comment|/* Load a color */
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|r
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|g
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|b
argument_list|,
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
operator|-
literal|3
index|]
operator|.
name|a
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
break|break;
block|}
comment|/* switch */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_load_right_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_save_right_callback (GtkWidget * widget,gpointer data)
name|cpopup_save_right_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|r
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|g
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|b
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
expr_stmt|;
name|g_editor
operator|->
name|saved_colors
index|[
operator|(
name|long
operator|)
name|data
index|]
operator|.
name|a
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_save_right_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_blending_menu (void)
name|cpopup_create_blending_menu
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|num_items
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|group
operator|=
name|NULL
expr_stmt|;
name|num_items
operator|=
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_blending_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
operator|(
name|num_items
operator|-
literal|1
operator|)
condition|)
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"(Varies)"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|gettext
argument_list|(
name|blending_types
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_menu_item_group
argument_list|(
name|GTK_RADIO_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_blending_callback
argument_list|,
call|(
name|gpointer
call|)
argument_list|(
operator|(
name|long
operator|)
name|i
argument_list|)
argument_list|)
expr_stmt|;
comment|/* FIXME: I don't like this cast */
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_blending_items
index|[
name|i
index|]
operator|=
name|menuitem
expr_stmt|;
block|}
comment|/* for */
comment|/* "Varies" is always disabled */
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_blending_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_comment
comment|/* cpopup_create_blending_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_blending_callback (GtkWidget * widget,gpointer data)
name|cpopup_blending_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_type_t
name|type
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
if|if
condition|(
operator|!
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
return|return;
comment|/* Do nothing if the menu item is being deactivated */
name|type
operator|=
operator|(
name|grad_type_t
operator|)
name|data
expr_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|type
operator|=
name|type
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_blending_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_coloring_menu (void)
name|cpopup_create_coloring_menu
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GSList
modifier|*
name|group
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|num_items
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|group
operator|=
name|NULL
expr_stmt|;
name|num_items
operator|=
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_items
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|i
operator|==
operator|(
name|num_items
operator|-
literal|1
operator|)
condition|)
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|_
argument_list|(
literal|"(Varies)"
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|menuitem
operator|=
name|gtk_radio_menu_item_new_with_label
argument_list|(
name|group
argument_list|,
name|gettext
argument_list|(
name|coloring_types
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|=
name|gtk_radio_menu_item_group
argument_list|(
name|GTK_RADIO_MENU_ITEM
argument_list|(
name|menuitem
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_coloring_callback
argument_list|,
call|(
name|gpointer
call|)
argument_list|(
operator|(
name|long
operator|)
name|i
argument_list|)
argument_list|)
expr_stmt|;
comment|/* FIXME: I don't like this cast */
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_coloring_items
index|[
name|i
index|]
operator|=
name|menuitem
expr_stmt|;
block|}
comment|/* for */
comment|/* "Varies" is always disabled */
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|control_coloring_items
index|[
name|num_items
operator|-
literal|1
index|]
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_comment
comment|/* cpopup_create_coloring_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_coloring_callback (GtkWidget * widget,gpointer data)
name|cpopup_coloring_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_color_t
name|color
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
if|if
condition|(
operator|!
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|widget
argument_list|)
operator|->
name|active
condition|)
return|return;
comment|/* Do nothing if the menu item is being deactivated */
name|color
operator|=
operator|(
name|grad_color_t
operator|)
name|data
expr_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|color
operator|=
name|color
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_coloring_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|cpopup_create_sel_ops_menu (void)
name|cpopup_create_sel_ops_menu
parameter_list|(
name|void
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|menuitem
decl_stmt|;
name|GtkAccelGroup
modifier|*
name|accel_group
decl_stmt|;
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|accel_group
operator|=
name|g_editor
operator|->
name|accel_group
expr_stmt|;
name|gtk_menu_set_accel_group
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|accel_group
argument_list|)
expr_stmt|;
comment|/* Flip */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_flip_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_flip_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'F'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Replicate */
name|menuitem
operator|=
name|cpopup_create_menu_item_with_label
argument_list|(
literal|""
argument_list|,
operator|&
name|g_editor
operator|->
name|control_replicate_label
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_replicate_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'M'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
comment|/* Blend colors / opacity */
name|menuitem
operator|=
name|gtk_menu_item_new
argument_list|()
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Blend endpoints' colors"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_blend_colors
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_blend_colors_menu_item
operator|=
name|menuitem
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'B'
argument_list|,
literal|0
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|menuitem
operator|=
name|gtk_menu_item_new_with_label
argument_list|(
name|_
argument_list|(
literal|"Blend endpoints' opacity"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|menuitem
argument_list|)
argument_list|,
literal|"activate"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_blend_opacity
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_menu_append
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|menuitem
argument_list|)
expr_stmt|;
name|gtk_widget_add_accelerator
argument_list|(
name|menuitem
argument_list|,
literal|"activate"
argument_list|,
name|accel_group
argument_list|,
literal|'B'
argument_list|,
name|GDK_CONTROL_MASK
argument_list|,
name|GTK_ACCEL_VISIBLE
operator||
name|GTK_ACCEL_LOCKED
argument_list|)
expr_stmt|;
name|g_editor
operator|->
name|control_blend_opacity_menu_item
operator|=
name|menuitem
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function

begin_comment
comment|/* cpopup_create_sel_ops_menu */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_blend_colors (GtkWidget * widget,gpointer data)
name|cpopup_blend_colors
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_blend_colors */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_blend_opacity (GtkWidget * widget,gpointer data)
name|cpopup_blend_opacity
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_blend_opacity */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_set_color_selection_color (GtkColorSelection * cs,double r,double g,double b,double a)
name|cpopup_set_color_selection_color
parameter_list|(
name|GtkColorSelection
modifier|*
name|cs
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|)
block|{
name|gdouble
name|color
index|[
literal|4
index|]
decl_stmt|;
name|color
index|[
literal|0
index|]
operator|=
name|r
expr_stmt|;
name|color
index|[
literal|1
index|]
operator|=
name|g
expr_stmt|;
name|color
index|[
literal|2
index|]
operator|=
name|b
expr_stmt|;
name|color
index|[
literal|3
index|]
operator|=
name|a
expr_stmt|;
name|gtk_color_selection_set_color
argument_list|(
name|cs
argument_list|,
name|color
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_set_color_selection_color */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_get_color_selection_color (GtkColorSelection * cs,double * r,double * g,double * b,double * a)
name|cpopup_get_color_selection_color
parameter_list|(
name|GtkColorSelection
modifier|*
name|cs
parameter_list|,
name|double
modifier|*
name|r
parameter_list|,
name|double
modifier|*
name|g
parameter_list|,
name|double
modifier|*
name|b
parameter_list|,
name|double
modifier|*
name|a
parameter_list|)
block|{
name|gdouble
name|color
index|[
literal|4
index|]
decl_stmt|;
name|gtk_color_selection_get_color
argument_list|(
name|cs
argument_list|,
name|color
argument_list|)
expr_stmt|;
operator|*
name|r
operator|=
name|color
index|[
literal|0
index|]
expr_stmt|;
operator|*
name|g
operator|=
name|color
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|b
operator|=
name|color
index|[
literal|2
index|]
expr_stmt|;
operator|*
name|a
operator|=
name|color
index|[
literal|3
index|]
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_get_color_selection_color */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_create_color_dialog (char * title,double r,double g,double b,double a,GtkSignalFunc color_changed_callback,GtkSignalFunc ok_callback,GtkSignalFunc cancel_callback,GtkSignalFunc delete_callback)
name|cpopup_create_color_dialog
parameter_list|(
name|char
modifier|*
name|title
parameter_list|,
name|double
name|r
parameter_list|,
name|double
name|g
parameter_list|,
name|double
name|b
parameter_list|,
name|double
name|a
parameter_list|,
name|GtkSignalFunc
name|color_changed_callback
parameter_list|,
name|GtkSignalFunc
name|ok_callback
parameter_list|,
name|GtkSignalFunc
name|cancel_callback
parameter_list|,
name|GtkSignalFunc
name|delete_callback
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|window
decl_stmt|;
name|GtkColorSelection
modifier|*
name|cs
decl_stmt|;
name|GtkColorSelectionDialog
modifier|*
name|csd
decl_stmt|;
name|window
operator|=
name|gtk_color_selection_dialog_new
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|csd
operator|=
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|cs
operator|=
name|GTK_COLOR_SELECTION
argument_list|(
name|csd
operator|->
name|colorsel
argument_list|)
expr_stmt|;
name|gtk_color_selection_set_opacity
argument_list|(
name|cs
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_color_selection_set_update_policy
argument_list|(
name|cs
argument_list|,
name|g_editor
operator|->
name|instant_update
condition|?
name|GTK_UPDATE_CONTINUOUS
else|:
name|GTK_UPDATE_DELAYED
argument_list|)
expr_stmt|;
comment|/* FIXME: this is a hack; we set the color twice so that the          * color selector remembers it as its "old" color, too 	 */
name|cpopup_set_color_selection_color
argument_list|(
name|cs
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|cpopup_set_color_selection_color
argument_list|(
name|cs
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|csd
argument_list|)
argument_list|,
literal|"delete_event"
argument_list|,
name|delete_callback
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|cs
argument_list|)
argument_list|,
literal|"color_changed"
argument_list|,
name|color_changed_callback
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|csd
operator|->
name|ok_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|ok_callback
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|GTK_OBJECT
argument_list|(
name|csd
operator|->
name|cancel_button
argument_list|)
argument_list|,
literal|"clicked"
argument_list|,
name|cancel_callback
argument_list|,
name|window
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|window
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|window
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_create_color_dialog */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|grad_segment_t
modifier|*
DECL|function|cpopup_save_selection (void)
name|cpopup_save_selection
parameter_list|(
name|void
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|prev
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|grad_segment_t
modifier|*
name|oseg
decl_stmt|,
modifier|*
name|oaseg
decl_stmt|;
name|prev
operator|=
name|NULL
expr_stmt|;
name|oseg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
do|do
block|{
name|seg
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
operator|*
name|seg
operator|=
operator|*
name|oseg
expr_stmt|;
comment|/* Copy everything */
if|if
condition|(
name|prev
operator|==
name|NULL
condition|)
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
else|else
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
name|oaseg
operator|=
name|oseg
expr_stmt|;
name|oseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
return|return
name|tmp
return|;
block|}
end_function

begin_comment
comment|/* cpopup_save_selection */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_free_selection (grad_segment_t * seg)
name|cpopup_free_selection
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
block|{
name|seg_free_segments
argument_list|(
name|seg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_free_selection */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_replace_selection (grad_segment_t * replace_seg)
name|cpopup_replace_selection
parameter_list|(
name|grad_segment_t
modifier|*
name|replace_seg
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|grad_segment_t
modifier|*
name|replace_last
decl_stmt|;
comment|/* Remember left and right segments */
name|lseg
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
name|replace_last
operator|=
name|seg_get_last_segment
argument_list|(
name|replace_seg
argument_list|)
expr_stmt|;
comment|/* Free old selection */
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
name|seg_free_segments
argument_list|(
name|g_editor
operator|->
name|control_sel_l
argument_list|)
expr_stmt|;
comment|/* Link in new segments */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|replace_seg
expr_stmt|;
else|else
name|curr_gradient
operator|->
name|segments
operator|=
name|replace_seg
expr_stmt|;
name|replace_seg
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|replace_last
expr_stmt|;
name|replace_last
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
name|g_editor
operator|->
name|control_sel_l
operator|=
name|replace_seg
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|replace_last
expr_stmt|;
name|curr_gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
block|}
end_function

begin_comment
comment|/* cpopup_replace_selection */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_set_left_color_callback (GtkWidget * widget,gpointer data)
name|cpopup_set_left_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_editor
operator|->
name|left_saved_dirty
operator|=
name|curr_gradient
operator|->
name|dirty
expr_stmt|;
name|g_editor
operator|->
name|left_saved_segments
operator|=
name|cpopup_save_selection
argument_list|()
expr_stmt|;
name|cpopup_create_color_dialog
argument_list|(
name|_
argument_list|(
literal|"Left endpoint's color"
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_left_color_changed
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_left_color_dialog_ok
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_left_color_dialog_cancel
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_left_color_dialog_delete
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_set_left_color_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_left_color_changed (GtkWidget * widget,gpointer client_data)
name|cpopup_left_color_changed
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkColorSelection
modifier|*
name|cs
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|cs
operator|=
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|client_data
argument_list|)
operator|->
name|colorsel
argument_list|)
expr_stmt|;
name|cpopup_get_color_selection_color
argument_list|(
name|cs
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_left_color_changed */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_left_color_dialog_ok (GtkWidget * widget,gpointer client_data)
name|cpopup_left_color_dialog_ok
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkColorSelection
modifier|*
name|cs
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|cs
operator|=
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|client_data
argument_list|)
operator|->
name|colorsel
argument_list|)
expr_stmt|;
name|cpopup_get_color_selection_color
argument_list|(
name|cs
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|cpopup_free_selection
argument_list|(
name|g_editor
operator|->
name|left_saved_segments
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_left_color_dialog_ok */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_left_color_dialog_cancel (GtkWidget * widget,gpointer client_data)
name|cpopup_left_color_dialog_cancel
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|curr_gradient
operator|->
name|dirty
operator|=
name|g_editor
operator|->
name|left_saved_dirty
expr_stmt|;
name|cpopup_replace_selection
argument_list|(
name|g_editor
operator|->
name|left_saved_segments
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_left_color_dialog_cancel */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|int
DECL|function|cpopup_left_color_dialog_delete (GtkWidget * widget,GdkEvent * event,gpointer data)
name|cpopup_left_color_dialog_delete
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|curr_gradient
operator|->
name|dirty
operator|=
name|g_editor
operator|->
name|left_saved_dirty
expr_stmt|;
name|cpopup_replace_selection
argument_list|(
name|g_editor
operator|->
name|left_saved_segments
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* cpopup_left_color_dialog_delete */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_set_right_color_callback (GtkWidget * widget,gpointer data)
name|cpopup_set_right_color_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_editor
operator|->
name|right_saved_dirty
operator|=
name|curr_gradient
operator|->
name|dirty
expr_stmt|;
name|g_editor
operator|->
name|right_saved_segments
operator|=
name|cpopup_save_selection
argument_list|()
expr_stmt|;
name|cpopup_create_color_dialog
argument_list|(
name|_
argument_list|(
literal|"Right endpoint's color"
argument_list|)
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|r1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|g1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|b1
argument_list|,
name|g_editor
operator|->
name|control_sel_r
operator|->
name|a1
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_right_color_changed
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_right_color_dialog_ok
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_right_color_dialog_cancel
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_right_color_dialog_delete
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_set_right_color_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_right_color_changed (GtkWidget * widget,gpointer client_data)
name|cpopup_right_color_changed
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkColorSelection
modifier|*
name|cs
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|cs
operator|=
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|client_data
argument_list|)
operator|->
name|colorsel
argument_list|)
expr_stmt|;
name|cpopup_get_color_selection_color
argument_list|(
name|cs
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_right_color_changed */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_right_color_dialog_ok (GtkWidget * widget,gpointer client_data)
name|cpopup_right_color_dialog_ok
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|GtkColorSelection
modifier|*
name|cs
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|cs
operator|=
name|GTK_COLOR_SELECTION
argument_list|(
name|GTK_COLOR_SELECTION_DIALOG
argument_list|(
name|client_data
argument_list|)
operator|->
name|colorsel
argument_list|)
expr_stmt|;
name|cpopup_get_color_selection_color
argument_list|(
name|cs
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
name|cpopup_blend_endpoints
argument_list|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|r0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|g0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|b0
argument_list|,
name|g_editor
operator|->
name|control_sel_l
operator|->
name|a0
argument_list|,
name|r
argument_list|,
name|g
argument_list|,
name|b
argument_list|,
name|a
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|cpopup_free_selection
argument_list|(
name|g_editor
operator|->
name|right_saved_segments
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_right_color_dialog_ok */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_right_color_dialog_cancel (GtkWidget * widget,gpointer client_data)
name|cpopup_right_color_dialog_cancel
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|curr_gradient
operator|->
name|dirty
operator|=
name|g_editor
operator|->
name|right_saved_dirty
expr_stmt|;
name|cpopup_replace_selection
argument_list|(
name|g_editor
operator|->
name|right_saved_segments
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_right_color_dialog_cancel */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|int
DECL|function|cpopup_right_color_dialog_delete (GtkWidget * widget,GdkEvent * event,gpointer data)
name|cpopup_right_color_dialog_delete
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|curr_gradient
operator|->
name|dirty
operator|=
name|g_editor
operator|->
name|right_saved_dirty
expr_stmt|;
name|cpopup_replace_selection
argument_list|(
name|g_editor
operator|->
name|right_saved_segments
argument_list|)
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/* cpopup_right_color_dialog_delete */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_midpoint_callback (GtkWidget * widget,gpointer data)
name|cpopup_split_midpoint_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|cpopup_split_midpoint
argument_list|(
name|seg
argument_list|,
operator|&
name|lseg
argument_list|,
operator|&
name|rseg
argument_list|)
expr_stmt|;
name|seg
operator|=
name|rseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|lseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|rseg
expr_stmt|;
name|curr_gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_split_midpoint_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_callback (GtkWidget * widget,gpointer data)
name|cpopup_split_uniform_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkObject
modifier|*
name|scale_data
decl_stmt|;
comment|/* Create dialog window */
name|dialog
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
operator|(
name|g_editor
operator|->
name|control_sel_l
operator|==
name|g_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"Split segment uniformly"
argument_list|)
else|:
name|_
argument_list|(
literal|"Split segments uniformly"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Instructions */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Please select the number of uniform parts"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
operator|(
name|g_editor
operator|->
name|control_sel_l
operator|==
name|g_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"in which you want to split the selected segment"
argument_list|)
else|:
name|_
argument_list|(
literal|"in which you want to split the segments in the selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* Scale */
name|g_editor
operator|->
name|split_parts
operator|=
literal|2
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|2.0
argument_list|,
literal|2.0
argument_list|,
literal|21.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|scale
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|scale_data
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_split_uniform_scale_update
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Buttons */
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Split"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_split_uniform_split_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_split_uniform_cancel_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Show! */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_split_uniform_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_delete_callback (GtkWidget * widget,gpointer data)
name|cpopup_delete_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|,
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|,
modifier|*
name|next
decl_stmt|;
name|double
name|join
decl_stmt|;
comment|/* Remember segments to the left and to the right of the selection */
name|lseg
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
comment|/* Cannot delete all the segments in the gradient */
if|if
condition|(
operator|(
name|lseg
operator|==
name|NULL
operator|)
operator|&&
operator|(
name|rseg
operator|==
name|NULL
operator|)
condition|)
return|return;
comment|/* Calculate join point */
name|join
operator|=
operator|(
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
operator|+
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
if|if
condition|(
name|lseg
operator|==
name|NULL
condition|)
name|join
operator|=
literal|0.0
expr_stmt|;
elseif|else
if|if
condition|(
name|rseg
operator|==
name|NULL
condition|)
name|join
operator|=
literal|1.0
expr_stmt|;
comment|/* Move segments */
if|if
condition|(
name|lseg
operator|!=
name|NULL
condition|)
name|control_compress_range
argument_list|(
name|lseg
argument_list|,
name|lseg
argument_list|,
name|lseg
operator|->
name|left
argument_list|,
name|join
argument_list|)
expr_stmt|;
if|if
condition|(
name|rseg
operator|!=
name|NULL
condition|)
name|control_compress_range
argument_list|(
name|rseg
argument_list|,
name|rseg
argument_list|,
name|join
argument_list|,
name|rseg
operator|->
name|right
argument_list|)
expr_stmt|;
comment|/* Link */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
comment|/* Delete old segments */
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|next
operator|=
name|seg
operator|->
name|next
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg_free_segment
argument_list|(
name|seg
argument_list|)
expr_stmt|;
name|seg
operator|=
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
comment|/* Change selection */
if|if
condition|(
name|rseg
condition|)
block|{
name|g_editor
operator|->
name|control_sel_l
operator|=
name|rseg
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|rseg
expr_stmt|;
block|}
else|else
block|{
name|g_editor
operator|->
name|control_sel_l
operator|=
name|lseg
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|lseg
expr_stmt|;
block|}
comment|/* else */
if|if
condition|(
name|lseg
operator|==
name|NULL
condition|)
name|curr_gradient
operator|->
name|segments
operator|=
name|rseg
expr_stmt|;
comment|/* Done */
name|curr_gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_delete_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_recenter_callback (GtkWidget * wiodget,gpointer data)
name|cpopup_recenter_callback
parameter_list|(
name|GtkWidget
modifier|*
name|wiodget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|->
name|middle
operator|=
operator|(
name|seg
operator|->
name|left
operator|+
name|seg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_recenter_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_redistribute_callback (GtkWidget * widget,gpointer data)
name|cpopup_redistribute_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|double
name|left
decl_stmt|,
name|right
decl_stmt|,
name|seg_len
decl_stmt|;
name|int
name|num_segs
decl_stmt|;
name|int
name|i
decl_stmt|;
comment|/* Count number of segments in selection */
name|num_segs
operator|=
literal|0
expr_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|num_segs
operator|++
expr_stmt|;
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
comment|/* Calculate new segment length */
name|left
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|right
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
expr_stmt|;
name|seg_len
operator|=
operator|(
name|right
operator|-
name|left
operator|)
operator|/
name|num_segs
expr_stmt|;
comment|/* Redistribute */
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_segs
condition|;
name|i
operator|++
control|)
block|{
name|seg
operator|->
name|left
operator|=
name|left
operator|+
name|i
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|left
operator|+
operator|(
name|i
operator|+
literal|1
operator|)
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
operator|(
name|seg
operator|->
name|left
operator|+
name|seg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* for */
comment|/* Fix endpoints to squish accumulative error */
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
operator|=
name|left
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|=
name|right
expr_stmt|;
comment|/* Done */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_redistribute_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_flip_callback (GtkWidget * widget,gpointer data)
name|cpopup_flip_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|oseg
decl_stmt|,
modifier|*
name|oaseg
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|prev
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|grad_segment_t
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|double
name|left
decl_stmt|,
name|right
decl_stmt|;
name|left
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|right
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
expr_stmt|;
comment|/* Build flipped segments */
name|prev
operator|=
name|NULL
expr_stmt|;
name|oseg
operator|=
name|g_editor
operator|->
name|control_sel_r
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
do|do
block|{
name|seg
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
if|if
condition|(
name|prev
operator|==
name|NULL
condition|)
block|{
name|seg
operator|->
name|left
operator|=
name|left
expr_stmt|;
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
block|}
else|else
name|seg
operator|->
name|left
operator|=
name|left
operator|+
name|right
operator|-
name|oseg
operator|->
name|right
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|left
operator|+
name|right
operator|-
name|oseg
operator|->
name|middle
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|left
operator|+
name|right
operator|-
name|oseg
operator|->
name|left
expr_stmt|;
name|seg
operator|->
name|r0
operator|=
name|oseg
operator|->
name|r1
expr_stmt|;
name|seg
operator|->
name|g0
operator|=
name|oseg
operator|->
name|g1
expr_stmt|;
name|seg
operator|->
name|b0
operator|=
name|oseg
operator|->
name|b1
expr_stmt|;
name|seg
operator|->
name|a0
operator|=
name|oseg
operator|->
name|a1
expr_stmt|;
name|seg
operator|->
name|r1
operator|=
name|oseg
operator|->
name|r0
expr_stmt|;
name|seg
operator|->
name|g1
operator|=
name|oseg
operator|->
name|g0
expr_stmt|;
name|seg
operator|->
name|b1
operator|=
name|oseg
operator|->
name|b0
expr_stmt|;
name|seg
operator|->
name|a1
operator|=
name|oseg
operator|->
name|a0
expr_stmt|;
switch|switch
condition|(
name|oseg
operator|->
name|type
condition|)
block|{
case|case
name|GRAD_SPHERE_INCREASING
case|:
name|seg
operator|->
name|type
operator|=
name|GRAD_SPHERE_DECREASING
expr_stmt|;
break|break;
case|case
name|GRAD_SPHERE_DECREASING
case|:
name|seg
operator|->
name|type
operator|=
name|GRAD_SPHERE_INCREASING
expr_stmt|;
break|break;
default|default:
name|seg
operator|->
name|type
operator|=
name|oseg
operator|->
name|type
expr_stmt|;
block|}
comment|/* switch */
switch|switch
condition|(
name|oseg
operator|->
name|color
condition|)
block|{
case|case
name|GRAD_HSV_CCW
case|:
name|seg
operator|->
name|color
operator|=
name|GRAD_HSV_CW
expr_stmt|;
break|break;
case|case
name|GRAD_HSV_CW
case|:
name|seg
operator|->
name|color
operator|=
name|GRAD_HSV_CCW
expr_stmt|;
break|break;
default|default:
name|seg
operator|->
name|color
operator|=
name|oseg
operator|->
name|color
expr_stmt|;
block|}
comment|/* switch */
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
name|oaseg
operator|=
name|oseg
expr_stmt|;
name|oseg
operator|=
name|oseg
operator|->
name|prev
expr_stmt|;
comment|/* Move backwards! */
block|}
do|while
condition|(
name|oaseg
operator|!=
name|g_editor
operator|->
name|control_sel_l
condition|)
do|;
name|seg
operator|->
name|right
operator|=
name|right
expr_stmt|;
comment|/* Squish accumulative error */
comment|/* Free old segments */
name|lseg
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
name|oseg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|oaseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
name|seg_free_segment
argument_list|(
name|oseg
argument_list|)
expr_stmt|;
name|oseg
operator|=
name|oaseg
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|rseg
condition|)
do|;
comment|/* Link in new segments */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|tmp
expr_stmt|;
else|else
name|curr_gradient
operator|->
name|segments
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|seg
expr_stmt|;
comment|/* Reset selection */
name|g_editor
operator|->
name|control_sel_l
operator|=
name|tmp
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
comment|/* Done */
name|curr_gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_flip_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_replicate_callback (GtkWidget * widget,gpointer data)
name|cpopup_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|GtkWidget
modifier|*
name|dialog
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkObject
modifier|*
name|scale_data
decl_stmt|;
comment|/* Create dialog window */
name|dialog
operator|=
name|gtk_dialog_new
argument_list|()
expr_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
operator|(
name|g_editor
operator|->
name|control_sel_l
operator|==
name|g_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"Replicate segment"
argument_list|)
else|:
name|_
argument_list|(
literal|"Replicate selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_window_position
argument_list|(
name|GTK_WINDOW
argument_list|(
name|dialog
argument_list|)
argument_list|,
name|GTK_WIN_POS_MOUSE
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|dialog
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|vbox
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_container_border_width
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|vbox
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|vbox
argument_list|)
argument_list|,
name|vbox
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* Instructions */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|_
argument_list|(
literal|"Please select the number of times"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
operator|(
name|g_editor
operator|->
name|control_sel_l
operator|==
name|g_editor
operator|->
name|control_sel_r
operator|)
condition|?
name|_
argument_list|(
literal|"you want to replicate the selected segment"
argument_list|)
else|:
name|_
argument_list|(
literal|"you want to replicate the selection"
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_misc_set_alignment
argument_list|(
name|GTK_MISC
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* Scale */
name|g_editor
operator|->
name|replicate_times
operator|=
literal|2
expr_stmt|;
name|scale_data
operator|=
name|gtk_adjustment_new
argument_list|(
literal|2.0
argument_list|,
literal|2.0
argument_list|,
literal|21.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|gtk_hscale_new
argument_list|(
name|GTK_ADJUSTMENT
argument_list|(
name|scale_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_scale_set_digits
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_scale_set_value_pos
argument_list|(
name|GTK_SCALE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_POS_TOP
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|scale
argument_list|,
name|FALSE
argument_list|,
name|TRUE
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_signal_connect
argument_list|(
name|scale_data
argument_list|,
literal|"value_changed"
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_replicate_scale_update
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* Buttons */
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Replicate"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_do_replicate_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_grab_default
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|button
operator|=
name|ed_create_button
argument_list|(
name|_
argument_list|(
literal|"Cancel"
argument_list|)
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|,
operator|(
name|GtkSignalFunc
operator|)
name|cpopup_replicate_cancel_callback
argument_list|,
operator|(
name|gpointer
operator|)
name|dialog
argument_list|)
expr_stmt|;
name|GTK_WIDGET_SET_FLAGS
argument_list|(
name|button
argument_list|,
name|GTK_CAN_DEFAULT
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|GTK_DIALOG
argument_list|(
name|dialog
argument_list|)
operator|->
name|action_area
argument_list|)
argument_list|,
name|button
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* Show! */
name|gtk_widget_show
argument_list|(
name|dialog
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_replicate_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_scale_update (GtkAdjustment * adjustment,gpointer data)
name|cpopup_split_uniform_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_editor
operator|->
name|split_parts
operator|=
call|(
name|int
call|)
argument_list|(
name|adjustment
operator|->
name|value
operator|+
literal|0.5
argument_list|)
expr_stmt|;
comment|/* We have to round */
block|}
end_function

begin_comment
comment|/* cpopup_split_uniform_scale_update */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_split_callback (GtkWidget * widget,gpointer client_data)
name|cpopup_split_uniform_split_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|,
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|,
modifier|*
name|lsel
decl_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
name|lsel
operator|=
name|NULL
expr_stmt|;
do|do
block|{
name|aseg
operator|=
name|seg
expr_stmt|;
name|cpopup_split_uniform
argument_list|(
name|seg
argument_list|,
name|g_editor
operator|->
name|split_parts
argument_list|,
operator|&
name|lseg
argument_list|,
operator|&
name|rseg
argument_list|)
expr_stmt|;
if|if
condition|(
name|seg
operator|==
name|g_editor
operator|->
name|control_sel_l
condition|)
name|lsel
operator|=
name|lseg
expr_stmt|;
name|seg
operator|=
name|rseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
name|g_editor
operator|->
name|control_sel_l
operator|=
name|lsel
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|rseg
expr_stmt|;
name|curr_gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_split_uniform_split_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform_cancel_callback (GtkWidget * widget,gpointer client_data)
name|cpopup_split_uniform_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_split_uniform_cancel_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_replicate_scale_update (GtkAdjustment * adjustment,gpointer data)
name|cpopup_replicate_scale_update
parameter_list|(
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|,
name|gpointer
name|data
parameter_list|)
block|{
name|g_editor
operator|->
name|replicate_times
operator|=
call|(
name|int
call|)
argument_list|(
name|adjustment
operator|->
name|value
operator|+
literal|0.5
argument_list|)
expr_stmt|;
comment|/* We have to round */
block|}
end_function

begin_comment
comment|/* cpopup_replicate_scale_update */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_do_replicate_callback (GtkWidget * widget,gpointer client_data)
name|cpopup_do_replicate_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|double
name|sel_left
decl_stmt|,
name|sel_right
decl_stmt|,
name|sel_len
decl_stmt|;
name|double
name|new_left
decl_stmt|;
name|double
name|factor
decl_stmt|;
name|grad_segment_t
modifier|*
name|prev
decl_stmt|,
modifier|*
name|seg
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|grad_segment_t
modifier|*
name|oseg
decl_stmt|,
modifier|*
name|oaseg
decl_stmt|;
name|grad_segment_t
modifier|*
name|lseg
decl_stmt|,
modifier|*
name|rseg
decl_stmt|;
name|int
name|i
decl_stmt|;
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Remember original parameters */
name|sel_left
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|sel_right
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
expr_stmt|;
name|sel_len
operator|=
name|sel_right
operator|-
name|sel_left
expr_stmt|;
name|factor
operator|=
literal|1.0
operator|/
name|g_editor
operator|->
name|replicate_times
expr_stmt|;
comment|/* Build replicated segments */
name|prev
operator|=
name|NULL
expr_stmt|;
name|seg
operator|=
name|NULL
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|g_editor
operator|->
name|replicate_times
condition|;
name|i
operator|++
control|)
block|{
comment|/* Build one cycle */
name|new_left
operator|=
name|sel_left
operator|+
name|i
operator|*
name|factor
operator|*
name|sel_len
expr_stmt|;
name|oseg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|seg
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
if|if
condition|(
name|prev
operator|==
name|NULL
condition|)
block|{
name|seg
operator|->
name|left
operator|=
name|sel_left
expr_stmt|;
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
block|}
else|else
name|seg
operator|->
name|left
operator|=
name|new_left
operator|+
name|factor
operator|*
operator|(
name|oseg
operator|->
name|left
operator|-
name|sel_left
operator|)
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
name|new_left
operator|+
name|factor
operator|*
operator|(
name|oseg
operator|->
name|middle
operator|-
name|sel_left
operator|)
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|new_left
operator|+
name|factor
operator|*
operator|(
name|oseg
operator|->
name|right
operator|-
name|sel_left
operator|)
expr_stmt|;
name|seg
operator|->
name|r0
operator|=
name|oseg
operator|->
name|r0
expr_stmt|;
name|seg
operator|->
name|g0
operator|=
name|oseg
operator|->
name|g0
expr_stmt|;
name|seg
operator|->
name|b0
operator|=
name|oseg
operator|->
name|b0
expr_stmt|;
name|seg
operator|->
name|a0
operator|=
name|oseg
operator|->
name|a0
expr_stmt|;
name|seg
operator|->
name|r1
operator|=
name|oseg
operator|->
name|r1
expr_stmt|;
name|seg
operator|->
name|g1
operator|=
name|oseg
operator|->
name|g1
expr_stmt|;
name|seg
operator|->
name|b1
operator|=
name|oseg
operator|->
name|b1
expr_stmt|;
name|seg
operator|->
name|a1
operator|=
name|oseg
operator|->
name|a1
expr_stmt|;
name|seg
operator|->
name|type
operator|=
name|oseg
operator|->
name|type
expr_stmt|;
name|seg
operator|->
name|color
operator|=
name|oseg
operator|->
name|color
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
name|oaseg
operator|=
name|oseg
expr_stmt|;
name|oseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
block|}
comment|/* for */
name|seg
operator|->
name|right
operator|=
name|sel_right
expr_stmt|;
comment|/* Squish accumulative error */
comment|/* Free old segments */
name|lseg
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|prev
expr_stmt|;
name|rseg
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|next
expr_stmt|;
name|oseg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
name|oaseg
operator|=
name|oseg
operator|->
name|next
expr_stmt|;
name|seg_free_segment
argument_list|(
name|oseg
argument_list|)
expr_stmt|;
name|oseg
operator|=
name|oaseg
expr_stmt|;
block|}
do|while
condition|(
name|oaseg
operator|!=
name|rseg
condition|)
do|;
comment|/* Link in new segments */
if|if
condition|(
name|lseg
condition|)
name|lseg
operator|->
name|next
operator|=
name|tmp
expr_stmt|;
else|else
name|curr_gradient
operator|->
name|segments
operator|=
name|tmp
expr_stmt|;
name|tmp
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|rseg
expr_stmt|;
if|if
condition|(
name|rseg
condition|)
name|rseg
operator|->
name|prev
operator|=
name|seg
expr_stmt|;
comment|/* Reset selection */
name|g_editor
operator|->
name|control_sel_l
operator|=
name|tmp
expr_stmt|;
name|g_editor
operator|->
name|control_sel_r
operator|=
name|seg
expr_stmt|;
comment|/* Done */
name|curr_gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
name|curr_gradient
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|ed_update_editor
argument_list|(
name|GRAD_UPDATE_PREVIEW
operator||
name|GRAD_UPDATE_CONTROL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_do_replicate_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_replicate_cancel_callback (GtkWidget * widget,gpointer client_data)
name|cpopup_replicate_cancel_callback
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gpointer
name|client_data
parameter_list|)
block|{
name|gtk_widget_destroy
argument_list|(
name|GTK_WIDGET
argument_list|(
name|client_data
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_set_sensitive
argument_list|(
name|g_editor
operator|->
name|shell
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_replicate_cancel_callback */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_blend_endpoints (double r0,double g0,double b0,double a0,double r1,double g1,double b1,double a1,int blend_colors,int blend_opacity)
name|cpopup_blend_endpoints
parameter_list|(
name|double
name|r0
parameter_list|,
name|double
name|g0
parameter_list|,
name|double
name|b0
parameter_list|,
name|double
name|a0
parameter_list|,
name|double
name|r1
parameter_list|,
name|double
name|g1
parameter_list|,
name|double
name|b1
parameter_list|,
name|double
name|a1
parameter_list|,
name|int
name|blend_colors
parameter_list|,
name|int
name|blend_opacity
parameter_list|)
block|{
name|double
name|dr
decl_stmt|,
name|dg
decl_stmt|,
name|db
decl_stmt|,
name|da
decl_stmt|;
name|double
name|left
decl_stmt|,
name|len
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|aseg
decl_stmt|;
name|dr
operator|=
name|r1
operator|-
name|r0
expr_stmt|;
name|dg
operator|=
name|g1
operator|-
name|g0
expr_stmt|;
name|db
operator|=
name|b1
operator|-
name|b0
expr_stmt|;
name|da
operator|=
name|a1
operator|-
name|a0
expr_stmt|;
name|left
operator|=
name|g_editor
operator|->
name|control_sel_l
operator|->
name|left
expr_stmt|;
name|len
operator|=
name|g_editor
operator|->
name|control_sel_r
operator|->
name|right
operator|-
name|left
expr_stmt|;
name|seg
operator|=
name|g_editor
operator|->
name|control_sel_l
expr_stmt|;
do|do
block|{
if|if
condition|(
name|blend_colors
condition|)
block|{
name|seg
operator|->
name|r0
operator|=
name|r0
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|dr
expr_stmt|;
name|seg
operator|->
name|g0
operator|=
name|g0
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|dg
expr_stmt|;
name|seg
operator|->
name|b0
operator|=
name|b0
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|db
expr_stmt|;
name|seg
operator|->
name|r1
operator|=
name|r0
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|dr
expr_stmt|;
name|seg
operator|->
name|g1
operator|=
name|g0
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|dg
expr_stmt|;
name|seg
operator|->
name|b1
operator|=
name|b0
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|db
expr_stmt|;
block|}
comment|/* if */
if|if
condition|(
name|blend_opacity
condition|)
block|{
name|seg
operator|->
name|a0
operator|=
name|a0
operator|+
operator|(
name|seg
operator|->
name|left
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|da
expr_stmt|;
name|seg
operator|->
name|a1
operator|=
name|a0
operator|+
operator|(
name|seg
operator|->
name|right
operator|-
name|left
operator|)
operator|/
name|len
operator|*
name|da
expr_stmt|;
block|}
comment|/* if */
name|aseg
operator|=
name|seg
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
do|while
condition|(
name|aseg
operator|!=
name|g_editor
operator|->
name|control_sel_r
condition|)
do|;
block|}
end_function

begin_comment
comment|/* cpopup_blend_endpoints */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_midpoint (grad_segment_t * lseg,grad_segment_t ** newl,grad_segment_t ** newr)
name|cpopup_split_midpoint
parameter_list|(
name|grad_segment_t
modifier|*
name|lseg
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newl
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newr
parameter_list|)
block|{
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|grad_segment_t
modifier|*
name|newseg
decl_stmt|;
comment|/* Get color at original segment's midpoint */
name|grad_get_color_at
argument_list|(
name|lseg
operator|->
name|middle
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
comment|/* Create a new segment and insert it in the list */
name|newseg
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
name|newseg
operator|->
name|prev
operator|=
name|lseg
expr_stmt|;
name|newseg
operator|->
name|next
operator|=
name|lseg
operator|->
name|next
expr_stmt|;
name|lseg
operator|->
name|next
operator|=
name|newseg
expr_stmt|;
if|if
condition|(
name|newseg
operator|->
name|next
condition|)
name|newseg
operator|->
name|next
operator|->
name|prev
operator|=
name|newseg
expr_stmt|;
comment|/* Set coordinates of new segment */
name|newseg
operator|->
name|left
operator|=
name|lseg
operator|->
name|middle
expr_stmt|;
name|newseg
operator|->
name|right
operator|=
name|lseg
operator|->
name|right
expr_stmt|;
name|newseg
operator|->
name|middle
operator|=
operator|(
name|newseg
operator|->
name|left
operator|+
name|newseg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
comment|/* Set coordinates of original segment */
name|lseg
operator|->
name|right
operator|=
name|newseg
operator|->
name|left
expr_stmt|;
name|lseg
operator|->
name|middle
operator|=
operator|(
name|lseg
operator|->
name|left
operator|+
name|lseg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
comment|/* Set colors of both segments */
name|newseg
operator|->
name|r1
operator|=
name|lseg
operator|->
name|r1
expr_stmt|;
name|newseg
operator|->
name|g1
operator|=
name|lseg
operator|->
name|g1
expr_stmt|;
name|newseg
operator|->
name|b1
operator|=
name|lseg
operator|->
name|b1
expr_stmt|;
name|newseg
operator|->
name|a1
operator|=
name|lseg
operator|->
name|a1
expr_stmt|;
name|lseg
operator|->
name|r1
operator|=
name|newseg
operator|->
name|r0
operator|=
name|r
expr_stmt|;
name|lseg
operator|->
name|g1
operator|=
name|newseg
operator|->
name|g0
operator|=
name|g
expr_stmt|;
name|lseg
operator|->
name|b1
operator|=
name|newseg
operator|->
name|b0
operator|=
name|b
expr_stmt|;
name|lseg
operator|->
name|a1
operator|=
name|newseg
operator|->
name|a0
operator|=
name|a
expr_stmt|;
comment|/* Set parameters of new segment */
name|newseg
operator|->
name|type
operator|=
name|lseg
operator|->
name|type
expr_stmt|;
name|newseg
operator|->
name|color
operator|=
name|lseg
operator|->
name|color
expr_stmt|;
comment|/* Done */
operator|*
name|newl
operator|=
name|lseg
expr_stmt|;
operator|*
name|newr
operator|=
name|newseg
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_split_midpoint */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|cpopup_split_uniform (grad_segment_t * lseg,int parts,grad_segment_t ** newl,grad_segment_t ** newr)
name|cpopup_split_uniform
parameter_list|(
name|grad_segment_t
modifier|*
name|lseg
parameter_list|,
name|int
name|parts
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newl
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|newr
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|prev
decl_stmt|,
modifier|*
name|tmp
decl_stmt|;
name|double
name|seg_len
decl_stmt|;
name|int
name|i
decl_stmt|;
name|seg_len
operator|=
operator|(
name|lseg
operator|->
name|right
operator|-
name|lseg
operator|->
name|left
operator|)
operator|/
name|parts
expr_stmt|;
comment|/* Length of divisions */
name|seg
operator|=
name|NULL
expr_stmt|;
name|prev
operator|=
name|NULL
expr_stmt|;
name|tmp
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|parts
condition|;
name|i
operator|++
control|)
block|{
name|seg
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
name|tmp
operator|=
name|seg
expr_stmt|;
comment|/* Remember first segment */
name|seg
operator|->
name|left
operator|=
name|lseg
operator|->
name|left
operator|+
name|i
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|lseg
operator|->
name|left
operator|+
operator|(
name|i
operator|+
literal|1
operator|)
operator|*
name|seg_len
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
operator|(
name|seg
operator|->
name|left
operator|+
name|seg
operator|->
name|right
operator|)
operator|/
literal|2.0
expr_stmt|;
name|grad_get_color_at
argument_list|(
name|seg
operator|->
name|left
argument_list|,
operator|&
name|seg
operator|->
name|r0
argument_list|,
operator|&
name|seg
operator|->
name|g0
argument_list|,
operator|&
name|seg
operator|->
name|b0
argument_list|,
operator|&
name|seg
operator|->
name|a0
argument_list|)
expr_stmt|;
name|grad_get_color_at
argument_list|(
name|seg
operator|->
name|right
argument_list|,
operator|&
name|seg
operator|->
name|r1
argument_list|,
operator|&
name|seg
operator|->
name|g1
argument_list|,
operator|&
name|seg
operator|->
name|b1
argument_list|,
operator|&
name|seg
operator|->
name|a1
argument_list|)
expr_stmt|;
name|seg
operator|->
name|type
operator|=
name|lseg
operator|->
name|type
expr_stmt|;
name|seg
operator|->
name|color
operator|=
name|lseg
operator|->
name|color
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
name|prev
operator|=
name|seg
expr_stmt|;
block|}
comment|/* for */
comment|/* Fix edges */
name|tmp
operator|->
name|r0
operator|=
name|lseg
operator|->
name|r0
expr_stmt|;
name|tmp
operator|->
name|g0
operator|=
name|lseg
operator|->
name|g0
expr_stmt|;
name|tmp
operator|->
name|b0
operator|=
name|lseg
operator|->
name|b0
expr_stmt|;
name|tmp
operator|->
name|a0
operator|=
name|lseg
operator|->
name|a0
expr_stmt|;
name|seg
operator|->
name|r1
operator|=
name|lseg
operator|->
name|r1
expr_stmt|;
name|seg
operator|->
name|g1
operator|=
name|lseg
operator|->
name|g1
expr_stmt|;
name|seg
operator|->
name|b1
operator|=
name|lseg
operator|->
name|b1
expr_stmt|;
name|seg
operator|->
name|a1
operator|=
name|lseg
operator|->
name|a1
expr_stmt|;
name|tmp
operator|->
name|left
operator|=
name|lseg
operator|->
name|left
expr_stmt|;
name|seg
operator|->
name|right
operator|=
name|lseg
operator|->
name|right
expr_stmt|;
comment|/* To squish accumulative error */
comment|/* Link in list */
name|tmp
operator|->
name|prev
operator|=
name|lseg
operator|->
name|prev
expr_stmt|;
name|seg
operator|->
name|next
operator|=
name|lseg
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|lseg
operator|->
name|prev
condition|)
name|lseg
operator|->
name|prev
operator|->
name|next
operator|=
name|tmp
expr_stmt|;
else|else
name|curr_gradient
operator|->
name|segments
operator|=
name|tmp
expr_stmt|;
comment|/* We are on leftmost segment */
if|if
condition|(
name|lseg
operator|->
name|next
condition|)
name|lseg
operator|->
name|next
operator|->
name|prev
operator|=
name|seg
expr_stmt|;
name|curr_gradient
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
comment|/* Force re-search */
comment|/* Done */
operator|*
name|newl
operator|=
name|tmp
expr_stmt|;
operator|*
name|newr
operator|=
name|seg
expr_stmt|;
comment|/* Delete old segment */
name|seg_free_segment
argument_list|(
name|lseg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* cpopup_split_uniform */
end_comment

begin_comment
comment|/***** Gradient functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|gradient_t
modifier|*
DECL|function|grad_new_gradient (void)
name|grad_new_gradient
parameter_list|(
name|void
parameter_list|)
block|{
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|grad
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|gradient_t
argument_list|)
argument_list|)
expr_stmt|;
name|grad
operator|->
name|name
operator|=
name|NULL
expr_stmt|;
name|grad
operator|->
name|segments
operator|=
name|NULL
expr_stmt|;
name|grad
operator|->
name|last_visited
operator|=
name|NULL
expr_stmt|;
name|grad
operator|->
name|dirty
operator|=
literal|0
expr_stmt|;
name|grad
operator|->
name|filename
operator|=
name|NULL
expr_stmt|;
name|grad
operator|->
name|pixmap
operator|=
name|NULL
expr_stmt|;
return|return
name|grad
return|;
block|}
end_function

begin_comment
comment|/* grad_new_gradient */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|grad_free_gradient (gradient_t * grad)
name|grad_free_gradient
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|)
block|{
name|g_assert
argument_list|(
name|grad
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|grad
operator|->
name|name
condition|)
name|g_free
argument_list|(
name|grad
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|grad
operator|->
name|segments
condition|)
name|seg_free_segments
argument_list|(
name|grad
operator|->
name|segments
argument_list|)
expr_stmt|;
if|if
condition|(
name|grad
operator|->
name|filename
condition|)
name|g_free
argument_list|(
name|grad
operator|->
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|grad
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* grad_free_gradient */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|grad_save_all (int need_free)
name|grad_save_all
parameter_list|(
name|int
name|need_free
parameter_list|)
block|{
name|GSList
modifier|*
name|node
decl_stmt|;
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|node
operator|=
name|gradients_list
expr_stmt|;
while|while
condition|(
name|node
condition|)
block|{
name|grad
operator|=
name|node
operator|->
name|data
expr_stmt|;
comment|/* If gradient has dirty flag set, save it */
if|if
condition|(
name|grad
operator|->
name|dirty
condition|)
name|grad_save_gradient
argument_list|(
name|grad
argument_list|,
name|grad
operator|->
name|filename
argument_list|)
expr_stmt|;
if|if
condition|(
name|need_free
condition|)
name|grad_free_gradient
argument_list|(
name|grad
argument_list|)
expr_stmt|;
name|node
operator|=
name|g_slist_next
argument_list|(
name|node
argument_list|)
expr_stmt|;
block|}
comment|/* while */
block|}
end_function

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|grad_free_gradients (void)
name|grad_free_gradients
parameter_list|(
name|void
parameter_list|)
block|{
name|grad_save_all
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|gradients_list
argument_list|)
expr_stmt|;
name|num_gradients
operator|=
literal|0
expr_stmt|;
name|gradients_list
operator|=
name|NULL
expr_stmt|;
name|curr_gradient
operator|=
name|NULL
expr_stmt|;
block|}
end_function

begin_comment
comment|/* grad_free_gradients */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|grad_load_gradient (char * filename)
name|grad_load_gradient
parameter_list|(
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|FILE
modifier|*
name|file
decl_stmt|;
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|,
modifier|*
name|prev
decl_stmt|;
name|int
name|num_segments
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|type
decl_stmt|,
name|color
decl_stmt|;
name|char
name|line
index|[
literal|1024
index|]
decl_stmt|;
name|g_assert
argument_list|(
name|filename
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|file
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"rb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
return|return;
name|fgets
argument_list|(
name|line
argument_list|,
literal|1024
argument_list|,
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|line
argument_list|,
literal|"GIMP Gradient\n"
argument_list|)
operator|!=
literal|0
condition|)
return|return;
name|grad
operator|=
name|grad_new_gradient
argument_list|()
expr_stmt|;
name|grad
operator|->
name|filename
operator|=
name|g_strdup
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|grad
operator|->
name|name
operator|=
name|g_strdup
argument_list|(
name|g_basename
argument_list|(
name|filename
argument_list|)
argument_list|)
expr_stmt|;
name|fgets
argument_list|(
name|line
argument_list|,
literal|1024
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|num_segments
operator|=
name|atoi
argument_list|(
name|line
argument_list|)
expr_stmt|;
if|if
condition|(
name|num_segments
operator|<
literal|1
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"grad_load_gradient(): invalid number of segments in \"%s\""
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|grad
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
name|prev
operator|=
name|NULL
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|num_segments
condition|;
name|i
operator|++
control|)
block|{
name|seg
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|prev
expr_stmt|;
if|if
condition|(
name|prev
condition|)
name|prev
operator|->
name|next
operator|=
name|seg
expr_stmt|;
else|else
name|grad
operator|->
name|segments
operator|=
name|seg
expr_stmt|;
name|fgets
argument_list|(
name|line
argument_list|,
literal|1024
argument_list|,
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|sscanf
argument_list|(
name|line
argument_list|,
literal|"%lf%lf%lf%lf%lf%lf%lf%lf%lf%lf%lf%d%d"
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|left
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|middle
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|right
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|r0
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|g0
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|b0
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|a0
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|r1
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|g1
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|b1
operator|)
argument_list|,
operator|&
operator|(
name|seg
operator|->
name|a1
operator|)
argument_list|,
operator|&
name|type
argument_list|,
operator|&
name|color
argument_list|)
operator|!=
literal|13
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"grad_load_gradient(): badly formatted "
literal|"gradient segment %d in \"%s\" --- bad things may "
literal|"happen soon"
argument_list|)
argument_list|,
name|i
argument_list|,
name|filename
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|seg
operator|->
name|type
operator|=
operator|(
name|grad_type_t
operator|)
name|type
expr_stmt|;
name|seg
operator|->
name|color
operator|=
operator|(
name|grad_color_t
operator|)
name|color
expr_stmt|;
block|}
comment|/* else */
name|prev
operator|=
name|seg
expr_stmt|;
block|}
comment|/* for */
name|fclose
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|grad_insert_in_gradients_list
argument_list|(
name|grad
argument_list|)
expr_stmt|;
comment|/* Check if this gradient is the default one */
if|if
condition|(
name|strcmp
argument_list|(
name|default_gradient
argument_list|,
name|grad
operator|->
name|name
argument_list|)
operator|==
literal|0
condition|)
name|grad_default_gradient
operator|=
name|grad
expr_stmt|;
block|}
end_function

begin_comment
comment|/* grad_load_gradient */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|grad_save_gradient (gradient_t * grad,char * filename)
name|grad_save_gradient
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|char
modifier|*
name|filename
parameter_list|)
block|{
name|FILE
modifier|*
name|file
decl_stmt|;
name|int
name|num_segments
decl_stmt|;
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|g_assert
argument_list|(
name|grad
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|filename
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"grad_save_gradient(): can not save gradient with NULL filename"
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
name|file
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"wb"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
block|{
name|g_message
argument_list|(
name|_
argument_list|(
literal|"grad_save_gradient(): can't open \"%s\""
argument_list|)
argument_list|,
name|filename
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* if */
comment|/* File format is: 	 * 	 *   GIMP Gradient 	 *   number_of_segments 	 *   left middle right r0 g0 b0 a0 r1 g1 b1 a1 type coloring 	 *   left middle right r0 g0 b0 a0 r1 g1 b1 a1 type coloring 	 *   ... 	 */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"GIMP Gradient\n"
argument_list|)
expr_stmt|;
comment|/* Count number of segments */
name|num_segments
operator|=
literal|0
expr_stmt|;
name|seg
operator|=
name|grad
operator|->
name|segments
expr_stmt|;
while|while
condition|(
name|seg
condition|)
block|{
name|num_segments
operator|++
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* while */
comment|/* Write rest of file */
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"%d\n"
argument_list|,
name|num_segments
argument_list|)
expr_stmt|;
for|for
control|(
name|seg
operator|=
name|grad
operator|->
name|segments
init|;
name|seg
condition|;
name|seg
operator|=
name|seg
operator|->
name|next
control|)
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"%f %f %f %f %f %f %f %f %f %f %f %d %d\n"
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|seg
operator|->
name|r0
argument_list|,
name|seg
operator|->
name|g0
argument_list|,
name|seg
operator|->
name|b0
argument_list|,
name|seg
operator|->
name|a0
argument_list|,
name|seg
operator|->
name|r1
argument_list|,
name|seg
operator|->
name|g1
argument_list|,
name|seg
operator|->
name|b1
argument_list|,
name|seg
operator|->
name|a1
argument_list|,
operator|(
name|int
operator|)
name|seg
operator|->
name|type
argument_list|,
operator|(
name|int
operator|)
name|seg
operator|->
name|color
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|grad
operator|->
name|dirty
operator|=
literal|0
expr_stmt|;
block|}
end_function

begin_comment
comment|/* grad_save_gradient */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|gradient_t
modifier|*
DECL|function|grad_create_default_gradient (void)
name|grad_create_default_gradient
parameter_list|(
name|void
parameter_list|)
block|{
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|grad
operator|=
name|grad_new_gradient
argument_list|()
expr_stmt|;
name|grad
operator|->
name|segments
operator|=
name|seg_new_segment
argument_list|()
expr_stmt|;
return|return
name|grad
return|;
block|}
end_function

begin_comment
comment|/* grad_create_default_gradient */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|int
DECL|function|grad_insert_in_gradients_list (gradient_t * grad)
name|grad_insert_in_gradients_list
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|)
block|{
name|GSList
modifier|*
name|tmp
decl_stmt|;
name|gradient_t
modifier|*
name|g
decl_stmt|;
name|int
name|n
decl_stmt|;
comment|/* We insert gradients in alphabetical order.  Find the index 	 * of the gradient after which we will insert the current one. 	 */
name|n
operator|=
literal|0
expr_stmt|;
name|tmp
operator|=
name|gradients_list
expr_stmt|;
while|while
condition|(
name|tmp
condition|)
block|{
name|g
operator|=
name|tmp
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|grad
operator|->
name|name
argument_list|,
name|g
operator|->
name|name
argument_list|)
operator|<=
literal|0
condition|)
break|break;
comment|/* We found the one we want */
name|n
operator|++
expr_stmt|;
name|tmp
operator|=
name|g_slist_next
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
block|}
comment|/* while */
name|num_gradients
operator|++
expr_stmt|;
name|gradients_list
operator|=
name|g_slist_insert
argument_list|(
name|gradients_list
argument_list|,
name|grad
argument_list|,
name|n
argument_list|)
expr_stmt|;
return|return
name|n
return|;
block|}
end_function

begin_comment
comment|/* grad_insert_in_gradients_list */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|grad_dump_gradient (gradient_t * grad,FILE * file)
name|grad_dump_gradient
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|FILE
modifier|*
name|file
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"Name: \"%s\"\n"
argument_list|,
name|grad
operator|->
name|name
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"Dirty: %d\n"
argument_list|,
name|grad
operator|->
name|dirty
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"Filename: \"%s\"\n"
argument_list|,
name|grad
operator|->
name|filename
argument_list|)
expr_stmt|;
name|seg
operator|=
name|grad
operator|->
name|segments
expr_stmt|;
while|while
condition|(
name|seg
condition|)
block|{
name|fprintf
argument_list|(
name|file
argument_list|,
literal|"%c%p | %f %f %f | %f %f %f %f | %f %f %f %f | %d %d | %p %p\n"
argument_list|,
operator|(
name|seg
operator|==
name|grad
operator|->
name|last_visited
operator|)
condition|?
literal|'>'
else|:
literal|' '
argument_list|,
name|seg
argument_list|,
name|seg
operator|->
name|left
argument_list|,
name|seg
operator|->
name|middle
argument_list|,
name|seg
operator|->
name|right
argument_list|,
name|seg
operator|->
name|r0
argument_list|,
name|seg
operator|->
name|g0
argument_list|,
name|seg
operator|->
name|b0
argument_list|,
name|seg
operator|->
name|a0
argument_list|,
name|seg
operator|->
name|r1
argument_list|,
name|seg
operator|->
name|g1
argument_list|,
name|seg
operator|->
name|b1
argument_list|,
name|seg
operator|->
name|a1
argument_list|,
operator|(
name|int
operator|)
name|seg
operator|->
name|type
argument_list|,
operator|(
name|int
operator|)
name|seg
operator|->
name|color
argument_list|,
name|seg
operator|->
name|prev
argument_list|,
name|seg
operator|->
name|next
argument_list|)
expr_stmt|;
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
comment|/* while */
block|}
end_function

begin_comment
comment|/* grad_dump_gradient */
end_comment

begin_comment
comment|/***** Segment functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|grad_segment_t
modifier|*
DECL|function|seg_new_segment (void)
name|seg_new_segment
parameter_list|(
name|void
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|seg
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|grad_segment_t
argument_list|)
argument_list|)
expr_stmt|;
name|seg
operator|->
name|left
operator|=
literal|0.0
expr_stmt|;
name|seg
operator|->
name|middle
operator|=
literal|0.5
expr_stmt|;
name|seg
operator|->
name|right
operator|=
literal|1.0
expr_stmt|;
name|seg
operator|->
name|r0
operator|=
name|seg
operator|->
name|g0
operator|=
name|seg
operator|->
name|b0
operator|=
literal|0.0
expr_stmt|;
name|seg
operator|->
name|r1
operator|=
name|seg
operator|->
name|g1
operator|=
name|seg
operator|->
name|b1
operator|=
name|seg
operator|->
name|a0
operator|=
name|seg
operator|->
name|a1
operator|=
literal|1.0
expr_stmt|;
name|seg
operator|->
name|type
operator|=
name|GRAD_LINEAR
expr_stmt|;
name|seg
operator|->
name|color
operator|=
name|GRAD_RGB
expr_stmt|;
name|seg
operator|->
name|prev
operator|=
name|seg
operator|->
name|next
operator|=
name|NULL
expr_stmt|;
return|return
name|seg
return|;
block|}
end_function

begin_comment
comment|/* seg_new_segment */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|seg_free_segment (grad_segment_t * seg)
name|seg_free_segment
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
block|{
name|g_assert
argument_list|(
name|seg
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|seg
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* seg_free_segment */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|seg_free_segments (grad_segment_t * seg)
name|seg_free_segments
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|tmp
decl_stmt|;
name|g_assert
argument_list|(
name|seg
operator|!=
name|NULL
argument_list|)
expr_stmt|;
while|while
condition|(
name|seg
condition|)
block|{
name|tmp
operator|=
name|seg
operator|->
name|next
expr_stmt|;
name|seg_free_segment
argument_list|(
name|seg
argument_list|)
expr_stmt|;
name|seg
operator|=
name|tmp
expr_stmt|;
block|}
comment|/* while */
block|}
end_function

begin_comment
comment|/* seg_free_segments */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|grad_segment_t
modifier|*
DECL|function|seg_get_segment_at (gradient_t * grad,double pos)
name|seg_get_segment_at
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
name|grad_segment_t
modifier|*
name|seg
decl_stmt|;
name|g_assert
argument_list|(
name|grad
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|pos
operator|=
name|BOUNDS
argument_list|(
name|pos
argument_list|,
literal|0.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
comment|/* to handle FP imprecision at the edges of the gradient */
if|if
condition|(
name|grad
operator|->
name|last_visited
condition|)
name|seg
operator|=
name|grad
operator|->
name|last_visited
expr_stmt|;
else|else
name|seg
operator|=
name|grad
operator|->
name|segments
expr_stmt|;
while|while
condition|(
name|seg
condition|)
if|if
condition|(
name|pos
operator|>=
name|seg
operator|->
name|left
condition|)
block|{
if|if
condition|(
name|pos
operator|<=
name|seg
operator|->
name|right
condition|)
block|{
name|grad
operator|->
name|last_visited
operator|=
name|seg
expr_stmt|;
comment|/* for speed */
return|return
name|seg
return|;
block|}
else|else
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
block|}
else|else
name|seg
operator|=
name|seg
operator|->
name|prev
expr_stmt|;
comment|/* Oops: we should have found a segment, but we didn't */
name|grad_dump_gradient
argument_list|(
name|curr_gradient
argument_list|,
name|stderr
argument_list|)
expr_stmt|;
name|fatal_error
argument_list|(
name|_
argument_list|(
literal|"seg_get_segment_at(): aieee, no matching segment for position %0.15f"
argument_list|)
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
comment|/* To shut up -Wall */
block|}
end_function

begin_comment
comment|/* seg_get_segment_at */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|grad_segment_t
modifier|*
DECL|function|seg_get_last_segment (grad_segment_t * seg)
name|seg_get_last_segment
parameter_list|(
name|grad_segment_t
modifier|*
name|seg
parameter_list|)
block|{
if|if
condition|(
operator|!
name|seg
condition|)
return|return
name|NULL
return|;
while|while
condition|(
name|seg
operator|->
name|next
condition|)
name|seg
operator|=
name|seg
operator|->
name|next
expr_stmt|;
return|return
name|seg
return|;
block|}
end_function

begin_comment
comment|/* seg_get_last_segment */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|seg_get_closest_handle (gradient_t * grad,double pos,grad_segment_t ** seg,control_drag_mode_t * handle)
name|seg_get_closest_handle
parameter_list|(
name|gradient_t
modifier|*
name|grad
parameter_list|,
name|double
name|pos
parameter_list|,
name|grad_segment_t
modifier|*
modifier|*
name|seg
parameter_list|,
name|control_drag_mode_t
modifier|*
name|handle
parameter_list|)
block|{
name|double
name|l_delta
decl_stmt|,
name|m_delta
decl_stmt|,
name|r_delta
decl_stmt|;
operator|*
name|seg
operator|=
name|seg_get_segment_at
argument_list|(
name|grad
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|m_delta
operator|=
name|fabs
argument_list|(
name|pos
operator|-
operator|(
operator|*
name|seg
operator|)
operator|->
name|middle
argument_list|)
expr_stmt|;
if|if
condition|(
name|pos
operator|<
operator|(
operator|*
name|seg
operator|)
operator|->
name|middle
condition|)
block|{
name|l_delta
operator|=
name|fabs
argument_list|(
name|pos
operator|-
operator|(
operator|*
name|seg
operator|)
operator|->
name|left
argument_list|)
expr_stmt|;
if|if
condition|(
name|l_delta
operator|<
name|m_delta
condition|)
operator|*
name|handle
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
else|else
operator|*
name|handle
operator|=
name|GRAD_DRAG_MIDDLE
expr_stmt|;
block|}
else|else
block|{
name|r_delta
operator|=
name|fabs
argument_list|(
name|pos
operator|-
operator|(
operator|*
name|seg
operator|)
operator|->
name|right
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_delta
operator|<
name|r_delta
condition|)
operator|*
name|handle
operator|=
name|GRAD_DRAG_MIDDLE
expr_stmt|;
else|else
block|{
operator|*
name|seg
operator|=
operator|(
operator|*
name|seg
operator|)
operator|->
name|next
expr_stmt|;
operator|*
name|handle
operator|=
name|GRAD_DRAG_LEFT
expr_stmt|;
block|}
comment|/* else */
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* seg_get_closest_handle */
end_comment

begin_comment
comment|/***** Calculation functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|calc_linear_factor (double middle,double pos)
name|calc_linear_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
if|if
condition|(
name|pos
operator|<=
name|middle
condition|)
block|{
if|if
condition|(
name|middle
operator|<
name|EPSILON
condition|)
return|return
literal|0.0
return|;
else|else
return|return
literal|0.5
operator|*
name|pos
operator|/
name|middle
return|;
block|}
else|else
block|{
name|pos
operator|-=
name|middle
expr_stmt|;
name|middle
operator|=
literal|1.0
operator|-
name|middle
expr_stmt|;
if|if
condition|(
name|middle
operator|<
name|EPSILON
condition|)
return|return
literal|1.0
return|;
else|else
return|return
literal|0.5
operator|+
literal|0.5
operator|*
name|pos
operator|/
name|middle
return|;
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* calc_linear_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|calc_curved_factor (double middle,double pos)
name|calc_curved_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
if|if
condition|(
name|middle
operator|<
name|EPSILON
condition|)
name|middle
operator|=
name|EPSILON
expr_stmt|;
return|return
name|pow
argument_list|(
name|pos
argument_list|,
name|log
argument_list|(
literal|0.5
argument_list|)
operator|/
name|log
argument_list|(
name|middle
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* calc_curved_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|calc_sine_factor (double middle,double pos)
name|calc_sine_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
name|pos
operator|=
name|calc_linear_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
operator|(
name|sin
argument_list|(
operator|(
operator|-
name|M_PI
operator|/
literal|2.0
operator|)
operator|+
name|M_PI
operator|*
name|pos
argument_list|)
operator|+
literal|1.0
operator|)
operator|/
literal|2.0
return|;
block|}
end_function

begin_comment
comment|/* calc_sine_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|calc_sphere_increasing_factor (double middle,double pos)
name|calc_sphere_increasing_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
name|pos
operator|=
name|calc_linear_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
operator|-
literal|1.0
expr_stmt|;
return|return
name|sqrt
argument_list|(
literal|1.0
operator|-
name|pos
operator|*
name|pos
argument_list|)
return|;
comment|/* Works for convex increasing and concave decreasing */
block|}
end_function

begin_comment
comment|/* calc_sphere_increasing_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|double
DECL|function|calc_sphere_decreasing_factor (double middle,double pos)
name|calc_sphere_decreasing_factor
parameter_list|(
name|double
name|middle
parameter_list|,
name|double
name|pos
parameter_list|)
block|{
name|pos
operator|=
name|calc_linear_factor
argument_list|(
name|middle
argument_list|,
name|pos
argument_list|)
expr_stmt|;
return|return
literal|1.0
operator|-
name|sqrt
argument_list|(
literal|1.0
operator|-
name|pos
operator|*
name|pos
argument_list|)
return|;
comment|/* Works for convex decreasing and concave increasing */
block|}
end_function

begin_comment
comment|/* calc_sphere_decreasing_factor */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|calc_rgb_to_hsv (double * r,double * g,double * b)
name|calc_rgb_to_hsv
parameter_list|(
name|double
modifier|*
name|r
parameter_list|,
name|double
modifier|*
name|g
parameter_list|,
name|double
modifier|*
name|b
parameter_list|)
block|{
name|double
name|red
decl_stmt|,
name|green
decl_stmt|,
name|blue
decl_stmt|;
name|double
name|h
decl_stmt|,
name|s
decl_stmt|,
name|v
decl_stmt|;
name|double
name|min
decl_stmt|,
name|max
decl_stmt|;
name|double
name|delta
decl_stmt|;
name|red
operator|=
operator|*
name|r
expr_stmt|;
name|green
operator|=
operator|*
name|g
expr_stmt|;
name|blue
operator|=
operator|*
name|b
expr_stmt|;
name|h
operator|=
literal|0.0
expr_stmt|;
comment|/* Shut up -Wall */
if|if
condition|(
name|red
operator|>
name|green
condition|)
block|{
if|if
condition|(
name|red
operator|>
name|blue
condition|)
name|max
operator|=
name|red
expr_stmt|;
else|else
name|max
operator|=
name|blue
expr_stmt|;
if|if
condition|(
name|green
operator|<
name|blue
condition|)
name|min
operator|=
name|green
expr_stmt|;
else|else
name|min
operator|=
name|blue
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|green
operator|>
name|blue
condition|)
name|max
operator|=
name|green
expr_stmt|;
else|else
name|max
operator|=
name|blue
expr_stmt|;
if|if
condition|(
name|red
operator|<
name|blue
condition|)
name|min
operator|=
name|red
expr_stmt|;
else|else
name|min
operator|=
name|blue
expr_stmt|;
block|}
comment|/* else */
name|v
operator|=
name|max
expr_stmt|;
if|if
condition|(
name|max
operator|!=
literal|0.0
condition|)
name|s
operator|=
operator|(
name|max
operator|-
name|min
operator|)
operator|/
name|max
expr_stmt|;
else|else
name|s
operator|=
literal|0.0
expr_stmt|;
if|if
condition|(
name|s
operator|==
literal|0.0
condition|)
name|h
operator|=
literal|0.0
expr_stmt|;
else|else
block|{
name|delta
operator|=
name|max
operator|-
name|min
expr_stmt|;
if|if
condition|(
name|red
operator|==
name|max
condition|)
name|h
operator|=
operator|(
name|green
operator|-
name|blue
operator|)
operator|/
name|delta
expr_stmt|;
elseif|else
if|if
condition|(
name|green
operator|==
name|max
condition|)
name|h
operator|=
literal|2
operator|+
operator|(
name|blue
operator|-
name|red
operator|)
operator|/
name|delta
expr_stmt|;
elseif|else
if|if
condition|(
name|blue
operator|==
name|max
condition|)
name|h
operator|=
literal|4
operator|+
operator|(
name|red
operator|-
name|green
operator|)
operator|/
name|delta
expr_stmt|;
name|h
operator|/=
literal|6.0
expr_stmt|;
if|if
condition|(
name|h
operator|<
literal|0.0
condition|)
name|h
operator|+=
literal|1.0
expr_stmt|;
elseif|else
if|if
condition|(
name|h
operator|>
literal|1.0
condition|)
name|h
operator|-=
literal|1.0
expr_stmt|;
block|}
comment|/* else */
operator|*
name|r
operator|=
name|h
expr_stmt|;
operator|*
name|g
operator|=
name|s
expr_stmt|;
operator|*
name|b
operator|=
name|v
expr_stmt|;
block|}
end_function

begin_comment
comment|/* calc_rgb_to_hsv */
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|void
DECL|function|calc_hsv_to_rgb (double * h,double * s,double * v)
name|calc_hsv_to_rgb
parameter_list|(
name|double
modifier|*
name|h
parameter_list|,
name|double
modifier|*
name|s
parameter_list|,
name|double
modifier|*
name|v
parameter_list|)
block|{
name|double
name|hue
decl_stmt|,
name|saturation
decl_stmt|,
name|value
decl_stmt|;
name|double
name|f
decl_stmt|,
name|p
decl_stmt|,
name|q
decl_stmt|,
name|t
decl_stmt|;
if|if
condition|(
operator|*
name|s
operator|==
literal|0.0
condition|)
block|{
operator|*
name|h
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|s
operator|=
operator|*
name|v
expr_stmt|;
operator|*
name|v
operator|=
operator|*
name|v
expr_stmt|;
comment|/* heh */
block|}
else|else
block|{
name|hue
operator|=
operator|*
name|h
operator|*
literal|6.0
expr_stmt|;
name|saturation
operator|=
operator|*
name|s
expr_stmt|;
name|value
operator|=
operator|*
name|v
expr_stmt|;
if|if
condition|(
name|hue
operator|==
literal|6.0
condition|)
name|hue
operator|=
literal|0.0
expr_stmt|;
name|f
operator|=
name|hue
operator|-
operator|(
name|int
operator|)
name|hue
expr_stmt|;
name|p
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|)
expr_stmt|;
name|q
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|*
name|f
operator|)
expr_stmt|;
name|t
operator|=
name|value
operator|*
operator|(
literal|1.0
operator|-
name|saturation
operator|*
operator|(
literal|1.0
operator|-
name|f
operator|)
operator|)
expr_stmt|;
switch|switch
condition|(
operator|(
name|int
operator|)
name|hue
condition|)
block|{
case|case
literal|0
case|:
operator|*
name|h
operator|=
name|value
expr_stmt|;
operator|*
name|s
operator|=
name|t
expr_stmt|;
operator|*
name|v
operator|=
name|p
expr_stmt|;
break|break;
case|case
literal|1
case|:
operator|*
name|h
operator|=
name|q
expr_stmt|;
operator|*
name|s
operator|=
name|value
expr_stmt|;
operator|*
name|v
operator|=
name|p
expr_stmt|;
break|break;
case|case
literal|2
case|:
operator|*
name|h
operator|=
name|p
expr_stmt|;
operator|*
name|s
operator|=
name|value
expr_stmt|;
operator|*
name|v
operator|=
name|t
expr_stmt|;
break|break;
case|case
literal|3
case|:
operator|*
name|h
operator|=
name|p
expr_stmt|;
operator|*
name|s
operator|=
name|q
expr_stmt|;
operator|*
name|v
operator|=
name|value
expr_stmt|;
break|break;
case|case
literal|4
case|:
operator|*
name|h
operator|=
name|t
expr_stmt|;
operator|*
name|s
operator|=
name|p
expr_stmt|;
operator|*
name|v
operator|=
name|value
expr_stmt|;
break|break;
case|case
literal|5
case|:
operator|*
name|h
operator|=
name|value
expr_stmt|;
operator|*
name|s
operator|=
name|p
expr_stmt|;
operator|*
name|v
operator|=
name|q
expr_stmt|;
break|break;
block|}
comment|/* switch */
block|}
comment|/* else */
block|}
end_function

begin_comment
comment|/* calc_hsv_to_rgb */
end_comment

begin_comment
comment|/***** Files and paths functions *****/
end_comment

begin_comment
comment|/*****/
end_comment

begin_function
specifier|static
name|char
modifier|*
DECL|function|build_user_filename (char * name,char * path_str)
name|build_user_filename
parameter_list|(
name|char
modifier|*
name|name
parameter_list|,
name|char
modifier|*
name|path_str
parameter_list|)
block|{
name|char
modifier|*
name|home
decl_stmt|;
name|char
modifier|*
name|local_path
decl_stmt|;
name|char
modifier|*
name|first_token
decl_stmt|;
name|char
modifier|*
name|token
decl_stmt|;
name|char
modifier|*
name|path
decl_stmt|;
name|char
modifier|*
name|filename
decl_stmt|;
name|g_assert
argument_list|(
name|name
operator|!=
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|path_str
condition|)
return|return
name|NULL
return|;
comment|/* Perhaps this is not a good idea */
comment|/* Get the first path specified in the list */
name|home
operator|=
name|g_get_home_dir
argument_list|()
expr_stmt|;
name|local_path
operator|=
name|g_strdup
argument_list|(
name|path_str
argument_list|)
expr_stmt|;
name|first_token
operator|=
name|local_path
expr_stmt|;
name|token
operator|=
name|xstrsep
argument_list|(
operator|&
name|first_token
argument_list|,
literal|":"
argument_list|)
expr_stmt|;
name|filename
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|token
condition|)
block|{
if|if
condition|(
operator|*
name|token
operator|==
literal|'~'
condition|)
block|{
name|path
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s%s"
argument_list|,
name|home
argument_list|,
name|token
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|path
operator|=
name|g_strdup
argument_list|(
name|token
argument_list|)
expr_stmt|;
block|}
comment|/* else */
name|filename
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s/%s"
argument_list|,
name|path
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|path
argument_list|)
expr_stmt|;
block|}
comment|/* if */
name|g_free
argument_list|(
name|local_path
argument_list|)
expr_stmt|;
return|return
name|filename
return|;
block|}
end_function

begin_comment
comment|/* build_user_filename */
end_comment

begin_comment
comment|/***** Procedural database declarations and functions *****/
end_comment

begin_comment
comment|/***** gradients_get_list *****/
end_comment

begin_decl_stmt
DECL|variable|gradients_get_list_out_args
name|ProcArg
name|gradients_get_list_out_args
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"num_gradients"
block|,
literal|"The number of loaded gradients"
block|}
block|,
block|{
name|PDB_STRINGARRAY
block|,
literal|"gradient_names"
block|,
literal|"The list of gradient names"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_get_list_out_args */
end_comment

begin_decl_stmt
DECL|variable|gradients_get_list_proc
name|ProcRecord
name|gradients_get_list_proc
init|=
block|{
literal|"gimp_gradients_get_list"
block|,
literal|"Retrieve the list of loaded gradients"
block|,
literal|"This procedure returns a list of the gradients that are currently loaded "
literal|"in the gradient editor.  You can later use the gimp_gradients_set_active "
literal|"function to set the active gradient."
block|,
literal|"Federico Mena Quintero"
block|,
literal|"Federico Mena Quintero"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/* Input arguments */
literal|0
block|,
name|NULL
block|,
comment|/* Output arguments */
sizeof|sizeof
argument_list|(
name|gradients_get_list_out_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradients_get_list_out_args
index|[
literal|0
index|]
argument_list|)
block|,
name|gradients_get_list_out_args
block|,
comment|/* Exec method */
block|{
block|{
name|gradients_get_list_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_get_list_proc */
end_comment

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|gradients_get_list_invoker (Argument * args)
name|gradients_get_list_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|GSList
modifier|*
name|list
decl_stmt|;
name|char
modifier|*
modifier|*
name|gradients
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|success
decl_stmt|;
name|gradients
operator|=
name|g_malloc
argument_list|(
sizeof|sizeof
argument_list|(
name|char
operator|*
argument_list|)
operator|*
name|num_gradients
argument_list|)
expr_stmt|;
name|list
operator|=
name|gradients_list
expr_stmt|;
name|success
operator|=
operator|(
name|list
operator|!=
name|NULL
operator|)
expr_stmt|;
name|i
operator|=
literal|0
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|grad
operator|=
name|list
operator|->
name|data
expr_stmt|;
name|gradients
index|[
name|i
operator|++
index|]
operator|=
name|g_strdup
argument_list|(
name|grad
operator|->
name|name
argument_list|)
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
comment|/* while */
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|gradients_get_list_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|num_gradients
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|gradients
expr_stmt|;
block|}
comment|/* if */
return|return
name|return_args
return|;
block|}
end_function

begin_comment
comment|/* gradients_get_list_invoker */
end_comment

begin_comment
comment|/***** gradients_get_active *****/
end_comment

begin_decl_stmt
DECL|variable|gradients_get_active_out_args
name|ProcArg
name|gradients_get_active_out_args
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"name"
block|,
literal|"The name of the active gradient"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_get_active_out_args */
end_comment

begin_decl_stmt
DECL|variable|gradients_get_active_proc
name|ProcRecord
name|gradients_get_active_proc
init|=
block|{
literal|"gimp_gradients_get_active"
block|,
literal|"Retrieve the name of the active gradient"
block|,
literal|"This procedure returns the name of the active gradient in hte gradient editor."
block|,
literal|"Federico Mena Quintero"
block|,
literal|"Federico Mena Quintero"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/* Input arguments */
literal|0
block|,
name|NULL
block|,
comment|/* Output arguments */
sizeof|sizeof
argument_list|(
name|gradients_get_active_out_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradients_get_active_out_args
index|[
literal|0
index|]
argument_list|)
block|,
name|gradients_get_active_out_args
block|,
comment|/* Exec method */
block|{
block|{
name|gradients_get_active_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_get_active_proc */
end_comment

begin_function
name|Argument
modifier|*
DECL|function|gradients_get_active_invoker (Argument * args)
name|gradients_get_active_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|int
name|success
decl_stmt|;
name|success
operator|=
operator|(
name|curr_gradient
operator|!=
name|NULL
operator|)
expr_stmt|;
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|gradients_get_active_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|curr_gradient
operator|->
name|name
argument_list|)
expr_stmt|;
return|return
name|return_args
return|;
block|}
end_function

begin_comment
comment|/* gradients_get_active_invoker */
end_comment

begin_comment
comment|/***** gradients_set_active *****/
end_comment

begin_decl_stmt
DECL|variable|gradients_set_active_args
name|ProcArg
name|gradients_set_active_args
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"name"
block|,
literal|"The name of the gradient to set"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_set_active_args */
end_comment

begin_decl_stmt
DECL|variable|gradients_set_active_proc
name|ProcRecord
name|gradients_set_active_proc
init|=
block|{
literal|"gimp_gradients_set_active"
block|,
literal|"Sets the specified gradient as the active gradient"
block|,
literal|"This procedure lets you set the specified gradient as the active "
literal|"or \"current\" one.  The name is simply a string which corresponds "
literal|"to one of the loaded gradients in the gradient editor.  If no "
literal|"matching gradient is found, this procedure will return an error. "
literal|"Otherwise, the specified gradient will become active and will be used "
literal|"for subsequent custom gradient operations."
block|,
literal|"Federico Mena Quintero"
block|,
literal|"Federico Mena Quintero"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/* Input arguments */
sizeof|sizeof
argument_list|(
name|gradients_set_active_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradients_set_active_args
index|[
literal|0
index|]
argument_list|)
block|,
name|gradients_set_active_args
block|,
comment|/* Output arguments */
literal|0
block|,
name|NULL
block|,
comment|/* Exec method */
block|{
block|{
name|gradients_set_active_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_set_active_proc */
end_comment

begin_function
name|gint
DECL|function|grad_set_grad_to_name (gchar * name)
name|grad_set_grad_to_name
parameter_list|(
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|GSList
modifier|*
name|list
decl_stmt|;
name|gradient_t
modifier|*
name|grad
decl_stmt|;
name|int
name|n
init|=
literal|0
decl_stmt|;
name|list
operator|=
name|gradients_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|grad
operator|=
name|list
operator|->
name|data
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|grad
operator|->
name|name
argument_list|,
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
comment|/* We found it! */
comment|/* Select that gradient in the listbox */
comment|/* Only if gradient editor has been created */
if|if
condition|(
name|g_editor
condition|)
block|{
name|gtk_clist_select_row
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|n
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_clist_moveto
argument_list|(
name|GTK_CLIST
argument_list|(
name|g_editor
operator|->
name|clist
argument_list|)
argument_list|,
name|n
argument_list|,
literal|0
argument_list|,
literal|0.5
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* force internal structs to use selected gradient */
name|GSList
modifier|*
name|tmp
init|=
name|g_slist_nth
argument_list|(
name|gradients_list
argument_list|,
name|n
argument_list|)
decl_stmt|;
if|if
condition|(
name|tmp
condition|)
name|curr_gradient
operator|=
operator|(
name|gradient_t
operator|*
operator|)
operator|(
name|tmp
operator|->
name|data
operator|)
expr_stmt|;
block|}
return|return
name|TRUE
return|;
block|}
comment|/* if */
name|n
operator|++
expr_stmt|;
name|list
operator|=
name|g_slist_next
argument_list|(
name|list
argument_list|)
expr_stmt|;
block|}
comment|/* while */
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|gradients_set_active_invoker (Argument * args)
name|gradients_set_active_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|char
modifier|*
name|name
decl_stmt|;
name|int
name|success
decl_stmt|;
name|name
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
name|success
operator|=
operator|(
name|name
operator|!=
name|NULL
operator|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
comment|/* See if we have a gradient with the specified name */
name|success
operator|=
name|grad_set_grad_to_name
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
comment|/* if */
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|gradients_set_active_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* gradients_set_active_invoker */
end_comment

begin_comment
comment|/***** gradients_sample_uniform *****/
end_comment

begin_decl_stmt
DECL|variable|gradients_sample_uniform_args
name|ProcArg
name|gradients_sample_uniform_args
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"num_samples"
block|,
literal|"The number of samples to take"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_sample_uniform_args */
end_comment

begin_decl_stmt
DECL|variable|gradients_sample_uniform_out_args
name|ProcArg
name|gradients_sample_uniform_out_args
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"array_length"
block|,
literal|"Length of the color_samples array (4 * num_samples)"
block|}
block|,
block|{
name|PDB_FLOATARRAY
block|,
literal|"color_samples"
block|,
literal|"Color samples: { R1, G1, B1, A1, ..., Rn, Gn, Bn, An }"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_sample_uniform_out_args */
end_comment

begin_decl_stmt
DECL|variable|gradients_sample_uniform_proc
name|ProcRecord
name|gradients_sample_uniform_proc
init|=
block|{
literal|"gimp_gradients_sample_uniform"
block|,
literal|"Sample the active gradient in uniform parts"
block|,
literal|"This procedure samples the active gradient from the gradient editor in the "
literal|"specified number of uniform parts.  It returns a list of floating-point values "
literal|"which correspond to the RGBA values for each sample.  The minimum number of "
literal|"samples to take is 2, in which case the returned colors will correspond to the "
literal|"{ 0.0, 1.0 } positions in the gradient.  For example, if the number of samples "
literal|"is 3, the procedure will return the colors at positions { 0.0, 0.5, 1.0 }."
block|,
literal|"Federico Mena Quintero"
block|,
literal|"Federico Mena Quintero"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/* Input arguments */
sizeof|sizeof
argument_list|(
name|gradients_sample_uniform_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradients_sample_uniform_args
index|[
literal|0
index|]
argument_list|)
block|,
name|gradients_sample_uniform_args
block|,
comment|/* Output arguments */
sizeof|sizeof
argument_list|(
name|gradients_sample_uniform_out_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradients_sample_uniform_out_args
index|[
literal|0
index|]
argument_list|)
block|,
name|gradients_sample_uniform_out_args
block|,
comment|/* Exec method */
block|{
block|{
name|gradients_sample_uniform_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_sample_uniform_proc */
end_comment

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|gradients_sample_uniform_invoker (Argument * args)
name|gradients_sample_uniform_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gdouble
modifier|*
name|values
decl_stmt|,
modifier|*
name|pv
decl_stmt|;
name|double
name|pos
decl_stmt|,
name|delta
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|success
decl_stmt|;
name|i
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|success
operator|=
operator|(
name|i
operator|>=
literal|2
operator|)
expr_stmt|;
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|gradients_sample_uniform_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|pos
operator|=
literal|0.0
expr_stmt|;
name|delta
operator|=
literal|1.0
operator|/
operator|(
name|i
operator|-
literal|1
operator|)
expr_stmt|;
name|values
operator|=
name|g_malloc
argument_list|(
name|i
operator|*
literal|4
operator|*
sizeof|sizeof
argument_list|(
name|gdouble
argument_list|)
argument_list|)
expr_stmt|;
name|pv
operator|=
name|values
expr_stmt|;
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|i
operator|*
literal|4
expr_stmt|;
while|while
condition|(
name|i
operator|--
condition|)
block|{
name|grad_get_color_at
argument_list|(
name|pos
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|r
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|g
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|b
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|a
expr_stmt|;
name|pos
operator|+=
name|delta
expr_stmt|;
block|}
comment|/* while */
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|values
expr_stmt|;
block|}
comment|/* if */
return|return
name|return_args
return|;
block|}
end_function

begin_comment
comment|/* gradients_sample_uniform_invoker */
end_comment

begin_comment
comment|/***** gradients_sample_custom *****/
end_comment

begin_decl_stmt
DECL|variable|gradients_sample_custom_args
name|ProcArg
name|gradients_sample_custom_args
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"num_samples"
block|,
literal|"The number of samples to take"
block|}
block|,
block|{
name|PDB_FLOATARRAY
block|,
literal|"positions"
block|,
literal|"The list of positions to sample along the gradient"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_sample_custom_args */
end_comment

begin_decl_stmt
DECL|variable|gradients_sample_custom_out_args
name|ProcArg
name|gradients_sample_custom_out_args
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"array_length"
block|,
literal|"Length of the color_samples array (4 * num_samples)"
block|}
block|,
block|{
name|PDB_FLOATARRAY
block|,
literal|"color_samples"
block|,
literal|"Color samples: { R1, G1, B1, A1, ..., Rn, Gn, Bn, An }"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_sample_custom_out_args */
end_comment

begin_decl_stmt
DECL|variable|gradients_sample_custom_proc
name|ProcRecord
name|gradients_sample_custom_proc
init|=
block|{
literal|"gimp_gradients_sample_custom"
block|,
literal|"Sample the active gradient in custom positions"
block|,
literal|"This procedure samples the active gradient from the gradient editor in "
literal|"the specified number of points.  The procedure will sample the gradient "
literal|"in the specified positions from the list.  The left endpoint of the "
literal|"gradient corresponds to position 0.0, and the right endpoint corresponds "
literal|"to 1.0.  The procedure returns a list of floating-point values which "
literal|"correspond to the RGBA values for each sample."
block|,
literal|"Federico Mena Quintero"
block|,
literal|"Federico Mena Quintero"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
comment|/* Input arguments */
sizeof|sizeof
argument_list|(
name|gradients_sample_custom_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradients_sample_custom_args
index|[
literal|0
index|]
argument_list|)
block|,
name|gradients_sample_custom_args
block|,
comment|/* Output arguments */
sizeof|sizeof
argument_list|(
name|gradients_sample_custom_out_args
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|gradients_sample_custom_out_args
index|[
literal|0
index|]
argument_list|)
block|,
name|gradients_sample_custom_out_args
block|,
comment|/* Exec method */
block|{
block|{
name|gradients_sample_custom_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_comment
comment|/* gradients_sample_custom_proc */
end_comment

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|gradients_sample_custom_invoker (Argument * args)
name|gradients_sample_custom_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gdouble
modifier|*
name|values
decl_stmt|,
modifier|*
name|pv
decl_stmt|;
name|gdouble
modifier|*
name|pos
decl_stmt|;
name|double
name|r
decl_stmt|,
name|g
decl_stmt|,
name|b
decl_stmt|,
name|a
decl_stmt|;
name|int
name|i
decl_stmt|;
name|int
name|success
decl_stmt|;
name|i
operator|=
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
name|success
operator|=
operator|(
name|i
operator|>
literal|0
operator|)
expr_stmt|;
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|gradients_sample_custom_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|pos
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
name|values
operator|=
name|g_malloc
argument_list|(
name|i
operator|*
literal|4
operator|*
sizeof|sizeof
argument_list|(
name|gdouble
argument_list|)
argument_list|)
expr_stmt|;
name|pv
operator|=
name|values
expr_stmt|;
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|i
operator|*
literal|4
expr_stmt|;
while|while
condition|(
name|i
operator|--
condition|)
block|{
name|grad_get_color_at
argument_list|(
operator|*
name|pos
argument_list|,
operator|&
name|r
argument_list|,
operator|&
name|g
argument_list|,
operator|&
name|b
argument_list|,
operator|&
name|a
argument_list|)
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|r
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|g
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|b
expr_stmt|;
operator|*
name|pv
operator|++
operator|=
name|a
expr_stmt|;
name|pos
operator|++
expr_stmt|;
block|}
comment|/* while */
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|values
expr_stmt|;
block|}
comment|/* if */
return|return
name|return_args
return|;
block|}
end_function

begin_comment
comment|/* gradients_sample_custom_invoker */
end_comment

end_unit

