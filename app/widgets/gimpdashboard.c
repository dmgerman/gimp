begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995-1999 Spencer Kimball and Peter Mattis  *  * gimpdashboard.c  * Copyright (C) 2017 Ell  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<https://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<stdarg.h>
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gio/gio.h>
end_include

begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|G_OS_WIN32
end_ifdef

begin_include
include|#
directive|include
file|<windows.h>
end_include

begin_include
include|#
directive|include
file|<psapi.h>
end_include

begin_define
DECL|macro|HAVE_CPU_GROUP
define|#
directive|define
name|HAVE_CPU_GROUP
end_define

begin_define
DECL|macro|HAVE_MEMORY_GROUP
define|#
directive|define
name|HAVE_MEMORY_GROUP
end_define

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* ! G_OS_WIN32 */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_TIMES_H
end_ifdef

begin_include
include|#
directive|include
file|<sys/times.h>
end_include

begin_define
DECL|macro|HAVE_CPU_GROUP
define|#
directive|define
name|HAVE_CPU_GROUP
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_SYS_TIMES_H */
end_comment

begin_if
if|#
directive|if
name|defined
argument_list|(
name|HAVE_UNISTD_H
argument_list|)
operator|&&
name|defined
argument_list|(
name|HAVE_FCNTL_H
argument_list|)
end_if

begin_include
include|#
directive|include
file|<unistd.h>
end_include

begin_include
include|#
directive|include
file|<fcntl.h>
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|_SC_PAGE_SIZE
end_ifdef

begin_define
DECL|macro|HAVE_MEMORY_GROUP
define|#
directive|define
name|HAVE_MEMORY_GROUP
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* _SC_PAGE_SIZE */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_UNISTD_H&& HAVE_FCNTL_H */
end_comment

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* ! G_OS_WIN32 */
end_comment

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpwidgets/gimpwidgets.h"
end_include

begin_include
include|#
directive|include
file|"widgets-types.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp-gui.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp-utils.h"
end_include

begin_include
include|#
directive|include
file|"core/gimp-parallel.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpasync.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpbacktrace.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpwaitable.h"
end_include

begin_include
include|#
directive|include
file|"gimpactiongroup.h"
end_include

begin_include
include|#
directive|include
file|"gimpdocked.h"
end_include

begin_include
include|#
directive|include
file|"gimpdashboard.h"
end_include

begin_include
include|#
directive|include
file|"gimpdialogfactory.h"
end_include

begin_include
include|#
directive|include
file|"gimphelp-ids.h"
end_include

begin_include
include|#
directive|include
file|"gimpmeter.h"
end_include

begin_include
include|#
directive|include
file|"gimpsessioninfo-aux.h"
end_include

begin_include
include|#
directive|include
file|"gimpuimanager.h"
end_include

begin_include
include|#
directive|include
file|"gimpwidgets-utils.h"
end_include

begin_include
include|#
directive|include
file|"gimpwindowstrategy.h"
end_include

begin_include
include|#
directive|include
file|"gimp-intl.h"
end_include

begin_include
include|#
directive|include
file|"gimp-version.h"
end_include

begin_define
DECL|macro|DEFAULT_UPDATE_INTERVAL
define|#
directive|define
name|DEFAULT_UPDATE_INTERVAL
value|GIMP_DASHBOARD_UPDATE_INTERVAL_0_25_SEC
end_define

begin_define
DECL|macro|DEFAULT_HISTORY_DURATION
define|#
directive|define
name|DEFAULT_HISTORY_DURATION
value|GIMP_DASHBOARD_HISTORY_DURATION_60_SEC
end_define

begin_define
DECL|macro|DEFAULT_LOW_SWAP_SPACE_WARNING
define|#
directive|define
name|DEFAULT_LOW_SWAP_SPACE_WARNING
value|TRUE
end_define

begin_define
DECL|macro|LOW_SWAP_SPACE_WARNING_ON
define|#
directive|define
name|LOW_SWAP_SPACE_WARNING_ON
comment|/* swap occupied is above */
value|0.90
end_define

begin_comment
DECL|macro|LOW_SWAP_SPACE_WARNING_ON
comment|/* of swap limit */
end_comment

begin_define
DECL|macro|LOW_SWAP_SPACE_WARNING_OFF
define|#
directive|define
name|LOW_SWAP_SPACE_WARNING_OFF
comment|/* swap occupied is below */
value|0.85
end_define

begin_comment
DECL|macro|LOW_SWAP_SPACE_WARNING_OFF
comment|/* of swap limit */
end_comment

begin_define
DECL|macro|CPU_ACTIVE_ON
define|#
directive|define
name|CPU_ACTIVE_ON
comment|/* individual cpu usage is above */
value|0.75
end_define

begin_define
DECL|macro|CPU_ACTIVE_OFF
define|#
directive|define
name|CPU_ACTIVE_OFF
comment|/* individual cpu usage is below */
value|0.25
end_define

begin_define
DECL|macro|LOG_VERSION
define|#
directive|define
name|LOG_VERSION
value|1
end_define

begin_define
DECL|macro|LOG_SAMPLE_FREQUENCY
define|#
directive|define
name|LOG_SAMPLE_FREQUENCY
value|10
end_define

begin_comment
DECL|macro|LOG_SAMPLE_FREQUENCY
comment|/* samples per second */
end_comment

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2a0d52400103
block|{
DECL|enumerator|VARIABLE_NONE
name|VARIABLE_NONE
block|,
DECL|enumerator|FIRST_VARIABLE
name|FIRST_VARIABLE
block|,
comment|/* cache */
DECL|enumerator|VARIABLE_CACHE_OCCUPIED
name|VARIABLE_CACHE_OCCUPIED
init|=
name|FIRST_VARIABLE
block|,
DECL|enumerator|VARIABLE_CACHE_MAXIMUM
name|VARIABLE_CACHE_MAXIMUM
block|,
DECL|enumerator|VARIABLE_CACHE_LIMIT
name|VARIABLE_CACHE_LIMIT
block|,
DECL|enumerator|VARIABLE_CACHE_COMPRESSION
name|VARIABLE_CACHE_COMPRESSION
block|,
DECL|enumerator|VARIABLE_CACHE_HIT_MISS
name|VARIABLE_CACHE_HIT_MISS
block|,
comment|/* swap */
DECL|enumerator|VARIABLE_SWAP_OCCUPIED
name|VARIABLE_SWAP_OCCUPIED
block|,
DECL|enumerator|VARIABLE_SWAP_SIZE
name|VARIABLE_SWAP_SIZE
block|,
DECL|enumerator|VARIABLE_SWAP_LIMIT
name|VARIABLE_SWAP_LIMIT
block|,
DECL|enumerator|VARIABLE_SWAP_QUEUED
name|VARIABLE_SWAP_QUEUED
block|,
DECL|enumerator|VARIABLE_SWAP_QUEUE_STALLS
name|VARIABLE_SWAP_QUEUE_STALLS
block|,
DECL|enumerator|VARIABLE_SWAP_QUEUE_FULL
name|VARIABLE_SWAP_QUEUE_FULL
block|,
DECL|enumerator|VARIABLE_SWAP_READ
name|VARIABLE_SWAP_READ
block|,
DECL|enumerator|VARIABLE_SWAP_READ_THROUGHPUT
name|VARIABLE_SWAP_READ_THROUGHPUT
block|,
DECL|enumerator|VARIABLE_SWAP_WRITTEN
name|VARIABLE_SWAP_WRITTEN
block|,
DECL|enumerator|VARIABLE_SWAP_WRITE_THROUGHPUT
name|VARIABLE_SWAP_WRITE_THROUGHPUT
block|,
DECL|enumerator|VARIABLE_SWAP_COMPRESSION
name|VARIABLE_SWAP_COMPRESSION
block|,
ifdef|#
directive|ifdef
name|HAVE_CPU_GROUP
comment|/* cpu */
DECL|enumerator|VARIABLE_CPU_USAGE
name|VARIABLE_CPU_USAGE
block|,
DECL|enumerator|VARIABLE_CPU_ACTIVE
name|VARIABLE_CPU_ACTIVE
block|,
DECL|enumerator|VARIABLE_CPU_ACTIVE_TIME
name|VARIABLE_CPU_ACTIVE_TIME
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|HAVE_MEMORY_GROUP
comment|/* memory */
DECL|enumerator|VARIABLE_MEMORY_USED
name|VARIABLE_MEMORY_USED
block|,
DECL|enumerator|VARIABLE_MEMORY_AVAILABLE
name|VARIABLE_MEMORY_AVAILABLE
block|,
DECL|enumerator|VARIABLE_MEMORY_SIZE
name|VARIABLE_MEMORY_SIZE
block|,
endif|#
directive|endif
comment|/* misc */
DECL|enumerator|VARIABLE_MIPMAPED
name|VARIABLE_MIPMAPED
block|,
DECL|enumerator|VARIABLE_ASYNC_RUNNING
name|VARIABLE_ASYNC_RUNNING
block|,
DECL|enumerator|VARIABLE_SCRATCH_TOTAL
name|VARIABLE_SCRATCH_TOTAL
block|,
DECL|enumerator|N_VARIABLES
name|N_VARIABLES
block|,
DECL|enumerator|VARIABLE_SEPARATOR
name|VARIABLE_SEPARATOR
DECL|typedef|Variable
block|}
name|Variable
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2a0d52400203
block|{
DECL|enumerator|VARIABLE_TYPE_BOOLEAN
name|VARIABLE_TYPE_BOOLEAN
block|,
DECL|enumerator|VARIABLE_TYPE_INTEGER
name|VARIABLE_TYPE_INTEGER
block|,
DECL|enumerator|VARIABLE_TYPE_SIZE
name|VARIABLE_TYPE_SIZE
block|,
DECL|enumerator|VARIABLE_TYPE_SIZE_RATIO
name|VARIABLE_TYPE_SIZE_RATIO
block|,
DECL|enumerator|VARIABLE_TYPE_INT_RATIO
name|VARIABLE_TYPE_INT_RATIO
block|,
DECL|enumerator|VARIABLE_TYPE_PERCENTAGE
name|VARIABLE_TYPE_PERCENTAGE
block|,
DECL|enumerator|VARIABLE_TYPE_DURATION
name|VARIABLE_TYPE_DURATION
block|,
DECL|enumerator|VARIABLE_TYPE_RATE_OF_CHANGE
name|VARIABLE_TYPE_RATE_OF_CHANGE
DECL|typedef|VariableType
block|}
name|VariableType
typedef|;
end_typedef

begin_typedef
typedef|typedef
enum|enum
DECL|enum|__anon2a0d52400303
block|{
DECL|enumerator|FIRST_GROUP
name|FIRST_GROUP
block|,
DECL|enumerator|GROUP_CACHE
name|GROUP_CACHE
init|=
name|FIRST_GROUP
block|,
DECL|enumerator|GROUP_SWAP
name|GROUP_SWAP
block|,
ifdef|#
directive|ifdef
name|HAVE_CPU_GROUP
DECL|enumerator|GROUP_CPU
name|GROUP_CPU
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|HAVE_MEMORY_GROUP
DECL|enumerator|GROUP_MEMORY
name|GROUP_MEMORY
block|,
endif|#
directive|endif
DECL|enumerator|GROUP_MISC
name|GROUP_MISC
block|,
DECL|enumerator|N_GROUPS
name|N_GROUPS
DECL|typedef|Group
block|}
name|Group
typedef|;
end_typedef

begin_typedef
DECL|typedef|VariableInfo
typedef|typedef
name|struct
name|_VariableInfo
name|VariableInfo
typedef|;
end_typedef

begin_typedef
DECL|typedef|FieldInfo
typedef|typedef
name|struct
name|_FieldInfo
name|FieldInfo
typedef|;
end_typedef

begin_typedef
DECL|typedef|GroupInfo
typedef|typedef
name|struct
name|_GroupInfo
name|GroupInfo
typedef|;
end_typedef

begin_typedef
DECL|typedef|VariableData
typedef|typedef
name|struct
name|_VariableData
name|VariableData
typedef|;
end_typedef

begin_typedef
DECL|typedef|FieldData
typedef|typedef
name|struct
name|_FieldData
name|FieldData
typedef|;
end_typedef

begin_typedef
DECL|typedef|GroupData
typedef|typedef
name|struct
name|_GroupData
name|GroupData
typedef|;
end_typedef

begin_typedef
DECL|typedef|VariableFunc
typedef|typedef
name|void
function_decl|(
modifier|*
name|VariableFunc
function_decl|)
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_typedef

begin_struct
DECL|struct|_VariableInfo
struct|struct
name|_VariableInfo
block|{
DECL|member|name
specifier|const
name|gchar
modifier|*
name|name
decl_stmt|;
DECL|member|title
specifier|const
name|gchar
modifier|*
name|title
decl_stmt|;
DECL|member|description
specifier|const
name|gchar
modifier|*
name|description
decl_stmt|;
DECL|member|type
name|VariableType
name|type
decl_stmt|;
DECL|member|exclude_from_log
name|gboolean
name|exclude_from_log
decl_stmt|;
DECL|member|color
name|GimpRGB
name|color
decl_stmt|;
DECL|member|sample_func
name|VariableFunc
name|sample_func
decl_stmt|;
DECL|member|reset_func
name|VariableFunc
name|reset_func
decl_stmt|;
DECL|member|data
name|gconstpointer
name|data
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_FieldInfo
struct|struct
name|_FieldInfo
block|{
DECL|member|variable
name|Variable
name|variable
decl_stmt|;
DECL|member|title
specifier|const
name|gchar
modifier|*
name|title
decl_stmt|;
DECL|member|default_active
name|gboolean
name|default_active
decl_stmt|;
DECL|member|show_in_header
name|gboolean
name|show_in_header
decl_stmt|;
DECL|member|meter_variable
name|Variable
name|meter_variable
decl_stmt|;
DECL|member|meter_value
name|gint
name|meter_value
decl_stmt|;
DECL|member|meter_cumulative
name|gboolean
name|meter_cumulative
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_GroupInfo
struct|struct
name|_GroupInfo
block|{
DECL|member|name
specifier|const
name|gchar
modifier|*
name|name
decl_stmt|;
DECL|member|title
specifier|const
name|gchar
modifier|*
name|title
decl_stmt|;
DECL|member|description
specifier|const
name|gchar
modifier|*
name|description
decl_stmt|;
DECL|member|default_active
name|gboolean
name|default_active
decl_stmt|;
DECL|member|default_expanded
name|gboolean
name|default_expanded
decl_stmt|;
DECL|member|has_meter
name|gboolean
name|has_meter
decl_stmt|;
DECL|member|meter_limit
name|Variable
name|meter_limit
decl_stmt|;
DECL|member|meter_led
specifier|const
name|Variable
modifier|*
name|meter_led
decl_stmt|;
DECL|member|fields
specifier|const
name|FieldInfo
modifier|*
name|fields
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_VariableData
struct|struct
name|_VariableData
block|{
DECL|member|available
name|gboolean
name|available
decl_stmt|;
union|union
DECL|union|__anon2a0d5240040a
block|{
DECL|member|boolean
name|gboolean
name|boolean
decl_stmt|;
DECL|member|integer
name|gint
name|integer
decl_stmt|;
DECL|member|size
name|guint64
name|size
decl_stmt|;
comment|/* in bytes                   */
struct|struct
DECL|struct|__anon2a0d52400508
block|{
DECL|member|antecedent
name|guint64
name|antecedent
decl_stmt|;
DECL|member|consequent
name|guint64
name|consequent
decl_stmt|;
DECL|member|size_ratio
block|}
name|size_ratio
struct|;
struct|struct
DECL|struct|__anon2a0d52400608
block|{
DECL|member|antecedent
name|gint
name|antecedent
decl_stmt|;
DECL|member|consequent
name|gint
name|consequent
decl_stmt|;
DECL|member|int_ratio
block|}
name|int_ratio
struct|;
DECL|member|percentage
name|gdouble
name|percentage
decl_stmt|;
comment|/* from 0 to 1                */
DECL|member|duration
name|gdouble
name|duration
decl_stmt|;
comment|/* in seconds                 */
DECL|member|rate_of_change
name|gdouble
name|rate_of_change
decl_stmt|;
comment|/* in source units per second */
DECL|member|value
block|}
name|value
union|;
DECL|member|data
name|gpointer
name|data
decl_stmt|;
DECL|member|data_size
name|gsize
name|data_size
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_FieldData
struct|struct
name|_FieldData
block|{
DECL|member|active
name|gboolean
name|active
decl_stmt|;
DECL|member|menu_item
name|GtkCheckMenuItem
modifier|*
name|menu_item
decl_stmt|;
DECL|member|value_label
name|GtkLabel
modifier|*
name|value_label
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_GroupData
struct|struct
name|_GroupData
block|{
DECL|member|n_fields
name|gint
name|n_fields
decl_stmt|;
DECL|member|n_meter_values
name|gint
name|n_meter_values
decl_stmt|;
DECL|member|active
name|gboolean
name|active
decl_stmt|;
DECL|member|limit
name|gdouble
name|limit
decl_stmt|;
DECL|member|action
name|GtkToggleAction
modifier|*
name|action
decl_stmt|;
DECL|member|expander
name|GtkExpander
modifier|*
name|expander
decl_stmt|;
DECL|member|header_values_label
name|GtkLabel
modifier|*
name|header_values_label
decl_stmt|;
DECL|member|menu_button
name|GtkButton
modifier|*
name|menu_button
decl_stmt|;
DECL|member|menu
name|GtkMenu
modifier|*
name|menu
decl_stmt|;
DECL|member|meter
name|GimpMeter
modifier|*
name|meter
decl_stmt|;
DECL|member|grid
name|GtkGrid
modifier|*
name|grid
decl_stmt|;
DECL|member|fields
name|FieldData
modifier|*
name|fields
decl_stmt|;
block|}
struct|;
end_struct

begin_struct
DECL|struct|_GimpDashboardPrivate
struct|struct
name|_GimpDashboardPrivate
block|{
DECL|member|gimp
name|Gimp
modifier|*
name|gimp
decl_stmt|;
DECL|member|variables
name|VariableData
name|variables
index|[
name|N_VARIABLES
index|]
decl_stmt|;
DECL|member|groups
name|GroupData
name|groups
index|[
name|N_GROUPS
index|]
decl_stmt|;
DECL|member|thread
name|GThread
modifier|*
name|thread
decl_stmt|;
DECL|member|mutex
name|GMutex
name|mutex
decl_stmt|;
DECL|member|cond
name|GCond
name|cond
decl_stmt|;
DECL|member|quit
name|gboolean
name|quit
decl_stmt|;
DECL|member|update_now
name|gboolean
name|update_now
decl_stmt|;
DECL|member|update_idle_id
name|gint
name|update_idle_id
decl_stmt|;
DECL|member|low_swap_space_idle_id
name|gint
name|low_swap_space_idle_id
decl_stmt|;
DECL|member|update_interval
name|GimpDashboardUpdateInteval
name|update_interval
decl_stmt|;
DECL|member|history_duration
name|GimpDashboardHistoryDuration
name|history_duration
decl_stmt|;
DECL|member|low_swap_space_warning
name|gboolean
name|low_swap_space_warning
decl_stmt|;
DECL|member|log_output
name|GOutputStream
modifier|*
name|log_output
decl_stmt|;
DECL|member|log_error
name|GError
modifier|*
name|log_error
decl_stmt|;
DECL|member|log_start_time
name|gint64
name|log_start_time
decl_stmt|;
DECL|member|log_sample_frequency
name|gint
name|log_sample_frequency
decl_stmt|;
DECL|member|log_n_samples
name|gint
name|log_n_samples
decl_stmt|;
DECL|member|log_n_markers
name|gint
name|log_n_markers
decl_stmt|;
DECL|member|log_variables
name|VariableData
name|log_variables
index|[
name|N_VARIABLES
index|]
decl_stmt|;
DECL|member|log_include_backtrace
name|gboolean
name|log_include_backtrace
decl_stmt|;
DECL|member|log_backtrace
name|GimpBacktrace
modifier|*
name|log_backtrace
decl_stmt|;
DECL|member|log_addresses
name|GHashTable
modifier|*
name|log_addresses
decl_stmt|;
DECL|member|log_record_button
name|GtkWidget
modifier|*
name|log_record_button
decl_stmt|;
DECL|member|log_add_marker_label
name|GtkLabel
modifier|*
name|log_add_marker_label
decl_stmt|;
block|}
struct|;
end_struct

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_docked_iface_init
parameter_list|(
name|GimpDockedInterface
modifier|*
name|iface
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_constructed
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_map
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_set_aux_info
parameter_list|(
name|GimpDocked
modifier|*
name|docked
parameter_list|,
name|GList
modifier|*
name|aux_info
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GList
modifier|*
name|gimp_dashboard_get_aux_info
parameter_list|(
name|GimpDocked
modifier|*
name|docked
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_dashboard_group_expander_button_press
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_group_action_toggled
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GtkToggleAction
modifier|*
name|action
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_field_menu_item_toggled
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GtkCheckMenuItem
modifier|*
name|item
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gpointer
name|gimp_dashboard_sample
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_dashboard_update
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_dashboard_low_swap_space
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_function
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_gegl_config
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_gegl_stats
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_variable_changed
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_variable_rate_of_change
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_swap_limit
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CPU_GROUP
end_ifdef

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_cpu_usage
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_cpu_active
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_cpu_active_time
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_CPU_GROUP */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_MEMORY_GROUP
end_ifdef

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_memory_used
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_memory_available
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_memory_size
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_MEMORY_GROUP */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_sample_object
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_update_groups
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_update_group
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_update_group_values
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_group_set_active
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|,
name|gboolean
name|active
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_field_set_active
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|,
name|gint
name|field
parameter_list|,
name|gboolean
name|active
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_reset_unlocked
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_reset_variables
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gpointer
name|gimp_dashboard_variable_get_data
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|,
name|gsize
name|size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_dashboard_variable_to_boolean
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gdouble
name|gimp_dashboard_variable_to_double
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gchar
modifier|*
name|gimp_dashboard_field_to_string
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|,
name|gint
name|field
parameter_list|,
name|gboolean
name|full
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_dashboard_log_printf
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
specifier|const
name|gchar
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
function_decl|G_GNUC_PRINTF
parameter_list|(
function_decl|2
operator|,
function_decl|3
end_function_decl

begin_empty_stmt
unit|)
empty_stmt|;
end_empty_stmt

begin_function_decl
specifier|static
name|gboolean
name|gimp_dashboard_log_print_escaped
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
specifier|const
name|gchar
modifier|*
name|string
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint64
name|gimp_dashboard_log_time
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_log_sample
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|gboolean
name|variables_changed
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_log_update_highlight
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_log_update_n_markers
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_log_write_address_map
parameter_list|(
name|GimpAsync
modifier|*
name|async
parameter_list|,
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_dashboard_field_use_meter_underlay
parameter_list|(
name|Group
name|group
parameter_list|,
name|gint
name|field
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gchar
modifier|*
name|gimp_dashboard_format_rate_of_change
parameter_list|(
specifier|const
name|gchar
modifier|*
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gchar
modifier|*
name|gimp_dashboard_format_value
parameter_list|(
name|VariableType
name|type
parameter_list|,
name|gdouble
name|value
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_dashboard_label_set_text
parameter_list|(
name|GtkLabel
modifier|*
name|label
parameter_list|,
specifier|const
name|gchar
modifier|*
name|text
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/*  static variables  */
end_comment

begin_decl_stmt
DECL|variable|variables
specifier|static
specifier|const
name|VariableInfo
name|variables
index|[]
init|=
block|{
comment|/* cache variables */
index|[
name|VARIABLE_CACHE_OCCUPIED
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cache-occupied"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Occupied"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Tile cache occupied size"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.3
block|,
literal|0.6
block|,
literal|0.3
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"tile-cache-total"
block|}
block|,
index|[
name|VARIABLE_CACHE_MAXIMUM
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cache-maximum"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Maximum"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Maximal tile cache occupied size"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.3
block|,
literal|0.7
block|,
literal|0.8
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"tile-cache-total-max"
block|}
block|,
index|[
name|VARIABLE_CACHE_LIMIT
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cache-limit"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Limit"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Tile cache size limit"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_config
block|,
operator|.
name|data
operator|=
literal|"tile-cache-size"
block|}
block|,
index|[
name|VARIABLE_CACHE_COMPRESSION
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cache-compression"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Compression"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Tile cache compression ratio"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE_RATIO
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"tile-cache-total\0"
literal|"tile-cache-total-uncompressed"
block|}
block|,
index|[
name|VARIABLE_CACHE_HIT_MISS
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cache-hit-miss"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Hit/Miss"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Tile cache hit/miss ratio"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_INT_RATIO
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"tile-cache-hits\0"
literal|"tile-cache-misses"
block|}
block|,
comment|/* swap variables */
index|[
name|VARIABLE_SWAP_OCCUPIED
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-occupied"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Occupied"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Swap file occupied size"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.2
block|,
literal|0.2
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"swap-total"
block|}
block|,
index|[
name|VARIABLE_SWAP_SIZE
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-size"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Size"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Swap file size"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.6
block|,
literal|0.4
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"swap-file-size"
block|}
block|,
index|[
name|VARIABLE_SWAP_LIMIT
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-limit"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Limit"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Swap file size limit"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_swap_limit
block|,   }
block|,
index|[
name|VARIABLE_SWAP_QUEUED
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-queued"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Queued"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Size of data queued for writing to the swap"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.8
block|,
literal|0.2
block|,
literal|0.5
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"swap-queued-total"
block|}
block|,
index|[
name|VARIABLE_SWAP_QUEUE_STALLS
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-queue-stalls"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Queue stalls"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Number of times the writing to the swap has been "
literal|"stalled, due to a full queue"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_INTEGER
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"swap-queue-stalls"
block|}
block|,
index|[
name|VARIABLE_SWAP_QUEUE_FULL
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-queue-full"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Queue full"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Whether the swap queue is full"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_BOOLEAN
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_variable_changed
block|,
operator|.
name|data
operator|=
name|GINT_TO_POINTER
argument_list|(
argument|VARIABLE_SWAP_QUEUE_STALLS
argument_list|)
block|}
block|,
index|[
name|VARIABLE_SWAP_READ
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-read"
block|,
comment|/* Translators: this is the past participle form of "read",      *              as in "total amount of data read from the swap".      */
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Read"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Total amount of data read from the swap"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.2
block|,
literal|0.4
block|,
literal|1.0
block|,
literal|0.4
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"swap-read-total"
block|}
block|,
index|[
name|VARIABLE_SWAP_READ_THROUGHPUT
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-read-throughput"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Read throughput"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"The rate at which data is read from the swap"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_RATE_OF_CHANGE
block|,
operator|.
name|color
operator|=
block|{
literal|0.2
block|,
literal|0.4
block|,
literal|1.0
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_variable_rate_of_change
block|,
operator|.
name|data
operator|=
name|GINT_TO_POINTER
argument_list|(
argument|VARIABLE_SWAP_READ
argument_list|)
block|}
block|,
index|[
name|VARIABLE_SWAP_WRITTEN
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-written"
block|,
comment|/* Translators: this is the past participle form of "write",      *              as in "total amount of data written to the swap".      */
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Written"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Total amount of data written to the swap"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.3
block|,
literal|0.2
block|,
literal|0.4
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"swap-write-total"
block|}
block|,
index|[
name|VARIABLE_SWAP_WRITE_THROUGHPUT
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-write-throughput"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Write throughput"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"The rate at which data is written to the swap"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_RATE_OF_CHANGE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.3
block|,
literal|0.2
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_variable_rate_of_change
block|,
operator|.
name|data
operator|=
name|GINT_TO_POINTER
argument_list|(
argument|VARIABLE_SWAP_WRITTEN
argument_list|)
block|}
block|,
index|[
name|VARIABLE_SWAP_COMPRESSION
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap-compression"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Compression"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Swap compression ratio"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE_RATIO
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"swap-total\0"
literal|"swap-total-uncompressed"
block|}
block|,
ifdef|#
directive|ifdef
name|HAVE_CPU_GROUP
comment|/* cpu variables */
index|[
name|VARIABLE_CPU_USAGE
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cpu-usage"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Usage"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Total CPU usage"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_PERCENTAGE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.7
block|,
literal|0.2
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_cpu_usage
block|}
block|,
index|[
name|VARIABLE_CPU_ACTIVE
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cpu-active"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Active"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Whether the CPU is active"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_BOOLEAN
block|,
operator|.
name|color
operator|=
block|{
literal|0.9
block|,
literal|0.8
block|,
literal|0.3
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_cpu_active
block|}
block|,
index|[
name|VARIABLE_CPU_ACTIVE_TIME
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cpu-active-time"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Active"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Total amount of time the CPU has been active"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_DURATION
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.7
block|,
literal|0.2
block|,
literal|0.4
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_cpu_active_time
block|}
block|,
endif|#
directive|endif
comment|/* HAVE_CPU_GROUP */
ifdef|#
directive|ifdef
name|HAVE_MEMORY_GROUP
comment|/* memory variables */
index|[
name|VARIABLE_MEMORY_USED
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"memory-used"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Used"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Amount of memory used by the process"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.5
block|,
literal|0.2
block|,
literal|1.0
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_memory_used
block|}
block|,
index|[
name|VARIABLE_MEMORY_AVAILABLE
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"memory-available"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Available"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Amount of available physical memory"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|color
operator|=
block|{
literal|0.8
block|,
literal|0.5
block|,
literal|0.2
block|,
literal|0.4
block|}
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_memory_available
block|}
block|,
index|[
name|VARIABLE_MEMORY_SIZE
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"memory-size"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Size"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Physical memory size"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_memory_size
block|}
block|,
endif|#
directive|endif
comment|/* HAVE_MEMORY_GROUP */
comment|/* misc variables */
index|[
name|VARIABLE_MIPMAPED
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"mipmapped"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Mipmapped"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Total size of processed mipmapped data"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"zoom-total"
block|}
block|,
index|[
name|VARIABLE_ASYNC_RUNNING
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"async-running"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Async"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Number of ongoing asynchronous operations"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_INTEGER
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_function
block|,
operator|.
name|data
operator|=
name|gimp_async_get_n_running
block|}
block|,
index|[
name|VARIABLE_SCRATCH_TOTAL
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"scratch-total"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Scratch"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Total size of scratch memory"
argument_list|)
block|,
operator|.
name|type
operator|=
name|VARIABLE_TYPE_SIZE
block|,
operator|.
name|sample_func
operator|=
name|gimp_dashboard_sample_gegl_stats
block|,
operator|.
name|data
operator|=
literal|"scratch-total"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|groups
specifier|static
specifier|const
name|GroupInfo
name|groups
index|[]
init|=
block|{
comment|/* cache group */
index|[
name|GROUP_CACHE
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cache"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-group"
argument_list|,
literal|"Cache"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"In-memory tile cache"
argument_list|)
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|default_expanded
operator|=
name|TRUE
block|,
operator|.
name|has_meter
operator|=
name|TRUE
block|,
operator|.
name|meter_limit
operator|=
name|VARIABLE_CACHE_LIMIT
block|,
operator|.
name|fields
operator|=
operator|(
specifier|const
name|FieldInfo
index|[]
operator|)
block|{
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CACHE_OCCUPIED
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|show_in_header
operator|=
name|TRUE
block|,
operator|.
name|meter_value
operator|=
literal|2
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CACHE_MAXIMUM
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|,
operator|.
name|meter_value
operator|=
literal|1
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CACHE_LIMIT
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|}
block|,
block|{
name|VARIABLE_SEPARATOR
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CACHE_COMPRESSION
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CACHE_HIT_MISS
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|}
block|,
block|{}
block|}
block|}
block|,
comment|/* swap group */
index|[
name|GROUP_SWAP
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"swap"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-group"
argument_list|,
literal|"Swap"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"On-disk tile swap"
argument_list|)
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|default_expanded
operator|=
name|TRUE
block|,
operator|.
name|has_meter
operator|=
name|TRUE
block|,
operator|.
name|meter_limit
operator|=
name|VARIABLE_SWAP_LIMIT
block|,
operator|.
name|meter_led
operator|=
operator|(
specifier|const
name|Variable
index|[]
operator|)
block|{
name|VARIABLE_SWAP_QUEUE_FULL
block|,
name|VARIABLE_SWAP_READ_THROUGHPUT
block|,
name|VARIABLE_SWAP_WRITE_THROUGHPUT
block|,
name|VARIABLE_NONE
block|}
block|,
operator|.
name|fields
operator|=
operator|(
specifier|const
name|FieldInfo
index|[]
operator|)
block|{
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SWAP_OCCUPIED
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|show_in_header
operator|=
name|TRUE
block|,
operator|.
name|meter_value
operator|=
literal|5
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SWAP_SIZE
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|meter_value
operator|=
literal|4
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SWAP_LIMIT
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|}
block|,
block|{
name|VARIABLE_SEPARATOR
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SWAP_QUEUED
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|,
operator|.
name|meter_variable
operator|=
name|VARIABLE_SWAP_QUEUE_FULL
block|,
operator|.
name|meter_value
operator|=
literal|3
block|}
block|,
block|{
name|VARIABLE_SEPARATOR
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SWAP_READ
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|,
operator|.
name|meter_variable
operator|=
name|VARIABLE_SWAP_READ_THROUGHPUT
block|,
operator|.
name|meter_value
operator|=
literal|2
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SWAP_WRITTEN
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|,
operator|.
name|meter_variable
operator|=
name|VARIABLE_SWAP_WRITE_THROUGHPUT
block|,
operator|.
name|meter_value
operator|=
literal|1
block|}
block|,
block|{
name|VARIABLE_SEPARATOR
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SWAP_COMPRESSION
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|}
block|,
block|{}
block|}
block|}
block|,
ifdef|#
directive|ifdef
name|HAVE_CPU_GROUP
comment|/* cpu group */
index|[
name|GROUP_CPU
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"cpu"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-group"
argument_list|,
literal|"CPU"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"CPU usage"
argument_list|)
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|default_expanded
operator|=
name|FALSE
block|,
operator|.
name|has_meter
operator|=
name|TRUE
block|,
operator|.
name|meter_led
operator|=
operator|(
specifier|const
name|Variable
index|[]
operator|)
block|{
name|VARIABLE_CPU_ACTIVE
block|,
name|VARIABLE_NONE
block|}
block|,
operator|.
name|fields
operator|=
operator|(
specifier|const
name|FieldInfo
index|[]
operator|)
block|{
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CPU_USAGE
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|show_in_header
operator|=
name|TRUE
block|,
operator|.
name|meter_value
operator|=
literal|2
block|}
block|,
block|{
name|VARIABLE_SEPARATOR
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CPU_ACTIVE_TIME
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|,
operator|.
name|meter_variable
operator|=
name|VARIABLE_CPU_ACTIVE
block|,
operator|.
name|meter_value
operator|=
literal|1
block|}
block|,
block|{}
block|}
block|}
block|,
endif|#
directive|endif
comment|/* HAVE_CPU_GROUP */
ifdef|#
directive|ifdef
name|HAVE_MEMORY_GROUP
comment|/* memory group */
index|[
name|GROUP_MEMORY
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"memory"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-group"
argument_list|,
literal|"Memory"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Memory usage"
argument_list|)
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|default_expanded
operator|=
name|FALSE
block|,
operator|.
name|has_meter
operator|=
name|TRUE
block|,
operator|.
name|meter_limit
operator|=
name|VARIABLE_MEMORY_SIZE
block|,
operator|.
name|fields
operator|=
operator|(
specifier|const
name|FieldInfo
index|[]
operator|)
block|{
block|{
operator|.
name|variable
operator|=
name|VARIABLE_CACHE_OCCUPIED
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-variable"
argument_list|,
literal|"Cache"
argument_list|)
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|,
operator|.
name|meter_value
operator|=
literal|3
block|}
block|,
block|{
name|VARIABLE_SEPARATOR
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_MEMORY_USED
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|show_in_header
operator|=
name|TRUE
block|,
operator|.
name|meter_value
operator|=
literal|2
block|,
operator|.
name|meter_cumulative
operator|=
name|TRUE
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_MEMORY_AVAILABLE
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|,
operator|.
name|meter_value
operator|=
literal|1
block|,
operator|.
name|meter_cumulative
operator|=
name|TRUE
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_MEMORY_SIZE
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|}
block|,
block|{}
block|}
block|}
block|,
endif|#
directive|endif
comment|/* HAVE_MEMORY_GROUP */
comment|/* misc group */
index|[
name|GROUP_MISC
index|]
operator|=
block|{
operator|.
name|name
operator|=
literal|"misc"
block|,
operator|.
name|title
operator|=
name|NC_
argument_list|(
literal|"dashboard-group"
argument_list|,
literal|"Misc"
argument_list|)
block|,
operator|.
name|description
operator|=
name|N_
argument_list|(
literal|"Miscellaneous information"
argument_list|)
block|,
operator|.
name|default_active
operator|=
name|FALSE
block|,
operator|.
name|default_expanded
operator|=
name|FALSE
block|,
operator|.
name|has_meter
operator|=
name|FALSE
block|,
operator|.
name|fields
operator|=
operator|(
specifier|const
name|FieldInfo
index|[]
operator|)
block|{
block|{
operator|.
name|variable
operator|=
name|VARIABLE_MIPMAPED
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_ASYNC_RUNNING
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|}
block|,
block|{
operator|.
name|variable
operator|=
name|VARIABLE_SCRATCH_TOTAL
block|,
operator|.
name|default_active
operator|=
name|TRUE
block|}
block|,
block|{}
block|}
block|}
block|, }
decl_stmt|;
end_decl_stmt

begin_macro
name|G_DEFINE_TYPE_WITH_CODE
argument_list|(
argument|GimpDashboard
argument_list|,
argument|gimp_dashboard
argument_list|,
argument|GIMP_TYPE_EDITOR
argument_list|,
argument|G_ADD_PRIVATE (GimpDashboard)                          G_IMPLEMENT_INTERFACE (GIMP_TYPE_DOCKED,                                                 gimp_dashboard_docked_iface_init)
argument_list|)
end_macro

begin_define
DECL|macro|parent_class
define|#
directive|define
name|parent_class
value|gimp_dashboard_parent_class
end_define

begin_decl_stmt
specifier|static
name|GimpDockedInterface
modifier|*
name|parent_docked_iface
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_comment
comment|/*  private functions  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_class_init (GimpDashboardClass * klass)
name|gimp_dashboard_class_init
parameter_list|(
name|GimpDashboardClass
modifier|*
name|klass
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|object_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GtkWidgetClass
modifier|*
name|widget_class
init|=
name|GTK_WIDGET_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|object_class
operator|->
name|constructed
operator|=
name|gimp_dashboard_constructed
expr_stmt|;
name|object_class
operator|->
name|dispose
operator|=
name|gimp_dashboard_dispose
expr_stmt|;
name|object_class
operator|->
name|finalize
operator|=
name|gimp_dashboard_finalize
expr_stmt|;
name|widget_class
operator|->
name|map
operator|=
name|gimp_dashboard_map
expr_stmt|;
name|widget_class
operator|->
name|unmap
operator|=
name|gimp_dashboard_unmap
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_init (GimpDashboard * dashboard)
name|gimp_dashboard_init
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkWidget
modifier|*
name|box
decl_stmt|;
name|GtkWidget
modifier|*
name|scrolled_window
decl_stmt|;
name|GtkWidget
modifier|*
name|viewport
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox
decl_stmt|;
name|GtkWidget
modifier|*
name|expander
decl_stmt|;
name|GtkWidget
modifier|*
name|hbox
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|image
decl_stmt|;
name|GtkWidget
modifier|*
name|menu
decl_stmt|;
name|GtkWidget
modifier|*
name|item
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|;
name|GtkWidget
modifier|*
name|vbox2
decl_stmt|;
name|GtkWidget
modifier|*
name|meter
decl_stmt|;
name|GtkWidget
modifier|*
name|grid
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|gint
name|content_spacing
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|gint
name|field
decl_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
operator|=
name|gimp_dashboard_get_instance_private
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
name|g_mutex_init
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|g_cond_init
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|)
expr_stmt|;
name|priv
operator|->
name|update_interval
operator|=
name|DEFAULT_UPDATE_INTERVAL
expr_stmt|;
name|priv
operator|->
name|history_duration
operator|=
name|DEFAULT_HISTORY_DURATION
expr_stmt|;
name|priv
operator|->
name|low_swap_space_warning
operator|=
name|DEFAULT_LOW_SWAP_SPACE_WARNING
expr_stmt|;
name|gtk_widget_style_get
argument_list|(
name|GTK_WIDGET
argument_list|(
name|dashboard
argument_list|)
argument_list|,
literal|"content-spacing"
argument_list|,
operator|&
name|content_spacing
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/* we put the dashboard inside an event box, so that it gets its own window,    * which reduces the overhead of updating the ui, since it gets updated    * frequently.  unfortunately, this means that the dashboard's background    * color may be a bit off for some themes.    */
name|box
operator|=
name|gtk_event_box_new
argument_list|()
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|box
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|box
argument_list|)
expr_stmt|;
comment|/* scrolled window */
name|scrolled_window
operator|=
name|gtk_scrolled_window_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_scrolled_window_set_policy
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|,
name|GTK_POLICY_AUTOMATIC
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|box
argument_list|)
argument_list|,
name|scrolled_window
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|scrolled_window
argument_list|)
expr_stmt|;
comment|/* viewport */
name|viewport
operator|=
name|gtk_viewport_new
argument_list|(
name|gtk_scrolled_window_get_hadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_window
argument_list|)
argument_list|)
argument_list|,
name|gtk_scrolled_window_get_vadjustment
argument_list|(
name|GTK_SCROLLED_WINDOW
argument_list|(
name|scrolled_window
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_viewport_set_shadow_type
argument_list|(
name|GTK_VIEWPORT
argument_list|(
name|viewport
argument_list|)
argument_list|,
name|GTK_SHADOW_NONE
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|scrolled_window
argument_list|)
argument_list|,
name|viewport
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|viewport
argument_list|)
expr_stmt|;
comment|/* main vbox */
name|vbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|2
operator|*
name|content_spacing
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|viewport
argument_list|)
argument_list|,
name|vbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox
argument_list|)
expr_stmt|;
comment|/* construct the groups */
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|group_data
operator|->
name|n_fields
operator|=
literal|0
expr_stmt|;
name|group_data
operator|->
name|n_meter_values
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|group_info
operator|->
name|fields
index|[
name|field
index|]
operator|.
name|variable
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
name|group_data
operator|->
name|n_fields
operator|++
expr_stmt|;
name|group_data
operator|->
name|n_meter_values
operator|=
name|MAX
argument_list|(
name|group_data
operator|->
name|n_meter_values
argument_list|,
name|field_info
operator|->
name|meter_value
argument_list|)
expr_stmt|;
block|}
name|group_data
operator|->
name|fields
operator|=
name|g_new0
argument_list|(
name|FieldData
argument_list|,
name|group_data
operator|->
name|n_fields
argument_list|)
expr_stmt|;
comment|/* group expander */
name|expander
operator|=
name|gtk_expander_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|group_data
operator|->
name|expander
operator|=
name|GTK_EXPANDER
argument_list|(
name|expander
argument_list|)
expr_stmt|;
name|gtk_expander_set_expanded
argument_list|(
name|GTK_EXPANDER
argument_list|(
name|expander
argument_list|)
argument_list|,
name|group_info
operator|->
name|default_expanded
argument_list|)
expr_stmt|;
name|gtk_expander_set_label_fill
argument_list|(
name|GTK_EXPANDER
argument_list|(
name|expander
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox
argument_list|)
argument_list|,
name|expander
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|expander
argument_list|)
argument_list|,
literal|"gimp-dashboard-group"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|group
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|expander
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_dashboard_group_expander_button_press
argument_list|)
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
comment|/* group expander label box */
name|hbox
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|hbox
argument_list|,
name|g_dgettext
argument_list|(
name|NULL
argument_list|,
name|group_info
operator|->
name|description
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_expander_set_label_widget
argument_list|(
name|GTK_EXPANDER
argument_list|(
name|expander
argument_list|)
argument_list|,
name|hbox
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|hbox
argument_list|)
expr_stmt|;
comment|/* group expander label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|g_dpgettext2
argument_list|(
name|NULL
argument_list|,
literal|"dashboard-group"
argument_list|,
name|group_info
operator|->
name|title
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gimp_label_set_attributes
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
name|PANGO_ATTR_WEIGHT
argument_list|,
name|PANGO_WEIGHT_BOLD
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
comment|/* group expander values label */
name|label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|group_data
operator|->
name|header_values_label
operator|=
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|label
argument_list|,
name|TRUE
argument_list|,
name|TRUE
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|g_object_bind_property
argument_list|(
name|expander
argument_list|,
literal|"expanded"
argument_list|,
name|label
argument_list|,
literal|"visible"
argument_list|,
name|G_BINDING_SYNC_CREATE
operator||
name|G_BINDING_INVERT_BOOLEAN
argument_list|)
expr_stmt|;
comment|/* group expander menu button */
name|button
operator|=
name|gtk_button_new
argument_list|()
expr_stmt|;
name|group_data
operator|->
name|menu_button
operator|=
name|GTK_BUTTON
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|button
argument_list|,
name|_
argument_list|(
literal|"Select fields"
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_can_focus
argument_list|(
name|button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_button_set_relief
argument_list|(
name|GTK_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|GTK_RELIEF_NONE
argument_list|)
expr_stmt|;
name|gtk_box_pack_end
argument_list|(
name|GTK_BOX
argument_list|(
name|hbox
argument_list|)
argument_list|,
name|button
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|image
operator|=
name|gtk_image_new_from_icon_name
argument_list|(
name|GIMP_ICON_MENU_LEFT
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|)
expr_stmt|;
name|gtk_image_set_pixel_size
argument_list|(
name|GTK_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|gtk_image_set_from_icon_name
argument_list|(
name|GTK_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|GIMP_ICON_MENU_LEFT
argument_list|,
name|GTK_ICON_SIZE_MENU
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/* group menu */
name|menu
operator|=
name|gtk_menu_new
argument_list|()
expr_stmt|;
name|group_data
operator|->
name|menu
operator|=
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
expr_stmt|;
name|gtk_menu_attach_to_widget
argument_list|(
name|GTK_MENU
argument_list|(
name|menu
argument_list|)
argument_list|,
name|button
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
name|FieldData
modifier|*
name|field_data
init|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|variable
operator|!=
name|VARIABLE_SEPARATOR
condition|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|field_info
operator|->
name|variable
index|]
decl_stmt|;
name|item
operator|=
name|gtk_check_menu_item_new_with_label
argument_list|(
name|g_dpgettext2
argument_list|(
name|NULL
argument_list|,
literal|"dashboard-variable"
argument_list|,
name|field_info
operator|->
name|title
condition|?
name|field_info
operator|->
name|title
else|:
name|variable_info
operator|->
name|title
argument_list|)
argument_list|)
expr_stmt|;
name|field_data
operator|->
name|menu_item
operator|=
name|GTK_CHECK_MENU_ITEM
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|item
argument_list|,
name|g_dgettext
argument_list|(
name|NULL
argument_list|,
name|variable_info
operator|->
name|description
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"gimp-dashboard-group"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|group
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"gimp-dashboard-field"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|field
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|item
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_dashboard_field_menu_item_toggled
argument_list|)
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
name|gimp_dashboard_field_set_active
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|,
name|field
argument_list|,
name|field_info
operator|->
name|default_active
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|item
operator|=
name|gtk_separator_menu_item_new
argument_list|()
expr_stmt|;
block|}
name|gtk_menu_shell_append
argument_list|(
name|GTK_MENU_SHELL
argument_list|(
name|menu
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
comment|/* group frame */
name|frame
operator|=
name|gimp_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|expander
argument_list|)
argument_list|,
name|frame
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|frame
argument_list|)
expr_stmt|;
comment|/* group vbox */
name|vbox2
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_VERTICAL
argument_list|,
literal|2
operator|*
name|content_spacing
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|vbox2
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|vbox2
argument_list|)
expr_stmt|;
comment|/* group meter */
if|if
condition|(
name|group_info
operator|->
name|has_meter
condition|)
block|{
name|meter
operator|=
name|gimp_meter_new
argument_list|(
name|group_data
operator|->
name|n_meter_values
argument_list|)
expr_stmt|;
name|group_data
operator|->
name|meter
operator|=
name|GIMP_METER
argument_list|(
name|meter
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|meter
argument_list|,
name|g_dgettext
argument_list|(
name|NULL
argument_list|,
name|group_info
operator|->
name|description
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_meter_set_history_resolution
argument_list|(
name|GIMP_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|priv
operator|->
name|update_interval
operator|/
literal|1000.0
argument_list|)
expr_stmt|;
name|gimp_meter_set_history_duration
argument_list|(
name|GIMP_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|priv
operator|->
name|history_duration
operator|/
literal|1000.0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox2
argument_list|)
argument_list|,
name|meter
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|meter
argument_list|)
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|meter_value
condition|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|field_info
operator|->
name|variable
index|]
decl_stmt|;
name|gimp_meter_set_value_color
argument_list|(
name|GIMP_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|field_info
operator|->
name|meter_value
operator|-
literal|1
argument_list|,
operator|&
name|variable_info
operator|->
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_dashboard_field_use_meter_underlay
argument_list|(
name|group
argument_list|,
name|field
argument_list|)
condition|)
block|{
name|gimp_meter_set_value_show_in_gauge
argument_list|(
name|GIMP_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|field_info
operator|->
name|meter_value
operator|-
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_meter_set_value_interpolation
argument_list|(
name|GIMP_METER
argument_list|(
name|meter
argument_list|)
argument_list|,
name|field_info
operator|->
name|meter_value
operator|-
literal|1
argument_list|,
name|GIMP_INTERPOLATION_NONE
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
comment|/* group grid */
name|grid
operator|=
name|gtk_grid_new
argument_list|()
expr_stmt|;
name|group_data
operator|->
name|grid
operator|=
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
expr_stmt|;
name|gtk_grid_set_row_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
name|content_spacing
argument_list|)
expr_stmt|;
name|gtk_grid_set_column_spacing
argument_list|(
name|GTK_GRID
argument_list|(
name|grid
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|vbox2
argument_list|)
argument_list|,
name|grid
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|grid
argument_list|)
expr_stmt|;
name|gimp_dashboard_group_set_active
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|,
name|group_info
operator|->
name|default_active
argument_list|)
expr_stmt|;
name|gimp_dashboard_update_group
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|)
expr_stmt|;
block|}
comment|/* sampler thread    *    * we use a separate thread for sampling, so that data is sampled even when    * the main thread is busy    */
name|priv
operator|->
name|thread
operator|=
name|g_thread_new
argument_list|(
literal|"dashboard"
argument_list|,
operator|(
name|GThreadFunc
operator|)
name|gimp_dashboard_sample
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_docked_iface_init (GimpDockedInterface * iface)
name|gimp_dashboard_docked_iface_init
parameter_list|(
name|GimpDockedInterface
modifier|*
name|iface
parameter_list|)
block|{
name|parent_docked_iface
operator|=
name|g_type_interface_peek_parent
argument_list|(
name|iface
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|parent_docked_iface
condition|)
name|parent_docked_iface
operator|=
name|g_type_default_interface_peek
argument_list|(
name|GIMP_TYPE_DOCKED
argument_list|)
expr_stmt|;
name|iface
operator|->
name|set_aux_info
operator|=
name|gimp_dashboard_set_aux_info
expr_stmt|;
name|iface
operator|->
name|get_aux_info
operator|=
name|gimp_dashboard_get_aux_info
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_constructed (GObject * object)
name|gimp_dashboard_constructed
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
init|=
name|GIMP_DASHBOARD
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GimpUIManager
modifier|*
name|ui_manager
decl_stmt|;
name|GimpActionGroup
modifier|*
name|action_group
decl_stmt|;
name|GtkAction
modifier|*
name|action
decl_stmt|;
name|GtkWidget
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|box
decl_stmt|;
name|GtkWidget
modifier|*
name|image
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|constructed
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|ui_manager
operator|=
name|gimp_editor_get_ui_manager
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|action_group
operator|=
name|gimp_ui_manager_get_action_group
argument_list|(
name|ui_manager
argument_list|,
literal|"dashboard"
argument_list|)
expr_stmt|;
comment|/* group actions */
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GimpToggleActionEntry
name|entry
init|=
block|{}
decl_stmt|;
name|entry
operator|.
name|name
operator|=
name|g_strdup_printf
argument_list|(
literal|"dashboard-group-%s"
argument_list|,
name|group_info
operator|->
name|name
argument_list|)
expr_stmt|;
name|entry
operator|.
name|label
operator|=
name|g_dpgettext2
argument_list|(
name|NULL
argument_list|,
literal|"dashboard-group"
argument_list|,
name|group_info
operator|->
name|title
argument_list|)
expr_stmt|;
name|entry
operator|.
name|tooltip
operator|=
name|g_dgettext
argument_list|(
name|NULL
argument_list|,
name|group_info
operator|->
name|description
argument_list|)
expr_stmt|;
name|entry
operator|.
name|help_id
operator|=
name|GIMP_HELP_DASHBOARD_GROUPS
expr_stmt|;
name|entry
operator|.
name|is_active
operator|=
name|group_data
operator|->
name|active
expr_stmt|;
name|gimp_action_group_add_toggle_actions
argument_list|(
name|action_group
argument_list|,
literal|"dashboard-groups"
argument_list|,
operator|&
name|entry
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|action
operator|=
name|gimp_ui_manager_find_action
argument_list|(
name|ui_manager
argument_list|,
literal|"dashboard"
argument_list|,
name|entry
operator|.
name|name
argument_list|)
expr_stmt|;
name|group_data
operator|->
name|action
operator|=
name|GTK_TOGGLE_ACTION
argument_list|(
name|action
argument_list|)
expr_stmt|;
name|g_object_set_data
argument_list|(
name|G_OBJECT
argument_list|(
name|action
argument_list|)
argument_list|,
literal|"gimp-dashboard-group"
argument_list|,
name|GINT_TO_POINTER
argument_list|(
name|group
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|action
argument_list|,
literal|"toggled"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_dashboard_group_action_toggled
argument_list|)
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
operator|(
name|gpointer
operator|)
name|entry
operator|.
name|name
argument_list|)
expr_stmt|;
block|}
name|button
operator|=
name|gimp_editor_add_action_button
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|dashboard
argument_list|)
argument_list|,
literal|"dashboard"
argument_list|,
literal|"dashboard-log-record"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_record_button
operator|=
name|button
expr_stmt|;
name|button
operator|=
name|gimp_editor_add_action_button
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|dashboard
argument_list|)
argument_list|,
literal|"dashboard"
argument_list|,
literal|"dashboard-log-add-marker"
argument_list|,
literal|"dashboard-log-add-empty-marker"
argument_list|,
name|gimp_get_extend_selection_mask
argument_list|()
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|action
operator|=
name|gtk_action_group_get_action
argument_list|(
name|GTK_ACTION_GROUP
argument_list|(
name|action_group
argument_list|)
argument_list|,
literal|"dashboard-log-add-marker"
argument_list|)
expr_stmt|;
name|g_object_bind_property
argument_list|(
name|action
argument_list|,
literal|"sensitive"
argument_list|,
name|button
argument_list|,
literal|"visible"
argument_list|,
name|G_BINDING_DEFAULT
operator||
name|G_BINDING_SYNC_CREATE
argument_list|)
expr_stmt|;
name|image
operator|=
name|g_object_ref
argument_list|(
name|gtk_bin_get_child
argument_list|(
name|GTK_BIN
argument_list|(
name|button
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|box
operator|=
name|gtk_box_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
name|box
argument_list|)
expr_stmt|;
name|gtk_widget_set_halign
argument_list|(
name|GTK_WIDGET
argument_list|(
name|box
argument_list|)
argument_list|,
name|GTK_ALIGN_CENTER
argument_list|)
expr_stmt|;
name|gtk_widget_set_valign
argument_list|(
name|GTK_WIDGET
argument_list|(
name|box
argument_list|)
argument_list|,
name|GTK_ALIGN_CENTER
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|box
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|image
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_add_marker_label
operator|=
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|label
argument_list|,
name|FALSE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|button
operator|=
name|gimp_editor_add_action_button
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|dashboard
argument_list|)
argument_list|,
literal|"dashboard"
argument_list|,
literal|"dashboard-reset"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|action
operator|=
name|gtk_action_group_get_action
argument_list|(
name|GTK_ACTION_GROUP
argument_list|(
name|action_group
argument_list|)
argument_list|,
literal|"dashboard-reset"
argument_list|)
expr_stmt|;
name|g_object_bind_property
argument_list|(
name|action
argument_list|,
literal|"sensitive"
argument_list|,
name|button
argument_list|,
literal|"visible"
argument_list|,
name|G_BINDING_DEFAULT
operator||
name|G_BINDING_SYNC_CREATE
argument_list|)
expr_stmt|;
name|gimp_action_group_update
argument_list|(
name|action_group
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_dispose (GObject * object)
name|gimp_dashboard_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
init|=
name|GIMP_DASHBOARD
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|thread
condition|)
block|{
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|priv
operator|->
name|quit
operator|=
name|TRUE
expr_stmt|;
name|g_cond_signal
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|g_clear_pointer
argument_list|(
operator|&
name|priv
operator|->
name|thread
argument_list|,
name|g_thread_join
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|update_idle_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|priv
operator|->
name|update_idle_id
argument_list|)
expr_stmt|;
name|priv
operator|->
name|update_idle_id
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|low_swap_space_idle_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|priv
operator|->
name|low_swap_space_idle_id
argument_list|)
expr_stmt|;
name|priv
operator|->
name|low_swap_space_idle_id
operator|=
literal|0
expr_stmt|;
block|}
name|gimp_dashboard_log_stop_recording
argument_list|(
name|dashboard
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_dashboard_reset_variables
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|dispose
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_finalize (GObject * object)
name|gimp_dashboard_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
init|=
name|GIMP_DASHBOARD
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|gint
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
name|FIRST_GROUP
init|;
name|i
operator|<
name|N_GROUPS
condition|;
name|i
operator|++
control|)
name|g_free
argument_list|(
name|priv
operator|->
name|groups
index|[
name|i
index|]
operator|.
name|fields
argument_list|)
expr_stmt|;
name|g_mutex_clear
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|g_cond_clear
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|)
expr_stmt|;
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|finalize
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_map (GtkWidget * widget)
name|gimp_dashboard_map
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
init|=
name|GIMP_DASHBOARD
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|map
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gimp_dashboard_update
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_unmap (GtkWidget * widget)
name|gimp_dashboard_unmap
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
init|=
name|GIMP_DASHBOARD
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|update_idle_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|priv
operator|->
name|update_idle_id
argument_list|)
expr_stmt|;
name|priv
operator|->
name|update_idle_id
operator|=
literal|0
expr_stmt|;
block|}
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|GTK_WIDGET_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|unmap
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
end_function

begin_define
DECL|macro|AUX_INFO_UPDATE_INTERVAL
define|#
directive|define
name|AUX_INFO_UPDATE_INTERVAL
value|"update-interval"
end_define

begin_define
DECL|macro|AUX_INFO_HISTORY_DURATION
define|#
directive|define
name|AUX_INFO_HISTORY_DURATION
value|"history-duration"
end_define

begin_define
DECL|macro|AUX_INFO_LOW_SWAP_SPACE_WARNING
define|#
directive|define
name|AUX_INFO_LOW_SWAP_SPACE_WARNING
value|"low-swap-space-warning"
end_define

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_set_aux_info (GimpDocked * docked,GList * aux_info)
name|gimp_dashboard_set_aux_info
parameter_list|(
name|GimpDocked
modifier|*
name|docked
parameter_list|,
name|GList
modifier|*
name|aux_info
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
init|=
name|GIMP_DASHBOARD
argument_list|(
name|docked
argument_list|)
decl_stmt|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|parent_docked_iface
operator|->
name|set_aux_info
argument_list|(
name|docked
argument_list|,
name|aux_info
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|aux_info
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpSessionInfoAux
modifier|*
name|aux
init|=
name|list
operator|->
name|data
decl_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|name
argument_list|,
name|AUX_INFO_UPDATE_INTERVAL
argument_list|)
condition|)
block|{
name|gint
name|value
init|=
name|atoi
argument_list|(
name|aux
operator|->
name|value
argument_list|)
decl_stmt|;
name|GimpDashboardUpdateInteval
name|update_interval
decl_stmt|;
for|for
control|(
name|update_interval
operator|=
name|GIMP_DASHBOARD_UPDATE_INTERVAL_0_25_SEC
init|;
name|update_interval
operator|<
name|value
operator|&&
name|update_interval
operator|<
name|GIMP_DASHBOARD_UPDATE_INTERVAL_4_SEC
condition|;
name|update_interval
operator|*=
literal|2
control|)
empty_stmt|;
name|gimp_dashboard_set_update_interval
argument_list|(
name|dashboard
argument_list|,
name|update_interval
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|name
argument_list|,
name|AUX_INFO_HISTORY_DURATION
argument_list|)
condition|)
block|{
name|gint
name|value
init|=
name|atoi
argument_list|(
name|aux
operator|->
name|value
argument_list|)
decl_stmt|;
name|GimpDashboardHistoryDuration
name|history_duration
decl_stmt|;
for|for
control|(
name|history_duration
operator|=
name|GIMP_DASHBOARD_HISTORY_DURATION_15_SEC
init|;
name|history_duration
operator|<
name|value
operator|&&
name|history_duration
operator|<
name|GIMP_DASHBOARD_HISTORY_DURATION_240_SEC
condition|;
name|history_duration
operator|*=
literal|2
control|)
empty_stmt|;
name|gimp_dashboard_set_history_duration
argument_list|(
name|dashboard
argument_list|,
name|history_duration
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|name
argument_list|,
name|AUX_INFO_LOW_SWAP_SPACE_WARNING
argument_list|)
condition|)
block|{
name|gimp_dashboard_set_low_swap_space_warning
argument_list|(
name|dashboard
argument_list|,
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|value
argument_list|,
literal|"yes"
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Group
name|group
decl_stmt|;
name|gint
name|field
decl_stmt|;
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|name
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s-active"
argument_list|,
name|group_info
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|name
argument_list|,
name|name
argument_list|)
condition|)
block|{
name|gboolean
name|active
init|=
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|value
argument_list|,
literal|"yes"
argument_list|)
decl_stmt|;
name|gimp_dashboard_group_set_active
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|,
name|active
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
goto|goto
name|next_aux_info
goto|;
block|}
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|name
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s-expanded"
argument_list|,
name|group_info
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|name
argument_list|,
name|name
argument_list|)
condition|)
block|{
name|gboolean
name|expanded
init|=
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|value
argument_list|,
literal|"yes"
argument_list|)
decl_stmt|;
name|gtk_expander_set_expanded
argument_list|(
name|group_data
operator|->
name|expander
argument_list|,
name|expanded
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
goto|goto
name|next_aux_info
goto|;
block|}
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|variable
operator|!=
name|VARIABLE_SEPARATOR
condition|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|field_info
operator|->
name|variable
index|]
decl_stmt|;
name|name
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s-%s-active"
argument_list|,
name|group_info
operator|->
name|name
argument_list|,
name|variable_info
operator|->
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|name
argument_list|,
name|name
argument_list|)
condition|)
block|{
name|gboolean
name|active
init|=
operator|!
name|strcmp
argument_list|(
name|aux
operator|->
name|value
argument_list|,
literal|"yes"
argument_list|)
decl_stmt|;
name|gimp_dashboard_field_set_active
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|,
name|field
argument_list|,
name|active
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
goto|goto
name|next_aux_info
goto|;
block|}
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
name|next_aux_info
label|:
empty_stmt|;
block|}
name|gimp_dashboard_update_groups
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GList
modifier|*
DECL|function|gimp_dashboard_get_aux_info (GimpDocked * docked)
name|gimp_dashboard_get_aux_info
parameter_list|(
name|GimpDocked
modifier|*
name|docked
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
init|=
name|GIMP_DASHBOARD
argument_list|(
name|docked
argument_list|)
decl_stmt|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GList
modifier|*
name|aux_info
decl_stmt|;
name|GimpSessionInfoAux
modifier|*
name|aux
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|gchar
modifier|*
name|value
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|gint
name|field
decl_stmt|;
name|aux_info
operator|=
name|parent_docked_iface
operator|->
name|get_aux_info
argument_list|(
name|docked
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|update_interval
operator|!=
name|DEFAULT_UPDATE_INTERVAL
condition|)
block|{
name|value
operator|=
name|g_strdup_printf
argument_list|(
literal|"%d"
argument_list|,
name|priv
operator|->
name|update_interval
argument_list|)
expr_stmt|;
name|aux
operator|=
name|gimp_session_info_aux_new
argument_list|(
name|AUX_INFO_UPDATE_INTERVAL
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aux_info
operator|=
name|g_list_append
argument_list|(
name|aux_info
argument_list|,
name|aux
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|history_duration
operator|!=
name|DEFAULT_HISTORY_DURATION
condition|)
block|{
name|value
operator|=
name|g_strdup_printf
argument_list|(
literal|"%d"
argument_list|,
name|priv
operator|->
name|history_duration
argument_list|)
expr_stmt|;
name|aux
operator|=
name|gimp_session_info_aux_new
argument_list|(
name|AUX_INFO_HISTORY_DURATION
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aux_info
operator|=
name|g_list_append
argument_list|(
name|aux_info
argument_list|,
name|aux
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|value
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|low_swap_space_warning
operator|!=
name|DEFAULT_LOW_SWAP_SPACE_WARNING
condition|)
block|{
name|value
operator|=
name|priv
operator|->
name|low_swap_space_warning
condition|?
literal|"yes"
else|:
literal|"no"
expr_stmt|;
name|aux
operator|=
name|gimp_session_info_aux_new
argument_list|(
name|AUX_INFO_LOW_SWAP_SPACE_WARNING
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aux_info
operator|=
name|g_list_append
argument_list|(
name|aux_info
argument_list|,
name|aux
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|gboolean
name|active
init|=
name|group_data
operator|->
name|active
decl_stmt|;
name|gboolean
name|expanded
init|=
name|gtk_expander_get_expanded
argument_list|(
name|group_data
operator|->
name|expander
argument_list|)
decl_stmt|;
if|if
condition|(
name|active
operator|!=
name|group_info
operator|->
name|default_active
condition|)
block|{
name|name
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s-active"
argument_list|,
name|group_info
operator|->
name|name
argument_list|)
expr_stmt|;
name|value
operator|=
name|active
condition|?
literal|"yes"
else|:
literal|"no"
expr_stmt|;
name|aux
operator|=
name|gimp_session_info_aux_new
argument_list|(
name|name
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aux_info
operator|=
name|g_list_append
argument_list|(
name|aux_info
argument_list|,
name|aux
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|expanded
operator|!=
name|group_info
operator|->
name|default_expanded
condition|)
block|{
name|name
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s-expanded"
argument_list|,
name|group_info
operator|->
name|name
argument_list|)
expr_stmt|;
name|value
operator|=
name|expanded
condition|?
literal|"yes"
else|:
literal|"no"
expr_stmt|;
name|aux
operator|=
name|gimp_session_info_aux_new
argument_list|(
name|name
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aux_info
operator|=
name|g_list_append
argument_list|(
name|aux_info
argument_list|,
name|aux
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
name|FieldData
modifier|*
name|field_data
init|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
name|gboolean
name|active
init|=
name|field_data
operator|->
name|active
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|variable
operator|!=
name|VARIABLE_SEPARATOR
condition|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|field_info
operator|->
name|variable
index|]
decl_stmt|;
if|if
condition|(
name|active
operator|!=
name|field_info
operator|->
name|default_active
condition|)
block|{
name|name
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s-%s-active"
argument_list|,
name|group_info
operator|->
name|name
argument_list|,
name|variable_info
operator|->
name|name
argument_list|)
expr_stmt|;
name|value
operator|=
name|active
condition|?
literal|"yes"
else|:
literal|"no"
expr_stmt|;
name|aux
operator|=
name|gimp_session_info_aux_new
argument_list|(
name|name
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|aux_info
operator|=
name|g_list_append
argument_list|(
name|aux_info
argument_list|,
name|aux
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
return|return
name|aux_info
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_dashboard_group_expander_button_press (GimpDashboard * dashboard,GdkEventButton * bevent,GtkWidget * widget)
name|gimp_dashboard_group_expander_button_press
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GdkEventButton
modifier|*
name|bevent
parameter_list|,
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|GroupData
modifier|*
name|group_data
decl_stmt|;
name|GtkAllocation
name|expander_allocation
decl_stmt|;
name|GtkAllocation
name|allocation
decl_stmt|;
name|group
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
literal|"gimp-dashboard-group"
argument_list|)
argument_list|)
expr_stmt|;
name|group_data
operator|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
expr_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|GTK_WIDGET
argument_list|(
name|group_data
operator|->
name|expander
argument_list|)
argument_list|,
operator|&
name|expander_allocation
argument_list|)
expr_stmt|;
name|gtk_widget_get_allocation
argument_list|(
name|GTK_WIDGET
argument_list|(
name|group_data
operator|->
name|menu_button
argument_list|)
argument_list|,
operator|&
name|allocation
argument_list|)
expr_stmt|;
name|allocation
operator|.
name|x
operator|-=
name|expander_allocation
operator|.
name|x
expr_stmt|;
name|allocation
operator|.
name|y
operator|-=
name|expander_allocation
operator|.
name|y
expr_stmt|;
if|if
condition|(
name|bevent
operator|->
name|button
operator|==
literal|1
operator|&&
name|bevent
operator|->
name|x
operator|>=
name|allocation
operator|.
name|x
operator|&&
name|bevent
operator|->
name|x
operator|<
name|allocation
operator|.
name|x
operator|+
name|allocation
operator|.
name|width
operator|&&
name|bevent
operator|->
name|y
operator|>=
name|allocation
operator|.
name|y
operator|&&
name|bevent
operator|->
name|y
operator|<
name|allocation
operator|.
name|y
operator|+
name|allocation
operator|.
name|height
condition|)
block|{
name|gtk_menu_popup_at_widget
argument_list|(
name|group_data
operator|->
name|menu
argument_list|,
name|GTK_WIDGET
argument_list|(
name|group_data
operator|->
name|menu_button
argument_list|)
argument_list|,
name|GDK_GRAVITY_WEST
argument_list|,
name|GDK_GRAVITY_NORTH_EAST
argument_list|,
operator|(
name|GdkEvent
operator|*
operator|)
name|bevent
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_group_action_toggled (GimpDashboard * dashboard,GtkToggleAction * action)
name|gimp_dashboard_group_action_toggled
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GtkToggleAction
modifier|*
name|action
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|GroupData
modifier|*
name|group_data
decl_stmt|;
name|group
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|action
argument_list|)
argument_list|,
literal|"gimp-dashboard-group"
argument_list|)
argument_list|)
expr_stmt|;
name|group_data
operator|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
expr_stmt|;
name|group_data
operator|->
name|active
operator|=
name|gtk_toggle_action_get_active
argument_list|(
name|action
argument_list|)
expr_stmt|;
name|gimp_dashboard_update_group
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_field_menu_item_toggled (GimpDashboard * dashboard,GtkCheckMenuItem * item)
name|gimp_dashboard_field_menu_item_toggled
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GtkCheckMenuItem
modifier|*
name|item
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|GroupData
modifier|*
name|group_data
decl_stmt|;
name|gint
name|field
decl_stmt|;
name|FieldData
modifier|*
name|field_data
decl_stmt|;
name|group
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"gimp-dashboard-group"
argument_list|)
argument_list|)
expr_stmt|;
name|group_data
operator|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
expr_stmt|;
name|field
operator|=
name|GPOINTER_TO_INT
argument_list|(
name|g_object_get_data
argument_list|(
name|G_OBJECT
argument_list|(
name|item
argument_list|)
argument_list|,
literal|"gimp-dashboard-field"
argument_list|)
argument_list|)
expr_stmt|;
name|field_data
operator|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
expr_stmt|;
name|field_data
operator|->
name|active
operator|=
name|gtk_check_menu_item_get_active
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|gimp_dashboard_update_group
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gpointer
DECL|function|gimp_dashboard_sample (GimpDashboard * dashboard)
name|gimp_dashboard_sample
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|gint64
name|last_sample_time
init|=
literal|0
decl_stmt|;
name|gint64
name|last_update_time
init|=
literal|0
decl_stmt|;
name|gboolean
name|seen_low_swap_space
init|=
name|FALSE
decl_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|priv
operator|->
name|quit
condition|)
block|{
name|gint64
name|update_interval
decl_stmt|;
name|gint64
name|sample_interval
decl_stmt|;
name|gint64
name|end_time
decl_stmt|;
name|update_interval
operator|=
name|priv
operator|->
name|update_interval
operator|*
name|G_TIME_SPAN_SECOND
operator|/
literal|1000
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_output
condition|)
name|sample_interval
operator|=
name|G_TIME_SPAN_SECOND
operator|/
name|priv
operator|->
name|log_sample_frequency
expr_stmt|;
else|else
name|sample_interval
operator|=
name|update_interval
expr_stmt|;
name|end_time
operator|=
name|last_sample_time
operator|+
name|sample_interval
expr_stmt|;
if|if
condition|(
operator|!
name|g_cond_wait_until
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|,
operator|&
name|priv
operator|->
name|mutex
argument_list|,
name|end_time
argument_list|)
operator|||
name|priv
operator|->
name|update_now
condition|)
block|{
name|gint64
name|time
decl_stmt|;
name|gboolean
name|variables_changed
init|=
name|FALSE
decl_stmt|;
name|Variable
name|variable
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|gint
name|field
decl_stmt|;
name|time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
comment|/* sample all variables */
for|for
control|(
name|variable
operator|=
name|FIRST_VARIABLE
init|;
name|variable
operator|<
name|N_VARIABLES
condition|;
name|variable
operator|++
control|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
specifier|const
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|VariableData
name|prev_variable_data
init|=
operator|*
name|variable_data
decl_stmt|;
name|variable_info
operator|->
name|sample_func
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|)
expr_stmt|;
name|variables_changed
operator|=
name|variables_changed
operator|||
name|memcmp
argument_list|(
name|variable_data
argument_list|,
operator|&
name|prev_variable_data
argument_list|,
sizeof|sizeof
argument_list|(
name|VariableData
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/* log sample */
if|if
condition|(
name|priv
operator|->
name|log_output
condition|)
name|gimp_dashboard_log_sample
argument_list|(
name|dashboard
argument_list|,
name|variables_changed
argument_list|)
expr_stmt|;
comment|/* update gui */
if|if
condition|(
name|priv
operator|->
name|update_now
operator|||
operator|!
name|priv
operator|->
name|log_output
operator|||
name|time
operator|-
name|last_update_time
operator|>=
name|update_interval
condition|)
block|{
comment|/* add samples to meters */
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|gdouble
modifier|*
name|sample
decl_stmt|;
name|gdouble
name|total
init|=
literal|0.0
decl_stmt|;
if|if
condition|(
operator|!
name|group_info
operator|->
name|has_meter
condition|)
continue|continue;
name|sample
operator|=
name|g_new
argument_list|(
name|gdouble
argument_list|,
name|group_data
operator|->
name|n_meter_values
argument_list|)
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|meter_value
condition|)
block|{
name|gdouble
name|value
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|meter_variable
condition|)
name|variable
operator|=
name|field_info
operator|->
name|meter_variable
expr_stmt|;
else|else
name|variable
operator|=
name|field_info
operator|->
name|variable
expr_stmt|;
name|value
operator|=
name|gimp_dashboard_variable_to_double
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|)
expr_stmt|;
if|if
condition|(
name|value
operator|&&
name|gimp_dashboard_field_use_meter_underlay
argument_list|(
name|group
argument_list|,
name|field
argument_list|)
condition|)
block|{
name|value
operator|=
name|G_MAXDOUBLE
expr_stmt|;
block|}
if|if
condition|(
name|field_info
operator|->
name|meter_cumulative
condition|)
block|{
name|total
operator|+=
name|value
expr_stmt|;
name|value
operator|=
name|total
expr_stmt|;
block|}
name|sample
index|[
name|field_info
operator|->
name|meter_value
operator|-
literal|1
index|]
operator|=
name|value
expr_stmt|;
block|}
block|}
name|gimp_meter_add_sample
argument_list|(
name|group_data
operator|->
name|meter
argument_list|,
name|sample
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|sample
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|variables_changed
condition|)
block|{
comment|/* enqueue update source */
if|if
condition|(
operator|!
name|priv
operator|->
name|update_idle_id
operator|&&
name|gtk_widget_get_mapped
argument_list|(
name|GTK_WIDGET
argument_list|(
name|dashboard
argument_list|)
argument_list|)
condition|)
block|{
name|priv
operator|->
name|update_idle_id
operator|=
name|g_idle_add_full
argument_list|(
name|G_PRIORITY_DEFAULT
argument_list|,
operator|(
name|GSourceFunc
operator|)
name|gimp_dashboard_update
argument_list|,
name|dashboard
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
comment|/* check for low swap space */
if|if
condition|(
name|priv
operator|->
name|low_swap_space_warning
operator|&&
name|priv
operator|->
name|variables
index|[
name|VARIABLE_SWAP_OCCUPIED
index|]
operator|.
name|available
operator|&&
name|priv
operator|->
name|variables
index|[
name|VARIABLE_SWAP_LIMIT
index|]
operator|.
name|available
condition|)
block|{
name|guint64
name|swap_occupied
decl_stmt|;
name|guint64
name|swap_limit
decl_stmt|;
name|swap_occupied
operator|=
name|priv
operator|->
name|variables
index|[
name|VARIABLE_SWAP_OCCUPIED
index|]
operator|.
name|value
operator|.
name|size
expr_stmt|;
name|swap_limit
operator|=
name|priv
operator|->
name|variables
index|[
name|VARIABLE_SWAP_LIMIT
index|]
operator|.
name|value
operator|.
name|size
expr_stmt|;
if|if
condition|(
operator|!
name|seen_low_swap_space
operator|&&
name|swap_occupied
operator|>=
name|LOW_SWAP_SPACE_WARNING_ON
operator|*
name|swap_limit
condition|)
block|{
if|if
condition|(
operator|!
name|priv
operator|->
name|low_swap_space_idle_id
condition|)
block|{
name|priv
operator|->
name|low_swap_space_idle_id
operator|=
name|g_idle_add_full
argument_list|(
name|G_PRIORITY_HIGH
argument_list|,
operator|(
name|GSourceFunc
operator|)
name|gimp_dashboard_low_swap_space
argument_list|,
name|dashboard
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|seen_low_swap_space
operator|=
name|TRUE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|seen_low_swap_space
operator|&&
name|swap_occupied
operator|<=
name|LOW_SWAP_SPACE_WARNING_OFF
operator|*
name|swap_limit
condition|)
block|{
if|if
condition|(
name|priv
operator|->
name|low_swap_space_idle_id
condition|)
block|{
name|g_source_remove
argument_list|(
name|priv
operator|->
name|low_swap_space_idle_id
argument_list|)
expr_stmt|;
name|priv
operator|->
name|low_swap_space_idle_id
operator|=
literal|0
expr_stmt|;
block|}
name|seen_low_swap_space
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
block|}
name|priv
operator|->
name|update_now
operator|=
name|FALSE
expr_stmt|;
name|last_update_time
operator|=
name|time
expr_stmt|;
block|}
name|last_sample_time
operator|=
name|time
expr_stmt|;
block|}
block|}
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_dashboard_update (GimpDashboard * dashboard)
name|gimp_dashboard_update
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
name|gimp_dashboard_update_group_values
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|)
expr_stmt|;
name|priv
operator|->
name|update_idle_id
operator|=
literal|0
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
return|return
name|G_SOURCE_REMOVE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_dashboard_low_swap_space (GimpDashboard * dashboard)
name|gimp_dashboard_low_swap_space
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|gimp
condition|)
block|{
name|GdkMonitor
modifier|*
name|monitor
decl_stmt|;
name|gint
name|field
decl_stmt|;
name|gtk_expander_set_expanded
argument_list|(
name|priv
operator|->
name|groups
index|[
name|GROUP_SWAP
index|]
operator|.
name|expander
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|priv
operator|->
name|groups
index|[
name|GROUP_SWAP
index|]
operator|.
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|groups
index|[
name|GROUP_SWAP
index|]
operator|.
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|variable
operator|==
name|VARIABLE_SWAP_OCCUPIED
operator|||
name|field_info
operator|->
name|variable
operator|==
name|VARIABLE_SWAP_LIMIT
condition|)
block|{
name|gimp_dashboard_field_set_active
argument_list|(
name|dashboard
argument_list|,
name|GROUP_SWAP
argument_list|,
name|field
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
name|gimp_dashboard_update_groups
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
name|monitor
operator|=
name|gimp_get_monitor_at_pointer
argument_list|()
expr_stmt|;
name|gimp_window_strategy_show_dockable_dialog
argument_list|(
name|GIMP_WINDOW_STRATEGY
argument_list|(
name|gimp_get_window_strategy
argument_list|(
name|priv
operator|->
name|gimp
argument_list|)
argument_list|)
argument_list|,
name|priv
operator|->
name|gimp
argument_list|,
name|gimp_dialog_factory_get_singleton
argument_list|()
argument_list|,
name|monitor
argument_list|,
literal|"gimp-dashboard"
argument_list|)
expr_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|priv
operator|->
name|low_swap_space_idle_id
operator|=
literal|0
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
return|return
name|G_SOURCE_REMOVE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_function (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_function
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
DECL|macro|CALL_FUNC (result_type)
define|#
directive|define
name|CALL_FUNC
parameter_list|(
name|result_type
parameter_list|)
define|\
value|(((result_type (*) (void)) variable_info->data) ())
switch|switch
condition|(
name|variable_info
operator|->
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
name|variable_data
operator|->
name|value
operator|.
name|boolean
operator|=
name|CALL_FUNC
argument_list|(
name|gboolean
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
name|variable_data
operator|->
name|value
operator|.
name|integer
operator|=
name|CALL_FUNC
argument_list|(
name|gint
argument_list|)
expr_stmt|;
case|case
name|VARIABLE_TYPE_SIZE
case|:
name|variable_data
operator|->
name|value
operator|.
name|size
operator|=
name|CALL_FUNC
argument_list|(
name|guint64
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
name|variable_data
operator|->
name|value
operator|.
name|percentage
operator|=
name|CALL_FUNC
argument_list|(
name|gdouble
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_DURATION
case|:
name|variable_data
operator|->
name|value
operator|.
name|duration
operator|=
name|CALL_FUNC
argument_list|(
name|gdouble
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
name|variable_data
operator|->
name|value
operator|.
name|rate_of_change
operator|=
name|CALL_FUNC
argument_list|(
name|gdouble
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
name|g_return_if_reached
argument_list|()
expr_stmt|;
break|break;
block|}
undef|#
directive|undef
name|CALL_FUNC
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_gegl_config (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_gegl_config
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|gimp_dashboard_sample_object
argument_list|(
name|dashboard
argument_list|,
name|G_OBJECT
argument_list|(
name|gegl_config
argument_list|()
argument_list|)
argument_list|,
name|variable
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_gegl_stats (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_gegl_stats
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|gimp_dashboard_sample_object
argument_list|(
name|dashboard
argument_list|,
name|G_OBJECT
argument_list|(
name|gegl_stats
argument_list|()
argument_list|)
argument_list|,
name|variable
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_variable_changed (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_variable_changed
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|Variable
name|var
init|=
name|GPOINTER_TO_INT
argument_list|(
name|variable_info
operator|->
name|data
argument_list|)
decl_stmt|;
specifier|const
name|VariableData
modifier|*
name|var_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|var
index|]
decl_stmt|;
name|gpointer
name|prev_value
init|=
name|gimp_dashboard_variable_get_data
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|,
sizeof|sizeof
argument_list|(
name|var_data
operator|->
name|value
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|var_data
operator|->
name|available
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|boolean
operator|=
name|memcmp
argument_list|(
operator|&
name|var_data
operator|->
name|value
argument_list|,
name|prev_value
argument_list|,
sizeof|sizeof
argument_list|(
name|var_data
operator|->
name|value
argument_list|)
argument_list|)
operator|!=
literal|0
expr_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|value
operator|.
name|boolean
condition|)
name|memcpy
argument_list|(
name|prev_value
argument_list|,
operator|&
name|var_data
operator|->
name|value
argument_list|,
sizeof|sizeof
argument_list|(
name|var_data
operator|->
name|value
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_variable_rate_of_change (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_variable_rate_of_change
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
typedef|typedef
struct|struct
DECL|struct|__anon2a0d52400708
block|{
DECL|member|last_time
name|gint64
name|last_time
decl_stmt|;
DECL|member|last_available
name|gboolean
name|last_available
decl_stmt|;
DECL|member|last_value
name|gdouble
name|last_value
decl_stmt|;
DECL|typedef|Data
block|}
name|Data
typedef|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|Variable
name|var
init|=
name|GPOINTER_TO_INT
argument_list|(
name|variable_info
operator|->
name|data
argument_list|)
decl_stmt|;
specifier|const
name|VariableData
modifier|*
name|var_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|var
index|]
decl_stmt|;
name|Data
modifier|*
name|data
init|=
name|gimp_dashboard_variable_get_data
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|,
sizeof|sizeof
argument_list|(
name|Data
argument_list|)
argument_list|)
decl_stmt|;
name|gint64
name|time
decl_stmt|;
name|time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
if|if
condition|(
name|time
operator|==
name|data
operator|->
name|last_time
condition|)
return|return;
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|var_data
operator|->
name|available
condition|)
block|{
name|gdouble
name|value
init|=
name|gimp_dashboard_variable_to_double
argument_list|(
name|dashboard
argument_list|,
name|var
argument_list|)
decl_stmt|;
if|if
condition|(
name|data
operator|->
name|last_available
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|rate_of_change
operator|=
operator|(
name|value
operator|-
name|data
operator|->
name|last_value
operator|)
operator|*
name|G_TIME_SPAN_SECOND
operator|/
operator|(
name|time
operator|-
name|data
operator|->
name|last_time
operator|)
expr_stmt|;
block|}
name|data
operator|->
name|last_value
operator|=
name|value
expr_stmt|;
block|}
name|data
operator|->
name|last_time
operator|=
name|time
expr_stmt|;
name|data
operator|->
name|last_available
operator|=
name|var_data
operator|->
name|available
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_swap_limit (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_swap_limit
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
typedef|typedef
struct|struct
DECL|struct|__anon2a0d52400808
block|{
DECL|member|free_space
name|guint64
name|free_space
decl_stmt|;
DECL|member|has_free_space
name|gboolean
name|has_free_space
decl_stmt|;
DECL|member|last_check_time
name|gint64
name|last_check_time
decl_stmt|;
DECL|typedef|Data
block|}
name|Data
typedef|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|Data
modifier|*
name|data
init|=
name|gimp_dashboard_variable_get_data
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|,
sizeof|sizeof
argument_list|(
name|Data
argument_list|)
argument_list|)
decl_stmt|;
name|gint64
name|time
decl_stmt|;
comment|/* we don't have a config option for limiting the swap size, so we simply    * return the free space available on the filesystem containing the swap    */
name|time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
if|if
condition|(
name|time
operator|-
name|data
operator|->
name|last_check_time
operator|>=
name|G_TIME_SPAN_SECOND
condition|)
block|{
name|gchar
modifier|*
name|swap_dir
decl_stmt|;
name|g_object_get
argument_list|(
name|gegl_config
argument_list|()
argument_list|,
literal|"swap"
argument_list|,
operator|&
name|swap_dir
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|data
operator|->
name|free_space
operator|=
literal|0
expr_stmt|;
name|data
operator|->
name|has_free_space
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|swap_dir
condition|)
block|{
name|GFile
modifier|*
name|file
decl_stmt|;
name|GFileInfo
modifier|*
name|info
decl_stmt|;
name|file
operator|=
name|g_file_new_for_path
argument_list|(
name|swap_dir
argument_list|)
expr_stmt|;
name|info
operator|=
name|g_file_query_filesystem_info
argument_list|(
name|file
argument_list|,
name|G_FILE_ATTRIBUTE_FILESYSTEM_FREE
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|info
condition|)
block|{
name|data
operator|->
name|free_space
operator|=
name|g_file_info_get_attribute_uint64
argument_list|(
name|info
argument_list|,
name|G_FILE_ATTRIBUTE_FILESYSTEM_FREE
argument_list|)
expr_stmt|;
name|data
operator|->
name|has_free_space
operator|=
name|TRUE
expr_stmt|;
name|g_object_unref
argument_list|(
name|info
argument_list|)
expr_stmt|;
block|}
name|g_object_unref
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|swap_dir
argument_list|)
expr_stmt|;
block|}
name|data
operator|->
name|last_check_time
operator|=
name|time
expr_stmt|;
block|}
name|variable_data
operator|->
name|available
operator|=
name|data
operator|->
name|has_free_space
expr_stmt|;
if|if
condition|(
name|data
operator|->
name|has_free_space
condition|)
block|{
name|variable_data
operator|->
name|value
operator|.
name|size
operator|=
name|data
operator|->
name|free_space
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|variables
index|[
name|VARIABLE_SWAP_SIZE
index|]
operator|.
name|available
condition|)
block|{
comment|/* the swap limit is the sum of free_space and swap_size, since the            * swap itself occupies space in the filesystem            */
name|variable_data
operator|->
name|value
operator|.
name|size
operator|+=
name|priv
operator|->
name|variables
index|[
name|VARIABLE_SWAP_SIZE
index|]
operator|.
name|value
operator|.
name|size
expr_stmt|;
block|}
block|}
block|}
end_function

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_CPU_GROUP
end_ifdef

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_SYS_TIMES_H
end_ifdef

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_cpu_usage (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_cpu_usage
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
typedef|typedef
struct|struct
DECL|struct|__anon2a0d52400908
block|{
DECL|member|prev_clock
name|clock_t
name|prev_clock
decl_stmt|;
DECL|member|prev_usage
name|clock_t
name|prev_usage
decl_stmt|;
DECL|typedef|Data
block|}
name|Data
typedef|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|Data
modifier|*
name|data
init|=
name|gimp_dashboard_variable_get_data
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|,
sizeof|sizeof
argument_list|(
name|Data
argument_list|)
argument_list|)
decl_stmt|;
name|clock_t
name|curr_clock
decl_stmt|;
name|clock_t
name|curr_usage
decl_stmt|;
name|struct
name|tms
name|tms
decl_stmt|;
name|curr_clock
operator|=
name|times
argument_list|(
operator|&
name|tms
argument_list|)
expr_stmt|;
if|if
condition|(
name|curr_clock
operator|==
operator|(
name|clock_t
operator|)
operator|-
literal|1
condition|)
block|{
name|data
operator|->
name|prev_clock
operator|=
literal|0
expr_stmt|;
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
return|return;
block|}
name|curr_usage
operator|=
name|tms
operator|.
name|tms_utime
operator|+
name|tms
operator|.
name|tms_stime
expr_stmt|;
if|if
condition|(
name|data
operator|->
name|prev_clock
operator|&&
name|curr_clock
operator|!=
name|data
operator|->
name|prev_clock
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|percentage
operator|=
call|(
name|gdouble
call|)
argument_list|(
name|curr_usage
operator|-
name|data
operator|->
name|prev_usage
argument_list|)
operator|/
operator|(
name|curr_clock
operator|-
name|data
operator|->
name|prev_clock
operator|)
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|percentage
operator|/=
name|g_get_num_processors
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
block|}
name|data
operator|->
name|prev_clock
operator|=
name|curr_clock
expr_stmt|;
name|data
operator|->
name|prev_usage
operator|=
name|curr_usage
expr_stmt|;
block|}
end_function

begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|G_OS_WIN32
argument_list|)
end_elif

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_cpu_usage (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_cpu_usage
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
typedef|typedef
struct|struct
DECL|struct|__anon2a0d52400a08
block|{
DECL|member|prev_time
name|guint64
name|prev_time
decl_stmt|;
DECL|member|prev_usage
name|guint64
name|prev_usage
decl_stmt|;
DECL|typedef|Data
block|}
name|Data
typedef|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|Data
modifier|*
name|data
init|=
name|gimp_dashboard_variable_get_data
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|,
sizeof|sizeof
argument_list|(
name|Data
argument_list|)
argument_list|)
decl_stmt|;
name|guint64
name|curr_time
decl_stmt|;
name|guint64
name|curr_usage
decl_stmt|;
name|FILETIME
name|system_time
decl_stmt|;
name|FILETIME
name|process_creation_time
decl_stmt|;
name|FILETIME
name|process_exit_time
decl_stmt|;
name|FILETIME
name|process_kernel_time
decl_stmt|;
name|FILETIME
name|process_user_time
decl_stmt|;
if|if
condition|(
operator|!
name|GetProcessTimes
argument_list|(
name|GetCurrentProcess
argument_list|()
argument_list|,
operator|&
name|process_creation_time
argument_list|,
operator|&
name|process_exit_time
argument_list|,
operator|&
name|process_kernel_time
argument_list|,
operator|&
name|process_user_time
argument_list|)
condition|)
block|{
name|data
operator|->
name|prev_time
operator|=
literal|0
expr_stmt|;
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
return|return;
block|}
name|GetSystemTimeAsFileTime
argument_list|(
operator|&
name|system_time
argument_list|)
expr_stmt|;
name|curr_time
operator|=
operator|(
operator|(
name|guint64
operator|)
name|system_time
operator|.
name|dwHighDateTime
operator|<<
literal|32
operator|)
operator||
operator|(
name|guint64
operator|)
name|system_time
operator|.
name|dwLowDateTime
expr_stmt|;
name|curr_usage
operator|=
operator|(
operator|(
name|guint64
operator|)
name|process_kernel_time
operator|.
name|dwHighDateTime
operator|<<
literal|32
operator|)
operator||
operator|(
name|guint64
operator|)
name|process_kernel_time
operator|.
name|dwLowDateTime
expr_stmt|;
name|curr_usage
operator|+=
operator|(
operator|(
name|guint64
operator|)
name|process_user_time
operator|.
name|dwHighDateTime
operator|<<
literal|32
operator|)
operator||
operator|(
name|guint64
operator|)
name|process_user_time
operator|.
name|dwLowDateTime
expr_stmt|;
if|if
condition|(
name|data
operator|->
name|prev_time
operator|&&
name|curr_time
operator|!=
name|data
operator|->
name|prev_time
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|percentage
operator|=
call|(
name|gdouble
call|)
argument_list|(
name|curr_usage
operator|-
name|data
operator|->
name|prev_usage
argument_list|)
operator|/
operator|(
name|curr_time
operator|-
name|data
operator|->
name|prev_time
operator|)
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|percentage
operator|/=
name|g_get_num_processors
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
block|}
name|data
operator|->
name|prev_time
operator|=
name|curr_time
expr_stmt|;
name|data
operator|->
name|prev_usage
operator|=
name|curr_usage
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* G_OS_WIN32 */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_cpu_active (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_cpu_active
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
typedef|typedef
struct|struct
DECL|struct|__anon2a0d52400b08
block|{
DECL|member|active
name|gboolean
name|active
decl_stmt|;
DECL|typedef|Data
block|}
name|Data
typedef|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|Data
modifier|*
name|data
init|=
name|gimp_dashboard_variable_get_data
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|,
sizeof|sizeof
argument_list|(
name|Data
argument_list|)
argument_list|)
decl_stmt|;
name|gboolean
name|active
init|=
name|FALSE
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|variables
index|[
name|VARIABLE_CPU_USAGE
index|]
operator|.
name|available
condition|)
block|{
if|if
condition|(
operator|!
name|data
operator|->
name|active
condition|)
block|{
name|active
operator|=
name|priv
operator|->
name|variables
index|[
name|VARIABLE_CPU_USAGE
index|]
operator|.
name|value
operator|.
name|percentage
operator|*
name|g_get_num_processors
argument_list|()
operator|>
name|CPU_ACTIVE_ON
expr_stmt|;
block|}
else|else
block|{
name|active
operator|=
name|priv
operator|->
name|variables
index|[
name|VARIABLE_CPU_USAGE
index|]
operator|.
name|value
operator|.
name|percentage
operator|*
name|g_get_num_processors
argument_list|()
operator|>
name|CPU_ACTIVE_OFF
expr_stmt|;
block|}
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
block|}
name|data
operator|->
name|active
operator|=
name|active
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|boolean
operator|=
name|active
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_cpu_active_time (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_cpu_active_time
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
typedef|typedef
struct|struct
DECL|struct|__anon2a0d52400c08
block|{
DECL|member|prev_time
name|gint64
name|prev_time
decl_stmt|;
DECL|member|active_time
name|gint64
name|active_time
decl_stmt|;
DECL|typedef|Data
block|}
name|Data
typedef|;
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|Data
modifier|*
name|data
init|=
name|gimp_dashboard_variable_get_data
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|,
sizeof|sizeof
argument_list|(
name|Data
argument_list|)
argument_list|)
decl_stmt|;
name|gint64
name|curr_time
decl_stmt|;
name|curr_time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|variables
index|[
name|VARIABLE_CPU_ACTIVE
index|]
operator|.
name|available
condition|)
block|{
name|gboolean
name|active
init|=
name|priv
operator|->
name|variables
index|[
name|VARIABLE_CPU_ACTIVE
index|]
operator|.
name|value
operator|.
name|boolean
decl_stmt|;
if|if
condition|(
name|active
operator|&&
name|data
operator|->
name|prev_time
condition|)
name|data
operator|->
name|active_time
operator|+=
name|curr_time
operator|-
name|data
operator|->
name|prev_time
expr_stmt|;
block|}
name|data
operator|->
name|prev_time
operator|=
name|curr_time
expr_stmt|;
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|duration
operator|=
name|data
operator|->
name|active_time
operator|/
literal|1000000.0
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_CPU_GROUP */
end_comment

begin_ifdef
ifdef|#
directive|ifdef
name|HAVE_MEMORY_GROUP
end_ifdef

begin_ifndef
ifndef|#
directive|ifndef
name|G_OS_WIN32
end_ifndef

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_memory_used (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_memory_used
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
specifier|static
name|gboolean
name|initialized
init|=
name|FALSE
decl_stmt|;
specifier|static
name|long
name|page_size
decl_stmt|;
specifier|static
name|gint
name|fd
init|=
operator|-
literal|1
decl_stmt|;
name|gchar
name|buffer
index|[
literal|128
index|]
decl_stmt|;
name|gint
name|size
decl_stmt|;
name|unsigned
name|long
name|long
name|resident
decl_stmt|;
name|unsigned
name|long
name|long
name|shared
decl_stmt|;
if|if
condition|(
operator|!
name|initialized
condition|)
block|{
name|page_size
operator|=
name|sysconf
argument_list|(
name|_SC_PAGE_SIZE
argument_list|)
expr_stmt|;
if|if
condition|(
name|page_size
operator|>
literal|0
condition|)
name|fd
operator|=
name|open
argument_list|(
literal|"/proc/self/statm"
argument_list|,
name|O_RDONLY
argument_list|)
expr_stmt|;
name|initialized
operator|=
name|TRUE
expr_stmt|;
block|}
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|fd
operator|<
literal|0
condition|)
return|return;
if|if
condition|(
name|lseek
argument_list|(
name|fd
argument_list|,
literal|0
argument_list|,
name|SEEK_SET
argument_list|)
condition|)
return|return;
name|size
operator|=
name|read
argument_list|(
name|fd
argument_list|,
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|<=
literal|0
condition|)
return|return;
name|buffer
index|[
name|size
index|]
operator|=
literal|'\0'
expr_stmt|;
if|if
condition|(
name|sscanf
argument_list|(
name|buffer
argument_list|,
literal|"%*u %llu %llu"
argument_list|,
operator|&
name|resident
argument_list|,
operator|&
name|shared
argument_list|)
operator|!=
literal|2
condition|)
return|return;
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|size
operator|=
call|(
name|guint64
call|)
argument_list|(
name|resident
operator|-
name|shared
argument_list|)
operator|*
name|page_size
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_memory_available (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_memory_available
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
specifier|static
name|gboolean
name|initialized
init|=
name|FALSE
decl_stmt|;
specifier|static
name|gint64
name|last_check_time
init|=
literal|0
decl_stmt|;
specifier|static
name|gint
name|fd
decl_stmt|;
specifier|static
name|guint64
name|available
decl_stmt|;
specifier|static
name|gboolean
name|has_available
init|=
name|FALSE
decl_stmt|;
name|gint64
name|time
decl_stmt|;
if|if
condition|(
operator|!
name|initialized
condition|)
block|{
name|fd
operator|=
name|open
argument_list|(
literal|"/proc/meminfo"
argument_list|,
name|O_RDONLY
argument_list|)
expr_stmt|;
name|initialized
operator|=
name|TRUE
expr_stmt|;
block|}
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|fd
operator|<
literal|0
condition|)
return|return;
comment|/* we don't have a config option for limiting the swap size, so we simply    * return the free space available on the filesystem containing the swap    */
name|time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
if|if
condition|(
name|time
operator|-
name|last_check_time
operator|>=
name|G_TIME_SPAN_SECOND
condition|)
block|{
name|gchar
name|buffer
index|[
literal|512
index|]
decl_stmt|;
name|gint
name|size
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
name|last_check_time
operator|=
name|time
expr_stmt|;
name|has_available
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|lseek
argument_list|(
name|fd
argument_list|,
literal|0
argument_list|,
name|SEEK_SET
argument_list|)
condition|)
return|return;
name|size
operator|=
name|read
argument_list|(
name|fd
argument_list|,
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
operator|-
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|size
operator|<=
literal|0
condition|)
return|return;
name|buffer
index|[
name|size
index|]
operator|=
literal|'\0'
expr_stmt|;
name|str
operator|=
name|strstr
argument_list|(
name|buffer
argument_list|,
literal|"MemAvailable:"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|str
condition|)
return|return;
name|available
operator|=
name|strtoull
argument_list|(
name|str
operator|+
literal|13
argument_list|,
operator|&
name|str
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|str
condition|)
return|return;
for|for
control|(
init|;
operator|*
name|str
condition|;
name|str
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|str
operator|==
literal|'k'
condition|)
block|{
name|available
operator|<<=
literal|10
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
operator|*
name|str
operator|==
literal|'M'
condition|)
block|{
name|available
operator|<<=
literal|20
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
operator|*
name|str
condition|)
return|return;
name|has_available
operator|=
name|TRUE
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|has_available
condition|)
return|return;
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|size
operator|=
name|available
expr_stmt|;
block|}
end_function

begin_else
else|#
directive|else
end_else

begin_comment
comment|/* G_OS_WIN32 */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_memory_used (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_memory_used
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|PROCESS_MEMORY_COUNTERS_EX
name|pmc
init|=
block|{}
decl_stmt|;
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
operator|!
name|GetProcessMemoryInfo
argument_list|(
name|GetCurrentProcess
argument_list|()
argument_list|,
operator|(
name|PPROCESS_MEMORY_COUNTERS
operator|)
operator|&
name|pmc
argument_list|,
sizeof|sizeof
argument_list|(
name|pmc
argument_list|)
argument_list|)
operator|||
name|pmc
operator|.
name|cb
operator|!=
sizeof|sizeof
argument_list|(
name|pmc
argument_list|)
condition|)
block|{
return|return;
block|}
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|size
operator|=
name|pmc
operator|.
name|PrivateUsage
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_memory_available (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_memory_available
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|MEMORYSTATUSEX
name|ms
decl_stmt|;
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
name|ms
operator|.
name|dwLength
operator|=
sizeof|sizeof
argument_list|(
name|ms
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|GlobalMemoryStatusEx
argument_list|(
operator|&
name|ms
argument_list|)
condition|)
return|return;
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|size
operator|=
name|ms
operator|.
name|ullAvailPhys
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* G_OS_WIN32 */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_memory_size (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_sample_memory_size
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|variable_data
operator|->
name|value
operator|.
name|size
operator|=
name|gimp_get_physical_memory_size
argument_list|()
expr_stmt|;
name|variable_data
operator|->
name|available
operator|=
name|variable_data
operator|->
name|value
operator|.
name|size
operator|>
literal|0
expr_stmt|;
block|}
end_function

begin_endif
endif|#
directive|endif
end_endif

begin_comment
comment|/* HAVE_MEMORY_GROUP */
end_comment

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_sample_object (GimpDashboard * dashboard,GObject * object,Variable variable)
name|gimp_dashboard_sample_object
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GObject
modifier|*
name|object
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GObjectClass
modifier|*
name|klass
init|=
name|G_OBJECT_GET_CLASS
argument_list|(
name|object
argument_list|)
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|variable_data
operator|->
name|available
operator|=
name|FALSE
expr_stmt|;
switch|switch
condition|(
name|variable_info
operator|->
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|variable_info
operator|->
name|data
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|variable_info
operator|->
name|data
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|boolean
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|variable_info
operator|->
name|data
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|variable_info
operator|->
name|data
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|integer
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_SIZE
case|:
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|variable_info
operator|->
name|data
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|variable_info
operator|->
name|data
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|size
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
block|{
specifier|const
name|gchar
modifier|*
name|antecedent
init|=
name|variable_info
operator|->
name|data
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|consequent
init|=
name|antecedent
operator|+
name|strlen
argument_list|(
name|antecedent
argument_list|)
operator|+
literal|1
decl_stmt|;
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|antecedent
argument_list|)
operator|&&
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|consequent
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|antecedent
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|antecedent
argument_list|,
name|consequent
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|consequent
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
block|{
specifier|const
name|gchar
modifier|*
name|antecedent
init|=
name|variable_info
operator|->
name|data
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|consequent
init|=
name|antecedent
operator|+
name|strlen
argument_list|(
name|antecedent
argument_list|)
operator|+
literal|1
decl_stmt|;
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|antecedent
argument_list|)
operator|&&
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|consequent
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|antecedent
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|antecedent
argument_list|,
name|consequent
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|consequent
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|variable_info
operator|->
name|data
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|variable_info
operator|->
name|data
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|percentage
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_DURATION
case|:
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|variable_info
operator|->
name|data
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|variable_info
operator|->
name|data
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|duration
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
if|if
condition|(
name|g_object_class_find_property
argument_list|(
name|klass
argument_list|,
name|variable_info
operator|->
name|data
argument_list|)
condition|)
block|{
name|variable_data
operator|->
name|available
operator|=
name|TRUE
expr_stmt|;
name|g_object_get
argument_list|(
name|object
argument_list|,
name|variable_info
operator|->
name|data
argument_list|,
operator|&
name|variable_data
operator|->
name|value
operator|.
name|rate_of_change
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_update_groups (GimpDashboard * dashboard)
name|gimp_dashboard_update_groups
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|Group
name|group
decl_stmt|;
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
name|gimp_dashboard_update_group
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_update_group (GimpDashboard * dashboard,Group group)
name|gimp_dashboard_update_group
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|gint
name|n_rows
decl_stmt|;
name|gboolean
name|add_separator
decl_stmt|;
name|gint
name|field
decl_stmt|;
name|gtk_widget_set_visible
argument_list|(
name|GTK_WIDGET
argument_list|(
name|group_data
operator|->
name|expander
argument_list|)
argument_list|,
name|group_data
operator|->
name|active
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|group_data
operator|->
name|active
condition|)
return|return;
name|n_rows
operator|=
literal|0
expr_stmt|;
name|add_separator
operator|=
name|FALSE
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
specifier|const
name|FieldData
modifier|*
name|field_data
init|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|variable
operator|!=
name|VARIABLE_SEPARATOR
condition|)
block|{
if|if
condition|(
name|group_info
operator|->
name|has_meter
operator|&&
name|field_info
operator|->
name|meter_value
condition|)
block|{
name|gimp_meter_set_value_active
argument_list|(
name|group_data
operator|->
name|meter
argument_list|,
name|field_info
operator|->
name|meter_value
operator|-
literal|1
argument_list|,
name|field_data
operator|->
name|active
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|field_data
operator|->
name|active
condition|)
block|{
if|if
condition|(
name|add_separator
condition|)
block|{
name|add_separator
operator|=
name|FALSE
expr_stmt|;
name|n_rows
operator|++
expr_stmt|;
block|}
name|n_rows
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|n_rows
operator|>
literal|0
condition|)
name|add_separator
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
name|gimp_gtk_container_clear
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|group_data
operator|->
name|grid
argument_list|)
argument_list|)
expr_stmt|;
name|n_rows
operator|=
literal|0
expr_stmt|;
name|add_separator
operator|=
name|FALSE
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
name|FieldData
modifier|*
name|field_data
init|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|variable
operator|!=
name|VARIABLE_SEPARATOR
condition|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|field_info
operator|->
name|variable
index|]
decl_stmt|;
name|GtkWidget
modifier|*
name|separator
decl_stmt|;
name|GtkWidget
modifier|*
name|color_area
decl_stmt|;
name|GtkWidget
modifier|*
name|label
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|description
decl_stmt|;
name|gchar
modifier|*
name|str
decl_stmt|;
if|if
condition|(
operator|!
name|field_data
operator|->
name|active
condition|)
continue|continue;
name|description
operator|=
name|g_dgettext
argument_list|(
name|NULL
argument_list|,
name|variable_info
operator|->
name|description
argument_list|)
expr_stmt|;
if|if
condition|(
name|add_separator
condition|)
block|{
name|separator
operator|=
name|gtk_separator_new
argument_list|(
name|GTK_ORIENTATION_HORIZONTAL
argument_list|)
expr_stmt|;
name|gtk_widget_set_hexpand
argument_list|(
name|separator
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|group_data
operator|->
name|grid
argument_list|,
name|separator
argument_list|,
literal|0
argument_list|,
name|n_rows
argument_list|,
literal|3
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|separator
argument_list|)
expr_stmt|;
name|add_separator
operator|=
name|FALSE
expr_stmt|;
name|n_rows
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|variable_info
operator|->
name|color
operator|.
name|a
condition|)
block|{
name|color_area
operator|=
name|gimp_color_area_new
argument_list|(
operator|&
name|variable_info
operator|->
name|color
argument_list|,
name|GIMP_COLOR_AREA_FLAT
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|color_area
argument_list|,
name|description
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|color_area
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|gtk_widget_set_valign
argument_list|(
name|color_area
argument_list|,
name|GTK_ALIGN_CENTER
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|group_data
operator|->
name|grid
argument_list|,
name|color_area
argument_list|,
literal|0
argument_list|,
name|n_rows
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|color_area
argument_list|)
expr_stmt|;
block|}
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s:"
argument_list|,
name|g_dpgettext2
argument_list|(
name|NULL
argument_list|,
literal|"dashboard-variable"
argument_list|,
name|field_info
operator|->
name|title
condition|?
name|field_info
operator|->
name|title
else|:
name|variable_info
operator|->
name|title
argument_list|)
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|label
argument_list|,
name|description
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|group_data
operator|->
name|grid
argument_list|,
name|label
argument_list|,
literal|1
argument_list|,
name|n_rows
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
name|label
operator|=
name|gtk_label_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|field_data
operator|->
name|value_label
operator|=
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|gimp_help_set_help_data
argument_list|(
name|label
argument_list|,
name|description
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gtk_label_set_xalign
argument_list|(
name|GTK_LABEL
argument_list|(
name|label
argument_list|)
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|gtk_widget_set_hexpand
argument_list|(
name|label
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_grid_attach
argument_list|(
name|group_data
operator|->
name|grid
argument_list|,
name|label
argument_list|,
literal|2
argument_list|,
name|n_rows
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gtk_widget_show
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|n_rows
operator|++
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|n_rows
operator|>
literal|0
condition|)
name|add_separator
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_dashboard_update_group_values
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_update_group_values (GimpDashboard * dashboard,Group group)
name|gimp_dashboard_update_group_values
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|gdouble
name|limit
init|=
literal|0.0
decl_stmt|;
name|GString
modifier|*
name|header_values
decl_stmt|;
name|gint
name|field
decl_stmt|;
if|if
condition|(
operator|!
name|group_data
operator|->
name|active
condition|)
return|return;
if|if
condition|(
name|group_info
operator|->
name|has_meter
condition|)
block|{
if|if
condition|(
name|group_info
operator|->
name|meter_limit
condition|)
block|{
specifier|const
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|group_info
operator|->
name|meter_limit
index|]
decl_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|available
condition|)
block|{
name|limit
operator|=
name|gimp_dashboard_variable_to_double
argument_list|(
name|dashboard
argument_list|,
name|group_info
operator|->
name|meter_limit
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
specifier|const
name|FieldData
modifier|*
name|field_data
init|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_info
operator|->
name|meter_value
operator|&&
name|field_data
operator|->
name|active
condition|)
block|{
name|gdouble
name|value
decl_stmt|;
name|value
operator|=
name|gimp_dashboard_variable_to_double
argument_list|(
name|dashboard
argument_list|,
name|field_info
operator|->
name|variable
argument_list|)
expr_stmt|;
name|limit
operator|=
name|MAX
argument_list|(
name|limit
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|gimp_meter_set_range
argument_list|(
name|group_data
operator|->
name|meter
argument_list|,
literal|0.0
argument_list|,
name|limit
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|group_info
operator|->
name|meter_led
condition|)
block|{
name|GimpRGB
name|color
init|=
block|{
literal|0.0
block|,
literal|0.0
block|,
literal|0.0
block|,
literal|1.0
block|}
decl_stmt|;
name|gboolean
name|active
init|=
name|FALSE
decl_stmt|;
specifier|const
name|Variable
modifier|*
name|var
decl_stmt|;
for|for
control|(
name|var
operator|=
name|group_info
operator|->
name|meter_led
init|;
operator|*
name|var
condition|;
name|var
operator|++
control|)
block|{
if|if
condition|(
name|gimp_dashboard_variable_to_boolean
argument_list|(
name|dashboard
argument_list|,
operator|*
name|var
argument_list|)
condition|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
operator|*
name|var
index|]
decl_stmt|;
name|color
operator|.
name|r
operator|=
name|MAX
argument_list|(
name|color
operator|.
name|r
argument_list|,
name|variable_info
operator|->
name|color
operator|.
name|r
argument_list|)
expr_stmt|;
name|color
operator|.
name|g
operator|=
name|MAX
argument_list|(
name|color
operator|.
name|g
argument_list|,
name|variable_info
operator|->
name|color
operator|.
name|g
argument_list|)
expr_stmt|;
name|color
operator|.
name|b
operator|=
name|MAX
argument_list|(
name|color
operator|.
name|b
argument_list|,
name|variable_info
operator|->
name|color
operator|.
name|b
argument_list|)
expr_stmt|;
name|active
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|active
condition|)
name|gimp_meter_set_led_color
argument_list|(
name|group_data
operator|->
name|meter
argument_list|,
operator|&
name|color
argument_list|)
expr_stmt|;
name|gimp_meter_set_led_active
argument_list|(
name|group_data
operator|->
name|meter
argument_list|,
name|active
argument_list|)
expr_stmt|;
block|}
block|}
name|group_data
operator|->
name|limit
operator|=
name|limit
expr_stmt|;
name|header_values
operator|=
name|g_string_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
for|for
control|(
name|field
operator|=
literal|0
init|;
name|field
operator|<
name|group_data
operator|->
name|n_fields
condition|;
name|field
operator|++
control|)
block|{
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
specifier|const
name|FieldData
modifier|*
name|field_data
init|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|field_data
operator|->
name|active
condition|)
block|{
name|gchar
modifier|*
name|text
decl_stmt|;
name|text
operator|=
name|gimp_dashboard_field_to_string
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|,
name|field
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gimp_dashboard_label_set_text
argument_list|(
name|field_data
operator|->
name|value_label
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|text
argument_list|)
expr_stmt|;
if|if
condition|(
name|field_info
operator|->
name|show_in_header
condition|)
block|{
name|text
operator|=
name|gimp_dashboard_field_to_string
argument_list|(
name|dashboard
argument_list|,
name|group
argument_list|,
name|field
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|header_values
operator|->
name|len
operator|>
literal|0
condition|)
name|g_string_append
argument_list|(
name|header_values
argument_list|,
literal|", "
argument_list|)
expr_stmt|;
name|g_string_append
argument_list|(
name|header_values
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|text
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|header_values
operator|->
name|len
operator|>
literal|0
condition|)
block|{
name|g_string_prepend
argument_list|(
name|header_values
argument_list|,
literal|"("
argument_list|)
expr_stmt|;
name|g_string_append
argument_list|(
name|header_values
argument_list|,
literal|")"
argument_list|)
expr_stmt|;
block|}
name|gimp_dashboard_label_set_text
argument_list|(
name|group_data
operator|->
name|header_values_label
argument_list|,
name|header_values
operator|->
name|str
argument_list|)
expr_stmt|;
name|g_string_free
argument_list|(
name|header_values
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_group_set_active (GimpDashboard * dashboard,Group group,gboolean active)
name|gimp_dashboard_group_set_active
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|,
name|gboolean
name|active
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
if|if
condition|(
name|active
operator|!=
name|group_data
operator|->
name|active
condition|)
block|{
name|group_data
operator|->
name|active
operator|=
name|active
expr_stmt|;
if|if
condition|(
name|group_data
operator|->
name|action
condition|)
block|{
name|g_signal_handlers_block_by_func
argument_list|(
name|group_data
operator|->
name|action
argument_list|,
name|gimp_dashboard_group_action_toggled
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
name|gtk_toggle_action_set_active
argument_list|(
name|group_data
operator|->
name|action
argument_list|,
name|active
argument_list|)
expr_stmt|;
name|g_signal_handlers_unblock_by_func
argument_list|(
name|group_data
operator|->
name|action
argument_list|,
name|gimp_dashboard_group_action_toggled
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_field_set_active (GimpDashboard * dashboard,Group group,gint field,gboolean active)
name|gimp_dashboard_field_set_active
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|,
name|gint
name|field
parameter_list|,
name|gboolean
name|active
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
name|FieldData
modifier|*
name|field_data
init|=
operator|&
name|group_data
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
if|if
condition|(
name|active
operator|!=
name|field_data
operator|->
name|active
condition|)
block|{
name|field_data
operator|->
name|active
operator|=
name|active
expr_stmt|;
name|g_signal_handlers_block_by_func
argument_list|(
name|field_data
operator|->
name|menu_item
argument_list|,
name|gimp_dashboard_field_menu_item_toggled
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
name|gtk_check_menu_item_set_active
argument_list|(
name|field_data
operator|->
name|menu_item
argument_list|,
name|active
argument_list|)
expr_stmt|;
name|g_signal_handlers_unblock_by_func
argument_list|(
name|field_data
operator|->
name|menu_item
argument_list|,
name|gimp_dashboard_field_menu_item_toggled
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_reset_unlocked (GimpDashboard * dashboard)
name|gimp_dashboard_reset_unlocked
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
name|gegl_reset_stats
argument_list|()
expr_stmt|;
name|gimp_dashboard_reset_variables
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
if|if
condition|(
name|group_data
operator|->
name|meter
condition|)
name|gimp_meter_clear_history
argument_list|(
name|group_data
operator|->
name|meter
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_reset_variables (GimpDashboard * dashboard)
name|gimp_dashboard_reset_variables
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|Variable
name|variable
decl_stmt|;
for|for
control|(
name|variable
operator|=
name|FIRST_VARIABLE
init|;
name|variable
operator|<
name|N_VARIABLES
condition|;
name|variable
operator|++
control|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
if|if
condition|(
name|variable_info
operator|->
name|reset_func
condition|)
name|variable_info
operator|->
name|reset_func
argument_list|(
name|dashboard
argument_list|,
name|variable
argument_list|)
expr_stmt|;
name|g_clear_pointer
argument_list|(
operator|&
name|variable_data
operator|->
name|data
argument_list|,
name|g_free
argument_list|)
expr_stmt|;
name|variable_data
operator|->
name|data_size
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|gpointer
DECL|function|gimp_dashboard_variable_get_data (GimpDashboard * dashboard,Variable variable,gsize size)
name|gimp_dashboard_variable_get_data
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|,
name|gsize
name|size
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|data_size
operator|!=
name|size
condition|)
block|{
name|variable_data
operator|->
name|data
operator|=
name|g_realloc
argument_list|(
name|variable_data
operator|->
name|data
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|data_size
operator|<
name|size
condition|)
block|{
name|memset
argument_list|(
operator|(
name|guint8
operator|*
operator|)
name|variable_data
operator|->
name|data
operator|+
name|variable_data
operator|->
name|data_size
argument_list|,
literal|0
argument_list|,
name|size
operator|-
name|variable_data
operator|->
name|data_size
argument_list|)
expr_stmt|;
block|}
name|variable_data
operator|->
name|data_size
operator|=
name|size
expr_stmt|;
block|}
return|return
name|variable_data
operator|->
name|data
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_dashboard_variable_to_boolean (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_variable_to_boolean
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
specifier|const
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|available
condition|)
block|{
switch|switch
condition|(
name|variable_info
operator|->
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|boolean
return|;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|integer
operator|!=
literal|0
return|;
case|case
name|VARIABLE_TYPE_SIZE
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|size
operator|>
literal|0
return|;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|antecedent
operator|!=
literal|0
operator|&&
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|consequent
operator|!=
literal|0
return|;
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|antecedent
operator|!=
literal|0
operator|&&
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|consequent
operator|!=
literal|0
return|;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|percentage
operator|!=
literal|0.0
return|;
case|case
name|VARIABLE_TYPE_DURATION
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|duration
operator|!=
literal|0.0
return|;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|rate_of_change
operator|!=
literal|0.0
return|;
block|}
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|gdouble
DECL|function|gimp_dashboard_variable_to_double (GimpDashboard * dashboard,Variable variable)
name|gimp_dashboard_variable_to_double
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Variable
name|variable
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
specifier|const
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|available
condition|)
block|{
switch|switch
condition|(
name|variable_info
operator|->
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|boolean
condition|?
literal|1.0
else|:
literal|0.0
return|;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|integer
return|;
case|case
name|VARIABLE_TYPE_SIZE
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|size
return|;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
if|if
condition|(
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|consequent
condition|)
block|{
return|return
operator|(
name|gdouble
operator|)
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|antecedent
operator|/
operator|(
name|gdouble
operator|)
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|consequent
return|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
if|if
condition|(
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|consequent
condition|)
block|{
return|return
operator|(
name|gdouble
operator|)
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|antecedent
operator|/
operator|(
name|gdouble
operator|)
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|consequent
return|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|percentage
return|;
case|case
name|VARIABLE_TYPE_DURATION
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|duration
return|;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
return|return
name|variable_data
operator|->
name|value
operator|.
name|rate_of_change
return|;
block|}
block|}
return|return
literal|0.0
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|gimp_dashboard_field_to_string (GimpDashboard * dashboard,Group group,gint field,gboolean full)
name|gimp_dashboard_field_to_string
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|Group
name|group
parameter_list|,
name|gint
name|field
parameter_list|,
name|gboolean
name|full
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
specifier|const
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
specifier|const
name|FieldInfo
modifier|*
name|field_info
init|=
operator|&
name|group_info
operator|->
name|fields
index|[
name|field
index|]
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|field_info
operator|->
name|variable
index|]
decl_stmt|;
specifier|const
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|field_info
operator|->
name|variable
index|]
decl_stmt|;
comment|/* Tranlators: "N/A" is an abbreviation for "not available" */
specifier|const
name|gchar
modifier|*
name|str
init|=
name|C_
argument_list|(
literal|"dashboard-value"
argument_list|,
literal|"N/A"
argument_list|)
decl_stmt|;
name|gboolean
name|static_str
init|=
name|TRUE
decl_stmt|;
name|gboolean
name|show_limit
init|=
name|TRUE
decl_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|available
condition|)
block|{
switch|switch
condition|(
name|variable_info
operator|->
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
name|str
operator|=
name|variable_data
operator|->
name|value
operator|.
name|boolean
condition|?
name|C_
argument_list|(
literal|"dashboard-value"
argument_list|,
literal|"Yes"
argument_list|)
else|:
name|C_
argument_list|(
literal|"dashboard-value"
argument_list|,
literal|"No"
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%d"
argument_list|,
name|variable_data
operator|->
name|value
operator|.
name|integer
argument_list|)
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_SIZE
case|:
name|str
operator|=
name|g_format_size_full
argument_list|(
name|variable_data
operator|->
name|value
operator|.
name|size
argument_list|,
name|G_FORMAT_SIZE_IEC_UNITS
argument_list|)
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
block|{
if|if
condition|(
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|consequent
condition|)
block|{
name|gdouble
name|value
decl_stmt|;
name|value
operator|=
literal|100.0
operator|*
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|antecedent
operator|/
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|consequent
expr_stmt|;
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%d%%"
argument_list|,
name|SIGNED_ROUND
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
break|break;
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
block|{
name|gdouble
name|min
decl_stmt|;
name|gdouble
name|max
decl_stmt|;
name|gdouble
name|antecedent
decl_stmt|;
name|gdouble
name|consequent
decl_stmt|;
name|antecedent
operator|=
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|antecedent
expr_stmt|;
name|consequent
operator|=
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|consequent
expr_stmt|;
name|min
operator|=
name|MIN
argument_list|(
name|ABS
argument_list|(
name|antecedent
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|consequent
argument_list|)
argument_list|)
expr_stmt|;
name|max
operator|=
name|MAX
argument_list|(
name|ABS
argument_list|(
name|antecedent
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|consequent
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|min
condition|)
block|{
name|antecedent
operator|/=
name|min
expr_stmt|;
name|consequent
operator|/=
name|min
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|max
condition|)
block|{
name|antecedent
operator|/=
name|max
expr_stmt|;
name|consequent
operator|/=
name|max
expr_stmt|;
block|}
if|if
condition|(
name|max
condition|)
block|{
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%g:%g"
argument_list|,
name|RINT
argument_list|(
literal|100.0
operator|*
name|antecedent
argument_list|)
operator|/
literal|100.0
argument_list|,
name|RINT
argument_list|(
literal|100.0
operator|*
name|consequent
argument_list|)
operator|/
literal|100.0
argument_list|)
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
break|break;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%d%%"
argument_list|,
name|SIGNED_ROUND
argument_list|(
literal|100.0
operator|*
name|variable_data
operator|->
name|value
operator|.
name|percentage
argument_list|)
argument_list|)
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
name|show_limit
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_DURATION
case|:
name|str
operator|=
name|g_strdup_printf
argument_list|(
literal|"%02d:%02d:%04.1f"
argument_list|,
operator|(
name|gint
operator|)
name|floor
argument_list|(
name|variable_data
operator|->
name|value
operator|.
name|duration
operator|/
literal|3600.0
argument_list|)
argument_list|,
operator|(
name|gint
operator|)
name|floor
argument_list|(
name|fmod
argument_list|(
name|variable_data
operator|->
name|value
operator|.
name|duration
operator|/
literal|60.0
argument_list|,
literal|60.0
argument_list|)
argument_list|)
argument_list|,
name|floor
argument_list|(
name|fmod
argument_list|(
name|variable_data
operator|->
name|value
operator|.
name|duration
argument_list|,
literal|60.0
argument_list|)
operator|*
literal|10.0
argument_list|)
operator|/
literal|10.0
argument_list|)
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
name|show_limit
operator|=
name|FALSE
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
comment|/* Translators:  This string reports the rate of change of a measured            * value.  The "%g" is replaced by a certain quantity, and the "/s"            * is an abbreviation for "per second".            */
name|str
operator|=
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%g/s"
argument_list|)
argument_list|,
name|variable_data
operator|->
name|value
operator|.
name|rate_of_change
argument_list|)
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|show_limit
operator|&&
name|variable_data
operator|->
name|available
operator|&&
name|field_info
operator|->
name|meter_value
operator|&&
operator|!
name|field_info
operator|->
name|meter_variable
operator|&&
name|group_data
operator|->
name|limit
condition|)
block|{
name|gdouble
name|value
decl_stmt|;
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|value
operator|=
name|gimp_dashboard_variable_to_double
argument_list|(
name|dashboard
argument_list|,
name|field_info
operator|->
name|variable
argument_list|)
expr_stmt|;
if|if
condition|(
name|full
condition|)
block|{
name|tmp
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s (%d%%)"
argument_list|,
name|str
argument_list|,
name|SIGNED_ROUND
argument_list|(
literal|100.0
operator|*
name|value
operator|/
name|group_data
operator|->
name|limit
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|tmp
operator|=
name|g_strdup_printf
argument_list|(
literal|"%d%%"
argument_list|,
name|SIGNED_ROUND
argument_list|(
literal|100.0
operator|*
name|value
operator|/
name|group_data
operator|->
name|limit
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|static_str
condition|)
name|g_free
argument_list|(
operator|(
name|gpointer
operator|)
name|str
argument_list|)
expr_stmt|;
name|str
operator|=
name|tmp
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|full
operator|&&
name|field_info
operator|->
name|meter_variable
operator|&&
name|variables
index|[
name|field_info
operator|->
name|meter_variable
index|]
operator|.
name|type
operator|==
name|VARIABLE_TYPE_RATE_OF_CHANGE
operator|&&
name|priv
operator|->
name|variables
index|[
name|field_info
operator|->
name|meter_variable
index|]
operator|.
name|available
condition|)
block|{
name|gdouble
name|value
decl_stmt|;
name|gchar
modifier|*
name|value_str
decl_stmt|;
name|gchar
modifier|*
name|rate_of_change_str
decl_stmt|;
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|value
operator|=
name|gimp_dashboard_variable_to_double
argument_list|(
name|dashboard
argument_list|,
name|field_info
operator|->
name|meter_variable
argument_list|)
expr_stmt|;
name|value_str
operator|=
name|gimp_dashboard_format_value
argument_list|(
name|variable_info
operator|->
name|type
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|rate_of_change_str
operator|=
name|gimp_dashboard_format_rate_of_change
argument_list|(
name|value_str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|value_str
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s (%s)"
argument_list|,
name|str
argument_list|,
name|rate_of_change_str
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|rate_of_change_str
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|static_str
condition|)
name|g_free
argument_list|(
operator|(
name|gpointer
operator|)
name|str
argument_list|)
expr_stmt|;
name|str
operator|=
name|tmp
expr_stmt|;
name|static_str
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|static_str
condition|)
return|return
name|g_strdup
argument_list|(
name|str
argument_list|)
return|;
else|else
return|return
operator|(
name|gpointer
operator|)
name|str
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_dashboard_log_printf (GimpDashboard * dashboard,const gchar * format,...)
name|gimp_dashboard_log_printf
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
specifier|const
name|gchar
modifier|*
name|format
parameter_list|,
modifier|...
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|va_list
name|args
decl_stmt|;
name|gboolean
name|result
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_error
condition|)
return|return
name|FALSE
return|;
name|va_start
argument_list|(
name|args
argument_list|,
name|format
argument_list|)
expr_stmt|;
name|result
operator|=
name|g_output_stream_vprintf
argument_list|(
name|priv
operator|->
name|log_output
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
operator|&
name|priv
operator|->
name|log_error
argument_list|,
name|format
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_dashboard_log_print_escaped (GimpDashboard * dashboard,const gchar * string)
name|gimp_dashboard_log_print_escaped
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
specifier|const
name|gchar
modifier|*
name|string
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|gchar
name|buffer
index|[
literal|1024
index|]
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|s
decl_stmt|;
name|gint
name|i
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_error
condition|)
return|return
name|FALSE
return|;
name|i
operator|=
literal|0
expr_stmt|;
DECL|macro|FLUSH ()
define|#
directive|define
name|FLUSH
parameter_list|()
define|\
value|G_STMT_START                                                  \       {                                                           \         if (! g_output_stream_write_all (priv->log_output,        \                                          buffer, i, NULL,         \                                          NULL,&priv->log_error)) \           {                                                       \             return FALSE;                                         \           }                                                       \                                                                   \         i = 0;                                                    \       }                                                           \     G_STMT_END
DECL|macro|RESERVE (n)
define|#
directive|define
name|RESERVE
parameter_list|(
name|n
parameter_list|)
define|\
value|G_STMT_START                       \       {                                \         if (i + (n)> sizeof (buffer)) \           FLUSH ();                    \       }                                \     G_STMT_END
for|for
control|(
name|s
operator|=
name|string
init|;
operator|*
name|s
condition|;
name|s
operator|++
control|)
block|{
DECL|macro|ESCAPE (from,to)
define|#
directive|define
name|ESCAPE
parameter_list|(
name|from
parameter_list|,
name|to
parameter_list|)
define|\
value|case from:                                  \           RESERVE (sizeof (to) - 1);                \           memcpy (&buffer[i], to, sizeof (to) - 1); \           i += sizeof (to) - 1;                     \           break;
switch|switch
condition|(
operator|*
name|s
condition|)
block|{
name|ESCAPE
argument_list|(
literal|'"'
argument_list|,
literal|"&quot;"
argument_list|)
name|ESCAPE
argument_list|(
literal|'\''
argument_list|,
literal|"&apos;"
argument_list|)
name|ESCAPE
argument_list|(
literal|'<'
argument_list|,
literal|"&lt;"
argument_list|)
name|ESCAPE
argument_list|(
literal|'>'
argument_list|,
literal|"&gt;"
argument_list|)
name|ESCAPE
argument_list|(
literal|'&'
argument_list|,
literal|"&amp;"
argument_list|)
default|default:
name|RESERVE
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|buffer
index|[
name|i
operator|++
index|]
operator|=
operator|*
name|s
expr_stmt|;
break|break;
block|}
undef|#
directive|undef
name|ESCAPE
block|}
name|FLUSH
argument_list|()
expr_stmt|;
undef|#
directive|undef
name|FLUSH
undef|#
directive|undef
name|RESERVE
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gint64
DECL|function|gimp_dashboard_log_time (GimpDashboard * dashboard)
name|gimp_dashboard_log_time
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
return|return
name|g_get_monotonic_time
argument_list|()
operator|-
name|priv
operator|->
name|log_start_time
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_log_sample (GimpDashboard * dashboard,gboolean variables_changed)
name|gimp_dashboard_log_sample
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|gboolean
name|variables_changed
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GimpBacktrace
modifier|*
name|backtrace
init|=
name|NULL
decl_stmt|;
name|gboolean
name|empty
init|=
name|TRUE
decl_stmt|;
name|Variable
name|variable
decl_stmt|;
DECL|macro|NONEMPTY ()
define|#
directive|define
name|NONEMPTY
parameter_list|()
define|\
value|G_STMT_START                                  \       {                                           \         if (empty)                                \           {                                       \             gimp_dashboard_log_printf (dashboard, \                                        ">\n");    \                                                   \             empty = FALSE;                        \           }                                       \       }                                           \     G_STMT_END
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<sample id=\"%d\" t=\"%lld\""
argument_list|,
name|priv
operator|->
name|log_n_samples
argument_list|,
operator|(
name|long
name|long
operator|)
name|gimp_dashboard_log_time
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_n_samples
operator|==
literal|0
operator|||
name|variables_changed
condition|)
block|{
name|NONEMPTY
argument_list|()
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<vars>\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|variable
operator|=
name|FIRST_VARIABLE
init|;
name|variable
operator|<
name|N_VARIABLES
condition|;
name|variable
operator|++
control|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
specifier|const
name|VariableData
modifier|*
name|variable_data
init|=
operator|&
name|priv
operator|->
name|variables
index|[
name|variable
index|]
decl_stmt|;
name|VariableData
modifier|*
name|log_variable_data
init|=
operator|&
name|priv
operator|->
name|log_variables
index|[
name|variable
index|]
decl_stmt|;
if|if
condition|(
name|variable_info
operator|->
name|exclude_from_log
condition|)
continue|continue;
if|if
condition|(
name|priv
operator|->
name|log_n_samples
operator|>
literal|0
operator|&&
operator|!
name|memcmp
argument_list|(
name|variable_data
argument_list|,
name|log_variable_data
argument_list|,
sizeof|sizeof
argument_list|(
name|VariableData
argument_list|)
argument_list|)
condition|)
block|{
continue|continue;
block|}
operator|*
name|log_variable_data
operator|=
operator|*
name|variable_data
expr_stmt|;
if|if
condition|(
name|variable_data
operator|->
name|available
condition|)
block|{
DECL|macro|LOG_VAR (format,...)
define|#
directive|define
name|LOG_VAR
parameter_list|(
name|format
parameter_list|,
modifier|...
parameter_list|)
define|\
value|gimp_dashboard_log_printf (dashboard,               \                                            "<%s>" format "</%s>\n", \                                            variable_info->name,     \                                            __VA_ARGS__,             \                                            variable_info->name)
DECL|macro|LOG_VAR_FLOAT (value)
define|#
directive|define
name|LOG_VAR_FLOAT
parameter_list|(
name|value
parameter_list|)
define|\
value|G_STMT_START                                                \                   {                                                         \                     gchar buffer[G_ASCII_DTOSTR_BUF_SIZE];                  \                                                                             \                     LOG_VAR ("%s", g_ascii_dtostr (buffer, sizeof (buffer), \                                                    value));                 \                   }                                                         \                 G_STMT_END
switch|switch
condition|(
name|variable_info
operator|->
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
name|LOG_VAR
argument_list|(
literal|"%d"
argument_list|,
name|variable_data
operator|->
name|value
operator|.
name|boolean
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
name|LOG_VAR
argument_list|(
literal|"%d"
argument_list|,
name|variable_data
operator|->
name|value
operator|.
name|integer
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_SIZE
case|:
name|LOG_VAR
argument_list|(
literal|"%llu"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|variable_data
operator|->
name|value
operator|.
name|size
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
name|LOG_VAR
argument_list|(
literal|"%llu/%llu"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|antecedent
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|variable_data
operator|->
name|value
operator|.
name|size_ratio
operator|.
name|consequent
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
name|LOG_VAR
argument_list|(
literal|"%d:%d"
argument_list|,
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|antecedent
argument_list|,
name|variable_data
operator|->
name|value
operator|.
name|int_ratio
operator|.
name|consequent
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
name|LOG_VAR_FLOAT
argument_list|(
name|variable_data
operator|->
name|value
operator|.
name|percentage
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_DURATION
case|:
name|LOG_VAR_FLOAT
argument_list|(
name|variable_data
operator|->
name|value
operator|.
name|duration
argument_list|)
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
name|LOG_VAR_FLOAT
argument_list|(
name|variable_data
operator|->
name|value
operator|.
name|rate_of_change
argument_list|)
expr_stmt|;
break|break;
block|}
undef|#
directive|undef
name|LOG_VAR
undef|#
directive|undef
name|LOG_VAR_FLOAT
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<%s />\n"
argument_list|,
name|variable_info
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
block|}
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</vars>\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|log_include_backtrace
condition|)
name|backtrace
operator|=
name|gimp_backtrace_new
argument_list|(
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|backtrace
condition|)
block|{
name|gboolean
name|backtrace_empty
init|=
name|TRUE
decl_stmt|;
name|gint
name|n_threads
decl_stmt|;
name|gint
name|thread
decl_stmt|;
DECL|macro|BACKTRACE_NONEMPTY ()
define|#
directive|define
name|BACKTRACE_NONEMPTY
parameter_list|()
define|\
value|G_STMT_START                                         \           {                                                  \             if (backtrace_empty)                             \               {                                              \                 NONEMPTY ();                                 \                                                              \                 gimp_dashboard_log_printf (dashboard,        \                                            "<backtrace>\n"); \                                                              \                 backtrace_empty = FALSE;                     \               }                                              \           }                                                  \         G_STMT_END
if|if
condition|(
name|priv
operator|->
name|log_backtrace
condition|)
block|{
name|n_threads
operator|=
name|gimp_backtrace_get_n_threads
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|)
expr_stmt|;
for|for
control|(
name|thread
operator|=
literal|0
init|;
name|thread
operator|<
name|n_threads
condition|;
name|thread
operator|++
control|)
block|{
name|guintptr
name|thread_id
decl_stmt|;
name|thread_id
operator|=
name|gimp_backtrace_get_thread_id
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|,
name|thread
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_backtrace_find_thread_by_id
argument_list|(
name|backtrace
argument_list|,
name|thread_id
argument_list|,
name|thread
argument_list|)
operator|<
literal|0
condition|)
block|{
specifier|const
name|gchar
modifier|*
name|thread_name
decl_stmt|;
name|BACKTRACE_NONEMPTY
argument_list|()
expr_stmt|;
name|thread_name
operator|=
name|gimp_backtrace_get_thread_name
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|,
name|thread
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<thread id=\"%llu\""
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|thread_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|thread_name
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" name=\""
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|thread_name
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
block|}
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" />\n"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|n_threads
operator|=
name|gimp_backtrace_get_n_threads
argument_list|(
name|backtrace
argument_list|)
expr_stmt|;
for|for
control|(
name|thread
operator|=
literal|0
init|;
name|thread
operator|<
name|n_threads
condition|;
name|thread
operator|++
control|)
block|{
name|guintptr
name|thread_id
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|thread_name
decl_stmt|;
name|gint
name|last_running
init|=
operator|-
literal|1
decl_stmt|;
name|gint
name|running
decl_stmt|;
name|gint
name|last_n_frames
init|=
operator|-
literal|1
decl_stmt|;
name|gint
name|n_frames
decl_stmt|;
name|gint
name|n_head
init|=
literal|0
decl_stmt|;
name|gint
name|n_tail
init|=
literal|0
decl_stmt|;
name|gint
name|frame
decl_stmt|;
name|thread_id
operator|=
name|gimp_backtrace_get_thread_id
argument_list|(
name|backtrace
argument_list|,
name|thread
argument_list|)
expr_stmt|;
name|thread_name
operator|=
name|gimp_backtrace_get_thread_name
argument_list|(
name|backtrace
argument_list|,
name|thread
argument_list|)
expr_stmt|;
name|running
operator|=
name|gimp_backtrace_is_thread_running
argument_list|(
name|backtrace
argument_list|,
name|thread
argument_list|)
expr_stmt|;
name|n_frames
operator|=
name|gimp_backtrace_get_n_frames
argument_list|(
name|backtrace
argument_list|,
name|thread
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_backtrace
condition|)
block|{
name|gint
name|other_thread
init|=
name|gimp_backtrace_find_thread_by_id
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|,
name|thread_id
argument_list|,
name|thread
argument_list|)
decl_stmt|;
if|if
condition|(
name|other_thread
operator|>=
literal|0
condition|)
block|{
name|gint
name|n
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|last_running
operator|=
name|gimp_backtrace_is_thread_running
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|,
name|other_thread
argument_list|)
expr_stmt|;
name|last_n_frames
operator|=
name|gimp_backtrace_get_n_frames
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|,
name|other_thread
argument_list|)
expr_stmt|;
name|n
operator|=
name|MIN
argument_list|(
name|n_frames
argument_list|,
name|last_n_frames
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|gimp_backtrace_get_frame_address
argument_list|(
name|backtrace
argument_list|,
name|thread
argument_list|,
name|i
argument_list|)
operator|!=
name|gimp_backtrace_get_frame_address
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|,
name|other_thread
argument_list|,
name|i
argument_list|)
condition|)
block|{
break|break;
block|}
block|}
name|n_head
operator|=
name|i
expr_stmt|;
name|n
operator|-=
name|i
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|gimp_backtrace_get_frame_address
argument_list|(
name|backtrace
argument_list|,
name|thread
argument_list|,
operator|-
name|i
operator|-
literal|1
argument_list|)
operator|!=
name|gimp_backtrace_get_frame_address
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|,
name|other_thread
argument_list|,
operator|-
name|i
operator|-
literal|1
argument_list|)
condition|)
block|{
break|break;
block|}
block|}
name|n_tail
operator|=
name|i
expr_stmt|;
block|}
block|}
if|if
condition|(
name|running
operator|==
name|last_running
operator|&&
name|n_frames
operator|==
name|last_n_frames
operator|&&
name|n_head
operator|+
name|n_tail
operator|==
name|n_frames
condition|)
block|{
continue|continue;
block|}
name|BACKTRACE_NONEMPTY
argument_list|()
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<thread id=\"%llu\""
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|thread_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|thread_name
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" name=\""
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|thread_name
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
block|}
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" running=\"%d\""
argument_list|,
name|running
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_head
operator|>
literal|0
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" head=\"%d\""
argument_list|,
name|n_head
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|n_tail
operator|>
literal|0
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" tail=\"%d\""
argument_list|,
name|n_tail
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|n_frames
operator|==
literal|0
operator|||
name|n_head
operator|+
name|n_tail
operator|<
name|n_frames
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|">\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|frame
operator|=
name|n_head
init|;
name|frame
operator|<
name|n_frames
operator|-
name|n_tail
condition|;
name|frame
operator|++
control|)
block|{
name|unsigned
name|long
name|long
name|address
decl_stmt|;
name|address
operator|=
name|gimp_backtrace_get_frame_address
argument_list|(
name|backtrace
argument_list|,
name|thread
argument_list|,
name|frame
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<frame address=\"0x%llx\" />\n"
argument_list|,
name|address
argument_list|)
expr_stmt|;
name|g_hash_table_add
argument_list|(
name|priv
operator|->
name|log_addresses
argument_list|,
operator|(
name|gpointer
operator|)
name|address
argument_list|)
expr_stmt|;
block|}
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</thread>\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" />\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|backtrace_empty
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</backtrace>\n"
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|BACKTRACE_NONEMPTY
block|}
elseif|else
if|if
condition|(
name|priv
operator|->
name|log_backtrace
condition|)
block|{
name|NONEMPTY
argument_list|()
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<backtrace />\n"
argument_list|)
expr_stmt|;
block|}
name|gimp_backtrace_free
argument_list|(
name|priv
operator|->
name|log_backtrace
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_backtrace
operator|=
name|backtrace
expr_stmt|;
if|if
condition|(
name|empty
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" />\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</sample>\n"
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|NONEMPTY
name|priv
operator|->
name|log_n_samples
operator|++
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_log_update_highlight (GimpDashboard * dashboard)
name|gimp_dashboard_log_update_highlight
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GtkReliefStyle
name|default_relief
decl_stmt|;
name|gtk_widget_style_get
argument_list|(
name|GTK_WIDGET
argument_list|(
name|dashboard
argument_list|)
argument_list|,
literal|"button-relief"
argument_list|,
operator|&
name|default_relief
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_button_set_suggested
argument_list|(
name|priv
operator|->
name|log_record_button
argument_list|,
name|gimp_dashboard_log_is_recording
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|default_relief
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_log_update_n_markers (GimpDashboard * dashboard)
name|gimp_dashboard_log_update_n_markers
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|gchar
name|buffer
index|[
literal|32
index|]
decl_stmt|;
name|g_snprintf
argument_list|(
name|buffer
argument_list|,
sizeof|sizeof
argument_list|(
name|buffer
argument_list|)
argument_list|,
literal|"%d"
argument_list|,
name|priv
operator|->
name|log_n_markers
operator|+
literal|1
argument_list|)
expr_stmt|;
name|gtk_label_set_text
argument_list|(
name|priv
operator|->
name|log_add_marker_label
argument_list|,
name|buffer
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint
DECL|function|gimp_dashboard_log_compare_addresses (gconstpointer a1,gconstpointer a2)
name|gimp_dashboard_log_compare_addresses
parameter_list|(
name|gconstpointer
name|a1
parameter_list|,
name|gconstpointer
name|a2
parameter_list|)
block|{
name|guintptr
name|address1
init|=
operator|*
operator|(
specifier|const
name|guintptr
operator|*
operator|)
name|a1
decl_stmt|;
name|guintptr
name|address2
init|=
operator|*
operator|(
specifier|const
name|guintptr
operator|*
operator|)
name|a2
decl_stmt|;
if|if
condition|(
name|address1
operator|<
name|address2
condition|)
return|return
operator|-
literal|1
return|;
elseif|else
if|if
condition|(
name|address1
operator|>
name|address2
condition|)
return|return
operator|+
literal|1
return|;
else|else
return|return
literal|0
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_log_write_address_map (GimpAsync * async,GimpDashboard * dashboard)
name|gimp_dashboard_log_write_address_map
parameter_list|(
name|GimpAsync
modifier|*
name|async
parameter_list|,
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
init|=
name|dashboard
operator|->
name|priv
decl_stmt|;
name|GimpBacktraceAddressInfo
name|infos
index|[
literal|2
index|]
decl_stmt|;
name|guintptr
modifier|*
name|addresses
decl_stmt|;
name|gint
name|n_addresses
decl_stmt|;
name|GList
modifier|*
name|iter
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|gint
name|n
decl_stmt|;
name|n_addresses
operator|=
name|g_hash_table_size
argument_list|(
name|priv
operator|->
name|log_addresses
argument_list|)
expr_stmt|;
if|if
condition|(
name|n_addresses
operator|==
literal|0
condition|)
block|{
name|gimp_async_finish
argument_list|(
name|async
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return;
block|}
name|addresses
operator|=
name|g_new
argument_list|(
name|guintptr
argument_list|,
name|n_addresses
argument_list|)
expr_stmt|;
for|for
control|(
name|iter
operator|=
name|g_hash_table_get_keys
argument_list|(
name|priv
operator|->
name|log_addresses
argument_list|)
operator|,
name|i
operator|=
literal|0
init|;
name|iter
condition|;
name|iter
operator|=
name|g_list_next
argument_list|(
name|iter
argument_list|)
operator|,
name|i
operator|++
control|)
block|{
name|addresses
index|[
name|i
index|]
operator|=
operator|(
name|guintptr
operator|)
name|iter
operator|->
name|data
expr_stmt|;
block|}
name|qsort
argument_list|(
name|addresses
argument_list|,
name|n_addresses
argument_list|,
sizeof|sizeof
argument_list|(
name|guintptr
argument_list|)
argument_list|,
name|gimp_dashboard_log_compare_addresses
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<address-map>\n"
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_addresses
condition|;
name|i
operator|++
control|)
block|{
name|GimpBacktraceAddressInfo
modifier|*
name|info
init|=
operator|&
name|infos
index|[
name|n
operator|%
literal|2
index|]
decl_stmt|;
specifier|const
name|GimpBacktraceAddressInfo
modifier|*
name|prev_info
init|=
operator|&
name|infos
index|[
operator|(
name|n
operator|+
literal|1
operator|)
operator|%
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|gimp_async_is_canceled
argument_list|(
name|async
argument_list|)
condition|)
break|break;
if|if
condition|(
name|gimp_backtrace_get_address_info
argument_list|(
name|addresses
index|[
name|i
index|]
argument_list|,
name|info
argument_list|)
condition|)
block|{
name|gboolean
name|empty
init|=
name|TRUE
decl_stmt|;
DECL|macro|NONEMPTY ()
define|#
directive|define
name|NONEMPTY
parameter_list|()
define|\
value|G_STMT_START                                  \               {                                           \                 if (empty)                                \                   {                                       \                     gimp_dashboard_log_printf (dashboard, \                                                ">\n");    \                                                           \                     empty = FALSE;                        \                   }                                       \               }                                           \             G_STMT_END
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<address value=\"0x%llx\""
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|addresses
index|[
name|i
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|n
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|info
operator|->
name|object_name
argument_list|,
name|prev_info
operator|->
name|object_name
argument_list|)
condition|)
block|{
name|NONEMPTY
argument_list|()
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|object_name
index|[
literal|0
index|]
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<object>"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|info
operator|->
name|object_name
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</object>\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<object />\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|n
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|info
operator|->
name|symbol_name
argument_list|,
name|prev_info
operator|->
name|symbol_name
argument_list|)
condition|)
block|{
name|NONEMPTY
argument_list|()
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|symbol_name
index|[
literal|0
index|]
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<symbol>"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|info
operator|->
name|symbol_name
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</symbol>\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<symbol />\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|n
operator|==
literal|0
operator|||
name|info
operator|->
name|symbol_address
operator|!=
name|prev_info
operator|->
name|symbol_address
condition|)
block|{
name|NONEMPTY
argument_list|()
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|symbol_address
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<base>0x%llx</base>\n"
argument_list|,
operator|(
name|unsigned
name|long
name|long
operator|)
name|info
operator|->
name|symbol_address
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<base />\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|n
operator|==
literal|0
operator|||
name|strcmp
argument_list|(
name|info
operator|->
name|source_file
argument_list|,
name|prev_info
operator|->
name|source_file
argument_list|)
condition|)
block|{
name|NONEMPTY
argument_list|()
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|source_file
index|[
literal|0
index|]
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<source>"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|info
operator|->
name|source_file
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</source>\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<source />\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|n
operator|==
literal|0
operator|||
name|info
operator|->
name|source_line
operator|!=
name|prev_info
operator|->
name|source_line
condition|)
block|{
name|NONEMPTY
argument_list|()
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|source_line
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<line>%d</line>\n"
argument_list|,
name|info
operator|->
name|source_line
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<line />\n"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|empty
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" />\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</address>\n"
argument_list|)
expr_stmt|;
block|}
undef|#
directive|undef
name|NONEMPTY
name|n
operator|++
expr_stmt|;
block|}
block|}
name|g_free
argument_list|(
name|addresses
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"</address-map>\n"
argument_list|)
expr_stmt|;
name|gimp_async_finish
argument_list|(
name|async
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_dashboard_field_use_meter_underlay (Group group,gint field)
name|gimp_dashboard_field_use_meter_underlay
parameter_list|(
name|Group
name|group
parameter_list|,
name|gint
name|field
parameter_list|)
block|{
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|Variable
name|variable
init|=
name|group_info
operator|->
name|fields
index|[
name|field
index|]
operator|.
name|variable
decl_stmt|;
specifier|const
name|VariableInfo
modifier|*
name|variable_info
decl_stmt|;
if|if
condition|(
name|group_info
operator|->
name|fields
index|[
name|field
index|]
operator|.
name|meter_variable
condition|)
name|variable
operator|=
name|group_info
operator|->
name|fields
index|[
name|field
index|]
operator|.
name|meter_variable
expr_stmt|;
name|variable_info
operator|=
operator|&
name|variables
index|[
name|variable
index|]
expr_stmt|;
return|return
name|variable_info
operator|->
name|type
operator|==
name|VARIABLE_TYPE_BOOLEAN
operator|||
operator|(
name|group_info
operator|->
name|fields
index|[
name|field
index|]
operator|.
name|meter_variable
operator|&&
name|variable_info
operator|->
name|type
operator|==
name|VARIABLE_TYPE_RATE_OF_CHANGE
operator|)
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|gimp_dashboard_format_rate_of_change (const gchar * value)
name|gimp_dashboard_format_rate_of_change
parameter_list|(
specifier|const
name|gchar
modifier|*
name|value
parameter_list|)
block|{
comment|/* Translators:  This string reports the rate of change of a measured value.    * The first "%s" is replaced by a certain quantity, usually followed by a    * unit of measurement (e.g., "10 bytes"). and the final "/s" is an    * abbreviation for "per second" (so the full string would read    * "10 bytes/s", that is, "10 bytes per second".    */
return|return
name|g_strdup_printf
argument_list|(
name|_
argument_list|(
literal|"%s/s"
argument_list|)
argument_list|,
name|value
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|gimp_dashboard_format_value (VariableType type,gdouble value)
name|gimp_dashboard_format_value
parameter_list|(
name|VariableType
name|type
parameter_list|,
name|gdouble
name|value
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
return|return
name|g_strdup
argument_list|(
name|value
condition|?
name|C_
argument_list|(
literal|"dashboard-value"
argument_list|,
literal|"Yes"
argument_list|)
else|:
name|C_
argument_list|(
literal|"dashboard-value"
argument_list|,
literal|"No"
argument_list|)
argument_list|)
return|;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
return|return
name|g_strdup_printf
argument_list|(
literal|"%g"
argument_list|,
name|value
argument_list|)
return|;
case|case
name|VARIABLE_TYPE_SIZE
case|:
return|return
name|g_format_size_full
argument_list|(
name|value
argument_list|,
name|G_FORMAT_SIZE_IEC_UNITS
argument_list|)
return|;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
if|if
condition|(
name|isfinite
argument_list|(
name|value
argument_list|)
condition|)
return|return
name|g_strdup_printf
argument_list|(
literal|"%d%%"
argument_list|,
name|SIGNED_ROUND
argument_list|(
literal|100.0
operator|*
name|value
argument_list|)
argument_list|)
return|;
break|break;
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
if|if
condition|(
name|isfinite
argument_list|(
name|value
argument_list|)
condition|)
block|{
name|gdouble
name|min
decl_stmt|;
name|gdouble
name|max
decl_stmt|;
name|gdouble
name|antecedent
decl_stmt|;
name|gdouble
name|consequent
decl_stmt|;
name|antecedent
operator|=
name|value
expr_stmt|;
name|consequent
operator|=
literal|1.0
expr_stmt|;
name|min
operator|=
name|MIN
argument_list|(
name|ABS
argument_list|(
name|antecedent
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|consequent
argument_list|)
argument_list|)
expr_stmt|;
name|max
operator|=
name|MAX
argument_list|(
name|ABS
argument_list|(
name|antecedent
argument_list|)
argument_list|,
name|ABS
argument_list|(
name|consequent
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|min
condition|)
block|{
name|antecedent
operator|/=
name|min
expr_stmt|;
name|consequent
operator|/=
name|min
expr_stmt|;
block|}
else|else
block|{
name|antecedent
operator|/=
name|max
expr_stmt|;
name|consequent
operator|/=
name|max
expr_stmt|;
block|}
return|return
name|g_strdup_printf
argument_list|(
literal|"%g:%g"
argument_list|,
name|RINT
argument_list|(
literal|100.0
operator|*
name|antecedent
argument_list|)
operator|/
literal|100.0
argument_list|,
name|RINT
argument_list|(
literal|100.0
operator|*
name|consequent
argument_list|)
operator|/
literal|100.0
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|isinf
argument_list|(
name|value
argument_list|)
condition|)
block|{
return|return
name|g_strdup
argument_list|(
literal|"1:0"
argument_list|)
return|;
block|}
break|break;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
return|return
name|g_strdup_printf
argument_list|(
literal|"%d%%"
argument_list|,
name|SIGNED_ROUND
argument_list|(
literal|100.0
operator|*
name|value
argument_list|)
argument_list|)
return|;
case|case
name|VARIABLE_TYPE_DURATION
case|:
return|return
name|g_strdup_printf
argument_list|(
literal|"%02d:%02d:%04.1f"
argument_list|,
operator|(
name|gint
operator|)
name|floor
argument_list|(
name|value
operator|/
literal|3600.0
argument_list|)
argument_list|,
operator|(
name|gint
operator|)
name|floor
argument_list|(
name|fmod
argument_list|(
name|value
operator|/
literal|60.0
argument_list|,
literal|60.0
argument_list|)
argument_list|)
argument_list|,
name|floor
argument_list|(
name|fmod
argument_list|(
name|value
argument_list|,
literal|60.0
argument_list|)
operator|*
literal|10.0
argument_list|)
operator|/
literal|10.0
argument_list|)
return|;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
block|{
name|gchar
name|buf
index|[
literal|64
index|]
decl_stmt|;
name|g_snprintf
argument_list|(
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
argument_list|,
literal|"%g"
argument_list|,
name|value
argument_list|)
expr_stmt|;
return|return
name|gimp_dashboard_format_rate_of_change
argument_list|(
name|buf
argument_list|)
return|;
block|}
block|}
return|return
name|g_strdup
argument_list|(
name|_
argument_list|(
literal|"N/A"
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_dashboard_label_set_text (GtkLabel * label,const gchar * text)
name|gimp_dashboard_label_set_text
parameter_list|(
name|GtkLabel
modifier|*
name|label
parameter_list|,
specifier|const
name|gchar
modifier|*
name|text
parameter_list|)
block|{
comment|/* the strcmp() reduces the overhead of gtk_label_set_text() when the    * text hasn't changed    */
if|if
condition|(
name|g_strcmp0
argument_list|(
name|gtk_label_get_text
argument_list|(
name|label
argument_list|)
argument_list|,
name|text
argument_list|)
condition|)
name|gtk_label_set_text
argument_list|(
name|label
argument_list|,
name|text
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  public functions  */
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_dashboard_new (Gimp * gimp,GimpMenuFactory * menu_factory)
name|gimp_dashboard_new
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|GimpMenuFactory
modifier|*
name|menu_factory
parameter_list|)
block|{
name|GimpDashboard
modifier|*
name|dashboard
decl_stmt|;
name|dashboard
operator|=
name|g_object_new
argument_list|(
name|GIMP_TYPE_DASHBOARD
argument_list|,
literal|"menu-factory"
argument_list|,
name|menu_factory
argument_list|,
literal|"menu-identifier"
argument_list|,
literal|"<Dashboard>"
argument_list|,
literal|"ui-path"
argument_list|,
literal|"/dashboard-popup"
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|dashboard
operator|->
name|priv
operator|->
name|gimp
operator|=
name|gimp
expr_stmt|;
return|return
name|GTK_WIDGET
argument_list|(
name|dashboard
argument_list|)
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_dashboard_log_start_recording (GimpDashboard * dashboard,GFile * file,GError ** error)
name|gimp_dashboard_log_start_recording
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GFile
modifier|*
name|file
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpUIManager
modifier|*
name|ui_manager
decl_stmt|;
name|GimpActionGroup
modifier|*
name|action_group
decl_stmt|;
name|gchar
modifier|*
name|version
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|envp
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|env
decl_stmt|;
name|GParamSpec
modifier|*
modifier|*
name|pspecs
decl_stmt|;
name|guint
name|n_pspecs
decl_stmt|;
name|gboolean
name|has_backtrace
decl_stmt|;
name|Variable
name|variable
decl_stmt|;
name|guint
name|i
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|G_IS_FILE
argument_list|(
name|file
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|error
operator|==
name|NULL
operator|||
operator|*
name|error
operator|==
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
operator|!
name|gimp_dashboard_log_is_recording
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_output
operator|=
name|G_OUTPUT_STREAM
argument_list|(
name|g_file_replace
argument_list|(
name|file
argument_list|,
name|NULL
argument_list|,
name|FALSE
argument_list|,
name|G_FILE_CREATE_NONE
argument_list|,
name|NULL
argument_list|,
name|error
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|priv
operator|->
name|log_output
condition|)
block|{
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
name|priv
operator|->
name|log_error
operator|=
name|NULL
expr_stmt|;
name|priv
operator|->
name|log_start_time
operator|=
name|g_get_monotonic_time
argument_list|()
expr_stmt|;
name|priv
operator|->
name|log_sample_frequency
operator|=
name|LOG_SAMPLE_FREQUENCY
expr_stmt|;
name|priv
operator|->
name|log_n_samples
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|log_n_markers
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|log_include_backtrace
operator|=
name|TRUE
expr_stmt|;
name|priv
operator|->
name|log_backtrace
operator|=
name|NULL
expr_stmt|;
name|priv
operator|->
name|log_addresses
operator|=
name|g_hash_table_new
argument_list|(
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_getenv
argument_list|(
literal|"GIMP_PERFORMANCE_LOG_SAMPLE_FREQUENCY"
argument_list|)
condition|)
block|{
name|priv
operator|->
name|log_sample_frequency
operator|=
name|atoi
argument_list|(
name|g_getenv
argument_list|(
literal|"GIMP_PERFORMANCE_LOG_SAMPLE_FREQUENCY"
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_sample_frequency
operator|=
name|CLAMP
argument_list|(
name|priv
operator|->
name|log_sample_frequency
argument_list|,
literal|1
argument_list|,
literal|1000
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|g_getenv
argument_list|(
literal|"GIMP_PERFORMANCE_LOG_NO_BACKTRACE"
argument_list|)
condition|)
name|priv
operator|->
name|log_include_backtrace
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_include_backtrace
condition|)
name|has_backtrace
operator|=
name|gimp_backtrace_start
argument_list|()
expr_stmt|;
else|else
name|has_backtrace
operator|=
name|FALSE
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n"
literal|"<gimp-performance-log version=\"%d\">\n"
argument_list|,
name|LOG_VERSION
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<params>\n"
literal|"<sample-frequency>%d</sample-frequency>\n"
literal|"<backtrace>%d</backtrace>\n"
literal|"</params>\n"
argument_list|,
name|priv
operator|->
name|log_sample_frequency
argument_list|,
name|has_backtrace
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<info>\n"
argument_list|)
expr_stmt|;
name|version
operator|=
name|gimp_version
argument_list|(
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<gimp-version>\n"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|version
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</gimp-version>\n"
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|version
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<env>\n"
argument_list|)
expr_stmt|;
name|envp
operator|=
name|g_get_environ
argument_list|()
expr_stmt|;
for|for
control|(
name|env
operator|=
name|envp
init|;
operator|*
name|env
condition|;
name|env
operator|++
control|)
block|{
if|if
condition|(
name|g_str_has_prefix
argument_list|(
operator|*
name|env
argument_list|,
literal|"BABL_"
argument_list|)
operator|||
name|g_str_has_prefix
argument_list|(
operator|*
name|env
argument_list|,
literal|"GEGL_"
argument_list|)
operator|||
name|g_str_has_prefix
argument_list|(
operator|*
name|env
argument_list|,
literal|"GIMP_"
argument_list|)
condition|)
block|{
name|gchar
modifier|*
name|delim
init|=
name|strchr
argument_list|(
operator|*
name|env
argument_list|,
literal|'='
argument_list|)
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|s
decl_stmt|;
if|if
condition|(
operator|!
name|delim
condition|)
continue|continue;
for|for
control|(
name|s
operator|=
operator|*
name|env
init|;
name|s
operator|!=
name|delim
operator|&&
operator|(
name|g_ascii_isalnum
argument_list|(
operator|*
name|s
argument_list|)
operator|||
operator|*
name|s
operator|==
literal|'_'
operator|||
operator|*
name|s
operator|==
literal|'-'
operator|)
condition|;
name|s
operator|++
control|)
empty_stmt|;
if|if
condition|(
name|s
operator|!=
name|delim
condition|)
continue|continue;
operator|*
name|delim
operator|=
literal|'\0'
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<%s>"
argument_list|,
operator|*
name|env
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|delim
operator|+
literal|1
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</%s>\n"
argument_list|,
operator|*
name|env
argument_list|)
expr_stmt|;
block|}
block|}
name|g_strfreev
argument_list|(
name|envp
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</env>\n"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<gegl-config>\n"
argument_list|)
expr_stmt|;
name|pspecs
operator|=
name|g_object_class_list_properties
argument_list|(
name|G_OBJECT_GET_CLASS
argument_list|(
name|gegl_config
argument_list|()
argument_list|)
argument_list|,
operator|&
name|n_pspecs
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|n_pspecs
condition|;
name|i
operator|++
control|)
block|{
specifier|const
name|GParamSpec
modifier|*
name|pspec
init|=
name|pspecs
index|[
name|i
index|]
decl_stmt|;
name|GValue
name|value
init|=
block|{}
decl_stmt|;
name|GValue
name|str_value
init|=
block|{}
decl_stmt|;
name|g_value_init
argument_list|(
operator|&
name|value
argument_list|,
name|pspec
operator|->
name|value_type
argument_list|)
expr_stmt|;
name|g_value_init
argument_list|(
operator|&
name|str_value
argument_list|,
name|G_TYPE_STRING
argument_list|)
expr_stmt|;
name|g_object_get_property
argument_list|(
name|G_OBJECT
argument_list|(
name|gegl_config
argument_list|()
argument_list|)
argument_list|,
name|pspec
operator|->
name|name
argument_list|,
operator|&
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_value_transform
argument_list|(
operator|&
name|value
argument_list|,
operator|&
name|str_value
argument_list|)
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<%s>"
argument_list|,
name|pspec
operator|->
name|name
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|g_value_get_string
argument_list|(
operator|&
name|str_value
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</%s>\n"
argument_list|,
name|pspec
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
name|g_value_unset
argument_list|(
operator|&
name|str_value
argument_list|)
expr_stmt|;
name|g_value_unset
argument_list|(
operator|&
name|value
argument_list|)
expr_stmt|;
block|}
name|g_free
argument_list|(
name|pspecs
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</gegl-config>\n"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"</info>\n"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<var-defs>\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|variable
operator|=
name|FIRST_VARIABLE
init|;
name|variable
operator|<
name|N_VARIABLES
condition|;
name|variable
operator|++
control|)
block|{
specifier|const
name|VariableInfo
modifier|*
name|variable_info
init|=
operator|&
name|variables
index|[
name|variable
index|]
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|type
init|=
literal|""
decl_stmt|;
if|if
condition|(
name|variable_info
operator|->
name|exclude_from_log
condition|)
continue|continue;
switch|switch
condition|(
name|variable_info
operator|->
name|type
condition|)
block|{
case|case
name|VARIABLE_TYPE_BOOLEAN
case|:
name|type
operator|=
literal|"boolean"
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_INTEGER
case|:
name|type
operator|=
literal|"integer"
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_SIZE
case|:
name|type
operator|=
literal|"size"
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_SIZE_RATIO
case|:
name|type
operator|=
literal|"size-ratio"
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_INT_RATIO
case|:
name|type
operator|=
literal|"int-ratio"
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_PERCENTAGE
case|:
name|type
operator|=
literal|"percentage"
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_DURATION
case|:
name|type
operator|=
literal|"duration"
expr_stmt|;
break|break;
case|case
name|VARIABLE_TYPE_RATE_OF_CHANGE
case|:
name|type
operator|=
literal|"rate-of-change"
expr_stmt|;
break|break;
block|}
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"<var name=\"%s\" type=\"%s\" desc=\""
argument_list|,
name|variable_info
operator|->
name|name
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
comment|/* intentionally untranslated */
name|variable_info
operator|->
name|description
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\" />\n"
argument_list|)
expr_stmt|;
block|}
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"</var-defs>\n"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<samples>\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_error
condition|)
block|{
name|GCancellable
modifier|*
name|cancellable
init|=
name|g_cancellable_new
argument_list|()
decl_stmt|;
name|gimp_backtrace_stop
argument_list|()
expr_stmt|;
comment|/* Cancel the overwrite initiated by g_file_replace(). */
name|g_cancellable_cancel
argument_list|(
name|cancellable
argument_list|)
expr_stmt|;
name|g_output_stream_close
argument_list|(
name|priv
operator|->
name|log_output
argument_list|,
name|cancellable
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|cancellable
argument_list|)
expr_stmt|;
name|g_clear_object
argument_list|(
operator|&
name|priv
operator|->
name|log_output
argument_list|)
expr_stmt|;
name|g_propagate_error
argument_list|(
name|error
argument_list|,
name|priv
operator|->
name|log_error
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_error
operator|=
name|NULL
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
name|gimp_dashboard_reset_unlocked
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
name|priv
operator|->
name|update_now
operator|=
name|TRUE
expr_stmt|;
name|g_cond_signal
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_update_n_markers
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
name|ui_manager
operator|=
name|gimp_editor_get_ui_manager
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|action_group
operator|=
name|gimp_ui_manager_get_action_group
argument_list|(
name|ui_manager
argument_list|,
literal|"dashboard"
argument_list|)
expr_stmt|;
name|gimp_action_group_update
argument_list|(
name|action_group
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_update_highlight
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_dashboard_log_stop_recording (GimpDashboard * dashboard,GError ** error)
name|gimp_dashboard_log_stop_recording
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|GimpUIManager
modifier|*
name|ui_manager
decl_stmt|;
name|GimpActionGroup
modifier|*
name|action_group
decl_stmt|;
name|gboolean
name|result
init|=
name|TRUE
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|error
operator|==
name|NULL
operator|||
operator|*
name|error
operator|==
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
if|if
condition|(
operator|!
name|gimp_dashboard_log_is_recording
argument_list|(
name|dashboard
argument_list|)
condition|)
return|return
name|TRUE
return|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"</samples>\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|g_hash_table_size
argument_list|(
name|priv
operator|->
name|log_addresses
argument_list|)
operator|>
literal|0
condition|)
block|{
name|GimpAsync
modifier|*
name|async
decl_stmt|;
name|async
operator|=
name|gimp_parallel_run_async_full
argument_list|(
operator|-
literal|1
argument_list|,
operator|(
name|GimpParallelRunAsyncFunc
operator|)
name|gimp_dashboard_log_write_address_map
argument_list|,
name|dashboard
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_wait
argument_list|(
name|priv
operator|->
name|gimp
argument_list|,
name|GIMP_WAITABLE
argument_list|(
name|async
argument_list|)
argument_list|,
name|_
argument_list|(
literal|"Resolving symbol information..."
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|async
argument_list|)
expr_stmt|;
block|}
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"</gimp-performance-log>\n"
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_include_backtrace
condition|)
name|gimp_backtrace_stop
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|priv
operator|->
name|log_error
condition|)
block|{
name|g_output_stream_close
argument_list|(
name|priv
operator|->
name|log_output
argument_list|,
name|NULL
argument_list|,
operator|&
name|priv
operator|->
name|log_error
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|GCancellable
modifier|*
name|cancellable
init|=
name|g_cancellable_new
argument_list|()
decl_stmt|;
comment|/* Cancel the overwrite initiated by g_file_replace(). */
name|g_cancellable_cancel
argument_list|(
name|cancellable
argument_list|)
expr_stmt|;
name|g_output_stream_close
argument_list|(
name|priv
operator|->
name|log_output
argument_list|,
name|cancellable
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|cancellable
argument_list|)
expr_stmt|;
block|}
name|g_clear_object
argument_list|(
operator|&
name|priv
operator|->
name|log_output
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|log_error
condition|)
block|{
name|g_propagate_error
argument_list|(
name|error
argument_list|,
name|priv
operator|->
name|log_error
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_error
operator|=
name|NULL
expr_stmt|;
name|result
operator|=
name|FALSE
expr_stmt|;
block|}
name|g_clear_pointer
argument_list|(
operator|&
name|priv
operator|->
name|log_backtrace
argument_list|,
name|gimp_backtrace_free
argument_list|)
expr_stmt|;
name|g_clear_pointer
argument_list|(
operator|&
name|priv
operator|->
name|log_addresses
argument_list|,
name|g_hash_table_unref
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|ui_manager
operator|=
name|gimp_editor_get_ui_manager
argument_list|(
name|GIMP_EDITOR
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|action_group
operator|=
name|gimp_ui_manager_get_action_group
argument_list|(
name|ui_manager
argument_list|,
literal|"dashboard"
argument_list|)
expr_stmt|;
name|gimp_action_group_update
argument_list|(
name|action_group
argument_list|,
name|dashboard
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_update_highlight
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_dashboard_log_is_recording (GimpDashboard * dashboard)
name|gimp_dashboard_log_is_recording
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
return|return
name|priv
operator|->
name|log_output
operator|!=
name|NULL
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_dashboard_log_add_marker (GimpDashboard * dashboard,const gchar * description)
name|gimp_dashboard_log_add_marker
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
specifier|const
name|gchar
modifier|*
name|description
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gimp_dashboard_log_is_recording
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|priv
operator|->
name|log_n_markers
operator|++
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"<marker id=\"%d\" t=\"%lld\""
argument_list|,
name|priv
operator|->
name|log_n_markers
argument_list|,
operator|(
name|long
name|long
operator|)
name|gimp_dashboard_log_time
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|description
operator|&&
name|description
index|[
literal|0
index|]
condition|)
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|">\n"
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_print_escaped
argument_list|(
name|dashboard
argument_list|,
name|description
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|"\n"
literal|"</marker>\n"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gimp_dashboard_log_printf
argument_list|(
name|dashboard
argument_list|,
literal|" />\n"
argument_list|)
expr_stmt|;
block|}
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_dashboard_log_update_n_markers
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_dashboard_reset (GimpDashboard * dashboard)
name|gimp_dashboard_reset
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|gimp_dashboard_reset_unlocked
argument_list|(
name|dashboard
argument_list|)
expr_stmt|;
name|priv
operator|->
name|update_now
operator|=
name|TRUE
expr_stmt|;
name|g_cond_signal
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_dashboard_set_update_interval (GimpDashboard * dashboard,GimpDashboardUpdateInteval update_interval)
name|gimp_dashboard_set_update_interval
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GimpDashboardUpdateInteval
name|update_interval
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|update_interval
operator|!=
name|priv
operator|->
name|update_interval
condition|)
block|{
name|Group
name|group
decl_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|priv
operator|->
name|update_interval
operator|=
name|update_interval
expr_stmt|;
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
if|if
condition|(
name|group_data
operator|->
name|meter
condition|)
block|{
name|gimp_meter_set_history_resolution
argument_list|(
name|group_data
operator|->
name|meter
argument_list|,
name|update_interval
operator|/
literal|1000.0
argument_list|)
expr_stmt|;
block|}
block|}
name|priv
operator|->
name|update_now
operator|=
name|TRUE
expr_stmt|;
name|g_cond_signal
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|GimpDashboardUpdateInteval
DECL|function|gimp_dashboard_get_update_interval (GimpDashboard * dashboard)
name|gimp_dashboard_get_update_interval
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|DEFAULT_UPDATE_INTERVAL
argument_list|)
expr_stmt|;
return|return
name|dashboard
operator|->
name|priv
operator|->
name|update_interval
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_dashboard_set_history_duration (GimpDashboard * dashboard,GimpDashboardHistoryDuration history_duration)
name|gimp_dashboard_set_history_duration
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|GimpDashboardHistoryDuration
name|history_duration
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|history_duration
operator|!=
name|priv
operator|->
name|history_duration
condition|)
block|{
name|Group
name|group
decl_stmt|;
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|priv
operator|->
name|history_duration
operator|=
name|history_duration
expr_stmt|;
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
name|GroupData
modifier|*
name|group_data
init|=
operator|&
name|priv
operator|->
name|groups
index|[
name|group
index|]
decl_stmt|;
if|if
condition|(
name|group_data
operator|->
name|meter
condition|)
block|{
name|gimp_meter_set_history_duration
argument_list|(
name|group_data
operator|->
name|meter
argument_list|,
name|history_duration
operator|/
literal|1000.0
argument_list|)
expr_stmt|;
block|}
block|}
name|priv
operator|->
name|update_now
operator|=
name|TRUE
expr_stmt|;
name|g_cond_signal
argument_list|(
operator|&
name|priv
operator|->
name|cond
argument_list|)
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|GimpDashboardHistoryDuration
DECL|function|gimp_dashboard_get_history_duration (GimpDashboard * dashboard)
name|gimp_dashboard_get_history_duration
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|DEFAULT_HISTORY_DURATION
argument_list|)
expr_stmt|;
return|return
name|dashboard
operator|->
name|priv
operator|->
name|history_duration
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_dashboard_set_low_swap_space_warning (GimpDashboard * dashboard,gboolean low_swap_space_warning)
name|gimp_dashboard_set_low_swap_space_warning
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|,
name|gboolean
name|low_swap_space_warning
parameter_list|)
block|{
name|GimpDashboardPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|dashboard
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|low_swap_space_warning
operator|!=
name|priv
operator|->
name|low_swap_space_warning
condition|)
block|{
name|g_mutex_lock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|priv
operator|->
name|low_swap_space_warning
operator|=
name|low_swap_space_warning
expr_stmt|;
name|g_mutex_unlock
argument_list|(
operator|&
name|priv
operator|->
name|mutex
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_dashboard_get_low_swap_space_warning (GimpDashboard * dashboard)
name|gimp_dashboard_get_low_swap_space_warning
parameter_list|(
name|GimpDashboard
modifier|*
name|dashboard
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_DASHBOARD
argument_list|(
name|dashboard
argument_list|)
argument_list|,
name|DEFAULT_LOW_SWAP_SPACE_WARNING
argument_list|)
expr_stmt|;
return|return
name|dashboard
operator|->
name|priv
operator|->
name|low_swap_space_warning
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_dashboard_menu_setup (GimpUIManager * manager,const gchar * ui_path)
name|gimp_dashboard_menu_setup
parameter_list|(
name|GimpUIManager
modifier|*
name|manager
parameter_list|,
specifier|const
name|gchar
modifier|*
name|ui_path
parameter_list|)
block|{
name|guint
name|merge_id
decl_stmt|;
name|Group
name|group
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_UI_MANAGER
argument_list|(
name|manager
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|ui_path
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|merge_id
operator|=
name|gtk_ui_manager_new_merge_id
argument_list|(
name|GTK_UI_MANAGER
argument_list|(
name|manager
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|group
operator|=
name|FIRST_GROUP
init|;
name|group
operator|<
name|N_GROUPS
condition|;
name|group
operator|++
control|)
block|{
specifier|const
name|GroupInfo
modifier|*
name|group_info
init|=
operator|&
name|groups
index|[
name|group
index|]
decl_stmt|;
name|gchar
modifier|*
name|action_name
decl_stmt|;
name|gchar
modifier|*
name|action_path
decl_stmt|;
name|action_name
operator|=
name|g_strdup_printf
argument_list|(
literal|"dashboard-group-%s"
argument_list|,
name|group_info
operator|->
name|name
argument_list|)
expr_stmt|;
name|action_path
operator|=
name|g_strdup_printf
argument_list|(
literal|"%s/Groups/Groups"
argument_list|,
name|ui_path
argument_list|)
expr_stmt|;
name|gtk_ui_manager_add_ui
argument_list|(
name|GTK_UI_MANAGER
argument_list|(
name|manager
argument_list|)
argument_list|,
name|merge_id
argument_list|,
name|action_path
argument_list|,
name|action_name
argument_list|,
name|action_name
argument_list|,
name|GTK_UI_MANAGER_MENUITEM
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|action_name
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|action_path
argument_list|)
expr_stmt|;
block|}
block|}
end_function

end_unit

