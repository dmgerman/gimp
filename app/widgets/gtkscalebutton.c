begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GTK - The GIMP Toolkit  * Copyright (C) 2005 Ronald S. Bultje  * Copyright (C) 2006, 2007 Christian Persch  * Copyright (C) 2006 Jan Arne Petersen  * Copyright (C) 2005-2007 Red Hat, Inc.  *  * Authors:  * - Ronald S. Bultje<rbultje@ronald.bitfreak.net>  * - Bastien Nocera<bnocera@redhat.com>  * - Jan Arne Petersen<jpetersen@jpetersen.org>  * - Christian Persch<chpe@svn.gnome.org>  *  * This library is free software: you can redistribute it and/or  * modify it under the terms of the GNU Lesser General Public  * License as published by the Free Software Foundation; either  * version 3 of the License, or (at your option) any later version.  *  * This library is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  * Lesser General Public License for more details.  *  * You should have received a copy of the GNU Lesser General Public  * License along with this library.  If not, see  *<http://www.gnu.org/licenses/>.  */
end_comment

begin_comment
comment|/*  * Modified by the GTK+ Team and others 2007.  See the AUTHORS  * file for a list of people on the GTK+ Team.  See the ChangeLog  * files for a list of changes.  These files are distributed with  * GTK+ at ftp://ftp.gtk.org/pub/gtk/.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_ifndef
ifndef|#
directive|ifndef
name|_WIN32
end_ifndef

begin_define
DECL|macro|_GNU_SOURCE
define|#
directive|define
name|_GNU_SOURCE
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_include
include|#
directive|include
file|<math.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<gdk-pixbuf/gdk-pixbuf.h>
end_include

begin_include
include|#
directive|include
file|<gdk/gdkkeysyms.h>
end_include

begin_define
DECL|macro|__GTK_SCALE_BUTTON_H__
define|#
directive|define
name|__GTK_SCALE_BUTTON_H__
end_define

begin_define
DECL|macro|__GTK_VOLUME_BUTTON_H__
define|#
directive|define
name|__GTK_VOLUME_BUTTON_H__
end_define

begin_define
DECL|macro|P_ (string)
define|#
directive|define
name|P_
parameter_list|(
name|string
parameter_list|)
value|string
end_define

begin_define
DECL|macro|I_ (string)
define|#
directive|define
name|I_
parameter_list|(
name|string
parameter_list|)
value|string
end_define

begin_define
DECL|macro|GTK_PARAM_READWRITE
define|#
directive|define
name|GTK_PARAM_READWRITE
value|(G_PARAM_READWRITE)
end_define

begin_define
DECL|macro|gtk_scale_button_parent_class
define|#
directive|define
name|gtk_scale_button_parent_class
value|gimp_gtk_scale_button_parent_class
end_define

begin_define
DECL|macro|gtk_scale_button_set_orientation
define|#
directive|define
name|gtk_scale_button_set_orientation
value|gimp_gtk_scale_button_set_orientation
end_define

begin_define
DECL|macro|gtk_scale_button_get_value
define|#
directive|define
name|gtk_scale_button_get_value
value|gimp_gtk_scale_button_get_value
end_define

begin_define
DECL|macro|gtk_scale_button_set_value
define|#
directive|define
name|gtk_scale_button_set_value
value|gimp_gtk_scale_button_set_value
end_define

begin_define
DECL|macro|gtk_scale_button_get_adjustment
define|#
directive|define
name|gtk_scale_button_get_adjustment
value|gimp_gtk_scale_button_get_adjustment
end_define

begin_define
DECL|macro|gtk_scale_button_set_adjustment
define|#
directive|define
name|gtk_scale_button_set_adjustment
value|gimp_gtk_scale_button_set_adjustment
end_define

begin_define
DECL|macro|gtk_scale_button_set_icons
define|#
directive|define
name|gtk_scale_button_set_icons
value|gimp_gtk_scale_button_set_icons
end_define

begin_include
include|#
directive|include
file|"gtkscalebutton.h"
end_include

begin_include
include|#
directive|include
file|"core/gimpmarshal.h"
end_include

begin_define
DECL|macro|SCALE_SIZE
define|#
directive|define
name|SCALE_SIZE
value|100
end_define

begin_define
DECL|macro|CLICK_TIMEOUT
define|#
directive|define
name|CLICK_TIMEOUT
value|250
end_define

begin_enum
enum|enum
DECL|enum|__anon2bf375a00103
block|{
DECL|enumerator|VALUE_CHANGED
name|VALUE_CHANGED
block|,
DECL|enumerator|POPUP
name|POPUP
block|,
DECL|enumerator|POPDOWN
name|POPDOWN
block|,
DECL|enumerator|LAST_SIGNAL
name|LAST_SIGNAL
block|}
enum|;
end_enum

begin_enum
enum|enum
DECL|enum|__anon2bf375a00203
block|{
DECL|enumerator|PROP_0
name|PROP_0
block|,
DECL|enumerator|PROP_ORIENTATION
name|PROP_ORIENTATION
block|,
DECL|enumerator|PROP_VALUE
name|PROP_VALUE
block|,
DECL|enumerator|PROP_SIZE
name|PROP_SIZE
block|,
DECL|enumerator|PROP_ADJUSTMENT
name|PROP_ADJUSTMENT
block|,
DECL|enumerator|PROP_ICONS
name|PROP_ICONS
block|}
enum|;
end_enum

begin_define
DECL|macro|GET_PRIVATE (obj)
define|#
directive|define
name|GET_PRIVATE
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_INSTANCE_GET_PRIVATE ((obj), GTK_TYPE_SCALE_BUTTON, GtkScaleButtonPrivate))
end_define

begin_struct
DECL|struct|_GtkScaleButtonPrivate
struct|struct
name|_GtkScaleButtonPrivate
block|{
DECL|member|dock
name|GtkWidget
modifier|*
name|dock
decl_stmt|;
DECL|member|scale
name|GtkWidget
modifier|*
name|scale
decl_stmt|;
DECL|member|image
name|GtkWidget
modifier|*
name|image
decl_stmt|;
DECL|member|size
name|GtkIconSize
name|size
decl_stmt|;
DECL|member|orientation
name|GtkOrientation
name|orientation
decl_stmt|;
DECL|member|click_id
name|guint
name|click_id
decl_stmt|;
DECL|member|click_timeout
name|gint
name|click_timeout
decl_stmt|;
DECL|member|timeout
name|guint
name|timeout
range|:
literal|1
decl_stmt|;
DECL|member|direction
name|gdouble
name|direction
decl_stmt|;
DECL|member|pop_time
name|guint32
name|pop_time
decl_stmt|;
DECL|member|icon_list
name|gchar
modifier|*
modifier|*
name|icon_list
decl_stmt|;
DECL|member|adjustment
name|GtkAdjustment
modifier|*
name|adjustment
decl_stmt|;
comment|/* needed because it must be settable in init() */
block|}
struct|;
end_struct

begin_function_decl
specifier|static
name|GObject
modifier|*
name|gtk_scale_button_constructor
parameter_list|(
name|GType
name|type
parameter_list|,
name|guint
name|n_construct_properties
parameter_list|,
name|GObjectConstructParam
modifier|*
name|construct_params
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gtk_scale_button_scroll
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventScroll
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_screen_changed
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkScreen
modifier|*
name|previous_screen
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gtk_scale_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gtk_scale_button_key_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_popup_from_bindings
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_popdown_from_bindings
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|cb_dock_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|cb_dock_key_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|cb_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|cb_button_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cb_dock_grab_notify
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|was_grabbed
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|cb_dock_grab_broken_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|was_grabbed
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|cb_scale_grab_notify
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|was_grabbed
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_update_icon
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gtk_scale_button_scale_value_changed
parameter_list|(
name|GtkRange
modifier|*
name|range
parameter_list|)
function_decl|;
end_function_decl

begin_comment
comment|/* see below for scale definitions */
end_comment

begin_function_decl
specifier|static
name|GtkWidget
modifier|*
name|gtk_scale_button_scale_box_new
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
function_decl|;
end_function_decl

begin_decl_stmt
DECL|variable|signals
specifier|static
name|guint
name|signals
index|[
name|LAST_SIGNAL
index|]
init|=
block|{
literal|0
block|, }
decl_stmt|;
end_decl_stmt

begin_macro
DECL|function|G_DEFINE_TYPE (GtkScaleButton,gimp_gtk_scale_button,GTK_TYPE_BUTTON)
name|G_DEFINE_TYPE
argument_list|(
argument|GtkScaleButton
argument_list|,
argument|gimp_gtk_scale_button
argument_list|,
argument|GTK_TYPE_BUTTON
argument_list|)
end_macro

begin_function
specifier|static
name|guint
name|gimp_gtk_binding_signal_new
parameter_list|(
specifier|const
name|gchar
modifier|*
name|signal_name
parameter_list|,
name|GType
name|itype
parameter_list|,
name|GSignalFlags
name|signal_flags
parameter_list|,
name|GCallback
name|handler
parameter_list|,
name|GSignalAccumulator
name|accumulator
parameter_list|,
name|gpointer
name|accu_data
parameter_list|,
name|GSignalCMarshaller
name|c_marshaller
parameter_list|,
name|GType
name|return_type
parameter_list|,
name|guint
name|n_params
parameter_list|,
modifier|...
parameter_list|)
block|{
name|va_list
name|args
decl_stmt|;
name|guint
name|signal_id
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|signal_name
operator|!=
name|NULL
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|va_start
argument_list|(
name|args
argument_list|,
name|n_params
argument_list|)
expr_stmt|;
name|signal_id
operator|=
name|g_signal_new_valist
argument_list|(
name|signal_name
argument_list|,
name|itype
argument_list|,
name|signal_flags
argument_list|,
name|g_cclosure_new
argument_list|(
name|handler
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|)
argument_list|,
name|accumulator
argument_list|,
name|accu_data
argument_list|,
name|c_marshaller
argument_list|,
name|return_type
argument_list|,
name|n_params
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|va_end
argument_list|(
name|args
argument_list|)
expr_stmt|;
return|return
name|signal_id
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gtk_scale_button_class_init (GtkScaleButtonClass * klass)
name|gimp_gtk_scale_button_class_init
parameter_list|(
name|GtkScaleButtonClass
modifier|*
name|klass
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|gobject_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GtkWidgetClass
modifier|*
name|widget_class
init|=
name|GTK_WIDGET_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GtkBindingSet
modifier|*
name|binding_set
decl_stmt|;
name|g_type_class_add_private
argument_list|(
name|klass
argument_list|,
sizeof|sizeof
argument_list|(
name|GtkScaleButtonPrivate
argument_list|)
argument_list|)
expr_stmt|;
name|gobject_class
operator|->
name|constructor
operator|=
name|gtk_scale_button_constructor
expr_stmt|;
name|gobject_class
operator|->
name|finalize
operator|=
name|gtk_scale_button_finalize
expr_stmt|;
name|gobject_class
operator|->
name|dispose
operator|=
name|gtk_scale_button_dispose
expr_stmt|;
name|gobject_class
operator|->
name|set_property
operator|=
name|gtk_scale_button_set_property
expr_stmt|;
name|gobject_class
operator|->
name|get_property
operator|=
name|gtk_scale_button_get_property
expr_stmt|;
name|widget_class
operator|->
name|button_press_event
operator|=
name|gtk_scale_button_press
expr_stmt|;
name|widget_class
operator|->
name|key_release_event
operator|=
name|gtk_scale_button_key_release
expr_stmt|;
name|widget_class
operator|->
name|scroll_event
operator|=
name|gtk_scale_button_scroll
expr_stmt|;
name|widget_class
operator|->
name|screen_changed
operator|=
name|gtk_scale_button_screen_changed
expr_stmt|;
comment|/**    * GtkScaleButton:orientation:    *    * The orientation of the #GtkScaleButton's popup window.    *    * Since: 2.14    **/
name|g_object_class_install_property
argument_list|(
name|gobject_class
argument_list|,
name|PROP_ORIENTATION
argument_list|,
name|g_param_spec_enum
argument_list|(
literal|"orientation"
argument_list|,
name|P_
argument_list|(
literal|"Orientation"
argument_list|)
argument_list|,
name|P_
argument_list|(
literal|"The orientation of the scale"
argument_list|)
argument_list|,
name|GTK_TYPE_ORIENTATION
argument_list|,
name|GTK_ORIENTATION_VERTICAL
argument_list|,
name|GTK_PARAM_READWRITE
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|gobject_class
argument_list|,
name|PROP_VALUE
argument_list|,
name|g_param_spec_double
argument_list|(
literal|"value"
argument_list|,
name|P_
argument_list|(
literal|"Value"
argument_list|)
argument_list|,
name|P_
argument_list|(
literal|"The value of the scale"
argument_list|)
argument_list|,
operator|-
name|G_MAXDOUBLE
argument_list|,
name|G_MAXDOUBLE
argument_list|,
literal|0
argument_list|,
name|GTK_PARAM_READWRITE
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|gobject_class
argument_list|,
name|PROP_SIZE
argument_list|,
name|g_param_spec_enum
argument_list|(
literal|"size"
argument_list|,
name|P_
argument_list|(
literal|"Icon size"
argument_list|)
argument_list|,
name|P_
argument_list|(
literal|"The icon size"
argument_list|)
argument_list|,
name|GTK_TYPE_ICON_SIZE
argument_list|,
name|GTK_ICON_SIZE_SMALL_TOOLBAR
argument_list|,
name|GTK_PARAM_READWRITE
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|gobject_class
argument_list|,
name|PROP_ADJUSTMENT
argument_list|,
name|g_param_spec_object
argument_list|(
literal|"adjustment"
argument_list|,
name|P_
argument_list|(
literal|"Adjustment"
argument_list|)
argument_list|,
name|P_
argument_list|(
literal|"The GtkAdjustment that contains the current value of this scale button object"
argument_list|)
argument_list|,
name|GTK_TYPE_ADJUSTMENT
argument_list|,
name|GTK_PARAM_READWRITE
argument_list|)
argument_list|)
expr_stmt|;
comment|/**    * GtkScaleButton:icons:    *    * The names of the icons to be used by the scale button.    * The first item in the array will be used in the button    * when the current value is the lowest value, the second    * item for the highest value. All the subsequent icons will    * be used for all the other values, spread evenly over the    * range of values.    *    * If there's only one icon name in the @icons array, it will    * be used for all the values. If only two icon names are in    * the @icons array, the first one will be used for the bottom    * 50% of the scale, and the second one for the top 50%.    *    * It is recommended to use at least 3 icons so that the    * #GtkScaleButton reflects the current value of the scale    * better for the users.    *    * Since: 2.12    */
name|g_object_class_install_property
argument_list|(
name|gobject_class
argument_list|,
name|PROP_ICONS
argument_list|,
name|g_param_spec_boxed
argument_list|(
literal|"icons"
argument_list|,
name|P_
argument_list|(
literal|"Icons"
argument_list|)
argument_list|,
name|P_
argument_list|(
literal|"List of icon names"
argument_list|)
argument_list|,
name|G_TYPE_STRV
argument_list|,
name|GTK_PARAM_READWRITE
argument_list|)
argument_list|)
expr_stmt|;
comment|/**    * GtkScaleButton::value-changed:    * @button: the object which received the signal    * @value: the new value    *    * The ::value-changed signal is emitted when the value field has    * changed.    *    * Since: 2.12    */
name|signals
index|[
name|VALUE_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
name|I_
argument_list|(
literal|"value-changed"
argument_list|)
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_LAST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GtkScaleButtonClass
argument_list|,
name|value_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__DOUBLE
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_DOUBLE
argument_list|)
expr_stmt|;
comment|/**    * GtkScaleButton::popup:    * @button: the object which received the signal    *    * The ::popup signal is a    *<link linkend="keybinding-signals">keybinding signal</link>    * which gets emitted to popup the scale widget.    *    * The default bindings for this signal are Space, Enter and Return.    *    * Since: 2.12    */
name|signals
index|[
name|POPUP
index|]
operator|=
name|gimp_gtk_binding_signal_new
argument_list|(
name|I_
argument_list|(
literal|"popup"
argument_list|)
argument_list|,
name|G_OBJECT_CLASS_TYPE
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_LAST
operator||
name|G_SIGNAL_ACTION
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_scale_button_popup_from_bindings
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/**    * GtkScaleButton::popdown:    * @button: the object which received the signal    *    * The ::popdown signal is a    *<link linkend="keybinding-signals">keybinding signal</link>    * which gets emitted to popdown the scale widget.    *    * The default binding for this signal is Escape.    *    * Since: 2.12    */
name|signals
index|[
name|POPDOWN
index|]
operator|=
name|gimp_gtk_binding_signal_new
argument_list|(
name|I_
argument_list|(
literal|"popdown"
argument_list|)
argument_list|,
name|G_OBJECT_CLASS_TYPE
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_LAST
operator||
name|G_SIGNAL_ACTION
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_scale_button_popdown_from_bindings
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|/* Key bindings */
name|binding_set
operator|=
name|gtk_binding_set_by_class
argument_list|(
name|widget_class
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_space
argument_list|,
literal|0
argument_list|,
literal|"popup"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_KP_Space
argument_list|,
literal|0
argument_list|,
literal|"popup"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_Return
argument_list|,
literal|0
argument_list|,
literal|"popup"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_ISO_Enter
argument_list|,
literal|0
argument_list|,
literal|"popup"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_KP_Enter
argument_list|,
literal|0
argument_list|,
literal|"popup"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_binding_entry_add_signal
argument_list|(
name|binding_set
argument_list|,
name|GDK_Escape
argument_list|,
literal|0
argument_list|,
literal|"popdown"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_gtk_scale_button_init (GtkScaleButton * button)
name|gimp_gtk_scale_button_init
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|button
operator|->
name|priv
operator|=
name|priv
operator|=
name|GET_PRIVATE
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|priv
operator|->
name|timeout
operator|=
name|FALSE
expr_stmt|;
name|priv
operator|->
name|click_id
operator|=
literal|0
expr_stmt|;
name|priv
operator|->
name|click_timeout
operator|=
name|CLICK_TIMEOUT
expr_stmt|;
name|priv
operator|->
name|orientation
operator|=
name|GTK_ORIENTATION_VERTICAL
expr_stmt|;
name|gtk_button_set_relief
argument_list|(
name|GTK_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|GTK_RELIEF_NONE
argument_list|)
expr_stmt|;
name|gtk_button_set_focus_on_click
argument_list|(
name|GTK_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* image */
name|priv
operator|->
name|image
operator|=
name|gtk_image_new
argument_list|()
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|button
argument_list|)
argument_list|,
name|priv
operator|->
name|image
argument_list|)
expr_stmt|;
name|gtk_widget_show_all
argument_list|(
name|priv
operator|->
name|image
argument_list|)
expr_stmt|;
comment|/* window */
name|priv
operator|->
name|dock
operator|=
name|gtk_window_new
argument_list|(
name|GTK_WINDOW_POPUP
argument_list|)
expr_stmt|;
name|gtk_widget_set_name
argument_list|(
name|priv
operator|->
name|dock
argument_list|,
literal|"gtk-scalebutton-popup-window"
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|priv
operator|->
name|dock
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_dock_button_press
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|priv
operator|->
name|dock
argument_list|,
literal|"key-release-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_dock_key_release
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|priv
operator|->
name|dock
argument_list|,
literal|"grab-notify"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_dock_grab_notify
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|priv
operator|->
name|dock
argument_list|,
literal|"grab-broken-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_dock_grab_broken_event
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|gtk_window_set_decorated
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* + */
name|button
operator|->
name|plus_button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"+"
argument_list|)
expr_stmt|;
name|gtk_button_set_relief
argument_list|(
name|GTK_BUTTON
argument_list|(
name|button
operator|->
name|plus_button
argument_list|)
argument_list|,
name|GTK_RELIEF_NONE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
operator|->
name|plus_button
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_button_press
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
operator|->
name|plus_button
argument_list|,
literal|"button-release-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_button_release
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
comment|/* - */
name|button
operator|->
name|minus_button
operator|=
name|gtk_button_new_with_label
argument_list|(
literal|"-"
argument_list|)
expr_stmt|;
name|gtk_button_set_relief
argument_list|(
name|GTK_BUTTON
argument_list|(
name|button
operator|->
name|minus_button
argument_list|)
argument_list|,
name|GTK_RELIEF_NONE
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
operator|->
name|minus_button
argument_list|,
literal|"button-press-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_button_press
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|button
operator|->
name|minus_button
argument_list|,
literal|"button-release-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_button_release
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|priv
operator|->
name|adjustment
operator|=
name|GTK_ADJUSTMENT
argument_list|(
name|gtk_adjustment_new
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|100.0
argument_list|,
literal|2
argument_list|,
literal|20
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_ref_sink
argument_list|(
name|priv
operator|->
name|adjustment
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|GObject
modifier|*
DECL|function|gtk_scale_button_constructor (GType type,guint n_construct_properties,GObjectConstructParam * construct_params)
name|gtk_scale_button_constructor
parameter_list|(
name|GType
name|type
parameter_list|,
name|guint
name|n_construct_properties
parameter_list|,
name|GObjectConstructParam
modifier|*
name|construct_params
parameter_list|)
block|{
name|GObject
modifier|*
name|object
decl_stmt|;
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
decl_stmt|,
modifier|*
name|box
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|object
operator|=
name|G_OBJECT_CLASS
argument_list|(
name|gtk_scale_button_parent_class
argument_list|)
operator|->
name|constructor
argument_list|(
name|type
argument_list|,
name|n_construct_properties
argument_list|,
name|construct_params
argument_list|)
expr_stmt|;
name|button
operator|=
name|GTK_SCALE_BUTTON
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
comment|/* frame */
name|frame
operator|=
name|gtk_frame_new
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|gtk_frame_set_shadow_type
argument_list|(
name|GTK_FRAME
argument_list|(
name|frame
argument_list|)
argument_list|,
name|GTK_SHADOW_OUT
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
name|frame
argument_list|)
expr_stmt|;
comment|/* box with scale and +/- buttons */
name|box
operator|=
name|gtk_scale_button_scale_box_new
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|box
argument_list|)
expr_stmt|;
comment|/* set button text and size */
name|priv
operator|->
name|size
operator|=
name|GTK_ICON_SIZE_SMALL_TOOLBAR
expr_stmt|;
name|gtk_scale_button_update_icon
argument_list|(
name|button
argument_list|)
expr_stmt|;
return|return
name|object
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_set_property (GObject * object,guint prop_id,const GValue * value,GParamSpec * pspec)
name|gtk_scale_button_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
name|GTK_SCALE_BUTTON
argument_list|(
name|object
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|prop_id
condition|)
block|{
case|case
name|PROP_ORIENTATION
case|:
name|gtk_scale_button_set_orientation
argument_list|(
name|button
argument_list|,
name|g_value_get_enum
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_VALUE
case|:
name|gtk_scale_button_set_value
argument_list|(
name|button
argument_list|,
name|g_value_get_double
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_SIZE
case|:
block|{
name|GtkIconSize
name|size
decl_stmt|;
name|size
operator|=
name|g_value_get_enum
argument_list|(
name|value
argument_list|)
expr_stmt|;
if|if
condition|(
name|button
operator|->
name|priv
operator|->
name|size
operator|!=
name|size
condition|)
block|{
name|button
operator|->
name|priv
operator|->
name|size
operator|=
name|size
expr_stmt|;
name|gtk_scale_button_update_icon
argument_list|(
name|button
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
case|case
name|PROP_ADJUSTMENT
case|:
name|gtk_scale_button_set_adjustment
argument_list|(
name|button
argument_list|,
name|g_value_get_object
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_ICONS
case|:
name|gtk_scale_button_set_icons
argument_list|(
name|button
argument_list|,
operator|(
specifier|const
name|gchar
operator|*
operator|*
operator|)
name|g_value_get_boxed
argument_list|(
name|value
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|prop_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_get_property (GObject * object,guint prop_id,GValue * value,GParamSpec * pspec)
name|gtk_scale_button_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|prop_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
name|GTK_SCALE_BUTTON
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
init|=
name|button
operator|->
name|priv
decl_stmt|;
switch|switch
condition|(
name|prop_id
condition|)
block|{
case|case
name|PROP_ORIENTATION
case|:
name|g_value_set_enum
argument_list|(
name|value
argument_list|,
name|priv
operator|->
name|orientation
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_VALUE
case|:
name|g_value_set_double
argument_list|(
name|value
argument_list|,
name|gtk_scale_button_get_value
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_SIZE
case|:
name|g_value_set_enum
argument_list|(
name|value
argument_list|,
name|priv
operator|->
name|size
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_ADJUSTMENT
case|:
name|g_value_set_object
argument_list|(
name|value
argument_list|,
name|gtk_scale_button_get_adjustment
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_ICONS
case|:
name|g_value_set_boxed
argument_list|(
name|value
argument_list|,
name|priv
operator|->
name|icon_list
argument_list|)
expr_stmt|;
break|break;
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|prop_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_finalize (GObject * object)
name|gtk_scale_button_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
name|GTK_SCALE_BUTTON
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
init|=
name|button
operator|->
name|priv
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|icon_list
condition|)
block|{
name|g_strfreev
argument_list|(
name|priv
operator|->
name|icon_list
argument_list|)
expr_stmt|;
name|priv
operator|->
name|icon_list
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|adjustment
condition|)
block|{
name|g_object_unref
argument_list|(
name|priv
operator|->
name|adjustment
argument_list|)
expr_stmt|;
name|priv
operator|->
name|adjustment
operator|=
name|NULL
expr_stmt|;
block|}
name|G_OBJECT_CLASS
argument_list|(
name|gtk_scale_button_parent_class
argument_list|)
operator|->
name|finalize
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_dispose (GObject * object)
name|gtk_scale_button_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
name|GTK_SCALE_BUTTON
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
init|=
name|button
operator|->
name|priv
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|dock
condition|)
block|{
name|gtk_widget_destroy
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|priv
operator|->
name|dock
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|priv
operator|->
name|click_id
operator|!=
literal|0
condition|)
block|{
name|g_source_remove
argument_list|(
name|priv
operator|->
name|click_id
argument_list|)
expr_stmt|;
name|priv
operator|->
name|click_id
operator|=
literal|0
expr_stmt|;
block|}
name|G_OBJECT_CLASS
argument_list|(
name|gtk_scale_button_parent_class
argument_list|)
operator|->
name|dispose
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_new:  * @size: a stock icon size  * @min: the minimum value of the scale (usually 0)  * @max: the maximum value of the scale (usually 100)  * @step: the stepping of value when a scroll-wheel event,  *        or up/down arrow event occurs (usually 2)  * @icons: a %NULL-terminated array of icon names, or %NULL if  *         you want to set the list later with gtk_scale_button_set_icons()  *  * Creates a #GtkScaleButton, with a range between @min and @max, with  * a stepping of @step.  *  * Return value: a new #GtkScaleButton  *  * Since: 2.12  */
end_comment

begin_function
name|GtkWidget
modifier|*
DECL|function|gimp_gtk_scale_button_new (GtkIconSize size,gdouble min,gdouble max,gdouble step,const gchar ** icons)
name|gimp_gtk_scale_button_new
parameter_list|(
name|GtkIconSize
name|size
parameter_list|,
name|gdouble
name|min
parameter_list|,
name|gdouble
name|max
parameter_list|,
name|gdouble
name|step
parameter_list|,
specifier|const
name|gchar
modifier|*
modifier|*
name|icons
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkObject
modifier|*
name|adj
decl_stmt|;
name|adj
operator|=
name|gtk_adjustment_new
argument_list|(
name|min
argument_list|,
name|min
argument_list|,
name|max
argument_list|,
name|step
argument_list|,
literal|10
operator|*
name|step
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|button
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_SCALE_BUTTON
argument_list|,
literal|"adjustment"
argument_list|,
name|adj
argument_list|,
literal|"icons"
argument_list|,
name|icons
argument_list|,
literal|"size"
argument_list|,
name|size
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GTK_WIDGET
argument_list|(
name|button
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_get_value:  * @button: a #GtkScaleButton  *  * Gets the current value of the scale button.  *  * Return value: current value of the scale button  *  * Since: 2.12  */
end_comment

begin_function
name|gdouble
DECL|function|gimp_gtk_scale_button_get_value (GtkScaleButton * button)
name|gimp_gtk_scale_button_get_value
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GTK_IS_SCALE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
return|return
name|gtk_adjustment_get_value
argument_list|(
name|priv
operator|->
name|adjustment
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_set_value:  * @button: a #GtkScaleButton  * @value: new value of the scale button  *  * Sets the current value of the scale; if the value is outside  * the minimum or maximum range values, it will be clamped to fit  * inside them. The scale button emits the #GtkScaleButton::value-changed  * signal if the value changes.  *  * Since: 2.12  */
end_comment

begin_function
name|void
DECL|function|gimp_gtk_scale_button_set_value (GtkScaleButton * button,gdouble value)
name|gimp_gtk_scale_button_set_value
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|,
name|gdouble
name|value
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GTK_IS_SCALE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
name|gtk_range_set_value
argument_list|(
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_set_icons:  * @button: a #GtkScaleButton  * @icons: a %NULL-terminated array of icon names  *  * Sets the icons to be used by the scale button.  * For details, see the #GtkScaleButton:icons property.  *  * Since: 2.12  */
end_comment

begin_function
name|void
DECL|function|gimp_gtk_scale_button_set_icons (GtkScaleButton * button,const gchar ** icons)
name|gimp_gtk_scale_button_set_icons
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|,
specifier|const
name|gchar
modifier|*
modifier|*
name|icons
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|tmp
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GTK_IS_SCALE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
name|tmp
operator|=
name|priv
operator|->
name|icon_list
expr_stmt|;
name|priv
operator|->
name|icon_list
operator|=
name|g_strdupv
argument_list|(
operator|(
name|gchar
operator|*
operator|*
operator|)
name|icons
argument_list|)
expr_stmt|;
name|g_strfreev
argument_list|(
name|tmp
argument_list|)
expr_stmt|;
name|gtk_scale_button_update_icon
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"icons"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_get_adjustment:  * @button: a #GtkScaleButton  *  * Gets the #GtkAdjustment associated with the #GtkScaleButton's scale.  * See gtk_range_get_adjustment() for details.  *  * Returns: the adjustment associated with the scale  *  * Since: 2.12  */
end_comment

begin_function
name|GtkAdjustment
modifier|*
DECL|function|gimp_gtk_scale_button_get_adjustment (GtkScaleButton * button)
name|gimp_gtk_scale_button_get_adjustment
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GTK_IS_SCALE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|button
operator|->
name|priv
operator|->
name|adjustment
return|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_set_adjustment:  * @button: a #GtkScaleButton  * @adjustment: a #GtkAdjustment  *  * Sets the #GtkAdjustment to be used as a model  * for the #GtkScaleButton's scale.  * See gtk_range_set_adjustment() for details.  *  * Since: 2.12  */
end_comment

begin_function
name|void
DECL|function|gimp_gtk_scale_button_set_adjustment (GtkScaleButton * button,GtkAdjustment * adjustment)
name|gimp_gtk_scale_button_set_adjustment
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|,
name|GtkAdjustment
modifier|*
name|adjustment
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GTK_IS_SCALE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GTK_IS_ADJUSTMENT
argument_list|(
name|adjustment
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|button
operator|->
name|priv
operator|->
name|adjustment
condition|)
name|g_object_unref
argument_list|(
name|button
operator|->
name|priv
operator|->
name|adjustment
argument_list|)
expr_stmt|;
name|button
operator|->
name|priv
operator|->
name|adjustment
operator|=
name|g_object_ref_sink
argument_list|(
name|adjustment
argument_list|)
expr_stmt|;
if|if
condition|(
name|button
operator|->
name|priv
operator|->
name|scale
condition|)
name|gtk_range_set_adjustment
argument_list|(
name|GTK_RANGE
argument_list|(
name|button
operator|->
name|priv
operator|->
name|scale
argument_list|)
argument_list|,
name|adjustment
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"adjustment"
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_get_orientation:  * @button: a #GtkScaleButton  *  * Gets the orientation of the #GtkScaleButton's popup window.  *  * Returns: the #GtkScaleButton's orientation.  *  * Since: 2.14  **/
end_comment

begin_function
name|GtkOrientation
DECL|function|gimp_gtk_scale_button_get_orientation (GtkScaleButton * button)
name|gimp_gtk_scale_button_get_orientation
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GTK_IS_SCALE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|,
name|GTK_ORIENTATION_VERTICAL
argument_list|)
expr_stmt|;
return|return
name|button
operator|->
name|priv
operator|->
name|orientation
return|;
block|}
end_function

begin_comment
comment|/**  * gtk_scale_button_set_orientation:  * @button: a #GtkScaleButton  * @orientation: the new orientation  *  * Sets the orientation of the #GtkScaleButton's popup window.  *  * Since: 2.14  **/
end_comment

begin_function
name|void
DECL|function|gimp_gtk_scale_button_set_orientation (GtkScaleButton * button,GtkOrientation orientation)
name|gimp_gtk_scale_button_set_orientation
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|,
name|GtkOrientation
name|orientation
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GTK_IS_SCALE_BUTTON
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|orientation
operator|!=
name|priv
operator|->
name|orientation
condition|)
block|{
name|priv
operator|->
name|orientation
operator|=
name|orientation
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|scale
condition|)
block|{
name|GtkWidget
modifier|*
name|box
init|=
name|priv
operator|->
name|scale
operator|->
name|parent
decl_stmt|;
name|GtkWidget
modifier|*
name|frame
init|=
name|box
operator|->
name|parent
decl_stmt|;
name|g_object_ref
argument_list|(
name|button
operator|->
name|plus_button
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|button
operator|->
name|minus_button
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|box
argument_list|)
argument_list|,
name|button
operator|->
name|plus_button
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|box
argument_list|)
argument_list|,
name|button
operator|->
name|minus_button
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|box
argument_list|)
argument_list|,
name|priv
operator|->
name|scale
argument_list|)
expr_stmt|;
name|gtk_container_remove
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|box
argument_list|)
expr_stmt|;
name|box
operator|=
name|gtk_scale_button_scale_box_new
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|gtk_container_add
argument_list|(
name|GTK_CONTAINER
argument_list|(
name|frame
argument_list|)
argument_list|,
name|box
argument_list|)
expr_stmt|;
comment|/* FIXME: without this, the popup window appears as a square            * after changing the orientation            */
name|gtk_window_resize
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|button
operator|->
name|plus_button
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|button
operator|->
name|minus_button
argument_list|)
expr_stmt|;
block|}
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"orientation"
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/*  * button callbacks.  */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|gtk_scale_button_scroll (GtkWidget * widget,GdkEventScroll * event)
name|gtk_scale_button_scroll
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventScroll
modifier|*
name|event
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gdouble
name|d
decl_stmt|;
name|button
operator|=
name|GTK_SCALE_BUTTON
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
name|adj
operator|=
name|priv
operator|->
name|adjustment
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
operator|!=
name|GDK_SCROLL
condition|)
return|return
name|FALSE
return|;
name|d
operator|=
name|gtk_scale_button_get_value
argument_list|(
name|button
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|direction
operator|==
name|GDK_SCROLL_UP
condition|)
block|{
name|d
operator|+=
name|adj
operator|->
name|step_increment
expr_stmt|;
if|if
condition|(
name|d
operator|>
name|adj
operator|->
name|upper
condition|)
name|d
operator|=
name|adj
operator|->
name|upper
expr_stmt|;
block|}
else|else
block|{
name|d
operator|-=
name|adj
operator|->
name|step_increment
expr_stmt|;
if|if
condition|(
name|d
operator|<
name|adj
operator|->
name|lower
condition|)
name|d
operator|=
name|adj
operator|->
name|lower
expr_stmt|;
block|}
name|gtk_scale_button_set_value
argument_list|(
name|button
argument_list|,
name|d
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_screen_changed (GtkWidget * widget,GdkScreen * previous_screen)
name|gtk_scale_button_screen_changed
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkScreen
modifier|*
name|previous_screen
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
operator|(
name|GtkScaleButton
operator|*
operator|)
name|widget
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GdkScreen
modifier|*
name|screen
decl_stmt|;
name|GValue
name|value
init|=
block|{
literal|0
block|, }
decl_stmt|;
if|if
condition|(
name|gtk_widget_has_screen
argument_list|(
name|widget
argument_list|)
operator|==
name|FALSE
condition|)
return|return;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
name|screen
operator|=
name|gtk_widget_get_screen
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|g_value_init
argument_list|(
operator|&
name|value
argument_list|,
name|G_TYPE_INT
argument_list|)
expr_stmt|;
if|if
condition|(
name|gdk_screen_get_setting
argument_list|(
name|screen
argument_list|,
literal|"gtk-double-click-time"
argument_list|,
operator|&
name|value
argument_list|)
operator|==
name|FALSE
condition|)
block|{
name|priv
operator|->
name|click_timeout
operator|=
name|CLICK_TIMEOUT
expr_stmt|;
return|return;
block|}
name|priv
operator|->
name|click_timeout
operator|=
name|g_value_get_int
argument_list|(
operator|&
name|value
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gtk_scale_popup (GtkWidget * widget,GdkEvent * event,guint32 time)
name|gtk_scale_popup
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEvent
modifier|*
name|event
parameter_list|,
name|guint32
name|time
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|,
name|m
decl_stmt|,
name|dx
decl_stmt|,
name|dy
decl_stmt|,
name|sx
decl_stmt|,
name|sy
decl_stmt|,
name|startoff
decl_stmt|;
name|gdouble
name|v
decl_stmt|;
name|GdkDisplay
modifier|*
name|display
decl_stmt|;
name|GdkScreen
modifier|*
name|screen
decl_stmt|;
name|button
operator|=
name|GTK_SCALE_BUTTON
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
name|adj
operator|=
name|priv
operator|->
name|adjustment
expr_stmt|;
name|display
operator|=
name|gtk_widget_get_display
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|screen
operator|=
name|gtk_widget_get_screen
argument_list|(
name|widget
argument_list|)
expr_stmt|;
comment|/* position roughly */
name|gtk_window_set_screen
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
name|screen
argument_list|)
expr_stmt|;
name|gdk_window_get_origin
argument_list|(
name|widget
operator|->
name|window
argument_list|,
operator|&
name|x
argument_list|,
operator|&
name|y
argument_list|)
expr_stmt|;
name|x
operator|+=
name|widget
operator|->
name|allocation
operator|.
name|x
expr_stmt|;
name|y
operator|+=
name|widget
operator|->
name|allocation
operator|.
name|y
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|orientation
operator|==
name|GTK_ORIENTATION_VERTICAL
condition|)
name|gtk_window_move
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
name|x
argument_list|,
name|y
operator|-
operator|(
name|SCALE_SIZE
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
else|else
name|gtk_window_move
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
name|x
operator|-
operator|(
name|SCALE_SIZE
operator|/
literal|2
operator|)
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|gtk_widget_show_all
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|gdk_window_get_origin
argument_list|(
name|priv
operator|->
name|dock
operator|->
name|window
argument_list|,
operator|&
name|dx
argument_list|,
operator|&
name|dy
argument_list|)
expr_stmt|;
name|dx
operator|+=
name|priv
operator|->
name|dock
operator|->
name|allocation
operator|.
name|x
expr_stmt|;
name|dy
operator|+=
name|priv
operator|->
name|dock
operator|->
name|allocation
operator|.
name|y
expr_stmt|;
name|gdk_window_get_origin
argument_list|(
name|priv
operator|->
name|scale
operator|->
name|window
argument_list|,
operator|&
name|sx
argument_list|,
operator|&
name|sy
argument_list|)
expr_stmt|;
name|sx
operator|+=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|x
expr_stmt|;
name|sy
operator|+=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|y
expr_stmt|;
name|priv
operator|->
name|timeout
operator|=
name|TRUE
expr_stmt|;
comment|/* position (needs widget to be shown already) */
name|v
operator|=
name|gtk_scale_button_get_value
argument_list|(
name|button
argument_list|)
operator|/
operator|(
name|adj
operator|->
name|upper
operator|-
name|adj
operator|->
name|lower
operator|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|orientation
operator|==
name|GTK_ORIENTATION_VERTICAL
condition|)
block|{
name|startoff
operator|=
name|sy
operator|-
name|dy
expr_stmt|;
name|x
operator|+=
operator|(
name|widget
operator|->
name|allocation
operator|.
name|width
operator|-
name|priv
operator|->
name|dock
operator|->
name|allocation
operator|.
name|width
operator|)
operator|/
literal|2
expr_stmt|;
name|y
operator|-=
name|startoff
expr_stmt|;
name|y
operator|-=
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
operator|/
literal|2
expr_stmt|;
name|m
operator|=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|height
operator|-
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
expr_stmt|;
name|y
operator|-=
name|m
operator|*
operator|(
literal|1.0
operator|-
name|v
operator|)
expr_stmt|;
block|}
else|else
block|{
name|startoff
operator|=
name|sx
operator|-
name|dx
expr_stmt|;
name|x
operator|-=
name|startoff
expr_stmt|;
name|y
operator|+=
operator|(
name|widget
operator|->
name|allocation
operator|.
name|height
operator|-
name|priv
operator|->
name|dock
operator|->
name|allocation
operator|.
name|height
operator|)
operator|/
literal|2
expr_stmt|;
name|x
operator|-=
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
operator|/
literal|2
expr_stmt|;
name|m
operator|=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|width
operator|-
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
expr_stmt|;
name|x
operator|-=
name|m
operator|*
name|v
expr_stmt|;
block|}
comment|/* Make sure the dock stays inside the monitor */
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|GDK_BUTTON_PRESS
condition|)
block|{
name|int
name|monitor
decl_stmt|;
name|GdkEventButton
modifier|*
name|button_event
init|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
decl_stmt|;
name|GdkRectangle
name|rect
decl_stmt|;
name|GtkWidget
modifier|*
name|d
decl_stmt|;
name|d
operator|=
name|GTK_WIDGET
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|monitor
operator|=
name|gdk_screen_get_monitor_at_point
argument_list|(
name|screen
argument_list|,
name|button_event
operator|->
name|x_root
argument_list|,
name|button_event
operator|->
name|y_root
argument_list|)
expr_stmt|;
name|gdk_screen_get_monitor_geometry
argument_list|(
name|screen
argument_list|,
name|monitor
argument_list|,
operator|&
name|rect
argument_list|)
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|orientation
operator|==
name|GTK_ORIENTATION_VERTICAL
condition|)
name|y
operator|+=
name|button_event
operator|->
name|y
expr_stmt|;
else|else
name|x
operator|+=
name|button_event
operator|->
name|x
expr_stmt|;
if|if
condition|(
name|y
operator|<
name|rect
operator|.
name|y
condition|)
name|y
operator|=
name|rect
operator|.
name|y
expr_stmt|;
elseif|else
if|if
condition|(
name|y
operator|+
name|d
operator|->
name|allocation
operator|.
name|height
operator|>
name|rect
operator|.
name|height
operator|+
name|rect
operator|.
name|y
condition|)
name|y
operator|=
name|rect
operator|.
name|y
operator|+
name|rect
operator|.
name|height
operator|-
name|d
operator|->
name|allocation
operator|.
name|height
expr_stmt|;
if|if
condition|(
name|x
operator|<
name|rect
operator|.
name|x
condition|)
name|x
operator|=
name|rect
operator|.
name|x
expr_stmt|;
elseif|else
if|if
condition|(
name|x
operator|+
name|d
operator|->
name|allocation
operator|.
name|width
operator|>
name|rect
operator|.
name|width
operator|+
name|rect
operator|.
name|x
condition|)
name|x
operator|=
name|rect
operator|.
name|x
operator|+
name|rect
operator|.
name|width
operator|-
name|d
operator|->
name|allocation
operator|.
name|width
expr_stmt|;
block|}
name|gtk_window_move
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|GDK_BUTTON_PRESS
condition|)
name|GTK_WIDGET_CLASS
argument_list|(
name|gtk_scale_button_parent_class
argument_list|)
operator|->
name|button_press_event
argument_list|(
name|widget
argument_list|,
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
argument_list|)
expr_stmt|;
comment|/* grab focus */
name|gtk_grab_add
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
if|if
condition|(
name|gdk_pointer_grab
argument_list|(
name|priv
operator|->
name|dock
operator|->
name|window
argument_list|,
name|TRUE
argument_list|,
name|GDK_BUTTON_PRESS_MASK
operator||
name|GDK_BUTTON_RELEASE_MASK
operator||
name|GDK_POINTER_MOTION_MASK
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|time
argument_list|)
operator|!=
name|GDK_GRAB_SUCCESS
condition|)
block|{
name|gtk_grab_remove
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
if|if
condition|(
name|gdk_keyboard_grab
argument_list|(
name|priv
operator|->
name|dock
operator|->
name|window
argument_list|,
name|TRUE
argument_list|,
name|time
argument_list|)
operator|!=
name|GDK_GRAB_SUCCESS
condition|)
block|{
name|gdk_display_pointer_ungrab
argument_list|(
name|display
argument_list|,
name|time
argument_list|)
expr_stmt|;
name|gtk_grab_remove
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
name|gtk_widget_grab_focus
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|GDK_BUTTON_PRESS
condition|)
block|{
name|GdkEventButton
modifier|*
name|e
decl_stmt|;
name|GdkEventButton
modifier|*
name|button_event
init|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|event
decl_stmt|;
comment|/* forward event to the slider */
name|e
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|gdk_event_copy
argument_list|(
operator|(
name|GdkEvent
operator|*
operator|)
name|event
argument_list|)
expr_stmt|;
name|e
operator|->
name|window
operator|=
name|priv
operator|->
name|scale
operator|->
name|window
expr_stmt|;
comment|/* position: the X position isn't relevant, halfway will work just fine.        * The vertical position should be *exactly* in the middle of the slider        * of the scale; if we don't do that correctly, it'll move from its current        * position, which means a position change on-click, which is bad.        */
if|if
condition|(
name|priv
operator|->
name|orientation
operator|==
name|GTK_ORIENTATION_VERTICAL
condition|)
block|{
name|e
operator|->
name|x
operator|=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|width
operator|/
literal|2
expr_stmt|;
name|m
operator|=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|height
operator|-
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
expr_stmt|;
name|e
operator|->
name|y
operator|=
operator|(
operator|(
literal|1.0
operator|-
name|v
operator|)
operator|*
name|m
operator|)
operator|+
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
operator|/
literal|2
expr_stmt|;
block|}
else|else
block|{
name|e
operator|->
name|y
operator|=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|height
operator|/
literal|2
expr_stmt|;
name|m
operator|=
name|priv
operator|->
name|scale
operator|->
name|allocation
operator|.
name|width
operator|-
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
expr_stmt|;
name|e
operator|->
name|x
operator|=
operator|(
name|v
operator|*
name|m
operator|)
operator|+
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
operator|->
name|min_slider_size
operator|/
literal|2
expr_stmt|;
block|}
name|gtk_widget_event
argument_list|(
name|priv
operator|->
name|scale
argument_list|,
operator|(
name|GdkEvent
operator|*
operator|)
name|e
argument_list|)
expr_stmt|;
name|e
operator|->
name|window
operator|=
name|button_event
operator|->
name|window
expr_stmt|;
name|gdk_event_free
argument_list|(
operator|(
name|GdkEvent
operator|*
operator|)
name|e
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_grab_focus
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
expr_stmt|;
name|priv
operator|->
name|pop_time
operator|=
name|time
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gtk_scale_button_press (GtkWidget * widget,GdkEventButton * event)
name|gtk_scale_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
return|return
name|gtk_scale_popup
argument_list|(
name|widget
argument_list|,
operator|(
name|GdkEvent
operator|*
operator|)
name|event
argument_list|,
name|event
operator|->
name|time
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_popup_from_bindings (GtkWidget * widget)
name|gtk_scale_button_popup_from_bindings
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GdkEvent
modifier|*
name|ev
decl_stmt|;
name|ev
operator|=
name|gdk_event_new
argument_list|(
name|GDK_KEY_RELEASE
argument_list|)
expr_stmt|;
name|gtk_scale_popup
argument_list|(
name|widget
argument_list|,
name|ev
argument_list|,
name|GDK_CURRENT_TIME
argument_list|)
expr_stmt|;
name|gdk_event_free
argument_list|(
name|ev
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gtk_scale_button_key_release (GtkWidget * widget,GdkEventKey * event)
name|gtk_scale_button_key_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|)
block|{
return|return
name|gtk_bindings_activate_event
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
name|event
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/* This is called when the grab is broken for  * either the dock, or the scale itself */
end_comment

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_grab_notify (GtkScaleButton * button,gboolean was_grabbed)
name|gtk_scale_button_grab_notify
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|,
name|gboolean
name|was_grabbed
parameter_list|)
block|{
name|GdkDisplay
modifier|*
name|display
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
if|if
condition|(
name|was_grabbed
operator|!=
name|FALSE
condition|)
return|return;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
if|if
condition|(
operator|!
name|GTK_WIDGET_HAS_GRAB
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
condition|)
return|return;
if|if
condition|(
name|gtk_widget_is_ancestor
argument_list|(
name|gtk_grab_get_current
argument_list|()
argument_list|,
name|priv
operator|->
name|dock
argument_list|)
condition|)
return|return;
name|display
operator|=
name|gtk_widget_get_display
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|gdk_display_keyboard_ungrab
argument_list|(
name|display
argument_list|,
name|GDK_CURRENT_TIME
argument_list|)
expr_stmt|;
name|gdk_display_pointer_ungrab
argument_list|(
name|display
argument_list|,
name|GDK_CURRENT_TIME
argument_list|)
expr_stmt|;
name|gtk_grab_remove
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
comment|/* hide again */
name|gtk_widget_hide
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|priv
operator|->
name|timeout
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * +/- button callbacks.  */
end_comment

begin_function
specifier|static
name|gboolean
DECL|function|cb_button_timeout (gpointer user_data)
name|cb_button_timeout
parameter_list|(
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gdouble
name|val
decl_stmt|;
name|gboolean
name|res
init|=
name|TRUE
decl_stmt|;
name|button
operator|=
name|GTK_SCALE_BUTTON
argument_list|(
name|user_data
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|click_id
operator|==
literal|0
condition|)
return|return
name|FALSE
return|;
name|adj
operator|=
name|priv
operator|->
name|adjustment
expr_stmt|;
name|val
operator|=
name|gtk_scale_button_get_value
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|val
operator|+=
name|priv
operator|->
name|direction
expr_stmt|;
if|if
condition|(
name|val
operator|<=
name|adj
operator|->
name|lower
condition|)
block|{
name|res
operator|=
name|FALSE
expr_stmt|;
name|val
operator|=
name|adj
operator|->
name|lower
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|val
operator|>
name|adj
operator|->
name|upper
condition|)
block|{
name|res
operator|=
name|FALSE
expr_stmt|;
name|val
operator|=
name|adj
operator|->
name|upper
expr_stmt|;
block|}
name|gtk_scale_button_set_value
argument_list|(
name|button
argument_list|,
name|val
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|res
condition|)
block|{
name|g_source_remove
argument_list|(
name|priv
operator|->
name|click_id
argument_list|)
expr_stmt|;
name|priv
operator|->
name|click_id
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|res
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|cb_button_press (GtkWidget * widget,GdkEventButton * event,gpointer user_data)
name|cb_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|button
operator|=
name|GTK_SCALE_BUTTON
argument_list|(
name|user_data
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
name|adj
operator|=
name|priv
operator|->
name|adjustment
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|click_id
operator|!=
literal|0
condition|)
name|g_source_remove
argument_list|(
name|priv
operator|->
name|click_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
operator|==
name|button
operator|->
name|plus_button
condition|)
name|priv
operator|->
name|direction
operator|=
name|fabs
argument_list|(
name|adj
operator|->
name|page_increment
argument_list|)
expr_stmt|;
else|else
name|priv
operator|->
name|direction
operator|=
operator|-
name|fabs
argument_list|(
name|adj
operator|->
name|page_increment
argument_list|)
expr_stmt|;
name|priv
operator|->
name|click_id
operator|=
name|gdk_threads_add_timeout
argument_list|(
name|priv
operator|->
name|click_timeout
argument_list|,
name|cb_button_timeout
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|cb_button_timeout
argument_list|(
name|button
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|cb_button_release (GtkWidget * widget,GdkEventButton * event,gpointer user_data)
name|cb_button_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|button
operator|=
name|GTK_SCALE_BUTTON
argument_list|(
name|user_data
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
if|if
condition|(
name|priv
operator|->
name|click_id
operator|!=
literal|0
condition|)
block|{
name|g_source_remove
argument_list|(
name|priv
operator|->
name|click_id
argument_list|)
expr_stmt|;
name|priv
operator|->
name|click_id
operator|=
literal|0
expr_stmt|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cb_dock_grab_notify (GtkWidget * widget,gboolean was_grabbed,gpointer user_data)
name|cb_dock_grab_notify
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|was_grabbed
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
operator|(
name|GtkScaleButton
operator|*
operator|)
name|user_data
decl_stmt|;
name|gtk_scale_button_grab_notify
argument_list|(
name|button
argument_list|,
name|was_grabbed
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|cb_dock_grab_broken_event (GtkWidget * widget,gboolean was_grabbed,gpointer user_data)
name|cb_dock_grab_broken_event
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|was_grabbed
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
operator|(
name|GtkScaleButton
operator|*
operator|)
name|user_data
decl_stmt|;
name|gtk_scale_button_grab_notify
argument_list|(
name|button
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function

begin_comment
comment|/*  * Scale callbacks.  */
end_comment

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_release_grab (GtkScaleButton * button,GdkEventButton * event)
name|gtk_scale_button_release_grab
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|GdkEventButton
modifier|*
name|e
decl_stmt|;
name|GdkDisplay
modifier|*
name|display
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
comment|/* ungrab focus */
name|display
operator|=
name|gtk_widget_get_display
argument_list|(
name|GTK_WIDGET
argument_list|(
name|button
argument_list|)
argument_list|)
expr_stmt|;
name|gdk_display_keyboard_ungrab
argument_list|(
name|display
argument_list|,
name|event
operator|->
name|time
argument_list|)
expr_stmt|;
name|gdk_display_pointer_ungrab
argument_list|(
name|display
argument_list|,
name|event
operator|->
name|time
argument_list|)
expr_stmt|;
name|gtk_grab_remove
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
comment|/* hide again */
name|gtk_widget_hide
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|priv
operator|->
name|timeout
operator|=
name|FALSE
expr_stmt|;
name|e
operator|=
operator|(
name|GdkEventButton
operator|*
operator|)
name|gdk_event_copy
argument_list|(
operator|(
name|GdkEvent
operator|*
operator|)
name|event
argument_list|)
expr_stmt|;
name|e
operator|->
name|window
operator|=
name|GTK_WIDGET
argument_list|(
name|button
argument_list|)
operator|->
name|window
expr_stmt|;
name|e
operator|->
name|type
operator|=
name|GDK_BUTTON_RELEASE
expr_stmt|;
name|gtk_widget_event
argument_list|(
name|GTK_WIDGET
argument_list|(
name|button
argument_list|)
argument_list|,
operator|(
name|GdkEvent
operator|*
operator|)
name|e
argument_list|)
expr_stmt|;
name|e
operator|->
name|window
operator|=
name|event
operator|->
name|window
expr_stmt|;
name|gdk_event_free
argument_list|(
operator|(
name|GdkEvent
operator|*
operator|)
name|e
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|cb_dock_button_press (GtkWidget * widget,GdkEventButton * event,gpointer user_data)
name|cb_dock_button_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
name|GTK_SCALE_BUTTON
argument_list|(
name|user_data
argument_list|)
decl_stmt|;
if|if
condition|(
name|event
operator|->
name|type
operator|==
name|GDK_BUTTON_PRESS
condition|)
block|{
name|gtk_scale_button_release_grab
argument_list|(
name|button
argument_list|,
name|event
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
return|return
name|FALSE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_popdown_from_bindings (GtkWidget * widget)
name|gtk_scale_button_popdown_from_bindings
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GdkDisplay
modifier|*
name|display
decl_stmt|;
name|button
operator|=
name|GTK_SCALE_BUTTON
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
comment|/* ungrab focus */
name|display
operator|=
name|gtk_widget_get_display
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|gdk_display_keyboard_ungrab
argument_list|(
name|display
argument_list|,
name|GDK_CURRENT_TIME
argument_list|)
expr_stmt|;
name|gdk_display_pointer_ungrab
argument_list|(
name|display
argument_list|,
name|GDK_CURRENT_TIME
argument_list|)
expr_stmt|;
name|gtk_grab_remove
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
comment|/* hide again */
name|gtk_widget_hide
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
name|priv
operator|->
name|timeout
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|cb_dock_key_release (GtkWidget * widget,GdkEventKey * event,gpointer user_data)
name|cb_dock_key_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventKey
modifier|*
name|event
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|keyval
operator|==
name|GDK_Escape
condition|)
block|{
name|gtk_scale_button_popdown_from_bindings
argument_list|(
name|GTK_WIDGET
argument_list|(
name|user_data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
if|if
condition|(
operator|!
name|gtk_bindings_activate_event
argument_list|(
name|GTK_OBJECT
argument_list|(
name|widget
argument_list|)
argument_list|,
name|event
argument_list|)
condition|)
block|{
comment|/* The popup hasn't managed the event, pass onto the button */
name|gtk_bindings_activate_event
argument_list|(
name|GTK_OBJECT
argument_list|(
name|user_data
argument_list|)
argument_list|,
name|event
argument_list|)
expr_stmt|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|cb_scale_grab_notify (GtkWidget * widget,gboolean was_grabbed,gpointer user_data)
name|cb_scale_grab_notify
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|gboolean
name|was_grabbed
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
init|=
operator|(
name|GtkScaleButton
operator|*
operator|)
name|user_data
decl_stmt|;
name|gtk_scale_button_grab_notify
argument_list|(
name|button
argument_list|,
name|was_grabbed
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  * Scale stuff.  */
end_comment

begin_decl_stmt
specifier|static
name|GType
name|gtk_scale_button_hscale_get_type
argument_list|(
name|void
argument_list|)
name|G_GNUC_CONST
decl_stmt|;
end_decl_stmt

begin_decl_stmt
specifier|static
name|GType
name|gtk_scale_button_vscale_get_type
argument_list|(
name|void
argument_list|)
name|G_GNUC_CONST
decl_stmt|;
end_decl_stmt

begin_define
DECL|macro|GTK_TYPE_SCALE_BUTTON_VSCALE
define|#
directive|define
name|GTK_TYPE_SCALE_BUTTON_VSCALE
value|(gtk_scale_button_vscale_get_type ())
end_define

begin_define
DECL|macro|GTK_SCALE_BUTTON_VSCALE (obj)
define|#
directive|define
name|GTK_SCALE_BUTTON_VSCALE
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_CHECK_INSTANCE_CAST ((obj), GTK_TYPE_SCALE_BUTTON_VSCALE, GtkScaleButtonVScale))
end_define

begin_define
DECL|macro|GTK_IS_SCALE_BUTTON_VSCALE (obj)
define|#
directive|define
name|GTK_IS_SCALE_BUTTON_VSCALE
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_CHECK_INSTANCE_TYPE ((obj), GTK_TYPE_SCALE_BUTTON_VSCALE))
end_define

begin_typedef
DECL|struct|_GtkScaleButtonVScale
typedef|typedef
struct|struct
name|_GtkScaleButtonVScale
block|{
DECL|member|parent
name|GtkVScale
name|parent
decl_stmt|;
DECL|member|button
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
DECL|typedef|GtkScaleButtonVScale
block|}
name|GtkScaleButtonVScale
typedef|;
end_typedef

begin_typedef
DECL|struct|_GtkScaleButtonVScaleClass
typedef|typedef
struct|struct
name|_GtkScaleButtonVScaleClass
block|{
DECL|member|parent_class
name|GtkVScaleClass
name|parent_class
decl_stmt|;
DECL|typedef|GtkScaleButtonVScaleClass
block|}
name|GtkScaleButtonVScaleClass
typedef|;
end_typedef

begin_define
DECL|macro|GTK_TYPE_SCALE_BUTTON_HSCALE
define|#
directive|define
name|GTK_TYPE_SCALE_BUTTON_HSCALE
value|(gtk_scale_button_hscale_get_type ())
end_define

begin_define
DECL|macro|GTK_SCALE_BUTTON_HSCALE (obj)
define|#
directive|define
name|GTK_SCALE_BUTTON_HSCALE
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_CHECK_INSTANCE_CAST ((obj), GTK_TYPE_SCALE_BUTTON_HSCALE, GtkScaleButtonHScale))
end_define

begin_define
DECL|macro|GTK_IS_SCALE_BUTTON_HSCALE (obj)
define|#
directive|define
name|GTK_IS_SCALE_BUTTON_HSCALE
parameter_list|(
name|obj
parameter_list|)
value|(G_TYPE_CHECK_INSTANCE_TYPE ((obj), GTK_TYPE_SCALE_BUTTON_HSCALE))
end_define

begin_typedef
DECL|struct|_GtkScaleButtonHScale
typedef|typedef
struct|struct
name|_GtkScaleButtonHScale
block|{
DECL|member|parent
name|GtkVScale
name|parent
decl_stmt|;
DECL|member|button
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
DECL|typedef|GtkScaleButtonHScale
block|}
name|GtkScaleButtonHScale
typedef|;
end_typedef

begin_typedef
DECL|struct|_GtkScaleButtonHScaleClass
typedef|typedef
struct|struct
name|_GtkScaleButtonHScaleClass
block|{
DECL|member|parent_class
name|GtkVScaleClass
name|parent_class
decl_stmt|;
DECL|typedef|GtkScaleButtonHScaleClass
block|}
name|GtkScaleButtonHScaleClass
typedef|;
end_typedef

begin_function_decl
specifier|static
name|gboolean
name|gtk_scale_button_scale_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gtk_scale_button_scale_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
function_decl|;
end_function_decl

begin_macro
DECL|function|G_DEFINE_TYPE (GtkScaleButtonVScale,gtk_scale_button_vscale,GTK_TYPE_VSCALE)
name|G_DEFINE_TYPE
argument_list|(
argument|GtkScaleButtonVScale
argument_list|,
argument|gtk_scale_button_vscale
argument_list|,
argument|GTK_TYPE_VSCALE
argument_list|)
end_macro

begin_macro
name|G_DEFINE_TYPE
argument_list|(
argument|GtkScaleButtonHScale
argument_list|,
argument|gtk_scale_button_hscale
argument_list|,
argument|GTK_TYPE_HSCALE
argument_list|)
end_macro

begin_function
specifier|static
name|void
name|gtk_scale_button_vscale_class_init
parameter_list|(
name|GtkScaleButtonVScaleClass
modifier|*
name|klass
parameter_list|)
block|{
name|GtkWidgetClass
modifier|*
name|gtkwidget_class
init|=
name|GTK_WIDGET_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GtkRangeClass
modifier|*
name|gtkrange_class
init|=
name|GTK_RANGE_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|gtkwidget_class
operator|->
name|button_press_event
operator|=
name|gtk_scale_button_scale_press
expr_stmt|;
name|gtkwidget_class
operator|->
name|button_release_event
operator|=
name|gtk_scale_button_scale_release
expr_stmt|;
name|gtkrange_class
operator|->
name|value_changed
operator|=
name|gtk_scale_button_scale_value_changed
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_hscale_class_init (GtkScaleButtonHScaleClass * klass)
name|gtk_scale_button_hscale_class_init
parameter_list|(
name|GtkScaleButtonHScaleClass
modifier|*
name|klass
parameter_list|)
block|{
name|GtkWidgetClass
modifier|*
name|gtkwidget_class
init|=
name|GTK_WIDGET_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GtkRangeClass
modifier|*
name|gtkrange_class
init|=
name|GTK_RANGE_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|gtkwidget_class
operator|->
name|button_press_event
operator|=
name|gtk_scale_button_scale_press
expr_stmt|;
name|gtkwidget_class
operator|->
name|button_release_event
operator|=
name|gtk_scale_button_scale_release
expr_stmt|;
name|gtkrange_class
operator|->
name|value_changed
operator|=
name|gtk_scale_button_scale_value_changed
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_vscale_init (GtkScaleButtonVScale * scale)
name|gtk_scale_button_vscale_init
parameter_list|(
name|GtkScaleButtonVScale
modifier|*
name|scale
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_hscale_init (GtkScaleButtonHScale * scale)
name|gtk_scale_button_hscale_init
parameter_list|(
name|GtkScaleButtonHScale
modifier|*
name|scale
parameter_list|)
block|{ }
end_function

begin_function
specifier|static
name|GtkWidget
modifier|*
DECL|function|gtk_scale_button_scale_box_new (GtkScaleButton * button)
name|gtk_scale_button_scale_box_new
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
init|=
name|button
operator|->
name|priv
decl_stmt|;
name|GtkScaleButtonVScale
modifier|*
name|scale
decl_stmt|;
name|GtkWidget
modifier|*
name|box
decl_stmt|;
if|if
condition|(
name|priv
operator|->
name|orientation
operator|==
name|GTK_ORIENTATION_VERTICAL
condition|)
block|{
name|box
operator|=
name|gtk_vbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_SCALE_BUTTON_VSCALE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|->
name|scale
operator|=
name|GTK_WIDGET
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|priv
operator|->
name|scale
argument_list|,
operator|-
literal|1
argument_list|,
name|SCALE_SIZE
argument_list|)
expr_stmt|;
name|gtk_range_set_inverted
argument_list|(
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|button
operator|->
name|plus_button
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|priv
operator|->
name|scale
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|button
operator|->
name|minus_button
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|box
operator|=
name|gtk_hbox_new
argument_list|(
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scale
operator|=
name|g_object_new
argument_list|(
name|GTK_TYPE_SCALE_BUTTON_HSCALE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|priv
operator|->
name|scale
operator|=
name|GTK_WIDGET
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|gtk_widget_set_size_request
argument_list|(
name|priv
operator|->
name|scale
argument_list|,
name|SCALE_SIZE
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|button
operator|->
name|minus_button
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|priv
operator|->
name|scale
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gtk_box_pack_start
argument_list|(
name|GTK_BOX
argument_list|(
name|box
argument_list|)
argument_list|,
name|button
operator|->
name|plus_button
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|gtk_scale_set_draw_value
argument_list|(
name|GTK_SCALE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gtk_range_set_adjustment
argument_list|(
name|GTK_RANGE
argument_list|(
name|scale
argument_list|)
argument_list|,
name|GTK_ADJUSTMENT
argument_list|(
name|priv
operator|->
name|adjustment
argument_list|)
argument_list|)
expr_stmt|;
name|scale
operator|->
name|button
operator|=
name|button
expr_stmt|;
name|g_signal_connect
argument_list|(
name|priv
operator|->
name|scale
argument_list|,
literal|"grab-notify"
argument_list|,
name|G_CALLBACK
argument_list|(
name|cb_scale_grab_notify
argument_list|)
argument_list|,
name|button
argument_list|)
expr_stmt|;
comment|/* FIXME: without this, the popup window appears as a square    * after changing the orientation    */
name|gtk_window_resize
argument_list|(
name|GTK_WINDOW
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
name|box
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gtk_scale_button_scale_press (GtkWidget * widget,GdkEventButton * event)
name|gtk_scale_button_scale_press
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkWidgetClass
modifier|*
name|widget_class
decl_stmt|;
if|if
condition|(
name|GTK_IS_SCALE_BUTTON_VSCALE
argument_list|(
name|widget
argument_list|)
condition|)
block|{
name|priv
operator|=
name|GTK_SCALE_BUTTON_VSCALE
argument_list|(
name|widget
argument_list|)
operator|->
name|button
operator|->
name|priv
expr_stmt|;
name|widget_class
operator|=
name|GTK_WIDGET_CLASS
argument_list|(
name|gtk_scale_button_vscale_parent_class
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|priv
operator|=
name|GTK_SCALE_BUTTON_HSCALE
argument_list|(
name|widget
argument_list|)
operator|->
name|button
operator|->
name|priv
expr_stmt|;
name|widget_class
operator|=
name|GTK_WIDGET_CLASS
argument_list|(
name|gtk_scale_button_hscale_parent_class
argument_list|)
expr_stmt|;
block|}
comment|/* the scale will grab input; if we have input grabbed, all goes    * horribly wrong, so let's not do that. */
name|gtk_grab_remove
argument_list|(
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
return|return
name|widget_class
operator|->
name|button_press_event
argument_list|(
name|widget
argument_list|,
name|event
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gtk_scale_button_scale_release (GtkWidget * widget,GdkEventButton * event)
name|gtk_scale_button_scale_release
parameter_list|(
name|GtkWidget
modifier|*
name|widget
parameter_list|,
name|GdkEventButton
modifier|*
name|event
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|GtkWidgetClass
modifier|*
name|widget_class
decl_stmt|;
name|gboolean
name|res
decl_stmt|;
if|if
condition|(
name|GTK_IS_SCALE_BUTTON_VSCALE
argument_list|(
name|widget
argument_list|)
condition|)
block|{
name|button
operator|=
name|GTK_SCALE_BUTTON_VSCALE
argument_list|(
name|widget
argument_list|)
operator|->
name|button
expr_stmt|;
name|widget_class
operator|=
name|GTK_WIDGET_CLASS
argument_list|(
name|gtk_scale_button_vscale_parent_class
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|button
operator|=
name|GTK_SCALE_BUTTON_HSCALE
argument_list|(
name|widget
argument_list|)
operator|->
name|button
expr_stmt|;
name|widget_class
operator|=
name|GTK_WIDGET_CLASS
argument_list|(
name|gtk_scale_button_hscale_parent_class
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|button
operator|->
name|priv
operator|->
name|timeout
condition|)
block|{
comment|/* if we did a quick click, leave the window open; else, hide it */
if|if
condition|(
name|event
operator|->
name|time
operator|>
name|button
operator|->
name|priv
operator|->
name|pop_time
operator|+
name|button
operator|->
name|priv
operator|->
name|click_timeout
condition|)
block|{
name|gtk_scale_button_release_grab
argument_list|(
name|button
argument_list|,
name|event
argument_list|)
expr_stmt|;
name|widget_class
operator|->
name|button_release_event
argument_list|(
name|widget
argument_list|,
name|event
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
name|button
operator|->
name|priv
operator|->
name|timeout
operator|=
name|FALSE
expr_stmt|;
block|}
name|res
operator|=
name|widget_class
operator|->
name|button_release_event
argument_list|(
name|widget
argument_list|,
name|event
argument_list|)
expr_stmt|;
comment|/* the scale will release input; right after that, we *have to* grab    * it back so we can catch out-of-scale clicks and hide the popup,    * so I basically want a g_signal_connect_after_always(), but I can't    * find that, so we do this complex 'first-call-parent-then-do-actual-    * action' thingy...    */
name|gtk_grab_add
argument_list|(
name|button
operator|->
name|priv
operator|->
name|dock
argument_list|)
expr_stmt|;
return|return
name|res
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_update_icon (GtkScaleButton * button)
name|gtk_scale_button_update_icon
parameter_list|(
name|GtkScaleButton
modifier|*
name|button
parameter_list|)
block|{
name|GtkScaleButtonPrivate
modifier|*
name|priv
decl_stmt|;
name|GtkRange
modifier|*
name|range
decl_stmt|;
name|GtkAdjustment
modifier|*
name|adj
decl_stmt|;
name|gdouble
name|value
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|name
decl_stmt|;
name|guint
name|num_icons
decl_stmt|;
name|priv
operator|=
name|button
operator|->
name|priv
expr_stmt|;
if|if
condition|(
operator|!
name|priv
operator|->
name|icon_list
operator|||
name|priv
operator|->
name|icon_list
index|[
literal|0
index|]
operator|==
literal|'\0'
condition|)
block|{
name|gtk_image_set_from_stock
argument_list|(
name|GTK_IMAGE
argument_list|(
name|priv
operator|->
name|image
argument_list|)
argument_list|,
name|GTK_STOCK_MISSING_IMAGE
argument_list|,
name|priv
operator|->
name|size
argument_list|)
expr_stmt|;
return|return;
block|}
name|num_icons
operator|=
name|g_strv_length
argument_list|(
name|priv
operator|->
name|icon_list
argument_list|)
expr_stmt|;
comment|/* The 1-icon special case */
if|if
condition|(
name|num_icons
operator|==
literal|1
condition|)
block|{
name|gtk_image_set_from_icon_name
argument_list|(
name|GTK_IMAGE
argument_list|(
name|priv
operator|->
name|image
argument_list|)
argument_list|,
name|priv
operator|->
name|icon_list
index|[
literal|0
index|]
argument_list|,
name|priv
operator|->
name|size
argument_list|)
expr_stmt|;
return|return;
block|}
name|range
operator|=
name|GTK_RANGE
argument_list|(
name|priv
operator|->
name|scale
argument_list|)
expr_stmt|;
name|adj
operator|=
name|priv
operator|->
name|adjustment
expr_stmt|;
name|value
operator|=
name|gtk_scale_button_get_value
argument_list|(
name|button
argument_list|)
expr_stmt|;
comment|/* The 2-icons special case */
if|if
condition|(
name|num_icons
operator|==
literal|2
condition|)
block|{
name|gdouble
name|limit
decl_stmt|;
name|limit
operator|=
operator|(
name|adj
operator|->
name|upper
operator|-
name|adj
operator|->
name|lower
operator|)
operator|/
literal|2
operator|+
name|adj
operator|->
name|lower
expr_stmt|;
if|if
condition|(
name|value
operator|<
name|limit
condition|)
name|name
operator|=
name|priv
operator|->
name|icon_list
index|[
literal|0
index|]
expr_stmt|;
else|else
name|name
operator|=
name|priv
operator|->
name|icon_list
index|[
literal|1
index|]
expr_stmt|;
name|gtk_image_set_from_icon_name
argument_list|(
name|GTK_IMAGE
argument_list|(
name|priv
operator|->
name|image
argument_list|)
argument_list|,
name|name
argument_list|,
name|priv
operator|->
name|size
argument_list|)
expr_stmt|;
return|return;
block|}
comment|/* With 3 or more icons */
if|if
condition|(
name|value
operator|==
name|adj
operator|->
name|lower
condition|)
block|{
name|name
operator|=
name|priv
operator|->
name|icon_list
index|[
literal|0
index|]
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|value
operator|==
name|adj
operator|->
name|upper
condition|)
block|{
name|name
operator|=
name|priv
operator|->
name|icon_list
index|[
literal|1
index|]
expr_stmt|;
block|}
else|else
block|{
name|gdouble
name|step
decl_stmt|;
name|guint
name|i
decl_stmt|;
name|step
operator|=
operator|(
name|adj
operator|->
name|upper
operator|-
name|adj
operator|->
name|lower
operator|)
operator|/
operator|(
name|num_icons
operator|-
literal|2
operator|)
expr_stmt|;
name|i
operator|=
call|(
name|guint
call|)
argument_list|(
operator|(
name|value
operator|-
name|adj
operator|->
name|lower
operator|)
operator|/
name|step
argument_list|)
operator|+
literal|2
expr_stmt|;
name|g_assert
argument_list|(
name|i
operator|<
name|num_icons
argument_list|)
expr_stmt|;
name|name
operator|=
name|priv
operator|->
name|icon_list
index|[
name|i
index|]
expr_stmt|;
block|}
name|gtk_image_set_from_icon_name
argument_list|(
name|GTK_IMAGE
argument_list|(
name|priv
operator|->
name|image
argument_list|)
argument_list|,
name|name
argument_list|,
name|priv
operator|->
name|size
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gtk_scale_button_scale_value_changed (GtkRange * range)
name|gtk_scale_button_scale_value_changed
parameter_list|(
name|GtkRange
modifier|*
name|range
parameter_list|)
block|{
name|GtkScaleButton
modifier|*
name|button
decl_stmt|;
name|gdouble
name|value
decl_stmt|;
if|if
condition|(
name|GTK_IS_SCALE_BUTTON_VSCALE
argument_list|(
name|range
argument_list|)
condition|)
name|button
operator|=
name|GTK_SCALE_BUTTON_VSCALE
argument_list|(
name|range
argument_list|)
operator|->
name|button
expr_stmt|;
else|else
name|button
operator|=
name|GTK_SCALE_BUTTON_HSCALE
argument_list|(
name|range
argument_list|)
operator|->
name|button
expr_stmt|;
name|value
operator|=
name|gtk_range_get_value
argument_list|(
name|range
argument_list|)
expr_stmt|;
name|gtk_scale_button_update_icon
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|button
argument_list|,
name|signals
index|[
name|VALUE_CHANGED
index|]
argument_list|,
literal|0
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|g_object_notify
argument_list|(
name|G_OBJECT
argument_list|(
name|button
argument_list|)
argument_list|,
literal|"value"
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

