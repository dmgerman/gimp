begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* GIMP - The GNU Image Manipulation Program  * Copyright (C) 1995 Spencer Kimball and Peter Mattis  *  * This program is free software: you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program.  If not, see<http://www.gnu.org/licenses/>.  */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|<time.h>
end_include

begin_include
include|#
directive|include
file|<cairo.h>
end_include

begin_include
include|#
directive|include
file|<gdk-pixbuf/gdk-pixbuf.h>
end_include

begin_include
include|#
directive|include
file|<gegl.h>
end_include

begin_include
include|#
directive|include
file|<gexiv2/gexiv2.h>
end_include

begin_include
include|#
directive|include
file|"libgimpcolor/gimpcolor.h"
end_include

begin_include
include|#
directive|include
file|"libgimpmath/gimpmath.h"
end_include

begin_include
include|#
directive|include
file|"libgimpbase/gimpbase.h"
end_include

begin_include
include|#
directive|include
file|"libgimpconfig/gimpconfig.h"
end_include

begin_include
include|#
directive|include
file|"core-types.h"
end_include

begin_include
include|#
directive|include
file|"config/gimpcoreconfig.h"
end_include

begin_include
include|#
directive|include
file|"gegl/gimp-babl.h"
end_include

begin_include
include|#
directive|include
file|"gimp.h"
end_include

begin_include
include|#
directive|include
file|"gimp-memsize.h"
end_include

begin_include
include|#
directive|include
file|"gimp-parasites.h"
end_include

begin_include
include|#
directive|include
file|"gimpcontext.h"
end_include

begin_include
include|#
directive|include
file|"gimpdrawablestack.h"
end_include

begin_include
include|#
directive|include
file|"gimpgrid.h"
end_include

begin_include
include|#
directive|include
file|"gimperror.h"
end_include

begin_include
include|#
directive|include
file|"gimpguide.h"
end_include

begin_include
include|#
directive|include
file|"gimpidtable.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-colormap.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-guides.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-item-list.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-metadata.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-sample-points.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-preview.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-private.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-profile.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-quick-mask.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-undo.h"
end_include

begin_include
include|#
directive|include
file|"gimpimage-undo-push.h"
end_include

begin_include
include|#
directive|include
file|"gimpitemtree.h"
end_include

begin_include
include|#
directive|include
file|"gimplayer.h"
end_include

begin_include
include|#
directive|include
file|"gimplayer-floating-sel.h"
end_include

begin_include
include|#
directive|include
file|"gimplayermask.h"
end_include

begin_include
include|#
directive|include
file|"gimpmarshal.h"
end_include

begin_include
include|#
directive|include
file|"gimpparasitelist.h"
end_include

begin_include
include|#
directive|include
file|"gimppickable.h"
end_include

begin_include
include|#
directive|include
file|"gimpprojectable.h"
end_include

begin_include
include|#
directive|include
file|"gimpprojection.h"
end_include

begin_include
include|#
directive|include
file|"gimpsamplepoint.h"
end_include

begin_include
include|#
directive|include
file|"gimpselection.h"
end_include

begin_include
include|#
directive|include
file|"gimptempbuf.h"
end_include

begin_include
include|#
directive|include
file|"gimptemplate.h"
end_include

begin_include
include|#
directive|include
file|"gimpundostack.h"
end_include

begin_include
include|#
directive|include
file|"file/file-utils.h"
end_include

begin_include
include|#
directive|include
file|"vectors/gimpvectors.h"
end_include

begin_include
include|#
directive|include
file|"gimp-log.h"
end_include

begin_include
include|#
directive|include
file|"gimp-intl.h"
end_include

begin_ifdef
ifdef|#
directive|ifdef
name|DEBUG
end_ifdef

begin_define
DECL|macro|TRC (x)
define|#
directive|define
name|TRC
parameter_list|(
name|x
parameter_list|)
value|g_printerr x
end_define

begin_else
else|#
directive|else
end_else

begin_define
DECL|macro|TRC (x)
define|#
directive|define
name|TRC
parameter_list|(
name|x
parameter_list|)
end_define

begin_endif
endif|#
directive|endif
end_endif

begin_enum
enum|enum
DECL|enum|__anon2a1fa2e20103
block|{
DECL|enumerator|MODE_CHANGED
name|MODE_CHANGED
block|,
DECL|enumerator|PRECISION_CHANGED
name|PRECISION_CHANGED
block|,
DECL|enumerator|ALPHA_CHANGED
name|ALPHA_CHANGED
block|,
DECL|enumerator|FLOATING_SELECTION_CHANGED
name|FLOATING_SELECTION_CHANGED
block|,
DECL|enumerator|ACTIVE_LAYER_CHANGED
name|ACTIVE_LAYER_CHANGED
block|,
DECL|enumerator|ACTIVE_CHANNEL_CHANGED
name|ACTIVE_CHANNEL_CHANGED
block|,
DECL|enumerator|ACTIVE_VECTORS_CHANGED
name|ACTIVE_VECTORS_CHANGED
block|,
DECL|enumerator|COMPONENT_VISIBILITY_CHANGED
name|COMPONENT_VISIBILITY_CHANGED
block|,
DECL|enumerator|COMPONENT_ACTIVE_CHANGED
name|COMPONENT_ACTIVE_CHANGED
block|,
DECL|enumerator|MASK_CHANGED
name|MASK_CHANGED
block|,
DECL|enumerator|RESOLUTION_CHANGED
name|RESOLUTION_CHANGED
block|,
DECL|enumerator|SIZE_CHANGED_DETAILED
name|SIZE_CHANGED_DETAILED
block|,
DECL|enumerator|UNIT_CHANGED
name|UNIT_CHANGED
block|,
DECL|enumerator|QUICK_MASK_CHANGED
name|QUICK_MASK_CHANGED
block|,
DECL|enumerator|SELECTION_INVALIDATE
name|SELECTION_INVALIDATE
block|,
DECL|enumerator|CLEAN
name|CLEAN
block|,
DECL|enumerator|DIRTY
name|DIRTY
block|,
DECL|enumerator|SAVED
name|SAVED
block|,
DECL|enumerator|EXPORTED
name|EXPORTED
block|,
DECL|enumerator|GUIDE_ADDED
name|GUIDE_ADDED
block|,
DECL|enumerator|GUIDE_REMOVED
name|GUIDE_REMOVED
block|,
DECL|enumerator|GUIDE_MOVED
name|GUIDE_MOVED
block|,
DECL|enumerator|SAMPLE_POINT_ADDED
name|SAMPLE_POINT_ADDED
block|,
DECL|enumerator|SAMPLE_POINT_REMOVED
name|SAMPLE_POINT_REMOVED
block|,
DECL|enumerator|SAMPLE_POINT_MOVED
name|SAMPLE_POINT_MOVED
block|,
DECL|enumerator|PARASITE_ATTACHED
name|PARASITE_ATTACHED
block|,
DECL|enumerator|PARASITE_DETACHED
name|PARASITE_DETACHED
block|,
DECL|enumerator|COLORMAP_CHANGED
name|COLORMAP_CHANGED
block|,
DECL|enumerator|UNDO_EVENT
name|UNDO_EVENT
block|,
DECL|enumerator|LAST_SIGNAL
name|LAST_SIGNAL
block|}
enum|;
end_enum

begin_enum
enum|enum
DECL|enum|__anon2a1fa2e20203
block|{
DECL|enumerator|PROP_0
name|PROP_0
block|,
DECL|enumerator|PROP_GIMP
name|PROP_GIMP
block|,
DECL|enumerator|PROP_ID
name|PROP_ID
block|,
DECL|enumerator|PROP_WIDTH
name|PROP_WIDTH
block|,
DECL|enumerator|PROP_HEIGHT
name|PROP_HEIGHT
block|,
DECL|enumerator|PROP_BASE_TYPE
name|PROP_BASE_TYPE
block|,
DECL|enumerator|PROP_PRECISION
name|PROP_PRECISION
block|,
DECL|enumerator|PROP_METADATA
name|PROP_METADATA
block|,
DECL|enumerator|PROP_BUFFER
name|PROP_BUFFER
block|}
enum|;
end_enum

begin_comment
comment|/*  local function prototypes  */
end_comment

begin_function_decl
specifier|static
name|void
name|gimp_color_managed_iface_init
parameter_list|(
name|GimpColorManagedInterface
modifier|*
name|iface
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_projectable_iface_init
parameter_list|(
name|GimpProjectableInterface
modifier|*
name|iface
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_pickable_iface_init
parameter_list|(
name|GimpPickableInterface
modifier|*
name|iface
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_constructed
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_name_changed
parameter_list|(
name|GimpObject
modifier|*
name|object
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gint64
name|gimp_image_get_memsize
parameter_list|(
name|GimpObject
modifier|*
name|object
parameter_list|,
name|gint64
modifier|*
name|gui_size
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_image_get_size
parameter_list|(
name|GimpViewable
modifier|*
name|viewable
parameter_list|,
name|gint
modifier|*
name|width
parameter_list|,
name|gint
modifier|*
name|height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_size_changed
parameter_list|(
name|GimpViewable
modifier|*
name|viewable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gchar
modifier|*
name|gimp_image_get_description
parameter_list|(
name|GimpViewable
modifier|*
name|viewable
parameter_list|,
name|gchar
modifier|*
modifier|*
name|tooltip
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_real_mode_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_real_precision_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_real_resolution_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_real_size_changed_detailed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|previous_origin_x
parameter_list|,
name|gint
name|previous_origin_y
parameter_list|,
name|gint
name|previous_width
parameter_list|,
name|gint
name|previous_height
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_real_unit_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_real_colormap_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|color_index
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|const
name|guint8
modifier|*
name|gimp_image_color_managed_get_icc_profile
parameter_list|(
name|GimpColorManaged
modifier|*
name|managed
parameter_list|,
name|gsize
modifier|*
name|len
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpColorProfile
name|gimp_image_color_managed_get_color_profile
parameter_list|(
name|GimpColorManaged
modifier|*
name|managed
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_projectable_flush
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|,
name|gboolean
name|invalidate_preview
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GeglNode
modifier|*
name|gimp_image_get_graph
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GimpImage
modifier|*
name|gimp_image_get_image
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
specifier|const
name|Babl
modifier|*
name|gimp_image_get_proj_format
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_pickable_flush
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|GeglBuffer
modifier|*
name|gimp_image_get_buffer
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gboolean
name|gimp_image_get_pixel_at
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
specifier|const
name|Babl
modifier|*
name|format
parameter_list|,
name|gpointer
name|pixel
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|gdouble
name|gimp_image_get_opacity_at
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_mask_update
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_layer_alpha_changed
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_channel_add
parameter_list|(
name|GimpContainer
modifier|*
name|container
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_channel_remove
parameter_list|(
name|GimpContainer
modifier|*
name|container
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_channel_name_changed
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_channel_color_changed
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_active_layer_notify
parameter_list|(
name|GimpItemTree
modifier|*
name|tree
parameter_list|,
specifier|const
name|GParamSpec
modifier|*
name|pspec
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_active_channel_notify
parameter_list|(
name|GimpItemTree
modifier|*
name|tree
parameter_list|,
specifier|const
name|GParamSpec
modifier|*
name|pspec
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_function_decl
specifier|static
name|void
name|gimp_image_active_vectors_notify
parameter_list|(
name|GimpItemTree
modifier|*
name|tree
parameter_list|,
specifier|const
name|GParamSpec
modifier|*
name|pspec
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
function_decl|;
end_function_decl

begin_macro
name|G_DEFINE_TYPE_WITH_CODE
argument_list|(
argument|GimpImage
argument_list|,
argument|gimp_image
argument_list|,
argument|GIMP_TYPE_VIEWABLE
argument_list|,
argument|G_IMPLEMENT_INTERFACE (GIMP_TYPE_COLOR_MANAGED,                                                 gimp_color_managed_iface_init)                          G_IMPLEMENT_INTERFACE (GIMP_TYPE_PROJECTABLE,                                                 gimp_projectable_iface_init)                          G_IMPLEMENT_INTERFACE (GIMP_TYPE_PICKABLE,                                                 gimp_pickable_iface_init)
argument_list|)
end_macro

begin_define
DECL|macro|parent_class
define|#
directive|define
name|parent_class
value|gimp_image_parent_class
end_define

begin_decl_stmt
specifier|static
name|guint
name|gimp_image_signals
index|[
name|LAST_SIGNAL
index|]
init|=
block|{
literal|0
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|void
DECL|function|gimp_image_class_init (GimpImageClass * klass)
name|gimp_image_class_init
parameter_list|(
name|GimpImageClass
modifier|*
name|klass
parameter_list|)
block|{
name|GObjectClass
modifier|*
name|object_class
init|=
name|G_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GimpObjectClass
modifier|*
name|gimp_object_class
init|=
name|GIMP_OBJECT_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|GimpViewableClass
modifier|*
name|viewable_class
init|=
name|GIMP_VIEWABLE_CLASS
argument_list|(
name|klass
argument_list|)
decl_stmt|;
name|gimp_image_signals
index|[
name|MODE_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"mode-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|mode_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|PRECISION_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"precision-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|precision_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|ALPHA_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"alpha-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|alpha_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|FLOATING_SELECTION_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"floating-selection-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|floating_selection_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|ACTIVE_LAYER_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"active-layer-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|active_layer_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|ACTIVE_CHANNEL_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"active-channel-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|active_channel_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|ACTIVE_VECTORS_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"active-vectors-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|active_vectors_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|COMPONENT_VISIBILITY_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"component-visibility-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|component_visibility_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__ENUM
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GIMP_TYPE_CHANNEL_TYPE
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|COMPONENT_ACTIVE_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"component-active-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|component_active_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__ENUM
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GIMP_TYPE_CHANNEL_TYPE
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|MASK_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"mask-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|mask_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|RESOLUTION_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"resolution-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|resolution_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|SIZE_CHANGED_DETAILED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"size-changed-detailed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|size_changed_detailed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__INT_INT_INT_INT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|4
argument_list|,
name|G_TYPE_INT
argument_list|,
name|G_TYPE_INT
argument_list|,
name|G_TYPE_INT
argument_list|,
name|G_TYPE_INT
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|UNIT_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"unit-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|unit_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|QUICK_MASK_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"quick-mask-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|quick_mask_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|SELECTION_INVALIDATE
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"selection-invalidate"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|selection_invalidate
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__VOID
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|CLEAN
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"clean"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|clean
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__FLAGS
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GIMP_TYPE_DIRTY_MASK
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|DIRTY
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"dirty"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|dirty
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__FLAGS
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GIMP_TYPE_DIRTY_MASK
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|SAVED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"saved"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|saved
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__OBJECT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_FILE
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|EXPORTED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"exported"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|exported
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__OBJECT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_FILE
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|GUIDE_ADDED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"guide-added"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|guide_added
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__OBJECT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GIMP_TYPE_GUIDE
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|GUIDE_REMOVED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"guide-removed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|guide_removed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__OBJECT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GIMP_TYPE_GUIDE
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|GUIDE_MOVED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"guide-moved"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|guide_moved
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__OBJECT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|GIMP_TYPE_GUIDE
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|SAMPLE_POINT_ADDED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"sample-point-added"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|sample_point_added
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__POINTER
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_POINTER
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|SAMPLE_POINT_REMOVED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"sample-point-removed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|sample_point_removed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__POINTER
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_POINTER
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|SAMPLE_POINT_MOVED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"sample-point-moved"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|sample_point_moved
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__POINTER
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_POINTER
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|PARASITE_ATTACHED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"parasite-attached"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|parasite_attached
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__STRING
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_STRING
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|PARASITE_DETACHED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"parasite-detached"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|parasite_detached
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|g_cclosure_marshal_VOID__STRING
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_STRING
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|COLORMAP_CHANGED
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"colormap-changed"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|colormap_changed
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__INT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|1
argument_list|,
name|G_TYPE_INT
argument_list|)
expr_stmt|;
name|gimp_image_signals
index|[
name|UNDO_EVENT
index|]
operator|=
name|g_signal_new
argument_list|(
literal|"undo-event"
argument_list|,
name|G_TYPE_FROM_CLASS
argument_list|(
name|klass
argument_list|)
argument_list|,
name|G_SIGNAL_RUN_FIRST
argument_list|,
name|G_STRUCT_OFFSET
argument_list|(
name|GimpImageClass
argument_list|,
name|undo_event
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|gimp_marshal_VOID__ENUM_OBJECT
argument_list|,
name|G_TYPE_NONE
argument_list|,
literal|2
argument_list|,
name|GIMP_TYPE_UNDO_EVENT
argument_list|,
name|GIMP_TYPE_UNDO
argument_list|)
expr_stmt|;
name|object_class
operator|->
name|constructed
operator|=
name|gimp_image_constructed
expr_stmt|;
name|object_class
operator|->
name|set_property
operator|=
name|gimp_image_set_property
expr_stmt|;
name|object_class
operator|->
name|get_property
operator|=
name|gimp_image_get_property
expr_stmt|;
name|object_class
operator|->
name|dispose
operator|=
name|gimp_image_dispose
expr_stmt|;
name|object_class
operator|->
name|finalize
operator|=
name|gimp_image_finalize
expr_stmt|;
name|gimp_object_class
operator|->
name|name_changed
operator|=
name|gimp_image_name_changed
expr_stmt|;
name|gimp_object_class
operator|->
name|get_memsize
operator|=
name|gimp_image_get_memsize
expr_stmt|;
name|viewable_class
operator|->
name|default_icon_name
operator|=
literal|"gimp-image"
expr_stmt|;
name|viewable_class
operator|->
name|get_size
operator|=
name|gimp_image_get_size
expr_stmt|;
name|viewable_class
operator|->
name|size_changed
operator|=
name|gimp_image_size_changed
expr_stmt|;
name|viewable_class
operator|->
name|get_preview_size
operator|=
name|gimp_image_get_preview_size
expr_stmt|;
name|viewable_class
operator|->
name|get_popup_size
operator|=
name|gimp_image_get_popup_size
expr_stmt|;
name|viewable_class
operator|->
name|get_new_preview
operator|=
name|gimp_image_get_new_preview
expr_stmt|;
name|viewable_class
operator|->
name|get_description
operator|=
name|gimp_image_get_description
expr_stmt|;
name|klass
operator|->
name|mode_changed
operator|=
name|gimp_image_real_mode_changed
expr_stmt|;
name|klass
operator|->
name|precision_changed
operator|=
name|gimp_image_real_precision_changed
expr_stmt|;
name|klass
operator|->
name|alpha_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|floating_selection_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|active_layer_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|active_channel_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|active_vectors_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|component_visibility_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|component_active_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|mask_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|resolution_changed
operator|=
name|gimp_image_real_resolution_changed
expr_stmt|;
name|klass
operator|->
name|size_changed_detailed
operator|=
name|gimp_image_real_size_changed_detailed
expr_stmt|;
name|klass
operator|->
name|unit_changed
operator|=
name|gimp_image_real_unit_changed
expr_stmt|;
name|klass
operator|->
name|quick_mask_changed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|selection_invalidate
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|clean
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|dirty
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|saved
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|exported
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|guide_added
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|guide_removed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|guide_moved
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|sample_point_added
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|sample_point_removed
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|sample_point_moved
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|parasite_attached
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|parasite_detached
operator|=
name|NULL
expr_stmt|;
name|klass
operator|->
name|colormap_changed
operator|=
name|gimp_image_real_colormap_changed
expr_stmt|;
name|klass
operator|->
name|undo_event
operator|=
name|NULL
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_GIMP
argument_list|,
name|g_param_spec_object
argument_list|(
literal|"gimp"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GIMP_TYPE_GIMP
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT_ONLY
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_ID
argument_list|,
name|g_param_spec_int
argument_list|(
literal|"id"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|,
name|G_MAXINT
argument_list|,
literal|0
argument_list|,
name|GIMP_PARAM_READABLE
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_WIDTH
argument_list|,
name|g_param_spec_int
argument_list|(
literal|"width"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|,
name|GIMP_MAX_IMAGE_SIZE
argument_list|,
literal|1
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_HEIGHT
argument_list|,
name|g_param_spec_int
argument_list|(
literal|"height"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
literal|1
argument_list|,
name|GIMP_MAX_IMAGE_SIZE
argument_list|,
literal|1
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_BASE_TYPE
argument_list|,
name|g_param_spec_enum
argument_list|(
literal|"base-type"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GIMP_TYPE_IMAGE_BASE_TYPE
argument_list|,
name|GIMP_RGB
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_PRECISION
argument_list|,
name|g_param_spec_enum
argument_list|(
literal|"precision"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GIMP_TYPE_PRECISION
argument_list|,
name|GIMP_PRECISION_U8_GAMMA
argument_list|,
name|GIMP_PARAM_READWRITE
operator||
name|G_PARAM_CONSTRUCT
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_install_property
argument_list|(
name|object_class
argument_list|,
name|PROP_METADATA
argument_list|,
name|g_param_spec_object
argument_list|(
literal|"metadata"
argument_list|,
name|NULL
argument_list|,
name|NULL
argument_list|,
name|GEXIV2_TYPE_METADATA
argument_list|,
name|GIMP_PARAM_READABLE
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_class_override_property
argument_list|(
name|object_class
argument_list|,
name|PROP_BUFFER
argument_list|,
literal|"buffer"
argument_list|)
expr_stmt|;
name|g_type_class_add_private
argument_list|(
name|klass
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpImagePrivate
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_color_managed_iface_init (GimpColorManagedInterface * iface)
name|gimp_color_managed_iface_init
parameter_list|(
name|GimpColorManagedInterface
modifier|*
name|iface
parameter_list|)
block|{
name|iface
operator|->
name|get_icc_profile
operator|=
name|gimp_image_color_managed_get_icc_profile
expr_stmt|;
name|iface
operator|->
name|get_color_profile
operator|=
name|gimp_image_color_managed_get_color_profile
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_projectable_iface_init (GimpProjectableInterface * iface)
name|gimp_projectable_iface_init
parameter_list|(
name|GimpProjectableInterface
modifier|*
name|iface
parameter_list|)
block|{
name|iface
operator|->
name|flush
operator|=
name|gimp_image_projectable_flush
expr_stmt|;
name|iface
operator|->
name|get_image
operator|=
name|gimp_image_get_image
expr_stmt|;
name|iface
operator|->
name|get_format
operator|=
name|gimp_image_get_proj_format
expr_stmt|;
name|iface
operator|->
name|get_size
operator|=
operator|(
name|void
argument_list|(
operator|*
argument_list|)
argument_list|(
name|GimpProjectable
operator|*
argument_list|,
name|gint
operator|*
argument_list|,
name|gint
operator|*
argument_list|)
operator|)
name|gimp_image_get_size
expr_stmt|;
name|iface
operator|->
name|get_graph
operator|=
name|gimp_image_get_graph
expr_stmt|;
name|iface
operator|->
name|invalidate_preview
operator|=
operator|(
name|void
argument_list|(
operator|*
argument_list|)
argument_list|(
name|GimpProjectable
operator|*
argument_list|)
operator|)
name|gimp_viewable_invalidate_preview
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_pickable_iface_init (GimpPickableInterface * iface)
name|gimp_pickable_iface_init
parameter_list|(
name|GimpPickableInterface
modifier|*
name|iface
parameter_list|)
block|{
name|iface
operator|->
name|flush
operator|=
name|gimp_image_pickable_flush
expr_stmt|;
name|iface
operator|->
name|get_image
operator|=
operator|(
name|GimpImage
operator|*
call|(
modifier|*
call|)
argument_list|(
name|GimpPickable
operator|*
name|pickable
argument_list|)
operator|)
name|gimp_image_get_image
expr_stmt|;
name|iface
operator|->
name|get_format
operator|=
operator|(
specifier|const
name|Babl
operator|*
call|(
modifier|*
call|)
argument_list|(
name|GimpPickable
operator|*
name|pickable
argument_list|)
operator|)
name|gimp_image_get_proj_format
expr_stmt|;
name|iface
operator|->
name|get_format_with_alpha
operator|=
operator|(
specifier|const
name|Babl
operator|*
call|(
modifier|*
call|)
argument_list|(
name|GimpPickable
operator|*
name|pickable
argument_list|)
operator|)
name|gimp_image_get_proj_format
expr_stmt|;
name|iface
operator|->
name|get_buffer
operator|=
name|gimp_image_get_buffer
expr_stmt|;
name|iface
operator|->
name|get_pixel_at
operator|=
name|gimp_image_get_pixel_at
expr_stmt|;
name|iface
operator|->
name|get_opacity_at
operator|=
name|gimp_image_get_opacity_at
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_init (GimpImage * image)
name|gimp_image_init
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|private
operator|->
name|ID
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|load_proc
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|save_proc
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|width
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|height
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|xresolution
operator|=
literal|1.0
expr_stmt|;
name|private
operator|->
name|yresolution
operator|=
literal|1.0
expr_stmt|;
name|private
operator|->
name|resolution_unit
operator|=
name|GIMP_UNIT_INCH
expr_stmt|;
name|private
operator|->
name|base_type
operator|=
name|GIMP_RGB
expr_stmt|;
name|private
operator|->
name|precision
operator|=
name|GIMP_PRECISION_U8_GAMMA
expr_stmt|;
name|private
operator|->
name|colormap
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|n_colors
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|palette
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|metadata
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|dirty
operator|=
literal|1
expr_stmt|;
name|private
operator|->
name|dirty_time
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|undo_freeze_count
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|export_dirty
operator|=
literal|1
expr_stmt|;
name|private
operator|->
name|instance_count
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|disp_count
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|tattoo_state
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|projection
operator|=
name|gimp_projection_new
argument_list|(
name|GIMP_PROJECTABLE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|->
name|guides
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|grid
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|sample_points
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|layers
operator|=
name|gimp_item_tree_new
argument_list|(
name|image
argument_list|,
name|GIMP_TYPE_DRAWABLE_STACK
argument_list|,
name|GIMP_TYPE_LAYER
argument_list|)
expr_stmt|;
name|private
operator|->
name|channels
operator|=
name|gimp_item_tree_new
argument_list|(
name|image
argument_list|,
name|GIMP_TYPE_DRAWABLE_STACK
argument_list|,
name|GIMP_TYPE_CHANNEL
argument_list|)
expr_stmt|;
name|private
operator|->
name|vectors
operator|=
name|gimp_item_tree_new
argument_list|(
name|image
argument_list|,
name|GIMP_TYPE_ITEM_STACK
argument_list|,
name|GIMP_TYPE_VECTORS
argument_list|)
expr_stmt|;
name|private
operator|->
name|layer_stack
operator|=
name|NULL
expr_stmt|;
name|g_signal_connect
argument_list|(
name|private
operator|->
name|layers
argument_list|,
literal|"notify::active-item"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_active_layer_notify
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|private
operator|->
name|channels
argument_list|,
literal|"notify::active-item"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_active_channel_notify
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|private
operator|->
name|vectors
argument_list|,
literal|"notify::active-item"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_active_vectors_notify
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|,
literal|"update"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_invalidate
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|layer_alpha_handler
operator|=
name|gimp_container_add_handler
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|,
literal|"alpha-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_layer_alpha_changed
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
literal|"update"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_invalidate
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|channel_name_changed_handler
operator|=
name|gimp_container_add_handler
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
literal|"name-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_channel_name_changed
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|channel_color_changed_handler
operator|=
name|gimp_container_add_handler
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
literal|"color-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_channel_color_changed
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
literal|"add"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_channel_add
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
literal|"remove"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_channel_remove
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|floating_sel
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|selection_mask
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|parasites
operator|=
name|gimp_parasite_list_new
argument_list|()
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_CHANNELS
condition|;
name|i
operator|++
control|)
block|{
name|private
operator|->
name|visible
index|[
name|i
index|]
operator|=
name|TRUE
expr_stmt|;
name|private
operator|->
name|active
index|[
name|i
index|]
operator|=
name|TRUE
expr_stmt|;
block|}
name|private
operator|->
name|quick_mask_state
operator|=
name|FALSE
expr_stmt|;
name|private
operator|->
name|quick_mask_inverted
operator|=
name|FALSE
expr_stmt|;
name|gimp_rgba_set
argument_list|(
operator|&
name|private
operator|->
name|quick_mask_color
argument_list|,
literal|1.0
argument_list|,
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|private
operator|->
name|undo_stack
operator|=
name|gimp_undo_stack_new
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|redo_stack
operator|=
name|gimp_undo_stack_new
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|group_count
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|pushing_undo_group
operator|=
name|GIMP_UNDO_GROUP_NONE
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|alpha_changed
operator|=
name|FALSE
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|mask_changed
operator|=
name|FALSE
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|floating_selection_changed
operator|=
name|FALSE
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|preview_invalidated
operator|=
name|FALSE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_constructed (GObject * object)
name|gimp_image_constructed
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|GimpChannel
modifier|*
name|selection
decl_stmt|;
name|GimpCoreConfig
modifier|*
name|config
decl_stmt|;
name|GimpTemplate
modifier|*
name|template
decl_stmt|;
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|constructed
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|g_assert
argument_list|(
name|GIMP_IS_GIMP
argument_list|(
name|image
operator|->
name|gimp
argument_list|)
argument_list|)
expr_stmt|;
name|config
operator|=
name|image
operator|->
name|gimp
operator|->
name|config
expr_stmt|;
name|private
operator|->
name|ID
operator|=
name|gimp_id_table_insert
argument_list|(
name|image
operator|->
name|gimp
operator|->
name|image_table
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|template
operator|=
name|config
operator|->
name|default_image
expr_stmt|;
name|private
operator|->
name|xresolution
operator|=
name|gimp_template_get_resolution_x
argument_list|(
name|template
argument_list|)
expr_stmt|;
name|private
operator|->
name|yresolution
operator|=
name|gimp_template_get_resolution_y
argument_list|(
name|template
argument_list|)
expr_stmt|;
name|private
operator|->
name|resolution_unit
operator|=
name|gimp_template_get_resolution_unit
argument_list|(
name|template
argument_list|)
expr_stmt|;
name|private
operator|->
name|grid
operator|=
name|gimp_config_duplicate
argument_list|(
name|GIMP_CONFIG
argument_list|(
name|config
operator|->
name|default_grid
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|->
name|quick_mask_color
operator|=
name|config
operator|->
name|quick_mask_color
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|base_type
operator|==
name|GIMP_INDEXED
condition|)
name|gimp_image_colormap_init
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|selection
operator|=
name|gimp_selection_new
argument_list|(
name|image
argument_list|,
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_image_take_mask
argument_list|(
name|image
argument_list|,
name|selection
argument_list|)
expr_stmt|;
name|g_signal_connect_object
argument_list|(
name|config
argument_list|,
literal|"notify::transparency-type"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_item_stack_invalidate_previews
argument_list|)
argument_list|,
name|private
operator|->
name|layers
operator|->
name|container
argument_list|,
name|G_CONNECT_SWAPPED
argument_list|)
expr_stmt|;
name|g_signal_connect_object
argument_list|(
name|config
argument_list|,
literal|"notify::transparency-size"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_item_stack_invalidate_previews
argument_list|)
argument_list|,
name|private
operator|->
name|layers
operator|->
name|container
argument_list|,
name|G_CONNECT_SWAPPED
argument_list|)
expr_stmt|;
name|g_signal_connect_object
argument_list|(
name|config
argument_list|,
literal|"notify::layer-previews"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_viewable_size_changed
argument_list|)
argument_list|,
name|image
argument_list|,
name|G_CONNECT_SWAPPED
argument_list|)
expr_stmt|;
name|gimp_container_add
argument_list|(
name|image
operator|->
name|gimp
operator|->
name|images
argument_list|,
name|GIMP_OBJECT
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_set_property (GObject * object,guint property_id,const GValue * value,GParamSpec * pspec)
name|gimp_image_set_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
specifier|const
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|property_id
condition|)
block|{
case|case
name|PROP_GIMP
case|:
name|image
operator|->
name|gimp
operator|=
name|g_value_get_object
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_ID
case|:
name|g_assert_not_reached
argument_list|()
expr_stmt|;
break|break;
case|case
name|PROP_WIDTH
case|:
name|private
operator|->
name|width
operator|=
name|g_value_get_int
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HEIGHT
case|:
name|private
operator|->
name|height
operator|=
name|g_value_get_int
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_BASE_TYPE
case|:
name|private
operator|->
name|base_type
operator|=
name|g_value_get_enum
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_PRECISION
case|:
name|private
operator|->
name|precision
operator|=
name|g_value_get_enum
argument_list|(
name|value
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_METADATA
case|:
case|case
name|PROP_BUFFER
case|:
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|property_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_get_property (GObject * object,guint property_id,GValue * value,GParamSpec * pspec)
name|gimp_image_get_property
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|,
name|guint
name|property_id
parameter_list|,
name|GValue
modifier|*
name|value
parameter_list|,
name|GParamSpec
modifier|*
name|pspec
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|property_id
condition|)
block|{
case|case
name|PROP_GIMP
case|:
name|g_value_set_object
argument_list|(
name|value
argument_list|,
name|image
operator|->
name|gimp
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_ID
case|:
name|g_value_set_int
argument_list|(
name|value
argument_list|,
name|private
operator|->
name|ID
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_WIDTH
case|:
name|g_value_set_int
argument_list|(
name|value
argument_list|,
name|private
operator|->
name|width
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_HEIGHT
case|:
name|g_value_set_int
argument_list|(
name|value
argument_list|,
name|private
operator|->
name|height
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_BASE_TYPE
case|:
name|g_value_set_enum
argument_list|(
name|value
argument_list|,
name|private
operator|->
name|base_type
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_PRECISION
case|:
name|g_value_set_enum
argument_list|(
name|value
argument_list|,
name|private
operator|->
name|precision
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_METADATA
case|:
name|g_value_set_object
argument_list|(
name|value
argument_list|,
name|gimp_image_get_metadata
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PROP_BUFFER
case|:
name|g_value_set_object
argument_list|(
name|value
argument_list|,
name|gimp_image_get_buffer
argument_list|(
name|GIMP_PICKABLE
argument_list|(
name|image
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|G_OBJECT_WARN_INVALID_PROPERTY_ID
argument_list|(
name|object
argument_list|,
name|property_id
argument_list|,
name|pspec
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_dispose (GObject * object)
name|gimp_image_dispose
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
name|private
operator|->
name|colormap
condition|)
name|gimp_image_colormap_dispose
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_image_undo_free
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|,
name|gimp_image_invalidate
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|gimp_container_remove_handler
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|,
name|private
operator|->
name|layer_alpha_handler
argument_list|)
expr_stmt|;
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
name|gimp_image_invalidate
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|gimp_container_remove_handler
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
name|private
operator|->
name|channel_name_changed_handler
argument_list|)
expr_stmt|;
name|gimp_container_remove_handler
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
name|private
operator|->
name|channel_color_changed_handler
argument_list|)
expr_stmt|;
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
name|gimp_image_channel_add
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|g_signal_handlers_disconnect_by_func
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
name|gimp_image_channel_remove
argument_list|,
name|image
argument_list|)
expr_stmt|;
name|gimp_container_foreach
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|,
operator|(
name|GFunc
operator|)
name|gimp_item_removed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_container_foreach
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|,
operator|(
name|GFunc
operator|)
name|gimp_item_removed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_container_foreach
argument_list|(
name|private
operator|->
name|vectors
operator|->
name|container
argument_list|,
operator|(
name|GFunc
operator|)
name|gimp_item_removed
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|dispose
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_finalize (GObject * object)
name|gimp_image_finalize
parameter_list|(
name|GObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
name|private
operator|->
name|projection
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|projection
argument_list|)
expr_stmt|;
name|private
operator|->
name|projection
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|graph
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|graph
argument_list|)
expr_stmt|;
name|private
operator|->
name|graph
operator|=
name|NULL
expr_stmt|;
name|private
operator|->
name|visible_mask
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|colormap
condition|)
name|gimp_image_colormap_free
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|metadata
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|metadata
argument_list|)
expr_stmt|;
name|private
operator|->
name|metadata
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|file
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|file
argument_list|)
expr_stmt|;
name|private
operator|->
name|file
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|imported_file
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|imported_file
argument_list|)
expr_stmt|;
name|private
operator|->
name|imported_file
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|exported_file
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|exported_file
argument_list|)
expr_stmt|;
name|private
operator|->
name|exported_file
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|save_a_copy_file
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|save_a_copy_file
argument_list|)
expr_stmt|;
name|private
operator|->
name|save_a_copy_file
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|untitled_file
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|untitled_file
argument_list|)
expr_stmt|;
name|private
operator|->
name|untitled_file
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|layers
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|layers
argument_list|)
expr_stmt|;
name|private
operator|->
name|layers
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|channels
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|channels
argument_list|)
expr_stmt|;
name|private
operator|->
name|channels
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|vectors
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|vectors
argument_list|)
expr_stmt|;
name|private
operator|->
name|vectors
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|layer_stack
condition|)
block|{
name|g_slist_free
argument_list|(
name|private
operator|->
name|layer_stack
argument_list|)
expr_stmt|;
name|private
operator|->
name|layer_stack
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|selection_mask
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|selection_mask
argument_list|)
expr_stmt|;
name|private
operator|->
name|selection_mask
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|parasites
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|parasites
argument_list|)
expr_stmt|;
name|private
operator|->
name|parasites
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|guides
condition|)
block|{
name|g_list_free_full
argument_list|(
name|private
operator|->
name|guides
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|g_object_unref
argument_list|)
expr_stmt|;
name|private
operator|->
name|guides
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|grid
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|grid
argument_list|)
expr_stmt|;
name|private
operator|->
name|grid
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|sample_points
condition|)
block|{
name|g_list_free_full
argument_list|(
name|private
operator|->
name|sample_points
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|gimp_sample_point_unref
argument_list|)
expr_stmt|;
name|private
operator|->
name|sample_points
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|undo_stack
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|undo_stack
argument_list|)
expr_stmt|;
name|private
operator|->
name|undo_stack
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|redo_stack
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|redo_stack
argument_list|)
expr_stmt|;
name|private
operator|->
name|redo_stack
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|image
operator|->
name|gimp
operator|&&
name|image
operator|->
name|gimp
operator|->
name|image_table
condition|)
block|{
name|gimp_id_table_remove
argument_list|(
name|image
operator|->
name|gimp
operator|->
name|image_table
argument_list|,
name|private
operator|->
name|ID
argument_list|)
expr_stmt|;
name|image
operator|->
name|gimp
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|display_name
condition|)
block|{
name|g_free
argument_list|(
name|private
operator|->
name|display_name
argument_list|)
expr_stmt|;
name|private
operator|->
name|display_name
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|display_path
condition|)
block|{
name|g_free
argument_list|(
name|private
operator|->
name|display_path
argument_list|)
expr_stmt|;
name|private
operator|->
name|display_path
operator|=
name|NULL
expr_stmt|;
block|}
name|G_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|finalize
argument_list|(
name|object
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_name_changed (GimpObject * object)
name|gimp_image_name_changed
parameter_list|(
name|GimpObject
modifier|*
name|object
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|name
decl_stmt|;
if|if
condition|(
name|GIMP_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|name_changed
condition|)
name|GIMP_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|name_changed
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|display_name
condition|)
block|{
name|g_free
argument_list|(
name|private
operator|->
name|display_name
argument_list|)
expr_stmt|;
name|private
operator|->
name|display_name
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|display_path
condition|)
block|{
name|g_free
argument_list|(
name|private
operator|->
name|display_path
argument_list|)
expr_stmt|;
name|private
operator|->
name|display_path
operator|=
name|NULL
expr_stmt|;
block|}
comment|/* We never want the empty string as a name, so change empty strings    * to NULL strings (without emitting the "name-changed" signal    * again)    */
name|name
operator|=
name|gimp_object_get_name
argument_list|(
name|object
argument_list|)
expr_stmt|;
if|if
condition|(
name|name
operator|&&
name|strlen
argument_list|(
name|name
argument_list|)
operator|==
literal|0
condition|)
block|{
name|gimp_object_name_free
argument_list|(
name|object
argument_list|)
expr_stmt|;
name|name
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|file
condition|)
block|{
name|g_object_unref
argument_list|(
name|private
operator|->
name|file
argument_list|)
expr_stmt|;
name|private
operator|->
name|file
operator|=
name|NULL
expr_stmt|;
block|}
if|if
condition|(
name|name
condition|)
name|private
operator|->
name|file
operator|=
name|g_file_new_for_uri
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gint64
DECL|function|gimp_image_get_memsize (GimpObject * object,gint64 * gui_size)
name|gimp_image_get_memsize
parameter_list|(
name|GimpObject
modifier|*
name|object
parameter_list|,
name|gint64
modifier|*
name|gui_size
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|object
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|gint64
name|memsize
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|gimp_image_get_colormap
argument_list|(
name|image
argument_list|)
condition|)
name|memsize
operator|+=
name|GIMP_IMAGE_COLORMAP_SIZE
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|palette
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|projection
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_g_list_get_memsize
argument_list|(
name|gimp_image_get_guides
argument_list|(
name|image
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpGuide
argument_list|)
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|grid
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_g_list_get_memsize
argument_list|(
name|gimp_image_get_sample_points
argument_list|(
name|image
argument_list|)
argument_list|,
sizeof|sizeof
argument_list|(
name|GimpSamplePoint
argument_list|)
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|layers
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|channels
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|vectors
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_g_slist_get_memsize
argument_list|(
name|private
operator|->
name|layer_stack
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|selection_mask
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|parasites
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|undo_stack
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
name|memsize
operator|+=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|private
operator|->
name|redo_stack
argument_list|)
argument_list|,
name|gui_size
argument_list|)
expr_stmt|;
return|return
name|memsize
operator|+
name|GIMP_OBJECT_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|get_memsize
argument_list|(
name|object
argument_list|,
name|gui_size
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_image_get_size (GimpViewable * viewable,gint * width,gint * height)
name|gimp_image_get_size
parameter_list|(
name|GimpViewable
modifier|*
name|viewable
parameter_list|,
name|gint
modifier|*
name|width
parameter_list|,
name|gint
modifier|*
name|height
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|viewable
argument_list|)
decl_stmt|;
operator|*
name|width
operator|=
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
expr_stmt|;
operator|*
name|height
operator|=
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_size_changed (GimpViewable * viewable)
name|gimp_image_size_changed
parameter_list|(
name|GimpViewable
modifier|*
name|viewable
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|viewable
argument_list|)
decl_stmt|;
name|GimpMetadata
modifier|*
name|metadata
decl_stmt|;
name|GList
modifier|*
name|all_items
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
if|if
condition|(
name|GIMP_VIEWABLE_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|size_changed
condition|)
name|GIMP_VIEWABLE_CLASS
argument_list|(
name|parent_class
argument_list|)
operator|->
name|size_changed
argument_list|(
name|viewable
argument_list|)
expr_stmt|;
name|all_items
operator|=
name|gimp_image_get_layer_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|all_items
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpLayerMask
modifier|*
name|mask
init|=
name|gimp_layer_get_mask
argument_list|(
name|GIMP_LAYER
argument_list|(
name|list
operator|->
name|data
argument_list|)
argument_list|)
decl_stmt|;
name|gimp_viewable_size_changed
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|list
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|mask
condition|)
name|gimp_viewable_size_changed
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|mask
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|all_items
argument_list|)
expr_stmt|;
name|all_items
operator|=
name|gimp_image_get_channel_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_list_free_full
argument_list|(
name|all_items
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|gimp_viewable_size_changed
argument_list|)
expr_stmt|;
name|all_items
operator|=
name|gimp_image_get_vectors_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_list_free_full
argument_list|(
name|all_items
argument_list|,
operator|(
name|GDestroyNotify
operator|)
name|gimp_viewable_size_changed
argument_list|)
expr_stmt|;
name|gimp_viewable_size_changed
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|gimp_image_get_mask
argument_list|(
name|image
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|metadata
operator|=
name|gimp_image_get_metadata
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|metadata
condition|)
name|gimp_metadata_set_pixel_size
argument_list|(
name|metadata
argument_list|,
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_projectable_structure_changed
argument_list|(
name|GIMP_PROJECTABLE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|gimp_image_get_description (GimpViewable * viewable,gchar ** tooltip)
name|gimp_image_get_description
parameter_list|(
name|GimpViewable
modifier|*
name|viewable
parameter_list|,
name|gchar
modifier|*
modifier|*
name|tooltip
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|viewable
argument_list|)
decl_stmt|;
if|if
condition|(
name|tooltip
condition|)
operator|*
name|tooltip
operator|=
name|g_strdup
argument_list|(
name|gimp_image_get_display_path
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|g_strdup_printf
argument_list|(
literal|"%s-%d"
argument_list|,
name|gimp_image_get_display_name
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_ID
argument_list|(
name|image
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_real_mode_changed (GimpImage * image)
name|gimp_image_real_mode_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|gimp_projectable_structure_changed
argument_list|(
name|GIMP_PROJECTABLE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_real_precision_changed (GimpImage * image)
name|gimp_image_real_precision_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpMetadata
modifier|*
name|metadata
decl_stmt|;
name|metadata
operator|=
name|gimp_image_get_metadata
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|metadata
condition|)
block|{
switch|switch
condition|(
name|gimp_image_get_component_type
argument_list|(
name|image
argument_list|)
condition|)
block|{
case|case
name|GIMP_COMPONENT_TYPE_U8
case|:
name|gimp_metadata_set_bits_per_sample
argument_list|(
name|metadata
argument_list|,
literal|8
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_COMPONENT_TYPE_U16
case|:
case|case
name|GIMP_COMPONENT_TYPE_HALF
case|:
name|gimp_metadata_set_bits_per_sample
argument_list|(
name|metadata
argument_list|,
literal|16
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_COMPONENT_TYPE_U32
case|:
case|case
name|GIMP_COMPONENT_TYPE_FLOAT
case|:
name|gimp_metadata_set_bits_per_sample
argument_list|(
name|metadata
argument_list|,
literal|32
argument_list|)
expr_stmt|;
break|break;
case|case
name|GIMP_COMPONENT_TYPE_DOUBLE
case|:
name|gimp_metadata_set_bits_per_sample
argument_list|(
name|metadata
argument_list|,
literal|64
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|gimp_projectable_structure_changed
argument_list|(
name|GIMP_PROJECTABLE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_real_resolution_changed (GimpImage * image)
name|gimp_image_real_resolution_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpMetadata
modifier|*
name|metadata
decl_stmt|;
name|metadata
operator|=
name|gimp_image_get_metadata
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|metadata
condition|)
block|{
name|gdouble
name|xres
decl_stmt|,
name|yres
decl_stmt|;
name|gimp_image_get_resolution
argument_list|(
name|image
argument_list|,
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|gimp_metadata_set_resolution
argument_list|(
name|metadata
argument_list|,
name|xres
argument_list|,
name|yres
argument_list|,
name|gimp_image_get_unit
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_real_size_changed_detailed (GimpImage * image,gint previous_origin_x,gint previous_origin_y,gint previous_width,gint previous_height)
name|gimp_image_real_size_changed_detailed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|previous_origin_x
parameter_list|,
name|gint
name|previous_origin_y
parameter_list|,
name|gint
name|previous_width
parameter_list|,
name|gint
name|previous_height
parameter_list|)
block|{
comment|/* Whenever GimpImage::size-changed-detailed is emitted, so is    * GimpViewable::size-changed. Clients choose what signal to listen    * to depending on how much info they need.    */
name|gimp_viewable_size_changed
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_real_unit_changed (GimpImage * image)
name|gimp_image_real_unit_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpMetadata
modifier|*
name|metadata
decl_stmt|;
name|metadata
operator|=
name|gimp_image_get_metadata
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|metadata
condition|)
block|{
name|gdouble
name|xres
decl_stmt|,
name|yres
decl_stmt|;
name|gimp_image_get_resolution
argument_list|(
name|image
argument_list|,
operator|&
name|xres
argument_list|,
operator|&
name|yres
argument_list|)
expr_stmt|;
name|gimp_metadata_set_resolution
argument_list|(
name|metadata
argument_list|,
name|xres
argument_list|,
name|yres
argument_list|,
name|gimp_image_get_unit
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_real_colormap_changed (GimpImage * image,gint color_index)
name|gimp_image_real_colormap_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|color_index
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
name|private
operator|->
name|colormap
operator|&&
name|private
operator|->
name|n_colors
operator|>
literal|0
condition|)
block|{
name|babl_palette_set_palette
argument_list|(
name|private
operator|->
name|babl_palette_rgb
argument_list|,
name|gimp_babl_format
argument_list|(
name|GIMP_RGB
argument_list|,
name|private
operator|->
name|precision
argument_list|,
name|FALSE
argument_list|)
argument_list|,
name|private
operator|->
name|colormap
argument_list|,
name|private
operator|->
name|n_colors
argument_list|)
expr_stmt|;
name|babl_palette_set_palette
argument_list|(
name|private
operator|->
name|babl_palette_rgba
argument_list|,
name|gimp_babl_format
argument_list|(
name|GIMP_RGB
argument_list|,
name|private
operator|->
name|precision
argument_list|,
name|FALSE
argument_list|)
argument_list|,
name|private
operator|->
name|colormap
argument_list|,
name|private
operator|->
name|n_colors
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|gimp_image_get_base_type
argument_list|(
name|image
argument_list|)
operator|==
name|GIMP_INDEXED
condition|)
block|{
comment|/* A colormap alteration affects the whole image */
name|gimp_image_invalidate
argument_list|(
name|image
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_item_stack_invalidate_previews
argument_list|(
name|GIMP_ITEM_STACK
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
specifier|const
name|guint8
modifier|*
DECL|function|gimp_image_color_managed_get_icc_profile (GimpColorManaged * managed,gsize * len)
name|gimp_image_color_managed_get_icc_profile
parameter_list|(
name|GimpColorManaged
modifier|*
name|managed
parameter_list|,
name|gsize
modifier|*
name|len
parameter_list|)
block|{
specifier|const
name|GimpParasite
modifier|*
name|parasite
decl_stmt|;
name|parasite
operator|=
name|gimp_image_get_icc_profile
argument_list|(
name|GIMP_IMAGE
argument_list|(
name|managed
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|parasite
condition|)
block|{
name|gsize
name|data_size
init|=
name|gimp_parasite_data_size
argument_list|(
name|parasite
argument_list|)
decl_stmt|;
if|if
condition|(
name|data_size
operator|>
literal|0
condition|)
block|{
operator|*
name|len
operator|=
name|data_size
expr_stmt|;
return|return
name|gimp_parasite_data
argument_list|(
name|parasite
argument_list|)
return|;
block|}
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|GimpColorProfile
DECL|function|gimp_image_color_managed_get_color_profile (GimpColorManaged * managed)
name|gimp_image_color_managed_get_color_profile
parameter_list|(
name|GimpColorManaged
modifier|*
name|managed
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|managed
argument_list|)
decl_stmt|;
name|GimpColorProfile
name|profile
decl_stmt|;
name|profile
operator|=
name|gimp_image_get_color_profile
argument_list|(
name|image
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|profile
condition|)
block|{
name|GimpColorConfig
modifier|*
name|config
init|=
name|image
operator|->
name|gimp
operator|->
name|config
operator|->
name|color_management
decl_stmt|;
name|profile
operator|=
name|gimp_color_config_get_rgb_profile
argument_list|(
name|config
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|profile
condition|)
block|{
specifier|const
name|Babl
modifier|*
name|format
init|=
name|gimp_image_get_layer_format
argument_list|(
name|image
argument_list|,
name|FALSE
argument_list|)
decl_stmt|;
if|if
condition|(
name|gimp_babl_format_get_linear
argument_list|(
name|format
argument_list|)
condition|)
name|profile
operator|=
name|gimp_color_profile_new_linear_rgb
argument_list|()
expr_stmt|;
else|else
name|profile
operator|=
name|gimp_color_profile_new_srgb
argument_list|()
expr_stmt|;
block|}
return|return
name|profile
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_projectable_flush (GimpProjectable * projectable,gboolean invalidate_preview)
name|gimp_image_projectable_flush
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|,
name|gboolean
name|invalidate_preview
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|projectable
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
name|private
operator|->
name|flush_accum
operator|.
name|alpha_changed
condition|)
block|{
name|gimp_image_alpha_changed
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|alpha_changed
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|flush_accum
operator|.
name|mask_changed
condition|)
block|{
name|gimp_image_mask_changed
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|mask_changed
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|flush_accum
operator|.
name|floating_selection_changed
condition|)
block|{
name|gimp_image_floating_selection_changed
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|floating_selection_changed
operator|=
name|FALSE
expr_stmt|;
block|}
if|if
condition|(
name|private
operator|->
name|flush_accum
operator|.
name|preview_invalidated
condition|)
block|{
comment|/*  don't invalidate the preview here, the projection does this when        *  it is completely constructed.        */
name|private
operator|->
name|flush_accum
operator|.
name|preview_invalidated
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|GimpImage
modifier|*
DECL|function|gimp_image_get_image (GimpProjectable * projectable)
name|gimp_image_get_image
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|)
block|{
return|return
name|GIMP_IMAGE
argument_list|(
name|projectable
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
specifier|const
name|Babl
modifier|*
DECL|function|gimp_image_get_proj_format (GimpProjectable * projectable)
name|gimp_image_get_proj_format
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|projectable
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|private
operator|->
name|base_type
condition|)
block|{
case|case
name|GIMP_RGB
case|:
case|case
name|GIMP_INDEXED
case|:
return|return
name|gimp_image_get_format
argument_list|(
name|image
argument_list|,
name|GIMP_RGB
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|TRUE
argument_list|)
return|;
case|case
name|GIMP_GRAY
case|:
return|return
name|gimp_image_get_format
argument_list|(
name|image
argument_list|,
name|GIMP_GRAY
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|TRUE
argument_list|)
return|;
block|}
name|g_assert_not_reached
argument_list|()
expr_stmt|;
return|return
name|NULL
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_pickable_flush (GimpPickable * pickable)
name|gimp_image_pickable_flush
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|pickable
argument_list|)
decl_stmt|;
return|return
name|gimp_pickable_flush
argument_list|(
name|GIMP_PICKABLE
argument_list|(
name|private
operator|->
name|projection
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|GeglBuffer
modifier|*
DECL|function|gimp_image_get_buffer (GimpPickable * pickable)
name|gimp_image_get_buffer
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|pickable
argument_list|)
decl_stmt|;
return|return
name|gimp_pickable_get_buffer
argument_list|(
name|GIMP_PICKABLE
argument_list|(
name|private
operator|->
name|projection
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gboolean
DECL|function|gimp_image_get_pixel_at (GimpPickable * pickable,gint x,gint y,const Babl * format,gpointer pixel)
name|gimp_image_get_pixel_at
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
specifier|const
name|Babl
modifier|*
name|format
parameter_list|,
name|gpointer
name|pixel
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|pickable
argument_list|)
decl_stmt|;
return|return
name|gimp_pickable_get_pixel_at
argument_list|(
name|GIMP_PICKABLE
argument_list|(
name|private
operator|->
name|projection
argument_list|)
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|format
argument_list|,
name|pixel
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gdouble
DECL|function|gimp_image_get_opacity_at (GimpPickable * pickable,gint x,gint y)
name|gimp_image_get_opacity_at
parameter_list|(
name|GimpPickable
modifier|*
name|pickable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|pickable
argument_list|)
decl_stmt|;
return|return
name|gimp_pickable_get_opacity_at
argument_list|(
name|GIMP_PICKABLE
argument_list|(
name|private
operator|->
name|projection
argument_list|)
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|GeglNode
modifier|*
DECL|function|gimp_image_get_graph (GimpProjectable * projectable)
name|gimp_image_get_graph
parameter_list|(
name|GimpProjectable
modifier|*
name|projectable
parameter_list|)
block|{
name|GimpImage
modifier|*
name|image
init|=
name|GIMP_IMAGE
argument_list|(
name|projectable
argument_list|)
decl_stmt|;
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|GeglNode
modifier|*
name|layers_node
decl_stmt|;
name|GeglNode
modifier|*
name|channels_node
decl_stmt|;
name|GeglNode
modifier|*
name|output
decl_stmt|;
name|GimpComponentMask
name|mask
decl_stmt|;
if|if
condition|(
name|private
operator|->
name|graph
condition|)
return|return
name|private
operator|->
name|graph
return|;
name|private
operator|->
name|graph
operator|=
name|gegl_node_new
argument_list|()
expr_stmt|;
name|layers_node
operator|=
name|gimp_filter_stack_get_graph
argument_list|(
name|GIMP_FILTER_STACK
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|)
argument_list|)
expr_stmt|;
name|gegl_node_add_child
argument_list|(
name|private
operator|->
name|graph
argument_list|,
name|layers_node
argument_list|)
expr_stmt|;
name|channels_node
operator|=
name|gimp_filter_stack_get_graph
argument_list|(
name|GIMP_FILTER_STACK
argument_list|(
name|private
operator|->
name|channels
operator|->
name|container
argument_list|)
argument_list|)
expr_stmt|;
name|gegl_node_add_child
argument_list|(
name|private
operator|->
name|graph
argument_list|,
name|channels_node
argument_list|)
expr_stmt|;
name|gegl_node_connect_to
argument_list|(
name|layers_node
argument_list|,
literal|"output"
argument_list|,
name|channels_node
argument_list|,
literal|"input"
argument_list|)
expr_stmt|;
name|mask
operator|=
operator|~
name|gimp_image_get_visible_mask
argument_list|(
name|image
argument_list|)
operator|&
name|GIMP_COMPONENT_ALL
expr_stmt|;
name|private
operator|->
name|visible_mask
operator|=
name|gegl_node_new_child
argument_list|(
name|private
operator|->
name|graph
argument_list|,
literal|"operation"
argument_list|,
literal|"gimp:mask-components"
argument_list|,
literal|"mask"
argument_list|,
name|mask
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gegl_node_connect_to
argument_list|(
name|channels_node
argument_list|,
literal|"output"
argument_list|,
name|private
operator|->
name|visible_mask
argument_list|,
literal|"input"
argument_list|)
expr_stmt|;
name|output
operator|=
name|gegl_node_get_output_proxy
argument_list|(
name|private
operator|->
name|graph
argument_list|,
literal|"output"
argument_list|)
expr_stmt|;
name|gegl_node_connect_to
argument_list|(
name|private
operator|->
name|visible_mask
argument_list|,
literal|"output"
argument_list|,
name|output
argument_list|,
literal|"input"
argument_list|)
expr_stmt|;
return|return
name|private
operator|->
name|graph
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_mask_update (GimpDrawable * drawable,gint x,gint y,gint width,gint height,GimpImage * image)
name|gimp_image_mask_update
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|flush_accum
operator|.
name|mask_changed
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_layer_alpha_changed (GimpDrawable * drawable,GimpImage * image)
name|gimp_image_layer_alpha_changed
parameter_list|(
name|GimpDrawable
modifier|*
name|drawable
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
name|gimp_container_get_n_children
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|)
operator|==
literal|1
condition|)
name|private
operator|->
name|flush_accum
operator|.
name|alpha_changed
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_channel_add (GimpContainer * container,GimpChannel * channel,GimpImage * image)
name|gimp_image_channel_add
parameter_list|(
name|GimpContainer
modifier|*
name|container
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|GIMP_IMAGE_QUICK_MASK_NAME
argument_list|,
name|gimp_object_get_name
argument_list|(
name|channel
argument_list|)
argument_list|)
condition|)
block|{
name|gimp_image_set_quick_mask_state
argument_list|(
name|image
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_channel_remove (GimpContainer * container,GimpChannel * channel,GimpImage * image)
name|gimp_image_channel_remove
parameter_list|(
name|GimpContainer
modifier|*
name|container
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|GIMP_IMAGE_QUICK_MASK_NAME
argument_list|,
name|gimp_object_get_name
argument_list|(
name|channel
argument_list|)
argument_list|)
condition|)
block|{
name|gimp_image_set_quick_mask_state
argument_list|(
name|image
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_channel_name_changed (GimpChannel * channel,GimpImage * image)
name|gimp_image_channel_name_changed
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|GIMP_IMAGE_QUICK_MASK_NAME
argument_list|,
name|gimp_object_get_name
argument_list|(
name|channel
argument_list|)
argument_list|)
condition|)
block|{
name|gimp_image_set_quick_mask_state
argument_list|(
name|image
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|gimp_image_get_quick_mask_state
argument_list|(
name|image
argument_list|)
operator|&&
operator|!
name|gimp_image_get_quick_mask
argument_list|(
name|image
argument_list|)
condition|)
block|{
name|gimp_image_set_quick_mask_state
argument_list|(
name|image
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_channel_color_changed (GimpChannel * channel,GimpImage * image)
name|gimp_image_channel_color_changed
parameter_list|(
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|GIMP_IMAGE_QUICK_MASK_NAME
argument_list|,
name|gimp_object_get_name
argument_list|(
name|channel
argument_list|)
argument_list|)
condition|)
block|{
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|quick_mask_color
operator|=
name|channel
operator|->
name|color
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_active_layer_notify (GimpItemTree * tree,const GParamSpec * pspec,GimpImage * image)
name|gimp_image_active_layer_notify
parameter_list|(
name|GimpItemTree
modifier|*
name|tree
parameter_list|,
specifier|const
name|GParamSpec
modifier|*
name|pspec
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
init|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|GimpLayer
modifier|*
name|layer
init|=
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
name|layer
condition|)
block|{
comment|/*  Configure the layer stack to reflect this change  */
name|private
operator|->
name|layer_stack
operator|=
name|g_slist_remove
argument_list|(
name|private
operator|->
name|layer_stack
argument_list|,
name|layer
argument_list|)
expr_stmt|;
name|private
operator|->
name|layer_stack
operator|=
name|g_slist_prepend
argument_list|(
name|private
operator|->
name|layer_stack
argument_list|,
name|layer
argument_list|)
expr_stmt|;
block|}
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|ACTIVE_LAYER_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|layer
operator|&&
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
condition|)
name|gimp_image_set_active_channel
argument_list|(
name|image
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_active_channel_notify (GimpItemTree * tree,const GParamSpec * pspec,GimpImage * image)
name|gimp_image_active_channel_notify
parameter_list|(
name|GimpItemTree
modifier|*
name|tree
parameter_list|,
specifier|const
name|GParamSpec
modifier|*
name|pspec
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpChannel
modifier|*
name|channel
init|=
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|ACTIVE_CHANNEL_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
operator|&&
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
condition|)
name|gimp_image_set_active_layer
argument_list|(
name|image
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|gimp_image_active_vectors_notify (GimpItemTree * tree,const GParamSpec * pspec,GimpImage * image)
name|gimp_image_active_vectors_notify
parameter_list|(
name|GimpItemTree
modifier|*
name|tree
parameter_list|,
specifier|const
name|GParamSpec
modifier|*
name|pspec
parameter_list|,
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|ACTIVE_VECTORS_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  public functions  */
end_comment

begin_function
name|GimpImage
modifier|*
DECL|function|gimp_image_new (Gimp * gimp,gint width,gint height,GimpImageBaseType base_type,GimpPrecision precision)
name|gimp_image_new
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
name|GimpImageBaseType
name|base_type
parameter_list|,
name|GimpPrecision
name|precision
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_GIMP
argument_list|(
name|gimp
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|base_type
operator|!=
name|GIMP_INDEXED
operator|||
name|precision
operator|==
name|GIMP_PRECISION_U8_GAMMA
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|g_object_new
argument_list|(
name|GIMP_TYPE_IMAGE
argument_list|,
literal|"gimp"
argument_list|,
name|gimp
argument_list|,
literal|"width"
argument_list|,
name|width
argument_list|,
literal|"height"
argument_list|,
name|height
argument_list|,
literal|"base-type"
argument_list|,
name|base_type
argument_list|,
literal|"precision"
argument_list|,
name|precision
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_function

begin_function
name|gint64
DECL|function|gimp_image_estimate_memsize (const GimpImage * image,GimpComponentType component_type,gint width,gint height)
name|gimp_image_estimate_memsize
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpComponentType
name|component_type
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|GList
modifier|*
name|drawables
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gint
name|current_width
decl_stmt|;
name|gint
name|current_height
decl_stmt|;
name|gint64
name|current_size
decl_stmt|;
name|gint64
name|scalable_size
init|=
literal|0
decl_stmt|;
name|gint64
name|scaled_size
init|=
literal|0
decl_stmt|;
name|gint64
name|new_size
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|current_width
operator|=
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|current_height
operator|=
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|current_size
operator|=
name|gimp_object_get_memsize
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
comment|/*  the part of the image's memsize that scales linearly with the image  */
name|drawables
operator|=
name|gimp_image_item_list_get_list
argument_list|(
name|image
argument_list|,
name|NULL
argument_list|,
name|GIMP_ITEM_TYPE_LAYERS
operator||
name|GIMP_ITEM_TYPE_CHANNELS
argument_list|,
name|GIMP_ITEM_SET_ALL
argument_list|)
expr_stmt|;
name|gimp_image_item_list_filter
argument_list|(
name|NULL
argument_list|,
name|drawables
argument_list|,
name|TRUE
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|drawables
operator|=
name|g_list_prepend
argument_list|(
name|drawables
argument_list|,
name|gimp_image_get_mask
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|drawables
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpDrawable
modifier|*
name|drawable
init|=
name|list
operator|->
name|data
decl_stmt|;
name|gdouble
name|drawable_width
decl_stmt|;
name|gdouble
name|drawable_height
decl_stmt|;
name|drawable_width
operator|=
name|gimp_item_get_width
argument_list|(
name|GIMP_ITEM
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
name|drawable_height
operator|=
name|gimp_item_get_height
argument_list|(
name|GIMP_ITEM
argument_list|(
name|drawable
argument_list|)
argument_list|)
expr_stmt|;
name|scalable_size
operator|+=
name|gimp_drawable_estimate_memsize
argument_list|(
name|drawable
argument_list|,
name|gimp_drawable_get_component_type
argument_list|(
name|drawable
argument_list|)
argument_list|,
name|drawable_width
argument_list|,
name|drawable_height
argument_list|)
expr_stmt|;
name|scaled_size
operator|+=
name|gimp_drawable_estimate_memsize
argument_list|(
name|drawable
argument_list|,
name|component_type
argument_list|,
name|drawable_width
operator|*
name|width
operator|/
name|current_width
argument_list|,
name|drawable_height
operator|*
name|height
operator|/
name|current_height
argument_list|)
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|drawables
argument_list|)
expr_stmt|;
name|scalable_size
operator|+=
name|gimp_projection_estimate_memsize
argument_list|(
name|gimp_image_get_base_type
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_component_type
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|scaled_size
operator|+=
name|gimp_projection_estimate_memsize
argument_list|(
name|gimp_image_get_base_type
argument_list|(
name|image
argument_list|)
argument_list|,
name|component_type
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|GIMP_LOG
argument_list|(
name|IMAGE_SCALE
argument_list|,
literal|"scalable_size = %"
name|G_GINT64_FORMAT
literal|"  scaled_size = %"
name|G_GINT64_FORMAT
argument_list|,
name|scalable_size
argument_list|,
name|scaled_size
argument_list|)
expr_stmt|;
name|new_size
operator|=
name|current_size
operator|-
name|scalable_size
operator|+
name|scaled_size
expr_stmt|;
return|return
name|new_size
return|;
block|}
end_function

begin_function
name|GimpImageBaseType
DECL|function|gimp_image_get_base_type (const GimpImage * image)
name|gimp_image_get_base_type
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|base_type
return|;
block|}
end_function

begin_function
name|GimpComponentType
DECL|function|gimp_image_get_component_type (const GimpImage * image)
name|gimp_image_get_component_type
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
name|gimp_babl_component_type
argument_list|(
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|precision
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpPrecision
DECL|function|gimp_image_get_precision (const GimpImage * image)
name|gimp_image_get_precision
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|precision
return|;
block|}
end_function

begin_function
specifier|const
name|Babl
modifier|*
DECL|function|gimp_image_get_format (const GimpImage * image,GimpImageBaseType base_type,GimpPrecision precision,gboolean with_alpha)
name|gimp_image_get_format
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpImageBaseType
name|base_type
parameter_list|,
name|GimpPrecision
name|precision
parameter_list|,
name|gboolean
name|with_alpha
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|base_type
condition|)
block|{
case|case
name|GIMP_RGB
case|:
case|case
name|GIMP_GRAY
case|:
return|return
name|gimp_babl_format
argument_list|(
name|base_type
argument_list|,
name|precision
argument_list|,
name|with_alpha
argument_list|)
return|;
case|case
name|GIMP_INDEXED
case|:
if|if
condition|(
name|precision
operator|==
name|GIMP_PRECISION_U8_GAMMA
condition|)
block|{
if|if
condition|(
name|with_alpha
condition|)
return|return
name|gimp_image_colormap_get_rgba_format
argument_list|(
name|image
argument_list|)
return|;
else|else
return|return
name|gimp_image_colormap_get_rgb_format
argument_list|(
name|image
argument_list|)
return|;
block|}
block|}
name|g_return_val_if_reached
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|const
name|Babl
modifier|*
DECL|function|gimp_image_get_layer_format (const GimpImage * image,gboolean with_alpha)
name|gimp_image_get_layer_format
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gboolean
name|with_alpha
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|gimp_image_get_format
argument_list|(
name|image
argument_list|,
name|gimp_image_get_base_type
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|with_alpha
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|Babl
modifier|*
DECL|function|gimp_image_get_channel_format (const GimpImage * image)
name|gimp_image_get_channel_format
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|gimp_image_get_format
argument_list|(
name|image
argument_list|,
name|GIMP_GRAY
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
return|;
block|}
end_function

begin_function
specifier|const
name|Babl
modifier|*
DECL|function|gimp_image_get_mask_format (const GimpImage * image)
name|gimp_image_get_mask_format
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|gimp_babl_mask_format
argument_list|(
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_ID (const GimpImage * image)
name|gimp_image_get_ID
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|ID
return|;
block|}
end_function

begin_function
name|GimpImage
modifier|*
DECL|function|gimp_image_get_by_ID (Gimp * gimp,gint image_id)
name|gimp_image_get_by_ID
parameter_list|(
name|Gimp
modifier|*
name|gimp
parameter_list|,
name|gint
name|image_id
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_GIMP
argument_list|(
name|gimp
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp
operator|->
name|image_table
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
return|return
operator|(
name|GimpImage
operator|*
operator|)
name|gimp_id_table_lookup
argument_list|(
name|gimp
operator|->
name|image_table
argument_list|,
name|image_id
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_file (GimpImage * image,GFile * file)
name|gimp_image_set_file
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GFile
modifier|*
name|file
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|file
operator|==
name|NULL
operator|||
name|G_IS_FILE
argument_list|(
name|file
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|file
operator|!=
name|file
condition|)
block|{
name|gimp_object_take_name
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|image
argument_list|)
argument_list|,
name|file
condition|?
name|g_file_get_uri
argument_list|(
name|file
argument_list|)
else|:
name|NULL
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * gimp_image_get_untitled_file:  *  * Returns: A #GFile saying "Untitled" for newly created images.  **/
end_comment

begin_function
name|GFile
modifier|*
DECL|function|gimp_image_get_untitled_file (const GimpImage * image)
name|gimp_image_get_untitled_file
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|private
operator|->
name|untitled_file
condition|)
name|private
operator|->
name|untitled_file
operator|=
name|g_file_new_for_uri
argument_list|(
name|_
argument_list|(
literal|"Untitled"
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|private
operator|->
name|untitled_file
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_get_file_or_untitled:  * @image: A #GimpImage.  *  * Get the file of the XCF image, or the "Untitled" file if there is no file.  *  * Returns: A #GFile.  **/
end_comment

begin_function
name|GFile
modifier|*
DECL|function|gimp_image_get_file_or_untitled (const GimpImage * image)
name|gimp_image_get_file_or_untitled
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GFile
modifier|*
name|file
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|file
operator|=
name|gimp_image_get_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
name|file
operator|=
name|gimp_image_get_untitled_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|file
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_get_file:  * @image: A #GimpImage.  *  * Get the file of the XCF image, or NULL if there is no file.  *  * Returns: The file, or NULL.  **/
end_comment

begin_function
name|GFile
modifier|*
DECL|function|gimp_image_get_file (const GimpImage * image)
name|gimp_image_get_file
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|file
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_filename (GimpImage * image,const gchar * filename)
name|gimp_image_set_filename
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|filename
parameter_list|)
block|{
name|GFile
modifier|*
name|file
init|=
name|NULL
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|filename
operator|&&
name|strlen
argument_list|(
name|filename
argument_list|)
condition|)
name|file
operator|=
name|file_utils_filename_to_file
argument_list|(
name|image
operator|->
name|gimp
argument_list|,
name|filename
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|gimp_image_set_file
argument_list|(
name|image
argument_list|,
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|file
condition|)
name|g_object_unref
argument_list|(
name|file
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_get_imported_file:  * @image: A #GimpImage.  *  * Returns: The file of the imported image, or NULL if the image has  * been saved as XCF after it was imported.  **/
end_comment

begin_function
name|GFile
modifier|*
DECL|function|gimp_image_get_imported_file (const GimpImage * image)
name|gimp_image_get_imported_file
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|imported_file
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_get_exported_file:  * @image: A #GimpImage.  *  * Returns: The file of the image last exported from this XCF file, or  * NULL if the image has never been exported.  **/
end_comment

begin_function
name|GFile
modifier|*
DECL|function|gimp_image_get_exported_file (const GimpImage * image)
name|gimp_image_get_exported_file
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|exported_file
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_get_save_a_copy_file:  * @image: A #GimpImage.  *  * Returns: The URI of the last copy that was saved of this XCF file.  **/
end_comment

begin_function
name|GFile
modifier|*
DECL|function|gimp_image_get_save_a_copy_file (const GimpImage * image)
name|gimp_image_get_save_a_copy_file
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|save_a_copy_file
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_get_any_file:  * @image: A #GimpImage.  *  * Returns: The XCF file, the imported file, or the exported file, in  * that order of precedence.  **/
end_comment

begin_function
name|GFile
modifier|*
DECL|function|gimp_image_get_any_file (const GimpImage * image)
name|gimp_image_get_any_file
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GFile
modifier|*
name|file
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|file
operator|=
name|gimp_image_get_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
block|{
name|file
operator|=
name|gimp_image_get_imported_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
block|{
name|file
operator|=
name|gimp_image_get_exported_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|file
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_set_imported_uri:  * @image: A #GimpImage.  * @file:  *  * Sets the URI this file was imported from.  **/
end_comment

begin_function
name|void
DECL|function|gimp_image_set_imported_file (GimpImage * image,GFile * file)
name|gimp_image_set_imported_file
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GFile
modifier|*
name|file
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|file
operator|==
name|NULL
operator|||
name|G_IS_FILE
argument_list|(
name|file
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|imported_file
operator|!=
name|file
condition|)
block|{
if|if
condition|(
name|private
operator|->
name|imported_file
condition|)
name|g_object_unref
argument_list|(
name|private
operator|->
name|imported_file
argument_list|)
expr_stmt|;
name|private
operator|->
name|imported_file
operator|=
name|file
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|imported_file
condition|)
name|g_object_ref
argument_list|(
name|private
operator|->
name|imported_file
argument_list|)
expr_stmt|;
name|gimp_object_name_changed
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * gimp_image_set_exported_file:  * @image: A #GimpImage.  * @file:  *  * Sets the file this image was last exported to. Note that saving as  * XCF is not "exporting".  **/
end_comment

begin_function
name|void
DECL|function|gimp_image_set_exported_file (GimpImage * image,GFile * file)
name|gimp_image_set_exported_file
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GFile
modifier|*
name|file
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|file
operator|==
name|NULL
operator|||
name|G_IS_FILE
argument_list|(
name|file
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|exported_file
operator|!=
name|file
condition|)
block|{
if|if
condition|(
name|private
operator|->
name|exported_file
condition|)
name|g_object_unref
argument_list|(
name|private
operator|->
name|exported_file
argument_list|)
expr_stmt|;
name|private
operator|->
name|exported_file
operator|=
name|file
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|exported_file
condition|)
name|g_object_ref
argument_list|(
name|private
operator|->
name|exported_file
argument_list|)
expr_stmt|;
name|gimp_object_name_changed
argument_list|(
name|GIMP_OBJECT
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_comment
comment|/**  * gimp_image_set_save_a_copy_file:  * @image: A #GimpImage.  * @uri:  *  * Set the URI to the last copy this XCF file was saved to through the  * "save a copy" action.  **/
end_comment

begin_function
name|void
DECL|function|gimp_image_set_save_a_copy_file (GimpImage * image,GFile * file)
name|gimp_image_set_save_a_copy_file
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GFile
modifier|*
name|file
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|file
operator|==
name|NULL
operator|||
name|G_IS_FILE
argument_list|(
name|file
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|save_a_copy_file
operator|!=
name|file
condition|)
block|{
if|if
condition|(
name|private
operator|->
name|save_a_copy_file
condition|)
name|g_object_unref
argument_list|(
name|private
operator|->
name|save_a_copy_file
argument_list|)
expr_stmt|;
name|private
operator|->
name|save_a_copy_file
operator|=
name|file
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|save_a_copy_file
condition|)
name|g_object_ref
argument_list|(
name|private
operator|->
name|save_a_copy_file
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gchar
modifier|*
DECL|function|gimp_image_get_filename (const GimpImage * image)
name|gimp_image_get_filename
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GFile
modifier|*
name|file
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|file
operator|=
name|gimp_image_get_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|file
condition|)
return|return
name|NULL
return|;
return|return
name|g_file_get_path
argument_list|(
name|file
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|gchar
modifier|*
DECL|function|gimp_image_format_display_uri (GimpImage * image,gboolean basename)
name|gimp_image_format_display_uri
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gboolean
name|basename
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|uri_format
init|=
name|NULL
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|export_status
init|=
name|NULL
decl_stmt|;
name|GFile
modifier|*
name|file
init|=
name|NULL
decl_stmt|;
name|GFile
modifier|*
name|source
init|=
name|NULL
decl_stmt|;
name|GFile
modifier|*
name|dest
init|=
name|NULL
decl_stmt|;
name|GFile
modifier|*
name|display_file
init|=
name|NULL
decl_stmt|;
name|gboolean
name|is_imported
decl_stmt|;
name|gboolean
name|is_exported
decl_stmt|;
name|gchar
modifier|*
name|display_uri
init|=
name|NULL
decl_stmt|;
name|gchar
modifier|*
name|format_string
decl_stmt|;
name|gchar
modifier|*
name|tmp
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|file
operator|=
name|gimp_image_get_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|source
operator|=
name|gimp_image_get_imported_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|dest
operator|=
name|gimp_image_get_exported_file
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|is_imported
operator|=
operator|(
name|source
operator|!=
name|NULL
operator|)
expr_stmt|;
name|is_exported
operator|=
operator|(
name|dest
operator|!=
name|NULL
operator|)
expr_stmt|;
if|if
condition|(
name|file
condition|)
block|{
name|display_file
operator|=
name|g_object_ref
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|uri_format
operator|=
literal|"%s"
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|is_imported
condition|)
name|display_file
operator|=
name|source
expr_stmt|;
comment|/* Calculate filename suffix */
if|if
condition|(
operator|!
name|gimp_image_is_export_dirty
argument_list|(
name|image
argument_list|)
condition|)
block|{
if|if
condition|(
name|is_exported
condition|)
block|{
name|display_file
operator|=
name|dest
expr_stmt|;
name|export_status
operator|=
name|_
argument_list|(
literal|" (exported)"
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|is_imported
condition|)
block|{
name|export_status
operator|=
name|_
argument_list|(
literal|" (overwritten)"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|g_warning
argument_list|(
literal|"Unexpected code path, Save+export implementation is buggy!"
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|is_imported
condition|)
block|{
name|export_status
operator|=
name|_
argument_list|(
literal|" (imported)"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|display_file
condition|)
name|display_file
operator|=
name|file_utils_file_with_new_ext
argument_list|(
name|display_file
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|uri_format
operator|=
literal|"[%s]"
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|display_file
condition|)
name|display_file
operator|=
name|g_object_ref
argument_list|(
name|gimp_image_get_untitled_file
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|basename
condition|)
name|display_uri
operator|=
name|g_path_get_basename
argument_list|(
name|gimp_file_get_utf8_name
argument_list|(
name|display_file
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|display_uri
operator|=
name|g_strdup
argument_list|(
name|gimp_file_get_utf8_name
argument_list|(
name|display_file
argument_list|)
argument_list|)
expr_stmt|;
name|g_object_unref
argument_list|(
name|display_file
argument_list|)
expr_stmt|;
name|format_string
operator|=
name|g_strconcat
argument_list|(
name|uri_format
argument_list|,
name|export_status
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|g_strdup_printf
argument_list|(
name|format_string
argument_list|,
name|display_uri
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|display_uri
argument_list|)
expr_stmt|;
name|display_uri
operator|=
name|tmp
expr_stmt|;
name|g_free
argument_list|(
name|format_string
argument_list|)
expr_stmt|;
return|return
name|display_uri
return|;
block|}
end_function

begin_function
specifier|const
name|gchar
modifier|*
DECL|function|gimp_image_get_display_name (GimpImage * image)
name|gimp_image_get_display_name
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|private
operator|->
name|display_name
condition|)
name|private
operator|->
name|display_name
operator|=
name|gimp_image_format_display_uri
argument_list|(
name|image
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|private
operator|->
name|display_name
return|;
block|}
end_function

begin_function
specifier|const
name|gchar
modifier|*
DECL|function|gimp_image_get_display_path (GimpImage * image)
name|gimp_image_get_display_path
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|private
operator|->
name|display_path
condition|)
name|private
operator|->
name|display_path
operator|=
name|gimp_image_format_display_uri
argument_list|(
name|image
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|private
operator|->
name|display_path
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_load_proc (GimpImage * image,GimpPlugInProcedure * proc)
name|gimp_image_set_load_proc
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpPlugInProcedure
modifier|*
name|proc
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|load_proc
operator|=
name|proc
expr_stmt|;
block|}
end_function

begin_function
name|GimpPlugInProcedure
modifier|*
DECL|function|gimp_image_get_load_proc (const GimpImage * image)
name|gimp_image_get_load_proc
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|load_proc
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_save_proc (GimpImage * image,GimpPlugInProcedure * proc)
name|gimp_image_set_save_proc
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpPlugInProcedure
modifier|*
name|proc
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|save_proc
operator|=
name|proc
expr_stmt|;
block|}
end_function

begin_function
name|GimpPlugInProcedure
modifier|*
DECL|function|gimp_image_get_save_proc (const GimpImage * image)
name|gimp_image_get_save_proc
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|save_proc
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_export_proc (GimpImage * image,GimpPlugInProcedure * proc)
name|gimp_image_set_export_proc
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpPlugInProcedure
modifier|*
name|proc
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|export_proc
operator|=
name|proc
expr_stmt|;
block|}
end_function

begin_function
name|GimpPlugInProcedure
modifier|*
DECL|function|gimp_image_get_export_proc (const GimpImage * image)
name|gimp_image_get_export_proc
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|export_proc
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_xcf_version (GimpImage * image,gboolean zlib_compression,gint * gimp_version,const gchar ** version_string)
name|gimp_image_get_xcf_version
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gboolean
name|zlib_compression
parameter_list|,
name|gint
modifier|*
name|gimp_version
parameter_list|,
specifier|const
name|gchar
modifier|*
modifier|*
name|version_string
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|gint
name|version
init|=
literal|0
decl_stmt|;
comment|/* default to oldest */
comment|/* need version 1 for colormaps */
if|if
condition|(
name|gimp_image_get_colormap
argument_list|(
name|image
argument_list|)
condition|)
name|version
operator|=
literal|1
expr_stmt|;
for|for
control|(
name|list
operator|=
name|gimp_image_get_layer_iter
argument_list|(
name|image
argument_list|)
init|;
name|list
operator|&&
name|version
operator|<
literal|3
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpLayer
modifier|*
name|layer
init|=
name|GIMP_LAYER
argument_list|(
name|list
operator|->
name|data
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|gimp_layer_get_mode
argument_list|(
name|layer
argument_list|)
condition|)
block|{
comment|/* new layer modes not supported by gimp-1.2 */
case|case
name|GIMP_SOFTLIGHT_MODE
case|:
case|case
name|GIMP_GRAIN_EXTRACT_MODE
case|:
case|case
name|GIMP_GRAIN_MERGE_MODE
case|:
case|case
name|GIMP_COLOR_ERASE_MODE
case|:
name|version
operator|=
name|MAX
argument_list|(
literal|2
argument_list|,
name|version
argument_list|)
expr_stmt|;
break|break;
comment|/* new layer modes not supported by gimp-2.8 */
case|case
name|GIMP_NEW_OVERLAY_MODE
case|:
name|version
operator|=
name|MAX
argument_list|(
literal|9
argument_list|,
name|version
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
comment|/* need version 3 for layer trees */
if|if
condition|(
name|gimp_viewable_get_children
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
condition|)
name|version
operator|=
name|MAX
argument_list|(
literal|3
argument_list|,
name|version
argument_list|)
expr_stmt|;
block|}
comment|/* need version 6 for new metadata */
if|if
condition|(
name|gimp_image_get_metadata
argument_list|(
name|image
argument_list|)
condition|)
name|version
operator|=
name|MAX
argument_list|(
literal|6
argument_list|,
name|version
argument_list|)
expr_stmt|;
comment|/* need version 7 for high bit depth images */
if|if
condition|(
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
operator|!=
name|GIMP_PRECISION_U8_GAMMA
condition|)
name|version
operator|=
name|MAX
argument_list|(
literal|7
argument_list|,
name|version
argument_list|)
expr_stmt|;
comment|/* need version 8 for zlib compression */
if|if
condition|(
name|zlib_compression
condition|)
name|version
operator|=
name|MAX
argument_list|(
literal|8
argument_list|,
name|version
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|version
condition|)
block|{
case|case
literal|0
case|:
case|case
literal|1
case|:
case|case
literal|2
case|:
if|if
condition|(
name|gimp_version
condition|)
operator|*
name|gimp_version
operator|=
literal|206
expr_stmt|;
if|if
condition|(
name|version_string
condition|)
operator|*
name|version_string
operator|=
literal|"GIMP 2.6"
expr_stmt|;
break|break;
case|case
literal|3
case|:
if|if
condition|(
name|gimp_version
condition|)
operator|*
name|gimp_version
operator|=
literal|208
expr_stmt|;
if|if
condition|(
name|version_string
condition|)
operator|*
name|version_string
operator|=
literal|"GIMP 2.8"
expr_stmt|;
break|break;
case|case
literal|4
case|:
case|case
literal|5
case|:
case|case
literal|6
case|:
case|case
literal|7
case|:
case|case
literal|8
case|:
case|case
literal|9
case|:
if|if
condition|(
name|gimp_version
condition|)
operator|*
name|gimp_version
operator|=
literal|210
expr_stmt|;
if|if
condition|(
name|version_string
condition|)
operator|*
name|version_string
operator|=
literal|"GIMP 2.10"
expr_stmt|;
break|break;
block|}
return|return
name|version
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_xcf_compat_mode (GimpImage * image,gboolean compat_mode)
name|gimp_image_set_xcf_compat_mode
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gboolean
name|compat_mode
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|xcf_compat_mode
operator|=
name|compat_mode
expr_stmt|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_get_xcf_compat_mode (const GimpImage * image)
name|gimp_image_get_xcf_compat_mode
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|xcf_compat_mode
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_resolution (GimpImage * image,gdouble xresolution,gdouble yresolution)
name|gimp_image_set_resolution
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gdouble
name|xresolution
parameter_list|,
name|gdouble
name|yresolution
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/* don't allow to set the resolution out of bounds */
if|if
condition|(
name|xresolution
operator|<
name|GIMP_MIN_RESOLUTION
operator|||
name|xresolution
operator|>
name|GIMP_MAX_RESOLUTION
operator|||
name|yresolution
operator|<
name|GIMP_MIN_RESOLUTION
operator|||
name|yresolution
operator|>
name|GIMP_MAX_RESOLUTION
condition|)
return|return;
if|if
condition|(
operator|(
name|ABS
argument_list|(
name|private
operator|->
name|xresolution
operator|-
name|xresolution
argument_list|)
operator|>=
literal|1e-5
operator|)
operator|||
operator|(
name|ABS
argument_list|(
name|private
operator|->
name|yresolution
operator|-
name|yresolution
argument_list|)
operator|>=
literal|1e-5
operator|)
condition|)
block|{
name|gimp_image_undo_push_image_resolution
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Change Image Resolution"
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|->
name|xresolution
operator|=
name|xresolution
expr_stmt|;
name|private
operator|->
name|yresolution
operator|=
name|yresolution
expr_stmt|;
name|gimp_image_resolution_changed
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|gimp_image_size_changed_detailed
argument_list|(
name|image
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_get_resolution (const GimpImage * image,gdouble * xresolution,gdouble * yresolution)
name|gimp_image_get_resolution
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gdouble
modifier|*
name|xresolution
parameter_list|,
name|gdouble
modifier|*
name|yresolution
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|xresolution
operator|!=
name|NULL
operator|&&
name|yresolution
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
operator|*
name|xresolution
operator|=
name|private
operator|->
name|xresolution
expr_stmt|;
operator|*
name|yresolution
operator|=
name|private
operator|->
name|yresolution
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_resolution_changed (GimpImage * image)
name|gimp_image_resolution_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|RESOLUTION_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_unit (GimpImage * image,GimpUnit unit)
name|gimp_image_set_unit
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpUnit
name|unit
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|unit
operator|>
name|GIMP_UNIT_PIXEL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|resolution_unit
operator|!=
name|unit
condition|)
block|{
name|gimp_image_undo_push_image_resolution
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Change Image Unit"
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|->
name|resolution_unit
operator|=
name|unit
expr_stmt|;
name|gimp_image_unit_changed
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|GimpUnit
DECL|function|gimp_image_get_unit (const GimpImage * image)
name|gimp_image_get_unit
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|GIMP_UNIT_INCH
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|resolution_unit
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_unit_changed (GimpImage * image)
name|gimp_image_unit_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|UNIT_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_width (const GimpImage * image)
name|gimp_image_get_width
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|width
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_height (const GimpImage * image)
name|gimp_image_get_height
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|height
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_has_alpha (const GimpImage * image)
name|gimp_image_has_alpha
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpLayer
modifier|*
name|layer
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|layer
operator|=
name|GIMP_LAYER
argument_list|(
name|gimp_container_get_first_child
argument_list|(
name|private
operator|->
name|layers
operator|->
name|container
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
operator|(
name|gimp_image_get_n_layers
argument_list|(
name|image
argument_list|)
operator|>
literal|1
operator|)
operator|||
operator|(
name|layer
operator|&&
name|gimp_drawable_has_alpha
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
operator|)
operator|)
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_is_empty (const GimpImage * image)
name|gimp_image_is_empty
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
return|return
name|gimp_container_is_empty
argument_list|(
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|layers
operator|->
name|container
argument_list|)
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_floating_selection (GimpImage * image,GimpLayer * floating_sel)
name|gimp_image_set_floating_selection
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpLayer
modifier|*
name|floating_sel
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|floating_sel
operator|==
name|NULL
operator|||
name|GIMP_IS_LAYER
argument_list|(
name|floating_sel
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|floating_sel
operator|!=
name|floating_sel
condition|)
block|{
name|private
operator|->
name|floating_sel
operator|=
name|floating_sel
expr_stmt|;
name|private
operator|->
name|flush_accum
operator|.
name|floating_selection_changed
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
end_function

begin_function
name|GimpLayer
modifier|*
DECL|function|gimp_image_get_floating_selection (const GimpImage * image)
name|gimp_image_get_floating_selection
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|floating_sel
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_floating_selection_changed (GimpImage * image)
name|gimp_image_floating_selection_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|FLOATING_SELECTION_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|GimpChannel
modifier|*
DECL|function|gimp_image_get_mask (const GimpImage * image)
name|gimp_image_get_mask
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|selection_mask
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_mask_changed (GimpImage * image)
name|gimp_image_mask_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|MASK_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_take_mask (GimpImage * image,GimpChannel * mask)
name|gimp_image_take_mask
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannel
modifier|*
name|mask
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_SELECTION
argument_list|(
name|mask
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|selection_mask
condition|)
name|g_object_unref
argument_list|(
name|private
operator|->
name|selection_mask
argument_list|)
expr_stmt|;
name|private
operator|->
name|selection_mask
operator|=
name|g_object_ref_sink
argument_list|(
name|mask
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|private
operator|->
name|selection_mask
argument_list|,
literal|"update"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gimp_image_mask_update
argument_list|)
argument_list|,
name|image
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  image components  */
end_comment

begin_function
specifier|const
name|Babl
modifier|*
DECL|function|gimp_image_get_component_format (const GimpImage * image,GimpChannelType channel)
name|gimp_image_get_component_format
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannelType
name|channel
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel
condition|)
block|{
case|case
name|GIMP_RED_CHANNEL
case|:
return|return
name|gimp_babl_component_format
argument_list|(
name|GIMP_RGB
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|RED
argument_list|)
return|;
case|case
name|GIMP_GREEN_CHANNEL
case|:
return|return
name|gimp_babl_component_format
argument_list|(
name|GIMP_RGB
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|GREEN
argument_list|)
return|;
case|case
name|GIMP_BLUE_CHANNEL
case|:
return|return
name|gimp_babl_component_format
argument_list|(
name|GIMP_RGB
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|BLUE
argument_list|)
return|;
case|case
name|GIMP_ALPHA_CHANNEL
case|:
return|return
name|gimp_babl_component_format
argument_list|(
name|GIMP_RGB
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|ALPHA
argument_list|)
return|;
case|case
name|GIMP_GRAY_CHANNEL
case|:
return|return
name|gimp_babl_component_format
argument_list|(
name|GIMP_GRAY
argument_list|,
name|gimp_image_get_precision
argument_list|(
name|image
argument_list|)
argument_list|,
name|GRAY
argument_list|)
return|;
case|case
name|GIMP_INDEXED_CHANNEL
case|:
return|return
name|babl_format
argument_list|(
literal|"Y u8"
argument_list|)
return|;
comment|/* will extract grayscale, the best                                     * we can do here */
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_component_index (const GimpImage * image,GimpChannelType channel)
name|gimp_image_get_component_index
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannelType
name|channel
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|channel
condition|)
block|{
case|case
name|GIMP_RED_CHANNEL
case|:
return|return
name|RED
return|;
case|case
name|GIMP_GREEN_CHANNEL
case|:
return|return
name|GREEN
return|;
case|case
name|GIMP_BLUE_CHANNEL
case|:
return|return
name|BLUE
return|;
case|case
name|GIMP_GRAY_CHANNEL
case|:
return|return
name|GRAY
return|;
case|case
name|GIMP_INDEXED_CHANNEL
case|:
return|return
name|INDEXED
return|;
case|case
name|GIMP_ALPHA_CHANNEL
case|:
switch|switch
condition|(
name|gimp_image_get_base_type
argument_list|(
name|image
argument_list|)
condition|)
block|{
case|case
name|GIMP_RGB
case|:
return|return
name|ALPHA
return|;
case|case
name|GIMP_GRAY
case|:
return|return
name|ALPHA_G
return|;
case|case
name|GIMP_INDEXED
case|:
return|return
name|ALPHA_I
return|;
block|}
block|}
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_component_active (GimpImage * image,GimpChannelType channel,gboolean active)
name|gimp_image_set_component_active
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannelType
name|channel
parameter_list|,
name|gboolean
name|active
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|gint
name|index
init|=
operator|-
literal|1
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|index
operator|=
name|gimp_image_get_component_index
argument_list|(
name|image
argument_list|,
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|!=
operator|-
literal|1
operator|&&
name|active
operator|!=
name|private
operator|->
name|active
index|[
name|index
index|]
condition|)
block|{
name|private
operator|->
name|active
index|[
name|index
index|]
operator|=
name|active
condition|?
name|TRUE
else|:
name|FALSE
expr_stmt|;
comment|/*  If there is an active channel and we mess with the components,        *  the active channel gets unset...        */
name|gimp_image_unset_active_channel
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|COMPONENT_ACTIVE_CHANGED
index|]
argument_list|,
literal|0
argument_list|,
name|channel
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_get_component_active (const GimpImage * image,GimpChannelType channel)
name|gimp_image_get_component_active
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannelType
name|channel
parameter_list|)
block|{
name|gint
name|index
init|=
operator|-
literal|1
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|index
operator|=
name|gimp_image_get_component_index
argument_list|(
name|image
argument_list|,
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|!=
operator|-
literal|1
condition|)
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|active
index|[
name|index
index|]
return|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_get_active_array (const GimpImage * image,gboolean * components)
name|gimp_image_get_active_array
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gboolean
modifier|*
name|components
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|components
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_CHANNELS
condition|;
name|i
operator|++
control|)
name|components
index|[
name|i
index|]
operator|=
name|private
operator|->
name|active
index|[
name|i
index|]
expr_stmt|;
block|}
end_function

begin_function
name|GimpComponentMask
DECL|function|gimp_image_get_active_mask (const GimpImage * image)
name|gimp_image_get_active_mask
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpComponentMask
name|mask
init|=
literal|0
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|gimp_image_get_base_type
argument_list|(
name|image
argument_list|)
condition|)
block|{
case|case
name|GIMP_RGB
case|:
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|RED
index|]
operator|)
condition|?
name|GIMP_COMPONENT_RED
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|GREEN
index|]
operator|)
condition|?
name|GIMP_COMPONENT_GREEN
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|BLUE
index|]
operator|)
condition|?
name|GIMP_COMPONENT_BLUE
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|ALPHA
index|]
operator|)
condition|?
name|GIMP_COMPONENT_ALPHA
else|:
literal|0
expr_stmt|;
break|break;
case|case
name|GIMP_GRAY
case|:
case|case
name|GIMP_INDEXED
case|:
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|GRAY
index|]
operator|)
condition|?
name|GIMP_COMPONENT_RED
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|GRAY
index|]
operator|)
condition|?
name|GIMP_COMPONENT_GREEN
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|GRAY
index|]
operator|)
condition|?
name|GIMP_COMPONENT_BLUE
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|active
index|[
name|ALPHA_G
index|]
operator|)
condition|?
name|GIMP_COMPONENT_ALPHA
else|:
literal|0
expr_stmt|;
break|break;
block|}
return|return
name|mask
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_set_component_visible (GimpImage * image,GimpChannelType channel,gboolean visible)
name|gimp_image_set_component_visible
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannelType
name|channel
parameter_list|,
name|gboolean
name|visible
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|gint
name|index
init|=
operator|-
literal|1
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|index
operator|=
name|gimp_image_get_component_index
argument_list|(
name|image
argument_list|,
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|!=
operator|-
literal|1
operator|&&
name|visible
operator|!=
name|private
operator|->
name|visible
index|[
name|index
index|]
condition|)
block|{
name|private
operator|->
name|visible
index|[
name|index
index|]
operator|=
name|visible
condition|?
name|TRUE
else|:
name|FALSE
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|visible_mask
condition|)
block|{
name|GimpComponentMask
name|mask
decl_stmt|;
name|mask
operator|=
operator|~
name|gimp_image_get_visible_mask
argument_list|(
name|image
argument_list|)
operator|&
name|GIMP_COMPONENT_ALL
expr_stmt|;
name|gegl_node_set
argument_list|(
name|private
operator|->
name|visible_mask
argument_list|,
literal|"mask"
argument_list|,
name|mask
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|COMPONENT_VISIBILITY_CHANGED
index|]
argument_list|,
literal|0
argument_list|,
name|channel
argument_list|)
expr_stmt|;
name|gimp_image_invalidate
argument_list|(
name|image
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
argument_list|,
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_get_component_visible (const GimpImage * image,GimpChannelType channel)
name|gimp_image_get_component_visible
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannelType
name|channel
parameter_list|)
block|{
name|gint
name|index
init|=
operator|-
literal|1
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|index
operator|=
name|gimp_image_get_component_index
argument_list|(
name|image
argument_list|,
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|!=
operator|-
literal|1
condition|)
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|visible
index|[
name|index
index|]
return|;
return|return
name|FALSE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_get_visible_array (const GimpImage * image,gboolean * components)
name|gimp_image_get_visible_array
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gboolean
modifier|*
name|components
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|gint
name|i
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|components
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|MAX_CHANNELS
condition|;
name|i
operator|++
control|)
name|components
index|[
name|i
index|]
operator|=
name|private
operator|->
name|visible
index|[
name|i
index|]
expr_stmt|;
block|}
end_function

begin_function
name|GimpComponentMask
DECL|function|gimp_image_get_visible_mask (const GimpImage * image)
name|gimp_image_get_visible_mask
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpComponentMask
name|mask
init|=
literal|0
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|gimp_image_get_base_type
argument_list|(
name|image
argument_list|)
condition|)
block|{
case|case
name|GIMP_RGB
case|:
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|RED
index|]
operator|)
condition|?
name|GIMP_COMPONENT_RED
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|GREEN
index|]
operator|)
condition|?
name|GIMP_COMPONENT_GREEN
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|BLUE
index|]
operator|)
condition|?
name|GIMP_COMPONENT_BLUE
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|ALPHA
index|]
operator|)
condition|?
name|GIMP_COMPONENT_ALPHA
else|:
literal|0
expr_stmt|;
break|break;
case|case
name|GIMP_GRAY
case|:
case|case
name|GIMP_INDEXED
case|:
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|GRAY
index|]
operator|)
condition|?
name|GIMP_COMPONENT_RED
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|GRAY
index|]
operator|)
condition|?
name|GIMP_COMPONENT_GREEN
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|GRAY
index|]
operator|)
condition|?
name|GIMP_COMPONENT_BLUE
else|:
literal|0
expr_stmt|;
name|mask
operator||=
operator|(
name|private
operator|->
name|visible
index|[
name|ALPHA
index|]
operator|)
condition|?
name|GIMP_COMPONENT_ALPHA
else|:
literal|0
expr_stmt|;
break|break;
block|}
return|return
name|mask
return|;
block|}
end_function

begin_comment
comment|/*  emitting image signals  */
end_comment

begin_function
name|void
DECL|function|gimp_image_mode_changed (GimpImage * image)
name|gimp_image_mode_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|MODE_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_precision_changed (GimpImage * image)
name|gimp_image_precision_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|PRECISION_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_alpha_changed (GimpImage * image)
name|gimp_image_alpha_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|ALPHA_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_invalidate (GimpImage * image,gint x,gint y,gint width,gint height)
name|gimp_image_invalidate
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_projectable_invalidate
argument_list|(
name|GIMP_PROJECTABLE
argument_list|(
name|image
argument_list|)
argument_list|,
name|x
argument_list|,
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|flush_accum
operator|.
name|preview_invalidated
operator|=
name|TRUE
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_guide_added (GimpImage * image,GimpGuide * guide)
name|gimp_image_guide_added
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpGuide
modifier|*
name|guide
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_GUIDE
argument_list|(
name|guide
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|GUIDE_ADDED
index|]
argument_list|,
literal|0
argument_list|,
name|guide
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_guide_removed (GimpImage * image,GimpGuide * guide)
name|gimp_image_guide_removed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpGuide
modifier|*
name|guide
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_GUIDE
argument_list|(
name|guide
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|GUIDE_REMOVED
index|]
argument_list|,
literal|0
argument_list|,
name|guide
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_guide_moved (GimpImage * image,GimpGuide * guide)
name|gimp_image_guide_moved
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpGuide
modifier|*
name|guide
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_GUIDE
argument_list|(
name|guide
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|GUIDE_MOVED
index|]
argument_list|,
literal|0
argument_list|,
name|guide
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_sample_point_added (GimpImage * image,GimpSamplePoint * sample_point)
name|gimp_image_sample_point_added
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpSamplePoint
modifier|*
name|sample_point
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|sample_point
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|SAMPLE_POINT_ADDED
index|]
argument_list|,
literal|0
argument_list|,
name|sample_point
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_sample_point_removed (GimpImage * image,GimpSamplePoint * sample_point)
name|gimp_image_sample_point_removed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpSamplePoint
modifier|*
name|sample_point
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|sample_point
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|SAMPLE_POINT_REMOVED
index|]
argument_list|,
literal|0
argument_list|,
name|sample_point
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_sample_point_moved (GimpImage * image,GimpSamplePoint * sample_point)
name|gimp_image_sample_point_moved
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpSamplePoint
modifier|*
name|sample_point
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|sample_point
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|SAMPLE_POINT_MOVED
index|]
argument_list|,
literal|0
argument_list|,
name|sample_point
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_size_changed_detailed:  * @image:  * @previous_origin_x:  * @previous_origin_y:  *  * Emits the size-changed-detailed signal that is typically used to adjust the  * position of the image in the display shell on various operations,  * e.g. crop.  *  * This function makes sure that GimpViewable::size-changed is also emitted.  **/
end_comment

begin_function
name|void
DECL|function|gimp_image_size_changed_detailed (GimpImage * image,gint previous_origin_x,gint previous_origin_y,gint previous_width,gint previous_height)
name|gimp_image_size_changed_detailed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|previous_origin_x
parameter_list|,
name|gint
name|previous_origin_y
parameter_list|,
name|gint
name|previous_width
parameter_list|,
name|gint
name|previous_height
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|SIZE_CHANGED_DETAILED
index|]
argument_list|,
literal|0
argument_list|,
name|previous_origin_x
argument_list|,
name|previous_origin_y
argument_list|,
name|previous_width
argument_list|,
name|previous_height
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_colormap_changed (GimpImage * image,gint color_index)
name|gimp_image_colormap_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
name|color_index
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|color_index
operator|>=
operator|-
literal|1
operator|&&
name|color_index
operator|<
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|n_colors
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|COLORMAP_CHANGED
index|]
argument_list|,
literal|0
argument_list|,
name|color_index
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_selection_invalidate (GimpImage * image)
name|gimp_image_selection_invalidate
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|SELECTION_INVALIDATE
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_quick_mask_changed (GimpImage * image)
name|gimp_image_quick_mask_changed
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|QUICK_MASK_CHANGED
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_undo_event (GimpImage * image,GimpUndoEvent event,GimpUndo * undo)
name|gimp_image_undo_event
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpUndoEvent
name|event
parameter_list|,
name|GimpUndo
modifier|*
name|undo
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
operator|(
operator|(
name|event
operator|==
name|GIMP_UNDO_EVENT_UNDO_FREE
operator|||
name|event
operator|==
name|GIMP_UNDO_EVENT_UNDO_FREEZE
operator|||
name|event
operator|==
name|GIMP_UNDO_EVENT_UNDO_THAW
operator|)
operator|&&
name|undo
operator|==
name|NULL
operator|)
operator|||
name|GIMP_IS_UNDO
argument_list|(
name|undo
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|UNDO_EVENT
index|]
argument_list|,
literal|0
argument_list|,
name|event
argument_list|,
name|undo
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  dirty counters  */
end_comment

begin_comment
comment|/* NOTE about the image->dirty counter:  *   If 0, then the image is clean (ie, copy on disk is the same as the one  *      in memory).  *   If positive, then that's the number of dirtying operations done  *       on the image since the last save.  *   If negative, then user has hit undo and gone back in time prior  *       to the saved copy.  Hitting redo will eventually come back to  *       the saved copy.  *  *   The image is dirty (ie, needs saving) if counter is non-zero.  *  *   If the counter is around 100000, this is due to undo-ing back  *   before a saved version, then changing the image (thus destroying  *   the redo stack).  Once this has happened, it's impossible to get  *   the image back to the state on disk, since the redo info has been  *   freed.  See gimpimage-undo.c for the gory details.  */
end_comment

begin_comment
comment|/*  * NEVER CALL gimp_image_dirty() directly!  *  * If your code has just dirtied the image, push an undo instead.  * Failing that, push the trivial undo which tells the user the  * command is not undoable: undo_push_cantundo() (But really, it would  * be best to push a proper undo).  If you just dirty the image  * without pushing an undo then the dirty count is increased, but  * popping that many undo actions won't lead to a clean image.  */
end_comment

begin_function
name|gint
DECL|function|gimp_image_dirty (GimpImage * image,GimpDirtyMask dirty_mask)
name|gimp_image_dirty
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpDirtyMask
name|dirty_mask
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|dirty
operator|++
expr_stmt|;
name|private
operator|->
name|export_dirty
operator|++
expr_stmt|;
if|if
condition|(
operator|!
name|private
operator|->
name|dirty_time
condition|)
name|private
operator|->
name|dirty_time
operator|=
name|time
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|DIRTY
index|]
argument_list|,
literal|0
argument_list|,
name|dirty_mask
argument_list|)
expr_stmt|;
name|TRC
argument_list|(
operator|(
literal|"dirty %d -> %d\n"
operator|,
name|private
operator|->
name|dirty
operator|-
literal|1
operator|,
name|private
operator|->
name|dirty
operator|)
argument_list|)
expr_stmt|;
return|return
name|private
operator|->
name|dirty
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_clean (GimpImage * image,GimpDirtyMask dirty_mask)
name|gimp_image_clean
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpDirtyMask
name|dirty_mask
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|dirty
operator|--
expr_stmt|;
name|private
operator|->
name|export_dirty
operator|--
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|CLEAN
index|]
argument_list|,
literal|0
argument_list|,
name|dirty_mask
argument_list|)
expr_stmt|;
name|TRC
argument_list|(
operator|(
literal|"clean %d -> %d\n"
operator|,
name|private
operator|->
name|dirty
operator|+
literal|1
operator|,
name|private
operator|->
name|dirty
operator|)
argument_list|)
expr_stmt|;
return|return
name|private
operator|->
name|dirty
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_clean_all (GimpImage * image)
name|gimp_image_clean_all
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|dirty
operator|=
literal|0
expr_stmt|;
name|private
operator|->
name|dirty_time
operator|=
literal|0
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|CLEAN
index|]
argument_list|,
literal|0
argument_list|,
name|GIMP_DIRTY_ALL
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_export_clean_all (GimpImage * image)
name|gimp_image_export_clean_all
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|export_dirty
operator|=
literal|0
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|CLEAN
index|]
argument_list|,
literal|0
argument_list|,
name|GIMP_DIRTY_ALL
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_is_dirty:  * @image:  *  * Returns: True if the image is dirty, false otherwise.  **/
end_comment

begin_function
name|gint
DECL|function|gimp_image_is_dirty (const GimpImage * image)
name|gimp_image_is_dirty
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|dirty
operator|!=
literal|0
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_is_export_dirty:  * @image:  *  * Returns: True if the image export is dirty, false otherwise.  **/
end_comment

begin_function
name|gboolean
DECL|function|gimp_image_is_export_dirty (const GimpImage * image)
name|gimp_image_is_export_dirty
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|export_dirty
operator|!=
literal|0
return|;
block|}
end_function

begin_function
name|gint64
DECL|function|gimp_image_get_dirty_time (const GimpImage * image)
name|gimp_image_get_dirty_time
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|dirty_time
return|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_saved:  * @image:  * @file:  *  * Emits the "saved" signal, indicating that @image was saved to the  * location specified by @file.  */
end_comment

begin_function
name|void
DECL|function|gimp_image_saved (GimpImage * image,GFile * file)
name|gimp_image_saved
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GFile
modifier|*
name|file
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|G_IS_FILE
argument_list|(
name|file
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|SAVED
index|]
argument_list|,
literal|0
argument_list|,
name|file
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**  * gimp_image_exported:  * @image:  * @file:  *  * Emits the "exported" signal, indicating that @image was exported to the  * location specified by @file.  */
end_comment

begin_function
name|void
DECL|function|gimp_image_exported (GimpImage * image,GFile * file)
name|gimp_image_exported
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GFile
modifier|*
name|file
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|G_IS_FILE
argument_list|(
name|file
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|EXPORTED
index|]
argument_list|,
literal|0
argument_list|,
name|file
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  flush this image's displays  */
end_comment

begin_function
name|void
DECL|function|gimp_image_flush (GimpImage * image)
name|gimp_image_flush
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_projectable_flush
argument_list|(
name|GIMP_PROJECTABLE
argument_list|(
name|image
argument_list|)
argument_list|,
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|flush_accum
operator|.
name|preview_invalidated
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  display / instance counters  */
end_comment

begin_function
name|gint
DECL|function|gimp_image_get_display_count (const GimpImage * image)
name|gimp_image_get_display_count
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|disp_count
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_inc_display_count (GimpImage * image)
name|gimp_image_inc_display_count
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|disp_count
operator|++
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_dec_display_count (GimpImage * image)
name|gimp_image_dec_display_count
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|disp_count
operator|--
expr_stmt|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_instance_count (const GimpImage * image)
name|gimp_image_get_instance_count
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|instance_count
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_inc_instance_count (GimpImage * image)
name|gimp_image_inc_instance_count
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|instance_count
operator|++
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  parasites  */
end_comment

begin_function
specifier|const
name|GimpParasite
modifier|*
DECL|function|gimp_image_parasite_find (const GimpImage * image,const gchar * name)
name|gimp_image_parasite_find
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|gimp_parasite_list_find
argument_list|(
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|parasites
argument_list|,
name|name
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|list_func (gchar * key,GimpParasite * p,gchar *** cur)
name|list_func
parameter_list|(
name|gchar
modifier|*
name|key
parameter_list|,
name|GimpParasite
modifier|*
name|p
parameter_list|,
name|gchar
modifier|*
modifier|*
modifier|*
name|cur
parameter_list|)
block|{
operator|*
operator|(
operator|*
name|cur
operator|)
operator|++
operator|=
operator|(
name|gchar
operator|*
operator|)
name|g_strdup
argument_list|(
name|key
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gchar
modifier|*
modifier|*
DECL|function|gimp_image_parasite_list (const GimpImage * image,gint * count)
name|gimp_image_parasite_list
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|gint
modifier|*
name|count
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|list
decl_stmt|;
name|gchar
modifier|*
modifier|*
name|cur
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
operator|*
name|count
operator|=
name|gimp_parasite_list_length
argument_list|(
name|private
operator|->
name|parasites
argument_list|)
expr_stmt|;
name|cur
operator|=
name|list
operator|=
name|g_new
argument_list|(
name|gchar
operator|*
argument_list|,
operator|*
name|count
argument_list|)
expr_stmt|;
name|gimp_parasite_list_foreach
argument_list|(
name|private
operator|->
name|parasites
argument_list|,
operator|(
name|GHFunc
operator|)
name|list_func
argument_list|,
operator|&
name|cur
argument_list|)
expr_stmt|;
return|return
name|list
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_parasite_validate (GimpImage * image,const GimpParasite * parasite,GError ** error)
name|gimp_image_parasite_validate
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|GimpParasite
modifier|*
name|parasite
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
block|{
specifier|const
name|gchar
modifier|*
name|name
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|parasite
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|error
operator|==
name|NULL
operator|||
operator|*
name|error
operator|==
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|name
operator|=
name|gimp_parasite_name
argument_list|(
name|parasite
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|GIMP_ICC_PROFILE_PARASITE_NAME
argument_list|)
operator|==
literal|0
condition|)
block|{
return|return
name|gimp_image_validate_icc_profile
argument_list|(
name|image
argument_list|,
name|parasite
argument_list|,
name|error
argument_list|)
return|;
block|}
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_parasite_attach (GimpImage * image,const GimpParasite * parasite)
name|gimp_image_parasite_attach
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|GimpParasite
modifier|*
name|parasite
parameter_list|)
block|{
name|GimpParasite
name|copy
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|parasite
operator|!=
name|NULL
argument_list|)
expr_stmt|;
comment|/*  make a temporary copy of the GimpParasite struct because    *  gimp_parasite_shift_parent() changes it    */
name|copy
operator|=
operator|*
name|parasite
expr_stmt|;
comment|/*  only set the dirty bit manually if we can be saved and the new    *  parasite differs from the current one and we aren't undoable    */
if|if
condition|(
name|gimp_parasite_is_undoable
argument_list|(
operator|&
name|copy
argument_list|)
condition|)
name|gimp_image_undo_push_image_parasite
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Attach Parasite to Image"
argument_list|)
argument_list|,
operator|&
name|copy
argument_list|)
expr_stmt|;
comment|/*  We used to push an cantundo on te stack here. This made the undo stack    *  unusable (NULL on the stack) and prevented people from undoing after a    *  save (since most save plug-ins attach an undoable comment parasite).    *  Now we simply attach the parasite without pushing an undo. That way    *  it's undoable but does not block the undo system.   --Sven    */
name|gimp_parasite_list_add
argument_list|(
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|parasites
argument_list|,
operator|&
name|copy
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_parasite_has_flag
argument_list|(
operator|&
name|copy
argument_list|,
name|GIMP_PARASITE_ATTACH_PARENT
argument_list|)
condition|)
block|{
name|gimp_parasite_shift_parent
argument_list|(
operator|&
name|copy
argument_list|)
expr_stmt|;
name|gimp_parasite_attach
argument_list|(
name|image
operator|->
name|gimp
argument_list|,
operator|&
name|copy
argument_list|)
expr_stmt|;
block|}
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|PARASITE_ATTACHED
index|]
argument_list|,
literal|0
argument_list|,
name|gimp_parasite_name
argument_list|(
name|parasite
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|gimp_parasite_name
argument_list|(
name|parasite
argument_list|)
argument_list|,
name|GIMP_ICC_PROFILE_PARASITE_NAME
argument_list|)
operator|==
literal|0
condition|)
name|gimp_color_managed_profile_changed
argument_list|(
name|GIMP_COLOR_MANAGED
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_parasite_detach (GimpImage * image,const gchar * name)
name|gimp_image_parasite_detach
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
specifier|const
name|GimpParasite
modifier|*
name|parasite
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|name
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|parasite
operator|=
name|gimp_parasite_list_find
argument_list|(
name|private
operator|->
name|parasites
argument_list|,
name|name
argument_list|)
operator|)
condition|)
return|return;
if|if
condition|(
name|gimp_parasite_is_undoable
argument_list|(
name|parasite
argument_list|)
condition|)
name|gimp_image_undo_push_image_parasite_remove
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Remove Parasite from Image"
argument_list|)
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|gimp_parasite_list_remove
argument_list|(
name|private
operator|->
name|parasites
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|g_signal_emit
argument_list|(
name|image
argument_list|,
name|gimp_image_signals
index|[
name|PARASITE_DETACHED
index|]
argument_list|,
literal|0
argument_list|,
name|name
argument_list|)
expr_stmt|;
if|if
condition|(
name|strcmp
argument_list|(
name|name
argument_list|,
name|GIMP_ICC_PROFILE_PARASITE_NAME
argument_list|)
operator|==
literal|0
condition|)
name|gimp_color_managed_profile_changed
argument_list|(
name|GIMP_COLOR_MANAGED
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  tattoos  */
end_comment

begin_function
name|GimpTattoo
DECL|function|gimp_image_get_new_tattoo (GimpImage * image)
name|gimp_image_get_new_tattoo
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|private
operator|->
name|tattoo_state
operator|++
expr_stmt|;
if|if
condition|(
name|G_UNLIKELY
argument_list|(
name|private
operator|->
name|tattoo_state
operator|==
literal|0
argument_list|)
condition|)
name|g_warning
argument_list|(
literal|"%s: Tattoo state corrupted (integer overflow)."
argument_list|,
name|G_STRFUNC
argument_list|)
expr_stmt|;
return|return
name|private
operator|->
name|tattoo_state
return|;
block|}
end_function

begin_function
name|GimpTattoo
DECL|function|gimp_image_get_tattoo_state (GimpImage * image)
name|gimp_image_get_tattoo_state
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|tattoo_state
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_set_tattoo_state (GimpImage * image,GimpTattoo val)
name|gimp_image_set_tattoo_state
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpTattoo
name|val
parameter_list|)
block|{
name|GList
modifier|*
name|all_items
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gboolean
name|retval
init|=
name|TRUE
decl_stmt|;
name|GimpTattoo
name|maxval
init|=
literal|0
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
comment|/* Check that the layer tattoos don't overlap with channel or vector ones */
name|all_items
operator|=
name|gimp_image_get_layer_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|all_items
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpTattoo
name|ltattoo
decl_stmt|;
name|ltattoo
operator|=
name|gimp_item_get_tattoo
argument_list|(
name|GIMP_ITEM
argument_list|(
name|list
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ltattoo
operator|>
name|maxval
condition|)
name|maxval
operator|=
name|ltattoo
expr_stmt|;
if|if
condition|(
name|gimp_image_get_channel_by_tattoo
argument_list|(
name|image
argument_list|,
name|ltattoo
argument_list|)
condition|)
name|retval
operator|=
name|FALSE
expr_stmt|;
comment|/* Oopps duplicated tattoo in channel */
if|if
condition|(
name|gimp_image_get_vectors_by_tattoo
argument_list|(
name|image
argument_list|,
name|ltattoo
argument_list|)
condition|)
name|retval
operator|=
name|FALSE
expr_stmt|;
comment|/* Oopps duplicated tattoo in vectors */
block|}
name|g_list_free
argument_list|(
name|all_items
argument_list|)
expr_stmt|;
comment|/* Now check that the channel and vectors tattoos don't overlap */
name|all_items
operator|=
name|gimp_image_get_channel_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|all_items
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpTattoo
name|ctattoo
decl_stmt|;
name|ctattoo
operator|=
name|gimp_item_get_tattoo
argument_list|(
name|GIMP_ITEM
argument_list|(
name|list
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ctattoo
operator|>
name|maxval
condition|)
name|maxval
operator|=
name|ctattoo
expr_stmt|;
if|if
condition|(
name|gimp_image_get_vectors_by_tattoo
argument_list|(
name|image
argument_list|,
name|ctattoo
argument_list|)
condition|)
name|retval
operator|=
name|FALSE
expr_stmt|;
comment|/* Oopps duplicated tattoo in vectors */
block|}
name|g_list_free
argument_list|(
name|all_items
argument_list|)
expr_stmt|;
comment|/* Find the max tattoo value in the vectors */
name|all_items
operator|=
name|gimp_image_get_vectors_list
argument_list|(
name|image
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|all_items
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpTattoo
name|vtattoo
decl_stmt|;
name|vtattoo
operator|=
name|gimp_item_get_tattoo
argument_list|(
name|GIMP_ITEM
argument_list|(
name|list
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|vtattoo
operator|>
name|maxval
condition|)
name|maxval
operator|=
name|vtattoo
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|all_items
argument_list|)
expr_stmt|;
if|if
condition|(
name|val
operator|<
name|maxval
condition|)
name|retval
operator|=
name|FALSE
expr_stmt|;
comment|/* Must check if the state is valid */
if|if
condition|(
name|retval
operator|==
name|TRUE
condition|)
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|tattoo_state
operator|=
name|val
expr_stmt|;
return|return
name|retval
return|;
block|}
end_function

begin_comment
comment|/*  projection  */
end_comment

begin_function
name|GimpProjection
modifier|*
DECL|function|gimp_image_get_projection (const GimpImage * image)
name|gimp_image_get_projection
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|projection
return|;
block|}
end_function

begin_comment
comment|/*  layers / channels / vectors  */
end_comment

begin_function
name|GimpItemTree
modifier|*
DECL|function|gimp_image_get_layer_tree (const GimpImage * image)
name|gimp_image_get_layer_tree
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|layers
return|;
block|}
end_function

begin_function
name|GimpItemTree
modifier|*
DECL|function|gimp_image_get_channel_tree (const GimpImage * image)
name|gimp_image_get_channel_tree
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|channels
return|;
block|}
end_function

begin_function
name|GimpItemTree
modifier|*
DECL|function|gimp_image_get_vectors_tree (const GimpImage * image)
name|gimp_image_get_vectors_tree
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|vectors
return|;
block|}
end_function

begin_function
name|GimpContainer
modifier|*
DECL|function|gimp_image_get_layers (const GimpImage * image)
name|gimp_image_get_layers
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|layers
operator|->
name|container
return|;
block|}
end_function

begin_function
name|GimpContainer
modifier|*
DECL|function|gimp_image_get_channels (const GimpImage * image)
name|gimp_image_get_channels
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|channels
operator|->
name|container
return|;
block|}
end_function

begin_function
name|GimpContainer
modifier|*
DECL|function|gimp_image_get_vectors (const GimpImage * image)
name|gimp_image_get_vectors
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
return|return
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
operator|->
name|vectors
operator|->
name|container
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_n_layers (const GimpImage * image)
name|gimp_image_get_n_layers
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_layers
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_n_items
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_n_channels (const GimpImage * image)
name|gimp_image_get_n_channels
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_channels
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_n_items
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|gint
DECL|function|gimp_image_get_n_vectors (const GimpImage * image)
name|gimp_image_get_n_vectors
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_vectors
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_n_items
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|GList
modifier|*
DECL|function|gimp_image_get_layer_iter (const GimpImage * image)
name|gimp_image_get_layer_iter
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_layers
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_item_iter
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|GList
modifier|*
DECL|function|gimp_image_get_channel_iter (const GimpImage * image)
name|gimp_image_get_channel_iter
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_channels
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_item_iter
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|GList
modifier|*
DECL|function|gimp_image_get_vectors_iter (const GimpImage * image)
name|gimp_image_get_vectors_iter
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_vectors
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_item_iter
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|GList
modifier|*
DECL|function|gimp_image_get_layer_list (const GimpImage * image)
name|gimp_image_get_layer_list
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_layers
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_item_list
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|GList
modifier|*
DECL|function|gimp_image_get_channel_list (const GimpImage * image)
name|gimp_image_get_channel_list
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_channels
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_item_list
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_function
name|GList
modifier|*
DECL|function|gimp_image_get_vectors_list (const GimpImage * image)
name|gimp_image_get_vectors_list
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_vectors
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|gimp_item_stack_get_item_list
argument_list|(
name|stack
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  active drawable, layer, channel, vectors  */
end_comment

begin_function
name|GimpDrawable
modifier|*
DECL|function|gimp_image_get_active_drawable (const GimpImage * image)
name|gimp_image_get_active_drawable
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpItem
modifier|*
name|active_channel
decl_stmt|;
name|GimpItem
modifier|*
name|active_layer
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|active_channel
operator|=
name|gimp_item_tree_get_active_item
argument_list|(
name|private
operator|->
name|channels
argument_list|)
expr_stmt|;
name|active_layer
operator|=
name|gimp_item_tree_get_active_item
argument_list|(
name|private
operator|->
name|layers
argument_list|)
expr_stmt|;
comment|/*  If there is an active channel (a saved selection, etc.),    *  we ignore the active layer    */
if|if
condition|(
name|active_channel
condition|)
block|{
return|return
name|GIMP_DRAWABLE
argument_list|(
name|active_channel
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|active_layer
condition|)
block|{
name|GimpLayer
modifier|*
name|layer
init|=
name|GIMP_LAYER
argument_list|(
name|active_layer
argument_list|)
decl_stmt|;
name|GimpLayerMask
modifier|*
name|mask
init|=
name|gimp_layer_get_mask
argument_list|(
name|layer
argument_list|)
decl_stmt|;
if|if
condition|(
name|mask
operator|&&
name|gimp_layer_get_edit_mask
argument_list|(
name|layer
argument_list|)
condition|)
return|return
name|GIMP_DRAWABLE
argument_list|(
name|mask
argument_list|)
return|;
else|else
return|return
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
return|;
block|}
return|return
name|NULL
return|;
block|}
end_function

begin_function
name|GimpLayer
modifier|*
DECL|function|gimp_image_get_active_layer (const GimpImage * image)
name|gimp_image_get_active_layer
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|GIMP_LAYER
argument_list|(
name|gimp_item_tree_get_active_item
argument_list|(
name|private
operator|->
name|layers
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpChannel
modifier|*
DECL|function|gimp_image_get_active_channel (const GimpImage * image)
name|gimp_image_get_active_channel
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|GIMP_CHANNEL
argument_list|(
name|gimp_item_tree_get_active_item
argument_list|(
name|private
operator|->
name|channels
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpVectors
modifier|*
DECL|function|gimp_image_get_active_vectors (const GimpImage * image)
name|gimp_image_get_active_vectors
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|GIMP_VECTORS
argument_list|(
name|gimp_item_tree_get_active_item
argument_list|(
name|private
operator|->
name|vectors
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpLayer
modifier|*
DECL|function|gimp_image_set_active_layer (GimpImage * image,GimpLayer * layer)
name|gimp_image_set_active_layer
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpLayer
modifier|*
name|layer
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpLayer
modifier|*
name|floating_sel
decl_stmt|;
name|GimpLayer
modifier|*
name|active_layer
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|layer
operator|==
name|NULL
operator|||
name|GIMP_IS_LAYER
argument_list|(
name|layer
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|layer
operator|==
name|NULL
operator|||
operator|(
name|gimp_item_is_attached
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
operator|&&
name|gimp_item_get_image
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
operator|==
name|image
operator|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|floating_sel
operator|=
name|gimp_image_get_floating_selection
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*  Make sure the floating_sel always is the active layer  */
if|if
condition|(
name|floating_sel
operator|&&
name|layer
operator|!=
name|floating_sel
condition|)
return|return
name|floating_sel
return|;
name|active_layer
operator|=
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|layer
operator|!=
name|active_layer
condition|)
block|{
comment|/*  Don't cache selection info for the previous active layer  */
if|if
condition|(
name|active_layer
condition|)
name|gimp_drawable_invalidate_boundary
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|active_layer
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_item_tree_set_active_item
argument_list|(
name|private
operator|->
name|layers
argument_list|,
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpChannel
modifier|*
DECL|function|gimp_image_set_active_channel (GimpImage * image,GimpChannel * channel)
name|gimp_image_set_active_channel
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|channel
operator|==
name|NULL
operator|||
name|GIMP_IS_CHANNEL
argument_list|(
name|channel
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|channel
operator|==
name|NULL
operator|||
operator|(
name|gimp_item_is_attached
argument_list|(
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|)
operator|&&
name|gimp_item_get_image
argument_list|(
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|)
operator|==
name|image
operator|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*  Not if there is a floating selection  */
if|if
condition|(
name|channel
operator|&&
name|gimp_image_get_floating_selection
argument_list|(
name|image
argument_list|)
condition|)
return|return
name|NULL
return|;
if|if
condition|(
name|channel
operator|!=
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
condition|)
block|{
name|gimp_item_tree_set_active_item
argument_list|(
name|private
operator|->
name|channels
argument_list|,
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpChannel
modifier|*
DECL|function|gimp_image_unset_active_channel (GimpImage * image)
name|gimp_image_unset_active_channel
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpChannel
modifier|*
name|channel
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|channel
condition|)
block|{
name|gimp_image_set_active_channel
argument_list|(
name|image
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|private
operator|->
name|layer_stack
condition|)
name|gimp_image_set_active_layer
argument_list|(
name|image
argument_list|,
name|private
operator|->
name|layer_stack
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
return|return
name|channel
return|;
block|}
end_function

begin_function
name|GimpVectors
modifier|*
DECL|function|gimp_image_set_active_vectors (GimpImage * image,GimpVectors * vectors)
name|gimp_image_set_active_vectors
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpVectors
modifier|*
name|vectors
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|vectors
operator|==
name|NULL
operator|||
name|GIMP_IS_VECTORS
argument_list|(
name|vectors
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|vectors
operator|==
name|NULL
operator|||
operator|(
name|gimp_item_is_attached
argument_list|(
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|)
operator|&&
name|gimp_item_get_image
argument_list|(
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|)
operator|==
name|image
operator|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|vectors
operator|!=
name|gimp_image_get_active_vectors
argument_list|(
name|image
argument_list|)
condition|)
block|{
name|gimp_item_tree_set_active_item
argument_list|(
name|private
operator|->
name|vectors
argument_list|,
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|gimp_image_get_active_vectors
argument_list|(
name|image
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  layer, channel, vectors by tattoo  */
end_comment

begin_function
name|GimpLayer
modifier|*
DECL|function|gimp_image_get_layer_by_tattoo (const GimpImage * image,GimpTattoo tattoo)
name|gimp_image_get_layer_by_tattoo
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpTattoo
name|tattoo
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_layers
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|GIMP_LAYER
argument_list|(
name|gimp_item_stack_get_item_by_tattoo
argument_list|(
name|stack
argument_list|,
name|tattoo
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpChannel
modifier|*
DECL|function|gimp_image_get_channel_by_tattoo (const GimpImage * image,GimpTattoo tattoo)
name|gimp_image_get_channel_by_tattoo
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpTattoo
name|tattoo
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_channels
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|GIMP_CHANNEL
argument_list|(
name|gimp_item_stack_get_item_by_tattoo
argument_list|(
name|stack
argument_list|,
name|tattoo
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpVectors
modifier|*
DECL|function|gimp_image_get_vectors_by_tattoo (const GimpImage * image,GimpTattoo tattoo)
name|gimp_image_get_vectors_by_tattoo
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpTattoo
name|tattoo
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|stack
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|stack
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_vectors
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|GIMP_VECTORS
argument_list|(
name|gimp_item_stack_get_item_by_tattoo
argument_list|(
name|stack
argument_list|,
name|tattoo
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  layer, channel, vectors by name  */
end_comment

begin_function
name|GimpLayer
modifier|*
DECL|function|gimp_image_get_layer_by_name (const GimpImage * image,const gchar * name)
name|gimp_image_get_layer_by_name
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|GimpItemTree
modifier|*
name|tree
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|name
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|tree
operator|=
name|gimp_image_get_layer_tree
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|GIMP_LAYER
argument_list|(
name|gimp_item_tree_get_item_by_name
argument_list|(
name|tree
argument_list|,
name|name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpChannel
modifier|*
DECL|function|gimp_image_get_channel_by_name (const GimpImage * image,const gchar * name)
name|gimp_image_get_channel_by_name
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|GimpItemTree
modifier|*
name|tree
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|name
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|tree
operator|=
name|gimp_image_get_channel_tree
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|GIMP_CHANNEL
argument_list|(
name|gimp_item_tree_get_item_by_name
argument_list|(
name|tree
argument_list|,
name|name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
name|GimpVectors
modifier|*
DECL|function|gimp_image_get_vectors_by_name (const GimpImage * image,const gchar * name)
name|gimp_image_get_vectors_by_name
parameter_list|(
specifier|const
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|gchar
modifier|*
name|name
parameter_list|)
block|{
name|GimpItemTree
modifier|*
name|tree
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|name
operator|!=
name|NULL
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|tree
operator|=
name|gimp_image_get_vectors_tree
argument_list|(
name|image
argument_list|)
expr_stmt|;
return|return
name|GIMP_VECTORS
argument_list|(
name|gimp_item_tree_get_item_by_name
argument_list|(
name|tree
argument_list|,
name|name
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  items  */
end_comment

begin_function
name|gboolean
DECL|function|gimp_image_reorder_item (GimpImage * image,GimpItem * item,GimpItem * new_parent,gint new_index,gboolean push_undo,const gchar * undo_desc)
name|gimp_image_reorder_item
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpItem
modifier|*
name|item
parameter_list|,
name|GimpItem
modifier|*
name|new_parent
parameter_list|,
name|gint
name|new_index
parameter_list|,
name|gboolean
name|push_undo
parameter_list|,
specifier|const
name|gchar
modifier|*
name|undo_desc
parameter_list|)
block|{
name|GimpItemTree
modifier|*
name|tree
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_ITEM
argument_list|(
name|item
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|gimp_item_get_image
argument_list|(
name|item
argument_list|)
operator|==
name|image
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|tree
operator|=
name|gimp_item_get_tree
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|tree
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|push_undo
operator|&&
operator|!
name|undo_desc
condition|)
name|undo_desc
operator|=
name|GIMP_ITEM_GET_CLASS
argument_list|(
name|item
argument_list|)
operator|->
name|reorder_desc
expr_stmt|;
comment|/*  item and new_parent are type-checked in GimpItemTree    */
return|return
name|gimp_item_tree_reorder_item
argument_list|(
name|tree
argument_list|,
name|item
argument_list|,
name|new_parent
argument_list|,
name|new_index
argument_list|,
name|push_undo
argument_list|,
name|undo_desc
argument_list|)
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_raise_item (GimpImage * image,GimpItem * item,GError ** error)
name|gimp_image_raise_item
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpItem
modifier|*
name|item
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
block|{
name|gint
name|index
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_ITEM
argument_list|(
name|item
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|error
operator|==
name|NULL
operator|||
operator|*
name|error
operator|==
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|index
operator|=
name|gimp_item_get_index
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|index
operator|!=
operator|-
literal|1
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|==
literal|0
condition|)
block|{
name|g_set_error_literal
argument_list|(
name|error
argument_list|,
name|GIMP_ERROR
argument_list|,
name|GIMP_FAILED
argument_list|,
name|GIMP_ITEM_GET_CLASS
argument_list|(
name|item
argument_list|)
operator|->
name|raise_failed
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
return|return
name|gimp_image_reorder_item
argument_list|(
name|image
argument_list|,
name|item
argument_list|,
name|gimp_item_get_parent
argument_list|(
name|item
argument_list|)
argument_list|,
name|index
operator|-
literal|1
argument_list|,
name|TRUE
argument_list|,
name|GIMP_ITEM_GET_CLASS
argument_list|(
name|item
argument_list|)
operator|->
name|raise_desc
argument_list|)
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_raise_item_to_top (GimpImage * image,GimpItem * item)
name|gimp_image_raise_item_to_top
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpItem
modifier|*
name|item
parameter_list|)
block|{
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_ITEM
argument_list|(
name|item
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
return|return
name|gimp_image_reorder_item
argument_list|(
name|image
argument_list|,
name|item
argument_list|,
name|gimp_item_get_parent
argument_list|(
name|item
argument_list|)
argument_list|,
literal|0
argument_list|,
name|TRUE
argument_list|,
name|GIMP_ITEM_GET_CLASS
argument_list|(
name|item
argument_list|)
operator|->
name|raise_to_top_desc
argument_list|)
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_lower_item (GimpImage * image,GimpItem * item,GError ** error)
name|gimp_image_lower_item
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpItem
modifier|*
name|item
parameter_list|,
name|GError
modifier|*
modifier|*
name|error
parameter_list|)
block|{
name|GimpContainer
modifier|*
name|container
decl_stmt|;
name|gint
name|index
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_ITEM
argument_list|(
name|item
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|error
operator|==
name|NULL
operator|||
operator|*
name|error
operator|==
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|container
operator|=
name|gimp_item_get_container
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|container
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|index
operator|=
name|gimp_item_get_index
argument_list|(
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|index
operator|==
name|gimp_container_get_n_children
argument_list|(
name|container
argument_list|)
operator|-
literal|1
condition|)
block|{
name|g_set_error_literal
argument_list|(
name|error
argument_list|,
name|GIMP_ERROR
argument_list|,
name|GIMP_FAILED
argument_list|,
name|GIMP_ITEM_GET_CLASS
argument_list|(
name|item
argument_list|)
operator|->
name|lower_failed
argument_list|)
expr_stmt|;
return|return
name|FALSE
return|;
block|}
return|return
name|gimp_image_reorder_item
argument_list|(
name|image
argument_list|,
name|item
argument_list|,
name|gimp_item_get_parent
argument_list|(
name|item
argument_list|)
argument_list|,
name|index
operator|+
literal|1
argument_list|,
name|TRUE
argument_list|,
name|GIMP_ITEM_GET_CLASS
argument_list|(
name|item
argument_list|)
operator|->
name|lower_desc
argument_list|)
return|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_lower_item_to_bottom (GimpImage * image,GimpItem * item)
name|gimp_image_lower_item_to_bottom
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpItem
modifier|*
name|item
parameter_list|)
block|{
name|GimpContainer
modifier|*
name|container
decl_stmt|;
name|gint
name|length
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_ITEM
argument_list|(
name|item
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|container
operator|=
name|gimp_item_get_container
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|g_return_val_if_fail
argument_list|(
name|container
operator|!=
name|NULL
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|length
operator|=
name|gimp_container_get_n_children
argument_list|(
name|container
argument_list|)
expr_stmt|;
return|return
name|gimp_image_reorder_item
argument_list|(
name|image
argument_list|,
name|item
argument_list|,
name|gimp_item_get_parent
argument_list|(
name|item
argument_list|)
argument_list|,
name|length
operator|-
literal|1
argument_list|,
name|TRUE
argument_list|,
name|GIMP_ITEM_GET_CLASS
argument_list|(
name|item
argument_list|)
operator|->
name|lower_to_bottom_desc
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/*  layers  */
end_comment

begin_function
name|gboolean
DECL|function|gimp_image_add_layer (GimpImage * image,GimpLayer * layer,GimpLayer * parent,gint position,gboolean push_undo)
name|gimp_image_add_layer
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpLayer
modifier|*
name|layer
parameter_list|,
name|GimpLayer
modifier|*
name|parent
parameter_list|,
name|gint
name|position
parameter_list|,
name|gboolean
name|push_undo
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|gboolean
name|old_has_alpha
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*  item and parent are type-checked in GimpItemTree    */
if|if
condition|(
operator|!
name|gimp_item_tree_get_insert_pos
argument_list|(
name|private
operator|->
name|layers
argument_list|,
operator|(
name|GimpItem
operator|*
operator|)
name|layer
argument_list|,
operator|(
name|GimpItem
operator|*
operator|*
operator|)
operator|&
name|parent
argument_list|,
operator|&
name|position
argument_list|)
condition|)
return|return
name|FALSE
return|;
comment|/*  If there is a floating selection (and this isn't it!),    *  make sure the insert position is greater than 0    */
if|if
condition|(
name|parent
operator|==
name|NULL
operator|&&
name|position
operator|==
literal|0
operator|&&
name|gimp_image_get_floating_selection
argument_list|(
name|image
argument_list|)
condition|)
name|position
operator|=
literal|1
expr_stmt|;
name|old_has_alpha
operator|=
name|gimp_image_has_alpha
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|push_undo
condition|)
name|gimp_image_undo_push_layer_add
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Add Layer"
argument_list|)
argument_list|,
name|layer
argument_list|,
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_item_tree_add_item
argument_list|(
name|private
operator|->
name|layers
argument_list|,
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|,
name|GIMP_ITEM
argument_list|(
name|parent
argument_list|)
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|gimp_image_set_active_layer
argument_list|(
name|image
argument_list|,
name|layer
argument_list|)
expr_stmt|;
comment|/*  If the layer is a floating selection, attach it to the drawable  */
if|if
condition|(
name|gimp_layer_is_floating_sel
argument_list|(
name|layer
argument_list|)
condition|)
name|gimp_drawable_attach_floating_sel
argument_list|(
name|gimp_layer_get_floating_sel_drawable
argument_list|(
name|layer
argument_list|)
argument_list|,
name|layer
argument_list|)
expr_stmt|;
if|if
condition|(
name|old_has_alpha
operator|!=
name|gimp_image_has_alpha
argument_list|(
name|image
argument_list|)
condition|)
name|private
operator|->
name|flush_accum
operator|.
name|alpha_changed
operator|=
name|TRUE
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_remove_layer (GimpImage * image,GimpLayer * layer,gboolean push_undo,GimpLayer * new_active)
name|gimp_image_remove_layer
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpLayer
modifier|*
name|layer
parameter_list|,
name|gboolean
name|push_undo
parameter_list|,
name|GimpLayer
modifier|*
name|new_active
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpLayer
modifier|*
name|active_layer
decl_stmt|;
name|gboolean
name|old_has_alpha
decl_stmt|;
name|gboolean
name|undo_group
init|=
name|FALSE
decl_stmt|;
specifier|const
name|gchar
modifier|*
name|undo_desc
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_LAYER
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gimp_item_is_attached
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gimp_item_get_image
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
operator|==
name|image
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_drawable_get_floating_sel
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|push_undo
condition|)
block|{
name|g_warning
argument_list|(
literal|"%s() was called from an undo function while the layer "
literal|"had a floating selection. Please report this at "
literal|"http://www.gimp.org/bugs/"
argument_list|,
name|G_STRFUNC
argument_list|)
expr_stmt|;
return|return;
block|}
name|gimp_image_undo_group_start
argument_list|(
name|image
argument_list|,
name|GIMP_UNDO_GROUP_IMAGE_ITEM_REMOVE
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Remove Layer"
argument_list|)
argument_list|)
expr_stmt|;
name|undo_group
operator|=
name|TRUE
expr_stmt|;
name|gimp_image_remove_layer
argument_list|(
name|image
argument_list|,
name|gimp_drawable_get_floating_sel
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|active_layer
operator|=
name|gimp_image_get_active_layer
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|old_has_alpha
operator|=
name|gimp_image_has_alpha
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_layer_is_floating_sel
argument_list|(
name|layer
argument_list|)
condition|)
block|{
name|undo_desc
operator|=
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Remove Floating Selection"
argument_list|)
expr_stmt|;
name|gimp_drawable_detach_floating_sel
argument_list|(
name|gimp_layer_get_floating_sel_drawable
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|undo_desc
operator|=
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Remove Layer"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|push_undo
condition|)
name|gimp_image_undo_push_layer_remove
argument_list|(
name|image
argument_list|,
name|undo_desc
argument_list|,
name|layer
argument_list|,
name|gimp_layer_get_parent
argument_list|(
name|layer
argument_list|)
argument_list|,
name|gimp_item_get_index
argument_list|(
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|)
argument_list|,
name|active_layer
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|layer
argument_list|)
expr_stmt|;
comment|/*  Make sure we're not caching any old selection info  */
if|if
condition|(
name|layer
operator|==
name|active_layer
condition|)
name|gimp_drawable_invalidate_boundary
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
expr_stmt|;
name|private
operator|->
name|layer_stack
operator|=
name|g_slist_remove
argument_list|(
name|private
operator|->
name|layer_stack
argument_list|,
name|layer
argument_list|)
expr_stmt|;
comment|/*  Also remove all children of a group layer from the layer_stack  */
if|if
condition|(
name|gimp_viewable_get_children
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
condition|)
block|{
name|GimpContainer
modifier|*
name|stack
init|=
name|gimp_viewable_get_children
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|layer
argument_list|)
argument_list|)
decl_stmt|;
name|GList
modifier|*
name|children
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|children
operator|=
name|gimp_item_stack_get_item_list
argument_list|(
name|GIMP_ITEM_STACK
argument_list|(
name|stack
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|children
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|private
operator|->
name|layer_stack
operator|=
name|g_slist_remove
argument_list|(
name|private
operator|->
name|layer_stack
argument_list|,
name|list
operator|->
name|data
argument_list|)
expr_stmt|;
block|}
name|g_list_free
argument_list|(
name|children
argument_list|)
expr_stmt|;
block|}
name|new_active
operator|=
name|GIMP_LAYER
argument_list|(
name|gimp_item_tree_remove_item
argument_list|(
name|private
operator|->
name|layers
argument_list|,
name|GIMP_ITEM
argument_list|(
name|layer
argument_list|)
argument_list|,
name|GIMP_ITEM
argument_list|(
name|new_active
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_layer_is_floating_sel
argument_list|(
name|layer
argument_list|)
condition|)
block|{
comment|/*  If this was the floating selection, activate the underlying drawable        */
name|floating_sel_activate_drawable
argument_list|(
name|layer
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|active_layer
operator|&&
operator|(
name|layer
operator|==
name|active_layer
operator|||
name|gimp_viewable_is_ancestor
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|layer
argument_list|)
argument_list|,
name|GIMP_VIEWABLE
argument_list|(
name|active_layer
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|gimp_image_set_active_layer
argument_list|(
name|image
argument_list|,
name|new_active
argument_list|)
expr_stmt|;
block|}
name|g_object_unref
argument_list|(
name|layer
argument_list|)
expr_stmt|;
if|if
condition|(
name|old_has_alpha
operator|!=
name|gimp_image_has_alpha
argument_list|(
name|image
argument_list|)
condition|)
name|private
operator|->
name|flush_accum
operator|.
name|alpha_changed
operator|=
name|TRUE
expr_stmt|;
if|if
condition|(
name|undo_group
condition|)
name|gimp_image_undo_group_end
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_add_layers (GimpImage * image,GList * layers,GimpLayer * parent,gint position,gint x,gint y,gint width,gint height,const gchar * undo_desc)
name|gimp_image_add_layers
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GList
modifier|*
name|layers
parameter_list|,
name|GimpLayer
modifier|*
name|parent
parameter_list|,
name|gint
name|position
parameter_list|,
name|gint
name|x
parameter_list|,
name|gint
name|y
parameter_list|,
name|gint
name|width
parameter_list|,
name|gint
name|height
parameter_list|,
specifier|const
name|gchar
modifier|*
name|undo_desc
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|gint
name|layers_x
init|=
name|G_MAXINT
decl_stmt|;
name|gint
name|layers_y
init|=
name|G_MAXINT
decl_stmt|;
name|gint
name|layers_width
init|=
literal|0
decl_stmt|;
name|gint
name|layers_height
init|=
literal|0
decl_stmt|;
name|gint
name|offset_x
decl_stmt|;
name|gint
name|offset_y
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|layers
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*  item and parent are type-checked in GimpItemTree    */
if|if
condition|(
operator|!
name|gimp_item_tree_get_insert_pos
argument_list|(
name|private
operator|->
name|layers
argument_list|,
operator|(
name|GimpItem
operator|*
operator|)
name|layers
operator|->
name|data
argument_list|,
operator|(
name|GimpItem
operator|*
operator|*
operator|)
operator|&
name|parent
argument_list|,
operator|&
name|position
argument_list|)
condition|)
return|return;
for|for
control|(
name|list
operator|=
name|layers
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpItem
modifier|*
name|item
init|=
name|GIMP_ITEM
argument_list|(
name|list
operator|->
name|data
argument_list|)
decl_stmt|;
name|gint
name|off_x
decl_stmt|,
name|off_y
decl_stmt|;
name|gimp_item_get_offset
argument_list|(
name|item
argument_list|,
operator|&
name|off_x
argument_list|,
operator|&
name|off_y
argument_list|)
expr_stmt|;
name|layers_x
operator|=
name|MIN
argument_list|(
name|layers_x
argument_list|,
name|off_x
argument_list|)
expr_stmt|;
name|layers_y
operator|=
name|MIN
argument_list|(
name|layers_y
argument_list|,
name|off_y
argument_list|)
expr_stmt|;
name|layers_width
operator|=
name|MAX
argument_list|(
name|layers_width
argument_list|,
name|off_x
operator|+
name|gimp_item_get_width
argument_list|(
name|item
argument_list|)
operator|-
name|layers_x
argument_list|)
expr_stmt|;
name|layers_height
operator|=
name|MAX
argument_list|(
name|layers_height
argument_list|,
name|off_y
operator|+
name|gimp_item_get_height
argument_list|(
name|item
argument_list|)
operator|-
name|layers_y
argument_list|)
expr_stmt|;
block|}
name|offset_x
operator|=
name|x
operator|+
operator|(
name|width
operator|-
name|layers_width
operator|)
operator|/
literal|2
operator|-
name|layers_x
expr_stmt|;
name|offset_y
operator|=
name|y
operator|+
operator|(
name|height
operator|-
name|layers_height
operator|)
operator|/
literal|2
operator|-
name|layers_y
expr_stmt|;
name|gimp_image_undo_group_start
argument_list|(
name|image
argument_list|,
name|GIMP_UNDO_GROUP_LAYER_ADD
argument_list|,
name|undo_desc
argument_list|)
expr_stmt|;
for|for
control|(
name|list
operator|=
name|layers
init|;
name|list
condition|;
name|list
operator|=
name|g_list_next
argument_list|(
name|list
argument_list|)
control|)
block|{
name|GimpItem
modifier|*
name|new_item
init|=
name|GIMP_ITEM
argument_list|(
name|list
operator|->
name|data
argument_list|)
decl_stmt|;
name|gimp_item_translate
argument_list|(
name|new_item
argument_list|,
name|offset_x
argument_list|,
name|offset_y
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|gimp_image_add_layer
argument_list|(
name|image
argument_list|,
name|GIMP_LAYER
argument_list|(
name|new_item
argument_list|)
argument_list|,
name|parent
argument_list|,
name|position
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
name|position
operator|++
expr_stmt|;
block|}
if|if
condition|(
name|layers
condition|)
name|gimp_image_set_active_layer
argument_list|(
name|image
argument_list|,
name|layers
operator|->
name|data
argument_list|)
expr_stmt|;
name|gimp_image_undo_group_end
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  channels  */
end_comment

begin_function
name|gboolean
DECL|function|gimp_image_add_channel (GimpImage * image,GimpChannel * channel,GimpChannel * parent,gint position,gboolean push_undo)
name|gimp_image_add_channel
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|GimpChannel
modifier|*
name|parent
parameter_list|,
name|gint
name|position
parameter_list|,
name|gboolean
name|push_undo
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*  item and parent are type-checked in GimpItemTree    */
if|if
condition|(
operator|!
name|gimp_item_tree_get_insert_pos
argument_list|(
name|private
operator|->
name|channels
argument_list|,
operator|(
name|GimpItem
operator|*
operator|)
name|channel
argument_list|,
operator|(
name|GimpItem
operator|*
operator|*
operator|)
operator|&
name|parent
argument_list|,
operator|&
name|position
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|push_undo
condition|)
name|gimp_image_undo_push_channel_add
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Add Channel"
argument_list|)
argument_list|,
name|channel
argument_list|,
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_item_tree_add_item
argument_list|(
name|private
operator|->
name|channels
argument_list|,
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|,
name|GIMP_ITEM
argument_list|(
name|parent
argument_list|)
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|gimp_image_set_active_channel
argument_list|(
name|image
argument_list|,
name|channel
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_remove_channel (GimpImage * image,GimpChannel * channel,gboolean push_undo,GimpChannel * new_active)
name|gimp_image_remove_channel
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpChannel
modifier|*
name|channel
parameter_list|,
name|gboolean
name|push_undo
parameter_list|,
name|GimpChannel
modifier|*
name|new_active
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpChannel
modifier|*
name|active_channel
decl_stmt|;
name|gboolean
name|undo_group
init|=
name|FALSE
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_CHANNEL
argument_list|(
name|channel
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gimp_item_is_attached
argument_list|(
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gimp_item_get_image
argument_list|(
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|)
operator|==
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|gimp_drawable_get_floating_sel
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|push_undo
condition|)
block|{
name|g_warning
argument_list|(
literal|"%s() was called from an undo function while the channel "
literal|"had a floating selection. Please report this at "
literal|"http://www.gimp.org/bugs/"
argument_list|,
name|G_STRFUNC
argument_list|)
expr_stmt|;
return|return;
block|}
name|gimp_image_undo_group_start
argument_list|(
name|image
argument_list|,
name|GIMP_UNDO_GROUP_IMAGE_ITEM_REMOVE
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Remove Channel"
argument_list|)
argument_list|)
expr_stmt|;
name|undo_group
operator|=
name|TRUE
expr_stmt|;
name|gimp_image_remove_layer
argument_list|(
name|image
argument_list|,
name|gimp_drawable_get_floating_sel
argument_list|(
name|GIMP_DRAWABLE
argument_list|(
name|channel
argument_list|)
argument_list|)
argument_list|,
name|TRUE
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|active_channel
operator|=
name|gimp_image_get_active_channel
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|push_undo
condition|)
name|gimp_image_undo_push_channel_remove
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Remove Channel"
argument_list|)
argument_list|,
name|channel
argument_list|,
name|gimp_channel_get_parent
argument_list|(
name|channel
argument_list|)
argument_list|,
name|gimp_item_get_index
argument_list|(
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|)
argument_list|,
name|active_channel
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|channel
argument_list|)
expr_stmt|;
name|new_active
operator|=
name|GIMP_CHANNEL
argument_list|(
name|gimp_item_tree_remove_item
argument_list|(
name|private
operator|->
name|channels
argument_list|,
name|GIMP_ITEM
argument_list|(
name|channel
argument_list|)
argument_list|,
name|GIMP_ITEM
argument_list|(
name|new_active
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|active_channel
operator|&&
operator|(
name|channel
operator|==
name|active_channel
operator|||
name|gimp_viewable_is_ancestor
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|channel
argument_list|)
argument_list|,
name|GIMP_VIEWABLE
argument_list|(
name|active_channel
argument_list|)
argument_list|)
operator|)
condition|)
block|{
if|if
condition|(
name|new_active
condition|)
name|gimp_image_set_active_channel
argument_list|(
name|image
argument_list|,
name|new_active
argument_list|)
expr_stmt|;
else|else
name|gimp_image_unset_active_channel
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
name|g_object_unref
argument_list|(
name|channel
argument_list|)
expr_stmt|;
if|if
condition|(
name|undo_group
condition|)
name|gimp_image_undo_group_end
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/*  vectors  */
end_comment

begin_function
name|gboolean
DECL|function|gimp_image_add_vectors (GimpImage * image,GimpVectors * vectors,GimpVectors * parent,gint position,gboolean push_undo)
name|gimp_image_add_vectors
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpVectors
modifier|*
name|vectors
parameter_list|,
name|GimpVectors
modifier|*
name|parent
parameter_list|,
name|gint
name|position
parameter_list|,
name|gboolean
name|push_undo
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
comment|/*  item and parent are type-checked in GimpItemTree    */
if|if
condition|(
operator|!
name|gimp_item_tree_get_insert_pos
argument_list|(
name|private
operator|->
name|vectors
argument_list|,
operator|(
name|GimpItem
operator|*
operator|)
name|vectors
argument_list|,
operator|(
name|GimpItem
operator|*
operator|*
operator|)
operator|&
name|parent
argument_list|,
operator|&
name|position
argument_list|)
condition|)
return|return
name|FALSE
return|;
if|if
condition|(
name|push_undo
condition|)
name|gimp_image_undo_push_vectors_add
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Add Path"
argument_list|)
argument_list|,
name|vectors
argument_list|,
name|gimp_image_get_active_vectors
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_item_tree_add_item
argument_list|(
name|private
operator|->
name|vectors
argument_list|,
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|,
name|GIMP_ITEM
argument_list|(
name|parent
argument_list|)
argument_list|,
name|position
argument_list|)
expr_stmt|;
name|gimp_image_set_active_vectors
argument_list|(
name|image
argument_list|,
name|vectors
argument_list|)
expr_stmt|;
return|return
name|TRUE
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_remove_vectors (GimpImage * image,GimpVectors * vectors,gboolean push_undo,GimpVectors * new_active)
name|gimp_image_remove_vectors
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
name|GimpVectors
modifier|*
name|vectors
parameter_list|,
name|gboolean
name|push_undo
parameter_list|,
name|GimpVectors
modifier|*
name|new_active
parameter_list|)
block|{
name|GimpImagePrivate
modifier|*
name|private
decl_stmt|;
name|GimpVectors
modifier|*
name|active_vectors
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_VECTORS
argument_list|(
name|vectors
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gimp_item_is_attached
argument_list|(
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|g_return_if_fail
argument_list|(
name|gimp_item_get_image
argument_list|(
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|)
operator|==
name|image
argument_list|)
expr_stmt|;
name|private
operator|=
name|GIMP_IMAGE_GET_PRIVATE
argument_list|(
name|image
argument_list|)
expr_stmt|;
name|active_vectors
operator|=
name|gimp_image_get_active_vectors
argument_list|(
name|image
argument_list|)
expr_stmt|;
if|if
condition|(
name|push_undo
condition|)
name|gimp_image_undo_push_vectors_remove
argument_list|(
name|image
argument_list|,
name|C_
argument_list|(
literal|"undo-type"
argument_list|,
literal|"Remove Path"
argument_list|)
argument_list|,
name|vectors
argument_list|,
name|gimp_vectors_get_parent
argument_list|(
name|vectors
argument_list|)
argument_list|,
name|gimp_item_get_index
argument_list|(
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|)
argument_list|,
name|active_vectors
argument_list|)
expr_stmt|;
name|g_object_ref
argument_list|(
name|vectors
argument_list|)
expr_stmt|;
name|new_active
operator|=
name|GIMP_VECTORS
argument_list|(
name|gimp_item_tree_remove_item
argument_list|(
name|private
operator|->
name|vectors
argument_list|,
name|GIMP_ITEM
argument_list|(
name|vectors
argument_list|)
argument_list|,
name|GIMP_ITEM
argument_list|(
name|new_active
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|active_vectors
operator|&&
operator|(
name|vectors
operator|==
name|active_vectors
operator|||
name|gimp_viewable_is_ancestor
argument_list|(
name|GIMP_VIEWABLE
argument_list|(
name|vectors
argument_list|)
argument_list|,
name|GIMP_VIEWABLE
argument_list|(
name|active_vectors
argument_list|)
argument_list|)
operator|)
condition|)
block|{
name|gimp_image_set_active_vectors
argument_list|(
name|image
argument_list|,
name|new_active
argument_list|)
expr_stmt|;
block|}
name|g_object_unref
argument_list|(
name|vectors
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
name|gboolean
DECL|function|gimp_image_coords_in_active_pickable (GimpImage * image,const GimpCoords * coords,gboolean sample_merged,gboolean selected_only)
name|gimp_image_coords_in_active_pickable
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|,
specifier|const
name|GimpCoords
modifier|*
name|coords
parameter_list|,
name|gboolean
name|sample_merged
parameter_list|,
name|gboolean
name|selected_only
parameter_list|)
block|{
name|gint
name|x
decl_stmt|,
name|y
decl_stmt|;
name|gboolean
name|in_pickable
init|=
name|FALSE
decl_stmt|;
name|g_return_val_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
name|x
operator|=
name|floor
argument_list|(
name|coords
operator|->
name|x
argument_list|)
expr_stmt|;
name|y
operator|=
name|floor
argument_list|(
name|coords
operator|->
name|y
argument_list|)
expr_stmt|;
if|if
condition|(
name|sample_merged
condition|)
block|{
if|if
condition|(
name|x
operator|>=
literal|0
operator|&&
name|x
operator|<
name|gimp_image_get_width
argument_list|(
name|image
argument_list|)
operator|&&
name|y
operator|>=
literal|0
operator|&&
name|y
operator|<
name|gimp_image_get_height
argument_list|(
name|image
argument_list|)
condition|)
name|in_pickable
operator|=
name|TRUE
expr_stmt|;
block|}
else|else
block|{
name|GimpDrawable
modifier|*
name|drawable
init|=
name|gimp_image_get_active_drawable
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
name|drawable
condition|)
block|{
name|GimpItem
modifier|*
name|item
init|=
name|GIMP_ITEM
argument_list|(
name|drawable
argument_list|)
decl_stmt|;
name|gint
name|off_x
decl_stmt|,
name|off_y
decl_stmt|;
name|gint
name|d_x
decl_stmt|,
name|d_y
decl_stmt|;
name|gimp_item_get_offset
argument_list|(
name|item
argument_list|,
operator|&
name|off_x
argument_list|,
operator|&
name|off_y
argument_list|)
expr_stmt|;
name|d_x
operator|=
name|x
operator|-
name|off_x
expr_stmt|;
name|d_y
operator|=
name|y
operator|-
name|off_y
expr_stmt|;
if|if
condition|(
name|d_x
operator|>=
literal|0
operator|&&
name|d_x
operator|<
name|gimp_item_get_width
argument_list|(
name|item
argument_list|)
operator|&&
name|d_y
operator|>=
literal|0
operator|&&
name|d_y
operator|<
name|gimp_item_get_height
argument_list|(
name|item
argument_list|)
condition|)
name|in_pickable
operator|=
name|TRUE
expr_stmt|;
block|}
block|}
if|if
condition|(
name|in_pickable
operator|&&
name|selected_only
condition|)
block|{
name|GimpChannel
modifier|*
name|selection
init|=
name|gimp_image_get_mask
argument_list|(
name|image
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|gimp_channel_is_empty
argument_list|(
name|selection
argument_list|)
operator|&&
operator|!
name|gimp_pickable_get_opacity_at
argument_list|(
name|GIMP_PICKABLE
argument_list|(
name|selection
argument_list|)
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
condition|)
block|{
name|in_pickable
operator|=
name|FALSE
expr_stmt|;
block|}
block|}
return|return
name|in_pickable
return|;
block|}
end_function

begin_function
name|void
DECL|function|gimp_image_invalidate_previews (GimpImage * image)
name|gimp_image_invalidate_previews
parameter_list|(
name|GimpImage
modifier|*
name|image
parameter_list|)
block|{
name|GimpItemStack
modifier|*
name|layers
decl_stmt|;
name|GimpItemStack
modifier|*
name|channels
decl_stmt|;
name|g_return_if_fail
argument_list|(
name|GIMP_IS_IMAGE
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|layers
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_layers
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|channels
operator|=
name|GIMP_ITEM_STACK
argument_list|(
name|gimp_image_get_channels
argument_list|(
name|image
argument_list|)
argument_list|)
expr_stmt|;
name|gimp_item_stack_invalidate_previews
argument_list|(
name|layers
argument_list|)
expr_stmt|;
name|gimp_item_stack_invalidate_previews
argument_list|(
name|channels
argument_list|)
expr_stmt|;
block|}
end_function

end_unit

