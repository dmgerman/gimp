begin_unit|revision:0.9.5;language:C;cregit-version:0.0.1
begin_comment
comment|/* The GIMP -- an image manipulation program  * Copyright (C) 1995-1999 Spencer Kimball and Peter Mattis  *  * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 2 of the License, or  * (at your option) any later version.  *  * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *  * You should have received a copy of the GNU General Public License  * along with this program; if not, write to the Free Software  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
end_comment

begin_comment
comment|/* NOTE: This file is autogenerated by pdbgen.pl. */
end_comment

begin_include
include|#
directive|include
file|"config.h"
end_include

begin_include
include|#
directive|include
file|"procedural_db.h"
end_include

begin_include
include|#
directive|include
file|<stdio.h>
end_include

begin_include
include|#
directive|include
file|<stdlib.h>
end_include

begin_include
include|#
directive|include
file|<string.h>
end_include

begin_include
include|#
directive|include
file|"regex.h"
end_include

begin_include
include|#
directive|include
file|"libgimp/gimpintl.h"
end_include

begin_comment
comment|/*  Query structure  */
end_comment

begin_typedef
DECL|typedef|PDBQuery
typedef|typedef
name|struct
name|_PDBQuery
name|PDBQuery
typedef|;
end_typedef

begin_struct
DECL|struct|_PDBQuery
struct|struct
name|_PDBQuery
block|{
DECL|member|name_regex
name|regex_t
name|name_regex
decl_stmt|;
DECL|member|blurb_regex
name|regex_t
name|blurb_regex
decl_stmt|;
DECL|member|help_regex
name|regex_t
name|help_regex
decl_stmt|;
DECL|member|author_regex
name|regex_t
name|author_regex
decl_stmt|;
DECL|member|copyright_regex
name|regex_t
name|copyright_regex
decl_stmt|;
DECL|member|date_regex
name|regex_t
name|date_regex
decl_stmt|;
DECL|member|proc_type_regex
name|regex_t
name|proc_type_regex
decl_stmt|;
DECL|member|list_of_procs
name|gchar
modifier|*
modifier|*
name|list_of_procs
decl_stmt|;
DECL|member|num_procs
name|int
name|num_procs
decl_stmt|;
block|}
struct|;
end_struct

begin_typedef
DECL|typedef|PDBData
typedef|typedef
name|struct
name|_PDBData
name|PDBData
typedef|;
end_typedef

begin_struct
DECL|struct|_PDBData
struct|struct
name|_PDBData
block|{
DECL|member|identifier
name|gchar
modifier|*
name|identifier
decl_stmt|;
DECL|member|bytes
name|gint
name|bytes
decl_stmt|;
DECL|member|data
name|gchar
modifier|*
name|data
decl_stmt|;
block|}
struct|;
end_struct

begin_decl_stmt
DECL|variable|procedural_db_out
specifier|static
name|FILE
modifier|*
name|procedural_db_out
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|data_list
specifier|static
name|GList
modifier|*
name|data_list
init|=
name|NULL
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|proc_type_str
specifier|static
name|char
modifier|*
name|proc_type_str
index|[]
init|=
block|{
name|N_
argument_list|(
literal|"Internal GIMP procedure"
argument_list|)
block|,
name|N_
argument_list|(
literal|"GIMP Plug-In"
argument_list|)
block|,
name|N_
argument_list|(
literal|"GIMP Extension"
argument_list|)
block|,
name|N_
argument_list|(
literal|"Temporary Procedure"
argument_list|)
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|type_str
specifier|static
specifier|const
name|char
modifier|*
specifier|const
name|type_str
index|[]
init|=
block|{
literal|"PDB_INT32"
block|,
literal|"PDB_INT16"
block|,
literal|"PDB_INT8"
block|,
literal|"PDB_FLOAT"
block|,
literal|"PDB_STRING"
block|,
literal|"PDB_INT32ARRAY"
block|,
literal|"PDB_INT16ARRAY"
block|,
literal|"PDB_INT8ARRAY"
block|,
literal|"PDB_FLOATARRAY"
block|,
literal|"PDB_STRINGARRAY"
block|,
literal|"PDB_COLOR"
block|,
literal|"PDB_REGION"
block|,
literal|"PDB_DISPLAY"
block|,
literal|"PDB_IMAGE"
block|,
literal|"PDB_LAYER"
block|,
literal|"PDB_CHANNEL"
block|,
literal|"PDB_DRAWABLE"
block|,
literal|"PDB_SELECTION"
block|,
literal|"PDB_BOUNDARY"
block|,
literal|"PDB_PATH"
block|,
literal|"PDB_PARASITE"
block|,
literal|"PDB_STATUS"
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_dump_proc
specifier|static
name|ProcRecord
name|procedural_db_dump_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_query_proc
specifier|static
name|ProcRecord
name|procedural_db_query_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_info_proc
specifier|static
name|ProcRecord
name|procedural_db_proc_info_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_arg_proc
specifier|static
name|ProcRecord
name|procedural_db_proc_arg_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_val_proc
specifier|static
name|ProcRecord
name|procedural_db_proc_val_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_get_data_proc
specifier|static
name|ProcRecord
name|procedural_db_get_data_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_get_data_size_proc
specifier|static
name|ProcRecord
name|procedural_db_get_data_size_proc
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_set_data_proc
specifier|static
name|ProcRecord
name|procedural_db_set_data_proc
decl_stmt|;
end_decl_stmt

begin_function
name|void
DECL|function|register_procedural_db_procs (void)
name|register_procedural_db_procs
parameter_list|(
name|void
parameter_list|)
block|{
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_dump_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_query_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_proc_info_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_proc_arg_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_proc_val_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_get_data_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_get_data_size_proc
argument_list|)
expr_stmt|;
name|procedural_db_register
argument_list|(
operator|&
name|procedural_db_set_data_proc
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|int
DECL|function|match_strings (regex_t * preg,gchar * a)
name|match_strings
parameter_list|(
name|regex_t
modifier|*
name|preg
parameter_list|,
name|gchar
modifier|*
name|a
parameter_list|)
block|{
return|return
name|regexec
argument_list|(
name|preg
argument_list|,
name|a
argument_list|,
literal|0
argument_list|,
name|NULL
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|procedural_db_query_entry (gpointer key,gpointer value,gpointer user_data)
name|procedural_db_query_entry
parameter_list|(
name|gpointer
name|key
parameter_list|,
name|gpointer
name|value
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|GList
modifier|*
name|list
decl_stmt|;
name|ProcRecord
modifier|*
name|proc
decl_stmt|;
name|PDBQuery
modifier|*
name|pdb_query
decl_stmt|;
name|int
name|new_length
decl_stmt|;
name|list
operator|=
operator|(
name|GList
operator|*
operator|)
name|value
expr_stmt|;
name|proc
operator|=
operator|(
name|ProcRecord
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|pdb_query
operator|=
operator|(
name|PDBQuery
operator|*
operator|)
name|user_data
expr_stmt|;
if|if
condition|(
operator|!
name|match_strings
argument_list|(
operator|&
name|pdb_query
operator|->
name|name_regex
argument_list|,
name|proc
operator|->
name|name
argument_list|)
operator|&&
operator|!
name|match_strings
argument_list|(
operator|&
name|pdb_query
operator|->
name|blurb_regex
argument_list|,
name|proc
operator|->
name|blurb
argument_list|)
operator|&&
operator|!
name|match_strings
argument_list|(
operator|&
name|pdb_query
operator|->
name|help_regex
argument_list|,
name|proc
operator|->
name|help
argument_list|)
operator|&&
operator|!
name|match_strings
argument_list|(
operator|&
name|pdb_query
operator|->
name|author_regex
argument_list|,
name|proc
operator|->
name|author
argument_list|)
operator|&&
operator|!
name|match_strings
argument_list|(
operator|&
name|pdb_query
operator|->
name|copyright_regex
argument_list|,
name|proc
operator|->
name|copyright
argument_list|)
operator|&&
operator|!
name|match_strings
argument_list|(
operator|&
name|pdb_query
operator|->
name|date_regex
argument_list|,
name|proc
operator|->
name|date
argument_list|)
operator|&&
operator|!
name|match_strings
argument_list|(
operator|&
name|pdb_query
operator|->
name|proc_type_regex
argument_list|,
name|proc_type_str
index|[
operator|(
name|int
operator|)
name|proc
operator|->
name|proc_type
index|]
argument_list|)
condition|)
block|{
name|new_length
operator|=
name|proc
operator|->
name|name
condition|?
operator|(
name|strlen
argument_list|(
name|proc
operator|->
name|name
argument_list|)
operator|+
literal|1
operator|)
else|:
literal|0
expr_stmt|;
if|if
condition|(
name|new_length
condition|)
block|{
name|pdb_query
operator|->
name|num_procs
operator|++
expr_stmt|;
name|pdb_query
operator|->
name|list_of_procs
operator|=
name|g_realloc
argument_list|(
name|pdb_query
operator|->
name|list_of_procs
argument_list|,
operator|(
sizeof|sizeof
argument_list|(
name|gchar
operator|*
operator|*
argument_list|)
operator|*
name|pdb_query
operator|->
name|num_procs
operator|)
argument_list|)
expr_stmt|;
name|pdb_query
operator|->
name|list_of_procs
index|[
name|pdb_query
operator|->
name|num_procs
operator|-
literal|1
index|]
operator|=
name|g_strdup
argument_list|(
name|proc
operator|->
name|name
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|output_string (const char * string)
name|output_string
parameter_list|(
specifier|const
name|char
modifier|*
name|string
parameter_list|)
block|{
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"\""
argument_list|)
expr_stmt|;
while|while
condition|(
operator|*
name|string
condition|)
block|{
switch|switch
condition|(
operator|*
name|string
condition|)
block|{
case|case
literal|'\\'
case|:
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"\\\\"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'\"'
case|:
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"\\\""
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'{'
case|:
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"@{"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'@'
case|:
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"@@"
argument_list|)
expr_stmt|;
break|break;
case|case
literal|'}'
case|:
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"@}"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"%c"
argument_list|,
operator|*
name|string
argument_list|)
expr_stmt|;
block|}
name|string
operator|++
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"\"\n"
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|static
name|void
DECL|function|procedural_db_print_entry (gpointer key,gpointer value,gpointer user_data)
name|procedural_db_print_entry
parameter_list|(
name|gpointer
name|key
parameter_list|,
name|gpointer
name|value
parameter_list|,
name|gpointer
name|user_data
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|ProcRecord
modifier|*
name|procedure
decl_stmt|;
name|GList
modifier|*
name|list
init|=
operator|(
name|GList
operator|*
operator|)
name|value
decl_stmt|;
name|int
name|num
init|=
literal|0
decl_stmt|;
name|GString
modifier|*
name|buf
init|=
name|g_string_new
argument_list|(
literal|""
argument_list|)
decl_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|num
operator|++
expr_stmt|;
name|procedure
operator|=
operator|(
name|ProcRecord
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"\n(register-procedure "
argument_list|)
expr_stmt|;
if|if
condition|(
name|list
operator|||
name|num
operator|!=
literal|1
condition|)
block|{
name|g_string_sprintf
argument_list|(
name|buf
argument_list|,
literal|"%s<%d>"
argument_list|,
name|procedure
operator|->
name|name
argument_list|,
name|num
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|buf
operator|->
name|str
argument_list|)
expr_stmt|;
block|}
else|else
name|output_string
argument_list|(
name|procedure
operator|->
name|name
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|blurb
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|help
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|author
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|copyright
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|date
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|proc_type_str
index|[
operator|(
name|int
operator|)
name|procedure
operator|->
name|proc_type
index|]
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"( "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|procedure
operator|->
name|num_args
condition|;
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"( "
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|args
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|type_str
index|[
name|procedure
operator|->
name|args
index|[
name|i
index|]
operator|.
name|arg_type
index|]
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|args
index|[
name|i
index|]
operator|.
name|description
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|" ) "
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|" ) "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"( "
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|procedure
operator|->
name|num_values
condition|;
name|i
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|"( "
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|values
index|[
name|i
index|]
operator|.
name|name
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|type_str
index|[
name|procedure
operator|->
name|values
index|[
name|i
index|]
operator|.
name|arg_type
index|]
argument_list|)
expr_stmt|;
name|output_string
argument_list|(
name|procedure
operator|->
name|values
index|[
name|i
index|]
operator|.
name|description
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|" ) "
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|" ) "
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|procedural_db_out
argument_list|,
literal|" ) "
argument_list|)
expr_stmt|;
block|}
name|g_string_free
argument_list|(
name|buf
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/* This really doesn't belong here, but it depends on our generated type_str  * array.  */
end_comment

begin_function
specifier|const
name|char
modifier|*
DECL|function|pdb_type_name (gint type)
name|pdb_type_name
parameter_list|(
name|gint
name|type
parameter_list|)
block|{
if|if
condition|(
name|type
operator|>=
literal|0
operator|&&
name|type
operator|<=
name|PDB_END
condition|)
return|return
name|type_str
index|[
name|type
index|]
return|;
else|else
return|return
name|g_strdup_printf
argument_list|(
literal|"(PDB type %d unknown)"
argument_list|,
name|type
argument_list|)
return|;
comment|/* Yeah, we leak the memory.  But then you shouldn't try and     * get the name of a PDB type that doesn't exist, should you.     */
block|}
end_function

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_dump_invoker (Argument * args)
name|procedural_db_dump_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|filename
decl_stmt|;
name|filename
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|filename
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
if|if
condition|(
operator|(
name|procedural_db_out
operator|=
name|fopen
argument_list|(
name|filename
argument_list|,
literal|"w"
argument_list|)
operator|)
condition|)
block|{
name|g_hash_table_foreach
argument_list|(
name|procedural_ht
argument_list|,
name|procedural_db_print_entry
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
name|fclose
argument_list|(
name|procedural_db_out
argument_list|)
expr_stmt|;
block|}
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_dump_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_dump_inargs
specifier|static
name|ProcArg
name|procedural_db_dump_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"filename"
block|,
literal|"The dump filename"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_dump_proc
specifier|static
name|ProcRecord
name|procedural_db_dump_proc
init|=
block|{
literal|"gimp_procedural_db_dump"
block|,
literal|"Dumps the current contents of the procedural database"
block|,
literal|"This procedure dumps the contents of the procedural database to the specified file. The file will contain all of the information provided for each registered procedure. This file is in a format appropriate for use with the supplied \"pdb_self_doc.el\" Elisp script, which generates a texinfo document."
block|,
literal|"Spencer Kimball& Josh MacDonald"
block|,
literal|"Spencer Kimball& Josh MacDonald& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|PDB_INTERNAL
block|,
literal|1
block|,
name|procedural_db_dump_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|procedural_db_dump_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_query_invoker (Argument * args)
name|procedural_db_query_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|name
decl_stmt|;
name|gchar
modifier|*
name|blurb
decl_stmt|;
name|gchar
modifier|*
name|help
decl_stmt|;
name|gchar
modifier|*
name|author
decl_stmt|;
name|gchar
modifier|*
name|copyright
decl_stmt|;
name|gchar
modifier|*
name|date
decl_stmt|;
name|gchar
modifier|*
name|proc_type
decl_stmt|;
name|PDBQuery
name|pdb_query
decl_stmt|;
name|name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|name
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|blurb
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|blurb
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|help
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|help
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|author
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|author
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|copyright
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|copyright
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|date
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|date
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|proc_type
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|6
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|proc_type
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|regcomp
argument_list|(
operator|&
name|pdb_query
operator|.
name|name_regex
argument_list|,
name|name
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|regcomp
argument_list|(
operator|&
name|pdb_query
operator|.
name|blurb_regex
argument_list|,
name|blurb
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|regcomp
argument_list|(
operator|&
name|pdb_query
operator|.
name|help_regex
argument_list|,
name|help
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|regcomp
argument_list|(
operator|&
name|pdb_query
operator|.
name|author_regex
argument_list|,
name|author
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|regcomp
argument_list|(
operator|&
name|pdb_query
operator|.
name|copyright_regex
argument_list|,
name|copyright
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|regcomp
argument_list|(
operator|&
name|pdb_query
operator|.
name|date_regex
argument_list|,
name|date
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|regcomp
argument_list|(
operator|&
name|pdb_query
operator|.
name|proc_type_regex
argument_list|,
name|proc_type
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|pdb_query
operator|.
name|list_of_procs
operator|=
name|NULL
expr_stmt|;
name|pdb_query
operator|.
name|num_procs
operator|=
literal|0
expr_stmt|;
name|g_hash_table_foreach
argument_list|(
name|procedural_ht
argument_list|,
name|procedural_db_query_entry
argument_list|,
operator|&
name|pdb_query
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pdb_query
operator|.
name|name_regex
operator|.
name|buffer
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pdb_query
operator|.
name|blurb_regex
operator|.
name|buffer
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pdb_query
operator|.
name|help_regex
operator|.
name|buffer
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pdb_query
operator|.
name|author_regex
operator|.
name|buffer
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pdb_query
operator|.
name|copyright_regex
operator|.
name|buffer
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pdb_query
operator|.
name|date_regex
operator|.
name|buffer
argument_list|)
expr_stmt|;
name|free
argument_list|(
name|pdb_query
operator|.
name|proc_type_regex
operator|.
name|buffer
argument_list|)
expr_stmt|;
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_query_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|pdb_query
operator|.
name|num_procs
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|pdb_query
operator|.
name|list_of_procs
expr_stmt|;
block|}
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_query_inargs
specifier|static
name|ProcArg
name|procedural_db_query_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"name"
block|,
literal|"The regex for procedure name"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"blurb"
block|,
literal|"The regex for procedure blurb"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"help"
block|,
literal|"The regex for procedure help"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"author"
block|,
literal|"The regex for procedure author"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"copyright"
block|,
literal|"The regex for procedure copyright"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"date"
block|,
literal|"The regex for procedure date"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"proc_type"
block|,
literal|"The regex for procedure type: { 'Internal GIMP procedure', 'GIMP Plug-in', 'GIMP Extension' }"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_query_outargs
specifier|static
name|ProcArg
name|procedural_db_query_outargs
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"num_matches"
block|,
literal|"The number of matching procedures"
block|}
block|,
block|{
name|PDB_STRINGARRAY
block|,
literal|"procedure_names"
block|,
literal|"The list of procedure names"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_query_proc
specifier|static
name|ProcRecord
name|procedural_db_query_proc
init|=
block|{
literal|"gimp_procedural_db_query"
block|,
literal|"Queries the procedural database for its contents using regular expression matching."
block|,
literal|"This procedure queries the contents of the procedural database. It is supplied with seven arguments matching procedures on { name, blurb, help, author, copyright, date, procedure type}. This is accomplished using regular expression matching. For instance, to find all procedures with \"jpeg\" listed in the blurb, all seven arguments can be supplied as \".*\", except for the second, which can be supplied as \".*jpeg.*\". There are two return arguments for this procedure. The first is the number of procedures matching the query. The second is a concatenated list of procedure names corresponding to those matching the query. If no matching entries are found, then the returned string is NULL and the number of entries is 0."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1995-1996"
block|,
name|PDB_INTERNAL
block|,
literal|7
block|,
name|procedural_db_query_inargs
block|,
literal|2
block|,
name|procedural_db_query_outargs
block|,
block|{
block|{
name|procedural_db_query_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_proc_info_invoker (Argument * args)
name|procedural_db_proc_info_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|proc_name
decl_stmt|;
name|ProcRecord
modifier|*
name|proc
init|=
name|NULL
decl_stmt|;
name|proc_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|proc_name
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
name|success
operator|=
operator|(
name|proc
operator|=
name|procedural_db_lookup
argument_list|(
name|proc_name
argument_list|)
operator|)
operator|!=
name|NULL
expr_stmt|;
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_proc_info_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|proc
operator|->
name|blurb
argument_list|)
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|proc
operator|->
name|help
argument_list|)
expr_stmt|;
name|return_args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|proc
operator|->
name|author
argument_list|)
expr_stmt|;
name|return_args
index|[
literal|4
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|proc
operator|->
name|copyright
argument_list|)
expr_stmt|;
name|return_args
index|[
literal|5
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|proc
operator|->
name|date
argument_list|)
expr_stmt|;
name|return_args
index|[
literal|6
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|proc
operator|->
name|proc_type
expr_stmt|;
name|return_args
index|[
literal|7
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|proc
operator|->
name|num_args
expr_stmt|;
name|return_args
index|[
literal|8
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|proc
operator|->
name|num_values
expr_stmt|;
block|}
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_proc_info_inargs
specifier|static
name|ProcArg
name|procedural_db_proc_info_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"procedure"
block|,
literal|"The procedure name"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_info_outargs
specifier|static
name|ProcArg
name|procedural_db_proc_info_outargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"blurb"
block|,
literal|"A short blurb"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"help"
block|,
literal|"Detailed procedure help"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"author"
block|,
literal|"Author(s) of the procedure"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"copyright"
block|,
literal|"The copyright"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"date"
block|,
literal|"Copyright date"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"proc_type"
block|,
literal|"The procedure type: { INTERNAL (0), PLUGIN (1), EXTENSION (2) }"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"num_args"
block|,
literal|"The number of input arguments"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"num_values"
block|,
literal|"The number of return values"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_info_proc
specifier|static
name|ProcRecord
name|procedural_db_proc_info_proc
init|=
block|{
literal|"gimp_procedural_db_proc_info"
block|,
literal|"Queries the procedural database for information on the specified procedure."
block|,
literal|"This procedure returns information on the specified procedure. A short blurb, detailed help, author(s), copyright information, procedure type, number of input, and number of return values are returned. For specific information on each input argument and return value, use the 'gimp_procedural_db_query_proc_arg' and 'gimp_procedural_db_query_proc_val' procedures."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
literal|1
block|,
name|procedural_db_proc_info_inargs
block|,
literal|8
block|,
name|procedural_db_proc_info_outargs
block|,
block|{
block|{
name|procedural_db_proc_info_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_proc_arg_invoker (Argument * args)
name|procedural_db_proc_arg_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|proc_name
decl_stmt|;
name|gint32
name|arg_num
decl_stmt|;
name|ProcRecord
modifier|*
name|proc
decl_stmt|;
name|ProcArg
modifier|*
name|arg
init|=
name|NULL
decl_stmt|;
name|proc_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|proc_name
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|arg_num
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|proc
operator|=
name|procedural_db_lookup
argument_list|(
name|proc_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|proc
operator|&&
operator|(
name|arg_num
operator|>=
literal|0
operator|&&
name|arg_num
operator|<
name|proc
operator|->
name|num_args
operator|)
condition|)
name|arg
operator|=
operator|&
name|proc
operator|->
name|args
index|[
name|arg_num
index|]
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_proc_arg_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|arg
operator|->
name|arg_type
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|arg
operator|->
name|name
argument_list|)
expr_stmt|;
name|return_args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|arg
operator|->
name|description
argument_list|)
expr_stmt|;
block|}
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_proc_arg_inargs
specifier|static
name|ProcArg
name|procedural_db_proc_arg_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"procedure"
block|,
literal|"The procedure name"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"arg_num"
block|,
literal|"The argument number"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_arg_outargs
specifier|static
name|ProcArg
name|procedural_db_proc_arg_outargs
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"arg_type"
block|,
literal|"The type of argument { PDB_INT32 (0), PDB_INT16 (1), PDB_INT8 (2), PDB_FLOAT (3), PDB_STRING (4), PDB_INT32ARRAY (5), PDB_INT16ARRAY (6), PDB_INT8ARRAY (7), PDB_FLOATARRAY (8), PDB_STRINGARRAY (9), PDB_COLOR (10), PDB_REGION (11), PDB_DISPLAY (12), PDB_IMAGE (13), PDB_LAYER (14), PDB_CHANNEL (15), PDB_DRAWABLE (16), PDB_SELECTION (17), PDB_BOUNDARY (18), PDB_PATH (19), PDB_PARASITE (20), PDB_STATUS (21) }"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"arg_name"
block|,
literal|"The name of the argument"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"arg_desc"
block|,
literal|"A description of the argument"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_arg_proc
specifier|static
name|ProcRecord
name|procedural_db_proc_arg_proc
init|=
block|{
literal|"gimp_procedural_db_proc_arg"
block|,
literal|"Queries the procedural database for information on the specified procedure's argument."
block|,
literal|"This procedure returns information on the specified procedure's argument. The argument type, name, and a description are retrieved."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
literal|2
block|,
name|procedural_db_proc_arg_inargs
block|,
literal|3
block|,
name|procedural_db_proc_arg_outargs
block|,
block|{
block|{
name|procedural_db_proc_arg_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_proc_val_invoker (Argument * args)
name|procedural_db_proc_val_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|proc_name
decl_stmt|;
name|gint32
name|val_num
decl_stmt|;
name|ProcRecord
modifier|*
name|proc
decl_stmt|;
name|ProcArg
modifier|*
name|val
init|=
name|NULL
decl_stmt|;
name|proc_name
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|proc_name
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|val_num
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|proc
operator|=
name|procedural_db_lookup
argument_list|(
name|proc_name
argument_list|)
expr_stmt|;
if|if
condition|(
name|proc
operator|&&
operator|(
name|val_num
operator|>=
literal|0
operator|&&
name|val_num
operator|<
name|proc
operator|->
name|num_values
operator|)
condition|)
name|val
operator|=
operator|&
name|proc
operator|->
name|values
index|[
name|val_num
index|]
expr_stmt|;
else|else
name|success
operator|=
name|FALSE
expr_stmt|;
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_proc_val_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|val
operator|->
name|arg_type
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|val
operator|->
name|name
argument_list|)
expr_stmt|;
name|return_args
index|[
literal|3
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|g_strdup
argument_list|(
name|val
operator|->
name|description
argument_list|)
expr_stmt|;
block|}
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_proc_val_inargs
specifier|static
name|ProcArg
name|procedural_db_proc_val_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"procedure"
block|,
literal|"The procedure name"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"val_num"
block|,
literal|"The return value number"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_val_outargs
specifier|static
name|ProcArg
name|procedural_db_proc_val_outargs
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"val_type"
block|,
literal|"The type of return value { PDB_INT32 (0), PDB_INT16 (1), PDB_INT8 (2), PDB_FLOAT (3), PDB_STRING (4), PDB_INT32ARRAY (5), PDB_INT16ARRAY (6), PDB_INT8ARRAY (7), PDB_FLOATARRAY (8), PDB_STRINGARRAY (9), PDB_COLOR (10), PDB_REGION (11), PDB_DISPLAY (12), PDB_IMAGE (13), PDB_LAYER (14), PDB_CHANNEL (15), PDB_DRAWABLE (16), PDB_SELECTION (17), PDB_BOUNDARY (18), PDB_PATH (19), PDB_PARASITE (20), PDB_STATUS (21) }"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"val_name"
block|,
literal|"The name of the return value"
block|}
block|,
block|{
name|PDB_STRING
block|,
literal|"val_desc"
block|,
literal|"A description of the return value"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_proc_val_proc
specifier|static
name|ProcRecord
name|procedural_db_proc_val_proc
init|=
block|{
literal|"gimp_procedural_db_proc_val"
block|,
literal|"Queries the procedural database for information on the specified procedure's return value."
block|,
literal|"This procedure returns information on the specified procedure's return value. The return value type, name, and a description are retrieved."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
literal|2
block|,
name|procedural_db_proc_val_inargs
block|,
literal|3
block|,
name|procedural_db_proc_val_outargs
block|,
block|{
block|{
name|procedural_db_proc_val_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_get_data_invoker (Argument * args)
name|procedural_db_get_data_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|identifier
decl_stmt|;
name|gint8
modifier|*
name|data_copy
init|=
name|NULL
decl_stmt|;
name|PDBData
modifier|*
name|data
init|=
name|NULL
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|identifier
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|identifier
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|success
operator|=
name|FALSE
expr_stmt|;
name|list
operator|=
name|data_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|data
operator|=
operator|(
name|PDBData
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|data
operator|->
name|identifier
argument_list|,
name|identifier
argument_list|)
condition|)
block|{
name|data_copy
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
name|data
operator|->
name|bytes
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|data_copy
argument_list|,
name|data
operator|->
name|data
argument_list|,
name|data
operator|->
name|bytes
argument_list|)
expr_stmt|;
name|success
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
block|}
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_get_data_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|data
operator|->
name|bytes
expr_stmt|;
name|return_args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
operator|=
name|data_copy
expr_stmt|;
block|}
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_get_data_inargs
specifier|static
name|ProcArg
name|procedural_db_get_data_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"identifier"
block|,
literal|"The identifier associated with data"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_get_data_outargs
specifier|static
name|ProcArg
name|procedural_db_get_data_outargs
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"bytes"
block|,
literal|"The number of bytes in the data"
block|}
block|,
block|{
name|PDB_INT8ARRAY
block|,
literal|"data"
block|,
literal|"A byte array containing data"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_get_data_proc
specifier|static
name|ProcRecord
name|procedural_db_get_data_proc
init|=
block|{
literal|"gimp_procedural_db_get_data"
block|,
literal|"Returns data associated with the specified identifier."
block|,
literal|"This procedure returns any data which may have been associated with the specified identifier. The data is a variable length array of bytes. If no data has been associated with the identifier, an error is returned."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
literal|1
block|,
name|procedural_db_get_data_inargs
block|,
literal|2
block|,
name|procedural_db_get_data_outargs
block|,
block|{
block|{
name|procedural_db_get_data_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_get_data_size_invoker (Argument * args)
name|procedural_db_get_data_size_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|Argument
modifier|*
name|return_args
decl_stmt|;
name|gchar
modifier|*
name|identifier
decl_stmt|;
name|PDBData
modifier|*
name|data
init|=
name|NULL
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|identifier
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|identifier
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|success
operator|=
name|FALSE
expr_stmt|;
name|list
operator|=
name|data_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
name|data
operator|=
operator|(
name|PDBData
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
if|if
condition|(
operator|!
name|strcmp
argument_list|(
name|data
operator|->
name|identifier
argument_list|,
name|identifier
argument_list|)
condition|)
block|{
name|success
operator|=
name|TRUE
expr_stmt|;
break|break;
block|}
block|}
block|}
name|return_args
operator|=
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_get_data_size_proc
argument_list|,
name|success
argument_list|)
expr_stmt|;
if|if
condition|(
name|success
condition|)
name|return_args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
operator|=
name|data
operator|->
name|bytes
expr_stmt|;
return|return
name|return_args
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_get_data_size_inargs
specifier|static
name|ProcArg
name|procedural_db_get_data_size_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"identifier"
block|,
literal|"The identifier associated with data"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_get_data_size_outargs
specifier|static
name|ProcArg
name|procedural_db_get_data_size_outargs
index|[]
init|=
block|{
block|{
name|PDB_INT32
block|,
literal|"bytes"
block|,
literal|"The number of bytes in the data"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_get_data_size_proc
specifier|static
name|ProcRecord
name|procedural_db_get_data_size_proc
init|=
block|{
literal|"gimp_procedural_db_get_data_size"
block|,
literal|"Returns size of data associated with the specified identifier."
block|,
literal|"This procedure returns the size of any data which may have been associated with the specified identifier. If no data has been associated with the identifier, an error is returned."
block|,
literal|"Nick Lamb"
block|,
literal|"Nick Lamb"
block|,
literal|"1998"
block|,
name|PDB_INTERNAL
block|,
literal|1
block|,
name|procedural_db_get_data_size_inargs
block|,
literal|1
block|,
name|procedural_db_get_data_size_outargs
block|,
block|{
block|{
name|procedural_db_get_data_size_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_function
specifier|static
name|Argument
modifier|*
DECL|function|procedural_db_set_data_invoker (Argument * args)
name|procedural_db_set_data_invoker
parameter_list|(
name|Argument
modifier|*
name|args
parameter_list|)
block|{
name|gboolean
name|success
init|=
name|TRUE
decl_stmt|;
name|gchar
modifier|*
name|identifier
decl_stmt|;
name|gint32
name|bytes
decl_stmt|;
name|gint8
modifier|*
name|data_src
decl_stmt|;
name|PDBData
modifier|*
name|data
init|=
name|NULL
decl_stmt|;
name|GList
modifier|*
name|list
decl_stmt|;
name|identifier
operator|=
operator|(
name|gchar
operator|*
operator|)
name|args
index|[
literal|0
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|identifier
operator|==
name|NULL
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|bytes
operator|=
name|args
index|[
literal|1
index|]
operator|.
name|value
operator|.
name|pdb_int
expr_stmt|;
if|if
condition|(
name|bytes
operator|<=
literal|0
condition|)
name|success
operator|=
name|FALSE
expr_stmt|;
name|data_src
operator|=
operator|(
name|gint8
operator|*
operator|)
name|args
index|[
literal|2
index|]
operator|.
name|value
operator|.
name|pdb_pointer
expr_stmt|;
if|if
condition|(
name|success
condition|)
block|{
name|list
operator|=
name|data_list
expr_stmt|;
while|while
condition|(
name|list
condition|)
block|{
if|if
condition|(
operator|!
name|strcmp
argument_list|(
operator|(
operator|(
name|PDBData
operator|*
operator|)
name|list
operator|->
name|data
operator|)
operator|->
name|identifier
argument_list|,
name|identifier
argument_list|)
condition|)
name|data
operator|=
operator|(
name|PDBData
operator|*
operator|)
name|list
operator|->
name|data
expr_stmt|;
name|list
operator|=
name|list
operator|->
name|next
expr_stmt|;
block|}
comment|/* If there isn't already data with the specified identifier, create one */
if|if
condition|(
name|data
operator|==
name|NULL
condition|)
block|{
name|data
operator|=
operator|(
name|PDBData
operator|*
operator|)
name|g_new
argument_list|(
name|PDBData
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|data_list
operator|=
name|g_list_append
argument_list|(
name|data_list
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
else|else
name|g_free
argument_list|(
name|data
operator|->
name|data
argument_list|)
expr_stmt|;
name|data
operator|->
name|identifier
operator|=
name|g_strdup
argument_list|(
name|identifier
argument_list|)
expr_stmt|;
name|data
operator|->
name|bytes
operator|=
name|bytes
expr_stmt|;
name|data
operator|->
name|data
operator|=
name|g_new
argument_list|(
name|char
argument_list|,
name|data
operator|->
name|bytes
argument_list|)
expr_stmt|;
name|memcpy
argument_list|(
name|data
operator|->
name|data
argument_list|,
operator|(
name|char
operator|*
operator|)
name|data_src
argument_list|,
name|data
operator|->
name|bytes
argument_list|)
expr_stmt|;
block|}
return|return
name|procedural_db_return_args
argument_list|(
operator|&
name|procedural_db_set_data_proc
argument_list|,
name|success
argument_list|)
return|;
block|}
end_function

begin_decl_stmt
DECL|variable|procedural_db_set_data_inargs
specifier|static
name|ProcArg
name|procedural_db_set_data_inargs
index|[]
init|=
block|{
block|{
name|PDB_STRING
block|,
literal|"identifier"
block|,
literal|"The identifier associated with data"
block|}
block|,
block|{
name|PDB_INT32
block|,
literal|"bytes"
block|,
literal|"The number of bytes in the data"
block|}
block|,
block|{
name|PDB_INT8ARRAY
block|,
literal|"data"
block|,
literal|"A byte array containing data"
block|}
block|}
decl_stmt|;
end_decl_stmt

begin_decl_stmt
DECL|variable|procedural_db_set_data_proc
specifier|static
name|ProcRecord
name|procedural_db_set_data_proc
init|=
block|{
literal|"gimp_procedural_db_set_data"
block|,
literal|"Associates the specified identifier with the supplied data."
block|,
literal|"This procedure associates the supplied data with the provided identifier. The data may be subsequently retrieved by a call to 'procedural-db-get-data'."
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"Spencer Kimball& Peter Mattis"
block|,
literal|"1997"
block|,
name|PDB_INTERNAL
block|,
literal|3
block|,
name|procedural_db_set_data_inargs
block|,
literal|0
block|,
name|NULL
block|,
block|{
block|{
name|procedural_db_set_data_invoker
block|}
block|}
block|}
decl_stmt|;
end_decl_stmt

end_unit

